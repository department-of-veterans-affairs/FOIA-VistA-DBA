Released IB*2*305 SEQ #316
Extracted from mail message
**KIDS**:IB*2.0*305^

**INSTALL NAME**
IB*2.0*305
"BLD",6171,0)
IB*2.0*305^INTEGRATED BILLING^0^3060622^y
"BLD",6171,1,0)
^^1^1^3050810^^
"BLD",6171,1,1,0)
Companion patch for PRCA*4.5*232 - Vista AR IB extract -phase II -part II.
"BLD",6171,4,0)
^9.64PA^^
"BLD",6171,"ABPKG")
n
"BLD",6171,"KRN",0)
^9.67PA^8989.52^19
"BLD",6171,"KRN",.4,0)
.4
"BLD",6171,"KRN",.401,0)
.401
"BLD",6171,"KRN",.402,0)
.402
"BLD",6171,"KRN",.403,0)
.403
"BLD",6171,"KRN",.5,0)
.5
"BLD",6171,"KRN",.84,0)
.84
"BLD",6171,"KRN",3.6,0)
3.6
"BLD",6171,"KRN",3.8,0)
3.8
"BLD",6171,"KRN",9.2,0)
9.2
"BLD",6171,"KRN",9.8,0)
9.8
"BLD",6171,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6171,"KRN",9.8,"NM",1,0)
IBJDIPR^^0^B68845412
"BLD",6171,"KRN",9.8,"NM",2,0)
IBRFN4^^0^B25672480
"BLD",6171,"KRN",9.8,"NM",3,0)
IBCNBOA^^0^B46681109
"BLD",6171,"KRN",9.8,"NM","B","IBCNBOA",3)

"BLD",6171,"KRN",9.8,"NM","B","IBJDIPR",1)

"BLD",6171,"KRN",9.8,"NM","B","IBRFN4",2)

"BLD",6171,"KRN",19,0)
19
"BLD",6171,"KRN",19.1,0)
19.1
"BLD",6171,"KRN",101,0)
101
"BLD",6171,"KRN",409.61,0)
409.61
"BLD",6171,"KRN",771,0)
771
"BLD",6171,"KRN",870,0)
870
"BLD",6171,"KRN",8989.51,0)
8989.51
"BLD",6171,"KRN",8989.52,0)
8989.52
"BLD",6171,"KRN",8994,0)
8994
"BLD",6171,"KRN","B",.4,.4)

"BLD",6171,"KRN","B",.401,.401)

"BLD",6171,"KRN","B",.402,.402)

"BLD",6171,"KRN","B",.403,.403)

"BLD",6171,"KRN","B",.5,.5)

"BLD",6171,"KRN","B",.84,.84)

"BLD",6171,"KRN","B",3.6,3.6)

"BLD",6171,"KRN","B",3.8,3.8)

"BLD",6171,"KRN","B",9.2,9.2)

"BLD",6171,"KRN","B",9.8,9.8)

"BLD",6171,"KRN","B",19,19)

"BLD",6171,"KRN","B",19.1,19.1)

"BLD",6171,"KRN","B",101,101)

"BLD",6171,"KRN","B",409.61,409.61)

"BLD",6171,"KRN","B",771,771)

"BLD",6171,"KRN","B",870,870)

"BLD",6171,"KRN","B",8989.51,8989.51)

"BLD",6171,"KRN","B",8989.52,8989.52)

"BLD",6171,"KRN","B",8994,8994)

"BLD",6171,"QUES",0)
^9.62^^
"BLD",6171,"REQB",0)
^9.611^4^4
"BLD",6171,"REQB",1,0)
IB*2.0*233^2
"BLD",6171,"REQB",2,0)
IB*2.0*301^2
"BLD",6171,"REQB",3,0)
PRCA*4.5*201^2
"BLD",6171,"REQB",4,0)
PRCA*4.5*228^2
"BLD",6171,"REQB","B","IB*2.0*233",1)

"BLD",6171,"REQB","B","IB*2.0*301",2)

"BLD",6171,"REQB","B","PRCA*4.5*201",3)

"BLD",6171,"REQB","B","PRCA*4.5*228",4)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
305^3060622^7
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3060622
"PKG",200,22,1,"PAH",1,1,1,0)
Companion patch for PRCA*4.5*232 - Vista AR IB extract -phase II -part II.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBCNBOA")
0^3^B46681109^B43063126
"RTN","IBCNBOA",1,0)
IBCNBOA ;ALB/ARH-Ins Buffer: Activity Report ;1 Jun 97
"RTN","IBCNBOA",2,0)
 ;;2.0;INTEGRATED BILLING;**82,305**;21-MAR-94
"RTN","IBCNBOA",3,0)
 ;
"RTN","IBCNBOA",4,0)
EN ;get parameters then run the report
"RTN","IBCNBOA",5,0)
 ;
"RTN","IBCNBOA",6,0)
 K ^TMP($J) D HOME^%ZIS S IBHDR="INSURANCE BUFFER ACTIVITY REPORT" W @IOF,!!,?25,IBHDR
"RTN","IBCNBOA",7,0)
 W !!,"This report contains the counts and time statistics for all activity in the",!,"Insurance Buffer.",!!
"RTN","IBCNBOA",8,0)
 ;
"RTN","IBCNBOA",9,0)
 S IBBEG=$$DATES^IBCNBOE("Beginning") G:'IBBEG EXIT
"RTN","IBCNBOA",10,0)
 S IBEND=$$DATES^IBCNBOE("Ending",IBBEG) G:'IBEND EXIT  W !!
"RTN","IBCNBOA",11,0)
 ;
"RTN","IBCNBOA",12,0)
 S IBMONTH=$$MONTH^IBCNBOE G:IBMONTH="" EXIT  W !!
"RTN","IBCNBOA",13,0)
 ;
"RTN","IBCNBOA",14,0)
DEV ;get the device
"RTN","IBCNBOA",15,0)
 S %ZIS="QM",%ZIS("A")="OUTPUT DEVICE: " D ^%ZIS G:POP EXIT
"RTN","IBCNBOA",16,0)
 I $D(IO("Q")) S ZTRTN="RPT^IBCNBOA",ZTDESC=IBHDR,ZTSAVE("IB*")="" D ^%ZTLOAD K IO("Q") G EXIT
"RTN","IBCNBOA",17,0)
 U IO
"RTN","IBCNBOA",18,0)
 ;
"RTN","IBCNBOA",19,0)
RPT ; run report
"RTN","IBCNBOA",20,0)
 S IBQUIT=0
"RTN","IBCNBOA",21,0)
 ;
"RTN","IBCNBOA",22,0)
 ;Patch 305- QUIT in line below inserted for transmission to ARC
"RTN","IBCNBOA",23,0)
 D SEARCH(IBBEG,IBEND,IBMONTH) Q:$G(IBARFLAG)  G:IBQUIT EXIT
"RTN","IBCNBOA",24,0)
 D PRINT(IBBEG,IBEND)
"RTN","IBCNBOA",25,0)
 ;
"RTN","IBCNBOA",26,0)
EXIT K ^TMP($J),IBHDR,IBBEG,IBEND,IBMONTH,IBQUIT
"RTN","IBCNBOA",27,0)
 Q:$D(ZTQUEUED)
"RTN","IBCNBOA",28,0)
 D ^%ZISC
"RTN","IBCNBOA",29,0)
 Q
"RTN","IBCNBOA",30,0)
 ;
"RTN","IBCNBOA",31,0)
SEARCH(IBBEG,IBEND,IBMONTH) ; search/sort statistics for activity report
"RTN","IBCNBOA",32,0)
 N IBXST,IBXDT,IBBUFDA,IBB0,IBSTAT,IBTIME,IBS3,IBDATE,IBVER,IBDT2 S IBQUIT=""
"RTN","IBCNBOA",33,0)
 S IBBEG=$G(IBBEG)-.01,IBEND=$S('$G(IBEND):9999999,1:$P(IBEND,".")+.9)
"RTN","IBCNBOA",34,0)
 ;
"RTN","IBCNBOA",35,0)
 S IBXST="" F  S IBXST=$O(^IBA(355.33,"AFST",IBXST)) Q:IBXST=""  D   Q:IBQUIT
"RTN","IBCNBOA",36,0)
 . S IBXDT=+IBBEG F  S IBXDT=$O(^IBA(355.33,"AFST",IBXST,IBXDT)) Q:'IBXDT!(IBXDT>IBEND)  D  S IBQUIT=$$STOP Q:IBQUIT
"RTN","IBCNBOA",37,0)
 .. S IBBUFDA=0 F  S IBBUFDA=$O(^IBA(355.33,"AFST",IBXST,IBXDT,IBBUFDA)) Q:'IBBUFDA  D
"RTN","IBCNBOA",38,0)
 ... ;
"RTN","IBCNBOA",39,0)
 ... S IBB0=$G(^IBA(355.33,IBBUFDA,0)),IBSTAT=$P(IBB0,U,4),IBVER=$P(IBB0,U,10)
"RTN","IBCNBOA",40,0)
 ... ;
"RTN","IBCNBOA",41,0)
 ... ; entered
"RTN","IBCNBOA",42,0)
 ... I IBXST="E" S IBDATE=+IBB0 I +IBDATE,IBDATE>IBBEG,IBDATE<IBEND D
"RTN","IBCNBOA",43,0)
 .... S IBDT2=+$P(IBB0,U,10) I 'IBDT2 S IBDT2=+$P(IBB0,U,5) I 'IBDT2 S IBDT2=$$NOW^XLFDT
"RTN","IBCNBOA",44,0)
 .... S IBTIME=+$$FMDIFF^XLFDT(IBDT2,IBDATE,2),IBSTAT="ENTERED",IBS3=1
"RTN","IBCNBOA",45,0)
 .... I +$G(IBMONTH) D SET(IBSTAT,$E(IBDATE,1,5),IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",46,0)
 .... D SET(IBSTAT,99999,IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",47,0)
 ... ;
"RTN","IBCNBOA",48,0)
 ... ; verified
"RTN","IBCNBOA",49,0)
 ... I IBXST="V" S IBDATE=+$P(IBB0,U,10) I +IBDATE,IBDATE>IBBEG,IBDATE<IBEND D
"RTN","IBCNBOA",50,0)
 .... S IBTIME=+$$FMDIFF^XLFDT(IBDATE,+IBB0,2),IBSTAT="VERIFIED",IBS3=2
"RTN","IBCNBOA",51,0)
 .... I +$G(IBMONTH) D SET(IBSTAT,$E(IBDATE,1,5),IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",52,0)
 .... D SET(IBSTAT,99999,IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",53,0)
 ... ;
"RTN","IBCNBOA",54,0)
 ... ; processed
"RTN","IBCNBOA",55,0)
 ... I IBXST="A"!(IBXST="R") S IBDATE=+$P(IBB0,U,5) I +IBDATE,IBDATE>IBBEG,IBDATE<IBEND D
"RTN","IBCNBOA",56,0)
 .... S IBDT2=+IBVER I 'IBVER S IBDT2=+IBB0
"RTN","IBCNBOA",57,0)
 .... S IBTIME=+$$FMDIFF^XLFDT(IBDATE,+IBDT2,2),IBSTAT="UNKNOWN",IBS3=6
"RTN","IBCNBOA",58,0)
 .... I $P(IBB0,U,4)="A" S IBS3=3,IBSTAT="ACCEPTED" I 'IBVER S IBS3=4,IBSTAT=IBSTAT_" (&V)"
"RTN","IBCNBOA",59,0)
 .... I $P(IBB0,U,4)="R" S IBS3=5,IBSTAT="REJECTED" I +IBVER S IBS3=6,IBSTAT=IBSTAT_" (V)"
"RTN","IBCNBOA",60,0)
 .... I +$G(IBMONTH) D SET(IBSTAT,$E(IBDATE,1,5),IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",61,0)
 .... D SET(IBSTAT,99999,IBS3,IBTIME,IBB0)
"RTN","IBCNBOA",62,0)
 ;
"RTN","IBCNBOA",63,0)
 Q
"RTN","IBCNBOA",64,0)
 ;
"RTN","IBCNBOA",65,0)
SET(STAT,S1,S3,TIME,IBB0) ;
"RTN","IBCNBOA",66,0)
 D TMP("IBCNBOA",S1,1,S3,TIME,STAT)
"RTN","IBCNBOA",67,0)
 I S3<3 D TMP("IBCNBOA",S1,2,1,TIME,"NOT PROCESSED")
"RTN","IBCNBOA",68,0)
 I S3>2 D TMP("IBCNBOA",S1,2,2,TIME,"PROCESSED")
"RTN","IBCNBOA",69,0)
 D TMP("IBCNBOA",S1,2,9,TIME,"TOTAL")
"RTN","IBCNBOA",70,0)
 ;
"RTN","IBCNBOA",71,0)
 Q:$E(STAT)'="A"
"RTN","IBCNBOA",72,0)
 ;
"RTN","IBCNBOA",73,0)
 D TMP1("IBCNBOAC",S1,+$P(IBB0,U,7),+$P(IBB0,U,8),+$P(IBB0,U,9))
"RTN","IBCNBOA",74,0)
 Q
"RTN","IBCNBOA",75,0)
 ;
"RTN","IBCNBOA",76,0)
TMP(XREF,S1,S2,S3,TIME,NAME) ;
"RTN","IBCNBOA",77,0)
 S ^TMP($J,XREF,S1,S2,S3)=NAME
"RTN","IBCNBOA",78,0)
 S ^TMP($J,XREF,S1,S2,S3,"CNT")=$G(^TMP($J,XREF,S1,S2,S3,"CNT"))+1
"RTN","IBCNBOA",79,0)
 S ^TMP($J,XREF,S1,S2,S3,"TM")=$G(^TMP($J,XREF,S1,S2,S3,"TM"))+TIME
"RTN","IBCNBOA",80,0)
 I '$G(^TMP($J,XREF,S1,S2,S3,"HG"))!($G(^TMP($J,XREF,S1,S2,S3,"HG"))<TIME) S ^TMP($J,XREF,S1,S2,S3,"HG")=TIME
"RTN","IBCNBOA",81,0)
 I '$G(^TMP($J,XREF,S1,S2,S3,"LS"))!($G(^TMP($J,XREF,S1,S2,S3,"LS"))>TIME) S ^TMP($J,XREF,S1,S2,S3,"LS")=TIME
"RTN","IBCNBOA",82,0)
 Q
"RTN","IBCNBOA",83,0)
 ;
"RTN","IBCNBOA",84,0)
TMP1(XREF,S1,IC,GC,PC) ;
"RTN","IBCNBOA",85,0)
 I +IC S ^TMP($J,XREF,S1,"I")=$G(^TMP($J,XREF,S1,"I"))+1
"RTN","IBCNBOA",86,0)
 I +GC S ^TMP($J,XREF,S1,"G")=$G(^TMP($J,XREF,S1,"G"))+1
"RTN","IBCNBOA",87,0)
 I +PC S ^TMP($J,XREF,S1,"P")=$G(^TMP($J,XREF,S1,"P"))+1
"RTN","IBCNBOA",88,0)
 S ^TMP($J,XREF,S1,"CNT")=$G(^TMP($J,XREF,S1,"CNT"))+1
"RTN","IBCNBOA",89,0)
 Q
"RTN","IBCNBOA",90,0)
 ;
"RTN","IBCNBOA",91,0)
 ;
"RTN","IBCNBOA",92,0)
 ;
"RTN","IBCNBOA",93,0)
PRINT(IBBEG,IBEND) ;
"RTN","IBCNBOA",94,0)
 N IBXREF,IBLABLE,IBS1,IBS2,IBS3,IBINS,IBGRP,IBPOL,IBCNT,IBIP,IBGP,IBPP,IBRDT,IBPGN,IBRANGE,IBLN,IBI
"RTN","IBCNBOA",95,0)
 ;
"RTN","IBCNBOA",96,0)
 S IBRANGE=$$FMTE^XLFDT(+IBBEG)_" - "_$$FMTE^XLFDT(IBEND)
"RTN","IBCNBOA",97,0)
 S IBRDT=$$FMTE^XLFDT($J($$NOW^XLFDT,0,4),2),IBRDT=$TR(IBRDT,"@"," "),IBPGN=0
"RTN","IBCNBOA",98,0)
 D HDR
"RTN","IBCNBOA",99,0)
 ;
"RTN","IBCNBOA",100,0)
 S IBXREF="IBCNBOA",IBS1="" F  S IBS1=$O(^TMP($J,IBXREF,IBS1)) Q:IBS1=""  D:IBLN>(IOSL-17) HDR Q:IBQUIT  D  S IBLN=IBLN+7
"RTN","IBCNBOA",101,0)
 . S IBLABLE=$S(IBS1=99999:"TOTALS",($E(IBBEG,1,5)<IBS1)&($E(IBEND,1,5)>IBS1):$$FMTE^XLFDT(IBS1_"00"),1:"")
"RTN","IBCNBOA",102,0)
 . I IBLABLE="" S IBLABLE=$$FMTE^XLFDT($S($E(IBBEG,1,5)<IBS1:IBS1_1,1:IBBEG))_" - "_$$FMTE^XLFDT($S($E(IBEND,1,5)>IBS1:$$SCH^XLFDT("1M(L)",IBS1_11),1:IBEND))
"RTN","IBCNBOA",103,0)
 . W !,?(40-($L(IBLABLE)/2)),IBLABLE,!
"RTN","IBCNBOA",104,0)
 . W !,?43,"AVERAGE",?56,"LONGEST",?68,"SHORTEST"
"RTN","IBCNBOA",105,0)
 . W !,"STATUS",?22,"COUNT",?30,"PERCENT",?43,"# DAYS",?56,"# DAYS",?68,"# DAYS"
"RTN","IBCNBOA",106,0)
 . ;
"RTN","IBCNBOA",107,0)
 . S IBS2=0 F  S IBS2=$O(^TMP($J,IBXREF,IBS1,IBS2)) Q:IBS2=""  D  S IBLN=IBLN+1
"RTN","IBCNBOA",108,0)
 .. W !,"-----------------------------------------------------------------------------"
"RTN","IBCNBOA",109,0)
 .. S IBS3="" F  S IBS3=$O(^TMP($J,IBXREF,IBS1,IBS2,IBS3)) Q:'IBS3  D PRTLN  S IBLN=IBLN+1
"RTN","IBCNBOA",110,0)
 . ;
"RTN","IBCNBOA",111,0)
 . S IBINS=+$G(^TMP($J,"IBCNBOAC",IBS1,"I")),IBGRP=+$G(^TMP($J,"IBCNBOAC",IBS1,"G"))
"RTN","IBCNBOA",112,0)
 . S IBPOL=+$G(^TMP($J,"IBCNBOAC",IBS1,"P")),IBCNT=+$G(^TMP($J,"IBCNBOAC",IBS1,"CNT"))
"RTN","IBCNBOA",113,0)
 . S (IBIP,IBGP,IBPP)=0 I IBCNT'=0 S IBIP=((IBINS/IBCNT)*100)\1,IBGP=((IBGRP/IBCNT)*100)\1,IBPP=((IBPOL/IBCNT)*100)\1
"RTN","IBCNBOA",114,0)
 . W !!,?2,IBINS," New Compan",$S(IBINS=1:"y",1:"ies")," (",IBIP,"%), "
"RTN","IBCNBOA",115,0)
 . W IBGRP," New Group/Plan",$S(IBGRP=1:"",1:"s")," (",IBGP,"%), "
"RTN","IBCNBOA",116,0)
 . W IBPOL," New Patient Polic",$S(IBPOL=1:"y",1:"ies")," (",IBPP,"%)",!
"RTN","IBCNBOA",117,0)
 Q
"RTN","IBCNBOA",118,0)
 ;
"RTN","IBCNBOA",119,0)
PRTLN ;
"RTN","IBCNBOA",120,0)
 N IBSTX,IBCNT,IBTM,IBHG,IBLS,IBTCNT
"RTN","IBCNBOA",121,0)
 ;
"RTN","IBCNBOA",122,0)
 S IBSTX=$G(^TMP($J,IBXREF,IBS1,IBS2,IBS3))
"RTN","IBCNBOA",123,0)
 S IBCNT=$G(^TMP($J,IBXREF,IBS1,IBS2,IBS3,"CNT")) Q:'IBCNT
"RTN","IBCNBOA",124,0)
 S IBTM=$G(^TMP($J,IBXREF,IBS1,IBS2,IBS3,"TM"))
"RTN","IBCNBOA",125,0)
 S IBHG=$G(^TMP($J,IBXREF,IBS1,IBS2,IBS3,"HG"))
"RTN","IBCNBOA",126,0)
 S IBLS=$G(^TMP($J,IBXREF,IBS1,IBS2,IBS3,"LS"))
"RTN","IBCNBOA",127,0)
 S IBTCNT=$G(^TMP($J,IBXREF,IBS1,2,9,"CNT")) Q:'IBTCNT
"RTN","IBCNBOA",128,0)
 ;
"RTN","IBCNBOA",129,0)
 W !,IBSTX,?20,$J($FN(IBCNT,","),7),?30,$J(((IBCNT/IBTCNT)*100),6,1),"%",?43,$J($$STD((IBTM/IBCNT)),6,1),?56,$J($$STD(IBHG),6,1),?68,$J($$STD(IBLS),6,1)
"RTN","IBCNBOA",130,0)
 Q
"RTN","IBCNBOA",131,0)
 ;
"RTN","IBCNBOA",132,0)
STD(SEC) ; convert seconds to days
"RTN","IBCNBOA",133,0)
 N IBX,IBD,IBS,IBH,DAYS S DAYS="" G:'$G(SEC) STDQ
"RTN","IBCNBOA",134,0)
 S IBD=(SEC/86400),IBD=+$P(IBD,".")
"RTN","IBCNBOA",135,0)
 S IBS=SEC-(IBD*86400)
"RTN","IBCNBOA",136,0)
 S IBH=((IBS/60)/60),IBH=+$J(IBH,0,2)
"RTN","IBCNBOA",137,0)
 S DAYS=IBD+(IBH/24)
"RTN","IBCNBOA",138,0)
STDQ Q DAYS
"RTN","IBCNBOA",139,0)
 ;
"RTN","IBCNBOA",140,0)
HDR ;print the report header
"RTN","IBCNBOA",141,0)
 S IBQUIT=$$STOP Q:IBQUIT
"RTN","IBCNBOA",142,0)
 I IBPGN>0 S IBQUIT=$$PAUSE Q:IBQUIT
"RTN","IBCNBOA",143,0)
 S IBPGN=IBPGN+1,IBLN=4 I IBPGN>1!($E(IOST,1,2)["C-") W @IOF
"RTN","IBCNBOA",144,0)
 W !,"INSURANCE BUFFER ACTIVITY REPORT   ",IBRANGE," "
"RTN","IBCNBOA",145,0)
 W ?(IOM-22),IBRDT,?(IOM-7)," PAGE ",IBPGN,!
"RTN","IBCNBOA",146,0)
 S IBI="",$P(IBI,"-",IOM+1)="" W IBI,!
"RTN","IBCNBOA",147,0)
 Q
"RTN","IBCNBOA",148,0)
 ;
"RTN","IBCNBOA",149,0)
PAUSE() ;pause at end of screen if being displayed on a terminal
"RTN","IBCNBOA",150,0)
 N IBX,DIR,DIRUT,X,Y S IBX=0
"RTN","IBCNBOA",151,0)
 I $E(IOST,1,2)["C-" W !! S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DIRUT)) S IBX=1
"RTN","IBCNBOA",152,0)
 Q IBX
"RTN","IBCNBOA",153,0)
 ;
"RTN","IBCNBOA",154,0)
STOP() ;determine if user has requested the queued report to stop
"RTN","IBCNBOA",155,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ I +$G(IBPGN) W !,"***TASK STOPPED BY USER***"
"RTN","IBCNBOA",156,0)
 Q +$G(ZTSTOP)
"RTN","IBCNBOA",157,0)
 ;
"RTN","IBCNBOA",158,0)
IBAR(IBBEG,IBEND) ;Entry point for Vista IB AR data to ARC
"RTN","IBCNBOA",159,0)
 ;patch 305 - called by IBRFN4
"RTN","IBCNBOA",160,0)
 N IBMONTH,IBARFLAG,IBARDATA,IBTM,IBCNT
"RTN","IBCNBOA",161,0)
 S IBMONTH=0,IBARFLAG=1 K ^TMP($J)
"RTN","IBCNBOA",162,0)
 D RPT
"RTN","IBCNBOA",163,0)
 S IBTM=$G(^TMP($J,"IBCNBOA",99999,2,2,"TM"))
"RTN","IBCNBOA",164,0)
 S IBCNT=$G(^TMP($J,"IBCNBOA",99999,2,2,"CNT"))
"RTN","IBCNBOA",165,0)
 I 'IBCNT S IBARDATA=0 G IBARQ
"RTN","IBCNBOA",166,0)
 S IBARDATA=$FN($$STD((IBTM/IBCNT)),"",1)
"RTN","IBCNBOA",167,0)
 K ^TMP($J)
"RTN","IBCNBOA",168,0)
IBARQ Q IBARDATA
"RTN","IBJDIPR")
0^1^B68845412^B63713595
"RTN","IBJDIPR",1,0)
IBJDIPR ;ALB/HMC - PERCENTAGE OF PATIENTS PREREGISTERED REPORT ;10-MAY-2004
"RTN","IBJDIPR",2,0)
 ;;2.0;INTEGRATED BILLING;**272,305**;21-MAR-1994
"RTN","IBJDIPR",3,0)
 ;
"RTN","IBJDIPR",4,0)
EN ; - Option entry point.
"RTN","IBJDIPR",5,0)
 ;
"RTN","IBJDIPR",6,0)
 D ENQ1
"RTN","IBJDIPR",7,0)
 W !!,"This report provides number of patients treated, the number of"
"RTN","IBJDIPR",8,0)
 W !,"patients pre-registered, % of patients pre-registered, number of"
"RTN","IBJDIPR",9,0)
 W !,"patients pre-registered past the pre-registration time frame,"
"RTN","IBJDIPR",10,0)
 W !,"number of patients never pre-registered, the clinic exclusions,"
"RTN","IBJDIPR",11,0)
 W !,"and the eligibility exclusions.",!!
"RTN","IBJDIPR",12,0)
 ;
"RTN","IBJDIPR",13,0)
DATE D DATE^IBOUTL I IBBDT=""!(IBEDT="") G ENQ
"RTN","IBJDIPR",14,0)
 ;
"RTN","IBJDIPR",15,0)
 ;
"RTN","IBJDIPR",16,0)
TIME ;Pre-Registration time frame, default is 180 days
"RTN","IBJDIPR",17,0)
 ;
"RTN","IBJDIPR",18,0)
 S DIR(0)="N^^I X'>0 K X"
"RTN","IBJDIPR",19,0)
 S DIR("A")="Pre-Registration time frame (days)" W !
"RTN","IBJDIPR",20,0)
 S DIR("B")=180
"RTN","IBJDIPR",21,0)
 S DIR("?")="^D THLP^IBJDIPR"
"RTN","IBJDIPR",22,0)
 D ^DIR
"RTN","IBJDIPR",23,0)
 S IBPRF=Y
"RTN","IBJDIPR",24,0)
 I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) G ENQ
"RTN","IBJDIPR",25,0)
 ;
"RTN","IBJDIPR",26,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",27,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("?")="^D EHLP^IBJDIPR"
"RTN","IBJDIPR",28,0)
 S DIR("A")="Detailed list of Exclusions (Y/N)"
"RTN","IBJDIPR",29,0)
 D ^DIR
"RTN","IBJDIPR",30,0)
 S IBEXC=+Y
"RTN","IBJDIPR",31,0)
 I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) G ENQ
"RTN","IBJDIPR",32,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",33,0)
 ;
"RTN","IBJDIPR",34,0)
 W !!,"This report only requires an 80 column printer."
"RTN","IBJDIPR",35,0)
 W !!,"Note: This report may take a while to run."
"RTN","IBJDIPR",36,0)
 W !!,"You should queue this report to run after normal business hours.",!
"RTN","IBJDIPR",37,0)
 ;
"RTN","IBJDIPR",38,0)
 ; - Select a device.
"RTN","IBJDIPR",39,0)
 S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDIPR",40,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDIPR",41,0)
 .S ZTRTN="DQ^IBJDIPR",ZTDESC="IB - PERCENTAGE OF PATIENTS PREREGISTERED"
"RTN","IBJDIPR",42,0)
 .S ZTSAVE("IB*")=""
"RTN","IBJDIPR",43,0)
 .D ^%ZTLOAD
"RTN","IBJDIPR",44,0)
 .W !!,$S($D(ZTSK):"This job has been queued. The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBJDIPR",45,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDIPR",46,0)
 ;
"RTN","IBJDIPR",47,0)
 U IO
"RTN","IBJDIPR",48,0)
 ;
"RTN","IBJDIPR",49,0)
DQ ; - Tasked entry point.
"RTN","IBJDIPR",50,0)
 ;
"RTN","IBJDIPR",51,0)
 N IBQUERY,IBQUERY1,DGNAM
"RTN","IBJDIPR",52,0)
 K IB,^TMP("IBJDIPR",$J),^TMP("IBJDIPR1",$J)
"RTN","IBJDIPR",53,0)
 ;
"RTN","IBJDIPR",54,0)
 ;Temporary global IBJDIPR contains outpatients found for date range in the outpatient encounter file"
"RTN","IBJDIPR",55,0)
 ;Temporary global IBJDIPR1 contains the clinic exclusions found in the MAS parameter file"
"RTN","IBJDIPR",56,0)
 ;
"RTN","IBJDIPR",57,0)
 S (IBQ,DGPREC,DGPREE)=0
"RTN","IBJDIPR",58,0)
 F I="TOT","PRE","PAST","NEVR" S IB(I)=0
"RTN","IBJDIPR",59,0)
 ;
"RTN","IBJDIPR",60,0)
 ;Build exclusion temporary file from MAS parameter file,
"RTN","IBJDIPR",61,0)
 ; ^DG(43 - dbia 4242
"RTN","IBJDIPR",62,0)
 ;
"RTN","IBJDIPR",63,0)
 ;Get clinic exclusions and clinic name from ^SC (Hospital location file)
"RTN","IBJDIPR",64,0)
 ;dbia 401
"RTN","IBJDIPR",65,0)
 S X="" F  S X=$O(^DG(43,1,"DGPREC","B",X)) Q:X=""  D
"RTN","IBJDIPR",66,0)
 . S DGNAM=$P($G(^SC(X,0)),U,1) I DGNAM="" Q
"RTN","IBJDIPR",67,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREC",X)=""
"RTN","IBJDIPR",68,0)
 . S ^TMP("IBJDIPR1",$J,"DGPRECA",DGNAM_U_X)=X ;index sorted by name
"RTN","IBJDIPR",69,0)
 . S DGPREC=DGPREC+1
"RTN","IBJDIPR",70,0)
 ;
"RTN","IBJDIPR",71,0)
 ;Get eligibility exclusions and eligibility name from ^DIC(8 dbia 427
"RTN","IBJDIPR",72,0)
 ;
"RTN","IBJDIPR",73,0)
 S X="" F  S X=$O(^DG(43,1,"DGPREE","B",X)) Q:X=""  D
"RTN","IBJDIPR",74,0)
 . S DGNAM=$P($G(^DIC(8,X,0)),U,1) I DGNAM="" Q
"RTN","IBJDIPR",75,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREE",X)=""
"RTN","IBJDIPR",76,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREEA",DGNAM_U_X)=X ;index sorted by name
"RTN","IBJDIPR",77,0)
 . S DGPREE=DGPREE+1
"RTN","IBJDIPR",78,0)
 ;
"RTN","IBJDIPR",79,0)
 ; - Find outpatients treated within the user-specified date range.
"RTN","IBJDIPR",80,0)
 D OUTPT("",IBBDT,IBEDT,"S:IBQ SDSTOP=1 I 'IBQ,$$ENCHK^IBJDI5(Y0) D ENC^IBJDIPR(Y0)","Percentage of Patients Pre-registered",.IBQ,"IBJDIPR",.IBQUERY)
"RTN","IBJDIPR",81,0)
 D CLOSE^IBSDU(.IBQUERY),CLOSE^IBSDU(.IBQUERY1) I IBQ G ENQ
"RTN","IBJDIPR",82,0)
 ;
"RTN","IBJDIPR",83,0)
 ;Find pre-registered patients
"RTN","IBJDIPR",84,0)
 ;Use file 41.41 (^DGS), Pre-registration audit file
"RTN","IBJDIPR",85,0)
 ;dbia 4425
"RTN","IBJDIPR",86,0)
 ;
"RTN","IBJDIPR",87,0)
 S DFN=""
"RTN","IBJDIPR",88,0)
 F  S DFN=$O(^TMP("IBJDIPR",$J,DFN)) Q:DFN=""  D
"RTN","IBJDIPR",89,0)
 . S TRDAT=^TMP("IBJDIPR",$J,DFN) ;Get treatment date
"RTN","IBJDIPR",90,0)
 . S IB("TOT")=IB("TOT")+1 ;Total unique patients treated
"RTN","IBJDIPR",91,0)
 . S PRDAT=TRDAT+.0000001
"RTN","IBJDIPR",92,0)
 . S PRDAT=$O(^DGS(41.41,"ADC",DFN,PRDAT),-1) ;Most recent pre-reg date
"RTN","IBJDIPR",93,0)
 . I PRDAT="" S IB("NEVR")=IB("NEVR")+1 Q  ;never pre-registered
"RTN","IBJDIPR",94,0)
 . I PRDAT<$$FMADD^XLFDT(TRDAT,-IBPRF) S IB("PAST")=IB("PAST")+1 Q  ;past time frame
"RTN","IBJDIPR",95,0)
 . S IB("PRE")=IB("PRE")+1 ;pre-registered
"RTN","IBJDIPR",96,0)
 ;
"RTN","IBJDIPR",97,0)
 ; - Print the reports.
"RTN","IBJDIPR",98,0)
 ; QUIT if this is a electronic transmission to the ARC -IB patch 305
"RTN","IBJDIPR",99,0)
 Q:$G(IBARFLAG)
"RTN","IBJDIPR",100,0)
 S (IBQ,IBPAG)=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%)
"RTN","IBJDIPR",101,0)
 I 'IBQ D SUM,PAUSE
"RTN","IBJDIPR",102,0)
ENQ K ^TMP("IBJDIPR",$J),^TMP("IBJDIPR1",$J)
"RTN","IBJDIPR",103,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDIPR",104,0)
 ;
"RTN","IBJDIPR",105,0)
 D ^%ZISC
"RTN","IBJDIPR",106,0)
ENQ1 K IB,IBQ,IBBDT,IBEDT,IBD,IBPAG,IBRUN,IBOED,IBPRF
"RTN","IBJDIPR",107,0)
 K DFN,POP,I,X,X1,X2,Y,%,%ZIS,ZTDESC,ZTRTN,ZTSAVE,ZTREQ,ZTQUEUED
"RTN","IBJDIPR",108,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",109,0)
 K DGPREC,DGPREE,PRDAT,TRDAT,IBEXC,DGEE,DGEC,PCENT,TAB,DGNAM
"RTN","IBJDIPR",110,0)
 Q
"RTN","IBJDIPR",111,0)
 ;
"RTN","IBJDIPR",112,0)
OUTPT(DFN,IBBDT,IBEDT,IBCBK,IBMSG,IBQ,IBSUBSCR,IBQUERY,IBDIR) ;
"RTN","IBJDIPR",113,0)
 ; Input:   DFN = IEN of patient if using PATIENT/DATE index, otherwise,
"RTN","IBJDIPR",114,0)
 ;                if null or 0, DATE/TIME index will be used
"RTN","IBJDIPR",115,0)
 ;        IBCBK = The MUMPS code to execute when valid enctr found
"RTN","IBJDIPR",116,0)
 ;        IBBDT/IBEDT = The start/end dates
"RTN","IBJDIPR",117,0)
 ;        IBMSG = The text to send to STOP PROCESSING CALL (if null, no
"RTN","IBJDIPR",118,0)
 ;                call made)
"RTN","IBJDIPR",119,0)
 ;          IBQ = Flag that says whether or not the process was stopped
"RTN","IBJDIPR",120,0)
 ;                by user
"RTN","IBJDIPR",121,0)
 ;      IBQUERY = The # of the QUERY OBJECT to be used to extract outpt
"RTN","IBJDIPR",122,0)
 ;                visits
"RTN","IBJDIPR",123,0)
 ;        IBDIR = Null to look forward, 'B' to look backward thru file
"RTN","IBJDIPR",124,0)
 ;
"RTN","IBJDIPR",125,0)
 N IBVAL,IBFILTER
"RTN","IBJDIPR",126,0)
 S IBVAL("BDT")=IBBDT,IBVAL("EDT")=IBEDT_".99" S:$G(DFN) IBVAL("DFN")=DFN
"RTN","IBJDIPR",127,0)
 ;
"RTN","IBJDIPR",128,0)
 ; - Look at parent encounters, completely checked out, check user
"RTN","IBJDIPR",129,0)
 ;   requested to quit, process each pt only once if IBSUBSCR'=null
"RTN","IBJDIPR",130,0)
 S IBFILTER=""
"RTN","IBJDIPR",131,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,7),$S((Y#100)'=0:1,$G(IBMSG)="""":1,1:'$$STOP^IBJDI21(.IBQ,IBMSG))"_" "_IBCBK
"RTN","IBJDIPR",132,0)
 S IBDIR=$S($G(IBDIR)="":"",1:"BACKWARD")
"RTN","IBJDIPR",133,0)
 ;
"RTN","IBJDIPR",134,0)
 ;ibsdu will use ^SD(409.1), Standard encounter query, to process
"RTN","IBJDIPR",135,0)
 ;file 409.68 (^SCE) - dbia402 for outpatient encounter data.
"RTN","IBJDIPR",136,0)
 ;
"RTN","IBJDIPR",137,0)
 D SCAN^IBSDU($S($G(DFN):"PATIENT/DATE",1:"DATE/TIME"),.IBVAL,IBFILTER,IBCBK,0,.IBQUERY,IBDIR) K ^TMP("DIERR",$J)
"RTN","IBJDIPR",138,0)
 Q
"RTN","IBJDIPR",139,0)
 ;
"RTN","IBJDIPR",140,0)
ENC(IBOED) ; - Encounter extract.
"RTN","IBJDIPR",141,0)
 ; Input:    IBOED = Data from outpatient encounter file, ^SCE.
"RTN","IBJDIPR",142,0)
 ;
"RTN","IBJDIPR",143,0)
 S DFN=+$P(IBOED,U,2) I 'DFN Q
"RTN","IBJDIPR",144,0)
 ;Check exclusions
"RTN","IBJDIPR",145,0)
 I $P(IBOED,U,4)]"",$D(^TMP("IBJDIPR1",$J,"DGPREC",$P(IBOED,U,4))) Q  ;Clinic exclusion
"RTN","IBJDIPR",146,0)
 I $P(IBOED,U,13)]"",$D(^TMP("IBJDIPR1",$J,"DGPREE",$P(IBOED,U,13))) Q  ;Eligibility exclusion
"RTN","IBJDIPR",147,0)
 D PROC(DFN,IBOED) ; Process patient.
"RTN","IBJDIPR",148,0)
 Q
"RTN","IBJDIPR",149,0)
 ;
"RTN","IBJDIPR",150,0)
PROC(DFN,IBOED) ; - Process each specific patient.
"RTN","IBJDIPR",151,0)
 ; Input:     DFN = Pointer to the patient in file #2
"RTN","IBJDIPR",152,0)
 ;          IBOED = Data from outpatient encounter file, ^SCE.
"RTN","IBJDIPR",153,0)
 ;
"RTN","IBJDIPR",154,0)
 ; Pre-set variables IB array, IBBDT, IBEDT are required.
"RTN","IBJDIPR",155,0)
 ;
"RTN","IBJDIPR",156,0)
 I $$TESTP^IBJDI1(DFN) Q  ;     Test patient.
"RTN","IBJDIPR",157,0)
 D ELIG^VADPT G:'VAEL(4) PRCQ ; Patient is not a vet.
"RTN","IBJDIPR",158,0)
 ;
"RTN","IBJDIPR",159,0)
 ; - Set patient index
"RTN","IBJDIPR",160,0)
 S ^TMP("IBJDIPR",$J,DFN)=$P(IBOED,U,1)
"RTN","IBJDIPR",161,0)
 ;
"RTN","IBJDIPR",162,0)
PRCQ K VA,VAERR,VAEL
"RTN","IBJDIPR",163,0)
 Q
"RTN","IBJDIPR",164,0)
 ;
"RTN","IBJDIPR",165,0)
SUM ; - Print the summary report.
"RTN","IBJDIPR",166,0)
 D HEAD Q:IBQ
"RTN","IBJDIPR",167,0)
 W !!?15,"Patients pre-registered from ",$$DAT1^IBOUTL(IBBDT)," - ",$$DAT1^IBOUTL(IBEDT)
"RTN","IBJDIPR",168,0)
 W !!?17,"Pre-registration time frame: ",$J(IBPRF,5)," days"
"RTN","IBJDIPR",169,0)
 W !!?24,"Run Date: ",IBRUN,!?10,$$DASH(55),!!
"RTN","IBJDIPR",170,0)
 ;
"RTN","IBJDIPR",171,0)
 W ?35,"*Number of Unique Patients Treated: ",$J(IB("TOT"),5)
"RTN","IBJDIPR",172,0)
 W !?1,"Unique Outpatients Pre-registered within pre-registration time frame: ",$J(IB("PRE"),5)
"RTN","IBJDIPR",173,0)
 S PCENT=0 I IB("TOT") S PCENT=(IB("PRE")/IB("TOT"))*100
"RTN","IBJDIPR",174,0)
 W !?47,"Percent Pre-registered: ",$J(PCENT,5,2),"%"
"RTN","IBJDIPR",175,0)
 W !!?3,"Unique Outpatients Pre-registered past pre-registration time frame: ",$J(IB("PAST"),5)
"RTN","IBJDIPR",176,0)
 W !?30,"Unique Outpatients never Pre-registered: ",$J(IB("NEVR"),5)
"RTN","IBJDIPR",177,0)
 W !!?8,"*Counts may not include all patients because of exclusions."
"RTN","IBJDIPR",178,0)
 W !!?37,"Number of Eligibility Exclusions: ",$J(DGPREE,5)
"RTN","IBJDIPR",179,0)
 W !!?42,"Number of Clinic Exclusions: ",$J(DGPREC,5)
"RTN","IBJDIPR",180,0)
 I 'IBEXC Q
"RTN","IBJDIPR",181,0)
 I DGPREE D
"RTN","IBJDIPR",182,0)
 .S DGEE=1
"RTN","IBJDIPR",183,0)
 .D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",184,0)
 .S X="" F I=1:1 S X=$O(^TMP("IBJDIPR1",$J,"DGPREEA",X)) Q:X=""  D  Q:IBQ
"RTN","IBJDIPR",185,0)
 ..I $Y>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",186,0)
 ..S TAB=$S((I#2):10,1:45)
"RTN","IBJDIPR",187,0)
 ..W ?TAB,$E($P(X,U,1),1,30) W:'(I#2) !
"RTN","IBJDIPR",188,0)
 I DGPREC D
"RTN","IBJDIPR",189,0)
 .S DGEC=1,DGEE=0
"RTN","IBJDIPR",190,0)
 .S X="" F I=1:1 S X=$O(^TMP("IBJDIPR1",$J,"DGPRECA",X)) Q:X=""  D  Q:IBQ
"RTN","IBJDIPR",191,0)
 ..I I=1 D  Q:IBQ
"RTN","IBJDIPR",192,0)
 ...I ($Y+4)>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q
"RTN","IBJDIPR",193,0)
 ...W !!?10,"Clinic Exclusions",!?9,$$DASH(19),!
"RTN","IBJDIPR",194,0)
 ..I $Y>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",195,0)
 ..S TAB=$S((I#2):10,1:45)
"RTN","IBJDIPR",196,0)
 ..W ?TAB,$E($P(X,U,1),1,30) W:'(I#2) !
"RTN","IBJDIPR",197,0)
 Q
"RTN","IBJDIPR",198,0)
 ;
"RTN","IBJDIPR",199,0)
HEAD ; - Report Header
"RTN","IBJDIPR",200,0)
 ;
"RTN","IBJDIPR",201,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF,*13
"RTN","IBJDIPR",202,0)
 S IBPAG=IBPAG+1
"RTN","IBJDIPR",203,0)
 W !?21,"PERCENTAGE OF PATIENTS PRE-REGISTERED",?71,"Page: ",IBPAG
"RTN","IBJDIPR",204,0)
 I IBPAG=1 W !!?33,"SUMMARY REPORT" Q
"RTN","IBJDIPR",205,0)
 W !!?24,"Run Date: ",IBRUN,!?10,$$DASH(55),!!
"RTN","IBJDIPR",206,0)
 W !?10,"Listing of all Exclusions: ",!
"RTN","IBJDIPR",207,0)
 I $G(DGEE) W !!?10,"Eligibility Exclusions",!?9,$$DASH(24),!
"RTN","IBJDIPR",208,0)
 I $G(DGEC) W !!?10,"Clinic Exclusions",!?9,$$DASH(19),!
"RTN","IBJDIPR",209,0)
 S IBQ=$$STOP^IBOUTL("Percentage of Patients Pre-registered")
"RTN","IBJDIPR",210,0)
 Q
"RTN","IBJDIPR",211,0)
 ;
"RTN","IBJDIPR",212,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDIPR",213,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDIPR",214,0)
 ;
"RTN","IBJDIPR",215,0)
PAUSE ; - Page break.
"RTN","IBJDIPR",216,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDIPR",217,0)
 N DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDIPR",218,0)
 S DIR(0)="E" D ^DIR I $D(DIRUT)!($D(DUOUT)) S IBQ=1
"RTN","IBJDIPR",219,0)
 Q
"RTN","IBJDIPR",220,0)
 ;
"RTN","IBJDIPR",221,0)
THLP ; - 'Pre-Registration time frame (days)' prompt
"RTN","IBJDIPR",222,0)
 ;
"RTN","IBJDIPR",223,0)
 W !!,"Number of days to search for pre-registered patients."
"RTN","IBJDIPR",224,0)
 W !,"Number of days must be greater that zero."
"RTN","IBJDIPR",225,0)
 W !,"Select '<CR>' to accept the default 180 days."
"RTN","IBJDIPR",226,0)
 W !?11,"'^' to quit."
"RTN","IBJDIPR",227,0)
 Q
"RTN","IBJDIPR",228,0)
 ;
"RTN","IBJDIPR",229,0)
EHLP ; - 'Detailed list of Exclusions' prompt
"RTN","IBJDIPR",230,0)
 ;
"RTN","IBJDIPR",231,0)
 W !!,"Select '<CR>' to print only the number of eligibility and clinic exclusions."
"RTN","IBJDIPR",232,0)
 W !!?11,"'Y' to print list of all eligibility and clinic exclusions."
"RTN","IBJDIPR",233,0)
 W !?11,"'^' to quit."
"RTN","IBJDIPR",234,0)
 Q
"RTN","IBJDIPR",235,0)
IBAR(IBBDT,IBEDT) ;Entry point for Vista IB AR data to ARC
"RTN","IBJDIPR",236,0)
 ;patch 305 - called by IBRFN4
"RTN","IBJDIPR",237,0)
 N IBPRF,IBEXC,IBARFLAG,IB,IBPERC,IBARDATA
"RTN","IBJDIPR",238,0)
 S IBPRF=180,IBEXC=0,IBARFLAG=1
"RTN","IBJDIPR",239,0)
 D DQ
"RTN","IBJDIPR",240,0)
 I 'IB("TOT") S IBPERC=0 G IBARD
"RTN","IBJDIPR",241,0)
 S IBPERC=IB("PRE")/IB("TOT")*100,IBPERC=$FN(IBPERC,"",2)
"RTN","IBJDIPR",242,0)
IBARD S IBARDATA=IB("TOT")_U_IB("PRE")_U_IBPERC_U_IB("PAST")_U_IB("NEVR")
"RTN","IBJDIPR",243,0)
 Q IBARDATA
"RTN","IBRFN4")
0^2^B25672480^B21437252
"RTN","IBRFN4",1,0)
IBRFN4 ;ALB/TMK - Supported functions for AR/IB DATA EXTRACT ;15-FEB-2005
"RTN","IBRFN4",2,0)
 ;;2.0;INTEGRATED BILLING;**301,305**;21-MAR-94
"RTN","IBRFN4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBRFN4",4,0)
 ;
"RTN","IBRFN4",5,0)
IBAREXT(IBIFN,IBD) ; Returns data for claim IBIFN for IB/AR Extract
"RTN","IBRFN4",6,0)
 ; Data returned (pieces):
"RTN","IBRFN4",7,0)
 ; 1-MEDICARE Status (0=not MRA secondary, 1=MRA secondary)
"RTN","IBRFN4",8,0)
 ; 2-Last MRA requested date "S";7 (7 - INTERNAL)
"RTN","IBRFN4",9,0)
 ; 3-Last Electronic extract date  "TX";2 (21 - INTERNAL)
"RTN","IBRFN4",10,0)
 ; 4-Printed via EDI  "TX";7  (26 - EXTERNAL)
"RTN","IBRFN4",11,0)
 ; 5-Force Claim to Print  "TX";8  (27 - EXTERNAL)
"RTN","IBRFN4",12,0)
 ; 6-Claim MRA Status  "TX";5  (24 - EXTERNAL)
"RTN","IBRFN4",13,0)
 ; 7-MRA recorded date  "TX";3  (22 - INTERNAL)
"RTN","IBRFN4",14,0)
 ; 8-Bill cancelled date  "S";17  (17 - INTERNAL)
"RTN","IBRFN4",15,0)
 ; 9-form type  0;19   (.19 - EXTERNAL)
"RTN","IBRFN4",16,0)
 ; 10-Current Payer  $$CURR^IBCEF2(IBIFN) returns IEN;NAME (file 36)
"RTN","IBRFN4",17,0)
 ; 11-DRG 0;8==> file 45 (9 - EXTERNAL)
"RTN","IBRFN4",18,0)
 ; 12-ECME #  "M1";8 (460 - EXTERNAL)
"RTN","IBRFN4",19,0)
 ; 13-NON-VA Facility
"RTN","IBRFN4",20,0)
 ; 14-#Days Site Not Responsible for MRA ($$DAYS(IBIFN))
"RTN","IBRFN4",21,0)
 ; 15-National VA id number for Ins Verification (365.12;.02 - INTERNAL)
"RTN","IBRFN4",22,0)
 ; 16-Payer name (file 365.12;.01)
"RTN","IBRFN4",23,0)
 ; 17-Offset Amount (202-INTERNAL)
"RTN","IBRFN4",24,0)
 ;
"RTN","IBRFN4",25,0)
 ; IBD("PRD",seq #)=prosthetic item name^date^bill ien
"RTN","IBRFN4",26,0)
 ; IBD("IN")= TYPE OF PLAN NAME ^ GROUP NUMBER ^ RELATIONSHIP TO INSURED
"RTN","IBRFN4",27,0)
 ;   ^ SOURCE OF INFO ^ EDI ID NUMBER - INST ^ EDI ID NUMBER - PROF
"RTN","IBRFN4",28,0)
 ;   ^ INSURANCE REIMBURSE
"RTN","IBRFN4",29,0)
 ; IBD("IN","MMA")= MAILING STREET ADDRESS [LINE 1] ^
"RTN","IBRFN4",30,0)
 ;   ^ MAILING STREET ADDRESS [LINE 2] ^ CITY ^ STATE NAME  ^  ZIP
"RTN","IBRFN4",31,0)
 ;
"RTN","IBRFN4",32,0)
 N IB,IBI,IBJ,IBK,IBX,IBNODE,IBTMP,IBIN,Z
"RTN","IBRFN4",33,0)
 F IBNODE=0,"S","TX","M","U1" S IB(IBNODE)=$G(^DGCR(399,IBIFN,IBNODE))
"RTN","IBRFN4",34,0)
 S IBD=$S($$MRASEC^IBCEF4(IBIFN):1,1:0)
"RTN","IBRFN4",35,0)
 S $P(IBD,U,2)=$P(IB("S"),U,7),$P(IBD,U,3)=$P(IB("TX"),U,2)
"RTN","IBRFN4",36,0)
 S $P(IBD,U,4)=$$GET1^DIQ(399,IBIFN_",",26,"E"),$P(IBD,U,5)=$$GET1^DIQ(399,IBIFN_",",27,"E")
"RTN","IBRFN4",37,0)
 S $P(IBD,U,6)=$$GET1^DIQ(399,IBIFN_",",24,"E"),$P(IBD,U,7)=$P(IB("TX"),U,3)
"RTN","IBRFN4",38,0)
 S $P(IBD,U,8)=$P(IB("S"),U,17),$P(IBD,U,9)=$$GET1^DIQ(399,IBIFN_",",.19,"E")
"RTN","IBRFN4",39,0)
 S Z=$$CURR^IBCEF2(IBIFN),$P(IBD,U,10)=Z_$S(Z:";"_$P($G(^DIC(36,Z,0)),U),1:"")
"RTN","IBRFN4",40,0)
 S Z=$P($G(^DIC(36,+Z,3)),U,10),$P(IBD,U,15)=$P($G(^IBE(365.12,+Z,0)),U,2),$P(IBD,U,16)=$P($G(^(0)),U)
"RTN","IBRFN4",41,0)
 S Z=$P(IB(0),U,8),$P(IBD,U,11)=$S(Z:$$GET1^DIQ(45,Z_",",9,"E"),1:"")
"RTN","IBRFN4",42,0)
 S $P(IBD,U,12)=$$GET1^DIQ(399,IBIFN_",",460,"E")
"RTN","IBRFN4",43,0)
 S Z=$P($G(^DGCR(399,IBIFN,"U2")),U,10),$P(IBD,U,13)=$S(Z:$P($G(^IBA(355.93,Z,0)),U,1),1:"")
"RTN","IBRFN4",44,0)
 ;
"RTN","IBRFN4",45,0)
 S $P(IBD,U,14)=$$DAYS(IBIFN)
"RTN","IBRFN4",46,0)
 S $P(IBD,U,17)=$P(IB("U1"),U,2)
"RTN","IBRFN4",47,0)
 ;
"RTN","IBRFN4",48,0)
 K IBTMP D SET^IBCSC5B(IBIFN,.IBTMP)
"RTN","IBRFN4",49,0)
 S (IBI,IBJ)=0 F  S IBI=$O(IBTMP(IBI)) Q:'IBI  D
"RTN","IBRFN4",50,0)
 . S IBK=0 F  S IBK=$O(IBTMP(IBI,IBK)) Q:'IBK  D
"RTN","IBRFN4",51,0)
 .. S IBX=IBTMP(IBI,IBK)
"RTN","IBRFN4",52,0)
 .. S IBJ=IBJ+1
"RTN","IBRFN4",53,0)
 .. S IBD("PRD",IBJ)=$P($$PIN^IBCSC5B(IBK),U,2)_U_IBI_U_+IBTMP
"RTN","IBRFN4",54,0)
 ;
"RTN","IBRFN4",55,0)
 S Z=" ",IBD("IN")="",DFN=+$P(IB(0),U,2)
"RTN","IBRFN4",56,0)
 F  S Z=$O(^DPT(DFN,.312,Z),-1) Q:Z=""  D  Q:Z=""
"RTN","IBRFN4",57,0)
 . S IBIN=$G(^DPT(DFN,.312,Z,0))
"RTN","IBRFN4",58,0)
 . I +IB("M")=+IBIN D
"RTN","IBRFN4",59,0)
 .. N IBQ,IBP
"RTN","IBRFN4",60,0)
 .. S IBP=+$P(IBIN,U,18),IBQ=$G(^IBA(355.3,+IBP,0))
"RTN","IBRFN4",61,0)
 .. S IBD("IN")=$S($P(IBQ,U,9):$$GET1^DIQ(355.3,IBP_",",.09,"E"),1:"")_U_$P(IBQ,U,4)_U_$P(IBIN,U,6)_U_$P($G(^DPT(DFN,.312,Z,1)),U,9)
"RTN","IBRFN4",62,0)
 .. S Z=""
"RTN","IBRFN4",63,0)
 ;
"RTN","IBRFN4",64,0)
 S Z=$G(^DIC(36,+IB("M"),3))
"RTN","IBRFN4",65,0)
 S $P(IBD("IN"),U,5)=$P(Z,U,4),$P(IBD("IN"),U,6)=$P(Z,U,2)
"RTN","IBRFN4",66,0)
 S $P(IBD("IN"),U,7)=$$GET1^DIQ(36,+IB("M")_",",1,"I")
"RTN","IBRFN4",67,0)
 S Z=$G(^DIC(36,+IB("M"),.11))
"RTN","IBRFN4",68,0)
 S IBD("IN","MMA")=$P(Z,U,1)_U_$P(Z,U,2)_U_$P(Z,U,4)_U_$S($P(Z,U,5):$P($G(^DIC(5,$P(Z,U,5),0)),U,1),1:"")_U_$P(Z,U,6)
"RTN","IBRFN4",69,0)
 ;
"RTN","IBRFN4",70,0)
 Q IBD
"RTN","IBRFN4",71,0)
 ;
"RTN","IBRFN4",72,0)
IBACT(IBIFN,IBARRY) ; Returns IB actions for bill ien IBIFN
"RTN","IBRFN4",73,0)
 ;IBARRY should be passed by reference and returns:
"RTN","IBRFN4",74,0)
 ;
"RTN","IBRFN4",75,0)
 ; IBARRY(seq)=AR bill #^reference #^external STATUS^IB ACTION TYPE NAME
"RTN","IBRFN4",76,0)
 ;             ^UNITS^TOTAL CHARGE^DT BILLD FROM^DT BILLD TO^AR BILL IEN
"RTN","IBRFN4",77,0)
 ;             ^DT ENTRY ADDED^PATIENT SSN^EVENT DATE^RESULTING FROM
"RTN","IBRFN4",78,0)
 ;             ^INSTITUTION IEN
"RTN","IBRFN4",79,0)
 ;
"RTN","IBRFN4",80,0)
 N IBNA,IB,IB0,DFN,IBCT,Z
"RTN","IBRFN4",81,0)
 S IBNA=$$BN1^PRCAFN(IBIFN),IB="",IBCT=0
"RTN","IBRFN4",82,0)
 F  S IB=$O(^IB("ABIL",IBNA,IB)) Q:IB=""  D
"RTN","IBRFN4",83,0)
 . S IBCT=IBCT+1
"RTN","IBRFN4",84,0)
 . S IB0=$G(^IB(IB,0))
"RTN","IBRFN4",85,0)
 . I $G(DFN)="" S DFN=$P(IB0,U,2)
"RTN","IBRFN4",86,0)
 . ;
"RTN","IBRFN4",87,0)
 . S IBARRY=IBNA_U_$P(IB0,U,1)_U_$$GET1^DIQ(350,IB_",",.05,"E")
"RTN","IBRFN4",88,0)
 . S Z=$P(IB0,U,3)
"RTN","IBRFN4",89,0)
 . S IBARRY=IBARRY_U_$S(Z'="":$P($G(^IBE(350.1,Z,0)),U,1),1:"")
"RTN","IBRFN4",90,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,6) ; UNITS
"RTN","IBRFN4",91,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,7) ; TOTAL CHARGE
"RTN","IBRFN4",92,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,14) ; DT BILLD FROM
"RTN","IBRFN4",93,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,15) ; DT BILLD TO
"RTN","IBRFN4",94,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,11) ; AR BILL #
"RTN","IBRFN4",95,0)
 . S IBARRY=IBARRY_U_$P($P($G(^IB(IB,1)),U,2),".",1) ; DT ENTRY ADDED
"RTN","IBRFN4",96,0)
 . S IBARRY=IBARRY_U_$P(^DPT(DFN,0),U,9) ; SSN
"RTN","IBRFN4",97,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,17) ; EVENT DT
"RTN","IBRFN4",98,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,4) ;RESULTING FROM
"RTN","IBRFN4",99,0)
 . S IBARRY=IBARRY_U_$P(IB0,U,13) ; Institution
"RTN","IBRFN4",100,0)
 . S IBARRY(IBCT)=IBARRY,IBARRY=""
"RTN","IBRFN4",101,0)
 Q
"RTN","IBRFN4",102,0)
 ;
"RTN","IBRFN4",103,0)
PREREG(IBBDT,IBEDT) ;Returns Pre-registration data
"RTN","IBRFN4",104,0)
 N IBDATA
"RTN","IBRFN4",105,0)
 S IBDATA=$$IBAR^IBJDIPR(IBBDT,IBEDT)
"RTN","IBRFN4",106,0)
 Q IBDATA
"RTN","IBRFN4",107,0)
 ;
"RTN","IBRFN4",108,0)
BUFFER(IBBDT,IBEDT) ;Returns Buffer data
"RTN","IBRFN4",109,0)
 N IBDATA
"RTN","IBRFN4",110,0)
 S IBDATA=$$IBAR^IBCNBOA(IBBDT,IBEDT)
"RTN","IBRFN4",111,0)
 Q IBDATA
"RTN","IBRFN4",112,0)
 ;
"RTN","IBRFN4",113,0)
DAYS(IBIFN) ; Returns # days site not responsible for MRA
"RTN","IBRFN4",114,0)
 N X,X1,X2,D0
"RTN","IBRFN4",115,0)
 S X="" ;No. of days
"RTN","IBRFN4",116,0)
 G:'$P(IBD,U,2) DAYSQ
"RTN","IBRFN4",117,0)
 S X2=$P(IBD,U,2) ;MRA Request Date
"RTN","IBRFN4",118,0)
 S X1=$P(IBD,U,7) ;MRA Recorded Date
"RTN","IBRFN4",119,0)
 G:'$$MRASEC^IBCEF4(IBIFN) DAYSQ ; Not MEDICARE secondary
"RTN","IBRFN4",120,0)
 I 'X1!(X1<X2) S X1=DT
"RTN","IBRFN4",121,0)
 D ^%DTC
"RTN","IBRFN4",122,0)
DAYSQ Q X
"RTN","IBRFN4",123,0)
 ;
"RTN","IBRFN4",124,0)
REJ(IBIFN) ; Returns 1 if any rejects found for MRA secondary claim or for
"RTN","IBRFN4",125,0)
 ; any preceding claims it was cancelled/cloned from
"RTN","IBRFN4",126,0)
 N X,Y,I,X1,X2,X3,D0,CURSEQ
"RTN","IBRFN4",127,0)
 S Y=0 ;Y=REJECT FLAG
"RTN","IBRFN4",128,0)
 G:'$$MRASEC^IBCEF4(IBIFN) REJQ ; Not MEDICARE secondary
"RTN","IBRFN4",129,0)
 S CURSEQ=$$COBN^IBCEF(IBIFN),X1=+$P($G(^DGCR(399,IBIFN,0)),U,15)
"RTN","IBRFN4",130,0)
 S D0=IBIFN
"RTN","IBRFN4",131,0)
 F  D  Q:'D0!Y
"RTN","IBRFN4",132,0)
 . ; claim copied from not cancelled and not MRA secondary claim
"RTN","IBRFN4",133,0)
 . I X1,$P($G(^DGCR(399,X1,0)),U,13)'=7,X1'=IBIFN S D0="" Q
"RTN","IBRFN4",134,0)
 . I X1,$P($G(^DGCR(399,X1,0)),U,19)'=$P($G(^DGCR(399,D0,0)),U,19) S D0="" Q
"RTN","IBRFN4",135,0)
 . S I=0 F  S I=$O(^IBM(361,"B",D0,I)) Q:'I  D  Q:Y
"RTN","IBRFN4",136,0)
 .. S X2=$G(^IBM(361,I,0))
"RTN","IBRFN4",137,0)
 .. Q:$P(X2,U,3)'="R"!'$P(X2,U,11)  ;No reject or no transmit bill
"RTN","IBRFN4",138,0)
 .. S X3=$TR($P($G(^IBA(364,+$P(X2,U,11),0)),U,8),"PST","123") ;status msg seq
"RTN","IBRFN4",139,0)
 .. Q:X3'=(CURSEQ-1)
"RTN","IBRFN4",140,0)
 .. S Y=1
"RTN","IBRFN4",141,0)
 . I 'Y S D0=X1,X1=+$P($G(^DGCR(399,X1,0)),U,15) S:X1=D0 D0="" Q
"RTN","IBRFN4",142,0)
REJQ Q Y
"VER")
8.0^22.0
"BLD",6171,6)
^316
**END**
**END**
