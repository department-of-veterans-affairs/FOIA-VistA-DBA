Released PSX*2*44 SEQ #41
Extracted from mail message
**KIDS**:PSX*2.0*44^

**INSTALL NAME**
PSX*2.0*44
"BLD",3946,0)
PSX*2.0*44^CMOP^0^3021126^y
"BLD",3946,1,0)
^^4^4^3021126^
"BLD",3946,1,1,0)
Problem:  The [PSX START BACKGROUND FILER] Start/Stop Background 
"BLD",3946,1,2,0)
Filer option was erroring out.
"BLD",3946,1,3,0)
 
"BLD",3946,1,4,0)
Resolution:  Modified code to correct error.
"BLD",3946,4,0)
^9.64PA^^
"BLD",3946,"ABPKG")
n
"BLD",3946,"KRN",0)
^9.67PA^8989.52^19
"BLD",3946,"KRN",.4,0)
.4
"BLD",3946,"KRN",.401,0)
.401
"BLD",3946,"KRN",.402,0)
.402
"BLD",3946,"KRN",.403,0)
.403
"BLD",3946,"KRN",.5,0)
.5
"BLD",3946,"KRN",.84,0)
.84
"BLD",3946,"KRN",3.6,0)
3.6
"BLD",3946,"KRN",3.8,0)
3.8
"BLD",3946,"KRN",9.2,0)
9.2
"BLD",3946,"KRN",9.8,0)
9.8
"BLD",3946,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3946,"KRN",9.8,"NM",1,0)
PSXBKD^^0^B31759876
"BLD",3946,"KRN",9.8,"NM",2,0)
PSXRTN^^0^B29904588
"BLD",3946,"KRN",9.8,"NM","B","PSXBKD",1)

"BLD",3946,"KRN",9.8,"NM","B","PSXRTN",2)

"BLD",3946,"KRN",19,0)
19
"BLD",3946,"KRN",19.1,0)
19.1
"BLD",3946,"KRN",101,0)
101
"BLD",3946,"KRN",409.61,0)
409.61
"BLD",3946,"KRN",771,0)
771
"BLD",3946,"KRN",870,0)
870
"BLD",3946,"KRN",8989.51,0)
8989.51
"BLD",3946,"KRN",8989.52,0)
8989.52
"BLD",3946,"KRN",8994,0)
8994
"BLD",3946,"KRN","B",.4,.4)

"BLD",3946,"KRN","B",.401,.401)

"BLD",3946,"KRN","B",.402,.402)

"BLD",3946,"KRN","B",.403,.403)

"BLD",3946,"KRN","B",.5,.5)

"BLD",3946,"KRN","B",.84,.84)

"BLD",3946,"KRN","B",3.6,3.6)

"BLD",3946,"KRN","B",3.8,3.8)

"BLD",3946,"KRN","B",9.2,9.2)

"BLD",3946,"KRN","B",9.8,9.8)

"BLD",3946,"KRN","B",19,19)

"BLD",3946,"KRN","B",19.1,19.1)

"BLD",3946,"KRN","B",101,101)

"BLD",3946,"KRN","B",409.61,409.61)

"BLD",3946,"KRN","B",771,771)

"BLD",3946,"KRN","B",870,870)

"BLD",3946,"KRN","B",8989.51,8989.51)

"BLD",3946,"KRN","B",8989.52,8989.52)

"BLD",3946,"KRN","B",8994,8994)

"BLD",3946,"QUES",0)
^9.62^^
"BLD",3946,"REQB",0)
^9.611^1^1
"BLD",3946,"REQB",1,0)
PSX*2.0*38^1
"BLD",3946,"REQB","B","PSX*2.0*38",1)

"MBREQ")
0
"PKG",526,-1)
1^1
"PKG",526,0)
CMOP^PSX^CONSOLIDATED MAIL OUTPATIENT PHARMACY
"PKG",526,20,0)
^9.402P^^
"PKG",526,22,0)
^9.49I^1^1
"PKG",526,22,1,0)
2.0^3000210^3000217^11853
"PKG",526,22,1,"PAH",1,0)
44^3021126
"PKG",526,22,1,"PAH",1,1,0)
^^4^4^3021126
"PKG",526,22,1,"PAH",1,1,1,0)
Problem:  The [PSX START BACKGROUND FILER] Start/Stop Background 
"PKG",526,22,1,"PAH",1,1,2,0)
Filer option was erroring out.
"PKG",526,22,1,"PAH",1,1,3,0)
 
"PKG",526,22,1,"PAH",1,1,4,0)
Resolution:  Modified code to correct error.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSXBKD")
0^1^B31759876
"RTN","PSXBKD",1,0)
PSXBKD ;BIR/WPB,PWC-Routine to Control Host Background Jobs ;08 Apr 98  4:22 AM
"RTN","PSXBKD",2,0)
 ;;2.0;CMOP;**38,44**;11 Apr 97
"RTN","PSXBKD",3,0)
DELREL W !!
"RTN","PSXBKD",4,0)
 I $D(^PSX(554,"AR")) S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="This job is already scheduled.",DIR("A")="Do you want to unschedule this job" D ^DIR K DIR G:(Y<1)!($D(DIRUT)) EXIT G:Y=1 UNSCH
"RTN","PSXBKD",5,0)
 S %DT="AEXR",%DT("A")="Enter starting date/time: ",%DT("B")="TODAY@2300" D ^%DT G:Y<0!($D(DTOUT)) EXIT S PSXDATE=Y K %DT,%DT("A"),%DT("B"),Y,X
"RTN","PSXBKD",6,0)
 S ZTIO="",ZTDTH=PSXDATE,ZTDESC="CMOP Background Purge for CMOP Release File",ZTRTN="DEL513A^PSXBKD" D ^%ZTLOAD
"RTN","PSXBKD",7,0)
 I $G(ZTSK)>0 W !,"Job Started.",! D
"RTN","PSXBKD",8,0)
 .K DD,DO
"RTN","PSXBKD",9,0)
 .S:'$D(^PSX(554,1,1,0)) ^PSX(554,1,1,0)="^554.01SA^^"
"RTN","PSXBKD",10,0)
 .S DIC(0)="Z",DA(1)=1,DIC="^PSX(554,"_DA(1)_",1,",X=2,DIC("DR")="1////"_PSXDATE_";2////"_ZTSK_";3////S;4////"_DUZ D FILE^DICN K DIC,DIC(0),DIC("DR"),Y,X
"RTN","PSXBKD",11,0)
 S ZTREQ="@"
"RTN","PSXBKD",12,0)
EXIT K Y,%DT("A"),%DT("B"),N,PSXDATE,STDATE,TIME,DIR,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","PSXBKD",13,0)
 Q
"RTN","PSXBKD",14,0)
 ;Called by Taskman to update 554 and purge 552.3
"RTN","PSXBKD",15,0)
DEL513A S PSXTSK1=ZTSK D RESCH
"RTN","PSXBKD",16,0)
D513AA S REC=$O(^PSX(554,"AR","")) L +^PSX(554,1,1,REC):600 G:'$T D513AA
"RTN","PSXBKD",17,0)
 S DA=REC,DA(1)=1,DIE="^PSX(554,"_DA(1)_",1,",DR="3////R" D ^DIE
"RTN","PSXBKD",18,0)
 L -^PSX(554,1,1,REC) K DIE,DA,DR
"RTN","PSXBKD",19,0)
 S DEL=0 F  S DEL=$O(^PSX(552.3,"AF",DEL)) Q:DEL'>0  S DA=DEL,DIK="^PSX(552.3," D ^DIK K DIK,DA
"RTN","PSXBKD",20,0)
D513AB S REC=$O(^PSX(554,"AR","")) L +^PSX(554,1,1,REC):600 G:'$T D513AB
"RTN","PSXBKD",21,0)
 S DA=REC,DA(1)=1,DIE="^PSX(554,"_DA(1)_",1,",DR="3////S" D ^DIE
"RTN","PSXBKD",22,0)
 L -^PSX(554,1,1,REC) K DIE,DA,DR
"RTN","PSXBKD",23,0)
 K DEL,ZTIO,ZTDESC,ZTRTN,ZTSK,ZTDTH,REC
"RTN","PSXBKD",24,0)
 Q
"RTN","PSXBKD",25,0)
RESCH S ZTSK=PSXTSK1,TIME="24H",ZTIO="",ZTDESC="CMOP Background Purge for CMOP Release File",ZTRTN="DEL513A^PSXBKD",ZTDTH=TIME D REQ^%ZTLOAD
"RTN","PSXBKD",26,0)
 D NOW^%DTC
"RTN","PSXBKD",27,0)
 S RE=$O(^PSX(554,"AR","")) S:$G(RE)>0 $P(^PSX(554,1,1,RE,0),"^",9)=%
"RTN","PSXBKD",28,0)
 K PSXTSK1,%,RE
"RTN","PSXBKD",29,0)
 Q
"RTN","PSXBKD",30,0)
UNSCH N ZTSK
"RTN","PSXBKD",31,0)
 S REC=$O(^PSX(554,"AR",""))
"RTN","PSXBKD",32,0)
 S ZTSK=$P(^PSX(554,1,1,REC,0),"^",3)
"RTN","PSXBKD",33,0)
 I $G(ZTSK)'>0 W !,"This job doesn't exist.",! Q
"RTN","PSXBKD",34,0)
 D STAT^%ZTLOAD
"RTN","PSXBKD",35,0)
 I ZTSK(1)=2 W !,"This task is currently running, wait until the task has finished before stopping the job.",! Q
"RTN","PSXBKD",36,0)
 I ZTSK(1)'=2 D KILL^%ZTLOAD
"RTN","PSXBKD",37,0)
UNSCH1 I ZTSK(0)=1 W !,"Job stopped.",! L +^PSX(554,1,1,REC):600 G:'$T UNSCH1 D
"RTN","PSXBKD",38,0)
 .D NOW^%DTC S DA=REC,DA(1)=1
"RTN","PSXBKD",39,0)
 .S DIE="^PSX(554,"_DA(1)_",1,",DR="2////@;3////S;5////"_%_";6////"_DUZ
"RTN","PSXBKD",40,0)
 .D ^DIE K DA,DIE,DR
"RTN","PSXBKD",41,0)
 L -^PSX(554,1,1,REC) K Y,ZTSK
"RTN","PSXBKD",42,0)
 Q
"RTN","PSXBKD",43,0)
STOPJOB N ZTSK
"RTN","PSXBKD",44,0)
 S REC=$O(^PSX(554,"AB",""))
"RTN","PSXBKD",45,0)
 S ZTSK=$P(^PSX(554,1,1,REC,0),"^",3)
"RTN","PSXBKD",46,0)
 I $G(ZTSK)'>0 W !,"This job doesn't exist.",! Q
"RTN","PSXBKD",47,0)
 D STAT^%ZTLOAD
"RTN","PSXBKD",48,0)
 I ZTSK(1)=2 W !,"This task is currently running, wait until the task has finished before stopping the job.",! Q
"RTN","PSXBKD",49,0)
 I ZTSK(1)'=2 D KILL^%ZTLOAD
"RTN","PSXBKD",50,0)
STOP1 I ZTSK(0)=1 W !,"Job stopped.",! L +^PSX(554,REC):600 G:'$T STOP1 D
"RTN","PSXBKD",51,0)
 .D NOW^%DTC S DA=REC,DA(1)=1,DIE="^PSX(554,"_DA(1)_",1,"
"RTN","PSXBKD",52,0)
 .S DR="2////@;3////S;5////"_%_";6////"_DUZ D ^DIE
"RTN","PSXBKD",53,0)
 .L -^PSX(554,REC) K DA,DIE,DR,REC
"RTN","PSXBKD",54,0)
 Q
"RTN","PSXBKD",55,0)
STATUS N PSXSTAT,PSXTXT
"RTN","PSXBKD",56,0)
 S PSXSTAT=$G(^PSX(553,1,"S"))
"RTN","PSXBKD",57,0)
 Q:PSXSTAT=""
"RTN","PSXBKD",58,0)
 S PSXTXT="CMOP Interface is "_$S(PSXSTAT="R":"RUNNING!!!",1:"Stopped.")
"RTN","PSXBKD",59,0)
 W !!,?((IOM\2)-($L(PSXTXT)\2)-3),PSXTXT
"RTN","PSXBKD",60,0)
 N PSX1,PSX2 S (CNT,BCNT,OCNT,TRX,QFLG,TTRX)=0
"RTN","PSXBKD",61,0)
 G:'$O(^PSX(553.1,0)) ST1
"RTN","PSXBKD",62,0)
 S QRY=$P(^PSX(553.1,0),"^",3) G:$G(QRY)'>0 ST1
"RTN","PSXBKD",63,0)
 S STAT=$P(^PSX(553.1,QRY,0),"^",5) D
"RTN","PSXBKD",64,0)
 .I $G(STAT)'=1&($G(STAT)'=5) S QRY=QRY-1 S TRX=$P(^PSX(553.1,QRY,0),"^",6),QTM=$$FMTE^XLFDT($P($G(^PSX(553.1,QRY,0)),"^",4),1) S:$G(TRX)="" TRX=0 Q
"RTN","PSXBKD",65,0)
 .I $G(STAT)=5 S QFLG=1,TTRX=$P(^PSX(553.1,QRY,0),"^",6) S:$G(TRX)="" TTRX=0 S TRX=$P(^PSX(553.1,QRY-1,0),"^",6) S:$G(TRX)="" TRX=0 S QTM=$$FMTE^XLFDT($P($G(^PSX(553.1,QRY-1,0)),"^",4),1) Q
"RTN","PSXBKD",66,0)
 .I $G(STAT)=1 S TRX=$P(^PSX(553.1,QRY,0),"^",6),QTM=$$FMTE^XLFDT($P($G(^PSX(553.1,QRY,0)),"^",4),1) S:$G(TRX)="" TRX=0
"RTN","PSXBKD",67,0)
ST1 I $P($G(^PSX(552.1,0)),"^",3)'>0 S NDATA=1 G EX
"RTN","PSXBKD",68,0)
 S PSX1=$G(^PSX(553,1,99)) Q:PSX1=""  S ST=$P(PSX1,"-",1),ST2=$O(^PSX(552.1,"B",$P(PSX1,"-",1,2),""))
"RTN","PSXBKD",69,0)
 ;S X=ST S:$D(^PSX(552,"D",X)) X=$E(X,2,99) S DIC="4",DIC(0)="MOZX" D ^DIC S ST1=+Y I $G(ST1)="" W !,"Remote site is not in the Institution file." Q  ;****DOD L1
"RTN","PSXBKD",70,0)
 S X=ST,AGNCY="VASTANUM" S:$D(^PSX(552,"D",X)) X=$E(X,2,99),AGNCY="DMIS" S ST1=$$IEN^XUMF(4,AGNCY,X) I $G(ST1)="" W !,"Remote site is not in the Institution file." Q  ;****DOD L1
"RTN","PSXBKD",71,0)
 S SITE=$P(Y,"^",2),IEN512=$O(^PSX(552.2,"B",PSX1,"")) K DIC,Y,X
"RTN","PSXBKD",72,0)
 S:$G(IEN512)'="" ACKTM=$$HTE^XLFDT($P($G(^PSX(552.2,$G(IEN512),0)),"^",4),1)
"RTN","PSXBKD",73,0)
 S:$G(IEN512)="" ACKTM=$$FMTE^XLFDT($P(^PSX(552.1,ST2,0),"^",6),1)
"RTN","PSXBKD",74,0)
 I '$D(^PSX(552.1,"AQ")) S CNT=0
"RTN","PSXBKD",75,0)
 I $D(^PSX(552.1,"AQ")) S XXX="" F  S XXX=$O(^PSX(552.1,"AQ",XXX)) Q:'XXX  S BCNT=BCNT+1,YYY="" F  S YYY=$O(^PSX(552.1,"AQ",XXX,YYY)) Q:'YYY  S ZZZ=0 F  S ZZZ=$O(^PSX(552.1,"AQ",XXX,YYY,ZZZ)) Q:ZZZ'>0  D
"RTN","PSXBKD",76,0)
 .S CNT=$P($G(^PSX(552.1,ZZZ,1)),"^",4)+CNT,OCNT=$P($G(^PSX(552.1,ZZZ,1)),"^",3)+OCNT
"RTN","PSXBKD",77,0)
 W !!,"Last Order Processed ",?22,":",?24,$G(SITE)," ",PSX1
"RTN","PSXBKD",78,0)
 W !,"Date and Time",?22,":",?24,$G(ACKTM)
"RTN","PSXBKD",79,0)
 W !!,"Total in the Queue",?22,":",?24,$G(BCNT)," Transmissions with ",$G(OCNT)_"/"_$G(CNT)," Orders/Rx's"
"RTN","PSXBKD",80,0)
EX I $G(NDATA)>0 W !!,"No data has been sent to the automated system."
"RTN","PSXBKD",81,0)
 I $G(QRY)>0 W !!,"Last Query Request",?22,":",?24,$S($G(QFLG)=0:$G(QRY),$G(QFLG)=1:$G(QRY)-1,1:""),!,"  Rx's received",?22,":",?24,$G(TRX),!,"  Date and Time",?22,":",?24,$G(QTM)
"RTN","PSXBKD",82,0)
 I $G(QFLG)=1 W !!,"Query# ",$G(QRY)," in progress ",$G(TTRX)," Rx's have been received."
"RTN","PSXBKD",83,0)
 W !
"RTN","PSXBKD",84,0)
 S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR,Y W @IOF
"RTN","PSXBKD",85,0)
EX1 K PSX1,ST,ST1,ST2,SITE,XXX,YYY,ZZZ,CNT,BCNT,OCNT,QRY,TRX,PSXSTAT,PSXTXT,ACKTM,IEN512,QFLG,QTM,STAT,TTRX,NDATA,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","PSXBKD",86,0)
 Q
"RTN","PSXRTN")
0^2^B29904588
"RTN","PSXRTN",1,0)
PSXRTN ;BIR/WPB,PWC-Queue for the Background Filer at Host Facilities ;MAR 1,2002@16:11:17
"RTN","PSXRTN",2,0)
 ;;2.0;CMOP;**32,44**;11 Apr 97
"RTN","PSXRTN",3,0)
QUE W !!
"RTN","PSXRTN",4,0)
 I $D(^PSX(554,"AB")) S DIR(0)="Y",DIR("A",1)="This job is already scheduled.",DIR("A")="Do you want to unschedule this job",DIR("B")="NO" D ^DIR K DIR G:Y<1!($D(DIRUT)) EXIT G:Y=1 STOPJOB^PSXBKD Q
"RTN","PSXRTN",5,0)
 S %DT="AEXR",%DT("A")="Enter starting date/time:  ",%DT("B")="NOW" D ^%DT K %DT G:Y<0!($D(DTOUT)) EXIT S PSXDATE=Y K Y,X
"RTN","PSXRTN",6,0)
 S ZTDTH=PSXDATE,ZTDESC="CMOP Background Filer CMOP Master Database file",ZTIO="",ZTRTN="DATA^PSXRTN1",ZTSAVE("DUZ")="" D ^%ZTLOAD
"RTN","PSXRTN",7,0)
 I $G(ZTSK)>0 W !,"Job Started.",! D
"RTN","PSXRTN",8,0)
 .K DD,DO
"RTN","PSXRTN",9,0)
 .S:'$D(^PSX(554,1,1,0)) ^PSX(554,1,1,0)="^554.01SA^^"
"RTN","PSXRTN",10,0)
 .S DA(1)=1,X=1,DIC(0)="Z",DIC="^PSX(554,"_DA(1)_",1,",DIC("DR")="1////"_PSXDATE_";2////"_ZTSK_";3////S;4////"_DUZ D FILE^DICN K DIC,DIC(0),DIC("DR"),X
"RTN","PSXRTN",11,0)
 S ZTREQ="@"
"RTN","PSXRTN",12,0)
 Q
"RTN","PSXRTN",13,0)
NEXT S FREQ="900S",ZTSK=PSXZTSK,ZTRTN="DATA^PSXRTN1",ZTIO="",ZTDESC="CMOP Automated Release Data Processor",ZTDTH=FREQ D REQ^%ZTLOAD
"RTN","PSXRTN",14,0)
 ;D ISQED^%ZTLOAD S:$G(ZTSK(0))=0!($G(ZTSK(0))=1) NXTM=$$HTFM^XLFDT($G(ZTSK("D")))
"RTN","PSXRTN",15,0)
 D NOW^%DTC
"RTN","PSXRTN",16,0)
 S RE=$O(^PSX(554,"AB","")) S:$G(RE)>0 $P(^PSX(554,1,1,RE,0),"^",9)=%
"RTN","PSXRTN",17,0)
 K ZTDESC,ZTRTN,ZTSK,ZTIO,ZTDTH,FREQ,ZTSAVE("DUZ"),ZTREQ,PSXZTSK,RE,%
"RTN","PSXRTN",18,0)
EXIT K AF,BB,CC,CNT,COMDT,DIE,DIC,DR,DA,DRUG,EMPID,FILL,I,NPTR,NREC,PSXFM,PSXNDC,PSXTS,QRYID,QTY,REASON,RECDT,REL,RXN,RXSTAT,SNODE,SS,STAT,REL1,DUPFLG,CANFLG,CDT1,RX1,SP,SP2,SP3,XX1,XX2
"RTN","PSXRTN",19,0)
 K TNODE,UU,VV,X,XPTR,XREC,XX,XXX,Y,DEL,IEN50,N,NK,NNREC,PSXDATE,COST,STDATE,TIME,XDA,QRYN,ACKTM,ACKT,%,TDT,CANFLG,STOP,LST,LSTQRY,CANF,IDDRG,COST,IEN50,DIROUT,DIR,DIRUT,DTOUT,DUOUT,CDT,LCNT,NXTM
"RTN","PSXRTN",20,0)
 Q
"RTN","PSXRTN",21,0)
NDRGMSG Q:'$D(^TMP($J,"PSXNDG"))
"RTN","PSXRTN",22,0)
 I $$GET1^DIQ(554,1,8)="NO" Q
"RTN","PSXRTN",23,0)
 S XMSUB="CMOP DRUG Cost Missing",XMDUZ=.5,XMDUN="CMOP Manager"
"RTN","PSXRTN",24,0)
 D XMZ^XMA2 G:XMZ'>0 NDRGMSG
"RTN","PSXRTN",25,0)
 S XX2="********************"
"RTN","PSXRTN",26,0)
 S LCNT=1,^XMB(3.9,XMZ,2,LCNT,0)="DRUG/Items listed below are missing cost data or are not marked for CMOP.",LCNT=LCNT+1
"RTN","PSXRTN",27,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1,XX1="                  "
"RTN","PSXRTN",28,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="DRUG ID  COMPLETED DATE    RX NUMBER         TRANSMISSION",LCNT=LCNT+1
"RTN","PSXRTN",29,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="-------------------------------------------------------------------------------",LCNT=LCNT+1
"RTN","PSXRTN",30,0)
 S IDRG="" F  S IDRG=$O(^TMP($J,"PSXNDG",IDRG)) Q:IDRG=""  S CDT="" F  S CDT=$O(^TMP($J,"PSXNDG",IDRG,CDT)) Q:CDT=""  D
"RTN","PSXRTN",31,0)
 .S CDT1=$$FMTE^XLFDT(CDT,"2D"),RX1=$P(^TMP($J,"PSXNDG",IDRG,CDT),"^",1),SP="    ",SP2=$E(XX1,1,18-$L(CDT1)),SP3=$E(XX1,1,18-$L(RX1))
"RTN","PSXRTN",32,0)
 .S ^XMB(3.9,XMZ,2,LCNT,0)=IDRG_SP_CDT1_SP2_RX1_SP3_$P(^TMP($J,"PSXNDG",IDRG,CDT),"^",2),LCNT=LCNT+1
"RTN","PSXRTN",33,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXRTN",34,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)=XX2_XX2_XX2_$E(XX2,1,$L(XX2)-1),LCNT=LCNT+1
"RTN","PSXRTN",35,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="There is NO ENTRY in DRUG file #50 marked for CMOP Dispense with this ID number",LCNT=LCNT+1
"RTN","PSXRTN",36,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="and/or there is no COST information available.",LCNT=LCNT+1
"RTN","PSXRTN",37,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)=XX2_XX2_XX2_$E(XX2,1,$L(XX2)-1),LCNT=LCNT+1
"RTN","PSXRTN",38,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXRTN",39,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="Corrective Action:  ",LCNT=LCNT+1
"RTN","PSXRTN",40,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 1:  Locate the correct entry in DRUG file #50, or create the new entry",LCNT=LCNT+1
"RTN","PSXRTN",41,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             if necessary.  Since the drug/item was filled by the automated",LCNT=LCNT+1
"RTN","PSXRTN",42,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             system, you can look up the VA Print Name on that system, not",LCNT=LCNT+1
"RTN","PSXRTN",43,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             DHCP, to determine what the DRUG file #50 entry should be.  The",LCNT=LCNT+1
"RTN","PSXRTN",44,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             remainder of the steps should be done on DHCP.",LCNT=LCNT+1
"RTN","PSXRTN",45,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 2:  Be sure the entry is marked for Outpatient use.",LCNT=LCNT+1
"RTN","PSXRTN",46,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 3:  Match to the correct NATIONAL DRUG file entry.",LCNT=LCNT+1
"RTN","PSXRTN",47,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 4:  Verify the match.",LCNT=LCNT+1
"RTN","PSXRTN",48,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 5:  Merge the NDF data into DRUG file #50.",LCNT=LCNT+1
"RTN","PSXRTN",49,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 6:  Enter the correct cost information in DRUG file #50.",LCNT=LCNT+1
"RTN","PSXRTN",50,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 7:  Run the Cost Update option for the completed date listed to",LCNT=LCNT+1
"RTN","PSXRTN",51,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             update the CMOP MASTER DATABASE file.",LCNT=LCNT+1
"RTN","PSXRTN",52,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 8:  Review prescriptions listed above using the Rx Inquiry option",LCNT=LCNT+1
"RTN","PSXRTN",53,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             to validate that the cost entry is complete.",LCNT=LCNT+1
"RTN","PSXRTN",54,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="    Step 9:  Recompile the cost data for the date(s) listed to pick up the new",LCNT=LCNT+1
"RTN","PSXRTN",55,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="             cost data.",LCNT=LCNT+1
"RTN","PSXRTN",56,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="",LCNT=LCNT+1
"RTN","PSXRTN",57,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)=XX2_XX2_XX2_$E(XX2,1,$L(XX2)-1),LCNT=LCNT+1
"RTN","PSXRTN",58,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)="** Failure to complete these changes will result in inaccurate cost reports. **",LCNT=LCNT+1
"RTN","PSXRTN",59,0)
 S ^XMB(3.9,XMZ,2,LCNT,0)=XX2_XX2_XX2_$E(XX2,1,$L(XX2)-1),LCNT=LCNT+1
"RTN","PSXRTN",60,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_LCNT_"^"_LCNT_"^"_DT
"RTN","PSXRTN",61,0)
 K XMY D GRP^PSXNOTE D ENT1^XMD
"RTN","PSXRTN",62,0)
 G EXIT
"VER")
8.0^22.0
**END**
**END**
