Released IB*2*287 SEQ #273
Extracted from mail message
**KIDS**:IB*2.0*287^

**INSTALL NAME**
IB*2.0*287
"BLD",5249,0)
IB*2.0*287^INTEGRATED BILLING^0^3050217^y
"BLD",5249,1,0)
^^1^1^3041206^
"BLD",5249,1,1,0)
Reasonable Charges v2.2.  Enhancements only, no charges.
"BLD",5249,4,0)
^9.64PA^^
"BLD",5249,"INIT")
POST^IBYPSC
"BLD",5249,"KRN",0)
^9.67PA^8989.52^19
"BLD",5249,"KRN",.4,0)
.4
"BLD",5249,"KRN",.401,0)
.401
"BLD",5249,"KRN",.402,0)
.402
"BLD",5249,"KRN",.403,0)
.403
"BLD",5249,"KRN",.5,0)
.5
"BLD",5249,"KRN",.84,0)
.84
"BLD",5249,"KRN",3.6,0)
3.6
"BLD",5249,"KRN",3.8,0)
3.8
"BLD",5249,"KRN",9.2,0)
9.2
"BLD",5249,"KRN",9.8,0)
9.8
"BLD",5249,"KRN",9.8,"NM",0)
^9.68A^21^16
"BLD",5249,"KRN",9.8,"NM",2,0)
IBCSC4^^0^B23401431
"BLD",5249,"KRN",9.8,"NM",4,0)
IBCSCE^^0^B14652895
"BLD",5249,"KRN",9.8,"NM",5,0)
IBCSCH^^0^B71799679
"BLD",5249,"KRN",9.8,"NM",6,0)
IBCU65^^0^B30440768
"BLD",5249,"KRN",9.8,"NM",9,0)
IBCU7A^^0^B38419441
"BLD",5249,"KRN",9.8,"NM",10,0)
IBYPSC^^0^B3967765
"BLD",5249,"KRN",9.8,"NM",12,0)
IBCDE^^0^B15655498
"BLD",5249,"KRN",9.8,"NM",13,0)
IBCU2^^0^B7719494
"BLD",5249,"KRN",9.8,"NM",14,0)
IBCROIP^^0^B23082380
"BLD",5249,"KRN",9.8,"NM",15,0)
IBCROR^^0^B14535382
"BLD",5249,"KRN",9.8,"NM",16,0)
IBCSC5^^0^B17725585
"BLD",5249,"KRN",9.8,"NM",17,0)
IBYPSC1^^0^B50879196
"BLD",5249,"KRN",9.8,"NM",18,0)
IBCNS3^^0^B53375755
"BLD",5249,"KRN",9.8,"NM",19,0)
IBCROI1^^0^B11664048
"BLD",5249,"KRN",9.8,"NM",20,0)
IBCDP^^0^B65537098
"BLD",5249,"KRN",9.8,"NM",21,0)
IBCRBE^^0^B31036524
"BLD",5249,"KRN",9.8,"NM","B","IBCDE",12)

"BLD",5249,"KRN",9.8,"NM","B","IBCDP",20)

"BLD",5249,"KRN",9.8,"NM","B","IBCNS3",18)

"BLD",5249,"KRN",9.8,"NM","B","IBCRBE",21)

"BLD",5249,"KRN",9.8,"NM","B","IBCROI1",19)

"BLD",5249,"KRN",9.8,"NM","B","IBCROIP",14)

"BLD",5249,"KRN",9.8,"NM","B","IBCROR",15)

"BLD",5249,"KRN",9.8,"NM","B","IBCSC4",2)

"BLD",5249,"KRN",9.8,"NM","B","IBCSC5",16)

"BLD",5249,"KRN",9.8,"NM","B","IBCSCE",4)

"BLD",5249,"KRN",9.8,"NM","B","IBCSCH",5)

"BLD",5249,"KRN",9.8,"NM","B","IBCU2",13)

"BLD",5249,"KRN",9.8,"NM","B","IBCU65",6)

"BLD",5249,"KRN",9.8,"NM","B","IBCU7A",9)

"BLD",5249,"KRN",9.8,"NM","B","IBYPSC",10)

"BLD",5249,"KRN",9.8,"NM","B","IBYPSC1",17)

"BLD",5249,"KRN",19,0)
19
"BLD",5249,"KRN",19.1,0)
19.1
"BLD",5249,"KRN",101,0)
101
"BLD",5249,"KRN",409.61,0)
409.61
"BLD",5249,"KRN",771,0)
771
"BLD",5249,"KRN",870,0)
870
"BLD",5249,"KRN",8989.51,0)
8989.51
"BLD",5249,"KRN",8989.52,0)
8989.52
"BLD",5249,"KRN",8994,0)
8994
"BLD",5249,"KRN","B",.4,.4)

"BLD",5249,"KRN","B",.401,.401)

"BLD",5249,"KRN","B",.402,.402)

"BLD",5249,"KRN","B",.403,.403)

"BLD",5249,"KRN","B",.5,.5)

"BLD",5249,"KRN","B",.84,.84)

"BLD",5249,"KRN","B",3.6,3.6)

"BLD",5249,"KRN","B",3.8,3.8)

"BLD",5249,"KRN","B",9.2,9.2)

"BLD",5249,"KRN","B",9.8,9.8)

"BLD",5249,"KRN","B",19,19)

"BLD",5249,"KRN","B",19.1,19.1)

"BLD",5249,"KRN","B",101,101)

"BLD",5249,"KRN","B",409.61,409.61)

"BLD",5249,"KRN","B",771,771)

"BLD",5249,"KRN","B",870,870)

"BLD",5249,"KRN","B",8989.51,8989.51)

"BLD",5249,"KRN","B",8989.52,8989.52)

"BLD",5249,"KRN","B",8994,8994)

"BLD",5249,"QUES",0)
^9.62^^
"BLD",5249,"REQB",0)
^9.611^1^1
"BLD",5249,"REQB",1,0)
IB*2.0*288^1
"BLD",5249,"REQB","B","IB*2.0*288",1)

"INIT")
POST^IBYPSC
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
287^3050217
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3050217
"PKG",200,22,1,"PAH",1,1,1,0)
Reasonable Charges v2.2.  Enhancements only, no charges.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","IBCDE")
0^12^B15655498
"RTN","IBCDE",1,0)
IBCDE ;ALB/ARH - AUTOMATED BILLER ERRORS ; 8/6/93
"RTN","IBCDE",2,0)
 ;;2.0;INTEGRATED BILLING;**55,287**;21-MAR-94
"RTN","IBCDE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCDE",4,0)
 ;
"RTN","IBCDE",5,0)
SETCOMM ;sets errors/comments into file (362.1) based on array passed in
"RTN","IBCDE",6,0)
 ;^TMP("IBCE",$J,IBDT,IBTRN,IBIFN,x)=error message  (IBTRN OR IBIFN may be 0)
"RTN","IBCDE",7,0)
 ;if an entry already exists for event/bill its comments are deleted and replaced with what is passed in, if any
"RTN","IBCDE",8,0)
 ;
"RTN","IBCDE",9,0)
 Q:'$D(^TMP("IBCE",$J))
"RTN","IBCDE",10,0)
 S IBDT=0 F  S IBDT=$O(^TMP("IBCE",$J,IBDT)) Q:'IBDT  D
"RTN","IBCDE",11,0)
 . S IBTRN="" F  S IBTRN=$O(^TMP("IBCE",$J,IBDT,IBTRN)) Q:IBTRN=""  D
"RTN","IBCDE",12,0)
 .. S IBIFN="" F  S IBIFN=$O(^TMP("IBCE",$J,IBDT,IBTRN,IBIFN)) Q:IBIFN=""  D
"RTN","IBCDE",13,0)
 ... S IBDA=$$COMM1(IBTRN,IBIFN) Q:IBDA'>0  D COMM2(IBDA,"",1)
"RTN","IBCDE",14,0)
 ... S IBX=0 F  S IBX=$O(^TMP("IBCE",$J,IBDT,IBTRN,IBIFN,IBX)) Q:'IBX  D
"RTN","IBCDE",15,0)
 .... D COMM2(IBDA,^(IBX))
"RTN","IBCDE",16,0)
 K IBDT,IBTRN,IBIFN,IBDA,IBX,X,Y
"RTN","IBCDE",17,0)
 Q
"RTN","IBCDE",18,0)
 ;
"RTN","IBCDE",19,0)
COMM1(TRN,IFN) ;returns the comment entry number for event and bill, updates comment date and bill IFN
"RTN","IBCDE",20,0)
 ;if an entry does not exits one is created,  does not add any comments
"RTN","IBCDE",21,0)
 N IBDA,X,Y S IBDA=0,TRN=$G(TRN),IFN=$G(IFN) I '$D(^IBT(356,+TRN,0))!(+IFN&('$D(^DGCR(399,+IFN,0)))) G COMM1E
"RTN","IBCDE",22,0)
 S IBDA=$$FIND(TRN,IFN) I 'IBDA D  G:IBDA<0 COMM1E ; create new comment entry
"RTN","IBCDE",23,0)
 . S IBDA=$P(^IBA(362.1,0),U,3)+1 F  Q:'$D(^IBA(362.1,IBDA))  S IBDA=IBDA+1
"RTN","IBCDE",24,0)
 . S DIC="^IBA(362.1,",X=IBDA,DIC(0)="L",DIC("DR")=".02////"_$S(+TRN:TRN,1:"") K DD,DO D FILE^DICN K DD,DO,DIC S IBDA=+Y,DR=";.05////"_DT
"RTN","IBCDE",25,0)
 ; edit existing comment entry, add date (DT) and bill number
"RTN","IBCDE",26,0)
 S DIE="^IBA(362.1,",DA=IBDA,DR=".03////"_$S(+IFN:IFN,1:"")_$G(DR) D ^DIE K DIE,DA,DR,DIC
"RTN","IBCDE",27,0)
COMM1E Q IBDA
"RTN","IBCDE",28,0)
 ;
"RTN","IBCDE",29,0)
COMM2(IFNC,COMM,DEL) ;adds/deletes comments form a comment file entry, nothing returned
"RTN","IBCDE",30,0)
 ;if DEL is passed as true any comments existing for the entry are deleted
"RTN","IBCDE",31,0)
 ;if COMM contains text it is added as a comment to the entry
"RTN","IBCDE",32,0)
 N X,Y,IBDA1 S IBDA1=0 I '$D(^IBA(362.1,+$G(IFNC),0)) G COMM2E
"RTN","IBCDE",33,0)
 I +$G(DEL),$D(^IBA(362.1,+IFNC,11)) S DIE="^IBA(362.1,",DA=+IFNC,DR="11///@" D ^DIE K DIE,DIC,DR,DA
"RTN","IBCDE",34,0)
 I $G(COMM)'="" D  S ^IBA(362.1,+IFNC,11,IBDA1,0)=COMM
"RTN","IBCDE",35,0)
 . S IBDA1=+$P($G(^IBA(362.1,+IFNC,11,0)),U,3)+1 F  Q:'$D(^IBA(362.1,+IFNC,11,IBDA1))  S IBDA1=IBDA1+1
"RTN","IBCDE",36,0)
 I IBDA1>0 S ^IBA(362.1,+IFNC,11,0)="^^"_IBDA1_"^"_IBDA1_"^"_DT_"^"
"RTN","IBCDE",37,0)
COMM2E Q
"RTN","IBCDE",38,0)
 ;
"RTN","IBCDE",39,0)
FIND(TRN,IFN) ;find an entry in the comments file, returns IFN of comment entry
"RTN","IBCDE",40,0)
 ;returns comment entry that may not match with bill number if either the bill number passed in or comment entry bill number is null  (a comment entry may be initially created with no bill number)
"RTN","IBCDE",41,0)
 ;given that a comment entry is found for the event (TRN) then returns comment IFN based on following restrictions, otherwise returns 0
"RTN","IBCDE",42,0)
 ;1) if an exact match between bill number passed in and comment entry bill number is found (including null) then the IFN of that comment entry is returned
"RTN","IBCDE",43,0)
 ;2) if not 1) and no bill number passed in then returns the IFN of the last comment entry found, if any
"RTN","IBCDE",44,0)
 ;3) if not 1) and a bill number is passed in then returns the IFN of thelast comment entry found that does not have an associated bill number, if any
"RTN","IBCDE",45,0)
 N X,X1,Y S (X,Y)=0,TRN=+$G(TRN),IFN=+$G(IFN)
"RTN","IBCDE",46,0)
 F  S Y=$O(^IBA(362.1,"C",TRN,Y)) Q:'Y  S X1=+$P($G(^IBA(362.1,Y,0)),U,3) S:('X1)!('IFN) X=Y I X1=IFN S X=Y Q
"RTN","IBCDE",47,0)
 Q X
"RTN","IBCDE",48,0)
 ;
"RTN","IBCDE",49,0)
FINDB(IFN) ;search for any entries for a particular bill, returns string of comment file entry numbers separated by "^"
"RTN","IBCDE",50,0)
 N X,Y S X="",TRN=+$G(TRN),IFN=+$G(IFN)
"RTN","IBCDE",51,0)
 S Y=0 F  S Y=$O(^IBA(362.1,"D",IFN,Y)) Q:'Y  S X=Y_"^"_X
"RTN","IBCDE",52,0)
 Q X
"RTN","IBCDE",53,0)
 ;
"RTN","IBCDE",54,0)
PRINT ;print error/comments file (362.1), OPTION - replace in IB*2*287
"RTN","IBCDE",55,0)
 G ^IBCDP
"RTN","IBCDE",56,0)
 Q
"RTN","IBCDE",57,0)
 W !!,"Report requires 132 columns."
"RTN","IBCDE",58,0)
 S IBDATES=$$FMDATES^IBCU2 I IBDATES="" G PE
"RTN","IBCDE",59,0)
 S DHD="AUTOMATED BILLER ERRORS/COMMENTS FOR "_$$FMTE^XLFDT($P(IBDATES,U,1))_" - "_$$FMTE^XLFDT($P(IBDATES,U,2))
"RTN","IBCDE",60,0)
 S (FLDS,BY)="[IB AB COMMENTS]",FR=$P(IBDATES,U,1)_",,?,",TO=$P(IBDATES,U,2)_",,?,",L=0,DIC="^IBA(362.1,"
"RTN","IBCDE",61,0)
 D EN1^DIP
"RTN","IBCDE",62,0)
PE K X,Y,DTOUT,DUOUT,DIRUT,DIROUT,DIOEND,DIC,L,FLDS,BY,DHD,FR,TO,IBDATES
"RTN","IBCDE",63,0)
 Q
"RTN","IBCDE",64,0)
 ;
"RTN","IBCDE",65,0)
EDIT ;edit auto bill parameters, OPTION
"RTN","IBCDE",66,0)
 N IBFR,IBFR2
"RTN","IBCDE",67,0)
 S IBFR=$P($G(^IBE(350.9,1,7)),U,1)
"RTN","IBCDE",68,0)
 S DIE="^IBE(350.9,",DA=1,DR="7.01;7.03" D ^DIE I $D(Y) G EDITQ
"RTN","IBCDE",69,0)
 S IBFR2=$P($G(^IBE(350.9,1,7)),U,1)
"RTN","IBCDE",70,0)
 D:'IBFR CLEAN^IBCDC D:'IBFR2 ABOFF^IBCDC
"RTN","IBCDE",71,0)
E2 W ! S DIC="^IBE(356.6,",DIC(0)="AEQ" D ^DIC G EDITQ:Y<0
"RTN","IBCDE",72,0)
 S DIE="^IBE(356.6,",DA=+Y,DR=".04;.05;.06" D ^DIE
"RTN","IBCDE",73,0)
 G E2
"RTN","IBCDE",74,0)
EDITQ K DIE,DA,DR,X,Y
"RTN","IBCDE",75,0)
 Q
"RTN","IBCDE",76,0)
DELDT ;deletes entries from file (362.1) based on date and if they have a bill, OPTION
"RTN","IBCDE",77,0)
 S IBDT=$$FMADD^XLFDT(DT,-3),DIR("B")=$$FMTE^XLFDT(IBDT),DIR("?")="Enter a date before "_DIR("B")_"."
"RTN","IBCDE",78,0)
 S DIR("?",1)="All entries in the Auto Biller Comments file not associated with a bill entered on or before this date will be deleted."
"RTN","IBCDE",79,0)
 S DIR(0)="DOA^2880101:"_IBDT_":EX",DIR("A")="End Date for Delete: "
"RTN","IBCDE",80,0)
 D ^DIR K DIR G:'Y DELDTQ S IBDT=+Y
"RTN","IBCDE",81,0)
 ;
"RTN","IBCDE",82,0)
 S IBCE=0 F  S IBCE=$O(^IBA(362.1,IBCE)) Q:'IBCE  S X=$G(^IBA(362.1,IBCE,0)) I $P(X,U,5)'>IBDT,'$P(X,U,3) D
"RTN","IBCDE",83,0)
 . S DIK="^IBA(362.1,",DA=IBCE D ^DIK W "."
"RTN","IBCDE",84,0)
DELDTQ K IBCE,DIK,DIC,DA,X,Y
"RTN","IBCDE",85,0)
 Q
"RTN","IBCDP")
0^20^B65537098
"RTN","IBCDP",1,0)
IBCDP ;ALB/ARH - AUTOMATED BILLER PRINT ; 12/01/04
"RTN","IBCDP",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBCDP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCDP",4,0)
 ;
"RTN","IBCDP",5,0)
EN ; OPTION ENTRY POINT:  Auto Biller Report - get parameters then run the report
"RTN","IBCDP",6,0)
 N X,Y,DIR,DIRUT,DTOUT,DUOUT,DIROUT,IBSDR,IBDATES,IBSEV,IBSBC,IBPATS,IBQUIT K ^TMP($J,"IBCDP")
"RTN","IBCDP",7,0)
 W !!!,"Auto Biller Results Report"
"RTN","IBCDP",8,0)
 W !,"This report contains results of the activity from the Third Party Auto Biller."
"RTN","IBCDP",9,0)
 W !,"The Third Party Auto Biller processes Claims Tracking entries and may create a"
"RTN","IBCDP",10,0)
 W !,"bill.  This report will provide detail for all processed entries, including the"
"RTN","IBCDP",11,0)
 W !,"bill number if a bill was created or the reason a bill could not be created."
"RTN","IBCDP",12,0)
 ;
"RTN","IBCDP",13,0)
 ; select sort/select by Auto Biller Date or Event Date
"RTN","IBCDP",14,0)
 S DIR("?")="Sort the report by Event Date or by the Date(s) the Auto Biller Processed the Events."
"RTN","IBCDP",15,0)
 S DIR(0)="S^1:Event Date;2:Auto Biller Date",DIR("B")="Event Date",DIR("A")="Sort By"
"RTN","IBCDP",16,0)
 D ^DIR S IBSDR=+Y K DIR W ! I ('Y)!($D(DIRUT)) Q
"RTN","IBCDP",17,0)
 ;
"RTN","IBCDP",18,0)
 ; get date range
"RTN","IBCDP",19,0)
 S IBDATES=$S(IBSDR=1:"Event Date",1:"Auto Biller Date"),IBDATES=$$FMDATES^IBCU2(IBDATES) I IBDATES="" Q
"RTN","IBCDP",20,0)
 ;
"RTN","IBCDP",21,0)
 ; get types of events to include in report
"RTN","IBCDP",22,0)
 S DIR("?")="Select the Types of Events to include in the report."
"RTN","IBCDP",23,0)
 S DIR(0)="S^1:Inpatient Admissions;2:Outpatient Visits;3:Prescriptions;4:All",DIR("B")="All",DIR("A")="Include"
"RTN","IBCDP",24,0)
 D ^DIR S IBSEV=$S(+Y=4:"",1:+Y) K DIR I ('Y)!($D(DIRUT)) Q
"RTN","IBCDP",25,0)
 ;
"RTN","IBCDP",26,0)
 ; get types of auto biller results to include in report, either bill created or not
"RTN","IBCDP",27,0)
 S DIR("?")="Include Claims Tracking events the Auto Biller was able to create bills for or those events the Auto Biller could not create a bill for (with the reason) or both types of events."
"RTN","IBCDP",28,0)
 S DIR(0)="S^1:Bill Auto Created;2:No Bill Created;3:All",DIR("B")="All",DIR("A")="Include"
"RTN","IBCDP",29,0)
 D ^DIR S IBSBC=$S(+Y=3:"",1:+Y) K DIR I ('Y)!($D(DIRUT)) Q
"RTN","IBCDP",30,0)
 ;
"RTN","IBCDP",31,0)
 ; get range of patient names
"RTN","IBCDP",32,0)
 S DIR("?")="Select range of Patient Names to include in report." W !
"RTN","IBCDP",33,0)
 S DIR(0)="FO" S DIR("B")="FIRST",DIR("A")="START WITH PATIENT NAME"
"RTN","IBCDP",34,0)
 D ^DIR Q:$D(DIRUT)  K DIR S IBPATS=$E(Y,1,$L(Y)-1)_$C($A($E(Y,$L(Y)))-1)_"~" I Y="FIRST" S IBPATS=""
"RTN","IBCDP",35,0)
 ;
"RTN","IBCDP",36,0)
 S DIR("?")="Select range of Patient Names to include in report."
"RTN","IBCDP",37,0)
 S DIR(0)="FO^^I X'=""LAST"","""_IBPATS_"""]X K X",DIR("B")="LAST",DIR("A")="GO TO PATIENT NAME"
"RTN","IBCDP",38,0)
 D ^DIR Q:$D(DIRUT)  K DIR S:Y="LAST" Y="" S $P(IBPATS,U,2)=Y_"~"
"RTN","IBCDP",39,0)
 ;
"RTN","IBCDP",40,0)
 W !!,"Report requires 132 columns.",!
"RTN","IBCDP",41,0)
 S IBQUIT=0 D DEV I IBQUIT G EXIT
"RTN","IBCDP",42,0)
 ;
"RTN","IBCDP",43,0)
RPT ;find, save, and print Auto Biller Report - entry for tasked jobs
"RTN","IBCDP",44,0)
 ;
"RTN","IBCDP",45,0)
 I IBSDR=1 D SORT1
"RTN","IBCDP",46,0)
 I IBSDR=2 D SORT2
"RTN","IBCDP",47,0)
 ;
"RTN","IBCDP",48,0)
 D PRINT
"RTN","IBCDP",49,0)
 ;
"RTN","IBCDP",50,0)
EXIT ;clean up and quit
"RTN","IBCDP",51,0)
 K ^TMP($J,"IBCDP") Q:$D(ZTQUEUED)
"RTN","IBCDP",52,0)
 D ^%ZISC
"RTN","IBCDP",53,0)
 Q
"RTN","IBCDP",54,0)
 ;
"RTN","IBCDP",55,0)
 ;
"RTN","IBCDP",56,0)
SORT1 ; sort by Event Date in Claims Tracking
"RTN","IBCDP",57,0)
 ; for each CT entry within the selected date range check/get it's auto biller entries, if they meet the criteria
"RTN","IBCDP",58,0)
 N IBBEG,IBEND,IBEVDT,IBCTFN,IBABFN Q:'$G(IBDATES)
"RTN","IBCDP",59,0)
 ;
"RTN","IBCDP",60,0)
 S IBBEG=+$P(IBDATES,U,1)-.01,IBEND=+$P(IBDATES,U,2)+.7
"RTN","IBCDP",61,0)
 ;
"RTN","IBCDP",62,0)
 S IBEVDT=IBBEG F  S IBEVDT=$O(^IBT(356,"D",IBEVDT)) Q:('IBEVDT)!(IBEVDT>IBEND)  D
"RTN","IBCDP",63,0)
 . S IBCTFN=0 F  S IBCTFN=$O(^IBT(356,"D",IBEVDT,IBCTFN)) Q:'IBCTFN  D
"RTN","IBCDP",64,0)
 .. ;
"RTN","IBCDP",65,0)
 .. S IBABFN=0 F  S IBABFN=$O(^IBA(362.1,"C",IBCTFN,IBABFN)) Q:'IBABFN  D
"RTN","IBCDP",66,0)
 ... ;
"RTN","IBCDP",67,0)
 ... D GETLN(IBABFN)
"RTN","IBCDP",68,0)
 Q
"RTN","IBCDP",69,0)
 ;
"RTN","IBCDP",70,0)
SORT2 ; sort by Entry Date in Auto Biller
"RTN","IBCDP",71,0)
 ; for each AB entry within the selected date range check/get the entry, if they meet the criteria
"RTN","IBCDP",72,0)
 N IBBEG,IBEND,IBABFN,IBETDT Q:'IBDATES
"RTN","IBCDP",73,0)
 ;
"RTN","IBCDP",74,0)
 S IBBEG=+$P(IBDATES,U,1)-.01,IBEND=+$P(IBDATES,U,2)+.7
"RTN","IBCDP",75,0)
 ;
"RTN","IBCDP",76,0)
 S IBABFN=0  F  S IBABFN=$O(^IBA(362.1,IBABFN)) Q:'IBABFN  D
"RTN","IBCDP",77,0)
 . S IBETDT=$P($G(^IBA(362.1,IBABFN,0)),U,5)
"RTN","IBCDP",78,0)
 . ;
"RTN","IBCDP",79,0)
 . I (IBETDT<IBBEG)!(IBETDT>IBEND) Q
"RTN","IBCDP",80,0)
 . ;
"RTN","IBCDP",81,0)
 . D GETLN(IBABFN)
"RTN","IBCDP",82,0)
 ;
"RTN","IBCDP",83,0)
 Q
"RTN","IBCDP",84,0)
 ;
"RTN","IBCDP",85,0)
 ;
"RTN","IBCDP",86,0)
GETLN(IBABFN) ; check and select auto biller entries that meet the criteria, Input: all select criteria
"RTN","IBCDP",87,0)
 ; Output:  ^TMP($J,"IBCDP",sort date,event type,patient name_event date/time, AB FN) = CT FN
"RTN","IBCDP",88,0)
 N IBAB0,IBCTFN,IBCT0,IBCTDT,IBCTTY,DFN,IBDFNN,IBABDT,IBDTBEG,IBDTEND,IBPTBEG,IBPTEND,IBSORT1,IBSORT3,IBX
"RTN","IBCDP",89,0)
 Q:'$G(IBSDR)  Q:'$G(IBDATES)  S IBSEV=$G(IBSEV),IBSBC=$G(IBSBC),IBPATS=$G(IBPATS)
"RTN","IBCDP",90,0)
 ;
"RTN","IBCDP",91,0)
 S IBAB0=$G(^IBA(362.1,+$G(IBABFN),0)) Q:IBAB0=""
"RTN","IBCDP",92,0)
 S IBCTFN=$P(IBAB0,U,2) Q:'IBCTFN  S IBCT0=$G(^IBT(356,IBCTFN,0)) Q:IBCT0=""
"RTN","IBCDP",93,0)
 ;
"RTN","IBCDP",94,0)
 S IBCTDT=$P(IBCT0,U,6),IBCTTY=$P(IBCT0,U,18)
"RTN","IBCDP",95,0)
 S DFN=$P(IBCT0,U,2) Q:'DFN  S IBDFNN=$P($G(^DPT(DFN,0)),U,1)
"RTN","IBCDP",96,0)
 S IBABDT=$P(IBAB0,U,5)
"RTN","IBCDP",97,0)
 ;
"RTN","IBCDP",98,0)
 S IBDTBEG=+$P(IBDATES,U,1)-.01,IBDTEND=+$P(IBDATES,U,2)+.7
"RTN","IBCDP",99,0)
 S IBPTBEG=$P(IBPATS,U,1),IBPTEND=$P(IBPATS,U,2)
"RTN","IBCDP",100,0)
 ;
"RTN","IBCDP",101,0)
 ;
"RTN","IBCDP",102,0)
 I IBSDR=1 I (IBCTDT<IBDTBEG)!(IBCTDT>IBDTEND) Q  ; check entry within CT event date
"RTN","IBCDP",103,0)
 I IBSDR=2 I (IBABDT<IBDTBEG)!(IBABDT>IBDTEND) Q  ; check entry within AB entry date
"RTN","IBCDP",104,0)
 ;
"RTN","IBCDP",105,0)
 I IBSEV=1 I IBCTTY'=1 Q  ; check types of events to include
"RTN","IBCDP",106,0)
 I IBSEV=2 I IBCTTY'=2 Q
"RTN","IBCDP",107,0)
 I IBSEV=3 I IBCTTY'=4 Q
"RTN","IBCDP",108,0)
 ;
"RTN","IBCDP",109,0)
 I +IBSBC S IBX=$$CHKBILL(IBCTFN) ; check if a bill is associated with the AB entry
"RTN","IBCDP",110,0)
 I IBSBC=1,'IBX Q
"RTN","IBCDP",111,0)
 I IBSBC=2,+IBX Q
"RTN","IBCDP",112,0)
 ;
"RTN","IBCDP",113,0)
 I IBPTBEG'="",IBDFNN']IBPTBEG Q  ; check patient name is within the range selected
"RTN","IBCDP",114,0)
 I IBPTEND'="",IBDFNN]IBPTEND Q
"RTN","IBCDP",115,0)
 ;
"RTN","IBCDP",116,0)
 ;
"RTN","IBCDP",117,0)
 S IBSORT1=$S(IBSDR=1:IBCTDT,1:IBABDT),IBSORT1=$E(IBSORT1,1,7) ; sort by CT event date or AB entry date
"RTN","IBCDP",118,0)
 S IBSORT3=IBDFNN_" ^"_IBCTDT ; sort by patient name and date/time
"RTN","IBCDP",119,0)
 ;
"RTN","IBCDP",120,0)
 S ^TMP($J,"IBCDP",+IBSORT1,+IBCTTY,IBSORT3,IBABFN)=IBCTFN
"RTN","IBCDP",121,0)
 Q
"RTN","IBCDP",122,0)
 ;
"RTN","IBCDP",123,0)
CHKBILL(IBCTFN) ; return first bill found if Claims Tracking event had a bill created for it
"RTN","IBCDP",124,0)
 N IBX,IBABFN,IBAB0 S IBX=0
"RTN","IBCDP",125,0)
 I +$G(IBCTFN) S IBABFN=0 F  S IBABFN=$O(^IBA(362.1,"C",IBCTFN,IBABFN)) Q:'IBABFN  D  Q:+IBX
"RTN","IBCDP",126,0)
 . S IBAB0=$G(^IBA(362.1,IBABFN,0)) S IBX=+$P(IBAB0,U,3)
"RTN","IBCDP",127,0)
 Q IBX
"RTN","IBCDP",128,0)
 ;
"RTN","IBCDP",129,0)
 ;
"RTN","IBCDP",130,0)
 ;
"RTN","IBCDP",131,0)
PRINT ;print the report from the temp sort file to the appropriate device
"RTN","IBCDP",132,0)
 N IBSCRPT,IBPGN,IBLN,IBQUIT,IBS1,IBS2,IBS3,IBABFN,IBAB0,IBCTFN,IBCT0,DFN,IBDFN0,IBBLFN,IBBL0,IBBLU,IBX
"RTN","IBCDP",133,0)
 N IBDFNN,IB1U4N,IBTYP,IBEVDT,IBBILL,IBBSTAT,IBBTF,IBBSF,IBBST,IBABC,IBHDR1,IBHDR2,IBHDR3,IBHDR4
"RTN","IBCDP",134,0)
 I '$D(ZTQUEUED) U IO
"RTN","IBCDP",135,0)
 S IBSCRPT="IBCDP",IBPGN=0,IBLN=99999,IBQUIT=0 D GETHDR Q:$$HDR
"RTN","IBCDP",136,0)
 ;
"RTN","IBCDP",137,0)
 S IBS1="" F  S IBS1=$O(^TMP($J,IBSCRPT,IBS1)) Q:IBS1=""  D  Q:IBQUIT
"RTN","IBCDP",138,0)
 . I +$G(IBSDR) W !,?20,$S(IBSDR=1:"Event Date: ",1:"Auto Bill Date: "),$$FMTE^XLFDT(IBS1),! S IBLN=IBLN+2
"RTN","IBCDP",139,0)
 . ;
"RTN","IBCDP",140,0)
 . S IBS2="" F  S IBS2=$O(^TMP($J,IBSCRPT,IBS1,IBS2)) Q:IBS2=""  D  Q:IBQUIT  W ! S IBLN=IBLN+1
"RTN","IBCDP",141,0)
 .. S IBS3="" F  S IBS3=$O(^TMP($J,IBSCRPT,IBS1,IBS2,IBS3)) Q:IBS3=""  D  Q:IBQUIT
"RTN","IBCDP",142,0)
 ... S IBABFN="" F  S IBABFN=$O(^TMP($J,IBSCRPT,IBS1,IBS2,IBS3,IBABFN)) Q:IBABFN=""  D  S IBQUIT=$$HDR Q:IBQUIT
"RTN","IBCDP",143,0)
 .... ;
"RTN","IBCDP",144,0)
 .... S IBAB0=$G(^IBA(362.1,IBABFN,0)) Q:IBAB0=""
"RTN","IBCDP",145,0)
 .... S IBCTFN=$P(IBAB0,U,2) Q:'IBCTFN  S IBCT0=$G(^IBT(356,IBCTFN,0)) Q:IBCT0=""
"RTN","IBCDP",146,0)
 .... S DFN=$P(IBCT0,U,2) Q:'DFN  S IBDFN0=$G(^DPT(DFN,0))
"RTN","IBCDP",147,0)
 .... S IBBLFN=$P(IBAB0,U,3),IBBL0="",IBBLU=""
"RTN","IBCDP",148,0)
 .... I +IBBLFN S IBBL0=$G(^DGCR(399,IBBLFN,0)),IBBLU=$G(^DGCR(399,IBBLFN,"U"))
"RTN","IBCDP",149,0)
 .... ;
"RTN","IBCDP",150,0)
 .... S IBDFNN=$P(IBDFN0,U,1)
"RTN","IBCDP",151,0)
 .... S IB1U4N=$E(IBDFN0,1)_$E($P(IBDFN0,U,9),6,9)
"RTN","IBCDP",152,0)
 .... S IBTYP=$P($G(^IBE(356.6,+$P(IBCT0,U,18),0)),U,1)
"RTN","IBCDP",153,0)
 .... S IBEVDT=$$FMTE^XLFDT($P(IBCT0,U,6)),IBEVDT=$TR(IBEVDT,"@"," ")
"RTN","IBCDP",154,0)
 .... S IBBILL=$P(IBBL0,U,1)
"RTN","IBCDP",155,0)
 .... S IBBSTAT=$$EXSET^IBEFUNC($P(IBBL0,U,13),399,.13)
"RTN","IBCDP",156,0)
 .... S IBBTF=$$EXSET^IBEFUNC($P(IBBL0,U,6),399,.06)
"RTN","IBCDP",157,0)
 .... S IBBSF=$$FMTE^XLFDT(IBBLU)
"RTN","IBCDP",158,0)
 .... S IBBST=$$FMTE^XLFDT($P(IBBLU,U,2))
"RTN","IBCDP",159,0)
 .... ;
"RTN","IBCDP",160,0)
 .... W !,$E(IBDFNN,1,20),?22,$E(IB1U4N,1,6),?30,$E(IBTYP,U,4),?37,$P(IBEVDT,":",1,2),?60,IBBILL,?70,$E(IBBSTAT,1,7),?82,$E(IBBTF,1,15),?102,IBBSF,?117,IBBST S IBLN=IBLN+1
"RTN","IBCDP",161,0)
 .... ;
"RTN","IBCDP",162,0)
 .... S IBABC=0 F  S IBABC=$O(^IBA(362.1,IBABFN,11,IBABC)) Q:'IBABC  D
"RTN","IBCDP",163,0)
 ..... S IBX=$G(^IBA(362.1,IBABFN,11,IBABC,0)) I IBX'="" W !,?37,IBX S IBLN=IBLN+1
"RTN","IBCDP",164,0)
 ;
"RTN","IBCDP",165,0)
 I 'IBQUIT D PAUSE
"RTN","IBCDP",166,0)
 Q
"RTN","IBCDP",167,0)
 ;
"RTN","IBCDP",168,0)
 ;
"RTN","IBCDP",169,0)
GETHDR ; set up header lines
"RTN","IBCDP",170,0)
 S IBHDR1="AUTOMATED BILLER ERRORS/COMMENTS FOR "_$$FMTE^XLFDT($G(IBDATES))_" - "_$$FMTE^XLFDT($P($G(IBDATES),U,2))
"RTN","IBCDP",171,0)
 S IBHDR1=IBHDR1_$J("",(IOM-$L(IBHDR1)-30))_$P($$HTE^XLFDT($H),":",1,2)_$J("",$L(IOM-8))_"Page "
"RTN","IBCDP",172,0)
 S IBHDR2="                              EVENT                         BILL                  TIMEFRAME OF        STATEMENT      STATEMENT"
"RTN","IBCDP",173,0)
 S IBHDR3="PATIENT                       TYPE   EPISODE DATE           NUMBER    STATUS      BILL                COVERS FROM    COVERS TO"
"RTN","IBCDP",174,0)
 S IBHDR4="",$P(IBHDR4,"-",IOM+1)=""
"RTN","IBCDP",175,0)
 Q
"RTN","IBCDP",176,0)
 ;
"RTN","IBCDP",177,0)
 ;
"RTN","IBCDP",178,0)
HDR() ;print the report header
"RTN","IBCDP",179,0)
 N IBQUIT,X,Y S IBQUIT=0
"RTN","IBCDP",180,0)
 S IBQUIT=$$STOP I +IBQUIT G HDRQ
"RTN","IBCDP",181,0)
 I IBLN<(IOSL-5) G HDRQ
"RTN","IBCDP",182,0)
 I IBPGN>0 D PAUSE I +IBQUIT G HDRQ
"RTN","IBCDP",183,0)
 S IBPGN=IBPGN+1,IBLN=5
"RTN","IBCDP",184,0)
 I IBPGN>1!($E(IOST,1,2)["C-") W @IOF
"RTN","IBCDP",185,0)
 ;
"RTN","IBCDP",186,0)
 W !,IBHDR1,IBPGN,!,IBHDR2,!,IBHDR3,!,IBHDR4
"RTN","IBCDP",187,0)
HDRQ Q IBQUIT
"RTN","IBCDP",188,0)
 ;
"RTN","IBCDP",189,0)
 ;
"RTN","IBCDP",190,0)
PAUSE ;pause at end of screen if being displayed on a terminal
"RTN","IBCDP",191,0)
 Q:$E(IOST,1,2)'["C-"  S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DIRUT)) S IBQUIT=1
"RTN","IBCDP",192,0)
 Q
"RTN","IBCDP",193,0)
 ;
"RTN","IBCDP",194,0)
 ;
"RTN","IBCDP",195,0)
DEV ;get the device
"RTN","IBCDP",196,0)
 S IBQUIT=0 S %ZIS="QM",%ZIS("A")="OUTPUT DEVICE: " D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBCDP",197,0)
 I $D(IO("Q")) S ZTRTN="RPT^IBCDP",ZTDESC="Auto Biller Report",ZTSAVE("IB*")="" D ^%ZTLOAD K IO("Q") S IBQUIT=1
"RTN","IBCDP",198,0)
 Q
"RTN","IBCDP",199,0)
 ;
"RTN","IBCDP",200,0)
STOP() ; determine if user has requested the queued report to stop
"RTN","IBCDP",201,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ I +$G(IBPGN) W !,"***TASK STOPPED BY USER***"
"RTN","IBCDP",202,0)
 Q +$G(ZTSTOP)
"RTN","IBCNS3")
0^18^B53375755
"RTN","IBCNS3",1,0)
IBCNS3 ;ALB/ARH - DISPLAY EXTENDED INSURANCE ; 01-DEC-04
"RTN","IBCNS3",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBCNS3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNS3",4,0)
 ;
"RTN","IBCNS3",5,0)
DISP(DFN,DATE,DISPLAY) ;  Display all insurance company information
"RTN","IBCNS3",6,0)
 ;    input: DFN     = pointer to patient
"RTN","IBCNS3",7,0)
 ;           DATE    = date to check for coverage and riders
"RTN","IBCNS3",8,0)
 ;           DISPLAY = contain indicators of data to display (123)
"RTN","IBCNS3",9,0)
 ;
"RTN","IBCNS3",10,0)
 Q:'$G(DFN)  D:'$D(IOF) HOME^%ZIS
"RTN","IBCNS3",11,0)
 N IBINS,IBPOLFN,IBPOL0,IBPLNFN S DISPLAY=$G(DISPLAY) I '$G(DATE) S DATE=DT
"RTN","IBCNS3",12,0)
 K ^TMP($J,"IBCNS3")
"RTN","IBCNS3",13,0)
 ;
"RTN","IBCNS3",14,0)
 D ALL^IBCNS1(DFN,"IBINS")
"RTN","IBCNS3",15,0)
 ;
"RTN","IBCNS3",16,0)
 I '$D(IBINS) D SETLN(" "),SETLN("No Insurance Information")
"RTN","IBCNS3",17,0)
 ;
"RTN","IBCNS3",18,0)
 ;
"RTN","IBCNS3",19,0)
 S IBPOLFN=0 F  S IBPOLFN=$O(IBINS(IBPOLFN)) Q:'IBPOLFN  D
"RTN","IBCNS3",20,0)
 . S IBPOL0=IBINS(IBPOLFN,0),IBPLNFN=$P(IBPOL0,U,18)
"RTN","IBCNS3",21,0)
 . S ^TMP($J,"IBCNS3")=IBPOLFN
"RTN","IBCNS3",22,0)
 . ;
"RTN","IBCNS3",23,0)
 . D GETLN(IBPOL0,DATE)
"RTN","IBCNS3",24,0)
 . I DISPLAY[2 D GETEXT(DFN,IBPOLFN,IBPOL0,DATE) ; display extended
"RTN","IBCNS3",25,0)
 . I DISPLAY[3 D GETCOM(IBPLNFN,$G(IBINS(IBPOLFN,1))) ; display extended 3, comments
"RTN","IBCNS3",26,0)
 ;
"RTN","IBCNS3",27,0)
 S ^TMP($J,"IBCNS3")="" D GETNOTES(DFN)
"RTN","IBCNS3",28,0)
 ;
"RTN","IBCNS3",29,0)
 D PRINT
"RTN","IBCNS3",30,0)
 ;
"RTN","IBCNS3",31,0)
DISPQ K ^TMP($J,"IBCNS3")
"RTN","IBCNS3",32,0)
 Q
"RTN","IBCNS3",33,0)
 ;
"RTN","IBCNS3",34,0)
PRINT ; display compiled array of patient insurance information in ^TMP($J,"IBCNS3")
"RTN","IBCNS3",35,0)
 N IBSUB,IBCOUNT,IBQUIT,IBLEVEL,IBLNX,IBDASH,IBLINE,IBCNTLN S $P(IBDASH,"-",80)="-" S DISPLAY=+$G(DISPLAY)
"RTN","IBCNS3",36,0)
 ;
"RTN","IBCNS3",37,0)
 D HDR S IBSUB="IBCNS3",IBCOUNT=3,IBQUIT=0
"RTN","IBCNS3",38,0)
 ;
"RTN","IBCNS3",39,0)
 S IBLEVEL=0 F  S IBLEVEL=$O(^TMP($J,IBSUB,IBLEVEL)) Q:'IBLEVEL  D  Q:IBQUIT
"RTN","IBCNS3",40,0)
 . S IBCNTLN=+$G(^TMP($J,IBSUB,IBLEVEL))+1
"RTN","IBCNS3",41,0)
 . ;
"RTN","IBCNS3",42,0)
 . I IBCOUNT>10,(IBCNTLN+IBCOUNT)>(IOSL-3) S IBQUIT=$$EOP Q:IBQUIT  D HDR S IBCOUNT=3
"RTN","IBCNS3",43,0)
 . ;
"RTN","IBCNS3",44,0)
 . S IBLNX=0 F  S IBLNX=$O(^TMP($J,IBSUB,IBLEVEL,IBLNX)) Q:'IBLNX  D  Q:IBQUIT
"RTN","IBCNS3",45,0)
 .. ;
"RTN","IBCNS3",46,0)
 .. S IBLINE=$G(^TMP($J,IBSUB,IBLEVEL,IBLNX))
"RTN","IBCNS3",47,0)
 .. ;
"RTN","IBCNS3",48,0)
 .. W !,IBLINE S IBCOUNT=IBCOUNT+1 I IBCOUNT>(IOSL-3) S IBQUIT=$$EOP Q:IBQUIT  W @IOF S IBCOUNT=2
"RTN","IBCNS3",49,0)
 . ;
"RTN","IBCNS3",50,0)
 . I 'IBQUIT,DISPLAY>1 W !,IBDASH S IBCOUNT=IBCOUNT+1
"RTN","IBCNS3",51,0)
 ;
"RTN","IBCNS3",52,0)
 I 'IBQUIT,IBCOUNT>2 S IBQUIT=$$EOP
"RTN","IBCNS3",53,0)
 Q
"RTN","IBCNS3",54,0)
 ;
"RTN","IBCNS3",55,0)
SETLN(LINE) ; set line as next line for current policy
"RTN","IBCNS3",56,0)
 N CNT,POL S LINE=$G(LINE)
"RTN","IBCNS3",57,0)
 S POL=+$G(^TMP($J,"IBCNS3"))
"RTN","IBCNS3",58,0)
 I 'POL S POL=$O(^TMP($J,"IBCNS3","~"),-1)+1 S ^TMP($J,"IBCNS3")=POL
"RTN","IBCNS3",59,0)
 ;
"RTN","IBCNS3",60,0)
 S CNT=+$G(^TMP($J,"IBCNS3",POL))+1
"RTN","IBCNS3",61,0)
 S ^TMP($J,"IBCNS3",POL)=CNT
"RTN","IBCNS3",62,0)
 S ^TMP($J,"IBCNS3",POL,CNT)=LINE
"RTN","IBCNS3",63,0)
 Q
"RTN","IBCNS3",64,0)
 ;
"RTN","IBCNS3",65,0)
 ;
"RTN","IBCNS3",66,0)
 ;
"RTN","IBCNS3",67,0)
GETLN(IBPOL0,IBDATE) ; get single line of primary data on insurance policy
"RTN","IBCNS3",68,0)
 ;     input:   IBPOL0 = line from array, zero node of patient policy (2,.312)
"RTN","IBCNS3",69,0)
 ;              IBDATE = date to check coverage, default today
"RTN","IBCNS3",70,0)
 ;    output:   formatted line of data for insurance policy in TMP($J,"IBCNS")
"RTN","IBCNS3",71,0)
 ;
"RTN","IBCNS3",72,0)
 N IBX,IBLINE S IBLINE=" " S IBPOL0=$G(IBPOL0)
"RTN","IBCNS3",73,0)
 ;
"RTN","IBCNS3",74,0)
 S IBX=$G(^DIC(36,+IBPOL0,0)),IBX=$S($P(IBX,U,1)'="":$P(IBX,U,1),1:"UNKNOWN") S IBLINE=$$FRMLN(IBX,IBLINE,11,0)
"RTN","IBCNS3",75,0)
 S IBX=$P(IBPOL0,U,20),IBX=$S(IBX=1:"p",IBX=2:"s",IBX=3:"t",1:"") S IBLINE=$$FRMLN(IBX,IBLINE,1,14)
"RTN","IBCNS3",76,0)
 S IBX=$P(IBPOL0,U,2) S IBLINE=$$FRMLN(IBX,IBLINE,16,17)
"RTN","IBCNS3",77,0)
 S IBX=$$FNDGRP($P(IBPOL0,U,18)) S IBLINE=$$FRMLN(IBX,IBLINE,10,35)
"RTN","IBCNS3",78,0)
 S IBX=$P(IBPOL0,U,6),IBX=$S(IBX="v":"SELF",IBX="s":"SPOUSE",1:"OTHER") S IBLINE=$$FRMLN(IBX,IBLINE,7,47)
"RTN","IBCNS3",79,0)
 S IBX=$$DAT1^IBOUTL($P(IBPOL0,U,8)) S IBLINE=$$FRMLN(IBX,IBLINE,8,55)
"RTN","IBCNS3",80,0)
 S IBX=$$DAT1^IBOUTL($P(IBPOL0,U,4)) S IBLINE=$$FRMLN(IBX,IBLINE,8,65)
"RTN","IBCNS3",81,0)
 S IBX=$$FNDCOV(+IBPOL0,+$P(IBPOL0,U,18),$G(IBDATE)) S IBLINE=$$FRMLN(IBX,IBLINE,5,75)
"RTN","IBCNS3",82,0)
 ;
"RTN","IBCNS3",83,0)
 D SETLN(IBLINE)
"RTN","IBCNS3",84,0)
GETLNQ Q
"RTN","IBCNS3",85,0)
 ;
"RTN","IBCNS3",86,0)
 ;
"RTN","IBCNS3",87,0)
GETEXT(DFN,IBPOLFN,IBPOL0,DATE) ; display extended insurance information
"RTN","IBCNS3",88,0)
 ; Plan Filing Timeframe, Plan Coverage, Conditional Coverage Comments, and Riders
"RTN","IBCNS3",89,0)
 ;     input:   DFN     = pointer to patient (2)
"RTN","IBCNS3",90,0)
 ;              IBPOLFN = pointer to patient insurance policy in 2.312
"RTN","IBCNS3",91,0)
 ;              IBPOL0  = line from array, zero node of patient policy (2,.312)
"RTN","IBCNS3",92,0)
 ;              DATE    = date to check coverage, default today
"RTN","IBCNS3",93,0)
 ;              DISPARR = array to pass data back in, pass by reference
"RTN","IBCNS3",94,0)
 ;    output:   array of extended data in TMP($J,"IBCNS")
"RTN","IBCNS3",95,0)
 ;
"RTN","IBCNS3",96,0)
 N IBX,IBY,IBZ,IBC,IBINSFN,IBPLNFN,IBPLN0,IBLINE,IBCAT,IBCATFN,IBCOVRD,ARR,ARR1 S:'$G(DATE) DATE=DT
"RTN","IBCNS3",97,0)
 S IBINSFN=+$G(IBPOL0) Q:'IBINSFN  S IBPLNFN=+$P(IBPOL0,U,18),IBPLN0=$G(^IBA(355.3,IBPLNFN,0)) Q:IBPLN0=""
"RTN","IBCNS3",98,0)
 ;
"RTN","IBCNS3",99,0)
 S IBLINE="Last Verified:   ",(IBY,IBX)=""
"RTN","IBCNS3",100,0)
 S IBY=$P($G(^DPT(DFN,.312,IBPOLFN,1)),U,3) I IBY'="" S IBX=$$DAT1^IBOUTL(IBY) S IBLINE=IBLINE_IBX D SETLN(" "),SETLN(IBLINE)
"RTN","IBCNS3",101,0)
 ;
"RTN","IBCNS3",102,0)
 S IBLINE="Plan Filing Time Frame: "
"RTN","IBCNS3",103,0)
 S IBY=$P(IBPLN0,U,13) I IBY'="" S IBLINE=IBLINE_IBY D:IBX="" SETLN(" ") D SETLN(IBLINE)
"RTN","IBCNS3",104,0)
 ;
"RTN","IBCNS3",105,0)
 S IBLINE="Insurance Comp:  "
"RTN","IBCNS3",106,0)
 I $P($G(^DIC(36,IBINSFN,0)),U,2)="N" S IBLINE=IBLINE_"Will Not Reimburse" D SETLN(" "),SETLN(IBLINE)
"RTN","IBCNS3",107,0)
 ;
"RTN","IBCNS3",108,0)
 S IBLINE="Conditional: ",IBCOVRD=""
"RTN","IBCNS3",109,0)
 K ARR F IBCAT="INPATIENT","OUTPATIENT","PHARMACY","MENTAL HEALTH","DENTAL" D
"RTN","IBCNS3",110,0)
 . S IBCATFN=+$O(^IBE(355.31,"B",IBCAT,"")) Q:'IBCATFN
"RTN","IBCNS3",111,0)
 . S IBY=$$PLCOV^IBCNSU3(+IBPLNFN,DATE,IBCATFN,.ARR) Q:IBY'>0
"RTN","IBCNS3",112,0)
 . I IBY=1 S IBCOVRD=$G(IBCOVRD)_IBCAT_", " Q
"RTN","IBCNS3",113,0)
 . S IBX=IBCAT_": ",IBC=$G(IBC)+100 S IBLINE=$$FRMLN(IBX,IBLINE,15,17)
"RTN","IBCNS3",114,0)
 . S IBZ=0 F  S IBZ=$O(ARR(IBZ)) Q:'IBZ  S IBX=ARR(IBZ) D  S IBLINE=""
"RTN","IBCNS3",115,0)
 .. S IBLINE=$$FRMLN(IBX,IBLINE,46,33) S ARR1(IBC+IBZ)=IBLINE
"RTN","IBCNS3",116,0)
 I IBCOVRD'="" S IBLINE="Plan Coverage:   "_$G(IBCOVRD) D SETLN(" "),SETLN(IBLINE)
"RTN","IBCNS3",117,0)
 I $O(ARR1("")) D:IBCOVRD="" SETLN(" ") S IBZ=0 F  S IBZ=$O(ARR1(IBZ)) Q:'IBZ  S IBX=ARR1(IBZ) D SETLN(IBX)
"RTN","IBCNS3",118,0)
 ;
"RTN","IBCNS3",119,0)
 S IBLINE="Policy Riders: "
"RTN","IBCNS3",120,0)
 K ARR D RIDERS^IBCNSU3(+$G(DFN),+$G(IBPOLFN),.ARR) I $O(ARR("")) D SETLN(" ")
"RTN","IBCNS3",121,0)
 S IBZ=0 F  S IBZ=$O(ARR(IBZ)) Q:'IBZ  S IBX=ARR(IBZ) D  S IBLINE=""
"RTN","IBCNS3",122,0)
 . S IBLINE=$$FRMLN(IBX,IBLINE,62,17) D SETLN(IBLINE)
"RTN","IBCNS3",123,0)
 Q
"RTN","IBCNS3",124,0)
 ;
"RTN","IBCNS3",125,0)
 ;
"RTN","IBCNS3",126,0)
GETCOM(IBPLNFN,IBPOL1) ; get patient insurance and plan insurance comments in TMP($J,"IBCNS")
"RTN","IBCNS3",127,0)
 N IBX,IBY
"RTN","IBCNS3",128,0)
 ;
"RTN","IBCNS3",129,0)
 S IBX=$P($G(IBPOL1),U,8) I IBX'="" S IBY="Patient Policy Comments: " D SETLN(" "),SETLN(IBY),SETLN(IBX)
"RTN","IBCNS3",130,0)
 ;
"RTN","IBCNS3",131,0)
 I +$G(IBPLNFN),$O(^IBA(355.3,+IBPLNFN,11,0)) S IBX="Group/Plan Comments:" D SETLN(" "),SETLN(IBX) D
"RTN","IBCNS3",132,0)
 . S IBX=0 F  S IBX=$O(^IBA(355.3,+IBPLNFN,11,IBX)) Q:'IBX  S IBY=$G(^IBA(355.3,+IBPLNFN,11,IBX,0)) D SETLN(IBY)
"RTN","IBCNS3",133,0)
 Q
"RTN","IBCNS3",134,0)
 ;
"RTN","IBCNS3",135,0)
 ;
"RTN","IBCNS3",136,0)
GETNOTES(DFN) ; get final notes/warnings in TMP($J,"IBCNS")
"RTN","IBCNS3",137,0)
 N IBX,IBY,IBLINE1,IBLINE2,IBFND S (IBFND,IBLINE1,IBLINE2)=""  Q:'$G(DFN)
"RTN","IBCNS3",138,0)
 ;
"RTN","IBCNS3",139,0)
 S IBX=+$G(^IBA(354,DFN,60)) I +IBX S IBY="*** Verification of No Coverage "_$$FMTE^XLFDT(IBX)_" ***" S IBLINE1=$$FRMLN(IBY,"",60,16),IBFND=1
"RTN","IBCNS3",140,0)
 I $$BUFFER^IBCNBU1(DFN) S IBY="***  Patient has Insurance Buffer entries  ***" S IBLINE2=$$FRMLN(IBY,"",50,17),IBFND=1
"RTN","IBCNS3",141,0)
 ;
"RTN","IBCNS3",142,0)
 I +IBFND D SETLN(" ") D:IBLINE1'="" SETLN(IBLINE1) D:IBLINE2'="" SETLN(IBLINE2) D SETLN(" ")
"RTN","IBCNS3",143,0)
 ;
"RTN","IBCNS3",144,0)
 Q
"RTN","IBCNS3",145,0)
 ;
"RTN","IBCNS3",146,0)
 ;
"RTN","IBCNS3",147,0)
 ;
"RTN","IBCNS3",148,0)
 ;
"RTN","IBCNS3",149,0)
FRMLN(FIELD,IBLINE,FLNG,COL) ; format line data fields, returns IBLINE with FIELD of length FLNG at column COL
"RTN","IBCNS3",150,0)
 N IBNEW,IBL S FIELD=$G(FIELD),IBLINE=$G(IBLINE),FLNG=$G(FLNG),COL=$G(COL)
"RTN","IBCNS3",151,0)
 ;
"RTN","IBCNS3",152,0)
 S IBNEW=$E(IBLINE,1,COL),IBL=$L(IBNEW),IBNEW=IBNEW_$J("",COL-IBL)
"RTN","IBCNS3",153,0)
 S IBNEW=IBNEW_$E(FIELD,1,FLNG),IBL=$L(FIELD),IBNEW=IBNEW_$J("",FLNG-IBL)
"RTN","IBCNS3",154,0)
 S IBNEW=IBNEW_$E(IBLINE,COL+FLNG+1,9999)
"RTN","IBCNS3",155,0)
 Q IBNEW
"RTN","IBCNS3",156,0)
 ;
"RTN","IBCNS3",157,0)
 ;
"RTN","IBCNS3",158,0)
 ;
"RTN","IBCNS3",159,0)
FNDCOV(IBINSFN,IBPLNFN,IBDATE) ; -- return group/plan coverage limitations indications
"RTN","IBCNS3",160,0)
 ;     input:   IBINSFN = pointer to insurance company entry in 36
"RTN","IBCNS3",161,0)
 ;              IBPLNFN = pointer to insurance plan entry in 355.3
"RTN","IBCNS3",162,0)
 ;              IBDATE  = date to check coverage, default today
"RTN","IBCNS3",163,0)
 ;    output:   if insurance company will not reimburse = WNR, if all covered then returns null
"RTN","IBCNS3",164,0)
 ;              otherwise list of first characters of types covered, if conditional then character in lower case
"RTN","IBCNS3",165,0)
 ;              
"RTN","IBCNS3",166,0)
 N IBOUT,IBX,IBY,IBCAT,IBCATFN S IBOUT="" S:'$G(IBDATE) IBDATE=DT I '$G(IBINSFN)!'$G(IBPLNFN) G FNDCOVQ
"RTN","IBCNS3",167,0)
 ;
"RTN","IBCNS3",168,0)
 I $P($G(^DIC(36,+IBINSFN,0)),U,2)="N" S IBOUT="*WNR*" G FNDCOVQ
"RTN","IBCNS3",169,0)
 F IBCAT="INPATIENT","OUTPATIENT","PHARMACY","MENTAL HEALTH","DENTAL" D
"RTN","IBCNS3",170,0)
 . S IBCATFN=+$O(^IBE(355.31,"B",IBCAT,"")) Q:'IBCATFN
"RTN","IBCNS3",171,0)
 . S IBY=$$PLCOV^IBCNSU3(+IBPLNFN,IBDATE,+IBCATFN) Q:'IBY
"RTN","IBCNS3",172,0)
 . S IBX=$S(IBCAT="PHARMACY":"R",1:$E(IBCAT)) S:IBY>1 IBX=$C($A(IBX)+32) S IBOUT=IBOUT_IBX
"RTN","IBCNS3",173,0)
 S:IBOUT="" IBOUT="no CV" I IBOUT?5U S IBOUT=""
"RTN","IBCNS3",174,0)
FNDCOVQ Q IBOUT
"RTN","IBCNS3",175,0)
 ;
"RTN","IBCNS3",176,0)
 ;
"RTN","IBCNS3",177,0)
FNDGRP(IBPLNFN) ; -- return group name/group policy
"RTN","IBCNS3",178,0)
 ;     input:   IBPLNFN = pointer to insurance plan entry in 355.3
"RTN","IBCNS3",179,0)
 ;    output:   group name or group number, if both group NUMBER, check for Individual plans
"RTN","IBCNS3",180,0)
 ;
"RTN","IBCNS3",181,0)
 N IBX,IBOUT S IBOUT=""
"RTN","IBCNS3",182,0)
 S IBX=$G(^IBA(355.3,+$G(IBPLNFN),0))
"RTN","IBCNS3",183,0)
 S IBOUT=$S($P(IBX,U,4)'="":$P(IBX,U,4),1:$P(IBX,U,3))
"RTN","IBCNS3",184,0)
 I $P(IBX,U,10) S IBOUT="Ind. Plan "_IBOUT
"RTN","IBCNS3",185,0)
FNDGRPQ Q IBOUT
"RTN","IBCNS3",186,0)
 ;
"RTN","IBCNS3",187,0)
 ;
"RTN","IBCNS3",188,0)
 ;
"RTN","IBCNS3",189,0)
 ;
"RTN","IBCNS3",190,0)
HDR ; -- print header
"RTN","IBCNS3",191,0)
 N IBX W @IOF
"RTN","IBCNS3",192,0)
 W !,"Insurance",?13,"COB",?17,"Subscriber ID",?35,"Group",?47,"Holder",?55,"Effectve",?65,"Expires",?75,"Only"
"RTN","IBCNS3",193,0)
 S IBX="",$P(IBX,"=",80)="=" W !,IBX
"RTN","IBCNS3",194,0)
 Q
"RTN","IBCNS3",195,0)
 ;
"RTN","IBCNS3",196,0)
EOP() ; ask user for return at end of page, return 1 if '^' entered
"RTN","IBCNS3",197,0)
 N IBQ,DIR,DIRUT,DUOUT,DTOUT,X,Y W ! S IBQ=0,DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DIRUT)) S IBQ=1
"RTN","IBCNS3",198,0)
 Q IBQ
"RTN","IBCRBE")
0^21^B31036524
"RTN","IBCRBE",1,0)
IBCRBE ;ALB/ARH - RATES: BILL ENTER/EDIT (RS/CS) SCREEN ; 22-MAY-1996
"RTN","IBCRBE",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,245,287**;21-MAR-94
"RTN","IBCRBE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCRBE",4,0)
 ; 
"RTN","IBCRBE",5,0)
EDIT(IBIFN) ; ENTRY POINT from Enter/Edit a Bill option:  
"RTN","IBCRBE",6,0)
 ; display available Schedules/Sets for a bill, allow the user to choose the ones to use,
"RTN","IBCRBE",7,0)
 ; then recalculate the bills charges
"RTN","IBCRBE",8,0)
 ;
"RTN","IBCRBE",9,0)
 N IBSRTARR,IBCHGARR,IBUCHGAR I '$G(IBIFN) G EDITQ
"RTN","IBCRBE",10,0)
 ;
"RTN","IBCRBE",11,0)
 I '$$DISPLAY(IBIFN,.IBSRTARR) G EDITQ
"RTN","IBCRBE",12,0)
 ;
"RTN","IBCRBE",13,0)
 I '$$SELCT(IBIFN,.IBSRTARR,.IBCHGARR) G EDITQ
"RTN","IBCRBE",14,0)
 ;
"RTN","IBCRBE",15,0)
 I $O(IBCHGARR(0)) D BILL^IBCRBC(IBIFN,.IBCHGARR)
"RTN","IBCRBE",16,0)
 ;
"RTN","IBCRBE",17,0)
 I $O(IBCHGARR(0)),$$SELITEMS^IBCRBEI(IBIFN,.IBCHGARR,.IBUCHGAR) D BILLITEM^IBCRBC(IBIFN,.IBUCHGAR)
"RTN","IBCRBE",18,0)
 ;
"RTN","IBCRBE",19,0)
EDITQ Q
"RTN","IBCRBE",20,0)
 ;
"RTN","IBCRBE",21,0)
DISPLAY(IBIFN,IBSRTARR) ; get list of all RS/CS combinations available for use on the bill
"RTN","IBCRBE",22,0)
 ; sort them in name order then display the results to the screen, returns 1 if some found
"RTN","IBCRBE",23,0)
 N IB0,IBU,IBC,IBRSARR K IBSRTARR S IBC=1
"RTN","IBCRBE",24,0)
 ;
"RTN","IBCRBE",25,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) I IB0="" S IBC=0 G DISPQ
"RTN","IBCRBE",26,0)
 S IBU=$G(^DGCR(399,+$G(IBIFN),"U")) I 'IBU S IBC=0 G DISPQ
"RTN","IBCRBE",27,0)
 D RT^IBCRU3($P(IB0,U,7),+$P(IB0,U,5),$P(IBU,U,1,2),.IBRSARR)
"RTN","IBCRBE",28,0)
 ;
"RTN","IBCRBE",29,0)
 I 'IBRSARR D NONE($P(IB0,U,1),$P(IB0,U,7),+$P(IB0,U,5),$P(IB0,U,3)),WAIT S IBC=0 G DISPQ
"RTN","IBCRBE",30,0)
 ;
"RTN","IBCRBE",31,0)
 D SORTBRS(.IBRSARR,.IBSRTARR,$P(IB0,U,27)),DISPRS($P(IB0,U,7),$P(IB0,U,5),.IBSRTARR)
"RTN","IBCRBE",32,0)
 ;
"RTN","IBCRBE",33,0)
DISPQ Q IBC
"RTN","IBCRBE",34,0)
 ;
"RTN","IBCRBE",35,0)
SORTBRS(IBRSARR,IBSRTARR,IBBCT) ; return array in rs name, cs name sorted order with external form of data
"RTN","IBCRBE",36,0)
 ; input:   IBRSARR(rate sched IFN,charge set IFN) = true if auto add
"RTN","IBCRBE",37,0)
 ; output:  IBSRTARR = CNT of RS/CS to be auto added ^ total CNT
"RTN","IBCRBE",38,0)
 ;          IBSRTARR(CNT) = rs IFN ^ cs IFN ^ rs name ^ cs name ^ auto add ^ unassoc event ^ chg type ^ disp set
"RTN","IBCRBE",39,0)
 ;
"RTN","IBCRBE",40,0)
 N IBRS,IBCS,IBRSN,IBCSN,IBAA,IBUA,IBCT,IBTCNT,IBACNT,IBLN,IBS,ARRX K IBSRTARR S IBBCT=+$G(IBBCT)
"RTN","IBCRBE",41,0)
 S IBRS=0 F  S IBRS=$O(IBRSARR(IBRS)) Q:'IBRS  D
"RTN","IBCRBE",42,0)
 . S IBCS=0 F  S IBCS=$O(IBRSARR(IBRS,IBCS)) Q:'IBCS  D
"RTN","IBCRBE",43,0)
 .. S IBAA=IBRSARR(IBRS,IBCS),IBRSN=$P($G(^IBE(363,+IBRS,0)),U,1),IBCSN=$P($G(^IBE(363.1,+IBCS,0)),U,1)
"RTN","IBCRBE",44,0)
 .. S IBUA=$S($$CSBR^IBCRU3(IBCS)["UNASSOCIATE":1,1:0),IBCT=$P($G(^IBE(363.1,+IBCS,0)),U,4)
"RTN","IBCRBE",45,0)
 .. S IBS=$S('IBAA:2,(+IBBCT&(IBBCT'=IBCT)):1,1:" ")_$S(IBCT=1:"I",IBCT=2:"P",1:" ")
"RTN","IBCRBE",46,0)
 .. I IBRSN'="",IBCSN'="" S ARRX(IBS_IBRSN_IBRS_IBCS,IBCSN)=IBRS_U_IBCS_U_IBRSN_U_IBCSN_U_IBAA_U_IBUA_U_IBCT_U_IBS
"RTN","IBCRBE",47,0)
 ;
"RTN","IBCRBE",48,0)
 S (IBTCNT,IBACNT)=0,IBRSN="" F  S IBRSN=$O(ARRX(IBRSN)) Q:IBRSN=""  D
"RTN","IBCRBE",49,0)
 . S IBCSN="" F  S IBCSN=$O(ARRX(IBRSN,IBCSN)) Q:IBCSN=""  D
"RTN","IBCRBE",50,0)
 .. S IBLN=ARRX(IBRSN,IBCSN),IBTCNT=IBTCNT+1 I 'IBRSN S IBACNT=IBACNT+1
"RTN","IBCRBE",51,0)
 .. S IBSRTARR(IBTCNT)=IBLN
"RTN","IBCRBE",52,0)
 S IBSRTARR=IBACNT_U_IBTCNT
"RTN","IBCRBE",53,0)
 Q
"RTN","IBCRBE",54,0)
 ;
"RTN","IBCRBE",55,0)
DISPRS(RT,BT,IBSRTARR) ; display available rate schedules and charge sets for a bill
"RTN","IBCRBE",56,0)
 N RTN,IBCNT,IBLN,IBLAST S RTN=$P($G(^DGCR(399.3,+$G(RT),0)),U,1),BT=$G(BT)
"RTN","IBCRBE",57,0)
 W @IOF,!?5,"Rate Schedules available for an "_$S(BT>2:"Outpatient ",BT>0:"Inpatient ",1:"")_$E(RTN,1,27)_" bill"
"RTN","IBCRBE",58,0)
 W !,"------------------------------------------------------------------------------"
"RTN","IBCRBE",59,0)
 ;
"RTN","IBCRBE",60,0)
 S IBCNT=0 F  S IBCNT=$O(IBSRTARR(IBCNT)) Q:'IBCNT  D
"RTN","IBCRBE",61,0)
 . S IBLN=$G(IBSRTARR(IBCNT)) I +$P(IBLN,U,8)'=+$G(IBLAST) W ! S IBLAST=+$P(IBLN,U,8)
"RTN","IBCRBE",62,0)
 . W !,?3,IBCNT,")",?8,$P(IBLN,U,3),?31,$P(IBLN,U,4),?69,$S(+$P(IBLN,U,7)=1:"INST",$P(IBLN,U,7)=2:"PROF",1:""),?75,$S(+$P(IBLN,U,6):"s",1:""),?77,$S('$P(IBLN,U,5):"*",1:"")
"RTN","IBCRBE",63,0)
 ;
"RTN","IBCRBE",64,0)
 Q
"RTN","IBCRBE",65,0)
 ;
"RTN","IBCRBE",66,0)
SELCT(IBIFN,IBSRTARR,IBCHGARR) ; get the user selection of rs/cs charges to add to the bill
"RTN","IBCRBE",67,0)
 ; input:   IBSRTARR = CNT of RS/CS to be auto added ^ total CNT
"RTN","IBCRBE",68,0)
 ;          IBSRTARR(CNT) = rs IFN ^ cs IFN ^ rs name ^ cs name ^ Auto Add ^ unassoc event ^ chg type ^ disp set
"RTN","IBCRBE",69,0)
 ; output:  IBCHGARR(rate sched IFN,charge set IFN) = 1 - add charges for rs/cs
"RTN","IBCRBE",70,0)
 ;
"RTN","IBCRBE",71,0)
 N IBCHNG,IBSEL,IBI,IBS,IBX,IBLN,DIR,DIRUT,DUOUT,DTOUT,X,Y K IBCHGARR S IBCHNG=0 I '$G(IBIFN) G SELCTQ
"RTN","IBCRBE",72,0)
 I '$O(IBSRTARR(0)) G SELCTQ
"RTN","IBCRBE",73,0)
 ;
"RTN","IBCRBE",74,0)
 S DIR("?")="Enter the number (1-"_+$P(IBSRTARR,U,2)_") preceding the Rate Schedule/Charge Sets that apply to this bill.  All associated charges will be added to the bill."
"RTN","IBCRBE",75,0)
 S DIR("?",1)="* - these charges are available to be added to this bill if selected here,"
"RTN","IBCRBE",76,0)
 S DIR("?",2)="    but will not be added when the bills charges are automatically calculated."
"RTN","IBCRBE",77,0)
 S DIR("?",3)="s - the items these charges are associated with must be specifically"
"RTN","IBCRBE",78,0)
 S DIR("?",4)="    selected here, they do not relate to any item on the bill.",DIR("?",5)=" "
"RTN","IBCRBE",79,0)
 S DIR("?",6)="If the bill's charge type is exclusively institutional or professional then"
"RTN","IBCRBE",80,0)
 S DIR("?",7)="only sets of charges with a corresponding type will be added when the bills"
"RTN","IBCRBE",81,0)
 S DIR("?",8)="charges are automatically calculated.  On this screen, these charges will be"
"RTN","IBCRBE",82,0)
 S DIR("?",9)="displayed in the first set and used as the selection default.",DIR("?",10)=" "
"RTN","IBCRBE",83,0)
 S DIR("??")="^D HELP^IBCRBE("_IBIFN_")"
"RTN","IBCRBE",84,0)
 S DIR("A")="Select Schedule Charges to ADD to the bill: " I +IBSRTARR S DIR("B")="1-"_+IBSRTARR
"RTN","IBCRBE",85,0)
 ;
"RTN","IBCRBE",86,0)
 W !! S DIR(0)="LOA^1:"_+$P(IBSRTARR,U,2) D ^DIR K DIR I 'Y!$D(DIRUT) G SELCTQ
"RTN","IBCRBE",87,0)
 ;
"RTN","IBCRBE",88,0)
 S IBX="" F  S IBX=$O(Y(IBX)) Q:IBX=""  D
"RTN","IBCRBE",89,0)
 . S IBSEL=Y(IBX) F IBI=1:1:100 S IBS=$P(IBSEL,",",IBI) Q:'IBS  D
"RTN","IBCRBE",90,0)
 .. I $D(IBSRTARR(IBS)) S IBCHNG=1,IBLN=IBSRTARR(IBS),IBCHGARR(+IBLN,$P(IBLN,U,2))=1
"RTN","IBCRBE",91,0)
 ;
"RTN","IBCRBE",92,0)
SELCTQ Q IBCHNG
"RTN","IBCRBE",93,0)
 ;
"RTN","IBCRBE",94,0)
NONE(IBBN,RT,BT,EVDT) ; write message indicating no rate schedules defined for this bill
"RTN","IBCRBE",95,0)
 N IBRTN S BT=+$G(BT),EVDT=$G(EVDT),IBRTN=$P($G(^DGCR(399.3,+$G(RT),0)),U,1)
"RTN","IBCRBE",96,0)
 W !,?7 I +EVDT W !,?7,"On ",$$DATE^IBCRU1(+EVDT),", there are "
"RTN","IBCRBE",97,0)
 W "No Rate Schedules with charges defined "
"RTN","IBCRBE",98,0)
 I IBRTN'="" W:+EVDT !,?20 W "for ",$S(BT>2:"Outpatient ",BT>0:"Inpatient ",1:""),IBRTN
"RTN","IBCRBE",99,0)
 I $G(IBBN)'="" W !!,?7,"Therefore, charges can not be calculated for this bill (",IBBN,") "
"RTN","IBCRBE",100,0)
 W !
"RTN","IBCRBE",101,0)
 Q
"RTN","IBCRBE",102,0)
 ;
"RTN","IBCRBE",103,0)
WAIT N DIR,DIRUT,DUOUT,DTOUT,Y,X S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR
"RTN","IBCRBE",104,0)
 Q
"RTN","IBCRBE",105,0)
 ;
"RTN","IBCRBE",106,0)
HELP(IBIFN) ; display rs/cs for the bill - used as help text
"RTN","IBCRBE",107,0)
 N IBX I +$G(IBIFN) S IBX=$$DISPLAY(IBIFN)
"RTN","IBCRBE",108,0)
 Q
"RTN","IBCROI1")
0^19^B11664048
"RTN","IBCROI1",1,0)
IBCROI1 ;ALB/ARH - RATES: REPORTS CHARGE ITEM (SRCH) ; 11/22/96
"RTN","IBCROI1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,245,287**;21-MAR-94
"RTN","IBCROI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCROI1",4,0)
 ;
"RTN","IBCROI1",5,0)
 ;  ^TMP($J,SUB1) = report header ^ SORT1 ^ SORT2 ^ count & desc (optional)
"RTN","IBCROI1",6,0)
 ;  ^TMP($J,SUB1, SUB2) = IFN of SUB2
"RTN","IBCROI1",7,0)
 ;  ^TMP($J,SUB1, SUB2, SUB3, SUB4, CI IFN) = itm ^ cs ^ ef dt ^ in dt ^ chg ^ rv cd ^ mod ^ base charge
"RTN","IBCROI1",8,0)
 ; 
"RTN","IBCROI1",9,0)
 ; SORT1=1:  (SRCH1) SUB2 = BILLING RATE name        SORT2=1:  SUB3 = Item Name          SUB4 = Effective Date
"RTN","IBCROI1",10,0)
 ; SORT1=2:  (SRCH2) SUB2 = CHARGE SET name          SORT2=2:  SUB3 = Effective Date     SUB4 = Item Name
"RTN","IBCROI1",11,0)
 ; 
"RTN","IBCROI1",12,0)
 ; SUB1 - first subscript to identify the search/print, set to "IBCROI" for the Charge Item report
"RTN","IBCROI1",13,0)
 ; other reports may use this array and print routine, both TMPLN and TMPHDR must be called to setup array
"RTN","IBCROI1",14,0)
 ; if called direct to SRCHITM with SORT3=3: sort by Item, Effective Date, SUB2 (as passed in)
"RTN","IBCROI1",15,0)
 ;
"RTN","IBCROI1",16,0)
SRCH1(BRL,SORT2,BDT,EDT,IBSELITM) ; search/gather items for the report, all charge sets for a particular Rate
"RTN","IBCROI1",17,0)
 ; Input: BRL = List of Billing Rates to include, SORT2 = secondary sort: 1/charge item, 2/effective date
"RTN","IBCROI1",18,0)
 N IBRATE,IBRATEN,IBHDR,IBSUB2,IBCS,IBCS0,IBI K ^TMP($J,"IBCROI") I '$G(SORT2)!($G(BDT)'?7N)!($G(EDT)'?7N) Q
"RTN","IBCROI1",19,0)
 ;
"RTN","IBCROI1",20,0)
 I +$G(BRL) S IBRATE=0 F IBI=1:1 S IBRATE=$P(BRL,U,IBI) Q:'IBRATE  D
"RTN","IBCROI1",21,0)
 . S IBRATEN=$P($G(^IBE(363.3,+IBRATE,0)),U,1) Q:IBRATEN=""
"RTN","IBCROI1",22,0)
 . S IBHDR="Charges for "_$S(+$P(BRL,U,2):"Selected",1:IBRATEN)_" Rates ",IBSUB2="BILLING RATE"
"RTN","IBCROI1",23,0)
 . ;
"RTN","IBCROI1",24,0)
 . S IBCS=0 F  S IBCS=$O(^IBE(363.1,IBCS)) Q:'IBCS  D
"RTN","IBCROI1",25,0)
 .. S IBCS0=$G(^IBE(363.1,IBCS,0)) I $P(IBCS0,U,2)'=IBRATE Q
"RTN","IBCROI1",26,0)
 .. D SRCHITM(IBCS,IBSUB2,SORT2,BDT,EDT,$G(IBSELITM)) I '$D(ZTQUEUED) W "."
"RTN","IBCROI1",27,0)
 .. D TMPHDR("IBCROI",IBSUB2,0,IBHDR,"1^"_SORT2,BDT,EDT)
"RTN","IBCROI1",28,0)
 Q
"RTN","IBCROI1",29,0)
 ;
"RTN","IBCROI1",30,0)
SRCH2(CSL,SORT2,BDT,EDT,IBSELITM) ; search/gather items for the report for a group of Charge Sets
"RTN","IBCROI1",31,0)
 ; Input:  CSL = list of Charge Sets to sort, SORT2 = secondary sort: 1/charge item, 2/effective date
"RTN","IBCROI1",32,0)
 N IBCS,IBCSN,IBI,IBHDR K ^TMP($J,"IBCROI") I '$G(SORT2)!($G(BDT)'?7N)!($G(EDT)'?7N) Q
"RTN","IBCROI1",33,0)
 ;
"RTN","IBCROI1",34,0)
 I +$G(CSL) S IBCS=0 F IBI=1:1 S IBCS=$P(CSL,U,IBI) Q:'IBCS  D
"RTN","IBCROI1",35,0)
 . S IBCSN=$P($G(^IBE(363.1,+IBCS,0)),U,1) Q:IBCSN=""  S IBHDR="Charges by Set for "
"RTN","IBCROI1",36,0)
 . D SRCHITM(IBCS,IBCSN,SORT2,BDT,EDT,$G(IBSELITM)) I '$D(ZTQUEUED) W "."
"RTN","IBCROI1",37,0)
 . D TMPHDR("IBCROI",IBCSN,IBCS,IBHDR,"2^"_SORT2,BDT,EDT)
"RTN","IBCROI1",38,0)
 Q
"RTN","IBCROI1",39,0)
 ;
"RTN","IBCROI1",40,0)
SRCHITM(CS,SUB2,SORT2,BDT,EDT,IBSELITM) ; search/gather all items within the date range for one Charge Set
"RTN","IBCROI1",41,0)
 ; Input:  CS = CS IFN, SUB2 = first data subscript, SORT2 = secondary sort: 1/charge item, 2/effective date
"RTN","IBCROI1",42,0)
 N IBXRF,IBITM,IBEFDT,IBCI,IBINDT,IBITEM,IBITEMN I '$G(CS)!'$G(SORT2)!($G(SUB2)="")!($G(BDT)'?7N)!($G(EDT)'?7N) Q
"RTN","IBCROI1",43,0)
 S IBXRF="AIVDTS"_+CS
"RTN","IBCROI1",44,0)
 ;
"RTN","IBCROI1",45,0)
 S IBITM=+$G(IBSELITM) I +IBITM S IBITM=IBITM-.0001
"RTN","IBCROI1",46,0)
 F  S IBITM=$O(^IBA(363.2,IBXRF,IBITM)) Q:'IBITM!(+$G(IBSELITM)&(IBITM'=$G(IBSELITM)))  D
"RTN","IBCROI1",47,0)
 . S IBEFDT=-(EDT+.01) F  S IBEFDT=$O(^IBA(363.2,IBXRF,IBITM,IBEFDT)) Q:'IBEFDT  D
"RTN","IBCROI1",48,0)
 .. S IBCI=0 F  S IBCI=$O(^IBA(363.2,IBXRF,IBITM,IBEFDT,IBCI)) Q:'IBCI  D
"RTN","IBCROI1",49,0)
 ... ;
"RTN","IBCROI1",50,0)
 ... S IBINDT=$$INACTCI^IBCRU4(IBCI) I +IBINDT,IBINDT<BDT Q
"RTN","IBCROI1",51,0)
 ... D TMPLN(IBCI,"IBCROI",SUB2,SORT2)
"RTN","IBCROI1",52,0)
 Q
"RTN","IBCROI1",53,0)
 ;
"RTN","IBCROI1",54,0)
TMPLN(CI,SUB1,SUB2,SORT2) ; add charge item to TMP array
"RTN","IBCROI1",55,0)
 N IBINDT,IBITEM,IBITEMN I '$G(CI)!'$G(SORT2)!($G(SUB1)="")!($G(SUB2)="") Q
"RTN","IBCROI1",56,0)
 S IBINDT=$$INACTCI^IBCRU4(CI)
"RTN","IBCROI1",57,0)
 S IBITEM=$G(^IBA(363.2,+CI,0)) Q:IBITEM=""  ;S $P(IBITEM,U,8)=IBINDT
"RTN","IBCROI1",58,0)
 S IBITEMN=$$EXPAND^IBCRU1(363.2,.01,$P(IBITEM,U,1))_" "
"RTN","IBCROI1",59,0)
 I +$P(IBITEM,U,7) S IBITEMN=IBITEMN_"- "_$P($$MOD^ICPTMOD(+$P(IBITEM,U,7),"I",DT),U,2)
"RTN","IBCROI1",60,0)
 ;
"RTN","IBCROI1",61,0)
 I SORT2=1 S ^TMP($J,SUB1,SUB2,IBITEMN,+$P(IBITEM,U,3),+CI)=IBITEM
"RTN","IBCROI1",62,0)
 I SORT2=2 S ^TMP($J,SUB1,SUB2,+$P(IBITEM,U,3),IBITEMN,+CI)=IBITEM
"RTN","IBCROI1",63,0)
 ;
"RTN","IBCROI1",64,0)
 I SORT2=3 S ^TMP($J,SUB1,IBITEMN,+$P(IBITEM,U,3),SUB2,+CI)=IBITEM
"RTN","IBCROI1",65,0)
 Q
"RTN","IBCROI1",66,0)
 ;
"RTN","IBCROI1",67,0)
TMPHDR(SUB1,SUB2,SUB2IFN,HDR,SORT,BDT,EDT) ; set up top level of the TMP array
"RTN","IBCROI1",68,0)
 I '$G(SORT)!($G(SUB2)="")!($G(SUB1)="") Q
"RTN","IBCROI1",69,0)
 I +$G(BDT) S HDR=$G(HDR)_" "_$$DATE^IBCRU1(BDT) I +$G(EDT) S HDR=HDR_" - "_$$DATE^IBCRU1(EDT)
"RTN","IBCROI1",70,0)
 S ^TMP($J,SUB1)=HDR_U_SORT
"RTN","IBCROI1",71,0)
 S ^TMP($J,SUB1,SUB2)=SUB2IFN
"RTN","IBCROI1",72,0)
 Q
"RTN","IBCROIP")
0^14^B23082380
"RTN","IBCROIP",1,0)
IBCROIP ;ALB/ARH - RATES: REPORTS CHARGE ITEM: PROCEDURES ; 12/01/04
"RTN","IBCROIP",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBCROIP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCROIP",4,0)
 ;
"RTN","IBCROIP",5,0)
EN ; OPTION ENTRY POINT:  Charge Item report for Procedures Only - get parameters then run the report
"RTN","IBCROIP",6,0)
 N RATES,DIVS,CPTS,IBBDT,IBEDT,IBCS,IBCS0,IBSUB,IBQUIT,IBSCRPT
"RTN","IBCROIP",7,0)
 ;
"RTN","IBCROIP",8,0)
 W !!,"Procedure Charge Report: Print charges for selected CPT procedures.",!
"RTN","IBCROIP",9,0)
 ;
"RTN","IBCROIP",10,0)
 D SELRATE(.RATES) Q:'RATES  ;  get billing rates to include
"RTN","IBCROIP",11,0)
 D SELDIVS(.DIVS) Q:DIVS<0  ;   get divisions
"RTN","IBCROIP",12,0)
 D SELCPTS(.CPTS) Q:'CPTS  ;    get list of CPT codes
"RTN","IBCROIP",13,0)
 ;
"RTN","IBCROIP",14,0)
 S IBBDT=$$GETDT^IBCRU1(DT,"Charges effective beginning on") Q:IBBDT'?7N
"RTN","IBCROIP",15,0)
 S IBEDT=$$GETDT^IBCRU1(DT,"Charges effective ending on") Q:IBEDT'?7N
"RTN","IBCROIP",16,0)
 ;
"RTN","IBCROIP",17,0)
 S IBQUIT=0 D DEV I IBQUIT G EXIT
"RTN","IBCROIP",18,0)
 ;
"RTN","IBCROIP",19,0)
RPT ; find, save, and print Charge Item report - entry for tasked jobs  DBIA #2815
"RTN","IBCROIP",20,0)
 ;
"RTN","IBCROIP",21,0)
 K ^TMP($J,"IBCROI") S IBSCRPT="IBCROI"
"RTN","IBCROIP",22,0)
 ;
"RTN","IBCROIP",23,0)
 S IBCS=0 F  S IBCS=$O(^IBE(363.1,IBCS)) Q:'IBCS  D
"RTN","IBCROIP",24,0)
 . S IBCS0=$G(^IBE(363.1,IBCS,0))
"RTN","IBCROIP",25,0)
 . ;
"RTN","IBCROIP",26,0)
 . I '$D(RATES(+$P(IBCS0,U,2))) Q
"RTN","IBCROIP",27,0)
 . I DIVS'=1,+$P(IBCS0,U,7) I '$$CHKDV(+$P(IBCS0,U,7),.DIVS) Q
"RTN","IBCROIP",28,0)
 . ;
"RTN","IBCROIP",29,0)
 . S IBSUB=+$P(IBCS0,U,4)_U_$P(IBCS0,U,1) ; sort by CT and charge set name
"RTN","IBCROIP",30,0)
 . ;
"RTN","IBCROIP",31,0)
 . D GET
"RTN","IBCROIP",32,0)
 ;
"RTN","IBCROIP",33,0)
 D PRINT^IBCROI
"RTN","IBCROIP",34,0)
 ;
"RTN","IBCROIP",35,0)
EXIT D EXIT^IBCROI
"RTN","IBCROIP",36,0)
 Q
"RTN","IBCROIP",37,0)
 ;
"RTN","IBCROIP",38,0)
 ;
"RTN","IBCROIP",39,0)
GET ; get charge items for selected procedures
"RTN","IBCROIP",40,0)
 N IBCPTS,IBC1,IBC2,IBCFIRST,IBCLAST,IBCNEXT,IBCIFN
"RTN","IBCROIP",41,0)
 ;
"RTN","IBCROIP",42,0)
 S IBCPTS="" F  S IBCPTS=$O(CPTS(IBCPTS)) Q:IBCPTS=""  D
"RTN","IBCROIP",43,0)
 . I IBCPTS'?5UN1"-"5UN Q
"RTN","IBCROIP",44,0)
 . S IBC1=$P(IBCPTS,"-",1),IBCFIRST=$O(^ICPT("B",IBC1),-1)
"RTN","IBCROIP",45,0)
 . S IBC2=$P(IBCPTS,"-",2),IBCLAST=$O(^ICPT("B",IBC2))
"RTN","IBCROIP",46,0)
 . ;
"RTN","IBCROIP",47,0)
 . S IBCNEXT=IBCFIRST F  S IBCNEXT=$O(^ICPT("B",IBCNEXT)) Q:(IBCNEXT="")!(IBCNEXT=IBCLAST)  D
"RTN","IBCROIP",48,0)
 .. S IBCIFN=$O(^ICPT("B",IBCNEXT,0))
"RTN","IBCROIP",49,0)
 .. ;
"RTN","IBCROIP",50,0)
 .. D SRCHITM^IBCROI1(IBCS,IBSUB,3,IBBDT,IBEDT,IBCIFN)
"RTN","IBCROIP",51,0)
 . ;
"RTN","IBCROIP",52,0)
 . D TMPHDR^IBCROI1(IBSCRPT,IBSUB,0,"Procedure Charges","1^1",IBBDT,IBEDT)
"RTN","IBCROIP",53,0)
 Q
"RTN","IBCROIP",54,0)
 ;
"RTN","IBCROIP",55,0)
CHKDV(RG,DIVS) ; check if Region contains a selected division (where DIVS is array of divisions)
"RTN","IBCROIP",56,0)
 N IBDV,IBSEL S IBSEL=0
"RTN","IBCROIP",57,0)
 I +$O(^IBE(363.31,+$G(RG),11,"B",0)) S IBDV=0 F  S IBDV=$O(DIVS(IBDV)) Q:'IBDV  D  Q:+IBSEL
"RTN","IBCROIP",58,0)
 . I +$O(^IBE(363.31,RG,11,"B",IBDV,0)) S IBSEL=1
"RTN","IBCROIP",59,0)
 Q IBSEL
"RTN","IBCROIP",60,0)
 ;
"RTN","IBCROIP",61,0)
SELRATE(RATES) ; get rates to review, RATES(ptr to 363.3)=Billing Rate Name returned, or RATES=0 if none selected
"RTN","IBCROIP",62,0)
 N IBN,IBX,IBY,IBCNT,IBDFLT,IBARR,DIR,DIRUT,DTOUT,DUOUT,X,Y K RATES S RATES=0
"RTN","IBCROIP",63,0)
 ;
"RTN","IBCROIP",64,0)
 S IBN="" F  S IBN=$O(^IBE(363.3,"B",IBN)) Q:IBN=""  D
"RTN","IBCROIP",65,0)
 . S IBX=0 F  S IBX=$O(^IBE(363.3,"B",IBN,IBX)) Q:'IBX  D
"RTN","IBCROIP",66,0)
 .. S IBY=$G(^IBE(363.3,IBX,0)) I $P(IBY,U,4)'=2 Q
"RTN","IBCROIP",67,0)
 .. S IBCNT=$G(IBCNT)+1
"RTN","IBCROIP",68,0)
 .. ;
"RTN","IBCROIP",69,0)
 .. I $E(IBY,1,3)="RC " S IBDFLT=$G(IBDFLT)_IBCNT_","
"RTN","IBCROIP",70,0)
 .. S IBARR(IBCNT)=IBX_U_IBN,IBARR=IBCNT
"RTN","IBCROIP",71,0)
 ;
"RTN","IBCROIP",72,0)
 W !,"Select Charge Billing Rates:"
"RTN","IBCROIP",73,0)
 S IBCNT=0  F  S IBCNT=$O(IBARR(IBCNT)) Q:'IBCNT  W !,?10,IBCNT," - ",$P(IBARR(IBCNT),U,2)
"RTN","IBCROIP",74,0)
 ;
"RTN","IBCROIP",75,0)
 S DIR(0)="LO^1:"_IBARR_":0",DIR("A")="Charge Rates",DIR("B")=IBDFLT D ^DIR Q:$$QUIT
"RTN","IBCROIP",76,0)
 ;
"RTN","IBCROIP",77,0)
 F IBX=1:1:20 S IBCNT=$P(Y,",",IBX) Q:'IBCNT  S IBY=IBARR(IBCNT),RATES=$G(RATES)+1,RATES(+IBY)=$P(IBY,U,2)
"RTN","IBCROIP",78,0)
 ;
"RTN","IBCROIP",79,0)
 Q
"RTN","IBCROIP",80,0)
 ;
"RTN","IBCROIP",81,0)
SELDIVS(VAUTD) ; Issue prompt for Division (ALL: VAUTD=1,  SELECT: VAUTD=0, VAUTD(DV ptr)=DV Name, ELSE: VAUTD=-1)
"RTN","IBCROIP",82,0)
 N Y D PSDR^IBODIV I Y<0 K VAUTD S VAUTD=-1
"RTN","IBCROIP",83,0)
 Q
"RTN","IBCROIP",84,0)
 ;
"RTN","IBCROIP",85,0)
SELCPTS(CPTS) ; Select CPT Codes, returned in array ranges separated by dash, external form, or CPTS=0 if none selected
"RTN","IBCROIP",86,0)
 ; will only allow ranges with matching first character because of length
"RTN","IBCROIP",87,0)
 N IBI,IBCOD,IBCOD1,IBCOD2,DIC,DIR,DIRUT,DTOUT,DUOUT,X,Y K CPTS S CPTS=0
"RTN","IBCROIP",88,0)
 ;
"RTN","IBCROIP",89,0)
 S DIR("?")="Enter a CPT/HCPCS code or range of codes separated by a dash"
"RTN","IBCROIP",90,0)
 S DIR("A")="Select CPT/HPCS Codes",DIR(0)="FO^^"
"RTN","IBCROIP",91,0)
 ;
"RTN","IBCROIP",92,0)
 F IBI=1:1 D ^DIR Q:$$QUIT  D
"RTN","IBCROIP",93,0)
 . S IBCOD=$$UP^XLFSTR(Y),IBCOD1=$P(IBCOD,"-",1),IBCOD2=$P(IBCOD,"-",2)
"RTN","IBCROIP",94,0)
 . ;
"RTN","IBCROIP",95,0)
 . I IBCOD["-" S IBCOD1=$$LJ^XLFSTR(IBCOD1,5,0),IBCOD2=$$LJ^XLFSTR(IBCOD2,5,0)
"RTN","IBCROIP",96,0)
 . I IBCOD'["-" S IBCOD1=$P($$CPTDIC(IBCOD),U,2),IBCOD2=IBCOD1 I IBCOD1="" W ?36,"??" Q
"RTN","IBCROIP",97,0)
 . ;
"RTN","IBCROIP",98,0)
 . I (IBCOD1'?5UN)!(IBCOD2'?5UN) W ?36,"??" Q
"RTN","IBCROIP",99,0)
 . I IBCOD1'=IBCOD2,IBCOD2']IBCOD1 W ?36,IBCOD1,"-",IBCOD2," Invalid Range" Q
"RTN","IBCROIP",100,0)
 . I $E(IBCOD1,1)'=$E(IBCOD2,1) W ?36,"Range too large, first character must match" Q
"RTN","IBCROIP",101,0)
 . ;
"RTN","IBCROIP",102,0)
 . S IBCOD=IBCOD1_"-"_IBCOD2 S CPTS=$G(CPTS)+1,CPTS(IBCOD)=""
"RTN","IBCROIP",103,0)
 ;
"RTN","IBCROIP",104,0)
 Q
"RTN","IBCROIP",105,0)
 ;
"RTN","IBCROIP",106,0)
CPTDIC(CODE) ; inquiry on CPT code, returns null or 'internal^external'
"RTN","IBCROIP",107,0)
 N IBX,DIC,DUOUT,DTOUT,I,X,Y S IBX="" I $G(CODE)'="" S X=CODE,DIC="^ICPT(",DIC(0)="EM" D ^DIC I Y>1 S IBX=Y
"RTN","IBCROIP",108,0)
 Q IBX
"RTN","IBCROIP",109,0)
 ;
"RTN","IBCROIP",110,0)
 ;
"RTN","IBCROIP",111,0)
QUIT() N IBX S IBX=0 I ($G(Y)="")!($D(DIRUT))!($D(DUOUT))!($D(DTOUT)) S IBX=1
"RTN","IBCROIP",112,0)
 Q IBX
"RTN","IBCROIP",113,0)
 ;
"RTN","IBCROIP",114,0)
DEV ; get device
"RTN","IBCROIP",115,0)
 S IBQUIT=0 S %ZIS="QM",%ZIS("A")="OUTPUT DEVICE: " D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBCROIP",116,0)
 I $D(IO("Q")) S ZTRTN="RPT^IBCROIP",ZTDESC="Charge Procedure Report",ZTSAVE("IB*")="",ZTSAVE("RATES(")="",ZTSAVE("CPTS(")="",ZTSAVE("DIVS(")="",ZTSAVE("DIVS")="" D ^%ZTLOAD K IO("Q") S IBQUIT=1
"RTN","IBCROIP",117,0)
 Q
"RTN","IBCROR")
0^15^B14535382
"RTN","IBCROR",1,0)
IBCROR ;ALB/ARH - RATES: REPORTS ; 5/23/96
"RTN","IBCROR",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,287**;21-MAR-94
"RTN","IBCROR",3,0)
 ;
"RTN","IBCROR",4,0)
 ;
"RTN","IBCROR",5,0)
OPTION ;
"RTN","IBCROR",6,0)
 W !!!,"Charge Master Reports:",!
"RTN","IBCROR",7,0)
 S DIR(0)="SO^R:RATE SCHEDULES;C:CHARGE SETS;I:CHARGE ITEMS;IP:CHARGE ITEMS - PROCEDURES;B:BILLING RATES;T:RATE TYPES;G:BILLING REGIONS;V:REV CD LINKS;D:PROVIDER DISCOUNTS;O:OTHER BILLABLE ITEMS;X:(OLD RATES FILE)"
"RTN","IBCROR",8,0)
 S DIR("A")="Select Report" D ^DIR K DIR
"RTN","IBCROR",9,0)
 I Y="R" D RS G OPTION
"RTN","IBCROR",10,0)
 I Y="C" D CS G OPTION
"RTN","IBCROR",11,0)
 I Y="I" D CI G OPTION
"RTN","IBCROR",12,0)
 I Y="IP" D CIP G OPTION
"RTN","IBCROR",13,0)
 I Y="B" D BR G OPTION
"RTN","IBCROR",14,0)
 I Y="T" D RT G OPTION
"RTN","IBCROR",15,0)
 I Y="G" D RG G OPTION
"RTN","IBCROR",16,0)
 I Y="V" D RL G OPTION
"RTN","IBCROR",17,0)
 I Y="D" D PD G OPTION
"RTN","IBCROR",18,0)
 I Y="O" D BI G OPTION
"RTN","IBCROR",19,0)
 I Y="X" D OLD G OPTION
"RTN","IBCROR",20,0)
 K DIR,X,Y,DIRUT
"RTN","IBCROR",21,0)
 Q
"RTN","IBCROR",22,0)
RS ;
"RTN","IBCROR",23,0)
 W !,"Report requires 120 columns."
"RTN","IBCROR",24,0)
 S FLDS=".01,.03;L5,.04;L10;""BILL SERVICE"",.05,.06,W:$$RSADJ^IBCROR($G(D0)) ""YES"";""CHARGES ADJUSTED"";L10,11,.01,.02"
"RTN","IBCROR",25,0)
 S L=0,DIC="^IBE(363,",BY=".02;S1,.03"
"RTN","IBCROR",26,0)
 D EN1^DIP
"RTN","IBCROR",27,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",28,0)
 Q
"RTN","IBCROR",29,0)
CS ;
"RTN","IBCROR",30,0)
 W !,"Report requires 132 columns."
"RTN","IBCROR",31,0)
 S L=0,DIC="^IBE(363.1,",FLDS=".01,.03;L26,.04,.05,.06;L15,.07",BY=".02;S1,.03",FR="",TO=""
"RTN","IBCROR",32,0)
 D EN1^DIP
"RTN","IBCROR",33,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",34,0)
 Q
"RTN","IBCROR",35,0)
CI ;
"RTN","IBCROR",36,0)
 ;
"RTN","IBCROR",37,0)
 W !!,"Caution: This report may be extremely long for some Charge Sets.",!,"Some Charge Sets, such as CMAC or AWP, may have many thousands of Charge Items.",!
"RTN","IBCROR",38,0)
 ;
"RTN","IBCROR",39,0)
 D ^IBCROI
"RTN","IBCROR",40,0)
 Q
"RTN","IBCROR",41,0)
CIP ;
"RTN","IBCROR",42,0)
 ;
"RTN","IBCROR",43,0)
 W !!,"Caution: This report may be extremely long if many procedures are selected.",!
"RTN","IBCROR",44,0)
 ;
"RTN","IBCROR",45,0)
 D ^IBCROIP
"RTN","IBCROR",46,0)
 Q
"RTN","IBCROR",47,0)
BR ;
"RTN","IBCROR",48,0)
 S L=0,DIC="^IBE(363.3,",FLDS=".01,.02,.03,.04,.05",BY=".03;S1,.01",FR="",TO=""
"RTN","IBCROR",49,0)
 D EN1^DIP
"RTN","IBCROR",50,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",51,0)
 Q
"RTN","IBCROR",52,0)
RT ;
"RTN","IBCROR",53,0)
 W !,"Report requires 132 columns."
"RTN","IBCROR",54,0)
 S FLDS=".01;L20,.02;L20,.03;L5,.04;L8,.05;L5;""THIRD PARTY BILL?"",.06;L20,.07;L11,.08;L5;""REIMB INS?"",.09;L4"
"RTN","IBCROR",55,0)
 S L=0,DIC="^DGCR(399.3,",BY="",FR="",TO=""
"RTN","IBCROR",56,0)
 D EN1^DIP
"RTN","IBCROR",57,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",58,0)
 Q
"RTN","IBCROR",59,0)
RG ;
"RTN","IBCROR",60,0)
 S L=0,DIC="^IBE(363.31,",FLDS=".01,11,.01,",BY=".01;S1",(FR,TO)=""
"RTN","IBCROR",61,0)
 D EN1^DIP
"RTN","IBCROR",62,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",63,0)
 Q
"RTN","IBCROR",64,0)
BI ;
"RTN","IBCROR",65,0)
 S L=0,DIC="^IBA(363.21,",FLDS=".01,.02,",BY=".02;S1,.01"
"RTN","IBCROR",66,0)
 D EN1^DIP
"RTN","IBCROR",67,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",68,0)
 Q
"RTN","IBCROR",69,0)
RL ;
"RTN","IBCROR",70,0)
 N IBX,DIR,X,Y,DTOUT,DUOUT,DIRUT
"RTN","IBCROR",71,0)
 S DIR(0)="SO^1:SORT BY REVENUE CODE;2:SORT BY PROCEDURE" D ^DIR Q:Y'>0
"RTN","IBCROR",72,0)
 I Y=1 S L=0,DIC="^IBE(363.33,",FLDS=".01,.03,.04,.02",BY=".01,.02"
"RTN","IBCROR",73,0)
 I Y=2 S L=0,DIC="^IBE(363.33,",FLDS=".03,.04,.01,.02",BY=".03;TXT,.02",(FR,TO)=",?"
"RTN","IBCROR",74,0)
 D EN1^DIP
"RTN","IBCROR",75,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",76,0)
 Q
"RTN","IBCROR",77,0)
 ;
"RTN","IBCROR",78,0)
PD ;
"RTN","IBCROR",79,0)
 D ^IBCRON
"RTN","IBCROR",80,0)
 Q
"RTN","IBCROR",81,0)
 ;
"RTN","IBCROR",82,0)
OLD ;  prints old rates in 399.5, provided for reference only
"RTN","IBCROR",83,0)
 ; (these rates are no longer used and the orginal report (IBORAT2) was deleted)
"RTN","IBCROR",84,0)
 W !!,"This report is for reference only, the rates and charges in this report are no",!,"longer used.  They have been replace by the rates in the Charge Master.",!
"RTN","IBCROR",85,0)
 S L=0,DIC="^DGCR(399.5,",FLDS=".01,.04,"" "";"""",.03,.05;L3,.06,.07",BY=".02;S1,.01;S1,.06,.03",FR=",?",TO=",?"
"RTN","IBCROR",86,0)
 D EN1^DIP
"RTN","IBCROR",87,0)
 K FLDS,BY,FR,TO,L,DIC
"RTN","IBCROR",88,0)
 Q
"RTN","IBCROR",89,0)
 ;
"RTN","IBCROR",90,0)
RSADJ(D0) ; returns true if RS has an Adjustment
"RTN","IBCROR",91,0)
 N IBX S IBX=0 I $G(^IBE(363,+$G(D0),10))'="" S IBX=1
"RTN","IBCROR",92,0)
 Q IBX
"RTN","IBCSC4")
0^2^B23401431
"RTN","IBCSC4",1,0)
IBCSC4 ;ALB/MJB - MCCR SCREEN 4 (INPT. EOC) ;27 MAY 88 10:17
"RTN","IBCSC4",2,0)
 ;;2.0;INTEGRATED BILLING;**52,51,210,245,155,287**;21-MAR-94
"RTN","IBCSC4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC4",4,0)
 ;
"RTN","IBCSC4",5,0)
 ;MAP TO DGCRSC4
"RTN","IBCSC4",6,0)
 ;
"RTN","IBCSC4",7,0)
EN I $P(^DGCR(399,IBIFN,0),"^",5)>2 G EN^IBCSC5
"RTN","IBCSC4",8,0)
 I $D(IBASKCOD) K IBASKCOD D CODMUL^IBCU7 I $$BILLCPT^IBCRU4(IBIFN) D ASK^IBCU7A(IBIFN) S DGRVRCAL=1
"RTN","IBCSC4",9,0)
 I $D(DGRVRCAL) D ^IBCU6 K DGRVRCAL
"RTN","IBCSC4",10,0)
 L ^DGCR(399,IBIFN):1
"RTN","IBCSC4",11,0)
 D ^IBCSCU S IBSR=4,IBSR1="",IBV1="0000000"_$S($$FT^IBCEF(IBIFN)'=2:0,1:1),IBUC="UNSPECIFIED CODE"
"RTN","IBCSC4",12,0)
 S:IBV IBV1="11111111"
"RTN","IBCSC4",13,0)
 D H^IBCSCU F I=1:1:4 S Y="Q"_I_"^IBCVA" D @Y
"RTN","IBCSC4",14,0)
 D INP
"RTN","IBCSC4",15,0)
 S IBBT=$P(IB(0),"^",4)_$P(IB(0),"^",5)_$P(IB(0),"^",6)
"RTN","IBCSC4",16,0)
 D:DGPT(0)]"" DX^IBCSC4A D OCC^IBCVA1
"RTN","IBCSC4",17,0)
 I '$P(DGPT(0),U,6) W !?26,$S('DGPT(0):"No PTF record for this ADMISSION",1:"PTF record status: OPEN")
"RTN","IBCSC4",18,0)
 S J=$P(IB("U"),U,20),J=$S(J=99:"",J="":"",$L(J)=1:".0"_J,1:"."_J)
"RTN","IBCSC4",19,0)
 S Z=1 X IBWW W " Admission  : " S I=$S($P(DGPT(0),U,2)]"":$P(DGPT(0),U,2),1:$P(IBIP,U,2)_J) S:$P(I,".",2)=""&I $P(I,".",2)="2400"
"RTN","IBCSC4",20,0)
 S Y=$$FMTE^XLFDT(I,"1P")
"RTN","IBCSC4",21,0)
 W Y,?49,"Accident Hour: ",$S($P(IB("U"),U,10)=99:IBU,$P(IB("U"),U,10)'="":$P(IB("U"),U,10),1:IBU)
"RTN","IBCSC4",22,0)
 W !?4,"Source     : " S I=$P(^DD(399,159,0),U,3),I=$P($P(I,";",($P(IB("U"),U,9))),":",2) W I
"RTN","IBCSC4",23,0)
 W ?58,"Type: ",$S($P(IB("U"),U,8)=3:"ELECTIVE",$P(IB("U"),U,8)=1:"EMERGENCY",$P(IB("U"),U,8)=2:"URGENT",1:IBU)
"RTN","IBCSC4",24,0)
 D OT
"RTN","IBCSC4",25,0)
 S Z=2 X IBWW
"RTN","IBCSC4",26,0)
 W " Discharge  : " S Y=$S($P(IBIP,U,6)>0:$P(IBIP,U,6),1:"") X ^DD("DD") W $S(Y]"":Y,1:IBU)
"RTN","IBCSC4",27,0)
 W !?4,"Status     : ",$S($P(IB("U"),U,12)]""&($D(^DGCR(399.1,(+$P(IB("U"),"^",12)),0))):$P(^(0),"^",1),1:IBU)
"RTN","IBCSC4",28,0)
 N IBPOARR,IBDATE
"RTN","IBCSC4",29,0)
 D SET^IBCSC4D(IBIFN,"",.IBPOARR)
"RTN","IBCSC4",30,0)
 S IBDATE=$$BDATE^IBACSV(+$G(IBIFN)) ; The EVENT DATE of the bill
"RTN","IBCSC4",31,0)
 S Z=3,IBW=1 X IBWW W " Prin. Diag.: " S Y=$$DX(0,IBDATE) W $S(Y'="":$P(Y,U,4)_" - "_$P(Y,U,2),$$DXREQ(IBIFN):IBU,1:IBUN)
"RTN","IBCSC4",32,0)
 F I=1:1:4 S Y=$$DX(+Y,IBDATE) Q:Y=""  W !?4,"Other Diag.: ",$P(Y,U,4)_" - "_$P(Y,U,2)
"RTN","IBCSC4",33,0)
 I +Y S Y=$$DX(+Y,IBDATE) I +Y W !?4,"***There are more diagnoses associated with this bill.***"
"RTN","IBCSC4",34,0)
 ;F I=15:1:18 I $P(IB("C"),U,I)]"" W !?4,"Other Diag.: ",$S($D(^ICD9($P(IB("C"),U,I),0)):$P(^(0),U,3)_" - "_$P(^(0),U,1),1:IBU)
"RTN","IBCSC4",35,0)
 S Z=4,IBW=1,DGPCM=$P(IB(0),U,9) X IBWW W " Cod. Method: ",$S(DGPCM="":IBUN,DGPCM=9:"ICD-9-CM",DGPCM=4:"CPT-4",1:"HCPCS")
"RTN","IBCSC4",36,0)
 D:$D(IBPROC) WRT^IBCSC5
"RTN","IBCSC4",37,0)
 ;I DGPCM="" W !?4,"Pro. Code  : ",IBUN G OCC
"RTN","IBCSC4",38,0)
 ;I $D(IBCPT),DGPCM=4 F I=1:1:3 I $D(IBCPT(I)) W !?4,"CPT Code   : ",$P(^ICPT(IBCPT(I),0),U,2)," - ",$P(^(0),U),?55,"Date: " S Y=$P(IB("C"),U,(I+10)) D DT^DIQ
"RTN","IBCSC4",39,0)
 ;I DGPCM=4 W:'$D(IBCPT) !?4,"Pro. Code  : ",IBUN G OCC
"RTN","IBCSC4",40,0)
 ;I $D(IBICD),DGPCM=9 F I=4:1:6 I $D(IBICD(I)) W !?4,"ICD Code   : ",$S($D(^ICD0(IBICD(I),0)):$E($P(^(0),U,4),1,20)_" - "_$P(^(0),U,1),1:IBUC),?55,"Date: " S Y=$P(IB("C"),U,(I+7)) D DT^DIQ
"RTN","IBCSC4",41,0)
 ;I DGPCM=9 W:'$D(IBICD) !?4,"Pro. Code  : ",IBUN G OCC
"RTN","IBCSC4",42,0)
 ;I $D(IBHC),DGPCM=5 F I=7:1:9 I $D(IBHC(I)) W !?4,"HCFA Code  : ",$P(^ICPT(IBHC(I),0),U,2)," - ",IBHCN(I),?55,"Date: " S Y=$P(IB("C"),U,(I+4)) D DT^DIQ
"RTN","IBCSC4",43,0)
 ;I DGPCM=5 W:'$D(IBHC) !?4,"Pro. Code  : ",IBUN
"RTN","IBCSC4",44,0)
OCC ;I $O(^DGCR(399,IBIFN,"CP",0)) S I=0 F I1=1:1 S I=$O(^DGCR(399,IBIFN,"CP",I)) D:I1>9 MORE Q:'I  W !,?17 S Y=$P(^(I,0),"^",2) D:+Y D^DIQ D OCC1
"RTN","IBCSC4",45,0)
 S Z=$S($P(IB(0),U,5)<3:5,1:6)
"RTN","IBCSC4",46,0)
 S IBW=1 X IBWW W " Pros. Items: " S Y=$$PD^IBCSC5 I 'Y W IBUN
"RTN","IBCSC4",47,0)
 S Z=$S($P(IB(0),U,5)<3:6,1:7) X IBWW
"RTN","IBCSC4",48,0)
 W " Occ. Code  : " F I=1:1:5 I $D(IBO(I)) W:I>1 !?4,"Occ. Code  : ",$E(IBOCN(I),1,27) W:I=1 $E(IBOCN(I),1,27) S Y=IBOCD(I) X ^DD("DD") W ?55,Y S Y=IBOCD2(I) I +Y X ^DD("DD") W " - ",Y
"RTN","IBCSC4",49,0)
 I '$D(IBO) W IBUN
"RTN","IBCSC4",50,0)
 I $D(IBO)=1,IBO="" W IBUN
"RTN","IBCSC4",51,0)
 S Z=$S($P(IB(0),U,5)<3:7,1:8) X IBWW
"RTN","IBCSC4",52,0)
 W " Cond. Code : " F I=1:1:5 I $D(IBCC(I)) W:I>1 !?4,"Cond. Code : ",IBCCN(I) W:I=1 IBCCN(I)
"RTN","IBCSC4",53,0)
 I '$D(IBCC) W IBUN
"RTN","IBCSC4",54,0)
 I $D(IBCC)=1,IBCC="" W IBUN
"RTN","IBCSC4",55,0)
 S Z=$S($P(IB(0),U,5)<3:8,1:9)
"RTN","IBCSC4",56,0)
 X IBWW W " Value Code : " S IBVC=0
"RTN","IBCSC4",57,0)
 I $$FT^IBCEF(IBIFN)'=2 D
"RTN","IBCSC4",58,0)
 . D VC^IBCVA1 I +IBVC S J=1,I=0 F  S I=$O(IBVC(I)) Q:'I  W:J>1 !,?3," Value Code : " W ?17,$E($P(IBVC(I),U,2),1,40),?58,$P(IBVC(I),U,3) S J=J+1
"RTN","IBCSC4",59,0)
 W:'IBVC IBUN K IBVC
"RTN","IBCSC4",60,0)
 D Q^IBCSC4B G ^IBCSCP
"RTN","IBCSC4",61,0)
 Q
"RTN","IBCSC4",62,0)
OCC1 W $P(^DGCR(399,IBIFN,"CP",I,0),"^",3)_" - "_$P($$PRCD^IBCEF1($P(^DGCR(399,IBIFN,"CP",I,0),U)),U),?55,"Date: ",Y
"RTN","IBCSC4",63,0)
 Q
"RTN","IBCSC4",64,0)
 ;IBIP= PTF ptr (399,.08) ^ PTF admiss dt (45,2) or Event dt (399,.03)^ accident hour (399,160) 
"RTN","IBCSC4",65,0)
 ; ^ source of addmis (399,159) ^ typ of addmiss (399,158)
"RTN","IBCSC4",66,0)
 ; ^ PTF disch dt (45,70) or Non-VA disch dt (399,.16) ^ disch status (399,162)
"RTN","IBCSC4",67,0)
 ; ^ dxls (45,79) ^ disch bedsection (399,161)
"RTN","IBCSC4",68,0)
INP F I="C","U",0 S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCSC4",69,0)
 S IBPTF=$P(IB(0),U,8) F I=0,70 S DGPT(I)=$S(IBPTF="":"",$D(^DGPT(IBPTF,I)):^(I),1:"")
"RTN","IBCSC4",70,0)
 F I="C","U",0 S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCSC4",71,0)
 S IBIP=IBPTF_"^"_$S($P(DGPT(0),"^",2)]"":$P(DGPT(0),"^",2),1:$P(IB(0),"^",3))_"^"_$P(IB("U"),"^",10)_"^"_$P(IB("U"),"^",9)_"^"_$P(IB("U"),"^",8)_"^"_$S(+DGPT(70)>0:+DGPT(70),1:$P(IB(0),"^",16))_"^"
"RTN","IBCSC4",72,0)
 S IBIP=IBIP_$P(IB("U"),"^",12)_"^"_$S($D(DGPT(70)):$P(DGPT(70),"^",10),1:"")_"^"_$P(IB("U"),"^",11)
"RTN","IBCSC4",73,0)
 Q
"RTN","IBCSC4",74,0)
SET ;S ^DD(399.0304,0,"ID","WRITE")="N X S X=^(0) W ""   "",$E($P($G(@(U_$P($P(X,U),"";"",2)_+X_"",0)"")),U,$S($P(X,U,1)[""CPT"":2,1:4)),1,30)"
"RTN","IBCSC4",75,0)
 Q
"RTN","IBCSC4",76,0)
 ;
"RTN","IBCSC4",77,0)
DX(ORDER,IBDATE) ; Get next diagnosis data
"RTN","IBCSC4",78,0)
 N IBX
"RTN","IBCSC4",79,0)
 S IBX=""
"RTN","IBCSC4",80,0)
 S ORDER=$O(IBPOARR(ORDER))
"RTN","IBCSC4",81,0)
 I ORDER S IBX=ORDER_U_$$ICD9^IBACSV(+IBPOARR(ORDER),$G(IBDATE))
"RTN","IBCSC4",82,0)
 Q IBX
"RTN","IBCSC4",83,0)
 ;
"RTN","IBCSC4",84,0)
OT ; print Other Care (SNF) multiple
"RTN","IBCSC4",85,0)
 N IBX,IBY,IBN I '$O(^DGCR(399,IBIFN,"OT",0)) W !,?4,"SNF Care   : UNSPECIFIED [NOT REQUIRED]"
"RTN","IBCSC4",86,0)
 S IBX=0 F  S IBX=$O(^DGCR(399,IBIFN,"OT",IBX)) Q:'IBX  D
"RTN","IBCSC4",87,0)
 . S IBY=$G(^DGCR(399,IBIFN,"OT",IBX,0)) Q:'IBY
"RTN","IBCSC4",88,0)
 . S IBN=$P($G(^DGCR(399.1,+IBY,0)),U,1),IBN=$S(IBN["SKILLED":"SNF Care ",IBN["SUB-ACUTE":"Sub-Acute",1:"Unknown  ")
"RTN","IBCSC4",89,0)
 . W !,?4,IBN,"  : ",$$FMTE^XLFDT(+$P(IBY,U,2))," - ",$$FMTE^XLFDT(+$P(IBY,U,3))
"RTN","IBCSC4",90,0)
 Q
"RTN","IBCSC4",91,0)
 ;
"RTN","IBCSC4",92,0)
DXREQ(IBIFN) ; Is the principle diagnosis code required or not?
"RTN","IBCSC4",93,0)
 ; Function returns true (1) if DX is required for this bill, otherwise 0
"RTN","IBCSC4",94,0)
 NEW REQ,IBFT
"RTN","IBCSC4",95,0)
 S REQ=0,IBFT=$$FT^IBCEF(IBIFN)
"RTN","IBCSC4",96,0)
 I IBFT=2 S REQ=1 G DXREQX                            ; required for HCFA-1500
"RTN","IBCSC4",97,0)
 I IBFT=3,$$WNRBILL^IBEFUNC(IBIFN) S REQ=1 G DXREQX   ; UB92 with Medicare (WNR) current payer
"RTN","IBCSC4",98,0)
DXREQX ;
"RTN","IBCSC4",99,0)
 Q REQ
"RTN","IBCSC4",100,0)
 ;
"RTN","IBCSC4",101,0)
 ;IBCSC4
"RTN","IBCSC5")
0^16^B17725585
"RTN","IBCSC5",1,0)
IBCSC5 ;ALB/MJB - MCCR SCREEN 5 (OPT. EOC) ;27 MAY 88 10:15
"RTN","IBCSC5",2,0)
 ;;2.0;INTEGRATED BILLING;**52,125,51,210,266,288,287**;21-MAR-94
"RTN","IBCSC5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC5",4,0)
 ;
"RTN","IBCSC5",5,0)
 ;MAP TO DGCRSC5
"RTN","IBCSC5",6,0)
 ;
"RTN","IBCSC5",7,0)
EN I $$INPAT^IBCEF(IBIFN) G ^IBCSC4
"RTN","IBCSC5",8,0)
 I $D(IBASKCOD) K IBASKCOD D CODMUL^IBCU7 I $$BILLCPT^IBCRU4(IBIFN) D ASK^IBCU7A(IBIFN) S DGRVRCAL=1
"RTN","IBCSC5",9,0)
 I $D(DGRVRCAL) D ^IBCU6 K DGRVRCAL
"RTN","IBCSC5",10,0)
 L ^DGCR(399,IBIFN):1
"RTN","IBCSC5",11,0)
 D ^IBCSCU S IBSR=5,IBSR1="",IBV1="10000000"_$S($$FT^IBCEF(IBIFN)'=2:0,1:1) F I="U",0 S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"") S:IBV IBV1="111111111"
"RTN","IBCSC5",12,0)
 D H^IBCSCU
"RTN","IBCSC5",13,0)
 S IBPTF=$P(IB(0),U,8),IBBT=$P(IB(0),"^",4)_$P(IB(0),"^",5)_$P(IB(0),"^",6)
"RTN","IBCSC5",14,0)
 D EN4^IBCVA1
"RTN","IBCSC5",15,0)
 S Z=1,IBW=1 X IBWW W " Event Date : " S Y=$P(IB(0),U,3) D DT^DIQ
"RTN","IBCSC5",16,0)
 N IBPOARR,IBDATE
"RTN","IBCSC5",17,0)
 D SET^IBCSC4D(IBIFN,"",.IBPOARR)
"RTN","IBCSC5",18,0)
 S IBDATE=$$BDATE^IBACSV(IBIFN) ; Event date
"RTN","IBCSC5",19,0)
 S Z=2,IBW=1 X IBWW W " Prin. Diag.: " S Y=$$DX^IBCSC4(0,IBDATE) W $S(Y'="":$P(Y,U,4)_" - "_$P(Y,U,2),$$DXREQ^IBCSC4(IBIFN):IBU,1:IBUN)
"RTN","IBCSC5",20,0)
 F I=1:1:4 S Y=$$DX^IBCSC4(+Y,IBDATE) Q:Y=""  W !?4,"Other Diag.: ",$P(Y,U,4)_" - "_$P(Y,U,2)
"RTN","IBCSC5",21,0)
 I +Y S Y=$$DX^IBCSC4(+Y,IBDATE) I +Y W !?4,"***There are more diagnoses associated with this bill.***"
"RTN","IBCSC5",22,0)
OP S Z=3,IBW=1 X IBWW W " OP Visits  : " F I=0:0 S I=$O(^DGCR(399,IBIFN,"OP",I)) Q:'I  S Y=I X ^DD("DD") W:$X>67 !?17 W Y_", "
"RTN","IBCSC5",23,0)
 S:$D(^DGCR(399,"OP")) DGOPV=1 I '$O(^DGCR(399,IBIFN,"OP",0)) W IBU
"RTN","IBCSC5",24,0)
 S Z=4,IBW=1 X IBWW W " Cod. Method: ",$S($P(IB(0),U,9)="":IBUN,$P(IB(0),U,9)=9:"ICD-9-CM",$P(IB(0),U,9)=4:"CPT-4",1:"HCPCS")
"RTN","IBCSC5",25,0)
 D WRT:$D(IBPROC)
"RTN","IBCSC5",26,0)
 S Z=5,IBW=1 X IBWW W " Rx. Refills: " S Y=$$RX I 'Y W IBUN
"RTN","IBCSC5",27,0)
OCC G OCC^IBCSC4
"RTN","IBCSC5",28,0)
 W !?4,"Opt. Code  : ",IBUN
"RTN","IBCSC5",29,0)
 G OCC^IBCSC4
"RTN","IBCSC5",30,0)
 Q
"RTN","IBCSC5",31,0)
MORE W !?4,*7,"***There are more procedures associated with this bill.***" S I=0
"RTN","IBCSC5",32,0)
 Q
"RTN","IBCSC5",33,0)
WRT ;  -write out procedures codes on screen
"RTN","IBCSC5",34,0)
 N IBDATE
"RTN","IBCSC5",35,0)
 S J=0 F I=1:1 S J=$O(IBPROC(J)) Q:'J  D  I I>6 D MORE Q
"RTN","IBCSC5",36,0)
 .S IBDATE=$P(IBPROC(J),U,2) I 'IBDATE S IBDATE=$$BDATE^IBACSV($G(IBIFN))
"RTN","IBCSC5",37,0)
 .S X=$$PRCD^IBCEF1($P(IBPROC(J),U),1,IBDATE)
"RTN","IBCSC5",38,0)
 .I IBPROC(J)["ICD" W !?4,"ICD Code   : ",$E($P(X,U,3),1,28)_" - "_$P(X,U,2)
"RTN","IBCSC5",39,0)
 .I IBPROC(J)["CPT" W !?4,"CPT Code   : " D
"RTN","IBCSC5",40,0)
 .. N Z
"RTN","IBCSC5",41,0)
 .. S Z=$P(X,"^",3)_" "_$P(X,"^",2)_$S($P(IBPROC(J),U,15):"-"_$$MODLST^IBEFUNC2($P(IBPROC(J),U,15)),1:"")
"RTN","IBCSC5",42,0)
 .. I $L(Z)>40 S Z=" "_$P(X,"^",2)_$S($P(IBPROC(J),U,15):"-"_$$MODLST^IBEFUNC2($P(IBPROC(J),U,15)),1:""),Z=$E($P(X,U,3),1,40-$L(Z))_Z
"RTN","IBCSC5",43,0)
 .. W Z
"RTN","IBCSC5",44,0)
 .I $P(IB(0),U,19)=2 S Y=+$P(IBPROC(J),U,11) S:+Y Y=+$G(^IBA(362.3,+Y,0)) W ?58,$P($$ICD9^IBACSV(Y,IBDATE),U) S Y=$P(IBPROC(J),U,2) D D^DIQ W ?67,Y Q
"RTN","IBCSC5",45,0)
 .S Y=$P(IBPROC(J),"^",2) D D^DIQ W ?67,Y
"RTN","IBCSC5",46,0)
 Q
"RTN","IBCSC5",47,0)
 ;
"RTN","IBCSC5",48,0)
MOD(IBM,PUNC) ; Returns modifier list from comma delimited ien's in string IBM
"RTN","IBCSC5",49,0)
 ; PUNC = Punctuation to use as first character of output
"RTN","IBCSC5",50,0)
 N IBMOD,Q
"RTN","IBCSC5",51,0)
 S IBMOD=""
"RTN","IBCSC5",52,0)
 F Q=1:1:$L(IBM,",") I $P(IBM,",",Q)'="" S IBMOD=IBMOD_$S(IBMOD'="":",",1:"")_$P($$MOD^ICPTMOD($P(IBM,",",Q),"I"),U,2)
"RTN","IBCSC5",53,0)
 I IBMOD'="" S IBMOD=$G(PUNC)_IBMOD
"RTN","IBCSC5",54,0)
 Q IBMOD
"RTN","IBCSC5",55,0)
 ;
"RTN","IBCSC5",56,0)
PD() ;prints prosthetic device in external form, returns 0 if there are none
"RTN","IBCSC5",57,0)
 N IBX,IBY,IBZ,IBN,X S X=0 S IBX=0 F  S IBX=$O(^IBA(362.5,"AIFN"_IBIFN,IBX)) Q:'IBX  D  Q:X>5
"RTN","IBCSC5",58,0)
 . S IBY=0 F  S IBY=$O(^IBA(362.5,"AIFN"_IBIFN,IBX,IBY)) Q:'IBY  S IBZ=$G(^IBA(362.5,IBY,0)) I IBZ'="" D  Q:X>5
"RTN","IBCSC5",59,0)
 .. S X=X+1 I X>5 W !,?17,"*** There are more Pros. Items associated with this bill.***" Q
"RTN","IBCSC5",60,0)
 .. ;S IBN=$G(^RMPR(661,+$P(IBZ,U,3),0)) W:X'=1 ! W ?17,$E($$PIN^IBCSC5B(+IBN),1,35)," - ",$P(IBN,U,1),?65,$$FMTE^XLFDT(+IBZ)
"RTN","IBCSC5",61,0)
 .. S IBN=$$PIN^IBCSC5B(+$P(IBZ,U,3)) W:X'=1 ! W ?17,$E($P(IBN,U,2),1,35)," - ",$P(IBN,U,1),?65,$$FMTE^XLFDT(+IBZ)
"RTN","IBCSC5",62,0)
 Q X
"RTN","IBCSC5",63,0)
 ;
"RTN","IBCSC5",64,0)
RX() ;prints RX REFILLS in external form, returns 0 if there are none
"RTN","IBCSC5",65,0)
 N IBX,IBY,IBZ,IBN,X S X=0 S IBX="" F  S IBX=$O(^IBA(362.4,"AIFN"_IBIFN,IBX)) Q:IBX=""  D  Q:X>5
"RTN","IBCSC5",66,0)
 . S IBY=0 F  S IBY=$O(^IBA(362.4,"AIFN"_IBIFN,IBX,IBY)) Q:'IBY  S IBZ=$G(^IBA(362.4,IBY,0)) I IBZ'="" D  Q:X>5
"RTN","IBCSC5",67,0)
 .. S X=X+1 I X>5 W !,?17,"*** There are more Rx. Refills associated with this bill.***" Q
"RTN","IBCSC5",68,0)
 .. S IBN=$G(^PSDRUG(+$P(IBZ,U,4),0)) W:X'=1 ! W ?17,$P(IBN,U,1),?65,$$FMTE^XLFDT(+$P(IBZ,U,3))
"RTN","IBCSC5",69,0)
 Q X
"RTN","IBCSC5",70,0)
 ;
"RTN","IBCSC5",71,0)
 ;IBCSC5
"RTN","IBCSCE")
0^4^B14652895
"RTN","IBCSCE",1,0)
IBCSCE ;ALB/MRL,MJB - MCCR SCREEN EDITS ;07 JUN 88 14:35
"RTN","IBCSCE",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,91,106,51,137,236,245,287**;21-MAR-94
"RTN","IBCSCE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSCE",4,0)
 ;
"RTN","IBCSCE",5,0)
 ;MAP TO DGCRSCE
"RTN","IBCSCE",6,0)
 ; always do procedures last because they are edited upon return to screen routine
"RTN","IBCSCE",7,0)
 I IBDR20["54," S IBDR20=$P(IBDR20,"54,",1)_$P(IBDR20,"54,",2)_"54,"
"RTN","IBCSCE",8,0)
 I IBDR20["44," S IBDR20=$P(IBDR20,"44,",1)_$P(IBDR20,"44,",2)_"44,"
"RTN","IBCSCE",9,0)
LOOP N IBDRLP,IBDRL S IBDRLP=IBDR20 F IBDRL=1:1 S IBDR20=$P(IBDRLP,",",IBDRL) Q:IBDR20=""  D EDIT
"RTN","IBCSCE",10,0)
 Q
"RTN","IBCSCE",11,0)
EDIT N IBQUERY
"RTN","IBCSCE",12,0)
 I (IBDR20["31") D MCCR^IBCNSP2 G ENQ
"RTN","IBCSCE",13,0)
 I (IBDR20["43")!(IBDR20["52") D ^IBCSC4D G ENQ
"RTN","IBCSCE",14,0)
 I (IBDR20["74")!(IBDR20["53") K DR N I D ^IBCOPV S (DA,Y)=IBIFN G TMPL
"RTN","IBCSCE",15,0)
 I (IBDR20["54"),$P($G(^IBE(350.9,1,1)),"^",17) K DR N I D EN1^IBCCPT(.IBQUERY) D CLOSE^IBSDU(.IBQUERY) G TMPL ;
"RTN","IBCSCE",16,0)
 I (IBDR20["55") D ^IBCSC5A G ENQ
"RTN","IBCSCE",17,0)
 I (IBDR20["45")!(IBDR20["56") D ^IBCSC5B G ENQ
"RTN","IBCSCE",18,0)
 I (IBDR20["66")!(IBDR20["76") D EDIT^IBCRBE(IBIFN) D ASKCMB^IBCU65(IBIFN) G ENQ
"RTN","IBCSCE",19,0)
 I (IBDR20["87") D EN1^IBCEP6 G ENQ
"RTN","IBCSCE",20,0)
 F Q=1:1:9 I IBDR20[("9"_Q) D EDIT^IBCSC9 G ENQ
"RTN","IBCSCE",21,0)
TMPL N IBFLIAE S IBFLIAE=1 ;to invoke EN^DGREGAED from [IB SCREEN1]
"RTN","IBCSCE",22,0)
 S DR="[IB SCREEN"_IBSR_IBSR1_"]",(DA,Y)=IBIFN,DIE="^DGCR(399,"
"RTN","IBCSCE",23,0)
 D ^DIE K DIE,DR,DLAYGO
"RTN","IBCSCE",24,0)
 I (IBDR20["15") S DR="110///"_$$PTADD^IBCU(+$P(^DGCR(399,IBIFN,0),U,2),"PSA"),(DA,Y)=IBIFN,DIE="^DGCR(399," D ^DIE K DIE,DR
"RTN","IBCSCE",25,0)
 I (IBDR20["61")!(IBDR20["71") I +$G(DGRVRCAL) D PROC^IBCU7A(IBIFN,1)
"RTN","IBCSCE",26,0)
ENQ K DIE,DR,IBDR1,IBDR20,DGDRD,DGDRS,DGDRS1,DA Q
"RTN","IBCSCE",27,0)
 ;
"RTN","IBCSCE",28,0)
 ; W I "^11^12^13^15^14^21^22^23^"[("^"_J_"^") G W1
"RTN","IBCSCE",29,0)
 ; I "^44^"[("^"_J_"^") S DR(2,399.0304)=".01;1;I $D(IBIP),X<$P(IBIP,""^"",2)!($P(IBIP,""^"",6)&(X>$P(IBIP,""^"",6))) K X"
"RTN","IBCSCE",30,0)
 ; I "^64^"[("^"_J_"^") S DR(2,399.042)=".01:.03;"
"RTN","IBCSCE",31,0)
 ; I $T(@J) S DGDRD=$P($T(@J),";;",2) D S S K=(J*10) I $T(@K) S DGDRD=$P($T(@K),";;",2) D S
"RTN","IBCSCE",32,0)
 ; D ^IBCSCE1:("^31^")[("^"_J_"^") Q
"RTN","IBCSCE",33,0)
 ; W1 I @DGDRS["^2^DPT(^^D SET^IBCSCE;" D ^IBCSCE1 Q
"RTN","IBCSCE",34,0)
 ; S DGDRD="^2^DPT(^^D SET^IBCSCE;" D S,^IBCSCE1 Q
"RTN","IBCSCE",35,0)
 ; S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q
"RTN","IBCSCE",36,0)
 ; S DGCT=DGCT+1,DGDRS="DR(1,399,"_DGCT_")",@DGDRS=DGDRD Q
"RTN","IBCSCE",37,0)
 ; Q
"RTN","IBCSCE",38,0)
16 ;;110;
"RTN","IBCSCE",39,0)
17 ;;.18;
"RTN","IBCSCE",40,0)
31 ;;.07;S X=$P(^DGCR(399,DA,0),U,11);S Y="@"_$S(X']"":31,X="p":31,X="o":311,1:310);@310;D 1^IBCSCH1 S Y="@"_$S(IBADI=-1:31,'IBADI:312,1:313);@313;^2^DPT(^^D SET^IBCSCE;D UPDT^IBCSCE;@312;
"RTN","IBCSCE",41,0)
310 ;;101;102;103;S Y="@31";@311;D INST^IBCU;111;K DIC("DR"),DLAYGO;@31;
"RTN","IBCSCE",42,0)
32 ;;104;105;106;121;107;108;109
"RTN","IBCSCE",43,0)
41 ;;S:IBPTF Y="@411";159.5;@411;160;159;158;
"RTN","IBCSCE",44,0)
42 ;;162;
"RTN","IBCSCE",45,0)
43 ;;I IBPTF S Y="@943";64;65;66;67;68;S Y="@43";@943;D DX^IBCSC4B;@43;
"RTN","IBCSCE",46,0)
44 ;;S IBZ20=$P(^DGCR(399,DA,0),U,9);.09;D PRO^IBCSC4B;S IBASKCOD=1
"RTN","IBCSCE",47,0)
45 ;;41;
"RTN","IBCSCE",48,0)
46 ;;40;
"RTN","IBCSCE",49,0)
51 ;;.03;
"RTN","IBCSCE",50,0)
999 ;;64;65;66;67;68;
"RTN","IBCSCE",51,0)
52 ;;64;S:X="" Y="@99";65;S:X="" Y="@99";66;S:X="" Y="@99";67;S:X="" Y="@99";68;@99;
"RTN","IBCSCE",52,0)
53 ;;;;same as 74
"RTN","IBCSCE",53,0)
54 ;;S IBZ20=$P(^DGCR(399,DA,0),U,9);.09;S IBASKCOD=1
"RTN","IBCSCE",54,0)
55 ;;41;
"RTN","IBCSCE",55,0)
56 ;;40;
"RTN","IBCSCE",56,0)
61 ;;.06;164;
"RTN","IBCSCE",57,0)
62 ;;155;S:X=0 Y=156;157;156;S:'$D(IBOX) Y="@62";153;@62;
"RTN","IBCSCE",58,0)
63 ;;151;152;
"RTN","IBCSCE",59,0)
64 ;;161;165;
"RTN","IBCSCE",60,0)
65 ;;D RCD^IBCU1;42;202;S:'X Y=201;203;201;I $P(^DGCR(399,DA,"U1"),"^",11)']"" S Y="@65";210;@65;
"RTN","IBCSCE",61,0)
71 ;;.06;164;
"RTN","IBCSCE",62,0)
72 ;;155;S:X=0 Y=156;157;156;S:'$D(IBOX) Y="@72";153;@72;
"RTN","IBCSCE",63,0)
73 ;;151;152;
"RTN","IBCSCE",64,0)
74 ;;S:$D(IBOUT) Y="@999";43;@999;K IBOUT;
"RTN","IBCSCE",65,0)
75 ;;D RCD^IBCU1;42;202;S:'X Y=201;203;201;I $P(^DGCR(399,DA,"U1"),"^",11)']"" S Y="@75";210;@75;
"RTN","IBCSCE",66,0)
81 ;;208;
"RTN","IBCSCE",67,0)
82 ;;204;
"RTN","IBCSCE",68,0)
83 ;;205;
"RTN","IBCSCE",69,0)
84 ;;206;
"RTN","IBCSCE",70,0)
85 ;;207;
"RTN","IBCSCE",71,0)
86 ;;163;
"RTN","IBCSCE",72,0)
 ; AD S X=$S($D(^DPT(DA,.11)):^(.11),1:""),IBPHO=$S($D(^(.13)):$P(^(.13),U,1),1:""),Y=$S($D(^(IBADD)):^(IBADD),1:""),^(IBADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_IBPHO_U_$P(Y,U,10) K IBADD,IBPHO Q
"RTN","IBCSCE",73,0)
 ; SET S I(0,0)=D0,Y(1)=$S($D(^DGCR(399,D0,0)):^(0),1:""),X=$P(Y(1),"^",2),D(0)=X,X=$S(D(0)>0:D(0),1:"") Q
"RTN","IBCSCE",74,0)
 ;called by screen 3 (input template)
"RTN","IBCSCE",75,0)
UPDT F IBDD=0:0 S IBDD=$O(^DPT(DFN,.312,IBDD)) Q:IBDD'>0  S IBI1=^DPT(DFN,.312,IBDD,0) I $D(^DIC(36,+IBI1,0)),$P(^(0),"^",2)'="N" S IBDD(+IBI1)=IBI1
"RTN","IBCSCE",76,0)
 F IBAIC=0:0 S IBAIC=$O(^DGCR(399,IBIFN,"AIC",IBAIC)) Q:IBAIC'>0  I $D(IBDD(IBAIC)) F IBI1="I1","I2","I3" I $D(^DGCR(399,IBIFN,IBI1)),+^(IBI1)=IBAIC,^(IBI1)'=IBDD(IBAIC) S ^DGCR(399,IBIFN,IBI1)=IBDD(IBAIC)
"RTN","IBCSCE",77,0)
 K IBAIC,IBDD,IBI1 Q
"RTN","IBCSCE",78,0)
 ;
"RTN","IBCSCE",79,0)
 ;Edit patient's address using DGREGAED API
"RTN","IBCSCE",80,0)
EDADDR(IBDFN) ;
"RTN","IBCSCE",81,0)
 I $G(IBFLIAE)'=1!(IBDFN=0) Q 0
"RTN","IBCSCE",82,0)
 N IBFL S IBFL(1)=1
"RTN","IBCSCE",83,0)
 N X,Y,DIE,DA,DR,DIDEL,DIW,DIEDA,DG,DICR
"RTN","IBCSCE",84,0)
 D EN^DGREGAED(IBDFN,.IBFL)
"RTN","IBCSCE",85,0)
 Q 1
"RTN","IBCSCE",86,0)
 ;IBCSCE
"RTN","IBCSCH")
0^5^B71799679
"RTN","IBCSCH",1,0)
IBCSCH ;ALB/MJB - MCCR HELP ROUTINE ;03 JUN 88 15:25
"RTN","IBCSCH",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,124,138,51,148,137,161,245,232,287**;21-MAR-94
"RTN","IBCSCH",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSCH",4,0)
 ;
"RTN","IBCSCH",5,0)
 ;MAP TO DGCRSCH
"RTN","IBCSCH",6,0)
 ;
"RTN","IBCSCH",7,0)
 N I,C,IBSCNNZ,IBQ,IBPRNT,Z S IBSCNNZ=$$UP^XLFSTR($G(IBSCNN)),IBQ=0
"RTN","IBCSCH",8,0)
 I '$D(IBPAR) D  Q:IBQ
"RTN","IBCSCH",9,0)
 . I $G(IBSCNNZ)="?HCFA",$$FT^IBCEF(IBIFN)=2 S IBQ=1,IBPRNT=2 D BL24(IBIFN,1) Q
"RTN","IBCSCH",10,0)
 . I $G(IBSCNNZ)="?SC" S IBQ=1 D DISPSC(IBIFN) Q
"RTN","IBCSCH",11,0)
 . I $G(IBSCNNZ)="?INS" S IBQ=1 D INSDSPL(IBIFN) Q
"RTN","IBCSCH",12,0)
 . I $G(IBSCNNZ)="?INX" S IBQ=1 D INSDSPLX(IBIFN) Q
"RTN","IBCSCH",13,0)
 . I $G(IBSCNNZ)="?PRV" S IBQ=1 D DISPPRV(IBIFN) Q
"RTN","IBCSCH",14,0)
 . I $G(IBSCNNZ)="?CHG" S IBQ=1 D DISPCHG^IBCRBH1(IBIFN) Q
"RTN","IBCSCH",15,0)
 . I $G(IBSCNNZ)="?PRC" S IBQ=1 D DISPPRC^IBCSCH1(IBIFN) Q
"RTN","IBCSCH",16,0)
 . I $G(IBSCNNZ)="?CPT" S IBQ=1 D BCPTCHG^IBCRBH2(IBIFN) Q
"RTN","IBCSCH",17,0)
 . I $G(IBSCNNZ)="?INC" S IBQ=1 D EDIT^IBCBB(IBIFN) Q
"RTN","IBCSCH",18,0)
 . I $G(IBSCNNZ)="?CLA",$$CK0^IBCIUT1() S IBQ=1 D CLA^IBCISC(IBIFN) Q
"RTN","IBCSCH",19,0)
 . I $G(IBSCNNZ)="?MRA",$$MCRONBIL^IBEFUNC(IBIFN),$T(SCR^IBCEMVU)'="" S IBQ=1 D SCR^IBCEMVU(IBIFN) Q
"RTN","IBCSCH",20,0)
 . I $G(IBSCNNZ)="?ID" S IBQ=1 D DISPID^IBCEF74(IBIFN) Q
"RTN","IBCSCH",21,0)
 . Q
"RTN","IBCSCH",22,0)
 ;
"RTN","IBCSCH",23,0)
 S IBH("HELP")="" D ^IBCSCU,H^IBCSCU K IBH("HELP") W !,"Enter '^' to stop the display ",$S(IBV:"",1:"and edit "),"of data,"
"RTN","IBCSCH",24,0)
 W:'$D(IBPAR) " '^N' to jump to screen #N (see",!,"listing below), <RET> to continue on to the next available screen" I IBV W "." G M
"RTN","IBCSCH",25,0)
 W " or enter",!,"the field group number(s) you wish to edit using commas and dashes as",!,"delimiters.  Those groups enclosed in brackets ""[]"" are editable while those"
"RTN","IBCSCH",26,0)
 W !,"enclosed in arrows ""<>"" are not."
"RTN","IBCSCH",27,0)
 G:$D(IBPAR) M1
"RTN","IBCSCH",28,0)
M W "  Special help screens:"
"RTN","IBCSCH",29,0)
 W !,?5,"Enter '?SC' to view SC Status and Rated Disabilities."
"RTN","IBCSCH",30,0)
 W !,?5,"Enter '?INS' to view the patients insurance policies."
"RTN","IBCSCH",31,0)
 W !,?5,"Enter '?INX' to view the patients insurance policies with comments."
"RTN","IBCSCH",32,0)
 W !,?5,"Enter '?PRV' to view provider specific information."
"RTN","IBCSCH",33,0)
 W !,?5,"Enter '?PRC' to view all procedures on the bill and related data."
"RTN","IBCSCH",34,0)
 W !,?5,"Enter '?CHG' to view all items on the bill with potential charges."
"RTN","IBCSCH",35,0)
 W !,?5,"Enter '?CPT' to view all charges for selected CPT codes and bill type."
"RTN","IBCSCH",36,0)
 I $$FT^IBCEF(IBIFN)=2 W !,?5,"Enter '?HCFA' to view how block 24 will print on a HCFA 1500."
"RTN","IBCSCH",37,0)
 W !,?5,"Enter '?INC' to execute the edits & view the bill inconsistencies."
"RTN","IBCSCH",38,0)
 I $$CK0^IBCIUT1() W !?5,"Enter '?CLA' to view the ClaimsManager options."
"RTN","IBCSCH",39,0)
 I $$MCRONBIL^IBEFUNC(IBIFN) W !?5,"Enter '?MRA' to view Medicare Remittance Advice EOB's on file."
"RTN","IBCSCH",40,0)
 W !,?5,"Enter '?ID' to view all IDs to be electronically transmitted on this claim."
"RTN","IBCSCH",41,0)
 ;
"RTN","IBCSCH",42,0)
 I +IBSR'=9 S Z="DATA GROUPS ON SCREEN "_+IBSR W ! X IBWW D @(IBSR1_IBSR) D W
"RTN","IBCSCH",43,0)
 D S W ! F I=$Y:1:20 W !
"RTN","IBCSCH",44,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to SCREEN ",+IBSR R X:DTIME Q
"RTN","IBCSCH",45,0)
M1 N I,Z S Z="DATA GROUPS ON PARAMETER SCREEN" W !! X IBWW D @(IBSR1_IBSR) D W W ! F I=$Y:1:20 W !
"RTN","IBCSCH",46,0)
 S Z="PRESS <RETURN> KEY" X IBWW W " to RETURN to PARAMETER SCREEN" R X:DTIME Q
"RTN","IBCSCH",47,0)
1 S X="DOB^Alias Name^Sex, Marital Status^Veteran Status, Eligibility^Address, Temporary Address^Patient Short Billing Address^SC at Time of Care" Q
"RTN","IBCSCH",48,0)
2 S X="Patient Employer Name, Address^Spouse Employer Name, Address" Q
"RTN","IBCSCH",49,0)
3 S X="Payer Information^Provider Numbers^Mailing Address" Q
"RTN","IBCSCH",50,0)
4 S X="Admission Information^Discharge Information^Diagnosis Code(s)^Coding Method, Inpt Proc Code(s)^Occurrence Code(s)^Condition Code(s)^Value Code(s)" Q
"RTN","IBCSCH",51,0)
5 S X="Event Date^Outpatient Diagnosis^Outpatient Visits^Coding Method, Opt. Pro. Code(s)^Occurrence Code(s)^Condition Code(s)" Q
"RTN","IBCSCH",52,0)
6 S X="Bill Type, Covered/Non-Covered Days^R.O.I., Assignment of Benefits^Statement Covers Period^Bedsection, Length of Stay^Revenue Code(s), Offset, Total^Rate Schedule(s)^Prior Payments/Claims" Q
"RTN","IBCSCH",53,0)
7 S X="Bill Type, Covered/Non-Covered Days^R.O.I., Assignment of Benefits^Statement Covers Period^Outpatient Visits^Revenue Code(s), Offset, Total^Rate Schedule(s)^Prior Payments/Claims" Q
"RTN","IBCSCH",54,0)
8 S X="Bill Remark^Form Locator 2^Form Locator 9^Form Locator 27^Form Locator 45^Form Locator 92^Form Locator 93^Tx Auth. Code" Q
"RTN","IBCSCH",55,0)
9 S X="Locally defined fields" Q
"RTN","IBCSCH",56,0)
28 S X="Bill Remark, ICN/DCN's, Tx Auth. Code, Admit Diagnosis/Source^Providers^Form Locator 2 and 11^Form Locator 31^Form Locator 56, 57, and 78^Force to Print" Q
"RTN","IBCSCH",57,0)
H8 S X="Period Unable to Work^Admit Dx, ICN/DCN, Tx/Prior Auth. Code^Providers^Non-VA Facility^Form Locator 19^Force to Print" Q
"RTN","IBCSCH",58,0)
PAR S X="Fed Tax #, BC/BS #, MAS Svc Pointer^Bill Signer, Billing Supervisor^Security Parameters, Outpatient CPT parameters ^Remarks, Mailgroups^Agent Cashier Address/Phone" Q
"RTN","IBCSCH",59,0)
S N C,I,Z,J W !! S Z="AVAILABLE SCREENS" X IBWW
"RTN","IBCSCH",60,0)
 S X="Demographic^Employment^Payer^Inpatient Event^Outpatient Event^Inpatient Billing - General^Outpatient Billing - General^Billing - Specific^Locally Defined"
"RTN","IBCSCH",61,0)
 S C=0 F I=1:1 S J=$P(X,"^",I) Q:J=""  I '$E(IBVV,I) S C=C+1,Z="^"_I,IBW=(C#2) W:'(C#2) ?41 X IBWW S Z=$S(I?1N:" ",1:" ")_J_" Data" W Z
"RTN","IBCSCH",62,0)
 Q
"RTN","IBCSCH",63,0)
W N I,J,Z
"RTN","IBCSCH",64,0)
 F I=1:1 S J=$P(X,"^",I) Q:J=""  S Z=I,IBW=(I#2) W:'(I#2) ?42 X IBWW W " "_J
"RTN","IBCSCH",65,0)
 W:'(I-1)#2 ! Q
"RTN","IBCSCH",66,0)
 Q
"RTN","IBCSCH",67,0)
 ;IBCSCH
"RTN","IBCSCH",68,0)
 ;
"RTN","IBCSCH",69,0)
 ;
"RTN","IBCSCH",70,0)
BL24(IBIFN,IBNOSHOW) ; display block 24 of HCFA 1500
"RTN","IBCSCH",71,0)
 ; IBNOSHOW = 1 for not to show error/warning text line
"RTN","IBCSCH",72,0)
 N X,Y,DIR,IBPG,IBLN,IBCOL,IBX,IBQ,IBLC,IBLIN,IBPFORM,IBD,IBC1,Z,Z0,IBXDATA,IBXSAVE
"RTN","IBCSCH",73,0)
 K ^TMP("IBXSAVE",$J)
"RTN","IBCSCH",74,0)
 S IBQ=0,IBLC=9 Q:'$G(IBIFN)  K ^TMP("IBXDISP",$J)
"RTN","IBCSCH",75,0)
 ;
"RTN","IBCSCH",76,0)
 S IBLIN=$$BOX24D^IBCEF11()
"RTN","IBCSCH",77,0)
 S IBPFORM=$S($P($G(^IBE(353,2,2)),U,8):$P(^(2),U,8),1:2)
"RTN","IBCSCH",78,0)
 S IBX=$$BILLN^IBCEFG0(0,"1^99",IBLIN,+IBIFN,IBPFORM)
"RTN","IBCSCH",79,0)
 ;
"RTN","IBCSCH",80,0)
 W @IOF,!,"Example of diagnoses, procedures and charges printing on the HCFA 1500"
"RTN","IBCSCH",81,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",82,0)
 F Z=+IBLIN,IBLIN+1 I $D(^TMP("IBXDISP",$J,1,Z)) S Z0=$G(^TMP("IBXDISP",$J,1,Z,+$O(^TMP("IBXDISP",$J,1,Z,20),-1))) I Z0'="" S:Z=+IBLIN Z0="BOX 19 DATA: "_Z0 W !,Z0
"RTN","IBCSCH",83,0)
 W !,"21. diagnosis"
"RTN","IBCSCH",84,0)
 ;
"RTN","IBCSCH",85,0)
 W !,?5,"1. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,3)),?25,"3. ",$G(^TMP("IBXDISP",$J,1,IBLIN+3,31))
"RTN","IBCSCH",86,0)
 W !,?5,"2. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,3)),?25,"4. ",$G(^TMP("IBXDISP",$J,1,IBLIN+5,31))
"RTN","IBCSCH",87,0)
 ;
"RTN","IBCSCH",88,0)
 D PG
"RTN","IBCSCH",89,0)
 S IBPG=0 F  S IBPG=$O(^TMP("IBXDISP",$J,IBPG)) Q:'IBPG  D  Q:IBQ
"RTN","IBCSCH",90,0)
 . F IBLN=IBLIN+8:1:+$P(IBLIN,U,2) S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,0)) Q:'IBCOL&'$O(^TMP("IBXDISP",$J,IBPG,IBLN))  S IBLC=IBLC+1 I IBCOL D  Q:IBQ
"RTN","IBCSCH",91,0)
 .. S IBCOL=0,IBC1=1 F  S IBCOL=$O(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL)) Q:'IBCOL  I $TR($G(^(IBCOL))," ")'="" D
"RTN","IBCSCH",92,0)
 ... W:IBC1 ! S IBC1=0 W ?(IBCOL-1),$G(^TMP("IBXDISP",$J,IBPG,IBLN,IBCOL))
"RTN","IBCSCH",93,0)
 . I 'IBQ,$O(^TMP("IBXDISP",$J,IBPG)) S IBLIN=$$BOX24D^IBCEF11(),IBQ=$$PAUSE^IBCSCH1(IBLC) Q:IBQ  S IBLC=9 W @IOF D PG
"RTN","IBCSCH",94,0)
 ;
"RTN","IBCSCH",95,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",96,0)
 I 'IBPG,'IBQ S IBQ=$$PAUSE^IBCSCH1(IBLC)
"RTN","IBCSCH",97,0)
 K ^TMP("IBXDISP",$J),^TMP("IBXSAVE",$J)
"RTN","IBCSCH",98,0)
 Q
"RTN","IBCSCH",99,0)
 ;
"RTN","IBCSCH",100,0)
PG ; Display box 24 letters at top of charge list
"RTN","IBCSCH",101,0)
 W !,"24. A             B   C     D            E            F     G H  I        K"
"RTN","IBCSCH",102,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",103,0)
 Q
"RTN","IBCSCH",104,0)
 ;
"RTN","IBCSCH",105,0)
INSDSPL(IBIFN) ; Display patient's policies
"RTN","IBCSCH",106,0)
 N DIR,X,Y,IBX,DFN,IBDTIN,IBCOVEXT W @IOF
"RTN","IBCSCH",107,0)
 S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDTIN=$P(IBX,U,3),IBCOVEXT=1
"RTN","IBCSCH",108,0)
 I +DFN D DISPDT^IBCNS W ! S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR
"RTN","IBCSCH",109,0)
 Q
"RTN","IBCSCH",110,0)
 ;
"RTN","IBCSCH",111,0)
INSDSPLX(IBIFN) ; Display patient's policies extended (?INX)
"RTN","IBCSCH",112,0)
 N IBX,DFN,IBDATE S IBX=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IBX,U,2),IBDATE=$P(IBX,U,3) D DISP^IBCNS3(DFN,IBDATE,123)
"RTN","IBCSCH",113,0)
 Q
"RTN","IBCSCH",114,0)
 ;
"RTN","IBCSCH",115,0)
DISPPRV(IBIFN) ; display provider information: interactive - user selects provider
"RTN","IBCSCH",116,0)
 N DIC,DA,X,Y,IBI,IBJ,IBPRV,IBPX,IBDT,IBARR
"RTN","IBCSCH",117,0)
 W !!,"This is a display of provider specific information."
"RTN","IBCSCH",118,0)
 D SPECIFIC^IBCEU5(IBIFN)
"RTN","IBCSCH",119,0)
 S IBDT=+$G(^DGCR(399,+$G(IBIFN),"U")) I 'IBDT S IBDT=DT
"RTN","IBCSCH",120,0)
 ;
"RTN","IBCSCH",121,0)
 F IBI=1:1 W ! S DIC("A")="Select PROVIDER NAME: ",DIC="^VA(200,",DIC(0)="AEQM" D ^DIC Q:Y'>0  D
"RTN","IBCSCH",122,0)
 . S IBPRV=Y W !!,$TR($J(" ",IOM)," ","-")
"RTN","IBCSCH",123,0)
 . ;
"RTN","IBCSCH",124,0)
 . S IBPX=$$ESBLOCK^XUSESIG1(+IBPRV)
"RTN","IBCSCH",125,0)
 . W !," Signature Name: ",$P(IBPX,U,1),!,"Signature Title: ",$P(IBPX,U,3),!,"         Degree: ",$P(IBPX,U,2)
"RTN","IBCSCH",126,0)
 . ;
"RTN","IBCSCH",127,0)
 . S IBPX=$$PRVLIC^IBCU1(+IBPRV,IBDT,.IBARR) W !!,"     License(s): " D
"RTN","IBCSCH",128,0)
 .. I IBPX'>0 W "None Active on ",$$FMTE^XLFDT(IBDT,2) Q
"RTN","IBCSCH",129,0)
 .. S IBJ=0,IBW=0 F  S IBJ=$O(IBARR(IBJ)) Q:'IBJ  D
"RTN","IBCSCH",130,0)
 ... S IBPX=IBARR(IBJ),IBPX=$P($G(^DIC(5,+IBPX,0)),U,2)_": "_$P(IBPX,U,2)
"RTN","IBCSCH",131,0)
 ... I (IBW+$L(IBPX))>61 W !,?17 S IBW=0
"RTN","IBCSCH",132,0)
 ... W IBPX,"  " S IBW=IBW+$L(IBPX)+2
"RTN","IBCSCH",133,0)
 . ;
"RTN","IBCSCH",134,0)
 . S IBPX=$$GET^XUA4A72(+IBPRV,IBDT) W !!,"   Person Class: " D
"RTN","IBCSCH",135,0)
 .. I IBPX'>0 W "None Active on ",$$FMTE^XLFDT(IBDT,2) Q
"RTN","IBCSCH",136,0)
 .. W $P(IBPX,U,7)
"RTN","IBCSCH",137,0)
 .. W !,"  PROVIDER TYPE: ",$P(IBPX,U,2),!," CLASSIFICATION: ",$P(IBPX,U,3),!," SPECIALIZATION: ",$P(IBPX,U,4)
"RTN","IBCSCH",138,0)
 .. I +$P(IBPX,U,5) W !,"      EFFECTIVE: ",$$FMTE^XLFDT(+$P(IBPX,U,5),2) I +$P(IBPX,U,6) W " - ",$$FMTE^XLFDT(+$P(IBPX,U,6),2)
"RTN","IBCSCH",139,0)
 . ;
"RTN","IBCSCH",140,0)
 . S IBPX=$$PRVTYP^IBCRU6(+IBPRV,+IBDT)
"RTN","IBCSCH",141,0)
 . W !!,"RC Provider Group: ",$S(+IBPX:$P(IBPX,U,3)_", "_$P(IBPX,U,5)_"%",1:"None")
"RTN","IBCSCH",142,0)
 . W !,$TR($J(" ",IOM)," ","-")
"RTN","IBCSCH",143,0)
 ;
"RTN","IBCSCH",144,0)
 Q
"RTN","IBCSCH",145,0)
 ;
"RTN","IBCSCH",146,0)
DISPSC(IBIFN) ; display patients SC Status and Rated Disabilities
"RTN","IBCSCH",147,0)
 N IB0,DFN,IBSC,IBX,VAEL,VAERR
"RTN","IBCSCH",148,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IB0,U,2),IBSC=$P(IB0,U,18)
"RTN","IBCSCH",149,0)
 W !,@IOF,!,"SC Status and Rated Disabilities for ",$P($G(^DPT(+$G(DFN),0)),U,1)
"RTN","IBCSCH",150,0)
 W !,"--------------------------------------------------------------------------------",!
"RTN","IBCSCH",151,0)
 I +$G(IBIFN) W !," SC At Time Of Care: ",$S(IBSC=1:"Yes",IBSC=0:"No",1:"")
"RTN","IBCSCH",152,0)
 I +$G(DFN) D ELIG^VADPT D DIS^DGRPDB
"RTN","IBCSCH",153,0)
 W !!,"--------------------------------------------------------------------------------"
"RTN","IBCSCH",154,0)
 S IBX=$$PAUSE^IBCSCH1(19)
"RTN","IBCSCH",155,0)
 Q
"RTN","IBCU2")
0^13^B7719494
"RTN","IBCU2",1,0)
IBCU2 ;ALB/MRL - BILLING UTILITY ROUTINE (CONTINUED) ;01 JUN 88 12:00
"RTN","IBCU2",2,0)
 ;;2.0;INTEGRATED BILLING;**137,287**;21-MAR-94
"RTN","IBCU2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU2",4,0)
 ;
"RTN","IBCU2",5,0)
 ;MAP TO DGCRU2
"RTN","IBCU2",6,0)
 ;
"RTN","IBCU2",7,0)
TC D TCL
"RTN","IBCU2",8,0)
 N DA,X,Y
"RTN","IBCU2",9,0)
 F DGJ=0:0 S DGJ=$O(^DD(399,201,1,DGJ)) Q:'DGJ  I $D(^DD(399,201,1,DGJ,DGXRF)) S DA=DGI(1),X=DGTCX1 X ^(DGXRF)
"RTN","IBCU2",10,0)
 K DGI,DGJ,DGXRF,DGTCX,DGTCX1,DGTCX2
"RTN","IBCU2",11,0)
 Q
"RTN","IBCU2",12,0)
 ;
"RTN","IBCU2",13,0)
TCL S (DGTCX,DGTCX2)=0 F DGTCX1=0:0 S DGTCX1=$O(^DGCR(399,DA(1),"RC",DGTCX1)) Q:'DGTCX1  I $D(^DGCR(399,DA(1),"RC",DGTCX1,0)),DGTCX1'=DA S DGTCX=DGTCX+$P(^(0),"^",4)
"RTN","IBCU2",14,0)
 I DGXRF=1 S DGTCX1=DGTCX+X
"RTN","IBCU2",15,0)
 E  S DGTCX1=DGTCX
"RTN","IBCU2",16,0)
 S $P(^DGCR(399,DA(1),"U1"),"^",1)=DGTCX1,DGI=DA,DGI(1)=DA(1),DGTCX=X
"RTN","IBCU2",17,0)
 Q
"RTN","IBCU2",18,0)
 ;
"RTN","IBCU2",19,0)
TC1 F DGJ1=0:0 S DGJ1=$O(^DD(399.042,.04,1,DGJ1)) Q:'DGJ1  I $D(^DD(399.042,.04,1,DGJ1,DGXRF1)) S X=DGTCX11 X ^(DGXRF1)
"RTN","IBCU2",20,0)
 S X=DGTCX11 K DGJ1,DGXRF11,DGTCX11
"RTN","IBCU2",21,0)
 Q
"RTN","IBCU2",22,0)
 ;
"RTN","IBCU2",23,0)
FY ;S DGTCX1=$S($D(^DGCR(399,DA,"U1")):^("U1"),1:0) I +X>+DGTCX1 W !?4,*7,"Exceeds 'Total Charges' for this bill." K X Q
"RTN","IBCU2",24,0)
 ;W !?4,"Edit revenue codes/from-to dates if appropriate." K X Q
"RTN","IBCU2",25,0)
 Q
"RTN","IBCU2",26,0)
 ;
"RTN","IBCU2",27,0)
21 ;set logic for CHARGES subfield x-ref (399.042;.02)
"RTN","IBCU2",28,0)
 I $P(^DGCR(399,DA(1),"RC",DA,0),"^",3)="" S $P(^DGCR(399,DA(1),"RC",DA,0),"^",3)=$S($P(^DGCR(399,DA(1),0),"^",5)<3:$P(^("U"),"^",15),$D(^DGCR(399,DA(1),"OP",0)):$P(^(0),"^",4),1:1)
"RTN","IBCU2",29,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",3) S DGTCX11=Z*Z1,$P(^(0),"^",4)=DGTCX11,DGXRF1=1 D TC1
"RTN","IBCU2",30,0)
 Q
"RTN","IBCU2",31,0)
 ;
"RTN","IBCU2",32,0)
22 ;kill logic for CHARGES subfield x-ref (399.042;.02)
"RTN","IBCU2",33,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",3) S DGTCX11=Z*Z1,$P(^(0),"^",4)=DGTCX11,DGXRF1=2 D TC1
"RTN","IBCU2",34,0)
 Q
"RTN","IBCU2",35,0)
 ;
"RTN","IBCU2",36,0)
31 ;set logic for UNITS OF SERVICE subfield x-ref (399.042;.03)
"RTN","IBCU2",37,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",2) S DGTCX11=Z*Z1,$P(^(0),"^",4)=DGTCX11,DGXRF1=1 D TC1
"RTN","IBCU2",38,0)
 Q
"RTN","IBCU2",39,0)
 ;
"RTN","IBCU2",40,0)
32 ;kill logic for UNITS OF SERVICE subfield x-ref (399.042;.03)
"RTN","IBCU2",41,0)
 S Z=X,Z1=$P(^DGCR(399,DA(1),"RC",DA,0),"^",2) S DGTCX11=Z*Z1,$P(^(0),"^",4)=DGTCX11,DGXRF1=2 D TC1
"RTN","IBCU2",42,0)
 Q
"RTN","IBCU2",43,0)
 ;
"RTN","IBCU2",44,0)
FMDATES(PROMPT) ; ask for date range
"RTN","IBCU2",45,0)
 N %DT,X,Y,DT1,DT2,IB1,IB2  S DT1="",IB1="START WITH DATE ENTERED: ",IB2="GO TO DATE ENTERED: "
"RTN","IBCU2",46,0)
 I $G(PROMPT)'="" S IB1="START WITH "_PROMPT_": ",IB2="GO TO "_PROMPT_": "
"RTN","IBCU2",47,0)
 S %DT="AEX",%DT("A")=IB1 D ^%DT K %DT I Y<0!($P(Y,".",1)'?7N) G FMDQ
"RTN","IBCU2",48,0)
 S (%DT(0),DT2)=$P(Y,".",1) I DT2'>DT S %DT("B")="TODAY"
"RTN","IBCU2",49,0)
 S %DT="AEX",%DT("A")=IB2 D ^%DT K %DT I Y<0!($P(Y,".",1)'?7N) G FMDQ
"RTN","IBCU2",50,0)
 S DT1=DT2_"^"_$P(Y,".",1)
"RTN","IBCU2",51,0)
FMDQ Q DT1
"RTN","IBCU2",52,0)
 ;
"RTN","IBCU65")
0^6^B30440768
"RTN","IBCU65",1,0)
IBCU65 ;ALB/ARH - BILL CHARGE UTILITY: COMBINE E&M ; 12/01/04
"RTN","IBCU65",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBCU65",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU65",4,0)
 ;
"RTN","IBCU65",5,0)
 ; Combine (E&M) Charges on one bill: 
"RTN","IBCU65",6,0)
 ; 90801-90815, 90845-90899, 99201-99215, 99241-99245, 99271-99288, 99385-99387, 99395-99429, 99499
"RTN","IBCU65",7,0)
 ; For each of the procedures update the first line item to include both the professional and facility charge
"RTN","IBCU65",8,0)
 ; If there is another line item for the procedure then delete it (no bill CT)
"RTN","IBCU65",9,0)
 ;
"RTN","IBCU65",10,0)
ASKCMB(IBIFN) ; if the user requests, combine (E&M) charges on the bill
"RTN","IBCU65",11,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y S IBIFN=+$G(IBIFN) Q:'IBIFN
"RTN","IBCU65",12,0)
 ;
"RTN","IBCU65",13,0)
 I '$$CHKBILL(IBIFN) Q  ; provider based bill with combinable procedures
"RTN","IBCU65",14,0)
 ;
"RTN","IBCU65",15,0)
 W !! S DIR("?")="Enter Yes to add both Institutional and Professional charge for E&M codes"
"RTN","IBCU65",16,0)
 S DIR("?",1)="The Professional and Facility charges of certain E&M codes may be combined onto"
"RTN","IBCU65",17,0)
 S DIR("?",2)="one line item on this bill.",DIR("?",3)=" "
"RTN","IBCU65",18,0)
 S DIR("B")="NO",DIR("A")="Combine Institutional and Professional Charges for E&M Procedures"
"RTN","IBCU65",19,0)
 S DIR(0)="Y" D ^DIR Q:$D(DIRUT)  Q:'Y
"RTN","IBCU65",20,0)
 ;
"RTN","IBCU65",21,0)
 I Y=1 D CHGCMB(IBIFN)
"RTN","IBCU65",22,0)
 Q
"RTN","IBCU65",23,0)
 ;
"RTN","IBCU65",24,0)
CHGCMB(IBIFN) ; combine certain E&M codes on the bill
"RTN","IBCU65",25,0)
 N IBRC,IBRC0,IBCPT,IBRCCT,IBMATCH,IBCHGS,IBTCHG,IBDONE,IBX K ^TMP($J,"IBCU65 CMB") Q:'$G(IBIFN)
"RTN","IBCU65",26,0)
 ;
"RTN","IBCU65",27,0)
 D BILLCHG(IBIFN) I '$D(^TMP($J,"IBCU65 CMB")) Q
"RTN","IBCU65",28,0)
 ;
"RTN","IBCU65",29,0)
 S IBRC=0 F  S IBRC=$O(^DGCR(399,IBIFN,"RC",IBRC)) Q:'IBRC  D
"RTN","IBCU65",30,0)
 . S IBRC0=$G(^DGCR(399,IBIFN,"RC",IBRC,0))
"RTN","IBCU65",31,0)
 . ;
"RTN","IBCU65",32,0)
 . S IBCPT=$P(IBRC0,U,6) Q:'IBCPT  I '$$CHKCODE(IBCPT) Q  ; charge must be for a combinable cpt
"RTN","IBCU65",33,0)
 . S IBRCCT=$P(IBRC0,U,12) I IBRCCT'=1,IBRCCT'=2 Q  ; must be a component charge
"RTN","IBCU65",34,0)
 . I '$P(IBRC0,U,8) Q  ; charge must be auto created
"RTN","IBCU65",35,0)
 . ;
"RTN","IBCU65",36,0)
 . S IBMATCH=$P(IBRC0,U,3)_U_IBCPT_U_$P(IBRC0,U,7)_U_$P(IBRC0,U,10)_U_$P(IBRC0,U,11)
"RTN","IBCU65",37,0)
 . ;
"RTN","IBCU65",38,0)
 . S IBCHGS=$G(^TMP($J,"IBCU65 CMB",IBMATCH)) Q:IBCHGS=""  ; find match
"RTN","IBCU65",39,0)
 . ;
"RTN","IBCU65",40,0)
 . I +$G(IBDONE(IBMATCH)) I $$RVDEL(IBIFN,IBRC) D  Q  ; if already combined delete line item
"RTN","IBCU65",41,0)
 .. S IBX(IBCPT_" "_IBRC)=$S(IBRCCT=1:"Facility",1:"Professional")_" Charge for "_IBCPT_" deleted "_$P(IBRC0,U,2)
"RTN","IBCU65",42,0)
 . ;
"RTN","IBCU65",43,0)
 . S IBTCHG=$P(IBCHGS,U,3) Q:'IBTCHG
"RTN","IBCU65",44,0)
 . ;
"RTN","IBCU65",45,0)
 . I $$RVCHG(IBIFN,IBRC,IBTCHG) S IBDONE(IBMATCH)=1 D  ; match found, combine charges
"RTN","IBCU65",46,0)
 .. S IBX(IBCPT_" "_IBRC)="Charge for "_IBCPT_" combined: "_$P(IBCHGS,U,1)_"+"_$P(IBCHGS,U,2)_"="_IBTCHG
"RTN","IBCU65",47,0)
 ;
"RTN","IBCU65",48,0)
 I '$D(ZTQUEUED),'$G(IBAUTO) S IBX="" F  S IBX=$O(IBX(IBX)) Q:IBX=""  W !,IBX(IBX)
"RTN","IBCU65",49,0)
 K ^TMP($J,"IBCU65 CMB")
"RTN","IBCU65",50,0)
 Q
"RTN","IBCU65",51,0)
 ;
"RTN","IBCU65",52,0)
 ;
"RTN","IBCU65",53,0)
 ;
"RTN","IBCU65",54,0)
RVDEL(IBIFN,RCIFN) ; delete charge line item, Output: 0/1
"RTN","IBCU65",55,0)
 ; Input:  IBIFN = Bill Number, RCIFN = Charge Line Item in RC multiple
"RTN","IBCU65",56,0)
 N IBX,DIK,DIC,X,Y,Z,Z1,DA,D0,D1,DG,DICR,DIG,DIH,DIW,DGXRF1 S IBX=0
"RTN","IBCU65",57,0)
 I $D(^DGCR(399,+$G(IBIFN),"RC",+$G(RCIFN),0)) D  S IBX=1
"RTN","IBCU65",58,0)
 . S DA(1)=+IBIFN,DA=+RCIFN,DIK="^DGCR(399,"_DA(1)_",""RC""," D ^DIK K DIK
"RTN","IBCU65",59,0)
 Q IBX
"RTN","IBCU65",60,0)
 ;
"RTN","IBCU65",61,0)
RVCHG(IBIFN,RCIFN,CHG) ; update line item charge and remove component, Output: 0/1
"RTN","IBCU65",62,0)
 ; Input:  IBIFN = Bill Number, RCIFN = Charge Line Item in RC multiple, CHG = New Charge Amount
"RTN","IBCU65",63,0)
 N IBX,DA,DIE,DIC,DR,X,Y,Z,Z1,D,D0,D1,DI,DQ,DGXRF1 S IBX=0
"RTN","IBCU65",64,0)
 I $D(^DGCR(399,+$G(IBIFN),"RC",+$G(RCIFN),0)) D  S IBX=1
"RTN","IBCU65",65,0)
 . S DA(1)=+IBIFN,DIE="^DGCR(399,"_DA(1)_",""RC"",",DR=".12///@;.02////"_+$G(CHG),DA=+RCIFN D ^DIE
"RTN","IBCU65",66,0)
 Q IBX
"RTN","IBCU65",67,0)
 ;
"RTN","IBCU65",68,0)
 ;
"RTN","IBCU65",69,0)
CHKCODE(CPT) ; return true if CPT code combinable
"RTN","IBCU65",70,0)
 N IBOUT S CPT=+$G(CPT) S IBOUT=0
"RTN","IBCU65",71,0)
 I (CPT<90800)!(CPT>99500) S IBOUT=0 G CHKCODQ
"RTN","IBCU65",72,0)
 ;
"RTN","IBCU65",73,0)
 I CPT>90800,CPT<90816 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",74,0)
 I CPT>90844,CPT<90900 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",75,0)
 I CPT>99200,CPT<99216 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",76,0)
 I CPT>99240,CPT<99246 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",77,0)
 I CPT>99270,CPT<99289 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",78,0)
 I CPT>99384,CPT<99388 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",79,0)
 I CPT>99394,CPT<99430 S IBOUT=1 G CHKCODQ
"RTN","IBCU65",80,0)
 I CPT=99499 S IBOUT=1
"RTN","IBCU65",81,0)
 ;
"RTN","IBCU65",82,0)
CHKCODQ Q IBOUT
"RTN","IBCU65",83,0)
 ;
"RTN","IBCU65",84,0)
CHKBILL(IBIFN) ; return true if combining charges is applicable or available for bill
"RTN","IBCU65",85,0)
 ; bill must be Provider Based and have at least one combinable procedure
"RTN","IBCU65",86,0)
 N IBOUT,IBX,IBY S IBOUT=0 S IBIFN=+$G(IBIFN) I 'IBIFN G CHKBILQ
"RTN","IBCU65",87,0)
 ;
"RTN","IBCU65",88,0)
 S IBX=$P($G(^DGCR(399,+IBIFN,0)),U,22) S IBY=$P($$RCDV^IBCRU8(IBX),U,3) I IBY'=1,IBY'=2 S IBOUT=0 G CHKBILQ
"RTN","IBCU65",89,0)
 ;
"RTN","IBCU65",90,0)
 S IBX="90800;" F  S IBX=$O(^DGCR(399,IBIFN,"CP","B",IBX)) Q:('IBX)!(+IBX>99499)  I +$$CHKCODE(+IBX) S IBOUT=1 Q
"RTN","IBCU65",91,0)
 ;
"RTN","IBCU65",92,0)
CHKBILQ Q IBOUT
"RTN","IBCU65",93,0)
 ;
"RTN","IBCU65",94,0)
 ;
"RTN","IBCU65",95,0)
BILLCHG(IBIFN) ; get all possible charges for bill with discounts applied
"RTN","IBCU65",96,0)
 ; output array of charges for combinable procedures
"RTN","IBCU65",97,0)
 ; Output: ^TMP($J,"IBCU65 CMB", "units ^ cpt ^ div ^ itm type ^ itm ptr") = inst chg ^ prof chg ^ total chg
"RTN","IBCU65",98,0)
 ;
"RTN","IBCU65",99,0)
 N IBX,IB0,IBU,IBBRT,IBBTYPE,IBCBARR,IBLN,IBCPT,IBCMP,IBSBCR,IBCHGI,IBCHGP
"RTN","IBCU65",100,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCSX"),^TMP($J,"IBCRCSXR"),^TMP($J,"IBCRCSXN")
"RTN","IBCU65",101,0)
 K ^TMP($J,"IBCU65 TMP"),^TMP($J,"IBCU65 CMB") Q:'$G(IBIFN)
"RTN","IBCU65",102,0)
 I '$O(^DGCR(399,+IBIFN,"RC",0)) Q
"RTN","IBCU65",103,0)
 ;
"RTN","IBCU65",104,0)
 S IB0=$G(^DGCR(399,+IBIFN,0)) Q:IB0=""  S IBU=$G(^DGCR(399,+IBIFN,"U")) Q:'IBU
"RTN","IBCU65",105,0)
 S IBBRT=+$P(IB0,U,7),IBBTYPE=$S($P(IB0,U,5)<3:1,1:3)
"RTN","IBCU65",106,0)
 ;
"RTN","IBCU65",107,0)
 ; get standard set of charge sets available for bill, including all Instutional and Professional charge sets
"RTN","IBCU65",108,0)
 D RT^IBCRU3(IBBRT,IBBTYPE,$P(IBU,U,1,2),.IBCBARR,"PROCEDURE") I 'IBCBARR  Q
"RTN","IBCU65",109,0)
 ;
"RTN","IBCU65",110,0)
 ; get all possible charges and sort as they would be added to the bill, including all discounts applied
"RTN","IBCU65",111,0)
 D BILL^IBCRBH1(IBIFN,1,.IBCBARR),SORTCI^IBCRBH1(IBIFN)
"RTN","IBCU65",112,0)
 ;
"RTN","IBCU65",113,0)
 ;
"RTN","IBCU65",114,0)
 ; compile like charges for procedures that are combinable
"RTN","IBCU65",115,0)
 S IBX=0 F  S IBX=$O(^TMP($J,"IBCRCSX",IBX)) Q:'IBX  D
"RTN","IBCU65",116,0)
 . S IBLN=$G(^TMP($J,"IBCRCSX",IBX))
"RTN","IBCU65",117,0)
 . ;
"RTN","IBCU65",118,0)
 . S IBCPT=$P(IBLN,U,5) Q:'IBCPT  I '$$CHKCODE(IBCPT) Q  ; CPT must be defined and combinable
"RTN","IBCU65",119,0)
 . S IBCMP=+$P(IBLN,U,9) Q:'IBCMP  ; must be a component charge
"RTN","IBCU65",120,0)
 . I '$P(IBLN,U,8) Q  ; item pointer must be defined
"RTN","IBCU65",121,0)
 . I $P(IBLN,U,7)'=4 Q  ; item type must be cpt
"RTN","IBCU65",122,0)
 . ;
"RTN","IBCU65",123,0)
 . S IBSBCR=$P(IBLN,U,4,8)
"RTN","IBCU65",124,0)
 . S ^TMP($J,"IBCU65 TMP",IBSBCR)=+$G(^TMP($J,"IBCU65 TMP",IBSBCR))+1
"RTN","IBCU65",125,0)
 . S ^TMP($J,"IBCU65 TMP",IBSBCR,IBCMP)=IBLN
"RTN","IBCU65",126,0)
 ;
"RTN","IBCU65",127,0)
 ;
"RTN","IBCU65",128,0)
 ; compile array of combinable charges by procedure, must be combinable cpt and have both charges available
"RTN","IBCU65",129,0)
 S IBSBCR="" F  S IBSBCR=$O(^TMP($J,"IBCU65 TMP",IBSBCR)) Q:IBSBCR=""  D
"RTN","IBCU65",130,0)
 . I +$G(^TMP($J,"IBCU65 TMP",IBSBCR))'=2 Q
"RTN","IBCU65",131,0)
 . ;
"RTN","IBCU65",132,0)
 . S IBCHGI=$P($G(^TMP($J,"IBCU65 TMP",IBSBCR,1)),U,3) Q:'IBCHGI
"RTN","IBCU65",133,0)
 . S IBCHGP=$P($G(^TMP($J,"IBCU65 TMP",IBSBCR,2)),U,3) Q:'IBCHGP
"RTN","IBCU65",134,0)
 . ;
"RTN","IBCU65",135,0)
 . S ^TMP($J,"IBCU65 CMB",IBSBCR)=IBCHGI_U_IBCHGP_U_(IBCHGI+IBCHGP)
"RTN","IBCU65",136,0)
 ;
"RTN","IBCU65",137,0)
 ;
"RTN","IBCU65",138,0)
 K ^TMP($J,"IBCRCC"),^TMP($J,"IBCRCSX"),^TMP($J,"IBCRCSXR"),^TMP($J,"IBCRCSXN"),^TMP($J,"IBCU65 TMP")
"RTN","IBCU65",139,0)
 Q
"RTN","IBCU7A")
0^9^B38419441
"RTN","IBCU7A",1,0)
IBCU7A ;ALB/ARH - BILL PROCEDURE MANIPULATIONS ; 10-OCT-03
"RTN","IBCU7A",2,0)
 ;;2.0;INTEGRATED BILLING;**245,287**;21-MAR-94
"RTN","IBCU7A",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU7A",4,0)
 ;
"RTN","IBCU7A",5,0)
 ; Based on Reasonable Charges v2.0+, certain CPT codes should be reported in a certain way
"RTN","IBCU7A",6,0)
 ; this set of routines manipulates the bill's procedure to conform to the charges and proper billing
"RTN","IBCU7A",7,0)
 ;
"RTN","IBCU7A",8,0)
 ; criteria:  bill must be a Reasonable Charges bill
"RTN","IBCU7A",9,0)
 ;            charges must be v2.0 or greater
"RTN","IBCU7A",10,0)
 ;
"RTN","IBCU7A",11,0)
 ; called after bill created and populated to reset procedures
"RTN","IBCU7A",12,0)
 ;
"RTN","IBCU7A",13,0)
PROC(IBIFN,EDIT) ; manipulate bill procedures base on charges and the clinical data
"RTN","IBCU7A",14,0)
 ; EDIT is a flag for which manipulations should be completed, if true then only the charge significant manipulations are preformed
"RTN","IBCU7A",15,0)
 N IB0,IBBCT,IBPBTYP S EDIT=$G(EDIT)
"RTN","IBCU7A",16,0)
 I '$O(^DGCR(399,+$G(IBIFN),"CP",0)) Q
"RTN","IBCU7A",17,0)
 S IB0=$G(^DGCR(399,+IBIFN,0)) Q:IB0=""  S IBBCT=$P(IB0,U,27) Q:'IBBCT
"RTN","IBCU7A",18,0)
 I +$P($G(^DGCR(399,+IBIFN,"U")),U,2)<$$VERSDT^IBCRU8(2) Q
"RTN","IBCU7A",19,0)
 I '$$BILLRATE^IBCRU3($P(IB0,U,7),$P(IB0,U,5),$P(IB0,U,3),"RC") Q
"RTN","IBCU7A",20,0)
 ;
"RTN","IBCU7A",21,0)
 S IBPBTYP=$P($$RCDV^IBCRU8(+$P(IB0,U,22)),U,3) Q:'IBPBTYP
"RTN","IBCU7A",22,0)
 ;
"RTN","IBCU7A",23,0)
 I 'EDIT,IBPBTYP<3 D DELCLN(IBIFN) ; delete TC/26 component clinical procedures from bills
"RTN","IBCU7A",24,0)
 I 'EDIT,IBPBTYP<3 D ADDCLN(IBIFN) ; add 26 modified clinical procedures to bill
"RTN","IBCU7A",25,0)
 I 'EDIT,IBPBTYP<3 D DELTC(IBIFN) ; delete all TC modifiers from institutional bills
"RTN","IBCU7A",26,0)
 ;
"RTN","IBCU7A",27,0)
 D MOD26(IBIFN) ; if only professional charge is a 26 charge then add or delete modifier 26 on procedure
"RTN","IBCU7A",28,0)
 ;
"RTN","IBCU7A",29,0)
 D BNDL^IBCU7A1(IBIFN) ; split or combine bundled procedures
"RTN","IBCU7A",30,0)
 ;
"RTN","IBCU7A",31,0)
 K ^UTILITY($J)
"RTN","IBCU7A",32,0)
 Q
"RTN","IBCU7A",33,0)
 ;
"RTN","IBCU7A",34,0)
 ;
"RTN","IBCU7A",35,0)
 ;
"RTN","IBCU7A",36,0)
DELTC(IBIFN) ; delete TC modifier from all procedures on RC v2.0+ Institutional bills
"RTN","IBCU7A",37,0)
 N IB0,IBBCT,IBTC,IBBCPT,IBLN,IBEVDT,IBMODS,IBV2,IBCHANGE S IBCHANGE=0
"RTN","IBCU7A",38,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBBCT=$P(IB0,U,27) I IBBCT'=1 Q
"RTN","IBCU7A",39,0)
 S IBTC=+$$MOD^ICPTMOD("TC","E") Q:IBTC<1  S IBV2=$$VERSDT^IBCRU8(2)
"RTN","IBCU7A",40,0)
 ;
"RTN","IBCU7A",41,0)
 S IBBCPT=0 F  S IBBCPT=$O(^DGCR(399,IBIFN,"CP",IBBCPT)) Q:'IBBCPT  D
"RTN","IBCU7A",42,0)
 . S IBLN=$G(^DGCR(399,IBIFN,"CP",IBBCPT,0)),IBEVDT=$P(IBLN,U,2) Q:IBLN'[";ICPT("
"RTN","IBCU7A",43,0)
 . I IBEVDT<IBV2 Q
"RTN","IBCU7A",44,0)
 . S IBMODS=","_$$GETMOD^IBEFUNC(IBIFN,IBBCPT)_","
"RTN","IBCU7A",45,0)
 . I IBMODS[IBTC D DELMOD^IBCU73(IBIFN,IBBCPT,IBTC) S IBCHANGE=IBCHANGE+1
"RTN","IBCU7A",46,0)
 I '$D(ZTQUEUED),'$G(IBAUTO),+IBCHANGE W !,"Modifier TC Deleted from all Procedures ("_IBCHANGE_")."
"RTN","IBCU7A",47,0)
 Q
"RTN","IBCU7A",48,0)
 ;
"RTN","IBCU7A",49,0)
DELCLN(IBIFN) ; remove clinical procedures from RC v2.0+ bills
"RTN","IBCU7A",50,0)
 ; - remove from institutional bill any procedures with a 26 in the clincal data
"RTN","IBCU7A",51,0)
 ; - remove from professional bill any procedures with a TC in the clinical data
"RTN","IBCU7A",52,0)
 ; to delete a procedure the outpatient encounter pointer must match the clinical encounter
"RTN","IBCU7A",53,0)
 ; (checks for non-modified procedure on bill in case modifier was manually removed)
"RTN","IBCU7A",54,0)
 ;
"RTN","IBCU7A",55,0)
 N IB0,IBBCT,IBMODE,IBMOD,IBX,IBLN,IBOE,IBCM,IBCPT,IBBCPT,IBLN1,IBFND,IBEND,IBV2,IBCHANGE S IBCHANGE=0
"RTN","IBCU7A",56,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBBCT=$P(IB0,U,27) I 'IBBCT Q
"RTN","IBCU7A",57,0)
 S IBMODE=$S(IBBCT=1:26,IBBCT=2:"TC",1:"") Q:IBMODE=""  S IBV2=$$VERSDT^IBCRU8(2)
"RTN","IBCU7A",58,0)
 S IBMOD=+$$MOD^ICPTMOD(IBMODE,"E") Q:IBMOD<1
"RTN","IBCU7A",59,0)
 ;
"RTN","IBCU7A",60,0)
 D GETSD^IBCU7U(IBIFN)
"RTN","IBCU7A",61,0)
 S IBX=0 F  S IBX=$O(^UTILITY($J,"CPT-CNT",IBX)) Q:'IBX  D
"RTN","IBCU7A",62,0)
 . S IBLN=$G(^UTILITY($J,"CPT-CNT",IBX)),(IBEND,IBFND)=0
"RTN","IBCU7A",63,0)
 . I +$P(IBLN,U,2)<IBV2 Q
"RTN","IBCU7A",64,0)
 . S IBOE=+$P(IBLN,U,11),IBCM=","_$P(IBLN,U,10)_","
"RTN","IBCU7A",65,0)
 . ;
"RTN","IBCU7A",66,0)
 . I IBCM[(","_IBMOD_",") D
"RTN","IBCU7A",67,0)
 .. S IBCPT=+IBLN_";ICPT(",IBBCPT=0 F  S IBBCPT=$O(^DGCR(399,IBIFN,"CP","B",IBCPT,IBBCPT)) Q:'IBBCPT  D  Q:IBEND
"RTN","IBCU7A",68,0)
 ... S IBLN1=$G(^DGCR(399,IBIFN,"CP",IBBCPT,0))
"RTN","IBCU7A",69,0)
 ... I IBOE=$P(IBLN1,U,20) S IBFND=IBBCPT I $O(^DGCR(399,IBIFN,"CP",IBBCPT,"MOD","C",IBMOD,0)) S IBEND=1
"RTN","IBCU7A",70,0)
 .. I +IBFND,+$$DELCPT^IBCU7U(IBIFN,IBBCPT) S IBCHANGE=IBCHANGE+1
"RTN","IBCU7A",71,0)
 I '$D(ZTQUEUED),'$G(IBAUTO),+IBCHANGE W !,"Modifier "_IBMODE_" Procedures Deleted ("_IBCHANGE_")."
"RTN","IBCU7A",72,0)
 Q
"RTN","IBCU7A",73,0)
 ;
"RTN","IBCU7A",74,0)
ADDCLN(IBIFN) ; add 26 modified clinical procedures to RC v2.0+ bills
"RTN","IBCU7A",75,0)
 ; - add to professional bill any procedures with a 26 in the clinical data
"RTN","IBCU7A",76,0)
 ; to add the clinical procedure the bill must not already have that procedure for the date
"RTN","IBCU7A",77,0)
 ; (checks for non-modified procedure on bill in case modifier was manually removed)
"RTN","IBCU7A",78,0)
 ;
"RTN","IBCU7A",79,0)
 N IB0,IBBCT,IBMOD,IBX,IBLN,IBEVDT,IBCM,IBCPT,IBBCPT,IBLN1,IBFND,IBEND,IBV2,IBCHANGE S IBCHANGE=0
"RTN","IBCU7A",80,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBBCT=$P(IB0,U,27) I IBBCT'=2 Q
"RTN","IBCU7A",81,0)
 S IBMOD=+$$MOD^ICPTMOD("26","E") Q:IBMOD<1  S IBV2=$$VERSDT^IBCRU8(2)
"RTN","IBCU7A",82,0)
 ;
"RTN","IBCU7A",83,0)
 D GETSD^IBCU7U(IBIFN)
"RTN","IBCU7A",84,0)
 S IBX=0 F  S IBX=$O(^UTILITY($J,"CPT-CNT",IBX)) Q:'IBX  D
"RTN","IBCU7A",85,0)
 . S IBLN=$G(^UTILITY($J,"CPT-CNT",IBX)),(IBEND,IBFND)=0
"RTN","IBCU7A",86,0)
 . S IBEVDT=+$P(IBLN,U,2),IBCM=","_$P(IBLN,U,10)_","
"RTN","IBCU7A",87,0)
 . I IBEVDT<IBV2 Q
"RTN","IBCU7A",88,0)
 . ;
"RTN","IBCU7A",89,0)
 . I IBCM[(","_IBMOD_",") D
"RTN","IBCU7A",90,0)
 .. S IBCPT=+IBLN_";ICPT(",IBBCPT=0 F  S IBBCPT=$O(^DGCR(399,IBIFN,"CP","B",IBCPT,IBBCPT)) Q:'IBBCPT  D  Q:IBEND
"RTN","IBCU7A",91,0)
 ... S IBLN1=$G(^DGCR(399,IBIFN,"CP",IBBCPT,0))
"RTN","IBCU7A",92,0)
 ... I IBEVDT=$P(IBLN1,U,2) S IBFND=IBBCPT I $O(^DGCR(399,IBIFN,"CP",IBBCPT,"MOD","C",IBMOD,0)) S IBEND=1
"RTN","IBCU7A",93,0)
 .. I 'IBFND,+$$ADDCPT^IBCU7U(IBIFN,IBLN) S IBCHANGE=IBCHANGE+1
"RTN","IBCU7A",94,0)
 I '$D(ZTQUEUED),'$G(IBAUTO),+IBCHANGE W !,"Modifier 26 Procedures Added ("_IBCHANGE_")."
"RTN","IBCU7A",95,0)
 Q
"RTN","IBCU7A",96,0)
 ;
"RTN","IBCU7A",97,0)
MOD26(IBIFN) ; add/delete modifier 26 to procedure if that is the only professional charge available
"RTN","IBCU7A",98,0)
 ; added on professional bill, deleted from institutional bill
"RTN","IBCU7A",99,0)
 N IB0,IBBCT,IB26,IBBCPT,IBLN,IBEVDT,IBMODS,IBV2,IBCHANGE,IBCHGS S IBCHANGE=0
"RTN","IBCU7A",100,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBBCT=$P(IB0,U,27) I 'IBBCT Q
"RTN","IBCU7A",101,0)
 S IB26=+$$MOD^ICPTMOD("26","E") Q:IB26<1  S IBV2=$$VERSDT^IBCRU8(2)
"RTN","IBCU7A",102,0)
 ;
"RTN","IBCU7A",103,0)
 S IBBCPT=0 F  S IBBCPT=$O(^DGCR(399,IBIFN,"CP",IBBCPT)) Q:'IBBCPT  D
"RTN","IBCU7A",104,0)
 . S IBLN=$G(^DGCR(399,IBIFN,"CP",IBBCPT,0)),IBEVDT=$P(IBLN,U,2) Q:IBLN'[";ICPT("
"RTN","IBCU7A",105,0)
 . I IBEVDT<IBV2 Q
"RTN","IBCU7A",106,0)
 . S IBMODS=","_$$GETMOD^IBEFUNC(IBIFN,IBBCPT)_","
"RTN","IBCU7A",107,0)
 . ;
"RTN","IBCU7A",108,0)
 . S IBCHGS=$$CHGMOD^IBCRCU1(IBIFN,+IBLN,IBEVDT,2) I (+IBCHGS'=1)!(+$P(IBCHGS,":",3)'=IB26) Q
"RTN","IBCU7A",109,0)
 . ;
"RTN","IBCU7A",110,0)
 . I IBBCT=1,IBMODS[IB26 D DELMOD^IBCU73(IBIFN,IBBCPT,IB26) S IBCHANGE=IBCHANGE+1
"RTN","IBCU7A",111,0)
 . I IBBCT=2,IBMODS'[IB26 D ADDMOD^IBCU73(IBIFN,IBBCPT,IB26) S IBCHANGE=IBCHANGE+1
"RTN","IBCU7A",112,0)
 ;
"RTN","IBCU7A",113,0)
 I '$D(ZTQUEUED),'$G(IBAUTO),+IBCHANGE W !,"Modifier 26 "_$S(IBBCT=1:"Deleted from",1:"Added to")_" Procedures ("_IBCHANGE_")."
"RTN","IBCU7A",114,0)
 Q
"RTN","IBCU7A",115,0)
 ;
"RTN","IBCU7A",116,0)
 ;
"RTN","IBCU7A",117,0)
ASK(IBIFN) ; ask if the bill procedure modifications should be executed
"RTN","IBCU7A",118,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBCU7A",119,0)
 I '$O(^DGCR(399,+$G(IBIFN),"CP",0)) Q
"RTN","IBCU7A",120,0)
 S DIR("?")="Enter Yes to apply the bill procedure modifications for charges."
"RTN","IBCU7A",121,0)
 S DIR("?",1)="For Reasonable Charges some procedures must be billed in a certain way to"
"RTN","IBCU7A",122,0)
 S DIR("?",2)="receive a charge.  The bill procedure modifications apply rules to the bill"
"RTN","IBCU7A",123,0)
 S DIR("?",3)="procedures to ensure the correct Reasonable Charge.",DIR("?",4)=""
"RTN","IBCU7A",124,0)
 S DIR("?",5)="- Modifier 26 will be added/removed from procedures if it affects the charges."
"RTN","IBCU7A",125,0)
 S DIR("?",6)="- Certain global procedures with no charge will be split into their component"
"RTN","IBCU7A",126,0)
 S DIR("?",7)="  procedures which do have charges.",DIR("?",8)=""
"RTN","IBCU7A",127,0)
 ;
"RTN","IBCU7A",128,0)
 S DIR("A")="Apply Procedure Updates for Charges" W !!
"RTN","IBCU7A",129,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR,X I Y=1 D PROC(+IBIFN,1) W !
"RTN","IBCU7A",130,0)
 Q
"RTN","IBYPSC")
0^10^B3967765
"RTN","IBYPSC",1,0)
IBYPSC ;ALB/ARH - IB*2.0*287 POST INIT: REASONABLE CHARGES V2.2 ; 12/01/04
"RTN","IBYPSC",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBYPSC",3,0)
 ; 
"RTN","IBYPSC",4,0)
 Q
"RTN","IBYPSC",5,0)
 ;
"RTN","IBYPSC",6,0)
POST ; post-init routine for IB*2*287 Reasonable Charges v2.2
"RTN","IBYPSC",7,0)
 N IBA
"RTN","IBYPSC",8,0)
 S IBA(1)="",IBA(2)="    IB*2*287 Post-Install .....",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSC",9,0)
 ;
"RTN","IBYPSC",10,0)
 D RVA ; activate Revenue Codes (399.2,2)
"RTN","IBYPSC",11,0)
 ;
"RTN","IBYPSC",12,0)
 D RVD^IBYPSC1 ; delete existing Revenue Code - CPT Links (#363.33)
"RTN","IBYPSC",13,0)
 D RVL^IBYPSC1 ; add new/updated Revenue Code - CPT Links (#363.33)
"RTN","IBYPSC",14,0)
 ;
"RTN","IBYPSC",15,0)
 S IBA(1)="",IBA(2)="    IB*2*287 Post-Install Complete",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSC",16,0)
 Q
"RTN","IBYPSC",17,0)
 ;
"RTN","IBYPSC",18,0)
 ;
"RTN","IBYPSC",19,0)
 ;
"RTN","IBYPSC",20,0)
RVA ; activate Revenue Codes exported in RV-CPT links (399.2,2), if currently inactive
"RTN","IBYPSC",21,0)
 N IBA,IBLN,IBI,IBRV,IBRVFN,IBRVLN,IBACT,IBCNT,IBJ,DD,DO,DIC,DIE,DA,DR,X,Y S IBCNT=0,IBACT=""
"RTN","IBYPSC",22,0)
 ;
"RTN","IBYPSC",23,0)
 S IBLN=$P($T(FRVA+1),";;",2)
"RTN","IBYPSC",24,0)
 ;
"RTN","IBYPSC",25,0)
 F IBI=1:1 S IBRV=$P(IBLN,",",IBI) Q:IBRV'?3N  D
"RTN","IBYPSC",26,0)
 . ;
"RTN","IBYPSC",27,0)
 . S IBRVFN=$O(^DGCR(399.2,"B",IBRV,0)) Q:'IBRVFN
"RTN","IBYPSC",28,0)
 . S IBRVLN=$G(^DGCR(399.2,+IBRVFN,0)) Q:IBRVLN=""
"RTN","IBYPSC",29,0)
 . I +$P(IBRVLN,U,3) Q
"RTN","IBYPSC",30,0)
 . ;
"RTN","IBYPSC",31,0)
 . S IBCNT=IBCNT+1,IBACT=IBACT_IBRV_","
"RTN","IBYPSC",32,0)
 . S DR="2////1",DIE="^DGCR(399.2,",DA=+IBRVFN D ^DIE K DIE,DIC,DA,DR,X,Y
"RTN","IBYPSC",33,0)
 ;
"RTN","IBYPSC",34,0)
 I IBCNT>0 S IBJ=0 F IBI=1:15 S IBJ=IBJ+15 S IBLN=$P(IBACT,",",IBI,IBJ) Q:IBLN=""  D MSG("         "_IBLN)
"RTN","IBYPSC",35,0)
 ;
"RTN","IBYPSC",36,0)
RVAQ S IBA(1)="    >> "_IBCNT_" Revenue Codes activated (399.2)..." D MSG(" ")
"RTN","IBYPSC",37,0)
 D MES^XPDUTL(.IBA)
"RTN","IBYPSC",38,0)
 Q
"RTN","IBYPSC",39,0)
 ;
"RTN","IBYPSC",40,0)
 ;
"RTN","IBYPSC",41,0)
MSG(X) ; 
"RTN","IBYPSC",42,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPSC",43,0)
 S IBA(IBX)=$G(X)
"RTN","IBYPSC",44,0)
 Q
"RTN","IBYPSC",45,0)
 ;
"RTN","IBYPSC",46,0)
FRVA ;  Revenue Codes to Activate (399.2,2)
"RTN","IBYPSC",47,0)
 ;;900,
"RTN","IBYPSC",48,0)
 ;;
"RTN","IBYPSC1")
0^17^B50879196
"RTN","IBYPSC1",1,0)
IBYPSC1 ;ALB/ARH - IB*2.0*287 POST INIT: UPDATE REVENUE CODE CPT LINKS ; 12/01/04
"RTN","IBYPSC1",2,0)
 ;;2.0;INTEGRATED BILLING;**287**;21-MAR-94
"RTN","IBYPSC1",3,0)
 ; 
"RTN","IBYPSC1",4,0)
 Q
"RTN","IBYPSC1",5,0)
 ;
"RTN","IBYPSC1",6,0)
 ;
"RTN","IBYPSC1",7,0)
RVD ; delete all Revenue Code - CPT links (363.33)
"RTN","IBYPSC1",8,0)
 N IBA,IBSGFN,IBRVLN,IBCNT,DA,DIK,DIC,X,Y S IBCNT=0
"RTN","IBYPSC1",9,0)
 ;
"RTN","IBYPSC1",10,0)
 S IBSGFN=$O(^IBE(363.32,"B","STANDARD RVCD LINKS",0)) I 'IBSGFN D MSG("         ** STANDARD RVCD LINKS Special Group not found, no links deleted.")
"RTN","IBYPSC1",11,0)
 ;
"RTN","IBYPSC1",12,0)
 S IBRVLN=0 F  S IBRVLN=$O(^IBE(363.33,IBRVLN)) Q:'IBRVLN  D
"RTN","IBYPSC1",13,0)
 . I +$P($G(^IBE(363.33,IBRVLN,0)),U,2)'=IBSGFN Q
"RTN","IBYPSC1",14,0)
 . S DA=IBRVLN,DIK="^IBE(363.33," D ^DIK K DA,DIK S IBCNT=IBCNT+1
"RTN","IBYPSC1",15,0)
 ; 
"RTN","IBYPSC1",16,0)
RVDQ S IBA(1)="    >> "_IBCNT_" Old Revenue Code - CPT Links deleted (363.33)..." D MSG(" ")
"RTN","IBYPSC1",17,0)
 D MES^XPDUTL(.IBA)
"RTN","IBYPSC1",18,0)
 Q
"RTN","IBYPSC1",19,0)
 ;
"RTN","IBYPSC1",20,0)
RVL ; add Revenue Codes - CPT links (363.33)
"RTN","IBYPSC1",21,0)
 N IBA,IBLN,IBI,IBSGFN,IBRV,IBRVFN,IBRVLN,IBCPT1,IBCPT2,IBCPT1N,IBCPT2N,IBCNT,DD,DO,DIC,DIE,DA,DR,X,Y,DLAYGO S IBCNT=0
"RTN","IBYPSC1",22,0)
 ;
"RTN","IBYPSC1",23,0)
 S IBSGFN=$O(^IBE(363.32,"B","STANDARD RVCD LINKS",0)) I 'IBSGFN D MSG("         ** STANDARD RVCD LINKS Special Group not found, no links added.")
"RTN","IBYPSC1",24,0)
 ;
"RTN","IBYPSC1",25,0)
 I +IBSGFN F IBI=1:1 S IBLN=$P($T(FRVL+IBI),";;",2,999) Q:IBLN=""  D
"RTN","IBYPSC1",26,0)
 . ;
"RTN","IBYPSC1",27,0)
 . S IBRV=$P(IBLN,U,1) Q:IBRV'?3N
"RTN","IBYPSC1",28,0)
 . ;
"RTN","IBYPSC1",29,0)
 . S IBRVFN=$O(^DGCR(399.2,"B",IBRV,0)) Q:'IBRVFN
"RTN","IBYPSC1",30,0)
 . S IBRVLN=$G(^DGCR(399.2,+IBRVFN,0)) Q:IBRVLN=""
"RTN","IBYPSC1",31,0)
 . I $P(IBRVLN,U,2)["*RESERVED" Q
"RTN","IBYPSC1",32,0)
 . ;
"RTN","IBYPSC1",33,0)
 . Q:$P(IBLN,U,2)=""
"RTN","IBYPSC1",34,0)
 . S IBCPT1=$P(IBLN,U,2),IBCPT1N=+$$CPT^ICPTCOD(IBCPT1,DT) I IBCPT1N<1 Q
"RTN","IBYPSC1",35,0)
 . S IBCPT2=$P(IBLN,U,3),IBCPT2N="" I IBCPT2'="" S IBCPT2N=+$$CPT^ICPTCOD(IBCPT2,DT) I IBCPT2N<1 Q
"RTN","IBYPSC1",36,0)
 . ;
"RTN","IBYPSC1",37,0)
 . I $O(^IBE(363.33,"AGP",IBSGFN,+IBCPT1N,0)) D MSG("         ** "_IBLN_" not added, a link already exists for "_IBCPT1) Q
"RTN","IBYPSC1",38,0)
 . ;
"RTN","IBYPSC1",39,0)
 . S DIC("DR")=".02////"_+IBSGFN_";.03////"_+IBCPT1N I +IBCPT2N S DIC("DR")=DIC("DR")_";.04////"_+IBCPT2N
"RTN","IBYPSC1",40,0)
 . K DD,DO S DLAYGO=363.33,DIC="^IBE(363.33,",DIC(0)="L",X=+IBRVFN D FILE^DICN K DIC,X,Y,DD,DO S IBCNT=IBCNT+1
"RTN","IBYPSC1",41,0)
 ;
"RTN","IBYPSC1",42,0)
RVLQ S IBA(1)="    >> "_IBCNT_" New Revenue Code - CPT Links added (363.33)..." D MSG(" ")
"RTN","IBYPSC1",43,0)
 D MES^XPDUTL(.IBA)
"RTN","IBYPSC1",44,0)
 Q
"RTN","IBYPSC1",45,0)
 ;
"RTN","IBYPSC1",46,0)
 ;
"RTN","IBYPSC1",47,0)
MSG(X) ; 
"RTN","IBYPSC1",48,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPSC1",49,0)
 S IBA(IBX)=$G(X)
"RTN","IBYPSC1",50,0)
 Q
"RTN","IBYPSC1",51,0)
 ;
"RTN","IBYPSC1",52,0)
FRVL ; revenue code - CPT links
"RTN","IBYPSC1",53,0)
 ;;301^80048^80440
"RTN","IBYPSC1",54,0)
 ;;301^82000^84999
"RTN","IBYPSC1",55,0)
 ;;302^86000^86999
"RTN","IBYPSC1",56,0)
 ;;302^87449^87450
"RTN","IBYPSC1",57,0)
 ;;305^85002^85999
"RTN","IBYPSC1",58,0)
 ;;306^87001^87430
"RTN","IBYPSC1",59,0)
 ;;306^87451^87999
"RTN","IBYPSC1",60,0)
 ;;307^81000^81099
"RTN","IBYPSC1",61,0)
 ;;309^89050^89399
"RTN","IBYPSC1",62,0)
 ;;310^80500^80502
"RTN","IBYPSC1",63,0)
 ;;311^88104^88299
"RTN","IBYPSC1",64,0)
 ;;312^88300^88399
"RTN","IBYPSC1",65,0)
 ;;320^70010^70330
"RTN","IBYPSC1",66,0)
 ;;320^70333^
"RTN","IBYPSC1",67,0)
 ;;320^70350^70390
"RTN","IBYPSC1",68,0)
 ;;320^71010^
"RTN","IBYPSC1",69,0)
 ;;320^71036^71130
"RTN","IBYPSC1",70,0)
 ;;320^72010^72120
"RTN","IBYPSC1",71,0)
 ;;320^72170^72190
"RTN","IBYPSC1",72,0)
 ;;320^72200^73110
"RTN","IBYPSC1",73,0)
 ;;320^73116^73140
"RTN","IBYPSC1",74,0)
 ;;320^73500^73520
"RTN","IBYPSC1",75,0)
 ;;320^73526^73565
"RTN","IBYPSC1",76,0)
 ;;320^73581^73660
"RTN","IBYPSC1",77,0)
 ;;320^74000^74022
"RTN","IBYPSC1",78,0)
 ;;320^74175^
"RTN","IBYPSC1",79,0)
 ;;320^74182^74183
"RTN","IBYPSC1",80,0)
 ;;320^74190^74775
"RTN","IBYPSC1",81,0)
 ;;320^75801^75897
"RTN","IBYPSC1",82,0)
 ;;320^75900^75985
"RTN","IBYPSC1",83,0)
 ;;320^75990^76066
"RTN","IBYPSC1",84,0)
 ;;320^76075^76088
"RTN","IBYPSC1",85,0)
 ;;320^76095^76125
"RTN","IBYPSC1",86,0)
 ;;320^76150^76350
"RTN","IBYPSC1",87,0)
 ;;322^70332^
"RTN","IBYPSC1",88,0)
 ;;322^73115^
"RTN","IBYPSC1",89,0)
 ;;322^73525^
"RTN","IBYPSC1",90,0)
 ;;322^73580^
"RTN","IBYPSC1",91,0)
 ;;322^76499^
"RTN","IBYPSC1",92,0)
 ;;323^75600^75790
"RTN","IBYPSC1",93,0)
 ;;323^75898^
"RTN","IBYPSC1",94,0)
 ;;324^71015^71035
"RTN","IBYPSC1",95,0)
 ;;333^77280^77799
"RTN","IBYPSC1",96,0)
 ;;341^78000^78999
"RTN","IBYPSC1",97,0)
 ;;342^79000^79999
"RTN","IBYPSC1",98,0)
 ;;351^70450^70492
"RTN","IBYPSC1",99,0)
 ;;351^76380^
"RTN","IBYPSC1",100,0)
 ;;352^71250^71270
"RTN","IBYPSC1",101,0)
 ;;352^72125^72133
"RTN","IBYPSC1",102,0)
 ;;352^72192^72194
"RTN","IBYPSC1",103,0)
 ;;352^73200^73202
"RTN","IBYPSC1",104,0)
 ;;352^73700^73702
"RTN","IBYPSC1",105,0)
 ;;352^74150^74170
"RTN","IBYPSC1",106,0)
 ;;359^75989^
"RTN","IBYPSC1",107,0)
 ;;359^76070^
"RTN","IBYPSC1",108,0)
 ;;359^76355^76375
"RTN","IBYPSC1",109,0)
 ;;360^19020^
"RTN","IBYPSC1",110,0)
 ;;360^19100^19103
"RTN","IBYPSC1",111,0)
 ;;360^19290^19291
"RTN","IBYPSC1",112,0)
 ;;360^20220^20225
"RTN","IBYPSC1",113,0)
 ;;360^28200^
"RTN","IBYPSC1",114,0)
 ;;360^31656^
"RTN","IBYPSC1",115,0)
 ;;360^31710^
"RTN","IBYPSC1",116,0)
 ;;360^32400^
"RTN","IBYPSC1",117,0)
 ;;360^32405^
"RTN","IBYPSC1",118,0)
 ;;360^33010^33011
"RTN","IBYPSC1",119,0)
 ;;360^35450^
"RTN","IBYPSC1",120,0)
 ;;360^35458^
"RTN","IBYPSC1",121,0)
 ;;360^35460^35476
"RTN","IBYPSC1",122,0)
 ;;360^35483^
"RTN","IBYPSC1",123,0)
 ;;360^35490^
"RTN","IBYPSC1",124,0)
 ;;360^35492^35495
"RTN","IBYPSC1",125,0)
 ;;360^36010^36217
"RTN","IBYPSC1",126,0)
 ;;360^36245^36247
"RTN","IBYPSC1",127,0)
 ;;360^36260^36262
"RTN","IBYPSC1",128,0)
 ;;360^36460^
"RTN","IBYPSC1",129,0)
 ;;360^36481^
"RTN","IBYPSC1",130,0)
 ;;360^37200^37202
"RTN","IBYPSC1",131,0)
 ;;360^37205^37207
"RTN","IBYPSC1",132,0)
 ;;360^41105^
"RTN","IBYPSC1",133,0)
 ;;360^43760^
"RTN","IBYPSC1",134,0)
 ;;360^47000^47001
"RTN","IBYPSC1",135,0)
 ;;360^47510^
"RTN","IBYPSC1",136,0)
 ;;360^47525^47530
"RTN","IBYPSC1",137,0)
 ;;360^47555^47556
"RTN","IBYPSC1",138,0)
 ;;360^48102^
"RTN","IBYPSC1",139,0)
 ;;360^49180^49200
"RTN","IBYPSC1",140,0)
 ;;360^50200^
"RTN","IBYPSC1",141,0)
 ;;360^50390^50393
"RTN","IBYPSC1",142,0)
 ;;360^50395^50398
"RTN","IBYPSC1",143,0)
 ;;360^50684^
"RTN","IBYPSC1",144,0)
 ;;360^50688^50690
"RTN","IBYPSC1",145,0)
 ;;360^51600^51605
"RTN","IBYPSC1",146,0)
 ;;360^51710^
"RTN","IBYPSC1",147,0)
 ;;360^52007^52010
"RTN","IBYPSC1",148,0)
 ;;360^52320^52355
"RTN","IBYPSC1",149,0)
 ;;360^53605^
"RTN","IBYPSC1",150,0)
 ;;360^53850^53852
"RTN","IBYPSC1",151,0)
 ;;360^55300^
"RTN","IBYPSC1",152,0)
 ;;360^59012^
"RTN","IBYPSC1",153,0)
 ;;360^60100^
"RTN","IBYPSC1",154,0)
 ;;360^61055^
"RTN","IBYPSC1",155,0)
 ;;360^61624^61626
"RTN","IBYPSC1",156,0)
 ;;360^62280^
"RTN","IBYPSC1",157,0)
 ;;360^62282^62284
"RTN","IBYPSC1",158,0)
 ;;360^66983^66986
"RTN","IBYPSC1",159,0)
 ;;362^65767^
"RTN","IBYPSC1",160,0)
 ;;370^00103^
"RTN","IBYPSC1",161,0)
 ;;370^00140^00147
"RTN","IBYPSC1",162,0)
 ;;370^00170^00176
"RTN","IBYPSC1",163,0)
 ;;401^76090^76091
"RTN","IBYPSC1",164,0)
 ;;402^76506^76999
"RTN","IBYPSC1",165,0)
 ;;403^76092^
"RTN","IBYPSC1",166,0)
 ;;404^G0125^G0126
"RTN","IBYPSC1",167,0)
 ;;410^94640^94668
"RTN","IBYPSC1",168,0)
 ;;413^99183^
"RTN","IBYPSC1",169,0)
 ;;420^64550^
"RTN","IBYPSC1",170,0)
 ;;420^90901^90911
"RTN","IBYPSC1",171,0)
 ;;420^95831^
"RTN","IBYPSC1",172,0)
 ;;420^95833^95851
"RTN","IBYPSC1",173,0)
 ;;420^97001^97002
"RTN","IBYPSC1",174,0)
 ;;420^97010^97016
"RTN","IBYPSC1",175,0)
 ;;420^97020^97033
"RTN","IBYPSC1",176,0)
 ;;420^97035^97521
"RTN","IBYPSC1",177,0)
 ;;420^97531^97533
"RTN","IBYPSC1",178,0)
 ;;420^97540^97752
"RTN","IBYPSC1",179,0)
 ;;420^97780^97799
"RTN","IBYPSC1",180,0)
 ;;430^29126^
"RTN","IBYPSC1",181,0)
 ;;430^29131^
"RTN","IBYPSC1",182,0)
 ;;430^29260^29280
"RTN","IBYPSC1",183,0)
 ;;430^95832^
"RTN","IBYPSC1",184,0)
 ;;430^95852^
"RTN","IBYPSC1",185,0)
 ;;430^97003^97004
"RTN","IBYPSC1",186,0)
 ;;430^97018^
"RTN","IBYPSC1",187,0)
 ;;430^97034^
"RTN","IBYPSC1",188,0)
 ;;430^97530^
"RTN","IBYPSC1",189,0)
 ;;430^97535^97537
"RTN","IBYPSC1",190,0)
 ;;440^92506^92510
"RTN","IBYPSC1",191,0)
 ;;440^92525^92526
"RTN","IBYPSC1",192,0)
 ;;440^92597^92598
"RTN","IBYPSC1",193,0)
 ;;440^96105^
"RTN","IBYPSC1",194,0)
 ;;440^V5362^V5364
"RTN","IBYPSC1",195,0)
 ;;441^92502^92504
"RTN","IBYPSC1",196,0)
 ;;441^92511^92520
"RTN","IBYPSC1",197,0)
 ;;450^24670^
"RTN","IBYPSC1",198,0)
 ;;450^25630^
"RTN","IBYPSC1",199,0)
 ;;450^25650^
"RTN","IBYPSC1",200,0)
 ;;450^27760^
"RTN","IBYPSC1",201,0)
 ;;450^28400^
"RTN","IBYPSC1",202,0)
 ;;460^94010^
"RTN","IBYPSC1",203,0)
 ;;460^94060^94620
"RTN","IBYPSC1",204,0)
 ;;460^94680^94750
"RTN","IBYPSC1",205,0)
 ;;460^94770^94772
"RTN","IBYPSC1",206,0)
 ;;470^92551^
"RTN","IBYPSC1",207,0)
 ;;470^92559^92560
"RTN","IBYPSC1",208,0)
 ;;470^92590^92595
"RTN","IBYPSC1",209,0)
 ;;470^V5299^
"RTN","IBYPSC1",210,0)
 ;;471^92552^92557
"RTN","IBYPSC1",211,0)
 ;;471^92561^92589
"RTN","IBYPSC1",212,0)
 ;;471^92596^
"RTN","IBYPSC1",213,0)
 ;;480^92950^92960
"RTN","IBYPSC1",214,0)
 ;;480^93303^93315
"RTN","IBYPSC1",215,0)
 ;;480^93317^93501
"RTN","IBYPSC1",216,0)
 ;;480^93505^93508
"RTN","IBYPSC1",217,0)
 ;;480^93514^93524
"RTN","IBYPSC1",218,0)
 ;;480^93536^
"RTN","IBYPSC1",219,0)
 ;;480^93571^93642
"RTN","IBYPSC1",220,0)
 ;;480^93660^
"RTN","IBYPSC1",221,0)
 ;;480^93724^
"RTN","IBYPSC1",222,0)
 ;;481^93511^
"RTN","IBYPSC1",223,0)
 ;;481^93528^93529
"RTN","IBYPSC1",224,0)
 ;;482^93017^
"RTN","IBYPSC1",225,0)
 ;;510^99201^
"RTN","IBYPSC1",226,0)
 ;;510^99211^
"RTN","IBYPSC1",227,0)
 ;;610^70336^
"RTN","IBYPSC1",228,0)
 ;;610^70540^70549
"RTN","IBYPSC1",229,0)
 ;;610^71550^71555
"RTN","IBYPSC1",230,0)
 ;;610^72195^72198
"RTN","IBYPSC1",231,0)
 ;;610^73218^73225
"RTN","IBYPSC1",232,0)
 ;;610^73718^73725
"RTN","IBYPSC1",233,0)
 ;;610^74181^
"RTN","IBYPSC1",234,0)
 ;;610^74185^
"RTN","IBYPSC1",235,0)
 ;;610^75552^75556
"RTN","IBYPSC1",236,0)
 ;;610^76093^76094
"RTN","IBYPSC1",237,0)
 ;;610^76390^76400
"RTN","IBYPSC1",238,0)
 ;;611^70551^70553
"RTN","IBYPSC1",239,0)
 ;;612^72141^72159
"RTN","IBYPSC1",240,0)
 ;;636^90732^90748
"RTN","IBYPSC1",241,0)
 ;;636^A4641^
"RTN","IBYPSC1",242,0)
 ;;730^93000^93012
"RTN","IBYPSC1",243,0)
 ;;730^93024^
"RTN","IBYPSC1",244,0)
 ;;730^93278^
"RTN","IBYPSC1",245,0)
 ;;731^93225^93226
"RTN","IBYPSC1",246,0)
 ;;731^93231^93232
"RTN","IBYPSC1",247,0)
 ;;731^93236^
"RTN","IBYPSC1",248,0)
 ;;731^93799^
"RTN","IBYPSC1",249,0)
 ;;740^95816^95829
"RTN","IBYPSC1",250,0)
 ;;740^95920^
"RTN","IBYPSC1",251,0)
 ;;740^95933^
"RTN","IBYPSC1",252,0)
 ;;750^43200^43204
"RTN","IBYPSC1",253,0)
 ;;750^43215^43272
"RTN","IBYPSC1",254,0)
 ;;750^43450^43460
"RTN","IBYPSC1",255,0)
 ;;750^44360^44373
"RTN","IBYPSC1",256,0)
 ;;750^44380^44394
"RTN","IBYPSC1",257,0)
 ;;750^45305^45321
"RTN","IBYPSC1",258,0)
 ;;750^45331^45334
"RTN","IBYPSC1",259,0)
 ;;750^45355^45385
"RTN","IBYPSC1",260,0)
 ;;750^56300^56305
"RTN","IBYPSC1",261,0)
 ;;750^91000^
"RTN","IBYPSC1",262,0)
 ;;750^91020^91030
"RTN","IBYPSC1",263,0)
 ;;750^91052^91122
"RTN","IBYPSC1",264,0)
 ;;761^11040^11044
"RTN","IBYPSC1",265,0)
 ;;762^99217^99220
"RTN","IBYPSC1",266,0)
 ;;771^G0008^G0010
"RTN","IBYPSC1",267,0)
 ;;820^90999^
"RTN","IBYPSC1",268,0)
 ;;900^90801^90802
"RTN","IBYPSC1",269,0)
 ;;900^90862^
"RTN","IBYPSC1",270,0)
 ;;900^90875^
"RTN","IBYPSC1",271,0)
 ;;900^97770^
"RTN","IBYPSC1",272,0)
 ;;901^90870^90871
"RTN","IBYPSC1",273,0)
 ;;904^Q0082^
"RTN","IBYPSC1",274,0)
 ;;914^90804^90814
"RTN","IBYPSC1",275,0)
 ;;914^90816^90845
"RTN","IBYPSC1",276,0)
 ;;915^90853^90857
"RTN","IBYPSC1",277,0)
 ;;916^90846^90847
"RTN","IBYPSC1",278,0)
 ;;916^90887^
"RTN","IBYPSC1",279,0)
 ;;918^96100^
"RTN","IBYPSC1",280,0)
 ;;918^96110^96117
"RTN","IBYPSC1",281,0)
 ;;920^51795^
"RTN","IBYPSC1",282,0)
 ;;920^54250^
"RTN","IBYPSC1",283,0)
 ;;920^59020^59025
"RTN","IBYPSC1",284,0)
 ;;920^92060^92065
"RTN","IBYPSC1",285,0)
 ;;920^92135^
"RTN","IBYPSC1",286,0)
 ;;920^92235^92250
"RTN","IBYPSC1",287,0)
 ;;920^92265^92275
"RTN","IBYPSC1",288,0)
 ;;920^93990^
"RTN","IBYPSC1",289,0)
 ;;920^95900^
"RTN","IBYPSC1",290,0)
 ;;920^95930^
"RTN","IBYPSC1",291,0)
 ;;920^95934^
"RTN","IBYPSC1",292,0)
 ;;921^54240^
"RTN","IBYPSC1",293,0)
 ;;921^93721^
"RTN","IBYPSC1",294,0)
 ;;921^93740^
"RTN","IBYPSC1",295,0)
 ;;921^93770^
"RTN","IBYPSC1",296,0)
 ;;921^93875^93971
"RTN","IBYPSC1",297,0)
 ;;922^95858^
"RTN","IBYPSC1",298,0)
 ;;922^95870^95875
"RTN","IBYPSC1",299,0)
 ;;924^95004^
"RTN","IBYPSC1",300,0)
 ;;924^95015^95071
"RTN","IBYPSC1",301,0)
 ;;924^95078^95199
"RTN","IBYPSC1",302,0)
 ;;943^93737^93738
"RTN","IBYPSC1",303,0)
 ;;943^93797^93798
"RTN","IBYPSC1",304,0)
 ;;
"RTN","IBYPSC1",305,0)
 ;
"RTN","IBYPSC1",306,0)
 Q
"VER")
8.0^22.0
**END**
**END**
