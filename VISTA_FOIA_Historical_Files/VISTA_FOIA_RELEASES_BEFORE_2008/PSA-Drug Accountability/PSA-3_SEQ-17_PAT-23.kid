Released PSA*3*23 SEQ #17
Extracted from mail message
**KIDS**:PSA*3.0*23^

**INSTALL NAME**
PSA*3.0*23
"BLD",819,0)
PSA*3.0*23^DRUG ACCOUNTABILITY^0^3000104^y
"BLD",819,1,0)
^^3^3^3000104^^
"BLD",819,1,1,0)
 This build contains the correct version of routine PSATI which was
"BLD",819,1,2,0)
 released in patch PSA*3*18. That patch had test version number five as
"BLD",819,1,3,0)
 the final version. 
"BLD",819,"KRN",0)
^9.67PA^^
"BLD",819,"KRN",.4,0)
.4
"BLD",819,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",819,"KRN",.401,0)
.401
"BLD",819,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",819,"KRN",.402,0)
.402
"BLD",819,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",819,"KRN",.403,0)
.403
"BLD",819,"KRN",.5,0)
.5
"BLD",819,"KRN",.84,0)
.84
"BLD",819,"KRN",3.6,0)
3.6
"BLD",819,"KRN",3.8,0)
3.8
"BLD",819,"KRN",9.2,0)
9.2
"BLD",819,"KRN",9.8,0)
9.8
"BLD",819,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",819,"KRN",9.8,"NM",1,0)
PSATI^^0^B24209795
"BLD",819,"KRN",9.8,"NM","B","PSATI",1)

"BLD",819,"KRN",19,0)
19
"BLD",819,"KRN",19.1,0)
19.1
"BLD",819,"KRN",101,0)
101
"BLD",819,"KRN",409.61,0)
409.61
"BLD",819,"KRN",771,0)
771
"BLD",819,"KRN",869.2,0)
869.2
"BLD",819,"KRN",870,0)
870
"BLD",819,"KRN",8994,0)
8994
"BLD",819,"KRN","B",.4,.4)

"BLD",819,"KRN","B",.401,.401)

"BLD",819,"KRN","B",.402,.402)

"BLD",819,"KRN","B",.403,.403)

"BLD",819,"KRN","B",.5,.5)

"BLD",819,"KRN","B",.84,.84)

"BLD",819,"KRN","B",3.6,3.6)

"BLD",819,"KRN","B",3.8,3.8)

"BLD",819,"KRN","B",9.2,9.2)

"BLD",819,"KRN","B",9.8,9.8)

"BLD",819,"KRN","B",19,19)

"BLD",819,"KRN","B",19.1,19.1)

"BLD",819,"KRN","B",101,101)

"BLD",819,"KRN","B",409.61,409.61)

"BLD",819,"KRN","B",771,771)

"BLD",819,"KRN","B",869.2,869.2)

"BLD",819,"KRN","B",870,870)

"BLD",819,"KRN","B",8994,8994)

"BLD",819,"QUES",0)
^9.62^^
"BLD",819,"REQB",0)
^9.611^1^1
"BLD",819,"REQB",1,0)
PSA*3.0*18^1
"BLD",819,"REQB","B","PSA*3.0*18",1)

"BLD",819,"REQG",0)
^9.611^^
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2990610^2970912^531
"PKG",182,22,1,"PAH",1,0)
23^3000104
"PKG",182,22,1,"PAH",1,1,0)
^^3^3^3000104
"PKG",182,22,1,"PAH",1,1,1,0)
 This build contains the correct version of routine PSATI which was
"PKG",182,22,1,"PAH",1,1,2,0)
 released in patch PSA*3*18. That patch had test version number five as
"PKG",182,22,1,"PAH",1,1,3,0)
 the final version. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSATI")
0^1^B24209795
"RTN","PSATI",1,0)
PSATI ;BIR/LTL-Single Drug Match ;7/23/97
"RTN","PSATI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**8,18,23**; 10/24/97
"RTN","PSATI",3,0)
 ;This routine enters/edits links with the ITEM MASTER file.
"RTN","PSATI",4,0)
 ;
"RTN","PSATI",5,0)
 ;References to $$DESCR^PRCPUX1 are covered by DBIA #259
"RTN","PSATI",6,0)
 ;References to $$VENNAME^PRCPUX1 are covered by DBIA #259
"RTN","PSATI",7,0)
 ;References to ^PRC( are covered by DBIA #214
"RTN","PSATI",8,0)
 ;References to ^PSDRUG( are covered by DBIA #2095
"RTN","PSATI",9,0)
 ;
"RTN","PSATI",10,0)
 N PSAIT,DTOUT,DUOUT,DIE,D0,D1,DA,DIC,DIR,DLAYGO,DR,DIRUT
"RTN","PSATI",11,0)
START D DT^DICRW
"RTN","PSATI",12,0)
 ;For call by ^PSAENT & ^PSAUNL 
"RTN","PSATI",13,0)
 I $G(PSAIT) S DIC(0)="Q",X=PSAIT W !!,$P($G(^PSDRUG(+PSAIT,0)),U),!!
"RTN","PSATI",14,0)
 ;LOOK UP DRUG
"RTN","PSATI",15,0)
LOOK S:'$D(DIC(0)) DIC(0)="AEMQ" S DIC=50,DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) QUIT S (PSADRUG,PSAIT)=$P(Y,U)
"RTN","PSATI",16,0)
DIS I $O(^PSDRUG(+PSADRUG,441,0)) W !,"This drug is currently linked to the following item(s):",!!  S PSAIM=0 F  S PSAIM=$O(^PSDRUG(PSADRUG,441,PSAIM)) Q:PSAIM="B"  S PSAI=$P(^PSDRUG(PSADRUG,441,PSAIM,0),U) D:$$DESCR^PRCPUX1(0,PSAI)]""
"RTN","PSATI",17,0)
 .W !,PSAI_"  "_$$DESCR^PRCPUX1(0,PSAI)_"  ",$$VENNAME^PRCPUX1($P($G(^PRC(441,+PSAI,0)),U,4)_"PRC(440"),!
"RTN","PSATI",18,0)
QUES1 I $D(PSAI) S DIR(0)="Y",DIR("A")="Would you like to alter the link(s)",DIR("B")="No" D ^DIR K DIR G:Y<1&('$D(PSALOC)) AGAIN G:Y<1 QUIT
"RTN","PSATI",19,0)
 W !!,"Current potential ITEM MASTER file links based on NDC or FSN are:",!!
"RTN","PSATI",20,0)
 ;Attempt match by NDC between #50/#441
"RTN","PSATI",21,0)
NDC I $P($G(^PSDRUG(PSADRUG,2)),U,4)]"" S PSANDC=$P(^(2),U,4),PSAI=$$ITEM^PSAUTL(PSANDC) W "DRUG file NDC:  "_PSANDC
"RTN","PSATI",22,0)
 I $D(PSAI),$D(PSANDC),PSAI W ?40,"ITEM NUMBER:  "_PSAI,!!,"DESC:  "_$$DESCR^PRCPUX1(0,PSAI),! W:$G(^PRC(441,+PSAI,3)) !?60,"* Inactive item" D:$O(^PRC(441,"F",PSANDC,PSAI))
"RTN","PSATI",23,0)
MORE .S PSAZ=1,PSAI(PSAZ)=PSAI F  S PSAI(PSAZ)=$O(^PRC(441,"F",PSANDC,PSAI(PSAZ))) Q:PSAI(PSAZ)=""  W !?40,"ITEM NUMBER:  "_PSAI(PSAZ),!!,"DESC:  ",$$DESCR^PRCPUX1(0,PSAI(PSAZ)) W:$G(^PRC(441,+PSAI(PSAZ),3)) !?60,"* Inactive item"
"RTN","PSATI",24,0)
 ;Attempt match between FSN (#50) and NSN (#441)
"RTN","PSATI",25,0)
FSN I '$G(PSAI),$P(^PSDRUG(PSADRUG,0),U,6)]"" S PSAFSN=$P(^(0),U,6) D:$D(^PRC(441,"BB",PSAFSN))
"RTN","PSATI",26,0)
 .S PSAI=$O(^PRC(441,"BB",PSAFSN,"")) W "  NO NDC MATCH IN ITEM MASTER file.",!!,"DRUG file FSN:  "_PSAFSN,?40,"ITEM NUMBER:  "_PSAI,!!,"DESC:  ",$$DESCR^PRCPUX1(0,PSAI),!
"RTN","PSATI",27,0)
FAIL S:'$D(PSAI) PSAI="" W:PSAI']"" !!,"No NDC or FSN match in the ITEM MASTER file.",!
"RTN","PSATI",28,0)
 ;S:'$D(^PSDRUG(+PSADRUG,441,0)) ^(0)="^50.0441P^^" ;Removed by SQA recommendation (PSA*3*18)
"RTN","PSATI",29,0)
CON S DIE="^PSDRUG(",DA=PSADRUG,DR="441//^S X=$G(PSAI)" D ^DIE K DIE I $D(Y)!($D(DTOUT)) S DIRUT=1 G QUIT
"RTN","PSATI",30,0)
 I '$D(^PSDRUG(PSADRUG,"ND")) W !!,"No NDF link, can't help.",!  G AGAIN
"RTN","PSATI",31,0)
 I $P(^PSDRUG(PSADRUG,"ND"),U)']"" W !!,"No NDF link, can't help.",!  K DUOUT G AGAIN
"RTN","PSATI",32,0)
 ;Check for package size or type = OTHER
"RTN","PSATI",33,0)
 I $P($G(^PSDRUG(+PSADRUG,"ND")),U,4)=2058 W !!,"No matching PACKAGE SIZE in the National Drug File." G AGAIN
"RTN","PSATI",34,0)
 I $P($G(^PSDRUG(+PSADRUG,"ND")),U,5)=623 W !!,"No matching PACKAGE TYPE in the National Drug file." G AGAIN
"RTN","PSATI",35,0)
NDF ;Offer NDF path
"RTN","PSATI",36,0)
 W !!,"This drug is linked to the NATIONAL DRUG file.",!!,"There may be an NDC there that will link to the ITEM MASTER file.",!
"RTN","PSATI",37,0)
 S DIR(0)="Y",DIR("A")="Would you like to check",DIR("B")="No" D ^DIR K DIR G:$D(DIRUT)!(Y<1) AGAIN
"RTN","PSATI",38,0)
 ;
"RTN","PSATI",39,0)
 ;DAVE B (PSA*3*18) Old NDF globals no longer used.
"RTN","PSATI",40,0)
 S PSAVP=$P($G(^PSDRUG(PSADRUG,"ND")),"^",3) I $G(PSAVP)="" W !,"Sorry, there is no entry in the PSNDF VA PRODUCT NAME, cannot find match.",! G AGAIN
"RTN","PSATI",41,0)
 ;Call PSNAPIS
"RTN","PSATI",42,0)
 S X=$$CIRN2^PSNAPIS("",PSAVP,.PSANDF)
"RTN","PSATI",43,0)
 S PSX="" F  S PSX=$O(PSANDF(PSX)) Q:PSX=""  K PSA D  Q:Y<1  D BINGO
"RTN","PSATI",44,0)
 .I PSX'["-" S PSA=$E(PSX,1,6)_"-"_$E(PSX,7,10)_"-"_$E(PSX,11,12)
"RTN","PSATI",45,0)
 .I $G(PSA)="" S PSA=PSX
"RTN","PSATI",46,0)
 .W !,"Going to check NDC #"_PSA,! S DIR(0)="Y",DIR("A")="OK",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)!(Y<1)
"RTN","PSATI",47,0)
AGAIN K PSA,PSAD,PSADO,PSADRUG,PSAF,PSAFSN,PSANDC,PSANDF,PSAI,PSAIM,PSAIQ,PSAIQT,PSAIAC,PSAILC,PSAINV,PSAINVN,PSAP,PSAPB,PSAS,PSAT,PSATB,PSAU,PSAV,PSAZ,X,Y
"RTN","PSATI",48,0)
 Q:$D(PSAS)!($D(PSALOC))  W ! S DIR(0)="Y",DIR("A")="Another drug",DIR("B")="Yes" D ^DIR K DIR I Y>0 K PSAIT,PSAI G START
"RTN","PSATI",49,0)
QUIT N:'$G(PSAIT(1)) PSAIT,Y K PSA,PSAI,PSAD,PSADO,PSADRUG,PSAF,PSAFSN,PSANDC,PSANDF,PSAI,PSAIM,PSAIQ,PSAIQT,PSAIAC,PSAILC,PSAINV,PSAINVN,PSAP,PSAPB,PSAS,PSAT,PSATB,PSAU,PSAV,PSAZ,X,Y Q
"RTN","PSATI",50,0)
BINGO S PSAI=$O(^PRC(441,"F",PSA,""))
"RTN","PSATI",51,0)
 Q:$O(^PSDRUG("AB",+PSAI,0))
"RTN","PSATI",52,0)
 W !!,"DRUG file:  "_$P(^PSDRUG(PSADRUG,0),U),!!,"Item #:  "_PSAI,"  Desc:  ",$$DESCR^PRCPUX1(0,PSAI),! D
"RTN","PSATI",53,0)
 .S DIR(0)="Y",DIR("A")="OK to link",DIR("B")="Yes",DIR("?")="If yes, I'll perform the link" D ^DIR K DIR K:(Y=0) Y Q:($G(Y)<1)
"RTN","PSATI",54,0)
 .S DIE=50,DA=PSADRUG,DR="441///^S X=""`""_PSAI" D ^DIE W " linked."
"RTN","PSATI",55,0)
 Q
"VER")
8.0^22.0
**END**
**END**
