Released LA*5.2*70 SEQ #50
Extracted from mail message
**KIDS**:LA*5.2*70^

**INSTALL NAME**
LA*5.2*70
"BLD",5419,0)
LA*5.2*70^AUTOMATED LAB INSTRUMENTS^0^3040827^y
"BLD",5419,1,0)
^^1^1^3040823^
"BLD",5419,1,1,0)
Refer to the National Patch Module
"BLD",5419,4,0)
^9.64PA^^
"BLD",5419,"INI")
PRE^LA70
"BLD",5419,"INID")
y^y^y
"BLD",5419,"INIT")
POST^LA70
"BLD",5419,"KRN",0)
^9.67PA^8989.52^19
"BLD",5419,"KRN",.4,0)
.4
"BLD",5419,"KRN",.401,0)
.401
"BLD",5419,"KRN",.402,0)
.402
"BLD",5419,"KRN",.403,0)
.403
"BLD",5419,"KRN",.5,0)
.5
"BLD",5419,"KRN",.84,0)
.84
"BLD",5419,"KRN",3.6,0)
3.6
"BLD",5419,"KRN",3.8,0)
3.8
"BLD",5419,"KRN",9.2,0)
9.2
"BLD",5419,"KRN",9.8,0)
9.8
"BLD",5419,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5419,"KRN",9.8,"NM",1,0)
LA7VOBXA^^0^B32444628
"BLD",5419,"KRN",9.8,"NM","B","LA7VOBXA",1)

"BLD",5419,"KRN",19,0)
19
"BLD",5419,"KRN",19,"NM",0)
^9.68A^10^10
"BLD",5419,"KRN",19,"NM",1,0)
LR ACC THEN DATA^^5^
"BLD",5419,"KRN",19,"NM",2,0)
LRENTER^^5^
"BLD",5419,"KRN",19,"NM",3,0)
LRFAST^^5^
"BLD",5419,"KRN",19,"NM",4,0)
LRFASTS^^5^
"BLD",5419,"KRN",19,"NM",5,0)
LRGV^^5^
"BLD",5419,"KRN",19,"NM",6,0)
LRNONCOM^^5^
"BLD",5419,"KRN",19,"NM",7,0)
LRSTUF^^5^
"BLD",5419,"KRN",19,"NM",8,0)
LRVR^^5^
"BLD",5419,"KRN",19,"NM",9,0)
LRVRW^^5^
"BLD",5419,"KRN",19,"NM",10,0)
LRVRW2^^5^
"BLD",5419,"KRN",19,"NM","B","LR ACC THEN DATA",1)

"BLD",5419,"KRN",19,"NM","B","LRENTER",2)

"BLD",5419,"KRN",19,"NM","B","LRFAST",3)

"BLD",5419,"KRN",19,"NM","B","LRFASTS",4)

"BLD",5419,"KRN",19,"NM","B","LRGV",5)

"BLD",5419,"KRN",19,"NM","B","LRNONCOM",6)

"BLD",5419,"KRN",19,"NM","B","LRSTUF",7)

"BLD",5419,"KRN",19,"NM","B","LRVR",8)

"BLD",5419,"KRN",19,"NM","B","LRVRW",9)

"BLD",5419,"KRN",19,"NM","B","LRVRW2",10)

"BLD",5419,"KRN",19.1,0)
19.1
"BLD",5419,"KRN",101,0)
101
"BLD",5419,"KRN",409.61,0)
409.61
"BLD",5419,"KRN",771,0)
771
"BLD",5419,"KRN",870,0)
870
"BLD",5419,"KRN",8989.51,0)
8989.51
"BLD",5419,"KRN",8989.52,0)
8989.52
"BLD",5419,"KRN",8994,0)
8994
"BLD",5419,"KRN","B",.4,.4)

"BLD",5419,"KRN","B",.401,.401)

"BLD",5419,"KRN","B",.402,.402)

"BLD",5419,"KRN","B",.403,.403)

"BLD",5419,"KRN","B",.5,.5)

"BLD",5419,"KRN","B",.84,.84)

"BLD",5419,"KRN","B",3.6,3.6)

"BLD",5419,"KRN","B",3.8,3.8)

"BLD",5419,"KRN","B",9.2,9.2)

"BLD",5419,"KRN","B",9.8,9.8)

"BLD",5419,"KRN","B",19,19)

"BLD",5419,"KRN","B",19.1,19.1)

"BLD",5419,"KRN","B",101,101)

"BLD",5419,"KRN","B",409.61,409.61)

"BLD",5419,"KRN","B",771,771)

"BLD",5419,"KRN","B",870,870)

"BLD",5419,"KRN","B",8989.51,8989.51)

"BLD",5419,"KRN","B",8989.52,8989.52)

"BLD",5419,"KRN","B",8994,8994)

"BLD",5419,"PRE")
LA70
"BLD",5419,"QUES",0)
^9.62^^
"BLD",5419,"REQB",0)
^9.611^1^1
"BLD",5419,"REQB",1,0)
LA*5.2*46^1
"BLD",5419,"REQB","B","LA*5.2*46",1)

"INI")
PRE^LA70
"INIT")
POST^LA70
"KRN",19,600,-1)
5^2
"KRN",19,600,0)
LRENTER
"KRN",19,611,-1)
5^3
"KRN",19,611,0)
LRFAST
"KRN",19,651,-1)
5^6
"KRN",19,651,0)
LRNONCOM
"KRN",19,661,-1)
5^5
"KRN",19,661,0)
LRGV
"KRN",19,664,-1)
5^8
"KRN",19,664,0)
LRVR
"KRN",19,684,-1)
5^7
"KRN",19,684,0)
LRSTUF
"KRN",19,727,-1)
5^9
"KRN",19,727,0)
LRVRW
"KRN",19,728,-1)
5^10
"KRN",19,728,0)
LRVRW2
"KRN",19,1041,-1)
5^1
"KRN",19,1041,0)
LR ACC THEN DATA
"KRN",19,8003,-1)
5^4
"KRN",19,8003,0)
LRFASTS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",53,-1)
1^1
"PKG",53,0)
AUTOMATED LAB INSTRUMENTS^LA^Lab Auto-Instrument Package
"PKG",53,22,0)
^9.49I^1^1
"PKG",53,22,1,0)
5.2^2940927^2950125
"PKG",53,22,1,"PAH",1,0)
70^3040827^6686
"PKG",53,22,1,"PAH",1,1,0)
^^1^1^3040827
"PKG",53,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module
"PRE")
LA70
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LA70")
0^^B9127154
"RTN","LA70",1,0)
LA70 ;DALOI/JMC - LA*5.2*70 PATCH ENVIRONMENT CHECK ROUTINE ; 8/23/04 2:08pm
"RTN","LA70",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**70**;Sep 27, 1994
"RTN","LA70",3,0)
EN ;
"RTN","LA70",4,0)
 ; Does not prevent loading of the transport global.
"RTN","LA70",5,0)
 ; Environment check is done only during the install.
"RTN","LA70",6,0)
 ;
"RTN","LA70",7,0)
 N XQA,XQAMSG
"RTN","LA70",8,0)
 ;
"RTN","LA70",9,0)
 I '$G(XPDENV) D  Q
"RTN","LA70",10,0)
 . S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")_" loaded on "_$$HTE^XLFDT($H)
"RTN","LA70",11,0)
 . S XQA("G.LMI")=""
"RTN","LA70",12,0)
 . D SETUP^XQALERT
"RTN","LA70",13,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Sending transport global loaded alert to mail group G.LMI",80))
"RTN","LA70",14,0)
 ;
"RTN","LA70",15,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" started on "_$$HTE^XLFDT($H)
"RTN","LA70",16,0)
 S XQA("G.LMI")=""
"RTN","LA70",17,0)
 D SETUP^XQALERT
"RTN","LA70",18,0)
 D CHECK
"RTN","LA70",19,0)
 D EXIT
"RTN","LA70",20,0)
 Q
"RTN","LA70",21,0)
 ;
"RTN","LA70",22,0)
CHECK ;
"RTN","LA70",23,0)
 ; Perform environment check
"RTN","LA70",24,0)
 ; Device Defined
"RTN","LA70",25,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LA70",26,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LA70",27,0)
 . S XPDQUIT=2
"RTN","LA70",28,0)
 ; DUZ setup
"RTN","LA70",29,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LA70",30,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Please log in to set local DUZ... variables",80))
"RTN","LA70",31,0)
 . S XPDQUIT=2
"RTN","LA70",32,0)
 ; Active User
"RTN","LA70",33,0)
 I $P($$ACTIVE^XUSER(DUZ),"^")'=1 D  Q
"RTN","LA70",34,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("You are not a valid user on this system",80))
"RTN","LA70",35,0)
 . S XPDQUIT=2
"RTN","LA70",36,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LA70",37,0)
 Q
"RTN","LA70",38,0)
 ;
"RTN","LA70",39,0)
EXIT ;
"RTN","LA70",40,0)
 ;
"RTN","LA70",41,0)
 I $G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Install Environment Check FAILED ---",80))
"RTN","LA70",42,0)
 I '$G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LA70",43,0)
 Q
"RTN","LA70",44,0)
 ;
"RTN","LA70",45,0)
PRE ;
"RTN","LA70",46,0)
 ;; KIDS Pre Install
"RTN","LA70",47,0)
 N DA,DIK
"RTN","LA70",48,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install started alert to mail group G.LMI",80))
"RTN","LA70",49,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LA70",50,0)
 D BMES^XPDUTL($$CJ^XLFSTR("--- No actions required for pre install ---",80))
"RTN","LA70",51,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LA70",52,0)
 Q
"RTN","LA70",53,0)
 ;
"RTN","LA70",54,0)
POST ;
"RTN","LA70",55,0)
 ;; KIDS Post Install
"RTN","LA70",56,0)
 N DA,DIK,FDA,LA7X,LA7ERR,XQA,XQAMSG
"RTN","LA70",57,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LA70",58,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LA70",59,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install completion alert to mail group G.LMI",80))
"RTN","LA70",60,0)
 ; Send alert
"RTN","LA70",61,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" completed on "_$$HTE^XLFDT($H)
"RTN","LA70",62,0)
 S XQA("G.LMI")=""
"RTN","LA70",63,0)
 D SETUP^XQALERT
"RTN","LA70",64,0)
 Q
"RTN","LA7VOBXA")
0^1^B32444628
"RTN","LA7VOBXA",1,0)
LA7VOBXA ;DALOI/JMC - LAB OBX Segment message builder (cont'd) ; 11-17-98
"RTN","LA7VOBXA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,70**;Sep 27, 1994
"RTN","LA7VOBXA",3,0)
 ;
"RTN","LA7VOBXA",4,0)
 Q
"RTN","LA7VOBXA",5,0)
 ;
"RTN","LA7VOBXA",6,0)
OBX2 ; Build OBX-2 sequence - Value type
"RTN","LA7VOBXA",7,0)
 ;
"RTN","LA7VOBXA",8,0)
 ; default value - string data
"RTN","LA7VOBXA",9,0)
 S LA7VAL="ST"
"RTN","LA7VOBXA",10,0)
 S LA7TYP="",LA7FILE=$G(LA7FILE),LA7FIELD=$G(LA7FIELD)
"RTN","LA7VOBXA",11,0)
 ;
"RTN","LA7VOBXA",12,0)
 I LA7FILE,LA7FIELD S LA7TYP=$$GET1^DID(LA7FILE,LA7FIELD,"","TYPE","","LA7ERR")
"RTN","LA7VOBXA",13,0)
 ;
"RTN","LA7VOBXA",14,0)
 I LA7TYP="DATE/TIME" S LA7VAL="TS"
"RTN","LA7VOBXA",15,0)
 I LA7TYP="FREE TEXT" S LA7VAL="ST"
"RTN","LA7VOBXA",16,0)
 I LA7TYP="WORD-PROCESSING" S LA7VAL="FT"
"RTN","LA7VOBXA",17,0)
 I LA7TYP="NUMERIC" S LA7VAL="NM"
"RTN","LA7VOBXA",18,0)
 I LA7TYP="SET OF CODES" S LA7VAL="CE"
"RTN","LA7VOBXA",19,0)
 I LA7TYP="POINTER" S LA7VAL="CE"
"RTN","LA7VOBXA",20,0)
 ;
"RTN","LA7VOBXA",21,0)
 Q
"RTN","LA7VOBXA",22,0)
 ;
"RTN","LA7VOBXA",23,0)
 ;
"RTN","LA7VOBXA",24,0)
OBX3 ; Build OBX-3 sequence - Observation identifier field
"RTN","LA7VOBXA",25,0)
 ;
"RTN","LA7VOBXA",26,0)
 ; Initialize variables 
"RTN","LA7VOBXA",27,0)
 S LA7J=1,LA7Y=""
"RTN","LA7VOBXA",28,0)
 ;
"RTN","LA7VOBXA",29,0)
 ; Identify file #64 entry from NLT code.
"RTN","LA7VOBXA",30,0)
 ; If no LOINC code passed then use default LOINC code from #64 if specified.
"RTN","LA7VOBXA",31,0)
 I $L(LA7NLT) D
"RTN","LA7VOBXA",32,0)
 . ;S LA764=$$FIND1^DIC(64,"","OMX",LA7NLT)
"RTN","LA7VOBXA",33,0)
 . S LA764=$O(^LAM("E",LA7NLT,0))
"RTN","LA7VOBXA",34,0)
 . I LA764,LA7953="" S LA7953=$$GET1^DIQ(64,LA764_",",25,"I")
"RTN","LA7VOBXA",35,0)
 ;
"RTN","LA7VOBXA",36,0)
 ; Build sequence using LOINC codes only
"RTN","LA7VOBXA",37,0)
 ; LOINC code/code name/"LN"
"RTN","LA7VOBXA",38,0)
 I $L(LA7953) D
"RTN","LA7VOBXA",39,0)
 . N LA7IENS,LA7X,LA7Z
"RTN","LA7VOBXA",40,0)
 . S LA7953=$P(LA7953,"-")
"RTN","LA7VOBXA",41,0)
 . S LA7IENS=LA7953_","
"RTN","LA7VOBXA",42,0)
 . D GETS^DIQ(95.3,LA7IENS,".01;80","E","LA7X")
"RTN","LA7VOBXA",43,0)
 . ; Invalid code???
"RTN","LA7VOBXA",44,0)
 . I $G(LA7X(95.3,LA7IENS,.01,"E"))="" Q
"RTN","LA7VOBXA",45,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3($G(LA7X(95.3,LA7IENS,.01,"E")),LA7FS_LA7ECH)
"RTN","LA7VOBXA",46,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7Z
"RTN","LA7VOBXA",47,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3($G(LA7X(95.3,LA7IENS,80,"E")),LA7FS_LA7ECH)
"RTN","LA7VOBXA",48,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",49,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="LN"
"RTN","LA7VOBXA",50,0)
 . S LA7J=4
"RTN","LA7VOBXA",51,0)
 ;
"RTN","LA7VOBXA",52,0)
 ; Build sequence using NLT codes
"RTN","LA7VOBXA",53,0)
 ; File #64 NLT code/NLT code name/"99VA64"
"RTN","LA7VOBXA",54,0)
 I $L(LA7NLT) D
"RTN","LA7VOBXA",55,0)
 . N LA764,LA7Z
"RTN","LA7VOBXA",56,0)
 . ; If LOINC is primary make NLT alternate, otherwise NLT primary.
"RTN","LA7VOBXA",57,0)
 . ;S LA764=$$FIND1^DIC(64,"","OMX",LA7NLT)
"RTN","LA7VOBXA",58,0)
 . S LA764=$O(^LAM("E",LA7NLT,0))
"RTN","LA7VOBXA",59,0)
 . I 'LA764 Q
"RTN","LA7VOBXA",60,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7NLT
"RTN","LA7VOBXA",61,0)
 . S LA7Z=$$GET1^DIQ(64,LA764_",",.01)
"RTN","LA7VOBXA",62,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",63,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",64,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="99VA64"
"RTN","LA7VOBXA",65,0)
 . S LA7J=LA7J+3
"RTN","LA7VOBXA",66,0)
 ;
"RTN","LA7VOBXA",67,0)
 ;
"RTN","LA7VOBXA",68,0)
 ; Non-standard/non-VA code
"RTN","LA7VOBXA",69,0)
 ; Don't use alternate code when it's "99VA63" and we've already encoded
"RTN","LA7VOBXA",70,0)
 ; a primary and alternate. If alternate is a non-VA code then use as
"RTN","LA7VOBXA",71,0)
 ; alternate code.
"RTN","LA7VOBXA",72,0)
 ; If primary and alternate are not 99VA63 then code 3rd triplet with
"RTN","LA7VOBXA",73,0)
 ; 99VA63 per Julius Chou for Clinical Case Registry (JMC/May 13, 2004)
"RTN","LA7VOBXA",74,0)
 I LA7ALT="" Q
"RTN","LA7VOBXA",75,0)
 I $P(LA7ALT,"^",3)'="99VA63",LA7J>4 S LA7J=4
"RTN","LA7VOBXA",76,0)
 I $P(LA7ALT,"^",3)="99VA63" D  Q:LA7J=0
"RTN","LA7VOBXA",77,0)
 . I $P(LA7Y,$E(LA7ECH,1),3)="99VA63" S LA7J=0 Q
"RTN","LA7VOBXA",78,0)
 . I LA7J>4,$P(LA7Y,$E(LA7ECH,1),6)="99VA63" S LA7J=0 Q
"RTN","LA7VOBXA",79,0)
 . I LA7J>4 S LA7J=7
"RTN","LA7VOBXA",80,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^"),LA7FS_LA7ECH)
"RTN","LA7VOBXA",81,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",2),LA7FS_LA7ECH)
"RTN","LA7VOBXA",82,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J+2)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",3),LA7FS_LA7ECH)
"RTN","LA7VOBXA",83,0)
 ;
"RTN","LA7VOBXA",84,0)
 Q
"RTN","LA7VOBXA",85,0)
 ;
"RTN","LA7VOBXA",86,0)
 ;
"RTN","LA7VOBXA",87,0)
OBX5 ; Build OBX-5 sequence - Observation value
"RTN","LA7VOBXA",88,0)
 ; Removes trailing spaces on string and text results.
"RTN","LA7VOBXA",89,0)
 ; Removes leading & trailing spaces on numeric results.
"RTN","LA7VOBXA",90,0)
 ;
"RTN","LA7VOBXA",91,0)
 S LA7Y=""
"RTN","LA7VOBXA",92,0)
 ;
"RTN","LA7VOBXA",93,0)
 I $G(LA7OBX2)="" S LA7OBX2="ST" ; default value type
"RTN","LA7VOBXA",94,0)
 I LA7OBX2="ST"!(LA7OBX2="TX") D
"RTN","LA7VOBXA",95,0)
 . S LA7VAL=$$TRIM^XLFSTR(LA7VAL,"R"," ")
"RTN","LA7VOBXA",96,0)
 . S LA7Y=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VOBXA",97,0)
 I LA7OBX2="NM" S LA7Y=$$TRIM^XLFSTR(LA7VAL,"RL"," ")
"RTN","LA7VOBXA",98,0)
 I LA7OBX2="TS" D
"RTN","LA7VOBXA",99,0)
 . S LA7VAL=$$CHKDT^LA7VHLU1(LA7VAL)
"RTN","LA7VOBXA",100,0)
 . S LA7Y=$$FMTHL7^XLFDT(LA7VAL)
"RTN","LA7VOBXA",101,0)
 I LA7OBX2="CE" D
"RTN","LA7VOBXA",102,0)
 . N I,X
"RTN","LA7VOBXA",103,0)
 . F I=1:1:6 D
"RTN","LA7VOBXA",104,0)
 . . I '$L($P(LA7VAL,"^",I)) Q
"RTN","LA7VOBXA",105,0)
 . . S X=$$CHKDATA^LA7VHLU3($P(LA7VAL,"^",I),LA7FS_LA7ECH)
"RTN","LA7VOBXA",106,0)
 . . S $P(LA7Y,$E(LA7ECH),I)=X
"RTN","LA7VOBXA",107,0)
 ;
"RTN","LA7VOBXA",108,0)
 Q
"RTN","LA7VOBXA",109,0)
 ;
"RTN","LA7VOBXA",110,0)
 ;
"RTN","LA7VOBXA",111,0)
OBX5M ; Build OBX-5 sequence - Observation value - multi-line textual result
"RTN","LA7VOBXA",112,0)
 ;
"RTN","LA7VOBXA",113,0)
 K LA7WP
"RTN","LA7VOBXA",114,0)
 ;
"RTN","LA7VOBXA",115,0)
 S LA7WP=""
"RTN","LA7VOBXA",116,0)
 S LA7TYPE=$$GET1^DID(LA7FN,LA7FLD,"","TYPE","LA7ERR(1)")
"RTN","LA7VOBXA",117,0)
 ;
"RTN","LA7VOBXA",118,0)
 ; Process word-processing type field.
"RTN","LA7VOBXA",119,0)
 ; Check and encode data
"RTN","LA7VOBXA",120,0)
 I LA7TYPE="WORD-PROCESSING" D  Q
"RTN","LA7VOBXA",121,0)
 . N DIWF,DIWL,DIWR,X
"RTN","LA7VOBXA",122,0)
 . S LA7WP=$$GET1^DIQ(LA7FN,LA7IENS,LA7FLD,"","LA7WP","LA7ERR(2)")
"RTN","LA7VOBXA",123,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",124,0)
 . S DIWL=1,DIWR=245,DIWF="",LA7I=0
"RTN","LA7VOBXA",125,0)
 . I $$GET1^DID(+$$GET1^DID(LA7FN,LA7FLD,"","SPECIFIER","LA7ERR(1)"),.01,"","SPECIFIER","LA7ERR(3)")["L" S DIWF="N"
"RTN","LA7VOBXA",126,0)
 . F  S LA7I=$O(LA7WP(LA7I)) Q:'LA7I  S X=LA7WP(LA7I) D ^DIWP
"RTN","LA7VOBXA",127,0)
 . K LA7WP
"RTN","LA7VOBXA",128,0)
 . S LA7I=0
"RTN","LA7VOBXA",129,0)
 . F  S LA7I=$O(^UTILITY($J,"W",DIWL,LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",130,0)
 . . S LA7WP(LA7I)=$$CHKDATA^LA7VHLU3(^UTILITY($J,"W",DIWL,LA7I,0),LA7FS_LA7ECH)
"RTN","LA7VOBXA",131,0)
 . . I LA7I>1 S LA7WP(LA7I)=$E(LA7ECH,3)_".br"_$E(LA7ECH,3)_LA7WP(LA7I)
"RTN","LA7VOBXA",132,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",133,0)
 ;
"RTN","LA7VOBXA",134,0)
 ; Free text, assumes multiple valued
"RTN","LA7VOBXA",135,0)
 I LA7TYPE="FREE TEXT" D
"RTN","LA7VOBXA",136,0)
 . D GETS^DIQ(LA7FN,LA7IENS,LA7FLD_"*","","LA7WP","LA7ERR")
"RTN","LA7VOBXA",137,0)
 ;
"RTN","LA7VOBXA",138,0)
 Q
"RTN","LA7VOBXA",139,0)
 ;
"RTN","LA7VOBXA",140,0)
 ;
"RTN","LA7VOBXA",141,0)
OBX5R ; Build OBX-5 sequence with repetition - Observation value
"RTN","LA7VOBXA",142,0)
 ;
"RTN","LA7VOBXA",143,0)
 S (LA7I,LA7Y)=""
"RTN","LA7VOBXA",144,0)
 F  S LA7I=$O(LA7VAL(LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",145,0)
 . S LA7Y=LA7Y_$$OBX5^LA7VOBX(LA7VAL(LA7I),LA7OBX2,LA7FS,LA7ECH)_$E(LA7ECH,2)
"RTN","LA7VOBXA",146,0)
 ;
"RTN","LA7VOBXA",147,0)
 Q
"RTN","LA7VOBXA",148,0)
 ;
"RTN","LA7VOBXA",149,0)
 ;
"RTN","LA7VOBXA",150,0)
OBX6 ; Build OBX-6 sequence - Units
"RTN","LA7VOBXA",151,0)
 ;
"RTN","LA7VOBXA",152,0)
 S LA7ECH=$G(LA7ECH),LA7Y=""
"RTN","LA7VOBXA",153,0)
 ;
"RTN","LA7VOBXA",154,0)
 I $L($G(LA7VAL)) S LA7Y=LA7VAL ; unit
"RTN","LA7VOBXA",155,0)
 ;
"RTN","LA7VOBXA",156,0)
 ; Build sequence using LOINC codes only
"RTN","LA7VOBXA",157,0)
 ; LOINC code/code name/"LN"
"RTN","LA7VOBXA",158,0)
 I $G(LA764061) D
"RTN","LA7VOBXA",159,0)
 . N LA7IENS,LA7X,LA7Z
"RTN","LA7VOBXA",160,0)
 . S LA7IENS=LA764061_","
"RTN","LA7VOBXA",161,0)
 . D GETS^DIQ(64.061,LA7IENS,".01;1","E","LA7X")
"RTN","LA7VOBXA",162,0)
 . ; LOINC code
"RTN","LA7VOBXA",163,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,.01,"E"))
"RTN","LA7VOBXA",164,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",165,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=LA7Z
"RTN","LA7VOBXA",166,0)
 . ; LOINC code name
"RTN","LA7VOBXA",167,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,1,"E"))
"RTN","LA7VOBXA",168,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",169,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7Z
"RTN","LA7VOBXA",170,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)="LN"
"RTN","LA7VOBXA",171,0)
 ;
"RTN","LA7VOBXA",172,0)
 Q
"RTN","LA7VOBXA",173,0)
 ;
"RTN","LA7VOBXA",174,0)
 ;
"RTN","LA7VOBXA",175,0)
OBX7 ; Build OBX-7 sequence - Reference range
"RTN","LA7VOBXA",176,0)
 ; Removes leading and trailing quote marks ("").
"RTN","LA7VOBXA",177,0)
 ;
"RTN","LA7VOBXA",178,0)
 S LA7Y=""
"RTN","LA7VOBXA",179,0)
 ;
"RTN","LA7VOBXA",180,0)
 I $L($G(LA7LOW)) D
"RTN","LA7VOBXA",181,0)
 . S LA7LOW=$$TRIM^XLFSTR(LA7LOW,"RL","""")
"RTN","LA7VOBXA",182,0)
 . I LA7LOW?1A.E S LA7Y=LA7Y_LA7LOW Q  ; alphabetic value
"RTN","LA7VOBXA",183,0)
 . I $L($G(LA7HIGH))="",$E(LA7LOW)'=">" S LA7Y=">"
"RTN","LA7VOBXA",184,0)
 . S LA7Y=LA7Y_LA7LOW
"RTN","LA7VOBXA",185,0)
 ;
"RTN","LA7VOBXA",186,0)
 I $L($G(LA7HIGH)) D
"RTN","LA7VOBXA",187,0)
 . S LA7HIGH=$$TRIM^XLFSTR(LA7HIGH,"RL","""")
"RTN","LA7VOBXA",188,0)
 . I LA7HIGH?1A.E S LA7Y=LA7Y_LA7HIGH Q  ; alphabetic value
"RTN","LA7VOBXA",189,0)
 . I '$L($G(LA7LOW)) D  Q
"RTN","LA7VOBXA",190,0)
 . . I $E(LA7HIGH)'="<" S LA7Y="<"
"RTN","LA7VOBXA",191,0)
 . . S LA7Y=LA7Y_LA7HIGH
"RTN","LA7VOBXA",192,0)
 . S LA7Y=LA7Y_"-"_LA7HIGH
"RTN","LA7VOBXA",193,0)
 ;
"RTN","LA7VOBXA",194,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBXA",195,0)
 ;
"RTN","LA7VOBXA",196,0)
 Q
"VER")
8.0^22.0
**END**
**END**
