Released ECX*3*28 SEQ #25
Extracted from mail message
**KIDS**:ECX*3.0*28^

**INSTALL NAME**
ECX*3.0*28
"BLD",2017,0)
ECX*3.0*28^DSS EXTRACTS^0^2990701^y
"BLD",2017,4,0)
^9.64PA^^
"BLD",2017,"KRN",0)
^9.67PA^19^18
"BLD",2017,"KRN",.4,0)
.4
"BLD",2017,"KRN",.401,0)
.401
"BLD",2017,"KRN",.402,0)
.402
"BLD",2017,"KRN",.403,0)
.403
"BLD",2017,"KRN",.5,0)
.5
"BLD",2017,"KRN",.84,0)
.84
"BLD",2017,"KRN",3.6,0)
3.6
"BLD",2017,"KRN",3.8,0)
3.8
"BLD",2017,"KRN",9.2,0)
9.2
"BLD",2017,"KRN",9.8,0)
9.8
"BLD",2017,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",2017,"KRN",9.8,"NM",1,0)
ECXSCX^^0^B68772883
"BLD",2017,"KRN",9.8,"NM",2,0)
ECXSCX1^^0^B9609156
"BLD",2017,"KRN",9.8,"NM",3,0)
ECXLABN^^0^B14742849
"BLD",2017,"KRN",9.8,"NM","B","ECXLABN",3)

"BLD",2017,"KRN",9.8,"NM","B","ECXSCX",1)

"BLD",2017,"KRN",9.8,"NM","B","ECXSCX1",2)

"BLD",2017,"KRN",19,0)
19
"BLD",2017,"KRN",19.1,0)
19.1
"BLD",2017,"KRN",101,0)
101
"BLD",2017,"KRN",409.61,0)
409.61
"BLD",2017,"KRN",771,0)
771
"BLD",2017,"KRN",869.2,0)
869.2
"BLD",2017,"KRN",870,0)
870
"BLD",2017,"KRN",8994,0)
8994
"BLD",2017,"KRN","B",.4,.4)

"BLD",2017,"KRN","B",.401,.401)

"BLD",2017,"KRN","B",.402,.402)

"BLD",2017,"KRN","B",.403,.403)

"BLD",2017,"KRN","B",.5,.5)

"BLD",2017,"KRN","B",.84,.84)

"BLD",2017,"KRN","B",3.6,3.6)

"BLD",2017,"KRN","B",3.8,3.8)

"BLD",2017,"KRN","B",9.2,9.2)

"BLD",2017,"KRN","B",9.8,9.8)

"BLD",2017,"KRN","B",19,19)

"BLD",2017,"KRN","B",19.1,19.1)

"BLD",2017,"KRN","B",101,101)

"BLD",2017,"KRN","B",409.61,409.61)

"BLD",2017,"KRN","B",771,771)

"BLD",2017,"KRN","B",869.2,869.2)

"BLD",2017,"KRN","B",870,870)

"BLD",2017,"KRN","B",8994,8994)

"BLD",2017,"QUES",0)
^9.62^^
"BLD",2017,"REQB",0)
^9.611^1^1
"BLD",2017,"REQB",1,0)
ECX*3.0*14^2
"BLD",2017,"REQB","B","ECX*3.0*14",1)

"MBREQ")
0
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
28^2990701
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ECXLABN")
0^3^B14742849
"RTN","ECXLABN",1,0)
ECXLABN ;ALB/JAP,BIR/CML-Lab Extract for DSS (New Format - With LMIP Codes) ; [ 11/22/96  5:14 PM ]
"RTN","ECXLABN",2,0)
 ;;3.0;DSS EXTRACTS;**1,11,8,13,28**;Dec 22, 1997
"RTN","ECXLABN",3,0)
BEG ;entry point
"RTN","ECXLABN",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXLABN",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXLABN",6,0)
 Q
"RTN","ECXLABN",7,0)
 ;
"RTN","ECXLABN",8,0)
START ; entry when queued
"RTN","ECXLABN",9,0)
 N QFLG
"RTN","ECXLABN",10,0)
 S QFLG=0
"RTN","ECXLABN",11,0)
 K ^LRO(64.03)
"RTN","ECXLABN",12,0)
 S LRSDT=ECSD,LREDT=ECED
"RTN","ECXLABN",13,0)
 D ^LRCAPDSS
"RTN","ECXLABN",14,0)
 ;quit if no completion date for API compile
"RTN","ECXLABN",15,0)
 I '$P($G(^LRO(64.03,1,1,1,0)),U,4) Q
"RTN","ECXLABN",16,0)
 ;quit if tasked and user sends stop request
"RTN","ECXLABN",17,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD D  Q
"RTN","ECXLABN",18,0)
 .K ^LRO(64.03) S ^LRO(64.03,0)="WKLD LOG FILE^64.03^"
"RTN","ECXLABN",19,0)
 ;otherwise, continue
"RTN","ECXLABN",20,0)
 K ECXDD D FIELD^DID(64.03,1,,"SPECIFIER","ECXDD") S ECPROF=$E(+$P(ECXDD("SPECIFIER"),"P",2)) K ECXDD
"RTN","ECXLABN",21,0)
 S ECLRN=1
"RTN","ECXLABN",22,0)
 F  S ECLRN=$O(^LRO(64.03,ECLRN)) Q:'ECLRN  D  Q:QFLG
"RTN","ECXLABN",23,0)
 .Q:'$D(^LRO(64.03,ECLRN,0))
"RTN","ECXLABN",24,0)
 .S EC1=^LRO(64.03,ECLRN,0)
"RTN","ECXLABN",25,0)
 .S ECDOC=ECPROF_$P(EC1,U,2),ECLOC=$P(EC1,U,15),EC=$P(EC1,U,3)
"RTN","ECXLABN",26,0)
 .I EC]"" D GET
"RTN","ECXLABN",27,0)
 K ^LRO(64.03) S ^LRO(64.03,0)="WKLD LOG FILE^64.03^"
"RTN","ECXLABN",28,0)
 Q
"RTN","ECXLABN",29,0)
 ;
"RTN","ECXLABN",30,0)
GET ;get data
"RTN","ECXLABN",31,0)
 N X
"RTN","ECXLABN",32,0)
 S ECF=$S($P(EC,";",2)="DPT(":2,$P(EC,";",2)="LRT(67,":67,1:0) Q:'ECF
"RTN","ECXLABN",33,0)
 S ECIFN=$P(EC,";")
"RTN","ECXLABN",34,0)
 ;resolve ecloc
"RTN","ECXLABN",35,0)
 S ECXL1=+$P(ECLOC,";",1),ECXL2=$P(ECLOC,";",2)
"RTN","ECXLABN",36,0)
 I ECF=2 S ECLOC=$S(ECXL1>0:ECXL1,1:"") I ECXL2]"",ECXL2'="SC(" S ECLOC=""
"RTN","ECXLABN",37,0)
 I ECF=67 D  S ECLOC=ECXSTN
"RTN","ECXLABN",38,0)
 .S (ECXSTN,ECXAGC)=""
"RTN","ECXLABN",39,0)
 .I ECXL2'="DIC(4," S ECXSTN="XXXXX",ECXAGC="XX" Q
"RTN","ECXLABN",40,0)
 .I '$D(^DIC(4,ECXL1)) S ECXSTN="XXXXX",ECXAGC="XX" Q
"RTN","ECXLABN",41,0)
 .I $D(^DIC(4,ECXL1)) S ECXSTN=$P(^DIC(4,ECXL1,"99"),U,1),ECXAGC=$E($P(^(99),U,5),1,2) S:ECXSTN="" ECXSTN="ZZZZZ" S:ECXAGC="" ECXAGC="ZZ"
"RTN","ECXLABN",42,0)
 S ECDT=$P(EC1,U,13),ECD=$P(ECDT,"."),ECTM=$$ECXTIME^ECXUTL(ECDT)
"RTN","ECXLABN",43,0)
 S ECWKLD=$P(EC1,U,11),ECWK="" I $D(^LAM(ECWKLD,0)) S ECWK=$P(^(0),U,2)
"RTN","ECXLABN",44,0)
 S (ECNA,ECSN,ECMN,ECPTTM,ECPTPR,ECCLAS)="",ECA=1
"RTN","ECXLABN",45,0)
 ;get the patient data if record is in file #2
"RTN","ECXLABN",46,0)
 I ECF=2,$D(^DPT(ECIFN,0)) D
"RTN","ECXLABN",47,0)
 .S EC0=^DPT(ECIFN,0),ECNA=$E($P($P(EC0,U),",")_"    ",1,4),ECSN=$P(EC0,U,9)
"RTN","ECXLABN",48,0)
 .S X=$$INP^ECXUTL2(ECIFN,ECD),ECA=$P(X,U,1),ECMN=$P(X,U,2)
"RTN","ECXLABN",49,0)
 .S X=$$PRIMARY^ECXUTL2(ECIFN,ECD,ECPROF),ECPTTM=$P(X,U,1),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3)
"RTN","ECXLABN",50,0)
 ;get patient data if record is in file #67
"RTN","ECXLABN",51,0)
 I ECF=67 S ECSN="000123456",ECNA="RFRL" I $D(^LRT(67,ECIFN,0)) D
"RTN","ECXLABN",52,0)
 .S EC0=^LRT(67,ECIFN,0),ECNA=$E($P($P(EC0,U),",")_"    ",1,4),ECSN=$P(EC0,U,9) D
"RTN","ECXLABN",53,0)
 ..S ECNA=$TR(ECNA,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ECXLABN",54,0)
 ..I ECSN="" S ECSN="000123456" Q
"RTN","ECXLABN",55,0)
 ..S ECSN=$TR(ECSN," "),ECSN=$TR(ECSN,"-")
"RTN","ECXLABN",56,0)
 ..I ($L(ECSN)<9)!($L(ECSN)>10) S ECSN="000123456" Q
"RTN","ECXLABN",57,0)
 ..I $L(ECSN)=9,ECSN'?9N S ECSN="000123456" Q
"RTN","ECXLABN",58,0)
 ..I $L(ECSN)=10,ECSN'?9N1"P" S ECSN="000123456"
"RTN","ECXLABN",59,0)
 S ECTREAT=$P(EC1,U,10) I ECTREAT S ECTREAT=$P($G(^DIC(45.7,+ECTREAT,0)),U,2)
"RTN","ECXLABN",60,0)
 ;create extract record only if patient name and accession area exist
"RTN","ECXLABN",61,0)
 I ECNA]"" S ECT=$P(EC1,U,8),ECURG=$P(EC1,U,9),EC=+$P(EC1,U,7) I EC D
"RTN","ECXLABN",62,0)
 .S:ECF=2 ECACA=EC_U_$P($G(^LRO(68,EC,0)),U,11) S:ECF=67 ECACA=ECXAGC_U_$P($G(^LRO(68,EC,0)),U,11)
"RTN","ECXLABN",63,0)
 .D FILE
"RTN","ECXLABN",64,0)
 Q
"RTN","ECXLABN",65,0)
 ;
"RTN","ECXLABN",66,0)
FILE ;file record
"RTN","ECXLABN",67,0)
 ;node0
"RTN","ECXLABN",68,0)
 ;inst^patient number^SSN (or equivalent)^name^in/out^day^accession area^abbreviation^test^urgency^treating spec^location^provider and file^
"RTN","ECXLABN",69,0)
 ;movement number^file^time^workload code^primary care team^primary care provider
"RTN","ECXLABN",70,0)
 ;node1
"RTN","ECXLABN",71,0)
 ;mpi^dss dept^provider npi^pc provider npi^pc prov person class
"RTN","ECXLABN",72,0)
 N DA,DIK
"RTN","ECXLABN",73,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXLABN",74,0)
 S ECODE=EC7_U_EC23
"RTN","ECXLABN",75,0)
 S ECODE=ECODE_U_ECINST_U_ECIFN_U_ECSN_U_ECNA_U_ECA_U_$$ECXDATE^ECXUTL(ECD,ECXYM)_U_ECACA_U_ECT_U_ECURG_U_ECTREAT_U_ECLOC_U_ECDOC_U_ECMN_U_ECF_U_ECTM_U_ECWK_U_ECPTTM_U_ECPTPR
"RTN","ECXLABN",76,0)
 ;(ECACA=acc area^abbreviation)
"RTN","ECXLABN",77,0)
 S ECODE1=U_U_U_U_ECCLAS
"RTN","ECXLABN",78,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXLABN",79,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXLABN",80,0)
 I $D(ZTQUEUED),ECRN>499,'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXLABN",81,0)
 Q
"RTN","ECXLABN",82,0)
 ;
"RTN","ECXLABN",83,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXLABN",84,0)
 S ECHEAD="LAB"
"RTN","ECXLABN",85,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXLABN",86,0)
 Q
"RTN","ECXLABN",87,0)
 ;
"RTN","ECXLABN",88,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXLABN",89,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXSCX")
0^1^B68772883
"RTN","ECXSCX",1,0)
ECXSCX ;ALB/JAP,BIR/DMA,CML,PTD-Clinic Extract ; 02/06/97 10:24 [ 03/26/97  2:10 PM ]
"RTN","ECXSCX",2,0)
 ;;3.0;DSS EXTRACTS;**1,3,11,8,13,14,28**;Dec 22, 1997
"RTN","ECXSCX",3,0)
BEG ;entry point from option
"RTN","ECXSCX",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSCX",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSCX",6,0)
 Q
"RTN","ECXSCX",7,0)
 ;
"RTN","ECXSCX",8,0)
START ;entry point
"RTN","ECXSCX",9,0)
 N QFLG,TIU
"RTN","ECXSCX",10,0)
 ;get ien for tiu in file #839.7
"RTN","ECXSCX",11,0)
 S DIC="^PX(839.7,",DIC(0)="X",X="TEXT INTEGRATION UTILITIES" D ^DIC S TIU=0 S:+Y>0 TIU=+Y K DIC,Y
"RTN","ECXSCX",12,0)
 K ^TMP("ECXS",$J) S ECXMISS=10,ECED=ECED+.3 S SC=0,QFLG=0
"RTN","ECXSCX",13,0)
 ;scheduled appts. and appended ekgs: loop through the file (#44)
"RTN","ECXSCX",14,0)
 F  S SC=$O(^SC(SC)) Q:('SC)!(QFLG)  I $D(^(SC,0)) S EC=^(0) I $P(EC,U,3)="C" S ECSU=$P(EC,U,15) S:'ECSU ECSU=1 D FEEDER^ECXSCX1(SC,ECSD1,.P1,.P2,.P3,.ECST) I ECST'=6 S ECD=ECSD1 D  Q:QFLG
"RTN","ECXSCX",15,0)
 .F  S ECD=$O(^SC(SC,"S",ECD)) Q:'ECD  Q:ECD>ECED  Q:QFLG  S ECDA=0 F  S ECDA=$O(^SC(SC,"S",ECD,1,ECDA)) Q:'ECDA  I $D(^(ECDA,0)) D  Q:QFLG
"RTN","ECXSCX",16,0)
 ..;for each patient appointment in the date range (skip cancellations), examine the APPOINTMENT multiple in the PATIENT file (#2)
"RTN","ECXSCX",17,0)
 ..I $S('$D(^SC(SC,"S",ECD,1,ECDA,"C")):1,1:$P(^("C"),U,3)]"") S PTADT=^(0),DFN=$P(PTADT,U) I $D(^DPT(+DFN,0)),$P(PTADT,U,9)="",$P($G(^DPT(DFN,"S",ECD,0)),U,2)'["C" D
"RTN","ECXSCX",18,0)
 ...D PAT,AOIRPOW^ECXUTL(DFN,.ECXAIP)
"RTN","ECXSCX",19,0)
 ...S ECL=$P(PTADT,U,2),ECL=$$RJ^XLFSTR(ECL,3,0),ECOB=$G(^SC(SC,"S",ECD,1,ECDA,"OB"))]""
"RTN","ECXSCX",20,0)
 ...;don't continue with record creation if the clinic appointment can't be found in subfile 2.98
"RTN","ECXSCX",21,0)
 ...Q:'$D(^DPT(DFN,"S",ECD,0))  Q:$P(^DPT(DFN,"S",ECD,0),U)'=SC
"RTN","ECXSCX",22,0)
 ...K EC2 S EC2=^DPT(DFN,"S",ECD,0) S ECN=$S($P(EC2,U,2)="N":"N",$P(EC2,U,2)="NA":"N",$P(EC2,U,2)="NT":"Q",1:"0")
"RTN","ECXSCX",23,0)
 ...S ECIEN=$P(EC2,U,20),ECEKG=$P(EC2,U,5)
"RTN","ECXSCX",24,0)
 ...I ECST'=3 S ECFD=P1_P2_ECL_P3_ECN,ECO1=ECO1_U_ECFD_U_ECOB_U_SC D API,FILE
"RTN","ECXSCX",25,0)
 ...I ECST=3 S ECFD=P1_"000"_ECL_P3_ECN,ECO1=ECO1_U_ECFD_U_ECOB_U_SC D API,FILE
"RTN","ECXSCX",26,0)
 ...I ECST=3 S ECFD=P2_"000"_ECL_P3_ECN,ECO1=ECO1_U_ECFD_U_ECOB_U_SC D API,FILE
"RTN","ECXSCX",27,0)
 ...;check for appended visits for EKG (107); if regular appt. is a no-show, append is a no-show
"RTN","ECXSCX",28,0)
 ...Q:'ECEKG  D
"RTN","ECXSCX",29,0)
 ....S $P(ECODE,U,10,12)="1070000280000"_ECN_U_U
"RTN","ECXSCX",30,0)
 ....S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSCX",31,0)
 ....S $P(ECODE,U,1)=EC7
"RTN","ECXSCX",32,0)
 ....D FILE2
"RTN","ECXSCX",33,0)
 ;Dispositions, stand-alones, and appended lab and x-ray: loop through the file (#409.68) for date range
"RTN","ECXSCX",34,0)
 S ECD=ECSD1
"RTN","ECXSCX",35,0)
 F  S ECD=$O(^SCE("B",ECD)) Q:'ECD!(ECD>ECED)  S ECIEN=0 D  Q:QFLG
"RTN","ECXSCX",36,0)
 .F  S ECIEN=$O(^SCE("B",ECD,ECIEN)) Q:'ECIEN  D  Q:QFLG
"RTN","ECXSCX",37,0)
 ..;quit if no outpatient encounter zero node
"RTN","ECXSCX",38,0)
 ..Q:'$D(^SCE(ECIEN,0))
"RTN","ECXSCX",39,0)
 ..;fd=1>x-ray or lab record, fd=2>disposition, fd=0>stand-alone visit
"RTN","ECXSCX",40,0)
 ..S FD=0,NCNTR=^SCE(ECIEN,0),STOP=$P($G(^DIC(40.7,+$P(NCNTR,U,3),0)),U,2)
"RTN","ECXSCX",41,0)
 ..S ENELG=$P($G(^DIC(8,+$P(NCNTR,U,13),0)),U,9) I ENELG S ENELG=$C(ENELG+64)
"RTN","ECXSCX",42,0)
 ..;quit if no clinic stop code for encounter
"RTN","ECXSCX",43,0)
 ..Q:'STOP
"RTN","ECXSCX",44,0)
 ..;clinic stop code equals 105 (x-ray) or 108 (lab)
"RTN","ECXSCX",45,0)
 ..I (STOP=105)!(STOP=108) S FD=1 D BLD Q
"RTN","ECXSCX",46,0)
 ..;quit if encounter not stop code addition or disposition
"RTN","ECXSCX",47,0)
 ..I ($P(NCNTR,U,8)'=2),($P(NCNTR,U,8)'=3) Q
"RTN","ECXSCX",48,0)
 ..;originating process type equals disposition
"RTN","ECXSCX",49,0)
 ..I $P(NCNTR,U,8)=3 S FD=2 D BLD Q
"RTN","ECXSCX",50,0)
 ..;else originating process type equals stop code addition (stand-alone)
"RTN","ECXSCX",51,0)
 ..;quit if there is a parent encounter pointer.
"RTN","ECXSCX",52,0)
 ..Q:$P($G(NCNTR),U,6)
"RTN","ECXSCX",53,0)
 ..D BLD
"RTN","ECXSCX",54,0)
 ;send missing clinic msg if needed
"RTN","ECXSCX",55,0)
 D:$D(^TMP("ECXS",$J)) EN^ECXSCX1
"RTN","ECXSCX",56,0)
 K EC,EC1,EC2,ECA,ECCPT,ECCSC,ECD,ECDA,ECEKG,ECFD,ECICD,ECIEN,ECL,ECMN,ECN,ECO1,ECO2,ECOB,ECODE,ECPROV,ECPTPR,ECPTTM,ECREC,ECSC,ECST,ECSU,ECTS,ECVAL,ECVIS
"RTN","ECXSCX",57,0)
 K C,CPT,DFN,ELIG,P1,P11,P2,P3,PTADT,SC,VAERR,VAIP,SEX,ADDR,STATE,CNTY,ENELG,PAYOR,SAI,ENR,MST,MSTEI
"RTN","ECXSCX",58,0)
 Q
"RTN","ECXSCX",59,0)
 ;
"RTN","ECXSCX",60,0)
BLD ;build record from outpatient encounter
"RTN","ECXSCX",61,0)
 S DFN=+$P(NCNTR,U,2),LOC=$P(NCNTR,U,4),ECSU=1 S:LOC ECSU=$P(^SC(LOC,0),U,15)
"RTN","ECXSCX",62,0)
 Q:'$D(^DPT(DFN,0))
"RTN","ECXSCX",63,0)
 D PAT,AOIRPOW^ECXUTL(DFN,.ECXAIP)
"RTN","ECXSCX",64,0)
 S P1=$$RJ^XLFSTR(STOP,3,0),P2="000",P3="0000",ECST=1
"RTN","ECXSCX",65,0)
 ;for x-ray and lab
"RTN","ECXSCX",66,0)
 I FD=1 S ECO1=ECO1_U_P1_P2_"02800000"_U_U D API,FILE Q
"RTN","ECXSCX",67,0)
 ;for dispositions
"RTN","ECXSCX",68,0)
 I FD=2 S ECO1=ECO1_U_P1_"47906000000"_U_U D API,FILE Q
"RTN","ECXSCX",69,0)
 ;for stand-alone visits
"RTN","ECXSCX",70,0)
 I FD=0,LOC,$D(^SC(LOC,0)) D
"RTN","ECXSCX",71,0)
 .S SC=LOC,APTLEN=29
"RTN","ECXSCX",72,0)
 .D FEEDER^ECXSCX1(SC,ECD,.P1,.P2,.P3,.ECST)
"RTN","ECXSCX",73,0)
 .I ECST'=6 D
"RTN","ECXSCX",74,0)
 ..D API
"RTN","ECXSCX",75,0)
 ..I $D(^TMP("PXKENC",$J,ECVIS,"VST",ECVIS,812)) D
"RTN","ECXSCX",76,0)
 ...S ECXSRCE=$P(^TMP("PXKENC",$J,ECVIS,"VST",ECVIS,812),U,3)
"RTN","ECXSCX",77,0)
 ...I ECXSRCE=TIU S APTLEN=+$P($G(^SC(SC,"SL")),U,1) S:APTLEN=0 APTLEN=29
"RTN","ECXSCX",78,0)
 ..S APTLEN=$TR($J(APTLEN,3)," ","0")
"RTN","ECXSCX",79,0)
 ..S ECO1=ECO1_U_P1_P2_APTLEN_P3_"0"_U_U_SC
"RTN","ECXSCX",80,0)
 ..D FILE
"RTN","ECXSCX",81,0)
 Q
"RTN","ECXSCX",82,0)
 ;
"RTN","ECXSCX",83,0)
FILE ;finish record setup
"RTN","ECXSCX",84,0)
 ;node0
"RTN","ECXSCX",85,0)
 ;facility^dfn^ssn^name^in/out status^day^feeder key^overbook^sc^mov #^treat spec^time^primary care team^
"RTN","ECXSCX",86,0)
 ;primary care provider^provider^CPT code^ICD-9 code^dob^eligibility^vet^race^
"RTN","ECXSCX",87,0)
 ;ao status^ao visit^ir status^ir visit^pow status^pow location^provider person class
"RTN","ECXSCX",88,0)
 ;node1
"RTN","ECXSCX",89,0)
 ;mpi^dss dept^sex^zip+4^pc provider npi^provider npi^encounter elig^mst status^mst indicator
"RTN","ECXSCX",90,0)
 ;cpt2^cpt3^cpt4^cpt5^cpt6^cpt7^cpt8^cpt9^cpt10^cpt11^sharing payor^sharing insurance^enr location^state^county^pc prov person class
"RTN","ECXSCX",91,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSCX",92,0)
 S ECODE=EC7_U_EC23
"RTN","ECXSCX",93,0)
 S ECODE=ECODE_U_ECO1
"RTN","ECXSCX",94,0)
 S $P(ECODE,U,8)=ECA,ECODE=ECODE_U_ECMN_U_ECTS_U_$$ECXTIME^ECXUTL(ECD)_U_ECPTTM_U_ECPTPR_U_ECPROV_U_ECCPT_U_ECICD
"RTN","ECXSCX",95,0)
 S ECODE=ECODE_U_$$ECXDOB^ECXUTL(DOB)_U_ELIG_U_VET_U_RACE
"RTN","ECXSCX",96,0)
 S ECODE=ECODE_U_ECXAIP("AO")_U_ECVAO_U_ECXAIP("IR")_U_ECVIR_U_ECXAIP("POW")_U_ECXAIP("POWL")_U_ECXPRPC
"RTN","ECXSCX",97,0)
 S CPT="" F C=2:1:11 S CPT=CPT_CPT(C) I C<11 S CPT=CPT_U
"RTN","ECXSCX",98,0)
 S ECODE1=U_U_SEX_U_ZIP_U_U_U_ENELG_U_MST_U_MSTEI_U_CPT_U_PAYOR_U_SAI_U_ENR_U_STATE_U_CNTY_U_ECCLAS
"RTN","ECXSCX",99,0)
 D CUT^ECXSCX1(.ECODE,.ECODE1)
"RTN","ECXSCX",100,0)
 D FILE2
"RTN","ECXSCX",101,0)
 Q
"RTN","ECXSCX",102,0)
 ;
"RTN","ECXSCX",103,0)
FILE2 ;file record
"RTN","ECXSCX",104,0)
 N DA,DIK
"RTN","ECXSCX",105,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXSCX",106,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXSCX",107,0)
 I $D(ZTQUEUED),ECRN>499,'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSCX",108,0)
 Q
"RTN","ECXSCX",109,0)
 ;
"RTN","ECXSCX",110,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSCX",111,0)
 S ECHEAD="CLI"
"RTN","ECXSCX",112,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSCX",113,0)
 Q
"RTN","ECXSCX",114,0)
 ;
"RTN","ECXSCX",115,0)
PAT ;patient file data
"RTN","ECXSCX",116,0)
 N VAPA
"RTN","ECXSCX",117,0)
 S EC1=^DPT(DFN,0)
"RTN","ECXSCX",118,0)
 S ECO1=ECSU_U_DFN_U_$P(EC1,U,9)_U_$E($P($P(EC1,U),",")_"    ",1,4)_U_U_$$ECXDATE^ECXUTL(ECD,ECXYM)
"RTN","ECXSCX",119,0)
 S ELIG=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),U,9) I ELIG S ELIG=$C(ELIG+64)
"RTN","ECXSCX",120,0)
 S SEX=$P(EC1,U,2),DOB=$P(EC1,U,3),VET=$P($G(^DPT(DFN,"VET")),U),RACE=$P($G(^DIC(10,+$P(EC1,U,6),0)),U,2)
"RTN","ECXSCX",121,0)
 D ADD^VADPT
"RTN","ECXSCX",122,0)
 S STATE=VAPA(5),CNTY=VAPA(7),ZIP=$P(VAPA(11),U,2)
"RTN","ECXSCX",123,0)
 S STATE=$P($G(^DIC(5,+STATE,0)),U,3),CNTY=$P($G(^DIC(5,+STATE,1,+CNTY,0)),U,3)
"RTN","ECXSCX",124,0)
 S ENR=$P($G(^DPT(DFN,"ENR")),U,2) I ENR D
"RTN","ECXSCX",125,0)
 .S DIC="^DIC(4,",DA=ENR,DR="99;",DIQ(0)="I",DIQ="ENR"
"RTN","ECXSCX",126,0)
 .D EN^DIQ1 S ENR=ENR(4,ENR,99,"I")
"RTN","ECXSCX",127,0)
 .K DIC,DIQ,DA,DR
"RTN","ECXSCX",128,0)
 S (MST,MSTEI)=""
"RTN","ECXSCX",129,0)
 ;get visn 19 sharing agreement data
"RTN","ECXSCX",130,0)
 D VISN19^ECXUTL2(DFN,.PAYOR,.SAI)
"RTN","ECXSCX",131,0)
 Q
"RTN","ECXSCX",132,0)
API ;call external utilities
"RTN","ECXSCX",133,0)
 ;determine in/out status and primary care
"RTN","ECXSCX",134,0)
 N X,PROV
"RTN","ECXSCX",135,0)
 F C=2:1:11 S CPT(C)=""
"RTN","ECXSCX",136,0)
 S X=$$INP^ECXUTL2(DFN,ECD),ECA=$P(X,U,1),ECMN=$P(X,U,2),ECTS=$P(X,U,3)
"RTN","ECXSCX",137,0)
 S X=$$PRIMARY^ECXUTL2(DFN,ECD),ECPTTM=$P(X,U,1),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3)
"RTN","ECXSCX",138,0)
 ;call pce api for cpt code, diagnosis/provider designated as primary
"RTN","ECXSCX",139,0)
 S ENELG="",ECPROV="",ECXPRPC="",ECCPT=99199,ECICD=799.9,ECVAO="",ECVIR=""
"RTN","ECXSCX",140,0)
 I 'ECIEN Q
"RTN","ECXSCX",141,0)
 I ECIEN D
"RTN","ECXSCX",142,0)
 .S ECVIS=+$P($G(^SCE(ECIEN,0)),U,5)
"RTN","ECXSCX",143,0)
 .S ENELG=+$P($G(^SCE(ECIEN,0)),U,13),ENELG=$P($G(^DIC(8,ENELG,0)),U,9)
"RTN","ECXSCX",144,0)
 .I ENELG S ENELG=$C(ENELG+64)
"RTN","ECXSCX",145,0)
 I 'ECVIS Q
"RTN","ECXSCX",146,0)
 I ECVIS D ENCEVENT^PXAPI(ECVIS)
"RTN","ECXSCX",147,0)
 I $O(^TMP("PXKENC",$J,ECVIS,""))']"" Q
"RTN","ECXSCX",148,0)
 ;get icd9 code; else use 799.9
"RTN","ECXSCX",149,0)
 I $O(^TMP("PXKENC",$J,ECVIS,"POV",0)) D
"RTN","ECXSCX",150,0)
 .S (ECREC,ECVAL)=0
"RTN","ECXSCX",151,0)
 .F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"POV",ECREC)) Q:'ECREC  S:($P(^TMP("PXKENC",$J,ECVIS,"POV",ECREC,0),U,12)="P") ECVAL=+^(0) Q:$P(^TMP("PXKENC",$J,ECVIS,"POV",ECREC,0),U,12)="P"
"RTN","ECXSCX",152,0)
 .I 'ECVAL S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"POV",0)) I ECREC S ECVAL=+^(ECREC,0)
"RTN","ECXSCX",153,0)
 .I ECVAL S ECICD=$P($G(^ICD9(ECVAL,0)),U)
"RTN","ECXSCX",154,0)
 ;get first provider designated as primary; if no primary, then get first physician provider; if no physician, then get first provider; if no "prv" array nodes, use null.
"RTN","ECXSCX",155,0)
 I $O(^TMP("PXKENC",$J,ECVIS,"PRV",0)) D
"RTN","ECXSCX",156,0)
 .S (ECREC,ECVAL)=0
"RTN","ECXSCX",157,0)
 .F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC)) Q:'ECREC  S:($P(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0),U,4)="P") ECVAL=+^(0) Q:$P(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0),U,4)="P"
"RTN","ECXSCX",158,0)
 .I ECVAL S ECPROV=ECVAL,ECXPRPC=$$PRVCLASS^ECXUTL(ECPROV,ECD)
"RTN","ECXSCX",159,0)
 .I 'ECVAL S ECREC=0 D
"RTN","ECXSCX",160,0)
 ..F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC)) Q:'ECREC  D  Q:ECVAL
"RTN","ECXSCX",161,0)
 ...S ECVAL=+^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0) Q:'ECVAL
"RTN","ECXSCX",162,0)
 ...S ECXPRPC=$$PRVCLASS^ECXUTL(ECVAL,ECD) Q:ECXPRPC=""
"RTN","ECXSCX",163,0)
 ...S NUM=$E(ECXPRPC,2,7) S:(NUM<110000)!(NUM>119999) ECVAL=0,ECXPRPC=""
"RTN","ECXSCX",164,0)
 ...I ECVAL S ECPROV=ECVAL
"RTN","ECXSCX",165,0)
 .I 'ECVAL D
"RTN","ECXSCX",166,0)
 ..S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",0)) Q:'ECREC  S ECVAL=+^(ECREC,0)
"RTN","ECXSCX",167,0)
 ..I ECVAL S ECPROV=ECVAL,ECXPRPC=$$PRVCLASS^ECXUTL(ECPROV,ECD)
"RTN","ECXSCX",168,0)
 .S:ECPROV]"" ECPROV="2"_ECPROV
"RTN","ECXSCX",169,0)
 ;get cpt code for ien
"RTN","ECXSCX",170,0)
 I $O(^TMP("PXKENC",$J,ECVIS,"CPT",0)) D
"RTN","ECXSCX",171,0)
 .S (ECREC,ECVAL)=0
"RTN","ECXSCX",172,0)
 .;if there's a primary provider, get a cpt associated with that provider
"RTN","ECXSCX",173,0)
 .I ECPROV]"" D
"RTN","ECXSCX",174,0)
 ..S PROV=$E(ECPROV,2,99)
"RTN","ECXSCX",175,0)
 ..F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"CPT",ECREC)) Q:'ECREC  D  Q:ECVAL
"RTN","ECXSCX",176,0)
 ...I $D(^TMP("PXKENC",$J,ECVIS,"CPT",ECREC,12)) S:$P(^(12),U,4)=PROV ECVAL=+^TMP("PXKENC",$J,ECVIS,"CPT",ECREC,0)
"RTN","ECXSCX",177,0)
 ...I ECVAL D
"RTN","ECXSCX",178,0)
 ....S ECCPT=$P($G(^ICPT(ECVAL,0)),U)
"RTN","ECXSCX",179,0)
 ...;get rid of the cpt record
"RTN","ECXSCX",180,0)
 ...K ^TMP("PXKENC",$J,ECVIS,"CPT",ECREC)
"RTN","ECXSCX",181,0)
 .I ECVAL=0 S ECREC=+$O(^TMP("PXKENC",$J,ECVIS,"CPT",0)) I ECREC S ECVAL=+^(ECREC,0)
"RTN","ECXSCX",182,0)
 .I ECVAL D
"RTN","ECXSCX",183,0)
 ..S ECCPT=$P($G(^ICPT(ECVAL,0)),U)
"RTN","ECXSCX",184,0)
 ..;get rid of the cpt record
"RTN","ECXSCX",185,0)
 ..K ^TMP("PXKENC",$J,ECVIS,"CPT",ECREC)
"RTN","ECXSCX",186,0)
 .;get remaining cpt codes
"RTN","ECXSCX",187,0)
 .S ECREC=0,C=2
"RTN","ECXSCX",188,0)
 .F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"CPT",ECREC)) Q:'ECREC!(C>11)  D
"RTN","ECXSCX",189,0)
 ..S ECVAL=+^TMP("PXKENC",$J,ECVIS,"CPT",ECREC,0)
"RTN","ECXSCX",190,0)
 ..I ECVAL S CPT(C)=$P($G(^ICPT(ECVAL,0)),U),C=C+1
"RTN","ECXSCX",191,0)
 ;ao and ir
"RTN","ECXSCX",192,0)
 S (ECVAO,ECVIR)=""
"RTN","ECXSCX",193,0)
 I $D(^TMP("PXKENC",$J,ECVIS,"VST",ECVIS,800)) D
"RTN","ECXSCX",194,0)
 .S ECVAO=$P(^(800),U,2),ECVIR=$P(^(800),U,3)
"RTN","ECXSCX",195,0)
 .S:ECVAO="0" ECVAO="N" S:ECVIR=0 ECVIR="N"
"RTN","ECXSCX",196,0)
 .S:ECVAO="1" ECVAO="Y" S:ECVIR=1 ECVIR="Y"
"RTN","ECXSCX",197,0)
 Q
"RTN","ECXSCX",198,0)
 ;
"RTN","ECXSCX",199,0)
QUE ;entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSCX",200,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXSCX1")
0^2^B9609156
"RTN","ECXSCX1",1,0)
ECXSCX1 ;ALB/JAP,BIR/DMA-Clinic Extract Message ; 20 Mar 95 / 11:10 AM [ 12/03/96  1:32 PM ]
"RTN","ECXSCX1",2,0)
 ;;3.0;DSS EXTRACTS;**8,28**;Dec 22, 1997
"RTN","ECXSCX1",3,0)
EN ;entry point from ecxscx
"RTN","ECXSCX1",4,0)
 N ECX
"RTN","ECXSCX1",5,0)
 S ECX=$O(^TMP("ECXS",$J,0)) Q:ECX=""
"RTN","ECXSCX1",6,0)
 S XMSUB="MISSING CLINICS",XMDUZ="DSS SYSTEM"
"RTN","ECXSCX1",7,0)
 K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXSCX1",8,0)
 F ECX=1:1:6 S ^TMP("ECXS",$J,ECX,0)=$P($T(MSG+ECX),";",3,300)
"RTN","ECXSCX1",9,0)
 S XMTEXT="^TMP(""ECXS"",$J," D ^XMD K ^TMP("ECXS",$J)
"RTN","ECXSCX1",10,0)
 Q
"RTN","ECXSCX1",11,0)
 ;
"RTN","ECXSCX1",12,0)
MSG ;Text for the leading lines of the missing clinic messages
"RTN","ECXSCX1",13,0)
 ;;The following clinics have not been entered into the CLINIC AND
"RTN","ECXSCX1",14,0)
 ;;STOP CODES file (#728.44).  If any listed clinic is currently
"RTN","ECXSCX1",15,0)
 ;;active, please use the options 'Create DSS Clinic Stop Code File'
"RTN","ECXSCX1",16,0)
 ;;and 'Enter/Edit DSS Stop Codes for Clinics' to update this file.
"RTN","ECXSCX1",17,0)
 ;; 
"RTN","ECXSCX1",18,0)
 ;
"RTN","ECXSCX1",19,0)
MISS ;load ^TMP for clinics missing from 728.44
"RTN","ECXSCX1",20,0)
 Q:'$O(^SC(SC,"S",ECSD1))  S DAT=$G(^SC(SC,"I")) I DAT]"" S ID=+DAT,RD=$P(DAT,U,2) I ID,ID<DT I 'RD!(RD>DT) Q
"RTN","ECXSCX1",21,0)
 ; no missing messages for inactive clinics
"RTN","ECXSCX1",22,0)
 I '$D(ECXMISS) S ECXMISS=10
"RTN","ECXSCX1",23,0)
 S ^TMP("ECXS",$J,ECXMISS,0)=$J(SC,6)_"    "_$$LJ^XLFSTR($P(^SC(SC,0),U),40)_ECSC_"/"_ECCSC,ECXMISS=ECXMISS+1
"RTN","ECXSCX1",24,0)
 Q
"RTN","ECXSCX1",25,0)
 ;
"RTN","ECXSCX1",26,0)
FEEDER(ECXSC,ECXSD,ECXP1,ECXP2,ECXP3,ECXSEND) ;get transmission style and feeder key variables
"RTN","ECXSCX1",27,0)
 ;feeder key is primary stop code_secondary stop code_length of appointment_national clinic code_noshow indicator
"RTN","ECXSCX1",28,0)
 ;   input
"RTN","ECXSCX1",29,0)
 ;   ECXSCX = ien of clinic in file #44 (required)
"RTN","ECXSCX1",30,0)
 ;   ECXSD  = start date of extract date range (required)
"RTN","ECXSCX1",31,0)
 ;   ECXP1,ECXP2,ECXP3,ECXSEND passed by reference (required)
"RTN","ECXSCX1",32,0)
 ;   output (passed-by-reference variables)
"RTN","ECXSCX1",33,0)
 ;   ECXP1  = primary stop code
"RTN","ECXSCX1",34,0)
 ;   ECXP2  = secondary stop code
"RTN","ECXSCX1",35,0)
 ;   ECXP3  = field #7 of file #728.44
"RTN","ECXSCX1",36,0)
 ;   ECXSEND = field #5 of file #728.44
"RTN","ECXSCX1",37,0)
 N ECSC,ECCSC,SC,ECSD1,ECXNC,ECXMISS
"RTN","ECXSCX1",38,0)
 S (ECXP1,ECXP2)="000",ECXP3="0000"
"RTN","ECXSCX1",39,0)
 S ECXSEND=1
"RTN","ECXSCX1",40,0)
 I '$D(^ECX(728.44,ECXSC,0)) D  Q
"RTN","ECXSCX1",41,0)
 .S ECSC=+$P($G(^SC(ECXSC,0)),U,7),ECCSC=+$P(^(0),U,18)
"RTN","ECXSCX1",42,0)
 .S SC=ECXSC,ECSD1=ECXSD D MISS^ECXSCX1
"RTN","ECXSCX1",43,0)
 .I ECSC S ECXP1=$P($G(^DIC(40.7,ECSC,0)),U,2),ECXP1=$$RJ^XLFSTR(+ECXP1,3,0)
"RTN","ECXSCX1",44,0)
 S EC=$G(^ECX(728.44,ECXSC,0)) Q:EC=""
"RTN","ECXSCX1",45,0)
 S ECXSEND=$P(EC,U,6)
"RTN","ECXSCX1",46,0)
 Q:ECXSEND=6
"RTN","ECXSCX1",47,0)
 S ECSC=+$P(EC,U,4),ECCSC=+$P(EC,U,5)
"RTN","ECXSCX1",48,0)
 I 'ECSC S ECSC=+$P(EC,U,2),ECCSC=+$P(EC,U,3)
"RTN","ECXSCX1",49,0)
 I ECSC S ECXP1=$$RJ^XLFSTR(ECSC,3,0),ECXP2=$$RJ^XLFSTR(ECCSC,3,0)
"RTN","ECXSCX1",50,0)
 I 'ECSC D
"RTN","ECXSCX1",51,0)
 .S ECSC=+$P($G(^SC(ECXSC,0)),U,7),ECCSC=+$P($G(^(0)),U,18) I ECSC D
"RTN","ECXSCX1",52,0)
 ..S ECXP1=+$P($G(^DIC(40.7,ECSC,0)),U,2) S:ECCSC ECXP2=+$P($G(^DIC(40.7,ECCSC,0)),U,2)
"RTN","ECXSCX1",53,0)
 ..S ECXP1=$$RJ^XLFSTR(ECXP1,3,0),ECXP2=$$RJ^XLFSTR(ECXP2,3,0)
"RTN","ECXSCX1",54,0)
 ;for action code=1, secondary stop code is always "000"
"RTN","ECXSCX1",55,0)
 I ECXSEND=1 S ECXP2="000" Q
"RTN","ECXSCX1",56,0)
 ;action code of 2 or 3 should not be used, but continue to follow v2t11 logic
"RTN","ECXSCX1",57,0)
 I ECXSEND=2 S ECXP1=ECXP2,ECXP2="000" Q
"RTN","ECXSCX1",58,0)
 I ECXSEND=3 Q
"RTN","ECXSCX1",59,0)
 ;for action code=4, need to get national clinic code
"RTN","ECXSCX1",60,0)
 I ECXSEND=4 D
"RTN","ECXSCX1",61,0)
 .S ECXNC=+$P($G(^ECX(728.44,ECXSC,0)),U,8)
"RTN","ECXSCX1",62,0)
 .I ECXNC S ECXNC=$P($G(^ECX(728.441,ECXNC,0)),U),ECXP3=$$RJ^XLFSTR(ECXNC,4,0)
"RTN","ECXSCX1",63,0)
 Q
"RTN","ECXSCX1",64,0)
 ;
"RTN","ECXSCX1",65,0)
CUT(ECODE,ECODE1) ;shorten transmission record by cutting fields
"RTN","ECXSCX1",66,0)
 N ALL,I,OUT
"RTN","ECXSCX1",67,0)
 S ALL=$P(ECODE,U,4,100)_"^"_ECODE1_"^~"
"RTN","ECXSCX1",68,0)
 Q:($L(ALL)<256)
"RTN","ECXSCX1",69,0)
 ;remove time
"RTN","ECXSCX1",70,0)
 S $P(ECODE,U,15)=""
"RTN","ECXSCX1",71,0)
 S ALL=$P(ECODE,U,4,100)_"^"_ECODE1_"^~"
"RTN","ECXSCX1",72,0)
 Q:($L(ALL)<256)
"RTN","ECXSCX1",73,0)
 ;remove shar. agree. insurer
"RTN","ECXSCX1",74,0)
 S $P(ECODE1,U,21)=""
"RTN","ECXSCX1",75,0)
 S ALL=$P(ECODE,U,4,100)_"^"_ECODE1_"^~"
"RTN","ECXSCX1",76,0)
 Q:($L(ALL)<256)
"RTN","ECXSCX1",77,0)
 ;remove shar. agree. payor
"RTN","ECXSCX1",78,0)
 S $P(ECODE1,U,20)=""
"RTN","ECXSCX1",79,0)
 S ALL=$P(ECODE,U,4,100)_"^"_ECODE1_"^~"
"RTN","ECXSCX1",80,0)
 Q:($L(ALL)<256)
"RTN","ECXSCX1",81,0)
 ;remove cpt codes starting with last
"RTN","ECXSCX1",82,0)
 S OUT=0
"RTN","ECXSCX1",83,0)
 F I=19:-1:10 D  Q:OUT
"RTN","ECXSCX1",84,0)
 .S $P(ECODE1,U,I)=""
"RTN","ECXSCX1",85,0)
 .S ALL=$P(ECODE,U,4,100)_"^"_ECODE1_"^~"
"RTN","ECXSCX1",86,0)
 .I ($L(ALL)<256) S OUT=1
"RTN","ECXSCX1",87,0)
 Q
"VER")
8.0^21.0
**END**
**END**
