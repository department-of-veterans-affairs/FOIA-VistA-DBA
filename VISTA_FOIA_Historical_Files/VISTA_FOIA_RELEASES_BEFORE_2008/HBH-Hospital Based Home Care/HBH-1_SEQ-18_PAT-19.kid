Released HBH*1*19 SEQ #18
Extracted from mail message
**KIDS**:HBH*1.0*19^

**INSTALL NAME**
HBH*1.0*19
"BLD",4293,0)
HBH*1.0*19^HOSPITAL BASED HOME CARE^0^3021202^y
"BLD",4293,1,0)
^^1^1^3021003^^^^
"BLD",4293,1,1,0)
This is HBH*1.0*19, Race/Ethnicity Mods, & Routine 2nd Line Correction
"BLD",4293,4,0)
^9.64PA^631^1
"BLD",4293,4,631,0)
631
"BLD",4293,4,631,2,0)
^9.641^631^1
"BLD",4293,4,631,2,631,0)
HBHC PATIENT  (File-top level)
"BLD",4293,4,631,2,631,1,0)
^9.6411^9.1^2
"BLD",4293,4,631,2,631,1,9,0)
RACE
"BLD",4293,4,631,2,631,1,9.1,0)
RACECOMP
"BLD",4293,4,631,222)
y^y^p^^^^n
"BLD",4293,4,"APDD",631,631)

"BLD",4293,4,"APDD",631,631,9)

"BLD",4293,4,"APDD",631,631,9.1)

"BLD",4293,4,"B",631,631)

"BLD",4293,"ABPKG")
n
"BLD",4293,"INID")
^
"BLD",4293,"INIT")

"BLD",4293,"KRN",0)
^9.67PA^8989.52^20
"BLD",4293,"KRN",.4,0)
.4
"BLD",4293,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4293,"KRN",.401,0)
.401
"BLD",4293,"KRN",.401,"NM",0)
^9.68A^^
"BLD",4293,"KRN",.402,0)
.402
"BLD",4293,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",4293,"KRN",.403,0)
.403
"BLD",4293,"KRN",.403,"NM",0)
^9.68A^^
"BLD",4293,"KRN",.5,0)
.5
"BLD",4293,"KRN",.84,0)
.84
"BLD",4293,"KRN",3.6,0)
3.6
"BLD",4293,"KRN",3.8,0)
3.8
"BLD",4293,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",4293,"KRN",9.2,0)
9.2
"BLD",4293,"KRN",9.8,0)
9.8
"BLD",4293,"KRN",9.8,"NM",0)
^9.68A^23^9
"BLD",4293,"KRN",9.8,"NM",6,0)
HBHCXMV^^0^B18350983
"BLD",4293,"KRN",9.8,"NM",7,0)
HBHCXMV1^^0^B6107370
"BLD",4293,"KRN",9.8,"NM",13,0)
HBHCXMA^^0^B26593993
"BLD",4293,"KRN",9.8,"NM",17,0)
HBHCUTL1^^0^B23832042
"BLD",4293,"KRN",9.8,"NM",18,0)
HBHCXMD1^^0^B14611933
"BLD",4293,"KRN",9.8,"NM",19,0)
HBHCXMD^^0^B22377789
"BLD",4293,"KRN",9.8,"NM",20,0)
HBHCXMA1^^0^B11373763
"BLD",4293,"KRN",9.8,"NM",21,0)
HBHCRP21^^0^B50792838
"BLD",4293,"KRN",9.8,"NM",23,0)
HBHCRP2^^0^B27363780
"BLD",4293,"KRN",9.8,"NM","B","HBHCRP2",23)

"BLD",4293,"KRN",9.8,"NM","B","HBHCRP21",21)

"BLD",4293,"KRN",9.8,"NM","B","HBHCUTL1",17)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMA",13)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMA1",20)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMD",19)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMD1",18)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMV",6)

"BLD",4293,"KRN",9.8,"NM","B","HBHCXMV1",7)

"BLD",4293,"KRN",19,0)
19
"BLD",4293,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4293,"KRN",19.1,0)
19.1
"BLD",4293,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4293,"KRN",101,0)
101
"BLD",4293,"KRN",409.61,0)
409.61
"BLD",4293,"KRN",771,0)
771
"BLD",4293,"KRN",869.2,0)
869.2
"BLD",4293,"KRN",870,0)
870
"BLD",4293,"KRN",8989.51,0)
8989.51
"BLD",4293,"KRN",8989.52,0)
8989.52
"BLD",4293,"KRN",8994,0)
8994
"BLD",4293,"KRN","B",.4,.4)

"BLD",4293,"KRN","B",.401,.401)

"BLD",4293,"KRN","B",.402,.402)

"BLD",4293,"KRN","B",.403,.403)

"BLD",4293,"KRN","B",.5,.5)

"BLD",4293,"KRN","B",.84,.84)

"BLD",4293,"KRN","B",3.6,3.6)

"BLD",4293,"KRN","B",3.8,3.8)

"BLD",4293,"KRN","B",9.2,9.2)

"BLD",4293,"KRN","B",9.8,9.8)

"BLD",4293,"KRN","B",19,19)

"BLD",4293,"KRN","B",19.1,19.1)

"BLD",4293,"KRN","B",101,101)

"BLD",4293,"KRN","B",409.61,409.61)

"BLD",4293,"KRN","B",771,771)

"BLD",4293,"KRN","B",869.2,869.2)

"BLD",4293,"KRN","B",870,870)

"BLD",4293,"KRN","B",8989.51,8989.51)

"BLD",4293,"KRN","B",8989.52,8989.52)

"BLD",4293,"KRN","B",8994,8994)

"BLD",4293,"QUES",0)
^9.62^^
"BLD",4293,"REQB",0)
^9.611^8^7
"BLD",4293,"REQB",2,0)
HBH*1.0*06^2
"BLD",4293,"REQB",3,0)
HBH*1.0*08^2
"BLD",4293,"REQB",4,0)
HBH*1.0*15^2
"BLD",4293,"REQB",5,0)
HBH*1.0*16^2
"BLD",4293,"REQB",6,0)
HBH*1.0*17^2
"BLD",4293,"REQB",7,0)
DG*5.3*415^2
"BLD",4293,"REQB",8,0)
SD*5.3*254^2
"BLD",4293,"REQB","B","DG*5.3*415",7)

"BLD",4293,"REQB","B","HBH*1.0*06",2)

"BLD",4293,"REQB","B","HBH*1.0*08",3)

"BLD",4293,"REQB","B","HBH*1.0*15",4)

"BLD",4293,"REQB","B","HBH*1.0*16",5)

"BLD",4293,"REQB","B","HBH*1.0*17",6)

"BLD",4293,"REQB","B","SD*5.3*254",8)

"FIA",631)
HBHC PATIENT
"FIA",631,0)
^HBHC(631,
"FIA",631,0,0)
631IP
"FIA",631,0,1)
y^y^p^^^^n
"FIA",631,0,10)

"FIA",631,0,11)

"FIA",631,0,"RLRO")

"FIA",631,0,"VR")
1.0^HBH
"FIA",631,631)
1
"FIA",631,631,9)

"FIA",631,631,9.1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
HOSPITAL BASED HOME CARE^HBH^Hospital Based Home Care
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
1.0^2931101
"PKG",455,22,1,"PAH",1,0)
19^3021202^3779
"PKG",455,22,1,"PAH",1,1,0)
^^1^1^3021202
"PKG",455,22,1,"PAH",1,1,1,0)
This is HBH*1.0*19, Race/Ethnicity Mods, & Routine 2nd Line Correction
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","HBHCRP2")
0^23^B27363780
"RTN","HBHCRP2",1,0)
HBHCRP2 ; LR VAMC(IRMS)/MJT-HBHC report on file 631, individual patient evaluation/admission data, includes all fields, plus Case Manager ;2/5/98  15:18
"RTN","HBHCRP2",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**1,2,5,6,9,19**;NOV 01, 1993
"RTN","HBHCRP2",3,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCRP2",4,0)
 K DIC S DIC="^HBHC(631,",DIC(0)="AEMQZ" D ^DIC
"RTN","HBHCRP2",5,0)
 G:Y=-1 EXIT
"RTN","HBHCRP2",6,0)
 S HBHCDFN=+Y,HBHCY0=Y(0),%ZIS="Q" K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP2",7,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP2",ZTDESC="HBPC Patient Evaluation/Admission Data Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP2",8,0)
DQ ; De-queue
"RTN","HBHCRP2",9,0)
 U IO
"RTN","HBHCRP2",10,0)
 S $P(HBHCY,"-",81)="",HBHCHEAD="Patient Evaluation/Admission Data",HBHCCOLM=(80-(20+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP2",11,0)
 D TODAY^HBHCUTL
"RTN","HBHCRP2",12,0)
 W ?HBHCCOLM,">>> HBPC ",HBHCHEAD," Report <<<" W !!,"Run Date: ",HBHCTDY,!!,HBHCZ
"RTN","HBHCRP2",13,0)
PROCESS ; Process record
"RTN","HBHCRP2",14,0)
 S HBHCDPT0=^DPT(+(HBHCY0),0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1))
"RTN","HBHCRP2",15,0)
 W !,"Patient Name:  ",$P(HBHCDPT0,U),?46,"Last Four:",?58,$E($P(HBHCDPT0,U,9),6,9),!,HBHCZ
"RTN","HBHCRP2",16,0)
 W !," 1.  Hospital Number:",?29,$J($S($P(^HBHC(631.9,1,0),U,5)]"":$E($P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U),1,7),1:""),7)
"RTN","HBHCRP2",17,0)
 W ?38,"|",?41,"20.  Primary Diagnosis @ Adm:",?74,$J($S($P(HBHCY0,U,19)]"":$P(^ICD9($P(HBHCY0,U,19),0),U),1:""),6),!,HBHCY
"RTN","HBHCRP2",18,0)
 W !," 2.  Date:",?28,$S($P(HBHCY0,U,18)]"":$E($P(HBHCY0,U,18),4,5)_"-"_$E($P(HBHCY0,U,18),6,7)_"-"_$E($P(HBHCY0,U,18),2,3),$P(HBHCY0,U,2)]"":$E($P(HBHCY0,U,2),4,5)_"-"_$E($P(HBHCY0,U,2),6,7)_"-"_$E($P(HBHCY0,U,2),2,3),1:"")
"RTN","HBHCRP2",19,0)
 W ?38,"|",?41,"21.  Secondary Diagnoses @ Adm:" I HBHCNOD1]"" W:$P(HBHCNOD1,U,14)]"" !?38,"|",?46,$P(HBHCNOD1,U,14)
"RTN","HBHCRP2",20,0)
 W !,HBHCY
"RTN","HBHCRP2",21,0)
 W !," 3.  State Code:",?34,$S($P(HBHCY0,U,3)]"":$P(^DIC(5,(+^HBHC(631.8,($P(HBHCY0,U,3)),0)),0),U,3),1:""),?38,"|",?41,"22.  Vision @ Admission:",?79,$P(HBHCY0,U,20),!,HBHCY
"RTN","HBHCRP2",22,0)
 S HBHCCNTY="" S:(($P(HBHCY0,U,3)]"")&($P(HBHCY0,U,4)]"")) HBHCCNTY=$P($G(^DIC(5,(+^HBHC(631.8,($P(HBHCY0,U,3)),0)),1,$P(HBHCY0,U,4),0)),U,3)
"RTN","HBHCRP2",23,0)
 W !," 4.  County Code:",?33,HBHCCNTY,?38,"|",?46,"Hearing @ Admission:",?79,$P(HBHCY0,U,21),!,HBHCY
"RTN","HBHCRP2",24,0)
 W !," 5.  ZIP Code:",?26,$J($E($P(HBHCY0,U,5),1,5)_$S($E($P(HBHCY0,U,5),6,9)]"":"-"_$E($P(HBHCY0,U,5),6,9),1:""),10),?38,"|",?41,"23.  Expressive Communication @ Adm:",?79,$P(HBHCY0,U,22),!,HBHCY
"RTN","HBHCRP2",25,0)
 W !," 6.  Eligibility @ Evaluation:",?34,$P(HBHCY0,U,6),?38,"|",?41,"24.  Receptive Communication @ Adm:",?79,$P(HBHCY0,U,23),!,HBHCY
"RTN","HBHCRP2",26,0)
 W !," 7.  Birth Year:",?32,$S($P(HBHCDPT0,U,3):1700+$E($P(HBHCDPT0,U,3),1,3),1:""),?38,"|",?41,"25.  Bathing @ Admission:",?79,$P(HBHCY0,U,24),!,HBHCY
"RTN","HBHCRP2",27,0)
 W !," 8.  Period of Service:",?34,$S($P(HBHCY0,U,8)]"":$P($G(^HBHC(631.7,$P(HBHCY0,U,8),0)),U),1:""),?38,"|",?46,"Dressing @ Admission:",?79,$P(HBHCY0,U,25),!,HBHCY
"RTN","HBHCRP2",28,0)
 W !," 9.  Sex:",?35,$S($P(HBHCDPT0,U,2)="M":1,1:2),?38,"|",?46,"Toilet Usage @ Admission:",?79,$P(HBHCY0,U,26),!,HBHCY
"RTN","HBHCRP2",29,0)
 ; Obsolete with Race/Ethnicity Info Jan 2003 mandate; commented out historical reference  mjt
"RTN","HBHCRP2",30,0)
 ;S HBHCRC=$S($P(HBHCDPT0,U,6)]"":$P(^DIC(10,$P(HBHCDPT0,U,6),0),U,2),1:"")
"RTN","HBHCRP2",31,0)
 ;W !,"10.  Race:",?35,$S(HBHCRC=6:1,HBHCRC=4:2,(HBHCRC=1)!(HBHCRC=2):3,HBHCRC=3:4,HBHCRC=5:5,1:9),?38,"|",?46,"Transferring @ Admission:",?79,$P(HBHCY0,U,27),!,HBHCY
"RTN","HBHCRP2",32,0)
 ; Field retained until VA Form 10-0014 modified to remove field  mjt
"RTN","HBHCRP2",33,0)
 W !,"10.  Race:  Obsolete Field  Jan 2003",?38,"|",?46,"Transferring @ Admission:",?79,$P(HBHCY0,U,27),!,HBHCY
"RTN","HBHCRP2",34,0)
 W !,"11.  Marital Status @ Evaluation:",?35,$P(HBHCY0,U,11),?38,"|",?46,"Eating @ Admission:",?79,$P(HBHCY0,U,28),!,HBHCY
"RTN","HBHCRP2",35,0)
 W !,"12.  Living Arrangements @ Eval:",?35,$P(HBHCY0,U,12),?38,"|",?46,"Walking @ Admission:",?79,$P(HBHCY0,U,29),!,HBHCY
"RTN","HBHCRP2",36,0)
 W !,"13.  Last Agency Providing Care:",?35,$P(HBHCY0,U,13),?38,"|",?41,"26.  Bowel Continence @ Admission:",?79,$P(HBHCY0,U,30),!,HBHCY
"RTN","HBHCRP2",37,0)
 W !,"14.  Type of Last Care Agency:",?35,$P(HBHCY0,U,14),?38,"|",?46,"Bladder Continence @ Admission:",?79,$P(HBHCY0,U,31),!,HBHCY
"RTN","HBHCRP2",38,0)
 W !,"15.  Referred While Inpatient:",?35,$P(HBHCNOD1,U,29),?38,"|",?41,"27.  Mobility @ Admission:",?79,$P(HBHCY0,U,32),!,HBHCY
"RTN","HBHCRP2",39,0)
 W !,"16.  Admit/Reject Action:",?35,$P(HBHCY0,U,15),?38,"|",?41,"28.  Adaptive Tasks @ Admission:",?79,$P(HBHCY0,U,33),!,HBHCY
"RTN","HBHCRP2",40,0)
 W !,"17.  Reject/Withdraw Reason:",?34,$S($P(HBHCY0,U,16)]"":$P(^HBHC(631.1,$P(HBHCY0,U,16),0),U),1:""),?38,"|",?41,"29.  Behavior Problems @ Admission:",?79,$P(HBHCY0,U,34),!,HBHCY
"RTN","HBHCRP2",41,0)
 W !,"18.  Reject/Withdraw Disposition:",?35,$P(HBHCY0,U,17),?38,"|",?41,"30.  Disorientation @ Admission:",?79,$P(HBHCY0,U,35),!,HBHCY
"RTN","HBHCRP2",42,0)
 W !,"19.  SSN:",?25,$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9),?38,"|",?41,"31.  Mood Disturbance @ Admission:",?79,$P(HBHCY0,U,36),!,HBHCY
"RTN","HBHCRP2",43,0)
 W !?38,"|",?41,"32.  Caregiver Limitations @ Adm:",?79,$P(HBHCY0,U,37),!,HBHCY
"RTN","HBHCRP2",44,0)
 W !?38,"|",?41,"33.  Person Completing Eval/Adm:",?76,$J($S($P(HBHCY0,U,38)]"":$P(^HBHC(631.4,$P(HBHCY0,U,38),0),U),1:""),4),!,HBHCY
"RTN","HBHCRP2",45,0)
 W !?38,"|",?46,"Date Eval/Adm Completed:",?72,$S($P(HBHCY0,U,39)]"":$E($P(HBHCY0,U,39),4,5)_"-"_$E($P(HBHCY0,U,39),6,7)_"-"_$E($P(HBHCY0,U,39),2,3),1:""),!,HBHCY
"RTN","HBHCRP2",46,0)
 W !?38,"|",?46,"Case Manager:",?76,$J($S($P(HBHCNOD1,U,13)]"":$P(^HBHC(631.4,$P(HBHCNOD1,U,13),0),U),1:""),4),!,HBHCY
"RTN","HBHCRP2",47,0)
EXIT ; Exit module
"RTN","HBHCRP2",48,0)
 D ^%ZISC
"RTN","HBHCRP2",49,0)
 K DIC,HBHCCNTY,HBHCCOLM,HBHCDFN,HBHCDPT0,HBHCHEAD,HBHCNOD1,HBHCRC,HBHCTDY,HBHCY,HBHCY0,HBHCZ,Y
"RTN","HBHCRP2",50,0)
 Q
"RTN","HBHCRP21")
0^21^B50792838
"RTN","HBHCRP21",1,0)
HBHCRP21 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, number of pat visits by date range, with total pats & total visits, user selectable alpha or number of visits sort, number of visits has subtotals & summary, calls CPT^HBHCUTL3 ; Apr 2000
"RTN","HBHCRP21",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**11,13,15,16,19**;NOV 01, 1993
"RTN","HBHCRP21",3,0)
 D START^HBHCUTL
"RTN","HBHCRP21",4,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP21",5,0)
 W !,"Visits containing any of the following CPT Codes are omitted from report:"
"RTN","HBHCRP21",6,0)
 W !!?2,"99358  PROLONGED SERV, W/O CONTACT"
"RTN","HBHCRP21",7,0)
 W !?2,"99359  PROLONGED SERV, W/O CONTACT"
"RTN","HBHCRP21",8,0)
 W !?2,"99361  PHYSICIAN/TEAM CONFERENCE"
"RTN","HBHCRP21",9,0)
 W !?2,"99362  PHYSICIAN/TEAM CONFERENCE"
"RTN","HBHCRP21",10,0)
 W !?2,"99371  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",11,0)
 W !?2,"99372  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",12,0)
 W !?2,"99373  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",13,0)
 W !?2,"99374  HOME HEALTH CARE SUPERVISION"
"RTN","HBHCRP21",14,0)
 W !?2,"99375  HOME HEALTH CARE SUPERVISION"
"RTN","HBHCRP21",15,0)
 W !?2,"99376  CARE PLAN OVERSIGHT/OVER 60",!
"RTN","HBHCRP21",16,0)
PROMPT ; Prompt user for CPT code
"RTN","HBHCRP21",17,0)
 K DIR S DIR(0)="PO^81",DIR("A")="Enter any other CPT code you wish to omit",DIR("?")="Enter 5 digit CPT code you wish to omit from report." D ^DIR
"RTN","HBHCRP21",18,0)
 G:$D(DTOUT) EXIT I '$D(DUOUT) I X'="" S HBHCCPTL(X)="" G PROMPT
"RTN","HBHCRP21",19,0)
 W !
"RTN","HBHCRP21",20,0)
 ; Prompt user for sort preference
"RTN","HBHCRP21",21,0)
 K DIR S DIR(0)="SM^A:Alphabetical;V:Number of Visits",DIR("A")="Sort Preference",DIR("B")="V",DIR("?")="Sort report alphabetically by patient (A), or by number of visits (V).  Visit sort includes subtotals & summary." D ^DIR
"RTN","HBHCRP21",22,0)
 G:$D(DIRUT) EXIT
"RTN","HBHCRP21",23,0)
 ; HBHCFLG exists if visit sort selected
"RTN","HBHCRP21",24,0)
 S:X="V" HBHCFLG=1
"RTN","HBHCRP21",25,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP21",26,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP21",ZTDESC=$S($D(HBHCFLG):"HBPC Total Visits by Date Range Report,Visit Sort",1:"HBPC Total Visits by Date Range Report"),ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP21",27,0)
DQ ; De-queue
"RTN","HBHCRP21",28,0)
 ; CPT codes omitted from inclusion on report
"RTN","HBHCRP21",29,0)
 S HBHCCPTL(99358)="",HBHCCPTL(99359)="",HBHCCPTL(99361)="",HBHCCPTL(99362)="",HBHCCPTL(99371)="",HBHCCPTL(99372)="",HBHCCPTL(99373)="",HBHCCPTL(99374)="",HBHCCPTL(99375)="",HBHCCPTL(99376)=""
"RTN","HBHCRP21",30,0)
 U IO
"RTN","HBHCRP21",31,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP21",32,0)
 S $P(HBHCY,"-",81)="",$P(HBHCZ,"=",81)="",(HBHCCNT,HBHCCNT1,HBHCTOT)=0
"RTN","HBHCRP21",33,0)
 S HBHCHEAD=$S($D(HBHCFLG):"Total Visits by Date Range, Visit Sort",1:"Total Visits by Date Range")
"RTN","HBHCRP21",34,0)
 S HBHCHDR="W !?31,""Last"",?40,""Visit"",?68,""Discharge"",!,""Patient Name"",?31,""Four"",?40,""Total"",?50,""Date"",?68,""Date""",HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP21",35,0)
LOOP ; Loop thru ^HBHC(632) "C" (appointment date) cross-ref to build report
"RTN","HBHCRP21",36,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCAPDT=X_.9999
"RTN","HBHCRP21",37,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT="")!(HBHCAPDT>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCAPDT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCRP21",38,0)
 D TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCRP21",39,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRRANGE^HBHCUTL
"RTN","HBHCRP21",40,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No Visits found for Date Range selected."
"RTN","HBHCRP21",41,0)
 I $D(^TMP("HBHC",$J)) W !!,"Visits containing any of the following CPT Codes are omitted from report:",! S HBHCCPT="" F  S HBHCCPT=$O(HBHCCPTL(HBHCCPT)) Q:HBHCCPT=""  S HBHC=$$CPT^ICPTCOD(HBHCCPT) W !?2,$P(HBHC,U,2)_"  "_$P(HBHC,U,3)
"RTN","HBHCRP21",42,0)
 I $D(^TMP("HBHC",$J)) W !!,HBHCY D:$D(HBHCFLG) SORT,PRTLOOP,SUMMARY I '$D(HBHCFLG) D APRTLOOP W !!,"Total Patients:  ",$J(HBHCCNT,4),!!,"Total Visits:  ",$J(HBHCTOT,6)
"RTN","HBHCRP21",43,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCRP21",44,0)
EXIT ; Exit module
"RTN","HBHCRP21",45,0)
 D ^%ZISC
"RTN","HBHCRP21",46,0)
 K DIR,HBHC,HBHCADDT,HBHCAPDT,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCNT,HBHCCNT1,HBHCCOLM,HBHCCPT,HBHCCPTL,HBHCDFN,HBHCDPT0,HBHCDSDT,HBHCEND1,HBHCEND2,HBHCFLAG,HBHCFLG,HBHCHEAD,HBHCHDR,HBHCI,HBHCIEN,HBHCINFO,HBHCNAME,HBHCNBR,HBHCNOD0
"RTN","HBHCRP21",47,0)
 K HBHCPAGE,HBHCLST4,HBHCTDY,HBHCTOT,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP21",48,0)
 Q
"RTN","HBHCRP21",49,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCRP21",50,0)
 ; Quit if no CPT codes
"RTN","HBHCRP21",51,0)
 D CPT^HBHCUTL3 Q:'$D(HBHCCPTA)
"RTN","HBHCRP21",52,0)
 ; Quit if contains CPT code to be omitted
"RTN","HBHCRP21",53,0)
 K HBHCFLAG
"RTN","HBHCRP21",54,0)
 S HBHCI="" F  S HBHCI=$O(HBHCCPTA(HBHCI)) Q:(HBHCI="")!($D(HBHCFLAG))  S HBHCCPT=$P(HBHCCPTA(HBHCI),"  ") S:$D(HBHCCPTL(HBHCCPT)) HBHCFLAG=1
"RTN","HBHCRP21",55,0)
 Q:$D(HBHCFLAG)
"RTN","HBHCRP21",56,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0),HBHCNAME=$P(HBHCDPT0,U),HBHCLST4=$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9)
"RTN","HBHCRP21",57,0)
 S (HBHCADDT,HBHCDSDT)=""
"RTN","HBHCRP21",58,0)
 S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(631,"B",$P(HBHCNOD0,U),HBHCIEN)) Q:HBHCIEN'>0  S HBHCINFO=^HBHC(631,HBHCIEN,0),HBHCADDT=$P(HBHCINFO,U,18),HBHCDSDT=$P(HBHCINFO,U,40)
"RTN","HBHCRP21",59,0)
 ; patient not in HBHC(631
"RTN","HBHCRP21",60,0)
 S:HBHCADDT="" HBHCADDT="n/a"
"RTN","HBHCRP21",61,0)
 S:HBHCDSDT="" HBHCDSDT="n/a"
"RTN","HBHCRP21",62,0)
 I $D(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) S ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)+1
"RTN","HBHCRP21",63,0)
 S:'$D(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=1
"RTN","HBHCRP21",64,0)
 Q
"RTN","HBHCRP21",65,0)
SORT ; Sort TMP according to number of visits
"RTN","HBHCRP21",66,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D SORTLOOP
"RTN","HBHCRP21",67,0)
 Q
"RTN","HBHCRP21",68,0)
SORTLOOP ; Sort loop
"RTN","HBHCRP21",69,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D SET
"RTN","HBHCRP21",70,0)
 Q
"RTN","HBHCRP21",71,0)
SET ; Set TMP in re-sorted order by number of visits, kill old TMP node
"RTN","HBHCRP21",72,0)
 S HBHCNBR=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",73,0)
 S ^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=HBHCNBR
"RTN","HBHCRP21",74,0)
 K ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",75,0)
 Q
"RTN","HBHCRP21",76,0)
PRTLOOP ; Print loop
"RTN","HBHCRP21",77,0)
 S HBHCNBR="" F  S HBHCNBR=$O(^TMP("HBHC",$J,HBHCNBR)) Q:HBHCNBR=""  D PRTLOOP2 W:HBHCCNT1>0 !!?5,"Total Patients with ",HBHCNBR," Visit(s):  ",HBHCCNT1,!!,HBHCY S HBHC(HBHCNBR)=HBHCCNT1,HBHCCNT1=0
"RTN","HBHCRP21",78,0)
 Q
"RTN","HBHCRP21",79,0)
PRTLOOP2 ; Print loop continued
"RTN","HBHCRP21",80,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D PRTLOOP3
"RTN","HBHCRP21",81,0)
 Q
"RTN","HBHCRP21",82,0)
PRTLOOP3 ; Print loop continued again
"RTN","HBHCRP21",83,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D PRINT
"RTN","HBHCRP21",84,0)
 Q
"RTN","HBHCRP21",85,0)
APRTLOOP ; Print loop for alphabetic sort
"RTN","HBHCRP21",86,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D APRTLP2
"RTN","HBHCRP21",87,0)
 Q
"RTN","HBHCRP21",88,0)
APRTLP2 ; Print loop for alphabetic sort continued
"RTN","HBHCRP21",89,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D PRINT
"RTN","HBHCRP21",90,0)
 Q
"RTN","HBHCRP21",91,0)
PRINT ; Print report
"RTN","HBHCRP21",92,0)
 S HBHCCNT=HBHCCNT+1
"RTN","HBHCRP21",93,0)
 S:$D(HBHCFLG) HBHCINFO=^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT),HBHCCNT1=HBHCCNT1+1
"RTN","HBHCRP21",94,0)
 S:'$D(HBHCFLG) HBHCINFO=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",95,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<7) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCRP21",96,0)
 S HBHCTOT=HBHCTOT+($P(HBHCINFO,U))
"RTN","HBHCRP21",97,0)
 W !,$E(HBHCNAME,1,25),?31,$E(HBHCLST4,8,11),?41,$J($P(HBHCINFO,U),3)
"RTN","HBHCRP21",98,0)
 S Y=HBHCADDT D DD^%DT W ?50,Y
"RTN","HBHCRP21",99,0)
 S Y=HBHCDSDT D DD^%DT W ?68,$S(Y'="n/a":Y,1:"")
"RTN","HBHCRP21",100,0)
 W !,HBHCY
"RTN","HBHCRP21",101,0)
 Q
"RTN","HBHCRP21",102,0)
SUMMARY ; Print report summary
"RTN","HBHCRP21",103,0)
 W @IOF,HBHCZ,!?22,"******  Total Visits Summary  ******",!,HBHCZ,!
"RTN","HBHCRP21",104,0)
 S HBHCNBR=0 F  S HBHCNBR=$O(HBHC(HBHCNBR)) Q:HBHCNBR'>0  W !,"Total Patients with ",$J(HBHCNBR,3)," Visit(s):  ",$J(HBHC(HBHCNBR),4)
"RTN","HBHCRP21",105,0)
 W !?34,"------",!,"Total Patients:  ",?35,$J(HBHCCNT,4),!!,"Total Visits:  ",?33,$J(HBHCTOT,6)
"RTN","HBHCRP21",106,0)
 Q
"RTN","HBHCUTL1")
0^17^B23832042
"RTN","HBHCUTL1",1,0)
HBHCUTL1 ; LR VAMC(IRMS)/MJT-HBHC Utility module, Entry points:  ENDRPT, END132, FORMMSG, BIRTHYR, SEXRACE ;2/5/98  15:19
"RTN","HBHCUTL1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**1,2,6,9,19**;NOV 01, 1993
"RTN","HBHCUTL1",3,0)
ENDRPT ; Print end of report message
"RTN","HBHCUTL1",4,0)
 W !!?28,"==== End of Report ===="
"RTN","HBHCUTL1",5,0)
 Q
"RTN","HBHCUTL1",6,0)
END132 ; Print end of report message for 132 column report
"RTN","HBHCUTL1",7,0)
 W !!?54,"==== End of Report ===="
"RTN","HBHCUTL1",8,0)
 Q
"RTN","HBHCUTL1",9,0)
FORMMSG ; Process Form 3/4/5 Transmit Status fields
"RTN","HBHCUTL1",10,0)
 W *7,!!,"Transmit Status Flag must be reset before editing this record is allowed."
"RTN","HBHCUTL1",11,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !!,"***  NOTICE:  Hospital Number is missing from System Parameter file (#631.9).",!,"Due to automatic Form 6 Correction Record generation, Transmit Status Flag"
"RTN","HBHCUTL1",12,0)
 I $P(^HBHC(631.9,1,0),U,5)="" W !,"CANNOT be reset without this information.  Contact IRM to enter this",!,"information using FileMan.",! S HBHCNHSP=1 H 10 Q
"RTN","HBHCUTL1",13,0)
 W !!,"Do you wish to reset the Flag" S %=2 D YN^DICN W ! I %=0 W !,"A 'Yes' response will reset the Transmit Status Flag field data.  A 'No'",!,"response will return you to the menu without resetting the Transmit",!,"Status Flag.",!! G FORMMSG
"RTN","HBHCUTL1",14,0)
 S HBHCPRCT=%
"RTN","HBHCUTL1",15,0)
 I %'=1 S:HBHCFORM=4 Y=0 Q
"RTN","HBHCUTL1",16,0)
 S HBHCFILE=$S(HBHCFORM=4:632,1:631),HBHCNODE=$S(HBHCFORM=4:0,1:1),HBHCPC1=$S(HBHCFORM=3:17,HBHCFORM=4:8,1:18),HBHCPC2=$S(HBHCFORM=3:25,HBHCFORM=4:12,1:27),HBHCPC3=$S(HBHCFORM=3:26,HBHCFORM=4:13,1:28)
"RTN","HBHCUTL1",17,0)
 S HBHCXREF=$S(HBHCFORM=3:"AE",HBHCFORM=4:"AC",1:"AF"),HBHCSTAT=$S(HBHCFORM=3:$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,17),HBHCFORM=5:$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,18),1:$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,8))
"RTN","HBHCUTL1",18,0)
 D NOW^%DTC S HBHCNOW=$E(%,1,12)
"RTN","HBHCUTL1",19,0)
 K:HBHCSTAT]"" ^HBHC(HBHCFILE,HBHCXREF,HBHCSTAT,HBHCDFN)
"RTN","HBHCUTL1",20,0)
 L +^HBHC(HBHCFILE,HBHCDFN,HBHCNODE)
"RTN","HBHCUTL1",21,0)
 S $P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,HBHCPC1)="N",^HBHC(HBHCFILE,HBHCXREF,"N",HBHCDFN)="",$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,HBHCPC2)=HBHCNOW,$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,HBHCPC3)=DUZ
"RTN","HBHCUTL1",22,0)
 I (HBHCFORM=3)&($P(^HBHC(HBHCFILE,HBHCDFN,0),U,40)]"") S HBHC5XMT=$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,18) K:HBHC5XMT]"" ^HBHC(HBHCFILE,"AF",HBHC5XMT,HBHCDFN) S $P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,18)="N",^HBHC(HBHCFILE,"AF","N",HBHCDFN)=""
"RTN","HBHCUTL1",23,0)
 I HBHCFORM=5 S HBHC3XMT=$P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,17) K:HBHC3XMT]"" ^HBHC(HBHCFILE,"AE",HBHC3XMT,HBHCDFN) S $P(^HBHC(HBHCFILE,HBHCDFN,HBHCNODE),U,17)="N",^HBHC(HBHCFILE,"AE","N",HBHCDFN)=""
"RTN","HBHCUTL1",24,0)
 L -^HBHC(HBHCFILE,HBHCDFN,HBHCNODE)
"RTN","HBHCUTL1",25,0)
 D:HBHCFORM'=4 SETNODE
"RTN","HBHCUTL1",26,0)
EXIT ; Exit FORMMSG module
"RTN","HBHCUTL1",27,0)
 K HBHCADDT,HBHCDPT0,HBHCDSDT,HBHCFILE,HBHCHOSP,HBHCINFO,HBHCLNTH,HBHCNAME,HBHCNDX1,HBHCNODE,HBHCNOW,HBHCPC1,HBHCPC2,HBHCPC3,HBHCREC,HBHCSP4,HBHCSP8,HBHCSP86,HBHCSTAT,HBHCXREF,HBHC3XMT,HBHC5XMT
"RTN","HBHCUTL1",28,0)
 Q
"RTN","HBHCUTL1",29,0)
SETNODE ; Set node in ^HBHC(634.4) (Form 6 Corrections file)
"RTN","HBHCUTL1",30,0)
 S $P(HBHCSP4," ",5)="",$P(HBHCSP8," ",9)="",$P(HBHCSP86," ",87)="",HBHCLNTH=30
"RTN","HBHCUTL1",31,0)
 L +^HBHC(634.4,0) S HBHCNDX1=$P(^HBHC(634.4,0),U,3)+1,$P(^HBHC(634.4,0),U,3)=HBHCNDX1,$P(^HBHC(634.4,0),U,4)=$P(^HBHC(634.4,0),U,4)+1 L -^HBHC(634.4,0)
"RTN","HBHCUTL1",32,0)
 S HBHCINFO=^HBHC(HBHCFILE,HBHCDFN,0),HBHCDPT0=^DPT(HBHCDPT,0)
"RTN","HBHCUTL1",33,0)
 S HBHCADDT=$S($P(HBHCINFO,U,18)]"":$E($P(HBHCINFO,U,18),4,5)_$E($P(HBHCINFO,U,18),6,7)_(1700+$E($P(HBHCINFO,U,18),1,3)),1:HBHCSP8)
"RTN","HBHCUTL1",34,0)
 S HBHCDSDT=$S($P(HBHCINFO,U,40)]"":$E($P(HBHCINFO,U,40),4,5)_$E($P(HBHCINFO,U,40),6,7)_(1700+$E($P(HBHCINFO,U,40),1,3)),1:HBHCSP8)
"RTN","HBHCUTL1",35,0)
 S HBHCNAME=$P(HBHCDPT0,U) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCUTL1",36,0)
 S HBHCHOSP=$P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U) S:$L(HBHCHOSP)'=7 HBHCHOSP=HBHCHOSP_$E(HBHCSP4,1,(7-($L(HBHCHOSP))))
"RTN","HBHCUTL1",37,0)
 S HBHCREC=6_HBHCHOSP_$P(HBHCDPT0,U,9)_HBHCADDT_HBHCNAME_HBHCDSDT_2_HBHCSP86
"RTN","HBHCUTL1",38,0)
 S ^HBHC(634.4,HBHCNDX1,0)=HBHCREC,^HBHC(634.4,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCUTL1",39,0)
 Q
"RTN","HBHCUTL1",40,0)
BIRTHYR ; Birth year field display during Evaluation/Admission Data Entry
"RTN","HBHCUTL1",41,0)
 S HBHCDPT0=^DPT(HBHCDPT,0)
"RTN","HBHCUTL1",42,0)
 W !!,"BIRTH YEAR:  ",$S($P(HBHCDPT0,U,3):1700+$E($P(HBHCDPT0,U,3),1,3),1:"0000"),*7 D MASMSG
"RTN","HBHCUTL1",43,0)
 Q
"RTN","HBHCUTL1",44,0)
SEXRACE ; Sex & Race fields display during Evaluation/Admission Data Entry
"RTN","HBHCUTL1",45,0)
 S HBHCDPT0=^DPT(HBHCDPT,0),HBHCSEX=$P(HBHCDPT0,U,2)
"RTN","HBHCUTL1",46,0)
 W !!,"SEX:  ",$S(HBHCSEX="M":"Male  (1)",1:"Female  (2)"),*7 D MASMSG
"RTN","HBHCUTL1",47,0)
 ; Obsolete with Race/Ethnicity Info Jan 2003 mandate; commented out historical reference  mjt
"RTN","HBHCUTL1",48,0)
 ; ,HBHCRACE=$S($P(HBHCDPT0,U,6)]"":$P(^DIC(10,$P(HBHCDPT0,U,6),0),U,2),1:"")
"RTN","HBHCUTL1",49,0)
 ;W !,"RACE:  ",$S(HBHCRACE=4:"Black  (2)",HBHCRACE=3:"American Indian/Alaskan Native  (4)",HBHCRACE=6:"White  (1)",(HBHCRACE=1)!(HBHCRACE=2):"Hispanic Origin  (3)",HBHCRACE=5:"Asian/Pacific Islander  (5)",1:"Not Determined  (9)")
"RTN","HBHCUTL1",50,0)
 ; Field retained until VA Form 10-0014 modified to remove field  mjt
"RTN","HBHCUTL1",51,0)
 W !,"RACE:  Obsolete Field  Jan 2003",!
"RTN","HBHCUTL1",52,0)
 K HBHCDPT0,HBHCSEX
"RTN","HBHCUTL1",53,0)
 Q
"RTN","HBHCUTL1",54,0)
MASMSG ; MAS message for BIRTHYR & SEX modules
"RTN","HBHCUTL1",55,0)
 W !?18,"***  Contact MAS if value is incorrect.  ***",!
"RTN","HBHCUTL1",56,0)
 Q
"RTN","HBHCXMA")
0^13^B26593993
"RTN","HBHCXMA",1,0)
HBHCXMA ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634) with Evaluation/Admission Data or ^HBHC(634.1), file of records in ^HBHC(631) containing missing/erroneous data, called by ^HBHCFILE, calls ^HBHCXMA1 ;9/02
"RTN","HBHCXMA",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**1,6,9,19**;NOV 01, 1993
"RTN","HBHCXMA",3,0)
 D START^HBHCXMA1
"RTN","HBHCXMA",4,0)
LOOP ; Loop thru ^HBHC(631) "AE","N" cross-ref to create nodes in ^HBHC(634) => transmit or ^HBHC(634.1) => Evaluation/Admission Error(s) file
"RTN","HBHCXMA",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AE","N",HBHCDFN)) Q:HBHCDFN=""  S HBHCFLG=1 D SETNODE I HBHCFLG D:HBHCDR="" TRANS D:HBHCDR]"" ERROR^HBHCXMA1
"RTN","HBHCXMA",6,0)
EXIT ; Exit module
"RTN","HBHCXMA",7,0)
 D EXIT^HBHCXMA1
"RTN","HBHCXMA",8,0)
 Q
"RTN","HBHCXMA",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit) or ^HBHC(634.1) Evaluation/Admission Error(s))
"RTN","HBHCXMA",10,0)
 S HBHCINFO=^HBHC(631,HBHCDFN,0),HBHCXMT3=$P($G(^HBHC(631,HBHCDFN,1)),U,17)
"RTN","HBHCXMA",11,0)
 ; Quit if admission date is greater than HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMA",12,0)
 I $P(HBHCINFO,U,18)>HBHCLSDT S HBHCFLG=0 Q
"RTN","HBHCXMA",13,0)
 S HBHCDPT0=^DPT(+HBHCINFO,0),HBHCDR=""
"RTN","HBHCXMA",14,0)
 S DFN=+HBHCINFO K VADM D DEM^VADPT D RACE,ETH
"RTN","HBHCXMA",15,0)
 S HBHCAFLG=0 F HBHCK=19:1:37 Q:HBHCAFLG  S:$P(HBHCINFO,U,HBHCK)]"" HBHCAFLG=1
"RTN","HBHCXMA",16,0)
 S HBHCRFLG=0 S:($P(HBHCINFO,U,16)]"")!($P(HBHCINFO,U,17)]"") HBHCRFLG=1
"RTN","HBHCXMA",17,0)
 S HBHCADDT=$S($P(HBHCINFO,U,18)]"":$E($P(HBHCINFO,U,18),4,5)_$E($P(HBHCINFO,U,18),6,7)_(1700+$E($P(HBHCINFO,U,18),1,3)),1:HBHCSP8)
"RTN","HBHCXMA",18,0)
 ; Use Evaluation Date for historical 'Reject' purposes 
"RTN","HBHCXMA",19,0)
 S:HBHCADDT=HBHCSP8 HBHCADDT=$S($P(HBHCINFO,U,2)]"":$E($P(HBHCINFO,U,2),4,5)_$E($P(HBHCINFO,U,2),6,7)_(1700+$E($P(HBHCINFO,U,2),1,3)),1:HBHCSP8)
"RTN","HBHCXMA",20,0)
 S:HBHCADDT=HBHCSP8 HBHCDR=HBHCDR_"17;"
"RTN","HBHCXMA",21,0)
 S HBHCST=$S($P(HBHCINFO,U,3)]"":$P(^DIC(5,(+^HBHC(631.8,($P(HBHCINFO,U,3)),0)),0),U,3),1:"") S:HBHCST="" HBHCDR=HBHCDR_"2;"
"RTN","HBHCXMA",22,0)
 S HBHCCNTY="" S:(($P(HBHCINFO,U,3)]"")&($P(HBHCINFO,U,4)]"")) HBHCCNTY=$P($G(^DIC(5,(+^HBHC(631.8,($P(HBHCINFO,U,3)),0)),1,$P(HBHCINFO,U,4),0)),U,3) S:HBHCCNTY="" HBHCDR=HBHCDR_"3;"
"RTN","HBHCXMA",23,0)
 S HBHCZIP=$S($P(HBHCINFO,U,5)]"":$P(HBHCINFO,U,5),1:"") S:$L(HBHCZIP)'=9 HBHCZIP=HBHCZIP_HBHCSP4 S:HBHCZIP="" HBHCDR=HBHCDR_"4;"
"RTN","HBHCXMA",24,0)
 S HBHCELGE=$S($P(HBHCINFO,U,6)]"":$P(HBHCINFO,U,6),1:"") S:HBHCELGE="" HBHCDR=HBHCDR_"5;"
"RTN","HBHCXMA",25,0)
 S HBHCBYR=$S($P(HBHCDPT0,U,3):1700+$E($P(HBHCDPT0,U,3),1,3),1:"0000")
"RTN","HBHCXMA",26,0)
 S HBHCPSRV=$S($P(HBHCINFO,U,8)]"":$P(^HBHC(631.7,$P(HBHCINFO,U,8),0),U),1:"") S:HBHCPSRV="" HBHCDR=HBHCDR_"7;"
"RTN","HBHCXMA",27,0)
 S HBHCSX=$P(HBHCDPT0,U,2),HBHCSEX=$S(HBHCSX="M":1,1:2)
"RTN","HBHCXMA",28,0)
 ; Obsolete with Race/Ethnicity Info Jan 2003 mandate; commented out historical reference; HBHCRC set to X in HBHCXMA1  mjt
"RTN","HBHCXMA",29,0)
 ;S HBHCRC=$S($P(HBHCDPT0,U,6)]"":$P(^DIC(10,$P(HBHCDPT0,U,6),0),U,2),1:""),HBHCRACE=$S(HBHCRC=6:1,HBHCRC=4:2,(HBHCRC=1)!(HBHCRC=2):3,HBHCRC=3:4,HBHCRC=5:5,1:9)
"RTN","HBHCXMA",30,0)
 F HBHCI=1:1:4 S HBHCFLD=$P(HBHCFLD1,U,HBHCI) S @HBHCFLD=$S($P(HBHCINFO,U,HBHCI+10)]"":$P(HBHCINFO,U,HBHCI+10),1:"") S:@HBHCFLD="" HBHCDR=HBHCDR_(HBHCI+9)_";"
"RTN","HBHCXMA",31,0)
 S HBHCRFIN=$S($P($G(^HBHC(631,HBHCDFN,1)),U,29)]"":$P($G(^HBHC(631,HBHCDFN,1)),U,29),1:HBHCSP1)
"RTN","HBHCXMA",32,0)
 S HBHCACTN=$S($P(HBHCINFO,U,15)]"":$P(HBHCINFO,U,15),1:"") I (HBHCACTN="")!((HBHCACTN=1)&(HBHCRFLG=1))!((HBHCACTN=2)&(HBHCAFLG=1)) S HBHCDR=HBHCDR_"14;" Q
"RTN","HBHCXMA",33,0)
 S HBHCREJ=$S($P(HBHCINFO,U,16)]"":$P(^HBHC(631.1,$P(HBHCINFO,U,16),0),U),1:HBHCSP2) S:(HBHCACTN=2)&(HBHCREJ=HBHCSP2) HBHCDR=HBHCDR_"15;"
"RTN","HBHCXMA",34,0)
 S HBHCREJD=$S($P(HBHCINFO,U,17)]"":$P(HBHCINFO,U,17),1:HBHCSP1) S:(HBHCACTN=2)&(HBHCREJD=HBHCSP1) HBHCDR=HBHCDR_"16;"
"RTN","HBHCXMA",35,0)
 S HBHCICDA=$S($P(HBHCINFO,U,19)]"":$P($P(^ICD9($P(HBHCINFO,U,19),0),U),".")_$P($P(^ICD9($P(HBHCINFO,U,19),0),U),".",2),1:HBHCSP6) S:$L(HBHCICDA)<6 HBHCICDA=HBHCICDA_$J("",6-$L(HBHCICDA)) S:(HBHCACTN=1)&(HBHCICDA=HBHCSP6) HBHCDR=HBHCDR_"18;"
"RTN","HBHCXMA",36,0)
 F HBHCJ=1:1:18 S HBHCFLD=$P(HBHCFLD2,U,HBHCJ) S @HBHCFLD=$S($P(HBHCINFO,U,HBHCJ+19)]"":$P(HBHCINFO,U,HBHCJ+19),1:HBHCSP1) S:(HBHCACTN=1)&(@HBHCFLD=HBHCSP1) HBHCDR=HBHCDR_(HBHCJ+18)_";"
"RTN","HBHCXMA",37,0)
 Q:HBHCDR]""
"RTN","HBHCXMA",38,0)
 S HBHCNAME=$P(^DPT($P(HBHCINFO,U),0),U) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCXMA",39,0)
 S HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMA",40,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCADDT_HBHCST_HBHCCNTY_HBHCZIP_HBHCELGE_HBHCBYR_HBHCPSRV_HBHCSEX_HBHCRC_HBHCMARE_HBHCLIVE_HBHCCARE_HBHCTYPE_HBHCRFIN_HBHCACTN_HBHCREJ_HBHCREJD_HBHCNAME
"RTN","HBHCXMA",41,0)
 S HBHCREC=HBHCREC_HBHCICDA_HBHCVISA_HBHCHERA_HBHCEXCA_HBHCRECA_HBHCBTHA_HBHCDRSA_HBHCTLTA_HBHCTRNA_HBHCEATA_HBHCWLKA_HBHCBWLA_HBHCBLDA_HBHCMOBA_HBHCADTA_HBHCBHVA_HBHCDSOA_HBHCMODA_HBHCLMTA_HBHCRACE_HBHCETH
"RTN","HBHCXMA",42,0)
 Q
"RTN","HBHCXMA",43,0)
RACE ; Race Jan 2003 mandate: 7 Race codes (w/corresponding Collection Method codes) exist, 4 additional 'slots' are for future expansion = 11 total for loop counter for data fill in transmit record
"RTN","HBHCXMA",44,0)
 S HBHCRACE="",HBHCEND=11,HBHCNODE=12,HBHCFIL=1
"RTN","HBHCXMA",45,0)
 D LOOP2
"RTN","HBHCXMA",46,0)
 S HBHCRACE=HBHCVAR
"RTN","HBHCXMA",47,0)
 Q
"RTN","HBHCXMA",48,0)
ETH ; Ethnicity Jan 2003 mandate: 4 Ethnicity codes (w/corresponding Collection Method codes) exist, 4 additional 'slots' are for future expansion = 8 total for loop counter for data fill in transmit record
"RTN","HBHCXMA",49,0)
 S HBHCETH="",HBHCEND=8,HBHCNODE=11,HBHCFIL=2
"RTN","HBHCXMA",50,0)
 D LOOP2
"RTN","HBHCXMA",51,0)
 S HBHCETH=HBHCVAR
"RTN","HBHCXMA",52,0)
 Q
"RTN","HBHCXMA",53,0)
LOOP2 ; Loop 2
"RTN","HBHCXMA",54,0)
 S HBHCVAR=""
"RTN","HBHCXMA",55,0)
 F HBHCL=1:1:HBHCEND S:'$D(VADM(HBHCNODE,HBHCL)) HBHCVAR=HBHCVAR_HBHCSP2 I $D(VADM(HBHCNODE,HBHCL)) D SET S HBHCVAR=HBHCVAR_HBHCPTFV_HBHCCM
"RTN","HBHCXMA",56,0)
 Q
"RTN","HBHCXMA",57,0)
SET ; Set PTF Value & Collection Method Variables
"RTN","HBHCXMA",58,0)
 S HBHCIENP=$P(VADM(HBHCNODE,HBHCL),U)
"RTN","HBHCXMA",59,0)
 S HBHCIEN2=$P(VADM(HBHCNODE,HBHCL,1),U)
"RTN","HBHCXMA",60,0)
 S HBHCPTFV=$$PTR2CODE^DGUTL4(HBHCIENP,HBHCFIL,HBHCPTF)
"RTN","HBHCXMA",61,0)
 S HBHCCM=$$PTR2CODE^DGUTL4(HBHCIEN2,HBHCT103,HBHCPTF)
"RTN","HBHCXMA",62,0)
 Q
"RTN","HBHCXMA",63,0)
TRANS ; Set node in ^HBHC(634) transmit file & flag record as 'F" (filed for transmit) in ^HBHC(631)
"RTN","HBHCXMA",64,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1,$P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMA",65,0)
 S $P(^HBHC(634,HBHCNDX1,0),U)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMA",66,0)
 L +^HBHC(631,HBHCDFN,1) K:HBHCXMT3]"" ^HBHC(631,"AE",HBHCXMT3,HBHCDFN) S $P(^HBHC(631,HBHCDFN,1),U,17)="F",^HBHC(631,"AE","F",HBHCDFN)="",$P(^HBHC(631,HBHCDFN,1),U,19)=HBHCTDY L -^HBHC(631,HBHCDFN,1)
"RTN","HBHCXMA",67,0)
 Q
"RTN","HBHCXMA1")
0^20^B11373763
"RTN","HBHCXMA1",1,0)
HBHCXMA1 ; LR VAMC(IRMS)/MJT-HBHC, called by ^HBHCXMA, entry points: START, ERROR, EXIT ; Jul 2000
"RTN","HBHCXMA1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,14,19**;NOV 01, 1993
"RTN","HBHCXMA1",3,0)
START ; Initialization
"RTN","HBHCXMA1",4,0)
 W !,"Processing Admission/Form 3 Data"
"RTN","HBHCXMA1",5,0)
 S HBHCFORM=3,$P(HBHCSP1," ",2)="",$P(HBHCSP2," ",3)="",$P(HBHCSP4," ",5)="",$P(HBHCSP6," ",7)="",$P(HBHCSP8," ",9)="",HBHCLNTH=30
"RTN","HBHCXMA1",6,0)
 S HBHCHOSP=$P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U) S:$L(HBHCHOSP)'=7 HBHCHOSP=HBHCHOSP_$E(HBHCSP4,1,(7-($L(HBHCHOSP))))
"RTN","HBHCXMA1",7,0)
 S HBHCFLD1="HBHCMARE^HBHCLIVE^HBHCCARE^HBHCTYPE"
"RTN","HBHCXMA1",8,0)
 S HBHCFLD2="HBHCVISA^HBHCHERA^HBHCEXCA^HBHCRECA^HBHCBTHA^HBHCDRSA^HBHCTLTA^HBHCTRNA^HBHCEATA^HBHCWLKA^HBHCBWLA^HBHCBLDA^HBHCMOBA^HBHCADTA^HBHCBHVA^HBHCDSOA^HBHCMODA^HBHCLMTA"
"RTN","HBHCXMA1",9,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMA1",10,0)
 ; Initialize variables passed for $$PRT2CODE^DGUTL4(VALUE,TYPE,CODE) calls
"RTN","HBHCXMA1",11,0)
 ; Following comments stolen from DGUTL4 routine:
"RTN","HBHCXMA1",12,0)
 ; Convert pointer to specified code
"RTN","HBHCXMA1",13,0)
 ; Input: VALUE - Pointer to RACE file (#10), ETHNICITY file (#10.2),
"RTN","HBHCXMA1",14,0)
 ;                or RACE AND ETHNICITY COLLECTION METHOD file (#10.3)
"RTN","HBHCXMA1",15,0)
 ;        TYPE - Flag indicating which file VALUE is for
"RTN","HBHCXMA1",16,0)
 ;               1 = Race (default)
"RTN","HBHCXMA1",17,0)
 ;               2 = Ethnicity
"RTN","HBHCXMA1",18,0)
 ;               3 = Collection Method
"RTN","HBHCXMA1",19,0)
 ;        CODE - Flag indicating which code to return
"RTN","HBHCXMA1",20,0)
 ;               1 = Abbreviation (default)
"RTN","HBHCXMA1",21,0)
 ;               2 = HL7
"RTN","HBHCXMA1",22,0)
 ;               3 = CDC (not applicable for Collection Method)
"RTN","HBHCXMA1",23,0)
 ;               4 = PTF
"RTN","HBHCXMA1",24,0)
 ; End of DGUTL4 comment theft  mjt
"RTN","HBHCXMA1",25,0)
 ; Race = 10, Ethnicity = 102, Collection Method = 103
"RTN","HBHCXMA1",26,0)
 ; Type
"RTN","HBHCXMA1",27,0)
 S HBHCT103=3
"RTN","HBHCXMA1",28,0)
 ; Code, PTF Value used for all files
"RTN","HBHCXMA1",29,0)
 S HBHCPTF=4
"RTN","HBHCXMA1",30,0)
 ; Race field set to "X" & became Historical only, beginning w/Jan 2003 new Race & Ethnicity Information fields mandate  mjt
"RTN","HBHCXMA1",31,0)
 S HBHCRC="X"
"RTN","HBHCXMA1",32,0)
 Q
"RTN","HBHCXMA1",33,0)
ERROR ; Set node in ^HBHC(634.1) if data is incomplete or proper fields invalid for 'Admit/Reject Action'
"RTN","HBHCXMA1",34,0)
 L +^HBHC(634.1,0) S HBHCNDX2=$P(^HBHC(634.1,0),U,3)+1,$P(^HBHC(634.1,0),U,3)=HBHCNDX2,$P(^HBHC(634.1,0),U,4)=$P(^HBHC(634.1,0),U,4)+1 L -^HBHC(634.1,0)
"RTN","HBHCXMA1",35,0)
 S ^HBHC(634.1,HBHCNDX2,0)=$P(HBHCINFO,U)_U_HBHCDFN,^HBHC(634.1,HBHCNDX2,1)=HBHCDR,^HBHC(634.1,"B",$P(HBHCINFO,U),HBHCNDX2)=""
"RTN","HBHCXMA1",36,0)
 Q
"RTN","HBHCXMA1",37,0)
EXIT ; Exit module => cleanup for HBHCXMA
"RTN","HBHCXMA1",38,0)
 K HBHCACTN,HBHCADDT,HBHCADTA,HBHCAFLG,HBHCBHVA,HBHCBLDA,HBHCBTHA,HBHCBWLA,HBHCBYR,HBHCCM,HBHCCARE,HBHCCNTY,HBHCDATE,HBHCDFN,HBHCDPT0,HBHCDR,HBHCDRSA,HBHCDSOA,HBHCEATA,HBHCELGE,HBHCEND,HBHCETH,HBHCEXCA,HBHCFIL,HBHCFLD,HBHCFLD1
"RTN","HBHCXMA1",39,0)
 K HBHCFLD2,HBHCFLG,HBHCFORM,HBHCHERA,HBHCHOSP,HBHCI,HBHCICDA,HBHCIEN2,HBHCIENP,HBHCINFO,HBHCJ,HBHCK,HBHCL,HBHCLIVE,HBHCLMTA,HBHCLNTH,HBHCMARE,HBHCMOBA,HBHCMODA,HBHCNAME,HBHCNDX1,HBHCNDX2,HBHCNODE,HBHCPSRV,HBHCPTF,HBHCPTFV
"RTN","HBHCXMA1",40,0)
 K HBHCRACE,HBHCRC,HBHCREC,HBHCRECA,HBHCREJ,HBHCREJD,HBHCRFIN,HBHCRFLG,HBHCSEX,HBHCSP1,HBHCSP2,HBHCSP4,HBHCSP6,HBHCSP8,HBHCSSN,HBHCST,HBHCSX,HBHCT103,HBHCTDY,HBHCTLTA,HBHCTRNA,HBHCTYPE,HBHCVAR,HBHCVISA,HBHCWLKA,HBHCXMT3,HBHCZIP
"RTN","HBHCXMA1",41,0)
 K X,Y,%DT
"RTN","HBHCXMA1",42,0)
 Q
"RTN","HBHCXMD")
0^19^B22377789
"RTN","HBHCXMD",1,0)
HBHCXMD ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634) with Discharge Data or ^HBHC(634.3), file of records in ^HBHC(631) containing missing/erroneous data, called by ^HBHCFILE, calls ^HBHCXMD1 ;9804
"RTN","HBHCXMD",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**4,6,9,10,13,19**;NOV 01, 1993
"RTN","HBHCXMD",3,0)
 D START^HBHCXMD1
"RTN","HBHCXMD",4,0)
LOOP ; Loop thru ^HBHC(631) "AF","N" cross-ref to create nodes in ^HBHC(634) => transmit or ^HBHC(634.3) => Discharge Error(s) file
"RTN","HBHCXMD",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(631,"AF","N",HBHCDFN)) Q:HBHCDFN=""  S HBHCFLG=1,HBHCCONT=0 D SETNODE I HBHCFLG D:HBHCCONT TRANS D:'HBHCCONT ERROR
"RTN","HBHCXMD",6,0)
EXIT ; Exit module
"RTN","HBHCXMD",7,0)
 D EXIT^HBHCXMD1
"RTN","HBHCXMD",8,0)
 Q
"RTN","HBHCXMD",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit) or ^HBHC(634.3) (Discharge Error(s))
"RTN","HBHCXMD",10,0)
 S HBHCNOD0=^HBHC(631,HBHCDFN,0),HBHCNOD1=$G(^HBHC(631,HBHCDFN,1)),HBHCXMT5=$P(HBHCNOD1,U,18)
"RTN","HBHCXMD",11,0)
 ; Quit if discharge date is greater than HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMD",12,0)
 I $P(HBHCNOD0,U,40)>HBHCLSDT S HBHCFLG=0 Q
"RTN","HBHCXMD",13,0)
 S (HBHCDR1,HBHCDR2,HBHCDR3,HBHCDR4,HBHCDR5)=""
"RTN","HBHCXMD",14,0)
 S HBHCTFLG=0 S:($P(HBHCNOD0,U,45)]"")!($P(HBHCNOD0,U,46)]"") HBHCTFLG=1
"RTN","HBHCXMD",15,0)
 S HBHCDFLG=0 F HBHCL=47:1:55 Q:HBHCDFLG  S:$P(HBHCNOD0,U,HBHCL)]"" HBHCDFLG=1
"RTN","HBHCXMD",16,0)
 I HBHCNOD1]"" F HBHCM=1:1:10 Q:HBHCDFLG  S:$P(HBHCNOD1,U,HBHCM)]"" HBHCDFLG=1
"RTN","HBHCXMD",17,0)
 S HBHCADDT=$S($P(HBHCNOD0,U,18)]"":$E($P(HBHCNOD0,U,18),4,5)_$E($P(HBHCNOD0,U,18),6,7)_(1700+$E($P(HBHCNOD0,U,18),1,3)),$P(HBHCNOD0,U,2)]"":$E($P(HBHCNOD0,U,2),4,5)_$E($P(HBHCNOD0,U,2),6,7)_(1700+$E($P(HBHCNOD0,U,2),1,3)),1:"")
"RTN","HBHCXMD",18,0)
 S HBHCDSDT=$S($P(HBHCNOD0,U,40)]"":$E($P(HBHCNOD0,U,40),4,5)_$E($P(HBHCNOD0,U,40),6,7)_(1700+$E($P(HBHCNOD0,U,40),1,3)),1:"")
"RTN","HBHCXMD",19,0)
 K HBHCDDTA F HBHCI=1:1:4 S HBHCFLD=$P(HBHCFLD1,U,HBHCI) S:HBHCFLD]"" HBHCDDTA=1 S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCI+40)]"":$P(HBHCNOD0,U,HBHCI+40),1:"") D:@HBHCFLD="" DFLT1^HBHCXMD1
"RTN","HBHCXMD",20,0)
 S:((HBHCDSDT="")&((HBHCDFLG=1)!(HBHCTFLG=1)!($D(HBHCDDTA)))) HBHCDR1="39;"_HBHCDR1
"RTN","HBHCXMD",21,0)
 Q:HBHCSTAT=""
"RTN","HBHCXMD",22,0)
 I HBHCSTAT=4 I (HBHCDFLG)!(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",23,0)
 I (HBHC359[(U_HBHCSTAT_U))&(HBHCTFLG) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",24,0)
 I HBHCNOD1]"" I ($P(HBHCNOD1,U,15)]"")&(HBHCSTAT'=4) S HBHCDR1=HBHCDR1_"43;" Q
"RTN","HBHCXMD",25,0)
 S HBHCDEST=$S($P(HBHCNOD0,U,45)]"":$P(HBHCNOD0,U,45),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCDEST=HBHCSP1) HBHCDR1=HBHCDR1_"44;"
"RTN","HBHCXMD",26,0)
 S HBHCAGCY=$S($P(HBHCNOD0,U,46)]"":$P(HBHCNOD0,U,46),1:HBHCSP1) S:(HBHC12[(U_HBHCSTAT_U))&(HBHCAGCY=HBHCSP1) HBHCDR1=HBHCDR1_"45;"
"RTN","HBHCXMD",27,0)
 S HBHCICDD=$S($P(HBHCNOD0,U,47)]"":$P($P(^ICD9($P(HBHCNOD0,U,47),0),U),".")_$P($P(^ICD9($P(HBHCNOD0,U,47),0),U),".",2),1:HBHCSP6) S:$L(HBHCICDD)<6 HBHCICDD=HBHCICDD_$J("",6-$L(HBHCICDD)) D:(HBHCSTAT'=4)&(HBHCICDD=HBHCSP6) ICDDFLT^HBHCXMD1
"RTN","HBHCXMD",28,0)
 F HBHCJ=1:1:8 S HBHCFLD=$P(HBHCFLD2,U,HBHCJ) S @HBHCFLD=$S($P(HBHCNOD0,U,HBHCJ+47)]"":$P(HBHCNOD0,U,HBHCJ+47),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT2^HBHCXMD1
"RTN","HBHCXMD",29,0)
 F HBHCK=1:1:10 S HBHCFLD=$P(HBHCFLD3,U,HBHCK) S @HBHCFLD=$S($P(HBHCNOD1,U,HBHCK)]"":$P(HBHCNOD1,U,HBHCK),1:HBHCSP1) D:(HBHCSTAT'=4)&(@HBHCFLD=HBHCSP1) DFLT3^HBHCXMD1
"RTN","HBHCXMD",30,0)
 Q:(HBHCADDT="")!(HBHCDR1]"")!(HBHCDR2]"")!(HBHCDR3]"")!(HBHCDR4]"")!(HBHCDR5]"")
"RTN","HBHCXMD",31,0)
 S HBHCCONT=1
"RTN","HBHCXMD",32,0)
 S HBHCNAME=$E($P(^DPT($P(HBHCNOD0,U),0),U),1,5) S:$L(HBHCNAME)<HBHCLNTH HBHCNAME=HBHCNAME_$J("",HBHCLNTH-$L(HBHCNAME))
"RTN","HBHCXMD",33,0)
 S HBHCSSN=$P(^DPT($P(HBHCNOD0,U),0),U,9)
"RTN","HBHCXMD",34,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDSDT_HBHCELGD_HBHCMARD_HBHCLIVD_HBHCSTAT_HBHCDEST_HBHCAGCY_HBHCADDT_HBHCNAME_HBHCICDD_HBHCVISD_HBHCHERD_HBHCEXCD_HBHCRECD_HBHCBTHD_HBHCDRSD_HBHCTLTD_HBHCTRND_HBHCEATD_HBHCWLKD_HBHCBWLD_HBHCBLDD
"RTN","HBHCXMD",35,0)
 S HBHCREC=HBHCREC_HBHCMOBD_HBHCADTD_HBHCBHVD_HBHCDSOD_HBHCMODD_HBHCLMTD_HBHCSP81
"RTN","HBHCXMD",36,0)
 Q
"RTN","HBHCXMD",37,0)
TRANS ; Set node in ^HBHC(634) transmit file & flag record as 'F" (filed for transmit) in ^HBHC(631)
"RTN","HBHCXMD",38,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1,$P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMD",39,0)
 S $P(^HBHC(634,HBHCNDX1,0),U)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMD",40,0)
 L +^HBHC(631,HBHCDFN,1) K:HBHCXMT5]"" ^HBHC(631,"AF",HBHCXMT5,HBHCDFN) S $P(^HBHC(631,HBHCDFN,1),U,18)="F",^HBHC(631,"AF","F",HBHCDFN)="",$P(^HBHC(631,HBHCDFN,1),U,22)=HBHCTDY L -^HBHC(631,HBHCDFN,1)
"RTN","HBHCXMD",41,0)
 Q
"RTN","HBHCXMD",42,0)
ERROR ; Set node in ^HBHC(634.3) if data is incomplete or proper fields invalid for 'Discharge Status'
"RTN","HBHCXMD",43,0)
 L +^HBHC(634.3,0) S HBHCNDX2=$P(^HBHC(634.3,0),U,3)+1,$P(^HBHC(634.3,0),U,3)=HBHCNDX2,$P(^HBHC(634.3,0),U,4)=$P(^HBHC(634.3,0),U,4)+1 L -^HBHC(634.3,0)
"RTN","HBHCXMD",44,0)
 S ^HBHC(634.3,HBHCNDX2,0)=$P(HBHCNOD0,U)_U_HBHCDFN
"RTN","HBHCXMD",45,0)
 S:HBHCDR1]"" ^HBHC(634.3,HBHCNDX2,1)=HBHCDR1
"RTN","HBHCXMD",46,0)
 S:HBHCDR2]"" ^HBHC(634.3,HBHCNDX2,2)=HBHCDR2
"RTN","HBHCXMD",47,0)
 S:HBHCDR3]"" ^HBHC(634.3,HBHCNDX2,3)=HBHCDR3
"RTN","HBHCXMD",48,0)
 S:HBHCDR4]"" ^HBHC(634.3,HBHCNDX2,4)=HBHCDR4
"RTN","HBHCXMD",49,0)
 S:HBHCDR5]"" ^HBHC(634.3,HBHCNDX2,5)=HBHCDR5
"RTN","HBHCXMD",50,0)
 S ^HBHC(634.3,"B",$P(HBHCNOD0,U),HBHCNDX2)=""
"RTN","HBHCXMD",51,0)
 Q
"RTN","HBHCXMD1")
0^18^B14611933
"RTN","HBHCXMD1",1,0)
HBHCXMD1 ; LR VAMC(IRMS)/MJT-HBHC, called by ^HBHCXMD ;9203
"RTN","HBHCXMD1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,6,19**;NOV 01, 1993
"RTN","HBHCXMD1",3,0)
START ; Initialization
"RTN","HBHCXMD1",4,0)
 W !,"Processing Discharge/Form 5 Data"
"RTN","HBHCXMD1",5,0)
 S HBHCFORM=5,HBHC12="^1^2^",HBHC359="^3^5^9^",$P(HBHCSP1," ",2)="",$P(HBHCSP4," ",5)="",$P(HBHCSP6," ",7)="",$P(HBHCSP81," ",82)="",HBHCLNTH=5
"RTN","HBHCXMD1",6,0)
 S HBHCHOSP=$P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U) S:$L(HBHCHOSP)'=7 HBHCHOSP=HBHCHOSP_$E(HBHCSP4,1,(7-($L(HBHCHOSP))))
"RTN","HBHCXMD1",7,0)
 S HBHCFLD1="HBHCELGD^HBHCMARD^HBHCLIVD^HBHCSTAT"
"RTN","HBHCXMD1",8,0)
 S HBHCFLD2="HBHCVISD^HBHCHERD^HBHCEXCD^HBHCRECD^HBHCBTHD^HBHCDRSD^HBHCTLTD^HBHCTRND"
"RTN","HBHCXMD1",9,0)
 S HBHCFLD3="HBHCEATD^HBHCWLKD^HBHCBWLD^HBHCBLDD^HBHCMOBD^HBHCADTD^HBHCBHVD^HBHCDSOD^HBHCMODD^HBHCLMTD"
"RTN","HBHCXMD1",10,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMD1",11,0)
 Q
"RTN","HBHCXMD1",12,0)
DFLT1 ; Process fields 5, 10, & 11 as default values for fields 40, 41 & 42
"RTN","HBHCXMD1",13,0)
 S HBHCX=$S(HBHCI=1:6,HBHCI=2:11,HBHCI=3:12,1:""),HBHCDFLT=""
"RTN","HBHCXMD1",14,0)
 S:$P(HBHCNOD0,U,HBHCX)]"" HBHCDFLT=$P($P(^DD(631,(HBHCX-1),0),($P(HBHCNOD0,U,HBHCX)_":"),2),";")
"RTN","HBHCXMD1",15,0)
 S HBHCDR1=$S(HBHCDFLT]"":HBHCDR1_(HBHCI+39)_"//"_HBHCDFLT_";",1:HBHCDR1_(HBHCI+39)_";")
"RTN","HBHCXMD1",16,0)
 Q
"RTN","HBHCXMD1",17,0)
ICDDFLT ; Process field 18 as default value for field 46
"RTN","HBHCXMD1",18,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",19,0)
 S:$P(HBHCNOD0,U,19)]"" HBHCDFLT=$P(^ICD9($P(HBHCNOD0,U,19),0),U)
"RTN","HBHCXMD1",20,0)
 S HBHCDR1=$S(HBHCDFLT]"":HBHCDR1_"46//"_HBHCDFLT_";",1:HBHCDR1_"46;")
"RTN","HBHCXMD1",21,0)
 Q
"RTN","HBHCXMD1",22,0)
DFLT2 ; Process fields 19 - 26 as default values for fields 47 - 54
"RTN","HBHCXMD1",23,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",24,0)
 S:(HBHCJ=3)&($P(HBHCNOD0,U,22)]"") HBHCDFLT=$P(^HBHC(631.2,$P(HBHCNOD0,U,22),0),U)
"RTN","HBHCXMD1",25,0)
 S:(HBHCJ=4)&($P(HBHCNOD0,U,23)]"") HBHCDFLT=$P(^HBHC(631.3,$P(HBHCNOD0,U,23),0),U)
"RTN","HBHCXMD1",26,0)
 S:(HBHCJ'=3)&(HBHCJ'=4)&($P(HBHCNOD0,U,HBHCJ+19)]"") HBHCDFLT=$P($P(^DD(631,(HBHCJ+18),0),($P(HBHCNOD0,U,HBHCJ+19)_":"),2),";")
"RTN","HBHCXMD1",27,0)
 S:(HBHCJ=1)!(HBHCJ=2) HBHCDR1=$S(HBHCDFLT]"":HBHCDR1_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR1_(HBHCJ+46)_";")
"RTN","HBHCXMD1",28,0)
 S:(HBHCJ=3)!(HBHCJ=4)!(HBHCJ=5) HBHCDR2=$S(HBHCDFLT]"":HBHCDR2_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR2_(HBHCJ+46)_";")
"RTN","HBHCXMD1",29,0)
 S:(HBHCJ=6)!(HBHCJ=7)!(HBHCJ=8) HBHCDR3=$S(HBHCDFLT]"":HBHCDR3_(HBHCJ+46)_"//"_HBHCDFLT_";",1:HBHCDR3_(HBHCJ+46)_";")
"RTN","HBHCXMD1",30,0)
 Q
"RTN","HBHCXMD1",31,0)
DFLT3 ; Process fields 27 - 36 as default values for fields 55 - 64
"RTN","HBHCXMD1",32,0)
 S HBHCDFLT=""
"RTN","HBHCXMD1",33,0)
 S:$P(HBHCNOD0,U,HBHCK+27)]"" HBHCDFLT=$P($P(^DD(631,(HBHCK+26),0),($P(HBHCNOD0,U,HBHCK+27)_":"),2),";")
"RTN","HBHCXMD1",34,0)
 S:HBHCK=1 HBHCDR3=$S(HBHCDFLT]"":HBHCDR3_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR3_(HBHCK+54)_";")
"RTN","HBHCXMD1",35,0)
 S:(HBHCK>1)&(HBHCK<6) HBHCDR4=$S(HBHCDFLT]"":HBHCDR4_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR4_(HBHCK+54)_";")
"RTN","HBHCXMD1",36,0)
 S:HBHCK>5 HBHCDR5=$S(HBHCDFLT]"":HBHCDR5_(HBHCK+54)_"//"_HBHCDFLT_";",1:HBHCDR5_(HBHCK+54)_";")
"RTN","HBHCXMD1",37,0)
 Q
"RTN","HBHCXMD1",38,0)
EXIT ; Exit module
"RTN","HBHCXMD1",39,0)
 K HBHC12,HBHC359,HBHCADDT,HBHCADTD,HBHCAGCY,HBHCBHVD,HBHCBLDD,HBHCBTHD,HBHCBWLD,HBHCCONT,HBHCDATE,HBHCDDTA,HBHCDEST,HBHCDFLG,HBHCDFLT,HBHCDFN,HBHCDR1,HBHCDR2,HBHCDR3,HBHCDR3,HBHCDR4,HBHCDR5,HBHCDRSD,HBHCDSDT,HBHCDSOD,HBHCEATD
"RTN","HBHCXMD1",40,0)
 K HBHCELGD,HBHCEXCD,HBHCFLD,HBHCFLD1,HBHCFLD2,HBHCFLD3,HBHCFLG,HBHCFORM,HBHCHERD,HBHCHOSP,HBHCI,HBHCICDD,HBHCJ,HBHCK,HBHCL,HBHCLIVD,HBHCLMTD,HBHCLNTH,HBHCM,HBHCMARD,HBHCMOBD,HBHCMODD,HBHCNAME,HBHCNDX1,HBHCNDX2,HBHCNOD0
"RTN","HBHCXMD1",41,0)
 K HBHCNOD1,HBHCREC,HBHCRECD,HBHCSP1,HBHCSP4,HBHCSP6,HBHCSP81,HBHCSSN,HBHCSTAT,HBHCTDY,HBHCTFLG,HBHCTLTD,HBHCTRND,HBHCVISD,HBHCWLKD,HBHCX,HBHCXMT5,X,Y,%DT
"RTN","HBHCXMD1",42,0)
 Q
"RTN","HBHCXMV")
0^6^B18350983
"RTN","HBHCXMV",1,0)
HBHCXMV ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634 with Visit Data, or ^HBHC(634.5, file of recs in ^HBHC(632 w/pseudo SSNs, called by ^HBHCFILE, calls HBHCXMV1 ; Oct 2000
"RTN","HBHCXMV",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,9,12,15,17,14,19**;NOV 01, 1993
"RTN","HBHCXMV",3,0)
 D START^HBHCXMV1
"RTN","HBHCXMV",4,0)
LOOP ; Loop thru ^HBHC(632) "AC","N" cross-ref to create nodes in ^HBHC(634) => transmit
"RTN","HBHCXMV",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"AC","N",HBHCDFN)) Q:HBHCDFN=""  D SETNODE
"RTN","HBHCXMV",6,0)
EXIT ; Exit module
"RTN","HBHCXMV",7,0)
 D EXIT^HBHCXMV1
"RTN","HBHCXMV",8,0)
 Q
"RTN","HBHCXMV",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit)
"RTN","HBHCXMV",10,0)
 S HBHCINFO=^HBHC(632,HBHCDFN,0),HBHCXMT4=$P(HBHCINFO,U,8),HBHCAPDT=$P(HBHCINFO,U,2),HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMV",11,0)
 Q:$P(HBHCINFO,U,7)]""  ; cancelled/no show appointment
"RTN","HBHCXMV",12,0)
 Q:HBHCAPDT>HBHCLSDT  ; Visit appointment date > HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMV",13,0)
 I HBHCAPDT<2961001 D PCE^HBHCXMV1 Q
"RTN","HBHCXMV",14,0)
 I HBHCSSN'?9N D PSSN^HBHCXMV1 Q
"RTN","HBHCXMV",15,0)
 S HBHCPRV=+^HBHC(631.4,$P(HBHCINFO,U,4),0) S:$L(HBHCPRV)'=4 HBHCPRV=HBHCPRV_HBHCSP1
"RTN","HBHCXMV",16,0)
 S HBHCTIME=$P(HBHCAPDT,".",2) S:$L(HBHCTIME)<4 HBHCTIME=HBHCTIME_$E(HBHCZRO4,1,(4-($L(HBHCTIME)))) S:$L(HBHCTIME)>4 HBHCTIME=$E(HBHCTIME,1,4)
"RTN","HBHCXMV",17,0)
 S HBHCDATE=$E(HBHCAPDT,4,5)_$E(HBHCAPDT,6,7)_(1700+$E(HBHCAPDT,1,3))_HBHCTIME
"RTN","HBHCXMV",18,0)
 S HBHCLNME=$P($P(^DPT($P(HBHCINFO,U),0),U),",") S:$L(HBHCLNME)'=11 HBHCLNME=$S($L(HBHCLNME)<11:HBHCLNME_$E(HBHCSP10,1,11-$L(HBHCLNME)),1:$E(HBHCLNME,1,11))
"RTN","HBHCXMV",19,0)
 S HBHCQAI=$S(($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)=""):HBHCSP1_$P(HBHCINFO,U,16),($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)]""):$P(HBHCINFO,U,16)_HBHCSP1,$L($P(HBHCINFO,U,16))=2:$P(HBHCINFO,U,16),1:HBHCSP2)
"RTN","HBHCXMV",20,0)
DX ; Dx
"RTN","HBHCXMV",21,0)
 D INIT,DX^HBHCUTL3
"RTN","HBHCXMV",22,0)
 S HBHCL=0 F  S HBHCL=$O(HBHCDX(HBHCL)) Q:HBHCL'>0  S HBHCDX=$P(HBHCDX(HBHCL),"  "),HBHCDX=$P(HBHCDX,".")_$P(HBHCDX,".",2) S HBHCDX(HBHCL)=$S($L(HBHCDX)'=6:HBHCDX_$E(HBHCSP6,1,6-$L(HBHCDX)),1:HBHCDX)
"RTN","HBHCXMV",23,0)
 ; Note:  HBHCI initialized here vs in CPT loop, since need HBHCI to continue for each 10 CPT code iteration
"RTN","HBHCXMV",24,0)
 S (HBHCFLAG,HBHCI,HBHCL)=0 F  S HBHCL=$O(HBHCDX(HBHCL)) Q:HBHCL'>0  S HBHCCNT1=HBHCCNT1+1,@("HBHCDX"_HBHCCNT1)=HBHCDX(HBHCL) D:(HBHCCNT1=5)&('HBHCFLAG) CPT D:HBHCCNT1=5 WRITE
"RTN","HBHCXMV",25,0)
 F  D:'HBHCFLAG CPT D WRITE Q:HBHCFLAG
"RTN","HBHCXMV",26,0)
 Q
"RTN","HBHCXMV",27,0)
CPT ; CPT Codes
"RTN","HBHCXMV",28,0)
 F HBHCCNT=1:1:10 S HBHCI=$O(^HBHC(632,HBHCDFN,2,HBHCI)) Q:HBHCI'>0  S HBHCNOD2=^HBHC(632,HBHCDFN,2,HBHCI,0) D SET
"RTN","HBHCXMV",29,0)
 S:HBHCI'>0 HBHCFLAG=1
"RTN","HBHCXMV",30,0)
 Q
"RTN","HBHCXMV",31,0)
SET ; Set CPT variables
"RTN","HBHCXMV",32,0)
 I HBHCCNT<10 S @("HBHCCPT"_HBHCCNT)=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(@("HBHCCPT"_HBHCCNT))'=5 @("HBHCCPT"_HBHCCNT)=@("HBHCCPT"_HBHCCNT)_$E(HBHCSP5,1,5-$L(@("HBHCCPT"_HBHCCNT)))
"RTN","HBHCXMV",33,0)
 I HBHCCNT=10 S HBHCCP10=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCP10)'=5 HBHCCP10=HBHCCP10_$E(HBHCSP5,1,5-$L(HBHCCP10))
"RTN","HBHCXMV",34,0)
 Q
"RTN","HBHCXMV",35,0)
WRITE ; Write transmit record, separate records containing max 5 DX & 10 CPTs each are generated for same visit if > 5 DX or > 10 CPTs exist
"RTN","HBHCXMV",36,0)
 Q:(HBHCDX1=HBHCSP6)&(HBHCCPT1=HBHCSP5)
"RTN","HBHCXMV",37,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1 F  Q:'$D(^HBHC(634,HBHCNDX1))  S HBHCNDX1=HBHCNDX1+1
"RTN","HBHCXMV",38,0)
 S $P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMV",39,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDATE_HBHCPRV_HBHCLNME_HBHCQAI_HBHCDX1_HBHCDX2_HBHCDX3_HBHCDX4_HBHCDX5_HBHCCPT1_HBHCCPT2_HBHCCPT3_HBHCCPT4_HBHCCPT5_HBHCCPT6_HBHCCPT7_HBHCCPT8_HBHCCPT9_HBHCCP10_HBHCSP24
"RTN","HBHCXMV",40,0)
 S ^HBHC(634,HBHCNDX1,0)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMV",41,0)
 ; Flag record as filed
"RTN","HBHCXMV",42,0)
 L +^HBHC(632,HBHCDFN,0) K:HBHCXMT4]"" ^HBHC(632,"AC",HBHCXMT4,HBHCDFN) S $P(^HBHC(632,HBHCDFN,0),U,8)="F",^HBHC(632,"AC","F",HBHCDFN)="",$P(^HBHC(632,HBHCDFN,0),U,9)=HBHCTDY L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCXMV",43,0)
 ; Initialize QAI, DX & CPT fields to spaces after 1st record written to avoid multiple count(s) of same data when > 5 DX or > 10 CPTs exist
"RTN","HBHCXMV",44,0)
 S HBHCQAI=HBHCSP2
"RTN","HBHCXMV",45,0)
INIT ; Initialize variables
"RTN","HBHCXMV",46,0)
 F HBHCK=1:1:5 S @("HBHCDX"_HBHCK)=HBHCSP6
"RTN","HBHCXMV",47,0)
 S (HBHCCNT,HBHCCNT1)=0,HBHCCP10=HBHCSP5
"RTN","HBHCXMV",48,0)
 F HBHCJ=1:1:9 S @("HBHCCPT"_HBHCJ)=HBHCSP5
"RTN","HBHCXMV",49,0)
 Q
"RTN","HBHCXMV1")
0^7^B6107370
"RTN","HBHCXMV1",1,0)
HBHCXMV1 ; LR VAMC(IRMS)/MJT-HBHC, called by ^HBHCXMV, entry points:  START, PCE, PSSN, & EXIT ; Aug 2000
"RTN","HBHCXMV1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,15,14,19**;NOV 01, 1993
"RTN","HBHCXMV1",3,0)
START ; Initialization
"RTN","HBHCXMV1",4,0)
 W !,"Processing Visit/Form 4 Data"
"RTN","HBHCXMV1",5,0)
 K ^HBHC(634.5) S ^HBHC(634.5,0)="HBHC PSEUDO SSN ERROR(S)^634.5P^"
"RTN","HBHCXMV1",6,0)
 S HBHCFORM=4,$P(HBHCSP1," ",2)="",$P(HBHCSP2," ",3)="",$P(HBHCSP4," ",5)="",$P(HBHCSP5," ",6)="",$P(HBHCSP6," ",7)="",$P(HBHCSP10," ",11)="",$P(HBHCSP24," ",25)="",$P(HBHCZRO4,"0",5)=""
"RTN","HBHCXMV1",7,0)
 S HBHCHOSP=$P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U) S:$L(HBHCHOSP)'=7 HBHCHOSP=HBHCHOSP_$E(HBHCSP4,1,(7-($L(HBHCHOSP))))
"RTN","HBHCXMV1",8,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMV1",9,0)
 Q
"RTN","HBHCXMV1",10,0)
PCE ; Appointment pre-dates Patient Care Encounter (PCE)
"RTN","HBHCXMV1",11,0)
 S DIE="^HBHC(632,",DA=HBHCDFN,DR="7///O" D ^DIE
"RTN","HBHCXMV1",12,0)
 Q
"RTN","HBHCXMV1",13,0)
PSSN ; Patient has pseudo SSN
"RTN","HBHCXMV1",14,0)
 K DD,DO S DIC="^HBHC(634.5,",DIC(0)="MN",(X,DINUM)=$P(HBHCINFO,U) D FILE^DICN
"RTN","HBHCXMV1",15,0)
 Q
"RTN","HBHCXMV1",16,0)
EXIT ; Exit module
"RTN","HBHCXMV1",17,0)
 K DA,DIC,DIE,DINUM,DR,DTOUT,HBHCAPDT,HBHCCNT,HBHCCNT1,HBHCCPT1,HBHCCPT2,HBHCCPT3,HBHCCPT4,HBHCCPT5,HBHCCPT6,HBHCCPT7,HBHCCPT8,HBHCCPT9,HBHCCP10,HBHCDATE,HBHCDFN,HBHCDX,HBHCDX1,HBHCDX2,HBHCDX3,HBHCDX4,HBHCDX5,HBHCFLAG,HBHCFORM
"RTN","HBHCXMV1",18,0)
 K HBHCHOSP,HBHCI,HBHCINFO,HBHCJ,HBHCK,HBHCL,HBHCLNME,HBHCNDX1,HBHCNDX2,HBHCNOD2,HBHCPRV,HBHCREC,HBHCQAI,HBHCSP1,HBHCSP10,HBHCSP2,HBHCSP4,HBHCSP5,HBHCSP6,HBHCSP24,HBHCSSN,HBHCSTDT,HBHCTDY,HBHCTIME,HBHCXMT4,HBHCZRO4,X,Y,%DT
"RTN","HBHCXMV1",19,0)
 Q
"VER")
8.0^22.0
"^DD",631,631,9,0)
RACE^CJ31^^ ; ^X ^DD(631,9,9.5) S X=$S(Y(631,9,2):Y(631,9,3),Y(631,9,4):Y(631,9,5),Y(631,9,6):Y(631,9,7),Y(631,9,8):Y(631,9,9),Y(631,9,10):Y(631,9,11),Y(631,9,12):Y(631,9,13),Y(631,9,14):X)
"^DD",631,631,9,3)
Answer with 1 digit numeric code representing patient's race.
"^DD",631,631,9,9)
^
"^DD",631,631,9,9.01)
631^9.1
"^DD",631,631,9,9.1)
$S(#9.1=6:"White  (1)",#9.1=4:"Black  (2)",#9.1=2:"Hispanic  (3)",#9.1=1:"Hispanic  (3)",#9.1=3:"Amer/Indian Alaskan Native  (4)",#9.1=5:"Asian/Pacific Islander  (5)",1:"Not Determined  (9)")
"^DD",631,631,9,9.2)
X $P(^DD(631,9.1,0),U,5,99) S Y(631,9,1)=X S X=Y(631,9,1)=6,Y(631,9,2)=X S X="White  (1)",Y(631,9,3)=X S X=Y(631,9,1)=4,Y(631,9,4)=X S X="Black  (2)"
"^DD",631,631,9,9.3)
X ^DD(631,9,9.2) S Y(631,9,5)=X S X=Y(631,9,1)=2,Y(631,9,6)=X S X="Hispanic  (3)",Y(631,9,7)=X S X=Y(631,9,1)=1,Y(631,9,8)=X S X="Hispanic  (3)",Y(631,9,9)=X
"^DD",631,631,9,9.4)
X ^DD(631,9,9.3) S X=Y(631,9,1)=3,Y(631,9,10)=X S X="Amer/Indian Alaskan Native  (4)",Y(631,9,11)=X S X=Y(631,9,1)=5,Y(631,9,12)=X S X="Asian/Pacific Islander  (5)"
"^DD",631,631,9,9.5)
X ^DD(631,9,9.4) S Y(631,9,13)=X S X=1,Y(631,9,14)=X S X="Not Determined  (9)"
"^DD",631,631,9,9.6)
X ^DD(631,9.1,9.3) S Y(631,9.1,101)=$S($D(^DPT(D0,0)):^(0),1:""),D0=$P(Y(631,9.1,101),U,6) S:'$D(^DIC(10,+D0,0)) D0=-1 X ^DD(631,9.1,9.2):D0>0 S X="" S D0=Y(631,9.1,80)
"^DD",631,631,9,9.7)
X ^DD(631,9.1,9.3) S Y(631,9.1,101)=$S($D(^DPT(D0,0)):^(0),1:""),D0=$P(Y(631,9.1,101),U,6) S:'$D(^DIC(10,+D0,0)) D0=-1 X ^DD(631,9.1,9.2):D0>0 S X="" S D0=Y(631,9.1,80)
"^DD",631,631,9,9.8)
X ^DD(631,9,9.2)=4,Y(631,9,1)=X S X="Black  (2)",Y(631,9,2)=X X ^DD(631,9,9.3)=3,Y(631,9,3)=X S X="American Indian/Alaskan Native  (4)",Y(631,9,4)=X X ^DD(631,9,9.4)
"^DD",631,631,9,9.9)
X ^DD(631,9,9.8) S X=X=6,Y(631,9,5)=X S X="White  (1)",Y(631,9,6)=X X ^DD(631,9,9.5)=2,Y(631,9,7)=X S X="Hispanic Origin  (3)",Y(631,9,8)=X X ^DD(631,9,9.6)
"^DD",631,631,9,10)
X ^DD(631,9,9.9) S X=X=5,Y(631,9,9)=X S X="Asian/Pacific Islander  (5)",Y(631,9,10)=X X ^DD(631,9,9.7)=1,Y(631,9,11)=X S X="Hispanic Origin  (3)"
"^DD",631,631,9,10.1)
X ^DD(631,9,10) S Y(631,9,12)=X S X=1,Y(631,9,13)=X S X="Not Determined  (9)"
"^DD",631,631,9,10.2)
X ^DD(631,9,10.1) S X=$P(Y(631,9,601),U,2),Y(631,9,602)=X S X="Hispanic (3)",Y(631,9,603)=X S X=$P(Y(631,9,601),U,1),Y(631,9,604)=X
"^DD",631,631,9,10.3)
X ^DD(631,9,10.2) S D0=$P(Y(631,9,101),U,6) S:'$D(^DIC(10,+D0,0)) D0=-1 S Y(631,9,701)=$S($D(^DIC(10,D0,0)):^(0),1:"") S X=$P(Y(631,9,701),U,2)=2
"^DD",631,631,9,10.4)
X ^DD(631,9,10.3) S Y(631,9,702)=X S X="Hispanic (3)",Y(631,9,703)=X S X=1,Y(631,9,704)=X S X="Not Determined (9)"
"^DD",631,631,9,21,0)
^.001^7^7^3021011^^^^
"^DD",631,631,9,21,1,0)
This field is obsolete & contains historical data only  (prior to
"^DD",631,631,9,21,2,0)
Race/Ethnicity Information multiple field mandate in Jan 2003).  Race field
"^DD",631,631,9,21,3,0)
value set to "X" for Austin tranmission purposes after mandate.
"^DD",631,631,9,21,4,0)

"^DD",631,631,9,21,5,0)
Historical Description:  This fields represents patient's Race in Patient
"^DD",631,631,9,21,6,0)
(2) file. (9.1) field to convert Race field value to corresponding HBHC
"^DD",631,631,9,21,7,0)
Race code. 
"^DD",631,631,9,"DT")
2931213
"^DD",631,631,9.1,0)
RACECOMP^CJ1^^ ; ^X ^DD(631,9.1,9.3) S X=$P(Y(631,9.1,201),U,2) S D0=Y(631,9.1,80)
"^DD",631,631,9.1,9)
^
"^DD",631,631,9.1,9.01)
10^2;2^.06;631^.01
"^DD",631,631,9.1,9.1)
#.01:#.06:#2
"^DD",631,631,9.1,9.2)
S Y(631,9.1,80)=$S($D(D0):D0,1:""),Y(631,9.1,1)=$S($D(^HBHC(631,D0,0)):^(0),1:""),D0=$P(Y(631,9.1,1),U,1) S:'$D(^DPT(+D0,0)) D0=-1 S Y(631,9.1,180)=$S($D(D0):D0,1:"")
"^DD",631,631,9.1,9.3)
X ^DD(631,9.1,9.2) S Y(631,9.1,101)=$S($D(^DPT(D0,0)):^(0),1:""),D0=$P(Y(631,9.1,101),U,6) S:'$D(^DIC(10,+D0,0)) D0=-1 S Y(631,9.1,201)=$S($D(^DIC(10,D0,0)):^(0),1:"")
"^DD",631,631,9.1,21,0)
^.001^8^8^3021003^^^
"^DD",631,631,9.1,21,1,0)
This field is obsolete & contains historical data only  (prior to
"^DD",631,631,9.1,21,2,0)
Race/Ethnicity Information multiple field mandate in Jan 2003).
"^DD",631,631,9.1,21,3,0)

"^DD",631,631,9.1,21,4,0)
Historical Description:
"^DD",631,631,9.1,21,5,0)
This field returns the abbreviation field from the Race file (#10).
"^DD",631,631,9.1,21,6,0)
Used to obtain the field value needed for converting the Patient file (#2),
"^DD",631,631,9.1,21,7,0)
Race field (#.06), Abbreviation field (#1 in DIC(10,) to the corresponding
"^DD",631,631,9.1,21,8,0)
HBHC Race code field value.
"^DD",631,631,9.1,"DT")
2931213
**END**
**END**
