Released PSB*3*26 SEQ #22
Extracted from mail message
**KIDS**:PSB*3.0*26^

**INSTALL NAME**
PSB*3.0*26
"BLD",6636,0)
PSB*3.0*26^BAR CODE MED ADMIN^0^3060718^y
"BLD",6636,1,0)
^^1^1^3060525^
"BLD",6636,1,1,0)
This patch corrects display problems with the Missed Med Rpt
"BLD",6636,4,0)
^9.64PA^^
"BLD",6636,6)
3^
"BLD",6636,"KRN",0)
^9.67PA^8989.52^19
"BLD",6636,"KRN",.4,0)
.4
"BLD",6636,"KRN",.401,0)
.401
"BLD",6636,"KRN",.402,0)
.402
"BLD",6636,"KRN",.403,0)
.403
"BLD",6636,"KRN",.5,0)
.5
"BLD",6636,"KRN",.84,0)
.84
"BLD",6636,"KRN",3.6,0)
3.6
"BLD",6636,"KRN",3.8,0)
3.8
"BLD",6636,"KRN",9.2,0)
9.2
"BLD",6636,"KRN",9.8,0)
9.8
"BLD",6636,"KRN",9.8,"NM",0)
^9.68A^10^4
"BLD",6636,"KRN",9.8,"NM",7,0)
PSBOMM^^0^50839011
"BLD",6636,"KRN",9.8,"NM",8,0)
PSBOMM2^^0^14344461
"BLD",6636,"KRN",9.8,"NM",9,0)
PSBOMH1^^0^71055237
"BLD",6636,"KRN",9.8,"NM",10,0)
PSBOMH2^^0^36786547
"BLD",6636,"KRN",9.8,"NM","B","PSBOMH1",9)

"BLD",6636,"KRN",9.8,"NM","B","PSBOMH2",10)

"BLD",6636,"KRN",9.8,"NM","B","PSBOMM",7)

"BLD",6636,"KRN",9.8,"NM","B","PSBOMM2",8)

"BLD",6636,"KRN",19,0)
19
"BLD",6636,"KRN",19,"NM",0)
^9.68A^^
"BLD",6636,"KRN",19.1,0)
19.1
"BLD",6636,"KRN",101,0)
101
"BLD",6636,"KRN",409.61,0)
409.61
"BLD",6636,"KRN",771,0)
771
"BLD",6636,"KRN",870,0)
870
"BLD",6636,"KRN",8989.51,0)
8989.51
"BLD",6636,"KRN",8989.52,0)
8989.52
"BLD",6636,"KRN",8994,0)
8994
"BLD",6636,"KRN","B",.4,.4)

"BLD",6636,"KRN","B",.401,.401)

"BLD",6636,"KRN","B",.402,.402)

"BLD",6636,"KRN","B",.403,.403)

"BLD",6636,"KRN","B",.5,.5)

"BLD",6636,"KRN","B",.84,.84)

"BLD",6636,"KRN","B",3.6,3.6)

"BLD",6636,"KRN","B",3.8,3.8)

"BLD",6636,"KRN","B",9.2,9.2)

"BLD",6636,"KRN","B",9.8,9.8)

"BLD",6636,"KRN","B",19,19)

"BLD",6636,"KRN","B",19.1,19.1)

"BLD",6636,"KRN","B",101,101)

"BLD",6636,"KRN","B",409.61,409.61)

"BLD",6636,"KRN","B",771,771)

"BLD",6636,"KRN","B",870,870)

"BLD",6636,"KRN","B",8989.51,8989.51)

"BLD",6636,"KRN","B",8989.52,8989.52)

"BLD",6636,"KRN","B",8994,8994)

"BLD",6636,"QUES",0)
^9.62^^
"BLD",6636,"REQB",0)
^9.611^1^1
"BLD",6636,"REQB",1,0)
PSB*3.0*27^2
"BLD",6636,"REQB","B","PSB*3.0*27",1)

"MBREQ")
0
"PKG",537,-1)
1^1
"PKG",537,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",537,20,0)
^9.402P^^
"PKG",537,22,0)
^9.49I^1^1
"PKG",537,22,1,0)
3.0^3040224^3040504^22979
"PKG",537,22,1,"PAH",1,0)
26^3060718^33270
"PKG",537,22,1,"PAH",1,1,0)
^^1^1^3060718
"PKG",537,22,1,"PAH",1,1,1,0)
This patch corrects display problems with the Missed Med Rpt
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSBOMH1")
0^9^B71055237^B78413665
"RTN","PSBOMH1",1,0)
PSBOMH1 ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,9,11,26**;Mar 2004
"RTN","PSBOMH1",3,0)
 ;
"RTN","PSBOMH1",4,0)
 ; Reference/IA
"RTN","PSBOMH1",5,0)
 ; ^DILF/2054
"RTN","PSBOMH1",6,0)
 ; File 200/10060
"RTN","PSBOMH1",7,0)
 ;
"RTN","PSBOMH1",8,0)
EN ;
"RTN","PSBOMH1",9,0)
 ; Load administrations
"RTN","PSBOMH1",10,0)
 S (PSBORD,PSBIEN,PSBR1,PSBADIEN,PSBABR)="",PSBDT=PSBSTRT
"RTN","PSBOMH1",11,0)
 K PSBTSA
"RTN","PSBOMH1",12,0)
 F  S PSBDT=$O(^PSB(53.79,"AADT",DFN,PSBDT)) Q:'PSBDT!(PSBDT>PSBSTOP)  D
"RTN","PSBOMH1",13,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBDT,PSBIEN)) Q:'PSBIEN  Q:'$D(^PSB(53.79,PSBIEN))  L +^PSB(53.79,PSBIEN):3 I $P(^PSB(53.79,PSBIEN,0),U,9)]"" D  L -^PSB(53.79,PSBIEN)
"RTN","PSBOMH1",14,0)
 ..Q:'$P($G(^PSB(53.79,PSBIEN,0)),U,6)  ; Bad IEN -no evnt dt
"RTN","PSBOMH1",15,0)
 ..Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"  ;NGiven
"RTN","PSBOMH1",16,0)
 ..S PSBORD=$P($G(^PSB(53.79,PSBIEN,.1)),U,1)
"RTN","PSBOMH1",17,0)
 ..; Continuous
"RTN","PSBOMH1",18,0)
 ..D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)="C"
"RTN","PSBOMH1",19,0)
 ...S X=PSBDT D H^%DTC S PSBWEEK=PSBAR(%H) D CLEAN^PSBVT,PSJ1^PSBVT($P(^PSB(53.79,PSBIEN,0),U,1),$P(^PSB(53.79,PSBIEN,.1),U,1))
"RTN","PSBOMH1",20,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,6)'=PSBDT,'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR) D  D CLEAN^PSBVT Q  ;chck IV audit
"RTN","PSBOMH1",21,0)
 ....S PSBSIEN=PSBIEN
"RTN","PSBOMH1",22,0)
 ....I $P(^PSB(53.79,PSBIEN,0),"^",10)]"" D BAGDTL^PSBRPC2(.PSBAUD,$P(^PSB(53.79,PSBIEN,0),U,10),$P(^PSB(53.79,PSBIEN,.1),U,1))
"RTN","PSBOMH1",23,0)
 ....S PSBIEN=PSBSIEN K PSBSIEN
"RTN","PSBOMH1",24,0)
 ....S X=0 F  S X=$O(PSBAUD(X)) Q:X=""  I $P(PSBAUD(X),U,3)="" K PSBAUD(X)
"RTN","PSBOMH1",25,0)
 ....S X=0 F  S X=$O(PSBAUD(X)) Q:X=""  Q:$P(PSBAUD(X),U,1)=PSBDT
"RTN","PSBOMH1",26,0)
 ....I X="" K PSBAUD Q
"RTN","PSBOMH1",27,0)
 ....I '$D(PSBAUD(X)) K PSBAUD Q
"RTN","PSBOMH1",28,0)
 ....S PSBS=$P(PSBAUD(X),U,3)
"RTN","PSBOMH1",29,0)
 ....I PSBS="GIVEN",$P($G(PSBAUD(X-1)),U,3)="NOT GIVEN" Q
"RTN","PSBOMH1",30,0)
 ....I PSBS="NOT GIVEN" Q
"RTN","PSBOMH1",31,0)
 ....S PSBS=$S(PSBS="INFUSING":"I",PSBS="GIVEN":"G",PSBS="COMPLETED":"C",PSBS="HELD":"H",PSBS="REFUSED":"R",PSBS="REMOVED":"RM",PSBS="STOPPED":"S",PSBS["MISSING":"M",1:"NOACTION")
"RTN","PSBOMH1",32,0)
 ....D PSBSTIV^PSBOMH2
"RTN","PSBOMH1",33,0)
 ....S X=PSBDT_U_$P(PSBAUD(X),U,2)_U_PSBS_U_PSBIEN
"RTN","PSBOMH1",34,0)
 ....S Y=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,""),-1)+1
"RTN","PSBOMH1",35,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,Y)=X
"RTN","PSBOMH1",36,0)
 ....S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,0)=Y
"RTN","PSBOMH1",37,0)
 ....D PSBOUT($P((X),"^",1),$P((X),"^",2))
"RTN","PSBOMH1",38,0)
 ....K PSBAUD
"RTN","PSBOMH1",39,0)
 ...S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBOMH1",40,0)
 ...S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH1",41,0)
 ...I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",42,0)
 ...;get instrc info - audt log
"RTN","PSBOMH1",43,0)
 ...I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",44,0)
 ....D INSTR^PSBOMH
"RTN","PSBOMH1",45,0)
 ....S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",46,0)
 ...I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",47,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,9)="G",PSBDT=$P(^PSB(53.79,PSBIEN,0),U,6)  D PSBCK1^PSBOMH2("A")
"RTN","PSBOMH1",48,0)
 ...I $P(^PSB(53.79,PSBIEN,0),U,9)'="G",PSBDT=$P(^PSB(53.79,PSBIEN,0),U,6)  D PSBCK1^PSBOMH2("B")
"RTN","PSBOMH1",49,0)
 ...I PSBDT'=$P(^PSB(53.79,PSBIEN,0),U,6),$P(^PSB(53.79,PSBIEN,0),U,9)="RM" D
"RTN","PSBOMH1",50,0)
 ....D DDAUD
"RTN","PSBOMH1",51,0)
 ....S I="" F  S I=$O(PSBTAR(I),-1) Q:I=""  I $P(PSBTAR(I),U,1)=PSBDT D
"RTN","PSBOMH1",52,0)
 .....S PSBS=$P(PSBTAR(I),U,3)
"RTN","PSBOMH1",53,0)
 .....I PSBS="GIVEN",$P($G(PSBTAR(I-1)),U,3)="NOT GIVEN" Q  ; canceled - not given
"RTN","PSBOMH1",54,0)
 .....I PSBS="NOT GIVEN" Q
"RTN","PSBOMH1",55,0)
 .....S PSBS=$S(PSBS="INFUSING":"I",PSBS="GIVEN":"G",PSBS="COMPLETED":"C",PSBS="HELD":"H",PSBS="REFUSED":"R",PSBS="REMOVED":"RM",PSBS="STOPPED":"S",PSBS["MISSING":"M",1:"NO ACTION")
"RTN","PSBOMH1",56,0)
 .....D PSBCTAR^PSBOMH2
"RTN","PSBOMH1",57,0)
 .....S X=$P(PSBTAR(I),U,1,2)_U_PSBS_U_PSBIEN
"RTN","PSBOMH1",58,0)
 ...S Y=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,""),-1)+1
"RTN","PSBOMH1",59,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,Y)=X
"RTN","PSBOMH1",60,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDT\1,0)=Y
"RTN","PSBOMH1",61,0)
 ...D PSBOUT($P((X),"^",1),$P((X),"^",2))
"RTN","PSBOMH1",62,0)
 ...Q
"RTN","PSBOMH1",63,0)
 ..; 1-Time On Call or PRN
"RTN","PSBOMH1",64,0)
 ..D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)'="C"
"RTN","PSBOMH1",65,0)
 ...I PSBDT'=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I") Q
"RTN","PSBOMH1",66,0)
 ...S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBOMH1",67,0)
 ...S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH1",68,0)
 ...I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",69,0)
 ...S (PSBXA,PSBM)=1,(PSBZ,PSBT,PSBFLG)=""
"RTN","PSBOMH1",70,0)
 ...I $$GET1^DIQ(53.79,PSBIEN_",",.09)="REMOVED"  D
"RTN","PSBOMH1",71,0)
 ....F I=1:1 S PSBXA=$O(^PSB(53.79,PSBIEN,.9,PSBXA)) Q:PSBXA=""  I PSBXA?1.3N  S PSBZ=PSBZ+1,PSBT(PSBZ)=^PSB(53.79,PSBIEN,.9,PSBXA,0)
"RTN","PSBOMH1",72,0)
 ....F S=1:1 Q:PSBM<1  S PSBM=PSBZ-S  I (PSBM>0) I (PSBT(PSBM)["GIVEN")  S PSBFLG="1" S PRELINE1=$P(PSBT(PSBM),"'",2)_" "_$$GET1^DIQ(53.79,PSBIEN_",",.04)_" "_$E($P(PSBT(PSBM),"'",4),1,3) Q
"RTN","PSBOMH1",73,0)
 ...I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",74,0)
 ....D INSTR^PSBOMH
"RTN","PSBOMH1",75,0)
 ....S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",76,0)
 ...I '$D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,".")))  D PSBOUT(PSBDT,PSBINIT)
"RTN","PSBOMH1",77,0)
 ...S PSBLINE1=$$GET1^DIQ(53.79,PSBIEN_",",.09)_" "_$$GET1^DIQ(53.79,PSBIEN_",",.06)_" "_PSBINIT_"            "_$$GET1^DIQ(53.79,PSBIEN_",",.21),PSBLINE2=""
"RTN","PSBOMH1",78,0)
 ...I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",79,0)
 ...D:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)="P"
"RTN","PSBOMH1",80,0)
 ....I $P($G(^PSB(53.79,PSBIEN,.2)),U,2)="" S PSBLINE2="  Results: <No PRN Results On File>"
"RTN","PSBOMH1",81,0)
 ....E  D
"RTN","PSBOMH1",82,0)
 .....S PSBINIT=$$GET1^DIQ(53.79,PSBIEN_",","PRN EFFECTIVENESS ENTERED BY:INITIAL")
"RTN","PSBOMH1",83,0)
 .....S PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","PRN EFFECTIVENESS ENTERED BY:NAME")
"RTN","PSBOMH1",84,0)
 .....I PSBINIT="" S PSBINIT=99
"RTN","PSBOMH1",85,0)
 .....I $D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."))) D
"RTN","PSBOMH1",86,0)
 ......S PSBINIT=PSBINIT_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,$P(PSBDT,"."),0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",87,0)
 ......S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)=""
"RTN","PSBOMH1",88,0)
 .....I '$D(^PSB(53.79,PSBIEN,.9,$P(PSBDT,".")))  D
"RTN","PSBOMH1",89,0)
 ......D:$D(^PSB(53.79,PSBIEN,.9,0))
"RTN","PSBOMH1",90,0)
 .......S (PSBXA2,PSBFG)=0,PSBEFFDT=$P(^PSB(53.79,PSBIEN,.2),U,4) F  S PSBXA2=$O(^PSB(53.79,PSBIEN,.9,PSBXA2)) Q:+PSBXA2'>0  D  Q:PSBFG=1
"RTN","PSBOMH1",91,0)
 ........D:($P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U)=PSBEFFDT)&($P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,3)["Instruct")&($P(^PSB(53.79,PSBIEN,.2),U,3)=$P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,2))
"RTN","PSBOMH1",92,0)
 .........S PSBINIT=PSBINIT_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,PSBXA2,0),U,3)_"  "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",93,0)
 .........S ^TMP("PSB",$J,"LEGEND",PSBINIT,PSBNAME)="",PSBFG=1
"RTN","PSBOMH1",94,0)
 .....S PSBLINE2="  Results: "_$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBOMH1",95,0)
 .....S PSBRTXTW="     Entered By "_PSBINIT_" on "_$$GET1^DIQ(53.79,PSBIEN_",",.24)
"RTN","PSBOMH1",96,0)
 .....I PSBINIT[99 S PSBINIT=""
"RTN","PSBOMH1",97,0)
 ...S X=PSBDT D H^%DTC F PSBWEEK=PSBAR(%H):-7 Q:$D(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",0))!('$D(PSBAR(PSBWEEK)))
"RTN","PSBOMH1",98,0)
 ...S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)+1
"RTN","PSBOMH1",99,0)
 ...I PSBFLG="1" S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X)=PRELINE1
"RTN","PSBOMH1",100,0)
 ...S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+1)=PSBLINE1
"RTN","PSBOMH1",101,0)
 ...I $G(PSBLINE2)]"" D
"RTN","PSBOMH1",102,0)
 ....I $L(PSBLINE2)<90 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+2)=PSBLINE2 S:$$GET1^DIQ(53.79,PSBIEN_",",.24)'="" ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+3)="      "_PSBRTXTW
"RTN","PSBOMH1",103,0)
 ....I $L(PSBLINE2)>90 D
"RTN","PSBOMH1",104,0)
 .....S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+2)=$E(PSBLINE2,1,90)
"RTN","PSBOMH1",105,0)
 .....S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+3)="           "_$E(PSBLINE2,91,161)
"RTN","PSBOMH1",106,0)
 .....I $L(PSBLINE2)'>161 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+4)="      "_PSBRTXTW
"RTN","PSBOMH1",107,0)
 .....I $L(PSBLINE2)>161 S ^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+4)="     "_$E(PSBLINE2,162,200),^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",X+5)="     "_PSBRTXTW
"RTN","PSBOMH1",108,0)
 Q
"RTN","PSBOMH1",109,0)
 ;
"RTN","PSBOMH1",110,0)
DDAUD ;  audits for dispen drugs
"RTN","PSBOMH1",111,0)
 ;
"RTN","PSBOMH1",112,0)
 M PSBMLA=^PSB(53.79,PSBIEN)
"RTN","PSBOMH1",113,0)
 S PSBGA="" I $D(PSBMLA(.9,0)) D
"RTN","PSBOMH1",114,0)
 .F PSBX=1:1 Q:'$D(PSBMLA(.9,PSBX))  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D  Q
"RTN","PSBOMH1",115,0)
 ..I $D(PSBMLA(.9,PSBX-2,0)) D DT^DILF("ENPST",$P(PSBMLA(.9,PSBX-2,0),"'",2),.PSBDATE)
"RTN","PSBOMH1",116,0)
 ..I '$D(PSBMLA(.9,PSBX-2,0)) S PSBDATE=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH1",117,0)
 ..S PSBTMP(10000000-PSBDATE,"B")=PSBDATE_U_$$INITIAL^PSBRPC2($P(PSBMLA(0),U,5))_U_$P(PSBMLA(.9,PSBX,0),"'",2)
"RTN","PSBOMH1",118,0)
 ..S PSBGA=1
"RTN","PSBOMH1",119,0)
 .F PSBX=1:1 Q:'$D(PSBMLA(.9,PSBX))  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D
"RTN","PSBOMH1",120,0)
 ..S PSBTMP(10000000-$P(PSBMLA(.9,PSBX,0),U,1),"B")=$P(PSBMLA(.9,PSBX,0),U,1)_U_$$INITIAL^PSBRPC2($P(PSBMLA(.9,PSBX,0),U,2))_U_$P($P(PSBMLA(.9,PSBX,0),U,3),"'",2)
"RTN","PSBOMH1",121,0)
 ..S PSBGA=1
"RTN","PSBOMH1",122,0)
 I PSBGA'=1 S PSBTMP(10000000-$P(PSBMLA(0),U,6),"A")=$P(PSBMLA(0),U,6)_U_$$INITIAL^PSBRPC2($P(PSBMLA(0),U,7))
"RTN","PSBOMH1",123,0)
 S PSBQRY="PSBTMP",PSBCNT=1 F  S PSBQRY=$Q(@PSBQRY) Q:PSBQRY=""  D  ; does comment go with action
"RTN","PSBOMH1",124,0)
 .S PSBPQRY=$Q(@PSBQRY,-1)
"RTN","PSBOMH1",125,0)
 .I PSBPQRY="" S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; no prev action
"RTN","PSBOMH1",126,0)
 .I $QS(PSBPQRY,2)="C"  S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; prev line = comment
"RTN","PSBOMH1",127,0)
 .I $QS(PSBQRY,2)="C",$E($P(@$Q(@PSBQRY,-1),U,1),1,12)=$E($P(@PSBQRY,U,1),1,12),$P(@$Q(@PSBQRY,-1),U,2)=$P(@PSBQRY,U,2) D  Q
"RTN","PSBOMH1",128,0)
 ..S X=$P(@PSBQRY,U,4) S:X[":" X=$P(X,":",2) S $P(PSBTAR(PSBCNT-1),U,4)=X Q
"RTN","PSBOMH1",129,0)
 .S PSBTAR(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1
"RTN","PSBOMH1",130,0)
 Q
"RTN","PSBOMH1",131,0)
 ;
"RTN","PSBOMH1",132,0)
PSBOUT(PSBTET,PSBOT1) ;
"RTN","PSBOMH1",133,0)
 I '$D(^PSB(53.79,PSBIEN,.9,0))  D PSBENT^PSBOMH2(PSBOT1)
"RTN","PSBOMH1",134,0)
 S PSBIDA="" I $P(^PSB(53.79,PSBIEN,0),U,6)=PSBTET S PSBIDA=$P(^PSB(53.79,PSBIEN,0),U,7),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",135,0)
 S PSBXA1=0
"RTN","PSBOMH1",136,0)
 F  S PSBXA1=$O(^PSB(53.79,PSBIEN,.9,PSBXA1)) Q:+PSBXA1'>0  I PSBXA1'=0  D  Q:$G(PSBOT1)["*"
"RTN","PSBOMH1",137,0)
 .I $L(PSBXA1)<4  D
"RTN","PSBOMH1",138,0)
 ..I $P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",1)=PSBTET  D
"RTN","PSBOMH1",139,0)
 ...S:$G(PSBIDA)="" PSBIDA=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",2),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",140,0)
 ...I (PSBIDA=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",2)),$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",3)["Instruct"  D
"RTN","PSBOMH1",141,0)
 ....S INSDD=$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),"^",1),Y=INSDD D DD^%DT S INSDD=Y
"RTN","PSBOMH1",142,0)
 ....S PSBOT1=PSBOT1_"*",PSBNAME=PSBNAME_"/"_$P(^PSB(53.79,PSBIEN,.9,PSBXA1,0),U,3)_" "_INSDD
"RTN","PSBOMH1",143,0)
 I $G(PSBIDA)="",$P(^PSB(53.79,PSBIEN,0),U,4)=PSBTET D
"RTN","PSBOMH1",144,0)
 .S PSBIDA=$P(^PSB(53.79,PSBIEN,0),U,5),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",145,0)
 I $G(PSBNAME)="" D
"RTN","PSBOMH1",146,0)
 . S PSBIDA=$P(^PSB(53.79,PSBIEN,0),U,5),PSBOT1=$P(^VA(200,PSBIDA,0),"^",2),PSBNAME=$P(^VA(200,PSBIDA,0),"^",1)
"RTN","PSBOMH1",147,0)
 S ^TMP("PSB",$J,"LEGEND",$S($G(PSBOT1)="":99,1:PSBOT1),PSBNAME)=""
"RTN","PSBOMH1",148,0)
 Q
"RTN","PSBOMH1",149,0)
 ;
"RTN","PSBOMH2")
0^10^B36786547^B29518009
"RTN","PSBOMH2",1,0)
PSBOMH2 ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,20,27,26**;Mar 2004
"RTN","PSBOMH2",3,0)
 ;
"RTN","PSBOMH2",4,0)
 ; Reference/IA
"RTN","PSBOMH2",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH2",6,0)
 ;
"RTN","PSBOMH2",7,0)
EN ;
"RTN","PSBOMH2",8,0)
 ; Okay, let's print this puppy
"RTN","PSBOMH2",9,0)
 S PSBWEEK=0
"RTN","PSBOMH2",10,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",11,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","C"))
"RTN","PSBOMH2",12,0)
 ..D CONT
"RTN","PSBOMH2",13,0)
 ;
"RTN","PSBOMH2",14,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",15,0)
 S PSBWEEK=0
"RTN","PSBOMH2",16,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",17,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","P"))
"RTN","PSBOMH2",18,0)
 ..D PRN
"RTN","PSBOMH2",19,0)
 ;
"RTN","PSBOMH2",20,0)
 D LEGEND
"RTN","PSBOMH2",21,0)
 Q
"RTN","PSBOMH2",22,0)
CONT ;
"RTN","PSBOMH2",23,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",24,0)
 W $$HDR()
"RTN","PSBOMH2",25,0)
 S PSBDRUG=""
"RTN","PSBOMH2",26,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",27,0)
 .S PSBORD=""
"RTN","PSBOMH2",28,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",29,0)
 ..;S X="",PSBNAF=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,X)) Q:X=""  I ^TMP("PSB",$J,PSBWEEK,PSBORD,X,0)'=0 S PSBNAF=1  ; check for data
"RTN","PSBOMH2",30,0)
 ..;D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBOMH2",31,0)
 ..;S X=PSBOST D H^%DTC S PSBOSTH=%H
"RTN","PSBOMH2",32,0)
 ..;S X=PSBOSP D H^%DTC S PSBOSPH=%H
"RTN","PSBOMH2",33,0)
 ..;I PSBNAF=0 Q
"RTN","PSBOMH2",34,0)
 ..;I PSBNAF=0,$G(PSBAR(PSBOSTH))'=PSBWEEK,$G(PSBAR(PSBOSPH))'=PSBWEEK Q  ; no data for this week and neither start or stop date is this week
"RTN","PSBOMH2",35,0)
 ..S PSBCNT=8
"RTN","PSBOMH2",36,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",37,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",38,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR()
"RTN","PSBOMH2",39,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",40,0)
 ...I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",41,0)
 ....W !?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",42,0)
 ....W $$HDR()
"RTN","PSBOMH2",43,0)
 ....W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOMH2",44,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",45,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",46,0)
 ...S PSBDAY=0,PSBCOL=0
"RTN","PSBOMH2",47,0)
 ...F  S PSBDAY=$O(^TMP("PSB",$J,PSBWEEK,"HDR",PSBDAY)) Q:'PSBDAY  D
"RTN","PSBOMH2",48,0)
 ....W ?(40+(PSBCOL*13)),"| "
"RTN","PSBOMH2",49,0)
 ....S Y=$G(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDAY,PSBLINE))
"RTN","PSBOMH2",50,0)
 ....W $P(Y,U,3)
"RTN","PSBOMH2",51,0)
 ....W $E($P($P(Y,U,1)_"0000",".",2),1,4)," "
"RTN","PSBOMH2",52,0)
 ....W $P(Y,U,2)
"RTN","PSBOMH2",53,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)),(PSBLINE=PSBCNT) W "HOLD"  ;output hold status
"RTN","PSBOMH2",54,0)
 ....I '$D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY))&'$D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)) D
"RTN","PSBOMH2",55,0)
 .....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"NTDUE",PSBDAY)),(PSBLINE=PSBCNT) W "***"  ;write *** when day no due
"RTN","PSBOMH2",56,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY)),(PSBLINE=PSBCNT) W "***"   ;output discontinued status
"RTN","PSBOMH2",57,0)
 ....S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",58,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",59,0)
 Q
"RTN","PSBOMH2",60,0)
 ;
"RTN","PSBOMH2",61,0)
PRN ;
"RTN","PSBOMH2",62,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",63,0)
 W $$HDR(1)
"RTN","PSBOMH2",64,0)
 S PSBDRUG=""
"RTN","PSBOMH2",65,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",66,0)
 .S PSBORD=""
"RTN","PSBOMH2",67,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",68,0)
 ..S PSBCNT=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)
"RTN","PSBOMH2",69,0)
 ..D:PSBCNT<$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",70,0)
 ...S PSBCNT=$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",71,0)
 ..S:PSBCNT<8 PSBCNT=8  ; Minimum space for order
"RTN","PSBOMH2",72,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR(1)
"RTN","PSBOMH2",73,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",74,0)
 ...I IOSL>24,$Y>$S(PSBCNT<13:(IOSL-PSBCNT-4),(PSBCNT-PSBLINE=12):(IOSL-12),1:(IOSL-12)) D
"RTN","PSBOMH2",75,0)
 ....W !?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",76,0)
 ....W $$HDR(1)
"RTN","PSBOMH2",77,0)
 ....W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOMH2",78,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",79,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",80,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",81,0)
 Q
"RTN","PSBOMH2",82,0)
 ;
"RTN","PSBOMH2",83,0)
LEGEND  ;
"RTN","PSBOMH2",84,0)
 ;print the initials - name legend as an extra page  ;
"RTN","PSBOMH2",85,0)
 ;I '$D(^TMP("PSB",$J,"LEGEND")) K ^TMP("PSJ",$J),^TMP("PSB",$J) Q  ;
"RTN","PSBOMH2",86,0)
 D PT^PSBOHDR(DFN,.PSBHDR)  ;
"RTN","PSBOMH2",87,0)
 W !!,"Initial - Name Legend",!  ;
"RTN","PSBOMH2",88,0)
 I $D(^TMP("PSB",$J,"LEGEND"))  D
"RTN","PSBOMH2",89,0)
 .S X=$Q(^TMP("PSB",$J,"LEGEND",""))
"RTN","PSBOMH2",90,0)
 .F  W $S($QS(X,4)[99:"",1:$QS(X,4)),?10,$QS(X,5),! S X=$Q(@X) Q:$QS(X,3)'="LEGEND"  ;
"RTN","PSBOMH2",91,0)
 W !!,"Status Codes",!,"C - Completed",!,"G - Given",!,"H - Held",!,"I - Infusing",!,"M - Missing Dose Requested",!,"R - Refused",!,"RM - Removed",!,"S - Stopped",!,"*** - Medication Not Due",!  ;
"RTN","PSBOMH2",92,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH2",93,0)
 Q
"RTN","PSBOMH2",94,0)
 ;
"RTN","PSBOMH2",95,0)
HDR(PRN)   ;
"RTN","PSBOMH2",96,0)
 ; PRN = TRUE IF DISPLAYING PRN MED (OPTIONAL)
"RTN","PSBOMH2",97,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMH2",98,0)
 W !,"Start Date",?20,"Stop Date",?32,"| ",$S('$G(PRN):"Admin",1:"Action Status")
"RTN","PSBOMH2",99,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"
"RTN","PSBOMH2",100,0)
 W !,"and Time",?20,"and Time",?32,"| ",$S('$G(PRN):"Times",1:"Action Date/Times")
"RTN","PSBOMH2",101,0)
 D:'$G(PRN)
"RTN","PSBOMH2",102,0)
 .S PSBCOL=0,X=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,"HDR",X)) Q:'X  D
"RTN","PSBOMH2",103,0)
 ..W ?(40+(PSBCOL*13)),"| ",$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBOMH2",104,0)
 ..S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",105,0)
 D:$G(PRN)
"RTN","PSBOMH2",106,0)
 .W ?76,"PRN Reason"
"RTN","PSBOMH2",107,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",108,0)
 Q ""
"RTN","PSBOMH2",109,0)
 ;
"RTN","PSBOMH2",110,0)
PSBCK1(PSBCHK) ;                   
"RTN","PSBOMH2",111,0)
 I PSBCHK="A" D
"RTN","PSBOMH2",112,0)
 .S TEST=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",113,0)
 .D PSBOUT^PSBOMH1(TEST,PSBINIT)
"RTN","PSBOMH2",114,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_"G"_U_PSBIEN
"RTN","PSBOMH2",115,0)
 I PSBCHK="B" D
"RTN","PSBOMH2",116,0)
 .S TESTB=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",117,0)
 .D PSBOUT^PSBOMH1(TESTB,PSBINIT)
"RTN","PSBOMH2",118,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_$P(^(0),U,9)_U_PSBIEN
"RTN","PSBOMH2",119,0)
 S PSBCHK=""
"RTN","PSBOMH2",120,0)
 Q
"RTN","PSBOMH2",121,0)
 ;
"RTN","PSBOMH2",122,0)
PSBENT(PSBTIS) ;
"RTN","PSBOMH2",123,0)
 S PSBNAME="",PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH2",124,0)
 S ^TMP("PSB",$J,"LEGEND",$S($G(PSBTIS)="":99,1:PSBTIS),PSBNAME)=""
"RTN","PSBOMH2",125,0)
 Q
"RTN","PSBOMH2",126,0)
 ;
"RTN","PSBOMH2",127,0)
PSBSTIV ;
"RTN","PSBOMH2",128,0)
 S YB="" F  S YB=$O(PSBAUD(YB)) Q:YB=""  D
"RTN","PSBOMH2",129,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",130,0)
 ..I $P(PSBAUD(YB),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",131,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",132,0)
 ....I $P(PSBAUD(YB),U,2)'["*"  S $P(PSBAUD(YB),U,2)=$P(PSBAUD(YB),U,2)_"*"
"RTN","PSBOMH2",133,0)
 ....D PSBOUT^PSBOMH1($P(PSBAUD(YB),U,1),$P(PSBAUD(YB),U,2))
"RTN","PSBOMH2",134,0)
 Q
"RTN","PSBOMH2",135,0)
 ;
"RTN","PSBOMH2",136,0)
PSBCTAR   ;
"RTN","PSBOMH2",137,0)
 S YC="" F  S YC=$O(PSBTAR(YC)) Q:YC=""  D
"RTN","PSBOMH2",138,0)
 .S Z="" F  S Z=$O(^PSB(53.79,PSBIEN,.9,Z)) Q:Z=""  I Z'=0  D
"RTN","PSBOMH2",139,0)
 ..I $P(PSBTAR(YC),U,1)=$P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1)  D
"RTN","PSBOMH2",140,0)
 ...I $P(^PSB(53.79,PSBIEN,.9,Z,0),"^",3)["Instruct"  D
"RTN","PSBOMH2",141,0)
 ....S $P(PSBTAR(YC),U,2)=$P(PSBTAR(YC),U,2)_"*"
"RTN","PSBOMH2",142,0)
 ....D PSBOUT^PSBOMH1($P(^PSB(53.79,PSBIEN,.9,Z,0),"^",1),$P(PSBTAR(YC),U,2))
"RTN","PSBOMH2",143,0)
 Q
"RTN","PSBOMH2",144,0)
 ;
"RTN","PSBOMM")
0^7^B50839011^B85447995
"RTN","PSBOMM",1,0)
PSBOMM ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26**;Mar 2004
"RTN","PSBOMM",3,0)
 ;
"RTN","PSBOMM",4,0)
 ; Reference/IA
"RTN","PSBOMM",5,0)
 ; ^DPT/10035
"RTN","PSBOMM",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMM",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMM",8,0)
 ;
"RTN","PSBOMM",9,0)
EN ; Called from DQ^PSBO
"RTN","PSBOMM",10,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT,PSBEDIT
"RTN","PSBOMM",11,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBOMM",12,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBOMM",13,0)
 S PSBSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM",14,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBOMM",15,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOMM",16,0)
 D PRINT
"RTN","PSBOMM",17,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBOMM",18,0)
 Q
"RTN","PSBOMM",19,0)
 ;
"RTN","PSBOMM",20,0)
EN1 ; Expects DFN,PSBSTRT,PSBSTOP from EN
"RTN","PSBOMM",21,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBHOUR
"RTN","PSBOMM",22,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBOMM",23,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMM",24,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBOMM",25,0)
 S PSBX=""
"RTN","PSBOMM",26,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMM",27,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOMM",28,0)
 .D CLEAN^PSBVT
"RTN","PSBOMM",29,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBOMM",30,0)
 .Q:PSBIVT="A"  ; No Admix or Hyp.
"RTN","PSBOMM",31,0)
 .Q:PSBIVT="H"
"RTN","PSBOMM",32,0)
 .I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOMM",33,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOMM",34,0)
 .I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOMM",35,0)
 .Q:PSBONX["P"  ;no pending orders
"RTN","PSBOMM",36,0)
 .I PSBSCHT="C" D  Q  ; Only Continuous
"RTN","PSBOMM",37,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBOMM",38,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBOMM",39,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBOMM",40,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOMM",41,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOMM",42,0)
 ..I PSBFREQ="O" S PSBYES=1
"RTN","PSBOMM",43,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMM",44,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMM",45,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBOMM",46,0)
 ..Q:PSBOSTS["D"  ;Discontinued
"RTN","PSBOMM",47,0)
 ..Q:PSBNGF  ; Marked DO NOT GIVE
"RTN","PSBOMM",48,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",49,0)
 ..Q:PSBSM  ;Self med
"RTN","PSBOMM",50,0)
 ..S PSBCADM=0
"RTN","PSBOMM",51,0)
 ..I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) Q:PSBADST=""  S PSBCADM=1
"RTN","PSBOMM",52,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOMM",53,0)
 ..;Invalid admin times
"RTN","PSBOMM",54,0)
 ..F Y=1:1:$L(PSBADST,"-") D
"RTN","PSBOMM",55,0)
 ...Q:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOMM",56,0)
 ..; Below is (Order Start Date, Report Date, Schedule)
"RTN","PSBOMM",57,0)
 ..Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,$P(^TMP("PSJ",$J,PSBX,3),U,2),PSBFREQ,PSBOSTS)  ; Screens QOD type stuff
"RTN","PSBOMM",58,0)
 ..K PSBOACTL,TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBOMM",59,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOMM",60,0)
 ...D MISSED^PSBOMM2(PSBADST,.PSBEDIT)
"RTN","PSBOMM",61,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBOMM",62,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBOMM",63,0)
 ..Q:PSBOSTS["D"!(PSBOSTS="N")  ; Discontinued
"RTN","PSBOMM",64,0)
 ..Q:PSBNGF  ; Marked DO NOT GIVE
"RTN","PSBOMM",65,0)
 ..Q:PSBSM  ;Self med
"RTN","PSBOMM",66,0)
 ..; Is the One Time Given?
"RTN","PSBOMM",67,0)
 ..Q:PSBOSP=PSBOST   ;Expired one-time
"RTN","PSBOMM",68,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBOMM",69,0)
 ..Q:PSBOSP<PSBSTRT
"RTN","PSBOMM",70,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBOMM",71,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBOMM",72,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBOMM",73,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)'="N",$P(^PSB(53.79,Y,0),U,9)'="M" S PSBGVN=1,(X,Y)=0
"RTN","PSBOMM",74,0)
 ..; How long does One Time remain on the this report ??
"RTN","PSBOMM",75,0)
 ..D NOW^%DTC
"RTN","PSBOMM",76,0)
 ..S PSBRMN=1
"RTN","PSBOMM",77,0)
 ..I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBOMM",78,0)
 ..D:('PSBGVN)&(PSBRMN)
"RTN","PSBOMM",79,0)
 ...S VAR=""
"RTN","PSBOMM",80,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",81,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBOMM",82,0)
 ....D UDONE^PSBOMM2
"RTN","PSBOMM",83,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBOMM",84,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  (Off Hold) "_$$FMTE^XLFDT(PSBUNHD)
"RTN","PSBOMM",85,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOST,2),"@"," ")
"RTN","PSBOMM",86,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")
"RTN","PSBOMM",87,0)
 ...S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBOMM",88,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBOMM",89,0)
 K PSBOACTL
"RTN","PSBOMM",90,0)
 Q
"RTN","PSBOMM",91,0)
 ;
"RTN","PSBOMM",92,0)
PRINT ; Print meds stored in ^TMP("PSB",$J,DFN,....
"RTN","PSBOMM",93,0)
 N PSBHDR,PSBDT,PSBOITX,PSBONX,DFN
"RTN","PSBOMM",94,0)
 ;
"RTN","PSBOMM",95,0)
 ; Print by Patient
"RTN","PSBOMM",96,0)
 ;
"RTN","PSBOMM",97,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOMM",98,0)
 .S PSBHDR(1)="MISSED MEDICATIONS  from "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" thru "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",99,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMM",100,0)
 .W $$PTHDR()
"RTN","PSBOMM",101,0)
 .I $G(PSBEDIT) W !?5,"*Administration Times have been edited*"
"RTN","PSBOMM",102,0)
 .I $O(^TMP("PSB",$J,DFN,""))="" W !,"No Missed Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOMM",103,0)
 .S PSBDT=""
"RTN","PSBOMM",104,0)
 .F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",105,0)
 ..W !  ; Line Break Between Admin Times
"RTN","PSBOMM",106,0)
 ..S PSBOITX=""
"RTN","PSBOMM",107,0)
 ..F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",108,0)
 ...S PSBONX=""
"RTN","PSBOMM",109,0)
 ...F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",110,0)
 ....I $Y>(IOSL-5) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOMM",111,0)
 ....W !,+PSBONX,$S(PSBONX["U":"UD",PSBONX["V":"IV",1:"")
"RTN","PSBOMM",112,0)
 ....I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",113,0)
 .....W ?12,PSBDT,?38,PSBOITX
"RTN","PSBOMM",114,0)
 .....W !,?38,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,1)
"RTN","PSBOMM",115,0)
 .....W !,"Start Date/Time: ",?16,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,2)
"RTN","PSBOMM",116,0)
 .....W !,"Stop Date/Time:  ",?16,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,3)
"RTN","PSBOMM",117,0)
 .....W !
"RTN","PSBOMM",118,0)
 ....W ?12,$S(PSBDT:$$FMTE^XLFDT(PSBDT),1:PSBDT),?38,PSBOITX
"RTN","PSBOMM",119,0)
 ....W !,?38,^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)
"RTN","PSBOMM",120,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",121,0)
 .Q
"RTN","PSBOMM",122,0)
 ;
"RTN","PSBOMM",123,0)
 ; Print by Ward
"RTN","PSBOMM",124,0)
 ;
"RTN","PSBOMM",125,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOMM",126,0)
 .S PSBHDR(1)="MISSED MEDICATIONS  from "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" thru "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",127,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOMM",128,0)
 .W $$WRDHDR()
"RTN","PSBOMM",129,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Missed Medications Found" Q
"RTN","PSBOMM",130,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",131,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",132,0)
 ..S PSBINDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",133,0)
 ..S:PSBINDX="" PSBINDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",134,0)
 ..S ^TMP("PSB",$J,"B",PSBINDX,DFN)=""
"RTN","PSBOMM",135,0)
 .S PSBINDX=""
"RTN","PSBOMM",136,0)
 .F  S PSBINDX=$O(^TMP("PSB",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOMM",137,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",138,0)
 ...W ! ; Line Break Between Pt's
"RTN","PSBOMM",139,0)
 ...S PSBDT=""
"RTN","PSBOMM",140,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",141,0)
 ....W !  ; Line Break Between Admin Times
"RTN","PSBOMM",142,0)
 ....S PSBOITX=""
"RTN","PSBOMM",143,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",144,0)
 .....S PSBONX=""
"RTN","PSBOMM",145,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",146,0)
 ......I $Y>(IOSL-5) W $$WRDHDR()
"RTN","PSBOMM",147,0)
 ......W !,+PSBONX,$S(PSBONX["U":"UD",PSBONX["V":"IV",1:"")
"RTN","PSBOMM",148,0)
 ......W ?10,$G(^DPT(DFN,.101),"**")
"RTN","PSBOMM",149,0)
 ......W ?30,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBOMM",150,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",151,0)
 .......W !,PSBDT,?30,PSBOITX," ",$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,1)
"RTN","PSBOMM",152,0)
 .......W !,"Start Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,2)
"RTN","PSBOMM",153,0)
 .......W !,"Stop Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,3)
"RTN","PSBOMM",154,0)
 .......W !
"RTN","PSBOMM",155,0)
 ......W ?64,$S(PSBDT:$$FMTE^XLFDT(PSBDT,2),1:PSBDT),?80,PSBOITX
"RTN","PSBOMM",156,0)
 ......W " ",^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)
"RTN","PSBOMM",157,0)
 Q
"RTN","PSBOMM",158,0)
 ;
"RTN","PSBOMM",159,0)
WRDHDR() ; Ward Header
"RTN","PSBOMM",160,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOMM",161,0)
 W !,"Ord Num",?10,"Room-Bed",?30,"Patient",?64,"Admin Date/Time",?80,"Medication"
"RTN","PSBOMM",162,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM",163,0)
 Q ""
"RTN","PSBOMM",164,0)
 ;
"RTN","PSBOMM",165,0)
PTHDR() ; Patient Header
"RTN","PSBOMM",166,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMM",167,0)
 W !,"Order Num",?12,"Administration Date/Time",?38,"Medication"
"RTN","PSBOMM",168,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM",169,0)
 Q ""
"RTN","PSBOMM",170,0)
 ;
"RTN","PSBOMM2")
0^8^B14344461^n/a
"RTN","PSBOMM2",1,0)
PSBOMM2 ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26**;Mar 2004
"RTN","PSBOMM2",3,0)
 ;
"RTN","PSBOMM2",4,0)
 ;
"RTN","PSBOMM2",5,0)
MISSED(PSBADMN,PSBEDIT) ;
"RTN","PSBOMM2",6,0)
 ;
"RTN","PSBOMM2",7,0)
 N PSBMISD,PSBAUDT
"RTN","PSBOMM2",8,0)
 F Y=1:1:$L(PSBADMN,"-") S PSBDT=+("."_$P(PSBADMN,"-",Y))+(PSBSTRT\1) D
"RTN","PSBOMM2",9,0)
 .S PSBMISD=$$CHECK(PSBDT)
"RTN","PSBOMM2",10,0)
 .;CHECK AUDITED ADMIN TIMES FOR MISSED MED
"RTN","PSBOMM2",11,0)
 .I PSBMISD F I=1:1:$P(PSBOACTL(0),U,4) I $P($G(PSBOACTL(I,1)),U,3)["ADMIN TIMES" D  Q:'PSBMISD
"RTN","PSBOMM2",12,0)
 ..Q:$P(PSBOACTL(I,1),U)<PSBSTRT
"RTN","PSBOMM2",13,0)
 ..Q:$P(PSBOACTL(I,1),U)>PSBSTOP
"RTN","PSBOMM2",14,0)
 ..S PSBAUDT=+("."_$P(PSBOACTL(I,2),"-",Y))+(PSBSTRT\1)
"RTN","PSBOMM2",15,0)
 ..S PSBMISD=$$CHECK(PSBAUDT),PSBEDIT=1
"RTN","PSBOMM2",16,0)
 .I PSBMISD D
"RTN","PSBOMM2",17,0)
 ..S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)=""
"RTN","PSBOMM2",18,0)
 ..D UDCONT
"RTN","PSBOMM2",19,0)
 Q
"RTN","PSBOMM2",20,0)
 ;
"RTN","PSBOMM2",21,0)
CHECK(PSBDT) ;
"RTN","PSBOMM2",22,0)
 I PSBDT<PSBOST Q 0 ; Order Start Date
"RTN","PSBOMM2",23,0)
 I PSBDT'<PSBOSP Q 0 ; Order Stop Date
"RTN","PSBOMM2",24,0)
 I PSBDT<PSBSTRT Q 0 ; Report Window
"RTN","PSBOMM2",25,0)
 I PSBDT>PSBSTOP Q 0  ; Report Window
"RTN","PSBOMM2",26,0)
 I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT)) D  Q:PSBSTUS'="N"&(PSBSTUS'="M") 0
"RTN","PSBOMM2",27,0)
 .S PSBINDX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,"")),PSBSTUS=$P(^PSB(53.79,PSBINDX,0),U,9)
"RTN","PSBOMM2",28,0)
 Q 1
"RTN","PSBOMM2",29,0)
UDCONT ;
"RTN","PSBOMM2",30,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",31,0)
 K ^TMP("PSB1",$J)
"RTN","PSBOMM2",32,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",33,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",34,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",35,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",36,0)
 .S J=0 F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",37,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",38,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",39,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",40,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",41,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST'="" I PSBDT<PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",42,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST="" S PSBFLAG=1
"RTN","PSBOMM2",43,0)
 K PSBCNT,TMP("PSB1",$J)
"RTN","PSBOMM2",44,0)
 I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBOMM2",45,0)
 I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  "_"(Off Hold) "_$$FMTE^XLFDT(PSBUNHD) Q
"RTN","PSBOMM2",46,0)
 Q
"RTN","PSBOMM2",47,0)
 ;
"RTN","PSBOMM2",48,0)
UDONE ;
"RTN","PSBOMM2",49,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",50,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",51,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",52,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",53,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",54,0)
 .S J="" F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",55,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",56,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",57,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",58,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",59,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",'$D(^TMP("PSB1",$J,DFN,J+1)) I PSBSTOP>PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",60,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",PSBOFDT'<PSBSTOP S PSBFLAG=1
"RTN","PSBOMM2",61,0)
 ..I PSBOSTS="H",PSBHDST="HOLD",'$D(^TMP("PSB1",$J,DFN,J+1)) S PSBFLAG=1
"RTN","PSBOMM2",62,0)
 K PSBCNT,^TMP("PSB1",$J)
"RTN","PSBOMM2",63,0)
 Q
"RTN","PSBOMM2",64,0)
 ;
"VER")
8.0^22.0
"BLD",6636,6)
^22
**END**
**END**
