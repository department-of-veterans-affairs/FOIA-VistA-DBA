Released XM*7.1*40 SEQ #42
Extracted from mail message
**KIDS**:XM*7.1*40^

**INSTALL NAME**
XM*7.1*40
"BLD",24,0)
XM*7.1*40^MAILMAN^0^2970528^n
"BLD",24,1,0)
^^68^68^2970528^^^^
"BLD",24,1,1,0)
MailMan patch XM*7.1*40 contains the following enhancements:
"BLD",24,1,2,0)

"BLD",24,1,3,0)
NOIS:       MCM-0197-51792
"BLD",24,1,4,0)
Rtns:       ^XMA1,^XMJMQ,^XMJMQ1,^XMJMP1,^XMXUTIL,^XMYPRE1
"BLD",24,1,5,0)
DD:         file 3.9, field .01 of RECIPIENT multiple - adds "C" xref to DD
"BLD",24,1,6,0)
Test Site:  Miles City,MT; Bronx,NY
"BLD",24,1,7,0)
Improves the query (Q,QD,QN,Q name) function:
"BLD",24,1,8,0)
1) makes coding clearer
"BLD",24,1,9,0)
2) makes 'Q name' perform more like a FileMan lookup for local addressees
"BLD",24,1,10,0)
   a) recognizes partial last name, partial first name for the first time ever
"BLD",24,1,11,0)
   b) query by addressee's DUZ for the first time ever
"BLD",24,1,12,0)
   c) query by addressee's nickname for the first time ever
"BLD",24,1,13,0)
3) enables 'Q name' to work on remote addressees for the first time ever!
"BLD",24,1,14,0)
   a) recognizes partial last name
"BLD",24,1,15,0)
   b) recognizes partial last name, partial first name
"BLD",24,1,16,0)
   c) recognizes partial last name, partial domain
"BLD",24,1,17,0)
   d) (does not work with I: or CC: remote addressees)
"BLD",24,1,18,0)
4) enables 'Q name' to work on devices and servers (D. and S.) for the first
"BLD",24,1,19,0)
   time ever
"BLD",24,1,20,0)
3) improves display aesthetics
"BLD",24,1,21,0)

"BLD",24,1,22,0)
The following concerns the RECIPIENT multiple of the MESSAGE file:
"BLD",24,1,23,0)
The "C" cross reference data has always existed for the .01 field (RECIPIENT).
"BLD",24,1,24,0)
But... the DD has the "C" xref on field 1 (LAST RESPONSE READ).
"BLD",24,1,25,0)
So... We switch the xref in the DD from field 1 to field .01. as follows:
"BLD",24,1,26,0)
Routine XMYPRE1 deletes the "C" xref on field 1 (LAST RESPONSE READ).
"BLD",24,1,27,0)
The partial DD in this patch sets the "C" xref on field .01 (RECIPIENT).
"BLD",24,1,28,0)
Since the actual "C" xref data has always been on field .01, we don't need
"BLD",24,1,29,0)
to do anything with the "C" xref data - just leave it alone.
"BLD",24,1,30,0)

"BLD",24,1,31,0)
===========================================================================
"BLD",24,1,32,0)
This patch should be installed after hours, when user activity is at a
"BLD",24,1,33,0)
minimum.  You should put the XMUSER Option out of order.
"BLD",24,1,34,0)
===========================================================================
"BLD",24,1,35,0)
 
"BLD",24,1,36,0)
INSTALLATION:
"BLD",24,1,37,0)
1.  If any of these routines is mapped (on systems which allow mapping),
"BLD",24,1,38,0)
    disable mapping for the affected routine(s).
"BLD",24,1,39,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads
"BLD",24,1,40,0)
    the patch into a Transport Global on your system.
"BLD",24,1,41,0)
3.  On the KIDS:Installation menu, use the following options to install the
"BLD",24,1,42,0)
    Transport Global:
"BLD",24,1,43,0)
       Verify Checksums in Transport Global
"BLD",24,1,44,0)
       Print Transport Global
"BLD",24,1,45,0)
       Compare Transport Global to Current System
"BLD",24,1,46,0)
       Backup a Transport Global
"BLD",24,1,47,0)
       Install Package(s)
"BLD",24,1,48,0)
4.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",24,1,49,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",24,1,50,0)
5.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",24,1,51,0)
============================================================================ 
"BLD",24,1,52,0)
  
"BLD",24,1,53,0)
ROUTINES:
"BLD",24,1,54,0)
The second line of the routine now looks like:
"BLD",24,1,55,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",24,1,56,0)
 
"BLD",24,1,57,0)
              Before          After
"BLD",24,1,58,0)
Name          Checksum        Checksum        Patch List
"BLD",24,1,59,0)
----------------------------------------------------------
"BLD",24,1,60,0)
XMA1           9580091         9717771        31,36,40
"BLD",24,1,61,0)
XMJMP1         * new *        11388791        40
"BLD",24,1,62,0)
XMJMQ          * new *        14561364        40
"BLD",24,1,63,0)
XMJMQ1         * new *         3291603        40
"BLD",24,1,64,0)
XMXUTIL        * new *         2338705        40
"BLD",24,1,65,0)
XMYPRE1        * new *           32634        40
"BLD",24,1,66,0)

"BLD",24,1,67,0)
* Checksums produced by CHECK^XTSUMBLD
"BLD",24,1,68,0)
============================================================================
"BLD",24,4,0)
^9.64PA^3.9^1
"BLD",24,4,3.9,0)
3.9
"BLD",24,4,3.9,2,0)
^9.641^3.91^1
"BLD",24,4,3.9,2,3.91,0)
RECIPIENT  (sub-file)
"BLD",24,4,3.9,2,3.91,1,0)
^9.6411^.01^1
"BLD",24,4,3.9,2,3.91,1,.01,0)
RECIPIENT
"BLD",24,4,3.9,222)
y^y^p^^^^n
"BLD",24,4,"APDD",3.9,3.91)

"BLD",24,4,"APDD",3.9,3.91,.01)

"BLD",24,4,"B",3.9,3.9)

"BLD",24,"INI")
XMYPRE1
"BLD",24,"INIT")

"BLD",24,"KRN",0)
^9.67PA^19^12
"BLD",24,"KRN",.4,0)
.4
"BLD",24,"KRN",.401,0)
.401
"BLD",24,"KRN",.402,0)
.402
"BLD",24,"KRN",.403,0)
.403
"BLD",24,"KRN",.5,0)
.5
"BLD",24,"KRN",.84,0)
.84
"BLD",24,"KRN",3.6,0)
3.6
"BLD",24,"KRN",3.8,0)
3.8
"BLD",24,"KRN",9.2,0)
9.2
"BLD",24,"KRN",9.8,0)
9.8
"BLD",24,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",24,"KRN",9.8,"NM",1,0)
XMA1^^0^B20280946
"BLD",24,"KRN",9.8,"NM",2,0)
XMJMQ^^0^B63443178
"BLD",24,"KRN",9.8,"NM",4,0)
XMXUTIL^^0^B5250684
"BLD",24,"KRN",9.8,"NM",5,0)
XMYPRE1^^0^B52582
"BLD",24,"KRN",9.8,"NM",6,0)
XMJMP1^^0^B43253878
"BLD",24,"KRN",9.8,"NM",7,0)
XMJMQ1^^0^B6609372
"BLD",24,"KRN",9.8,"NM","B","XMA1",1)

"BLD",24,"KRN",9.8,"NM","B","XMJMP1",6)

"BLD",24,"KRN",9.8,"NM","B","XMJMQ",2)

"BLD",24,"KRN",9.8,"NM","B","XMJMQ1",7)

"BLD",24,"KRN",9.8,"NM","B","XMXUTIL",4)

"BLD",24,"KRN",9.8,"NM","B","XMYPRE1",5)

"BLD",24,"KRN",19,0)
19
"BLD",24,"KRN",19,"NM",0)
^9.68A^^
"BLD",24,"KRN",19.1,0)
19.1
"BLD",24,"KRN","B",.4,.4)

"BLD",24,"KRN","B",.401,.401)

"BLD",24,"KRN","B",.402,.402)

"BLD",24,"KRN","B",.403,.403)

"BLD",24,"KRN","B",.5,.5)

"BLD",24,"KRN","B",.84,.84)

"BLD",24,"KRN","B",3.6,3.6)

"BLD",24,"KRN","B",3.8,3.8)

"BLD",24,"KRN","B",9.2,9.2)

"BLD",24,"KRN","B",9.8,9.8)

"BLD",24,"KRN","B",19,19)

"BLD",24,"KRN","B",19.1,19.1)

"BLD",24,"QUES",0)
^9.62^^
"BLD",24,"REQB",0)
^9.611^^
"FIA",3.9)
MESSAGE
"FIA",3.9,0)
^XMB(3.9,
"FIA",3.9,0,0)
3.9s
"FIA",3.9,0,1)
y^y^p^^^^n
"FIA",3.9,0,10)

"FIA",3.9,0,11)

"FIA",3.9,0,"RLRO")

"FIA",3.9,0,"VR")
7.1^XM
"FIA",3.9,3.9)
1
"FIA",3.9,3.9,2)

"FIA",3.9,3.91)
1
"FIA",3.9,3.91,.01)

"INI")
XMYPRE1
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
40^2970528
"PKG",6,22,1,"PAH",1,1,0)
^^68^68^2970528
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan patch XM*7.1*40 contains the following enhancements:
"PKG",6,22,1,"PAH",1,1,2,0)

"PKG",6,22,1,"PAH",1,1,3,0)
NOIS:       MCM-0197-51792
"PKG",6,22,1,"PAH",1,1,4,0)
Rtns:       ^XMA1,^XMJMQ,^XMJMQ1,^XMJMP1,^XMXUTIL,^XMYPRE1
"PKG",6,22,1,"PAH",1,1,5,0)
DD:         file 3.9, field .01 of RECIPIENT multiple - adds "C" xref to DD
"PKG",6,22,1,"PAH",1,1,6,0)
Test Site:  Miles City,MT; Bronx,NY
"PKG",6,22,1,"PAH",1,1,7,0)
Improves the query (Q,QD,QN,Q name) function:
"PKG",6,22,1,"PAH",1,1,8,0)
1) makes coding clearer
"PKG",6,22,1,"PAH",1,1,9,0)
2) makes 'Q name' perform more like a FileMan lookup for local addressees
"PKG",6,22,1,"PAH",1,1,10,0)
   a) recognizes partial last name, partial first name for the first time ever
"PKG",6,22,1,"PAH",1,1,11,0)
   b) query by addressee's DUZ for the first time ever
"PKG",6,22,1,"PAH",1,1,12,0)
   c) query by addressee's nickname for the first time ever
"PKG",6,22,1,"PAH",1,1,13,0)
3) enables 'Q name' to work on remote addressees for the first time ever!
"PKG",6,22,1,"PAH",1,1,14,0)
   a) recognizes partial last name
"PKG",6,22,1,"PAH",1,1,15,0)
   b) recognizes partial last name, partial first name
"PKG",6,22,1,"PAH",1,1,16,0)
   c) recognizes partial last name, partial domain
"PKG",6,22,1,"PAH",1,1,17,0)
   d) (does not work with I: or CC: remote addressees)
"PKG",6,22,1,"PAH",1,1,18,0)
4) enables 'Q name' to work on devices and servers (D. and S.) for the first
"PKG",6,22,1,"PAH",1,1,19,0)
   time ever
"PKG",6,22,1,"PAH",1,1,20,0)
3) improves display aesthetics
"PKG",6,22,1,"PAH",1,1,21,0)

"PKG",6,22,1,"PAH",1,1,22,0)
The following concerns the RECIPIENT multiple of the MESSAGE file:
"PKG",6,22,1,"PAH",1,1,23,0)
The "C" cross reference data has always existed for the .01 field (RECIPIENT).
"PKG",6,22,1,"PAH",1,1,24,0)
But... the DD has the "C" xref on field 1 (LAST RESPONSE READ).
"PKG",6,22,1,"PAH",1,1,25,0)
So... We switch the xref in the DD from field 1 to field .01. as follows:
"PKG",6,22,1,"PAH",1,1,26,0)
Routine XMYPRE1 deletes the "C" xref on field 1 (LAST RESPONSE READ).
"PKG",6,22,1,"PAH",1,1,27,0)
The partial DD in this patch sets the "C" xref on field .01 (RECIPIENT).
"PKG",6,22,1,"PAH",1,1,28,0)
Since the actual "C" xref data has always been on field .01, we don't need
"PKG",6,22,1,"PAH",1,1,29,0)
to do anything with the "C" xref data - just leave it alone.
"PKG",6,22,1,"PAH",1,1,30,0)

"PKG",6,22,1,"PAH",1,1,31,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,32,0)
This patch should be installed after hours, when user activity is at a
"PKG",6,22,1,"PAH",1,1,33,0)
minimum.  You should put the XMUSER Option out of order.
"PKG",6,22,1,"PAH",1,1,34,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,35,0)
 
"PKG",6,22,1,"PAH",1,1,36,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,37,0)
1.  If any of these routines is mapped (on systems which allow mapping),
"PKG",6,22,1,"PAH",1,1,38,0)
    disable mapping for the affected routine(s).
"PKG",6,22,1,"PAH",1,1,39,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads
"PKG",6,22,1,"PAH",1,1,40,0)
    the patch into a Transport Global on your system.
"PKG",6,22,1,"PAH",1,1,41,0)
3.  On the KIDS:Installation menu, use the following options to install the
"PKG",6,22,1,"PAH",1,1,42,0)
    Transport Global:
"PKG",6,22,1,"PAH",1,1,43,0)
       Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,44,0)
       Print Transport Global
"PKG",6,22,1,"PAH",1,1,45,0)
       Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,46,0)
       Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,47,0)
       Install Package(s)
"PKG",6,22,1,"PAH",1,1,48,0)
4.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,49,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,50,0)
5.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,51,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,52,0)
  
"PKG",6,22,1,"PAH",1,1,53,0)
ROUTINES:
"PKG",6,22,1,"PAH",1,1,54,0)
The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,55,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,56,0)
 
"PKG",6,22,1,"PAH",1,1,57,0)
              Before          After
"PKG",6,22,1,"PAH",1,1,58,0)
Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,59,0)
----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,60,0)
XMA1           9580091         9717771        31,36,40
"PKG",6,22,1,"PAH",1,1,61,0)
XMJMP1         * new *        11388791        40
"PKG",6,22,1,"PAH",1,1,62,0)
XMJMQ          * new *        14561364        40
"PKG",6,22,1,"PAH",1,1,63,0)
XMJMQ1         * new *         3291603        40
"PKG",6,22,1,"PAH",1,1,64,0)
XMXUTIL        * new *         2338705        40
"PKG",6,22,1,"PAH",1,1,65,0)
XMYPRE1        * new *           32634        40
"PKG",6,22,1,"PAH",1,1,66,0)

"PKG",6,22,1,"PAH",1,1,67,0)
* Checksums produced by CHECK^XTSUMBLD
"PKG",6,22,1,"PAH",1,1,68,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","XMA1")
0^1^B20280946
"RTN","XMA1",1,0)
XMA1 ;(WASH ISC)/CAP/THM-ACTIONS ;05/28/97  08:22
"RTN","XMA1",2,0)
 ;;7.1;MailMan;**31,36,40**;Jun 02, 1994
"RTN","XMA1",3,0)
CBASK D C2 I $D(XMAN),$L(XMAN)>1 S X=$E(XMAN,2) K XMAN G C3
"RTN","XMA1",4,0)
C1 G Q:$E($G(XMA1))="^"
"RTN","XMA1",5,0)
 ;
"RTN","XMA1",6,0)
 ;Display Other Body parts (BLOBs)
"RTN","XMA1",7,0)
 ;
"RTN","XMA1",8,0)
 I '$G(XMAPBLOB),$O(^MAG(2005,0)) D @($S($G(IOT)="IMPC":"BLOB",1:"NODISP")_"^XMAPBLOB")
"RTN","XMA1",9,0)
 ;
"RTN","XMA1",10,0)
 S Y="IGNORE (in" I XMDUZ'=.6,XMK=1,'$G(XMNEW) S X=$S($D(XMDISPI):$P(XMDISPI,U,2),1:"") I $L(X) S Y=$S(X="D":"DELETE (from",X="T":"TERMINATE (from",1:"IGNORE (in")
"RTN","XMA1",11,0)
 W !!,"Select MESSAGE Action: "_Y_" " W:$L(XMKN) XMKN_" " W "basket)" W "// " R X:DTIME S:'$T X=U
"RTN","XMA1",12,0)
 G Q:X[U
"RTN","XMA1",13,0)
 S XMORIG=X
"RTN","XMA1",14,0)
 W ! S:X="" X=$P(Y," ") S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","XMA1",15,0)
 F %="QUERY","QN","QD" I $E(%,1,$L($P(X," ")))=$P(X," ") G UP
"RTN","XMA1",16,0)
 I X["?" S XQH="XMR-ACTION" D EN^XQH G C1:$S(XMDUZ'=.5:1,XMK<1001:1,1:0) D PRIOH^XMC4 G C1
"RTN","XMA1",17,0)
C3 K XMA21G S XMA1=X S:$E(X)="^" X=$E(X,2,99)
"RTN","XMA1",18,0)
 G Q:XMA1="^" I $E("IGNORE",1,$L(X))=X D ENI^XMA10 G Q
"RTN","XMA1",19,0)
 I $P(XMR,U,7)="S" D SPOOL^XMAH G C1:X[U
"RTN","XMA1",20,0)
D I $E("DELETE",1,$L(X))=X,XMK G C1:$$SHARE^XMA1B(0) D  G END
"RTN","XMA1",21,0)
 . D BEG
"RTN","XMA1",22,0)
 . S XMKD=XMK
"RTN","XMA1",23,0)
 . S:$D(XMDN) XMDI=XMDN
"RTN","XMA1",24,0)
 . D KLQ^XMA1B
"RTN","XMA1",25,0)
 . S:'$D(XMKS) XMKS=""
"RTN","XMA1",26,0)
 . D NUMB^XMA03:XMKS=""
"RTN","XMA1",27,0)
 . W:$P($G(XMTYPE),";")'="Terminate" !,"Deleted !!"
"RTN","XMA1",28,0)
 . K XMNEW
"RTN","XMA1",29,0)
 . D KNEW
"RTN","XMA1",30,0)
 I "FXLNSQ"'[X S I=$O(^XMB(3.9,XMZ,2,.999)) I I S I=^(I,0) I $L($P(I,U,2)) G ENT0^XMAH:$E(I,1,4)="$TXT"
"RTN","XMA1",31,0)
 I "LNS"'[X,XMDUZ'=DUZ G ENT1^XMAH:"Yy"[$E($P(XMR,U,11)_" ")
"RTN","XMA1",32,0)
 I $E("TERMINATE",1,$L(X))=X G C1:$$SHARE^XMA1B(0),T
"RTN","XMA1",33,0)
 I $E("SAVE",1,$L(X))=X D S^XMA1B G QQ
"RTN","XMA1",34,0)
 I $E("LATER",1,$L(X))=X G POST^XMB1:XMDUZ'=.6 D SH^XMA1B G C1
"RTN","XMA1",35,0)
 I $E("BACKUP",1,$L(X))=X D E G C1
"RTN","XMA1",36,0)
 I $E("WRITE",1,$L(X))=X!($E("ANSWER",1,$L(X))=X) G GC1:XMDUZ=.6,NO:$D(XMNOSEND) D WRITE^XMA11A G C1
"RTN","XMA1",37,0)
 I $E("EDIT",1,$L(X))=X G GC1:XMDUZ=.6 I XME D EDIT^XMA11 G C1:$D(^XMB(3.9,XMZ)),Q
"RTN","XMA1",38,0)
 I $E("VAPORIZE",1,$L(X))=X G C1:$$SHARE^XMA1B(0),DATE^XMA11A
"RTN","XMA1",39,0)
 I $E("FORWARD",1,$L(X))=X G:$P(XMR,U,2)'=XMDUZ NF^XMA11:"Yy"[$E($P(XMR,U,9)_" ") G:XMDUZ=.6 GC1:$P(XMR,U,2)'=DUZ D FWD^XMA1A G C1
"RTN","XMA1",40,0)
 I $E("REPLY",1,$L(X))=X G NO:$D(XMNOSEND),^XMAH1
"RTN","XMA1",41,0)
 I $E("HEADERLESS",1,$L(X))=X!($E("PRINT",1,$L(X))=X) G:XMDUZ=.5&(XMK>999) SN^XMA1E S XMP=$E(X)="H"+1,XMA1P=1 D ENTPRT^XMA0 K XMP,XMA1P G C1
"RTN","XMA1",42,0)
 I "X"[X G GC1:XMDUZ=.6 G ENT0^XMAH:'$D(^XUSEC("XUPROGMODE",DUZ)) S X=XMZ,DIC(0)="N" D MM^XMP G C1
"RTN","XMA1",43,0)
 I $E("NEW",1,$L(X))=X G GC1:XMDUZ=.6 S XMNEW=$S('$D(^XMB(3.7,XMDUZ,2,XMK,1,XMZ,0)):1,$P(^(0),U,3)+0=0:1,1:0) W "  Will be new next time." G C1
"RTN","XMA1",44,0)
 I $E("COPY",1,$L(X))=X G SN^XMA1E:XMDUZ=.5&(XMK>999),CN^XMA1E:$L($P(XMR,U,10)),GC1:XMDUZ=.6&($P(XMR,U,2)'=DUZ),NO:$D(XMNOSEND),^XMA2C
"RTN","XMA1",45,0)
 I $E(X)="K" G ENTK^XMA10
"RTN","XMA1",46,0)
ER W *7,"'",X,"' is not a valid command.  Enter '???' for help." G C1
"RTN","XMA1",47,0)
C2 S XMZO=XMZ,XMKO=XMK_U_XMR D CONF
"RTN","XMA1",48,0)
 S XMZ=XMZO,XMK=+XMKO,XMR=$P(XMKO,U,2,99),XME=$S($P(XMR,U,2)=XMDUZ:1,XMDUZ=.5:$S(XMK>1000:1,1:0),1:0) Q
"RTN","XMA1",49,0)
 ;
"RTN","XMA1",50,0)
GC1 D SH^XMA1B G C1
"RTN","XMA1",51,0)
ZTSK ;
"RTN","XMA1",52,0)
 S XMDUZ=XMB("XMDUZ"),XMZ=XMB("XMZ"),XMKM=1 D S2^XMA1B G NNEW^XMA
"RTN","XMA1",53,0)
CONF I XMDUZ'=DUZ Q:"Yy"[$E($P(XMR,U,11)_" ")
"RTN","XMA1",54,0)
 G CONF^XMA1A
"RTN","XMA1",55,0)
T I $S($G(XMRC)="":1,'$D(^XMB(3.9,XMZ,1,XMRC)):1,1:0) S X="D" G D
"RTN","XMA1",56,0)
 D BEG S X="N",%DT="T" D ^%DT S ^XMB(3.9,XMZ,1,XMRC,"D")=Y
"RTN","XMA1",57,0)
 I $P($G(XMTYPE),";")'="Terminate" D T2
"RTN","XMA1",58,0)
 K XMNEW
"RTN","XMA1",59,0)
 S XMKD=XMK D KLQ^XMA1B,KNEW
"RTN","XMA1",60,0)
 G END
"RTN","XMA1",61,0)
T2 W !,"You won't see future responses. (In WASTE basket)" H 1
"RTN","XMA1",62,0)
 Q
"RTN","XMA1",63,0)
UP ;
"RTN","XMA1",64,0)
 I X="Q" D Q^XMJMQ(XMDUZ,XMK,XMKN,XMZ) G C1
"RTN","XMA1",65,0)
 I X="QD" D QD^XMJMQ(XMDUZ,XMK,XMKN,XMZ) G C1
"RTN","XMA1",66,0)
 I X="QN" D QN^XMJMQ(XMDUZ,XMK,XMKN,XMZ) G C1
"RTN","XMA1",67,0)
 I $L(X," ")>1,($P(X," ")="Q"!($P(X," ")="QD")) D QNAMEX^XMJMQ(XMDUZ,XMK,XMKN,XMZ,$P(XMORIG," ",2,99)) G C1
"RTN","XMA1",68,0)
 G ER
"RTN","XMA1",69,0)
E ;BACK UP
"RTN","XMA1",70,0)
 G EQ:$G(^XMB(3.9,XMZ,3,0))="" S %1=$P(^(0),U,3) G EQ:%1<1
"RTN","XMA1",71,0)
E0 W !,"There are "_%1_" responses.",!,"Back up to: Original message// "
"RTN","XMA1",72,0)
 R X:DTIME Q:X=U!'$T
"RTN","XMA1",73,0)
 I X=""!("Oo"[$E(X)) S X=0
"RTN","XMA1",74,0)
E1 G EQ:X=0 I X<0 S X=%1+X+1 S:X<0 X=0 G:X=0 E1
"RTN","XMA1",75,0)
 G EQ:+X=X D ENT8^XMAH
"RTN","XMA1",76,0)
 G E
"RTN","XMA1",77,0)
EQ S XMB0=XMZ,XMA0=X,XMBCK=1 K XMAPBLOB D ENTBCK^XMAP,KNEW:'$D(XMNEW) K XMBCK Q
"RTN","XMA1",78,0)
KNEW K XMKD
"RTN","XMA1",79,0)
 I '$D(XMNEW) D NEW^XMA Q
"RTN","XMA1",80,0)
 I XMNEW D NNEW^XMA
"RTN","XMA1",81,0)
 K XMNEW,XMS,XMSEC Q
"RTN","XMA1",82,0)
Q S XMHOLD=X D KNEW S X=XMHOLD S:$E($G(XMA1))="^" X="^" K XMHOLD
"RTN","XMA1",83,0)
QQ K XMA1,XMAPBLOB,XMS,XMSEC,XMORIG Q
"RTN","XMA1",84,0)
K S K=$O(^XMB(3.7,XMDUZ,2,"B",K)) Q:K=""  G K:$O(^(K,0))'=XMKM Q
"RTN","XMA1",85,0)
 ;
"RTN","XMA1",86,0)
 ;Response Time Monitor
"RTN","XMA1",87,0)
BEG Q:'$D(XRTL)  S XRTN="XMA1-DEL/TERM" D T0^%ZOSV Q
"RTN","XMA1",88,0)
END Q:'$D(XRT0)  D T1^%ZOSV G QQ
"RTN","XMA1",89,0)
NO G ERR^XMA1A
"RTN","XMJMP1")
0^6^B43253878
"RTN","XMJMP1",1,0)
XMJMP1 ;ISC-SF/GMB-Print,Backup continued ;05/16/97  07:49
"RTN","XMJMP1",2,0)
 ;;7.1;MailMan;**40**;Jun 02, 1994
"RTN","XMJMP1",3,0)
HELPRESP(XMZ,XMRESPS) ;
"RTN","XMJMP1",4,0)
 N DIR,XMRESP,DIRUT,XMLEN
"RTN","XMJMP1",5,0)
 W @IOF,"There "_$S(XMRESPS=1:"is ",1:"are "),XMRESPS," response"_$S(XMRESPS=1:"",1:"s")_"."
"RTN","XMJMP1",6,0)
 S DIR(0)="E"
"RTN","XMJMP1",7,0)
 S XMRESP=$S(XMPM=1:0,1:XMRESPS+1)
"RTN","XMJMP1",8,0)
 W ! D HRHDR(XMRESPS,XMRESP,.XMLEN)
"RTN","XMJMP1",9,0)
 D:XMPM=1 HRLINE(XMZ,0)
"RTN","XMJMP1",10,0)
 F  S XMRESP=$O(^XMB(3.9,XMZ,3,XMRESP),XMPM) Q:XMRESP'>0  D  Q:$D(DIRUT)
"RTN","XMJMP1",11,0)
 . I $Y>IOSL D  Q:$D(DIRUT)
"RTN","XMJMP1",12,0)
 . . D ^DIR Q:$D(DIRUT)
"RTN","XMJMP1",13,0)
 . . W @IOF D HRHDR(XMRESPS,XMRESP,.XMLEN)
"RTN","XMJMP1",14,0)
 . D HRLINE($P(^XMB(3.9,XMZ,3,XMRESP,0),U),XMRESP)
"RTN","XMJMP1",15,0)
 Q:XMPM=1
"RTN","XMJMP1",16,0)
 I $Y>IOSL D  Q:$D(DIRUT)
"RTN","XMJMP1",17,0)
 . D ^DIR Q:$D(DIRUT)
"RTN","XMJMP1",18,0)
 . W @IOF D HRHDR(XMRESP,.XMLEN)
"RTN","XMJMP1",19,0)
 D HRLINE(XMZ,0)
"RTN","XMJMP1",20,0)
 Q
"RTN","XMJMP1",21,0)
HRHDR(XMRESPS,XMRESP,XMLEN) ;
"RTN","XMJMP1",22,0)
 S XMLEN("RESP")=$S(XMPM=1:$L($$MIN^XLFMTH(XMRESPS,XMRESP+IOSL)),1:$L(XMRESP))
"RTN","XMJMP1",23,0)
 S XMLEN("DATE")=9
"RTN","XMJMP1",24,0)
 S XMLEN("LINE")=5
"RTN","XMJMP1",25,0)
 S XMLEN("FROM")=80-XMLEN("RESP")-XMLEN("DATE")-XMLEN("LINE")-3
"RTN","XMJMP1",26,0)
 W $$LJ^XLFSTR("Response",XMLEN("RESP")+XMLEN("DATE")+3,"."),$$LJ^XLFSTR("From",XMLEN("FROM"),"."),"Lines"
"RTN","XMJMP1",27,0)
 Q
"RTN","XMJMP1",28,0)
HRLINE(XMZ,XMRESP) ;
"RTN","XMJMP1",29,0)
 N XMZREC
"RTN","XMJMP1",30,0)
 S XMZREC=$G(^XMB(3.9,XMZ,0))
"RTN","XMJMP1",31,0)
 W !,$J(XMRESP,XMLEN("RESP")),") ",$E($$DATE($P(XMZREC,U,3)),1,XMLEN("DATE"))," ",$$MELD^XMJML($$FROM($P(XMZREC,U,2)),XMLEN("FROM"),+$P($G(^XMB(3.9,XMZ,2,0)),U,4),XMLEN("LINE"))
"RTN","XMJMP1",32,0)
 Q
"RTN","XMJMP1",33,0)
RESPHDR(XMZ,XMRESP) ;
"RTN","XMJMP1",34,0)
 N XMZREC
"RTN","XMJMP1",35,0)
 S XMZREC=$G(^XMB(3.9,XMZ,0))
"RTN","XMJMP1",36,0)
 W !,XMRESP,") From: ",$$FROM($P(XMZREC,U,2))
"RTN","XMJMP1",37,0)
 D W("  ",$$DATE($P(XMZREC,U,3)))
"RTN","XMJMP1",38,0)
 D W("  ",$$LINES(XMZ))
"RTN","XMJMP1",39,0)
 Q
"RTN","XMJMP1",40,0)
FROM(XMFROM) ;
"RTN","XMJMP1",41,0)
 N XMFREC,XMTITLE,XMINST
"RTN","XMJMP1",42,0)
 Q:XMFROM'=+XMFROM XMFROM
"RTN","XMJMP1",43,0)
 S XMFREC=$G(^VA(200,XMFROM,0)) Q:XMFREC="" $S(XMFROM=.5:"POSTMASTER",1:"USER #"_XMFROM)
"RTN","XMJMP1",44,0)
 S XMFROM=$P(XMFREC,U)
"RTN","XMJMP1",45,0)
 I $P($G(XMDISPI),U)["T",$P(XMFREC,U,9) D
"RTN","XMJMP1",46,0)
 . S XMTITLE=$P($G(^DIC(3.1,$P(XMFREC,U,9),0)),U)
"RTN","XMJMP1",47,0)
 . S:XMTITLE'="" XMFROM=XMFROM_" - "_XMTITLE
"RTN","XMJMP1",48,0)
 I $P($G(XMDISPI),U)["I",$D(^XMB(3.7,XMFROM,6000)) D
"RTN","XMJMP1",49,0)
 . S XMINST=$P(^XMB(3.7,XMFROM,6000),U)
"RTN","XMJMP1",50,0)
 . S:XMINST'="" XMFROM=XMFROM_" ("_XMINST_")"
"RTN","XMJMP1",51,0)
 Q XMFROM
"RTN","XMJMP1",52,0)
DATE(XMDT) ;
"RTN","XMJMP1",53,0)
 Q:XMDT'=+XMDT XMDT
"RTN","XMJMP1",54,0)
 Q $$MMDT^XMXUTIL(XMDT)
"RTN","XMJMP1",55,0)
LINES(XMZ) ;
"RTN","XMJMP1",56,0)
 N XMLINES
"RTN","XMJMP1",57,0)
 S XMLINES=+$P($G(^XMB(3.9,XMZ,2,0)),U,4)
"RTN","XMJMP1",58,0)
 S XMLINES=XMLINES_$S(XMLINES=1:" line",1:" lines")
"RTN","XMJMP1",59,0)
 Q XMLINES
"RTN","XMJMP1",60,0)
PRINTIT(XMDUZ,XMK,XMKN,XMZ,XMRESPS,XMWHICH,XMRECIPS,XMPRTHDR) ;
"RTN","XMJMP1",61,0)
 N XMZREC,XMSUBJ,XMFROM,XMHDR,XMPAGE,XMZSTR,I,XMRESP,XMRANGE,XMABORT
"RTN","XMJMP1",62,0)
 S XMABORT=0
"RTN","XMJMP1",63,0)
 S XMZREC=^XMB(3.9,XMZ,0)
"RTN","XMJMP1",64,0)
 S XMSUBJ=$P(XMZREC,U,1) S:XMSUBJ["~U~" XMSUBJ=$$DECODEUP^XMXUTIL(XMSUBJ)
"RTN","XMJMP1",65,0)
 S XMSUBJ="Subj: "_XMSUBJ,XMZSTR="[#"_XMZ_"]"
"RTN","XMJMP1",66,0)
 S XMPAGE=1
"RTN","XMJMP1",67,0)
 D:XMPRTHDR HEADER(XMDUZ,XMK,XMKN,XMZ,XMRESPS,XMZREC,XMSUBJ,XMZSTR)
"RTN","XMJMP1",68,0)
 Q:XMWHICH>XMRESPS
"RTN","XMJMP1",69,0)
 F I=1:1:$L(XMWHICH,",") D  Q:XMABORT
"RTN","XMJMP1",70,0)
 . S XMRANGE=$P(XMWHICH,",",I)
"RTN","XMJMP1",71,0)
 . S:$E(XMRANGE,$L(XMRANGE))="-" XMRANGE=XMRANGE_XMRESPS
"RTN","XMJMP1",72,0)
 . F XMRESP=$P(XMRANGE,"-",1):1:$S(XMRANGE["-":$P(XMRANGE,"-",2),1:XMRANGE) D  Q:XMABORT
"RTN","XMJMP1",73,0)
 . . I XMRESP>0 D RESPONSE($P(^XMB(3.9,XMZ,3,XMRESP,0),U),XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT) Q
"RTN","XMJMP1",74,0)
 . . D BODY(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",75,0)
 D LASTACC(XMDUZ,XMK,XMZ,XMRESP)
"RTN","XMJMP1",76,0)
 Q:XMABORT
"RTN","XMJMP1",77,0)
 D:XMRECIPS PRECIPS(XMDUZ,XMK,XMZ,XMRECIPS,XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",78,0)
 I $D(^XMB(3.7,XMDUZ,"N0",XMK,XMZ)),XMRESP=+$P($G(^XMB(3.9,XMZ,3,0)),U,4) D NONEW^XMXMSGS(XMDUZ,XMK,XMZ)
"RTN","XMJMP1",79,0)
 Q
"RTN","XMJMP1",80,0)
LASTACC(XMDUZ,XMK,XMZ,XMRESP) ; Note first, last accesses, number of responses read
"RTN","XMJMP1",81,0)
 N XMPTR,XMNOW,XMREC
"RTN","XMJMP1",82,0)
 S XMPTR=+$O(^XMB(3.9,XMZ,1,"C",$S(XMDUZ=.6:DUZ,1:XMDUZ),0)) Q:'XMPTR
"RTN","XMJMP1",83,0)
 S XMNOW=$$NOW^XLFDT
"RTN","XMJMP1",84,0)
 S XMREC=^XMB(3.9,XMZ,1,XMPTR,0)
"RTN","XMJMP1",85,0)
 S:$P(XMREC,U,10)="" $P(XMREC,U,10)=XMNOW ; first access
"RTN","XMJMP1",86,0)
 S $P(XMREC,U,3)=XMNOW  ; last access
"RTN","XMJMP1",87,0)
 S:XMRESP>$P(XMREC,U,2) $P(XMREC,U,2)=XMRESP ; last response read
"RTN","XMJMP1",88,0)
 S ^XMB(3.9,XMZ,1,XMPTR,0)=XMREC
"RTN","XMJMP1",89,0)
 S:XMK $P(^XMB(3.7,XMDUZ,2,XMK,1,XMZ,0),U,4)=XMNOW  ; last access (for MailMan's auto-vaporize)
"RTN","XMJMP1",90,0)
 Q
"RTN","XMJMP1",91,0)
PRECIPS(XMDUZ,XMK,XMZ,XMRECIPS,XMSUBJ,XMZSTR,XMPRTHDR,XMPAGE,XMABORT) ; Print recipients (replaces QE2^XMA5)
"RTN","XMJMP1",92,0)
 D INFO^XMJMQ(XMDUZ,XMK,XMZ,XMPRTHDR,XMSUBJ,XMZSTR,.XMPAGE,.XMABORT) Q:XMABORT
"RTN","XMJMP1",93,0)
 D LATER^XMJMQ(XMDUZ,XMZ,XMPRTHDR,XMSUBJ,XMZSTR,.XMPAGE,.XMABORT) Q:XMABORT
"RTN","XMJMP1",94,0)
 I XMRECIPS=1 D
"RTN","XMJMP1",95,0)
 . D SUMMARY^XMJMQ1(XMZ,XMPRTHDR,XMSUBJ,XMZSTR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",96,0)
 E  D DETAIL^XMJMQ(XMZ,XMPRTHDR,XMSUBJ,XMZSTR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",97,0)
 Q
"RTN","XMJMP1",98,0)
HEADER(XMDUZ,XMK,XMKN,XMZ,XMRESPS,XMZREC,XMSUBJ,XMZSTR) ;
"RTN","XMJMP1",99,0)
 D PAGE1HDR(XMDUZ,XMK,XMKN,XMZ,XMRESPS,XMZREC,XMSUBJ,XMZSTR)
"RTN","XMJMP1",100,0)
 D W("   ","Page 1")
"RTN","XMJMP1",101,0)
 D:$D(^XMB(3.7,XMDUZ,"N0",XMK,XMZ)) W("  ",$S($D(^XMB(3.7,XMDUZ,"N",XMK,XMZ)):"!Priority!",1:"*New*"))
"RTN","XMJMP1",102,0)
 D LINE
"RTN","XMJMP1",103,0)
 Q
"RTN","XMJMP1",104,0)
LINE ;
"RTN","XMJMP1",105,0)
 W !,"-------------------------------------------------------------------------------"
"RTN","XMJMP1",106,0)
 Q
"RTN","XMJMP1",107,0)
PAGE1HDR(XMDUZ,XMK,XMKN,XMZ,XMRESPS,XMZREC,XMSUBJ,XMZSTR) ;
"RTN","XMJMP1",108,0)
 N XMSENDR
"RTN","XMJMP1",109,0)
 W XMSUBJ
"RTN","XMJMP1",110,0)
 D W("  ",XMZSTR)
"RTN","XMJMP1",111,0)
 D W(" ",$$DATE($P(XMZREC,U,3)))
"RTN","XMJMP1",112,0)
 D W("  ",$$LINES(XMZ))
"RTN","XMJMP1",113,0)
 D:$O(^XMB(3.9,XMZ,2005,0)) W(" ","Attachment(s).")
"RTN","XMJMP1",114,0)
 W !,"From: ",$$FROM($P(XMZREC,U,2))
"RTN","XMJMP1",115,0)
 D:$P(XMZREC,U,4)'="" W(" ","(Sender: "_$$FROM($P(XMZREC,U,4))_")")
"RTN","XMJMP1",116,0)
 I XMRESPS>0 D
"RTN","XMJMP1",117,0)
 . N XMPTR,XMRESP
"RTN","XMJMP1",118,0)
 . S XMPTR=+$O(^XMB(3.9,XMZ,1,"C",$S(XMDUZ=.6:DUZ,1:XMDUZ),0))
"RTN","XMJMP1",119,0)
 . I XMPTR=0 S XMRESP=0
"RTN","XMJMP1",120,0)
 . E  S XMRESP=+$P(^XMB(3.9,XMZ,1,XMPTR,0),U,2)
"RTN","XMJMP1",121,0)
 . S XMRESP=XMRESP_" of "_XMRESPS_" response"_$S(XMRESPS=1:"",1:"s")_" read."
"RTN","XMJMP1",122,0)
 . D W("  ",XMRESP)
"RTN","XMJMP1",123,0)
 D W("  ","In '"_XMKN_"' basket.")
"RTN","XMJMP1",124,0)
 Q
"RTN","XMJMP1",125,0)
W(XMSPACE,XMSTRING) ;
"RTN","XMJMP1",126,0)
 I $X+$L(XMSPACE)+$L(XMSTRING)>IOM W !,XMSTRING
"RTN","XMJMP1",127,0)
 E  W XMSPACE,XMSTRING
"RTN","XMJMP1",128,0)
 Q
"RTN","XMJMP1",129,0)
BODY(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,XMPAGE,XMABORT) ;
"RTN","XMJMP1",130,0)
 N XMTEXT,I,J
"RTN","XMJMP1",131,0)
 S I=.999
"RTN","XMJMP1",132,0)
 F  S I=$O(^XMB(3.9,XMZ,2,I)) Q:I'>0  D  Q:XMABORT
"RTN","XMJMP1",133,0)
 . S XMTEXT=^XMB(3.9,XMZ,2,I,0)
"RTN","XMJMP1",134,0)
 . S:$D(XMSECURE) XMTEXT=$$DECSTR^XMJMCODE(XMTEXT)
"RTN","XMJMP1",135,0)
 . F  S J=$F(XMTEXT,"|TAB|")-6 Q:J<0  D
"RTN","XMJMP1",136,0)
 . . S XMTEXT=$E(XMTEXT,1,J)_$E("         ",1,9-(J-(J\9*9)))_$E(XMTEXT,J+6,999)
"RTN","XMJMP1",137,0)
 . F  D  Q:$L(XMTEXT)<IOM!XMABORT  S XMTEXT=$E(XMTEXT,IOM,999)
"RTN","XMJMP1",138,0)
 . . I $Y+3>IOSL D  Q:XMABORT
"RTN","XMJMP1",139,0)
 . . . D PAGE(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",140,0)
 . . E  W !
"RTN","XMJMP1",141,0)
 . . W $E(XMTEXT,1,IOM-1)
"RTN","XMJMP1",142,0)
 Q
"RTN","XMJMP1",143,0)
PAGE(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,XMPAGE,XMABORT) ;
"RTN","XMJMP1",144,0)
 I $G(IOST)["C-" D  Q:XMABORT
"RTN","XMJMP1",145,0)
 . N DIR,DIRUT
"RTN","XMJMP1",146,0)
 . S DIR(0)="E"
"RTN","XMJMP1",147,0)
 . D ^DIR I $D(DIRUT) S XMABORT=1 Q
"RTN","XMJMP1",148,0)
 W @IOF
"RTN","XMJMP1",149,0)
 D:XMPRTHDR PAGE2HDR(XMSUBJ,XMZSTR,.XMPAGE)
"RTN","XMJMP1",150,0)
 Q
"RTN","XMJMP1",151,0)
PAGE2HDR(XMSUBJ,XMZSTR,XMPAGE) ;
"RTN","XMJMP1",152,0)
 S XMPAGE=XMPAGE+1
"RTN","XMJMP1",153,0)
 W XMSUBJ
"RTN","XMJMP1",154,0)
 D W("  ",XMZSTR)
"RTN","XMJMP1",155,0)
 D W("   ","Page "_XMPAGE)
"RTN","XMJMP1",156,0)
 D LINE
"RTN","XMJMP1",157,0)
 W !
"RTN","XMJMP1",158,0)
 Q
"RTN","XMJMP1",159,0)
RESPONSE(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,XMPAGE,XMABORT) ;
"RTN","XMJMP1",160,0)
 N XMRSUBJ,XMREMOTE
"RTN","XMJMP1",161,0)
 S XMRSUBJ=$P(^XMB(3.9,XMZ,0),U)
"RTN","XMJMP1",162,0)
 S XMREMOTE=$S(XMRSUBJ?1"R".N:0,1:1)
"RTN","XMJMP1",163,0)
 I $Y+XMREMOTE+6>IOSL D  Q:XMABORT
"RTN","XMJMP1",164,0)
 . D PAGE(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",165,0)
 E  W !
"RTN","XMJMP1",166,0)
 D RESPHDR(XMZ,XMRESP)
"RTN","XMJMP1",167,0)
 W:XMREMOTE !,"   Subj: ",$P($G(^XMB(3.9,XMZ,0)),U,1)
"RTN","XMJMP1",168,0)
 W !
"RTN","XMJMP1",169,0)
 D BODY(XMZ,XMSUBJ,XMZSTR,XMPRTHDR,.XMPAGE,.XMABORT)
"RTN","XMJMP1",170,0)
 Q
"RTN","XMJMQ")
0^2^B63443178
"RTN","XMJMQ",1,0)
XMJMQ ;ISC-SF/GMB- Q,QD,QN Query recipients ;05/20/97  06:46
"RTN","XMJMQ",2,0)
 ;;7.1;MailMan;**40**;Jun 02, 1994
"RTN","XMJMQ",3,0)
 ; Replaces ^XMA5,^XMA5A (ISC-WASH/THM/CAP)
"RTN","XMJMQ",4,0)
Q(XMDUZ,XMK,XMKN,XMZ) ; Query
"RTN","XMJMQ",5,0)
 N XMRESPM,XMABORT
"RTN","XMJMQ",6,0)
 D QINIT(XMDUZ,XMK,XMKN,XMZ,.XMRESPM,.XMABORT)
"RTN","XMJMQ",7,0)
 D SUMMARY^XMJMQ1(XMZ,0,"","","",.XMABORT)
"RTN","XMJMQ",8,0)
 Q
"RTN","XMJMQ",9,0)
QD(XMDUZ,XMK,XMKN,XMZ) ; Query Detail
"RTN","XMJMQ",10,0)
 N XMRESPM,XMABORT
"RTN","XMJMQ",11,0)
 D QINIT(XMDUZ,XMK,XMKN,XMZ,.XMRESPM,.XMABORT)
"RTN","XMJMQ",12,0)
 D DETAIL(XMZ,0,"","","",.XMABORT)
"RTN","XMJMQ",13,0)
 Q
"RTN","XMJMQ",14,0)
QN(XMDUZ,XMK,XMKN,XMZ) ; Query Network
"RTN","XMJMQ",15,0)
 N XMRESPM,XMABORT
"RTN","XMJMQ",16,0)
 D QINIT(XMDUZ,XMK,XMKN,XMZ,.XMRESPM,.XMABORT)
"RTN","XMJMQ",17,0)
 D NETWORK^XMJMQ1(XMZ,.XMABORT) Q:XMABORT
"RTN","XMJMQ",18,0)
 D SUMMARY^XMJMQ1(XMZ,0,"","","",.XMABORT)
"RTN","XMJMQ",19,0)
 Q
"RTN","XMJMQ",20,0)
QNAME(XMDUZ,XMK,XMKN,XMZ) ; Query someone's name
"RTN","XMJMQ",21,0)
 N XMRESPM,XMABORT,DIR,Y,DIRUT,XMNAME
"RTN","XMJMQ",22,0)
 F  D  Q:$D(DIRUT)
"RTN","XMJMQ",23,0)
 . S DIR(0)="FO^1:30^K:"", ""[$E(X) X"
"RTN","XMJMQ",24,0)
 . S DIR("A")="Enter the person's name or partial name"
"RTN","XMJMQ",25,0)
 . S DIR("?",1)="Name must be from 1 to 30 characters,"
"RTN","XMJMQ",26,0)
 . S DIR("?")="and must not contain ^, or begin with comma or space."
"RTN","XMJMQ",27,0)
 . D ^DIR Q:$D(DIRUT)
"RTN","XMJMQ",28,0)
 . S XMNAME=Y
"RTN","XMJMQ",29,0)
 . D QINIT(XMDUZ,XMK,XMKN,XMZ,.XMRESPM,.XMABORT)
"RTN","XMJMQ",30,0)
 . D SEARCH(XMZ,XMNAME,XMRESPM)
"RTN","XMJMQ",31,0)
 Q
"RTN","XMJMQ",32,0)
QNAMEX(XMDUZ,XMK,XMKN,XMZ,XMNAME) ; Query someone's name (name is supplied)
"RTN","XMJMQ",33,0)
 N XMRESPM,XMABORT
"RTN","XMJMQ",34,0)
 I ($L(XMNAME)<1)!($L(XMNAME)>30)!(XMNAME[U)!(", "[$E(XMNAME,1)) D  Q
"RTN","XMJMQ",35,0)
 . W *7,!,"Name must be from 1 to 30 characters,"
"RTN","XMJMQ",36,0)
 . W !,"and must not contain ^, or begin with comma or space."
"RTN","XMJMQ",37,0)
 D QINIT(XMDUZ,XMK,XMKN,XMZ,.XMRESPM,.XMABORT)
"RTN","XMJMQ",38,0)
 D SEARCH(XMZ,XMNAME,XMRESPM)
"RTN","XMJMQ",39,0)
 Q
"RTN","XMJMQ",40,0)
QINIT(XMDUZ,XMK,XMKN,XMZ,XMRESPM,XMABORT) ;
"RTN","XMJMQ",41,0)
 N XMZSTR,XMSUBJ,XMRESPS
"RTN","XMJMQ",42,0)
 S XMABORT=0
"RTN","XMJMQ",43,0)
 S XMZSTR="[#"_XMZ_"]"
"RTN","XMJMQ",44,0)
 S XMSUBJ=$P(^XMB(3.9,XMZ,0),U)
"RTN","XMJMQ",45,0)
 S:XMSUBJ["~U~" XMSUBJ=$$DECODEUP^XMXUTIL(XMSUBJ)
"RTN","XMJMQ",46,0)
 S XMSUBJ="Subj: "_XMSUBJ
"RTN","XMJMQ",47,0)
 S XMRESPS=+$P($G(^XMB(3.9,XMZ,3,0)),U,4)
"RTN","XMJMQ",48,0)
 S XMRESPM=" of "_XMRESPS_" response"_$S(XMRESPS=1:")",1:"s)")
"RTN","XMJMQ",49,0)
 W @IOF
"RTN","XMJMQ",50,0)
 D PAGE1HDR^XMJMP1(XMDUZ,XMK,XMKN,XMZ,XMRESPS,^XMB(3.9,XMZ,0),XMSUBJ,XMZSTR)
"RTN","XMJMQ",51,0)
 D INFO(XMDUZ,XMK,XMZ,0,"","","",.XMABORT)
"RTN","XMJMQ",52,0)
 Q
"RTN","XMJMQ",53,0)
INFO(XMDUZ,XMK,XMZ,XMPHDR,XMSUBJ,XMZSTR,XMPAGE,XMABORT) ;
"RTN","XMJMQ",54,0)
 N XMREC,XMRECIPS
"RTN","XMJMQ",55,0)
 S XMREC=^XMB(3.9,XMZ,0)
"RTN","XMJMQ",56,0)
 I $Y+4>IOSL D  Q:XMABORT
"RTN","XMJMQ",57,0)
 . D PAGE(.XMABORT)
"RTN","XMJMQ",58,0)
 E  W !
"RTN","XMJMQ",59,0)
 W !
"RTN","XMJMQ",60,0)
 D W("Local Message-ID: "_XMZ_"@"_^XMB("NAME"))
"RTN","XMJMQ",61,0)
 ;D W(" "_$S($P(XMREC,U,13):"Priority!",$P(XMREC,U,7)["S":"[SPOOL]",$P(XMREC,U,8):"<RESPONSE>",1:""))
"RTN","XMJMQ",62,0)
 D W(" "_$S($P(XMREC,U,7)["P":"Priority!",$P(XMREC,U,7)["S":"[SPOOL]",$P(XMREC,U,8):"<RESPONSE>",1:""))
"RTN","XMJMQ",63,0)
 S XMRECIPS=+$P($G(^XMB(3.9,XMZ,1,0)),U,4)
"RTN","XMJMQ",64,0)
 I XMRECIPS D W(" ("_XMRECIPS_" Recipient"_$S(XMRECIPS>1:"s)",1:")"))
"RTN","XMJMQ",65,0)
 I "^Y^y^"[(U_$P(XMREC,U,5)_U) D W(" Confirmation requested.")
"RTN","XMJMQ",66,0)
 I $P(XMREC,U,10)'="" D W(" Scramble Hint: "_$P(XMREC,U,10)_".")
"RTN","XMJMQ",67,0)
 D:$O(^XMB(3.9,XMZ,2005,0)) LIST^XMA2B ; MIME body parts
"RTN","XMJMQ",68,0)
 I "^Y^y^"[(U_$P(XMREC,U,9)_U) D W(" Closed.")
"RTN","XMJMQ",69,0)
 I "^Y^y^"[(U_$P(XMREC,U,11)_U) D W(" Confidential.")
"RTN","XMJMQ",70,0)
 I "^Y^y^"[(U_$P(XMREC,U,12)_U) D W(" 'Information only' for all recipients.")
"RTN","XMJMQ",71,0)
 ;I $D(^XMB(3.9,XMZ,4)) S XMSG="Lock: "_^(4) D OUT G Z:$D(XMOUT)
"RTN","XMJMQ",72,0)
 I $D(^XMB(3.7,XMDUZ,2,XMK,1,XMZ,0)),$P(^(0),U,5) D W(" Automatic Deletion Date: "_$$MMDT^XMXUTIL($P(^(0),U,5)))
"RTN","XMJMQ",73,0)
 D LATER(XMDUZ,XMZ,XMPHDR,XMSUBJ,XMZSTR,.XMPAGE,.XMABORT)
"RTN","XMJMQ",74,0)
 Q
"RTN","XMJMQ",75,0)
W(XMPIECE) ;
"RTN","XMJMQ",76,0)
 I $L(XMPIECE)+$X>IOM D  Q:XMABORT
"RTN","XMJMQ",77,0)
 . I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",78,0)
 . W !
"RTN","XMJMQ",79,0)
 W XMPIECE
"RTN","XMJMQ",80,0)
 Q
"RTN","XMJMQ",81,0)
DETAIL(XMZ,XMPHDR,XMSUBJ,XMZSTR,XMPAGE,XMABORT) ;
"RTN","XMJMQ",82,0)
 ; *** If a msg is fwd'd from a remote site, we should be able to
"RTN","XMJMQ",83,0)
 ;     say who sent it.
"RTN","XMJMQ",84,0)
 ; XMRESPM  Last part msg: of Number of responses in msg
"RTN","XMJMQ",85,0)
 N XMTO,XMRESPM,XMNAME,XMIEN
"RTN","XMJMQ",86,0)
 I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",87,0)
 W !
"RTN","XMJMQ",88,0)
 S XMRESPM=+$P($G(^XMB(3.9,XMZ,3,0)),U,4)
"RTN","XMJMQ",89,0)
 S XMRESPM=" of "_XMRESPM_" response"_$S(XMRESPM=1:")",1:"s)")
"RTN","XMJMQ",90,0)
 S XMTO=""
"RTN","XMJMQ",91,0)
 F  S XMTO=$O(^XMB(3.9,XMZ,1,"C",XMTO)) Q:XMTO=""  D  Q:XMABORT
"RTN","XMJMQ",92,0)
 . S XMNAME=$S(XMTO'=+XMTO:XMTO,$D(^VA(200,XMTO,0)):$P(^(0),U),1:"User "_XMTO)
"RTN","XMJMQ",93,0)
 . S XMIEN=$O(^XMB(3.9,XMZ,1,"C",XMTO,""))
"RTN","XMJMQ",94,0)
 . D WNAME(XMZ,XMNAME,XMIEN,XMRESPM,.XMABORT)
"RTN","XMJMQ",95,0)
 Q
"RTN","XMJMQ",96,0)
WNAME(XMZ,XMNAME,XMIEN,XMRESPM,XMABORT) ;
"RTN","XMJMQ",97,0)
 N XMREC,XMTYPE,XMFWDBY
"RTN","XMJMQ",98,0)
 S XMREC=^XMB(3.9,XMZ,1,XMIEN,0)
"RTN","XMJMQ",99,0)
 I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",100,0)
 W !
"RTN","XMJMQ",101,0)
 I $D(^XMB(3.9,XMZ,1,XMIEN,"T")) D  ; CC: Info: Thru:
"RTN","XMJMQ",102,0)
 . S XMTYPE=$P(^XMB(3.9,XMZ,1,XMIEN,"T"),U,1)
"RTN","XMJMQ",103,0)
 . Q:XMTYPE=""
"RTN","XMJMQ",104,0)
 . S:'$D(XMTYPE(XMTYPE)) XMTYPE(XMTYPE)=$$EXTERNAL^DILFD(3.91,6.5,"",XMTYPE)
"RTN","XMJMQ",105,0)
 . W XMTYPE(XMTYPE),": "
"RTN","XMJMQ",106,0)
 W XMNAME
"RTN","XMJMQ",107,0)
 W:$X<20 ?20
"RTN","XMJMQ",108,0)
 I $E(XMNAME,1,2)="F." D
"RTN","XMJMQ",109,0)
 . D:$P(XMREC,U,5)'="" PRTPIECE(" Sent to fax: "_$$MMDT^XMXUTIL($P(XMREC,U,5)),.XMABORT)  Q:XMABORT
"RTN","XMJMQ",110,0)
 . D:$P(XMREC,U,6)'="" PRTPIECE(" Status: "_$P(XMREC,U,6),.XMABORT) Q:XMABORT
"RTN","XMJMQ",111,0)
 . D:$P(XMREC,U,12)'="" PRTPIECE(" Fax ID: "_$P(XMREC,U,12),.XMABORT)
"RTN","XMJMQ",112,0)
 E  I XMNAME["@" D
"RTN","XMJMQ",113,0)
 . D:$P(XMREC,U,5)'="" PRTPIECE(" Sent: "_$$MMDT^XMXUTIL($P(XMREC,U,5)),.XMABORT)  Q:XMABORT
"RTN","XMJMQ",114,0)
 . D:$P(XMREC,U,8)'="" PRTPIECE(" Time: "_$P(XMREC,U,8)_" second"_$S($P(XMREC,U,8)=1:"",1:"s"),.XMABORT) Q:XMABORT
"RTN","XMJMQ",115,0)
 . I $P(XMREC,U,7)'="",$D(^DIC(4.2,$P(XMREC,U,7),0)) D PRTPIECE(" Path: "_$P(^(0),U),.XMABORT) Q:XMABORT
"RTN","XMJMQ",116,0)
 . D:$P(XMREC,U,4)'="" PRTPIECE(" Message ID: "_$P(XMREC,U,4),.XMABORT) Q:XMABORT
"RTN","XMJMQ",117,0)
 . D:$P(XMREC,U,6)'="" PRTPIECE(" Status: "_$P(XMREC,U,6),.XMABORT)
"RTN","XMJMQ",118,0)
 E  D
"RTN","XMJMQ",119,0)
 . I $P(XMREC,U,10)="" W " Not read." Q
"RTN","XMJMQ",120,0)
 . D:$P(XMREC,U,3)'="" PRTPIECE(" Last read: "_$$MMDT^XMXUTIL($P(XMREC,U,3)),.XMABORT) Q:XMABORT
"RTN","XMJMQ",121,0)
 . D:$P(XMREC,U,2)'="" PRTPIECE(" ("_$P(XMREC,U,2)_XMRESPM,.XMABORT) Q:XMABORT
"RTN","XMJMQ",122,0)
 . D:$P(XMREC,U,10)'="" PRTPIECE(" [First read: "_$$MMDT^XMXUTIL($P(XMREC,U,10))_"]",.XMABORT) Q:XMABORT
"RTN","XMJMQ",123,0)
 . D:$D(^XMB(3.9,XMZ,1,XMIEN,"C")) PRTPIECE(" Copied: "_^("C"),.XMABORT)
"RTN","XMJMQ",124,0)
 . D:$D(^XMB(3.9,XMZ,1,XMIEN,"D")) PRTPIECE(" Terminated: "_$$MMDT^XMXUTIL(^("D")),.XMABORT)
"RTN","XMJMQ",125,0)
 Q:XMABORT
"RTN","XMJMQ",126,0)
 I $D(^XMB(3.9,XMZ,1,XMIEN,"F")) D
"RTN","XMJMQ",127,0)
 . S XMFWDBY=^XMB(3.9,XMZ,1,XMIEN,"F")
"RTN","XMJMQ",128,0)
 . I $E(XMFWDBY,1)?1A D PRTPIECE(" Forwarded by: "_$P(XMFWDBY,U,1),.XMABORT) Q
"RTN","XMJMQ",129,0)
 . I $E(XMFWDBY,1)?1N D PRTPIECE(" Forwarded by: "_$P($G(^VA(200,$P(XMFWDBY," "),0)),U)_" "_$P($P(XMFWDBY,U)," ",2,9),.XMABORT) Q
"RTN","XMJMQ",130,0)
 . D PRTPIECE(" Forwarded on: "_XMFWDBY,.XMABORT)
"RTN","XMJMQ",131,0)
 Q
"RTN","XMJMQ",132,0)
PRTPIECE(XMPIECE,XMABORT) ;
"RTN","XMJMQ",133,0)
 I $L(XMPIECE)+$X>IOM D  Q:XMABORT
"RTN","XMJMQ",134,0)
 . I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",135,0)
 . W !,?20
"RTN","XMJMQ",136,0)
 W XMPIECE
"RTN","XMJMQ",137,0)
 Q
"RTN","XMJMQ",138,0)
 ;PAGE(XMPHDR,XMSUBJ,XMZSTR,XMPAGE,XMABORT);
"RTN","XMJMQ",139,0)
PAGE(XMABORT) ;
"RTN","XMJMQ",140,0)
 I $G(IOST)["C-" D  Q:XMABORT
"RTN","XMJMQ",141,0)
 . N DIR,DIRUT
"RTN","XMJMQ",142,0)
 . S DIR(0)="E"
"RTN","XMJMQ",143,0)
 . D ^DIR
"RTN","XMJMQ",144,0)
 . I $D(DIRUT) S XMABORT=1
"RTN","XMJMQ",145,0)
 W @IOF
"RTN","XMJMQ",146,0)
 Q:'XMPHDR
"RTN","XMJMQ",147,0)
 D PAGE2HDR^XMJMP1(XMSUBJ,XMZSTR,.XMPAGE)
"RTN","XMJMQ",148,0)
 Q
"RTN","XMJMQ",149,0)
LATER(XMDUZ,XMZ,XMPHDR,XMSUBJ,XMZSTR,XMPAGE,XMABORT) ; List dates message will be new on 'later'
"RTN","XMJMQ",150,0)
 Q:'$O(^XMB(3.73,"AC",XMZ,XMDUZ,0))
"RTN","XMJMQ",151,0)
 N XMIEN,XMSEP
"RTN","XMJMQ",152,0)
 I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",153,0)
 W !
"RTN","XMJMQ",154,0)
 D W("Message will be NEW on: ")
"RTN","XMJMQ",155,0)
 S XMIEN="",XMSEP=" "
"RTN","XMJMQ",156,0)
 F  S XMIEN=$O(^XMB(3.73,"AC",XMZ,XMDUZ,XMIEN)) Q:XMIEN=""  D
"RTN","XMJMQ",157,0)
 . D W2(XMSEP,$$MMDT^XMXUTIL($P(^XMB(3.73,XMIEN,0),U)),.XMABORT)
"RTN","XMJMQ",158,0)
 . S XMSEP=", "
"RTN","XMJMQ",159,0)
 Q
"RTN","XMJMQ",160,0)
W2(XMSEP,XMPIECE,XMABORT) ;
"RTN","XMJMQ",161,0)
 I $X+$L(XMSEP)+$L(XMPIECE)>IOM D  Q:XMABORT
"RTN","XMJMQ",162,0)
 . I $Y+3>IOSL D PAGE(.XMABORT) Q:XMABORT
"RTN","XMJMQ",163,0)
 . W !,XMPIECE
"RTN","XMJMQ",164,0)
 E  W XMSEP,XMPIECE
"RTN","XMJMQ",165,0)
 Q
"RTN","XMJMQ",166,0)
SEARCH(XMZ,XMNAME,XMRESPM) ;
"RTN","XMJMQ",167,0)
 N I,XMXREF,XMPHDR
"RTN","XMJMQ",168,0)
 S XMPHDR=0
"RTN","XMJMQ",169,0)
 I $Y+5>IOSL D  Q:XMABORT
"RTN","XMJMQ",170,0)
 . D PAGE(.XMABORT)
"RTN","XMJMQ",171,0)
 E  W !
"RTN","XMJMQ",172,0)
 W !,"Searching for recipients that match '",XMNAME,"'.",!
"RTN","XMJMQ",173,0)
 S XMXREF="B"
"RTN","XMJMQ",174,0)
 S:$D(^VA(200,"BB")) XMXREF=XMXREF_"^BB"
"RTN","XMJMQ",175,0)
 S:$D(^VA(200,"C")) XMXREF=XMXREF_"^C"
"RTN","XMJMQ",176,0)
 S:$D(^VA(200,"D")) XMXREF=XMXREF_"^D"
"RTN","XMJMQ",177,0)
 D FIND^DIC(200,"","","A",XMNAME,"",XMXREF,"I $D(^XMB(3.9,XMZ,1,""C"",+Y))")
"RTN","XMJMQ",178,0)
 I '$D(DIERR) D PSEARCH(200,XMZ,XMRESPM,.XMABORT) Q:XMABORT
"RTN","XMJMQ",179,0)
 Q:$O(^XMB(3.9,XMZ,1,"C",999999999))=""  ; Quit if there aren't any non-local addressees
"RTN","XMJMQ",180,0)
 N XMSCREEN
"RTN","XMJMQ",181,0)
 S XMSCREEN=$S(+XMNAME=XMNAME:"I '$D(^XMB(3.9,XMZ,1,""C"",XMNAME))",1:"")
"RTN","XMJMQ",182,0)
 D FIND^DIC(3.91,","_XMZ_",","","",XMNAME,"","C",XMSCREEN)
"RTN","XMJMQ",183,0)
 I '$D(DIERR) D PSEARCH(3.91,XMZ,XMRESPM,.XMABORT)
"RTN","XMJMQ",184,0)
 Q:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"'[$E(XMNAME)  ; Quit if the search string does not begin with an upper case letter
"RTN","XMJMQ",185,0)
 Q:$O(^XMB(3.9,XMZ,1,"C","`"))=""  ; Quit if there aren't any lower case addressees
"RTN","XMJMQ",186,0)
 ; FM will translate lower case to upper case in its search, but won't
"RTN","XMJMQ",187,0)
 ; translate upper to lower, so we do it here.
"RTN","XMJMQ",188,0)
 S XMSCREEN="I ^(0)]""`""" ; Limit search to lower case addresses
"RTN","XMJMQ",189,0)
 D FIND^DIC(3.91,","_XMZ_",","","",$$LOW^XLFSTR(XMNAME),"","C",XMSCREEN)
"RTN","XMJMQ",190,0)
 I '$D(DIERR) D PSEARCH(3.91,XMZ,XMRESPM,.XMABORT)
"RTN","XMJMQ",191,0)
 Q
"RTN","XMJMQ",192,0)
PSEARCH(XMFILE,XMZ,XMRESPM,XMABORT) ; Print search results
"RTN","XMJMQ",193,0)
 N I,XMIEN
"RTN","XMJMQ",194,0)
 S I=0
"RTN","XMJMQ",195,0)
 F  S I=$O(^TMP("DILIST",$J,1,I)) Q:I=""  D  Q:XMABORT
"RTN","XMJMQ",196,0)
 . S XMIEN=^TMP("DILIST",$J,2,I)
"RTN","XMJMQ",197,0)
 . S:XMFILE=200 XMIEN=$O(^XMB(3.9,XMZ,1,"C",XMIEN,0))
"RTN","XMJMQ",198,0)
 . D WNAME(XMZ,^TMP("DILIST",$J,1,I),XMIEN,XMRESPM,.XMABORT)
"RTN","XMJMQ",199,0)
 Q
"RTN","XMJMQ1")
0^7^B6609372
"RTN","XMJMQ1",1,0)
XMJMQ1 ;ISC-SF/GMB- Q,QD,QN Query recipients (continued) ;05/16/97  08:53
"RTN","XMJMQ1",2,0)
 ;;7.1;MailMan;**40**;Jun 02, 1994
"RTN","XMJMQ1",3,0)
 ; Replaces ^XMA5,^XMA5A (ISC-WASH/THM/CAP)
"RTN","XMJMQ1",4,0)
NETWORK(XMZ,XMABORT) ;
"RTN","XMJMQ1",5,0)
 N I,J,XMLINE,XMPOS,XMPIECE,XMPHDR
"RTN","XMJMQ1",6,0)
 I $O(^XMB(3.9,XMZ,2,0))>.999 D  Q
"RTN","XMJMQ1",7,0)
 . W !!,"This message originated locally.  There is no network header."
"RTN","XMJMQ1",8,0)
 W !!,"Network header:",!
"RTN","XMJMQ1",9,0)
 S (I,XMPHDR)=0
"RTN","XMJMQ1",10,0)
 F  S I=$O(^XMB(3.9,XMZ,2,I)) Q:I=""!(I>.999)  D  Q:XMABORT
"RTN","XMJMQ1",11,0)
 . S XMLINE=^XMB(3.9,XMZ,2,I,0)
"RTN","XMJMQ1",12,0)
 . I $Y+3>IOSL D PAGE^XMJMQ(.XMABORT) Q:XMABORT
"RTN","XMJMQ1",13,0)
 . I $L(XMLINE)<IOM W !,XMLINE Q
"RTN","XMJMQ1",14,0)
 . S XMPOS=0
"RTN","XMJMQ1",15,0)
 . F  D  Q:XMLINE=""!XMABORT
"RTN","XMJMQ1",16,0)
 . . I $L(XMLINE)+10>IOM F J=IOM-10:-1:IOM-20 Q:", -"[$E(XMLINE,J)
"RTN","XMJMQ1",17,0)
 . . I $Y+3>IOSL D PAGE^XMJMQ(.XMABORT) Q:XMABORT
"RTN","XMJMQ1",18,0)
 . . W !,?XMPOS,$E(XMLINE,1,J)
"RTN","XMJMQ1",19,0)
 . . S XMPOS=9
"RTN","XMJMQ1",20,0)
 . . S XMLINE=$E(XMLINE,J+1,999)
"RTN","XMJMQ1",21,0)
 Q
"RTN","XMJMQ1",22,0)
SUMMARY(XMZ,XMPHDR,XMSUBJ,XMZSTR,XMPAGE,XMABORT) ;
"RTN","XMJMQ1",23,0)
 I $Y+3>IOSL D PAGE^XMJMQ(.XMABORT) Q:XMABORT
"RTN","XMJMQ1",24,0)
 W !
"RTN","XMJMQ1",25,0)
 I '$O(^XMB(3.9,XMZ,6,0)) D  Q
"RTN","XMJMQ1",26,0)
 . W !,"This is an old message which has no summary recipient list."
"RTN","XMJMQ1",27,0)
 . W !,"Only the Detail Query (QD) is available."
"RTN","XMJMQ1",28,0)
 W !,"This message was addressed as follows:",!
"RTN","XMJMQ1",29,0)
 D PRTADDR(XMZ,6,.XMABORT) Q:XMABORT  ; addressed to
"RTN","XMJMQ1",30,0)
 D PRTADDR(XMZ,7,.XMABORT)            ; deliver later to
"RTN","XMJMQ1",31,0)
 Q
"RTN","XMJMQ1",32,0)
PRTADDR(XMZ,XMNODE,XMABORT) ;
"RTN","XMJMQ1",33,0)
 N XMTO
"RTN","XMJMQ1",34,0)
 ;List Groups first
"RTN","XMJMQ1",35,0)
 S XMTO="G."
"RTN","XMJMQ1",36,0)
 F  S XMTO=$O(^XMB(3.9,XMZ,6,"B",XMTO)) Q:$E(XMTO,1,2)'="G."  D PRTSUMRY(XMZ,XMNODE,XMTO,.XMABORT)  Q:XMABORT
"RTN","XMJMQ1",37,0)
 Q:XMABORT
"RTN","XMJMQ1",38,0)
 S XMTO=""  ; Now list the rest
"RTN","XMJMQ1",39,0)
 F  S XMTO=$O(^XMB(3.9,XMZ,XMNODE,"B",XMTO)) Q:XMTO=""  D  Q:XMABORT
"RTN","XMJMQ1",40,0)
 . Q:$E(XMTO,1,2)="G."
"RTN","XMJMQ1",41,0)
 . D PRTSUMRY(XMZ,XMNODE,XMTO,.XMABORT)
"RTN","XMJMQ1",42,0)
 Q
"RTN","XMJMQ1",43,0)
PRTSUMRY(XMZ,XMNODE,XMTO,XMABORT) ;
"RTN","XMJMQ1",44,0)
 N XMIEN,XMREC
"RTN","XMJMQ1",45,0)
 S XMIEN=$O(^XMB(3.9,XMZ,XMNODE,"B",XMTO,0)) Q:'XMIEN
"RTN","XMJMQ1",46,0)
 S XMREC=$G(^XMB(3.9,XMZ,XMNODE,XMIEN,0)) Q:XMREC=""
"RTN","XMJMQ1",47,0)
 I $Y+3>IOSL D PAGE^XMJMQ(.XMABORT) Q:XMABORT
"RTN","XMJMQ1",48,0)
 W ! W $S($P(XMREC,U,2)="":"",$P(XMREC,U,2)="I":"Info:",$P(XMREC,U,2)="C":"cc:",1:$P(XMREC,U,2)_":") W $P(XMREC,U,1)
"RTN","XMJMQ1",49,0)
 Q:XMNODE=6
"RTN","XMJMQ1",50,0)
 D W^XMJMQ(" for delivery "_$$MMDT^XMXUTIL($P(XMREC,U,5)))
"RTN","XMJMQ1",51,0)
 D W^XMJMQ(" by "_$P(XMREC,U,4))
"RTN","XMJMQ1",52,0)
 Q
"RTN","XMXUTIL")
0^4^B5250684
"RTN","XMXUTIL",1,0)
XMXUTIL ;SF/GMB- Utilities ;02/12/97  13:44
"RTN","XMXUTIL",2,0)
 ;;7.1;MailMan;**40**;Jun 02, 1994
"RTN","XMXUTIL",3,0)
TNMSGCT(XMDUZ) ; Total new msg count
"RTN","XMXUTIL",4,0)
 Q +$P(^XMB(3.7,XMDUZ,0),U,6)
"RTN","XMXUTIL",5,0)
 ;N I,XMK
"RTN","XMXUTIL",6,0)
 ;S I=0,XMK=.99
"RTN","XMXUTIL",7,0)
 ;F  S XMK=$O(^XMB(3.7,XMDUZ,"N0",XMK)) Q:XMK'>0  S I=I+$$BNMSGCT(XMDUZ,XMK)
"RTN","XMXUTIL",8,0)
 ;Q I
"RTN","XMXUTIL",9,0)
BNMSGCT(XMDUZ,XMK) ; Basket new msg count
"RTN","XMXUTIL",10,0)
 Q +$P(^XMB(3.7,XMDUZ,2,XMK,0),U,2)
"RTN","XMXUTIL",11,0)
 ;N I,XMZ
"RTN","XMXUTIL",12,0)
 ;S I=0,XMZ=""
"RTN","XMXUTIL",13,0)
 ;F  S XMZ=$O(^XMB(3.7,XMDUZ,"N0",XMK,XMZ)) Q:XMZ=""  S I=I+1
"RTN","XMXUTIL",14,0)
 ;Q I
"RTN","XMXUTIL",15,0)
TMSGCT(XMDUZ) ; Total msg count
"RTN","XMXUTIL",16,0)
 N I,XMK
"RTN","XMXUTIL",17,0)
 S I=0,XMK=.99
"RTN","XMXUTIL",18,0)
 F  S XMK=$O(^XMB(3.7,XMDUZ,2,XMK)) Q:XMK'>0  S I=I+$$BMSGCT(XMDUZ,XMK)
"RTN","XMXUTIL",19,0)
 Q I
"RTN","XMXUTIL",20,0)
BMSGCT(XMDUZ,XMK) ; Basket msg count
"RTN","XMXUTIL",21,0)
 Q +$P($G(^XMB(3.7,XMDUZ,2,XMK,1,0)),U,4)
"RTN","XMXUTIL",22,0)
TSTAMP() ;
"RTN","XMXUTIL",23,0)
 Q $H*86400+$P($H,",",2)
"RTN","XMXUTIL",24,0)
LOCK(XMDOOR,XMLOCKED,XMWAIT) ;
"RTN","XMXUTIL",25,0)
 L +@XMDOOR:$G(XMWAIT,0) E  S XMLOCKED=0 Q
"RTN","XMXUTIL",26,0)
 S XMLOCKED=1
"RTN","XMXUTIL",27,0)
 Q
"RTN","XMXUTIL",28,0)
INCRNEW(XMDUZ,XMK) ;
"RTN","XMXUTIL",29,0)
 S $P(^(0),U,2)=$P(^XMB(3.7,XMDUZ,2,XMK,0),U,2)+1 ; New msgs in bskt
"RTN","XMXUTIL",30,0)
 S $P(^(0),U,6)=$P(^XMB(3.7,XMDUZ,0),U,6)+1       ; New msgs for user
"RTN","XMXUTIL",31,0)
 S $P(^XMB(3.7,XMDUZ,0),U,14)=$$NOW^XLFDT         ; When last msg rec'd
"RTN","XMXUTIL",32,0)
 Q
"RTN","XMXUTIL",33,0)
DECRNEW(XMDUZ,XMK) ;
"RTN","XMXUTIL",34,0)
 S $P(^(0),U,2)=$P(^XMB(3.7,XMDUZ,2,XMK,0),U,2)-1 ; New msgs in bskt
"RTN","XMXUTIL",35,0)
 S $P(^(0),U,6)=$P(^XMB(3.7,XMDUZ,0),U,6)-1       ; New msgs for user
"RTN","XMXUTIL",36,0)
 Q
"RTN","XMXUTIL",37,0)
MMDT(XMDT) ; Given FM date/time, return dd mmm yy hh:mm
"RTN","XMXUTIL",38,0)
 ; time is optional
"RTN","XMXUTIL",39,0)
 Q:XMDT'=+XMDT XMDT
"RTN","XMXUTIL",40,0)
 N MMDT
"RTN","XMXUTIL",41,0)
 S MMDT=$E(XMDT,6,7)_" "_$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec",U,$E(XMDT,4,5))_" "_$E(XMDT,2,3)
"RTN","XMXUTIL",42,0)
 S XMDT=$P(XMDT,".",2)_"0000"
"RTN","XMXUTIL",43,0)
 Q:'XMDT MMDT
"RTN","XMXUTIL",44,0)
 Q MMDT_" "_$E(XMDT,1,2)_":"_$E(XMDT,3,4)
"RTN","XMXUTIL",45,0)
NAME(XMNAME) ; Given a name or DUZ, return the name
"RTN","XMXUTIL",46,0)
 Q:+XMNAME'=XMNAME XMNAME
"RTN","XMXUTIL",47,0)
 Q $P($G(^VA(200,XMNAME,0)),U,1)
"RTN","XMXUTIL",48,0)
ENCODEUP(XMSUBJ) ;
"RTN","XMXUTIL",49,0)
 F  Q:XMSUBJ'[U  S XMSUBJ=$P(XMSUBJ,U)_"~U~"_$P(XMSUBJ,U,2,999)
"RTN","XMXUTIL",50,0)
 Q XMSUBJ
"RTN","XMXUTIL",51,0)
DECODEUP(XMSUBJ) ;
"RTN","XMXUTIL",52,0)
 F  Q:XMSUBJ'["~U~"  S XMSUBJ=$P(XMSUBJ,"~U~")_U_$P(XMSUBJ,"~U~",2,999)
"RTN","XMXUTIL",53,0)
 Q XMSUBJ
"RTN","XMXUTIL",54,0)
PRIORITY(XMZ) ; Returns 1 if msg is a priority msg; 0 if not.
"RTN","XMXUTIL",55,0)
 Q $P($G(^XMB(3.9,XMZ,0)),U,7)["P"  ; *** MM 7.1 code
"RTN","XMYPRE1")
0^5^B52582
"RTN","XMYPRE1",1,0)
XMYPRE1 ;(ISC-SF)/GMB-PREINSTALLATION INIT ;02/20/97  09:10
"RTN","XMYPRE1",2,0)
 ;;7.1;MailMan;**40**;Jun 02, 1994
"RTN","XMYPRE1",3,0)
 ; Get rid of "C" xref on field 1 (LAST RESPONSE READ) of RECIPIENT
"RTN","XMYPRE1",4,0)
 ; multiple of MESSAGE file
"RTN","XMYPRE1",5,0)
 K ^DD(3.91,1,1)
"RTN","XMYPRE1",6,0)
 K ^DD(3.91,0,"IX","C")
"RTN","XMYPRE1",7,0)
 K ^DD(3.91,"IX",1)
"RTN","XMYPRE1",8,0)
 Q
"UP",3.9,3.91,-1)
3.9^1
"UP",3.9,3.91,0)
3.91
"VER")
8.0^21.0
"^DD",3.9,3.9,2,0)
RECIPIENT^3.91A^^1;0
"^DD",3.9,3.9,2,21,0)
^^4^4^2970211^^^^
"^DD",3.9,3.9,2,21,1,0)
This is a list of all recipients of this message.  MailMan automatically
"^DD",3.9,3.9,2,21,2,0)
tracks each recipient's progress through the response chain, when
"^DD",3.9,3.9,2,21,3,0)
they last read it, who forwarded or copied the message, etc.  This 
"^DD",3.9,3.9,2,21,4,0)
information is displayed with the Query option after reading the message.
"^DD",3.9,3.91,0)
RECIPIENT SUB-FIELD^NL^14^18
"^DD",3.9,3.91,0,"NM","RECIPIENT")

"^DD",3.9,3.91,.01,0)
RECIPIENT^MFI^^0;1^K:$L(X)>65!($L(X)<3)!'(X?.ANP) X
"^DD",3.9,3.91,.01,.1)
The recipient user number or network address
"^DD",3.9,3.91,.01,1,0)
^.1
"^DD",3.9,3.91,.01,1,1,0)
3.91^C
"^DD",3.9,3.91,.01,1,1,1)
S ^XMB(3.9,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",3.9,3.91,.01,1,1,2)
K ^XMB(3.9,DA(1),1,"C",$E(X,1,30),DA)
"^DD",3.9,3.91,.01,1,1,"%D",0)
^^1^1^2970218^
"^DD",3.9,3.91,.01,1,1,"%D",1,0)
Helps to look up message recipients.
"^DD",3.9,3.91,.01,1,1,"DT")
2970218
"^DD",3.9,3.91,.01,3)
ANSWER MUST BE 3-65 CHARACTERS IN LENGTH
"^DD",3.9,3.91,.01,21,0)
^^1^1^2931214^^
"^DD",3.9,3.91,.01,21,1,0)
The name of a recipient of this message.
"^DD",3.9,3.91,.01,"DT")
2970218
**END**
**END**
