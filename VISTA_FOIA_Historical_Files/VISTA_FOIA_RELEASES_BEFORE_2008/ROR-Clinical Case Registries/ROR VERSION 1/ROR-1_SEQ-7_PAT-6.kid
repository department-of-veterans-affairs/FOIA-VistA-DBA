Released ROR*1*6 SEQ #7
Extracted from mail message
**KIDS**:ROR*1.0*6^

**INSTALL NAME**
ROR*1.0*6
"BLD",4926,0)
ROR*1.0*6^CLINICAL CASE REGISTRIES^0^3040630^y
"BLD",4926,1,0)
^^2^2^3040629^^
"BLD",4926,1,1,0)
This patch fixes problems discovered during the implementation of the
"BLD",4926,1,2,0)
Immunology Case Registry in the Clinical Case Registries framework.
"BLD",4926,4,0)
^9.64PA^799.34^2
"BLD",4926,4,799.31,0)
799.31
"BLD",4926,4,799.31,222)
n^n^f^^n^^y^o^n
"BLD",4926,4,799.34,0)
799.34
"BLD",4926,4,799.34,222)
n^n^f^^n^^y^o^n
"BLD",4926,4,"B",799.31,799.31)

"BLD",4926,4,"B",799.34,799.34)

"BLD",4926,"INIT")
POS^RORP006
"BLD",4926,"KRN",0)
^9.67PA^8989.52^19
"BLD",4926,"KRN",.4,0)
.4
"BLD",4926,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",4926,"KRN",.4,"NM",1,0)
ROR LOG    FILE #798.7^798.7^0
"BLD",4926,"KRN",.4,"NM","B","ROR LOG    FILE #798.7",1)

"BLD",4926,"KRN",.401,0)
.401
"BLD",4926,"KRN",.402,0)
.402
"BLD",4926,"KRN",.403,0)
.403
"BLD",4926,"KRN",.5,0)
.5
"BLD",4926,"KRN",.84,0)
.84
"BLD",4926,"KRN",.84,"NM",0)
^9.68A^4^4
"BLD",4926,"KRN",.84,"NM",1,0)
7981003.001^^0
"BLD",4926,"KRN",.84,"NM",2,0)
7981003.002^^0
"BLD",4926,"KRN",.84,"NM",3,0)
7981997.001^^0
"BLD",4926,"KRN",.84,"NM",4,0)
7981997.002^^0
"BLD",4926,"KRN",.84,"NM","B",7981003.001,1)

"BLD",4926,"KRN",.84,"NM","B",7981003.002,2)

"BLD",4926,"KRN",.84,"NM","B",7981997.001,3)

"BLD",4926,"KRN",.84,"NM","B",7981997.002,4)

"BLD",4926,"KRN",3.6,0)
3.6
"BLD",4926,"KRN",3.8,0)
3.8
"BLD",4926,"KRN",9.2,0)
9.2
"BLD",4926,"KRN",9.8,0)
9.8
"BLD",4926,"KRN",9.8,"NM",0)
^9.68A^34^30
"BLD",4926,"KRN",9.8,"NM",1,0)
RORHL17^^0^B33637677
"BLD",4926,"KRN",9.8,"NM",2,0)
RORX003^^0^B21906408
"BLD",4926,"KRN",9.8,"NM",3,0)
RORX003A^^0^B48035338
"BLD",4926,"KRN",9.8,"NM",4,0)
RORUPD05^^0^B44824205
"BLD",4926,"KRN",9.8,"NM",5,0)
RORUTL06^^0^B61329493
"BLD",4926,"KRN",9.8,"NM",9,0)
RORUTL18^^0^B650404
"BLD",4926,"KRN",9.8,"NM",10,0)
ROREXT02^^0^B27112280
"BLD",4926,"KRN",9.8,"NM",11,0)
RORUTL17^^0^B53261320
"BLD",4926,"KRN",9.8,"NM",12,0)
ROREXPR^^0^B10751653
"BLD",4926,"KRN",9.8,"NM",13,0)
RORHL031^^0^B39786704
"BLD",4926,"KRN",9.8,"NM",14,0)
RORHL09^^0^B51776008
"BLD",4926,"KRN",9.8,"NM",15,0)
RORRP012^^0^B16756305
"BLD",4926,"KRN",9.8,"NM",16,0)
ROR^^0^B18598681
"BLD",4926,"KRN",9.8,"NM",17,0)
RORHL02^^0^B44853872
"BLD",4926,"KRN",9.8,"NM",18,0)
ROREXT03^^0^B7069977
"BLD",4926,"KRN",9.8,"NM",20,0)
ROREXT01^^0^B23188606
"BLD",4926,"KRN",9.8,"NM",21,0)
RORUPD04^^0^B32341730
"BLD",4926,"KRN",9.8,"NM",22,0)
RORHL03^^0^B30890153
"BLD",4926,"KRN",9.8,"NM",23,0)
RORHL04^^0^B30377336
"BLD",4926,"KRN",9.8,"NM",24,0)
RORHL07^^0^B22855009
"BLD",4926,"KRN",9.8,"NM",25,0)
RORHL071^^0^B20578244
"BLD",4926,"KRN",9.8,"NM",26,0)
RORHL14^^0^B30912646
"BLD",4926,"KRN",9.8,"NM",27,0)
RORNTEG^^0^B19112178
"BLD",4926,"KRN",9.8,"NM",28,0)
RORNTEG0^^0^B4128508
"BLD",4926,"KRN",9.8,"NM",29,0)
RORP003^^1^
"BLD",4926,"KRN",9.8,"NM",30,0)
RORP004^^1^
"BLD",4926,"KRN",9.8,"NM",31,0)
RORP005^^1^
"BLD",4926,"KRN",9.8,"NM",32,0)
RORP005B^^1^
"BLD",4926,"KRN",9.8,"NM",33,0)
RORRP030^^0^B34969040
"BLD",4926,"KRN",9.8,"NM",34,0)
RORRP019^^0^B24433476
"BLD",4926,"KRN",9.8,"NM","B","ROR",16)

"BLD",4926,"KRN",9.8,"NM","B","ROREXPR",12)

"BLD",4926,"KRN",9.8,"NM","B","ROREXT01",20)

"BLD",4926,"KRN",9.8,"NM","B","ROREXT02",10)

"BLD",4926,"KRN",9.8,"NM","B","ROREXT03",18)

"BLD",4926,"KRN",9.8,"NM","B","RORHL02",17)

"BLD",4926,"KRN",9.8,"NM","B","RORHL03",22)

"BLD",4926,"KRN",9.8,"NM","B","RORHL031",13)

"BLD",4926,"KRN",9.8,"NM","B","RORHL04",23)

"BLD",4926,"KRN",9.8,"NM","B","RORHL07",24)

"BLD",4926,"KRN",9.8,"NM","B","RORHL071",25)

"BLD",4926,"KRN",9.8,"NM","B","RORHL09",14)

"BLD",4926,"KRN",9.8,"NM","B","RORHL14",26)

"BLD",4926,"KRN",9.8,"NM","B","RORHL17",1)

"BLD",4926,"KRN",9.8,"NM","B","RORNTEG",27)

"BLD",4926,"KRN",9.8,"NM","B","RORNTEG0",28)

"BLD",4926,"KRN",9.8,"NM","B","RORP003",29)

"BLD",4926,"KRN",9.8,"NM","B","RORP004",30)

"BLD",4926,"KRN",9.8,"NM","B","RORP005",31)

"BLD",4926,"KRN",9.8,"NM","B","RORP005B",32)

"BLD",4926,"KRN",9.8,"NM","B","RORRP012",15)

"BLD",4926,"KRN",9.8,"NM","B","RORRP019",34)

"BLD",4926,"KRN",9.8,"NM","B","RORRP030",33)

"BLD",4926,"KRN",9.8,"NM","B","RORUPD04",21)

"BLD",4926,"KRN",9.8,"NM","B","RORUPD05",4)

"BLD",4926,"KRN",9.8,"NM","B","RORUTL06",5)

"BLD",4926,"KRN",9.8,"NM","B","RORUTL17",11)

"BLD",4926,"KRN",9.8,"NM","B","RORUTL18",9)

"BLD",4926,"KRN",9.8,"NM","B","RORX003",2)

"BLD",4926,"KRN",9.8,"NM","B","RORX003A",3)

"BLD",4926,"KRN",19,0)
19
"BLD",4926,"KRN",19,"NM",0)
^9.68A^^
"BLD",4926,"KRN",19.1,0)
19.1
"BLD",4926,"KRN",101,0)
101
"BLD",4926,"KRN",409.61,0)
409.61
"BLD",4926,"KRN",771,0)
771
"BLD",4926,"KRN",870,0)
870
"BLD",4926,"KRN",8989.51,0)
8989.51
"BLD",4926,"KRN",8989.52,0)
8989.52
"BLD",4926,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",4926,"KRN",8994,0)
8994
"BLD",4926,"KRN","B",.4,.4)

"BLD",4926,"KRN","B",.401,.401)

"BLD",4926,"KRN","B",.402,.402)

"BLD",4926,"KRN","B",.403,.403)

"BLD",4926,"KRN","B",.5,.5)

"BLD",4926,"KRN","B",.84,.84)

"BLD",4926,"KRN","B",3.6,3.6)

"BLD",4926,"KRN","B",3.8,3.8)

"BLD",4926,"KRN","B",9.2,9.2)

"BLD",4926,"KRN","B",9.8,9.8)

"BLD",4926,"KRN","B",19,19)

"BLD",4926,"KRN","B",19.1,19.1)

"BLD",4926,"KRN","B",101,101)

"BLD",4926,"KRN","B",409.61,409.61)

"BLD",4926,"KRN","B",771,771)

"BLD",4926,"KRN","B",870,870)

"BLD",4926,"KRN","B",8989.51,8989.51)

"BLD",4926,"KRN","B",8989.52,8989.52)

"BLD",4926,"KRN","B",8994,8994)

"BLD",4926,"PRE")
RORP006
"BLD",4926,"PRET")
PTR^RORP006
"BLD",4926,"QUES",0)
^9.62^^
"BLD",4926,"REQB",0)
^9.611^1^1
"BLD",4926,"REQB",1,0)
ROR*1.0*5^2
"BLD",4926,"REQB","B","ROR*1.0*5",1)

"DATA",799.31,1,0)
REPORT
"DATA",799.31,2,0)
PARAMETERS
"DATA",799.31,3,0)
PATIENTS
"DATA",799.31,4,0)
CAREONLY
"DATA",799.31,5,0)
PATIENT
"DATA",799.31,6,0)
CATSPLIT
"DATA",799.31,7,0)
COLSPAN
"DATA",799.31,8,0)
ARV
"DATA",799.31,9,0)
NAME
"DATA",799.31,10,0)
DOB
"DATA",799.31,11,0)
DOD
"DATA",799.31,12,0)
COMPLETE
"DATA",799.31,13,0)
COUNT
"DATA",799.31,14,0)
DE_BEFORE
"DATA",799.31,15,0)
DATE
"DATA",799.31,16,0)
DE_DURING
"DATA",799.31,17,0)
HIV
"DATA",799.31,18,0)
ACTIVE
"DATA",799.31,19,0)
DFN
"DATA",799.31,20,0)
ICN
"DATA",799.31,21,0)
ID
"DATA",799.31,22,0)
INACTIVE
"DATA",799.31,23,0)
NEW
"DATA",799.31,24,0)
NOTSEEN
"DATA",799.31,25,0)
SELRULES
"DATA",799.31,26,0)
RULE
"DATA",799.31,27,0)
SSN
"DATA",799.31,28,0)
CSSN
"DATA",799.31,29,0)
AIDSTAT
"DATA",799.31,30,0)
ALIVE
"DATA",799.31,31,0)
AGE
"DATA",799.31,32,0)
ENTDT
"DATA",799.31,33,0)
INADT
"DATA",799.31,34,0)
PRIMELIG
"DATA",799.31,35,0)
RACE
"DATA",799.31,36,0)
READT
"DATA",799.31,37,0)
REIMBLVL
"DATA",799.31,38,0)
RISK
"DATA",799.31,39,0)
SEX
"DATA",799.31,40,0)
DE_AFTER
"DATA",799.31,41,0)
UTIL
"DATA",799.31,42,0)
CD4OPT
"DATA",799.31,43,0)
CLINICS
"DATA",799.31,44,0)
CLINIC
"DATA",799.31,45,0)
CUTOFF
"DATA",799.31,46,0)
DATE_RANGE
"DATA",799.31,47,0)
DIVISION
"DATA",799.31,48,0)
DIVISIONS
"DATA",799.31,49,0)
DRUGS
"DATA",799.31,50,0)
FIELDS
"DATA",799.31,51,0)
ICD9LST
"DATA",799.31,52,0)
ICD9
"DATA",799.31,53,0)
LABTESTS
"DATA",799.31,54,0)
LT
"DATA",799.31,55,0)
MAXUTNUM
"DATA",799.31,57,0)
MINRPNUM
"DATA",799.31,58,0)
OPTIONS
"DATA",799.31,59,0)
REGIEN
"DATA",799.31,60,0)
VIRAL_LOAD
"DATA",799.31,61,0)
LOW
"DATA",799.31,62,0)
HIGH
"DATA",799.31,63,0)
START
"DATA",799.31,64,0)
END
"DATA",799.31,65,0)
PARAMETER
"DATA",799.31,66,0)
TASK_DESCR
"DATA",799.31,67,0)
REGNAME
"DATA",799.31,69,0)
COLUMN
"DATA",799.31,70,0)
TITLE
"DATA",799.31,71,0)
HEADER
"DATA",799.31,72,0)
DESCR
"DATA",799.31,73,0)
LAST4
"DATA",799.31,74,0)
TASK_NUMBER
"DATA",799.31,75,0)
UPDATED_UNTIL
"DATA",799.31,76,0)
EXTRACTED_UNTIL
"DATA",799.31,77,0)
WARD
"DATA",799.31,78,0)
ADMDT
"DATA",799.31,79,0)
LOS
"DATA",799.31,80,0)
LOSFYTD
"DATA",799.31,81,0)
CATEGORY
"DATA",799.31,82,0)
SUMMARY
"DATA",799.31,83,0)
RACES
"DATA",799.31,84,0)
RISK_FACTORS
"DATA",799.31,85,0)
RACE_SUMMARY
"DATA",799.31,86,0)
SEX_SUMMARY
"DATA",799.31,87,0)
REIMBLVL_SUMMARY
"DATA",799.31,88,0)
AGE_SUMMARY
"DATA",799.31,89,0)
SEEN
"DATA",799.31,90,0)
SEEN_SUMMARY
"DATA",799.31,91,0)
LSNDT
"DATA",799.31,92,0)
CPT
"DATA",799.31,93,0)
QNTY
"DATA",799.31,94,0)
TOTAL
"DATA",799.31,95,0)
UNIQUE
"DATA",799.31,96,0)
PATIENT_SUMMARY
"DATA",799.31,97,0)
PROCEDURE
"DATA",799.31,98,0)
PROCEDURES
"DATA",799.31,99,0)
GROUP
"DATA",799.31,100,0)
RESULT
"DATA",799.31,101,0)
INARSN
"DATA",799.31,102,0)
REARSN
"DATA",799.31,103,0)
UTIL_CODES
"DATA",799.31,104,0)
INPATIENT
"DATA",799.31,105,0)
OUTPATIENTS
"DATA",799.31,106,0)
INPATIENTS
"DATA",799.31,107,0)
VISITS
"DATA",799.31,108,0)
STOPS
"DATA",799.31,109,0)
BEDSECTIONS
"DATA",799.31,110,0)
BEDSECTION
"DATA",799.31,111,0)
ITEM
"DATA",799.31,112,0)
STOP
"DATA",799.31,113,0)
CODE
"DATA",799.31,114,0)
STAYS
"DATA",799.31,115,0)
ND
"DATA",799.31,116,0)
NP
"DATA",799.31,117,0)
NSC
"DATA",799.31,118,0)
ALOS
"DATA",799.31,119,0)
MLOS
"DATA",799.31,120,0)
NV
"DATA",799.31,121,0)
DISPENSED
"DATA",799.31,122,0)
GENERIC
"DATA",799.31,123,0)
AIDS
"DATA",799.31,124,0)
ALL
"DATA",799.31,125,0)
OLD
"DATA",799.31,126,0)
OUTPATIENT
"DATA",799.31,127,0)
PTF
"DATA",799.31,128,0)
RANGE
"DATA",799.31,129,0)
ROWSPAN
"DATA",799.31,130,0)
TABLE
"DATA",799.31,131,0)
TYPE
"DATA",799.31,132,0)
USE
"DATA",799.31,133,0)
VARXCLS
"DATA",799.31,134,0)
VALUE
"DATA",799.31,135,0)
WIDTH
"DATA",799.31,136,0)
NDS
"DATA",799.31,137,0)
HIGHUTIL
"DATA",799.31,138,0)
DAYS
"DATA",799.31,139,0)
NOBS
"DATA",799.31,140,0)
HU_VISITS
"DATA",799.31,141,0)
HU_STAYS
"DATA",799.31,142,0)
HU_DAYS
"DATA",799.31,143,0)
NO
"DATA",799.31,144,0)
NR
"DATA",799.31,145,0)
NDT
"DATA",799.31,146,0)
MAXNRPP
"DATA",799.31,147,0)
ORDERS
"DATA",799.31,148,0)
VARDUMP
"DATA",799.31,149,0)
MAXNP
"DATA",799.31,150,0)
NC
"DATA",799.31,151,0)
DIAG
"DATA",799.31,152,0)
NDC
"DATA",799.31,153,0)
PTICDL
"DATA",799.31,154,0)
LAB
"DATA",799.31,155,0)
PHARMACY
"DATA",799.31,156,0)
DRUG
"DATA",799.31,157,0)
VARXCL
"DATA",799.31,158,0)
AIDSNOARV
"DATA",799.31,159,0)
ARVSMRY
"DATA",799.31,160,0)
PTLIST
"DATA",799.31,161,0)
COMPLEX
"DATA",799.31,162,0)
BASIC
"DATA",799.31,163,0)
PTLRL
"DATA",799.31,164,0)
PTRXL
"DATA",799.31,165,0)
RXCOMB
"DATA",799.31,166,0)
RXCOMBLST
"DATA",799.31,167,0)
TBLDEF
"DATA",799.31,168,0)
NST
"DATA",799.31,169,0)
NSS
"DATA",799.31,170,0)
NPR
"DATA",799.31,171,0)
NDP
"DATA",799.31,172,0)
FOOTER
"DATA",799.31,173,0)
INVESTIG
"DATA",799.31,174,0)
NPBASIC
"DATA",799.31,175,0)
NPCOMPLEX
"DATA",799.31,176,0)
NPARV
"DATA",799.31,177,0)
NPHIV
"DATA",799.31,178,0)
NPAIDS
"DATA",799.31,179,0)
FILLTYPE
"DATA",799.31,180,0)
ORDER
"DATA",799.31,181,0)
FILLS
"DATA",799.31,182,0)
DOSES
"DATA",799.31,183,0)
NF
"DATA",799.31,184,0)
HU_FILLS
"DATA",799.31,185,0)
HU_DOSES
"DATA",799.31,186,0)
NRX
"DATA",799.31,187,0)
NOTES
"DATA",799.31,188,0)
AGE_BASE_DATE
"DATA",799.31,189,0)
ROOM-BED
"DATA",799.31,190,0)
DAYSPLY
"DATA",799.31,191,0)
HU_STOPS
"DATA",799.31,192,0)
RESULTS
"DATA",799.31,193,0)
DRUGS_FILLS
"DATA",799.31,194,0)
DRUGS_DOSES
"DATA",799.31,195,0)
AIDS_SUMMARY
"DATA",799.31,196,0)
ALIVE_SUMMARY
"DATA",799.31,197,0)
ENTDT_SUMMARY
"DATA",799.31,198,0)
PRIMELIG_SUMMARY
"DATA",799.31,199,0)
ETHN
"DATA",799.31,200,0)
ETHN_SUMMARY
"DATA",799.31,201,0)
ETHNS
"DATA",799.31,202,0)
PENDING
"DATA",799.34,1,0)
List of Registry Patients^1^^1^^^^^1
"DATA",799.34,1,1)
10,20,32
"DATA",799.34,1,10.01)
$$REGPTLST^RORX001
"DATA",799.34,1,11,0)
^^2^2^3031209^
"DATA",799.34,1,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,1,11,2,0)
PATIENTS=ACTIVE
"DATA",799.34,1,12,0)
^^1^1^3031119^
"DATA",799.34,1,12,1,0)
PATIENTS=NAME
"DATA",799.34,2,0)
Current Inpatient List^1^^2^^^^^1
"DATA",799.34,2,1)
14
"DATA",799.34,2,10.01)
$$INPTLST^RORX002
"DATA",799.34,2,12,0)
^^1^1^3031119^
"DATA",799.34,2,12,1,0)
PATIENTS=NAME
"DATA",799.34,3,0)
General Utilization and Demographics^1^^3^^^^^1
"DATA",799.34,3,1)
10,22,24,62,30
"DATA",799.34,3,10.01)
$$UTLDMG^RORX003
"DATA",799.34,3,11,0)
^^3^3^3031209^
"DATA",799.34,3,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,3,11,2,0)
OPTIONS=COMPLETE
"DATA",799.34,3,11,3,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,HIV,AIDS
"DATA",799.34,3,12,0)
^^1^1^3031119^
"DATA",799.34,3,12,1,0)
PATIENTS=NAME
"DATA",799.34,4,0)
Clinic Follow Up^1^^4^^^^^1
"DATA",799.34,4,1)
10,22,24,60,110,80,50
"DATA",799.34,4,10.01)
$$CLNFLWUP^RORX004
"DATA",799.34,4,11,0)
^^4^4^3031209^
"DATA",799.34,4,11,1,0)
CLINICS=ALL
"DATA",799.34,4,11,2,0)
DATE_RANGE=YEAR
"DATA",799.34,4,11,3,0)
OPTIONS=SUMMARY
"DATA",799.34,4,11,4,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,HIV,AIDS,SEEN
"DATA",799.34,4,12,0)
^799.3412^1^1^3031119^^
"DATA",799.34,4,12,1,0)
PATIENTS=NAME
"DATA",799.34,5,0)
Inpatient and Outpatient Utilization^1^^5^^^^^1
"DATA",799.34,5,1)
10,22,24,170,26,110,46,34
"DATA",799.34,5,10.01)
$$IPOPUTL^RORX005
"DATA",799.34,5,11,0)
^^4^4^3031209^
"DATA",799.34,5,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,5,11,2,0)
DIVISIONS=ALL
"DATA",799.34,5,11,3,0)
MAXUTNUM=10
"DATA",799.34,5,11,4,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,INPATIENT,OUTPATIENT,AIDS,HIV
"DATA",799.34,5,12,0)
^^8^8^3031205^
"DATA",799.34,5,12,1,0)
BEDSECTIONS=NAME
"DATA",799.34,5,12,2,0)
CLINICS=STOP
"DATA",799.34,5,12,3,0)
HU_DAYS=ND:DESC 
"DATA",799.34,5,12,4,0)
HU_STAYS=NST:DESC
"DATA",799.34,5,12,5,0)
HU_STOPS=NSC:DESC
"DATA",799.34,5,12,6,0)
NOBS=NAME
"DATA",799.34,5,12,7,0)
STAYS=NST:DESC
"DATA",799.34,5,12,8,0)
STOPS=NSC:DESC
"DATA",799.34,6,0)
Lab Utilization^1^^6^^^^^1
"DATA",799.34,6,1)
10,22,24,110,120,52
"DATA",799.34,6,10.01)
$$LABUTL^RORX006
"DATA",799.34,6,11,0)
^799.3411^5^5^3040113^^^
"DATA",799.34,6,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,6,11,2,0)
LABTESTS=ALL
"DATA",799.34,6,11,3,0)
MAXUTNUM=10
"DATA",799.34,6,11,4,0)
MINRPNUM=1
"DATA",799.34,6,11,5,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,AIDS,HIV
"DATA",799.34,6,12,0)
^799.3412^3^3^3040113^^
"DATA",799.34,6,12,1,0)
LABTESTS=NAME
"DATA",799.34,6,12,2,0)
PATIENTS=NR:DESC
"DATA",799.34,6,12,3,0)
RESULTS=NR:DESC
"DATA",799.34,7,0)
Radiology Utilization^1^^7^^^^^1
"DATA",799.34,7,1)
10,22,24,110,120,100
"DATA",799.34,7,10.01)
$$RADUTL^RORX007
"DATA",799.34,7,11,0)
^799.3411^4^4^3040113^^^
"DATA",799.34,7,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,7,11,2,0)
MAXUTNUM=10
"DATA",799.34,7,11,3,0)
MINRPNUM=1
"DATA",799.34,7,11,4,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,AIDS,HIV
"DATA",799.34,7,12,0)
^799.3412^2^2^3040113^^
"DATA",799.34,7,12,1,0)
PATIENTS=TOTAL:DESC
"DATA",799.34,7,12,2,0)
PROCEDURES=NAME
"DATA",799.34,8,0)
VERA Reimbursement Report^1^^8^^^^^1
"DATA",799.34,8,1)
10,22,24,28,84,56,100
"DATA",799.34,8,10.01)
$$ARVREIMB^RORX008
"DATA",799.34,8,11,0)
^^3^3^3031209^
"DATA",799.34,8,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,8,11,2,0)
DRUGS=INVESTIG
"DATA",799.34,8,11,3,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,AIDS,HIV
"DATA",799.34,8,12,0)
^^2^2^3031120^
"DATA",799.34,8,12,1,0)
DRUGS=NAME
"DATA",799.34,8,12,2,0)
PATIENTS=NAME
"DATA",799.34,9,0)
Pharmacy Prescription Utilization^1^^9^^^^^1
"DATA",799.34,9,1)
10,22,24,170,26,110,46,84,44,40
"DATA",799.34,9,10.01)
$$RXUTIL^RORX009
"DATA",799.34,9,11,0)
^799.3411^5^5^3031209^^
"DATA",799.34,9,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,9,11,2,0)
DRUGS=GENERIC
"DATA",799.34,9,11,3,0)
MAXUTNUM=10
"DATA",799.34,9,11,4,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,AIDS,HIV,INPATIENT,OUTPATIENT
"DATA",799.34,9,11,5,0)
VADRUGCLS=ALL
"DATA",799.34,9,12,0)
^^2^2^3031209^
"DATA",799.34,9,12,1,0)
DRUGS=NAME
"DATA",799.34,9,12,2,0)
PATIENTS=NAME
"DATA",799.34,10,0)
HIV Viral Load and CD4 by Range^1^^10^^^^^1
"DATA",799.34,10,1)
10,24,48
"DATA",799.34,10,10.01)
$$VRLCD4^RORX010
"DATA",799.34,10,11,0)
^799.3411^4^4^3031209^
"DATA",799.34,10,11,1,0)
CD4OPT=1^0
"DATA",799.34,10,11,2,0)
DATE_RANGE=YEAR
"DATA",799.34,10,11,3,0)
PATIENTS=HIV,AIDS
"DATA",799.34,10,11,4,0)
VIRAL_LOAD=1^0
"DATA",799.34,10,12,0)
^^2^2^3031119^
"DATA",799.34,10,12,1,0)
PATIENTS=NAME
"DATA",799.34,10,12,2,0)
PTLRL=GROUP
"DATA",799.34,11,0)
Patient Drug History^1^^11^^^^^1
"DATA",799.34,11,1)
10,170,26,140,41
"DATA",799.34,11,10.01)
$$RXHIST^RORX011
"DATA",799.34,11,11,0)
^^3^3^3031209^
"DATA",799.34,11,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,11,11,2,0)
DRUGS=ALL
"DATA",799.34,11,11,3,0)
PATIENTS=INPATIENT,OUTPATIENT
"DATA",799.34,12,0)
Combined RX and Lab Report^1^^12^^^^^1
"DATA",799.34,12,1)
10,22,24,64,84,54,44,52,100
"DATA",799.34,12,10.01)
$$RXANDLAB^RORX012
"DATA",799.34,12,11,0)
^799.3411^5^5^3040608^^
"DATA",799.34,12,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,12,11,2,0)
DRUGS=GENERIC
"DATA",799.34,12,11,3,0)
LABTESTS=ALL
"DATA",799.34,12,11,4,0)
OPTIONS=LAB,PHARMACY
"DATA",799.34,12,11,5,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,HIV,AIDS
"DATA",799.34,12,12,0)
^799.3412^3^3^3040608^^^^
"DATA",799.34,12,12,1,0)
PATIENTS=NAME
"DATA",799.34,12,12,2,0)
PTLRL=DATE
"DATA",799.34,12,12,3,0)
PTRXL=NAME
"DATA",799.34,13,0)
Diagnosis Code Report^1^^13^^^^^1
"DATA",799.34,13,1)
10,22,24,62,58
"DATA",799.34,13,10.01)
$$ICD9LST^RORX013
"DATA",799.34,13,11,0)
^^4^4^3031209^
"DATA",799.34,13,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,13,11,2,0)
ICD9LST=ALL
"DATA",799.34,13,11,3,0)
OPTIONS=COMPLETE
"DATA",799.34,13,11,4,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,HIV,AIDS
"DATA",799.34,13,12,0)
^799.3412^3^3^3031119^^^
"DATA",799.34,13,12,1,0)
ICD9LST=CODE
"DATA",799.34,13,12,2,0)
PATIENTS=NAME
"DATA",799.34,13,12,3,0)
PTICDL=CODE
"DATA",799.34,14,0)
ARV Combination Report^1^^14^^^^^1
"DATA",799.34,14,1)
10,22,24,170,26,62,84,56,100
"DATA",799.34,14,10.01)
$$ARVCOMB^RORX014
"DATA",799.34,14,11,0)
^799.3411^3^3^3031209^^
"DATA",799.34,14,11,1,0)
DATE_RANGE=YEAR
"DATA",799.34,14,11,2,0)
OPTIONS=COMPLETE
"DATA",799.34,14,11,3,0)
PATIENTS=DE_BEFORE,DE_DURING,DE_AFTER,HIV,AIDS,INPATIENT,OUTPATIENT
"DATA",799.34,14,12,0)
^799.3412^3^3^3031209^^^
"DATA",799.34,14,12,1,0)
DRUGS=NAME
"DATA",799.34,14,12,2,0)
PATIENTS=NAME
"DATA",799.34,14,12,3,0)
RXCOMBLST=NP:DESC
"FIA",799.31)
ROR XML ITEM
"FIA",799.31,0)
^ROR(799.31,
"FIA",799.31,0,0)
799.31
"FIA",799.31,0,1)
n^n^f^^n^^y^o^n
"FIA",799.31,0,10)

"FIA",799.31,0,11)

"FIA",799.31,0,"RLRO")

"FIA",799.31,0,"VR")
1.0^ROR
"FIA",799.31,799.31)
0
"FIA",799.34)
ROR REPORT PARAMETERS
"FIA",799.34,0)
^ROR(799.34,
"FIA",799.34,0,0)
799.34I
"FIA",799.34,0,1)
n^n^f^^n^^y^o^n
"FIA",799.34,0,10)

"FIA",799.34,0,11)

"FIA",799.34,0,"RLRO")

"FIA",799.34,0,"VR")
1.0^ROR
"FIA",799.34,799.34)
0
"FIA",799.34,799.3411)
0
"FIA",799.34,799.3412)
0
"INIT")
POS^RORP006
"IX",799.34,799.34,"KEY",0)
799.34^KEY^Uniqueness Index for Key 'A' of File #799.34^R^^F^IR^I^799.34^^^^^LS
"IX",799.34,799.34,"KEY",1)
S ^ROR(799.34,"KEY",X,DA)=""
"IX",799.34,799.34,"KEY",2)
K ^ROR(799.34,"KEY",X,DA)
"IX",799.34,799.34,"KEY",2.5)
K ^ROR(799.34,"KEY")
"IX",799.34,799.34,"KEY",11.1,0)
^.114IA^1^1
"IX",799.34,799.34,"KEY",11.1,1,0)
1^F^799.34^.04^^1
"KEY",799.34,799.34,"A",0)
799.34^A^P^301
"KEY",799.34,799.34,"A",2,0)
^.312IA^1^1
"KEY",799.34,799.34,"A",2,1,0)
.04^799.34^1
"KEYPTR",799.34,799.34,"A")
799.34^KEY
"KRN",.4,2183,-1)
0^1
"KRN",.4,2183,0)
ROR LOG^3040608.1408^^798.7^^@^
"KRN",.4,2183,"%D",0)
^.4001^2^2^3040608^^^
"KRN",.4,2183,"%D",1,0)
This template is used by the [RORMNT PRINT LOGS] option to print 
"KRN",.4,2183,"%D",2,0)
messages from the log files.
"KRN",.4,2183,"DXS")
2
"KRN",.4,2183,"DXS",1,9)
X DXS(1,9.2) S X=X S Y=X,X=DIP(3),X=X S X=X_Y_")",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X)
"KRN",.4,2183,"DXS",1,9.2)
S DIP(1)=$S($D(^RORDATA(798.7,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,4),X=X S X=X'="",DIP(2)=$G(X) S X=" (",DIP(3)=$G(X) S X=$P(DIP(1),U,4)
"KRN",.4,2183,"F",1)
4,.01;S1;C1~4,1~4,3;"PATIENT NAME (DFN)"~4,X DXS(1,9) W X K DIP;X;Z;"$S(INTERNAL(PATIENT)'="":" ("_INTERNAL(PATIENT)_")",1:"")"~4,2;C4~4,4,.01;C4~
"KRN",.4,2183,"H")
CLINICAL REGISTRIES LOG FILE(S)
"KRN",.84,7981003.001,-1)
0^1
"KRN",.84,7981003.001,0)
7981003.001^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (HTML)
"KRN",.84,7981003.001,2,0)
^^313^313^3040607^
"KRN",.84,7981003.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981003.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981003.001,2,4,0)
>
"KRN",.84,7981003.001,2,5,0)
 
"KRN",.84,7981003.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981003.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981003.001,2,8,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->            
"KRN",.84,7981003.001,2,9,0)
 
"KRN",.84,7981003.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981003.001,2,11,0)
 <xsl:variable name="sum" select="/REPORT/SUMMARY"/>
"KRN",.84,7981003.001,2,12,0)
 <xsl:variable name="wide_summaries" 
"KRN",.84,7981003.001,2,13,0)
      select="$sum/RISK_FACTORS|$sum/RACE_SUMMARY|$sum/ETHN_SUMMARY|
"KRN",.84,7981003.001,2,14,0)
              $sum/UTIL_CODES|$sum/PRIMELIG_SUMMARY"/>
"KRN",.84,7981003.001,2,15,0)
 <xsl:variable name="narrow_summaries"
"KRN",.84,7981003.001,2,16,0)
      select="$sum/AGE_SUMMARY|$sum/SEX_SUMMARY|$sum/AIDS_SUMMARY|
"KRN",.84,7981003.001,2,17,0)
              $sum/REIMBLVL_SUMMARY|$sum/ENTDT_SUMMARY|$sum/ALIVE_SUMMARY"/>
"KRN",.84,7981003.001,2,18,0)
 <html>
"KRN",.84,7981003.001,2,19,0)
  <head>
"KRN",.84,7981003.001,2,20,0)
   <title>General Utilization and Demographics</title>
"KRN",.84,7981003.001,2,21,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981003.001,2,22,0)
  </head>
"KRN",.84,7981003.001,2,23,0)
  <body>
"KRN",.84,7981003.001,2,24,0)
   <h1>General Utilization and Demographics</h1>
"KRN",.84,7981003.001,2,25,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981003.001,2,26,0)
   <xsl:if test="/REPORT/PATIENTS/*[1]">
"KRN",.84,7981003.001,2,27,0)
    <div style="page-break-before:always">
"KRN",.84,7981003.001,2,28,0)
     <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.001,2,29,0)
    </div>
"KRN",.84,7981003.001,2,30,0)
   </xsl:if>
"KRN",.84,7981003.001,2,31,0)
   <xsl:if test="$sum/*[1]">
"KRN",.84,7981003.001,2,32,0)
    <div class="reportSummary">
"KRN",.84,7981003.001,2,33,0)
     <xsl:if test="$wide_summaries">
"KRN",.84,7981003.001,2,34,0)
      <div style="float:left; width:68%; margin-right:1%">
"KRN",.84,7981003.001,2,35,0)
       <xsl:apply-templates select="$wide_summaries"/>
"KRN",.84,7981003.001,2,36,0)
      </div>
"KRN",.84,7981003.001,2,37,0)
     </xsl:if>
"KRN",.84,7981003.001,2,38,0)
     <xsl:if test="$narrow_summaries">
"KRN",.84,7981003.001,2,39,0)
      <div style="float:left; width:30%">
"KRN",.84,7981003.001,2,40,0)
       <xsl:apply-templates select="$narrow_summaries"/>
"KRN",.84,7981003.001,2,41,0)
      </div>
"KRN",.84,7981003.001,2,42,0)
     </xsl:if>
"KRN",.84,7981003.001,2,43,0)
    </div>
"KRN",.84,7981003.001,2,44,0)
   </xsl:if>
"KRN",.84,7981003.001,2,45,0)
  </body>
"KRN",.84,7981003.001,2,46,0)
 </html>
"KRN",.84,7981003.001,2,47,0)
</xsl:template>
"KRN",.84,7981003.001,2,48,0)
 
"KRN",.84,7981003.001,2,49,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.001,2,50,0)
 
"KRN",.84,7981003.001,2,51,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.001,2,52,0)
 <xsl:param name="line" select="."/>
"KRN",.84,7981003.001,2,53,0)
 <td class="aLeft"><xsl:value-of select="$line"/></td>
"KRN",.84,7981003.001,2,54,0)
 <td>
"KRN",.84,7981003.001,2,55,0)
  <xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.001,2,56,0)
  <xsl:if test="$line/@COUNT=''">&#160;</xsl:if>
"KRN",.84,7981003.001,2,57,0)
 </td>
"KRN",.84,7981003.001,2,58,0)
</xsl:template>
"KRN",.84,7981003.001,2,59,0)
 
"KRN",.84,7981003.001,2,60,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.001,2,61,0)
 
"KRN",.84,7981003.001,2,62,0)
<xsl:template match="COLUMN[@NAME='REIMBLVL']">
"KRN",.84,7981003.001,2,63,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,64,0)
  <xsl:with-param name="title" select="'Reimbursement Level'"/>
"KRN",.84,7981003.001,2,65,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981003.001,2,66,0)
 </xsl:call-template>
"KRN",.84,7981003.001,2,67,0)
</xsl:template>
"KRN",.84,7981003.001,2,68,0)
 
"KRN",.84,7981003.001,2,69,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.001,2,70,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,71,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.001,2,72,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,73,0)
 </xsl:call-template>
"KRN",.84,7981003.001,2,74,0)
</xsl:template>
"KRN",.84,7981003.001,2,75,0)
 
"KRN",.84,7981003.001,2,76,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.001,2,77,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,78,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.001,2,79,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,80,0)
 </xsl:call-template>
"KRN",.84,7981003.001,2,81,0)
</xsl:template>
"KRN",.84,7981003.001,2,82,0)
 
"KRN",.84,7981003.001,2,83,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.001,2,84,0)
 
"KRN",.84,7981003.001,2,85,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.001,2,86,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,87,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,88,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,89,0)
   <caption>Age Summary</caption>
"KRN",.84,7981003.001,2,90,0)
   <thead>
"KRN",.84,7981003.001,2,91,0)
    <tr>
"KRN",.84,7981003.001,2,92,0)
     <th>Age</th>
"KRN",.84,7981003.001,2,93,0)
     <th width="30">Count<br/>(Value)</th>
"KRN",.84,7981003.001,2,94,0)
    </tr>
"KRN",.84,7981003.001,2,95,0)
   </thead>
"KRN",.84,7981003.001,2,96,0)
   <tbody>
"KRN",.84,7981003.001,2,97,0)
    <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.001,2,98,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,99,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,100,0)
   </tbody>
"KRN",.84,7981003.001,2,101,0)
  </table>
"KRN",.84,7981003.001,2,102,0)
 </xsl:if>
"KRN",.84,7981003.001,2,103,0)
</xsl:template>
"KRN",.84,7981003.001,2,104,0)
 
"KRN",.84,7981003.001,2,105,0)
<xsl:template match="SUMMARY/AIDS_SUMMARY">
"KRN",.84,7981003.001,2,106,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,107,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,108,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,109,0)
   <caption>AIDS OI Summary</caption>
"KRN",.84,7981003.001,2,110,0)
   <thead>
"KRN",.84,7981003.001,2,111,0)
    <tr>
"KRN",.84,7981003.001,2,112,0)
     <th>AIDS OI</th>
"KRN",.84,7981003.001,2,113,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,114,0)
    </tr>
"KRN",.84,7981003.001,2,115,0)
   </thead>
"KRN",.84,7981003.001,2,116,0)
   <tbody>
"KRN",.84,7981003.001,2,117,0)
    <xsl:for-each select="$summary/AIDS">
"KRN",.84,7981003.001,2,118,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,119,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,120,0)
   </tbody>
"KRN",.84,7981003.001,2,121,0)
  </table>
"KRN",.84,7981003.001,2,122,0)
 </xsl:if>
"KRN",.84,7981003.001,2,123,0)
</xsl:template>
"KRN",.84,7981003.001,2,124,0)
 
"KRN",.84,7981003.001,2,125,0)
<xsl:template match="SUMMARY/ALIVE_SUMMARY">
"KRN",.84,7981003.001,2,126,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,127,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,128,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,129,0)
   <caption>Alive Summary</caption>
"KRN",.84,7981003.001,2,130,0)
   <thead>
"KRN",.84,7981003.001,2,131,0)
    <tr>
"KRN",.84,7981003.001,2,132,0)
     <th>Alive</th>
"KRN",.84,7981003.001,2,133,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,134,0)
    </tr>
"KRN",.84,7981003.001,2,135,0)
   </thead>
"KRN",.84,7981003.001,2,136,0)
   <tbody>
"KRN",.84,7981003.001,2,137,0)
    <xsl:for-each select="$summary/ALIVE">
"KRN",.84,7981003.001,2,138,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,139,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,140,0)
   </tbody>
"KRN",.84,7981003.001,2,141,0)
  </table>
"KRN",.84,7981003.001,2,142,0)
 </xsl:if>
"KRN",.84,7981003.001,2,143,0)
</xsl:template>
"KRN",.84,7981003.001,2,144,0)
 
"KRN",.84,7981003.001,2,145,0)
<xsl:template match="SUMMARY/ENTDT_SUMMARY">
"KRN",.84,7981003.001,2,146,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,147,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,148,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,149,0)
   <caption>Date Entered Summary</caption>
"KRN",.84,7981003.001,2,150,0)
   <thead>
"KRN",.84,7981003.001,2,151,0)
    <tr>
"KRN",.84,7981003.001,2,152,0)
     <th>Date Entered</th>
"KRN",.84,7981003.001,2,153,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,154,0)
    </tr>
"KRN",.84,7981003.001,2,155,0)
   </thead>
"KRN",.84,7981003.001,2,156,0)
   <tbody>
"KRN",.84,7981003.001,2,157,0)
    <xsl:for-each select="$summary/ENTDT">
"KRN",.84,7981003.001,2,158,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,159,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,160,0)
   </tbody>
"KRN",.84,7981003.001,2,161,0)
  </table>
"KRN",.84,7981003.001,2,162,0)
 </xsl:if>
"KRN",.84,7981003.001,2,163,0)
</xsl:template>
"KRN",.84,7981003.001,2,164,0)
 
"KRN",.84,7981003.001,2,165,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.001,2,166,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,167,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,168,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,169,0)
   <caption>Ethnicity Summary</caption>
"KRN",.84,7981003.001,2,170,0)
   <thead>
"KRN",.84,7981003.001,2,171,0)
    <tr>
"KRN",.84,7981003.001,2,172,0)
     <th>Ethnicity</th>
"KRN",.84,7981003.001,2,173,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,174,0)
    </tr>
"KRN",.84,7981003.001,2,175,0)
   </thead>
"KRN",.84,7981003.001,2,176,0)
   <tbody>
"KRN",.84,7981003.001,2,177,0)
    <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.001,2,178,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,179,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,180,0)
   </tbody>
"KRN",.84,7981003.001,2,181,0)
  </table>
"KRN",.84,7981003.001,2,182,0)
 </xsl:if>
"KRN",.84,7981003.001,2,183,0)
</xsl:template>
"KRN",.84,7981003.001,2,184,0)
 
"KRN",.84,7981003.001,2,185,0)
<xsl:template match="SUMMARY/PRIMELIG_SUMMARY">
"KRN",.84,7981003.001,2,186,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,187,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,188,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,189,0)
   <caption>Primary Eligibility Summary</caption>
"KRN",.84,7981003.001,2,190,0)
   <thead>
"KRN",.84,7981003.001,2,191,0)
    <tr>
"KRN",.84,7981003.001,2,192,0)
     <th>Primary Eligibility</th>
"KRN",.84,7981003.001,2,193,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,194,0)
    </tr>
"KRN",.84,7981003.001,2,195,0)
   </thead>
"KRN",.84,7981003.001,2,196,0)
   <tbody>
"KRN",.84,7981003.001,2,197,0)
    <xsl:for-each select="$summary/PRIMELIG">
"KRN",.84,7981003.001,2,198,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,199,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,200,0)
   </tbody>
"KRN",.84,7981003.001,2,201,0)
  </table>
"KRN",.84,7981003.001,2,202,0)
 </xsl:if>
"KRN",.84,7981003.001,2,203,0)
</xsl:template>
"KRN",.84,7981003.001,2,204,0)
 
"KRN",.84,7981003.001,2,205,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.001,2,206,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,207,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,208,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,209,0)
   <caption>Race Summary</caption>
"KRN",.84,7981003.001,2,210,0)
   <thead>
"KRN",.84,7981003.001,2,211,0)
    <tr>
"KRN",.84,7981003.001,2,212,0)
     <th>Race</th>
"KRN",.84,7981003.001,2,213,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,214,0)
    </tr>
"KRN",.84,7981003.001,2,215,0)
   </thead>
"KRN",.84,7981003.001,2,216,0)
   <tbody>
"KRN",.84,7981003.001,2,217,0)
    <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.001,2,218,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,219,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,220,0)
   </tbody>
"KRN",.84,7981003.001,2,221,0)
  </table>
"KRN",.84,7981003.001,2,222,0)
 </xsl:if>
"KRN",.84,7981003.001,2,223,0)
</xsl:template>
"KRN",.84,7981003.001,2,224,0)
 
"KRN",.84,7981003.001,2,225,0)
<xsl:template match="SUMMARY/REIMBLVL_SUMMARY">
"KRN",.84,7981003.001,2,226,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,227,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,228,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,229,0)
   <caption>Reimbursement Level Summary</caption>
"KRN",.84,7981003.001,2,230,0)
   <thead>
"KRN",.84,7981003.001,2,231,0)
    <tr>
"KRN",.84,7981003.001,2,232,0)
     <th>Level</th>
"KRN",.84,7981003.001,2,233,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,234,0)
    </tr>
"KRN",.84,7981003.001,2,235,0)
   </thead>
"KRN",.84,7981003.001,2,236,0)
   <tbody>
"KRN",.84,7981003.001,2,237,0)
    <xsl:for-each select="$summary/REIMBLVL">
"KRN",.84,7981003.001,2,238,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,239,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,240,0)
   </tbody>
"KRN",.84,7981003.001,2,241,0)
  </table>
"KRN",.84,7981003.001,2,242,0)
 </xsl:if>
"KRN",.84,7981003.001,2,243,0)
</xsl:template>
"KRN",.84,7981003.001,2,244,0)
 
"KRN",.84,7981003.001,2,245,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.001,2,246,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,247,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,248,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,249,0)
   <caption>Risk Factors</caption>
"KRN",.84,7981003.001,2,250,0)
   <thead>
"KRN",.84,7981003.001,2,251,0)
    <tr>
"KRN",.84,7981003.001,2,252,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,253,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,254,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,255,0)
    </tr>
"KRN",.84,7981003.001,2,256,0)
   </thead>
"KRN",.84,7981003.001,2,257,0)
   <tbody>
"KRN",.84,7981003.001,2,258,0)
    <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.001,2,259,0)
     <tr>
"KRN",.84,7981003.001,2,260,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,261,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,262,0)
     </tr>
"KRN",.84,7981003.001,2,263,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,264,0)
   </tbody>
"KRN",.84,7981003.001,2,265,0)
  </table>
"KRN",.84,7981003.001,2,266,0)
 </xsl:if>
"KRN",.84,7981003.001,2,267,0)
</xsl:template>
"KRN",.84,7981003.001,2,268,0)
 
"KRN",.84,7981003.001,2,269,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.001,2,270,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,271,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,272,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,273,0)
   <caption>Sex Summary</caption>
"KRN",.84,7981003.001,2,274,0)
   <thead>
"KRN",.84,7981003.001,2,275,0)
    <tr>
"KRN",.84,7981003.001,2,276,0)
     <th>Sex</th>
"KRN",.84,7981003.001,2,277,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,278,0)
    </tr>
"KRN",.84,7981003.001,2,279,0)
   </thead>
"KRN",.84,7981003.001,2,280,0)
   <tbody>
"KRN",.84,7981003.001,2,281,0)
    <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.001,2,282,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,283,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,284,0)
   </tbody>
"KRN",.84,7981003.001,2,285,0)
  </table>
"KRN",.84,7981003.001,2,286,0)
 </xsl:if>
"KRN",.84,7981003.001,2,287,0)
</xsl:template>
"KRN",.84,7981003.001,2,288,0)
 
"KRN",.84,7981003.001,2,289,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.001,2,290,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,291,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,292,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,293,0)
   <caption>Utilization</caption>
"KRN",.84,7981003.001,2,294,0)
   <thead>
"KRN",.84,7981003.001,2,295,0)
    <tr>
"KRN",.84,7981003.001,2,296,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,297,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,298,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,299,0)
    </tr>
"KRN",.84,7981003.001,2,300,0)
   </thead>
"KRN",.84,7981003.001,2,301,0)
   <tbody>
"KRN",.84,7981003.001,2,302,0)
    <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.001,2,303,0)
     <tr>
"KRN",.84,7981003.001,2,304,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,305,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,306,0)
     </tr>
"KRN",.84,7981003.001,2,307,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,308,0)
   </tbody>
"KRN",.84,7981003.001,2,309,0)
  </table>
"KRN",.84,7981003.001,2,310,0)
 </xsl:if>
"KRN",.84,7981003.001,2,311,0)
</xsl:template>
"KRN",.84,7981003.001,2,312,0)
 
"KRN",.84,7981003.001,2,313,0)
</xsl:stylesheet>
"KRN",.84,7981003.002,-1)
0^2
"KRN",.84,7981003.002,0)
7981003.002^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (CSV)
"KRN",.84,7981003.002,2,0)
^^205^205^3040607^
"KRN",.84,7981003.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981003.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981003.002,2,4,0)
>
"KRN",.84,7981003.002,2,5,0)
 
"KRN",.84,7981003.002,2,6,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981003.002,2,7,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981003.002,2,8,0)
 
"KRN",.84,7981003.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981003.002,2,10,0)
 <xsl:text>General Utilization and Demographics (Patients)</xsl:text>
"KRN",.84,7981003.002,2,11,0)
 <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.002,2,12,0)
 <xsl:value-of select="$FILESWITCH"/>
"KRN",.84,7981003.002,2,13,0)
 <xsl:text>General Utilization and Demographics (Summary)</xsl:text>
"KRN",.84,7981003.002,2,14,0)
 <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981003.002,2,15,0)
</xsl:template>
"KRN",.84,7981003.002,2,16,0)
 
"KRN",.84,7981003.002,2,17,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.002,2,18,0)
 
"KRN",.84,7981003.002,2,19,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.002,2,20,0)
 <xsl:param name="line" select="."/>
"KRN",.84,7981003.002,2,21,0)
 <xsl:value-of select="$line/@ID"/>
"KRN",.84,7981003.002,2,22,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,23,0)
 <xsl:value-of select="$line"/>
"KRN",.84,7981003.002,2,24,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,25,0)
 <xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.002,2,26,0)
 <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,27,0)
</xsl:template>
"KRN",.84,7981003.002,2,28,0)
 
"KRN",.84,7981003.002,2,29,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.002,2,30,0)
 
"KRN",.84,7981003.002,2,31,0)
<xsl:template match="COLUMN[@NAME='REIMBLVL']">
"KRN",.84,7981003.002,2,32,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,33,0)
  <xsl:with-param name="title" select="'Reimbursement Level'"/>
"KRN",.84,7981003.002,2,34,0)
 </xsl:call-template>
"KRN",.84,7981003.002,2,35,0)
</xsl:template>
"KRN",.84,7981003.002,2,36,0)
 
"KRN",.84,7981003.002,2,37,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.002,2,38,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,39,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.002,2,40,0)
 </xsl:call-template>
"KRN",.84,7981003.002,2,41,0)
</xsl:template>
"KRN",.84,7981003.002,2,42,0)
 
"KRN",.84,7981003.002,2,43,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.002,2,44,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,45,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.002,2,46,0)
 </xsl:call-template>
"KRN",.84,7981003.002,2,47,0)
</xsl:template>
"KRN",.84,7981003.002,2,48,0)
 
"KRN",.84,7981003.002,2,49,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.002,2,50,0)
 
"KRN",.84,7981003.002,2,51,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.002,2,52,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,53,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,54,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,55,0)
  <xsl:text>[Age Summary]</xsl:text>
"KRN",.84,7981003.002,2,56,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,57,0)
  <xsl:text>,Age,Count (Value)</xsl:text>
"KRN",.84,7981003.002,2,58,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,59,0)
  <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.002,2,60,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,61,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,62,0)
 </xsl:if>
"KRN",.84,7981003.002,2,63,0)
</xsl:template>
"KRN",.84,7981003.002,2,64,0)
 
"KRN",.84,7981003.002,2,65,0)
<xsl:template match="SUMMARY/AIDS_SUMMARY">
"KRN",.84,7981003.002,2,66,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,67,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,68,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,69,0)
  <xsl:text>[AIDS OI Summary]</xsl:text>
"KRN",.84,7981003.002,2,70,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,71,0)
  <xsl:text>,AIDS OI,Count</xsl:text>
"KRN",.84,7981003.002,2,72,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,73,0)
  <xsl:for-each select="$summary/AIDS">
"KRN",.84,7981003.002,2,74,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,75,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,76,0)
 </xsl:if>
"KRN",.84,7981003.002,2,77,0)
</xsl:template>
"KRN",.84,7981003.002,2,78,0)
 
"KRN",.84,7981003.002,2,79,0)
<xsl:template match="SUMMARY/ALIVE_SUMMARY">
"KRN",.84,7981003.002,2,80,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,81,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,82,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,83,0)
  <xsl:text>[Alive Summary]</xsl:text>
"KRN",.84,7981003.002,2,84,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,85,0)
  <xsl:text>,Alive,Count</xsl:text>
"KRN",.84,7981003.002,2,86,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,87,0)
  <xsl:for-each select="$summary/ALIVE">
"KRN",.84,7981003.002,2,88,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,89,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,90,0)
 </xsl:if>
"KRN",.84,7981003.002,2,91,0)
</xsl:template>
"KRN",.84,7981003.002,2,92,0)
 
"KRN",.84,7981003.002,2,93,0)
<xsl:template match="SUMMARY/ENTDT_SUMMARY">
"KRN",.84,7981003.002,2,94,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,95,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,96,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,97,0)
  <xsl:text>[Date Entered Summary]</xsl:text>
"KRN",.84,7981003.002,2,98,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,99,0)
  <xsl:text>,Date Entered,Count</xsl:text>
"KRN",.84,7981003.002,2,100,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,101,0)
  <xsl:for-each select="$summary/ENTDT">
"KRN",.84,7981003.002,2,102,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,103,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,104,0)
 </xsl:if>
"KRN",.84,7981003.002,2,105,0)
</xsl:template>
"KRN",.84,7981003.002,2,106,0)
 
"KRN",.84,7981003.002,2,107,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.002,2,108,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,109,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,110,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,111,0)
  <xsl:text>[Ethnicity Summary]</xsl:text>
"KRN",.84,7981003.002,2,112,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,113,0)
  <xsl:text>,Ethnicity,Count</xsl:text>
"KRN",.84,7981003.002,2,114,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,115,0)
  <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.002,2,116,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,117,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,118,0)
 </xsl:if>
"KRN",.84,7981003.002,2,119,0)
</xsl:template>
"KRN",.84,7981003.002,2,120,0)
 
"KRN",.84,7981003.002,2,121,0)
<xsl:template match="SUMMARY/PRIMELIG_SUMMARY">
"KRN",.84,7981003.002,2,122,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,123,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,124,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,125,0)
  <xsl:text>[Primary Eligibility Summary]</xsl:text>
"KRN",.84,7981003.002,2,126,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,127,0)
  <xsl:text>,Primary Eligibility,Count</xsl:text>
"KRN",.84,7981003.002,2,128,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,129,0)
  <xsl:for-each select="$summary/PRIMELIG">
"KRN",.84,7981003.002,2,130,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,131,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,132,0)
 </xsl:if>
"KRN",.84,7981003.002,2,133,0)
</xsl:template>
"KRN",.84,7981003.002,2,134,0)
 
"KRN",.84,7981003.002,2,135,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.002,2,136,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,137,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,138,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,139,0)
  <xsl:text>[Race Summary]</xsl:text>
"KRN",.84,7981003.002,2,140,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,141,0)
  <xsl:text>,Race,Count</xsl:text>
"KRN",.84,7981003.002,2,142,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,143,0)
  <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.002,2,144,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,145,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,146,0)
 </xsl:if>
"KRN",.84,7981003.002,2,147,0)
</xsl:template>
"KRN",.84,7981003.002,2,148,0)
 
"KRN",.84,7981003.002,2,149,0)
<xsl:template match="SUMMARY/REIMBLVL_SUMMARY">
"KRN",.84,7981003.002,2,150,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,151,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,152,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,153,0)
  <xsl:text>[Reimbursement Level Summary]</xsl:text>
"KRN",.84,7981003.002,2,154,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,155,0)
  <xsl:text>,Level,Count</xsl:text>
"KRN",.84,7981003.002,2,156,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,157,0)
  <xsl:for-each select="$summary/REIMBLVL">
"KRN",.84,7981003.002,2,158,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,159,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,160,0)
 </xsl:if>
"KRN",.84,7981003.002,2,161,0)
</xsl:template>
"KRN",.84,7981003.002,2,162,0)
 
"KRN",.84,7981003.002,2,163,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.002,2,164,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,165,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,166,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,167,0)
  <xsl:text>[Risk Factors]</xsl:text>
"KRN",.84,7981003.002,2,168,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,169,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,170,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,171,0)
  <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.002,2,172,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,173,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,174,0)
 </xsl:if>
"KRN",.84,7981003.002,2,175,0)
</xsl:template>
"KRN",.84,7981003.002,2,176,0)
 
"KRN",.84,7981003.002,2,177,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.002,2,178,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,179,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,180,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,181,0)
  <xsl:text>[Sex Summary]</xsl:text>
"KRN",.84,7981003.002,2,182,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,183,0)
  <xsl:text>,Sex,Count</xsl:text>
"KRN",.84,7981003.002,2,184,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,185,0)
  <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.002,2,186,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,187,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,188,0)
 </xsl:if>
"KRN",.84,7981003.002,2,189,0)
</xsl:template>
"KRN",.84,7981003.002,2,190,0)
 
"KRN",.84,7981003.002,2,191,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.002,2,192,0)
 <xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,193,0)
 <xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,194,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,195,0)
  <xsl:text>[Utilization]</xsl:text>
"KRN",.84,7981003.002,2,196,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,197,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,198,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,199,0)
  <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.002,2,200,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,201,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,202,0)
 </xsl:if>
"KRN",.84,7981003.002,2,203,0)
</xsl:template>
"KRN",.84,7981003.002,2,204,0)
 
"KRN",.84,7981003.002,2,205,0)
</xsl:stylesheet>
"KRN",.84,7981997.001,-1)
0^3
"KRN",.84,7981997.001,0)
7981997.001^2^^CLINICAL CASE REGISTRIES^Patient data templates (HTML)
"KRN",.84,7981997.001,2,0)
^^219^219^3040311^
"KRN",.84,7981997.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981997.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.001,2,4,0)
 
"KRN",.84,7981997.001,2,5,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.001,2,6,0)
 
"KRN",.84,7981997.001,2,7,0)
<xsl:template name="BasicPatientHeader">
"KRN",.84,7981997.001,2,8,0)
 <xsl:param name="claids" select="1"/>
"KRN",.84,7981997.001,2,9,0)
 <xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,10,0)
 <xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,11,0)
 <xsl:param name="tblname" select="'PATIENTS'"/>
"KRN",.84,7981997.001,2,12,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,13,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,14,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,15,0)
   <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,16,0)
   <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981997.001,2,17,0)
   <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981997.001,2,18,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,19,0)
 </xsl:if>
"KRN",.84,7981997.001,2,20,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,21,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,22,0)
  <xsl:with-param name="sort" select="concat($tblname,'=NAME')"/>
"KRN",.84,7981997.001,2,23,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981997.001,2,24,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,25,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,26,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,27,0)
  <xsl:with-param name="sort" select="concat($tblname,'=LAST4')"/>
"KRN",.84,7981997.001,2,28,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981997.001,2,29,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,30,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,31,0)
 <xsl:if test="$claids">
"KRN",.84,7981997.001,2,32,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,33,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,34,0)
   <xsl:with-param name="sort" select="concat($tblname,'=AIDSTAT')"/>
"KRN",.84,7981997.001,2,35,0)
   <xsl:with-param name="title" select="'AIDS&#160;OI'"/>
"KRN",.84,7981997.001,2,36,0)
   <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,37,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,38,0)
 </xsl:if>
"KRN",.84,7981997.001,2,39,0)
</xsl:template>
"KRN",.84,7981997.001,2,40,0)
 
"KRN",.84,7981997.001,2,41,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.001,2,42,0)
 <xsl:param name="claids" select="1"/>
"KRN",.84,7981997.001,2,43,0)
 <xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,44,0)
 <xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,45,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,46,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,47,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,48,0)
   <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981997.001,2,49,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,50,0)
 </xsl:if>
"KRN",.84,7981997.001,2,51,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,52,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,53,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981997.001,2,54,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,55,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,56,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,57,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,58,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981997.001,2,59,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,60,0)
 <xsl:if test="$claids">
"KRN",.84,7981997.001,2,61,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,62,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,63,0)
   <xsl:with-param name="value" select="AIDSTAT"/>
"KRN",.84,7981997.001,2,64,0)
   <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981997.001,2,65,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,66,0)
 </xsl:if>
"KRN",.84,7981997.001,2,67,0)
</xsl:template>
"KRN",.84,7981997.001,2,68,0)
 
"KRN",.84,7981997.001,2,69,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.001,2,70,0)
 
"KRN",.84,7981997.001,2,71,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.001,2,72,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,73,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,74,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,75,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.001,2,76,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,77,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,78,0)
</xsl:template>
"KRN",.84,7981997.001,2,79,0)
 
"KRN",.84,7981997.001,2,80,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.001,2,81,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,82,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,83,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,84,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.001,2,85,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,86,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,87,0)
</xsl:template>
"KRN",.84,7981997.001,2,88,0)
 
"KRN",.84,7981997.001,2,89,0)
<xsl:template match="COLUMN[@NAME='ALIVE']">
"KRN",.84,7981997.001,2,90,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,91,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,92,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,93,0)
  <xsl:with-param name="title" select="'Alive?'"/>                 
"KRN",.84,7981997.001,2,94,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,95,0)
</xsl:template>
"KRN",.84,7981997.001,2,96,0)
 
"KRN",.84,7981997.001,2,97,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.001,2,98,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,99,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,100,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,101,0)
  <xsl:with-param name="title" select="'Coded SSN'"/>                      
"KRN",.84,7981997.001,2,102,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,103,0)
</xsl:template>
"KRN",.84,7981997.001,2,104,0)
 
"KRN",.84,7981997.001,2,105,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.001,2,106,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,107,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,108,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,109,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>                  
"KRN",.84,7981997.001,2,110,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,111,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,112,0)
</xsl:template>
"KRN",.84,7981997.001,2,113,0)
 
"KRN",.84,7981997.001,2,114,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.001,2,115,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,116,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,117,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,118,0)
   <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.001,2,119,0)
  <xsl:with-param name="sort" select="'PATIENTS=ENTDT:DESC'"/>                      
"KRN",.84,7981997.001,2,120,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,121,0)
</xsl:template>
"KRN",.84,7981997.001,2,122,0)
 
"KRN",.84,7981997.001,2,123,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.001,2,124,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,125,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,126,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,127,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.001,2,128,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,129,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,130,0)
</xsl:template>
"KRN",.84,7981997.001,2,131,0)
 
"KRN",.84,7981997.001,2,132,0)
<xsl:template match="COLUMN[@NAME='PRIMELIG']">
"KRN",.84,7981997.001,2,133,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,134,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,135,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,136,0)
  <xsl:with-param name="title" select="'Primary Eligibility'"/>
"KRN",.84,7981997.001,2,137,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,138,0)
</xsl:template>
"KRN",.84,7981997.001,2,139,0)
 
"KRN",.84,7981997.001,2,140,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.001,2,141,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,142,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,143,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,144,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.001,2,145,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,146,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,147,0)
</xsl:template>
"KRN",.84,7981997.001,2,148,0)
 
"KRN",.84,7981997.001,2,149,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.001,2,150,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,151,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,152,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,153,0)
  <xsl:with-param name="title" select="'Sex'"/>                 
"KRN",.84,7981997.001,2,154,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,155,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,156,0)
</xsl:template>
"KRN",.84,7981997.001,2,157,0)
 
"KRN",.84,7981997.001,2,158,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.001,2,159,0)
 
"KRN",.84,7981997.001,2,160,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.001,2,161,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,162,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,163,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,164,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,165,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,166,0)
</xsl:template>
"KRN",.84,7981997.001,2,167,0)
 
"KRN",.84,7981997.001,2,168,0)
<xsl:template match="PATIENT/ALIVE">
"KRN",.84,7981997.001,2,169,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,170,0)
 <xsl:choose>
"KRN",.84,7981997.001,2,171,0)
  <xsl:when test=".!=''">
"KRN",.84,7981997.001,2,172,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,173,0)
    <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,174,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,175,0)
   </xsl:call-template>
"KRN",.84,7981997.001,2,176,0)
  </xsl:when>
"KRN",.84,7981997.001,2,177,0)
  <xsl:otherwise>
"KRN",.84,7981997.001,2,178,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,179,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,180,0)
    <xsl:with-param name="value" select="'Yes'"/>
"KRN",.84,7981997.001,2,181,0)
   </xsl:call-template>
"KRN",.84,7981997.001,2,182,0)
  </xsl:otherwise>
"KRN",.84,7981997.001,2,183,0)
 </xsl:choose>
"KRN",.84,7981997.001,2,184,0)
</xsl:template>
"KRN",.84,7981997.001,2,185,0)
 
"KRN",.84,7981997.001,2,186,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.001,2,187,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,188,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,189,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,190,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,191,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,192,0)
</xsl:template>
"KRN",.84,7981997.001,2,193,0)
 
"KRN",.84,7981997.001,2,194,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981997.001,2,195,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,196,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,197,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,198,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,199,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,200,0)
</xsl:template>
"KRN",.84,7981997.001,2,201,0)
 
"KRN",.84,7981997.001,2,202,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.001,2,203,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,204,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,205,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,206,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,207,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,208,0)
</xsl:template>
"KRN",.84,7981997.001,2,209,0)
 
"KRN",.84,7981997.001,2,210,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.001,2,211,0)
 <td class="aLeft">
"KRN",.84,7981997.001,2,212,0)
  <xsl:for-each select="RACE">
"KRN",.84,7981997.001,2,213,0)
   <xsl:value-of select="."/>
"KRN",.84,7981997.001,2,214,0)
   <xsl:if test=".=''"><xsl:text>&#160;</xsl:text></xsl:if><br/>
"KRN",.84,7981997.001,2,215,0)
  </xsl:for-each>
"KRN",.84,7981997.001,2,216,0)
 </td>
"KRN",.84,7981997.001,2,217,0)
</xsl:template>
"KRN",.84,7981997.001,2,218,0)
 
"KRN",.84,7981997.001,2,219,0)
</xsl:stylesheet>
"KRN",.84,7981997.002,-1)
0^4
"KRN",.84,7981997.002,0)
7981997.002^2^^CLINICAL CASE REGISTRIES^Patient data templates (CSV)
"KRN",.84,7981997.002,2,0)
^^190^190^3040311^
"KRN",.84,7981997.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.002,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981997.002,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.002,2,4,0)
 
"KRN",.84,7981997.002,2,5,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.002,2,6,0)
 
"KRN",.84,7981997.002,2,7,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.002,2,8,0)
 <xsl:param name="claids" select="1"/>
"KRN",.84,7981997.002,2,9,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,10,0)
  <xsl:with-param name="value" select="../NAME"/>
"KRN",.84,7981997.002,2,11,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,12,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,13,0)
  <xsl:with-param name="value" select="../LAST4"/>
"KRN",.84,7981997.002,2,14,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,15,0)
 <xsl:if test="$claids">
"KRN",.84,7981997.002,2,16,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,17,0)
   <xsl:with-param name="value" select="../AIDSTAT"/>
"KRN",.84,7981997.002,2,18,0)
   <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981997.002,2,19,0)
  </xsl:call-template>
"KRN",.84,7981997.002,2,20,0)
 </xsl:if>
"KRN",.84,7981997.002,2,21,0)
</xsl:template>
"KRN",.84,7981997.002,2,22,0)
 
"KRN",.84,7981997.002,2,23,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.002,2,24,0)
 
"KRN",.84,7981997.002,2,25,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.002,2,26,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,27,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.002,2,28,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,29,0)
</xsl:template>
"KRN",.84,7981997.002,2,30,0)
 
"KRN",.84,7981997.002,2,31,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.002,2,32,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,33,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.002,2,34,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,35,0)
</xsl:template>
"KRN",.84,7981997.002,2,36,0)
 
"KRN",.84,7981997.002,2,37,0)
<xsl:template match="COLUMN[@NAME='ALIVE']">
"KRN",.84,7981997.002,2,38,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,39,0)
  <xsl:with-param name="title" select="'Alive?'"/>                 
"KRN",.84,7981997.002,2,40,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,41,0)
</xsl:template>
"KRN",.84,7981997.002,2,42,0)
 
"KRN",.84,7981997.002,2,43,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.002,2,44,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,45,0)
  <xsl:with-param name="title" select="'Coded SSN'"/>                      
"KRN",.84,7981997.002,2,46,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,47,0)
</xsl:template>
"KRN",.84,7981997.002,2,48,0)
 
"KRN",.84,7981997.002,2,49,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.002,2,50,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,51,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>                  
"KRN",.84,7981997.002,2,52,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,53,0)
</xsl:template>
"KRN",.84,7981997.002,2,54,0)
 
"KRN",.84,7981997.002,2,55,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.002,2,56,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,57,0)
  <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.002,2,58,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,59,0)
</xsl:template>
"KRN",.84,7981997.002,2,60,0)
 
"KRN",.84,7981997.002,2,61,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.002,2,62,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,63,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.002,2,64,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,65,0)
</xsl:template>
"KRN",.84,7981997.002,2,66,0)
 
"KRN",.84,7981997.002,2,67,0)
<xsl:template match="COLUMN[@NAME='INADT']">
"KRN",.84,7981997.002,2,68,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,69,0)
  <xsl:with-param name="title" select="'Inactivation Date'"/>
"KRN",.84,7981997.002,2,70,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,71,0)
</xsl:template>
"KRN",.84,7981997.002,2,72,0)
 
"KRN",.84,7981997.002,2,73,0)
<xsl:template match="COLUMN[@NAME='INARSN']">
"KRN",.84,7981997.002,2,74,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,75,0)
  <xsl:with-param name="title" select="'Inactivation Reason'"/>                 
"KRN",.84,7981997.002,2,76,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,77,0)
</xsl:template>
"KRN",.84,7981997.002,2,78,0)
 
"KRN",.84,7981997.002,2,79,0)
<xsl:template match="COLUMN[@NAME='PRIMELIG']">
"KRN",.84,7981997.002,2,80,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,81,0)
  <xsl:with-param name="title" select="'Primary Eligibility'"/>
"KRN",.84,7981997.002,2,82,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,83,0)
</xsl:template>
"KRN",.84,7981997.002,2,84,0)
 
"KRN",.84,7981997.002,2,85,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.002,2,86,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,87,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.002,2,88,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,89,0)
</xsl:template>
"KRN",.84,7981997.002,2,90,0)
 
"KRN",.84,7981997.002,2,91,0)
<xsl:template match="COLUMN[@NAME='READT']">
"KRN",.84,7981997.002,2,92,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,93,0)
  <xsl:with-param name="title" select="'Reactivation Date'"/>              
"KRN",.84,7981997.002,2,94,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,95,0)
</xsl:template>
"KRN",.84,7981997.002,2,96,0)
 
"KRN",.84,7981997.002,2,97,0)
<xsl:template match="COLUMN[@NAME='SELRULES']">
"KRN",.84,7981997.002,2,98,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,99,0)
  <xsl:with-param name="title" select="'Reasons'"/>
"KRN",.84,7981997.002,2,100,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,101,0)
</xsl:template>
"KRN",.84,7981997.002,2,102,0)
 
"KRN",.84,7981997.002,2,103,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.002,2,104,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,105,0)
  <xsl:with-param name="title" select="'Sex'"/>                 
"KRN",.84,7981997.002,2,106,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,107,0)
</xsl:template>
"KRN",.84,7981997.002,2,108,0)
 
"KRN",.84,7981997.002,2,109,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.002,2,110,0)
 
"KRN",.84,7981997.002,2,111,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.002,2,112,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,113,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,114,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,115,0)
</xsl:template>
"KRN",.84,7981997.002,2,116,0)
 
"KRN",.84,7981997.002,2,117,0)
<xsl:template match="PATIENT/ALIVE">
"KRN",.84,7981997.002,2,118,0)
 <xsl:choose>
"KRN",.84,7981997.002,2,119,0)
  <xsl:when test=".!=''">
"KRN",.84,7981997.002,2,120,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,121,0)
    <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,122,0)
   </xsl:call-template>
"KRN",.84,7981997.002,2,123,0)
  </xsl:when>
"KRN",.84,7981997.002,2,124,0)
  <xsl:otherwise>
"KRN",.84,7981997.002,2,125,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,126,0)
    <xsl:with-param name="value" select="'Yes'"/>
"KRN",.84,7981997.002,2,127,0)
   </xsl:call-template>
"KRN",.84,7981997.002,2,128,0)
  </xsl:otherwise>
"KRN",.84,7981997.002,2,129,0)
 </xsl:choose>
"KRN",.84,7981997.002,2,130,0)
</xsl:template>
"KRN",.84,7981997.002,2,131,0)
 
"KRN",.84,7981997.002,2,132,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.002,2,133,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,134,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,135,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,136,0)
</xsl:template>
"KRN",.84,7981997.002,2,137,0)
 
"KRN",.84,7981997.002,2,138,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981997.002,2,139,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,140,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,141,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,142,0)
</xsl:template>
"KRN",.84,7981997.002,2,143,0)
 
"KRN",.84,7981997.002,2,144,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.002,2,145,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,146,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,147,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,148,0)
</xsl:template>
"KRN",.84,7981997.002,2,149,0)
 
"KRN",.84,7981997.002,2,150,0)
<xsl:template match="PATIENT/INADT">
"KRN",.84,7981997.002,2,151,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,152,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,153,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,154,0)
</xsl:template>
"KRN",.84,7981997.002,2,155,0)
 
"KRN",.84,7981997.002,2,156,0)
<xsl:template match="PATIENT/READT">
"KRN",.84,7981997.002,2,157,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,158,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,159,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,160,0)
</xsl:template>
"KRN",.84,7981997.002,2,161,0)
 
"KRN",.84,7981997.002,2,162,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.002,2,163,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,164,0)
 <xsl:for-each select="RACE">
"KRN",.84,7981997.002,2,165,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,166,0)
  <xsl:call-template name="DoubleQuotes"/>
"KRN",.84,7981997.002,2,167,0)
 </xsl:for-each>
"KRN",.84,7981997.002,2,168,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,169,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,170,0)
</xsl:template>
"KRN",.84,7981997.002,2,171,0)
 
"KRN",.84,7981997.002,2,172,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981997.002,2,173,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,174,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981997.002,2,175,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,176,0)
</xsl:template>
"KRN",.84,7981997.002,2,177,0)
 
"KRN",.84,7981997.002,2,178,0)
<xsl:template match="PATIENT/SELRULES">
"KRN",.84,7981997.002,2,179,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,180,0)
 <xsl:for-each select="RULE">
"KRN",.84,7981997.002,2,181,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,182,0)
  <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981997.002,2,183,0)
   <xsl:with-param name="value" select="@DESCR"/>
"KRN",.84,7981997.002,2,184,0)
  </xsl:call-template>
"KRN",.84,7981997.002,2,185,0)
 </xsl:for-each>
"KRN",.84,7981997.002,2,186,0)
 <xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,187,0)
 <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,188,0)
</xsl:template>
"KRN",.84,7981997.002,2,189,0)
 
"KRN",.84,7981997.002,2,190,0)
</xsl:stylesheet>
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",9,.84)
.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"ORD",9,.84,0)
DIALOG
"PKG",389,-1)
1^1
"PKG",389,0)
CLINICAL CASE REGISTRIES^ROR^CLINICAL CASE REGISTRIES
"PKG",389,20,0)
^9.402P^^
"PKG",389,22,0)
^9.49I^1^1
"PKG",389,22,1,0)
1.0^3020515^3020726^222222227
"PKG",389,22,1,"PAH",1,0)
6^3040630
"PKG",389,22,1,"PAH",1,1,0)
^^2^2^3040630
"PKG",389,22,1,"PAH",1,1,1,0)
This patch fixes problems discovered during the implementation of the
"PKG",389,22,1,"PAH",1,1,2,0)
Immunology Case Registry in the Clinical Case Registries framework.
"PRE")
RORP006
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
31
"RTN","ROR")
0^16^B18598681
"RTN","ROR",1,0)
ROR ;HCIOFO/SG - CLINICAL CASE REGISTRIES ; 6/30/04 8:37am
"RTN","ROR",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,3,5,6**;May 14, 2002
"RTN","ROR",3,0)
 ;
"RTN","ROR",4,0)
 ; LOCAL VARIABLE ------ DESCRIPTION
"RTN","ROR",5,0)
 ;
"RTN","ROR",6,0)
 ; RORCACHE              In-memory cache
"RTN","ROR",7,0)
 ; RORERRDL              Default error location
"RTN","ROR",8,0)
 ; RORERROR              Error processing data
"RTN","ROR",9,0)
 ; RORPARM               Task-wide constants and variables
"RTN","ROR",10,0)
 ;
"RTN","ROR",11,0)
 ; See the source code of the ^ROR02 routine for more details.
"RTN","ROR",12,0)
 ;
"RTN","ROR",13,0)
 ; ROREXT                Regular data extraction    (See ^ROREXT)
"RTN","ROR",14,0)
 ; RORHDT                Historical data extraction (See ^RORHDT)
"RTN","ROR",15,0)
 ; RORLOG                Log subsystem data         (See ^RORLOG)
"RTN","ROR",16,0)
 ; RORUPD                Registry update parameters (See ^RORUPD)
"RTN","ROR",17,0)
 ;
"RTN","ROR",18,0)
 ; TEMPORARY NODE ------ DESCRIPTION
"RTN","ROR",19,0)
 ;
"RTN","ROR",20,0)
 ; ^TMP("RORACK")        Control data of acknowledgement processing
"RTN","ROR",21,0)
 ; ^TMP("RORHDT")        Control data of historical data extraction
"RTN","ROR",22,0)
 ; ^TMP("RORTMP")        Temporary storage
"RTN","ROR",23,0)
 ; ^TMP("RORUPD")        Registry update temporary data
"RTN","ROR",24,0)
 ;
"RTN","ROR",25,0)
 ; ^TMP(rtn_name)        Temporary storage used by the rtn_name
"RTN","ROR",26,0)
 ;                       routine (mostly, the RPC's)
"RTN","ROR",27,0)
 ;
"RTN","ROR",28,0)
 ; ^XTMP("RORHDT")       Control data of historical data extraction
"RTN","ROR",29,0)
 ; ^XTMP("RORUPDJ")      Registry update temporary data (multitask)
"RTN","ROR",30,0)
 ; ^XTMP("RORUPDR")      Registry update temporary data (installation)
"RTN","ROR",31,0)
 ;
"RTN","ROR",32,0)
 ; See detailed description of the temporary global nodes in
"RTN","ROR",33,0)
 ; the source code of the ^ROR01 routine.
"RTN","ROR",34,0)
 ;
"RTN","ROR",35,0)
 ; NAMESPACE ----------- DESCRIPTION
"RTN","ROR",36,0)
 ;
"RTN","ROR",37,0)
 ; RORACK*               Acknowldgement processing
"RTN","ROR",38,0)
 ; RORAPI*               Supported APIs
"RTN","ROR",39,0)
 ; RORDD*                Routines used by the Data Dictionary
"RTN","ROR",40,0)
 ; RORERR*               Error processing
"RTN","ROR",41,0)
 ; ROREVT*               Event protocols
"RTN","ROR",42,0)
 ; ROREX*                Regular data extraction & transmission
"RTN","ROR",43,0)
 ; RORHDT*               Historical data extraction
"RTN","ROR",44,0)
 ; RORHL*                HL7
"RTN","ROR",45,0)
 ; RORICR*               ICR-specific call-back routines
"RTN","ROR",46,0)
 ; RORKIDS*              Low-level installation utilities (KIDS)
"RTN","ROR",47,0)
 ; RORLOCK*              Locks and transactions
"RTN","ROR",48,0)
 ; RORLOG*               Error recording
"RTN","ROR",49,0)
 ;
"RTN","ROR",50,0)
 ; RORPnnn               Patch installation routines (KIDS)
"RTN","ROR",51,0)
 ;                         nnn - patch number
"RTN","ROR",52,0)
 ; RORPEnnn              Environment check routines (deprecated)
"RTN","ROR",53,0)
 ; RORPOnnn              Post-install routines      (deprecated)
"RTN","ROR",54,0)
 ; RORPRnnn              Pre-install routines       (deprecated)
"RTN","ROR",55,0)
 ; RORPUT*               High-level installation utilities
"RTN","ROR",56,0)
 ;
"RTN","ROR",57,0)
 ; RORREP*               Roll-and-scroll reports
"RTN","ROR",58,0)
 ; RORRP*                Remote procedures
"RTN","ROR",59,0)
 ; RORSET*               Setup routines
"RTN","ROR",60,0)
 ; RORTXT*               Text resource routines
"RTN","ROR",61,0)
 ; RORUP*                Registry update
"RTN","ROR",62,0)
 ; RORUTL*               Utilities
"RTN","ROR",63,0)
 ; RORVM*                Entry points for VistA menu options
"RTN","ROR",64,0)
 ; RORX*                 XML reports
"RTN","ROR",65,0)
 ;
"RTN","ROR",66,0)
 ; MENU OPTION --------- DESCRIPTION
"RTN","ROR",67,0)
 ;
"RTN","ROR",68,0)
 ; [ROR TASK]            Registry update and data extraction option
"RTN","ROR",69,0)
 ;                       (must be scheduled; do not run it directly)
"RTN","ROR",70,0)
 ; [ROR SETUP HEPC]      Setup the HepC registry
"RTN","ROR",71,0)
 ; [RORHDT MAIN]         Historical data extraction menu
"RTN","ROR",72,0)
 ; [RORMNT MAIN]         Maintenance menu
"RTN","ROR",73,0)
 ;
"RTN","ROR",74,0)
 ; SPECIAL ENTRY POINT - DESCRIPTION
"RTN","ROR",75,0)
 ;
"RTN","ROR",76,0)
 ;    START^RORTSITE     Prepares test sites for going live
"RTN","ROR",77,0)
 ;         ^RORUTL06     Registry definition validator
"RTN","ROR",78,0)
 ; DISTPREP^RORUTL06     Prepares registry parameters for KIDS distr.
"RTN","ROR",79,0)
 ;   PRTMDE^RORUTL06     Prints the data element metadata
"RTN","ROR",80,0)
 ;
"RTN","ROR",81,0)
 ;  EXTRACT^RORUTL07     Data extraction & transmission in debug mode
"RTN","ROR",82,0)
 ;   UPDATE^RORUTL07     Registry update in debug mode
"RTN","ROR",83,0)
 ;
"RTN","ROR",84,0)
 ; INITIALS ------------ DEVELOPER
"RTN","ROR",85,0)
 ;
"RTN","ROR",86,0)
 ; BH                    Brent Hicks
"RTN","ROR",87,0)
 ; CRT                   Cameron Taylor
"RTN","ROR",88,0)
 ; SG                    Sergey Gavrilov
"RTN","ROR",89,0)
 ;
"RTN","ROR",90,0)
 Q
"RTN","ROR",91,0)
 ;
"RTN","ROR",92,0)
 ;***** RETURNS THE TEST BUILD NUMBER FOR THE DATA EXTRACTION
"RTN","ROR",93,0)
BUILD() ;
"RTN","ROR",94,0)
 Q 3
"RTN","ROR",95,0)
 ;
"RTN","ROR",96,0)
 ;***** REGISTRY UPDATE AND DATA EXTRACTION TASK
"RTN","ROR",97,0)
 ;
"RTN","ROR",98,0)
 ; ZTQPARAM      String that contains a list of registry names
"RTN","ROR",99,0)
 ;               separated by commas. You must define the list as
"RTN","ROR",100,0)
 ;               a value of the TASK PARAMETERS field during
"RTN","ROR",101,0)
 ;               scheduling of the [ROR TASK] option that uses
"RTN","ROR",102,0)
 ;               this entry point.
"RTN","ROR",103,0)
 ;
"RTN","ROR",104,0)
 ; The following task parameters are optional. They can be defined
"RTN","ROR",105,0)
 ; on the second page of the option scheduling form as the pairs of
"RTN","ROR",106,0)
 ; variable names and values. See description of the ROR TASK option
"RTN","ROR",107,0)
 ; for more details regarding these parameters.
"RTN","ROR",108,0)
 ;
"RTN","ROR",109,0)
 ; [RORFLCLR]    Clear flags to control processing.
"RTN","ROR",110,0)
 ; [RORFLSET]    Set flags to control processing.
"RTN","ROR",111,0)
 ;
"RTN","ROR",112,0)
 ;                 D  Run the task(s) in Debug Mode #1
"RTN","ROR",113,0)
 ;
"RTN","ROR",114,0)
 ;                 E  Use the event references (file #798.3)
"RTN","ROR",115,0)
 ;
"RTN","ROR",116,0)
 ;                 X  Suspend the data extraction task in the
"RTN","ROR",117,0)
 ;                    same way as the registry update
"RTN","ROR",118,0)
 ;
"RTN","ROR",119,0)
 ; [RORMNTSK]    Maximum number of the registry update subtasks.
"RTN","ROR",120,0)
 ;               The default value of the parameter is "2-3-AUTO".
"RTN","ROR",121,0)
 ;
"RTN","ROR",122,0)
 ; [RORSUSP]     Suspension parameters of the registry update and
"RTN","ROR",123,0)
 ;               data extraction subtasks. The subtasks are not
"RTN","ROR",124,0)
 ;               suspended by default.
"RTN","ROR",125,0)
 ;
"RTN","ROR",126,0)
 ;               If you want to suspend data extraction subtask(s)
"RTN","ROR",127,0)
 ;               also, the flag "X" should be included in the value
"RTN","ROR",128,0)
 ;               of the RORFLSET parameters.
"RTN","ROR",129,0)
 ;
"RTN","ROR",130,0)
TASK ;
"RTN","ROR",131,0)
 N RORERROR      ; Error processing data
"RTN","ROR",132,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","ROR",133,0)
 N RORPARM       ; Application parameters
"RTN","ROR",134,0)
 ;
"RTN","ROR",135,0)
 N CNT,I,RC,REGLST,REGNAME,RGEXLST,RORERRDL  K ZTREQ
"RTN","ROR",136,0)
 ;--- Initialize constants and variables
"RTN","ROR",137,0)
 D INIT^RORUTL01("ROR",1)
"RTN","ROR",138,0)
 D CLEAR^RORERR("TASK^ROR",1)
"RTN","ROR",139,0)
 ;--- Open a new log
"RTN","ROR",140,0)
 S RC=$$SETUP^RORLOG(),RC=$$OPEN^RORLOG(,,"ROR TASK STARTED")
"RTN","ROR",141,0)
 ;--- Check the task parameters and force the <UNDEF>
"RTN","ROR",142,0)
 ;--- error if any of them has an invalid value
"RTN","ROR",143,0)
 I $$TASKPRMS^ROR10(.REGLST)<0  K ZTQPARAM  S RC=ZTQPARAM
"RTN","ROR",144,0)
 ;--- Associate the log with the registries
"RTN","ROR",145,0)
 S RC=$$SETRGLST^RORLOG(.REGLST)
"RTN","ROR",146,0)
 ;
"RTN","ROR",147,0)
 ;--- Debug mode
"RTN","ROR",148,0)
 S:$G(RORFLSET)["D" RORPARM("DEBUG")=1
"RTN","ROR",149,0)
 ;
"RTN","ROR",150,0)
 ;--- Rebuild the "ACL" cross-reference
"RTN","ROR",151,0)
 S RC=$$RNDXACL^RORUTL11()
"RTN","ROR",152,0)
 ;--- Check the application acknowledgements
"RTN","ROR",153,0)
 S RC=$$CHECKACK^ROR10(.REGLST)
"RTN","ROR",154,0)
 ;
"RTN","ROR",155,0)
 ;--- Update the registries
"RTN","ROR",156,0)
 S RC=$$UPDATE^RORUPD(.REGLST,.RGEXLST,RORMNTSK,RORSUSP,RORFLCLR,RORFLSET)
"RTN","ROR",157,0)
 ;--- Process the errors
"RTN","ROR",158,0)
 I RC<0  D  G:RC<0 ABORT
"RTN","ROR",159,0)
 . ;--- Quit if stop is requested (via the TaskMan User option)
"RTN","ROR",160,0)
 . I RC=-42  D ALERT^RORUTL01(.REGLST,-42)  S ZTSTOP=1  Q
"RTN","ROR",161,0)
 . ;--- Do not send the alert for some warnings
"RTN","ROR",162,0)
 . I RC=-28  S RC=0  Q
"RTN","ROR",163,0)
 . ;--- Send the alert in case of other errors/warnings
"RTN","ROR",164,0)
 . D ALERT^RORUTL01(.REGLST,-43,,,,"registry update")
"RTN","ROR",165,0)
 . S RC=0
"RTN","ROR",166,0)
 ;
"RTN","ROR",167,0)
 ;--- Mark registry records 3 weeks after the installation so that
"RTN","ROR",168,0)
 ;    the local registry data and demographic data will be resent
"RTN","ROR",169,0)
 ;--- to restore the data overwritten with the historical data
"RTN","ROR",170,0)
 S RC=$$REMARK^RORUTL05(.RGEXLST,21)
"RTN","ROR",171,0)
 ;
"RTN","ROR",172,0)
 ;--- Schedule the data extraction task(s)
"RTN","ROR",173,0)
 S REGNAME=""  K ZTSAVE
"RTN","ROR",174,0)
 F CNT=1:1  S REGNAME=$O(RGEXLST(REGNAME))  Q:REGNAME=""  D
"RTN","ROR",175,0)
 . S ZTRTN="TASK^ROREXT",ZTIO=""
"RTN","ROR",176,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,,(CNT-1)*30)
"RTN","ROR",177,0)
 . S ZTDESC="Data Extraction ("_REGNAME_")"
"RTN","ROR",178,0)
 . S ZTSAVE("RORREG")=REGNAME
"RTN","ROR",179,0)
 . S ZTSAVE("RORFLCLR")="",ZTSAVE("RORFLSET")=""
"RTN","ROR",180,0)
 . S ZTSAVE("RORSUSP")=""
"RTN","ROR",181,0)
 . D ^%ZTLOAD
"RTN","ROR",182,0)
 ;
"RTN","ROR",183,0)
 ;--- Purge the old tasks
"RTN","ROR",184,0)
 S RC=$$PURGE^RORTSK02(14)
"RTN","ROR",185,0)
 ;--- Purge the old logs
"RTN","ROR",186,0)
 S RC=$$PURGE^RORLOG01(14)
"RTN","ROR",187,0)
 ;--- Purge the old event references
"RTN","ROR",188,0)
 S RC=$$EPDATE^RORUTL05()
"RTN","ROR",189,0)
 S:RC>0 RC=$$PURGE^RORUPP02(RC)
"RTN","ROR",190,0)
 ;---
"RTN","ROR",191,0)
 S ZTREQ="@"
"RTN","ROR",192,0)
ABORT ;
"RTN","ROR",193,0)
 S I=$S($G(ZTREQ)="@":"COMPLETED",1:"ABORTED")
"RTN","ROR",194,0)
 D CLOSE^RORLOG("ROR TASK "_I)
"RTN","ROR",195,0)
 Q
"RTN","ROREXPR")
0^12^B10751653
"RTN","ROREXPR",1,0)
ROREXPR ;HCIOFO/SG - PREPARATION FOR DATA EXTRACTION  ; 4/15/04 11:40am
"RTN","ROREXPR",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,3,5,6**;May 14, 2002
"RTN","ROREXPR",3,0)
 ;
"RTN","ROREXPR",4,0)
 Q
"RTN","ROREXPR",5,0)
 ;
"RTN","ROREXPR",6,0)
 ;***** PREPARES VARIABLES FOR DATA EXTRACTION
"RTN","ROREXPR",7,0)
 ;
"RTN","ROREXPR",8,0)
 ; REGNAME       Registry name
"RTN","ROREXPR",9,0)
 ;
"RTN","ROREXPR",10,0)
 ; [DXBEG]       Data extraction start date (individual start
"RTN","ROREXPR",11,0)
 ;               date for each patient by default).
"RTN","ROREXPR",12,0)
 ;               Time part of the parameter value is ignored.
"RTN","ROREXPR",13,0)
 ;
"RTN","ROREXPR",14,0)
 ; [DXEND]       Data extraction end date (TODAY by default)
"RTN","ROREXPR",15,0)
 ;               Time part of the parameter value is ignored.
"RTN","ROREXPR",16,0)
 ;
"RTN","ROREXPR",17,0)
 ; DXBEG and DXEND parameters may be used only for historical data
"RTN","ROREXPR",18,0)
 ; extraction. Use of these parameters for regular data extraction
"RTN","ROREXPR",19,0)
 ; process will negatively affect the package!
"RTN","ROREXPR",20,0)
 ;
"RTN","ROREXPR",21,0)
 ; Return Values:
"RTN","ROREXPR",22,0)
 ;        0  Ok
"RTN","ROREXPR",23,0)
 ;       <0  Error code
"RTN","ROREXPR",24,0)
 ;
"RTN","ROREXPR",25,0)
PREPARE(REGNAME,DXBEG,DXEND) ;
"RTN","ROREXPR",26,0)
 N DTAREA,IL,IR,RC,REGIEN,RORMSG,SEGNAME,TMP
"RTN","ROREXPR",27,0)
 K RORLRC  F TMP="DXBEG","HL7","LD","MAXHL7SIZE"  K ROREXT(TMP)
"RTN","ROREXPR",28,0)
 S DXBEG=$G(DXBEG)\1,DXEND=$G(DXEND)\1
"RTN","ROREXPR",29,0)
 ;--- Data extraction period
"RTN","ROREXPR",30,0)
 S ROREXT("DXEND")=$S(DXEND>0:DXEND,1:$$DT^XLFDT)
"RTN","ROREXPR",31,0)
 I DXBEG>0  S RC=0  D  Q:RC<0 RC
"RTN","ROREXPR",32,0)
 . S ROREXT("DXBEG")=DXBEG  Q:DXBEG'>ROREXT("DXEND")
"RTN","ROREXPR",33,0)
 . S RC=$$ERROR^RORERR(-32,,,,DXBEG,ROREXT("DXEND"))
"RTN","ROREXPR",34,0)
 ;--- Check if the critical patches are installed
"RTN","ROREXPR",35,0)
 K ROREXT("PATCH")
"RTN","ROREXPR",36,0)
 F TMP="MD*1.0*1","MC*2.3*34"  D
"RTN","ROREXPR",37,0)
 . S:$$PATCH^XPDUTL(TMP) ROREXT("PATCH",TMP)=""
"RTN","ROREXPR",38,0)
 ;--- Get the package version and the latest patch info
"RTN","ROREXPR",39,0)
 S TMP="CLINICAL CASE REGISTRIES"
"RTN","ROREXPR",40,0)
 S ROREXT("VERSION")=$$VERSION^XPDUTL(TMP)
"RTN","ROREXPR",41,0)
 S TMP=$$LAST^XPDUTL(TMP)  D:TMP>0
"RTN","ROREXPR",42,0)
 . S $P(ROREXT("VERSION"),U,2)=+TMP
"RTN","ROREXPR",43,0)
 . S $P(ROREXT("VERSION"),U,3)=$P(TMP,U,2)
"RTN","ROREXPR",44,0)
 ;--- Get the registry IEN and some parameters
"RTN","ROREXPR",45,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME,"7;10;13E;13.1;15.1",.RORBUF)
"RTN","ROREXPR",46,0)
 Q:REGIEN<0 REGIEN
"RTN","ROREXPR",47,0)
 S ROREXT("EXTRDAYS")=$G(RORBUF("DILIST","ID",1,7))
"RTN","ROREXPR",48,0)
 S ROREXT("HL7PROT")=$G(RORBUF("DILIST","ID",1,13))
"RTN","ROREXPR",49,0)
 ;--- Check the HL7 parameters
"RTN","ROREXPR",50,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","ROREXPR",51,0)
 ;--- Load maximum message size and convert it into bytes
"RTN","ROREXPR",52,0)
 ;--- (1 Megabyte = 1024 Kb = 1024 * 1024 = 1048576 bytes)
"RTN","ROREXPR",53,0)
 S TMP=+$G(RORBUF("DILIST","ID",1,13.1))
"RTN","ROREXPR",54,0)
 S:TMP>0 ROREXT("MAXHL7SIZE")=(TMP*1048576)\1
"RTN","ROREXPR",55,0)
 ;--- Setup the lag interval (for regular data extraction only)
"RTN","ROREXPR",56,0)
 D:'$G(ROREXT("DXBEG"))
"RTN","ROREXPR",57,0)
 . S TMP=$G(RORBUF("DILIST","ID",1,15.1))
"RTN","ROREXPR",58,0)
 . S ROREXT("LD",1)=$S(TMP>0:TMP,1:1)
"RTN","ROREXPR",59,0)
 ;--- Setup the message builder call-back entry point
"RTN","ROREXPR",60,0)
 S TMP=$$TRIM^XLFSTR($G(RORBUF("DILIST","ID",1,10)))
"RTN","ROREXPR",61,0)
 I TMP'=""  D  Q:RC<0 $$ERROR^RORERR(-44,,REGNAME,,TMP)
"RTN","ROREXPR",62,0)
 . S RC=$$VERIFYEP^RORUTL01(TMP)
"RTN","ROREXPR",63,0)
 . S:RC'<0 ROREXT("MSGBLD")=TMP
"RTN","ROREXPR",64,0)
 ;--- Load and prepare segment descriptors
"RTN","ROREXPR",65,0)
 S TMP=","_REGIEN_","
"RTN","ROREXPR",66,0)
 D LIST^DIC(798.19,TMP,"@;.01;.02I;1","U",,,,"B",,,,"RORMSG")
"RTN","ROREXPR",67,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.19,TMP)
"RTN","ROREXPR",68,0)
 S IR=""
"RTN","ROREXPR",69,0)
 F  S IR=$O(^TMP("DILIST",$J,"ID",IR))  Q:IR=""  D
"RTN","ROREXPR",70,0)
 . S SEGNAME=^TMP("DILIST",$J,"ID",IR,.01)
"RTN","ROREXPR",71,0)
 . S DTAREA=+$G(^TMP("DILIST",$J,"ID",IR,.02))
"RTN","ROREXPR",72,0)
 . S TMP=$G(^TMP("DILIST",$J,"ID",IR,1))
"RTN","ROREXPR",73,0)
 . S $P(ROREXT("HL7",DTAREA,SEGNAME),U,2)=TMP
"RTN","ROREXPR",74,0)
 ;--- Load list of codes of extracted Lab results
"RTN","ROREXPR",75,0)
 S TMP=","_REGIEN_","
"RTN","ROREXPR",76,0)
 D LIST^DIC(798.112,TMP,"@;.01;.02;.03","U",,,,"B",,,,"RORMSG")
"RTN","ROREXPR",77,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.112,TMP)
"RTN","ROREXPR",78,0)
 Q:'$G(^TMP("DILIST",$J,0)) 0
"RTN","ROREXPR",79,0)
 S (IL,IR,RC)=0
"RTN","ROREXPR",80,0)
 F  S IR=$O(^TMP("DILIST",$J,"ID",IR))  Q:IR=""  D  Q:RC
"RTN","ROREXPR",81,0)
 . S TMP=$G(^TMP("DILIST",$J,"ID",IR,.01))
"RTN","ROREXPR",82,0)
 . I TMP="*"  K RORLRC  D  S RORLRC=$S(TMP'="":TMP,1:"*"),RC=1  Q
"RTN","ROREXPR",83,0)
 . . S TMP=$G(^TMP("DILIST",$J,"ID",IR,.03))
"RTN","ROREXPR",84,0)
 . I TMP>0  D  Q:RC<0  S IL=IL+1,RORLRC(IL)=TMP_"^LN"
"RTN","ROREXPR",85,0)
 . . S TMP=$$LNCODE^RORUTL02(TMP)  S:TMP<0 RC=TMP
"RTN","ROREXPR",86,0)
 . S TMP=$G(^TMP("DILIST",$J,"ID",IR,.02))
"RTN","ROREXPR",87,0)
 . S:TMP>0 IL=IL+1,RORLRC(IL)=TMP_"^NLT"
"RTN","ROREXPR",88,0)
 D CLEAN^DILF
"RTN","ROREXPR",89,0)
 Q $S(RC<0:RC,1:0)
"RTN","ROREXT01")
0^20^B23188606
"RTN","ROREXT01",1,0)
ROREXT01 ;HCIOFO/SG - EXTRACTION & TRANSMISSION PROCESS ; 6/30/04 11:25am
"RTN","ROREXT01",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,4,5,6**;May 14, 2002
"RTN","ROREXT01",3,0)
 ;
"RTN","ROREXT01",4,0)
 Q
"RTN","ROREXT01",5,0)
 ;
"RTN","ROREXT01",6,0)
 ;***** SCANS THE REGISTRY AND EXTRACTS THE DATA
"RTN","ROREXT01",7,0)
 ;
"RTN","ROREXT01",8,0)
 ; REGNAME       Registry name
"RTN","ROREXT01",9,0)
 ;
"RTN","ROREXT01",10,0)
 ; Return Values:
"RTN","ROREXT01",11,0)
 ;       <0  Error Code
"RTN","ROREXT01",12,0)
 ;      >=0  Statistics
"RTN","ROREXT01",13,0)
 ;             ^1: Total number of processed patients
"RTN","ROREXT01",14,0)
 ;             ^2: Number of patients processed with errors
"RTN","ROREXT01",15,0)
 ;
"RTN","ROREXT01",16,0)
 ; In normal mode this function processes all patients and returns
"RTN","ROREXT01",17,0)
 ; total number of patients and number of patients processed with
"RTN","ROREXT01",18,0)
 ; errors.
"RTN","ROREXT01",19,0)
 ;
"RTN","ROREXT01",20,0)
 ; However, in debug mode 3 the function stops after the first
"RTN","ROREXT01",21,0)
 ; patient processed with error and returns an error code.
"RTN","ROREXT01",22,0)
 ;
"RTN","ROREXT01",23,0)
PROCESS(REGNAME) ;
"RTN","ROREXT01",24,0)
 N CNT,DTNEXT,ECNT,IENS,IIEN,PATIEN,RC,REGIEN,ROOT,RORBUF,RORMSG,TH
"RTN","ROREXT01",25,0)
 S ROOT=$$ROOT^DILFD(798,,1)
"RTN","ROREXT01",26,0)
 ;--- Get the registry IEN
"RTN","ROREXT01",27,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME,"2.4I",.RORBUF)
"RTN","ROREXT01",28,0)
 Q:REGIEN<0 REGIEN
"RTN","ROREXT01",29,0)
 ;--- Initialize environment variables
"RTN","ROREXT01",30,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","ROREXT01",31,0)
 ;--- Create the HL7 batch message
"RTN","ROREXT01",32,0)
 S RC=$$CREATE^RORHL7()  Q:RC<0 RC
"RTN","ROREXT01",33,0)
 ;--- Generate the pseudo-patient data
"RTN","ROREXT01",34,0)
 S RC=$$PSEUDOPT^ROREXT03(REGIEN)  Q:RC<0 RC
"RTN","ROREXT01",35,0)
 ;--- Continue from the registry record that follows the last
"RTN","ROREXT01",36,0)
 ;    one processed by the previous data extraction if it hit
"RTN","ROREXT01",37,0)
 ;--- the maximum HL7 message size.
"RTN","ROREXT01",38,0)
 S IIEN=$G(RORBUF("DILIST","ID",1,2.4))
"RTN","ROREXT01",39,0)
 ;
"RTN","ROREXT01",40,0)
 ;--- Loop through the patients of the registry
"RTN","ROREXT01",41,0)
 S (CNT,ECNT,RC)=0
"RTN","ROREXT01",42,0)
 F  S IIEN=$O(@ROOT@("AC",REGIEN,IIEN))  Q:IIEN=""  D  Q:RC
"RTN","ROREXT01",43,0)
 . ;--- For a queued task only
"RTN","ROREXT01",44,0)
 . I $D(ZTQUEUED)  S RC=0  D  Q:RC<0
"RTN","ROREXT01",45,0)
 . . ;--- Check if task stop has been requested
"RTN","ROREXT01",46,0)
 . . I $$S^%ZTLOAD  S RC=$$ERROR^RORERR(-42)  Q
"RTN","ROREXT01",47,0)
 . . ;--- Check if the task should be suspended
"RTN","ROREXT01",48,0)
 . . Q:'$G(ROREXT("SUSPEND"))
"RTN","ROREXT01",49,0)
 . . Q:$$NOW^XLFDT<$G(DTNEXT)
"RTN","ROREXT01",50,0)
 . . Q:'$$SUSPEND(.DTNEXT)
"RTN","ROREXT01",51,0)
 . . ;--- Suspend the task during the peak hours
"RTN","ROREXT01",52,0)
 . . F  D  Q:'TH!(RC<0)
"RTN","ROREXT01",53,0)
 . . . S TH=$$FMDIFF^XLFDT(DTNEXT,$$NOW^XLFDT,2)
"RTN","ROREXT01",54,0)
 . . . I TH<60  S TH=0  Q       ; Do not HANG for less than a
"RTN","ROREXT01",55,0)
 . . . H $S(TH>3600:3600,1:TH)  ; minute and more than an hour
"RTN","ROREXT01",56,0)
 . . . ;--- Check if task stop has been requested
"RTN","ROREXT01",57,0)
 . . . S:$$S^%ZTLOAD RC=$$ERROR^RORERR(-42)
"RTN","ROREXT01",58,0)
 . ;--- Process the registry record
"RTN","ROREXT01",59,0)
 . S CNT=CNT+1
"RTN","ROREXT01",60,0)
 . I $G(RORPARM("DEBUG"))>1  W:$E($G(IOST),1,2)="C-" *13,CNT
"RTN","ROREXT01",61,0)
 . S RC=$$PROCREC(REGIEN,IIEN,.PATIEN)
"RTN","ROREXT01",62,0)
 . ;--- Process the error (if any)
"RTN","ROREXT01",63,0)
 . I RC<0  D  S:$G(RORPARM("DEBUG"))<3 RC=0  Q
"RTN","ROREXT01",64,0)
 . . S ECNT=ECNT+1,RC=$$ERROR^RORERR(-15,,,$G(PATIEN))
"RTN","ROREXT01",65,0)
 . ;--- Check size of the HL7 batch message
"RTN","ROREXT01",66,0)
 . S RC=$$ISMAXSZ^RORHL7()
"RTN","ROREXT01",67,0)
 Q:RC<0 RC
"RTN","ROREXT01",68,0)
 ;
"RTN","ROREXT01",69,0)
 ;--- Record a message to the log if the data extraction has
"RTN","ROREXT01",70,0)
 ;--- hit the maximum HL7 message size.
"RTN","ROREXT01",71,0)
 I IIEN  K RORBUF  D  D LOG^RORLOG(2,RORBUF,,.RORBUF)
"RTN","ROREXT01",72,0)
 . S RORBUF="Size of the HL7 message has reached its upper limit"
"RTN","ROREXT01",73,0)
 . S RORBUF(1)="Remaining data will be sent next time."
"RTN","ROREXT01",74,0)
 ;--- Remember IEN of the last processed registry record if
"RTN","ROREXT01",75,0)
 ;    the data extraction has hit the maximum HL7 message size.
"RTN","ROREXT01",76,0)
 ;--- Otherwise, clear the LAST IEN EXTRACTED field.
"RTN","ROREXT01",77,0)
 K RORBUF  S IENS=REGIEN_","
"RTN","ROREXT01",78,0)
 S RORBUF(798.1,IENS,2.4)=$S(IIEN:IIEN,1:"@")
"RTN","ROREXT01",79,0)
 D FILE^DIE(,"RORBUF","RORMSG")
"RTN","ROREXT01",80,0)
 I $G(DIERR)  D  Q RC
"RTN","ROREXT01",81,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","ROREXT01",82,0)
 ;--- Return number of processed records and number of errors
"RTN","ROREXT01",83,0)
 Q CNT_U_ECNT
"RTN","ROREXT01",84,0)
 ;
"RTN","ROREXT01",85,0)
 ;***** PROCESS THE PATIENT'S RECORD IN THE REGISTRY
"RTN","ROREXT01",86,0)
 ;
"RTN","ROREXT01",87,0)
 ; REGIEN        Registry IEN
"RTN","ROREXT01",88,0)
 ; IIEN          IEN of the patient record in the registry
"RTN","ROREXT01",89,0)
 ; [.PATIEN]     Patient IEN is returned by this parameter
"RTN","ROREXT01",90,0)
 ;
"RTN","ROREXT01",91,0)
 ; Return Values:
"RTN","ROREXT01",92,0)
 ;       <0  Error Code
"RTN","ROREXT01",93,0)
 ;        0  Ok
"RTN","ROREXT01",94,0)
 ;
"RTN","ROREXT01",95,0)
PROCREC(REGIEN,IIEN,PATIEN) ;
"RTN","ROREXT01",96,0)
 N RORERRDL      ; Default error location
"RTN","ROREXT01",97,0)
 ;
"RTN","ROREXT01",98,0)
 N DXDTS,FS,IENS,MSHPTR,RC,RORBUF,RORFDA,RORMSG,RORMSH,TMP
"RTN","ROREXT01",99,0)
 D CLEAR^RORERR("PROCREC^ROREXT01")
"RTN","ROREXT01",100,0)
 S IENS=IIEN_",",PATIEN=0
"RTN","ROREXT01",101,0)
 ;--- Get the registry record data
"RTN","ROREXT01",102,0)
 D GETS^DIQ(798,IENS,".01;11","EI","RORBUF","RORMSG")
"RTN","ROREXT01",103,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","ROREXT01",104,0)
 S PATIEN=RORBUF(798,IENS,.01,"I")
"RTN","ROREXT01",105,0)
 ;--- Skip a record tagged as "DON'T SEND"
"RTN","ROREXT01",106,0)
 Q:$G(RORBUF(798,IENS,11,"I")) 0
"RTN","ROREXT01",107,0)
 ;--- Prepare the data extraction time frames
"RTN","ROREXT01",108,0)
 S RC=$$DXPERIOD^ROREXTUT(.DXDTS,IIEN,PATIEN)
"RTN","ROREXT01",109,0)
 I RC  Q:RC<0 RC  D:$G(RORPARM("DEBUG"))  Q 0
"RTN","ROREXT01",110,0)
 . D LOG^RORLOG(4,"There is no data to extract.",PATIEN)
"RTN","ROREXT01",111,0)
 ;
"RTN","ROREXT01",112,0)
 ;--- Create an HL7 message for the patient
"RTN","ROREXT01",113,0)
 S MSHPTR=$$CREATE^RORHL7(.RORMSH)  Q:MSHPTR<0 MSHPTR
"RTN","ROREXT01",114,0)
 I $G(ROREXT("MSGBLD"))'=""  D
"RTN","ROREXT01",115,0)
 . X "S RC="_ROREXT("MSGBLD")_"(IIEN,PATIEN,.DXDTS)"
"RTN","ROREXT01",116,0)
 E  S RC=$$MESSAGE^ROREXT02(IIEN,PATIEN,.DXDTS)
"RTN","ROREXT01",117,0)
 ;
"RTN","ROREXT01",118,0)
 ;--- Delete the unfinished message from the ^TMP("HLS",$J)
"RTN","ROREXT01",119,0)
 ;    if there is no data to send (RC>0) or there was an error
"RTN","ROREXT01",120,0)
 ;    during the data extraction (RC<0). Return the error code
"RTN","ROREXT01",121,0)
 ;--- in the latter case.
"RTN","ROREXT01",122,0)
 I RC!($O(^TMP("HLS",$J,""),-1)=MSHPTR)  D  Q:RC<0 RC
"RTN","ROREXT01",123,0)
 . D ROLLBACK^RORHL7(MSHPTR)  S:'RC RC=1
"RTN","ROREXT01",124,0)
 ;
"RTN","ROREXT01",125,0)
 K RORFDA,RORMSG
"RTN","ROREXT01",126,0)
 S FS=$E(RORMSH,4),IENS=IIEN_","
"RTN","ROREXT01",127,0)
 ;--- Store the Message ID in the registry record and reset
"RTN","ROREXT01",128,0)
 ;    the CAN BE DELETED flag if some data has been extracted
"RTN","ROREXT01",129,0)
 ;--- and the message for this patient will be sent
"RTN","ROREXT01",130,0)
 I 'RC  D  S RORFDA(798,IENS,12)="@"
"RTN","ROREXT01",131,0)
 . S RORFDA(798,IENS,10)=$P(RORMSH,FS,10)
"RTN","ROREXT01",132,0)
 ;--- Otherwise, populate the MESSAGE ID field with a fake ID
"RTN","ROREXT01",133,0)
 ;    (there is no message for this patient and there will be
"RTN","ROREXT01",134,0)
 ;    no application acknowledgement). This will force the
"RTN","ROREXT01",135,0)
 ;    acknowledgement processing to update the DATA ACKNOWLEDGED
"RTN","ROREXT01",136,0)
 ;    UNTIL field so that the next data extraction process will not
"RTN","ROREXT01",137,0)
 ;--- browse through the data already processed by the previous one.
"RTN","ROREXT01",138,0)
 S:RC RORFDA(798,IENS,10)=ROREXT("HL7MID")_"-0"
"RTN","ROREXT01",139,0)
 ;--- Always update the DATA EXTRACTED UNTIL field
"RTN","ROREXT01",140,0)
 S RORFDA(798,IENS,9.2)=$P(DXDTS,U,2)
"RTN","ROREXT01",141,0)
 ;--- Update the registry record
"RTN","ROREXT01",142,0)
 D FILE^DIE("K","RORFDA","RORMSG")
"RTN","ROREXT01",143,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)
"RTN","ROREXT01",144,0)
 Q $S(RC<0:RC,1:0)
"RTN","ROREXT01",145,0)
 ;
"RTN","ROREXT01",146,0)
 ;***** CHECKS IF THE TASK SHOULD BE SUSPENDED
"RTN","ROREXT01",147,0)
 ;
"RTN","ROREXT01",148,0)
 ; .DTNEXT       Date/Time of the next event (suspend/resume)
"RTN","ROREXT01",149,0)
 ;               is returned via this parameter
"RTN","ROREXT01",150,0)
 ;
"RTN","ROREXT01",151,0)
 ; Return Values:
"RTN","ROREXT01",152,0)
 ;        0  Continue/Resume
"RTN","ROREXT01",153,0)
 ;        1  Suspend
"RTN","ROREXT01",154,0)
 ;
"RTN","ROREXT01",155,0)
SUSPEND(DTNEXT) ;
"RTN","ROREXT01",156,0)
 N DATE,NOW,SUSPEND,TIME,TS,TR
"RTN","ROREXT01",157,0)
 S TS=$P(ROREXT("SUSPEND"),U,1)
"RTN","ROREXT01",158,0)
 S TR=$P(ROREXT("SUSPEND"),U,2)
"RTN","ROREXT01",159,0)
 S NOW=$$NOW^XLFDT,DATE=NOW\1
"RTN","ROREXT01",160,0)
 ;--- A work day
"RTN","ROREXT01",161,0)
 I $$WDCHK^RORUTL01(DATE)  D  Q SUSPEND
"RTN","ROREXT01",162,0)
 . S TIME=NOW-DATE,SUSPEND=0
"RTN","ROREXT01",163,0)
 . I TIME<TS   S DTNEXT=DATE+TS  Q
"RTN","ROREXT01",164,0)
 . I TIME'<TR  S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS  Q
"RTN","ROREXT01",165,0)
 . S DTNEXT=DATE+TR,SUSPEND=1
"RTN","ROREXT01",166,0)
 ;--- Saturday, Sunday or Holiday
"RTN","ROREXT01",167,0)
 S DTNEXT=$$WDNEXT^RORUTL01(DATE)+TS
"RTN","ROREXT01",168,0)
 Q 0
"RTN","ROREXT02")
0^10^B27112280
"RTN","ROREXT02",1,0)
ROREXT02 ;HCIOFO/SG - DEFAULT MESSAGE BUILDER ; 6/22/04 2:53pm
"RTN","ROREXT02",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,5,6**;May 14, 2002
"RTN","ROREXT02",3,0)
 ;
"RTN","ROREXT02",4,0)
 Q
"RTN","ROREXT02",5,0)
 ;
"RTN","ROREXT02",6,0)
 ;***** EXTRACTS AND PREPARES LABORATORY DATA
"RTN","ROREXT02",7,0)
 ;
"RTN","ROREXT02",8,0)
 ; PATIEN        Patient IEN
"RTN","ROREXT02",9,0)
 ;
"RTN","ROREXT02",10,0)
 ; STDT          Extract from this date
"RTN","ROREXT02",11,0)
 ; ENDT          Extract until this date
"RTN","ROREXT02",12,0)
 ;
"RTN","ROREXT02",13,0)
 ; [HDTMODE]     If this parameter is defined and non-zero, start and
"RTN","ROREXT02",14,0)
 ;               end dates are specimen collection dates. Otherwise,
"RTN","ROREXT02",15,0)
 ;               they are dates of the results.
"RTN","ROREXT02",16,0)
 ;
"RTN","ROREXT02",17,0)
 ; The function uses node ^TMP("RORTMP",$J) as a temporary storage.
"RTN","ROREXT02",18,0)
 ;
"RTN","ROREXT02",19,0)
 ; Return Values:
"RTN","ROREXT02",20,0)
 ;       <0  Error Code
"RTN","ROREXT02",21,0)
 ;        0  Ok
"RTN","ROREXT02",22,0)
 ;
"RTN","ROREXT02",23,0)
LABDATA(PATIEN,STDT,ENDT,HDTMODE) ;
"RTN","ROREXT02",24,0)
 N RC,RORTMP,TMP
"RTN","ROREXT02",25,0)
 S RORTMP=$NA(^TMP("RORTMP",$J))
"RTN","ROREXT02",26,0)
 ;--- Get the Lab results
"RTN","ROREXT02",27,0)
 S TMP=$S($G(HDTMODE):"^CD",1:"^RAD")
"RTN","ROREXT02",28,0)
 S RC=$$LABRSLTS^RORUTL02(PATIEN,STDT_TMP,ENDT_TMP)
"RTN","ROREXT02",29,0)
 Q:RC<0 RC
"RTN","ROREXT02",30,0)
 ;--- Call the Lab data post-processor
"RTN","ROREXT02",31,0)
 S RC=$$LABPROC(RORTMP,PATIEN)
"RTN","ROREXT02",32,0)
 ;---
"RTN","ROREXT02",33,0)
 K @RORTMP
"RTN","ROREXT02",34,0)
 Q $S(RC<0:RC,1:0)
"RTN","ROREXT02",35,0)
 ;
"RTN","ROREXT02",36,0)
 ;***** DEFAULT LABORATORY DATA POST-PROCESSOR
"RTN","ROREXT02",37,0)
 ;
"RTN","ROREXT02",38,0)
 ; ROR8TMP       Closed root of the array (local or global), which
"RTN","ROREXT02",39,0)
 ;               contains the data loaded by the $$GCPR^LA7QRY
"RTN","ROREXT02",40,0)
 ;
"RTN","ROREXT02",41,0)
 ; PATIEN        Patient IEN
"RTN","ROREXT02",42,0)
 ;
"RTN","ROREXT02",43,0)
 ; Return Values:
"RTN","ROREXT02",44,0)
 ;       <0  Error Code
"RTN","ROREXT02",45,0)
 ;        0  Ok
"RTN","ROREXT02",46,0)
 ;
"RTN","ROREXT02",47,0)
LABPROC(ROR8TMP,PATIEN) ;
"RTN","ROREXT02",48,0)
 N BUF,CS,DFLTSITE,FS,I,J,SEG
"RTN","ROREXT02",49,0)
 ;--- Extract separators from the MSH segment
"RTN","ROREXT02",50,0)
 S BUF=$G(@ROR8TMP@(1))
"RTN","ROREXT02",51,0)
 S:$E(BUF,1,3)="MSH" FS=$E(BUF,4),CS=$E(BUF,5)
"RTN","ROREXT02",52,0)
 S:$G(FS)="" FS="|"  S:$G(CS)="" CS="^"
"RTN","ROREXT02",53,0)
 ;--- Get the default station number and name
"RTN","ROREXT02",54,0)
 S DFLTSITE=$$SITE^RORUTL03(CS)
"RTN","ROREXT02",55,0)
 ;
"RTN","ROREXT02",56,0)
 ;--- Add the results to the message
"RTN","ROREXT02",57,0)
 S I=0
"RTN","ROREXT02",58,0)
 F  S I=$O(@ROR8TMP@(I))  Q:I=""  D
"RTN","ROREXT02",59,0)
 . S SEG(1)=$P(@ROR8TMP@(I),FS)  Q:SEG(1)=""
"RTN","ROREXT02",60,0)
 . ;--- Ignore unnecessary segments
"RTN","ROREXT02",61,0)
 . Q:'$D(ROREXT("HL7",1,SEG(1)))
"RTN","ROREXT02",62,0)
 . ;--- Load the full segment
"RTN","ROREXT02",63,0)
 . D LOAD^RORHL7A(.SEG,ROR8TMP,I)
"RTN","ROREXT02",64,0)
 . ;--- Replace the local station with the default one
"RTN","ROREXT02",65,0)
 . I SEG(1)="OBX"  S:$P($G(SEG(16)),CS)="" SEG(16)=DFLTSITE
"RTN","ROREXT02",66,0)
 . ;--- Store the segment
"RTN","ROREXT02",67,0)
 . D SAVE^RORHL7A(.SEG)
"RTN","ROREXT02",68,0)
 Q 0
"RTN","ROREXT02",69,0)
 ;
"RTN","ROREXT02",70,0)
 ;***** EXTRACTS PATIENT DATA AND CREATES A MESSAGE BODY
"RTN","ROREXT02",71,0)
 ;
"RTN","ROREXT02",72,0)
 ; RORIEN        IEN of the patient record in the registry
"RTN","ROREXT02",73,0)
 ;
"RTN","ROREXT02",74,0)
 ; PATIEN        Patient IEN
"RTN","ROREXT02",75,0)
 ;
"RTN","ROREXT02",76,0)
 ; .DXDTS        Either a single time frame in StartDate^EndDate
"RTN","ROREXT02",77,0)
 ;               format or a reference to a local variable containing
"RTN","ROREXT02",78,0)
 ;               the list of data extraction time frames. The main
"RTN","ROREXT02",79,0)
 ;               time frame should be stored in the root node:
"RTN","ROREXT02",80,0)
 ;
"RTN","ROREXT02",81,0)
 ;  DXDTS(         MainStartDate^MainEndDate  (FileMan)
"RTN","ROREXT02",82,0)
 ;    DataArea,
"RTN","ROREXT02",83,0)
 ;      i)         StartDate^EndDate          (FileMan)
"RTN","ROREXT02",84,0)
 ;
"RTN","ROREXT02",85,0)
 ;               See the $$DXPERIOD^ROREXTUT function for details.
"RTN","ROREXT02",86,0)
 ;
"RTN","ROREXT02",87,0)
 ; [HDTMODE]     This parameter is defined and non-zero during the
"RTN","ROREXT02",88,0)
 ;               historical data extraction.
"RTN","ROREXT02",89,0)
 ;
"RTN","ROREXT02",90,0)
 ; Return Values:
"RTN","ROREXT02",91,0)
 ;       <0  Error Code
"RTN","ROREXT02",92,0)
 ;        0  Ok
"RTN","ROREXT02",93,0)
 ;       >0  Nothing to send
"RTN","ROREXT02",94,0)
 ;
"RTN","ROREXT02",95,0)
MESSAGE(RORIEN,PATIEN,DXDTS,HDTMODE) ;
"RTN","ROREXT02",96,0)
 N RORDEM        ; Update demographics
"RTN","ROREXT02",97,0)
 N RORFDA        ; Array containing values from the registry record
"RTN","ROREXT02",98,0)
 N RORLOC        ; Update local registry data
"RTN","ROREXT02",99,0)
 ;
"RTN","ROREXT02",100,0)
 N DATAPTR,DEMPTR,ENDT,FIELDS,IENS,LOCPTR,RBPTR,RC,RORBUF,RORMSG,RORPTR,STDT
"RTN","ROREXT02",101,0)
 S IENS=RORIEN_",",HDTMODE=+$G(HDTMODE)
"RTN","ROREXT02",102,0)
 ;--- If only the main time frame is provided then
"RTN","ROREXT02",103,0)
 ;--- generate the data-specific ones automatically
"RTN","ROREXT02",104,0)
 I $D(DXDTS)<10  D  D DXMERGE^ROREXTUT(.DXDTS)
"RTN","ROREXT02",105,0)
 . D DXADD^ROREXTUT(.DXDTS,$P(DXDTS,U),$P(DXDTS,U,2),0,1)
"RTN","ROREXT02",106,0)
 S STDT=$P(DXDTS,U),ENDT=$P(DXDTS,U,2)
"RTN","ROREXT02",107,0)
 ;--- Get the registry record data
"RTN","ROREXT02",108,0)
 D GETS^DIQ(798,IENS,"4;5","I","RORFDA","RORMSG")
"RTN","ROREXT02",109,0)
 I $G(DIERR)  D  Q RC
"RTN","ROREXT02",110,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,PATIEN,798,IENS)
"RTN","ROREXT02",111,0)
 S RORDEM=+$G(RORFDA(798,IENS,4,"I"))
"RTN","ROREXT02",112,0)
 S RORLOC=+$G(RORFDA(798,IENS,5,"I"))
"RTN","ROREXT02",113,0)
 ;--- Initialize environment variables
"RTN","ROREXT02",114,0)
 S RC=$$INIT^RORHL7()  Q:RC<0 RC
"RTN","ROREXT02",115,0)
 ;
"RTN","ROREXT02",116,0)
 ;=== Add patient data segments
"RTN","ROREXT02",117,0)
 ;
"RTN","ROREXT02",118,0)
 S DEMPTR=$$PTR^RORHL7
"RTN","ROREXT02",119,0)
 S RC=$$PID^RORHL01(PATIEN)      Q:RC<0 RC
"RTN","ROREXT02",120,0)
 ;--- Period of Servise
"RTN","ROREXT02",121,0)
 I $D(ROREXT("HL7",5,"ZSP"))  D  Q:RC<0 RC
"RTN","ROREXT02",122,0)
 . S RC=$$ZSP^RORHL01(PATIEN)
"RTN","ROREXT02",123,0)
 ;--- Rated Disabilities
"RTN","ROREXT02",124,0)
 I $D(ROREXT("HL7",5,"ZRD"))  D  Q:RC<0 RC
"RTN","ROREXT02",125,0)
 . S RC=$$ZRD^RORHL01(PATIEN)
"RTN","ROREXT02",126,0)
 ;
"RTN","ROREXT02",127,0)
 ;=== Add local registry data segments
"RTN","ROREXT02",128,0)
 ;
"RTN","ROREXT02",129,0)
 S LOCPTR=$$PTR^RORHL7
"RTN","ROREXT02",130,0)
 I $D(ROREXT("HL7",5,"CSR"))  D  Q:RC<0 RC
"RTN","ROREXT02",131,0)
 . S FIELDS=$P(ROREXT("HL7",5,"CSR"),U,2)
"RTN","ROREXT02",132,0)
 . S RC=$$CSR^RORHL02(IENS,FIELDS)
"RTN","ROREXT02",133,0)
 I $D(ROREXT("HL7",5,"CSP"))  D  Q:RC<0 RC
"RTN","ROREXT02",134,0)
 . S FIELDS=$P(ROREXT("HL7",5,"CSP"),U,2)
"RTN","ROREXT02",135,0)
 . S RC=$$CSP^RORHL02(IENS,FIELDS)
"RTN","ROREXT02",136,0)
 I $D(ROREXT("HL7",5,"CSS"))  D  Q:RC<0 RC
"RTN","ROREXT02",137,0)
 . S FIELDS=$P(ROREXT("HL7",5,"CSS"),U,2)
"RTN","ROREXT02",138,0)
 . S RC=$$CSS^RORHL02(IENS,FIELDS)
"RTN","ROREXT02",139,0)
 ;
"RTN","ROREXT02",140,0)
 ;=== Add other encounter data segments
"RTN","ROREXT02",141,0)
 ;
"RTN","ROREXT02",142,0)
 S DATAPTR=$$PTR^RORHL7
"RTN","ROREXT02",143,0)
 ;--- Pharmacy
"RTN","ROREXT02",144,0)
 I $D(ROREXT("HL7",6))>1  D  Q:RC<0 RC
"RTN","ROREXT02",145,0)
 . S RC=$$EN1^RORHL03(PATIEN,STDT,ENDT)
"RTN","ROREXT02",146,0)
 ;--- Radiology
"RTN","ROREXT02",147,0)
 I $D(ROREXT("HL7",4))>1  D  Q:RC<0 RC
"RTN","ROREXT02",148,0)
 . S RC=$$EN1^RORHL04(PATIEN,STDT,ENDT)
"RTN","ROREXT02",149,0)
 ;--- Autopsy
"RTN","ROREXT02",150,0)
 I $D(ROREXT("HL7",7))>1  D  Q:RC<0 RC
"RTN","ROREXT02",151,0)
 . S RC=$$EN1^RORHL05(PATIEN)
"RTN","ROREXT02",152,0)
 ;--- Liver Biopsy
"RTN","ROREXT02",153,0)
 I $D(ROREXT("HL7",8))>1  D  Q:RC<0 RC
"RTN","ROREXT02",154,0)
 . S RC=$$EN1^RORHL06(PATIEN,STDT,ENDT)
"RTN","ROREXT02",155,0)
 ;--- Lab Data
"RTN","ROREXT02",156,0)
 I $D(ROREXT("HL7",1))>1  D  Q:RC<0 RC
"RTN","ROREXT02",157,0)
 . S RC=$$LABDATA(PATIEN,STDT,ENDT,HDTMODE)
"RTN","ROREXT02",158,0)
 ;
"RTN","ROREXT02",159,0)
 ;=== Analyze structure of the message
"RTN","ROREXT02",160,0)
 S RORPTR=$$PTR^RORHL7,RC=0
"RTN","ROREXT02",161,0)
 I RORPTR'>DATAPTR  D
"RTN","ROREXT02",162,0)
 . S RBPTR=RORPTR
"RTN","ROREXT02",163,0)
 . ;--- Do not send local registry data segments if the UPDATE LOCAL
"RTN","ROREXT02",164,0)
 . ;    REGISTRY DATA flag is not set and there is no other
"RTN","ROREXT02",165,0)
 . ;--- VistA data to be sent
"RTN","ROREXT02",166,0)
 . I 'RORLOC!(RORPTR'>LOCPTR)  S RBPTR=LOCPTR  D
"RTN","ROREXT02",167,0)
 . . ;--- Do not send a message containing only the patient data
"RTN","ROREXT02",168,0)
 . . ;--- segments if the UPDATE DEMOGRAPHICS flag is not set
"RTN","ROREXT02",169,0)
 . . S:'RORDEM RBPTR=DEMPTR
"RTN","ROREXT02",170,0)
 . ;--- Delete unnecessary segments
"RTN","ROREXT02",171,0)
 . F  Q:RORPTR'>RBPTR  D  S RORPTR=$O(^TMP("HLS",$J,RORPTR),-1)
"RTN","ROREXT02",172,0)
 . . K ^TMP("HLS",$J,RORPTR)
"RTN","ROREXT02",173,0)
 . S RC=RORPTR'>DEMPTR
"RTN","ROREXT02",174,0)
 Q RC
"RTN","ROREXT03")
0^18^B7069977
"RTN","ROREXT03",1,0)
ROREXT03 ;HCIOFO/SG - PSEUDO-PATIENT MESSAGE BUILDER ; 6/30/04 11:26am
"RTN","ROREXT03",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**6**;May 14, 2002
"RTN","ROREXT03",3,0)
 ;
"RTN","ROREXT03",4,0)
 Q
"RTN","ROREXT03",5,0)
 ;
"RTN","ROREXT03",6,0)
 ;***** CSP SEGMENT
"RTN","ROREXT03",7,0)
CSP(REGIEN) ;
"RTN","ROREXT03",8,0)
 N CS,RORSEG,SCS
"RTN","ROREXT03",9,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","ROREXT03",10,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4)
"RTN","ROREXT03",11,0)
 ;
"RTN","ROREXT03",12,0)
 ;--- Initialize the segment
"RTN","ROREXT03",13,0)
 S RORSEG="CSP"
"RTN","ROREXT03",14,0)
 ;
"RTN","ROREXT03",15,0)
 ;--- CSP-1 - New Patient?
"RTN","ROREXT03",16,0)
 S $P(RORSEG,HLFS,2)="0"_CS_"Edit"_CS_"99VA7983"
"RTN","ROREXT03",17,0)
 ;
"RTN","ROREXT03",18,0)
 ;--- CSP-2 - Reactivation Date or Registration Date
"RTN","ROREXT03",19,0)
 S $P(RORSEG,HLFS,3)=$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ROREXT03",20,0)
 ;
"RTN","ROREXT03",21,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","ROREXT03",22,0)
 D SETSEG^RORHL7(RORSEG)
"RTN","ROREXT03",23,0)
 Q 0
"RTN","ROREXT03",24,0)
 ;
"RTN","ROREXT03",25,0)
 ;***** CSR SEGMENT
"RTN","ROREXT03",26,0)
CSR(REGIEN) ;
"RTN","ROREXT03",27,0)
 N CS,RC,RORINFO,RORSEG,SCS,TMP
"RTN","ROREXT03",28,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","ROREXT03",29,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4)
"RTN","ROREXT03",30,0)
 ;
"RTN","ROREXT03",31,0)
 ;--- Get the registry information
"RTN","ROREXT03",32,0)
 S RC=$$REGINFO^RORUTL17(REGIEN,"RORINFO")  Q:RC<0 RC
"RTN","ROREXT03",33,0)
 ;
"RTN","ROREXT03",34,0)
 ;--- Initialize the segment
"RTN","ROREXT03",35,0)
 S RORSEG="CSR"
"RTN","ROREXT03",36,0)
 ;
"RTN","ROREXT03",37,0)
 ;--- CSR-1 - Name of the registry and version of the ROR system
"RTN","ROREXT03",38,0)
 S TMP="ROR"_SCS_$TR($P(ROREXT("VERSION"),U,1,2),U,SCS)
"RTN","ROREXT03",39,0)
 S $P(TMP,SCS,4)=$$BUILD^ROR
"RTN","ROREXT03",40,0)
 S $P(RORSEG,HLFS,2)=$P($$REGNAME^RORUTL01(REGIEN),U)_CS_"VA"_CS_TMP
"RTN","ROREXT03",41,0)
 ;
"RTN","ROREXT03",42,0)
 ;--- CSR-3 - Default Division
"RTN","ROREXT03",43,0)
 S $P(RORSEG,HLFS,4)=$$SITE^RORUTL03(CS)
"RTN","ROREXT03",44,0)
 ;
"RTN","ROREXT03",45,0)
 ;--- CSR-4 - Patient ID
"RTN","ROREXT03",46,0)
 S TMP=$$M10^HLFNC(0,CS)_CS_CS_"PI"
"RTN","ROREXT03",47,0)
 S $P(TMP,CS,2)=+$G(RORINFO("NPP"))
"RTN","ROREXT03",48,0)
 S $P(RORSEG,HLFS,5)=TMP_CS_$TR($P(RORSEG,HLFS,4),CS,SCS)
"RTN","ROREXT03",49,0)
 ;
"RTN","ROREXT03",50,0)
 ;--- CSR-6 - Date when entered to the registry
"RTN","ROREXT03",51,0)
 S $P(RORSEG,HLFS,7)=$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ROREXT03",52,0)
 ;
"RTN","ROREXT03",53,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","ROREXT03",54,0)
 D SETSEG^RORHL7(RORSEG)
"RTN","ROREXT03",55,0)
 Q 0
"RTN","ROREXT03",56,0)
 ;
"RTN","ROREXT03",57,0)
 ;***** CSS SEGMENT
"RTN","ROREXT03",58,0)
CSS(REGIEN) ;
"RTN","ROREXT03",59,0)
 N CS,RORSEG,SCS
"RTN","ROREXT03",60,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","ROREXT03",61,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4)
"RTN","ROREXT03",62,0)
 ;
"RTN","ROREXT03",63,0)
 ;--- Initialize the segment
"RTN","ROREXT03",64,0)
 S RORSEG="CSS"
"RTN","ROREXT03",65,0)
 ;
"RTN","ROREXT03",66,0)
 ;--- CSS-1 Required Field. Set to "O"
"RTN","ROREXT03",67,0)
 S $P(RORSEG,HLFS,2)="O"_CS_"ONE TIME ONLY"_CS_"L"
"RTN","ROREXT03",68,0)
 ;
"RTN","ROREXT03",69,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","ROREXT03",70,0)
 D SETSEG^RORHL7(RORSEG)
"RTN","ROREXT03",71,0)
 Q 0
"RTN","ROREXT03",72,0)
 ;
"RTN","ROREXT03",73,0)
 ;***** PID SEGMENT
"RTN","ROREXT03",74,0)
PID() ;
"RTN","ROREXT03",75,0)
 N CS,RORSEG,SCS
"RTN","ROREXT03",76,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","ROREXT03",77,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4)
"RTN","ROREXT03",78,0)
 S RORSEG="PID"
"RTN","ROREXT03",79,0)
 ;
"RTN","ROREXT03",80,0)
 ;--- PID-3 DFN and Station Number
"RTN","ROREXT03",81,0)
 S TMP=$$M10^HLFNC(0,CS)
"RTN","ROREXT03",82,0)
 S $P(TMP,CS,5)="PI"
"RTN","ROREXT03",83,0)
 S $P(TMP,CS,6)=$$SITE^RORUTL03(SCS)
"RTN","ROREXT03",84,0)
 S $P(RORSEG,HLFS,4)=TMP
"RTN","ROREXT03",85,0)
 ;
"RTN","ROREXT03",86,0)
 ;--- PID-5 Patient Name
"RTN","ROREXT03",87,0)
 S $P(RORSEG,HLFS,6)="PSEUDO,PATIENT"
"RTN","ROREXT03",88,0)
 ;
"RTN","ROREXT03",89,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","ROREXT03",90,0)
 D SETSEG^RORHL7(RORSEG)
"RTN","ROREXT03",91,0)
 Q 0
"RTN","ROREXT03",92,0)
 ;
"RTN","ROREXT03",93,0)
 ;***** CREATES AN HL7 MESSAGE FOR THE PSEUDO-PATIENT
"RTN","ROREXT03",94,0)
 ;
"RTN","ROREXT03",95,0)
 ; REGIEN        Registry IEN
"RTN","ROREXT03",96,0)
 ;
"RTN","ROREXT03",97,0)
 ; Return Values:
"RTN","ROREXT03",98,0)
 ;       <0  Error code
"RTN","ROREXT03",99,0)
 ;        0  Ok
"RTN","ROREXT03",100,0)
 ;       >0  Number of ignored errors
"RTN","ROREXT03",101,0)
 ;
"RTN","ROREXT03",102,0)
PSEUDOPT(REGIEN) ;
"RTN","ROREXT03",103,0)
 N RC,RORSEG,TMP
"RTN","ROREXT03",104,0)
 ;--- Output pseudo-patient's segments
"RTN","ROREXT03",105,0)
 S RC=$$PID()        Q:RC<0 RC
"RTN","ROREXT03",106,0)
 S RC=$$CSR(REGIEN)  Q:RC<0 RC
"RTN","ROREXT03",107,0)
 S RC=$$CSP(REGIEN)  Q:RC<0 RC
"RTN","ROREXT03",108,0)
 S RC=$$CSS(REGIEN)  Q:RC<0 RC
"RTN","ROREXT03",109,0)
 ;---
"RTN","ROREXT03",110,0)
 Q 0
"RTN","RORHL02")
0^17^B44853872
"RTN","RORHL02",1,0)
RORHL02 ;HOIFO/CRT,SG - HL7 REGISTRY DATA: CSP,CSR,CSS ; 5/17/04 11:06am
"RTN","RORHL02",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,5,6**;May 14, 2002
"RTN","RORHL02",3,0)
 ;
"RTN","RORHL02",4,0)
 Q
"RTN","RORHL02",5,0)
 ;
"RTN","RORHL02",6,0)
 ;***** CSP SEGMENT BUILDER
"RTN","RORHL02",7,0)
 ;
"RTN","RORHL02",8,0)
 ; RORIENS       IENS of Patient Record in Registry File
"RTN","RORHL02",9,0)
 ;
"RTN","RORHL02",10,0)
 ; [RORFLDS]     Segment Fields to populate
"RTN","RORHL02",11,0)
 ;               (1,2,3 available)
"RTN","RORHL02",12,0)
 ;
"RTN","RORHL02",13,0)
 ; Return Values:
"RTN","RORHL02",14,0)
 ;       <0  Error Code
"RTN","RORHL02",15,0)
 ;        0  Ok
"RTN","RORHL02",16,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL02",17,0)
 ;
"RTN","RORHL02",18,0)
CSP(RORIENS,RORFLDS) ;
"RTN","RORHL02",19,0)
 N CS,ERRCNT,FLDS,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL02",20,0)
 S (ERRCNT,RC)=0
"RTN","RORHL02",21,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL02",22,0)
 S CS=$E(HLECH,1)
"RTN","RORHL02",23,0)
 ;--- Check the parameters
"RTN","RORHL02",24,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL02",25,0)
 ;
"RTN","RORHL02",26,0)
 I $G(RORFLDS)'=""  D
"RTN","RORHL02",27,0)
 . S:$E(RORFLDS)'="," RORFLDS=","_RORFLDS
"RTN","RORHL02",28,0)
 . S:$E(RORFLDS,$L(RORFLDS))'="," RORFLDS=RORFLDS_","
"RTN","RORHL02",29,0)
 E  S RORFLDS=",1,2,3," ; Default HL7 fields
"RTN","RORHL02",30,0)
 ;
"RTN","RORHL02",31,0)
 S FLDS="1;2;3;7"
"RTN","RORHL02",32,0)
 D GETS^DIQ(798,RORIENS,FLDS,"IE","ROROUT","RORMSG")
"RTN","RORHL02",33,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,RORIENS)
"RTN","RORHL02",34,0)
 ;
"RTN","RORHL02",35,0)
 ;--- Initialize the segment
"RTN","RORHL02",36,0)
 S RORSEG="CSP"
"RTN","RORHL02",37,0)
 ;
"RTN","RORHL02",38,0)
 ;--- CSP-1 - New Patient?
"RTN","RORHL02",39,0)
 I RORFLDS[",1,"  D
"RTN","RORHL02",40,0)
 . S TMP=+$G(ROROUT(798,RORIENS,3,"I"))
"RTN","RORHL02",41,0)
 . I TMP>0  S $P(TMP,CS,2)=$G(ROROUT(798,RORIENS,3,"E"))
"RTN","RORHL02",42,0)
 . E  S TMP="0"_CS_"Edit"_CS_"99VA7983"
"RTN","RORHL02",43,0)
 . S $P(RORSEG,HLFS,2)=TMP
"RTN","RORHL02",44,0)
 ;
"RTN","RORHL02",45,0)
 ;--- CSP-2 - Reactivation Date or Registration Date
"RTN","RORHL02",46,0)
 I RORFLDS[",2,"  D  Q:RC<0 RC
"RTN","RORHL02",47,0)
 . S TMP=$G(ROROUT(798,RORIENS,7,"I"))
"RTN","RORHL02",48,0)
 . I TMP'>0  S TMP=$G(ROROUT(798,RORIENS,1,"I"))  I TMP'>0  D  Q
"RTN","RORHL02",49,0)
 . . S RC=$$ERROR^RORERR(-95,,,,798,RORIENS,"1,7")
"RTN","RORHL02",50,0)
 . S $P(RORSEG,HLFS,3)=$$FMTHL7^XLFDT(TMP)
"RTN","RORHL02",51,0)
 ;
"RTN","RORHL02",52,0)
 ;--- CSP-3 - Inactivation Date or null
"RTN","RORHL02",53,0)
 I RORFLDS[",3,"  D
"RTN","RORHL02",54,0)
 . S TMP=$G(ROROUT(798,RORIENS,2,"I"))
"RTN","RORHL02",55,0)
 . Q:TMP'>$G(ROROUT(798,RORIENS,7,"I"))
"RTN","RORHL02",56,0)
 . S $P(RORSEG,HLFS,4)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL02",57,0)
 ;
"RTN","RORHL02",58,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","RORHL02",59,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL02",60,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL02",61,0)
 ;
"RTN","RORHL02",62,0)
 ;***** CSR SEGMENT BUILDER
"RTN","RORHL02",63,0)
 ;
"RTN","RORHL02",64,0)
 ; RORIENS       IENS of Patient Record in Registry File
"RTN","RORHL02",65,0)
 ;
"RTN","RORHL02",66,0)
 ; [RORFLDS]     Segment Fields to populate
"RTN","RORHL02",67,0)
 ;               (1,3,4,6,9,10,11,14,15,16 available)
"RTN","RORHL02",68,0)
 ;
"RTN","RORHL02",69,0)
 ; Return Values:
"RTN","RORHL02",70,0)
 ;       <0  Error Code
"RTN","RORHL02",71,0)
 ;        0  Ok
"RTN","RORHL02",72,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL02",73,0)
 ;
"RTN","RORHL02",74,0)
CSR(RORIENS,RORFLDS) ;
"RTN","RORHL02",75,0)
 N BUF,CS,ERRCNT,FLDS,RC,RORMSG,ROROUT,RORSEG,RORTXT,SCS,TMP
"RTN","RORHL02",76,0)
 S (ERRCNT,RC)=0
"RTN","RORHL02",77,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL02",78,0)
 S CS=$E(HLECH,1),SCS=$E(HLECH,4)
"RTN","RORHL02",79,0)
 ;--- Check the parameters
"RTN","RORHL02",80,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL02",81,0)
 ;
"RTN","RORHL02",82,0)
 S FLDS=".01;.02;1;2;2.2;6;6.1"
"RTN","RORHL02",83,0)
 D GETS^DIQ(798,RORIENS,FLDS,"IE","ROROUT","RORMSG")
"RTN","RORHL02",84,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,RORIENS)
"RTN","RORHL02",85,0)
 ;
"RTN","RORHL02",86,0)
 I $G(RORFLDS)'=""  D
"RTN","RORHL02",87,0)
 . S:$E(RORFLDS)'="," RORFLDS=","_RORFLDS
"RTN","RORHL02",88,0)
 . S:$E(RORFLDS,$L(RORFLDS))'="," RORFLDS=RORFLDS_","
"RTN","RORHL02",89,0)
 E  S RORFLDS=",1,3,4,6,8,9,10,11,14,15,16," ; Default HL7 fields
"RTN","RORHL02",90,0)
 ;
"RTN","RORHL02",91,0)
 ;--- Initialize the segment
"RTN","RORHL02",92,0)
 S RORSEG="CSR"
"RTN","RORHL02",93,0)
 ;
"RTN","RORHL02",94,0)
 ;--- CSR-1 - Name of the registry and version of the ROR system
"RTN","RORHL02",95,0)
 I RORFLDS[",1,"  D
"RTN","RORHL02",96,0)
 . S TMP="ROR"_SCS_$TR($P(ROREXT("VERSION"),U,1,2),U,SCS)
"RTN","RORHL02",97,0)
 . S $P(TMP,SCS,4)=$$BUILD^ROR
"RTN","RORHL02",98,0)
 . S $P(RORSEG,HLFS,2)=$G(ROROUT(798,RORIENS,.02,"E"))_CS_"VA"_CS_TMP
"RTN","RORHL02",99,0)
 ;
"RTN","RORHL02",100,0)
 ;--- CSR-3 - Inpatient Division or User Division if fails
"RTN","RORHL02",101,0)
 I RORFLDS[",3,"  D
"RTN","RORHL02",102,0)
 . S $P(RORSEG,HLFS,4)=$$SITE^RORUTL03(CS)
"RTN","RORHL02",103,0)
 ;
"RTN","RORHL02",104,0)
 ;--- CSR-4 - Patient ID
"RTN","RORHL02",105,0)
 I RORFLDS[",4,"  D
"RTN","RORHL02",106,0)
 . S TMP=$$M10^HLFNC(ROROUT(798,RORIENS,.01,"I"),CS)_CS_CS_"PI"
"RTN","RORHL02",107,0)
 . S:TMP>0 $P(RORSEG,HLFS,5)=TMP_CS_$TR($P(RORSEG,HLFS,4),CS,SCS)
"RTN","RORHL02",108,0)
 ;
"RTN","RORHL02",109,0)
 ;--- CSR-6 - Date when entered to the registry
"RTN","RORHL02",110,0)
 I RORFLDS[",6,"  D  Q:RC<0 RC
"RTN","RORHL02",111,0)
 . S TMP=$$FMTHL7^XLFDT($G(ROROUT(798,RORIENS,1,"I"))\1)
"RTN","RORHL02",112,0)
 . I TMP'>0  S RC=$$ERROR^RORERR(-95,,,,798,RORIENS,1)  Q
"RTN","RORHL02",113,0)
 . S $P(RORSEG,HLFS,7)=TMP
"RTN","RORHL02",114,0)
 ;
"RTN","RORHL02",115,0)
 ;--- CSR-9 Date of Category 4 (ICR)
"RTN","RORHL02",116,0)
 I RORFLDS[",9,",$D(^RORDATA(799.4,+RORIENS))>1  D  Q:RC<0 RC
"RTN","RORHL02",117,0)
 . D GETS^DIQ(799.4,RORIENS,".02;.03","I","ROROUT","RORMSG")
"RTN","RORHL02",118,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL02",119,0)
 . . D DBS^RORERR("RORMSG",-9,,,799.4,RORIENS)
"RTN","RORHL02",120,0)
 . Q:'$G(ROROUT(799.4,RORIENS,.02,"I"))
"RTN","RORHL02",121,0)
 . ;---
"RTN","RORHL02",122,0)
 . S TMP=$$FMTHL7^XLFDT($G(ROROUT(799.4,RORIENS,.03,"I")))
"RTN","RORHL02",123,0)
 . ; I TMP'>0  S RC=$$ERROR^RORERR(-95,,,,799.4,RORIENS,.03)  Q
"RTN","RORHL02",124,0)
 . S $P(RORSEG,HLFS,10)=TMP
"RTN","RORHL02",125,0)
 ;
"RTN","RORHL02",126,0)
 ;--- CSR-10 - Supporting Evidence and Reasons Added
"RTN","RORHL02",127,0)
 I RORFLDS[",10,"  D
"RTN","RORHL02",128,0)
 . S $P(RORSEG,HLFS,11)=$$ADREASON^RORHLUT1(RORIENS,CS)
"RTN","RORHL02",129,0)
 ;
"RTN","RORHL02",130,0)
 ;--- CSR-11 - Date CD4 form complete (ICR)
"RTN","RORHL02",131,0)
 I RORFLDS[",11,",$D(^RORDATA(799.4,+RORIENS))>1  D
"RTN","RORHL02",132,0)
 . S TMP=$$GET1^DIQ(799.4,RORIENS,9.01,"I",,"RORMSG")
"RTN","RORHL02",133,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL02",134,0)
 . . D DBS^RORERR("RORMSG",-9,,,799.4,RORIENS)
"RTN","RORHL02",135,0)
 . S $P(RORSEG,HLFS,12)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL02",136,0)
 ;
"RTN","RORHL02",137,0)
 ;--- CSR-14 - Investigational drugs + Medication in Profile
"RTN","RORHL02",138,0)
 I RORFLDS[",14,"  D
"RTN","RORHL02",139,0)
 . N ID,MP
"RTN","RORHL02",140,0)
 . S ID=+$G(ROROUT(798,RORIENS,6,"I"))
"RTN","RORHL02",141,0)
 . S MP=+$G(ROROUT(798,RORIENS,6.1,"I"))
"RTN","RORHL02",142,0)
 . S BUF=ID_MP
"RTN","RORHL02",143,0)
 . S $P(BUF,CS,2)="Investigational Drugs "_$S(ID:"",1:"Not ")_"Used."
"RTN","RORHL02",144,0)
 . I ID  S TMP=$S(MP:"",1:"Not ")  D
"RTN","RORHL02",145,0)
 . . S $P(BUF,CS,2)=$P(BUF,CS,2)_" Medication "_TMP_"in Profile."
"RTN","RORHL02",146,0)
 . S $P(RORSEG,HLFS,15)=BUF_CS_"99VA7986"
"RTN","RORHL02",147,0)
 ;
"RTN","RORHL02",148,0)
 ;--- CSR-15 - Inactivation date
"RTN","RORHL02",149,0)
 I RORFLDS[",15,"  D
"RTN","RORHL02",150,0)
 . S TMP=$G(ROROUT(798,RORIENS,2,"I"))
"RTN","RORHL02",151,0)
 . I TMP'="" S $P(RORSEG,HLFS,16)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL02",152,0)
 ;
"RTN","RORHL02",153,0)
 ;--- CSR-16 - Inactivation Reason
"RTN","RORHL02",154,0)
 I RORFLDS[",16,",$G(ROROUT(798,RORIENS,2.2,"I"))  D
"RTN","RORHL02",155,0)
 . S BUF=$$ITEMCODE^RORUTL09(ROROUT(798,RORIENS,2.2,"I"),.RORTXT)
"RTN","RORHL02",156,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7(RORTXT)
"RTN","RORHL02",157,0)
 . S $P(BUF,CS,3)="99VA79822"
"RTN","RORHL02",158,0)
 . S:BUF>0 $P(RORSEG,HLFS,17)=BUF
"RTN","RORHL02",159,0)
 ;
"RTN","RORHL02",160,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","RORHL02",161,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL02",162,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL02",163,0)
 ;
"RTN","RORHL02",164,0)
 ;***** CSS SEGMENT BUILDER
"RTN","RORHL02",165,0)
 ;
"RTN","RORHL02",166,0)
 ; RORIENS       IENS of Patient Record in Registry File
"RTN","RORHL02",167,0)
 ;
"RTN","RORHL02",168,0)
 ; [RORFLDS]     Segment Fields to populate
"RTN","RORHL02",169,0)
 ;               (1,2,3 available)
"RTN","RORHL02",170,0)
 ;
"RTN","RORHL02",171,0)
 ; Return Values:
"RTN","RORHL02",172,0)
 ;       <0  Error Code
"RTN","RORHL02",173,0)
 ;        0  Ok
"RTN","RORHL02",174,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL02",175,0)
 ;
"RTN","RORHL02",176,0)
CSS(RORIENS,RORFLDS) ;
"RTN","RORHL02",177,0)
 N CS,ERRCNT,RC,REP,RORMSG,RORSEG,TMP
"RTN","RORHL02",178,0)
 S (ERRCNT,RC)=0
"RTN","RORHL02",179,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL02",180,0)
 S CS=$E(HLECH,1),REP=$E(HLECH,2)
"RTN","RORHL02",181,0)
 ;--- Check the parameters
"RTN","RORHL02",182,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL02",183,0)
 ;
"RTN","RORHL02",184,0)
 I RORFLDS'=""  D
"RTN","RORHL02",185,0)
 . S:$E(RORFLDS)'="," RORFLDS=","_RORFLDS
"RTN","RORHL02",186,0)
 . S:$E(RORFLDS,$L(RORFLDS))'="," RORFLDS=RORFLDS_","
"RTN","RORHL02",187,0)
 E  S RORFLDS=",1,2,3," ; Default HL7 fields
"RTN","RORHL02",188,0)
 ;
"RTN","RORHL02",189,0)
 ;--- Initialize the segment
"RTN","RORHL02",190,0)
 S RORSEG="CSS"
"RTN","RORHL02",191,0)
 ;
"RTN","RORHL02",192,0)
 ;--- CSS-1 Required Field. Set to "O"
"RTN","RORHL02",193,0)
 S $P(RORSEG,HLFS,2)="O"_CS_"ONE TIME ONLY"_CS_"L"
"RTN","RORHL02",194,0)
 ;
"RTN","RORHL02",195,0)
 ;--- CSS-2 Last Extract Date
"RTN","RORHL02",196,0)
 I RORFLDS[",2,"  D  Q:RC<0 RC
"RTN","RORHL02",197,0)
 . S TMP=$$GET1^DIQ(798,RORIENS,"#.02:#2","I",,"RORMSG")
"RTN","RORHL02",198,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL02",199,0)
 . . D DBS^RORERR("RORMSG",-9,,,798,RORIENS)
"RTN","RORHL02",200,0)
 . S $P(RORSEG,HLFS,3)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL02",201,0)
 ;
"RTN","RORHL02",202,0)
 ;--- CSS-3 Risk Factors (ICR)
"RTN","RORHL02",203,0)
 I RORFLDS[",3,",$D(^RORDATA(799.4,+RORIENS))>1  D
"RTN","RORHL02",204,0)
 . N CNT,EV,FLD,RFLST,RORBUF,RORQUIT,RORRISK
"RTN","RORHL02",205,0)
 . S RFLST="14.01;14.02;14.03;14.04;14.07;14.08;14.09;14.1;14.11;14.12;14.13;14.16;14.17"
"RTN","RORHL02",206,0)
 . D GETS^DIQ(799.4,RORIENS,RFLST,"I","RORBUF","RORMSG")
"RTN","RORHL02",207,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL02",208,0)
 . . D DBS^RORERR("RORMSG",-9,,,799.4,RORIENS)
"RTN","RORHL02",209,0)
 . ;---
"RTN","RORHL02",210,0)
 . S RORRISK="",RORQUIT=0
"RTN","RORHL02",211,0)
 . F CNT=1:1  S FLD=$P(RFLST,";",CNT)  Q:FLD=""  D:FLD>0  Q:RORQUIT
"RTN","RORHL02",212,0)
 . . S TMP=$G(RORBUF(799.4,RORIENS,FLD,"I"))
"RTN","RORHL02",213,0)
 . . S EV=$S(TMP=0:"NO",TMP=1:"YES",TMP=9:"UNKNOWN",1:"")
"RTN","RORHL02",214,0)
 . . I EV=""  S RORRISK="",RORQUIT=1  Q
"RTN","RORHL02",215,0)
 . . S $P(RORRISK,REP,CNT)=TMP_CS_EV
"RTN","RORHL02",216,0)
 . S $P(RORSEG,HLFS,4)=RORRISK
"RTN","RORHL02",217,0)
 ;
"RTN","RORHL02",218,0)
 ;--- Store the segment in ^TMP("HLS",$J)
"RTN","RORHL02",219,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL02",220,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL03")
0^22^B30890153
"RTN","RORHL03",1,0)
RORHL03 ;HOIFO/CRT - HL7 PHARMACY: ORC,RXE ; 6/9/04 11:20am
"RTN","RORHL03",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,5,6**;May 14, 2002
"RTN","RORHL03",3,0)
 ;
"RTN","RORHL03",4,0)
 ; Routine's RORHL03* use the following IAs:
"RTN","RORHL03",5,0)
 ;
"RTN","RORHL03",6,0)
 ; #93-A         Get stop code from the file #44 (controlled)
"RTN","RORHL03",7,0)
 ; #1878         EN^PSOORDER (supported)
"RTN","RORHL03",8,0)
 ; #2400         OCL^PSOORRL and OEL^PSOORRL (controlled)
"RTN","RORHL03",9,0)
 ; #10060        Read access to file #200 (supported)
"RTN","RORHL03",10,0)
 ; #10090        Read access to file #4 (supported)
"RTN","RORHL03",11,0)
 ;
"RTN","RORHL03",12,0)
 ; #1977         Read access to file #52
"RTN","RORHL03",13,0)
 ; #1876         Read access to file #59
"RTN","RORHL03",14,0)
 ; #2497         Read access to file #55
"RTN","RORHL03",15,0)
 ; #221          Read access to file #50 and #50.68
"RTN","RORHL03",16,0)
 ; #2221         Read access to file 50.607
"RTN","RORHL03",17,0)
 ;
"RTN","RORHL03",18,0)
 ;***** PHARMACY DATA SEGMENT BUILDER
"RTN","RORHL03",19,0)
 ;
"RTN","RORHL03",20,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL03",21,0)
 ;
"RTN","RORHL03",22,0)
 ; RORSTDT       Start Date/Time (Fileman)
"RTN","RORHL03",23,0)
 ; RORENDT       End Date/Time (Fileman)
"RTN","RORHL03",24,0)
 ;
"RTN","RORHL03",25,0)
 ; Return Values:
"RTN","RORHL03",26,0)
 ;       <0  Error Code
"RTN","RORHL03",27,0)
 ;        0  Ok
"RTN","RORHL03",28,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL03",29,0)
 ;
"RTN","RORHL03",30,0)
 ; The function uses the ^TMP("PS",$J) and ^TMP($J,"ROR-PS")
"RTN","RORHL03",31,0)
 ; global nodes.
"RTN","RORHL03",32,0)
 ;
"RTN","RORHL03",33,0)
EN1(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL03",34,0)
 N ERRCNT,IEN,IENS,II,RC,RORII,RORINC,RORINDEX,RORMSG,RORORD,RORRXE,RORXII,TMP
"RTN","RORHL03",35,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL03",36,0)
 S (ERRCNT,RC)=0
"RTN","RORHL03",37,0)
 ;
"RTN","RORHL03",38,0)
 ;--- Load the list of prescriptions
"RTN","RORHL03",39,0)
 K ^TMP("PS",$J)
"RTN","RORHL03",40,0)
 D OCL^PSOORRL(RORDFN,RORSTDT,RORENDT)
"RTN","RORHL03",41,0)
 Q:$D(^TMP("PS",$J))<10 0
"RTN","RORHL03",42,0)
 ;
"RTN","RORHL03",43,0)
 ;--- Select the prescriptions
"RTN","RORHL03",44,0)
 K ^TMP($J,"ROR-PS")
"RTN","RORHL03",45,0)
 S RORII=0
"RTN","RORHL03",46,0)
 F  S RORII=$O(^TMP("PS",$J,RORII))  Q:'RORII  D
"RTN","RORHL03",47,0)
 . S RORORD=$P(^TMP("PS",$J,RORII,0),U)
"RTN","RORHL03",48,0)
 . Q:RORORD'>0
"RTN","RORHL03",49,0)
 . S II=$P(RORORD,";"),II=$E(II,$L(II))
"RTN","RORHL03",50,0)
 . Q:'("RUV"[II)
"RTN","RORHL03",51,0)
 . ;---
"RTN","RORHL03",52,0)
 . I "UV"[II   D  Q:(TMP<RORSTDT)!(TMP'<RORENDT)
"RTN","RORHL03",53,0)
 . . S TMP=$P($G(^TMP("PS",$J,RORII,0)),U,15)
"RTN","RORHL03",54,0)
 . I II="R"  D  Q:TMP<RORSTDT
"RTN","RORHL03",55,0)
 . . S TMP=$P($G(^TMP("PS",$J,RORII,0)),U,10)
"RTN","RORHL03",56,0)
 . ;---
"RTN","RORHL03",57,0)
 . ;M ^TMP($J,"ROR-PS",RORII)=^TMP("PS",$J,RORII)
"RTN","RORHL03",58,0)
 . S ^TMP($J,"ROR-PS",RORII,0)=^TMP("PS",$J,RORII,0)
"RTN","RORHL03",59,0)
 K ^TMP("PS",$J)
"RTN","RORHL03",60,0)
 ;
"RTN","RORHL03",61,0)
 ;--- Browse through the list and generate the HL7 segments
"RTN","RORHL03",62,0)
 S RORII=0
"RTN","RORHL03",63,0)
 F  S RORII=$O(^TMP($J,"ROR-PS",RORII))  Q:'RORII  D  Q:RC<0
"RTN","RORHL03",64,0)
 . S RORORD=$P(^TMP($J,"ROR-PS",RORII,0),U)
"RTN","RORHL03",65,0)
 . S RORXII=$P(RORORD,";"),RORXII=$E(RORXII,$L(RORXII))
"RTN","RORHL03",66,0)
 . ;
"RTN","RORHL03",67,0)
 . K ^TMP("PS",$J),RORRXE
"RTN","RORHL03",68,0)
 . D OEL^PSOORRL(RORDFN,RORORD)
"RTN","RORHL03",69,0)
 . Q:$D(^TMP("PS",$J))<10
"RTN","RORHL03",70,0)
 . M RORRXE=^TMP("PS",$J)
"RTN","RORHL03",71,0)
 . K ^TMP("PS",$J)
"RTN","RORHL03",72,0)
 . ;
"RTN","RORHL03",73,0)
 . I RORXII="R" D                ; Outpatient Pharmacy
"RTN","RORHL03",74,0)
 . . D REFILL
"RTN","RORHL03",75,0)
 . . ;--- Check if the original prescription or one of
"RTN","RORHL03",76,0)
 . . ;--- the refills is within date range
"RTN","RORHL03",77,0)
 . . S RORINC=0
"RTN","RORHL03",78,0)
 . . F RORINDEX="REF","PAR" D
"RTN","RORHL03",79,0)
 . . . S II=""
"RTN","RORHL03",80,0)
 . . . F  S II=$O(RORRXE(RORINDEX,II))  Q:II=""  D
"RTN","RORHL03",81,0)
 . . . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U)
"RTN","RORHL03",82,0)
 . . . . I TMP'<RORSTDT,TMP<RORENDT  S RORINC=1  Q
"RTN","RORHL03",83,0)
 . . . . K RORRXE(RORINDEX,II,0)
"RTN","RORHL03",84,0)
 . . Q:'RORINC
"RTN","RORHL03",85,0)
 . . ;---
"RTN","RORHL03",86,0)
 . . S IEN=+$P(RORORD,";")
"RTN","RORHL03",87,0)
 . . S TMP=$$ORC(IEN,.RORRXE)
"RTN","RORHL03",88,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",89,0)
 . . S TMP=$$RXE^RORHL031(IEN,.RORRXE)
"RTN","RORHL03",90,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",91,0)
 . . ;
"RTN","RORHL03",92,0)
 . I RORXII="U" D                        ; Unit Dose Inpatient Pharmacy
"RTN","RORHL03",93,0)
 . . S IENS=+$P(RORORD,";")_","_RORDFN_","
"RTN","RORHL03",94,0)
 . . S TMP=$$ORC^RORHL07(IENS,.RORRXE)
"RTN","RORHL03",95,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",96,0)
 . . S TMP=$$RXE^RORHL07(IENS,.RORRXE)
"RTN","RORHL03",97,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",98,0)
 . . ;
"RTN","RORHL03",99,0)
 . I RORXII="V" D                       ; IV Inpatient Pharmacy
"RTN","RORHL03",100,0)
 . . S IENS=+$P(RORORD,";")_","_RORDFN_","
"RTN","RORHL03",101,0)
 . . S TMP=$$ORC^RORHL071(IENS,.RORRXE)
"RTN","RORHL03",102,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",103,0)
 . . S TMP=$$RXE^RORHL071(IENS,.RORRXE)
"RTN","RORHL03",104,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL03",105,0)
 ;
"RTN","RORHL03",106,0)
 K ^TMP($J,"ROR-PS")
"RTN","RORHL03",107,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL03",108,0)
 ;
"RTN","RORHL03",109,0)
 ;***** OUTPATIENT PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL03",110,0)
 ;
"RTN","RORHL03",111,0)
 ; RORIEN        IEN of Record in PrescPN. File #52
"RTN","RORHL03",112,0)
 ;
"RTN","RORHL03",113,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL03",114,0)
 ;
"RTN","RORHL03",115,0)
 ; Return Values:
"RTN","RORHL03",116,0)
 ;       <0  Error Code
"RTN","RORHL03",117,0)
 ;        0  Ok
"RTN","RORHL03",118,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL03",119,0)
 ;
"RTN","RORHL03",120,0)
ORC(RORIEN,RORORC) ;
"RTN","RORHL03",121,0)
 N BUF,CS,ERRCNT,IEN,IENS59,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL03",122,0)
 S (ERRCNT,RC)=0
"RTN","RORHL03",123,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL03",124,0)
 S CS=$E(HLECH,1)
"RTN","RORHL03",125,0)
 ;
"RTN","RORHL03",126,0)
 ;--- Initialize the segment
"RTN","RORHL03",127,0)
 S RORSEG="ORC"
"RTN","RORHL03",128,0)
 ;
"RTN","RORHL03",129,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL03",130,0)
 S $P(RORSEG,HLFS,2)="NW"
"RTN","RORHL03",131,0)
 ;
"RTN","RORHL03",132,0)
 ;--- ORC-2 - Placer Order #
"RTN","RORHL03",133,0)
 S $P(RORSEG,HLFS,3)=+RORIEN_CS_"OP"
"RTN","RORHL03",134,0)
 ;
"RTN","RORHL03",135,0)
 ;--- ORC-9 - Release Date/Time
"RTN","RORHL03",136,0)
 S TMP=$P($G(RORORC("RXN",0)),U,7)
"RTN","RORHL03",137,0)
 S $P(RORSEG,HLFS,10)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL03",138,0)
 ;
"RTN","RORHL03",139,0)
 ;--- ORC-12 - Provider
"RTN","RORHL03",140,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL03",141,0)
 I BUF>0  D
"RTN","RORHL03",142,0)
 . S $P(BUF,CS,5)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL03",143,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL03",144,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL03",145,0)
 . S $P(RORSEG,HLFS,13)=BUF
"RTN","RORHL03",146,0)
 ;
"RTN","RORHL03",147,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL03",148,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL03",149,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL03",150,0)
 S $P(RORSEG,HLFS,16)=TMP
"RTN","RORHL03",151,0)
 ;
"RTN","RORHL03",152,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL03",153,0)
 S $P(RORSEG,HLFS,17)=CS_CS_CS_CS_"NEW"
"RTN","RORHL03",154,0)
 ;
"RTN","RORHL03",155,0)
 ;--- ORC-17 - Division
"RTN","RORHL03",156,0)
 S $P(RORSEG,HLFS,18)=$$SITE^RORUTL03(CS)
"RTN","RORHL03",157,0)
 S IENS59=+$$GET1^DIQ(52,+RORIEN,20,"I",,"RORMSG")_","
"RTN","RORHL03",158,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL03",159,0)
 . D DBS^RORERR("RORMSG",-99,,,52,+RORIEN)
"RTN","RORHL03",160,0)
 I IENS59>0  D
"RTN","RORHL03",161,0)
 . D GETS^DIQ(59,IENS59,"100","IE","ROROUT","RORMSG")
"RTN","RORHL03",162,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL03",163,0)
 . . D DBS^RORERR("RORMSG",-99,,,59,IENS59)
"RTN","RORHL03",164,0)
 . S IEN=+$G(ROROUT(59,IENS59,100,"I"))
"RTN","RORHL03",165,0)
 . Q:IEN'>0
"RTN","RORHL03",166,0)
 . ;---
"RTN","RORHL03",167,0)
 . S BUF=$$GET1^DIQ(4,IEN_",",99,"I",,"RORMSG")
"RTN","RORHL03",168,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL03",169,0)
 . . D DBS^RORERR("RORMSG",-99,,,4,IEN_",")
"RTN","RORHL03",170,0)
 . Q:BUF=""
"RTN","RORHL03",171,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7($G(ROROUT(59,IENS59,100,"E")))
"RTN","RORHL03",172,0)
 . S $P(BUF,CS,3)="99VA4"
"RTN","RORHL03",173,0)
 . S $P(RORSEG,HLFS,18)=BUF
"RTN","RORHL03",174,0)
 ;
"RTN","RORHL03",175,0)
 ;--- Store the segment
"RTN","RORHL03",176,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL03",177,0)
 Q ERRCNT
"RTN","RORHL03",178,0)
 ;
"RTN","RORHL03",179,0)
 ;***** MAKES ORIGINAL FILL LIKE REFILLS TO REUSE CODE
"RTN","RORHL03",180,0)
REFILL ;
"RTN","RORHL03",181,0)
 S RORRXE("REF",0,0)=""
"RTN","RORHL03",182,0)
 S $P(RORRXE("REF",0,0),U,1)=$P(RORRXE("RXN",0),U,6)
"RTN","RORHL03",183,0)
 S $P(RORRXE("REF",0,0),U,2)=$P(RORRXE(0),U,7)
"RTN","RORHL03",184,0)
 S $P(RORRXE("REF",0,0),U,3)=$P(RORRXE(0),U,8)
"RTN","RORHL03",185,0)
 S $P(RORRXE("REF",0,0),U,4)=$P(RORRXE("RXN",0),U,7)
"RTN","RORHL03",186,0)
 S $P(RORRXE("REF",0,0),U,5)=$P(RORRXE("RXN",0),U,3)
"RTN","RORHL03",187,0)
 Q
"RTN","RORHL031")
0^13^B39786704
"RTN","RORHL031",1,0)
RORHL031 ;HOIFO/BH - HL7 PHARMACY: UTILITIES ; 4/19/04 9:43am
"RTN","RORHL031",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORHL031",3,0)
 ;
"RTN","RORHL031",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL031",5,0)
 ;
"RTN","RORHL031",6,0)
 ; See RORHL03 for RORHL03* IA's.
"RTN","RORHL031",7,0)
 ;
"RTN","RORHL031",8,0)
 Q
"RTN","RORHL031",9,0)
 ;
"RTN","RORHL031",10,0)
 ;***** OUTPATIENT PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL031",11,0)
 ;
"RTN","RORHL031",12,0)
 ; RORIEN        IEN of Record in PrescPN. File #52
"RTN","RORHL031",13,0)
 ;
"RTN","RORHL031",14,0)
 ; .RORRXE       Array with info (from OEL^PSOORRL)
"RTN","RORHL031",15,0)
 ;
"RTN","RORHL031",16,0)
 ; Return Values:
"RTN","RORHL031",17,0)
 ;       <0  Error Code
"RTN","RORHL031",18,0)
 ;        0  Ok
"RTN","RORHL031",19,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL031",20,0)
 ;
"RTN","RORHL031",21,0)
RXE(RORIEN,RORRXE) ;
"RTN","RORHL031",22,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,J,L,RC,RORCMOP,RORMSG,ROROUT,RORTEST,RORDATA,RORMREF,RORCLIN,RORPRICE,RORSEG,RORSTOP,RORUIN,RORUOUT,RORLST,RORSTAT,RORISIG,RORRELDT,TMP
"RTN","RORHL031",23,0)
 S (ERRCNT,RC)=0
"RTN","RORHL031",24,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL031",25,0)
 S CS=$E(HLECH,1)
"RTN","RORHL031",26,0)
 ;
"RTN","RORHL031",27,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL031",28,0)
 ;
"RTN","RORHL031",29,0)
 K ^TMP("PSOR",$J)
"RTN","RORHL031",30,0)
 D EN^PSOORDER(,RORIEN)
"RTN","RORHL031",31,0)
 ;
"RTN","RORHL031",32,0)
 S BUF=$G(^TMP("PSOR",$J,RORIEN,0))
"RTN","RORHL031",33,0)
 S RORMREF=$P(BUF,U,8)            ; # of refills
"RTN","RORHL031",34,0)
 S RORPRICE=$P(BUF,U,10)          ; unit price of drugs
"RTN","RORHL031",35,0)
 ;
"RTN","RORHL031",36,0)
 S BUF=$G(^TMP("PSOR",$J,RORIEN,1))
"RTN","RORHL031",37,0)
 S RORSTAT=$P($P(BUF,U,5),";",1)  ; patient status (internal)
"RTN","RORHL031",38,0)
 S RORSTDE=$P($P(BUF,U,5),";",2)  ; patient status
"RTN","RORHL031",39,0)
 S RORCLIN=+$P(BUF,U,4)           ; clinic
"RTN","RORHL031",40,0)
 ;
"RTN","RORHL031",41,0)
 S (J,RORISIG)="",L=245
"RTN","RORHL031",42,0)
 F  S J=$O(^TMP("PSOR",$J,RORIEN,"SIG1",J))  Q:J=""  D  Q:L'>0
"RTN","RORHL031",43,0)
 . S BUF=$G(^TMP("PSOR",$J,RORIEN,"SIG1",J,0))
"RTN","RORHL031",44,0)
 . S RORISIG=RORISIG_" "_$E(BUF,1,L)
"RTN","RORHL031",45,0)
 . S L=L-$L(BUF)-1  S:L<-1 RORISIG=RORISIG_"..."
"RTN","RORHL031",46,0)
 S RORISIG=$$TRIM^XLFSTR(RORISIG)
"RTN","RORHL031",47,0)
 ;
"RTN","RORHL031",48,0)
 ;--- Get Stop Code
"RTN","RORHL031",49,0)
 S RORSTOP=$$STOPCODE^RORUTL18(+RORCLIN)
"RTN","RORHL031",50,0)
 S:RORSTOP'>0 RORSTOP=""
"RTN","RORHL031",51,0)
 ;
"RTN","RORHL031",52,0)
 ;--- Get last dispensed dates
"RTN","RORHL031",53,0)
 D LIST^DIC(52.1,","_RORIEN_",","@;10.1I",,,,,,,,"RORLST","RORMSG")
"RTN","RORHL031",54,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL031",55,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,52.1,","_RORIEN_",")
"RTN","RORHL031",56,0)
 S J=0  K RORLST("AIEN")
"RTN","RORHL031",57,0)
 F  S J=$O(RORLST("DILIST",2,J))  Q:J=""  D
"RTN","RORHL031",58,0)
 . S TMP=+RORLST("DILIST",2,J)
"RTN","RORHL031",59,0)
 . S:TMP RORLST("AIEN",TMP,J)=""
"RTN","RORHL031",60,0)
 ;
"RTN","RORHL031",61,0)
 ;--- Load the CMOP list
"RTN","RORHL031",62,0)
 D LIST^DIC(52.01,","_RORIEN_",","@;2;3","I",,,,,,,"RORCMOP","RORMSG")
"RTN","RORHL031",63,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL031",64,0)
 . D DBS^RORERR("RORMSG",-99,,,52.01,","_RORIEN_",")
"RTN","RORHL031",65,0)
 S J=0  K RORCMOP("A2")
"RTN","RORHL031",66,0)
 F  S J=$O(RORCMOP("DILIST","ID",J))  Q:J=""  D
"RTN","RORHL031",67,0)
 . Q:$G(RORCMOP("DILIST","ID",J,3))=3
"RTN","RORHL031",68,0)
 . S TMP=$G(RORCMOP("DILIST","ID",J,2))
"RTN","RORHL031",69,0)
 . S:TMP'="" RORCMOP("A2",TMP,J)=""
"RTN","RORHL031",70,0)
 ;
"RTN","RORHL031",71,0)
 F RORINDEX="REF","PAR" D
"RTN","RORHL031",72,0)
 . S II=""
"RTN","RORHL031",73,0)
 . F  S II=$O(RORRXE(RORINDEX,II))  Q:II=""  D  Q:RC<0
"RTN","RORHL031",74,0)
 . . S RORTEST=$G(RORRXE(RORINDEX,II,0))  Q:RORTEST=""
"RTN","RORHL031",75,0)
 . . ;
"RTN","RORHL031",76,0)
 . . ;--- Initialize the segment
"RTN","RORHL031",77,0)
 . . S RORSEG="RXE"
"RTN","RORHL031",78,0)
 . . ;
"RTN","RORHL031",79,0)
 . . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL031",80,0)
 . . S $P(RORSEG,HLFS,2)=""""""
"RTN","RORHL031",81,0)
 . . ;
"RTN","RORHL031",82,0)
 . . ;--- RXE-2 - Give Code
"RTN","RORHL031",83,0)
 . . S IDGN=+$P($G(RORRXE("DD",1,0)),U,3)  ; File #50 IEN
"RTN","RORHL031",84,0)
 . . I IDGN'>0  S IDGN=+$P($G(RORRXE("DD",1,0)),U)  Q:IDGN'>0
"RTN","RORHL031",85,0)
 . . S BUF="",TMP=$$RXE2(IDGN,CS,.BUF)
"RTN","RORHL031",86,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL031",87,0)
 . . Q:BUF=""
"RTN","RORHL031",88,0)
 . . S $P(RORSEG,HLFS,3)=BUF
"RTN","RORHL031",89,0)
 . . ;
"RTN","RORHL031",90,0)
 . . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL031",91,0)
 . . S $P(RORSEG,HLFS,4)=""""""
"RTN","RORHL031",92,0)
 . . ;
"RTN","RORHL031",93,0)
 . . ;--- RXE-4 - Max # of re-fills
"RTN","RORHL031",94,0)
 . . S $P(RORSEG,HLFS,5)=RORMREF
"RTN","RORHL031",95,0)
 . . ;
"RTN","RORHL031",96,0)
 . . ;--- RXE-5 - Give Units
"RTN","RORHL031",97,0)
 . . S INDF=+$$GET1^DIQ(50,IDGN,22,"I",,"RORMSG")    ; File #50.68 IEN
"RTN","RORHL031",98,0)
 . . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL031",99,0)
 . . . D DBS^RORERR("RORMSG",-99,,,50,IDGN)
"RTN","RORHL031",100,0)
 . . I INDF>0  D
"RTN","RORHL031",101,0)
 . . . S RORUIN=$$PROD0^PSNAPIS(,INDF)
"RTN","RORHL031",102,0)
 . . . S RORUIN=$P(RORUIN,U,4)
"RTN","RORHL031",103,0)
 . . . Q:'RORUIN
"RTN","RORHL031",104,0)
 . . . S RORUOUT=$P($G(^PS(50.607,RORUIN,0)),U)
"RTN","RORHL031",105,0)
 . . . S BUF=""
"RTN","RORHL031",106,0)
 . . . S $P(BUF,CS,4)=RORUIN
"RTN","RORHL031",107,0)
 . . . S $P(BUF,CS,5)=$$ESCAPE^RORHL7(RORUOUT)
"RTN","RORHL031",108,0)
 . . . S $P(BUF,CS,6)="99PSU"
"RTN","RORHL031",109,0)
 . . . S $P(RORSEG,HLFS,6)=BUF
"RTN","RORHL031",110,0)
 . . ;
"RTN","RORHL031",111,0)
 . . ;--- RXE-6
"RTN","RORHL031",112,0)
 . . S RORRELDT=""  K ROROUT
"RTN","RORHL031",113,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U,4)
"RTN","RORHL031",114,0)
 . . S RORRELDT=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",115,0)
 . . S $P(RORSEG,HLFS,7)=RORRELDT
"RTN","RORHL031",116,0)
 . . ;
"RTN","RORHL031",117,0)
 . . ;--- RXE-7 - SIG1
"RTN","RORHL031",118,0)
 . . S $P(RORSEG,HLFS,8)=CS_$$ESCAPE^RORHL7(RORISIG)
"RTN","RORHL031",119,0)
 . . ;
"RTN","RORHL031",120,0)
 . . ;--- RXE-10 - Dispense amount
"RTN","RORHL031",121,0)
 . . S $P(RORSEG,HLFS,11)=$P($G(RORRXE(RORINDEX,II,0)),U,3)
"RTN","RORHL031",122,0)
 . . ;
"RTN","RORHL031",123,0)
 . . ;--- RXE-15 - Refill Indicator
"RTN","RORHL031",124,0)
 . . S $P(RORSEG,HLFS,16)=$S(RORINDEX="REF":1,RORINDEX="PAR":2)
"RTN","RORHL031",125,0)
 . . ;
"RTN","RORHL031",126,0)
 . . ;--- RXE-17 - Refill #
"RTN","RORHL031",127,0)
 . . S $P(RORSEG,HLFS,18)=II
"RTN","RORHL031",128,0)
 . . ;
"RTN","RORHL031",129,0)
 . . ;--- RXE-18 - Fill Date/Time
"RTN","RORHL031",130,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U)
"RTN","RORHL031",131,0)
 . . S $P(RORSEG,HLFS,19)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",132,0)
 . . ;
"RTN","RORHL031",133,0)
 . . ;--- RXE-19 - Daily Dose
"RTN","RORHL031",134,0)
 . . S $P(RORSEG,HLFS,20)=$P($G(RORRXE(RORINDEX,II,0)),U,2)
"RTN","RORHL031",135,0)
 . . ;
"RTN","RORHL031",136,0)
 . . ;--- RXE-20 - CMOP
"RTN","RORHL031",137,0)
 . . S $P(RORSEG,HLFS,21)=$S($D(RORCMOP("A2",II)):"Y",1:"N")
"RTN","RORHL031",138,0)
 . . ;
"RTN","RORHL031",139,0)
 . . ;--- RXE-21 - Clinic Stop
"RTN","RORHL031",140,0)
 . . S $P(RORSEG,HLFS,22)=RORSTOP
"RTN","RORHL031",141,0)
 . . ;
"RTN","RORHL031",142,0)
 . . ;--- RXE-22 - Dispense Date
"RTN","RORHL031",143,0)
 . . I 'II  D
"RTN","RORHL031",144,0)
 . . . S TMP=$P($G(RORRXE(0)),U,5)
"RTN","RORHL031",145,0)
 . . . S $P(RORSEG,HLFS,23)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",146,0)
 . . E  D
"RTN","RORHL031",147,0)
 . . . S J=$O(RORLST("AIEN",II,""))  Q:J'>0
"RTN","RORHL031",148,0)
 . . . S TMP=$G(RORLST("DILIST","ID",J,10.1))
"RTN","RORHL031",149,0)
 . . . S $P(RORSEG,HLFS,23)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL031",150,0)
 . . ;
"RTN","RORHL031",151,0)
 . . ;--- RXE-23 - Unit Cost
"RTN","RORHL031",152,0)
 . . S $P(RORSEG,HLFS,24)=RORPRICE
"RTN","RORHL031",153,0)
 . . ;
"RTN","RORHL031",154,0)
 . . ;--- RXE-27 - Patient Status
"RTN","RORHL031",155,0)
 . . S $P(RORSEG,HLFS,28)=RORSTAT_CS_RORSTDE
"RTN","RORHL031",156,0)
 . . ;
"RTN","RORHL031",157,0)
 . . ;--- RXE-30 Mail/Window
"RTN","RORHL031",158,0)
 . . S TMP=$P($G(RORRXE(RORINDEX,II,0)),U,5)
"RTN","RORHL031",159,0)
 . . S $P(RORSEG,HLFS,31)=$S(TMP="M":"AD",TMP="W":"TR",1:"")
"RTN","RORHL031",160,0)
 . . ;
"RTN","RORHL031",161,0)
 . . ;--- Store the segment
"RTN","RORHL031",162,0)
 . . D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL031",163,0)
 ;
"RTN","RORHL031",164,0)
 K ^TMP("PSOR",$J)
"RTN","RORHL031",165,0)
 Q ERRCNT
"RTN","RORHL031",166,0)
 ;
"RTN","RORHL031",167,0)
 ;***** CONSTRUCTS THE RXE-2 FIELD (GIVE CODE)
"RTN","RORHL031",168,0)
 ;
"RTN","RORHL031",169,0)
 ; IDGN          IEN of Drug File #50
"RTN","RORHL031",170,0)
 ;
"RTN","RORHL031",171,0)
 ; [CS]          Component Separator (defaults to "^")
"RTN","RORHL031",172,0)
 ;
"RTN","RORHL031",173,0)
 ; .RXE2         Reference to a local variable where the value
"RTN","RORHL031",174,0)
 ;               of the  RXE-2 field is returned
"RTN","RORHL031",175,0)
 ;
"RTN","RORHL031",176,0)
 ; Return Values:
"RTN","RORHL031",177,0)
 ;       <0  Error Code
"RTN","RORHL031",178,0)
 ;        0  Ok
"RTN","RORHL031",179,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL031",180,0)
 ;
"RTN","RORHL031",181,0)
RXE2(IDGN,CS,RXE2) ;
"RTN","RORHL031",182,0)
 N ERRCNT,RC,RORMSG,ROROUT,TMP,TMP1
"RTN","RORHL031",183,0)
 S (ERRCNT,RC)=0,RXE2=""
"RTN","RORHL031",184,0)
 ;
"RTN","RORHL031",185,0)
 S:$G(CS)="" CS="^"
"RTN","RORHL031",186,0)
 S IDGN=+$G(IDGN)_","                                 ; File 50 IEN
"RTN","RORHL031",187,0)
 ;
"RTN","RORHL031",188,0)
 D GETS^DIQ(50,IDGN,".01;2;20;22;27;31","EI","ROROUT","RORMSG")
"RTN","RORHL031",189,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL031",190,0)
 . D DBS^RORERR("RORMSG",-9,,,50,IDGN)
"RTN","RORHL031",191,0)
 ;
"RTN","RORHL031",192,0)
 S $P(RXE2,CS,1)=$G(ROROUT(50,IDGN,31,"E"))      ; NDC
"RTN","RORHL031",193,0)
 ;--- VA Product Name
"RTN","RORHL031",194,0)
 S TMP1=$E($G(ROROUT(50,IDGN,22,"E")),1,64)
"RTN","RORHL031",195,0)
 S $P(RXE2,CS,2)=$$ESCAPE^RORHL7(TMP1)
"RTN","RORHL031",196,0)
 S $P(RXE2,CS,3)="PSNDF"
"RTN","RORHL031",197,0)
 ;
"RTN","RORHL031",198,0)
 S TMP=""
"RTN","RORHL031",199,0)
 S $P(TMP,"-",1)=$G(ROROUT(50,IDGN,20,"I"))      ; VA Drug Code
"RTN","RORHL031",200,0)
 S $P(TMP,"-",2)=$G(ROROUT(50,IDGN,2,"E"))       ; VA Drug Class
"RTN","RORHL031",201,0)
 S:TMP'="-" $P(RXE2,CS,4)=TMP
"RTN","RORHL031",202,0)
 ;--- Drug Name
"RTN","RORHL031",203,0)
 S $P(RXE2,CS,5)=$$ESCAPE^RORHL7($G(ROROUT(50,IDGN,.01,"E")))
"RTN","RORHL031",204,0)
 S $P(RXE2,CS,6)="99PSD"
"RTN","RORHL031",205,0)
 ;
"RTN","RORHL031",206,0)
 S:($P(RXE2,CS,1,2)="^")&($P(RXE2,CS,4,5)="^") RXE2=""
"RTN","RORHL031",207,0)
 Q ERRCNT
"RTN","RORHL04")
0^23^B30377336
"RTN","RORHL04",1,0)
RORHL04 ;HOIFO/CRT,SG - HL7 RADIOLOGY: OBR,OBX ; 6/9/04 11:21am
"RTN","RORHL04",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,3,4,5,6**;May 14, 2002
"RTN","RORHL04",3,0)
 ;
"RTN","RORHL04",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL04",5,0)
 ;
"RTN","RORHL04",6,0)
 ; #65           Read access to file #70 (controlled)
"RTN","RORHL04",7,0)
 ; #65           Read access to file #70 (controlled)
"RTN","RORHL04",8,0)
 ; #118-B        Read access to file #71 (controlled)
"RTN","RORHL04",9,0)
 ; #118-D        Read access to file #72 (controlled)
"RTN","RORHL04",10,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORHL04",11,0)
 ; #2043         EN1^RAO7PC1 (supported)
"RTN","RORHL04",12,0)
 ; #10060        Read access to the file #200 (supported)
"RTN","RORHL04",13,0)
 ; #10090        Read access to the file #4 (supported)
"RTN","RORHL04",14,0)
 ;
"RTN","RORHL04",15,0)
 ; #15-C         Read access to file #74 (Private)
"RTN","RORHL04",16,0)
 ;
"RTN","RORHL04",17,0)
 Q
"RTN","RORHL04",18,0)
 ;
"RTN","RORHL04",19,0)
 ;***** SEARCHES RADIOLOGY FOR DATA
"RTN","RORHL04",20,0)
 ;
"RTN","RORHL04",21,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL04",22,0)
 ;
"RTN","RORHL04",23,0)
 ; RORSTDT       Start date (FileMan)
"RTN","RORHL04",24,0)
 ; RORENDT       End date   (FileMan)
"RTN","RORHL04",25,0)
 ;
"RTN","RORHL04",26,0)
 ; Return Values:
"RTN","RORHL04",27,0)
 ;       <0  Error code
"RTN","RORHL04",28,0)
 ;        0  Ok
"RTN","RORHL04",29,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",30,0)
 ;
"RTN","RORHL04",31,0)
 ; The ^TMP($J,"RAE1") global node is used by the function.
"RTN","RORHL04",32,0)
 ;
"RTN","RORHL04",33,0)
EN1(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL04",34,0)
 N CNI,DTI,ERRCNT,EXAMID,IENS,IENS74,RACN0,RC,STR1,TMP
"RTN","RORHL04",35,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",36,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL04",37,0)
 ;
"RTN","RORHL04",38,0)
 K ^TMP($J,"RAE1")
"RTN","RORHL04",39,0)
 D EN1^RAO7PC1(RORDFN,RORSTDT,RORENDT,999999999)
"RTN","RORHL04",40,0)
 ;
"RTN","RORHL04",41,0)
 S EXAMID=""
"RTN","RORHL04",42,0)
 F  S EXAMID=$O(^TMP($J,"RAE1",RORDFN,EXAMID))  Q:EXAMID=""  D
"RTN","RORHL04",43,0)
 . S DTI=$P(EXAMID,"-"),CNI=$P(EXAMID,"-",2)
"RTN","RORHL04",44,0)
 . S IENS=CNI_","_DTI_","_RORDFN_","
"RTN","RORHL04",45,0)
 . S STR=^TMP($J,"RAE1",RORDFN,EXAMID)
"RTN","RORHL04",46,0)
 . S RACN0=$P(STR,"^",2),IENS74=$P(STR,"^",5)
"RTN","RORHL04",47,0)
 . S TMP=$$OBR(IENS,RACN0)
"RTN","RORHL04",48,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL04",49,0)
 . S TMP=$$OBX(IENS,IENS74)
"RTN","RORHL04",50,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL04",51,0)
 ;
"RTN","RORHL04",52,0)
 K ^TMP($J,"RAE1")
"RTN","RORHL04",53,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL04",54,0)
 ;
"RTN","RORHL04",55,0)
 ;***** GENERATES THE RADIOLOGY OBR SEGMENT
"RTN","RORHL04",56,0)
 ;
"RTN","RORHL04",57,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",58,0)
 ;
"RTN","RORHL04",59,0)
 ; Return Values:
"RTN","RORHL04",60,0)
 ;       <0  Error code
"RTN","RORHL04",61,0)
 ;        0  Ok
"RTN","RORHL04",62,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",63,0)
 ;
"RTN","RORHL04",64,0)
OBR(RORIENS,RACN0) ;
"RTN","RORHL04",65,0)
 N BUF,CS,ERRCNT,IENS,IENS7002,RADTE,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL04",66,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",67,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL04",68,0)
 S CS=$E(HLECH,1)
"RTN","RORHL04",69,0)
 ;--- Check the parameters
"RTN","RORHL04",70,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",71,0)
 ;
"RTN","RORHL04",72,0)
 D GETS^DIQ(70.03,RORIENS,"2;14","IE","ROROUT","RORMSG")
"RTN","RORHL04",73,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.03,RORIENS)
"RTN","RORHL04",74,0)
 S IENS7002=$P(RORIENS,",",2,3)_","
"RTN","RORHL04",75,0)
 D GETS^DIQ(70.02,IENS7002,".01;3","IE","ROROUT","RORMSG")
"RTN","RORHL04",76,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.02,IENS7002)
"RTN","RORHL04",77,0)
 ;
"RTN","RORHL04",78,0)
 ;--- Initialize the segment
"RTN","RORHL04",79,0)
 S RORSEG="OBR"
"RTN","RORHL04",80,0)
 ;
"RTN","RORHL04",81,0)
 ;--- OBR-3 - Unique Accession #
"RTN","RORHL04",82,0)
 S BUF=$P(RORIENS,",",2)_"-"_$P(RORIENS,",")
"RTN","RORHL04",83,0)
 S RADTE=$G(ROROUT(70.02,IENS7002,.01,"I"))\1
"RTN","RORHL04",84,0)
 S $P(BUF,CS,2)=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_+RACN0
"RTN","RORHL04",85,0)
 S $P(BUF,CS,3)="L"
"RTN","RORHL04",86,0)
 S $P(RORSEG,HLFS,4)=BUF
"RTN","RORHL04",87,0)
 ;
"RTN","RORHL04",88,0)
 ;--- OBR-4 - Procedure & CPT Code
"RTN","RORHL04",89,0)
 S IENS=+$G(ROROUT(70.03,RORIENS,2,"I"))_","
"RTN","RORHL04",90,0)
 Q:IENS'>0 $$ERROR^RORERR(-95,,,,70.03,RORIENS,2)
"RTN","RORHL04",91,0)
 S TMP=+$$GET1^DIQ(71,IENS,9,"I",,"RORMSG")
"RTN","RORHL04",92,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,71,IENS)
"RTN","RORHL04",93,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,71,IENS,9)
"RTN","RORHL04",94,0)
 ;---
"RTN","RORHL04",95,0)
 S TMP=$$CPT^ICPTCOD(TMP)
"RTN","RORHL04",96,0)
 Q:TMP<0 $$ERROR^RORERR(-56,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL04",97,0)
 S BUF=$P(TMP,U,2)_CS_$$ESCAPE^RORHL7($P(TMP,U,3))_CS_"C4"
"RTN","RORHL04",98,0)
 ;---
"RTN","RORHL04",99,0)
 S $P(BUF,CS,4)=$G(ROROUT(70.03,RORIENS,2,"I"))
"RTN","RORHL04",100,0)
 S $P(BUF,CS,5)=$$ESCAPE^RORHL7($G(ROROUT(70.03,RORIENS,2,"E")))
"RTN","RORHL04",101,0)
 S $P(BUF,CS,6)="99RAP"
"RTN","RORHL04",102,0)
 S $P(RORSEG,HLFS,5)=BUF
"RTN","RORHL04",103,0)
 ;
"RTN","RORHL04",104,0)
 ;--- OBR-7 - Exam Date/Time
"RTN","RORHL04",105,0)
 S TMP=$$FMTHL7^XLFDT($G(ROROUT(70.02,IENS7002,.01,"I")))
"RTN","RORHL04",106,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,70.02,IENS7002,.01)
"RTN","RORHL04",107,0)
 S $P(RORSEG,HLFS,8)=TMP
"RTN","RORHL04",108,0)
 ;
"RTN","RORHL04",109,0)
 ;--- OBR-16 - Requesting Physician
"RTN","RORHL04",110,0)
 S BUF=+$G(ROROUT(70.03,RORIENS,14,"I"))
"RTN","RORHL04",111,0)
 I BUF>0  D
"RTN","RORHL04",112,0)
 . S $P(BUF,CS,5)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL04",113,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")  Q
"RTN","RORHL04",114,0)
 . S $P(RORSEG,HLFS,17)=BUF
"RTN","RORHL04",115,0)
 ;
"RTN","RORHL04",116,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL04",117,0)
 S $P(RORSEG,HLFS,25)="RAD"
"RTN","RORHL04",118,0)
 ;
"RTN","RORHL04",119,0)
 ;--- OBR-44 - Division
"RTN","RORHL04",120,0)
 S $P(RORSEG,HLFS,45)=$$SITE1^RORUTL03(CS)
"RTN","RORHL04",121,0)
 S IENS=+$G(ROROUT(70.02,IENS7002,3,"I"))_","
"RTN","RORHL04",122,0)
 I IENS>0  D
"RTN","RORHL04",123,0)
 . S BUF=$$ESCAPE^RORHL7($G(ROROUT(70.02,IENS7002,3,"E")))
"RTN","RORHL04",124,0)
 . S $P(BUF,CS,2)="99VA4"
"RTN","RORHL04",125,0)
 . S $P(BUF,CS,3)=$$GET1^DIQ(4,IENS,99,"I",,"RORMSG")
"RTN","RORHL04",126,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,4,IENS)  Q
"RTN","RORHL04",127,0)
 . S:$P(BUF,CS,3)'="" $P(RORSEG,HLFS,45)=BUF
"RTN","RORHL04",128,0)
 ;
"RTN","RORHL04",129,0)
 ;--- Store the segment
"RTN","RORHL04",130,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL04",131,0)
 Q ERRCNT
"RTN","RORHL04",132,0)
 ;
"RTN","RORHL04",133,0)
 ;***** GENERATES THE RADIOLOGY OBX SEGMENT
"RTN","RORHL04",134,0)
 ;
"RTN","RORHL04",135,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",136,0)
 ;
"RTN","RORHL04",137,0)
 ; Return Values:
"RTN","RORHL04",138,0)
 ;       <0  Error code
"RTN","RORHL04",139,0)
 ;        0  Ok
"RTN","RORHL04",140,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",141,0)
 ;
"RTN","RORHL04",142,0)
OBX(RORIENS,IENS74) ;
"RTN","RORHL04",143,0)
 N ERRCNT,RC,RORMSG,ROROUT,RORSEG,RORTXT,TMP
"RTN","RORHL04",144,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",145,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL04",146,0)
 S CS=$E(HLECH,1)
"RTN","RORHL04",147,0)
 ;--- Check the parameters
"RTN","RORHL04",148,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",149,0)
 ;
"RTN","RORHL04",150,0)
 ;--- Initialize the segment
"RTN","RORHL04",151,0)
 S RORSEG="OBX"
"RTN","RORHL04",152,0)
 ;
"RTN","RORHL04",153,0)
 ; OBX-2
"RTN","RORHL04",154,0)
 S $P(RORSEG,HLFS,3)="FT"
"RTN","RORHL04",155,0)
 ;
"RTN","RORHL04",156,0)
 ; OBX-11
"RTN","RORHL04",157,0)
 S $P(RORSEG,HLFS,12)="F"
"RTN","RORHL04",158,0)
 ;
"RTN","RORHL04",159,0)
 ;-- Get the Report Text
"RTN","RORHL04",160,0)
 S TMP=$$GET1^DIQ(74,IENS74,200,,"RORTXT","RORMSG")
"RTN","RORHL04",161,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",162,0)
 . D DBS^RORERR("RORMSG",-99,,,74,IENS74)
"RTN","RORHL04",163,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",164,0)
 . D LOOP(.RORTXT,"RT"_CS_"Report Text"_CS_"VA080")
"RTN","RORHL04",165,0)
 ;
"RTN","RORHL04",166,0)
 ;--- Get the Impression Report
"RTN","RORHL04",167,0)
 S TMP=$$GET1^DIQ(74,IENS74,300,,"RORTXT","RORMSG")
"RTN","RORHL04",168,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",169,0)
 . D DBS^RORERR("RORMSG",-99,,,74,IENS74)
"RTN","RORHL04",170,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",171,0)
 . D LOOP(.RORTXT,"IT"_CS_"Impression Text"_CS_"VA080")
"RTN","RORHL04",172,0)
 ;
"RTN","RORHL04",173,0)
 ;--- Get the Clinical History
"RTN","RORHL04",174,0)
 S TMP=$$GET1^DIQ(70.03,RORIENS,400,,"RORTXT","RORMSG")
"RTN","RORHL04",175,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL04",176,0)
 . D DBS^RORERR("RORMSG",-99,,,70.03,RORIENS)
"RTN","RORHL04",177,0)
 I $D(RORTXT)>1  D  K RORTXT
"RTN","RORHL04",178,0)
 . D LOOP(.RORTXT,"CH"_CS_"Clinical History"_CS_"VA080")
"RTN","RORHL04",179,0)
 ;
"RTN","RORHL04",180,0)
 Q ERRCNT
"RTN","RORHL04",181,0)
 ;
"RTN","RORHL04",182,0)
LOOP(RORAR,RORVAL) ;
"RTN","RORHL04",183,0)
 N RORHLS,RORK1
"RTN","RORHL04",184,0)
 S RORK1=""
"RTN","RORHL04",185,0)
 F  S RORK1=$O(RORAR(RORK1))  Q:RORK1=""  D
"RTN","RORHL04",186,0)
 . S $P(RORSEG,HLFS,2)=""
"RTN","RORHL04",187,0)
 . S $P(RORSEG,HLFS,4)=RORVAL
"RTN","RORHL04",188,0)
 . S $P(RORSEG,HLFS,6)=$$ESCAPE^RORHL7(RORAR(RORK1))
"RTN","RORHL04",189,0)
 . D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL04",190,0)
 Q
"RTN","RORHL07")
0^24^B22855009
"RTN","RORHL07",1,0)
RORHL07 ;HOIFO/BH - HL7 INPATIENT PHARMACY: ORC,RXE ; 6/9/04 11:22am
"RTN","RORHL07",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,5,6**;May 14, 2002
"RTN","RORHL07",3,0)
 ;
"RTN","RORHL07",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL07",5,0)
 ;
"RTN","RORHL07",6,0)
 ; Routine's RORHL07* use the following IAs:
"RTN","RORHL07",7,0)
 ;
"RTN","RORHL07",8,0)
 ; #93           Get stop code from the file #44 (controlled)
"RTN","RORHL07",9,0)
 ; #10040        Read the INSTITUTION field of file #44 (supported)
"RTN","RORHL07",10,0)
 ; #10060        Read access to file #200 (supported)
"RTN","RORHL07",11,0)
 ; #10090        Read access to file #4 (supported)
"RTN","RORHL07",12,0)
 ;
"RTN","RORHL07",13,0)
 ; #1977         Read access to file #52
"RTN","RORHL07",14,0)
 ; #1876         Read access to file #59
"RTN","RORHL07",15,0)
 ; #2497         Read access to file #55
"RTN","RORHL07",16,0)
 ; #221          Read access to file #50 and #50.68
"RTN","RORHL07",17,0)
 ; #2221         Read access to file 50.607
"RTN","RORHL07",18,0)
 ;
"RTN","RORHL07",19,0)
 Q
"RTN","RORHL07",20,0)
 ;
"RTN","RORHL07",21,0)
 ;***** INPATIENT PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL07",22,0)
 ;
"RTN","RORHL07",23,0)
 ; RORIENS       IENS of Unit/Dose in subfile #55.06
"RTN","RORHL07",24,0)
 ;
"RTN","RORHL07",25,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL07",26,0)
 ;
"RTN","RORHL07",27,0)
 ; Return Values:
"RTN","RORHL07",28,0)
 ;       <0  Error Code
"RTN","RORHL07",29,0)
 ;        0  Ok
"RTN","RORHL07",30,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL07",31,0)
 ;
"RTN","RORHL07",32,0)
ORC(RORIENS,RORORC) ;
"RTN","RORHL07",33,0)
 N BUF,CS,ERRCNT,IEN42,IEN44,RC,RORMSG,RORSEG,TMP
"RTN","RORHL07",34,0)
 S (ERRCNT,RC)=0
"RTN","RORHL07",35,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL07",36,0)
 S CS=$E(HLECH,1)
"RTN","RORHL07",37,0)
 ;--- Check the parameters
"RTN","RORHL07",38,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL07",39,0)
 ;
"RTN","RORHL07",40,0)
 ;--- Initialize the segment
"RTN","RORHL07",41,0)
 S RORSEG="ORC"
"RTN","RORHL07",42,0)
 ;
"RTN","RORHL07",43,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL07",44,0)
 S $P(RORSEG,HLFS,2)="NW"
"RTN","RORHL07",45,0)
 ;
"RTN","RORHL07",46,0)
 ;--- ORC-2 - Placer Order Number
"RTN","RORHL07",47,0)
 S TMP=$$GET1^DIQ(55.06,RORIENS,.01,,,"RORMSG")
"RTN","RORHL07",48,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,55.06,RORIENS)
"RTN","RORHL07",49,0)
 S $P(RORSEG,HLFS,3)=RORDFN_"V"_TMP_CS_"IP"
"RTN","RORHL07",50,0)
 ;
"RTN","RORHL07",51,0)
 ;--- ORC-12 - Provider
"RTN","RORHL07",52,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL07",53,0)
 I BUF>0  D
"RTN","RORHL07",54,0)
 . S $P(BUF,CS,5)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL07",55,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",56,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL07",57,0)
 . S $P(RORSEG,HLFS,13)=BUF
"RTN","RORHL07",58,0)
 ;
"RTN","RORHL07",59,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL07",60,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL07",61,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL07",62,0)
 S $P(RORSEG,HLFS,16)=TMP
"RTN","RORHL07",63,0)
 ;
"RTN","RORHL07",64,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL07",65,0)
 S $P(RORSEG,HLFS,17)=CS_CS_CS_CS_"NEW"
"RTN","RORHL07",66,0)
 ;
"RTN","RORHL07",67,0)
 ;--- ORC-17 - Division
"RTN","RORHL07",68,0)
 S IEN42=+$$GET1^DIQ(55.06,RORIENS,9,"I",,"RORMSG")
"RTN","RORHL07",69,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",70,0)
 . D DBS^RORERR("RORMSG",-99,,,55.06,RORIENS)
"RTN","RORHL07",71,0)
 I IEN42>0  D
"RTN","RORHL07",72,0)
 . S IEN44=+$$GET1^DIQ(42,IEN42_",",44,"I",,"RORMSG")
"RTN","RORHL07",73,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",74,0)
 . . D DBS^RORERR("RORMSG",-99,,,42,IEN42_",")
"RTN","RORHL07",75,0)
 E  S IEN44=0
"RTN","RORHL07",76,0)
 S $P(RORSEG,HLFS,18)=$$DIV44^RORHLUT1(IEN44,2,CS)
"RTN","RORHL07",77,0)
 ;
"RTN","RORHL07",78,0)
 ;--- Store the segment
"RTN","RORHL07",79,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL07",80,0)
 Q ERRCNT
"RTN","RORHL07",81,0)
 ;
"RTN","RORHL07",82,0)
 ;***** INPATIENT PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL07",83,0)
 ;
"RTN","RORHL07",84,0)
 ; RORIENS       IENS of Pharmacy Record in subfile #55.06
"RTN","RORHL07",85,0)
 ; .RORRXE       Array containing info (from OEL^PSJORRL)
"RTN","RORHL07",86,0)
 ;
"RTN","RORHL07",87,0)
 ; Return Values:
"RTN","RORHL07",88,0)
 ;       <0  Error Code
"RTN","RORHL07",89,0)
 ;        0  Ok
"RTN","RORHL07",90,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL07",91,0)
 ;
"RTN","RORHL07",92,0)
RXE(RORIENS,RORRXE) ;
"RTN","RORHL07",93,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,RC,RORMSG,RORMR,ROROUT,RORUIN,RORUOUT,RORQT,RORSEG,TMP
"RTN","RORHL07",94,0)
 S (ERRCNT,RC)=0
"RTN","RORHL07",95,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL07",96,0)
 S CS=$E(HLECH,1)
"RTN","RORHL07",97,0)
 ;--- Check the parameters
"RTN","RORHL07",98,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL07",99,0)
 ;
"RTN","RORHL07",100,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL07",101,0)
 ;
"RTN","RORHL07",102,0)
 ;--- Load the data
"RTN","RORHL07",103,0)
 D GETS^DIQ(55.06,RORIENS,"3;26","E","ROROUT","RORMSG")
"RTN","RORHL07",104,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",105,0)
 . D DBS^RORERR("RORMSG",-99,,,55.06,RORIENS)
"RTN","RORHL07",106,0)
 S RORMR=$$ESCAPE^RORHL7($G(ROROUT(55.06,RORIENS,3,"E")))
"RTN","RORHL07",107,0)
 S TMP=$G(ROROUT(55.06,RORIENS,26,"E")),RORQT=""
"RTN","RORHL07",108,0)
 S:TMP'="" $P(RORQT,CS,8)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL07",109,0)
 ;
"RTN","RORHL07",110,0)
 S II=0
"RTN","RORHL07",111,0)
 F  S II=$O(RORRXE("DD",II)) Q:II=""  D  Q:RC<0
"RTN","RORHL07",112,0)
 . K ROROUT
"RTN","RORHL07",113,0)
 . ;--- Initialize the segment
"RTN","RORHL07",114,0)
 . S RORSEG="RXE"
"RTN","RORHL07",115,0)
 . ;
"RTN","RORHL07",116,0)
 . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL07",117,0)
 . S $P(RORSEG,HLFS,2)=RORQT
"RTN","RORHL07",118,0)
 . ;
"RTN","RORHL07",119,0)
 . ;--- RXE-2 - Give Code
"RTN","RORHL07",120,0)
 . S IDGN=+$P($G(RORRXE("DD",II,0)),U)
"RTN","RORHL07",121,0)
 . S:IDGN'>0 IDGN=+$P($G(RORRXE("DD",II,0)),U,3)  Q:IDGN'>0
"RTN","RORHL07",122,0)
 . S BUF="",TMP=$$RXE2^RORHL031(IDGN,CS,.BUF)
"RTN","RORHL07",123,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL07",124,0)
 . Q:BUF=""
"RTN","RORHL07",125,0)
 . S $P(RORSEG,HLFS,3)=BUF
"RTN","RORHL07",126,0)
 . ;
"RTN","RORHL07",127,0)
 . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL07",128,0)
 . S $P(RORSEG,HLFS,4)=""""""
"RTN","RORHL07",129,0)
 . ;
"RTN","RORHL07",130,0)
 . ;--- RXE-5 - Give Units
"RTN","RORHL07",131,0)
 . S INDF=+$$GET1^DIQ(50,IDGN,22,"I",,"RORMSG")_"," ; File #50.68 IEN
"RTN","RORHL07",132,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL07",133,0)
 . . D DBS^RORERR("RORMSG",-99,,,50,IDGN)
"RTN","RORHL07",134,0)
 . I INDF>0  D
"RTN","RORHL07",135,0)
 . . S RORUIN=$$PROD0^PSNAPIS(,INDF)
"RTN","RORHL07",136,0)
 . . S RORUIN=$P(RORUIN,U,4)
"RTN","RORHL07",137,0)
 . . Q:'RORUIN
"RTN","RORHL07",138,0)
        . . S RORUOUT=$P($G(^PS(50.607,RORUIN,0)),U)
"RTN","RORHL07",139,0)
 . . S BUF=""
"RTN","RORHL07",140,0)
 . . S $P(BUF,CS,4)=RORUIN
"RTN","RORHL07",141,0)
 . . Q:$P(BUF,CS,4)=""
"RTN","RORHL07",142,0)
 . . S $P(BUF,CS,5)=$$ESCAPE^RORHL7(RORUOUT)
"RTN","RORHL07",143,0)
 . . S $P(BUF,CS,6)="99PSU"
"RTN","RORHL07",144,0)
 . . S $P(RORSEG,HLFS,6)=BUF
"RTN","RORHL07",145,0)
 . ;
"RTN","RORHL07",146,0)
 . ;--- RXE-18 - Stop Date/Time
"RTN","RORHL07",147,0)
 . S TMP=$P($G(RORRXE(0)),U,3)
"RTN","RORHL07",148,0)
 . S $P(RORSEG,HLFS,19)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL07",149,0)
 . ;
"RTN","RORHL07",150,0)
 . ;--- RXE-21 - Medication Route
"RTN","RORHL07",151,0)
 . S:RORMR'="" $P(RORSEG,HLFS,22)=RORMR
"RTN","RORHL07",152,0)
 . ;
"RTN","RORHL07",153,0)
 . ;--- RXE-24 - Units per dose
"RTN","RORHL07",154,0)
 . S TMP=$P($G(RORRXE("DD",II,0)),U,2)
"RTN","RORHL07",155,0)
 . S TMP=+TMP
"RTN","RORHL07",156,0)
 . S:TMP'="" $P(RORSEG,HLFS,25)=TMP
"RTN","RORHL07",157,0)
 . ;
"RTN","RORHL07",158,0)
 . ;--- Store the segment
"RTN","RORHL07",159,0)
 . D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL07",160,0)
 ;
"RTN","RORHL07",161,0)
 Q ERRCNT
"RTN","RORHL071")
0^25^B20578244
"RTN","RORHL071",1,0)
RORHL071 ;HOIFO/BH - HL7 IV PHARMACY: ORC,RXE ; 6/9/04 11:23am
"RTN","RORHL071",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORHL071",3,0)
 ;
"RTN","RORHL071",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL071",5,0)
 ;
"RTN","RORHL071",6,0)
 ; See RORHL07 for RORHL07* IA's.
"RTN","RORHL071",7,0)
 ;
"RTN","RORHL071",8,0)
 Q
"RTN","RORHL071",9,0)
 ;
"RTN","RORHL071",10,0)
 ;***** IV PHARMACY ORC SEGMENT BUILDER
"RTN","RORHL071",11,0)
 ;
"RTN","RORHL071",12,0)
 ; RORIENS       IENS of IV in subfile #55.01
"RTN","RORHL071",13,0)
 ;
"RTN","RORHL071",14,0)
 ; .RORORC       Array with info (from OEL^PSOORRL)
"RTN","RORHL071",15,0)
 ;
"RTN","RORHL071",16,0)
 ; Return Values:
"RTN","RORHL071",17,0)
 ;       <0  Error Code
"RTN","RORHL071",18,0)
 ;        0  Ok
"RTN","RORHL071",19,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL071",20,0)
 ;
"RTN","RORHL071",21,0)
ORC(RORIENS,RORORC) ;
"RTN","RORHL071",22,0)
 N BUF,CS,ERRCNT,IEN42,IEN44,RC,RORMSG,RORSEG,TMP
"RTN","RORHL071",23,0)
 S (ERRCNT,RC)=0
"RTN","RORHL071",24,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL071",25,0)
 S CS=$E(HLECH,1)
"RTN","RORHL071",26,0)
 ;--- Check the parameters
"RTN","RORHL071",27,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL071",28,0)
 ;
"RTN","RORHL071",29,0)
 ;--- Initialize the segment
"RTN","RORHL071",30,0)
 S RORSEG="ORC"
"RTN","RORHL071",31,0)
 ;
"RTN","RORHL071",32,0)
 ;--- ORC-1 - Order Control 
"RTN","RORHL071",33,0)
 S $P(RORSEG,HLFS,2)="NW"
"RTN","RORHL071",34,0)
 ;
"RTN","RORHL071",35,0)
 ;--- ORC-2 - Placer Order Number
"RTN","RORHL071",36,0)
 S TMP=$$GET1^DIQ(55.01,RORIENS,.01,,,"RORMSG")
"RTN","RORHL071",37,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,55.01,RORIENS)
"RTN","RORHL071",38,0)
 S $P(RORSEG,HLFS,3)=RORDFN_"V"_TMP_CS_"IP"
"RTN","RORHL071",39,0)
 ;
"RTN","RORHL071",40,0)
 ;--- ORC-12 - Provider
"RTN","RORHL071",41,0)
 S BUF=+$P($G(RORORC("P",0)),U)
"RTN","RORHL071",42,0)
 I BUF>0  D
"RTN","RORHL071",43,0)
 . S $P(BUF,CS,5)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL071",44,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",45,0)
 . . D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")
"RTN","RORHL071",46,0)
 . S $P(RORSEG,HLFS,13)=BUF
"RTN","RORHL071",47,0)
 ;
"RTN","RORHL071",48,0)
 ;--- ORC-15 - Order Date/Time
"RTN","RORHL071",49,0)
 S TMP=$$FMTHL7^XLFDT($P($G(RORORC(0)),U,5))
"RTN","RORHL071",50,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No order date","OEL^PSOORRL")
"RTN","RORHL071",51,0)
 S $P(RORSEG,HLFS,16)=TMP
"RTN","RORHL071",52,0)
 ;
"RTN","RORHL071",53,0)
 ;--- ORC-16 - Control Code Reason
"RTN","RORHL071",54,0)
 S $P(RORSEG,HLFS,17)=CS_CS_CS_CS_"NEW"
"RTN","RORHL071",55,0)
 ;
"RTN","RORHL071",56,0)
 ;--- ORC-17 - Division
"RTN","RORHL071",57,0)
 S IEN42=+$$GET1^DIQ(55.01,RORIENS,9,"I",,"RORMSG")
"RTN","RORHL071",58,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",59,0)
 . D DBS^RORERR("RORMSG",-99,,,55.01,RORIENS)
"RTN","RORHL071",60,0)
 I IEN42>0  D
"RTN","RORHL071",61,0)
 . S IEN44=+$$GET1^DIQ(42,IEN42_",",44,"I",,"RORMSG")
"RTN","RORHL071",62,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",63,0)
 . . D DBS^RORERR("RORMSG",-99,,,42,IEN42_",")
"RTN","RORHL071",64,0)
 E  S IEN44=0
"RTN","RORHL071",65,0)
 S $P(RORSEG,HLFS,18)=$$DIV44^RORHLUT1(IEN44,2,CS)
"RTN","RORHL071",66,0)
 ;
"RTN","RORHL071",67,0)
 ;--- Store the segment
"RTN","RORHL071",68,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL071",69,0)
 Q ERRCNT
"RTN","RORHL071",70,0)
 ;
"RTN","RORHL071",71,0)
 ;***** IV PHARMACY RXE SEGMENT BUILDER
"RTN","RORHL071",72,0)
 ;
"RTN","RORHL071",73,0)
 ; RORIENS       IENS of Pharmacy Record in subfile #55.01
"RTN","RORHL071",74,0)
 ; .RORRXE       Array containing info (from OEL^PSJORRL)
"RTN","RORHL071",75,0)
 ;
"RTN","RORHL071",76,0)
 ; Return Values:
"RTN","RORHL071",77,0)
 ;       <0  Error Code
"RTN","RORHL071",78,0)
 ;        0  Ok
"RTN","RORHL071",79,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL071",80,0)
 ;
"RTN","RORHL071",81,0)
RXE(RORIENS,RORRXE) ;
"RTN","RORHL071",82,0)
 N BUF,CS,ERRCNT,IDGN,II,INDF,RC,RORMSG,RORMR,ROROUT,RORQT,RORSEG,RORUIN,RORUOUT,TMP
"RTN","RORHL071",83,0)
 S (ERRCNT,RC)=0
"RTN","RORHL071",84,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL071",85,0)
 S CS=$E(HLECH,1)
"RTN","RORHL071",86,0)
 ;--- Check the parameters
"RTN","RORHL071",87,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL071",88,0)
 ;
"RTN","RORHL071",89,0)
 Q:$P($G(RORRXE(0)),U)="" 0
"RTN","RORHL071",90,0)
 ;
"RTN","RORHL071",91,0)
 ;--- Load the data
"RTN","RORHL071",92,0)
 D GETS^DIQ(55.01,RORIENS,"132;.09","E","ROROUT","RORMSG")
"RTN","RORHL071",93,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",94,0)
 . D DBS^RORERR("RORMSG",-99,,,55.01,RORIENS)
"RTN","RORHL071",95,0)
 S RORMR=$$ESCAPE^RORHL7($G(ROROUT(55.01,RORIENS,132,"E")))
"RTN","RORHL071",96,0)
 S TMP=$G(ROROUT(55.01,RORIENS,.09,"E")),RORQT=""
"RTN","RORHL071",97,0)
 S:TMP'="" $P(RORQT,CS,8)=$$ESCAPE^RORHL7(TMP)
"RTN","RORHL071",98,0)
 ;
"RTN","RORHL071",99,0)
 S II=0
"RTN","RORHL071",100,0)
 F  S II=$O(RORRXE("DD",II)) Q:II=""  D  Q:RC<0
"RTN","RORHL071",101,0)
 . K ROROUT
"RTN","RORHL071",102,0)
 . ;--- Initialize the segment
"RTN","RORHL071",103,0)
 . S RORSEG="RXE"
"RTN","RORHL071",104,0)
 . ;
"RTN","RORHL071",105,0)
 . ;--- RXE-1 - Quantity/Timing
"RTN","RORHL071",106,0)
 . S $P(RORSEG,HLFS,2)=RORQT
"RTN","RORHL071",107,0)
 . ;
"RTN","RORHL071",108,0)
 . ;--- RXE-2 - Give Code
"RTN","RORHL071",109,0)
 . S IDGN=+$P($G(RORRXE("DD",II,0)),U)
"RTN","RORHL071",110,0)
 . S:IDGN'>0 IDGN=+$P($G(RORRXE("DD",II,0)),U,3)  Q:IDGN'>0
"RTN","RORHL071",111,0)
 . S BUF="",TMP=$$RXE2^RORHL031(IDGN,CS,.BUF)
"RTN","RORHL071",112,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL071",113,0)
 . Q:BUF=""
"RTN","RORHL071",114,0)
 . S $P(RORSEG,HLFS,3)=BUF
"RTN","RORHL071",115,0)
 . ;
"RTN","RORHL071",116,0)
 . ;--- RXE-3 - Give Amount (Min)
"RTN","RORHL071",117,0)
 . S $P(RORSEG,HLFS,4)=""""""
"RTN","RORHL071",118,0)
 . ;
"RTN","RORHL071",119,0)
 . ;--- RXE-5 - Give Units
"RTN","RORHL071",120,0)
 . S INDF=+$$GET1^DIQ(50,IDGN,22,"I",,"RORMSG")_"," ; File #50.68 IEN
"RTN","RORHL071",121,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL071",122,0)
 . . D DBS^RORERR("RORMSG",-99,,,50,IDGN)
"RTN","RORHL071",123,0)
 . I INDF>0  D
"RTN","RORHL071",124,0)
 . . S RORUIN=$$PROD0^PSNAPIS(,INDF)
"RTN","RORHL071",125,0)
 . . S RORUIN=$P(RORUIN,U,4)
"RTN","RORHL071",126,0)
 . . S RORUOUT=$P(^PS(50.607,RORUIN,0),U)
"RTN","RORHL071",127,0)
 . . S BUF=""
"RTN","RORHL071",128,0)
 . . S $P(BUF,CS,4)=RORUIN
"RTN","RORHL071",129,0)
 . . Q:$P(BUF,CS,4)=""
"RTN","RORHL071",130,0)
 . . S $P(BUF,CS,5)=$$ESCAPE^RORHL7(RORUOUT)
"RTN","RORHL071",131,0)
 . . S $P(BUF,CS,6)="99PSU"
"RTN","RORHL071",132,0)
 . . S $P(RORSEG,HLFS,6)=BUF
"RTN","RORHL071",133,0)
 . ;
"RTN","RORHL071",134,0)
 . ;--- RXE-18 - Stop Date/Time
"RTN","RORHL071",135,0)
 . S TMP=$P($G(RORRXE(0)),U,3)
"RTN","RORHL071",136,0)
 . S $P(RORSEG,HLFS,19)=$$FM2HL^RORHL7(TMP)
"RTN","RORHL071",137,0)
 . ;
"RTN","RORHL071",138,0)
 . ;--- RXE-21 - Medication Route
"RTN","RORHL071",139,0)
 . S:RORMR'="" $P(RORSEG,HLFS,22)=RORMR
"RTN","RORHL071",140,0)
 . ;
"RTN","RORHL071",141,0)
 . ;--- RXE-24 - Units per dose
"RTN","RORHL071",142,0)
 . S TMP=$P($G(RORRXE("DD",II,0)),U,2)
"RTN","RORHL071",143,0)
 . S TMP=+TMP
"RTN","RORHL071",144,0)
 . S:TMP'="" $P(RORSEG,HLFS,25)=TMP
"RTN","RORHL071",145,0)
 . ;
"RTN","RORHL071",146,0)
 . ;--- Store the segment
"RTN","RORHL071",147,0)
 . D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL071",148,0)
 ;
"RTN","RORHL071",149,0)
 Q ERRCNT
"RTN","RORHL09")
0^14^B51776008
"RTN","RORHL09",1,0)
RORHL09 ;HOIFO/BH - HL7 OUTPATIENT DATA: PV1,OBR,OBX ; 6/9/04 11:26am
"RTN","RORHL09",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORHL09",3,0)
 ;
"RTN","RORHL09",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL09",5,0)
 ;
"RTN","RORHL09",6,0)
 ; #1889     Use of the ENCEVENT^PXKENC API
"RTN","RORHL09",7,0)
 ; #3094     Read access to the 'AA' x-ref in VISIT file (#9000010)
"RTN","RORHL09",8,0)
 ; #93       Get stop code from the file #44 (controlled)
"RTN","RORHL09",9,0)
 ; #10060    Read access to the file #200 (supported)
"RTN","RORHL09",10,0)
 ; #2815     Get CPT code from the file #81 (supported)
"RTN","RORHL09",11,0)
 ; #10082    Get ICD-9 code from the file #80 (supported)
"RTN","RORHL09",12,0)
 ;
"RTN","RORHL09",13,0)
 Q
"RTN","RORHL09",14,0)
 ;
"RTN","RORHL09",15,0)
 ;***** OUTPATIENT DATA SEGMENT BUILDER
"RTN","RORHL09",16,0)
 ;
"RTN","RORHL09",17,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",18,0)
 ;
"RTN","RORHL09",19,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL09",20,0)
 ;               data extraction time frames are stored.
"RTN","RORHL09",21,0)
 ;
"RTN","RORHL09",22,0)
 ; RORTY         Set to either "PV1" or "OBR"
"RTN","RORHL09",23,0)
 ;
"RTN","RORHL09",24,0)
 ; Return Values:
"RTN","RORHL09",25,0)
 ;       <0  Error Code
"RTN","RORHL09",26,0)
 ;        0  Ok
"RTN","RORHL09",27,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",28,0)
 ;
"RTN","RORHL09",29,0)
 ; The function uses the ^TMP("RORHL08",$J) and ^TMP("PXKENC",$J)
"RTN","RORHL09",30,0)
 ; global nodes.
"RTN","RORHL09",31,0)
 ;
"RTN","RORHL09",32,0)
EN1(RORDFN,DXDTS,RORTY) ;
"RTN","RORHL09",33,0)
 N ERRCNT,PIEN,PV1CNT,RC
"RTN","RORHL09",34,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL09",35,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",36,0)
 ;
"RTN","RORHL09",37,0)
 ;--- PV1 Segments
"RTN","RORHL09",38,0)
 I RORTY="PV1"  K ^TMP("PXKENC",$J),^TMP("RORHL09",$J)  D
"RTN","RORHL09",39,0)
 . N IDX,INVDT,ROREND
"RTN","RORHL09",40,0)
 . S (IDX,PV1CNT)=0
"RTN","RORHL09",41,0)
 . F  S IDX=$O(DXDTS(2,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL09",42,0)
 . . S INVDT=9999999-$$FMADD^XLFDT($P(DXDTS(2,IDX),U)\1,-1)
"RTN","RORHL09",43,0)
 . . S ROREND=9999999-$P(DXDTS(2,IDX),U,2)
"RTN","RORHL09",44,0)
 . . F  S INVDT=$O(^AUPNVSIT("AA",RORDFN,INVDT),-1)  Q:'INVDT!(INVDT'>ROREND)  D
"RTN","RORHL09",45,0)
 . . . S PIEN=""
"RTN","RORHL09",46,0)
 . . . F  S PIEN=$O(^AUPNVSIT("AA",RORDFN,INVDT,PIEN),-1)  Q:'PIEN  D
"RTN","RORHL09",47,0)
 . . . . S TMP=$$PV1(PIEN,RORDFN)
"RTN","RORHL09",48,0)
 . . . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL09",49,0)
 . . . . ;--- Reference for the corresponding OBR segment
"RTN","RORHL09",50,0)
 . . . . S:TMP'="S" PV1CNT=PV1CNT+1,^TMP("RORHL09",$J,PV1CNT)=PIEN
"RTN","RORHL09",51,0)
 ;
"RTN","RORHL09",52,0)
 ;--- OBR and OBX Segments
"RTN","RORHL09",53,0)
 I RORTY="OBR"  D  K ^TMP("PXKENC",$J),^TMP("RORHL09",$J)
"RTN","RORHL09",54,0)
 . S PV1CNT=0
"RTN","RORHL09",55,0)
 . F  S PV1CNT=$O(^TMP("RORHL09",$J,PV1CNT))  Q:PV1CNT'>0  D
"RTN","RORHL09",56,0)
 . . S PIEN=+$G(^TMP("RORHL09",$J,PV1CNT))  Q:PIEN'>0
"RTN","RORHL09",57,0)
 . . ;---
"RTN","RORHL09",58,0)
 . . S TMP=$$OBR(PIEN,RORDFN)
"RTN","RORHL09",59,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL09",60,0)
 . . ;---
"RTN","RORHL09",61,0)
 . . S TMP=$$OBX(PIEN,RORDFN)
"RTN","RORHL09",62,0)
 . . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL09",63,0)
 ;
"RTN","RORHL09",64,0)
 ;--- Check for errors
"RTN","RORHL09",65,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL09",66,0)
 ;
"RTN","RORHL09",67,0)
 ;***** PV1 SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",68,0)
 ;
"RTN","RORHL09",69,0)
 ; RORIEN        IEN of file #9000010
"RTN","RORHL09",70,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",71,0)
 ;
"RTN","RORHL09",72,0)
 ; Return Values:
"RTN","RORHL09",73,0)
 ;       <0  Error Code
"RTN","RORHL09",74,0)
 ;        0  Ok
"RTN","RORHL09",75,0)
 ;      "S"  No visit data
"RTN","RORHL09",76,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",77,0)
 ;
"RTN","RORHL09",78,0)
PV1(RORIEN,RORDFN) ;
"RTN","RORHL09",79,0)
 N BUF,CLASS,CS,ERRCNT,IENS,KK4,RC,REC,REP,RORCLIN,RORMSG,PRV,TMP,TMP1,VST0
"RTN","RORHL09",80,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",81,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL09",82,0)
 S CS=$E(HLECH,1),REP=$E(HLECH,2,2)
"RTN","RORHL09",83,0)
 ;
"RTN","RORHL09",84,0)
 ;--- Get Visit Data
"RTN","RORHL09",85,0)
 D ENCEVENT^PXKENC(RORIEN,1)
"RTN","RORHL09",86,0)
 Q:$D(^TMP("PXKENC",$J,RORIEN))<10 "S"
"RTN","RORHL09",87,0)
 S VST0=$G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,0))
"RTN","RORHL09",88,0)
 ;
"RTN","RORHL09",89,0)
 ;--- Do not send visits with the following service categories: Daily
"RTN","RORHL09",90,0)
 ;--- Hospitalization (D), Ancillary (X), Chart (C), Not Found (N),
"RTN","RORHL09",91,0)
 ;                    (E), Event Historical, Hospitalization (H).
"RTN","RORHL09",92,0)
 Q:"HEDXNC"[$P(VST0,U,7) "S"
"RTN","RORHL09",93,0)
 ;
"RTN","RORHL09",94,0)
 ;--- Initialize the segment
"RTN","RORHL09",95,0)
 S RORSEG="PV1"
"RTN","RORHL09",96,0)
 ;
"RTN","RORHL09",97,0)
 ;--- PV1-2 - Patient Class
"RTN","RORHL09",98,0)
 S $P(RORSEG,HLFS,3)="O"  ; O - Outpatient
"RTN","RORHL09",99,0)
 ;
"RTN","RORHL09",100,0)
 ;--- PV1-3 - Assigned Patient Location
"RTN","RORHL09",101,0)
 S RORCLIN=+$P(VST0,U,22),BUF=""
"RTN","RORHL09",102,0)
 I RORCLIN>0  D
"RTN","RORHL09",103,0)
 . S IENS=RORCLIN_","
"RTN","RORHL09",104,0)
 . S TMP=$$GET1^DIQ(44,IENS,3.5,"I")  Q:TMP'>0
"RTN","RORHL09",105,0)
 . S BUF=$$GET1^DIQ(40.8,TMP,1)       Q:BUF=""
"RTN","RORHL09",106,0)
 . S TMP=$$STOPCODE^RORUTL18(+RORCLIN)
"RTN","RORHL09",107,0)
 . S $P(BUF,CS,6)=$S(TMP>0:TMP,1:"")
"RTN","RORHL09",108,0)
 Q:$P(BUF,CS,6)="" "S"  ; No Stop Code
"RTN","RORHL09",109,0)
 S $P(RORSEG,HLFS,4)=BUF
"RTN","RORHL09",110,0)
 ;
"RTN","RORHL09",111,0)
 ; PV1-4  - Admission Type
"RTN","RORHL09",112,0)
 S TMP=$P($G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,150)),U,3)
"RTN","RORHL09",113,0)
 S $P(RORSEG,HLFS,5)=TMP
"RTN","RORHL09",114,0)
 ;
"RTN","RORHL09",115,0)
 ;--- PV1-7 - Attending Physician
"RTN","RORHL09",116,0)
 S (KK4,BUF)=""
"RTN","RORHL09",117,0)
 F  S KK4=$O(^TMP("PXKENC",$J,RORIEN,"PRV",KK4))  Q:KK4=""  D
"RTN","RORHL09",118,0)
 . S REC=$G(^TMP("PXKENC",$J,RORIEN,"PRV",KK4,0))
"RTN","RORHL09",119,0)
 . S PRV=+$P(REC,U)  Q:(PRV'>0)!($P(REC,U,4)'="P")
"RTN","RORHL09",120,0)
 . S $P(PRV,CS,13)=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL09",121,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",122,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,PRV_",")
"RTN","RORHL09",123,0)
 . S BUF=BUF_REP_PRV
"RTN","RORHL09",124,0)
 S $P(RORSEG,HLFS,8)=$P(BUF,REP,2,999)
"RTN","RORHL09",125,0)
 ;
"RTN","RORHL09",126,0)
 ;--- PV1-19 - Visit Number (KEY)
"RTN","RORHL09",127,0)
 S $P(RORSEG,HLFS,20)=RORIEN
"RTN","RORHL09",128,0)
 ;
"RTN","RORHL09",129,0)
 ;--- PV1-44 - Admit Date/Time (KEY)
"RTN","RORHL09",130,0)
 S TMP=$$FMTHL7^XLFDT($P(VST0,U))
"RTN","RORHL09",131,0)
 I TMP'>0  D  Q RC
"RTN","RORHL09",132,0)
 . S RC=$$ERROR^RORERR(-100,,,,"No admission date","ENCEVENT^PXKENC")
"RTN","RORHL09",133,0)
 S $P(RORSEG,HLFS,45)=TMP
"RTN","RORHL09",134,0)
 ;
"RTN","RORHL09",135,0)
 ;--- PV1-51 - Visit Indicator
"RTN","RORHL09",136,0)
 S TMP=$P(VST0,U,11)
"RTN","RORHL09",137,0)
 S $P(RORSEG,HLFS,51)=$S(TMP'="":TMP,1:0)
"RTN","RORHL09",138,0)
 ;
"RTN","RORHL09",139,0)
 ;--- Store the segment
"RTN","RORHL09",140,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL09",141,0)
 Q ERRCNT
"RTN","RORHL09",142,0)
 ;
"RTN","RORHL09",143,0)
 ;***** OBR SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",144,0)
 ;
"RTN","RORHL09",145,0)
 ; RORIEN        IEN of file #9000010
"RTN","RORHL09",146,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",147,0)
 ;
"RTN","RORHL09",148,0)
 ; Return Values:
"RTN","RORHL09",149,0)
 ;       <0  Error Code
"RTN","RORHL09",150,0)
 ;        0  Ok
"RTN","RORHL09",151,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",152,0)
 ;
"RTN","RORHL09",153,0)
OBR(RORIEN,RORDFN) ;
"RTN","RORHL09",154,0)
 N BUF,BUF1,CS,ERRCNT,RC,RORCLIN,RORDIV,RORSEG,TMP
"RTN","RORHL09",155,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",156,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL09",157,0)
 S CS=$E(HLECH,1)
"RTN","RORHL09",158,0)
 ;
"RTN","RORHL09",159,0)
 ;--- Initialize the segment
"RTN","RORHL09",160,0)
 S RORSEG="OBR"
"RTN","RORHL09",161,0)
 ;
"RTN","RORHL09",162,0)
 ;--- OBR-3 - Order Number
"RTN","RORHL09",163,0)
 S $P(RORSEG,HLFS,4)=RORIEN
"RTN","RORHL09",164,0)
 ;
"RTN","RORHL09",165,0)
 ;--- OBR-4 - Universal Service ID
"RTN","RORHL09",166,0)
 S $P(RORSEG,HLFS,5)="OP"_CS_"Outpatient"_CS_"C4"
"RTN","RORHL09",167,0)
 ;
"RTN","RORHL09",168,0)
 S TMP=$G(^TMP("PXKENC",$J,RORIEN,"VST",RORIEN,0))
"RTN","RORHL09",169,0)
 S RORCLIN=$P(TMP,U,22)
"RTN","RORHL09",170,0)
 ;
"RTN","RORHL09",171,0)
 ;--- OBR-7 - Visit Date (KEY)
"RTN","RORHL09",172,0)
 S TMP=$$FMTHL7^XLFDT($P(TMP,U))
"RTN","RORHL09",173,0)
 Q:TMP'>0 $$ERROR^RORERR(-100,,,,"No visit date","ENCEVENT^PXKENC")
"RTN","RORHL09",174,0)
 S $P(RORSEG,HLFS,8)=TMP
"RTN","RORHL09",175,0)
 ;
"RTN","RORHL09",176,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL09",177,0)
 S $P(RORSEG,HLFS,25)="PHY"
"RTN","RORHL09",178,0)
 ;
"RTN","RORHL09",179,0)
 ;--- OBR-44 - Division
"RTN","RORHL09",180,0)
 S BUF1=$$SITE1^RORUTL03(CS)
"RTN","RORHL09",181,0)
 I RORCLIN>0 D
"RTN","RORHL09",182,0)
 . S RORDIV=$$GET1^DIQ(44,RORCLIN,3.5,"I")
"RTN","RORHL09",183,0)
 . Q:RORDIV=""
"RTN","RORHL09",184,0)
 . S RORDIV=$$GET1^DIQ(40.8,RORDIV,1)
"RTN","RORHL09",185,0)
 . Q:RORDIV=""
"RTN","RORHL09",186,0)
 . S BUF1=RORDIV
"RTN","RORHL09",187,0)
 S $P(RORSEG,HLFS,45)=BUF1
"RTN","RORHL09",188,0)
 ;
"RTN","RORHL09",189,0)
 ;--- Store the segment
"RTN","RORHL09",190,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL09",191,0)
 Q ERRCNT
"RTN","RORHL09",192,0)
 ;
"RTN","RORHL09",193,0)
 ;***** OBX SEGMENT BUILDER (OUTPATIENT)
"RTN","RORHL09",194,0)
 ;
"RTN","RORHL09",195,0)
 ; RORIEN        IEN of file #9000010
"RTN","RORHL09",196,0)
 ; RORDFN        DFN of Patient Record in File #2
"RTN","RORHL09",197,0)
 ;
"RTN","RORHL09",198,0)
 ; Return Values:
"RTN","RORHL09",199,0)
 ;       <0  Error Code
"RTN","RORHL09",200,0)
 ;        0  Ok
"RTN","RORHL09",201,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL09",202,0)
 ;
"RTN","RORHL09",203,0)
OBX(RORIEN,RORDFN) ;
"RTN","RORHL09",204,0)
 N CS,ERRCNT,RC,RORLST,RORMSG,RORSEG,TMP
"RTN","RORHL09",205,0)
 S (ERRCNT,RC)=0
"RTN","RORHL09",206,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL09",207,0)
 S CS=$E(HLECH)
"RTN","RORHL09",208,0)
 ;
"RTN","RORHL09",209,0)
 ;--- Procedures
"RTN","RORHL09",210,0)
 I $D(^TMP("PXKENC",$J,RORIEN,"CPT"))>1  D  Q:RC<0 RC
"RTN","RORHL09",211,0)
 . S RC=$$PROCS()  S:RC ERRCNT=ERRCNT+1
"RTN","RORHL09",212,0)
 ;--- Diagnosis codes
"RTN","RORHL09",213,0)
 I $D(^TMP("PXKENC",$J,RORIEN,"POV"))>1  D  Q:RC<0 RC
"RTN","RORHL09",214,0)
 . S RC=$$DIAGS()  S:RC ERRCNT=ERRCNT+1
"RTN","RORHL09",215,0)
 ;
"RTN","RORHL09",216,0)
 Q ERRCNT
"RTN","RORHL09",217,0)
 ; 
"RTN","RORHL09",218,0)
 ;***** PROCESSES PROCEDURES
"RTN","RORHL09",219,0)
PROCS() ;
"RTN","RORHL09",220,0)
 N CLASS,ERRCNT,IEN,K5,OID,PROC,PRV,REC,RORMSG,TMP
"RTN","RORHL09",221,0)
 S ERRCNT=0
"RTN","RORHL09",222,0)
 S OID="OCPT"_CS_"Procedures"_CS_"VA080"
"RTN","RORHL09",223,0)
 S K5=""
"RTN","RORHL09",224,0)
 F  S K5=$O(^TMP("PXKENC",$J,RORIEN,"CPT",K5))  Q:K5=""  D
"RTN","RORHL09",225,0)
 . S REC=$G(^TMP("PXKENC",$J,RORIEN,"CPT",K5,0))
"RTN","RORHL09",226,0)
 . ;---
"RTN","RORHL09",227,0)
 . S IEN=+$P(REC,U)  Q:IEN'>0
"RTN","RORHL09",228,0)
 . S PROC=$$GET1^DIQ(81,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL09",229,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",230,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,81,IEN_",")
"RTN","RORHL09",231,0)
 . Q:PROC=""
"RTN","RORHL09",232,0)
 . ;---
"RTN","RORHL09",233,0)
 . S PRV=+$P($G(^TMP("PXKENC",$J,RORIEN,"CPT",K5,12)),U,4)
"RTN","RORHL09",234,0)
 . Q:PRV'>0
"RTN","RORHL09",235,0)
 . ;---
"RTN","RORHL09",236,0)
 . S $P(PRV,CS,13)=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL09",237,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",238,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,PRV_",")
"RTN","RORHL09",239,0)
 . ;---
"RTN","RORHL09",240,0)
 . D SETOBX(OID,PROC,PRV)
"RTN","RORHL09",241,0)
 Q ERRCNT
"RTN","RORHL09",242,0)
 ;
"RTN","RORHL09",243,0)
 ;***** PROCESSES DIAGNOSIS CODES
"RTN","RORHL09",244,0)
DIAGS() ;
"RTN","RORHL09",245,0)
 N DIAG,ERRCNT,IEN,K5,OID,REC,RORMSG,TMP
"RTN","RORHL09",246,0)
 S ERRCNT=0
"RTN","RORHL09",247,0)
 S OID="OICD9"_CS_"Diagnosis"_CS_"VA080"
"RTN","RORHL09",248,0)
 S K5=""
"RTN","RORHL09",249,0)
 F  S K5=$O(^TMP("PXKENC",$J,RORIEN,"POV",K5))  Q:K5=""  D
"RTN","RORHL09",250,0)
 . S REC=^TMP("PXKENC",$J,RORIEN,"POV",K5,0)
"RTN","RORHL09",251,0)
 . ;---
"RTN","RORHL09",252,0)
 . S IEN=+$P(REC,U)  Q:IEN'>0
"RTN","RORHL09",253,0)
 . S DIAG=$$GET1^DIQ(80,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL09",254,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL09",255,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,80,IEN_",")
"RTN","RORHL09",256,0)
 . ;---
"RTN","RORHL09",257,0)
 . D:DIAG'="" SETOBX(OID,DIAG)
"RTN","RORHL09",258,0)
 Q ERRCNT
"RTN","RORHL09",259,0)
 ;
"RTN","RORHL09",260,0)
 ;***** GENERATES OBX SEGMENT
"RTN","RORHL09",261,0)
SETOBX(PIECE3,PIECE5,PIECE16) ;
"RTN","RORHL09",262,0)
 N RORSEG
"RTN","RORHL09",263,0)
 S RORSEG="OBX"
"RTN","RORHL09",264,0)
 ;--- OBX-2 - Value Type
"RTN","RORHL09",265,0)
 S $P(RORSEG,HLFS,3)="FT"
"RTN","RORHL09",266,0)
 ;--- OBX-3 - Obervation Identifier
"RTN","RORHL09",267,0)
 S $P(RORSEG,HLFS,4)=PIECE3
"RTN","RORHL09",268,0)
 ;--- OBX-5 - Obervation Value
"RTN","RORHL09",269,0)
 S $P(RORSEG,HLFS,6)=PIECE5
"RTN","RORHL09",270,0)
 ;--- OBX-11 - Obervation Result Status
"RTN","RORHL09",271,0)
 S $P(RORSEG,HLFS,12)="F"
"RTN","RORHL09",272,0)
 ;--- OBX-16 - Responsible Observer
"RTN","RORHL09",273,0)
 S:$G(PIECE16)'="" $P(RORSEG,HLFS,17)=PIECE16
"RTN","RORHL09",274,0)
 ;--- Store the segment
"RTN","RORHL09",275,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL09",276,0)
 Q
"RTN","RORHL14")
0^26^B30912646
"RTN","RORHL14",1,0)
RORHL14 ;HOIFO/BH - HL7 ALLERGY DATA: OBR,OBX ; 6/9/04 11:27am
"RTN","RORHL14",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORHL14",3,0)
 ;
"RTN","RORHL14",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL14",5,0)
 ;
"RTN","RORHL14",6,0)
 ; #2167         Read access to the file #120.83 (controlled)
"RTN","RORHL14",7,0)
 ; #2473         Read access to the file #50.605 (controlled)
"RTN","RORHL14",8,0)
 ; #2196         Read access to the file #50.416 (controlled)
"RTN","RORHL14",9,0)
 ; #10060        Read access to the file #200 (supported)
"RTN","RORHL14",10,0)
 ;
"RTN","RORHL14",11,0)
 ;
"RTN","RORHL14",12,0)
 Q
"RTN","RORHL14",13,0)
 ;
"RTN","RORHL14",14,0)
 ;***** SEARCHES FOR ALLERGY DATA
"RTN","RORHL14",15,0)
 ;
"RTN","RORHL14",16,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",17,0)
 ;
"RTN","RORHL14",18,0)
 ; RORSTDT       Start Date (FileMan)
"RTN","RORHL14",19,0)
 ; RORENDT       End Date   (FileMan)
"RTN","RORHL14",20,0)
 ;
"RTN","RORHL14",21,0)
 ; Return Values:
"RTN","RORHL14",22,0)
 ;       <0  Error code
"RTN","RORHL14",23,0)
 ;        0  Ok
"RTN","RORHL14",24,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",25,0)
 ;
"RTN","RORHL14",26,0)
EN1(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL14",27,0)
 N ERRCNT,RC,RORARR,RORDTE,RORIEN
"RTN","RORHL14",28,0)
 S (ERRCNT,RC)=0
"RTN","RORHL14",29,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL14",30,0)
 ;
"RTN","RORHL14",31,0)
 S RORDTE=$O(^GMR(120.8,"AODT",RORSTDT),-1)
"RTN","RORHL14",32,0)
 F  S RORDTE=$O(^GMR(120.8,"AODT",RORDTE))  Q:'RORDTE!(RORDTE'<RORENDT)  D
"RTN","RORHL14",33,0)
 . S RORIEN=0
"RTN","RORHL14",34,0)
 . F  S RORIEN=$O(^GMR(120.8,"AODT",RORDTE,RORIEN))  Q:'RORIEN  D
"RTN","RORHL14",35,0)
 . . S:$D(^GMR(120.8,"B",RORDFN,RORIEN)) RORARR(RORIEN)=""
"RTN","RORHL14",36,0)
 Q:$D(RORARR)<10 ERRCNT
"RTN","RORHL14",37,0)
 ;
"RTN","RORHL14",38,0)
 S RORIEN=0
"RTN","RORHL14",39,0)
 F  S RORIEN=$O(RORARR(RORIEN))  Q:'RORIEN  D
"RTN","RORHL14",40,0)
 . S RC=$$OBR(RORIEN,RORDFN)
"RTN","RORHL14",41,0)
 . I RC  S ERRCNT=ERRCNT+1  Q:RC<0
"RTN","RORHL14",42,0)
 . S RC=$$OBX(RORIEN,RORDFN)
"RTN","RORHL14",43,0)
 . I RC  S ERRCNT=ERRCNT+1  Q:RC<0
"RTN","RORHL14",44,0)
 ;
"RTN","RORHL14",45,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL14",46,0)
 ;
"RTN","RORHL14",47,0)
 ;***** ALLERGY OBR SEGMENT BUILDER
"RTN","RORHL14",48,0)
 ;
"RTN","RORHL14",49,0)
 ; RORAIEN       IEN of Allergy entry
"RTN","RORHL14",50,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",51,0)
 ;
"RTN","RORHL14",52,0)
 ; Return Values:
"RTN","RORHL14",53,0)
 ;       <0  Error code
"RTN","RORHL14",54,0)
 ;        0  Ok
"RTN","RORHL14",55,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",56,0)
 ;
"RTN","RORHL14",57,0)
OBR(RORAIEN,RORDFN) ;
"RTN","RORHL14",58,0)
 N BUF,CS,ERRCNT,RC,RORLST,RORMSG,RORSEG,TMP
"RTN","RORHL14",59,0)
 S (ERRCNT,RC)=0
"RTN","RORHL14",60,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL14",61,0)
 S CS=$E(HLECH,1)
"RTN","RORHL14",62,0)
 ;
"RTN","RORHL14",63,0)
 S RORAIEN=RORAIEN_","
"RTN","RORHL14",64,0)
 D GETS^DIQ(120.8,RORAIEN,".02;3.1;4;5;6","EI","RORLST","RORMSG")
"RTN","RORHL14",65,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL14",66,0)
 . D DBS^RORERR("RORMSG",-9,,RORDFN,120.8,RORAIEN)
"RTN","RORHL14",67,0)
 ;
"RTN","RORHL14",68,0)
 ;--- Initialize the segment
"RTN","RORHL14",69,0)
 S RORSEG="OBR"
"RTN","RORHL14",70,0)
 ;
"RTN","RORHL14",71,0)
 ;--- OBR-3 - IEN of record
"RTN","RORHL14",72,0)
 S $P(RORSEG,HLFS,4)=$P(RORAIEN,",")
"RTN","RORHL14",73,0)
 ;
"RTN","RORHL14",74,0)
 ;--- OBR-4 - Sevice ID
"RTN","RORHL14",75,0)
 S $P(RORSEG,HLFS,5)="95000"_CS_"ALLERGY"_CS_"C4"
"RTN","RORHL14",76,0)
 ;
"RTN","RORHL14",77,0)
 ;--- OBR-7 - Observation Date/Time
"RTN","RORHL14",78,0)
 S TMP=$$FMTHL7^XLFDT($G(RORLST(120.8,RORAIEN,4,"I")))
"RTN","RORHL14",79,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,RORDFN,120.8,RORAIEN,4)
"RTN","RORHL14",80,0)
 S $P(RORSEG,HLFS,8)=TMP
"RTN","RORHL14",81,0)
 ;
"RTN","RORHL14",82,0)
 ;--- OBR-13 - Relevant Clinical Info.
"RTN","RORHL14",83,0)
 S $P(RORSEG,HLFS,14)=$G(RORLST(120.8,RORAIEN,.02,"E"))
"RTN","RORHL14",84,0)
 ;
"RTN","RORHL14",85,0)
 ;--- OBR-16 - Ordering Provider
"RTN","RORHL14",86,0)
 S BUF=$G(RORLST(120.8,RORAIEN,5,"I"))
"RTN","RORHL14",87,0)
 I BUF>0  D
"RTN","RORHL14",88,0)
 . S $P(BUF,CS,5)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL14",89,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",90,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,200,+BUF_",")
"RTN","RORHL14",91,0)
 . S $P(RORSEG,HLFS,17)=BUF
"RTN","RORHL14",92,0)
 ;
"RTN","RORHL14",93,0)
 ;--- OBR-20 - Filler Field 1
"RTN","RORHL14",94,0)
 S $P(RORSEG,HLFS,21)=$G(RORLST(120.8,RORAIEN,3.1,"E"))
"RTN","RORHL14",95,0)
 ;
"RTN","RORHL14",96,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL14",97,0)
 S $P(RORSEG,HLFS,25)="TX"
"RTN","RORHL14",98,0)
 ;
"RTN","RORHL14",99,0)
 ;--- OBR-25 - Result Status
"RTN","RORHL14",100,0)
 S TMP=$G(RORLST(120.8,RORAIEN,6,"E"))
"RTN","RORHL14",101,0)
 I TMP'=""  D  S $P(RORSEG,HLFS,26)=TMP
"RTN","RORHL14",102,0)
 . S TMP=$S(TMP="HISTORICAL":"R",TMP="OBSERVED":"F",1:"")
"RTN","RORHL14",103,0)
 ;
"RTN","RORHL14",104,0)
 ;--- Store the segment
"RTN","RORHL14",105,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL14",106,0)
 Q ERRCNT
"RTN","RORHL14",107,0)
 ;
"RTN","RORHL14",108,0)
 ;***** ALLERGY OBX SEGMENT(S) BUILDER
"RTN","RORHL14",109,0)
 ;
"RTN","RORHL14",110,0)
 ; RORAIEN       IEN of Allergy entry
"RTN","RORHL14",111,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL14",112,0)
 ;
"RTN","RORHL14",113,0)
 ; Return Values:
"RTN","RORHL14",114,0)
 ;       <0  Error code
"RTN","RORHL14",115,0)
 ;        0  Ok
"RTN","RORHL14",116,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL14",117,0)
 ;
"RTN","RORHL14",118,0)
OBX(RORAIEN,RORDFN) ;
"RTN","RORHL14",119,0)
 N CS,DTE,ERRCNT,IEN,RC,REAC,RORID,RORIENS,RORKEY,RORLST,RORMSG,RORSEG,TMP
"RTN","RORHL14",120,0)
 S (ERRCNT,RC)=0,RORIENS=","_RORAIEN_","
"RTN","RORHL14",121,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL14",122,0)
 S CS=$E(HLECH)
"RTN","RORHL14",123,0)
 ;
"RTN","RORHL14",124,0)
 ;=== Ingredients
"RTN","RORHL14",125,0)
 K RORLST,RORMSG
"RTN","RORHL14",126,0)
 D LIST^DIC(120.802,RORIENS,"@;.01","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",127,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",128,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.802,RORIENS)
"RTN","RORHL14",129,0)
 S RORID="INGR"_CS_"Ingredients"_CS_"VA080"
"RTN","RORHL14",130,0)
 ;---
"RTN","RORHL14",131,0)
 S RORKEY=0
"RTN","RORHL14",132,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",133,0)
 . S IEN=RORLST("DILIST","ID",RORKEY,.01)  Q:IEN'>0
"RTN","RORHL14",134,0)
 . S TMP=$$GET1^DIQ(50.416,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL14",135,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",136,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,50.416,IEN_",")
"RTN","RORHL14",137,0)
 . D:TMP'="" SETOBX(TMP,RORID)
"RTN","RORHL14",138,0)
 ;
"RTN","RORHL14",139,0)
 ;=== Classes
"RTN","RORHL14",140,0)
 K RORLST,RORMSG
"RTN","RORHL14",141,0)
 D LIST^DIC(120.803,RORIENS,"@;.01","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",142,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",143,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.803,RORIENS)
"RTN","RORHL14",144,0)
 S RORID="CLAS"_CS_"Drug Class"_CS_"VA080"
"RTN","RORHL14",145,0)
 ;---
"RTN","RORHL14",146,0)
 S RORKEY=0
"RTN","RORHL14",147,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",148,0)
 . S IEN=RORLST("DILIST","ID",RORKEY,.01)  Q:IEN'>0
"RTN","RORHL14",149,0)
 . S TMP=$$GET1^DIQ(50.605,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL14",150,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",151,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,50.605,IEN_",")
"RTN","RORHL14",152,0)
 . D:TMP'="" SETOBX(TMP,RORID)
"RTN","RORHL14",153,0)
 ;
"RTN","RORHL14",154,0)
 ;=== Reactions
"RTN","RORHL14",155,0)
 K RORLST,RORMSG
"RTN","RORHL14",156,0)
 D LIST^DIC(120.81,RORIENS,"@;.01;3","I",,,,,,,"RORLST","RORMSG")
"RTN","RORHL14",157,0)
 I $G(DIERR)  D  Q RC
"RTN","RORHL14",158,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,120.81,RORIENS)
"RTN","RORHL14",159,0)
 S RORID="RCTS"_CS_"Reactions"_CS_"VA080"
"RTN","RORHL14",160,0)
 ;---
"RTN","RORHL14",161,0)
 S RORKEY=0
"RTN","RORHL14",162,0)
 F  S RORKEY=$O(RORLST("DILIST","ID",RORKEY))  Q:'RORKEY  D
"RTN","RORHL14",163,0)
 . S IEN=RORLST("DILIST","ID",RORKEY,.01)  Q:IEN'>0
"RTN","RORHL14",164,0)
 . S REAC=$$GET1^DIQ(120.83,IEN_",",.01,"E",,"RORMSG")
"RTN","RORHL14",165,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1  Q
"RTN","RORHL14",166,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,120.83,IEN_",")
"RTN","RORHL14",167,0)
 . Q:REAC=""
"RTN","RORHL14",168,0)
 . S DTE=$$FM2HL^RORHL7($G(RORLST("DILIST","ID",RORKEY,3)))
"RTN","RORHL14",169,0)
 . D SETOBX(REAC,RORID,DTE)
"RTN","RORHL14",170,0)
 ;
"RTN","RORHL14",171,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL14",172,0)
 ;
"RTN","RORHL14",173,0)
 ;***** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL14",174,0)
SETOBX(PIECE5,PIECE3,PIECE12) ;
"RTN","RORHL14",175,0)
 N RORSEG
"RTN","RORHL14",176,0)
 ;--- Initialize the segment
"RTN","RORHL14",177,0)
 S RORSEG="OBX"
"RTN","RORHL14",178,0)
 ;--- OBX-2
"RTN","RORHL14",179,0)
 S $P(RORSEG,HLFS,3)="FT"
"RTN","RORHL14",180,0)
 ;---
"RTN","RORHL14",181,0)
 S $P(RORSEG,HLFS,4)=PIECE3
"RTN","RORHL14",182,0)
 S $P(RORSEG,HLFS,6)=PIECE5
"RTN","RORHL14",183,0)
 ;--- OBX-11
"RTN","RORHL14",184,0)
 S $P(RORSEG,HLFS,12)="F"
"RTN","RORHL14",185,0)
 ;---
"RTN","RORHL14",186,0)
 S:$G(PIECE12)'="" $P(RORSEG,HLFS,13)=PIECE12
"RTN","RORHL14",187,0)
 ;--- Store the segment
"RTN","RORHL14",188,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL14",189,0)
 Q
"RTN","RORHL17")
0^1^B33637677
"RTN","RORHL17",1,0)
RORHL17 ;HOIFO/BH - HL7 Problem List: OBR,OBX ; 6/9/04 11:28am
"RTN","RORHL17",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORHL17",3,0)
 ;
"RTN","RORHL17",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL17",5,0)
 ;
"RTN","RORHL17",6,0)
 ; #2308         Controlled ???
"RTN","RORHL17",7,0)
 ; #2644         $$MOD^GMPLUTL3 (controlled)
"RTN","RORHL17",8,0)
 ;
"RTN","RORHL17",9,0)
 Q
"RTN","RORHL17",10,0)
 ;
"RTN","RORHL17",11,0)
 ;***** SEARCHES FOR Problem List DATA
"RTN","RORHL17",12,0)
 ;
"RTN","RORHL17",13,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL17",14,0)
 ;
"RTN","RORHL17",15,0)
 ; RORSTDT       Start Date (FileMan)
"RTN","RORHL17",16,0)
 ; RORENDT       End Date   (FileMan)
"RTN","RORHL17",17,0)
 ;
"RTN","RORHL17",18,0)
 ; Return Values:
"RTN","RORHL17",19,0)
 ;       <0  Error code
"RTN","RORHL17",20,0)
 ;        0  Ok
"RTN","RORHL17",21,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",22,0)
 ;
"RTN","RORHL17",23,0)
 ;
"RTN","RORHL17",24,0)
EN1(RORDFN,RORSTDT,RORENDT) ;
"RTN","RORHL17",25,0)
 N CNT,CS,DFN,DIAG,FACILITY,GMRVSTR,IENS,MDATE,NOTE,NUMBER,PAT,PROBIEN,RC,REC,REC1,RORARR,RORBUF,RORMSG,STAT,SUB3,SUB5,TMP
"RTN","RORHL17",26,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",27,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL17",28,0)
 S CS=$E(HLECH,1)
"RTN","RORHL17",29,0)
 ;
"RTN","RORHL17",30,0)
 ;--- Check to see is any problems have been entered/modified
"RTN","RORHL17",31,0)
 ;--- during the data extraction time frame
"RTN","RORHL17",32,0)
 ;
"RTN","RORHL17",33,0)
 S MDATE=$$MOD^GMPLUTL3(RORDFN)
"RTN","RORHL17",34,0)
 Q:(MDATE<RORSTDT)!(MDATE'<RORENDT) 0
"RTN","RORHL17",35,0)
 ;
"RTN","RORHL17",36,0)
 ;--- Find newly entered problems or modified problems
"RTN","RORHL17",37,0)
 ;
"RTN","RORHL17",38,0)
 S PROBIEN=""
"RTN","RORHL17",39,0)
 F  S PROBIEN=$O(^AUPNPROB("AC",RORDFN,PROBIEN)) Q:'PROBIEN  D
"RTN","RORHL17",40,0)
 . K RORARR
"RTN","RORHL17",41,0)
 . S REC=$G(^AUPNPROB(PROBIEN,0))
"RTN","RORHL17",42,0)
 . S REC1=$G(^AUPNPROB(PROBIEN,1))
"RTN","RORHL17",43,0)
 . S MDATE=$P(REC,U,3)
"RTN","RORHL17",44,0)
 . Q:(MDATE<RORSTDT)!(MDATE'<RORENDT)
"RTN","RORHL17",45,0)
 . ;
"RTN","RORHL17",46,0)
 . S RORARR("OBR","FACIL")=$P(REC,U,6)
"RTN","RORHL17",47,0)
 . S RORARR("OBR","NMBR")=$P(REC,U,7)
"RTN","RORHL17",48,0)
 . S RORARR("OBR","COND")=$P(REC1,U,2)
"RTN","RORHL17",49,0)
 . S RORARR("OBR","DE")=$$FMTHL7^XLFDT($P(REC,U,8))
"RTN","RORHL17",50,0)
 . S RORARR("OBR","DOO")=$$CHECK($P(REC,U,13))
"RTN","RORHL17",51,0)
 . S RORARR("OBR","DR")=$$CHECK($P(REC1,U,7))
"RTN","RORHL17",52,0)
 . ;
"RTN","RORHL17",53,0)
 . S DIAG=$$GET1^DIQ(80,+$P(REC,U)_",",.01,"E",,"RORMSG")
"RTN","RORHL17",54,0)
 . I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL17",55,0)
 . . D DBS^RORERR("RORMSG",-99,,RORDFN,80,$P(REC,U,1)_",")
"RTN","RORHL17",56,0)
 . ;
"RTN","RORHL17",57,0)
 . S RORARR("OBR","DIAG")=DIAG
"RTN","RORHL17",58,0)
 . S RORARR("OBR","DR")=$$FMTHL7^XLFDT($P(REC1,U,9))
"RTN","RORHL17",59,0)
 . S RORARR("OBR","RP")=$P(REC1,U,4)
"RTN","RORHL17",60,0)
 . S RORARR("OBR","DLM")=$$FMTHL7^XLFDT(MDATE)
"RTN","RORHL17",61,0)
 . S RORARR("OBR","ST")=$P(REC,U,12)
"RTN","RORHL17",62,0)
 . ;
"RTN","RORHL17",63,0)
 . S RORARR("OBX","PR")=$$GET1^DIQ(9000011,PROBIEN,.05,"E")
"RTN","RORHL17",64,0)
 . S RORARR("OBX","PROB")=$$GET1^DIQ(9000011,PROBIEN,1.01,"E")
"RTN","RORHL17",65,0)
 . ;
"RTN","RORHL17",66,0)
 . I $D(^AUPNPROB(PROBIEN,11)) D
"RTN","RORHL17",67,0)
 . . S SUB3=0,CNT=0
"RTN","RORHL17",68,0)
 . . F  S SUB3=$O(^AUPNPROB(PROBIEN,11,SUB3)) Q:'SUB3  D
"RTN","RORHL17",69,0)
 . . . S FACILITY=$$GET1^DIQ(9000011.11,SUB3_","_PROBIEN,.01,"E")
"RTN","RORHL17",70,0)
 . . . I FACILITY="" Q
"RTN","RORHL17",71,0)
 . . . S SUB5=0
"RTN","RORHL17",72,0)
 . . . F  S SUB5=$O(^AUPNPROB(PROBIEN,11,SUB3,11,SUB5)) Q:'SUB5  D
"RTN","RORHL17",73,0)
 . . . . S IENS=SUB5_","_SUB3_","_PROBIEN_","
"RTN","RORHL17",74,0)
 . . . . D GETS^DIQ(9000011.1111,IENS,".01;.03;.04","IE","RORBUF")
"RTN","RORHL17",75,0)
 . . . . S NUMBER=$G(RORBUF(9000011.1111,IENS,.01,"E"))
"RTN","RORHL17",76,0)
 . . . . S STAT=$G(RORBUF(9000011.1111,IENS,.04,"I"))
"RTN","RORHL17",77,0)
 . . . . I STAT="" S STAT="I"
"RTN","RORHL17",78,0)
 . . . . S NOTE=$G(RORBUF(9000011.1111,IENS,.03,"E"))
"RTN","RORHL17",79,0)
 . . . . S CNT=CNT+1
"RTN","RORHL17",80,0)
 . . . . S RORARR("OBX","NOTE",CNT)=FACILITY_CS_NUMBER_CS_STAT
"RTN","RORHL17",81,0)
 . . . . S RORARR("OBX","NOTE",CNT,0)=NOTE
"RTN","RORHL17",82,0)
 . ;
"RTN","RORHL17",83,0)
 . S TMP=$$OBR(.RORARR)
"RTN","RORHL17",84,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL17",85,0)
 . S TMP=$$OBX(.RORARR)
"RTN","RORHL17",86,0)
 . I TMP  S ERRCNT=ERRCNT+1  Q:TMP<0
"RTN","RORHL17",87,0)
 ;
"RTN","RORHL17",88,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL17",89,0)
 ;
"RTN","RORHL17",90,0)
 ;***** PROBLEM LIST OBR SEGMENT BUILDER
"RTN","RORHL17",91,0)
 ;
"RTN","RORHL17",92,0)
 ; Return Values:
"RTN","RORHL17",93,0)
 ;       <0  Error code
"RTN","RORHL17",94,0)
 ;        0  Ok
"RTN","RORHL17",95,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",96,0)
 ;
"RTN","RORHL17",97,0)
OBR(RORARR) ;
"RTN","RORHL17",98,0)
 N CLASS,CS,ERRCNT,PRV,RC,RORMSG,RORSEG,TMP,TMP1
"RTN","RORHL17",99,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",100,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL17",101,0)
 S CS=$E(HLECH,1)
"RTN","RORHL17",102,0)
 ;
"RTN","RORHL17",103,0)
 ;--- Initialize the segment
"RTN","RORHL17",104,0)
 S RORSEG="OBR"
"RTN","RORHL17",105,0)
 ;
"RTN","RORHL17",106,0)
 ;--- OBR-3 - Filler Order Number
"RTN","RORHL17",107,0)
 S $P(RORSEG,HLFS,4)=RORARR("OBR","FACIL")_RORARR("OBR","NMBR")
"RTN","RORHL17",108,0)
 ;
"RTN","RORHL17",109,0)
 ;--- OBR-4 - Problem List CPT Code
"RTN","RORHL17",110,0)
 S $P(RORSEG,HLFS,5)="90125"_CS_"HOSPITAL CARE,NEW, INTERMED."_CS_"C4"
"RTN","RORHL17",111,0)
 ;
"RTN","RORHL17",112,0)
 ;--- OBR-6 - Requested Date/time
"RTN","RORHL17",113,0)
 S $P(RORSEG,HLFS,7)=RORARR("OBR","DE")
"RTN","RORHL17",114,0)
 ;
"RTN","RORHL17",115,0)
 ;--- OBR-7 - Observation Date/Time
"RTN","RORHL17",116,0)
 S $P(RORSEG,HLFS,8)=RORARR("OBR","DOO")
"RTN","RORHL17",117,0)
 ;
"RTN","RORHL17",118,0)
 ;--- OBR-8 - Observation End Date/Time
"RTN","RORHL17",119,0)
 S $P(RORSEG,HLFS,9)=RORARR("OBR","DR")
"RTN","RORHL17",120,0)
 ;
"RTN","RORHL17",121,0)
 ;--- OBR-13 -  Relevant Clinical Info.
"RTN","RORHL17",122,0)
 S $P(RORSEG,HLFS,14)=RORARR("OBR","DIAG")
"RTN","RORHL17",123,0)
 ;
"RTN","RORHL17",124,0)
 ;--- OBR-14 - Specimen Received Date/time
"RTN","RORHL17",125,0)
 S $P(RORSEG,HLFS,15)=RORARR("OBR","DR")
"RTN","RORHL17",126,0)
 ;
"RTN","RORHL17",127,0)
 ;--- OBR-16 - Ordering Provider
"RTN","RORHL17",128,0)
 S PRV=RORARR("OBR","RP")
"RTN","RORHL17",129,0)
 S $P(PRV,CS,5)=$$GET1^DIQ(200,PRV_",",53.5,"E",,"RORMSG")
"RTN","RORHL17",130,0)
 I $G(DIERR)  D  S ERRCNT=ERRCNT+1
"RTN","RORHL17",131,0)
 . D DBS^RORERR("RORMSG",-99,,RORDFN,200,PRV_",")
"RTN","RORHL17",132,0)
 S $P(RORSEG,HLFS,17)=PRV
"RTN","RORHL17",133,0)
 ;
"RTN","RORHL17",134,0)
 ;--- OBR-20 - Filler Field 1
"RTN","RORHL17",135,0)
 S $P(RORSEG,HLFS,21)=RORARR("OBR","COND")
"RTN","RORHL17",136,0)
 ;
"RTN","RORHL17",137,0)
 ;--- OBR-22 - Results Rpt/Status Change Date/time  
"RTN","RORHL17",138,0)
 S $P(RORSEG,HLFS,23)=RORARR("OBR","DLM")
"RTN","RORHL17",139,0)
 ;
"RTN","RORHL17",140,0)
 ;--- OBR-24 - Diagnostic Service ID
"RTN","RORHL17",141,0)
 S $P(RORSEG,HLFS,25)="TX"
"RTN","RORHL17",142,0)
 ;
"RTN","RORHL17",143,0)
 ;--- OBR-25 - Result Status
"RTN","RORHL17",144,0)
 S TMP1=RORARR("OBR","ST")
"RTN","RORHL17",145,0)
 S TMP=$S(TMP1="A":"F",TMP1="I":"R",1:"")
"RTN","RORHL17",146,0)
 S $P(RORSEG,HLFS,26)=TMP
"RTN","RORHL17",147,0)
 ;
"RTN","RORHL17",148,0)
 ;--- OBR-44 - Division
"RTN","RORHL17",149,0)
 S $P(RORSEG,HLFS,45)=$$SITE1^RORUTL03(CS)
"RTN","RORHL17",150,0)
 ;
"RTN","RORHL17",151,0)
 ;--- Store the segment
"RTN","RORHL17",152,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL17",153,0)
 Q ERRCNT
"RTN","RORHL17",154,0)
 ;
"RTN","RORHL17",155,0)
 ;***** VITALS OBX SEGMENT(S) BUILDER
"RTN","RORHL17",156,0)
 ;
"RTN","RORHL17",157,0)
 ; Return Values:
"RTN","RORHL17",158,0)
 ;       <0  Error code
"RTN","RORHL17",159,0)
 ;        0  Ok
"RTN","RORHL17",160,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL17",161,0)
 ;
"RTN","RORHL17",162,0)
OBX(RORARR) ;
"RTN","RORHL17",163,0)
 N CS,ERRCNT,RC,OBID,OBX5PROB,OBX5PR
"RTN","RORHL17",164,0)
 S (ERRCNT,RC)=0
"RTN","RORHL17",165,0)
 S HLFS=$G(RORHL("FS"),"|"),HLECH=$G(RORHL("ECH"),"^~\&")
"RTN","RORHL17",166,0)
 S CS=$E(HLECH)
"RTN","RORHL17",167,0)
 ;
"RTN","RORHL17",168,0)
 I $D(RORARR("OBX","PR")) D
"RTN","RORHL17",169,0)
 . S OBX5PR=RORARR("OBX","PR")
"RTN","RORHL17",170,0)
 . D SETOBX("PRVN"_CS_"Provider Narrative"_CS_"VA080","",OBX5PR)
"RTN","RORHL17",171,0)
 ;
"RTN","RORHL17",172,0)
 I $D(RORARR("OBX","PROB")) D
"RTN","RORHL17",173,0)
 . S OBX5PROB=RORARR("OBX","PROB")
"RTN","RORHL17",174,0)
 . D SETOBX("EXPR"_CS_"Expression"_CS_"VA080","",OBX5PR)
"RTN","RORHL17",175,0)
 ;
"RTN","RORHL17",176,0)
 I $D(RORARR("OBX","NOTE")) D
"RTN","RORHL17",177,0)
 . N INDEX,OBX5NN,STATUS
"RTN","RORHL17",178,0)
 . S INDEX=""
"RTN","RORHL17",179,0)
 . F  S INDEX=$O(RORARR("OBX","NOTE",INDEX)) Q:'INDEX  D
"RTN","RORHL17",180,0)
 . . S REC=RORARR("OBX","NOTE",INDEX)
"RTN","RORHL17",181,0)
 . . S OBX5NN=RORARR("OBX","NOTE",INDEX,0)
"RTN","RORHL17",182,0)
 . . D SETOBX("NOTE"_CS_"Note Narrative"_CS_"VA080",REC,OBX5NN)
"RTN","RORHL17",183,0)
 ;
"RTN","RORHL17",184,0)
 Q ERRCNT
"RTN","RORHL17",185,0)
 ;
"RTN","RORHL17",186,0)
 ;*** CREATES AND STORES THE OBX SEGMENT
"RTN","RORHL17",187,0)
SETOBX(PIECE3,PIECE4,PIECE5) ;
"RTN","RORHL17",188,0)
 N RORSEG
"RTN","RORHL17",189,0)
 ;--- Initialize the segment
"RTN","RORHL17",190,0)
 S RORSEG="OBX"
"RTN","RORHL17",191,0)
 ;--- OBX-2
"RTN","RORHL17",192,0)
 S $P(RORSEG,HLFS,3)="FT"
"RTN","RORHL17",193,0)
 ;--- OBX-3
"RTN","RORHL17",194,0)
 S $P(RORSEG,HLFS,4)=PIECE3
"RTN","RORHL17",195,0)
 ;--- OBX-4
"RTN","RORHL17",196,0)
 I $D(PIECE4) S $P(RORSEG,HLFS,5)=PIECE4
"RTN","RORHL17",197,0)
 ;--- OBX-5
"RTN","RORHL17",198,0)
 S $P(RORSEG,HLFS,6)=PIECE5
"RTN","RORHL17",199,0)
 ;--- OBX-11
"RTN","RORHL17",200,0)
 S $P(RORSEG,HLFS,12)="F"
"RTN","RORHL17",201,0)
 ;--- Store the segment
"RTN","RORHL17",202,0)
 D SETSEG^RORHL7(.RORSEG)
"RTN","RORHL17",203,0)
 Q
"RTN","RORHL17",204,0)
 ;
"RTN","RORHL17",205,0)
CHECK(ROR1DATE) ;
"RTN","RORHL17",206,0)
 S ROR1DATE=$$FMTHL7^XLFDT(ROR1DATE)
"RTN","RORHL17",207,0)
 I 'ROR1DATE Q ""
"RTN","RORHL17",208,0)
 I $E(ROR1DATE,1,2)="20",$E(ROR1DATE,3,4)>$E(DT,2,3) Q ""
"RTN","RORHL17",209,0)
 I $E(ROR1DATE,7,8)="00" S $E(ROR1DATE,7,8)="01"
"RTN","RORHL17",210,0)
 I $E(ROR1DATE,5,6)="00" S $E(ROR1DATE,5,6)="01"
"RTN","RORHL17",211,0)
 Q ROR1DATE
"RTN","RORHL17",212,0)
 ;
"RTN","RORNTEG")
0^27^B19112178
"RTN","RORNTEG",1,0)
RORNTEG ;ISC/XTSUMBLD KERNEL - Package checksum checker ; 6/30/04 11:41am
"RTN","RORNTEG",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**3,4,5,6**;May 14, 2002
"RTN","RORNTEG",3,0)
 ;;7.3;3040629.080209
"RTN","RORNTEG",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","RORNTEG",6,0)
 G CONT^RORNTEG0
"RTN","RORNTEG",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","RORNTEG",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","RORNTEG",10,0)
 W ! G CONT
"RTN","RORNTEG",11,0)
ROU ;;
"RTN","RORNTEG",12,0)
ROR ;;2393807
"RTN","RORNTEG",13,0)
ROR01 ;;1117
"RTN","RORNTEG",14,0)
ROR02 ;;1122
"RTN","RORNTEG",15,0)
ROR10 ;;5784769
"RTN","RORNTEG",16,0)
RORACK ;;4221963
"RTN","RORNTEG",17,0)
RORACK01 ;;6457683
"RTN","RORNTEG",18,0)
RORAPI01 ;;2291186
"RTN","RORNTEG",19,0)
RORDD ;;4886229
"RTN","RORNTEG",20,0)
RORDD01 ;;919515
"RTN","RORNTEG",21,0)
RORERR ;;3863551
"RTN","RORNTEG",22,0)
RORERR10 ;;9157206
"RTN","RORNTEG",23,0)
RORERR11 ;;17589767
"RTN","RORNTEG",24,0)
RORERR12 ;;13407882
"RTN","RORNTEG",25,0)
RORERR20 ;;13404338
"RTN","RORNTEG",26,0)
ROREVT01 ;;2008294
"RTN","RORNTEG",27,0)
ROREXPR ;;3054011
"RTN","RORNTEG",28,0)
ROREXT ;;4234009
"RTN","RORNTEG",29,0)
ROREXT01 ;;4887747
"RTN","RORNTEG",30,0)
ROREXT02 ;;4504914
"RTN","RORNTEG",31,0)
ROREXT03 ;;1955488
"RTN","RORNTEG",32,0)
ROREXTUT ;;6225863
"RTN","RORNTEG",33,0)
RORHDT ;;3515691
"RTN","RORNTEG",34,0)
RORHDT01 ;;2383372
"RTN","RORNTEG",35,0)
RORHDT02 ;;1374405
"RTN","RORNTEG",36,0)
RORHDT03 ;;4235780
"RTN","RORNTEG",37,0)
RORHDT04 ;;8306528
"RTN","RORNTEG",38,0)
RORHDT05 ;;2635437
"RTN","RORNTEG",39,0)
RORHDTAC ;;3280350
"RTN","RORNTEG",40,0)
RORHDTUT ;;4563799
"RTN","RORNTEG",41,0)
RORHL01 ;;2652082
"RTN","RORNTEG",42,0)
RORHL02 ;;7424588
"RTN","RORNTEG",43,0)
RORHL03 ;;5325577
"RTN","RORNTEG",44,0)
RORHL031 ;;7575501
"RTN","RORNTEG",45,0)
RORHL04 ;;5193863
"RTN","RORNTEG",46,0)
RORHL05 ;;1858773
"RTN","RORNTEG",47,0)
RORHL06 ;;4487923
"RTN","RORNTEG",48,0)
RORHL07 ;;4114719
"RTN","RORNTEG",49,0)
RORHL071 ;;4095427
"RTN","RORNTEG",50,0)
RORHL08 ;;4376658
"RTN","RORNTEG",51,0)
RORHL081 ;;7681710
"RTN","RORNTEG",52,0)
RORHL09 ;;6760261
"RTN","RORNTEG",53,0)
RORHL10 ;;6706945
"RTN","RORNTEG",54,0)
RORHL11 ;;5142087
"RTN","RORNTEG",55,0)
RORHL12 ;;2274629
"RTN","RORNTEG",56,0)
RORHL121 ;;9997256
"RTN","RORNTEG",57,0)
RORHL13 ;;3432675
"RTN","RORNTEG",58,0)
RORHL14 ;;5434428
"RTN","RORNTEG",59,0)
RORHL15 ;;5689840
"RTN","RORNTEG",60,0)
RORHL16 ;;2973634
"RTN","RORNTEG",61,0)
RORHL17 ;;6039977
"RTN","RORNTEG",62,0)
RORHL21 ;;1631067
"RTN","RORNTEG",63,0)
RORHL7 ;;5115013
"RTN","RORNTEG",64,0)
RORHL7A ;;2252045
"RTN","RORNTEG",65,0)
RORHLUT1 ;;1863278
"RTN","RORNTEG",66,0)
RORICR01 ;;1541289
"RTN","RORNTEG",67,0)
RORICR02 ;;2080214
"RTN","RORNTEG",68,0)
RORICR03 ;;4746011
"RTN","RORNTEG",69,0)
RORICREX ;;3978828
"RTN","RORNTEG",70,0)
RORICRUT ;;362893
"RTN","RORNTEG",71,0)
RORKIDS ;;6161632
"RTN","RORNTEG",72,0)
RORLOCK ;;4131518
"RTN","RORNTEG",73,0)
RORLOG ;;5965990
"RTN","RORNTEG",74,0)
RORLOG01 ;;3182899
"RTN","RORNTEG",75,0)
RORP006 ;;4399886
"RTN","RORNTEG",76,0)
RORPUT01 ;;5495626
"RTN","RORNTEG",77,0)
RORREP01 ;;9015849
"RTN","RORNTEG",78,0)
RORREP02 ;;10910524
"RTN","RORNTEG",79,0)
RORRP007 ;;4488913
"RTN","RORNTEG",80,0)
RORRP010 ;;1854669
"RTN","RORNTEG",81,0)
RORRP011 ;;1877613
"RTN","RORNTEG",82,0)
RORRP012 ;;2760144
"RTN","RORNTEG",83,0)
RORRP013 ;;4685153
"RTN","RORNTEG",84,0)
RORRP014 ;;1851772
"RTN","RORNTEG",85,0)
RORRP015 ;;3365112
"RTN","RORNTEG",86,0)
RORRP016 ;;1339527
"RTN","RORNTEG",87,0)
RORRP017 ;;2082982
"RTN","RORNTEG",88,0)
RORRP018 ;;1399897
"RTN","RORNTEG",89,0)
RORRP019 ;;3662396
"RTN","RORNTEG",90,0)
RORRP020 ;;5106473
"RTN","RORNTEG",91,0)
RORRP021 ;;2207749
"RTN","RORNTEG",92,0)
RORRP022 ;;1246520
"RTN","RORNTEG",93,0)
RORRP023 ;;2273081
"RTN","RORNTEG",94,0)
RORRP024 ;;3769315
"RTN","RORNTEG",95,0)
RORRP025 ;;4917408
"RTN","RORNTEG",96,0)
RORRP026 ;;10022660
"RTN","RORNTEG",97,0)
RORRP027 ;;6640755
"RTN","RORNTEG",98,0)
RORRP029 ;;1527601
"RTN","RORNTEG",99,0)
RORRP030 ;;6154417
"RTN","RORNTEG",100,0)
RORRP031 ;;4897990
"RTN","RORNTEG",101,0)
RORRP032 ;;4897358
"RTN","RORNTEG",102,0)
RORRP033 ;;4204729
"RTN","RORNTEG",103,0)
RORRP034 ;;3265353
"RTN","RORNTEG",104,0)
RORRP035 ;;1615892
"RTN","RORNTEG",105,0)
RORRP1 ;;2796927
"RTN","RORNTEG",106,0)
RORRP10 ;;476541
"RTN","RORNTEG",107,0)
RORRP2 ;;4566009
"RTN","RORNTEG",108,0)
RORRP3 ;;3482249
"RTN","RORNTEG",109,0)
RORRP4 ;;5079227
"RTN","RORNTEG",110,0)
RORRP5 ;;1825009
"RTN","RORNTEG",111,0)
RORRP6 ;;3979336
"RTN","RORNTEG",112,0)
RORRP7 ;;4925487
"RTN","RORNTEG",113,0)
RORRP8 ;;3614530
"RTN","RORNTEG",114,0)
RORRP9 ;;8101985
"RTN","RORNTEG",115,0)
RORSET01 ;;4676823
"RTN","RORNTEG",116,0)
RORSETU1 ;;2833894
"RTN","RORNTEG",117,0)
RORSETU2 ;;2901879
"RTN","RORNTEG",118,0)
RORTSK ;;3791239
"RTN","RORNTEG",119,0)
RORTSK01 ;;7060222
"RTN","RORNTEG",120,0)
RORTSK02 ;;4617240
"RTN","RORNTEG",121,0)
RORTSK03 ;;2086919
"RTN","RORNTEG",122,0)
RORTSK10 ;;5534300
"RTN","RORNTEG",123,0)
RORTSK11 ;;3125173
"RTN","RORNTEG",124,0)
RORTXT ;;141117
"RTN","RORNTEG",125,0)
RORUPD ;;3654485
"RTN","RORNTEG",126,0)
RORUPD01 ;;7989261
"RTN","RORNTEG",127,0)
RORUPD04 ;;5149249
"RTN","RORNTEG",128,0)
RORUPD05 ;;7177293
"RTN","RORNTEG",129,0)
RORUPD06 ;;3084967
"RTN","RORNTEG",130,0)
RORUPD07 ;;2080523
"RTN","RORNTEG",131,0)
RORUPD08 ;;3835247
"RTN","RORNTEG",132,0)
RORUPD09 ;;2534692
"RTN","RORNTEG",133,0)
RORUPD50 ;;3446977
"RTN","RORNTEG",134,0)
RORUPD51 ;;6373941
"RTN","RORNTEG",135,0)
RORUPD52 ;;2583157
"RTN","RORNTEG",136,0)
RORUPDUT ;;7040706
"RTN","RORNTEG",137,0)
RORUPEX ;;3382608
"RTN","RORNTEG",138,0)
RORUPP01 ;;3620688
"RTN","RORNTEG",139,0)
RORUPP02 ;;3149282
"RTN","RORNTEG",140,0)
RORUPR ;;5403597
"RTN","RORNTEG",141,0)
RORUPR1 ;;10865390
"RTN","RORNTEG",142,0)
RORUTL01 ;;4698317
"RTN","RORNTEG",143,0)
RORUTL02 ;;5461265
"RTN","RORNTEG",144,0)
RORUTL03 ;;8322358
"RTN","RORNTEG",145,0)
RORUTL04 ;;2076790
"RTN","RORNTEG",146,0)
RORUTL05 ;;6817092
"RTN","RORNTEG",147,0)
RORUTL06 ;;9129215
"RTN","RORNTEG",148,0)
RORUTL07 ;;2762456
"RTN","RORNTEG",149,0)
RORUTL08 ;;3052928
"RTN","RORNTEG",150,0)
RORUTL09 ;;1836557
"RTN","RORNTEG",151,0)
RORUTL10 ;;5738979
"RTN","RORNTEG",152,0)
RORUTL11 ;;942933
"RTN","RORNTEG",153,0)
RORUTL14 ;;1275115
"RTN","RORNTEG",154,0)
RORUTL15 ;;5565629
"RTN","RORNTEG",155,0)
RORUTL16 ;;1877801
"RTN","RORNTEG",156,0)
RORUTL17 ;;6970881
"RTN","RORNTEG",157,0)
RORUTL18 ;;285281
"RTN","RORNTEG",158,0)
RORVM001 ;;1220339
"RTN","RORNTEG",159,0)
RORX000 ;;2233772
"RTN","RORNTEG",160,0)
RORX001 ;;6923293
"RTN","RORNTEG",161,0)
RORX002 ;;3760280
"RTN","RORNTEG",162,0)
RORX003 ;;5404752
"RTN","RORNTEG",163,0)
RORX003A ;;7951022
"RTN","RORNTEG",164,0)
RORX004 ;;4970351
"RTN","RORNTEG",165,0)
RORX005 ;;2080717
"RTN","RORNTEG",166,0)
RORX005A ;;7139090
"RTN","RORNTEG0")
0^28^B4128508
"RTN","RORNTEG0",1,0)
RORNTEG0 ;ISC/XTSUMBLD KERNEL - Package checksum checker ; 6/29/04 9:01am
"RTN","RORNTEG0",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**3,4,5,6**;May 14, 2002
"RTN","RORNTEG0",3,0)
 ;;7.3;3040629.080209
"RTN","RORNTEG0",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG0",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","RORNTEG0",6,0)
 ;
"RTN","RORNTEG0",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","RORNTEG0",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","RORNTEG0",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","RORNTEG0",10,0)
 W ! G CONT
"RTN","RORNTEG0",11,0)
ROU ;;
"RTN","RORNTEG0",12,0)
RORX005B ;;6769514
"RTN","RORNTEG0",13,0)
RORX005C ;;11147808
"RTN","RORNTEG0",14,0)
RORX005U ;;266710
"RTN","RORNTEG0",15,0)
RORX006 ;;1929501
"RTN","RORNTEG0",16,0)
RORX006A ;;5949892
"RTN","RORNTEG0",17,0)
RORX006C ;;4940545
"RTN","RORNTEG0",18,0)
RORX007 ;;7810802
"RTN","RORNTEG0",19,0)
RORX007A ;;2762724
"RTN","RORNTEG0",20,0)
RORX008 ;;1936486
"RTN","RORNTEG0",21,0)
RORX008A ;;6748545
"RTN","RORNTEG0",22,0)
RORX009 ;;2635430
"RTN","RORNTEG0",23,0)
RORX009A ;;6814376
"RTN","RORNTEG0",24,0)
RORX009C ;;7407361
"RTN","RORNTEG0",25,0)
RORX010 ;;5947630
"RTN","RORNTEG0",26,0)
RORX011 ;;6937846
"RTN","RORNTEG0",27,0)
RORX012 ;;2280944
"RTN","RORNTEG0",28,0)
RORX012A ;;6424353
"RTN","RORNTEG0",29,0)
RORX013 ;;1826953
"RTN","RORNTEG0",30,0)
RORX013A ;;7197965
"RTN","RORNTEG0",31,0)
RORX013C ;;3062651
"RTN","RORNTEG0",32,0)
RORX014 ;;1995239
"RTN","RORNTEG0",33,0)
RORX014A ;;6019953
"RTN","RORNTEG0",34,0)
RORXU001 ;;2415732
"RTN","RORNTEG0",35,0)
RORXU002 ;;7009537
"RTN","RORNTEG0",36,0)
RORXU003 ;;5395052
"RTN","RORNTEG0",37,0)
RORXU004 ;;405249
"RTN","RORNTEG0",38,0)
RORXU005 ;;2334516
"RTN","RORNTEG0",39,0)
RORXU006 ;;4584240
"RTN","RORNTEG0",40,0)
RORXU007 ;;5726275
"RTN","RORP003")
1^29
"RTN","RORP004")
1^30
"RTN","RORP005")
1^31
"RTN","RORP005B")
1^32
"RTN","RORP006")
0^^B17043899
"RTN","RORP006",1,0)
RORP006 ;HCIOFO/SG - PATCH INSTALLATION ROUTINE (ROR*1.0*6) ; 6/30/04 11:37am
"RTN","RORP006",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**6**;May 14, 2002
"RTN","RORP006",3,0)
 ;
"RTN","RORP006",4,0)
 ;***** ENVIRONMENT CHECK
"RTN","RORP006",5,0)
 N TMP
"RTN","RORP006",6,0)
 I $G(DUZ)'>0  D  S XPDABORT=2  Q
"RTN","RORP006",7,0)
 . W !!,"The DUZ variable must be defined!",!
"RTN","RORP006",8,0)
 ;--- Check the security key(s)
"RTN","RORP006",9,0)
 I '$D(^XUSEC("ROR VA IRM",DUZ))  D  Q
"RTN","RORP006",10,0)
 . W !!,"You must have the ROR VA IRM security key!",!
"RTN","RORP006",11,0)
 . S XPDABORT=2
"RTN","RORP006",12,0)
 ;
"RTN","RORP006",13,0)
 ;--- Installation section
"RTN","RORP006",14,0)
 Q:'$G(XPDENV)
"RTN","RORP006",15,0)
 ;--- Check the scheduled option
"RTN","RORP006",16,0)
 Q:$$CHKOPT^RORKIDS("ROR TASK")<0
"RTN","RORP006",17,0)
 Q
"RTN","RORP006",18,0)
 ;
"RTN","RORP006",19,0)
 ;***** RESTORES THE CDC DEFINITION
"RTN","RORP006",20,0)
 ;
"RTN","RORP006",21,0)
 ; [RORREG]      Registry IEN and registry name separated by the '^'
"RTN","RORP006",22,0)
 ;               (RegistryIEN^RegistryName).
"RTN","RORP006",23,0)
 ;
"RTN","RORP006",24,0)
 ; If some of these parameters are omitted or equal to an empty
"RTN","RORP006",25,0)
 ; strings, their values must be defined as the RORPARM("KIDS")
"RTN","RORP006",26,0)
 ; sub-nodes of the same name.
"RTN","RORP006",27,0)
 ;
"RTN","RORP006",28,0)
 ; Return Values:
"RTN","RORP006",29,0)
 ;       <0  Error code
"RTN","RORP006",30,0)
 ;        0  Ok
"RTN","RORP006",31,0)
 ;
"RTN","RORP006",32,0)
CDCDEF(RORREG) ;
"RTN","RORP006",33,0)
 N RC,RESULTS,RORBUF
"RTN","RORP006",34,0)
 D BMES^RORKIDS("Restoring the CDC definition...")
"RTN","RORP006",35,0)
 ;--- Restore the definition from the transport global
"RTN","RORP006",36,0)
 M RORBUF=@XPDGREF@("RORCDCDEF")
"RTN","RORP006",37,0)
 D SETPARM^RORRP012(.RESULTS,"ICRCDCDEF","PKG",.RORBUF)
"RTN","RORP006",38,0)
 Q:$G(RESULTS(0))<0 +RESULTS(0)
"RTN","RORP006",39,0)
 ;--- Success
"RTN","RORP006",40,0)
 D MES^RORKIDS("The definition has been restored successfully.")
"RTN","RORP006",41,0)
 Q 0
"RTN","RORP006",42,0)
 ;
"RTN","RORP006",43,0)
 ;***** ERROR PROCESSING
"RTN","RORP006",44,0)
ERROR ;
"RTN","RORP006",45,0)
 N TMP  S XPDABORT=1
"RTN","RORP006",46,0)
 I $D(ZTQUEUED)  D  D ALERT^RORKIDS(DUZ,-43,REGNAME,,TMP)
"RTN","RORP006",47,0)
 . S TMP=+$G(RORPARM("KIDS"))
"RTN","RORP006",48,0)
 . S TMP=$S(TMP=1:"pre-",TMP=2:"post-",1:"")_"install"
"RTN","RORP006",49,0)
 D DSPSTK^RORERR(),ABTMSG^RORKIDS()
"RTN","RORP006",50,0)
 Q
"RTN","RORP006",51,0)
 ;
"RTN","RORP006",52,0)
 ;***** POST-INSTALL ENTRY POINT
"RTN","RORP006",53,0)
POS ;
"RTN","RORP006",54,0)
 N RORERROR      ; Error processing data
"RTN","RORP006",55,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORP006",56,0)
 N RORPARM       ; Application parameters
"RTN","RORP006",57,0)
 ;
"RTN","RORP006",58,0)
 N RC,REGIEN,REGNAME,TMP
"RTN","RORP006",59,0)
 S RORPARM("DEVELOPER")=1   ; Enable modifications
"RTN","RORP006",60,0)
 S RORPARM("ERR")=1         ; Enable error processing
"RTN","RORP006",61,0)
 S RORPARM("KIDS")=2        ; Post-install indicator
"RTN","RORP006",62,0)
 S RORPARM("LOG")=1         ; Enable error recording
"RTN","RORP006",63,0)
 ;
"RTN","RORP006",64,0)
 ;--- Open a new log
"RTN","RORP006",65,0)
 S (TMP("VA HEPC"),TMP("VA ICR"))=""
"RTN","RORP006",66,0)
 S TMP=$$OPEN^RORLOG(.TMP,0,XPDNM_" POST-INSTALL STARTED")
"RTN","RORP006",67,0)
 K TMP
"RTN","RORP006",68,0)
 ;
"RTN","RORP006",69,0)
 ;=== HEPC
"RTN","RORP006",70,0)
 ;
"RTN","RORP006",71,0)
 S REGNAME="VA HEPC"        ; Registry Name
"RTN","RORP006",72,0)
 S RORPARM("KIDS","RORDRGAD")="DRUGADD^RORP006"
"RTN","RORP006",73,0)
 S RORPARM("KIDS","RORDRGRM")="DRUGREM^RORP006"
"RTN","RORP006",74,0)
 ;
"RTN","RORP006",75,0)
 ;--- IEN of the registry
"RTN","RORP006",76,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME)  G:REGIEN<0 ERROR
"RTN","RORP006",77,0)
 S RORPARM("KIDS","RORREG")=REGIEN_U_REGNAME
"RTN","RORP006",78,0)
 ;
"RTN","RORP006",79,0)
 ;--- Update the DRUG THERAPY LIST multiple
"RTN","RORP006",80,0)
 G:$$CP^RORKIDS("POS05","$$DRUGADD^RORPUT01")<0 ERROR
"RTN","RORP006",81,0)
 G:$$CP^RORKIDS("POS10","$$DRUGREM^RORPUT01")<0 ERROR
"RTN","RORP006",82,0)
 ;
"RTN","RORP006",83,0)
 ;=== ICR
"RTN","RORP006",84,0)
 ;
"RTN","RORP006",85,0)
 S REGNAME="VA ICR"         ; Registry Name
"RTN","RORP006",86,0)
 ;
"RTN","RORP006",87,0)
 ;--- IEN of the registry
"RTN","RORP006",88,0)
 S REGIEN=$$REGIEN^RORUTL02(REGNAME)  G:REGIEN<0 ERROR
"RTN","RORP006",89,0)
 S RORPARM("KIDS","RORREG")=REGIEN_U_REGNAME
"RTN","RORP006",90,0)
 ;
"RTN","RORP006",91,0)
 ;--- Restore the CDC definition
"RTN","RORP006",92,0)
 G:$$CP^RORKIDS("POS15","$$CDCDEF^RORP006")<0 ERROR
"RTN","RORP006",93,0)
 ;
"RTN","RORP006",94,0)
 ;--- Re-send the notification e-mail
"RTN","RORP006",95,0)
 S TMP=$$SENDINFO^RORUTL17(REGIEN,,"P")
"RTN","RORP006",96,0)
 ;
"RTN","RORP006",97,0)
 ;--- Close the log
"RTN","RORP006",98,0)
 D CLOSE^RORLOG(XPDNM_" POST-INSTALL COMPLETED")
"RTN","RORP006",99,0)
 Q
"RTN","RORP006",100,0)
 ;
"RTN","RORP006",101,0)
 ;***** PRE-TRANSPORTATION ENTRY POINT
"RTN","RORP006",102,0)
PTR ;
"RTN","RORP006",103,0)
 N RORBUF
"RTN","RORP006",104,0)
 ;--- Copy the CDC definition to the transport global
"RTN","RORP006",105,0)
 D GETPARM^RORRP012(.RORBUF,"ICRCDCDEF","PKG")
"RTN","RORP006",106,0)
 K RORBUF(0)  M @XPDGREF@("RORCDCDEF")=RORBUF
"RTN","RORP006",107,0)
 Q
"RTN","RORP006",108,0)
 ;
"RTN","RORP006",109,0)
 ;***** HEPC NDC CODE TO ADD
"RTN","RORP006",110,0)
DRUGADD ;
"RTN","RORP006",111,0)
 ;; 000004035239, 000004201607, 000004201609, 000004201707,
"RTN","RORP006",112,0)
 ;; 000004201709, 000085053901, 000085057102, 000085111001,
"RTN","RORP006",113,0)
 ;; 000085113301, 000085116801, 000085117902, 000085129701,
"RTN","RORP006",114,0)
 ;; 000085131601, 000085131801, 000085132301, 000085137001,
"RTN","RORP006",115,0)
 ;; 000085138507, 000187000714, 038779025605, 038779025608,
"RTN","RORP006",116,0)
 ;; 038779025609, 049452622101, 049452622103, 049452622104,
"RTN","RORP006",117,0)
 ;; 054569542700, 054868334100, 062991207701, 062991207702,
"RTN","RORP006",118,0)
 ;; 062991207703, 063370021950, 063370021955, 064116003101,
"RTN","RORP006",119,0)
 ;; 064116003106, 064116003124, 064116003901, 064116003906,
"RTN","RORP006",120,0)
 ;; 064116003924
"RTN","RORP006",121,0)
 ;
"RTN","RORP006",122,0)
 ;***** HEPC NDC CODE TO REMOVE
"RTN","RORP006",123,0)
DRUGREM ;
"RTN","RORP006",124,0)
 ;; 000004035639, 000004198701, 000004198709, 000004200909,
"RTN","RORP006",125,0)
 ;; 000085064703, 000085064704, 000085064705, 000085118401,
"RTN","RORP006",126,0)
 ;; 000085118402, 055513055401, 055513055406, 055513056201,
"RTN","RORP006",127,0)
 ;; 055513056206, 055513092601, 055513092606, 055513092701,
"RTN","RORP006",128,0)
 ;; 055513092706, 999999777701, 999999999999
"RTN","RORP006",129,0)
 ;
"RTN","RORRP012")
0^15^B16756305
"RTN","RORRP012",1,0)
RORRP012 ;HCIOFO/SG - RPC: MISCELLANEOUS ; 4/21/04 8:57am
"RTN","RORRP012",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORRP012",3,0)
 ;
"RTN","RORRP012",4,0)
 ; This routine uses the following IA's:
"RTN","RORRP012",5,0)
 ;
"RTN","RORRP012",6,0)
 ; #2263         Supported parameter tools (GETWP^XPAR and PUT^XPAR)
"RTN","RORRP012",7,0)
 ;
"RTN","RORRP012",8,0)
 Q
"RTN","RORRP012",9,0)
 ;
"RTN","RORRP012",10,0)
 ;***** RETRIEVES THE VALUE OF THE GUI PARAMETER
"RTN","RORRP012",11,0)
 ; RPC: [ROR GUI PARAMETER GET]
"RTN","RORRP012",12,0)
 ;
"RTN","RORRP012",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",14,0)
 ;               are returned to.
"RTN","RORRP012",15,0)
 ;
"RTN","RORRP012",16,0)
 ; NAME          Name of the GUI parameter
"RTN","RORRP012",17,0)
 ;
"RTN","RORRP012",18,0)
 ; [ENTITY]      Entity where the parameter value is searched for.
"RTN","RORRP012",19,0)
 ;               By default ($G(ENTITY)=""), the "ALL" value is used
"RTN","RORRP012",20,0)
 ;               (see the DBIA #2263 for more details).
"RTN","RORRP012",21,0)
 ;
"RTN","RORRP012",22,0)
 ; Return Values:
"RTN","RORRP012",23,0)
 ;
"RTN","RORRP012",24,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP012",25,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP012",26,0)
 ;
"RTN","RORRP012",27,0)
 ; Otherwise, the RESULTS(0) will contain 0 and the subsequent nodes
"RTN","RORRP012",28,0)
 ; of the RESULTS array will contain the lines of parameter value.
"RTN","RORRP012",29,0)
 ;
"RTN","RORRP012",30,0)
GETPARM(RESULTS,NAME,ENTITY) ;
"RTN","RORRP012",31,0)
 N CNT,I,RC,RORBUF,RORERRDL,RORMSG  K RESULTS
"RTN","RORRP012",32,0)
 D CLEAR^RORERR("GETPARM^RORRP012",1)
"RTN","RORRP012",33,0)
 S:$G(ENTITY)="" ENTITY="ALL"
"RTN","RORRP012",34,0)
 D GETWP^XPAR(.RORBUF,ENTITY,"ROR GUI PARAMETER",NAME,.RORMSG)
"RTN","RORRP012",35,0)
 I $G(RORMSG)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",36,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"GETWP^XPAR")
"RTN","RORRP012",37,0)
 S I="",CNT=0
"RTN","RORRP012",38,0)
 F  S I=$O(RORBUF(I))  Q:I=""  D
"RTN","RORRP012",39,0)
 . S CNT=CNT+1,RESULTS(CNT)=RORBUF(I,0)  K RORBUF(I)
"RTN","RORRP012",40,0)
 S RESULTS(0)=0
"RTN","RORRP012",41,0)
 Q
"RTN","RORRP012",42,0)
 ;
"RTN","RORRP012",43,0)
 ;***** RETURNS THE CURRENT DATE/TIME ON THE SERVER
"RTN","RORRP012",44,0)
 ; RPC: [ROR GET SERVER TIME]
"RTN","RORRP012",45,0)
 ;
"RTN","RORRP012",46,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",47,0)
 ;               are returned to.
"RTN","RORRP012",48,0)
 ;
"RTN","RORRP012",49,0)
 ; Return Values:
"RTN","RORRP012",50,0)
 ;
"RTN","RORRP012",51,0)
 ; The current dat/time (in internal FileMan format) is returned
"RTN","RORRP012",52,0)
 ; in the RESULTS(1). RESULTS(0) alwais contains 0.
"RTN","RORRP012",53,0)
 ;
"RTN","RORRP012",54,0)
GETSRVDT(RESULTS) ;
"RTN","RORRP012",55,0)
 S RESULTS(0)=0
"RTN","RORRP012",56,0)
 S RESULTS(1)=$$NOW^XLFDT
"RTN","RORRP012",57,0)
 Q
"RTN","RORRP012",58,0)
 ;
"RTN","RORRP012",59,0)
 ;***** RETURNS A LIST OF ITEMS FROM THE 'ROR LIST ITEM' FILE
"RTN","RORRP012",60,0)
 ; RPC: [ROR LIST ITEMS]
"RTN","RORRP012",61,0)
 ;
"RTN","RORRP012",62,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",63,0)
 ;               are returned to.
"RTN","RORRP012",64,0)
 ;
"RTN","RORRP012",65,0)
 ; REGIEN        Registry IEN
"RTN","RORRP012",66,0)
 ;
"RTN","RORRP012",67,0)
 ; TYPE          Type of the items:
"RTN","RORRP012",68,0)
 ;                 1  Reason for inactivation
"RTN","RORRP012",69,0)
 ;                 2  Supporting evidence
"RTN","RORRP012",70,0)
 ;                 3  Lab Group
"RTN","RORRP012",71,0)
 ;
"RTN","RORRP012",72,0)
 ; Return Values:
"RTN","RORRP012",73,0)
 ;
"RTN","RORRP012",74,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP012",75,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP012",76,0)
 ; details).
"RTN","RORRP012",77,0)
 ;
"RTN","RORRP012",78,0)
 ; Otherwise, number of items is returned in the RESULTS(0)
"RTN","RORRP012",79,0)
 ; and the subsequent nodes of the array contain the items.
"RTN","RORRP012",80,0)
 ; 
"RTN","RORRP012",81,0)
 ; RESULTS(0)            Number of item
"RTN","RORRP012",82,0)
 ;
"RTN","RORRP012",83,0)
 ; RESULTS(i)            List Item
"RTN","RORRP012",84,0)
 ;                         ^01: IEN
"RTN","RORRP012",85,0)
 ;                         ^02: Text
"RTN","RORRP012",86,0)
 ;                         ^03: Code
"RTN","RORRP012",87,0)
 ;
"RTN","RORRP012",88,0)
LSTITEMS(RESULTS,REGIEN,TYPE) ;
"RTN","RORRP012",89,0)
 N CNT,CODE,ITEMS,RC,RORERRDL
"RTN","RORRP012",90,0)
 D CLEAR^RORERR("LSTITEMS^RORRP012",1)
"RTN","RORRP012",91,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP012",92,0)
 ;--- Check the parameters
"RTN","RORRP012",93,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",94,0)
 . ;--- Registry IEN
"RTN","RORRP012",95,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP012",96,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP012",97,0)
 . S REGIEN=+REGIEN
"RTN","RORRP012",98,0)
 . ;--- Type
"RTN","RORRP012",99,0)
 . I $G(TYPE)'>0  D  Q
"RTN","RORRP012",100,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"TYPE",$G(TYPE))
"RTN","RORRP012",101,0)
 . S TYPE=+TYPE
"RTN","RORRP012",102,0)
 ;--- Load the list items
"RTN","RORRP012",103,0)
 S RC=$$ITEMLIST^RORUTL09(TYPE,REGIEN,.ITEMS)
"RTN","RORRP012",104,0)
 ;--- Populate the output array
"RTN","RORRP012",105,0)
 S CODE="",CNT=0
"RTN","RORRP012",106,0)
 F  S CODE=$O(ITEMS(CODE))  Q:CODE=""  D
"RTN","RORRP012",107,0)
 . S CNT=CNT+1,RESULTS(CNT)=$P(ITEMS(CODE),U,1,2)
"RTN","RORRP012",108,0)
 . S $P(RESULTS(CNT),U,3)=CODE
"RTN","RORRP012",109,0)
 S RESULTS(0)=CNT
"RTN","RORRP012",110,0)
 Q
"RTN","RORRP012",111,0)
 ;
"RTN","RORRP012",112,0)
 ;***** STORES THE VALUE OF THE GUI PARAMETER
"RTN","RORRP012",113,0)
 ; RPC: [ROR GUI PARAMETER SET]
"RTN","RORRP012",114,0)
 ;
"RTN","RORRP012",115,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",116,0)
 ;               are returned to.
"RTN","RORRP012",117,0)
 ;
"RTN","RORRP012",118,0)
 ; NAME          Name of the GUI parameter
"RTN","RORRP012",119,0)
 ;
"RTN","RORRP012",120,0)
 ; [ENTITY]      Entity that the parameter is associated with.
"RTN","RORRP012",121,0)
 ;               By default ($G(ENTITY)=""), the "USR" value is used
"RTN","RORRP012",122,0)
 ;               (see the DBIA #2263 for more details).
"RTN","RORRP012",123,0)
 ;
"RTN","RORRP012",124,0)
 ; [.]VALUE      Value of the parameter. It should be either a string
"RTN","RORRP012",125,0)
 ;               or a reference to a local array that contains a text
"RTN","RORRP012",126,0)
 ;               (prepared for a word-processing field).
"RTN","RORRP012",127,0)
 ;
"RTN","RORRP012",128,0)
 ;               The local array should not contain the 0 subscript
"RTN","RORRP012",129,0)
 ;               (it will not be stored).
"RTN","RORRP012",130,0)
 ;
"RTN","RORRP012",131,0)
 ;               You can use the "@" value to delete the parameter.
"RTN","RORRP012",132,0)
 ;
"RTN","RORRP012",133,0)
 ; Return Values:
"RTN","RORRP012",134,0)
 ;
"RTN","RORRP012",135,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP012",136,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP012",137,0)
 ;
"RTN","RORRP012",138,0)
 ; Otherwise, the RESULTS(0) will contain 0.
"RTN","RORRP012",139,0)
 ;
"RTN","RORRP012",140,0)
SETPARM(RESULTS,NAME,ENTITY,VALUE) ;
"RTN","RORRP012",141,0)
 N RC,RORERRDL,RORMSG,TMP  K RESULTS
"RTN","RORRP012",142,0)
 D CLEAR^RORERR("SETPARM^RORRP012",1)
"RTN","RORRP012",143,0)
 ;--- Check the parameters
"RTN","RORRP012",144,0)
 I $G(NAME)=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",145,0)
 . S RC=$$ERROR^RORERR(-88,,,,"NAME",$G(NAME))
"RTN","RORRP012",146,0)
 I '$D(VALUE)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",147,0)
 . S RC=$$ERROR^RORERR(-88,,,,"VALUE","<UNDEFINED>")
"RTN","RORRP012",148,0)
 S:$G(ENTITY)="" ENTITY="USR"
"RTN","RORRP012",149,0)
 ;--- Check for single-line parameter
"RTN","RORRP012",150,0)
 I $D(VALUE)=1,VALUE'="@"  S TMP=VALUE  K VALUE  S VALUE(1,0)=TMP
"RTN","RORRP012",151,0)
 ;--- Store the value
"RTN","RORRP012",152,0)
 D PUT^XPAR(ENTITY,"ROR GUI PARAMETER",NAME,.VALUE,.RORMSG)
"RTN","RORRP012",153,0)
 I $G(RORMSG),+RORMSG'=1  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP012",154,0)
 . S RC=$$ERROR^RORERR(-56,,$P(RORMSG,U,2),,+RORMSG,"PUT^XPAR")
"RTN","RORRP012",155,0)
 S RESULTS=0
"RTN","RORRP012",156,0)
 Q
"RTN","RORRP012",157,0)
 ;
"RTN","RORRP012",158,0)
 ;***** CHECKS IF THE RESCHEDULING CODE IS VALID
"RTN","RORRP012",159,0)
 ; ROR: [ROR TASK VALIDATE RESCHEDULING]
"RTN","RORRP012",160,0)
 ;
"RTN","RORRP012",161,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP012",162,0)
 ;               are returned to.
"RTN","RORRP012",163,0)
 ;
"RTN","RORRP012",164,0)
 ; SCHCODE       Rescheduling code
"RTN","RORRP012",165,0)
 ;
"RTN","RORRP012",166,0)
 ; [SCHDT]       Date when a task is scheduled to run for the
"RTN","RORRP012",167,0)
 ;               first time (FileMan). By default (if $G(SCHDT)'>0),
"RTN","RORRP012",168,0)
 ;               the current date/time is used.
"RTN","RORRP012",169,0)
 ;
"RTN","RORRP012",170,0)
 ; Return Values:
"RTN","RORRP012",171,0)
 ;
"RTN","RORRP012",172,0)
 ; A negative value of the first "^"-piece of the RESULTS(0) indicates
"RTN","RORRP012",173,0)
 ; an error (see the RPCSTK^RORERR procedure for more details).
"RTN","RORRP012",174,0)
 ;
"RTN","RORRP012",175,0)
 ; Otherwise, either 1 (the rescheduling code is valid) or 0 (the
"RTN","RORRP012",176,0)
 ; code is not valid) is returned in the RESULTS(0). If the code is
"RTN","RORRP012",177,0)
 ; valid then the next date/time to run the task (FileMan format)
"RTN","RORRP012",178,0)
 ; is returned in the RESULTS(1).
"RTN","RORRP012",179,0)
 ;
"RTN","RORRP012",180,0)
VALIDSCH(RESULTS,SCHCODE,SCHDT) ;
"RTN","RORRP012",181,0)
 N NEXT,RORMSG,TMP  K RESULTS
"RTN","RORRP012",182,0)
 I $G(SCHCODE)=""  S RESULTS(0)=1  Q
"RTN","RORRP012",183,0)
 S RESULTS(0)=0
"RTN","RORRP012",184,0)
 ;--- Check if the rescheduling code is correct
"RTN","RORRP012",185,0)
 S:$G(SCHDT)'>0 SCHDT=$$NOW^XLFDT
"RTN","RORRP012",186,0)
 S NEXT=$$SCH^XLFDT(SCHCODE,SCHDT,1)
"RTN","RORRP012",187,0)
 Q:NEXT'>0
"RTN","RORRP012",188,0)
 ;--- Make sure that a task will not be rescheduled in less
"RTN","RORRP012",189,0)
 ;--- than 60 seconds (to be able to delete it if necessary)
"RTN","RORRP012",190,0)
 S TMP=$$SCH^XLFDT(SCHCODE,NEXT,1)
"RTN","RORRP012",191,0)
 S:$$FMDIFF^XLFDT(TMP,NEXT,2)'<60 RESULTS(0)=1,RESULTS(1)=NEXT
"RTN","RORRP012",192,0)
 Q
"RTN","RORRP019")
0^34^B24433476
"RTN","RORRP019",1,0)
RORRP019 ;HCIOFO/SG - RPC: LIST OF PATIENTS ; 6/29/04 8:00am
"RTN","RORRP019",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORRP019",3,0)
 ;
"RTN","RORRP019",4,0)
 Q
"RTN","RORRP019",5,0)
 ;
"RTN","RORRP019",6,0)
 ;***** RETURNS THE LIST OF PATIENTS (EITHER FROM #798 OR #2)
"RTN","RORRP019",7,0)
 ; RPC: [ROR LIST PATIENTS]
"RTN","RORRP019",8,0)
 ;
"RTN","RORRP019",9,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP019",10,0)
 ;               are returned to.
"RTN","RORRP019",11,0)
 ;
"RTN","RORRP019",12,0)
 ; REGIEN        Registry IEN
"RTN","RORRP019",13,0)
 ;
"RTN","RORRP019",14,0)
 ; [DATE]        See description of the 'D flag below
"RTN","RORRP019",15,0)
 ;
"RTN","RORRP019",16,0)
 ; [PART]        The search pattern (partial match restriction)
"RTN","RORRP019",17,0)
 ;
"RTN","RORRP019",18,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP019",19,0)
 ;                 2  Search in the PATIENT file. By default, the
"RTN","RORRP019",20,0)
 ;                    ROR LOCAL REGISTRY and ROR PATIENT files are
"RTN","RORRP019",21,0)
 ;                    queried. This flag overrides the 'D', 'N' and
"RTN","RORRP019",22,0)
 ;                    'P' flags.
"RTN","RORRP019",23,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP019",24,0)
 ;                    direction of normal traversal.
"RTN","RORRP019",25,0)
 ;                 D  Ignore those patients who were added to the
"RTN","RORRP019",26,0)
 ;                    registry before the date defined by the DATE
"RTN","RORRP019",27,0)
 ;                    parameter.
"RTN","RORRP019",28,0)
 ;                 N  Include only new patients (AUTO or MANUAL)
"RTN","RORRP019",29,0)
 ;                 O  Add values of the optional fields
"RTN","RORRP019",30,0)
 ;                 P  Include only pending patients
"RTN","RORRP019",31,0)
 ;
"RTN","RORRP019",32,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP019",33,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP019",34,0)
 ;
"RTN","RORRP019",35,0)
 ; [FROM]        The index entry(s) from which to begin the list.
"RTN","RORRP019",36,0)
 ;               You should use the pieces of the @RESULTS@(0) node
"RTN","RORRP019",37,0)
 ;               (starting from the second one) to continue the
"RTN","RORRP019",38,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP019",39,0)
 ;
"RTN","RORRP019",40,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP019",41,0)
 ;                     the resulting list.
"RTN","RORRP019",42,0)
 ;
"RTN","RORRP019",43,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP019",44,0)
 ;
"RTN","RORRP019",45,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP019",46,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP019",47,0)
 ;
"RTN","RORRP019",48,0)
 ; Return Values:
"RTN","RORRP019",49,0)
 ;
"RTN","RORRP019",50,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP019",51,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP019",52,0)
 ; details).
"RTN","RORRP019",53,0)
 ;
"RTN","RORRP019",54,0)
 ; Otherwise, number of patients and the value of the FROM
"RTN","RORRP019",55,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP019",56,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP019",57,0)
 ; contain the patients.
"RTN","RORRP019",58,0)
 ; 
"RTN","RORRP019",59,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP019",60,0)
 ;                         ^01: Number of patients
"RTN","RORRP019",61,0)
 ;                         ^02: Values that comprise the FROM
"RTN","RORRP019",62,0)
 ;                         ^nn: parameter for the subsequent call
"RTN","RORRP019",63,0)
 ;
"RTN","RORRP019",64,0)
 ; @RESULTS@(i)          Patient
"RTN","RORRP019",65,0)
 ;                         ...  See the $$LOAD2^RORRP020 (RORDEM)
"RTN","RORRP019",66,0)
 ;
"RTN","RORRP019",67,0)
 ; @RESULTS@(i+1)        Optional fields (these nodes are created only
"RTN","RORRP019",68,0)
 ;                       if the FLAGS parameter contains the 'O' flag)
"RTN","RORRP019",69,0)
 ;                         ^01: "O" (letter O)
"RTN","RORRP019",70,0)
 ;                         ...  See the $$LOAD798^RORRP020
"RTN","RORRP019",71,0)
 ;
"RTN","RORRP019",72,0)
PTLIST(RESULTS,REGIEN,DATE,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",73,0)
 N BUF,I,RC,RORERRDL,TMP
"RTN","RORRP019",74,0)
 D CLEAR^RORERR("PTLIST^RORRP019",1)
"RTN","RORRP019",75,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP019",76,0)
 ;--- Check the parameters
"RTN","RORRP019",77,0)
 S RC=0  D  I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",78,0)
 . ;--- Registry IEN
"RTN","RORRP019",79,0)
 . I $G(REGIEN)'>0  D  Q
"RTN","RORRP019",80,0)
 . . S RC=$$ERROR^RORERR(-88,,,,"REGIEN",$G(REGIEN))
"RTN","RORRP019",81,0)
 . S REGIEN=+REGIEN
"RTN","RORRP019",82,0)
 . ;--- Flags
"RTN","RORRP019",83,0)
 . S FLAGS=$$UP^XLFSTR($G(FLAGS)),DATE=+$G(DATE)
"RTN","RORRP019",84,0)
 . S:FLAGS["2" FLAGS=$TR(FLAGS,"DNP")
"RTN","RORRP019",85,0)
 . ;--- Others
"RTN","RORRP019",86,0)
 . S PART=$G(PART),FROM=$G(FROM)
"RTN","RORRP019",87,0)
 . S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP019",88,0)
 ;--- Setup the start point
"RTN","RORRP019",89,0)
 F I=1:1  S TMP=$P(FROM,U,I)  Q:TMP=""  S FROM(I)=TMP
"RTN","RORRP019",90,0)
 S FROM=$G(FROM(1))
"RTN","RORRP019",91,0)
 ;--- Query the file
"RTN","RORRP019",92,0)
 S RC=0  D
"RTN","RORRP019",93,0)
 . I FLAGS["2"  D  Q
"RTN","RORRP019",94,0)
 . . S RC=$$LST2(REGIEN,PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP019",95,0)
 . I $TR(FLAGS,"NP")'=FLAGS  D  Q
"RTN","RORRP019",96,0)
 . . S RC=$$LST798A(REGIEN,PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP019",97,0)
 . S RC=$$LST798(REGIEN,+DATE,PART,FLAGS,NUMBER,.FROM)
"RTN","RORRP019",98,0)
 ;--- Check for the error(s)
"RTN","RORRP019",99,0)
 I RC<0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",100,0)
 . K ^TMP("DILIST",$J)
"RTN","RORRP019",101,0)
 ;--- Post-processing
"RTN","RORRP019",102,0)
 S RC=$$POSTPROC^RORRP020(RESULTS,REGIEN,FLAGS)
"RTN","RORRP019",103,0)
 I RC<0  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP019",104,0)
 ;--- Success
"RTN","RORRP019",105,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP019",106,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP019",107,0)
 I $P(TMP,U,3)  S I=0  D
"RTN","RORRP019",108,0)
 . F  S I=$O(FROM(I))  Q:I'>0  S TMP=FROM(I)  S:TMP'="" BUF=BUF_U_TMP
"RTN","RORRP019",109,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP019",110,0)
 Q
"RTN","RORRP019",111,0)
 ;
"RTN","RORRP019",112,0)
 ;***** QUERIES THE 'PATIENT' FILE (#2)
"RTN","RORRP019",113,0)
 ;
"RTN","RORRP019",114,0)
 ; RORREG        Registry IEN
"RTN","RORRP019",115,0)
 ;
"RTN","RORRP019",116,0)
 ; PART          The partial match restriction
"RTN","RORRP019",117,0)
 ;
"RTN","RORRP019",118,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP019",119,0)
 ;
"RTN","RORRP019",120,0)
 ; NUMBER        Maximum number of entries to return
"RTN","RORRP019",121,0)
 ;
"RTN","RORRP019",122,0)
 ; .FROM         Reference to a local variable that contains the
"RTN","RORRP019",123,0)
 ;               starting point for the LIST^DIC. The new point is
"RTN","RORRP019",124,0)
 ;               returned in this variable as well.
"RTN","RORRP019",125,0)
 ;
"RTN","RORRP019",126,0)
 ; Return Values:
"RTN","RORRP019",127,0)
 ;       <0  Error code
"RTN","RORRP019",128,0)
 ;        0  Ok
"RTN","RORRP019",129,0)
 ;
"RTN","RORRP019",130,0)
LST2(RORREG,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",131,0)
 N RC,RORMSG,SCR,TMP,XREF
"RTN","RORRP019",132,0)
 S XREF=$S(PART?4N:"BS",PART?1U4N:"BS5",PART?9N.1"P":"SSN",1:"B")
"RTN","RORRP019",133,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP019",134,0)
 S SCR="I '$$SKIPEMPL^RORUTL02(+Y,.RORREG)"
"RTN","RORRP019",135,0)
 ;--- Get the list of patients
"RTN","RORRP019",136,0)
 S TMP="P"_$S(FLAGS["B":"B",1:"")_$S(XREF="B":"M",1:"")
"RTN","RORRP019",137,0)
 D LIST^DIC(2,,"@",TMP,NUMBER,.FROM,PART,XREF,SCR,,,"RORMSG")
"RTN","RORRP019",138,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,2)
"RTN","RORRP019",139,0)
 ;---
"RTN","RORRP019",140,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","RORRP019",141,0)
 ;
"RTN","RORRP019",142,0)
 ;***** QUERIES THE 'ROR PATIENT' FILE (#798.4)
"RTN","RORRP019",143,0)
 ;
"RTN","RORRP019",144,0)
 ; RORREG        Registry IEN
"RTN","RORRP019",145,0)
 ;
"RTN","RORRP019",146,0)
 ; RORDT         Ignore patietns who were added to the registry
"RTN","RORRP019",147,0)
 ;               before the provided date (if the FLAGS parameter
"RTN","RORRP019",148,0)
 ;               contains the "D" flag)
"RTN","RORRP019",149,0)
 ;
"RTN","RORRP019",150,0)
 ; PART          The partial match restriction
"RTN","RORRP019",151,0)
 ;
"RTN","RORRP019",152,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP019",153,0)
 ;
"RTN","RORRP019",154,0)
 ; NUMBER        Maximum number of entries to return
"RTN","RORRP019",155,0)
 ;
"RTN","RORRP019",156,0)
 ; .FROM         Reference to a local variable that contains the
"RTN","RORRP019",157,0)
 ;               starting point for the LIST^DIC. The new point is
"RTN","RORRP019",158,0)
 ;               returned in this variable as well.
"RTN","RORRP019",159,0)
 ;
"RTN","RORRP019",160,0)
 ; Return Values:
"RTN","RORRP019",161,0)
 ;       <0  Error code
"RTN","RORRP019",162,0)
 ;        0  Ok
"RTN","RORRP019",163,0)
 ;
"RTN","RORRP019",164,0)
LST798(RORREG,RORDT,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",165,0)
 N RC,RORMSG,SCR,TMP,XREF
"RTN","RORRP019",166,0)
 S XREF=$S(PART?4N:"BS",PART?1U4N:"BS5",PART?9N.1"P":"SSN",1:"B")
"RTN","RORRP019",167,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP019",168,0)
 S SCR="S D=$O(^RORDATA(798,""KEY"",+Y,RORREG,0)) I D>0 "
"RTN","RORRP019",169,0)
 I FLAGS["D"  D  Q:'$D(SCR) 0
"RTN","RORRP019",170,0)
 . S SCR=SCR_"I $P($G(^RORDATA(798,D,0)),U,3)'<RORDT "
"RTN","RORRP019",171,0)
 . ;--- Check if there is at least one record with provided date
"RTN","RORRP019",172,0)
 . K:$O(^RORDATA(798,"ARD",(+RORREG)_"#",""),-1)<RORDT SCR
"RTN","RORRP019",173,0)
 ;
"RTN","RORRP019",174,0)
 ;--- Get the list of patients
"RTN","RORRP019",175,0)
 S TMP="P"_$S(FLAGS["B":"B",1:"")_$S(XREF="B":"M",1:"")
"RTN","RORRP019",176,0)
 D LIST^DIC(798.4,,"@",TMP,NUMBER,.FROM,PART,XREF,SCR,,,"RORMSG")
"RTN","RORRP019",177,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798.4)
"RTN","RORRP019",178,0)
 ;---
"RTN","RORRP019",179,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","RORRP019",180,0)
 ;
"RTN","RORRP019",181,0)
 ;***** QUERIES THE 'ROR LOCAL REGISTRY' FILE (#798)
"RTN","RORRP019",182,0)
 ;
"RTN","RORRP019",183,0)
 ; RORREG        Registry IEN
"RTN","RORRP019",184,0)
 ;
"RTN","RORRP019",185,0)
 ; SRCPART       The partial match restriction
"RTN","RORRP019",186,0)
 ;
"RTN","RORRP019",187,0)
 ; FLAGS         Flags that control the execution
"RTN","RORRP019",188,0)
 ;
"RTN","RORRP019",189,0)
 ; NUMBER        Maximum number of entries to return
"RTN","RORRP019",190,0)
 ;
"RTN","RORRP019",191,0)
 ; .FROM         Reference to a local variable that contains the
"RTN","RORRP019",192,0)
 ;               starting point for the LIST^DIC. The new point is
"RTN","RORRP019",193,0)
 ;               returned in this variable as well.
"RTN","RORRP019",194,0)
 ;
"RTN","RORRP019",195,0)
 ; Return Values:
"RTN","RORRP019",196,0)
 ;       <0  Error code
"RTN","RORRP019",197,0)
 ;        0  Ok
"RTN","RORRP019",198,0)
 ;
"RTN","RORRP019",199,0)
LST798A(RORREG,SRCPART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP019",200,0)
 N PART,RC,RORNPS,SCR,TMP
"RTN","RORRP019",201,0)
 S:FLAGS["N" (RORNPS(1),RORNPS(2))=""
"RTN","RORRP019",202,0)
 S:FLAGS["P" RORNPS(4)=""
"RTN","RORRP019",203,0)
 ;--- Prepare the search pattern
"RTN","RORRP019",204,0)
 S PART(1)=RORREG_"#"
"RTN","RORRP019",205,0)
 S PART(2)=$G(SRCPART)
"RTN","RORRP019",206,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP019",207,0)
 S SCR="S D=$P($G(^(0)),U,5) I D>0,$D(RORNPS(D))"
"RTN","RORRP019",208,0)
 ;--- Get the list of patients
"RTN","RORRP019",209,0)
 S TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP019",210,0)
 D LIST^DIC(798,,"@;.01I",TMP,NUMBER,.FROM,.PART,"ANP",SCR,,,"RORMSG")
"RTN","RORRP019",211,0)
 S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798)
"RTN","RORRP019",212,0)
 ;---
"RTN","RORRP019",213,0)
 Q $S($G(RC)<0:RC,1:0)
"RTN","RORRP030")
0^33^B34969040
"RTN","RORRP030",1,0)
RORRP030 ;HCIOFO/SG - RPC: PATIENT (IN)ACTIVATE/DELETE ; 6/21/04 10:04am
"RTN","RORRP030",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORRP030",3,0)
 ;
"RTN","RORRP030",4,0)
 Q
"RTN","RORRP030",5,0)
 ;
"RTN","RORRP030",6,0)
 ;***** SENDS THE ALERT TO THE CURRENT USER
"RTN","RORRP030",7,0)
 ;
"RTN","RORRP030",8,0)
 ; DFN           Patient IEN
"RTN","RORRP030",9,0)
 ; DLGNUM        Number of the alert template
"RTN","RORRP030",10,0)
 ;
"RTN","RORRP030",11,0)
ALERT(DFN,DLGNUM) ;
"RTN","RORRP030",12,0)
 N VA,VADM,VAHOW,VAROOT,XQA,XQADATA,XQAID,XQAMSG,XQAROU
"RTN","RORRP030",13,0)
 D DEM^VADPT
"RTN","RORRP030",14,0)
 S XQADATA=DLGNUM_U_$P(RORREG,U,2)            ; Dialog & Registry name
"RTN","RORRP030",15,0)
 S $P(XQADATA,U,3)=$G(VADM(1))                ; Patient name
"RTN","RORRP030",16,0)
 S $P(XQADATA,U,4)=$E($P($G(VADM(2)),U),6,9)  ; Last 4 of SSN
"RTN","RORRP030",17,0)
 S XQAMSG="Record of Clinical Case Registries has been (in)activated."
"RTN","RORRP030",18,0)
 S XQAID="ROR,"_(+DFN)_","
"RTN","RORRP030",19,0)
 S XQA(DUZ)="",XQAROU="ALERTRTN^RORRP030"
"RTN","RORRP030",20,0)
 D SETUP^XQALERT
"RTN","RORRP030",21,0)
 Q
"RTN","RORRP030",22,0)
 ;
"RTN","RORRP030",23,0)
 ;***** CALLBACK ENTRY POINT FOR ALERT PROCESSING
"RTN","RORRP030",24,0)
ALERTRTN ;
"RTN","RORRP030",25,0)
 N I,PARAMS,RORBUF
"RTN","RORRP030",26,0)
 ;--- Prepare the parameters
"RTN","RORRP030",27,0)
 S PARAMS("REGISTRY")=$P(XQADATA,U,2)  ; Registry name
"RTN","RORRP030",28,0)
 S PARAMS("NAME")=$P(XQADATA,U,3)      ; Patient name
"RTN","RORRP030",29,0)
 S PARAMS("LAST4")=$P(XQADATA,U,4)     ; Last 4 digits of SSN
"RTN","RORRP030",30,0)
 ;--- Generate the text of alert
"RTN","RORRP030",31,0)
 D BLD^DIALOG(+XQADATA,.PARAMS,,"RORBUF","S")
"RTN","RORRP030",32,0)
 ;--- Display the alert details
"RTN","RORRP030",33,0)
 S I=0  W !
"RTN","RORRP030",34,0)
 F  S I=$O(RORBUF(I))  Q:I'>0  W !,RORBUF(I)
"RTN","RORRP030",35,0)
 Q
"RTN","RORRP030",36,0)
 ;
"RTN","RORRP030",37,0)
 ;***** DELETE THE PATIENT'S RECORD FROM THE REGISTRY
"RTN","RORRP030",38,0)
 ; RPC: [ROR PATIENT DELETE]
"RTN","RORRP030",39,0)
 ;
"RTN","RORRP030",40,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP030",41,0)
 ;               are returned to.
"RTN","RORRP030",42,0)
 ;
"RTN","RORRP030",43,0)
 ; REGIEN        Registry IEN
"RTN","RORRP030",44,0)
 ;
"RTN","RORRP030",45,0)
 ; RORDFN        IEN of the patient
"RTN","RORRP030",46,0)
 ;
"RTN","RORRP030",47,0)
 ; [FORCE]       Force the deletion (even if the data has been
"RTN","RORRP030",48,0)
 ;               sent to the AAC already)
"RTN","RORRP030",49,0)
 ;
"RTN","RORRP030",50,0)
 ; Return Values:
"RTN","RORRP030",51,0)
 ;
"RTN","RORRP030",52,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP030",53,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP030",54,0)
 ; details).
"RTN","RORRP030",55,0)
 ;
"RTN","RORRP030",56,0)
 ; Otherwise, the following codes can be returned in the RESULTS(0):
"RTN","RORRP030",57,0)
 ;
"RTN","RORRP030",58,0)
 ;         0  The record cannot be deleted
"RTN","RORRP030",59,0)
 ;         9  The record has been deleted
"RTN","RORRP030",60,0)
 ;
"RTN","RORRP030",61,0)
DELETE(RESULTS,REGIEN,RORDFN,FORCE) ;
"RTN","RORRP030",62,0)
 N IENS,RC,REGNAME,RORFDA,RORMSG,TMP
"RTN","RORRP030",63,0)
 D CLEAR^RORERR("DELETE^RORRP030",1)
"RTN","RORRP030",64,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP030",65,0)
 ;
"RTN","RORRP030",66,0)
 ;--- Get the registry description/name
"RTN","RORRP030",67,0)
 S TMP=$$REGNAME^RORUTL01(REGIEN)
"RTN","RORRP030",68,0)
 I TMP=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",69,0)
 . S RC=$$ERROR^RORERR(-1,,,RORDFN)
"RTN","RORRP030",70,0)
 S REGNAME=$S($P(TMP,U,2)'="":$P(TMP,U,2),1:$P(TMP,U))
"RTN","RORRP030",71,0)
 ;
"RTN","RORRP030",72,0)
 ;--- Get IENS of the registry record
"RTN","RORRP030",73,0)
 S IENS=$$PRRIEN^RORUTL01(RORDFN,REGIEN)_","
"RTN","RORRP030",74,0)
 I IENS'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",75,0)
 . S RC=$$ERROR^RORERR(-97,,,RORDFN,REGNAME)
"RTN","RORRP030",76,0)
 ;
"RTN","RORRP030",77,0)
 ;--- Check if the data has been sent to the AAC already
"RTN","RORRP030",78,0)
 S TMP=$$GET1^DIQ(798,IENS,12,"I",,"RORMSG")
"RTN","RORRP030",79,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",80,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",81,0)
 I '$G(FORCE)  Q:'TMP
"RTN","RORRP030",82,0)
 ;
"RTN","RORRP030",83,0)
 ;--- Delete the record
"RTN","RORRP030",84,0)
 S RORFDA(798,IENS,.01)="@"
"RTN","RORRP030",85,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP030",86,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",87,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",88,0)
 ;---
"RTN","RORRP030",89,0)
 S RESULTS(0)=9
"RTN","RORRP030",90,0)
 Q
"RTN","RORRP030",91,0)
 ;
"RTN","RORRP030",92,0)
 ;***** INACTIVATES THE PATIENT
"RTN","RORRP030",93,0)
 ;
"RTN","RORRP030",94,0)
 ; IENS          IENS of the registry record
"RTN","RORRP030",95,0)
 ; REASON        IEN of the reason for inactivation
"RTN","RORRP030",96,0)
 ; DATE          Inactivation date
"RTN","RORRP030",97,0)
 ;
"RTN","RORRP030",98,0)
 ; Return Values:
"RTN","RORRP030",99,0)
 ;        <0  Error code
"RTN","RORRP030",100,0)
 ;         1  The record has been inactivated
"RTN","RORRP030",101,0)
 ;         9  The record has been deleted
"RTN","RORRP030",102,0)
 ;
"RTN","RORRP030",103,0)
INACTIV(IENS,REASON,DATE) ;
"RTN","RORRP030",104,0)
 N NODE,RC,RORFDA,RORMSG,DSENT
"RTN","RORRP030",105,0)
 ;--- Check if the data has been sent to the AAC already
"RTN","RORRP030",106,0)
 S DSENT='$$GET1^DIQ(798,IENS,12,"I",,"RORMSG")
"RTN","RORRP030",107,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP030",108,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",109,0)
 ;--- Prepare the fields
"RTN","RORRP030",110,0)
 I DSENT  D  S RC=1                  ;--- Update the record
"RTN","RORRP030",111,0)
 . S RORFDA(798,IENS,2)=DATE              ; INACTIVATION DATE
"RTN","RORRP030",112,0)
 . S RORFDA(798,IENS,2.1)=DUZ             ; INACTIVATED BY
"RTN","RORRP030",113,0)
 . S RORFDA(798,IENS,2.2)=REASON          ; REASON FOR INACTIVATION
"RTN","RORRP030",114,0)
 . S RORFDA(798,IENS,5)=1                 ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP030",115,0)
 E  S RORFDA(798,IENS,.01)="@",RC=9  ;--- Delete the record
"RTN","RORRP030",116,0)
 ;--- Update/Delete the registry record
"RTN","RORRP030",117,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP030",118,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP030",119,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",120,0)
 ;--- Send an alert to the user if inactivated patient has been
"RTN","RORRP030",121,0)
 ;--- added to the registry due to triggered selections rules
"RTN","RORRP030",122,0)
 S NODE=$$ROOT^DILFD(798.01,","_IENS,1)
"RTN","RORRP030",123,0)
 D:$O(@NODE@(0))>0 ALERT(RORDFN,7980000.013)
"RTN","RORRP030",124,0)
 Q RC
"RTN","RORRP030",125,0)
 ;
"RTN","RORRP030",126,0)
 ;***** REACTIVATES THE PATIENT
"RTN","RORRP030",127,0)
 ;
"RTN","RORRP030",128,0)
 ; IENS          IENS of the registry record
"RTN","RORRP030",129,0)
 ; REASON        IEN of the supporting evidence
"RTN","RORRP030",130,0)
 ; DATE          Reactivation date
"RTN","RORRP030",131,0)
 ;
"RTN","RORRP030",132,0)
 ; Return Values:
"RTN","RORRP030",133,0)
 ;        <0  Error code
"RTN","RORRP030",134,0)
 ;         2  The record has been reactivated
"RTN","RORRP030",135,0)
 ;
"RTN","RORRP030",136,0)
REACTIV(IENS,REASON,DATE) ;
"RTN","RORRP030",137,0)
 N NODE,RC,RORFDA,RORMSG
"RTN","RORRP030",138,0)
 S RORFDA(798,IENS,3)=3                   ; NEW PATIENT (REACTIVATED)
"RTN","RORRP030",139,0)
 S RORFDA(798,IENS,3.2)=REASON            ; SUPPORTING EVIDENCE
"RTN","RORRP030",140,0)
 S RORFDA(798,IENS,5)=1                   ; UPDATE LOCAL REGISTRY DATA
"RTN","RORRP030",141,0)
 S RORFDA(798,IENS,7)=DATE                ; REACTIVATION DATE
"RTN","RORRP030",142,0)
 S RORFDA(798,IENS,7.1)=DUZ               ; REACTIVATED BY
"RTN","RORRP030",143,0)
 ;--- Update the registry record
"RTN","RORRP030",144,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORRP030",145,0)
 I $G(DIERR)  D  Q RC
"RTN","RORRP030",146,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",147,0)
 ;--- Send an alert to the user if the reactivated patient has no
"RTN","RORRP030",148,0)
 ;--- selection rules that caused his/her addition to the registry
"RTN","RORRP030",149,0)
 S NODE=$$ROOT^DILFD(798.01,","_IENS,1)
"RTN","RORRP030",150,0)
 D:$O(@NODE@(0))'>0 ALERT(RORDFN,7980000.014)
"RTN","RORRP030",151,0)
 Q 2
"RTN","RORRP030",152,0)
 ;
"RTN","RORRP030",153,0)
 ;***** INACTIVATES/REACTIVATES THE PATIENT
"RTN","RORRP030",154,0)
 ; RPC: [ROR PATIENT (IN)ACTIVATE]
"RTN","RORRP030",155,0)
 ;
"RTN","RORRP030",156,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP030",157,0)
 ;               are returned to.
"RTN","RORRP030",158,0)
 ;
"RTN","RORRP030",159,0)
 ; REGIEN        Registry IEN
"RTN","RORRP030",160,0)
 ;
"RTN","RORRP030",161,0)
 ; RORDFN        IEN of the patient
"RTN","RORRP030",162,0)
 ;
"RTN","RORRP030",163,0)
 ; ACTION        Action to be performed
"RTN","RORRP030",164,0)
 ;                 I  Inactivate
"RTN","RORRP030",165,0)
 ;                 R  Reactivate
"RTN","RORRP030",166,0)
 ;
"RTN","RORRP030",167,0)
 ; REASON        Code of the reason for inactivation/reactivation
"RTN","RORRP030",168,0)
 ;
"RTN","RORRP030",169,0)
 ; Return Values:
"RTN","RORRP030",170,0)
 ;
"RTN","RORRP030",171,0)
 ; A negative value of the first "^"-piece of the RESULTS(0)
"RTN","RORRP030",172,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP030",173,0)
 ; details).
"RTN","RORRP030",174,0)
 ;
"RTN","RORRP030",175,0)
 ; Otherwise, the following codes can be returned in the RESULTS(0):
"RTN","RORRP030",176,0)
 ;
"RTN","RORRP030",177,0)
 ;         0  Requested action is redundant
"RTN","RORRP030",178,0)
 ;         1  The record has been inactivated
"RTN","RORRP030",179,0)
 ;         2  The record has been reactivated
"RTN","RORRP030",180,0)
 ;         9  The record has been deleted
"RTN","RORRP030",181,0)
 ;
"RTN","RORRP030",182,0)
UPDATE(RESULTS,REGIEN,RORDFN,ACTION,REASON) ;
"RTN","RORRP030",183,0)
 N DATE,IENS,RC,RORMSG,RORREG,RSNIEN,TMP
"RTN","RORRP030",184,0)
 D CLEAR^RORERR("UPDATE^RORRP030",1)
"RTN","RORRP030",185,0)
 K RESULTS  S RESULTS(0)=0
"RTN","RORRP030",186,0)
 ;
"RTN","RORRP030",187,0)
 ;--- Get the registry description/name
"RTN","RORRP030",188,0)
 S TMP=$$REGNAME^RORUTL01(REGIEN)
"RTN","RORRP030",189,0)
 I TMP=""  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",190,0)
 . S RC=$$ERROR^RORERR(-1,,,RORDFN)
"RTN","RORRP030",191,0)
 S RORREG=REGIEN_U_$S($P(TMP,U,2)'="":$P(TMP,U,2),1:$P(TMP,U))
"RTN","RORRP030",192,0)
 ;
"RTN","RORRP030",193,0)
 ;--- Get IENS of the registry record
"RTN","RORRP030",194,0)
 S IENS=$$PRRIEN^RORUTL01(RORDFN,REGIEN)_","
"RTN","RORRP030",195,0)
 I IENS'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",196,0)
 . S RC=$$ERROR^RORERR(-97,,,RORDFN,$P(RORREG,U,2))
"RTN","RORRP030",197,0)
 ;
"RTN","RORRP030",198,0)
 ;--- Get patient's status and check if the action is redundant
"RTN","RORRP030",199,0)
 S TMP=$$GET1^DIQ(798,IENS,8,,,"RORMSG")
"RTN","RORRP030",200,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",201,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,RORDFN,798,IENS)
"RTN","RORRP030",202,0)
 Q:$S(TMP:ACTION="R",1:ACTION="I")
"RTN","RORRP030",203,0)
 ;
"RTN","RORRP030",204,0)
 ;--- Get the IEN of inactivation reason/supporting evidence
"RTN","RORRP030",205,0)
 S TMP=$S(ACTION="I":1,ACTION="R":2,1:0)
"RTN","RORRP030",206,0)
 I TMP'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",207,0)
 . S RC=$$ERROR^RORERR(-88,,,RORDFN,"ACTION",ACTION)
"RTN","RORRP030",208,0)
 S RSNIEN=$$ITEMIEN^RORUTL09(TMP,REGIEN,REASON)
"RTN","RORRP030",209,0)
 I RSNIEN'>0  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP030",210,0)
 . S RC=$$ERROR^RORERR(-88,,,RORDFN,"REASON",REASON)
"RTN","RORRP030",211,0)
 ;
"RTN","RORRP030",212,0)
 ;--- Inactivate/Reactivate the record
"RTN","RORRP030",213,0)
 S DATE=$$NOW^XLFDT,RESULTS(0)=0
"RTN","RORRP030",214,0)
 S:ACTION="I" RESULTS(0)=$$INACTIV(IENS,RSNIEN,DATE)
"RTN","RORRP030",215,0)
 S:ACTION="R" RESULTS(0)=$$REACTIV(IENS,RSNIEN,DATE)
"RTN","RORRP030",216,0)
 D:RESULTS(0)<0 RPCSTK^RORERR(.RESULTS,RESULTS)
"RTN","RORRP030",217,0)
 Q
"RTN","RORUPD04")
0^21^B32341730
"RTN","RORUPD04",1,0)
RORUPD04 ;HCIOFO/SG - PROCESSING OF THE LAB DATA  ; 6/8/04 8:23am
"RTN","RORUPD04",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORUPD04",3,0)
 ;
"RTN","RORUPD04",4,0)
 ; This routine uses the following IA's:
"RTN","RORUPD04",5,0)
 ;
"RTN","RORUPD04",6,0)
 ; #10035        Access to the field #63 of the file #2
"RTN","RORUPD04",7,0)
 ;
"RTN","RORUPD04",8,0)
 Q
"RTN","RORUPD04",9,0)
 ;
"RTN","RORUPD04",10,0)
 ;***** CHECKS AN INDICATOR CONDITION
"RTN","RORUPD04",11,0)
 ;
"RTN","RORUPD04",12,0)
 ; LSI           Indicator (internal value)
"RTN","RORUPD04",13,0)
 ; VAL           Indicated value
"RTN","RORUPD04",14,0)
 ; .RESULT(      Result value
"RTN","RORUPD04",15,0)
 ;   "RH")       Reference high
"RTN","RORUPD04",16,0)
 ;   "RL")       Reference low
"RTN","RORUPD04",17,0)
 ;
"RTN","RORUPD04",18,0)
 ; Return Values:
"RTN","RORUPD04",19,0)
 ;        0  False
"RTN","RORUPD04",20,0)
 ;       >0  True
"RTN","RORUPD04",21,0)
 ;
"RTN","RORUPD04",22,0)
CHKIND(LSI,VAL,RESULT) ;
"RTN","RORUPD04",23,0)
 S RESULT=$$UP^XLFSTR(RESULT)
"RTN","RORUPD04",24,0)
 ;--- Reference Range
"RTN","RORUPD04",25,0)
 I LSI=1  D  Q LSI
"RTN","RORUPD04",26,0)
 . I $G(RESULT("RL"))'=""  Q:RESULT<RESULT("RL")
"RTN","RORUPD04",27,0)
 . I $G(RESULT("RH"))'=""  Q:RESULT>RESULT("RH")
"RTN","RORUPD04",28,0)
 . S LSI=0
"RTN","RORUPD04",29,0)
 ;--- Positive Result
"RTN","RORUPD04",30,0)
 I LSI=6  Q:RESULT="P" 1  S VAL=0  D  Q VAL
"RTN","RORUPD04",31,0)
 . I RESULT'["POS",RESULT'["REA",RESULT'["DETEC"  Q
"RTN","RORUPD04",32,0)
 . I RESULT'["NEG",RESULT'["NO",RESULT'["IND"  S VAL=1
"RTN","RORUPD04",33,0)
 ;--- Compare to the value
"RTN","RORUPD04",34,0)
 Q:VAL="" 0
"RTN","RORUPD04",35,0)
 I LSI=3  Q (RESULT>VAL)
"RTN","RORUPD04",36,0)
 I LSI=4  Q (RESULT<VAL)
"RTN","RORUPD04",37,0)
 S VAL=$$UP^XLFSTR(VAL)
"RTN","RORUPD04",38,0)
 I LSI=2  Q (RESULT[VAL)
"RTN","RORUPD04",39,0)
 I LSI=5  Q (RESULT=VAL)
"RTN","RORUPD04",40,0)
 Q 0
"RTN","RORUPD04",41,0)
 ;
"RTN","RORUPD04",42,0)
 ;***** PROCESSING OF THE 'LAB DATA' FILE
"RTN","RORUPD04",43,0)
 ;
"RTN","RORUPD04",44,0)
 ; UPDSTART      Date of the earliest update (DO NOT pass by
"RTN","RORUPD04",45,0)
 ;               reference)
"RTN","RORUPD04",46,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD04",47,0)
 ;
"RTN","RORUPD04",48,0)
 ; The function uses ^TMP("RORTMP",$J) node as a temporary storage.
"RTN","RORUPD04",49,0)
 ;
"RTN","RORUPD04",50,0)
 ; Return values:
"RTN","RORUPD04",51,0)
 ;       <0  Error code
"RTN","RORUPD04",52,0)
 ;        0  Continue processing of the current patient
"RTN","RORUPD04",53,0)
 ;        1  Stop processing
"RTN","RORUPD04",54,0)
 ;
"RTN","RORUPD04",55,0)
LAB(UPDSTART,PATIEN) ;
"RTN","RORUPD04",56,0)
 N RORFILE       ; File number
"RTN","RORUPD04",57,0)
 ;
"RTN","RORUPD04",58,0)
 N DM,DSEND,LABIENS,RC,TMP
"RTN","RORUPD04",59,0)
 S RORFILE=63,DSEND=RORUPD("DSEND")
"RTN","RORUPD04",60,0)
 K RORVALS("LS")
"RTN","RORUPD04",61,0)
 ;--- If the start date is more than 60 days in the past, results
"RTN","RORUPD04",62,0)
 ;    should be loaded using collection dates. Otherwise, dates of
"RTN","RORUPD04",63,0)
 ;--- the results are used).
"RTN","RORUPD04",64,0)
 S DM=$S($$FMDIFF^XLFDT(DT,UPDSTART)>60:"^CD",1:"^RAD")
"RTN","RORUPD04",65,0)
 ;--- Check the event references if the events are enabled
"RTN","RORUPD04",66,0)
 I $G(RORUPD("FLAGS"))["E"  D  Q:RC'>0 RC
"RTN","RORUPD04",67,0)
 . S RC=$$GET^RORUPP02(PATIEN,1,.UPDSTART,.DSEND)
"RTN","RORUPD04",68,0)
 . ;--- If dates have been modified according to the event references,
"RTN","RORUPD04",69,0)
 . ;--- they are the collection dates/times.
"RTN","RORUPD04",70,0)
 . S:RC>1 UPDSTART=UPDSTART\1,DSEND=$$FMADD^XLFDT(DSEND\1,1),DM="^CD"
"RTN","RORUPD04",71,0)
 ;---
"RTN","RORUPD04",72,0)
 S RC=0,LABIENS=$$LABREF(PATIEN)_","  Q:LABIENS'>0 0
"RTN","RORUPD04",73,0)
 D
"RTN","RORUPD04",74,0)
 . ;--- Load the Lab results
"RTN","RORUPD04",75,0)
 . S RC=$$LABRSLTS^RORUTL02(PATIEN,UPDSTART_DM,DSEND_DM)
"RTN","RORUPD04",76,0)
 . I RC<0  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",77,0)
 . ;--- Process the results
"RTN","RORUPD04",78,0)
 . Q:$$RESULTS(PATIEN)<0
"RTN","RORUPD04",79,0)
 . ;--- Load necessary data elements
"RTN","RORUPD04",80,0)
 . I $D(RORUPD("SR",RORFILE,"F"))>1  D  I TMP<0  D INCEC^RORUPDUT()  Q
"RTN","RORUPD04",81,0)
 . . S TMP=$$LOAD(LABIENS)
"RTN","RORUPD04",82,0)
 . ;--- Apply "before" rules
"RTN","RORUPD04",83,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,LABIENS,"B")
"RTN","RORUPD04",84,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",85,0)
 . ;--- Apply "after" rules
"RTN","RORUPD04",86,0)
 . S RC=$$APLRULES^RORUPDUT(RORFILE,LABIENS,"A")
"RTN","RORUPD04",87,0)
 . I RC  D INCEC^RORUPDUT(.RC)  Q
"RTN","RORUPD04",88,0)
 ;
"RTN","RORUPD04",89,0)
 D CLRDES^RORUPDUT(RORFILE)
"RTN","RORUPD04",90,0)
 Q RC
"RTN","RORUPD04",91,0)
 ;
"RTN","RORUPD04",92,0)
 ;***** RETURNS A LAB REFERENCE (IEN IN 'LAB DATA') OF THE PATIENT
"RTN","RORUPD04",93,0)
 ;
"RTN","RORUPD04",94,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD04",95,0)
 ;
"RTN","RORUPD04",96,0)
 ; Return values:
"RTN","RORUPD04",97,0)
 ;       <0  Error code
"RTN","RORUPD04",98,0)
 ;        0  Patient has no laboratory data
"RTN","RORUPD04",99,0)
 ;       >0  IEN of the record in LAB DATA file
"RTN","RORUPD04",100,0)
 ;
"RTN","RORUPD04",101,0)
LABREF(PATIEN) ;
"RTN","RORUPD04",102,0)
 N LABREF,RC,RORMSG
"RTN","RORUPD04",103,0)
 S LABREF=+$$GET1^DIQ(2,PATIEN_",",63,"I",,"RORMSG")
"RTN","RORUPD04",104,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,PATIEN,2)
"RTN","RORUPD04",105,0)
 Q LABREF
"RTN","RORUPD04",106,0)
 ;
"RTN","RORUPD04",107,0)
 ;***** LOAD DATA ELEMENTS
"RTN","RORUPD04",108,0)
 ;
"RTN","RORUPD04",109,0)
 ; IENS          IENS of the current record
"RTN","RORUPD04",110,0)
 ;
"RTN","RORUPD04",111,0)
 ; Return values:
"RTN","RORUPD04",112,0)
 ;       <0  Error code
"RTN","RORUPD04",113,0)
 ;        0  Ok
"RTN","RORUPD04",114,0)
 ;
"RTN","RORUPD04",115,0)
LOAD(IENS) ;
"RTN","RORUPD04",116,0)
 N RC  S RC=0
"RTN","RORUPD04",117,0)
 ;--- API #1
"RTN","RORUPD04",118,0)
 I $D(RORUPD("SR",RORFILE,"F",1))  D  Q:RC<0 RC
"RTN","RORUPD04",119,0)
 . S RC=$$LOADFLDS^RORUPDUT(RORFILE,IENS)
"RTN","RORUPD04",120,0)
 ;--- API #2
"RTN","RORUPD04",121,0)
 Q 0
"RTN","RORUPD04",122,0)
 ;
"RTN","RORUPD04",123,0)
 ;***** EXTRACTS PROPER RESULT CODE FROM THE OBSERVATION ID
"RTN","RORUPD04",124,0)
 ;
"RTN","RORUPD04",125,0)
 ; OID           Observation ID in HL7 format
"RTN","RORUPD04",126,0)
 ; CS            HL7 component separator
"RTN","RORUPD04",127,0)
 ;
"RTN","RORUPD04",128,0)
 ; Return values:
"RTN","RORUPD04",129,0)
 ;           Lab result code (see the LA7SC parameter of
"RTN","RORUPD04",130,0)
 ;           the GCPR^LA7QRY entry point)
"RTN","RORUPD04",131,0)
 ;             ^1: Result code
"RTN","RORUPD04",132,0)
 ;             ^2: Coding system ("LN" or "NLT")
"RTN","RORUPD04",133,0)
 ;           Or an empty string if coding system is unknown or there
"RTN","RORUPD04",134,0)
 ;           are no active search indicators exist for this code.
"RTN","RORUPD04",135,0)
 ;
"RTN","RORUPD04",136,0)
RESCODE(OID,CS) ;
"RTN","RORUPD04",137,0)
 N CODE,I,RESCODE,TYPE
"RTN","RORUPD04",138,0)
 S RESCODE=""
"RTN","RORUPD04",139,0)
 F I=1,4  D  Q:RESCODE'=""
"RTN","RORUPD04",140,0)
 . S CODE=$P(OID,CS,I),TYPE=$P(OID,CS,I+2)             Q:CODE=""
"RTN","RORUPD04",141,0)
 . S TYPE=$S(TYPE="LN":"LN",TYPE="99VA64":"NLT",1:"")  Q:TYPE=""
"RTN","RORUPD04",142,0)
 . ;--- Check if the search indicators exist for this code
"RTN","RORUPD04",143,0)
 . S RESCODE=CODE_U_TYPE
"RTN","RORUPD04",144,0)
 . S:$D(@RORUPDPI@("LS",RESCODE))<10 RESCODE=""
"RTN","RORUPD04",145,0)
 Q RESCODE
"RTN","RORUPD04",146,0)
 ;
"RTN","RORUPD04",147,0)
 ;***** LOADS AND PROCESSES RESULTS OF THE TESTS
"RTN","RORUPD04",148,0)
 ;
"RTN","RORUPD04",149,0)
 ; PATIEN        Patient IEN
"RTN","RORUPD04",150,0)
 ; ^TMP("RORTMP",
"RTN","RORUPD04",151,0)
 ;   $J,...)     HL7 message created by GCPR^LA7QRY
"RTN","RORUPD04",152,0)
 ;
"RTN","RORUPD04",153,0)
 ; Return values:
"RTN","RORUPD04",154,0)
 ;       <0  Error code
"RTN","RORUPD04",155,0)
 ;        0  Ok
"RTN","RORUPD04",156,0)
 ;
"RTN","RORUPD04",157,0)
RESULTS(PATIEN) ;
"RTN","RORUPD04",158,0)
 N DATE,I,ISEG,LSIEN,LSNODE,RC,RESCODE,RESVAL,SEG,SEGTYPE,TMP
"RTN","RORUPD04",159,0)
 N CS,FS,SCS ; HL7 Separators
"RTN","RORUPD04",160,0)
 S ISEG="",RC=0
"RTN","RORUPD04",161,0)
 F  S ISEG=$O(^TMP("RORTMP",$J,ISEG))  Q:ISEG=""  D  Q:RC<0
"RTN","RORUPD04",162,0)
 . S SEG=^TMP("RORTMP",$J,ISEG)
"RTN","RORUPD04",163,0)
 . ;--- Extract separators from the MSH segment
"RTN","RORUPD04",164,0)
 . I $E(SEG,1,3)="MSH"  D  Q
"RTN","RORUPD04",165,0)
 . . S FS=$E(SEG,4),TMP=$P(SEG,FS,2)
"RTN","RORUPD04",166,0)
 . . S CS=$E(TMP,1),SCS=$E(TMP,4)
"RTN","RORUPD04",167,0)
 . ;--- Skip all segments except OBX
"RTN","RORUPD04",168,0)
 . S SEGTYPE=$P(SEG,FS)
"RTN","RORUPD04",169,0)
 . Q:SEGTYPE'="OBX"
"RTN","RORUPD04",170,0)
 . S SEG=$P(SEG,FS,2,999)
"RTN","RORUPD04",171,0)
 . ;--- Get lab result code
"RTN","RORUPD04",172,0)
 . S RESCODE=$$RESCODE($P(SEG,FS,3),CS)  Q:RESCODE=""
"RTN","RORUPD04",173,0)
 . ;--- Load the full segment
"RTN","RORUPD04",174,0)
 . S I=""
"RTN","RORUPD04",175,0)
 . F  S I=$O(^TMP("RORTMP",$J,ISEG,I))  Q:I=""  S SEG=SEG_^(I)
"RTN","RORUPD04",176,0)
 . ;--- Get the result data
"RTN","RORUPD04",177,0)
 . S RESVAL=$P(SEG,FS,5),TMP=$P(SEG,FS,7)
"RTN","RORUPD04",178,0)
 . S RESVAL("RL")=$P(TMP,"-",1) ; Reference Low
"RTN","RORUPD04",179,0)
 . S RESVAL("RH")=$P(TMP,"-",2) ; Reference High
"RTN","RORUPD04",180,0)
 . S DATE=$$HL7TFM^XLFDT($P(SEG,FS,14),"L")\1
"RTN","RORUPD04",181,0)
 . ;--- Analyze the result
"RTN","RORUPD04",182,0)
 . S LSNODE=$NA(@RORUPDPI@("LS",RESCODE))
"RTN","RORUPD04",183,0)
 . S LSIEN=""
"RTN","RORUPD04",184,0)
 . F  S LSIEN=$O(@LSNODE@(LSIEN))  Q:LSIEN=""  D  Q:RC<0
"RTN","RORUPD04",185,0)
 . . S I="",RC=0
"RTN","RORUPD04",186,0)
 . . F  S I=$O(@LSNODE@(LSIEN,I))  Q:I=""  D  Q:RC
"RTN","RORUPD04",187,0)
 . . . S TMP=$G(@LSNODE@(LSIEN,I))
"RTN","RORUPD04",188,0)
 . . . S RC=$$CHKIND(+TMP,$P(TMP,U,2),.RESVAL)
"RTN","RORUPD04",189,0)
 . . Q:RC'>0
"RTN","RORUPD04",190,0)
 . . S TMP=+$G(RORVALS("LS",LSIEN))
"RTN","RORUPD04",191,0)
 . . S:'TMP!(DATE&(DATE<TMP)) RORVALS("LS",LSIEN)=DATE
"RTN","RORUPD04",192,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUPD04",193,0)
 ;
"RTN","RORUPD04",194,0)
 ;***** IMPLEMENTATION OF THE SELECTION RULE
"RTN","RORUPD04",195,0)
 ;
"RTN","RORUPD04",196,0)
 ; LSIEN         Lab Search IEN
"RTN","RORUPD04",197,0)
 ;
"RTN","RORUPD04",198,0)
 ; Return values:
"RTN","RORUPD04",199,0)
 ;        0  Skip the patient
"RTN","RORUPD04",200,0)
 ;        1  Add the patient
"RTN","RORUPD04",201,0)
 ;
"RTN","RORUPD04",202,0)
RULE(LSIEN) ;
"RTN","RORUPD04",203,0)
 I $D(RORVALS("LS",LSIEN))  D  Q 1
"RTN","RORUPD04",204,0)
 . N DATE  S DATE=$G(RORVALS("LS",LSIEN))  Q:DATE'>0
"RTN","RORUPD04",205,0)
 . S:DATE<RORVALS("SV","ROR SRDT") RORVALS("SV","ROR SRDT")=DATE
"RTN","RORUPD04",206,0)
 Q 0
"RTN","RORUPD05")
0^4^B44824205
"RTN","RORUPD05",1,0)
RORUPD05 ;HCIOFO/SG - REGISTRY UPDATE (MULTITASK) ; 3/11/04 3:47pm
"RTN","RORUPD05",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**2,5,6**;May 14, 2002
"RTN","RORUPD05",3,0)
 ;
"RTN","RORUPD05",4,0)
 Q
"RTN","RORUPD05",5,0)
 ;
"RTN","RORUPD05",6,0)
 ;***** MONITORS THE SUBTASKS
"RTN","RORUPD05",7,0)
 ;
"RTN","RORUPD05",8,0)
 ; Return Values:
"RTN","RORUPD05",9,0)
 ;       <0  Error code
"RTN","RORUPD05",10,0)
 ;      >=0  Combined statistics returned by the $$PROCESS^RORUPD01
"RTN","RORUPD05",11,0)
 ;           function of each subtask
"RTN","RORUPD05",12,0)
 ;
"RTN","RORUPD05",13,0)
MONITOR() ;
"RTN","RORUPD05",14,0)
 N CNT,ECNT,EXIT,RC,TASK,TIMEOUT,TSKCNT
"RTN","RORUPD05",15,0)
 S (CNT,ECNT,EXIT)=0,TIMEOUT=600 ; 10hrs = 600*60
"RTN","RORUPD05",16,0)
 F  H 60  D  Q:EXIT
"RTN","RORUPD05",17,0)
 . ;--- Exit if all subtasks finished
"RTN","RORUPD05",18,0)
 . I $D(@RORUPDPI@("T"))<10  S EXIT=1  Q
"RTN","RORUPD05",19,0)
 . ;--- Abort if some of the subtasks have not started during
"RTN","RORUPD05",20,0)
 . ;--- the predefined time frame.
"RTN","RORUPD05",21,0)
 . I TIMEOUT'>0  S EXIT=$$ERROR^RORERR(-78)  Q
"RTN","RORUPD05",22,0)
 . ;--- Check for a request to stop
"RTN","RORUPD05",23,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD  S EXIT=$$ERROR^RORERR(-42)  Q
"RTN","RORUPD05",24,0)
 . ;--- Browse through the list of subtasks
"RTN","RORUPD05",25,0)
 . S (TASK,TSKCNT)=0
"RTN","RORUPD05",26,0)
 . F  S TASK=$O(@RORUPDPI@("T",TASK))  Q:TASK=""  D
"RTN","RORUPD05",27,0)
 . . S RC=@RORUPDPI@("T",TASK),TSKCNT=TSKCNT+1
"RTN","RORUPD05",28,0)
 . . ;--- Skip a subtask that was scheduled but has not started yet
"RTN","RORUPD05",29,0)
 . . I RC="S"  S TSKCNT=TSKCNT-1  Q
"RTN","RORUPD05",30,0)
 . . ;--- Skip a running subtask
"RTN","RORUPD05",31,0)
 . . L +@RORUPDPI@("T",TASK):0  E  Q
"RTN","RORUPD05",32,0)
 . . L -@RORUPDPI@("T",TASK)
"RTN","RORUPD05",33,0)
 . . ;--- The subtask has crashed
"RTN","RORUPD05",34,0)
 . . I RC=-60  S EXIT=$$ERROR^RORERR(-60,,,,TASK)  Q
"RTN","RORUPD05",35,0)
 . . ;--- Fatal error in the subtask
"RTN","RORUPD05",36,0)
 . . I RC<0  S EXIT=+RC  D  Q
"RTN","RORUPD05",37,0)
 . . . S RC=$$ERROR^RORERR(-56,,,,+RC,"subtask #"_TASK)
"RTN","RORUPD05",38,0)
 . . ;--- The subtask is completed (accumulate the statistics)
"RTN","RORUPD05",39,0)
 . . S CNT=CNT+$P(RC,U),ECNT=ECNT+$P(RC,U,2)
"RTN","RORUPD05",40,0)
 . . K @RORUPDPI@("T",TASK)
"RTN","RORUPD05",41,0)
 . ;--- Timeout timer is ticking only if no subtasks are running
"RTN","RORUPD05",42,0)
 . S:TSKCNT'>0 TIMEOUT=TIMEOUT-1
"RTN","RORUPD05",43,0)
 Q $S(EXIT<0:EXIT,1:CNT_U_ECNT)
"RTN","RORUPD05",44,0)
 ;
"RTN","RORUPD05",45,0)
 ;***** PROCESSES THE DATA (SINGLE TASK OR MULTITASK MODE)
"RTN","RORUPD05",46,0)
 ;
"RTN","RORUPD05",47,0)
 ; [MAXNTSK]     Maximum number of data processing subtasks.
"RTN","RORUPD05",48,0)
 ;               If this parameter is less than 2, all patients
"RTN","RORUPD05",49,0)
 ;               will be processed by the single main task.
"RTN","RORUPD05",50,0)
 ;               Otherwise, all patients can be distributed among
"RTN","RORUPD05",51,0)
 ;               several subtasks.
"RTN","RORUPD05",52,0)
 ;
"RTN","RORUPD05",53,0)
 ;               If "N^M^AUTO" is passed as a value of this parameter
"RTN","RORUPD05",54,0)
 ;               and difference between the end and start dates is
"RTN","RORUPD05",55,0)
 ;               more than M days then N subtasks will be created.
"RTN","RORUPD05",56,0)
 ;
"RTN","RORUPD05",57,0)
 ; Return Values:
"RTN","RORUPD05",58,0)
 ;       <0  Error code
"RTN","RORUPD05",59,0)
 ;      >=0  Statistics returned by the $$MONITOR function
"RTN","RORUPD05",60,0)
 ;
"RTN","RORUPD05",61,0)
 ; The main task will wait for completion of the subtasks. If one
"RTN","RORUPD05",62,0)
 ; of them fails, all other (including the main one) will fail too.
"RTN","RORUPD05",63,0)
 ;
"RTN","RORUPD05",64,0)
PROCESS(MAXNTSK) ;
"RTN","RORUPD05",65,0)
 N COUNTERS,NTSK,OLDPI,RC,SUBSCR,TASKTBL,TMP
"RTN","RORUPD05",66,0)
 ;--- Calculate number of tasks and create the task table
"RTN","RORUPD05",67,0)
 D:$G(MAXNTSK)["AUTO"
"RTN","RORUPD05",68,0)
 . S TMP=$$FMDIFF^XLFDT(RORUPD("DSEND"),RORUPD("DSBEG"),1)
"RTN","RORUPD05",69,0)
 . S MAXNTSK=$S(TMP>$P(MAXNTSK,U,2):+MAXNTSK,1:0)
"RTN","RORUPD05",70,0)
 I $G(MAXNTSK)>1  D  Q:NTSK<0 NTSK
"RTN","RORUPD05",71,0)
 . S NTSK=$$TASKTBL(MAXNTSK,.TASKTBL)
"RTN","RORUPD05",72,0)
 ;--- Process all patients by the main task
"RTN","RORUPD05",73,0)
 Q:$G(NTSK)<2 $$PROCESS^RORUPD01()
"RTN","RORUPD05",74,0)
 ;
"RTN","RORUPD05",75,0)
 S RORUPD("JOB")=$J,OLDPI=RORUPDPI
"RTN","RORUPD05",76,0)
 ;--- Initialize the node in the ^XTMP global
"RTN","RORUPD05",77,0)
 I $G(RORPARM("SETUP"))  D
"RTN","RORUPD05",78,0)
 . S SUBSCR="RORUPDR"_+$O(RORUPD("LM2",""))
"RTN","RORUPD05",79,0)
 . S RORUPDPI=$NA(^XTMP(SUBSCR)),I=0
"RTN","RORUPD05",80,0)
 . F  S I=$O(@RORUPDPI@(I))  Q:I=""  K:I'="U" @RORUPDPI@(I)
"RTN","RORUPD05",81,0)
 E  D
"RTN","RORUPD05",82,0)
 . S SUBSCR="RORUPDJ"_$J
"RTN","RORUPD05",83,0)
 . S RORUPDPI=$NA(^XTMP(SUBSCR))
"RTN","RORUPD05",84,0)
 . K @RORUPDPI
"RTN","RORUPD05",85,0)
 D XTMPHDR^RORUTL01(SUBSCR,30,"PROCESS-RORUPD05")
"RTN","RORUPD05",86,0)
 M @RORUPDPI=@OLDPI
"RTN","RORUPD05",87,0)
 ;--- Indicate that the main task is running
"RTN","RORUPD05",88,0)
 L +@RORUPDPI@("T",0):5
"RTN","RORUPD05",89,0)
 E  Q $$ERROR^RORERR(-61)
"RTN","RORUPD05",90,0)
 ;
"RTN","RORUPD05",91,0)
 ;--- Start the subtasks
"RTN","RORUPD05",92,0)
 S RC=$$START(.TASKTBL)
"RTN","RORUPD05",93,0)
 ;--- Monitor the subtasks
"RTN","RORUPD05",94,0)
 S COUNTERS=$S(RC'<0:$$MONITOR(),1:RC)
"RTN","RORUPD05",95,0)
 ;
"RTN","RORUPD05",96,0)
 ;--- Clear "running" flag of the main task
"RTN","RORUPD05",97,0)
 ;    (request all unfinished subtasks to stop)
"RTN","RORUPD05",98,0)
 L -@RORUPDPI@("T",0)
"RTN","RORUPD05",99,0)
 ;--- Cleanup
"RTN","RORUPD05",100,0)
 I COUNTERS<0  D
"RTN","RORUPD05",101,0)
 . N TASK,ZTSK
"RTN","RORUPD05",102,0)
 . ;--- Dequeue subtasks that have not started yet
"RTN","RORUPD05",103,0)
 . S TASK=0
"RTN","RORUPD05",104,0)
 . F  S TASK=$O(@RORUPDPI@("T",TASK))  Q:TASK=""  D
"RTN","RORUPD05",105,0)
 . . S ZTSK=TASK  D DQ^%ZTLOAD
"RTN","RORUPD05",106,0)
 . ;--- Wait for all unfinished subtasks to stop
"RTN","RORUPD05",107,0)
 . L +@RORUPDPI@("T"):300  L -@RORUPDPI@("T")
"RTN","RORUPD05",108,0)
 K @RORUPDPI@("T")
"RTN","RORUPD05",109,0)
 Q COUNTERS
"RTN","RORUPD05",110,0)
 ;
"RTN","RORUPD05",111,0)
 ;***** STARTS THE SUBTASKS
"RTN","RORUPD05",112,0)
 ;
"RTN","RORUPD05",113,0)
 ; .TASKTBL      Reference to a local variable containing the table
"RTN","RORUPD05",114,0)
 ;               of subtask parameters. See the TASKSPLT and TASKTBL
"RTN","RORUPD05",115,0)
 ;               entry points for details.
"RTN","RORUPD05",116,0)
 ;
"RTN","RORUPD05",117,0)
 ; Return Values:
"RTN","RORUPD05",118,0)
 ;       <0  Error code
"RTN","RORUPD05",119,0)
 ;        0  Ok
"RTN","RORUPD05",120,0)
 ;
"RTN","RORUPD05",121,0)
START(TASKTBL) ;
"RTN","RORUPD05",122,0)
 N CNT,I,TYPE,ZTDESC,ZTDTH,ZTIO,ZTPRI,ZTRTN,ZTSAVE,ZTSK
"RTN","RORUPD05",123,0)
 K @RORUPDPI@("T")
"RTN","RORUPD05",124,0)
 ;--- Do not allow subtasks to proceed before everything is ready
"RTN","RORUPD05",125,0)
 L +@RORUPDPI@("T"):5
"RTN","RORUPD05",126,0)
 E  Q $$ERROR^RORERR(-61)
"RTN","RORUPD05",127,0)
 ;--- Start the subtasks
"RTN","RORUPD05",128,0)
 S I=""
"RTN","RORUPD05",129,0)
 F CNT=1:1  S I=$O(TASKTBL(I))  Q:I=""  D
"RTN","RORUPD05",130,0)
 . S ZTRTN="SUBTASK^RORUPD05",ZTIO=""
"RTN","RORUPD05",131,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,,CNT*30)
"RTN","RORUPD05",132,0)
 . S ZTDESC="Registry Update Subtask ("_$TR(TASKTBL(I),U,"-")_")"
"RTN","RORUPD05",133,0)
 . S ZTSAVE("RORIENS")=TASKTBL(I)
"RTN","RORUPD05",134,0)
 . S ZTSAVE("RORLRC(")=""
"RTN","RORUPD05",135,0)
 . S ZTSAVE("RORPARM(")=""
"RTN","RORUPD05",136,0)
 . S ZTSAVE("RORUPD(")=""
"RTN","RORUPD05",137,0)
 . S ZTSAVE("RORUPDPI")=""
"RTN","RORUPD05",138,0)
 . D ^%ZTLOAD
"RTN","RORUPD05",139,0)
 . ;--- Indicate that the subtask has been scheduled
"RTN","RORUPD05",140,0)
 . S @RORUPDPI@("T",ZTSK)="S"
"RTN","RORUPD05",141,0)
 . S TMP=$$MSG^RORERR20(-62,.TYPE,,ZTSK)
"RTN","RORUPD05",142,0)
 . D LOG^RORLOG(TYPE,TMP)
"RTN","RORUPD05",143,0)
 ;--- The subtasks may proceed now
"RTN","RORUPD05",144,0)
 L -@RORUPDPI@("T")
"RTN","RORUPD05",145,0)
 Q 0
"RTN","RORUPD05",146,0)
 ;
"RTN","RORUPD05",147,0)
 ;***** DATA PROCESSING SUBTASK
"RTN","RORUPD05",148,0)
 ;
"RTN","RORUPD05",149,0)
 ; RORIENS       Diapason of IENs in the 'PATIENT' file
"RTN","RORUPD05",150,0)
 ;                 ^1: Start IEN
"RTN","RORUPD05",151,0)
 ;                 ^2: End IEN
"RTN","RORUPD05",152,0)
 ; RORLRC        List of Lab result codes to check
"RTN","RORUPD05",153,0)
 ; RORPARM       Application parameters
"RTN","RORUPD05",154,0)
 ; RORUPD        Registry update descriptor
"RTN","RORUPD05",155,0)
 ; RORUPDPI      Closed root of the temporary storage
"RTN","RORUPD05",156,0)
 ;
"RTN","RORUPD05",157,0)
SUBTASK ;
"RTN","RORUPD05",158,0)
 N RORERROR      ; Error processing data
"RTN","RORUPD05",159,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","RORUPD05",160,0)
 ;
"RTN","RORUPD05",161,0)
 N RC,TASK,TMP,TYPE
"RTN","RORUPD05",162,0)
 S TASK=ZTSK
"RTN","RORUPD05",163,0)
 ;--- We are not in the KIDS environment anymore
"RTN","RORUPD05",164,0)
 K RORPARM("KIDS")
"RTN","RORUPD05",165,0)
 ;--- Disable debug output (subtask has no device)
"RTN","RORUPD05",166,0)
 S:$G(RORPARM("DEBUG"))>1 RORPARM("DEBUG")=1
"RTN","RORUPD05",167,0)
 ;--- Indicate that the subtask is running
"RTN","RORUPD05",168,0)
 L +@RORUPDPI@("T",TASK):180
"RTN","RORUPD05",169,0)
 E  S RC=$$ERROR^RORERR(-61)  Q
"RTN","RORUPD05",170,0)
 ;--- Check if the main task is running
"RTN","RORUPD05",171,0)
 L +@RORUPDPI@("T",0):0
"RTN","RORUPD05",172,0)
 I  D
"RTN","RORUPD05",173,0)
 . ;--- Cleanup if the main task is not running
"RTN","RORUPD05",174,0)
 . L -@RORUPDPI@("T",0)
"RTN","RORUPD05",175,0)
 . K @RORUPDPI@("T",TASK)
"RTN","RORUPD05",176,0)
 E  D
"RTN","RORUPD05",177,0)
 . N REGIEN,REGLST
"RTN","RORUPD05",178,0)
 . ;--- Error code that will be in effect if the subtask crashes
"RTN","RORUPD05",179,0)
 . S @RORUPDPI@("T",TASK)=-60
"RTN","RORUPD05",180,0)
 . ;--- Initialize the variables
"RTN","RORUPD05",181,0)
 . D INIT^RORUTL01(),CLEAR^RORERR("SUBTASK^RORUPD05")
"RTN","RORUPD05",182,0)
 . S REGIEN=""
"RTN","RORUPD05",183,0)
 . F  S REGIEN=$O(@RORUPDPI@(2,REGIEN))  Q:REGIEN=""  D
"RTN","RORUPD05",184,0)
 . . S TMP=$P(@RORUPDPI@(2,REGIEN),U)  S:TMP'="" REGLST(TMP)=REGIEN
"RTN","RORUPD05",185,0)
 . S TMP="REGISTRY UPDATE SUBTASK #"_TASK_" STARTED"
"RTN","RORUPD05",186,0)
 . S TMP=$$OPEN^RORLOG(.REGLST,1,TMP)
"RTN","RORUPD05",187,0)
 . ;--- Process the patients from 'Start IEN' to 'End IEN'
"RTN","RORUPD05",188,0)
 . S RC=$$PROCESS^RORUPD01($P(RORIENS,U),$P(RORIENS,U,2))
"RTN","RORUPD05",189,0)
 . ;--- Set the error code returned by the registry update process
"RTN","RORUPD05",190,0)
 . S @RORUPDPI@("T",TASK)=RC
"RTN","RORUPD05",191,0)
 . ;--- Cleanup and error processing
"RTN","RORUPD05",192,0)
 . S:RC=-42 ZTSTOP=1
"RTN","RORUPD05",193,0)
 . S TMP="REGISTRY UPDATE SUBTASK "_$S(RC<0:"ABORTED",1:"COMPLETED")
"RTN","RORUPD05",194,0)
 . D CLOSE^RORLOG(TMP,$S(RC'<0:RC,1:""))
"RTN","RORUPD05",195,0)
 ;--- Clear "running" flag of the subtask
"RTN","RORUPD05",196,0)
 L -@RORUPDPI@("T",TASK)
"RTN","RORUPD05",197,0)
 S ZTREQ="@"
"RTN","RORUPD05",198,0)
 Q
"RTN","RORUPD05",199,0)
 ;
"RTN","RORUPD05",200,0)
 ;***** CALCULATES TABLE OF SUBTASKS
"RTN","RORUPD05",201,0)
 ;
"RTN","RORUPD05",202,0)
 ; MAXNTSK       Maximum number of data processing subtasks
"RTN","RORUPD05",203,0)
 ;
"RTN","RORUPD05",204,0)
 ; .TASKTBL      Reference to a local variable where table of
"RTN","RORUPD05",205,0)
 ;               subtask parameters is returned:
"RTN","RORUPD05",206,0)
 ;
"RTN","RORUPD05",207,0)
 ;               TASKTBL       Number of subtasks
"RTN","RORUPD05",208,0)
 ;               TASKTBL(I)    Subtask parameters
"RTN","RORUPD05",209,0)
 ;                               ^1: Start IEN
"RTN","RORUPD05",210,0)
 ;                               ^2: End IEN
"RTN","RORUPD05",211,0)
 ;
"RTN","RORUPD05",212,0)
 ; Return Values:
"RTN","RORUPD05",213,0)
 ;       <0  Error code
"RTN","RORUPD05",214,0)
 ;        0  Process all data by the main task
"RTN","RORUPD05",215,0)
 ;       >1  Number of subtasks
"RTN","RORUPD05",216,0)
 ;
"RTN","RORUPD05",217,0)
 ; If the PATIENT file contains more than 100,000 records, up to
"RTN","RORUPD05",218,0)
 ; MAXNTSK data processing subtasks may be defined. Otherwise, the
"RTN","RORUPD05",219,0)
 ; data should be processed by the main task.
"RTN","RORUPD05",220,0)
 ;
"RTN","RORUPD05",221,0)
 ; The function uses the ^TMP("RORTMP",$J) global node.
"RTN","RORUPD05",222,0)
 ;
"RTN","RORUPD05",223,0)
TASKTBL(MAXNTSK,RORTBL) ;
"RTN","RORUPD05",224,0)
 N I,IEN,INC,LST,NR
"RTN","RORUPD05",225,0)
 K RORTBL,^TMP("RORTMP",$J)
"RTN","RORUPD05",226,0)
 ;--- Get number of records in the PATIENT file
"RTN","RORUPD05",227,0)
 S NR=$$GET1^DID(2,,,"ENTRIES",,"RORMSG")
"RTN","RORUPD05",228,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9)
"RTN","RORUPD05",229,0)
 Q:NR'>10000 0
"RTN","RORUPD05",230,0)
 ;--- Generate IEN intervals (no more than 300)
"RTN","RORUPD05",231,0)
 S INC=NR\300,NR=0  S:INC<1 INC=1
"RTN","RORUPD05",232,0)
 F IEN=0:INC  S IEN=$O(^DPT(IEN))  Q:IEN'>0  D
"RTN","RORUPD05",233,0)
 . S NR=NR+1,^TMP("RORTMP",$J,NR)=IEN
"RTN","RORUPD05",234,0)
 ;--- Generate the task table
"RTN","RORUPD05",235,0)
 S IEN=1,INC=NR/MAXNTSK
"RTN","RORUPD05",236,0)
 F RORTBL=1:1  D  Q:(RORTBL'<MAXNTSK)!(IEN'>0)
"RTN","RORUPD05",237,0)
 . S RORTBL(RORTBL)=IEN
"RTN","RORUPD05",238,0)
 . S I=$J(RORTBL*INC,0,0),IEN=$G(^TMP("RORTMP",$J,I))
"RTN","RORUPD05",239,0)
 . S $P(RORTBL(RORTBL),U,2)=IEN
"RTN","RORUPD05",240,0)
 K ^TMP("RORTMP",$J)
"RTN","RORUPD05",241,0)
 ;--- Analize the result
"RTN","RORUPD05",242,0)
 I $G(RORTBL)<2  K RORTBL
"RTN","RORUPD05",243,0)
 E  S $P(RORTBL(RORTBL),U,2)=$O(^DPT(" "),-1)
"RTN","RORUPD05",244,0)
 Q +$G(RORTBL)
"RTN","RORUTL06")
0^5^B61329493
"RTN","RORUTL06",1,0)
RORUTL06 ;HCIOFO/SG - DEVELOPER ENTRY POINTS ; 3/16/04 1:47pm
"RTN","RORUTL06",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORUTL06",3,0)
 ;
"RTN","RORUTL06",4,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORUTL06",5,0)
 W !,"CLINICAL CASE REGISTRIES DEVELOPER'S UTILITIES"
"RTN","RORUTL06",6,0)
 S X=""
"RTN","RORUTL06",7,0)
 S X=X_";M:Metadata definitions"
"RTN","RORUTL06",8,0)
 S X=X_";V:Verify registry definition"
"RTN","RORUTL06",9,0)
 S X=X_";P:Prepare for KIDS"
"RTN","RORUTL06",10,0)
 S DIR(0)="SO^"_$P(X,";",2,999)
"RTN","RORUTL06",11,0)
 D ^DIR  W !  Q:$D(DIRUT)
"RTN","RORUTL06",12,0)
 G PRTMDE:Y="M",VERIFY:Y="V",DISTPREP:Y="P"
"RTN","RORUTL06",13,0)
 Q
"RTN","RORUTL06",14,0)
 ;
"RTN","RORUTL06",15,0)
 ;***** VERIFIES REGISTRY DEFINITION
"RTN","RORUTL06",16,0)
VERIFY ;
"RTN","RORUTL06",17,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",18,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",19,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",20,0)
 ;
"RTN","RORUTL06",21,0)
 N RC,REGLST,REGNAME
"RTN","RORUTL06",22,0)
 W !,"REGISTRY DEFINITION VERIFIER",!
"RTN","RORUTL06",23,0)
 D KILL^XUSCLEAN,INIT^RORUTL01("ROR")
"RTN","RORUTL06",24,0)
 S RORPARM("DEBUG")=2
"RTN","RORUTL06",25,0)
 S RORPARM("ERR")=1
"RTN","RORUTL06",26,0)
 D CLEAR^RORERR("START^RORUTL06")
"RTN","RORUTL06",27,0)
 ;--- Select a registry
"RTN","RORUTL06",28,0)
 S RC=$$SELREG^RORHDTUT(.REGNAME)  G:RC<0 ERROR
"RTN","RORUTL06",29,0)
 Q:RC'>0  S REGLST(REGNAME)=""
"RTN","RORUTL06",30,0)
 ;--- Validate registry update defintion
"RTN","RORUTL06",31,0)
 S RC=$$UPDDEF(.REGLST)            G:RC<0 ERROR
"RTN","RORUTL06",32,0)
 ;--- Validate data extraction defintion
"RTN","RORUTL06",33,0)
 S RC=$$EXTDEF(REGNAME)            G:RC<0 ERROR
"RTN","RORUTL06",34,0)
 ;--- Cleanup
"RTN","RORUTL06",35,0)
 D INIT^RORUTL01("ROR")
"RTN","RORUTL06",36,0)
 Q
"RTN","RORUTL06",37,0)
 ;
"RTN","RORUTL06",38,0)
 ;***** PREPARES THE REGISTRY FOR KIDS DISTRIBUTION
"RTN","RORUTL06",39,0)
DISTPREP ;
"RTN","RORUTL06",40,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",41,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",42,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",43,0)
 ;
"RTN","RORUTL06",44,0)
 N IENS,FLD,RC,REGIEN,REGNAME,RORFDA,RORMSG
"RTN","RORUTL06",45,0)
 N DA,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RORUTL06",46,0)
 W !,"REGISTRY PREPARATION FOR KIDS DISTRIBUTION",!
"RTN","RORUTL06",47,0)
 D KILL^XUSCLEAN
"RTN","RORUTL06",48,0)
 S RORPARM("ERR")=1
"RTN","RORUTL06",49,0)
 D CLEAR^RORERR("DISTPREP^RORUTL06")
"RTN","RORUTL06",50,0)
 ;--- Select a registry
"RTN","RORUTL06",51,0)
 S RC=$$SELREG^RORHDTUT(.REGNAME)  G:RC<0 ERROR
"RTN","RORUTL06",52,0)
 Q:RC'>0  S REGIEN=RC
"RTN","RORUTL06",53,0)
 ;--- Request a confirmation
"RTN","RORUTL06",54,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RORUTL06",55,0)
 S DIR("A",1)="Some fields of the '"_REGNAME_"' registry parameters"
"RTN","RORUTL06",56,0)
 S DIR("A",2)="will be cleared to prepare them for KIDS distribution."
"RTN","RORUTL06",57,0)
 S DIR("A")="Do you really want to do this"
"RTN","RORUTL06",58,0)
 D ^DIR  Q:'$G(Y)
"RTN","RORUTL06",59,0)
 ;--- Clear Registry parameters (single-valued)
"RTN","RORUTL06",60,0)
 S IENS=REGIEN_","
"RTN","RORUTL06",61,0)
 F FLD=2.1,2.2,2.3,2.4,2.5,13,19.1,19.2,21.02,21.03,21.04,21.05  D
"RTN","RORUTL06",62,0)
 . S RORFDA(798.1,IENS,FLD)="@"
"RTN","RORUTL06",63,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",64,0)
 G:$$DBS^RORERR("RORMSG",-9,,,798.1,IENS) ERROR
"RTN","RORUTL06",65,0)
 ;--- Clear Registry parameters (multiples)
"RTN","RORUTL06",66,0)
 S IENS=","_REGIEN_","
"RTN","RORUTL06",67,0)
 G:$$CLEAR^RORUTL05(798.114,IENS)<0 ERROR  ; COORDINATOR (14)
"RTN","RORUTL06",68,0)
 G:$$CLEAR^RORUTL05(798.116,IENS)<0 ERROR  ; USER (16)
"RTN","RORUTL06",69,0)
 G:$$CLEAR^RORUTL05(798.128,IENS)<0 ERROR  ; LOCAL LAB TEST (28)
"RTN","RORUTL06",70,0)
 G:$$CLEAR^RORUTL05(798.129,IENS)<0 ERROR  ; LOCAL DRUG (29)
"RTN","RORUTL06",71,0)
 ;--- Registry-specific data
"RTN","RORUTL06",72,0)
 I REGNAME="VA HEPC"  G:$$HEPC(REGIEN)<0 ERROR
"RTN","RORUTL06",73,0)
 I REGNAME="VA ICR"   G:$$ICR(REGIEN)<0 ERROR
"RTN","RORUTL06",74,0)
 ;--- Success
"RTN","RORUTL06",75,0)
 W !,"Registry parameters are ready for distribution."
"RTN","RORUTL06",76,0)
 Q
"RTN","RORUTL06",77,0)
 ;
"RTN","RORUTL06",78,0)
 ;***** DISPLAYS THE ERRORS
"RTN","RORUTL06",79,0)
ERROR ;
"RTN","RORUTL06",80,0)
 D DSPSTK^RORERR()
"RTN","RORUTL06",81,0)
 Q
"RTN","RORUTL06",82,0)
 ;
"RTN","RORUTL06",83,0)
 ;***** VALIDATES DATA EXTRACTION DEFINITION
"RTN","RORUTL06",84,0)
 ;
"RTN","RORUTL06",85,0)
 ; REGNAME       Registry name
"RTN","RORUTL06",86,0)
 ;
"RTN","RORUTL06",87,0)
 ; Return Values:
"RTN","RORUTL06",88,0)
 ;       <0  Error Code
"RTN","RORUTL06",89,0)
 ;        0  Ok
"RTN","RORUTL06",90,0)
 ;
"RTN","RORUTL06",91,0)
EXTDEF(REGNAME) ;
"RTN","RORUTL06",92,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",93,0)
 N ROREXT        ; Data extraction descriptor
"RTN","RORUTL06",94,0)
 N RORHL         ; HL7 variables
"RTN","RORUTL06",95,0)
 N RORLRC        ; List of codes of Lab results to be extracted
"RTN","RORUTL06",96,0)
 ;
"RTN","RORUTL06",97,0)
 N RC
"RTN","RORUTL06",98,0)
 W !,"DATA EXTRACTION DEFINITION",!
"RTN","RORUTL06",99,0)
 D CLEAR^RORERR("UPDDEF^RORUTL06")
"RTN","RORUTL06",100,0)
 S RC=$$PREPARE^ROREXPR(REGNAME)
"RTN","RORUTL06",101,0)
 D:RC'<0 DEBUG1^ROREXT
"RTN","RORUTL06",102,0)
 Q RC
"RTN","RORUTL06",103,0)
 ;
"RTN","RORUTL06",104,0)
 ;***** HEPC-SPECIFIC PREPARATIONS
"RTN","RORUTL06",105,0)
HEPC(REGIEN) ;
"RTN","RORUTL06",106,0)
 N IENS,RORFDA,RORMSG
"RTN","RORUTL06",107,0)
 S IENS=(+REGIEN)_","
"RTN","RORUTL06",108,0)
 S RORFDA(798.1,IENS,1)=2900101  ; REGISTRY UPDATED UNTIL
"RTN","RORUTL06",109,0)
 S RORFDA(798.1,IENS,2)=2900101  ; DATA EXTRACTED UNTIL
"RTN","RORUTL06",110,0)
 S RORFDA(798.1,IENS,25)=1       ; ENABLE PROTOCOLS
"RTN","RORUTL06",111,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",112,0)
 Q $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL06",113,0)
 ;
"RTN","RORUTL06",114,0)
 ;***** ICR-SPECIFIC PREPARATIONS
"RTN","RORUTL06",115,0)
ICR(REGIEN) ;
"RTN","RORUTL06",116,0)
 N IENS,RORFDA,RORMSG
"RTN","RORUTL06",117,0)
 S IENS=(+REGIEN)_","
"RTN","RORUTL06",118,0)
 S RORFDA(798.1,IENS,1)=2850101  ; REGISTRY UPDATED UNTIL
"RTN","RORUTL06",119,0)
 S RORFDA(798.1,IENS,2)=2850101  ; DATA EXTRACTED UNTIL
"RTN","RORUTL06",120,0)
 S RORFDA(798.1,IENS,25)=1       ; ENABLE PROTOCOLS
"RTN","RORUTL06",121,0)
 D FILE^DIE(,"RORFDA","RORMSG")
"RTN","RORUTL06",122,0)
 Q $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORUTL06",123,0)
 ;
"RTN","RORUTL06",124,0)
 ;***** PRINTS THE DATA ELEMENT METADATA
"RTN","RORUTL06",125,0)
PRTMDE ;
"RTN","RORUTL06",126,0)
 N RORCOLS       ; Lits of column descriptors
"RTN","RORUTL06",127,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",128,0)
 N RORERROR      ; Error processing data
"RTN","RORUTL06",129,0)
 N RORLST        ; List of files grouped by parents
"RTN","RORUTL06",130,0)
 N RORPAGE       ; Current page number
"RTN","RORUTL06",131,0)
 N RORPARM       ; Application parameters
"RTN","RORUTL06",132,0)
 N RORTTL        ; Title of the report
"RTN","RORUTL06",133,0)
 ;
"RTN","RORUTL06",134,0)
 N DIR,DIRUT,DTOUT,DUOUT,MODE,TMP,X,Y
"RTN","RORUTL06",135,0)
 D KILL^XUSCLEAN
"RTN","RORUTL06",136,0)
 S (DDBDMSG,RORTTL)="METADATA OF THE DATA ELEMENTS"
"RTN","RORUTL06",137,0)
 W !,RORTTL,!  S RORPARM("ERR")=1
"RTN","RORUTL06",138,0)
 D CLEAR^RORERR("PRTMDE^RORUTL06")
"RTN","RORUTL06",139,0)
 ;---Request report sort mode from user
"RTN","RORUTL06",140,0)
 S DIR(0)="S^H:Hierarhical;L:List of codes"
"RTN","RORUTL06",141,0)
 S DIR("A")="Sort mode",DIR("B")="List of codes"
"RTN","RORUTL06",142,0)
 D ^DIR  Q:$D(DIRUT)  S MODE=Y
"RTN","RORUTL06",143,0)
 ;--- Generate and print the report
"RTN","RORUTL06",144,0)
 I MODE="H"  S RC=0  D
"RTN","RORUTL06",145,0)
 . N %ZIS,I,FILE,PARENT,ROOT,RORMSG
"RTN","RORUTL06",146,0)
 . S ROOT=$$ROOT^DILFD(799.2,,1),RORPAGE=0
"RTN","RORUTL06",147,0)
 . ;--- Load column descriptors
"RTN","RORUTL06",148,0)
 . F I=1:1  S TMP=$P($T(PRTMDEH+I),";;",2)  Q:TMP=""  D
"RTN","RORUTL06",149,0)
 . . S RORCOLS(I)=$TR($P(TMP,U,1,3)," ")_U_$P(TMP,U,4)
"RTN","RORUTL06",150,0)
 . ;--- Load file list
"RTN","RORUTL06",151,0)
 . S FILE=0,RC=0
"RTN","RORUTL06",152,0)
 . F  S FILE=$O(@ROOT@(FILE))  Q:FILE'>0  D  Q:RC<0
"RTN","RORUTL06",153,0)
 . . S PARENT=+$$GET1^DIQ(799.2,FILE_",",1,"I",,"RORMSG")
"RTN","RORUTL06",154,0)
 . . I $G(DIERR)  D  Q
"RTN","RORUTL06",155,0)
 . . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.2,FILE_",")
"RTN","RORUTL06",156,0)
 . . S RORLST(PARENT,FILE)=""
"RTN","RORUTL06",157,0)
 . Q:RC<0
"RTN","RORUTL06",158,0)
 . ;--- Print the report
"RTN","RORUTL06",159,0)
 . S %ZIS("B")=""
"RTN","RORUTL06",160,0)
 . D ^%ZIS   Q:$G(POP)  U IO
"RTN","RORUTL06",161,0)
 . S RC=$$PRTMDEH()  S:RC'<0 RC=$$PRTMDE1(0,1)
"RTN","RORUTL06",162,0)
 . D ^%ZISC
"RTN","RORUTL06",163,0)
 E  S RC=$$PRTMDE2()
"RTN","RORUTL06",164,0)
 G:RC<0 ERROR
"RTN","RORUTL06",165,0)
 Q
"RTN","RORUTL06",166,0)
 ;
"RTN","RORUTL06",167,0)
 ;***** PRINTS A LEVEL OF THE "FILE-PROCESSING TREE"
"RTN","RORUTL06",168,0)
 ;
"RTN","RORUTL06",169,0)
 ; PARENT        Parent file number
"RTN","RORUTL06",170,0)
 ; LEVEL         Number of the current level in the tree
"RTN","RORUTL06",171,0)
 ;
"RTN","RORUTL06",172,0)
 ; Return Values:
"RTN","RORUTL06",173,0)
 ;       <0  Error Code
"RTN","RORUTL06",174,0)
 ;        0  Ok
"RTN","RORUTL06",175,0)
 ;
"RTN","RORUTL06",176,0)
PRTMDE1(PARENT,LEVEL) ;
"RTN","RORUTL06",177,0)
 N FIELDS,FILE,FLD,I,IENS,IR,L,RORBUF,RORMSG
"RTN","RORUTL06",178,0)
 S FIELDS="@;.01E;.02I;1I;2E;4I;4.1;4.2;6I"
"RTN","RORUTL06",179,0)
 ;---
"RTN","RORUTL06",180,0)
 S FILE="",RC=0
"RTN","RORUTL06",181,0)
 F  S FILE=$O(RORLST(PARENT,FILE))  Q:FILE=""  D  Q:RC<0
"RTN","RORUTL06",182,0)
 . ;--- Load descriptors of the data elements
"RTN","RORUTL06",183,0)
 . K RORBUF  S IENS=","_FILE_","
"RTN","RORUTL06",184,0)
 . D LIST^DIC(799.22,IENS,FIELDS,,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL06",185,0)
 . ;--- Print header (if necessary) and file number
"RTN","RORUTL06",186,0)
 . I ($Y+5)>IOSL  S RC=$$PRTMDEH()  Q:RC<0
"RTN","RORUTL06",187,0)
 . D PRTMDEL(LEVEL-1),PRTMDEL(LEVEL-1,FILE)
"RTN","RORUTL06",188,0)
 . ;--- Print data element descriptors
"RTN","RORUTL06",189,0)
 . S IR="",RC=0
"RTN","RORUTL06",190,0)
 . F  S IR=$O(RORBUF("DILIST","ID",IR))  Q:IR=""  D  Q:RC<0  W !
"RTN","RORUTL06",191,0)
 . . I ($Y+5)>IOSL  S RC=$$PRTMDEH()  Q:RC<0
"RTN","RORUTL06",192,0)
 . . D:IR>1 PRTMDEL(LEVEL,"")
"RTN","RORUTL06",193,0)
 . . S I=""
"RTN","RORUTL06",194,0)
 . . F  S I=$O(RORCOLS(I))  Q:I=""  D
"RTN","RORUTL06",195,0)
 . . . S FLD=+$P(RORCOLS(I),U,2)  Q:FLD'>0
"RTN","RORUTL06",196,0)
 . . . S L=+$P(RORCOLS(I),U,3)  S:L'>0 L=999
"RTN","RORUTL06",197,0)
 . . . W ?(+RORCOLS(I)),$E($G(RORBUF("DILIST","ID",IR,FLD)),1,L)
"RTN","RORUTL06",198,0)
 . Q:RC<0
"RTN","RORUTL06",199,0)
 . S:$D(RORLST(FILE))>1 RC=$$PRTMDE1(FILE,LEVEL+1)
"RTN","RORUTL06",200,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL06",201,0)
 ;
"RTN","RORUTL06",202,0)
 ;***** PRINTS A TABLE OF DATA ELEMENTS
"RTN","RORUTL06",203,0)
PRTMDE2() ;
"RTN","RORUTL06",204,0)
 N BY,DHD,FR,L,DIC,FLDS,TO
"RTN","RORUTL06",205,0)
 S L=0,DIC=799.2,DHD=RORTTL
"RTN","RORUTL06",206,0)
 S BY="[ROR DATA ELEMENTS]",FLDS="[ROR DATA ELEMENTS]"
"RTN","RORUTL06",207,0)
 D EN1^DIP
"RTN","RORUTL06",208,0)
 Q 0
"RTN","RORUTL06",209,0)
 ;
"RTN","RORUTL06",210,0)
 ;***** PRINTS A HEADER OF THE DATA ELEMENT REPORT
"RTN","RORUTL06",211,0)
 ;  X  Field Width Title
"RTN","RORUTL06",212,0)
PRTMDEH() ;
"RTN","RORUTL06",213,0)
 ;;  0^     ^     ^File
"RTN","RORUTL06",214,0)
 ;; 22^  .01^   25^Data Name
"RTN","RORUTL06",215,0)
 ;; 49^  .02^     ^Code
"RTN","RORUTL06",216,0)
 ;; 55^ 2   ^     ^Req
"RTN","RORUTL06",217,0)
 ;; 60^ 1   ^     ^API
"RTN","RORUTL06",218,0)
 ;; 65^ 6   ^     ^Field Number
"RTN","RORUTL06",219,0)
 ;; 82^ 4   ^     ^VT
"RTN","RORUTL06",220,0)
 ;; 86^ 4.1 ^   20^External
"RTN","RORUTL06",221,0)
 ;;108^ 4.2 ^   20^Internal
"RTN","RORUTL06",222,0)
 ;
"RTN","RORUTL06",223,0)
 N DIR,DIRUT,DTOUT,DUOUT,I,X,Y
"RTN","RORUTL06",224,0)
 I RORPAGE,$E(IOST,1,2)="C-"  D  Q:'Y $S(Y="":-72,1:-71)
"RTN","RORUTL06",225,0)
 . S DIR(0)="E"  D ^DIR
"RTN","RORUTL06",226,0)
 W:RORPAGE!($E(IOST,1,2)="C-") @IOF
"RTN","RORUTL06",227,0)
 S RORPAGE=RORPAGE+1,I=""  W RORTTL,!
"RTN","RORUTL06",228,0)
 F  S I=$O(RORCOLS(I))  Q:I=""  W ?(+RORCOLS(I)),$P(RORCOLS(I),U,4)
"RTN","RORUTL06",229,0)
 S X="",$P(X,"-",IOM)=""
"RTN","RORUTL06",230,0)
 W !,X,!
"RTN","RORUTL06",231,0)
 Q 0
"RTN","RORUTL06",232,0)
 ;
"RTN","RORUTL06",233,0)
 ;***** PRINTS THE LEVEL INDICATOR
"RTN","RORUTL06",234,0)
 ;
"RTN","RORUTL06",235,0)
 ; N             Number of dots in the indicator
"RTN","RORUTL06",236,0)
 ; [FILE]        File number
"RTN","RORUTL06",237,0)
 ;
"RTN","RORUTL06",238,0)
PRTMDEL(N,FILE) ;
"RTN","RORUTL06",239,0)
 N I  W:$X>0 !  F I=1:1:N  W ". "
"RTN","RORUTL06",240,0)
 W:$D(FILE) FILE  W:'$D(FILE) !
"RTN","RORUTL06",241,0)
 Q
"RTN","RORUTL06",242,0)
 ;
"RTN","RORUTL06",243,0)
 ;***** VALIDATES REGISTRY UPDATE DEFINITION
"RTN","RORUTL06",244,0)
 ;
"RTN","RORUTL06",245,0)
 ; .REGLST       Reference to a local array containing
"RTN","RORUTL06",246,0)
 ;               registry names as subscripts
"RTN","RORUTL06",247,0)
 ;
"RTN","RORUTL06",248,0)
 ; Return Values:
"RTN","RORUTL06",249,0)
 ;       <0  Error Code
"RTN","RORUTL06",250,0)
 ;        0  Ok
"RTN","RORUTL06",251,0)
 ;
"RTN","RORUTL06",252,0)
UPDDEF(REGLST) ;
"RTN","RORUTL06",253,0)
 N RORERRDL      ; Default error location
"RTN","RORUTL06",254,0)
 N RORLRC        ; List of Lab result codes to check
"RTN","RORUTL06",255,0)
 N RORUPD        ; Update descriptor
"RTN","RORUTL06",256,0)
 N RORUPDPI      ; Closed root of the temporary storage
"RTN","RORUTL06",257,0)
 N RORVALS       ; Calculated values
"RTN","RORUTL06",258,0)
 ;
"RTN","RORUTL06",259,0)
 N RC
"RTN","RORUTL06",260,0)
 W !,"REGISTRY UPDATE DEFINITION",!
"RTN","RORUTL06",261,0)
 D CLEAR^RORERR("UPDDEF^RORUTL06")
"RTN","RORUTL06",262,0)
 S RORUPDPI=$NA(^TMP("RORUPD",$J))
"RTN","RORUTL06",263,0)
 S RC=$$PREPARE^RORUPR(.REGLST)
"RTN","RORUTL06",264,0)
 D:RC'<0 DEBUG^RORUPDUT
"RTN","RORUTL06",265,0)
 Q RC
"RTN","RORUTL17")
0^11^B53261320
"RTN","RORUTL17",1,0)
RORUTL17 ;HCIOFO/SG - REGISTRY INFORMATION UTILITIES ; 3/24/04 2:49pm
"RTN","RORUTL17",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORUTL17",3,0)
 ;
"RTN","RORUTL17",4,0)
 Q
"RTN","RORUTL17",5,0)
 ;
"RTN","RORUTL17",6,0)
 ;***** ADDS THE PENDING PATIENT TO THE LIST
"RTN","RORUTL17",7,0)
 ;
"RTN","RORUTL17",8,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",9,0)
 ; IEN           IEN of the registry record
"RTN","RORUTL17",10,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORUTL17",11,0)
 ;
"RTN","RORUTL17",12,0)
 ; Return Values:
"RTN","RORUTL17",13,0)
 ;       <0  Error code
"RTN","RORUTL17",14,0)
 ;        0  Ok
"RTN","RORUTL17",15,0)
 ;
"RTN","RORUTL17",16,0)
ADDPP(REGIEN,IEN,PATIEN) ;
"RTN","RORUTL17",17,0)
 N BUF,I,NODE,IEN1,TMP,VA,VADM
"RTN","RORUTL17",18,0)
 D VADEM^RORUTL05(PATIEN)
"RTN","RORUTL17",19,0)
 S @ROR8DST@("PPL",PATIEN)=IEN_U_$$XOR^RORUTL03($P($G(VADM(2)),U))
"RTN","RORUTL17",20,0)
 ;--- Dates of selection rules
"RTN","RORUTL17",21,0)
 S NODE=$$ROOT^DILFD(798.01,","_IEN_",",1),BUF=""
"RTN","RORUTL17",22,0)
 S IEN1=0
"RTN","RORUTL17",23,0)
 F  S IEN1=$O(@NODE@(IEN1))  Q:IEN1'>0  D
"RTN","RORUTL17",24,0)
 . S TMP=$G(@NODE@(IEN1,0)),I=+$G(RORSRL(+TMP))
"RTN","RORUTL17",25,0)
 . S:I>0 $P(BUF,U,I)=$P(TMP,U,2)
"RTN","RORUTL17",26,0)
 S @ROR8DST@("PPL",PATIEN,1)=BUF
"RTN","RORUTL17",27,0)
 Q 0
"RTN","RORUTL17",28,0)
 ;
"RTN","RORUTL17",29,0)
 ;***** FORMATS THE DATE
"RTN","RORUTL17",30,0)
DATE(DATE) ;
"RTN","RORUTL17",31,0)
 Q $S(DATE>1:$$FMTE^XLFDT(DATE\1,"5Z"),1:"")
"RTN","RORUTL17",32,0)
 ;
"RTN","RORUTL17",33,0)
 ;***** LOADS THE LIST OF SELECTION RULES
"RTN","RORUTL17",34,0)
 ;
"RTN","RORUTL17",35,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",36,0)
 ; .SRLST        Reference to a local variable for the
"RTN","RORUTL17",37,0)
 ;               list of selection rules
"RTN","RORUTL17",38,0)
 ;
"RTN","RORUTL17",39,0)
 ; Return Values:
"RTN","RORUTL17",40,0)
 ;       <0  Error code
"RTN","RORUTL17",41,0)
 ;        0  Ok
"RTN","RORUTL17",42,0)
 ;
"RTN","RORUTL17",43,0)
LOADSRL(REGIEN,SRLST) ;
"RTN","RORUTL17",44,0)
 N IEN,NAME,NODE
"RTN","RORUTL17",45,0)
 S NODE=$$ROOT^DILFD(798.2,,1)
"RTN","RORUTL17",46,0)
 S IEN=0
"RTN","RORUTL17",47,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORUTL17",48,0)
 . S NAME=$P($G(@NODE@(IEN,0)),U)  Q:NAME=""
"RTN","RORUTL17",49,0)
 . I NAME?1"VA"1.E1"LAB".E      S SRLST(IEN)="1^LAB"      Q
"RTN","RORUTL17",50,0)
 . I NAME?1"VA"1.E1"PROBLEM".E  S SRLST(IEN)="2^PROBLEM"  Q
"RTN","RORUTL17",51,0)
 . I NAME?1"VA"1.E1"PTF".E      S SRLST(IEN)="3^PTF"      Q
"RTN","RORUTL17",52,0)
 . I NAME?1"VA"1.E1"VPOV".E     S SRLST(IEN)="4^VISIT"    Q
"RTN","RORUTL17",53,0)
 . I NAME?1"VA"1.E1"VISIT".E    S SRLST(IEN)="4^VISIT"    Q
"RTN","RORUTL17",54,0)
 Q 0
"RTN","RORUTL17",55,0)
 ;
"RTN","RORUTL17",56,0)
 ;***** COUNTS PATIENTS WITH ERRORS
"RTN","RORUTL17",57,0)
 ;
"RTN","RORUTL17",58,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",59,0)
 ;
"RTN","RORUTL17",60,0)
 ; Return Values:
"RTN","RORUTL17",61,0)
 ;       <0  Error code
"RTN","RORUTL17",62,0)
 ;        0  Ok
"RTN","RORUTL17",63,0)
 ;       >0  Number of patients with errors
"RTN","RORUTL17",64,0)
 ;
"RTN","RORUTL17",65,0)
PTERR(REGIEN,SPI) ;
"RTN","RORUTL17",66,0)
 N CNT,IEN,NODE,RC,TMP
"RTN","RORUTL17",67,0)
 W:SPI !,"Counting patients with errors",!
"RTN","RORUTL17",68,0)
 S NODE=$$ROOT^DILFD(798.3,,1),(CNT,RC)=0
"RTN","RORUTL17",69,0)
 S IEN=0
"RTN","RORUTL17",70,0)
 F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORUTL17",71,0)
 . W:SPI "."
"RTN","RORUTL17",72,0)
 . S:$D(@NODE@(IEN,1,"B",REGIEN)) CNT=CNT+1
"RTN","RORUTL17",73,0)
 Q $S(RC<0:RC,1:CNT)
"RTN","RORUTL17",74,0)
 ;
"RTN","RORUTL17",75,0)
 ;***** GATHERS THE INFORMATION ABOUT THE REGISTRY
"RTN","RORUTL17",76,0)
 ;
"RTN","RORUTL17",77,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",78,0)
 ;
"RTN","RORUTL17",79,0)
 ; ROR8DST       Closed root of the destination array
"RTN","RORUTL17",80,0)
 ;
"RTN","RORUTL17",81,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL17",82,0)
 ;                 E  Count patients with errors in the
"RTN","RORUTL17",83,0)
 ;                    ROR PENDING PATIENT file
"RTN","RORUTL17",84,0)
 ;                 P  Include list of pending patients
"RTN","RORUTL17",85,0)
 ;                 S  Show the progress indicator
"RTN","RORUTL17",86,0)
 ;
"RTN","RORUTL17",87,0)
 ; @ROR8DST@(
"RTN","RORUTL17",88,0)
 ;   "DTACKMAX")         The latest and the earliest dates by which
"RTN","RORUTL17",89,0)
 ;   "DTACKMIN")         patient data transmissions are acknowledged
"RTN","RORUTL17",90,0)
 ;
"RTN","RORUTL17",91,0)
 ;   "NPA")              Number of active patients
"RTN","RORUTL17",92,0)
 ;   "NPE")              Number of patients with errors in the
"RTN","RORUTL17",93,0)
 ;                       ROR PENDING PATIENT file
"RTN","RORUTL17",94,0)
 ;   "NPP")              Number of pending patients
"RTN","RORUTL17",95,0)
 ;   "NPT")              Total number of patients in the registry
"RTN","RORUTL17",96,0)
 ;                       (including inactive and pending)
"RTN","RORUTL17",97,0)
 ;
"RTN","RORUTL17",98,0)
 ;   "PPL",
"RTN","RORUTL17",99,0)
 ;     0,1)              Map of the corresponding data subnode
"RTN","RORUTL17",100,0)
 ;                       (field names separated by ^)
"RTN","RORUTL17",101,0)
 ;     DFN)              Pending patient
"RTN","RORUTL17",102,0)
 ;                         ^01: IEN of the registry record
"RTN","RORUTL17",103,0)
 ;                         ^02: Coded SSN
"RTN","RORUTL17",104,0)
 ;     DFN,1)
"RTN","RORUTL17",105,0)
 ;                       Dates of the selection rules
"RTN","RORUTL17",106,0)
 ;                         ^01: LAB
"RTN","RORUTL17",107,0)
 ;                         ^02: PROBLEM
"RTN","RORUTL17",108,0)
 ;                         ^03: PTF
"RTN","RORUTL17",109,0)
 ;                         ^04: VISIT
"RTN","RORUTL17",110,0)
 ;
"RTN","RORUTL17",111,0)
 ; Return Values:
"RTN","RORUTL17",112,0)
 ;       <0  Error code
"RTN","RORUTL17",113,0)
 ;        0  Ok
"RTN","RORUTL17",114,0)
 ;       >0  Number of ignored errors
"RTN","RORUTL17",115,0)
 ;
"RTN","RORUTL17",116,0)
REGINFO(REGIEN,ROR8DST,FLAGS) ;
"RTN","RORUTL17",117,0)
 N RORECNT       ; Number of errors
"RTN","RORUTL17",118,0)
 N RORSRL        ; List of selection rules
"RTN","RORUTL17",119,0)
 ;
"RTN","RORUTL17",120,0)
 N COUNTS,CPPL,DTACKMIN,DTACKMAX,IEN,IENS,NODE,PTSTAT,RC,RORBUF,RORMSG,SPI,TMP
"RTN","RORUTL17",121,0)
 S FLAGS=$G(FLAGS),SPI=(FLAGS["S"),CPPL=(FLAGS["P")
"RTN","RORUTL17",122,0)
 S DTACKMIN=999999999,DTACKMAX=0
"RTN","RORUTL17",123,0)
 K @ROR8DST  S (RC,RORECNT)=0
"RTN","RORUTL17",124,0)
 ;
"RTN","RORUTL17",125,0)
 ;--- Load the list of selection rules
"RTN","RORUTL17",126,0)
 I CPPL  S RC=$$LOADSRL(REGIEN,.RORSRL)  Q:RC<0 RC
"RTN","RORUTL17",127,0)
 ;
"RTN","RORUTL17",128,0)
 ;--- Examine registry records
"RTN","RORUTL17",129,0)
 W:SPI !,"Examining registry records",!
"RTN","RORUTL17",130,0)
 S NODE=$$ROOT^DILFD(798,,1)
"RTN","RORUTL17",131,0)
 S IEN=0
"RTN","RORUTL17",132,0)
 F  S IEN=$O(@NODE@("AC",REGIEN,IEN))  Q:IEN'>0  D
"RTN","RORUTL17",133,0)
 . W:SPI "."
"RTN","RORUTL17",134,0)
 . S COUNTS("NPT")=$G(COUNTS("NPT"))+1  ; Total number of patients
"RTN","RORUTL17",135,0)
 . ;--- Load the data
"RTN","RORUTL17",136,0)
 . S IENS=IEN_","  K RORBUF
"RTN","RORUTL17",137,0)
 . D GETS^DIQ(798,IENS,".01;3;9.1","I","RORBUF","RORMSG")
"RTN","RORUTL17",138,0)
 . I $G(DIERR)  D  S RORECNT=RORECNT+1  Q
"RTN","RORUTL17",139,0)
 . . D DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORUTL17",140,0)
 . S PTSTAT=+$G(RORBUF(798,IENS,3,"I"))
"RTN","RORUTL17",141,0)
 . ;--- Number of active patients
"RTN","RORUTL17",142,0)
 . D:$$ACTIVE^RORDD(IEN)
"RTN","RORUTL17",143,0)
 . . S COUNTS("NPA")=$G(COUNTS("NPA"))+1
"RTN","RORUTL17",144,0)
 . . S TMP=+$G(RORBUF(798,IENS,9.1,"I"))
"RTN","RORUTL17",145,0)
 . . I TMP>0  S:TMP<DTACKMIN DTACKMIN=TMP  S:TMP>DTACKMAX DTACKMAX=TMP
"RTN","RORUTL17",146,0)
 . ;--- Add a pending patient to the list
"RTN","RORUTL17",147,0)
 . I PTSTAT=4  D:CPPL  S COUNTS("NPP")=$G(COUNTS("NPP"))+1
"RTN","RORUTL17",148,0)
 . . S TMP=$$ADDPP(REGIEN,IEN,+RORBUF(798,IENS,.01,"I"))
"RTN","RORUTL17",149,0)
 ;
"RTN","RORUTL17",150,0)
 ;--- Count patients with errors
"RTN","RORUTL17",151,0)
 I FLAGS["E"  D  Q:RC<0 RC  S @ROR8DST@("NPE")=RC
"RTN","RORUTL17",152,0)
 . S RC=$$PTERR(REGIEN,SPI)
"RTN","RORUTL17",153,0)
 ;
"RTN","RORUTL17",154,0)
 ;--- Success
"RTN","RORUTL17",155,0)
 I DTACKMAX>0  D
"RTN","RORUTL17",156,0)
 . S @ROR8DST@("DTACKMIN")=DTACKMIN
"RTN","RORUTL17",157,0)
 . S @ROR8DST@("DTACKMAX")=DTACKMAX
"RTN","RORUTL17",158,0)
 E  F TMP="MIN","MAX"  S @ROR8DST@("DTACK"_TMP)=""
"RTN","RORUTL17",159,0)
 I CPPL  D:$G(COUNTS("NPP"))>0
"RTN","RORUTL17",160,0)
 . S RORBUF="",TMP=0
"RTN","RORUTL17",161,0)
 . F  S TMP=$O(RORSRL(TMP))  Q:TMP'>0  D
"RTN","RORUTL17",162,0)
 . . S $P(RORBUF,U,+RORSRL(TMP))=$P(RORSRL(TMP),U,2)
"RTN","RORUTL17",163,0)
 . S @ROR8DST@("PPL",0,1)=RORBUF
"RTN","RORUTL17",164,0)
 F TMP="NPA","NPP","NPT"  S @ROR8DST@(TMP)=+$G(COUNTS(TMP))
"RTN","RORUTL17",165,0)
 Q RORECNT
"RTN","RORUTL17",166,0)
 ;
"RTN","RORUTL17",167,0)
 ;***** E-MAILS THE INFORMATION ABOUT THE REGISTRY
"RTN","RORUTL17",168,0)
 ;
"RTN","RORUTL17",169,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL17",170,0)
 ;
"RTN","RORUTL17",171,0)
 ; [EMAIL]       E-mail address where the data will be sent to
"RTN","RORUTL17",172,0)
 ;
"RTN","RORUTL17",173,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL17",174,0)
 ;                 E  Count patients with errors in the
"RTN","RORUTL17",175,0)
 ;                    ROR PENDING PATIENT file
"RTN","RORUTL17",176,0)
 ;                 P  Include list of pending patients
"RTN","RORUTL17",177,0)
 ;                 S  Show the progress indicator
"RTN","RORUTL17",178,0)
 ;
"RTN","RORUTL17",179,0)
 ; The ^TMP("RORSETU3I",$J) and ^TMP("RORSETU3M",$J) global nodes are 
"RTN","RORUTL17",180,0)
 ; used by this function.
"RTN","RORUTL17",181,0)
 ;
"RTN","RORUTL17",182,0)
 ; Return Values:
"RTN","RORUTL17",183,0)
 ;       <0  Error code
"RTN","RORUTL17",184,0)
 ;        0  Ok
"RTN","RORUTL17",185,0)
 ;
"RTN","RORUTL17",186,0)
SENDINFO(REGIEN,EMAIL,FLAGS) ;
"RTN","RORUTL17",187,0)
 Q:'$$CCRNTFY^RORUTL05(REGIEN) 0
"RTN","RORUTL17",188,0)
 N DATE,IENS,INFO,MSGBUF,PARAMS,RC,RORBUF,RORMSG,TMP
"RTN","RORUTL17",189,0)
 S FLAGS=$G(FLAGS)
"RTN","RORUTL17",190,0)
 S INFO=$NA(^TMP("RORSETU3I",$J)),RC=0
"RTN","RORUTL17",191,0)
 S MSGBUF=$NA(^TMP("RORSETU3M",$J))
"RTN","RORUTL17",192,0)
 S PARAMS("DATE")=$$DATE($$DT^XLFDT)
"RTN","RORUTL17",193,0)
 ;
"RTN","RORUTL17",194,0)
 ;--- Gather the information
"RTN","RORUTL17",195,0)
 S RC=$$REGINFO(REGIEN,INFO,FLAGS)
"RTN","RORUTL17",196,0)
 ;
"RTN","RORUTL17",197,0)
 D:RC'<0
"RTN","RORUTL17",198,0)
 . N I,MBI,NF,PATIEN,XMCHAN,XMDUZ,XMLOC,XMSUB,XMTEXT,XMY,XMZ
"RTN","RORUTL17",199,0)
 . S IENS=REGIEN_","  K @MSGBUF
"RTN","RORUTL17",200,0)
 . ;
"RTN","RORUTL17",201,0)
 . ;--- Load the registry parameters
"RTN","RORUTL17",202,0)
 . D GETS^DIQ(798.1,IENS,".01;1;2;2.5;13.3","I","RORBUF","RORMSG")
"RTN","RORUTL17",203,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798.1,IENS)  Q
"RTN","RORUTL17",204,0)
 . I $G(EMAIL)=""  S EMAIL=$G(RORBUF(798.1,IENS,13.3,"I"))  Q:EMAIL=""
"RTN","RORUTL17",205,0)
 . ;
"RTN","RORUTL17",206,0)
 . ;--- Header of the message body
"RTN","RORUTL17",207,0)
 . S TMP=$$SITE^RORUTL03()
"RTN","RORUTL17",208,0)
 . S PARAMS("STNAME")=$P(TMP,U,2)
"RTN","RORUTL17",209,0)
 . S PARAMS("STNUM")=$P(TMP,U)
"RTN","RORUTL17",210,0)
 . ;---
"RTN","RORUTL17",211,0)
 . F I="DTACKMAX","DTACKMIN"  D
"RTN","RORUTL17",212,0)
 . . S PARAMS(I)=$$DATE(+$G(@INFO@(I)))
"RTN","RORUTL17",213,0)
 . F I="NPA","NPP","NPT"  D
"RTN","RORUTL17",214,0)
 . . S PARAMS(I)=+$G(@INFO@(I))
"RTN","RORUTL17",215,0)
 . ;---
"RTN","RORUTL17",216,0)
 . S PARAMS("REGISTRY")=$G(RORBUF(798.1,IENS,.01,"I"))
"RTN","RORUTL17",217,0)
 . S PARAMS("RETRIES")=+$G(RORBUF(798.1,IENS,2.5,"I"))
"RTN","RORUTL17",218,0)
 . S PARAMS("UPDATED_UNTIL")=$$DATE($G(RORBUF(798.1,IENS,1,"I")))
"RTN","RORUTL17",219,0)
 . S PARAMS("EXTRACTED_UNTIL")=$$DATE($G(RORBUF(798.1,IENS,2,"I")))
"RTN","RORUTL17",220,0)
 . D BLD^DIALOG(7980000.021,.PARAMS,,MSGBUF,"S")
"RTN","RORUTL17",221,0)
 . S MBI=+$O(@MSGBUF@(""),-1)
"RTN","RORUTL17",222,0)
 . ;
"RTN","RORUTL17",223,0)
 . ;--- Number of patients with errors
"RTN","RORUTL17",224,0)
 . D:FLAGS["E"
"RTN","RORUTL17",225,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="<NPE>"_$G(@INFO@("NPE"))_"</NPE>"
"RTN","RORUTL17",226,0)
 . ;
"RTN","RORUTL17",227,0)
 . ;--- List of pending patients
"RTN","RORUTL17",228,0)
 . D:FLAGS["P"
"RTN","RORUTL17",229,0)
 . . S RORBUF=$G(@INFO@("PPL",0,1))
"RTN","RORUTL17",230,0)
 . . F NF=1:1  Q:$P(RORBUF,U,NF)=""
"RTN","RORUTL17",231,0)
 . . S NF=NF-1
"RTN","RORUTL17",232,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="<PPLIST>"
"RTN","RORUTL17",233,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="CSSN,"_$TR(RORBUF,U,",")
"RTN","RORUTL17",234,0)
 . . S PATIEN=0
"RTN","RORUTL17",235,0)
 . . F  S PATIEN=$O(@INFO@("PPL",PATIEN))  Q:PATIEN'>0  D
"RTN","RORUTL17",236,0)
 . . . S RORBUF=$G(@INFO@("PPL",PATIEN,1))
"RTN","RORUTL17",237,0)
 . . . F I=1:1:NF  S $P(RORBUF,U,I)=$$DATE(+$P(RORBUF,U,I))
"RTN","RORUTL17",238,0)
 . . . S TMP=$P(@INFO@("PPL",PATIEN),U,2)
"RTN","RORUTL17",239,0)
 . . . S MBI=MBI+1,@MSGBUF@(MBI)=TMP_","_$TR(RORBUF,U,",")
"RTN","RORUTL17",240,0)
 . . S MBI=MBI+1,@MSGBUF@(MBI)="</PPLIST>"
"RTN","RORUTL17",241,0)
 . ;
"RTN","RORUTL17",242,0)
 . ;--- Footer of the message body
"RTN","RORUTL17",243,0)
 . D BLD^DIALOG(7980000.022,.PARAMS,,MSGBUF,"S")
"RTN","RORUTL17",244,0)
 . ;
"RTN","RORUTL17",245,0)
 . ;--- Send the message
"RTN","RORUTL17",246,0)
 . S XMDUZ=.5,XMY(EMAIL)=""
"RTN","RORUTL17",247,0)
 . S XMSUB="ROR: REGISTRY INFO"
"RTN","RORUTL17",248,0)
 . S XMTEXT=$$OREF^DILF(MSGBUF)
"RTN","RORUTL17",249,0)
 . D ^XMD
"RTN","RORUTL17",250,0)
 ;
"RTN","RORUTL17",251,0)
 ;--- Cleanup
"RTN","RORUTL17",252,0)
 K @INFO,@MSGBUF
"RTN","RORUTL17",253,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL18")
0^9^B650404
"RTN","RORUTL18",1,0)
RORUTL18 ;HCIOFO/SG - MISCELLANEOUS UTILITIES ; 4/19/04 9:41am
"RTN","RORUTL18",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**6**;May 14, 2002
"RTN","RORUTL18",3,0)
 ;
"RTN","RORUTL18",4,0)
 Q
"RTN","RORUTL18",5,0)
 ;
"RTN","RORUTL18",6,0)
 ;***** CHECKS FOR PENDING STATUS
"RTN","RORUTL18",7,0)
 ;
"RTN","RORUTL18",8,0)
 ; IEN           IEN of the registry record (in file #798)
"RTN","RORUTL18",9,0)
 ;
"RTN","RORUTL18",10,0)
 ; Return Values:
"RTN","RORUTL18",11,0)
 ;        0  Non-pending
"RTN","RORUTL18",12,0)
 ;        1  Pending patient
"RTN","RORUTL18",13,0)
 ;
"RTN","RORUTL18",14,0)
PENDING(IEN) ;
"RTN","RORUTL18",15,0)
 Q ($P($G(^RORDATA(798,+IEN,0)),U,5)=4)
"RTN","RORUTL18",16,0)
 ;
"RTN","RORUTL18",17,0)
 ;***** RETURNS THE CLINIC'S STOP CODE
"RTN","RORUTL18",18,0)
 ;
"RTN","RORUTL18",19,0)
 ; CLIEN         Clinic IEN
"RTN","RORUTL18",20,0)
 ;
"RTN","RORUTL18",21,0)
 ; Return Values:
"RTN","RORUTL18",22,0)
 ;       <0  Error code
"RTN","RORUTL18",23,0)
 ;       ""  No stop code
"RTN","RORUTL18",24,0)
 ;       >0  Stop code
"RTN","RORUTL18",25,0)
 ;
"RTN","RORUTL18",26,0)
STOPCODE(CLIEN) ;
"RTN","RORUTL18",27,0)
 N RORMSG,STOP
"RTN","RORUTL18",28,0)
 I CLIEN>0  D
"RTN","RORUTL18",29,0)
 . S STOP=$$GET1^DIQ(44,CLIEN_",","#8:#1","I",,"RORMSG")
"RTN","RORUTL18",30,0)
 . S:$G(DIERR) STOP=$$DBS^RORERR("RORMSG",-99,,,44,CLIEN_",")
"RTN","RORUTL18",31,0)
 E  S STOP=""
"RTN","RORUTL18",32,0)
 Q STOP
"RTN","RORX003")
0^2^B21906408
"RTN","RORX003",1,0)
RORX003 ;HCIOFO/SG - GENERAL UTLIZATION AND DEMOGRAPHICS ; 6/25/04 3:50pm
"RTN","RORX003",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORX003",3,0)
 ;
"RTN","RORX003",4,0)
 ;--------------------------------------------------------------------
"RTN","RORX003",5,0)
 ; Registry: [VA ICR]
"RTN","RORX003",6,0)
 ;--------------------------------------------------------------------
"RTN","RORX003",7,0)
 Q
"RTN","RORX003",8,0)
 ;
"RTN","RORX003",9,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX003",10,0)
 ;
"RTN","RORX003",11,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003",12,0)
 ;
"RTN","RORX003",13,0)
 ; Return Values:
"RTN","RORX003",14,0)
 ;       <0  Error code
"RTN","RORX003",15,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX003",16,0)
 ;
"RTN","RORX003",17,0)
HEADER(PARTAG) ;
"RTN","RORX003",18,0)
 N COLUMNS,HEADER,NAME,NOTES,TMP
"RTN","RORX003",19,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX003",20,0)
 Q:HEADER<0 HEADER
"RTN","RORX003",21,0)
 S NOTES=$$ADDVAL^RORTSK11(RORTSK,"NOTES",,HEADER)
"RTN","RORX003",22,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE_BASE_DATE",RORAGEDT,NOTES)
"RTN","RORX003",23,0)
 ;---
"RTN","RORX003",24,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX003",25,0)
 Q:COLUMNS<0 COLUMNS
"RTN","RORX003",26,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX003",27,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX003",28,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX003",29,0)
 S RORFL798=".01",RORFLICR=""
"RTN","RORX003",30,0)
 ;--- Required columns
"RTN","RORX003",31,0)
 F NAME="#","NAME","LAST4"  D
"RTN","RORX003",32,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",33,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",34,0)
 ;--- Additional columns
"RTN","RORX003",35,0)
 S:$D(RORFLDS("RACE")) RORFLDS("ETHN")=""
"RTN","RORX003",36,0)
 F NAME="RACE","ETHN","RISK","AGE","SEX","PRIMELIG","AIDSTAT","REIMBLVL","ENTDT","UTIL","ALIVE"  D
"RTN","RORX003",37,0)
 . Q:'$D(RORFLDS(NAME))
"RTN","RORX003",38,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",39,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",40,0)
 ;---
"RTN","RORX003",41,0)
 S:$D(RORFLDS("ENTDT")) RORFL798=RORFL798_";1"
"RTN","RORX003",42,0)
 Q HEADER
"RTN","RORX003",43,0)
 ;
"RTN","RORX003",44,0)
 ;***** COMPILES THE "GENERAL UTLIZATION AND DEMOGRAPHICS" REPORT
"RTN","RORX003",45,0)
 ; REPORT CODE: 003
"RTN","RORX003",46,0)
 ;
"RTN","RORX003",47,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX003",48,0)
 ;
"RTN","RORX003",49,0)
 ; The ^TMP("RORX003",$J) global node is used by this function.
"RTN","RORX003",50,0)
 ;
"RTN","RORX003",51,0)
 ; Return Values:
"RTN","RORX003",52,0)
 ;       <0  Error code
"RTN","RORX003",53,0)
 ;        0  Ok
"RTN","RORX003",54,0)
 ;
"RTN","RORX003",55,0)
UTLDMG(RORTSK) ;
"RTN","RORX003",56,0)
 N RORAGEDT      ; Base date for age calculations
"RTN","RORX003",57,0)
 N RORARV        ; Closed root of the ARV drug list
"RTN","RORX003",58,0)
 N RORDTE0       ; Beginning of the Date Entered "sliding window"
"RTN","RORX003",59,0)
 N ROREDT        ; End date
"RTN","RORX003",60,0)
 N RORFL798      ; Fields to load from the file #798
"RTN","RORX003",61,0)
 N RORFLDS       ; List of additional fields
"RTN","RORX003",62,0)
 N RORFLICR      ; Fields to load from the file #799.4
"RTN","RORX003",63,0)
 N RORMODE       ; Patient selection options
"RTN","RORX003",64,0)
 N ROROPT        ; Report options
"RTN","RORX003",65,0)
 N RORREG        ; Registry IEN
"RTN","RORX003",66,0)
 N RORRISK       ; Risk factor counters
"RTN","RORX003",67,0)
 N RORSDT        ; Start date
"RTN","RORX003",68,0)
 N RORSUM        ; Summary data
"RTN","RORX003",69,0)
 N RORUTIL       ; Utilization code counters
"RTN","RORX003",70,0)
 ;
"RTN","RORX003",71,0)
 N CNT,ECNT,IEN,IENS,PATIENTS,RC,REPORT,RORPTN,SFLAGS,TMP,XREFNODE
"RTN","RORX003",72,0)
 ;--- Root node of the report
"RTN","RORX003",73,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX003",74,0)
 Q:REPORT<0 REPORT
"RTN","RORX003",75,0)
 ;
"RTN","RORX003",76,0)
 ;--- Get and prepare the report parameters
"RTN","RORX003",77,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX003",78,0)
 S RC=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX003",79,0)
 Q:RC<0 RC
"RTN","RORX003",80,0)
 S RORMODE=$$PARAM^RORTSK01("PATIENTS")
"RTN","RORX003",81,0)
 D LIST^RORXU002(.RORMODE)
"RTN","RORX003",82,0)
 S ROROPT=$$PARAM^RORTSK01("OPTIONS")
"RTN","RORX003",83,0)
 D LIST^RORXU002(.ROROPT)
"RTN","RORX003",84,0)
 I '$D(ROROPT("SUMMARY"))  S RORFLDS=$$PARAM^RORTSK01("FIELDS")
"RTN","RORX003",85,0)
 E  S RORFLDS="RACE,RISK,AGE,SEX,REIMBLVL,UTIL"
"RTN","RORX003",86,0)
 D LIST^RORXU002(.RORFLDS)
"RTN","RORX003",87,0)
 ;
"RTN","RORX003",88,0)
 ;--- Initialize constants and variables
"RTN","RORX003",89,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX003",90,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",RORREG))
"RTN","RORX003",91,0)
 S ECNT=0,SFLAGS=SFLAGS_"DI"
"RTN","RORX003",92,0)
 S TMP=$$FMDIFF^XLFDT(ROREDT,RORSDT)
"RTN","RORX003",93,0)
 S RORAGEDT=$$FMADD^XLFDT(RORSDT,TMP\2)
"RTN","RORX003",94,0)
 S RORDTE0=$P($$FMTE^XLFDT(DT,7),"/")-10  ; 10 year "sliding window"
"RTN","RORX003",95,0)
 ;
"RTN","RORX003",96,0)
 ;--- Prepare the ARV drug list
"RTN","RORX003",97,0)
 S RORARV=$NA(^TMP("RORX003",$J))
"RTN","RORX003",98,0)
 S RC=$$DRUGLIST^RORUTL16(RORARV,+RORREG)  Q:RC<0 RC
"RTN","RORX003",99,0)
 ;
"RTN","RORX003",100,0)
 D
"RTN","RORX003",101,0)
 . ;--- Report header
"RTN","RORX003",102,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX003",103,0)
 . ;---
"RTN","RORX003",104,0)
 . S PATIENTS=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX003",105,0)
 . I PATIENTS<0  S RC=+PATIENTS  Q
"RTN","RORX003",106,0)
 . D ADDATTR^RORTSK11(RORTSK,PATIENTS,"TABLE","PATIENTS")
"RTN","RORX003",107,0)
 . ;
"RTN","RORX003",108,0)
 . D TPPSETUP^RORTSK01(97)
"RTN","RORX003",109,0)
 . ;--- Browse through the registry records
"RTN","RORX003",110,0)
 . S (CNT,IEN,RC)=0
"RTN","RORX003",111,0)
 . F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX003",112,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX003",113,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX003",114,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX003",115,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX003",116,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX003",117,0)
 . . ;--- Process the registry record
"RTN","RORX003",118,0)
 . . S TMP=$$PATIENT^RORX003A(IENS,PATIENTS)
"RTN","RORX003",119,0)
 . . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX003",120,0)
 . Q:RC<0
"RTN","RORX003",121,0)
 . ;
"RTN","RORX003",122,0)
 . ;--- Report summary
"RTN","RORX003",123,0)
 . D TPPSETUP^RORTSK01(3)
"RTN","RORX003",124,0)
 . S RC=$$SUMMARY^RORX003A(REPORT,PATIENTS)  Q:RC<0
"RTN","RORX003",125,0)
 . ;
"RTN","RORX003",126,0)
 . ;--- Summary only
"RTN","RORX003",127,0)
 . D:'$D(ROROPT("COMPLETE")) UPDVAL^RORTSK11(RORTSK,PATIENTS,,,1)
"RTN","RORX003",128,0)
 ;
"RTN","RORX003",129,0)
 ;--- Cleanup
"RTN","RORX003",130,0)
 K ^TMP("RORX003",$J)
"RTN","RORX003",131,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX003A")
0^3^B48035338
"RTN","RORX003A",1,0)
RORX003A ;HCIOFO/SG - GENERAL UTLIZATION AND DEMOGRAPHICS ; 6/25/04 3:44pm
"RTN","RORX003A",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,6**;May 14, 2002
"RTN","RORX003A",3,0)
 ;
"RTN","RORX003A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX003A",5,0)
 ;
"RTN","RORX003A",6,0)
 ; #10061        2^VADPT (supported)
"RTN","RORX003A",7,0)
 ;
"RTN","RORX003A",8,0)
 Q
"RTN","RORX003A",9,0)
 ;
"RTN","RORX003A",10,0)
 ;***** INCREMENTS SUMMARY COUNTER
"RTN","RORX003A",11,0)
INCSUM(SUMMARY,VAL) ;
"RTN","RORX003A",12,0)
 S:$G(VAL)="" VAL="NO DATA"
"RTN","RORX003A",13,0)
 S RORSUM(SUMMARY,VAL)=$G(RORSUM(SUMMARY,VAL))+1
"RTN","RORX003A",14,0)
 Q
"RTN","RORX003A",15,0)
 ;
"RTN","RORX003A",16,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX003A",17,0)
 ;
"RTN","RORX003A",18,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX003A",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",20,0)
 ;
"RTN","RORX003A",21,0)
 ; Return Values:
"RTN","RORX003A",22,0)
 ;       <0  Error code
"RTN","RORX003A",23,0)
 ;        0  Ok
"RTN","RORX003A",24,0)
 ;       >0  Skip the patient
"RTN","RORX003A",25,0)
 ;
"RTN","RORX003A",26,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX003A",27,0)
 N CLINAIDS,DFN,IEN,NAME,RC,RORBUF,RORMSG,TMP,UTIL,VA,VADM,VAERR,VAHOW,VAPTYP,VAROOT
"RTN","RORX003A",28,0)
 S RC=0
"RTN","RORX003A",29,0)
 ;
"RTN","RORX003A",30,0)
 ;--- Check the clinical status
"RTN","RORX003A",31,0)
 S CLINAIDS=$$CLINAIDS^RORICRUT(+IENS,ROREDT)
"RTN","RORX003A",32,0)
 Q:'$D(RORMODE($S(CLINAIDS:"AIDS",1:"HIV"))) 1
"RTN","RORX003A",33,0)
 ;
"RTN","RORX003A",34,0)
 ;--- Get the data from the ROR LOCAL REGISTRY file
"RTN","RORX003A",35,0)
 I $G(RORFL798)'=""  D  Q:RC<0 RC
"RTN","RORX003A",36,0)
 . D GETS^DIQ(798,IENS,RORFL798,"I","RORBUF","RORMSG")
"RTN","RORX003A",37,0)
 . I $G(DIERR)  S RC=$$DBS^RORERR("RORMSG",-9,,,798,IENS)  Q
"RTN","RORX003A",38,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",39,0)
 ;
"RTN","RORX003A",40,0)
 ;--- Skip a patient without utilization
"RTN","RORX003A",41,0)
 S UTIL("ALL")=1
"RTN","RORX003A",42,0)
 S UTIL=$$UTIL^RORXU003(RORSDT,ROREDT,DFN,.UTIL)
"RTN","RORX003A",43,0)
 Q:'UTIL 1
"RTN","RORX003A",44,0)
 ;
"RTN","RORX003A",45,0)
 ;--- Get the data from the ROR ICR STUDY file
"RTN","RORX003A",46,0)
 I $G(RORFLICR)'=""  D  Q:RC<0 RC
"RTN","RORX003A",47,0)
 . D GETS^DIQ(799.4,IENS,RORFLICR,"I","RORBUF","RORMSG")
"RTN","RORX003A",48,0)
 . I $G(DIERR),'$D(RORMSG("DIERR","E",601))  D  Q
"RTN","RORX003A",49,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORX003A",50,0)
 ;--- Load the demographic data
"RTN","RORX003A",51,0)
 D 2^VADPT
"RTN","RORX003A",52,0)
 ;
"RTN","RORX003A",53,0)
 ;--- The <PATIENT> tag
"RTN","RORX003A",54,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX003A",55,0)
 Q:PTAG<0 PTAG  S RORSUM=$G(RORSUM)+1
"RTN","RORX003A",56,0)
 ;--- Patient Name
"RTN","RORX003A",57,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX003A",58,0)
 ;--- last 4 digits of the SSN
"RTN","RORX003A",59,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX003A",60,0)
 ;
"RTN","RORX003A",61,0)
 ;--- Race
"RTN","RORX003A",62,0)
 D:$D(RORFLDS("RACE"))
"RTN","RORX003A",63,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",64,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"RACES",,PTAG)
"RTN","RORX003A",65,0)
 . I $G(VADM(12))>0  S I=""  D
"RTN","RORX003A",66,0)
 . . F  S I=$O(VADM(12,I))  Q:I=""  D
"RTN","RORX003A",67,0)
 . . . S SUMVAL=$P(VADM(12,I),U,2)
"RTN","RORX003A",68,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"RACE",SUMVAL,TABLE)
"RTN","RORX003A",69,0)
 . . S:VADM(12)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",70,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"RACE",,TABLE)
"RTN","RORX003A",71,0)
 . D INCSUM("RACE",$G(SUMVAL))
"RTN","RORX003A",72,0)
 ;
"RTN","RORX003A",73,0)
 ;--- Ethnicity
"RTN","RORX003A",74,0)
 D:$D(RORFLDS("RACE"))
"RTN","RORX003A",75,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",76,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ETHNS",,PTAG)
"RTN","RORX003A",77,0)
 . I $G(VADM(11))>0  S I=""  D
"RTN","RORX003A",78,0)
 . . F  S I=$O(VADM(11,I))  Q:I=""  D
"RTN","RORX003A",79,0)
 . . . S SUMVAL=$P(VADM(11,I),U,2)
"RTN","RORX003A",80,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ETHN",SUMVAL,TABLE)
"RTN","RORX003A",81,0)
 . . S:VADM(11)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",82,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"ETHN",,TABLE)
"RTN","RORX003A",83,0)
 . D INCSUM("ETHN",$G(SUMVAL))
"RTN","RORX003A",84,0)
 ;
"RTN","RORX003A",85,0)
 ;--- Risk factors
"RTN","RORX003A",86,0)
 D:$D(RORFLDS("RISK"))
"RTN","RORX003A",87,0)
 . N I,RISKS
"RTN","RORX003A",88,0)
 . S RISKS=$$RISKS^RORXU005(+IENS)  S:RISKS<0 RISKS=""
"RTN","RORX003A",89,0)
 . D ADDVAL^RORTSK11(RORTSK,"RISK",RISKS,PTAG)
"RTN","RORX003A",90,0)
 . S RISKS=$TR(RISKS," ")
"RTN","RORX003A",91,0)
 . F I=1:1  S TMP=$P(RISKS,",",I)  Q:TMP'>0  D
"RTN","RORX003A",92,0)
 . . S RORRISK(TMP)=$G(RORRISK(TMP))+1
"RTN","RORX003A",93,0)
 ;
"RTN","RORX003A",94,0)
 ;--- Age
"RTN","RORX003A",95,0)
 D:$D(RORFLDS("AGE"))
"RTN","RORX003A",96,0)
 . S TMP=+$G(VADM(6))  ; Date of Death
"RTN","RORX003A",97,0)
 . S TMP=$S(TMP'>0:RORAGEDT,TMP<RORAGEDT:TMP,1:RORAGEDT)
"RTN","RORX003A",98,0)
 . S TMP=$$FMDIFF^XLFDT(TMP,+VADM(3))\365
"RTN","RORX003A",99,0)
 . D ADDVAL^RORTSK11(RORTSK,"AGE",$S(TMP>0:TMP,1:""),PTAG,1)
"RTN","RORX003A",100,0)
 . Q:TMP'>0
"RTN","RORX003A",101,0)
 . S RORSUM("AGE")=$G(RORSUM("AGE"))+1
"RTN","RORX003A",102,0)
 . S RORSUM("AGE","Average")=$G(RORSUM("AGE","Average"))+TMP
"RTN","RORX003A",103,0)
 . D INCSUM("AGE",TMP-(TMP#10))
"RTN","RORX003A",104,0)
 ;
"RTN","RORX003A",105,0)
 ;--- Sex
"RTN","RORX003A",106,0)
 D:$D(RORFLDS("SEX"))
"RTN","RORX003A",107,0)
 . S TMP=$P(VADM(5),U,2)
"RTN","RORX003A",108,0)
 . D ADDVAL^RORTSK11(RORTSK,"SEX",TMP,PTAG,1)
"RTN","RORX003A",109,0)
 . D INCSUM("SEX",TMP)
"RTN","RORX003A",110,0)
 ;
"RTN","RORX003A",111,0)
 ;--- Primary eligibility
"RTN","RORX003A",112,0)
 D:$D(RORFLDS("PRIMELIG"))
"RTN","RORX003A",113,0)
 . S TMP=$P(VAEL(1),U,2)
"RTN","RORX003A",114,0)
 . D ADDVAL^RORTSK11(RORTSK,"PRIMELIG",TMP,PTAG,1)
"RTN","RORX003A",115,0)
 . D INCSUM("PRIMELIG",TMP)
"RTN","RORX003A",116,0)
 ;
"RTN","RORX003A",117,0)
 ;--- Clinical AIDS status
"RTN","RORX003A",118,0)
 D:$D(RORFLDS("AIDSTAT"))
"RTN","RORX003A",119,0)
 . D ADDVAL^RORTSK11(RORTSK,"AIDSTAT",+CLINAIDS,PTAG,1)
"RTN","RORX003A",120,0)
 . D INCSUM("AIDS",$S(+CLINAIDS:"AIDS OI",1:"HIV+ (NO AIDS OI)"))
"RTN","RORX003A",121,0)
 ;
"RTN","RORX003A",122,0)
 ;--- Reimbursement level
"RTN","RORX003A",123,0)
 D:$D(RORFLDS("REIMBLVL"))
"RTN","RORX003A",124,0)
 . S TMP=$$REIMBLVL^RORXU005(+IENS,RORARV,RORSDT,ROREDT)
"RTN","RORX003A",125,0)
 . S TMP=$S(TMP=30:"AIDS+ARV",TMP=20:"AIDS",TMP=10:"ARV",'TMP:"NOARV",1:"")
"RTN","RORX003A",126,0)
 . D ADDVAL^RORTSK11(RORTSK,"REIMBLVL",TMP,PTAG,1)
"RTN","RORX003A",127,0)
 . D INCSUM("REIMBLVL",TMP)
"RTN","RORX003A",128,0)
 ;
"RTN","RORX003A",129,0)
 ;--- Date Entered into the Registry
"RTN","RORX003A",130,0)
 D:$D(RORFLDS("ENTDT"))
"RTN","RORX003A",131,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,1,"I"))\1)
"RTN","RORX003A",132,0)
 . D ADDVAL^RORTSK11(RORTSK,"ENTDT",TMP,PTAG,1)
"RTN","RORX003A",133,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",134,0)
 . D INCSUM("ENTDT",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",135,0)
 ;
"RTN","RORX003A",136,0)
 ;--- Utilization
"RTN","RORX003A",137,0)
 D:$D(RORFLDS("UTIL"))
"RTN","RORX003A",138,0)
 . S TMP=$$UTLCODES($P(UTIL,U,2,999))
"RTN","RORX003A",139,0)
 . D ADDVAL^RORTSK11(RORTSK,"UTIL",TMP,PTAG)
"RTN","RORX003A",140,0)
 ;
"RTN","RORX003A",141,0)
 ;--- Alive?
"RTN","RORX003A",142,0)
 D:$D(RORFLDS("ALIVE"))
"RTN","RORX003A",143,0)
 . S TMP=VADM(6)\1,TMP=$S(TMP>0:TMP>ROREDT,1:1)
"RTN","RORX003A",144,0)
 . D INCSUM("ALIVE",$S(TMP:"ALIVE",1:"DECEASED"))
"RTN","RORX003A",145,0)
 . S TMP=$S(TMP:"",1:VADM(6)\1)
"RTN","RORX003A",146,0)
 . D ADDVAL^RORTSK11(RORTSK,"ALIVE",TMP,PTAG,1)
"RTN","RORX003A",147,0)
 Q 0
"RTN","RORX003A",148,0)
 ;
"RTN","RORX003A",149,0)
 ;***** GENERATES THE REPORT SUMMARY
"RTN","RORX003A",150,0)
 ;
"RTN","RORX003A",151,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",152,0)
 ;
"RTN","RORX003A",153,0)
 ; PATIENTS      Reference (IEN) to the PATIENTS tag
"RTN","RORX003A",154,0)
 ;
"RTN","RORX003A",155,0)
 ; Return Values:
"RTN","RORX003A",156,0)
 ;       <0  Error code
"RTN","RORX003A",157,0)
 ;        0  Ok
"RTN","RORX003A",158,0)
 ;
"RTN","RORX003A",159,0)
SUMMARY(PARTAG,PATIENTS) ;
"RTN","RORX003A",160,0)
 N AGE,I,RC,RORBUF,SI,SUMMARY,TABLE,TAG,TMP
"RTN","RORX003A",161,0)
 S SUMMARY=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,PARTAG)
"RTN","RORX003A",162,0)
 Q:SUMMARY<0 SUMMARY
"RTN","RORX003A",163,0)
 ;
"RTN","RORX003A",164,0)
 ;--- Risk factors
"RTN","RORX003A",165,0)
 D:$D(RORRISK)>1
"RTN","RORX003A",166,0)
 . K RORBUF  D BLD^DIALOG(7980000.016,.RORRISK,,"RORBUF")
"RTN","RORX003A",167,0)
 . D ADDTEXT^RORTSK11(RORTSK,"RISK_FACTORS",.RORBUF,SUMMARY)
"RTN","RORX003A",168,0)
 ;
"RTN","RORX003A",169,0)
 ;--- Simple summaries
"RTN","RORX003A",170,0)
 F SI="RACE","ETHN","SEX","PRIMELIG","AIDS","REIMBLVL","ALIVE"  D:$D(RORSUM(SI))>1
"RTN","RORX003A",171,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,SI_"_SUMMARY",,SUMMARY)
"RTN","RORX003A",172,0)
 . S I=""
"RTN","RORX003A",173,0)
 . F  S I=$O(RORSUM(SI,I))  Q:I=""  D
"RTN","RORX003A",174,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,I,TABLE)
"RTN","RORX003A",175,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,I))
"RTN","RORX003A",176,0)
 ;
"RTN","RORX003A",177,0)
 ;--- Date Entered summary
"RTN","RORX003A",178,0)
 D:$D(RORSUM("ENTDT"))>1
"RTN","RORX003A",179,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ENTDT_SUMMARY",,SUMMARY)
"RTN","RORX003A",180,0)
 . D:$G(RORSUM("ENTDT",0))>0
"RTN","RORX003A",181,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,"ENTDT","Before "_RORDTE0,TABLE)
"RTN","RORX003A",182,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM("ENTDT",0))
"RTN","RORX003A",183,0)
 . S I=0
"RTN","RORX003A",184,0)
 . F  S I=$O(RORSUM("ENTDT",I))  Q:I=""  D
"RTN","RORX003A",185,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,"ENTDT",I,TABLE)
"RTN","RORX003A",186,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM("ENTDT",I))
"RTN","RORX003A",187,0)
 ;
"RTN","RORX003A",188,0)
 ;--- Age summary
"RTN","RORX003A",189,0)
 I $G(RORSUM("AGE"))>0  D
"RTN","RORX003A",190,0)
 . ;--- Average age
"RTN","RORX003A",191,0)
 . S TMP=$G(RORSUM("AGE","Average"))/RORSUM("AGE")
"RTN","RORX003A",192,0)
 . S RORSUM("AGE","Average")=$J(TMP,0,2)
"RTN","RORX003A",193,0)
 . ;--- Median age
"RTN","RORX003A",194,0)
 . S TMP=$$XREFNODE^RORTSK10(RORTSK,PATIENTS,"AGE")
"RTN","RORX003A",195,0)
 . S:TMP'="" TMP=$$XREFMDNV^RORXU004(TMP,RORSUM("AGE"))
"RTN","RORX003A",196,0)
 . S RORSUM("AGE","Median")=$S(TMP'="":$J(TMP,0,2),1:"")
"RTN","RORX003A",197,0)
 . ;--- Output the table
"RTN","RORX003A",198,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"AGE_SUMMARY",,SUMMARY)
"RTN","RORX003A",199,0)
 . S I=""
"RTN","RORX003A",200,0)
 . F  S I=$O(RORSUM("AGE",I))  Q:I=""  D
"RTN","RORX003A",201,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,"AGE",$S(+I=I:I_"+",1:I),TABLE)
"RTN","RORX003A",202,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM("AGE",I))
"RTN","RORX003A",203,0)
 ;
"RTN","RORX003A",204,0)
 ;--- Utilization codes
"RTN","RORX003A",205,0)
 D:$D(RORUTIL)>1
"RTN","RORX003A",206,0)
 . K RORBUF  D BLD^DIALOG(7980000.017,.RORUTIL,,"RORBUF")
"RTN","RORX003A",207,0)
 . D ADDTEXT^RORTSK11(RORTSK,"UTIL_CODES",.RORBUF,SUMMARY)
"RTN","RORX003A",208,0)
 ;---
"RTN","RORX003A",209,0)
 Q 0
"RTN","RORX003A",210,0)
 ;
"RTN","RORX003A",211,0)
 ;***** PROCESSES UTILIZATION CODES
"RTN","RORX003A",212,0)
UTLCODES(UCSRC) ;
"RTN","RORX003A",213,0)
 N I,UCLST  S UCLST=""
"RTN","RORX003A",214,0)
 F I=1:1  S UC=$P(UCSRC,U,I)  Q:UC=""  D
"RTN","RORX003A",215,0)
 . S UCLST=UCLST_", "_UC,RORUTIL(UC)=$G(RORUTIL(UC))+1
"RTN","RORX003A",216,0)
 Q $P(UCLST,", ",2,999)
"TEMP","RORCDCDEF",1)

"TEMP","RORCDCDEF",2)
edt1_1=^^548^87^32^^49^^^^1^^^^^^Name
"TEMP","RORCDCDEF",3)
edt1_3=^^246^178^22^^49^^^^1^ADR^3^^13^^Address
"TEMP","RORCDCDEF",4)
edt1_4=^^1083^178^22^^49^^^^1^ADR^6^^13^^City
"TEMP","RORCDCDEF",5)
edt1_5=^^1512^178^22^^49^^^^1^ADR^12^^13^^County
"TEMP","RORCDCDEF",6)
edt1_6=^^2205^178^22^^49^^^^1^ADR^9^^13^^ZIP
"TEMP","RORCDCDEF",7)
cmbb1_1=^^1872^176^24^^49^^^^1^ADR^8^^13^^
"TEMP","RORCDCDEF",8)
edt1_2=^^2020^108^22^^49^^^^1^ADR^13^^13^^Phone
"TEMP","RORCDCDEF",9)
edt1_7=^^1872^178^22^^49^^^^1^ADR^^^^^State
"TEMP","RORCDCDEF",10)
dtp2_1=^^161^567^30^MMDDYY^49^117^^^1^HDR^3^^6^^Date form was Completed
"TEMP","RORCDCDEF",11)
edt2_1=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",12)
edt2_2=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",13)
edt2_3=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",14)
edt2_4=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",15)
edt2_5=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",16)
edt2_6=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",17)
chkb2_1=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",18)
chkb2_2=^^^^32^^49^^^^1^^^^^^
"TEMP","RORCDCDEF",19)
edt3_3_1=^^1985^871^22^^49^^^^1^CDM^6^^8^^Territory of death
"TEMP","RORCDCDEF",20)
chkb3_3_1=^^1301^910^25^^49^^^^1^CDM^1^^14^^Current Status Alive
"TEMP","RORCDCDEF",21)
chkb3_3_2=^^1393^910^25^^49^^^^1^CDM^2^^14^^Current Status Dead
"TEMP","RORCDCDEF",22)
chkb3_3_3=^^1485^910^25^^49^^^^1^CDM^9^^14^^Current Status Unk
"TEMP","RORCDCDEF",23)
edt3_3_2=^^1607^902^30^MMDDYY^58^116^^^1^DEM^7^^14^^Date of Death
"TEMP","RORCDCDEF",24)
edt3_2_1=^^885^902^30^MMDDYY^58^115^^^1^DEM^5^^8^^Date of Birth
"TEMP","RORCDCDEF",25)
edt3_1_2=^^574^910^30^BoxedLine^54^2^^^1^CDM^4^^14^^AIDS age
"TEMP","RORCDCDEF",26)
chkb3_1_1=^^126^868^25^^49^^^^1^CDM^3^1^14^^Diagnostic status HIV
"TEMP","RORCDCDEF",27)
chkb3_1_2=^^126^923^25^^49^^^^1^CDM^3^2^14^^Diagnostic status AIDS
"TEMP","RORCDCDEF",28)
edt3_1_1=^^574^848^30^BoxedLine^54^2^^^1^CDM^4^^14^^HIV Age
"TEMP","RORCDCDEF",29)
chkb3_5_1=^^355^1040^25^^49^^^^1^ETN^3^2135-2^6^^Ethnicity Hispanic
"TEMP","RORCDCDEF",30)
chkb3_5_2=^^543^1039^25^^49^^^^1^ETN^3^2186-5^6^^Ethnicity Unk
"TEMP","RORCDCDEF",31)
chkb3_5_3=^^355^1101^25^^49^^^^1^ETN^3^9999-4^6^^Ethnicity Not Hispanic
"TEMP","RORCDCDEF",32)
chkb3_4_1=^^127^1040^25^^49^^^^1^DEM^8^M^8^^Sex Male
"TEMP","RORCDCDEF",33)
chkb3_4_2=^^126^1106^25^^49^^^^1^DEM^8^F^8^^Sex Female
"TEMP","RORCDCDEF",34)
chkb3_6_1=^^730^1039^25^^49^^^^1^RCE^3^1002-5^6^^Race American
"TEMP","RORCDCDEF",35)
chkb3_6_2=^^730^1118^25^^49^^^^1^RCE^3^2028-9^6^^Race Asian
"TEMP","RORCDCDEF",36)
chkb3_6_4=^^864^1119^25^^49^^^^1^RCE^3^2054-5^6^^Race Hawaiian
"TEMP","RORCDCDEF",37)
chkb3_6_3=^^1001^1039^25^^49^^^^1^RCE^3^2076-8^6^^Race Black Am
"TEMP","RORCDCDEF",38)
chkb3_6_6=^^1334^1115^25^^49^^^^1^RCE^3^2106-3^6^^Race Unkn.
"TEMP","RORCDCDEF",39)
chkb3_6_5=^^1189^1114^25^^49^^^^1^RCE^3^9999-4^6^^Race White
"TEMP","RORCDCDEF",40)
chkb3_7_1=^^1501^1019^25^^49^^^^1^CDM^7^1^14^^Country of Birth USA
"TEMP","RORCDCDEF",41)
chkb3_7_2=^^1643^1018^25^^49^^^^1^CDM^7^7^14^^Country of Birth US Depend
"TEMP","RORCDCDEF",42)
chkb3_7_4=^^2339^1123^25^^49^^^^1^CDM^7^9^14^^Country of Birth Unk.
"TEMP","RORCDCDEF",43)
edt3_7_1=^^1811^1065^22^^49^^^^1^CDM^8^^14^^Country of Birth USA Dep Name
"TEMP","RORCDCDEF",44)
chkb3_7_3=^^1501^1119^25^^49^^^^1^CDM^7^8^14^^Country of Birth Other
"TEMP","RORCDCDEF",45)
edt3_7_2=^^1765^1122^22^^49^^^^1^CDM^8^^14^^Country of Birth Other Name
"TEMP","RORCDCDEF",46)
edt3_8_2=^^864^1234^22^^49^^^^1^CDM^10^^14^^Residence County
"TEMP","RORCDCDEF",47)
edt3_8_1=^^214^1234^22^^49^^^^1^CDM^9^^14^^Residence City
"TEMP","RORCDCDEF",48)
edt3_8_4=^^1974^1215^30^BoxedLine^49^9^^^1^CDM^14^^14^ZIP^Residence ZIP
"TEMP","RORCDCDEF",49)
edt3_8_5=^^1383^1234^22^^49^^^^1^CDM^13^^14^^Residence Country
"TEMP","RORCDCDEF",50)
cmbb3_8_1=^^^^39^^49^^^^1^CDM^14^^14^ZIP^
"TEMP","RORCDCDEF",51)
chkb4_3_1=^^130^1806^25^^49^^^^1^FD^9^01^10^^Diagnostic Facility Type Physitcan, HMO
"TEMP","RORCDCDEF",52)
chkb4_3_2=^^484^1806^25^^49^^^^1^FD^9^31^10^^Diagnostic Facility Type Inpatient
"TEMP","RORCDCDEF",53)
chkb4_3_3=^^129^1865^25^^49^^^^1^FD^9^88^10^^Diagnostic Facility Type Other
"TEMP","RORCDCDEF",54)
edt4_3_1=^^397^1859^22^^49^^^^1^FD^10^^10^^Diagnostic Facility Type Other Name
"TEMP","RORCDCDEF",55)
chkb4_2_1=^^130^1694^25^^49^^^^1^FD^8^1^10^^Diagnostic Facility Setting Public
"TEMP","RORCDCDEF",56)
chkb4_2_2=^^339^1694^25^^49^^^^1^FD^8^2^10^^Diagnostic Facility Setting Private
"TEMP","RORCDCDEF",57)
chkb4_2_3=^^551^1694^25^^49^^^^1^FD^8^3^10^^Diagnostic Facility Setting  Federal
"TEMP","RORCDCDEF",58)
chkb4_2_4=^^772^1694^25^^49^^^^1^FD^8^9^10^^Diagnostic Facility Setting Unk
"TEMP","RORCDCDEF",59)
edt4_1_1=^^125^1402^22^^49^^^^1^FD^3^^10^^Diagnostic Facility Name
"TEMP","RORCDCDEF",60)
edt4_1_2=^^125^1474^22^^49^^^^1^FD^4^^10^^Diagnostic Facility City
"TEMP","RORCDCDEF",61)
edt4_1_4=^^125^1550^22^^49^^^^1^FD^7^^10^^Facility Country
"TEMP","RORCDCDEF",62)
cmbb4_1_1=^^125^1550^22^^49^^^^1^FD^6^^10^^Diagnostic Facility Setting  State
"TEMP","RORCDCDEF",63)
chkb5_14_1=^^2228^2209^24^^49^^^^1^PH^19^1^20^^Work in Clinical Lab Yes
"TEMP","RORCDCDEF",64)
chkb5_14_2=^^2316^2209^24^^49^^^^1^PH^19^0^20^^Work in Clinical Lab No
"TEMP","RORCDCDEF",65)
chkb5_14_3=^^2399^2209^24^^49^^^^1^PH^19^9^20^^Work in Clinical Lab Unk.
"TEMP","RORCDCDEF",66)
edt5_14_1=^^1420^2257^22^^49^^^^1^PH^20^^20^^Work in Clinical Lab Name
"TEMP","RORCDCDEF",67)
chkb5_12_1=^^2228^2163^24^^49^^^^1^PH^18^1^20^^Received Transpalnt Yes
"TEMP","RORCDCDEF",68)
chkb5_12_2=^^2316^2163^24^^49^^^^1^PH^18^0^20^^Received Transpalnt No
"TEMP","RORCDCDEF",69)
chkb5_12_3=^^2398^2163^24^^49^^^^1^PH^18^9^20^^Received Transpalnt Unk
"TEMP","RORCDCDEF",70)
chkb5_11_1=^^2228^2038^24^^49^^^^1^PH^15^1^20^^Received Transfusion Yes
"TEMP","RORCDCDEF",71)
chkb5_11_2=^^2316^2038^24^^49^^^^1^PH^15^0^20^^Received Transfusion No
"TEMP","RORCDCDEF",72)
chkb5_11_3=^^2399^2038^24^^49^^^^1^PH^15^9^20^^Received Transfusion Unk
"TEMP","RORCDCDEF",73)
edV_FirstYear=^^1357^2107^30^MMYY^50^170^^^1^PH^16^^20^MM/YY^Received Transfusion First
"TEMP","RORCDCDEF",74)
edV_LastYear=^^1766^2107^30^MMYY^50^170^^^1^PH^17^^20^MM/YY^Received Transfusion Last
"TEMP","RORCDCDEF",75)
chkb5_10_1=^^2228^1992^24^^49^^^^1^PH^14^1^20^^Hetero SR with Person with AIDS Yes
"TEMP","RORCDCDEF",76)
chkb5_10_2=^^2316^1992^24^^49^^^^1^PH^14^0^20^^Hetero SR with Person with AIDS No
"TEMP","RORCDCDEF",77)
chkb5_10_3=^^2398^1992^24^^49^^^^1^PH^14^9^20^^Hetero SR with Person with AIDS Unk.
"TEMP","RORCDCDEF",78)
chkb5_9_1=^^2228^1946^25^^49^^^^1^PH^13^1^20^^Hetero SR with Transplant recepient Yes
"TEMP","RORCDCDEF",79)
chkb5_9_2=^^2315^1946^25^^49^^^^1^PH^13^0^20^^Hetero SR with Transplant recepient No
"TEMP","RORCDCDEF",80)
chkb5_9_3=^^2398^1946^25^^49^^^^1^PH^13^9^20^^Hetero SR with Transplant recepient Unk
"TEMP","RORCDCDEF",81)
chkb5_8_1=^^2228^1901^24^^49^^^^1^PH^12^1^20^^Hetero SR with Transfusion recepient Yes
"TEMP","RORCDCDEF",82)
chkb5_8_2=^^2316^1901^24^^49^^^^1^PH^12^0^20^^Hetero SR with Transfusion recepient No
"TEMP","RORCDCDEF",83)
chkb5_8_3=^^2399^1901^24^^49^^^^1^PH^12^9^20^^Hetero SR with Transfusion recepient Unk
"TEMP","RORCDCDEF",84)
chkb5_7_1=^^2228^1855^24^^49^^^^1^PH^11^1^20^^Hetero SR with Hemofilia Yes
"TEMP","RORCDCDEF",85)
chkb5_7_2=^^2316^1855^24^^49^^^^1^PH^11^0^20^^Hetero SR with Hemofilia  No
"TEMP","RORCDCDEF",86)
chkb5_7_3=^^2398^1855^24^^49^^^^1^PH^11^9^20^^Hetero SR with Hemofilia Unk
"TEMP","RORCDCDEF",87)
chkb5_6_1=^^2228^1809^24^^49^^^^1^PH^9^1^20^^Hetero SR with Bisexual  male Yes
"TEMP","RORCDCDEF",88)
chkb5_6_2=^^2316^1809^24^^49^^^^1^PH^9^0^20^^Hetero SR with Bisexual  male No
"TEMP","RORCDCDEF",89)
chkb5_6_3=^^2398^1809^24^^49^^^^1^PH^9^9^20^^Hetero SR with Bisexual  male Unk
"TEMP","RORCDCDEF",90)
chkb5_5_1=^^2228^1763^24^^49^^^^1^PH^10^1^20^^Hetero SR with Intravenoue Yes
"TEMP","RORCDCDEF",91)
chkb5_5_2=^^2316^1763^24^^49^^^^1^PH^10^0^20^^Hetero SR with Intravenoue No
"TEMP","RORCDCDEF",92)
chkb5_5_3=^^2398^1763^24^^49^^^^1^PH^10^9^20^^Hetero SR with Intravenoue Unk
"TEMP","RORCDCDEF",93)
chkb5_4_1=^^2228^1601^24^^49^^^^1^PH^6^1^20^^Receiving Clotting Factor  Yes
"TEMP","RORCDCDEF",94)
chkb5_4_2=^^2316^1601^24^^49^^^^1^PH^6^0^20^^Receiving Clotting Factor  No
"TEMP","RORCDCDEF",95)
chkb5_4_3=^^2399^1601^24^^49^^^^1^PH^6^9^20^^Receiving Clotting Factor  Unk
"TEMP","RORCDCDEF",96)
chkb5_4_4=^^1167^1642^27^^49^^^^1^PH^7^1^20^^Receiving Clotting Factor VIII
"TEMP","RORCDCDEF",97)
chkb5_4_5=^^1429^1642^27^^49^^^^1^PH^7^2^20^^Receiving Clotting Factor IX
"TEMP","RORCDCDEF",98)
chkb5_4_6=^^1708^1642^27^^49^^^^1^PH^7^8^20^^Receiving Clotting Factor  Other
"TEMP","RORCDCDEF",99)
edt5_4_1=^^1901^1672^22^^49^^^^1^PH^8^^20^^Receiving Clotting Factor  Other Name
"TEMP","RORCDCDEF",100)
chkb5_3_1=^^2228^1555^24^^49^^^^1^PH^5^1^20^^Injected Drug Yes
"TEMP","RORCDCDEF",101)
chkb5_3_2=^^2316^1555^24^^49^^^^1^PH^5^0^20^^Injected Drug No
"TEMP","RORCDCDEF",102)
chkb5_3_3=^^2398^1555^24^^49^^^^1^PH^5^9^20^^Injected Drug Unk
"TEMP","RORCDCDEF",103)
chkb5_2_1=^^2228^1509^24^^49^^^^1^PH^4^1^20^^Sex With Female Yes
"TEMP","RORCDCDEF",104)
chkb5_2_2=^^2316^1509^24^^49^^^^1^PH^4^0^20^^Sex With Female No
"TEMP","RORCDCDEF",105)
chkb5_2_3=^^2398^1509^24^^49^^^^1^PH^4^9^20^^Sex With Female Unk
"TEMP","RORCDCDEF",106)
chkb5_1_1=^^2228^1463^24^^49^^^^1^PH^3^1^20^^Sex With Male Yes
"TEMP","RORCDCDEF",107)
chkb5_1_2=^^2316^1463^24^^49^^^^1^PH^3^0^20^^Sex With Male No
"TEMP","RORCDCDEF",108)
chkb5_1_3=^^2399^1463^24^^49^^^^1^PH^3^9^20^^Sex With Male Unk
"TEMP","RORCDCDEF",109)
chkb6_8_1=^^2228^2563^24^^49^^^^1^LD2^5^1^14^^HIV-1 Yes
"TEMP","RORCDCDEF",110)
chkb6_8_2=^^2308^2563^24^^49^^^^1^LD2^5^0^14^^HIV-1 No
"TEMP","RORCDCDEF",111)
chkb6_8_3=^^2387^2563^24^^49^^^^1^LD2^5^9^14^^HIV-1 Unk
"TEMP","RORCDCDEF",112)
edt6_8_1=^^2230^2656^30^MMYY^50^170^^^1^LD2^6^^14^MM/YY^HIV Diagnosis by Physician Date
"TEMP","RORCDCDEF",113)
edt6_7_1=^^2230^2448^30^MMYY^50^170^^^1^LD2^4^^14^MM/YY^Lst Documented negative HIV Date
"TEMP","RORCDCDEF",114)
edt6_7_2=^^1557^2469^22^^49^^^^1^LD2^3^^14^^Lst Documented negative HIV Name
"TEMP","RORCDCDEF",115)
edt6_4_1=^^1046^2664^30^MMYY^50^170^^^1^LD1^10^^18^MM/YY^VI. Other HIV Test Date
"TEMP","RORCDCDEF",116)
chkb6_4_1=^^746^2671^27^^49^^^^1^LD1^9^1^18^^VI. Other HIV Test Pos
"TEMP","RORCDCDEF",117)
chkb6_4_2=^^821^2671^27^^49^^^^1^LD1^9^0^18^^VI. Other HIV Test Neg
"TEMP","RORCDCDEF",118)
chkb6_4_3=^^895^2671^27^^49^^^^1^LD1^9^8^18^^VI. Other HIV Test Ind
"TEMP","RORCDCDEF",119)
chkb6_4_4=^^966^2671^27^^49^^^^1^LD1^9^9^18^^VI. Other HIV Not Done
"TEMP","RORCDCDEF",120)
edt6_4_2=^^315^2718^22^^49^^^^1^LD1^11^^18^^VI. Other HIV Test Name
"TEMP","RORCDCDEF",121)
edt6_3_1=^^1046^2598^30^MMYY^50^170^^^1^LD1^8^^18^MM/YY^VI. HIV-1 Western Date
"TEMP","RORCDCDEF",122)
chkb6_3_1=^^746^2605^26^^49^^^^1^LD1^7^1^18^^VI. HIV-1 Western Yes
"TEMP","RORCDCDEF",123)
chkb6_3_2=^^821^2605^26^^49^^^^1^LD1^7^0^18^^VI. HIV-1 Western No
"TEMP","RORCDCDEF",124)
chkb6_3_3=^^896^2605^26^^49^^^^1^LD1^7^8^18^^VI. HIV-1 Western Ind
"TEMP","RORCDCDEF",125)
chkb6_3_4=^^967^2605^26^^49^^^^1^LD1^7^9^18^^VI. HIV-1 Western Not Done
"TEMP","RORCDCDEF",126)
edt6_2_1=^^1046^2531^30^MMYY^50^170^^^1^LD1^6^^18^MM/YY^VI. HIV-1/2 Date
"TEMP","RORCDCDEF",127)
chkb6_2_1=^^746^2538^27^^49^^^^1^LD1^5^1^18^^VI. HIV 1/2 Pos
"TEMP","RORCDCDEF",128)
chkb6_2_2=^^820^2538^27^^49^^^^1^LD1^5^0^18^^VI. HIV 1/2 Neg
"TEMP","RORCDCDEF",129)
chkb6_2_3=^^967^2538^27^^49^^^^1^LD1^5^9^18^^VI. HIV 1/2 Not Done
"TEMP","RORCDCDEF",130)
edt6_1_1=^^1046^2465^30^MMYY^50^170^^^1^LD1^4^^18^MM/YY^VI. HIV-1 EAI Date
"TEMP","RORCDCDEF",131)
chkb6_1_1=^^746^2471^27^^49^^^^1^LD1^3^1^18^^VI. HIV-1 EAI Pos
"TEMP","RORCDCDEF",132)
chkb6_1_2=^^821^2471^27^^49^^^^1^LD1^3^0^18^^VI. HIV-1 EAI Neg
"TEMP","RORCDCDEF",133)
chkb6_1_3=^^966^2471^27^^49^^^^1^LD1^3^9^18^^VI. HIV-1 EAI  Not Done
"TEMP","RORCDCDEF",134)
edt6_5_1=^^1046^2836^30^MMYY^50^170^^^1^LD1^13^^18^MM/YY^VI. Positive HIV Detection Date
"TEMP","RORCDCDEF",135)
edt6_5_2=^^399^2908^22^^49^^^^1^LD1^14^^18^^VI. Positive HIV Detection Other Test Type
"TEMP","RORCDCDEF",136)
edt6_5_3=^^1046^2902^30^MMYY^50^170^^^1^LD1^15^^18^MM/YY^VI. Positive HIV Detection Other Date
"TEMP","RORCDCDEF",137)
chkb6_5_1=^^162^2838^27^^49^^^^1^LD1^12^1^18^^VI. Positive HIV Detection Culture
"TEMP","RORCDCDEF",138)
chkb6_5_2=^^337^2838^27^^49^^^^1^LD1^12^2^18^^VI. Positive HIV Detection Antigen
"TEMP","RORCDCDEF",139)
chkb6_5_3=^^524^2838^27^^49^^^^1^LD1^12^3^18^^VI. Positive HIV Detection PCR, DNA or RNA Probe 
"TEMP","RORCDCDEF",140)
edt6_6_2=^^1046^3074^30^MMYY^50^170^^^1^LD1^18^^18^MM/YY^VI. VIRAL LOAD TEST DATE
"TEMP","RORCDCDEF",141)
cmbb6_6_1=^^301^3073^30^BoxedLine^49^2^^^1^LD1^16^^18^^VI. VIRAL LOAD TEST TYPE 
"TEMP","RORCDCDEF",142)
edt6_6_1=^^517^3073^30^N7^50^29^125^^1^LD1^17^^18^^VI. VIRAL LOAD  COPIES/ML
"TEMP","RORCDCDEF",143)
edt6_9_2=^^2230^2877^30^MMYY^50^170^^^1^LD2^8^^14^MM/YY^VI. IMMUNOLOGY LAB CD4 Count Date
"TEMP","RORCDCDEF",144)
edt6_9_4=^^2230^2944^30^MMYY^50^170^^^1^LD2^10^^14^MM/YY^VI. IMMUNOLOGY LAB CD4 Percent Date
"TEMP","RORCDCDEF",145)
edt6_9_6=^^2230^3058^30^MMYY^50^170^^^1^LD2^12^^14^MM/YY^VI. IMMUNOLOGY LAB First <200ml CD4 Count Date
"TEMP","RORCDCDEF",146)
edt6_9_8=^^2230^3123^30^MMYY^50^170^^^1^LD2^14^^14^MM/YY^VI. IMMUNOLOGY LAB First <200ml CD4 Percent Date
"TEMP","RORCDCDEF",147)
edt6_9_3=^^1938^2944^30^BoxedLine^49^2^^^1^LD2^9^^14^^VI. IMMUNOLOGY LAB CD4 Percent
"TEMP","RORCDCDEF",148)
edt6_9_1=^^1811^2877^30^N4^49^30^^^1^LD2^7^^14^^VI. IMMUNOLOGY LAB CD4 Count
"TEMP","RORCDCDEF",149)
edt6_9_5=^^1810^3057^30^N4^49^30^^^1^LD2^11^^14^^VI. IMMUNOLOGY LAB First <200ml CD4 Count
"TEMP","RORCDCDEF",150)
edt6_9_7=^^1939^3123^30^BoxedLine^49^2^^^1^LD2^13^^14^^VI. IMMUNOLOGY LAB First <200ml CD4 Percent
"TEMP","RORCDCDEF",151)
edt7_1=^^380^111^22^^49^^^^2^^^^^^VII. Physician
"TEMP","RORCDCDEF",152)
edt7_5=^^1320^184^22^PlainLine^49^^^^2^^^^^^VII. Person, compiling form
"TEMP","RORCDCDEF",153)
edt7_3=^^1455^111^22^^49^^^^2^^^^^^VII. Physician Phone
"TEMP","RORCDCDEF",154)
edt7_6=^^2005^184^22^^49^^^^2^^^^^^VII. Person compiling phone
"TEMP","RORCDCDEF",155)
edt7_4=^^355^184^22^^49^^^^2^^^^^^VII. Hospital
"TEMP","RORCDCDEF",156)
edt7_2=^^2140^111^22^^49^^^^2^^^^^^VII. Medical Record Num
"TEMP","RORCDCDEF",157)
edt8_27_1=^^2185^1640^30^MMYY^50^158^^26^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",158)
chkb8_27_1=^^2016^1642^27^^49^^^26^2^AID^3^1^4^^
"TEMP","RORCDCDEF",159)
edt8_26_1=^^2185^1553^30^MMYY^50^158^^25^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",160)
chkb8_26_1=^^2017^1555^26^^49^^^25^2^AID^3^1^4^^
"TEMP","RORCDCDEF",161)
chkb8_26_2=^^2100^1555^26^^49^^^25^2^AID^3^2^4^^
"TEMP","RORCDCDEF",162)
edt8_25_1=^^2185^1464^30^MMYY^50^158^^24^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",163)
chkb8_25_1=^^2016^1467^27^PlainLine^49^1^^24^2^AID^3^1^4^^
"TEMP","RORCDCDEF",164)
edt8_24_1=^^2185^1378^30^MMYY^50^158^^23^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",165)
chkb8_24_1=^^2016^1380^26^^49^^^23^2^AID^3^1^26^^
"TEMP","RORCDCDEF",166)
edt8_23_1=^^2185^1290^30^MMYY^50^158^^22^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",167)
chkb8_23_1=^^2016^1292^27^^49^^^22^2^AID^3^1^4^^
"TEMP","RORCDCDEF",168)
chkb8_23_2=^^2104^1292^27^^49^^^22^2^AID^3^2^4^^
"TEMP","RORCDCDEF",169)
edt8_22_1=^^2185^1204^30^MMYY^50^158^^21^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",170)
chkb8_22_1=^^2017^1205^26^^49^^^21^2^AID^3^1^4^^
"TEMP","RORCDCDEF",171)
chkb8_22_2=^^2104^1205^26^^49^^^21^2^AID^3^2^4^^
"TEMP","RORCDCDEF",172)
edt8_21_1=^^2185^1115^30^MMYY^50^158^^20^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",173)
chkb8_21_1=^^2016^1117^27^^49^^^20^2^AID^3^1^4^^
"TEMP","RORCDCDEF",174)
chkb8_21_2=^^2104^1117^27^^49^^^20^2^AID^3^2^4^^
"TEMP","RORCDCDEF",175)
edt8_20_1=^^2185^1028^30^MMYY^50^158^^19^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",176)
chkb8_20_1=^^2017^1034^26^^49^^^19^2^AID^3^1^4^^
"TEMP","RORCDCDEF",177)
chkb8_20_2=^^2104^1034^26^^49^^^19^2^AID^3^2^4^^
"TEMP","RORCDCDEF",178)
edt8_19_1=^^2185^941^30^MMYY^50^158^^18^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",179)
chkb8_19_1=^^2016^942^27^^49^^^18^2^AID^3^1^4^^
"TEMP","RORCDCDEF",180)
chkb8_19_2=^^2104^942^27^^49^^^18^2^AID^3^2^4^^
"TEMP","RORCDCDEF",181)
edt8_18_1=^^2185^853^30^MMYY^50^158^^17^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",182)
chkb8_18_1=^^2017^855^26^^49^^^17^2^AID^3^1^4^^
"TEMP","RORCDCDEF",183)
chkb8_18_2=^^2104^855^26^PlainLine^49^^^17^2^AID^3^2^4^^
"TEMP","RORCDCDEF",184)
edt8_17_1=^^2185^765^30^MMYY^50^158^^16^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",185)
chkb8_17_1=^^2016^767^27^^49^^^16^2^AID^3^1^4^^
"TEMP","RORCDCDEF",186)
edt8_16_1=^^2185^676^30^MMYY^50^158^^15^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",187)
chkb8_16_1=^^2017^680^26^^49^^^15^2^AID^3^1^4^^
"TEMP","RORCDCDEF",188)
edt8_15_1=^^2185^590^30^MMYY^50^158^^14^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",189)
chkb8_15_1=^^2016^592^27^^49^^^14^2^AID^3^1^4^^
"TEMP","RORCDCDEF",190)
edt8_14_1=^^1019^1640^30^MMYY^50^158^^13^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",191)
chkb8_14_1=^^846^1642^27^^49^^^13^2^AID^3^1^4^^
"TEMP","RORCDCDEF",192)
chkb8_14_2=^^933^1642^27^^49^^^13^2^AID^3^2^4^^
"TEMP","RORCDCDEF",193)
edt8_13_1=^^1019^1552^30^MMYY^50^158^^12^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",194)
chkb8_13_1=^^846^1555^26^^49^^^12^2^AID^3^1^4^^
"TEMP","RORCDCDEF",195)
edt8_12_1=^^1019^1465^30^MMYY^50^158^^11^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",196)
chkb8_12_1=^^845^1467^27^^49^^^11^2^AID^3^1^4^^
"TEMP","RORCDCDEF",197)
edt8_11_1=^^1019^1376^30^MMYY^50^158^^10^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",198)
chkb8_11_1=^^846^1380^26^^49^^^10^2^AID^3^1^4^^
"TEMP","RORCDCDEF",199)
edt8_10_1=^^1019^1289^30^MMYY^50^158^^9^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",200)
chkb8_10_1=^^846^1292^27^^49^^^9^2^AID^3^1^4^^
"TEMP","RORCDCDEF",201)
edt8_9_1=^^1019^1202^30^MMYY^50^158^^8^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",202)
chkb8_9_1=^^846^1205^26^^49^^^8^2^AID^3^1^4^^
"TEMP","RORCDCDEF",203)
chkb8_9_2=^^934^1205^26^^49^^^8^2^AID^3^2^4^^
"TEMP","RORCDCDEF",204)
edt8_8_1=^^1019^1115^30^MMYY^50^158^^7^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",205)
chkb8_8_1=^^846^1117^27^^49^^^7^2^AID^3^1^4^^
"TEMP","RORCDCDEF",206)
edt8_7_1=^^1019^1029^30^MMYY^50^158^^6^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",207)
chkb8_7_1=^^846^1034^26^^49^^^6^2^AID^3^1^4^^
"TEMP","RORCDCDEF",208)
edt8_6_1=^^1019^941^30^MMYY^50^158^^5^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",209)
chkb8_6_1=^^846^946^27^^49^^^5^2^AID^3^1^4^^
"TEMP","RORCDCDEF",210)
edt8_5_1=^^1019^853^30^MMYY^50^158^^4^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",211)
chkb8_5_1=^^846^855^26^^49^^^4^2^AID^3^1^4^^
"TEMP","RORCDCDEF",212)
edt8_4_1=^^1019^765^30^MMYY^50^158^^3^2^AID^4^^4^MM/YY^
"TEMP","RORCDCDEF",213)
chkb8_4_1=^^846^767^27^^49^^^3^2^AID^3^1^4^^
"TEMP","RORCDCDEF",214)
edt8_3_1=^^1019^678^30^MMYY^50^158^^2^2^AID^4^^4^MM/YY^VIII. Candidiasis, esophagel Date
"TEMP","RORCDCDEF",215)
chkb8_3_1=^^846^684^26^^49^^^2^2^AID^3^1^4^^VIII. Candidiasis, esophagel Def
"TEMP","RORCDCDEF",216)
chkb8_3_2=^^934^684^26^^49^^^2^2^AID^3^2^4^^VIII. Candidiasis, esophagel Pres
"TEMP","RORCDCDEF",217)
edt8_2_1=^^1019^591^30^MMYY^50^158^^1^2^AID^4^^4^MM/YY^VIII. Candidiasis, Bronchi, trachea Date
"TEMP","RORCDCDEF",218)
chkb8_2_1=^^846^596^27^^49^^^1^2^AID^3^1^4^^VIII. Candidiasis, Bronchi, trachea Def
"TEMP","RORCDCDEF",219)
chkb8_1=^^471^417^27^^49^^^^2^CS^3^1^7^^VIII. Record Rewieved yes
"TEMP","RORCDCDEF",220)
chkb8_2=^^566^417^27^^49^^^^2^CS^3^0^7^^VIII. Record Rewieved No
"TEMP","RORCDCDEF",221)
edt8_1_1=^^1667^420^30^MMYY^50^155^^^2^CS^4^^7^MM/YY^VIII Asymptomatic Date
"TEMP","RORCDCDEF",222)
edt8_1_2=^^2188^419^30^MMYY^50^155^^^2^CS^5^^7^MM/YY^Symptomatic Date
"TEMP","RORCDCDEF",223)
edt8_1=^^1622^1724^30^BoxedLine^46^9^^^2^CS^6^^7^^RVCT CASE NO
"TEMP","RORCDCDEF",224)
chkb8_28_1=^^1396^1813^27^PlainLine^49^^^^2^CS^7^1^7^^VIII. Immunideficiency disqualifying from AIDS Yes
"TEMP","RORCDCDEF",225)
chkb8_28_2=^^1563^1813^27^^49^^^^2^CS^7^0^7^^VIII. Immunideficiency disqualifying from AIDS No
"TEMP","RORCDCDEF",226)
chkb8_28_3=^^1712^1813^27^^49^^^^2^CS^7^9^7^^VIII. Immunideficiency disqualifying from AIDS Unk
"TEMP","RORCDCDEF",227)
chkb9_8_1=^^1142^2255^26^^49^^^^2^TS1^10^1^11^^Clinic (HRSA)
"TEMP","RORCDCDEF",228)
chkb9_8_2=^^1142^2305^26^^49^^^^2^TS1^10^2^11^^Clinic (Other)
"TEMP","RORCDCDEF",229)
chkb9_8_4=^^1142^2355^26^^49^^^^2^TS1^10^9^11^^Clinic (None)
"TEMP","RORCDCDEF",230)
chkb9_8_3=^^1142^2405^26^^49^^^^2^TS1^10^3^11^^Clinic (Unknown)
"TEMP","RORCDCDEF",231)
chkb9_6_1=^^467^2392^27^^49^^^^2^TS1^8^1^11^^PCP prophylaxis Yes
"TEMP","RORCDCDEF",232)
chkb9_6_2=^^550^2392^27^^49^^^^2^TS1^8^0^11^^PCP prophylaxis No
"TEMP","RORCDCDEF",233)
chkb9_6_3=^^632^2392^27^^49^^^^2^TS1^8^9^11^^PCP prophylaxis Unk
"TEMP","RORCDCDEF",234)
chkb9_12_1=^^1241^2588^27^^49^^^^2^TS2^5^1^9^^IX. Live Infant delivered  Yes
"TEMP","RORCDCDEF",235)
chkb9_12_2=^^2100^2588^27^^49^^^^2^TS2^5^0^9^^IX. Live Infant delivered  No
"TEMP","RORCDCDEF",236)
chkb9_12_3=^^2250^2588^27^^49^^^^2^TS2^5^9^9^^IX. Live Infant delivered  Unk
"TEMP","RORCDCDEF",237)
edt9_12_2=^^1417^2758^30^BoxedLine^49^4^^^2^TS2^^^9^^IX. Live Infant delivered Child SOUNDEX ????
"TEMP","RORCDCDEF",238)
edt9_12_5=^^1942^2751^30^BoxedLine^50^10^^^2^TS2^9^^9^^IX. Live Infant delivered  Child State Patient # 
"TEMP","RORCDCDEF",239)
dtp9_12_1=^^164^2761^30^MMDDYY^49^106^^^2^TS2^6^^9^^IX. Live Infant delivered  Date of Birth
"TEMP","RORCDCDEF",240)
edt9_12_3=^^615^2772^22^^49^^^^2^TS2^8^^9^^IX. Live Infant delivered  City
"TEMP","RORCDCDEF",241)
edt9_12_1=^^769^2700^22^^49^^^^2^TS2^7^^9^^IX. Live Infant delivered  Hospital
"TEMP","RORCDCDEF",242)
cmbb9_12_1=^^1037^2772^22^^49^^^^2^TS2^9^^9^^IX. Live Infant delivered  State
"TEMP","RORCDCDEF",243)
chkb9_11_1=^^1934^2534^26^^49^^^^2^TS2^4^1^9^^IX. Is  patient pregnant Yes
"TEMP","RORCDCDEF",244)
chkb9_11_2=^^2101^2534^26^^49^^^^2^TS2^4^0^9^^IX. Is  patient pregnant No
"TEMP","RORCDCDEF",245)
chkb9_11_3=^^2251^2534^26^^49^^^^2^TS2^4^9^9^^IX. Is  patient pregnant Unk
"TEMP","RORCDCDEF",246)
chkb9_4_1=^^2146^2105^26^^49^^^^2^TS1^6^1^11^^Substance abuse Yes
"TEMP","RORCDCDEF",247)
chkb9_4_2=^^2229^2105^26^^49^^^^2^TS1^6^0^11^^Substance abuse No
"TEMP","RORCDCDEF",248)
chkb9_4_4=^^2392^2105^26^^49^^^^2^TS1^6^8^11^^Substance abuse Unk
"TEMP","RORCDCDEF",249)
chkb9_4_3=^^2313^2105^26^^49^^^^2^TS1^6^9^11^^Substance abuse NA
"TEMP","RORCDCDEF",250)
chkb9_3_1=^^2146^2050^27^^49^^^^2^TS1^5^1^11^^HIV med. services Yes
"TEMP","RORCDCDEF",251)
chkb9_3_2=^^2229^2050^27^^49^^^^2^TS1^5^0^11^^HIV med. services No
"TEMP","RORCDCDEF",252)
chkb9_3_3=^^2392^2050^27^^49^^^^2^TS1^5^9^11^^HIV med. services Unk
"TEMP","RORCDCDEF",253)
chkb9_2_1=^^229^2109^26^^49^^^^2^TS1^4^1^11^^Notified Health department
"TEMP","RORCDCDEF",254)
chkb9_2_3=^^625^2109^26^^49^^^^2^TS1^4^2^11^^Notified Physician/Provider
"TEMP","RORCDCDEF",255)
chkb9_2_2=^^1030^2109^26^^49^^^^2^TS1^4^3^11^^Notified Patient
"TEMP","RORCDCDEF",256)
chkb9_2_4=^^1263^2109^26^^49^^^^2^TS1^4^9^11^^Notified Unk
"TEMP","RORCDCDEF",257)
chkb9_1_1=^^996^1992^27^^49^^^^2^TS1^3^1^11^^Informed of HIV Yes
"TEMP","RORCDCDEF",258)
chkb9_1_2=^^1162^1992^27^^49^^^^2^TS1^3^0^11^^Informed of HIV No
"TEMP","RORCDCDEF",259)
chkb9_1_3=^^1312^1992^27^^49^^^^2^TS1^3^9^11^^Informed of HIV Unk
"TEMP","RORCDCDEF",260)
chkb9_5_1=^^468^2280^26^^49^^^^2^TS1^7^1^11^^ARV therapy Yes
"TEMP","RORCDCDEF",261)
chkb9_5_2=^^550^2280^26^^49^^^^2^TS1^7^0^11^^ARV therapy No
"TEMP","RORCDCDEF",262)
chkb9_5_3=^^634^2280^26^^49^^^^2^TS1^7^9^11^^ARV therapy Unk
"TEMP","RORCDCDEF",263)
chkb9_7_1=^^784^2255^26^^49^^^^2^TS1^9^1^11^^Clinical Trial NIH
"TEMP","RORCDCDEF",264)
chkb9_7_2=^^784^2305^26^^49^^^^2^TS1^9^2^11^^Clinical Trial Other
"TEMP","RORCDCDEF",265)
chkb9_7_4=^^784^2355^26^^49^^^^2^TS1^9^3^11^^Clinical Trial None
"TEMP","RORCDCDEF",266)
chkb9_7_3=^^784^2405^26^^49^^^^2^TS1^9^9^11^^Clinical Trial Unk
"TEMP","RORCDCDEF",267)
chkb9_9_1=^^1621^2255^26^^49^^^^2^TS1^11^1^11^^Reimburse Medicaid
"TEMP","RORCDCDEF",268)
chkb9_9_3=^^1621^2309^26^^49^^^^2^TS1^11^2^11^^Reimbursed No coverage
"TEMP","RORCDCDEF",269)
chkb9_9_2=^^2000^2255^26^^49^^^^2^TS1^11^3^11^^Reimbursed HMO
"TEMP","RORCDCDEF",270)
chkb9_9_4=^^2001^2309^26^^49^^^^2^TS1^11^4^11^^Reimbursed Other
"TEMP","RORCDCDEF",271)
chkb9_9_5=^^1621^2363^27^^49^^^^2^TS1^11^7^11^^Reimbursed Trial
"TEMP","RORCDCDEF",272)
chkb9_9_6=^^2000^2363^27^^49^^^^2^TS1^11^9^11^^Reimbursed Unk
"TEMP","RORCDCDEF",273)
chkb9_10_1=^^1934^2480^26^^49^^^^2^TS2^3^1^9^^Gynecol. services Yes
"TEMP","RORCDCDEF",274)
chkb9_10_2=^^2101^2480^26^^49^^^^2^TS2^3^0^9^^Gynecol. services No
"TEMP","RORCDCDEF",275)
chkb9_10_3=^^2251^2480^26^^49^^^^2^TS2^3^9^9^^Gynecol. services Unk
"TEMP","RORCDCDEF",276)
mmComments=^^420^2864^30^MEMO^65^^^^2^CMT^3^^3^^
"VER")
8.0^22
"^DD",799.31,799.31,0)
FIELD^^.01^1
"^DD",799.31,799.31,0,"DDA")
N
"^DD",799.31,799.31,0,"DT")
3021130
"^DD",799.31,799.31,0,"IX","B",799.31,.01)

"^DD",799.31,799.31,0,"NM","ROR XML ITEM")

"^DD",799.31,799.31,0,"PT",798.87,.01)

"^DD",799.31,799.31,0,"PT",798.872,.01)

"^DD",799.31,799.31,0,"VRPK")
ROR
"^DD",799.31,799.31,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.31,,-1)  K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",799.31,799.31,.01,1,0)
^.1
"^DD",799.31,799.31,.01,1,1,0)
799.31^B
"^DD",799.31,799.31,.01,1,1,1)
S ^ROR(799.31,"B",$E(X,1,30),DA)=""
"^DD",799.31,799.31,.01,1,1,2)
K ^ROR(799.31,"B",$E(X,1,30),DA)
"^DD",799.31,799.31,.01,1,1,3)
Do not delete!
"^DD",799.31,799.31,.01,3)
Enter the tag name (2-30 characters).
"^DD",799.31,799.31,.01,8.5)
@
"^DD",799.31,799.31,.01,9)
@
"^DD",799.31,799.31,.01,21,0)
^.001^4^4^3030506^^
"^DD",799.31,799.31,.01,21,1,0)
This field stores the tag name. The name should 
"^DD",799.31,799.31,.01,21,2,0)
not contain spaces and any punctuation marks 
"^DD",799.31,799.31,.01,21,3,0)
except underscore. See an XML reference guide for
"^DD",799.31,799.31,.01,21,4,0)
more details.
"^DD",799.31,799.31,.01,23,0)
^.001^4^4^3030506^^
"^DD",799.31,799.31,.01,23,1,0)
Please try to use shorter names for the tags that will
"^DD",799.31,799.31,.01,23,2,0)
be used more often and/or will be repeated many times 
"^DD",799.31,799.31,.01,23,3,0)
in the report. Thus you will decrease amount of the
"^DD",799.31,799.31,.01,23,4,0)
overhead data transmitted from the server to the GUI.
"^DD",799.31,799.31,.01,"DEL",1,0)
I $$VADEL^RORDD(799.31,,-1)
"^DD",799.31,799.31,.01,"DT")
3030506
"^DD",799.34,799.34,0)
FIELD^^12^9
"^DD",799.34,799.34,0,"DDA")
N
"^DD",799.34,799.34,0,"DT")
3031103
"^DD",799.34,799.34,0,"IX","B",799.34,.01)

"^DD",799.34,799.34,0,"NM","ROR REPORT PARAMETERS")

"^DD",799.34,799.34,0,"PT",798.8,.04)

"^DD",799.34,799.34,0,"VRPK")
ROR
"^DD",799.34,799.34,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",799.34,799.34,.01,1,0)
^.1
"^DD",799.34,799.34,.01,1,1,0)
799.34^B
"^DD",799.34,799.34,.01,1,1,1)
S ^ROR(799.34,"B",$E(X,1,30),DA)=""
"^DD",799.34,799.34,.01,1,1,2)
K ^ROR(799.34,"B",$E(X,1,30),DA)
"^DD",799.34,799.34,.01,1,1,3)
Do not delete!
"^DD",799.34,799.34,.01,3)
Enter the report name (3-60 characters).
"^DD",799.34,799.34,.01,8.5)
@
"^DD",799.34,799.34,.01,9)
@
"^DD",799.34,799.34,.01,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.01,21,3,0)
 
"^DD",799.34,799.34,.01,21,4,0)
The name of the report stored in the NAME field is
"^DD",799.34,799.34,.01,21,5,0)
displayed in the Reports sub-menu of the GUI.
"^DD",799.34,799.34,.01,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.01,"DT")
3021126
"^DD",799.34,799.34,.02,0)
BACKGROUND PROCESSING?^SX^0:NO;1:YES;^0;2^Q:$$VAEDT^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.02,8.5)
@
"^DD",799.34,799.34,.02,9)
@
"^DD",799.34,799.34,.02,21,0)
^^6^6^3030506^
"^DD",799.34,799.34,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.02,21,3,0)
 
"^DD",799.34,799.34,.02,21,4,0)
If the BACKGROUND PROCESSING? field is set to
"^DD",799.34,799.34,.02,21,5,0)
'YES' then the report will be scheduled to run as
"^DD",799.34,799.34,.02,21,6,0)
a background task.
"^DD",799.34,799.34,.02,23,0)
^^1^1^3030506^
"^DD",799.34,799.34,.02,23,1,0)
Only background processing is currently implemented.
"^DD",799.34,799.34,.02,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,.02,"DT")
3021127
"^DD",799.34,799.34,.04,0)
CODE^RNJ3,0X^^0;4^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",799.34,799.34,.04,3)
Enter the unique report code (between 1 and 999, 0 Decimal Digits).
"^DD",799.34,799.34,.04,8.5)
@
"^DD",799.34,799.34,.04,9)
@
"^DD",799.34,799.34,.04,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.04,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,.04,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,.04,21,3,0)
 
"^DD",799.34,799.34,.04,21,4,0)
The CODE field stores the unique code of the
"^DD",799.34,799.34,.04,21,5,0)
report.
"^DD",799.34,799.34,.04,23,0)
^^19^19^3030507^
"^DD",799.34,799.34,.04,23,1,0)
The corresponding XSL templates for the report are 
"^DD",799.34,799.34,.04,23,2,0)
stored in the DIALOG file (#.84). The dialog number 
"^DD",799.34,799.34,.04,23,3,0)
of the template has the following structure:
"^DD",799.34,799.34,.04,23,4,0)
 
"^DD",799.34,799.34,.04,23,5,0)
 7981CCC.TTT
"^DD",799.34,799.34,.04,23,6,0)
 
"^DD",799.34,799.34,.04,23,7,0)
 'CCC' is the code of the report.
"^DD",799.34,799.34,.04,23,8,0)
 
"^DD",799.34,799.34,.04,23,9,0)
 'TTT' is the type of the template:
"^DD",799.34,799.34,.04,23,10,0)
        001 - HTML Preview,
"^DD",799.34,799.34,.04,23,11,0)
        002 - Delimited Format (CSV),
"^DD",799.34,799.34,.04,23,12,0)
        003 - Printer Output.
"^DD",799.34,799.34,.04,23,13,0)
 
"^DD",799.34,799.34,.04,23,14,0)
For example, the dialog 7981001.001 contains the HTML
"^DD",799.34,799.34,.04,23,15,0)
preview template for the List of Registry Patients
"^DD",799.34,799.34,.04,23,16,0)
(report code: 1).
"^DD",799.34,799.34,.04,23,17,0)
 
"^DD",799.34,799.34,.04,23,18,0)
If no template is defined for the report then the
"^DD",799.34,799.34,.04,23,19,0)
default template from dialog 7981000 is used.
"^DD",799.34,799.34,.04,"DT")
3030401
"^DD",799.34,799.34,.05,0)
DATE OF INACTIVATION^D^^0;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",799.34,799.34,.05,21,0)
^^5^5^3030505^
"^DD",799.34,799.34,.05,21,1,0)
If this field has a value, the report will be
"^DD",799.34,799.34,.05,21,2,0)
considered inactive after this date. Use this
"^DD",799.34,799.34,.05,21,3,0)
field to disable unnecessary reports (and hide
"^DD",799.34,799.34,.05,21,4,0)
them from the Report sub-menu of the GUI) instead
"^DD",799.34,799.34,.05,21,5,0)
of deleting them.
"^DD",799.34,799.34,.05,23,0)
^^3^3^3030505^
"^DD",799.34,799.34,.05,23,1,0)
The ROR REPORTS AVAILABLE remote procedure analyzes
"^DD",799.34,799.34,.05,23,2,0)
this field when it loads the list of available reports
"^DD",799.34,799.34,.05,23,3,0)
and skips the inactive ones.
"^DD",799.34,799.34,.05,"DT")
3021126
"^DD",799.34,799.34,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;9^Q:$$VAEDT^RORDD(799.34,,-1)
"^DD",799.34,799.34,.09,8.5)
@
"^DD",799.34,799.34,.09,9)
@
"^DD",799.34,799.34,.09,21,0)
^^7^7^3030506^
"^DD",799.34,799.34,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",799.34,799.34,.09,21,2,0)
EDIT THIS FIELD!
"^DD",799.34,799.34,.09,21,3,0)
 
"^DD",799.34,799.34,.09,21,4,0)
Reports distributed with the national registries
"^DD",799.34,799.34,.09,21,5,0)
must have this field set to "YES". This prevents
"^DD",799.34,799.34,.09,21,6,0)
local editing of other fields of report
"^DD",799.34,799.34,.09,21,7,0)
definitions.
"^DD",799.34,799.34,.09,"DEL",1,0)
I $$VADEL^RORDD(799.34,,,-1)
"^DD",799.34,799.34,.09,"DT")
3021126
"^DD",799.34,799.34,1,0)
PARAMETER PANELS^FX^^1;E1,250^Q:$$VAEDT^RORDD(799.34,$G(DA))  K:$L(X)>250!($L(X)<1) X
"^DD",799.34,799.34,1,3)
Enter codes of dialog panels separated by commas (1-250 characters).
"^DD",799.34,799.34,1,8.5)
@
"^DD",799.34,799.34,1,9)
@
"^DD",799.34,799.34,1,21,0)
^^7^7^3030507^
"^DD",799.34,799.34,1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,1,21,3,0)
 
"^DD",799.34,799.34,1,21,4,0)
The PARAMETER PANELS field stores the list of 
"^DD",799.34,799.34,1,21,5,0)
panel codes separated by commas. The panels are 
"^DD",799.34,799.34,1,21,6,0)
combined by the GUI into the dialog form that is
"^DD",799.34,799.34,1,21,7,0)
used to request values of the report parameters.
"^DD",799.34,799.34,1,"DEL",1,0)
I $$VADEL^RORDD(799.34,$G(DA))
"^DD",799.34,799.34,1,"DT")
3030304
"^DD",799.34,799.34,10.01,0)
REPORT BUILDER^RFX^^10.01;E1,245^Q:$$VAEDT^RORDD(799.34,$G(DA))  Q:$$EP^RORDD(1)
"^DD",799.34,799.34,10.01,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",799.34,799.34,10.01,8.5)
@
"^DD",799.34,799.34,10.01,9)
@
"^DD",799.34,799.34,10.01,21,0)
^^6^6^3030506^
"^DD",799.34,799.34,10.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",799.34,799.34,10.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.34,799.34,10.01,21,3,0)
 
"^DD",799.34,799.34,10.01,21,4,0)
The REPORT BUILDER field stores a reference to the
"^DD",799.34,799.34,10.01,21,5,0)
function that is used to build the report (the
"^DD",799.34,799.34,10.01,21,6,0)
report builder).
"^DD",799.34,799.34,10.01,23,0)
^^70^70^3030507^
"^DD",799.34,799.34,10.01,23,1,0)
The call-back entry point is called with a single
"^DD",799.34,799.34,10.01,23,2,0)
parameter. The parameter is a reference to a local
"^DD",799.34,799.34,10.01,23,3,0)
variable that contains values of the report parameters.
"^DD",799.34,799.34,10.01,23,4,0)
 
"^DD",799.34,799.34,10.01,23,5,0)
 RORTSK(            Task Number
"^DD",799.34,799.34,10.01,23,6,0)
 
"^DD",799.34,799.34,10.01,23,7,0)
   "EP")            Entry Point ($$TAG^ROUTINE)
"^DD",799.34,799.34,10.01,23,8,0)
 
"^DD",799.34,799.34,10.01,23,9,0)
   "PARAMS",
"^DD",799.34,799.34,10.01,23,10,0)
 
"^DD",799.34,799.34,10.01,23,11,0)
     "CD4OPT")      CD4 Options
"^DD",799.34,799.34,10.01,23,12,0)
 
"^DD",799.34,799.34,10.01,23,13,0)
     "CLINICS",     "ALL"
"^DD",799.34,799.34,10.01,23,14,0)
      i)            Clinic IEN
"^DD",799.34,799.34,10.01,23,15,0)
 
"^DD",799.34,799.34,10.01,23,16,0)
     "DATE_RANGE")  Date Range
"^DD",799.34,799.34,10.01,23,17,0)
 
"^DD",799.34,799.34,10.01,23,18,0)
     "DIVISIONS",   "ALL"
"^DD",799.34,799.34,10.01,23,19,0)
       i)           Division IEN
"^DD",799.34,799.34,10.01,23,20,0)
 
"^DD",799.34,799.34,10.01,23,21,0)
     "DRUGS",       "AGRDISP", "AGRGEN", "ALL", 
"^DD",799.34,799.34,10.01,23,22,0)
                    "ARV", "VACLS"
"^DD",799.34,799.34,10.01,23,23,0)
       i)           Drug IEN
"^DD",799.34,799.34,10.01,23,24,0)
 
"^DD",799.34,799.34,10.01,23,25,0)
     "DRUGS",       "AGRDISP", "AGRGEN", "ALL", 
"^DD",799.34,799.34,10.01,23,26,0)
                    "ARV", "VACLS"
"^DD",799.34,799.34,10.01,23,27,0)
       i,j)         Drug IEN (grouped list of
"^DD",799.34,799.34,10.01,23,28,0)
                    drugs)
"^DD",799.34,799.34,10.01,23,29,0)
 
"^DD",799.34,799.34,10.01,23,30,0)
     "FIELDS")      List of additional fields
"^DD",799.34,799.34,10.01,23,31,0)
 
"^DD",799.34,799.34,10.01,23,32,0)
     "ICD9LST",     "ALL"
"^DD",799.34,799.34,10.01,23,33,0)
       i)           ICD-9 Code
"^DD",799.34,799.34,10.01,23,34,0)
 
"^DD",799.34,799.34,10.01,23,35,0)
     "LABTESTS",    "ALL"
"^DD",799.34,799.34,10.01,23,36,0)
       i)           Test IEN ???
"^DD",799.34,799.34,10.01,23,37,0)
 
"^DD",799.34,799.34,10.01,23,38,0)
     "MAXUTNUM")    Number of patients with
"^DD",799.34,799.34,10.01,23,39,0)
                    highest utilization
"^DD",799.34,799.34,10.01,23,40,0)
 
"^DD",799.34,799.34,10.01,23,41,0)
     "MINLRNUM")    Minimum number of lab
"^DD",799.34,799.34,10.01,23,42,0)
                    results
"^DD",799.34,799.34,10.01,23,43,0)
 
"^DD",799.34,799.34,10.01,23,44,0)
     "MINRPNUM")    Minimum number of radiology
"^DD",799.34,799.34,10.01,23,45,0)
                    procedures
"^DD",799.34,799.34,10.01,23,46,0)
 
"^DD",799.34,799.34,10.01,23,47,0)
     "OPTIONS")     Report Options
"^DD",799.34,799.34,10.01,23,48,0)
 
"^DD",799.34,799.34,10.01,23,49,0)
     "PATIENTS")    Patients Options
"^DD",799.34,799.34,10.01,23,50,0)
 
"^DD",799.34,799.34,10.01,23,51,0)
     "TASK_DESCR")  Task Description
"^DD",799.34,799.34,10.01,23,52,0)
 
"^DD",799.34,799.34,10.01,23,53,0)
     "VADRUGLCS",
"^DD",799.34,799.34,10.01,23,54,0)
       i)           VA Drug Class
"^DD",799.34,799.34,10.01,23,55,0)
 
"^DD",799.34,799.34,10.01,23,56,0)
     "VIRAL_LOAD")  Viral Load Options
"^DD",799.34,799.34,10.01,23,57,0)
 
"^DD",799.34,799.34,10.01,23,58,0)
   "REGIEN")        Registry IEN
"^DD",799.34,799.34,10.01,23,59,0)
 
"^DD",799.34,799.34,10.01,23,60,0)
   "TYPE")          Type of the Task
"^DD",799.34,799.34,10.01,23,61,0)
   "REPORT")        Code of the Report
"^DD",799.34,799.34,10.01,23,62,0)
   "SCHCODE")       Rescheduling Code
"^DD",799.34,799.34,10.01,23,63,0)
 
"^DD",799.34,799.34,10.01,23,64,0)
The function must return 0 in the case of successful
"^DD",799.34,799.34,10.01,23,65,0)
completion. Otherwise, a negative error code must be 
"^DD",799.34,799.34,10.01,23,66,0)
returned.
"^DD",799.34,799.34,10.01,23,67,0)
 
"^DD",799.34,799.34,10.01,23,68,0)
See description of the ROR REPORT SCHEDULE remote
"^DD",799.34,799.34,10.01,23,69,0)
procedure and source code of the RORTSK01 routine for
"^DD",799.34,799.34,10.01,23,70,0)
more details.
"^DD",799.34,799.34,10.01,"DT")
3021126
"^DD",799.34,799.34,11,0)
DEFAULT PARAMETERS^799.3411^^11;0
"^DD",799.34,799.34,11,9)
@
"^DD",799.34,799.34,11,21,0)
^.001^2^2^3040124^^
"^DD",799.34,799.34,11,21,1,0)
This field stores the default values for the 
"^DD",799.34,799.34,11,21,2,0)
report parameters (in the NAME=VALUE format).
"^DD",799.34,799.34,12,0)
DEFAULT SORTING^799.3412^^12;0
"^DD",799.34,799.34,12,9)
@
"^DD",799.34,799.34,12,21,0)
^^2^2^3040121^
"^DD",799.34,799.34,12,21,1,0)
This field stores the default sorting modes for
"^DD",799.34,799.34,12,21,2,0)
the report (in the TABLE=FIELD format).
"^DD",799.34,799.3411,0)
DEFAULT PARAMETERS SUB-FIELD^^.01^1
"^DD",799.34,799.3411,0,"DT")
3030918
"^DD",799.34,799.3411,0,"NM","DEFAULT PARAMETERS")

"^DD",799.34,799.3411,0,"UP")
799.34
"^DD",799.34,799.3411,.01,0)
DEFAULT PARAMETERS^WL^^0;1^Q
"^DD",799.34,799.3411,.01,8.5)
@
"^DD",799.34,799.3411,.01,9)
@
"^DD",799.34,799.3411,.01,"DT")
3030918
"^DD",799.34,799.3412,0)
DEFAULT SORTING SUB-FIELD^^.01^1
"^DD",799.34,799.3412,0,"DT")
3031103
"^DD",799.34,799.3412,0,"NM","DEFAULT SORTING")

"^DD",799.34,799.3412,0,"UP")
799.34
"^DD",799.34,799.3412,.01,0)
DEFAULT SORTING^WL^^0;1^Q
"^DD",799.34,799.3412,.01,8.5)
@
"^DD",799.34,799.3412,.01,9)
@
"^DD",799.34,799.3412,.01,"DT")
3031103
"^DIC",799.31,799.31,0)
ROR XML ITEM^799.31
"^DIC",799.31,799.31,0,"GL")
^ROR(799.31,
"^DIC",799.31,799.31,"%",0)
^1.005^^0
"^DIC",799.31,799.31,"%D",0)
^^7^7^3040124^
"^DIC",799.31,799.31,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.31,799.31,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.31,799.31,"%D",3,0)
THIS FILE!
"^DIC",799.31,799.31,"%D",4,0)
 
"^DIC",799.31,799.31,"%D",5,0)
The ROR XML ELEMENT file contains a list of XML 
"^DIC",799.31,799.31,"%D",6,0)
tags and attributes that can be used in the 
"^DIC",799.31,799.31,"%D",7,0)
reports.
"^DIC",799.31,"B","ROR XML ITEM",799.31)

"^DIC",799.34,799.34,0)
ROR REPORT PARAMETERS^799.34
"^DIC",799.34,799.34,0,"GL")
^ROR(799.34,
"^DIC",799.34,799.34,"%",0)
^1.005^^0
"^DIC",799.34,799.34,"%D",0)
^^7^7^3030814^^
"^DIC",799.34,799.34,"%D",1,0)
The ROR REPORT PARAMETERS file stores the report
"^DIC",799.34,799.34,"%D",2,0)
definitions that are used by the ROR REPORT 
"^DIC",799.34,799.34,"%D",3,0)
SCHEDULE remote procedure to schedule the reports.
"^DIC",799.34,799.34,"%D",4,0)
 
"^DIC",799.34,799.34,"%D",5,0)
Records of the file are uniquely identified by the
"^DIC",799.34,799.34,"%D",6,0)
report code (the "A" primary key and the
"^DIC",799.34,799.34,"%D",7,0)
uniqueness index "KEY" are used for that purpose).
"^DIC",799.34,"B","ROR REPORT PARAMETERS",799.34)

**END**
**END**
