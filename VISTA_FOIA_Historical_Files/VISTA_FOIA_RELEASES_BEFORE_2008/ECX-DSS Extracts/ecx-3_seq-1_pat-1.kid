Released ECX*3*1 SEQ #1
Extracted from mail message
**KIDS**:ECX*3.0*1^

**INSTALL NAME**
ECX*3.0*1
"BLD",979,0)
ECX*3.0*1^DSS EXTRACTS^0^2980219^y
"BLD",979,1,0)
^^2^2^2980219^^^^
"BLD",979,1,1,0)
DSS EXTRACTS v3.0
"BLD",979,1,2,0)
Enhancement Patch ECX*3.0*1
"BLD",979,4,0)
^9.64PA^727.811^7
"BLD",979,4,727.802,0)
727.802
"BLD",979,4,727.802,2,0)
^9.641^727.802^1
"BLD",979,4,727.802,2,727.802,0)
ADMISSION EXTRACT  (File-top level)
"BLD",979,4,727.802,2,727.802,1,0)
^9.6411^36^1
"BLD",979,4,727.802,2,727.802,1,36,0)
PRIMARY WARD PROVIDER
"BLD",979,4,727.802,222)
y^n^p^^^^n
"BLD",979,4,727.803,0)
727.803
"BLD",979,4,727.803,2,0)
^9.641^727.803^1
"BLD",979,4,727.803,2,727.803,0)
CLINIC EXTRACT  (File-top level)
"BLD",979,4,727.803,2,727.803,1,0)
^9.6411^30^1
"BLD",979,4,727.803,2,727.803,1,30,0)
PROVIDER PERSON CLASS
"BLD",979,4,727.803,222)
y^n^p^^^^n
"BLD",979,4,727.808,0)
727.808
"BLD",979,4,727.808,2,0)
^9.641^727.808^1
"BLD",979,4,727.808,2,727.808,0)
PHYSICAL MOVEMENT EXTRACT  (File-top level)
"BLD",979,4,727.808,2,727.808,1,0)
^9.6411^23^4
"BLD",979,4,727.808,2,727.808,1,16,0)
LOSING WARD LOS
"BLD",979,4,727.808,2,727.808,1,17,0)
PLACEHOLDER1
"BLD",979,4,727.808,2,727.808,1,22,0)
PLACEHOLDER2
"BLD",979,4,727.808,2,727.808,1,23,0)
PLACEHOLDER3
"BLD",979,4,727.808,222)
y^n^p^^^^n
"BLD",979,4,727.811,0)
727.811
"BLD",979,4,727.811,2,0)
^9.641^727.811^1
"BLD",979,4,727.811,2,727.811,0)
SURGERY EXTRACT  (File-top level)
"BLD",979,4,727.811,2,727.811,1,0)
^9.6411^36^1
"BLD",979,4,727.811,2,727.811,1,36,0)
ADMISSION DATE
"BLD",979,4,727.811,222)
y^n^p^^^^n
"BLD",979,4,727.813,0)
727.813
"BLD",979,4,727.813,2,0)
^9.641^727.813^1
"BLD",979,4,727.813,2,727.813,0)
LABORATORY EXTRACT  (File-top level)
"BLD",979,4,727.813,2,727.813,1,0)
^9.6411^9^1
"BLD",979,4,727.813,2,727.813,1,9,0)
ACCESSION AREA
"BLD",979,4,727.813,222)
y^n^p^^^^n
"BLD",979,4,727.817,0)
727.817
"BLD",979,4,727.817,2,0)
^9.641^727.817^1
"BLD",979,4,727.817,2,727.817,0)
TREATING SPECIALTY CHANGE EXTRACT  (File-top level)
"BLD",979,4,727.817,2,727.817,1,0)
^9.6411^23^7
"BLD",979,4,727.817,2,727.817,1,14,0)
NEW TREATING SPECIALTY
"BLD",979,4,727.817,2,727.817,1,15,0)
LOSING TREATING SPECIALTY
"BLD",979,4,727.817,2,727.817,1,16,0)
LOSING TREATING SPECIALTY LOS
"BLD",979,4,727.817,2,727.817,1,17,0)
LOSING ATTENDING PHYSICIAN
"BLD",979,4,727.817,2,727.817,1,21,0)
NEW PRIMARY WARD PROVIDER
"BLD",979,4,727.817,2,727.817,1,22,0)
NEW ATTENDING PHYSICIAN
"BLD",979,4,727.817,2,727.817,1,23,0)
LOSING PRIMARY WARD PROVIDER
"BLD",979,4,727.817,222)
y^n^p^^^^n
"BLD",979,4,728.44,0)
728.44
"BLD",979,4,728.44,2,0)
^9.641^728.44^1
"BLD",979,4,728.44,2,728.44,0)
CLINICS AND STOP CODES  (File-top level)
"BLD",979,4,728.44,2,728.44,1,0)
^9.6411^5^1
"BLD",979,4,728.44,2,728.44,1,5,0)
ACTION TO SEND
"BLD",979,4,728.44,222)
y^n^p^^^^n
"BLD",979,4,"APDD",727.802,727.802)

"BLD",979,4,"APDD",727.802,727.802,36)

"BLD",979,4,"APDD",727.803,727.803)

"BLD",979,4,"APDD",727.803,727.803,30)

"BLD",979,4,"APDD",727.808,727.808)

"BLD",979,4,"APDD",727.808,727.808,16)

"BLD",979,4,"APDD",727.808,727.808,17)

"BLD",979,4,"APDD",727.808,727.808,22)

"BLD",979,4,"APDD",727.808,727.808,23)

"BLD",979,4,"APDD",727.811,727.811)

"BLD",979,4,"APDD",727.811,727.811,36)

"BLD",979,4,"APDD",727.813,727.813)

"BLD",979,4,"APDD",727.813,727.813,9)

"BLD",979,4,"APDD",727.817,727.817)

"BLD",979,4,"APDD",727.817,727.817,14)

"BLD",979,4,"APDD",727.817,727.817,15)

"BLD",979,4,"APDD",727.817,727.817,16)

"BLD",979,4,"APDD",727.817,727.817,17)

"BLD",979,4,"APDD",727.817,727.817,21)

"BLD",979,4,"APDD",727.817,727.817,22)

"BLD",979,4,"APDD",727.817,727.817,23)

"BLD",979,4,"APDD",728.44,728.44)

"BLD",979,4,"APDD",728.44,728.44,5)

"BLD",979,4,"B",727.802,727.802)

"BLD",979,4,"B",727.803,727.803)

"BLD",979,4,"B",727.808,727.808)

"BLD",979,4,"B",727.811,727.811)

"BLD",979,4,"B",727.813,727.813)

"BLD",979,4,"B",727.817,727.817)

"BLD",979,4,"B",728.44,728.44)

"BLD",979,"KRN",0)
^9.67PA^19^18
"BLD",979,"KRN",.4,0)
.4
"BLD",979,"KRN",.401,0)
.401
"BLD",979,"KRN",.402,0)
.402
"BLD",979,"KRN",.403,0)
.403
"BLD",979,"KRN",.5,0)
.5
"BLD",979,"KRN",.84,0)
.84
"BLD",979,"KRN",3.6,0)
3.6
"BLD",979,"KRN",3.8,0)
3.8
"BLD",979,"KRN",9.2,0)
9.2
"BLD",979,"KRN",9.8,0)
9.8
"BLD",979,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",979,"KRN",9.8,"NM",1,0)
ECXADM^^0^B13773285
"BLD",979,"KRN",9.8,"NM",2,0)
ECXALAB^^0^B32262841
"BLD",979,"KRN",9.8,"NM",3,0)
ECXATRT^^0^B47003204
"BLD",979,"KRN",9.8,"NM",4,0)
ECXFELOC^^0^B17442082
"BLD",979,"KRN",9.8,"NM",5,0)
ECXLABN^^0^B19550529
"BLD",979,"KRN",9.8,"NM",6,0)
ECXSCX^^0^B57684840
"BLD",979,"KRN",9.8,"NM",7,0)
ECXSURG^^0^B21312207
"BLD",979,"KRN",9.8,"NM",8,0)
ECXTRT^^0^B33058363
"BLD",979,"KRN",9.8,"NM",9,0)
ECXUTL^^0^B33509994
"BLD",979,"KRN",9.8,"NM","B","ECXADM",1)

"BLD",979,"KRN",9.8,"NM","B","ECXALAB",2)

"BLD",979,"KRN",9.8,"NM","B","ECXATRT",3)

"BLD",979,"KRN",9.8,"NM","B","ECXFELOC",4)

"BLD",979,"KRN",9.8,"NM","B","ECXLABN",5)

"BLD",979,"KRN",9.8,"NM","B","ECXSCX",6)

"BLD",979,"KRN",9.8,"NM","B","ECXSURG",7)

"BLD",979,"KRN",9.8,"NM","B","ECXTRT",8)

"BLD",979,"KRN",9.8,"NM","B","ECXUTL",9)

"BLD",979,"KRN",19,0)
19
"BLD",979,"KRN",19.1,0)
19.1
"BLD",979,"KRN",101,0)
101
"BLD",979,"KRN",409.61,0)
409.61
"BLD",979,"KRN",771,0)
771
"BLD",979,"KRN",869.2,0)
869.2
"BLD",979,"KRN",870,0)
870
"BLD",979,"KRN",8994,0)
8994
"BLD",979,"KRN","B",.4,.4)

"BLD",979,"KRN","B",.401,.401)

"BLD",979,"KRN","B",.402,.402)

"BLD",979,"KRN","B",.403,.403)

"BLD",979,"KRN","B",.5,.5)

"BLD",979,"KRN","B",.84,.84)

"BLD",979,"KRN","B",3.6,3.6)

"BLD",979,"KRN","B",3.8,3.8)

"BLD",979,"KRN","B",9.2,9.2)

"BLD",979,"KRN","B",9.8,9.8)

"BLD",979,"KRN","B",19,19)

"BLD",979,"KRN","B",19.1,19.1)

"BLD",979,"KRN","B",101,101)

"BLD",979,"KRN","B",409.61,409.61)

"BLD",979,"KRN","B",771,771)

"BLD",979,"KRN","B",869.2,869.2)

"BLD",979,"KRN","B",870,870)

"BLD",979,"KRN","B",8994,8994)

"BLD",979,"QUES",0)
^9.62^^
"BLD",979,"REQB",0)
^9.611^1^1
"BLD",979,"REQB",1,0)
DSS EXTRACTS 3.0^1
"BLD",979,"REQB","B","DSS EXTRACTS 3.0",1)

"FIA",727.802)
ADMISSION EXTRACT
"FIA",727.802,0)
^ECX(727.802,
"FIA",727.802,0,0)
727.802
"FIA",727.802,0,1)
y^n^p^^^^n
"FIA",727.802,0,10)

"FIA",727.802,0,11)

"FIA",727.802,0,"RLRO")

"FIA",727.802,0,"VR")
3.0^ECX
"FIA",727.802,727.802)
1
"FIA",727.802,727.802,36)

"FIA",727.803)
CLINIC EXTRACT
"FIA",727.803,0)
^ECX(727.803,
"FIA",727.803,0,0)
727.803
"FIA",727.803,0,1)
y^n^p^^^^n
"FIA",727.803,0,10)

"FIA",727.803,0,11)

"FIA",727.803,0,"RLRO")

"FIA",727.803,0,"VR")
3.0^ECX
"FIA",727.803,727.803)
1
"FIA",727.803,727.803,30)

"FIA",727.808)
PHYSICAL MOVEMENT EXTRACT
"FIA",727.808,0)
^ECX(727.808,
"FIA",727.808,0,0)
727.808
"FIA",727.808,0,1)
y^n^p^^^^n
"FIA",727.808,0,10)

"FIA",727.808,0,11)

"FIA",727.808,0,"RLRO")

"FIA",727.808,0,"VR")
3.0^ECX
"FIA",727.808,727.808)
1
"FIA",727.808,727.808,16)

"FIA",727.808,727.808,17)

"FIA",727.808,727.808,22)

"FIA",727.808,727.808,23)

"FIA",727.811)
SURGERY EXTRACT
"FIA",727.811,0)
^ECX(727.811,
"FIA",727.811,0,0)
727.811
"FIA",727.811,0,1)
y^n^p^^^^n
"FIA",727.811,0,10)

"FIA",727.811,0,11)

"FIA",727.811,0,"RLRO")

"FIA",727.811,0,"VR")
3.0^ECX
"FIA",727.811,727.811)
1
"FIA",727.811,727.811,36)

"FIA",727.813)
LABORATORY EXTRACT
"FIA",727.813,0)
^ECX(727.813,
"FIA",727.813,0,0)
727.813
"FIA",727.813,0,1)
y^n^p^^^^n
"FIA",727.813,0,10)

"FIA",727.813,0,11)

"FIA",727.813,0,"RLRO")

"FIA",727.813,0,"VR")
3.0^ECX
"FIA",727.813,727.813)
1
"FIA",727.813,727.813,9)

"FIA",727.817)
TREATING SPECIALTY CHANGE EXTRACT
"FIA",727.817,0)
^ECX(727.817,
"FIA",727.817,0,0)
727.817
"FIA",727.817,0,1)
y^n^p^^^^n
"FIA",727.817,0,10)

"FIA",727.817,0,11)

"FIA",727.817,0,"RLRO")

"FIA",727.817,0,"VR")
3.0^ECX
"FIA",727.817,727.817)
1
"FIA",727.817,727.817,14)

"FIA",727.817,727.817,15)

"FIA",727.817,727.817,16)

"FIA",727.817,727.817,17)

"FIA",727.817,727.817,21)

"FIA",727.817,727.817,22)

"FIA",727.817,727.817,23)

"FIA",728.44)
CLINICS AND STOP CODES
"FIA",728.44,0)
^ECX(728.44,
"FIA",728.44,0,0)
728.44P
"FIA",728.44,0,1)
y^n^p^^^^n
"FIA",728.44,0,10)

"FIA",728.44,0,11)

"FIA",728.44,0,"RLRO")

"FIA",728.44,0,"VR")
3.0^ECX
"FIA",728.44,728.44)
1
"FIA",728.44,728.44,5)

"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
1^2980219
"PKG",513,22,1,"PAH",1,1,0)
^^2^2^2980219
"PKG",513,22,1,"PAH",1,1,1,0)
DSS EXTRACTS v3.0
"PKG",513,22,1,"PAH",1,1,2,0)
Enhancement Patch ECX*3.0*1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","ECXADM")
0^1^B13773285
"RTN","ECXADM",1,0)
ECXADM ;BIR/DMA,CML,PTD-Admissions Extract ; [ 11/25/96  11:21 AM ]
"RTN","ECXADM",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXADM",3,0)
BEG ;entry point from option
"RTN","ECXADM",4,0)
 D SETUP,^ECXTRAC,^ECXKILL Q
"RTN","ECXADM",5,0)
 ;
"RTN","ECXADM",6,0)
START ; start package specific extract
"RTN","ECXADM",7,0)
 S QFLG=0
"RTN","ECXADM",8,0)
 K ECXDD D FIELD^DID(405,.19,,"SPECIFIER","ECXDD") S ECPRO=$E(+$P(ECXDD("SPECIFIER"),"P",2)) K ECXDD
"RTN","ECXADM",9,0)
 S ECED=ECED+.3
"RTN","ECXADM",10,0)
 S ECD=ECSD1 F  S ECD=$O(^DGPM("ATT1",ECD)),ECDA=0 Q:'ECD  Q:ECD>ECED  F  S ECDA=$O(^DGPM("ATT1",ECD,ECDA)) Q:'ECDA  I $D(^DGPM(ECDA,0)) S EC=^(0),DFN=$P(EC,"^",3) I $D(^DPT(DFN,0)) S D0=^(0) D GET Q:QFLG
"RTN","ECXADM",11,0)
 Q
"RTN","ECXADM",12,0)
 ;
"RTN","ECXADM",13,0)
GET ;
"RTN","ECXADM",14,0)
 S ECTM=$$ECXTIME^ECXUTL(ECD)
"RTN","ECXADM",15,0)
 I $T(OUTPTPR^SDUTL3)[",SCDATE" D
"RTN","ECXADM",16,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN,ECD) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN,ECD) S:ECPTPR=0 ECPTPR=""
"RTN","ECXADM",17,0)
 I $T(OUTPTPR^SDUTL3)'[",SCDATE" D
"RTN","ECXADM",18,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN) S:ECPTPR=0 ECPTPR=""
"RTN","ECXADM",19,0)
 S ECODE=DFN_"^"_$P(D0,"^",9)_"^"_$E($P($P(D0,"^"),",")_"    ",1,4)_"^3^"_$$ECXDATE^ECXUTL(ECD,ECXYM)_"^"_ECPTTM_"^"_$P(D0,"^",2)_"^"_$$ECXDOB^ECXUTL($P(D0,"^",3))_"^"_$P(D0,"^",8)_"^"_$P($G(^DPT(DFN,.311)),"^",15)_"^"_+$$INSURED^IBCNS1(DFN,ECD)
"RTN","ECXADM",20,0)
 S D1=$G(^DPT(DFN,.11)),ECSTA=$P(D1,"^",5),STATE=$S(ECSTA:$P(^DIC(5,ECSTA,0),"^",3),1:"")
"RTN","ECXADM",21,0)
 S ECCTY=$P(D1,"^",7),COUNTY=$S(ECCTY:$P(^DIC(5,ECSTA,1,ECCTY,0),"^",3),1:"")
"RTN","ECXADM",22,0)
 S ECODE=ECODE_"^"_STATE_"^"_COUNTY_"^"_$P(D1,"^",6),D1=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),"^",9) I D1 S D1=$C(D1+64)
"RTN","ECXADM",23,0)
 S ECM=$P($G(^DG(408.32,+$P(D0,"^",14),0)),"^",2)
"RTN","ECXADM",24,0)
 S ECODE=ECODE_"^"_D1_"^"_$P($G(^DPT(DFN,"VET")),"^")_"^"_$P($G(^DPT(DFN,.321))_"^^^^","^",1,3)_"^"_$P($G(^DPT(DFN,.52)),"^",5)_"^"_$P($G(^DIC(21,+$P($G(^DPT(DFN,.32)),"^",3),0)),"^",3)_"^"_ECM_"^"_$P(D0,"^",5)
"RTN","ECXADM",25,0)
 S W=$P(EC,"^",6),FAC=$P($G(^DIC(42,+W,0)),"^",11),W=$P($G(^DIC(42,+W,44)),"^")
"RTN","ECXADM",26,0)
 S ECTS="" F J=1:1:10 S ECT1=$G(^DGPM(ECDA+J,0)) I $P(ECT1,"^",14)=ECDA,$P(ECT1,"^",2)=6 S ECTS=ECT1 Q
"RTN","ECXADM",27,0)
 Q:ECTS=""
"RTN","ECXADM",28,0)
 ;get corresponding Treating specialty - should be the next one, but must be close
"RTN","ECXADM",29,0)
 S ECODE=FAC_"^"_ECODE_"^"_W_"^"_$P($G(^DIC(45.7,+$P(ECTS,"^",9),0)),"^",2)_"^"_ECPRO_$P(ECTS,"^",19)_"^"_ECDA
"RTN","ECXADM",30,0)
 S (ECDRG,ECDIA)="",ECPTF=+$P(EC,"^",16) I ECPTF,$D(^DGPT(ECPTF,"M")) D PTF S ECODE=ECODE_"^"_ECDRG_"^"_ECDIA
"RTN","ECXADM",31,0)
 S ECXPRV="",ECXPRV=$P(ECTS,"^",8) S:ECXPRV]"" ECXPRV=ECPRO_ECXPRV
"RTN","ECXADM",32,0)
 S $P(ECODE,"^",31)=ECTM,$P(ECODE,"^",32)=ECPTPR,$P(ECODE,"^",33)=$P($G(^DIC(10,+$P(D0,"^",6),0)),"^",2)_"^"_ECXPRV_"^"
"RTN","ECXADM",33,0)
 ;facility^dfn^ssn^name^in/out^day^primary care team^sex^dob^religion^employment status^health ins^state^county^zip^eligibility^
"RTN","ECXADM",34,0)
 ;vet^vietnam^agent orange^radiation^pow^period of service^means test^marital status^ward^treating specialty^
"RTN","ECXADM",35,0)
 ;attending physician^mov #^DRG^diagnosis^time^primary care provider^race^primary ward provider
"RTN","ECXADM",36,0)
FILE S EC7=-$O(^ECX(ECFILE,"AINV","")) F  S EC7=EC7+1 Q:'$D(^ECX(ECFILE,EC7))
"RTN","ECXADM",37,0)
 S ^ECX(ECFILE,EC7,0)=EC7_"^"_EC23_"^"_ECODE,ECRN=ECRN+1 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXADM",38,0)
 I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXADM",39,0)
 Q
"RTN","ECXADM",40,0)
 ;
"RTN","ECXADM",41,0)
PTF ; get admitting DRG and diagnosis from PTF
"RTN","ECXADM",42,0)
 ;use number for DRG and .01 for diagnosis
"RTN","ECXADM",43,0)
 S EC=1 I $D(^DGPT(ECPTF,"M",2,0)) S EC=2
"RTN","ECXADM",44,0)
 S EC1=+$P(^DGPT(ECPTF,"M",EC,0),"^",5),ECDRG=$P($G(^DGPT(ECPTF,"M",EC,"P")),"^")
"RTN","ECXADM",45,0)
 S ECDIA=$P($G(^ICD9(EC1,0)),"^") Q
"RTN","ECXADM",46,0)
 ;
"RTN","ECXADM",47,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXADM",48,0)
 S ECPACK="Admission",ECPIECE=13,ECRTN="START^ECXADM",ECGRP="ADMS",ECHEAD="ADM",ECFILE=727.802,ECVER=7
"RTN","ECXADM",49,0)
 Q
"RTN","ECXADM",50,0)
 ;
"RTN","ECXADM",51,0)
LOCAL ; to extract nightly for local use not to be transmitted to TSI
"RTN","ECXADM",52,0)
 ; should be queued with a 1D frequency
"RTN","ECXADM",53,0)
 D SETUP,^ECXTLOCL,^ECXKILL Q
"RTN","ECXADM",54,0)
 ;
"RTN","ECXADM",55,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXADM",56,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXADM",57,0)
 ;
"RTN","ECXALAB")
0^2^B32262841
"RTN","ECXALAB",1,0)
ECXALAB ;ALB/JAP - ECS Extract Audit Report ;Oct 23, 1997
"RTN","ECXALAB",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXALAB",3,0)
 ;
"RTN","ECXALAB",4,0)
EN ;entry point for LAB extract audit report
"RTN","ECXALAB",5,0)
 ;this audit report can be used for extracts done with
"RTN","ECXALAB",6,0)
 ;either ECXLABN or ECXLABO
"RTN","ECXALAB",7,0)
 N %X,%Y,X,Y,DIC,DA,DR,DIQ,DIR
"RTN","ECXALAB",8,0)
 S ECXERR=0
"RTN","ECXALAB",9,0)
 ;ecxaud=0 for 'extract' audit
"RTN","ECXALAB",10,0)
 S ECXHEAD="LAB",ECXAUD=0
"RTN","ECXALAB",11,0)
 W !!,"Setup for ",ECXHEAD," Extract Audit Report --",!!
"RTN","ECXALAB",12,0)
 ;select extract
"RTN","ECXALAB",13,0)
 D AUDIT^ECXUTLA(ECXHEAD,.ECXERR,.ECXARRAY,ECXAUD)
"RTN","ECXALAB",14,0)
 Q:ECXERR
"RTN","ECXALAB",15,0)
 W !!
"RTN","ECXALAB",16,0)
 ;get the dss site name for report header
"RTN","ECXALAB",17,0)
 S ECXALL=1 D DEFAULT^ECXDVSN(.ECXDIV,ECXALL,.ECXERR)
"RTN","ECXALAB",18,0)
 Q:ECXERR=1
"RTN","ECXALAB",19,0)
 S DIR(0)="Y",DIR("A")="Do you want the "_ECXHEAD_" extract audit report for all Accession Areas"
"RTN","ECXALAB",20,0)
 S DIR("B")="NO" D ^DIR K DIR
"RTN","ECXALAB",21,0)
 I $G(DIRUT) S ECXERR=1 Q
"RTN","ECXALAB",22,0)
 ;if y=0 i.e., 'no', then ecxall=0 i.e., 'selected'
"RTN","ECXALAB",23,0)
 S ECXALL=Y
"RTN","ECXALAB",24,0)
 I ECXERR=1 D  Q
"RTN","ECXALAB",25,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXALAB",26,0)
 .D AUDIT^ECXKILL
"RTN","ECXALAB",27,0)
 ;select accession areas; all accession areas if ecxall=1
"RTN","ECXALAB",28,0)
 S X=ECXARRAY("START") D ^%DT S ECXSTART=Y S X=ECXARRAY("END") D ^%DT S ECXEND=Y
"RTN","ECXALAB",29,0)
 D LAB^ECXDVSN1(.ECXACC,ECXALL,.ECXERR)
"RTN","ECXALAB",30,0)
 I ECXERR=1 D  Q
"RTN","ECXALAB",31,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXALAB",32,0)
 .D AUDIT^ECXKILL
"RTN","ECXALAB",33,0)
 ;determine output device and queue if requested
"RTN","ECXALAB",34,0)
 W !
"RTN","ECXALAB",35,0)
 S ECXPGM="PROCESS^ECXALAB",ECXDESC="LAB Extract Audit Report"
"RTN","ECXALAB",36,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXALL")="",ECXSAVE("ECXACC(")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")=""
"RTN","ECXALAB",37,0)
 W !
"RTN","ECXALAB",38,0)
 D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE)
"RTN","ECXALAB",39,0)
 I ECXSAVE("POP")=1 D  Q
"RTN","ECXALAB",40,0)
 .W !!,?5,"Try agian later... exiting.",!
"RTN","ECXALAB",41,0)
 .D AUDIT^ECXKILL
"RTN","ECXALAB",42,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXALAB",43,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXALAB",44,0)
 .D PROCESS^ECXALAB
"RTN","ECXALAB",45,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXALAB",46,0)
 D HOME^%ZIS
"RTN","ECXALAB",47,0)
 D AUDIT^ECXKILL
"RTN","ECXALAB",48,0)
 Q
"RTN","ECXALAB",49,0)
 ;
"RTN","ECXALAB",50,0)
PROCESS ;process data in file #727.813
"RTN","ECXALAB",51,0)
 N X,Y,JJ,LMIP,IEN,DATA,DATE,ACC,ACCNM,WKLDNM,WKLD,FILE,QQFLG,CNT
"RTN","ECXALAB",52,0)
 K ^TMP($J,"ECXAUD")
"RTN","ECXALAB",53,0)
 S (CNT,QQFLG)=0
"RTN","ECXALAB",54,0)
 ;see if site is using lmip codes
"RTN","ECXALAB",55,0)
 S LMIP=+$G(^ECX(728,1,"LMIP"))
"RTN","ECXALAB",56,0)
 S ECXEXT=ECXARRAY("EXTRACT"),ECXDEF=ECXARRAY("DEF")
"RTN","ECXALAB",57,0)
 S X=ECXARRAY("START") D ^%DT S ECXSTART=Y S X=ECXARRAY("END") D ^%DT S ECXEND=Y
"RTN","ECXALAB",58,0)
 ;get run date in external format
"RTN","ECXALAB",59,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXALAB",60,0)
 ;setup acc. area array by name
"RTN","ECXALAB",61,0)
 S ACC="" F  S ACC=$O(ECXACC(ACC)) Q:ACC=""  D
"RTN","ECXALAB",62,0)
 .S ACCNM=$P(ECXACC(ACC),U,1),ACCAB=$P(ECXACC(ACC),U,2),ACC(ACCAB)=ACCNM_" ("_ACCAB_")"
"RTN","ECXALAB",63,0)
 ;get records within date range and accession area
"RTN","ECXALAB",64,0)
 S IEN="" F  S IEN=$O(^ECX(727.813,"AC",ECXEXT,IEN)) Q:IEN=""  D  Q:QQFLG
"RTN","ECXALAB",65,0)
 .S DATA=^ECX(727.813,IEN,0),DATE=$P(DATA,U,9),ACC=$P(DATA,U,11)
"RTN","ECXALAB",66,0)
 .;convert free text date to fm internal format date
"RTN","ECXALAB",67,0)
 .S $E(DATE,1,2)=$E(DATE,1,2)-17
"RTN","ECXALAB",68,0)
 .Q:$L(DATE)<7  Q:(DATE<ECXSTART)  Q:(DATE>ECXEND)
"RTN","ECXALAB",69,0)
 .Q:'$D(ACC(ACC))
"RTN","ECXALAB",70,0)
 .S ACCNM=$P(ACC(ACC),U,1)
"RTN","ECXALAB",71,0)
 .S WKLD="",WKLD=$P(DATA,U,20) D
"RTN","ECXALAB",72,0)
 ..S WKLDNM="" I WKLD]"" S X=WKLD,DIC="^LAM(",DIC(0)="MX" D ^DIC S WKLDNM=$P(Y,U,2)
"RTN","ECXALAB",73,0)
 ..I WKLD="" S:LMIP=1 WKLD="Unknown" S:LMIP=0 WKLD="NA"
"RTN","ECXALAB",74,0)
 ..I WKLDNM="" S WKLDNM="Unknown "_WKLD
"RTN","ECXALAB",75,0)
 .S FILE=$P(DATA,U,18)
"RTN","ECXALAB",76,0)
 .Q:((FILE'=2)&(FILE'=67))
"RTN","ECXALAB",77,0)
 .I '$D(^TMP($J,"ECXAUD",ACCNM,WKLDNM)) S ^TMP($J,"ECXAUD",ACCNM,WKLDNM)=0_U_0_U_WKLD
"RTN","ECXALAB",78,0)
 .I FILE=2 S $P(^(WKLDNM),U,1)=$P(^TMP($J,"ECXAUD",ACCNM,WKLDNM),U,1)+1,CNT=CNT+1
"RTN","ECXALAB",79,0)
 .I FILE=67 S $P(^(WKLDNM),U,2)=$P(^TMP($J,"ECXAUD",ACCNM,WKLDNM),U,2)+1,CNT=CNT+1
"RTN","ECXALAB",80,0)
 .I $D(ZTQUEUED),(CNT>499),'(CNT#500),$$S^%ZTLOAD S QQFLG=1,ZTSTOP=1 K ZTREQ
"RTN","ECXALAB",81,0)
 ;print the report
"RTN","ECXALAB",82,0)
 D PRINT
"RTN","ECXALAB",83,0)
 D AUDIT^ECXKILL
"RTN","ECXALAB",84,0)
 Q
"RTN","ECXALAB",85,0)
 ;
"RTN","ECXALAB",86,0)
PRINT ;print the LAB audit report by accession area and test
"RTN","ECXALAB",87,0)
 N SS,LN,PG,QFLG,TOTP,TOTR,GTOT,DIV,DIVNM,ACCAB,DIR,DR,DIRUT,DTOUT,DUOUT
"RTN","ECXALAB",88,0)
 U IO
"RTN","ECXALAB",89,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXALAB",90,0)
 S (QFLG,PG)=0,$P(LN,"-",80)="",ACCAB="",DIV="",DIV=$O(ECXDIV(DIV)) D HEADER
"RTN","ECXALAB",91,0)
 F  S ACCAB=$O(ACC(ACCAB)) Q:ACCAB=""  D  Q:QFLG
"RTN","ECXALAB",92,0)
 .S ACCNM=ACC(ACCAB),GTOT("P")=0,GTOT("R")=0
"RTN","ECXALAB",93,0)
 .;write the accession area name
"RTN","ECXALAB",94,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG  W !,ACCNM
"RTN","ECXALAB",95,0)
 .I '$D(^TMP($J,"ECXAUD",ACCNM)) D  Q
"RTN","ECXALAB",96,0)
 ..W !,?3,"No data available for this Accession Area.",!!
"RTN","ECXALAB",97,0)
 .I $D(^TMP($J,"ECXAUD",ACCNM)) S WKLDNM="" F  S WKLDNM=$O(^TMP($J,"ECXAUD",ACCNM,WKLDNM)) Q:WKLDNM=""  D  Q:QFLG
"RTN","ECXALAB",98,0)
 ..S TOTP=$P(^TMP($J,"ECXAUD",ACCNM,WKLDNM),U,1),TOTR=$P(^(WKLDNM),U,2),WKLD=$P(^(WKLDNM),U,3)
"RTN","ECXALAB",99,0)
 ..S GTOT("P")=GTOT("P")+TOTP,GTOT("R")=GTOT("R")+TOTR
"RTN","ECXALAB",100,0)
 ..;write the test data
"RTN","ECXALAB",101,0)
 ..D:($Y+3>IOSL) HEADER Q:QFLG  W !,?3,$E(WKLDNM,1,36),?40,WKLD,?56,$$RJ^XLFSTR(TOTP,5," "),?68,$$RJ^XLFSTR(TOTR,5," ")
"RTN","ECXALAB",102,0)
 .;write the accession area grandtotal
"RTN","ECXALAB",103,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG  W !,?3,$E(LN,1,70)
"RTN","ECXALAB",104,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG  W !,"Total for "_ACCNM_":",?56,$$RJ^XLFSTR(GTOT("P"),5," "),?68,$$RJ^XLFSTR(GTOT("R"),5," "),!!
"RTN","ECXALAB",105,0)
 ;print the audit descriptive narrative
"RTN","ECXALAB",106,0)
 I $E(IOST)'="C" D
"RTN","ECXALAB",107,0)
 .W @IOF S PG=PG+1
"RTN","ECXALAB",108,0)
 .W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXALAB",109,0)
 .W !,"DSS Extract Log #:    "_ECXEXT
"RTN","ECXALAB",110,0)
 .W !,"Date Range of Audit:  "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXALAB",111,0)
 .W !,"Report Run Date/Time: "_ECXRUN,?68,"Page: ",PG
"RTN","ECXALAB",112,0)
 .W !!,LN,!!
"RTN","ECXALAB",113,0)
 .S DIC="^ECX(727.1,",DA=ECXARRAY("DEF"),DR="1" D EN^DIQ
"RTN","ECXALAB",114,0)
 I $E(IOST)="C",'QFLG D
"RTN","ECXALAB",115,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXALAB",116,0)
 .S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXALAB",117,0)
 Q
"RTN","ECXALAB",118,0)
 ;
"RTN","ECXALAB",119,0)
HEADER ;header and page control
"RTN","ECXALAB",120,0)
 N JJ,SS
"RTN","ECXALAB",121,0)
 I $E(IOST)="C" D
"RTN","ECXALAB",122,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXALAB",123,0)
 .I PG>0 S DIR(0)="E" W ! D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXALAB",124,0)
 Q:QFLG
"RTN","ECXALAB",125,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXALAB",126,0)
 W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXALAB",127,0)
 W !,"DSS Extract Log #:    "_ECXARRAY("EXTRACT")
"RTN","ECXALAB",128,0)
 W !,"Date Range of Audit:  "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXALAB",129,0)
 W !,"Report Run Date/Time: "_ECXRUN
"RTN","ECXALAB",130,0)
 W !,"DSS Site:             "_$P(ECXDIV(DIV),U,2)_" ("_$P(ECXDIV(DIV),U,3)_")",?68,"Page: "_PG
"RTN","ECXALAB",131,0)
 W !!,"Accession Area (Feeder Location)",?40,"LMIP",?56,"# of Tests",?68,"# of Tests"
"RTN","ECXALAB",132,0)
 W !,?3,"Procedure",?40,"Code",?56,"(Patients)",?68,"(Referrals)"
"RTN","ECXALAB",133,0)
 W !,LN,!
"RTN","ECXALAB",134,0)
 Q
"RTN","ECXATRT")
0^3^B47003204
"RTN","ECXATRT",1,0)
ECXATRT ;ALB/JAP - TRT Extract Audit Report ;Oct 16, 1997
"RTN","ECXATRT",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXATRT",3,0)
 ;
"RTN","ECXATRT",4,0)
EN ;entry point for TRT extract audit report
"RTN","ECXATRT",5,0)
 N %X,%Y,X,Y,DIC,DA,DR,DIQ,DIR
"RTN","ECXATRT",6,0)
 S ECXERR=0
"RTN","ECXATRT",7,0)
 ;ecxaud=0 for 'extract' audit
"RTN","ECXATRT",8,0)
 S ECXHEAD="TRT",ECXAUD=0
"RTN","ECXATRT",9,0)
 W !!,"Setup for ",ECXHEAD," Extract Audit Report --",!!
"RTN","ECXATRT",10,0)
 ;select extract
"RTN","ECXATRT",11,0)
 D AUDIT^ECXUTLA(ECXHEAD,.ECXERR,.ECXARRAY,ECXAUD)
"RTN","ECXATRT",12,0)
 Q:ECXERR
"RTN","ECXATRT",13,0)
 ;currently, this extract does not capture divisional data
"RTN","ECXATRT",14,0)
 S ECXALL=1
"RTN","ECXATRT",15,0)
 D TRT^ECXDVSN(.ECXDIV,ECXALL,.ECXERR)
"RTN","ECXATRT",16,0)
 I ECXERR=1 D  Q
"RTN","ECXATRT",17,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXATRT",18,0)
 .D AUDIT^ECXKILL
"RTN","ECXATRT",19,0)
 ;determine output device and queue if requested
"RTN","ECXATRT",20,0)
 W !
"RTN","ECXATRT",21,0)
 S ECXPGM="PROCESS^ECXATRT",ECXDESC="TRT Extract Audit Report"
"RTN","ECXATRT",22,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXALL")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")=""
"RTN","ECXATRT",23,0)
 W !
"RTN","ECXATRT",24,0)
 D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE)
"RTN","ECXATRT",25,0)
 I ECXSAVE("POP")=1 D  Q
"RTN","ECXATRT",26,0)
 .W !!,?5,"Try agian later... exiting.",!
"RTN","ECXATRT",27,0)
 .D AUDIT^ECXKILL
"RTN","ECXATRT",28,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXATRT",29,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXATRT",30,0)
 .D PROCESS^ECXATRT
"RTN","ECXATRT",31,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXATRT",32,0)
 D HOME^%ZIS
"RTN","ECXATRT",33,0)
 D AUDIT^ECXKILL
"RTN","ECXATRT",34,0)
 Q
"RTN","ECXATRT",35,0)
 ;
"RTN","ECXATRT",36,0)
PROCESS ;process data in file #727.817
"RTN","ECXATRT",37,0)
 N X,Y,W,DATA,DATE,DIV,IEN,TS,SPEC,FTS,FTSNM,SERV,ECX,QQFLG,CNT,A1,A2,NUM,MN,NEWFTS,NEWSPEC
"RTN","ECXATRT",38,0)
 K ^TMP($J,"ECXAUD"),^TMP($J,"ECXSPEC")
"RTN","ECXATRT",39,0)
 S (QQFLG,CNT)=0
"RTN","ECXATRT",40,0)
 S ECXEXT=ECXARRAY("EXTRACT"),ECXDEF=ECXARRAY("DEF")
"RTN","ECXATRT",41,0)
 S X=ECXARRAY("START") D ^%DT S ECXSTART=Y S X=ECXARRAY("END") D ^%DT S ECXEND=Y
"RTN","ECXATRT",42,0)
 ;get run date in external format
"RTN","ECXATRT",43,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXATRT",44,0)
 ;set up the specialty array for site/division
"RTN","ECXATRT",45,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXATRT",46,0)
 S DIV="" F  S DIV=$O(ECXDIV(DIV)) Q:DIV=""  D
"RTN","ECXATRT",47,0)
 .S DIC="^DIC(42.4,",DR=".01;3",DIQ(0)="E",DIQ="ECX"
"RTN","ECXATRT",48,0)
 .S SPEC="" F  S SPEC=$O(^DIC(42.4,"B",SPEC)) Q:SPEC=""  S TS=$O(^(SPEC,0)) D
"RTN","ECXATRT",49,0)
 ..K ECX S DA=TS D EN^DIQ1
"RTN","ECXATRT",50,0)
 ..S SPEC=$G(ECX(42.4,TS,.01,"E")),SERV=$G(ECX(42.4,TS,3,"E")) S:SERV="" SERV="Unknown"
"RTN","ECXATRT",51,0)
 ..S ^TMP($J,"ECXSPEC",DIV,TS)=0_U_SERV_U_SPEC
"RTN","ECXATRT",52,0)
 ;set up the specialty to facility treating specialty conversion array;
"RTN","ECXATRT",53,0)
 ;determine if active between ecxstart and ecxend;
"RTN","ECXATRT",54,0)
 ;ignore if facility treating specialty not active within date range of report;
"RTN","ECXATRT",55,0)
 S DIC="^DIC(45.7,",DR=".01;1",DIQ(0)="I",DIQ="ECX"
"RTN","ECXATRT",56,0)
 S FTSNM="" F  S FTSNM=$O(^DIC(45.7,"B",FTSNM)) Q:FTSNM=""  S FTS=$O(^(FTSNM,0)) D
"RTN","ECXATRT",57,0)
 .K ECX S DA=FTS D EN^DIQ1
"RTN","ECXATRT",58,0)
 .S FTSNM=$G(ECX(45.7,FTS,.01,"I")),TS=$G(ECX(45.7,FTS,1,"I"))
"RTN","ECXATRT",59,0)
 .Q:TS=""
"RTN","ECXATRT",60,0)
 .S A1=$$ACTIVE^DGACT(45.7,FTS,ECXSTART),A2=$$ACTIVE^DGACT(45.7,FTS,ECXEND)
"RTN","ECXATRT",61,0)
 .Q:A1=0&(A2=0)
"RTN","ECXATRT",62,0)
 .;num(ts) will hold the number of facility treat. specialties associated with this
"RTN","ECXATRT",63,0)
 .;national specialty.
"RTN","ECXATRT",64,0)
 .I '$D(NUM(TS)) S NUM(TS)=0
"RTN","ECXATRT",65,0)
 .S ^TMP($J,"ECXTS",TS,FTS)=FTSNM,^TMP($J,"ECXREVTS",FTS)=TS,NUM(TS)=NUM(TS)+1
"RTN","ECXATRT",66,0)
 ;get extract records in date range
"RTN","ECXATRT",67,0)
 S IEN="" F  S IEN=$O(^ECX(727.817,"AC",ECXEXT,IEN)) Q:IEN=""  D  Q:QQFLG
"RTN","ECXATRT",68,0)
 .S DATA=^ECX(727.817,IEN,0),DATE=$P(DATA,U,9),DIV=$P(DATA,U,4)
"RTN","ECXATRT",69,0)
 .;currently the 4th piece of extract record is always null for trt
"RTN","ECXATRT",70,0)
 .S:DIV="" DIV=1
"RTN","ECXATRT",71,0)
 .;convert free text date to fm internal format date
"RTN","ECXATRT",72,0)
 .S $E(DATE,1,2)=$E(DATE,1,2)-17
"RTN","ECXATRT",73,0)
 .Q:$L(DATE)<7  Q:(DATE<ECXSTART)  Q:(DATE>ECXEND)
"RTN","ECXATRT",74,0)
 .I $D(ECXDIV(DIV)) D
"RTN","ECXATRT",75,0)
 ..;ts is the old specialty, newfts is the new facility treat. spec. for the movement date;
"RTN","ECXATRT",76,0)
 ..;after patch #1 'losing treating specialty los' field (#17) is non-null only for actual specialty changes;
"RTN","ECXATRT",77,0)
 ..;so should be able to distinguish true ts changes from provider-only changes;
"RTN","ECXATRT",78,0)
 ..;although it will still be possible that old and new specialty are the same, but facility
"RTN","ECXATRT",79,0)
 ..;treat. spec. was changed, but we've lost that info in the extract.
"RTN","ECXATRT",80,0)
 ..;
"RTN","ECXATRT",81,0)
 ..;filter out those records which are definitely provider-only changes;
"RTN","ECXATRT",82,0)
 ..;these are the records that have 'losing treating specialty los' which is null;
"RTN","ECXATRT",83,0)
 ..;but for extracts done prior to patch #1, still need to compare old & new specialty.
"RTN","ECXATRT",84,0)
 ..S NEWTS=$P(DATA,U,15),TS=$P(DATA,U,16),LOS=$P(DATA,U,17)
"RTN","ECXATRT",85,0)
 ..;leaving this next line in here for v3.0 extracts done prior to patch #1
"RTN","ECXATRT",86,0)
 ..Q:(NUM(TS)=1)&(NEWTS=TS)
"RTN","ECXATRT",87,0)
 ..Q:LOS=""
"RTN","ECXATRT",88,0)
 ..S $P(^(TS),U,1)=$P(^TMP($J,"ECXSPEC",DIV,TS),U,1)+1,CNT=CNT+1
"RTN","ECXATRT",89,0)
 ..I $D(ZTQUEUED),(CNT>499),'(CNT#500),$$S^%ZTLOAD S QQFLG=1,ZTSTOP=1 K ZTREQ
"RTN","ECXATRT",90,0)
 ;after all extract records processed, arrange by service and specialty;
"RTN","ECXATRT",91,0)
 ;total can only be associated with specialty, not facility treating specialty;
"RTN","ECXATRT",92,0)
 ;include specialty only if total loss is non-zero
"RTN","ECXATRT",93,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXATRT",94,0)
 S DIV="" F  S DIV=$O(ECXDIV(DIV)) Q:DIV=""  I $D(^TMP($J,"ECXSPEC",DIV)) D
"RTN","ECXATRT",95,0)
 .S TS="" F  S TS=$O(^TMP($J,"ECXSPEC",DIV,TS)) Q:TS=""  D
"RTN","ECXATRT",96,0)
 ..S TOT=+$P(^TMP($J,"ECXSPEC",DIV,TS),U,1) I TOT>0 D
"RTN","ECXATRT",97,0)
 ...S SERV=$P(^(TS),U,2),SPEC=$P(^(TS),U,3)
"RTN","ECXATRT",98,0)
 ...S ^TMP($J,"ECXAUD",DIV,SERV,SPEC)=TOT_U_TS
"RTN","ECXATRT",99,0)
 ;print the report
"RTN","ECXATRT",100,0)
 D PRINT
"RTN","ECXATRT",101,0)
 D AUDIT^ECXKILL
"RTN","ECXATRT",102,0)
 Q
"RTN","ECXATRT",103,0)
 ;
"RTN","ECXATRT",104,0)
PRINT ;print trt data by site, by service, by specialty
"RTN","ECXATRT",105,0)
 N JJ,SS,LN,P,DIV,DIVNM,GTOT,SVCTOT,PG,QFLG,DIR,DIRUT,DTOUT,DUOUT
"RTN","ECXATRT",106,0)
 U IO
"RTN","ECXATRT",107,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXATRT",108,0)
 S (QFLG,PG)=0,$P(LN,"-",80)=""
"RTN","ECXATRT",109,0)
 ;division associated with the treat. spec. change is not actually known; division is dss site
"RTN","ECXATRT",110,0)
 S DIV="" S DIV=$O(ECXDIV(DIV)) Q:DIV=""  S GTOT=0
"RTN","ECXATRT",111,0)
 D HEADER
"RTN","ECXATRT",112,0)
 I '$D(^TMP($J,"ECXAUD",DIV)) D  Q
"RTN","ECXATRT",113,0)
 .W !!,?5,"No data available for this DSS Site.",!!
"RTN","ECXATRT",114,0)
 I $D(^TMP($J,"ECXAUD",DIV)) S SERV="" F  S SERV=$O(^TMP($J,"ECXAUD",DIV,SERV)) Q:SERV=""  D  Q:QFLG
"RTN","ECXATRT",115,0)
 .S SVCTOT=0
"RTN","ECXATRT",116,0)
 .;write the service name
"RTN","ECXATRT",117,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG  W !,SERV
"RTN","ECXATRT",118,0)
 .S SPEC="" F  S SPEC=$O(^TMP($J,"ECXAUD",DIV,SERV,SPEC)) Q:SPEC=""  D  Q:QFLG
"RTN","ECXATRT",119,0)
 ..;write the specialty name and total
"RTN","ECXATRT",120,0)
 ..S TOT=$P(^TMP($J,"ECXAUD",DIV,SERV,SPEC),U,1),TS=$P(^(SPEC),U,2)
"RTN","ECXATRT",121,0)
 ..W ?22,$E(SPEC,1,30)_" ("_TS_")",?68,$$RJ^XLFSTR(TOT,5," "),!
"RTN","ECXATRT",122,0)
 ..S SVCTOT=SVCTOT+TOT,GTOT=GTOT+TOT
"RTN","ECXATRT",123,0)
 ..S FTS="" F  S FTS=$O(^TMP($J,"ECXTS",TS,FTS)) Q:FTS=""  D  Q:QFLG
"RTN","ECXATRT",124,0)
 ...S FTSNM=^TMP($J,"ECXTS",TS,FTS)
"RTN","ECXATRT",125,0)
 ...D:($Y+3>IOSL) HEADER Q:QFLG  W ?25,$E(FTSNM,1,30),!
"RTN","ECXATRT",126,0)
 .;write the service subtotal
"RTN","ECXATRT",127,0)
 .Q:QFLG
"RTN","ECXATRT",128,0)
 .W ?22,$E(LN,1,54),!
"RTN","ECXATRT",129,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG  W "Total for "_SERV_":",?68,$$RJ^XLFSTR(SVCTOT,5," "),!
"RTN","ECXATRT",130,0)
 ;write the grandtotal for all services at facility
"RTN","ECXATRT",131,0)
 D:($Y+3>IOSL) HEADER Q:QFLG  W !!,"Grand Total for all Services:",?68,$$RJ^XLFSTR(GTOT,5," ")
"RTN","ECXATRT",132,0)
 ;print the audit descriptive narrative
"RTN","ECXATRT",133,0)
 I $E(IOST)'="C" D
"RTN","ECXATRT",134,0)
 .W @IOF S PG=PG+1
"RTN","ECXATRT",135,0)
 .W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXATRT",136,0)
 .W !,"DSS Extract Log #:    "_ECXEXT
"RTN","ECXATRT",137,0)
 .W !,"Date Range of Audit:  "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXATRT",138,0)
 .W !,"Report Run Date/Time: "_ECXRUN,?68,"Page: ",PG
"RTN","ECXATRT",139,0)
 .W !!,LN,!!
"RTN","ECXATRT",140,0)
 .S DIC="^ECX(727.1,",DA=ECXARRAY("DEF"),DR="1" D EN^DIQ
"RTN","ECXATRT",141,0)
 I $E(IOST)="C",'QFLG D
"RTN","ECXATRT",142,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXATRT",143,0)
 .S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXATRT",144,0)
 Q
"RTN","ECXATRT",145,0)
 ;
"RTN","ECXATRT",146,0)
HEADER ;header and page control
"RTN","ECXATRT",147,0)
 N JJ,SS
"RTN","ECXATRT",148,0)
 I $E(IOST)="C" D
"RTN","ECXATRT",149,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXATRT",150,0)
 .I PG>0 S DIR(0)="E" W ! D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXATRT",151,0)
 Q:QFLG
"RTN","ECXATRT",152,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXATRT",153,0)
 ;W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXATRT",154,0)
 W !,"Treating Specialty Change"_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXATRT",155,0)
 W !,"DSS Extract Log #:    "_ECXARRAY("EXTRACT")
"RTN","ECXATRT",156,0)
 W !,"Date Range of Audit:  "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXATRT",157,0)
 W !,"Report Run Date/Time: "_ECXRUN
"RTN","ECXATRT",158,0)
 W !,"DSS Site:             "_$P(ECXDIV(DIV),U,2)_" ("_$P(ECXDIV(DIV),U,3)_")",?68,"Page: "_PG
"RTN","ECXATRT",159,0)
 W !!,"Service",?22,"Specialty (DSS Code)",?68,"# of Losses"
"RTN","ECXATRT",160,0)
 W !,?25,"Facility Treating Specialty"
"RTN","ECXATRT",161,0)
 W !,LN,!
"RTN","ECXATRT",162,0)
 Q
"RTN","ECXFELOC")
0^4^B17442082
"RTN","ECXFELOC",1,0)
ECXFELOC ;BIR/DMA,CML-Print Feeder Locations; [ 05/07/96  8:41 AM ]
"RTN","ECXFELOC",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXFELOC",3,0)
EN ;entry point from option
"RTN","ECXFELOC",4,0)
 W !!,"Print list of feeder locations.",! S QFLG=1
"RTN","ECXFELOC",5,0)
 K %ZIS S %ZIS="Q" D ^%ZIS Q:POP 
"RTN","ECXFELOC",6,0)
 I $D(IO("Q")) S ZTDESC="Feeder Location List (DSS)",ZTRTN="START^ECXFELOC" D ^%ZTLOAD D ^%ZISC G OUT
"RTN","ECXFELOC",7,0)
 U IO
"RTN","ECXFELOC",8,0)
START ;queued entry point
"RTN","ECXFELOC",9,0)
 I '$D(DT) S DT=$$HTFM^XLFDT(+$H)
"RTN","ECXFELOC",10,0)
 K ^TMP($J) S (QFLG,PG)=0,$P(LN,"-",81)=""
"RTN","ECXFELOC",11,0)
LAB S EC=0 F  S EC=$O(^LRO(68,EC)) Q:'EC  I $D(^(EC,0)) S EC1=^(0),^TMP($J,"LAB",$P(EC1,"^",11),EC)=$P(EC1,"^")
"RTN","ECXFELOC",12,0)
ECS S EC=0 I $P($G(^EC(720.1,1,0)),"^",2) D  G IV
"RTN","ECXFELOC",13,0)
 .F  S EC=$O(^ECJ(EC)) Q:'EC  I $D(^(EC,0)) S EC1=$P(^(0),"-",1,2),EC2=$P($G(^ECD(+$P(EC1,"-",2),0)),"^"),^TMP($J,"ECS",EC1,EC1)=EC2
"RTN","ECXFELOC",14,0)
 F  S EC=$O(^ECK(EC)) Q:'EC  I $D(^(EC,0)) S EC1=$P(^(0),"-",1,2),EC2=$P($G(^ECD(+$P(EC1,"-",2),0)),"^"),^TMP($J,"ECS",EC1,EC1)=EC2
"RTN","ECXFELOC",15,0)
IV S EC=0 F  S EC=$O(^DG(40.8,EC)) Q:'EC  I $D(^DG(40.8,EC,0)) S EC1=$E($P(^(0),"^"),1,30),^TMP($J,"IVP","IVP"_EC,EC)="IV Pharmacy-"_EC1
"RTN","ECXFELOC",16,0)
CLI S EC=0 F  S EC=$O(^SC(EC)) Q:'EC  I $D(^(EC,0)) S EC1=^(0),ECS=$P(EC1,"^",15),ECSC=$P($G(^DIC(40.7,+$P(EC1,"^",7),0)),"^",2),ECD=$P(EC1,"^") S:'ECS ECS=1 D
"RTN","ECXFELOC",17,0)
 .I $P(EC1,"^",17)'="Y",$P(EC1,"^",3)="C" S DAT=$G(^SC(EC,"I")),ID=+DAT,RD=$P(DAT,"^",2) I 'ID!(ID>DT)!(RD&(RD<DT)) S ^TMP($J,"CLI",ECS_ECSC,EC)=ECD
"RTN","ECXFELOC",18,0)
PRE I $O(^PS(59,0)) G V6
"RTN","ECXFELOC",19,0)
 S EC=0 F  S EC=$O(^DIC(59,EC)) Q:'EC  I $D(^(EC,0)) S EC1=$E($P(^(0),"^"),1,30),^TMP($J,"PRE","PRE"_EC,EC)="Prescriptions-"_EC1
"RTN","ECXFELOC",20,0)
 G RAD
"RTN","ECXFELOC",21,0)
V6 S EC=0 F  S EC=$O(^PS(59,EC)) Q:'EC  I $D(^(EC,0)) S EC1=$E($P(^(0),"^"),1,30),^TMP($J,"PRE","PRE"_EC,EC)="Prescriptions-"_EC1
"RTN","ECXFELOC",22,0)
RAD S EC=0 F  S EC=$O(^RA(79,EC)),EC1=0 Q:'EC  I $D(^(EC,0)) S ECD=$P(^(0),"^") F  S EC1=$O(^RA(79.2,EC1)) Q:'EC1  I $D(^(EC1,0)) S ECD1=$P(^(0),"^"),^TMP($J,"RAD",EC_"-"_EC1,EC_"-"_EC1)=ECD_"-"_ECD1
"RTN","ECXFELOC",23,0)
NUR S EC=0 F  S EC=$O(^NURSF(211.4,EC)) Q:'EC  I $D(^(EC,0)) S EC1=$P(^(0),"^"),EC1=$P($G(^SC(+EC1,0)),"^"),^TMP($J,"NUR",EC,EC)=EC1
"RTN","ECXFELOC",24,0)
SUR F EC=1:1:14 S EC2=$P($T(@EC),";",3) F EC1="I","A","D","M","P","C","S" S EC3=$P($T(@EC1),";",3),^TMP($J,"SUR",$P(EC2,"^")_EC1,EC)=$P(EC2,"^",2)_"-"_EC3
"RTN","ECXFELOC",25,0)
1 ;;ORGE^GENERAL PURPOSE OPERATING ROOM
"RTN","ECXFELOC",26,0)
2 ;;OROR^ORTHOPEDIC OPERATING ROOM
"RTN","ECXFELOC",27,0)
3 ;;ORCA^CARDIAC OPERATING ROOM
"RTN","ECXFELOC",28,0)
4 ;;ORNE^NEUROSURGERY OPERATING ROOM
"RTN","ECXFELOC",29,0)
5 ;;ORCN^CARDIAC/NEURO OPERATING ROOM
"RTN","ECXFELOC",30,0)
6 ;;ORAM^AMBULATORY OPERATING ROOM
"RTN","ECXFELOC",31,0)
7 ;;ORIN^INTENSIVE CARE UNIT
"RTN","ECXFELOC",32,0)
8 ;;OREN^ENDOSCOPY ROOM
"RTN","ECXFELOC",33,0)
9 ;;ORCY^CYSTOSCOPY ROOM
"RTN","ECXFELOC",34,0)
10 ;;ORWA^WARD
"RTN","ECXFELOC",35,0)
11 ;;ORCL^CLINIC
"RTN","ECXFELOC",36,0)
12 ;;ORDE^DEDICATED ROOM
"RTN","ECXFELOC",37,0)
13 ;;OROT^OTHER LOCATION
"RTN","ECXFELOC",38,0)
14 ;;ORNO^UNKNOWN
"RTN","ECXFELOC",39,0)
I ;;IMPLANTS
"RTN","ECXFELOC",40,0)
A ;;ANESTHESIA TIME
"RTN","ECXFELOC",41,0)
D ;;SURGERY TIME (DENTAL)
"RTN","ECXFELOC",42,0)
M ;;SURGERY TIME (MEDICINE)
"RTN","ECXFELOC",43,0)
P ;;SURGERY TIME (PSYCH)
"RTN","ECXFELOC",44,0)
C ;;SURGERY TIME (SPINAL CORD)
"RTN","ECXFELOC",45,0)
S ;;SURGERY TIME (SURGERY)
"RTN","ECXFELOC",46,0)
UDP S EC=0 F  S EC=$O(^DG(40.8,EC)) Q:'EC  I $D(^DG(40.8,EC,0)) S EC1=$E($P(^(0),"^"),1,30),^TMP($J,"UDP","UDP"_EC,EC)="Unit Dose Medications-"_EC1
"RTN","ECXFELOC",47,0)
DEN S EC=0 F  S EC=$O(^DENT(225,EC)) Q:'EC  I $D(^(EC,0)) S EC1=$P(^(0),"^"),^TMP($J,"DEN",EC1,EC)="Dental "_EC1
"RTN","ECXFELOC",48,0)
 ;
"RTN","ECXFELOC",49,0)
PRINT ;
"RTN","ECXFELOC",50,0)
 S EC="" F  S EC=$O(^TMP($J,EC)),EC1="" Q:EC=""  Q:QFLG  D HEAD Q:QFLG  F  S EC1=$O(^TMP($J,EC,EC1)),EC2=""  Q:EC1=""  Q:QFLG  F  S EC2=$O(^TMP($J,EC,EC1,EC2)) Q:EC2=""  Q:QFLG  D
"RTN","ECXFELOC",51,0)
 .W !,?5,EC1,?23,^(EC2) I $Y+3>IOSL D HEAD Q:QFLG
"RTN","ECXFELOC",52,0)
OUT I $E(IOST)="C"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","ECXFELOC",53,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXFELOC",54,0)
 K ^TMP($J),DAT,EC,EC1,EC2,EC3,ECD,ECD1,ECS,ECSC,ID,JJ,LN,PG,POP,QFLG,RD,SS,X,Y
"RTN","ECXFELOC",55,0)
 W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","ECXFELOC",56,0)
HEAD ;
"RTN","ECXFELOC",57,0)
 I $E(IOST)="C" S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXFELOC",58,0)
 I $E(IOST)="C",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","ECXFELOC",59,0)
 S PG=PG+1 W:$Y!($E(IOST)="C") @IOF W !,?15,"Feeder Location List For Feeder System ",EC,?72,"Page: ",PG,!!,?5,"FEEDER LOCATION",?23,"DESCRIPTION",!,LN
"RTN","ECXFELOC",60,0)
 Q
"RTN","ECXLABN")
0^5^B19550529
"RTN","ECXLABN",1,0)
ECXLABN ;BIR/CML-Lab Extract for DSS (New Format - With LMIP Codes) ; [ 11/22/96  5:14 PM ]
"RTN","ECXLABN",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXLABN",3,0)
BEG D SETUP,^ECXTRAC
"RTN","ECXLABN",4,0)
END D ^ECXKILL
"RTN","ECXLABN",5,0)
 Q
"RTN","ECXLABN",6,0)
START ; entry when queued
"RTN","ECXLABN",7,0)
 S QFLG=0
"RTN","ECXLABN",8,0)
 K ^LRO(64.03) S LRSDT=ECSD,LREDT=ECED D ^LRCAPDSS
"RTN","ECXLABN",9,0)
 ;quit if no completion date for API compile
"RTN","ECXLABN",10,0)
 I '$P($G(^LRO(64.03,1,1,1,0)),"^",4) Q
"RTN","ECXLABN",11,0)
 ;quit if tasked and user sends stop request
"RTN","ECXLABN",12,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ^LRO(64.03) S ^LRO(64.03,0)="WKLD LOG FILE^64.03^" Q
"RTN","ECXLABN",13,0)
 K ECXDD D FIELD^DID(64.03,1,,"SPECIFIER","ECXDD") S ECPROF=$E(+$P(ECXDD("SPECIFIER"),"P",2)) K ECXDD ; provider points to
"RTN","ECXLABN",14,0)
 S ECLRN=1 F  S ECLRN=$O(^LRO(64.03,ECLRN)) Q:'ECLRN  I $D(^LRO(64.03,ECLRN,0)) S EC1=^(0),ECDOC=ECPROF_$P(EC1,"^",2),ECLOC=$P(EC1,"^",15),EC=$P(EC1,"^",3) I EC]"" D  Q:QFLG
"RTN","ECXLABN",15,0)
 .S ECF=$S($P(EC,";",2)="DPT(":2,$P(EC,";",2)="LRT(67,":67,1:0) Q:'ECF  S ECIFN=$P(EC,";")
"RTN","ECXLABN",16,0)
 .;resolve ecloc
"RTN","ECXLABN",17,0)
 .S ECXL1=+$P(ECLOC,";",1),ECXL2=$P(ECLOC,";",2)
"RTN","ECXLABN",18,0)
 .I ECF=2 S ECLOC=$S(ECXL1>0:ECXL1,1:"") I ECXL2]"",ECXL2'="SC(" S ECLOC=""
"RTN","ECXLABN",19,0)
 .I ECF=67 D  S ECLOC=ECXSTN
"RTN","ECXLABN",20,0)
 ..S (ECXSTN,ECXAGC)=""
"RTN","ECXLABN",21,0)
 ..I ECXL2'="DIC(4," S ECXSTN="XXXXX",ECXAGC="XX" Q
"RTN","ECXLABN",22,0)
 ..I '$D(^DIC(4,ECXL1)) S ECXSTN="XXXXX",ECXAGC="XX" Q
"RTN","ECXLABN",23,0)
 ..I $D(^DIC(4,ECXL1)) S ECXSTN=$P(^DIC(4,ECXL1,"99"),"^",1),ECXAGC=$E($P(^(99),"^",5),1,2) S:ECXSTN="" ECXSTN="ZZZZZ" S:ECXAGC="" ECXAGC="ZZ"
"RTN","ECXLABN",24,0)
 .S ECDT=$P(EC1,"^",13),ECD=$P(ECDT,"."),ECTM=$$ECXTIME^ECXUTL(ECDT)
"RTN","ECXLABN",25,0)
 .S ECWKLD=$P(EC1,"^",11),ECWK="" I $D(^LAM(ECWKLD,0)) S ECWK=$P(^(0),"^",2)
"RTN","ECXLABN",26,0)
 .S (ECNA,ECSN,ECMN,ECPTTM,ECPTPR)="",ECA=1
"RTN","ECXLABN",27,0)
 .;get the patient data if record is in file #2
"RTN","ECXLABN",28,0)
 .I ECF=2,$D(^DPT(ECIFN,0)) D
"RTN","ECXLABN",29,0)
 ..S EC0=^DPT(ECIFN,0),ECNA=$E($P($P(EC0,"^"),",")_"    ",1,4),ECSN=$P(EC0,"^",9) K VAIP S VAIP("D")=ECD,DFN=ECIFN D IN5^VADPT S ECMN=VAIP(1) S:ECMN ECA=3
"RTN","ECXLABN",30,0)
 ..I $T(OUTPTPR^SDUTL3)[",SCDATE" D
"RTN","ECXLABN",31,0)
 ...S ECPTTM=+$$OUTPTTM^SDUTL3(DFN,ECDT) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN,ECDT) S:ECPTPR=0 ECPTPR=""
"RTN","ECXLABN",32,0)
 ..I $T(OUTPTPR^SDUTL3)'[",SCDATE" D
"RTN","ECXLABN",33,0)
 ...S ECPTTM=+$$OUTPTTM^SDUTL3(DFN) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN) S:ECPTPR=0 ECPTPR=""
"RTN","ECXLABN",34,0)
 .K VAIP,VAERR
"RTN","ECXLABN",35,0)
 .;get patient data if record is in file #67
"RTN","ECXLABN",36,0)
 .I ECF=67 S ECSN="000123456",ECNA="RFRL" I $D(^LRT(67,ECIFN,0)) D
"RTN","ECXLABN",37,0)
 ..S EC0=^LRT(67,ECIFN,0),ECNA=$E($P($P(EC0,"^"),",")_"    ",1,4),ECSN=$P(EC0,"^",9) D
"RTN","ECXLABN",38,0)
 ...S ECNA=$TR(ECNA,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ECXLABN",39,0)
 ...I ECSN="" S ECSN="000123456" Q
"RTN","ECXLABN",40,0)
 ...S ECSN=$TR(ECSN," "),ECSN=$TR(ECSN,"-")
"RTN","ECXLABN",41,0)
 ...I ($L(ECSN)<9)!($L(ECSN)>10) S ECSN="000123456" Q
"RTN","ECXLABN",42,0)
 ...I $L(ECSN)=9,ECSN'?9N S ECSN="000123456" Q
"RTN","ECXLABN",43,0)
 ...I $L(ECSN)=10,ECSN'?9N1"P" S ECSN="000123456"
"RTN","ECXLABN",44,0)
 .S ECTREAT=$P(EC1,"^",10) I ECTREAT S ECTREAT=$P($G(^DIC(45.7,+ECTREAT,0)),"^",2)
"RTN","ECXLABN",45,0)
 .;create extract record only if patient name and accession area exist
"RTN","ECXLABN",46,0)
 .I ECNA]"" S ECT=$P(EC1,"^",8),ECURG=$P(EC1,"^",9),EC=+$P(EC1,"^",7) I EC D
"RTN","ECXLABN",47,0)
 ..S:ECF=2 ECACA=EC_"^"_$P($G(^LRO(68,EC,0)),"^",11) S:ECF=67 ECACA=ECXAGC_"^"_$P($G(^LRO(68,EC,0)),"^",11)
"RTN","ECXLABN",48,0)
 ..S ECODE=ECINST_"^"_ECIFN_"^"_ECSN_"^"_ECNA_"^"_ECA_"^"_$$ECXDATE^ECXUTL(ECD,ECXYM)_"^"_ECACA_"^"_ECT_"^"_ECURG_"^"_ECTREAT_"^"_ECLOC_"^"_ECDOC_"^"_ECMN_"^"_ECF_"^"_ECTM_"^"_ECWK_"^"_ECPTTM_"^"_ECPTPR_"^"
"RTN","ECXLABN",49,0)
 ..;inst^patient (or thing) number^SSN (or equivalent)^name^in/out^day^accession area^abbreviation^test^urgency^treating spec^location^provider and file^
"RTN","ECXLABN",50,0)
 ..;movement number^file^time^workload code^primary care team^primary care provider
"RTN","ECXLABN",51,0)
 ..;(ECACA=acc area^abbreviation)
"RTN","ECXLABN",52,0)
 ..S EC7=-$O(^ECX(ECFILE,"AINV","")) F  S EC7=EC7+1 Q:'$D(^ECX(ECFILE,EC7))
"RTN","ECXLABN",53,0)
 ..S ^ECX(ECFILE,EC7,0)=EC7_"^"_EC23_"^"_ECODE,ECRN=ECRN+1 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXLABN",54,0)
 .I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXLABN",55,0)
 K ^LRO(64.03) S ^LRO(64.03,0)="WKLD LOG FILE^64.03^"
"RTN","ECXLABN",56,0)
 Q
"RTN","ECXLABN",57,0)
 ;
"RTN","ECXLABN",58,0)
SETUP S ECPACK="Laboratory",ECPIECE=1,ECRTN="START^ECXLABN",ECGRP="LAB",ECHEAD="LAB",ECFILE=727.813,ECVER=7
"RTN","ECXLABN",59,0)
 Q
"RTN","ECXLABN",60,0)
 ;
"RTN","ECXLABN",61,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXLABN",62,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXSCX")
0^6^B57684840
"RTN","ECXSCX",1,0)
ECXSCX ;BIR/DMA,CML,PTD-Clinic Extract ; 02/06/97 10:24 [ 03/26/97  2:10 PM ]
"RTN","ECXSCX",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXSCX",3,0)
BEG ;entry point from option
"RTN","ECXSCX",4,0)
 D SETUP,^ECXTRAC,^ECXKILL
"RTN","ECXSCX",5,0)
 Q
"RTN","ECXSCX",6,0)
 ;
"RTN","ECXSCX",7,0)
START ;scheduled appts. and appended ekgs: loop through the file (#44);
"RTN","ECXSCX",8,0)
 K ^TMP("ECXS",$J) S ECXMISS=10,ECED=ECED+.3 S SC=0,QFLG=0
"RTN","ECXSCX",9,0)
 F  S SC=$O(^SC(SC)) Q:'SC  I $D(^(SC,0)) S EC=^(0) I $P(EC,"^",3)="C" S ECSU=$P(EC,"^",15) S:'ECSU ECSU=1 D FEEDER(SC,ECSD1,.P1,.P2,.P3,.ECST) I ECST'=6 S ECD=ECSD1 D  Q:QFLG
"RTN","ECXSCX",10,0)
 .F  S ECD=$O(^SC(SC,"S",ECD)) Q:'ECD  Q:ECD>ECED  S ECDA=0 F  S ECDA=$O(^SC(SC,"S",ECD,1,ECDA)) Q:'ECDA  I $D(^(ECDA,0)) D  Q:QFLG
"RTN","ECXSCX",11,0)
 ..;for each patient appointment in the date range (skip cancellations), examine the APPOINTMENT multiple in the PATIENT file (#2)
"RTN","ECXSCX",12,0)
 ..I $S('$D(^SC(SC,"S",ECD,1,ECDA,"C")):1,1:$P(^("C"),"^",3)]"") S PTADT=^(0),DFN=$P(PTADT,"^") I $D(^DPT(+DFN,0)),$P(PTADT,"^",9)="",$P($G(^DPT(DFN,"S",ECD,0)),"^",2)'["C" D
"RTN","ECXSCX",13,0)
 ...S EC1=^DPT(DFN,0),ECO1=ECSU_"^"_DFN_"^"_$P(EC1,"^",9)_"^"_$E($P($P(EC1,"^"),",")_"   ",1,4)_"^^"_$$ECXDATE^ECXUTL(ECD,ECXYM)
"RTN","ECXSCX",14,0)
 ...D AOIRPOW^ECXUTL(DFN,.ECXAIP)
"RTN","ECXSCX",15,0)
 ...S ECL=$P(PTADT,"^",2),ECL=$$RJ^XLFSTR(ECL,3,0),ECOB=$G(^SC(SC,"S",ECD,1,ECDA,"OB"))]""
"RTN","ECXSCX",16,0)
 ...;don't continue with record creation if the clinic appointment can't be found in subfile 2.98
"RTN","ECXSCX",17,0)
 ...Q:'$D(^DPT(DFN,"S",ECD,0))  Q:$P(^DPT(DFN,"S",ECD,0),"^")'=SC
"RTN","ECXSCX",18,0)
 ...K EC2 S EC2=^DPT(DFN,"S",ECD,0) S ECN=$S($P(EC2,"^",2)="N":"N",$P(EC2,"^",2)="NA":"N",$P(EC2,"^",2)="NT":"Q",1:"0")
"RTN","ECXSCX",19,0)
 ...S ECIEN=$P(EC2,"^",20),ECEKG=$P(EC2,"^",5)
"RTN","ECXSCX",20,0)
 ...S ECO2=ECOB_"^"_SC
"RTN","ECXSCX",21,0)
 ...I ECST'=3 S ECFD=P1_P2_ECL_P3_ECN,ECODE=ECO1_"^"_ECFD_"^"_ECO2 D API
"RTN","ECXSCX",22,0)
 ...I ECST=3 S ECFD=P1_"000"_ECL_P3_ECN,ECODE=ECO1_"^"_ECFD_"^"_ECO2 D API
"RTN","ECXSCX",23,0)
 ...I ECST=3 S ECFD=P2_"000"_ECL_P3_ECN,ECODE=ECO1_"^"_ECFD_"^"_ECO2 D API
"RTN","ECXSCX",24,0)
 ...;Check for appended visits for EKG (107). If regular appt. is a no-show, append is a no-show.
"RTN","ECXSCX",25,0)
 ...Q:'ECEKG  S $P(ECODE,"^",7,9)="1070000280000"_ECN_"^^" D FILE2
"RTN","ECXSCX",26,0)
 K DFN,EC,EC1,EC2,ECA,ECCPT,ECCSC,ECD,ECDA,ECEKG,ECFD,ECICD,ECIEN,ECL,ECMN,ECN,ECO1,ECO2,ECOB,ECODE,ECPROV,ECPTPR,ECPTTM,ECREC,ECSC,ECST,ECSU,ECTS,ECVAL,ECVIS,ELIG,P1,P11,P2,P3,PTADT,SC,VAERR,VAIP
"RTN","ECXSCX",27,0)
 ;Dispositions, stand-alones, and appended lab and x-ray: Loop through the OUTPATIENT ENCOUNTER file (#409.68) for date range.
"RTN","ECXSCX",28,0)
 S ECD=ECSD1 F  S ECD=$O(^SCE("B",ECD)) Q:'ECD!(ECD>ECED)  S ECIEN=0 F  S ECIEN=$O(^SCE("B",ECD,ECIEN)) Q:'ECIEN  D PROC Q:QFLG
"RTN","ECXSCX",29,0)
 I '$D(^TMP("ECXS",$J)) Q
"RTN","ECXSCX",30,0)
 Q:QFLG
"RTN","ECXSCX",31,0)
 G ^ECXSCX1
"RTN","ECXSCX",32,0)
 ;
"RTN","ECXSCX",33,0)
PROC ;Process an OUTPATIENT ENCOUNTER.
"RTN","ECXSCX",34,0)
 Q:'$D(^SCE(ECIEN,0))  ;Quit if no OUTPATIENT ENCOUNTER zero node.
"RTN","ECXSCX",35,0)
 S FD=0,NCNTR=^SCE(ECIEN,0),STOP=$P($G(^DIC(40.7,+$P(NCNTR,"^",3),0)),"^",2) Q:'STOP  ;Quit if no clinic stop code for encounter.
"RTN","ECXSCX",36,0)
 ;FD=1>x-ray or lab record, FD=2>disposition, FD=0>stand-alone visit
"RTN","ECXSCX",37,0)
 I (STOP=105)!(STOP=108) S FD=1 G BLD ;Clinic stop code equals 105 (x-ray) or 108 (lab).
"RTN","ECXSCX",38,0)
 I ($P(NCNTR,"^",8)'=2),($P(NCNTR,"^",8)'=3) Q  ;Quit if encounter not STOP CODE ADDITION or DISPOSITION.
"RTN","ECXSCX",39,0)
 I $P(NCNTR,"^",8)=3 S FD=2 G BLD ;ORIGINATING PROCESS TYPE equals DISPOSITION.
"RTN","ECXSCX",40,0)
 ;Else ORIGINATING PROCESS TYPE equals STOP CODE ADDITION (stand-alone).
"RTN","ECXSCX",41,0)
 Q:$P($G(NCNTR),"^",6)  ;Quit if there is a PARENT ENCOUNTER pointer.
"RTN","ECXSCX",42,0)
BLD ;Build record.
"RTN","ECXSCX",43,0)
 S DFN=+$P(NCNTR,"^",2),LOC=$P(NCNTR,"^",4),ECSU=1 S:LOC ECSU=$P(^SC(LOC,0),"^",15)
"RTN","ECXSCX",44,0)
 I $D(^DPT(DFN,0)) S EC1=^(0),ECO1=ECSU_"^"_DFN_"^"_$P(EC1,"^",9)_"^"_$E($P($P(EC1,"^"),",")_"    ",1,4)_"^^"_$$ECXDATE^ECXUTL(ECD,ECXYM) D
"RTN","ECXSCX",45,0)
 .D AOIRPOW^ECXUTL(DFN,.ECXAIP)
"RTN","ECXSCX",46,0)
 .S P1=$$RJ^XLFSTR(STOP,3,0),P2="000",P3="0000",ECST=1
"RTN","ECXSCX",47,0)
 .; for x-ray and lab
"RTN","ECXSCX",48,0)
 .I FD=1 S ECODE=ECO1_"^"_P1_P2_"02800000^^" D API Q
"RTN","ECXSCX",49,0)
 .; for dispositions
"RTN","ECXSCX",50,0)
 .I FD=2 S ECODE=ECO1_"^"_P1_"47906000000^^" D API Q
"RTN","ECXSCX",51,0)
 .; for stand-alone visits
"RTN","ECXSCX",52,0)
 .I LOC,$D(^SC(LOC,0)) S SC=LOC,EC=^(0) D FEEDER(SC,ECD,.P1,.P2,.P3,.ECST)
"RTN","ECXSCX",53,0)
 .I ECST'=6 S ECODE=ECO1_"^"_P1_P2_"029"_P3_"0^^"_SC D API
"RTN","ECXSCX",54,0)
 Q
"RTN","ECXSCX",55,0)
 ;
"RTN","ECXSCX",56,0)
FILE ;facility^dfn^ssn^name^in/out status^day^feeder key^overbook^sc^mov #^treat spec^time^primary care team^
"RTN","ECXSCX",57,0)
 ;primary care provider^provider^CPT code^ICD-9 code^dob^eligibility^vet^race^
"RTN","ECXSCX",58,0)
 ;ao status^ao visit^ir statusir visit^pow status^pow location^provider person class
"RTN","ECXSCX",59,0)
 S $P(ECODE,"^",5)=ECA,ECODE=ECODE_"^"_ECMN_"^"_ECTS_"^"_$$ECXTIME^ECXUTL(ECD)_"^"_ECPTTM_"^"_ECPTPR_"^"_ECPROV_"^"_ECCPT_"^"_ECICD
"RTN","ECXSCX",60,0)
 S ECODE=ECODE_"^"_$$ECXDOB^ECXUTL($P(EC1,"^",3))_"^"_ELIG_"^"_$P($G(^DPT(DFN,"VET")),"^")_"^"_$P($G(^DIC(10,+$P(EC1,"^",6),0)),"^",2)
"RTN","ECXSCX",61,0)
 S ECODE=ECODE_"^"_ECXAIP("AO")_"^"_ECVAO_"^"_ECXAIP("IR")_"^"_ECVIR_"^"_ECXAIP("POW")_"^"_ECXAIP("POWL")_"^"_ECXPRPC_"^"
"RTN","ECXSCX",62,0)
FILE2 S EC7=-$O(^ECX(ECFILE,"AINV","")) F  S EC7=EC7+1 Q:'$D(^ECX(ECFILE,EC7))
"RTN","ECXSCX",63,0)
 S ^ECX(ECFILE,EC7,0)=EC7_"^"_EC23_"^"_ECODE,ECRN=ECRN+1 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXSCX",64,0)
 I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSCX",65,0)
 Q
"RTN","ECXSCX",66,0)
 ;
"RTN","ECXSCX",67,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSCX",68,0)
 S ECPACK="Clinic",ECPIECE=11,ECRTN="START^ECXSCX",ECGRP="SCX",ECFILE=727.803,ECHEAD="CLI",ECVER=7
"RTN","ECXSCX",69,0)
 Q
"RTN","ECXSCX",70,0)
 ;
"RTN","ECXSCX",71,0)
FEEDER(ECXSC,ECXSD,ECXP1,ECXP2,ECXP3,ECXSEND) ;get transmission style and feeder key variables
"RTN","ECXSCX",72,0)
 ;feeder key is primary stop code_secondary stop code_length of appointment_national clinic code_noshow indicator
"RTN","ECXSCX",73,0)
 ;   input
"RTN","ECXSCX",74,0)
 ;   ECXSCX = ien of clinic in file #44 (required)
"RTN","ECXSCX",75,0)
 ;   ECXSD  = start date of extract date range (required)
"RTN","ECXSCX",76,0)
 ;   ECXP1,ECXP2,ECXP3,ECXSEND passed by reference (required)
"RTN","ECXSCX",77,0)
 ;   output (passed-by-reference variables)
"RTN","ECXSCX",78,0)
 ;   ECXP1  = primary stop code
"RTN","ECXSCX",79,0)
 ;   ECXP2  = secondary stop code
"RTN","ECXSCX",80,0)
 ;   ECXP3  = field #7 of file #728.44
"RTN","ECXSCX",81,0)
 ;   ECXSEND = field #5 of file #728.44
"RTN","ECXSCX",82,0)
 N ECSC,ECCSC,SC,ECSD1,ECXNC,ECXMISS
"RTN","ECXSCX",83,0)
 S (ECXP1,ECXP2)="000",ECXP3="0000"
"RTN","ECXSCX",84,0)
 S ECXSEND=1
"RTN","ECXSCX",85,0)
 I '$D(^ECX(728.44,ECXSC,0)) D  Q
"RTN","ECXSCX",86,0)
 .S ECSC=$P($G(^SC(ECXSC,0)),"^",7),ECCSC=$P(^(0),"^",18)
"RTN","ECXSCX",87,0)
 .S SC=ECXSC,ECSD1=ECXSD D MISS^ECXSCX1
"RTN","ECXSCX",88,0)
 .I ECSC S ECXP1=$P($G(^DIC(40.7,ECSC,0)),"^",2),ECXP1=$$RJ^XLFSTR(ECXP1,3,0)
"RTN","ECXSCX",89,0)
 S EC=$G(^ECX(728.44,ECXSC,0)) Q:EC=""
"RTN","ECXSCX",90,0)
 S ECXSEND=$P(EC,"^",6)
"RTN","ECXSCX",91,0)
 Q:ECXSEND=6
"RTN","ECXSCX",92,0)
 S ECSC=$P(EC,"^",4),ECCSC=$P(EC,"^",5)
"RTN","ECXSCX",93,0)
 I ECSC="" S ECSC=$P(EC,"^",2),ECCSC=$P(EC,"^",3)
"RTN","ECXSCX",94,0)
 I ECSC S ECXP1=$$RJ^XLFSTR(ECSC,3,0),ECXP2=$$RJ^XLFSTR(ECCSC,3,0)
"RTN","ECXSCX",95,0)
 I ECSC="" D
"RTN","ECXSCX",96,0)
 .S ECSC=$P($G(^SC(ECXSC,0)),"^",7),ECCSC=$P($G(^(0)),"^",18) I ECSC D
"RTN","ECXSCX",97,0)
 ..S ECXP1=$P($G(^DIC(40.7,ECSC,0)),"^",2),ECXP2=$P($G(^DIC(40.7,ECCSC,0)),"^",2)
"RTN","ECXSCX",98,0)
 ..S ECXP1=$$RJ^XLFSTR(ECXP1,3,0),ECXP2=$$RJ^XLFSTR(ECXP2,3,0)
"RTN","ECXSCX",99,0)
 ;for action code=1, secondary stop code is always "000"
"RTN","ECXSCX",100,0)
 I ECXSEND=1 S ECXP2="000" Q
"RTN","ECXSCX",101,0)
 ;action code of 2 or 3 should not be used, but continue to follow v2t11 logic
"RTN","ECXSCX",102,0)
 I ECXSEND=2 S ECXP1=ECXP2,ECXP2="000" Q
"RTN","ECXSCX",103,0)
 I ECXSEND=3 Q
"RTN","ECXSCX",104,0)
 ;for action code=4, need to get national clinic code
"RTN","ECXSCX",105,0)
 I ECXSEND=4 D
"RTN","ECXSCX",106,0)
 .S ECXNC=$P($G(^ECX(728.44,ECXSC,0)),"^",8)
"RTN","ECXSCX",107,0)
 .I ECXNC S ECXNC=$P($G(^ECX(728.441,ECXNC,0)),"^"),ECXP3=$$RJ^XLFSTR(ECXNC,4,0)
"RTN","ECXSCX",108,0)
 Q
"RTN","ECXSCX",109,0)
 ;
"RTN","ECXSCX",110,0)
API ;call external utilities
"RTN","ECXSCX",111,0)
 ;Determine in/out status and movement number.
"RTN","ECXSCX",112,0)
 S ECA=1,ECTS="" K VAIP S VAIP("D")=ECD D IN5^VADPT S ECMN=VAIP(1) I ECMN S ECA=3,ECTS=$P($G(^DIC(45.7,+VAIP(8),0)),"^",2)
"RTN","ECXSCX",113,0)
 K VAIP,VAERR
"RTN","ECXSCX",114,0)
 ;Determine primary care team/provider and eligibility.
"RTN","ECXSCX",115,0)
 I $T(OUTPTPR^SDUTL3)[",SCDATE" D
"RTN","ECXSCX",116,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN,ECD) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN,ECD) S:ECPTPR=0 ECPTPR=""
"RTN","ECXSCX",117,0)
 I $T(OUTPTPR^SDUTL3)'[",SCDATE" D
"RTN","ECXSCX",118,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN) S:ECPTPR=0 ECPTPR=""
"RTN","ECXSCX",119,0)
 S ELIG=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),"^",9) I ELIG S ELIG=$C(ELIG+64)
"RTN","ECXSCX",120,0)
PCE ;call PCE API for CPT code, diagnosis/provider designated as primary
"RTN","ECXSCX",121,0)
 S ECPROV="",ECXPRPC="",ECCPT=99199,ECICD=799.9,ECVAO="",ECVIR=""
"RTN","ECXSCX",122,0)
 I 'ECIEN D FILE Q
"RTN","ECXSCX",123,0)
 I ECIEN S ECVIS=$P($G(^SCE(ECIEN,0)),"^",5)
"RTN","ECXSCX",124,0)
 I 'ECVIS D FILE Q
"RTN","ECXSCX",125,0)
 I ECVIS D ENCEVENT^PXAPI(ECVIS)
"RTN","ECXSCX",126,0)
 I $O(^TMP("PXKENC",$J,ECVIS,""))']"" D FILE Q
"RTN","ECXSCX",127,0)
POV ;get ICD9 code; else use 799.9
"RTN","ECXSCX",128,0)
 G:'$O(^TMP("PXKENC",$J,ECVIS,"POV",0)) PRV
"RTN","ECXSCX",129,0)
 S (ECREC,ECVAL)=0
"RTN","ECXSCX",130,0)
 F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"POV",ECREC)) Q:'ECREC  S:($P(^TMP("PXKENC",$J,ECVIS,"POV",ECREC,0),"^",12)="P") ECVAL=+^(0) Q:$P(^TMP("PXKENC",$J,ECVIS,"POV",ECREC,0),"^",12)="P"
"RTN","ECXSCX",131,0)
 I 'ECVAL S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"POV",0)) I ECREC S ECVAL=+^(ECREC,0)
"RTN","ECXSCX",132,0)
 I ECVAL S ECICD=$P($G(^ICD9(ECVAL,0)),"^")
"RTN","ECXSCX",133,0)
PRV ;get first provider designated as primary; if no primary, then get first physician provider; if no physician, then get first provider; if no "prv" array nodes, use null.
"RTN","ECXSCX",134,0)
 G:'$O(^TMP("PXKENC",$J,ECVIS,"PRV",0)) CPT
"RTN","ECXSCX",135,0)
 S (ECREC,ECVAL)=0
"RTN","ECXSCX",136,0)
 F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC)) Q:'ECREC  S:($P(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0),"^",4)="P") ECVAL=+^(0) Q:$P(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0),"^",4)="P"
"RTN","ECXSCX",137,0)
 I ECVAL S ECPROV=ECVAL,ECXPRPC=$$PRVCLASS^ECXUTL(ECPROV,ECD)
"RTN","ECXSCX",138,0)
 I 'ECVAL S ECREC=0 D
"RTN","ECXSCX",139,0)
 .F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",ECREC)) Q:'ECREC  D  Q:ECVAL
"RTN","ECXSCX",140,0)
 ..S ECVAL=+^TMP("PXKENC",$J,ECVIS,"PRV",ECREC,0) Q:'ECVAL
"RTN","ECXSCX",141,0)
 ..S ECXPRPC=$$PRVCLASS^ECXUTL(ECVAL,ECD) Q:ECXPRPC=""
"RTN","ECXSCX",142,0)
 ..S NUM=$E(ECXPRPC,2,7) S:(NUM<110000)!(NUM>119999) ECVAL=0,ECXPRPC=""
"RTN","ECXSCX",143,0)
 ..I ECVAL S ECPROV=ECVAL
"RTN","ECXSCX",144,0)
 I 'ECVAL D
"RTN","ECXSCX",145,0)
 .S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"PRV",0)) Q:'ECREC  S ECVAL=+^(ECREC,0)
"RTN","ECXSCX",146,0)
 .I ECVAL S ECPROV=ECVAL,ECXPRPC=$$PRVCLASS^ECXUTL(ECPROV,ECD)
"RTN","ECXSCX",147,0)
CPT ;get CPT code for IEN, else use default.
"RTN","ECXSCX",148,0)
 G:'$O(^TMP("PXKENC",$J,ECVIS,"CPT",0)) DFLT
"RTN","ECXSCX",149,0)
 S (ECREC,ECVAL)=0
"RTN","ECXSCX",150,0)
 ;if there's a primary provider, get a cpt associated with that provider
"RTN","ECXSCX",151,0)
 I ECPROV'="" D
"RTN","ECXSCX",152,0)
 .F  S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"CPT",ECREC)) Q:'ECREC  D  Q:ECVAL
"RTN","ECXSCX",153,0)
 ..I $D(^TMP("PXKENC",$J,ECVIS,"CPT",ECREC,12)) S:$P(^(12),"^",4)=ECPROV ECVAL=+^TMP("PXKENC",$J,ECVIS,"CPT",ECREC,0)
"RTN","ECXSCX",154,0)
 ..I ECVAL S ECCPT=$P($G(^ICPT(ECVAL,0)),"^")
"RTN","ECXSCX",155,0)
 I ECVAL=0 D
"RTN","ECXSCX",156,0)
 .S ECREC=$O(^TMP("PXKENC",$J,ECVIS,"CPT",0)),ECVAL=+^(ECREC,0) I ECVAL S ECCPT=$P($G(^ICPT(ECVAL,0)),"^")
"RTN","ECXSCX",157,0)
DFLT S (ECVAO,ECVIR)=""
"RTN","ECXSCX",158,0)
 I $D(^TMP("PXKENC",$J,ECVIS,"VST",ECVIS,800)) D
"RTN","ECXSCX",159,0)
 .S ECVAO=$P(^(800),"^",2),ECVIR=$P(^(800),"^",3)
"RTN","ECXSCX",160,0)
 .S:ECVAO="0" ECVAO="N" S:ECVIR=0 ECVIR="N"
"RTN","ECXSCX",161,0)
 .S:ECVAO="1" ECVAO="Y" S:ECVIR=1 ECVIR="Y"
"RTN","ECXSCX",162,0)
 D FILE
"RTN","ECXSCX",163,0)
 Q
"RTN","ECXSCX",164,0)
 ;
"RTN","ECXSCX",165,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSCX",166,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXSURG")
0^7^B21312207
"RTN","ECXSURG",1,0)
ECXSURG ;BIR/DMA,PTD-Surgery Extract for DSS ; [ 03/20/97  3:04 PM ]
"RTN","ECXSURG",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXSURG",3,0)
BEG ;entry point from option
"RTN","ECXSURG",4,0)
 D SETUP
"RTN","ECXSURG",5,0)
 D ^ECXTRAC
"RTN","ECXSURG",6,0)
 D ^ECXKILL
"RTN","ECXSURG",7,0)
 Q
"RTN","ECXSURG",8,0)
 ;
"RTN","ECXSURG",9,0)
START ;
"RTN","ECXSURG",10,0)
 S QFLG=0
"RTN","ECXSURG",11,0)
 S ECED=ECED+.3
"RTN","ECXSURG",12,0)
 S ECD=ECSD1 F  S ECD=$O(^SRF("AC",ECD)),ECD0=0 Q:'ECD  Q:ECD>ECED  F  S ECD0=$O(^SRF("AC",ECD,ECD0)) Q:'ECD0  I $D(^SRF(ECD0,0)) S EC0=^(0),DFN=+EC0 I $D(^DPT(DFN,0)) S ECP=^(0) D STUFF Q:QFLG
"RTN","ECXSURG",13,0)
 Q
"RTN","ECXSURG",14,0)
 ;
"RTN","ECXSURG",15,0)
STUFF ;gather data - ECODE0=basic info, ECODE full data
"RTN","ECXSURG",16,0)
 S SSN=$P(ECP,"^",9),ECNA=$E($P($P(ECP,"^"),",")_"    ",1,4)
"RTN","ECXSURG",17,0)
 I $T(OUTPTPR^SDUTL3)[",SCDATE" D
"RTN","ECXSURG",18,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN,ECD) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN,ECD) S:ECPTPR=0 ECPTPR=""
"RTN","ECXSURG",19,0)
 I $T(OUTPTPR^SDUTL3)'[",SCDATE" D
"RTN","ECXSURG",20,0)
 .S ECPTTM=+$$OUTPTTM^SDUTL3(DFN) S:ECPTTM=0 ECPTTM="" S ECPTPR=+$$OUTPTPR^SDUTL3(DFN) S:ECPTPR=0 ECPTPR=""
"RTN","ECXSURG",21,0)
 S DATA1=$S($D(^SRF(ECD0,.1)):^(.1),1:0),DATA2=$S($D(^(.2)):^(.2),1:""),DATAOP=$S($D(^("OP")):^("OP"),1:""),ECDIV=$S($D(^(8)):^(8),1:ECINST),ECANE="",ECSR=$P(DATA1,"^",4),ECAT=$P(DATA1,"^",13),ECNO=$G(^("NON"))
"RTN","ECXSURG",22,0)
 S ECTM=$$ECXTIME^ECXUTL($P(DATA2,"^",10)) I $P(ECNO,"^")="Y" S ECTM=$$ECXTIME^ECXUTL($P(ECNO,"^",4))
"RTN","ECXSURG",23,0)
 S ECCAN=$G(^SRF(ECD0,30))>0 I ECCAN!('$P(DATA2,"^",10)&($P(ECNO,"^")'="Y")) Q
"RTN","ECXSURG",24,0)
 ;quit if cancelled or no pt. in oper. rm. time
"RTN","ECXSURG",25,0)
 ;look for non-OR
"RTN","ECXSURG",26,0)
 I $P(ECNO,"^")="Y" S ECSR=$P(ECNO,"^",6),ECAT=$P(ECNO,"^",7),A1=$P(ECNO,"^",5),A2=$P(ECNO,"^",4),TIME="##" D:(A1&A2) TIME S ECNT=TIME
"RTN","ECXSURG",27,0)
 S ECNL="" I $P(ECNO,"^")="Y" S ECNL=+$P(ECNO,"^",2),ECNL=$P($G(^ECX(728.44,ECNL,0)),"^",9) I ECNL="" S ECNL="UNKNOWN"
"RTN","ECXSURG",28,0)
 S ECSA=$P($G(^SRF(ECD0,.3)),"^",4),ECO=$P($G(^SRF(ECD0,0)),"^",2) S ECORTY=$P($G(^SRS(+ECO,2)),"^"),ECO=$P($G(^SRS(+ECO,0)),"^")
"RTN","ECXSURG",29,0)
 S:ECAT ECAT=2_ECAT S:ECSR ECSR=2_ECSR S:ECSA ECSA=2_ECSA
"RTN","ECXSURG",30,0)
 ;add leading 2s for pointer to 200
"RTN","ECXSURG",31,0)
 S J=$O(^SRF(ECD0,6,0)) I J,$D(^(J,0)) S ECANE=$P(^(0),"^") I $P(^(0),"^",3)'="Y" F  S J=$O(^SRF(ECD0,6,J)) Q:'J  I $D(^(J,0)),$P(^(0),"^",3)="Y" S ECANE=$P(^(0),"^") Q
"RTN","ECXSURG",32,0)
 S ECSS=$P($G(^SRO(137.45,+$P(EC0,"^",4),0)),"^",2)
"RTN","ECXSURG",33,0)
 S ECSS=$$RJ^XLFSTR($P($G(^DIC(45.3,+ECSS,0)),"^"),3,0) S:ECSS="000" ECSS="999"
"RTN","ECXSURG",34,0)
 S ECODE0=ECDIV_"^"_DFN_"^"_SSN_"^"_ECNA_"^"_$S($P(EC0,"^",12)="I":3,1:1)_"^"_$$ECXDATE^ECXUTL(ECD,ECXYM)_"^"_ECD0_"^"_ECSS_"^"_ECO_"^"_ECSR_"^"_ECAT_"^"_ECSA_"^"_ECANE
"RTN","ECXSURG",35,0)
 ;ECODE0=division^dfn^ssn^name^in/out^day^case #^surg specialty^or room #^surgeon^attending^anesthesia supervisor^anesthesia technique
"RTN","ECXSURG",36,0)
 ;
"RTN","ECXSURG",37,0)
 ;get service of attending surgeon
"RTN","ECXSURG",38,0)
 S ECAT=$E(ECAT,2,$L(ECAT))
"RTN","ECXSURG",39,0)
 ;remove leading 2
"RTN","ECXSURG",40,0)
 S ECATSV=$P($G(^DIC(49,+$G(^VA(200,+ECAT,5)),730)),"^")
"RTN","ECXSURG",41,0)
 ;get primary
"RTN","ECXSURG",42,0)
 S ECPT=+$P(DATAOP,"^",2),ECPT=$P($G(^ICPT(ECPT,0)),"^")
"RTN","ECXSURG",43,0)
 S ECODE=ECODE0_"^P^"_ECPT_"^"
"RTN","ECXSURG",44,0)
 F J="10,12","2,3","1,4" S A2=$P(DATA2,"^",$P(J,",")),A1=$P(DATA2,"^",$P(J,",",2)),TIME="##" D:(A1&A2) TIME S ECODE=ECODE_"^"_TIME K TIME
"RTN","ECXSURG",45,0)
 S ECRR="" I $D(^SRF(ECD0,1.1)) S A1=$P(^(1.1),"^",8),A2=$P(^(1.1),"^",7),TIME="##" D:(A1&A2) TIME S ECRR=TIME K TIME
"RTN","ECXSURG",46,0)
 I ECNL]"" S $P(ECODE,"^",18)=ECNT
"RTN","ECXSURG",47,0)
 ;primary=ECODE0^P^CPT code^^patient time^operation time^anesthesia time
"RTN","ECXSURG",48,0)
 D FILE K EC0,DATA1,DATA2,DATA6,DATAOP,ECPT
"RTN","ECXSURG",49,0)
 ;get secondaries
"RTN","ECXSURG",50,0)
 S J=0 F  S J=$O(^SRF(ECD0,13,J)) Q:'J  I $D(^(J,0)),$D(^(2)),$P(^(2),"^")]"" S ECPT=$P(^(2),"^"),ECODE=ECODE0_"^S^"_$P($G(^ICPT(ECPT,0)),"^")_"^" D FILE
"RTN","ECXSURG",51,0)
 ;secondary=ECODE0^S^CPT code^
"RTN","ECXSURG",52,0)
 ;get prostheses
"RTN","ECXSURG",53,0)
 S J=0 F  S J=$O(^SRF(ECD0,1,J)) Q:'J  I $D(^(J,0)) S X=+^(0),Q=$P($G(^(1)),"^",2) S:'Q Q=1 S ECODE=ECODE0_"^I^^^^^^"_X_"^"_Q_"^^" D FILE
"RTN","ECXSURG",54,0)
 ;prosthesis=ECODE0^I^^^^^^prosthesis^quantity^
"RTN","ECXSURG",55,0)
 K J,Q,X
"RTN","ECXSURG",56,0)
 Q
"RTN","ECXSURG",57,0)
FILE ;add movement number^treating speciality^cancelled^time^OR type^attending's service^non-or dss id^recovery room time^^primary care team^primary care provider^admission date
"RTN","ECXSURG",58,0)
 D INP S $P(ECODE,"^",5)=ECA,$P(ECODE,"^",23,33)=ECMN_"^"_ECTS_"^"_$S(ECCAN:"C",1:"")_"^"_ECTM_"^"_ECORTY_"^"_ECATSV_"^"_ECNL_"^"_ECRR_"^^"_ECPTTM_"^"_ECPTPR_"^"_ECXADD_"^"
"RTN","ECXSURG",59,0)
 S EC7=-$O(^ECX(ECFILE,"AINV","")) F  S EC7=EC7+1 Q:'$D(^ECX(ECFILE,EC7))
"RTN","ECXSURG",60,0)
 S ^ECX(ECFILE,EC7,0)=EC7_"^"_EC23_"^"_ECODE,ECRN=ECRN+1 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXSURG",61,0)
 I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSURG",62,0)
 Q
"RTN","ECXSURG",63,0)
 ;
"RTN","ECXSURG",64,0)
TIME ; given date/time get increment
"RTN","ECXSURG",65,0)
 ;A1=later, A2=earlier, TIME=difference
"RTN","ECXSURG",66,0)
 S TIME=$TR($J($$FMDIFF^XLFDT(A1,A2,2)/900,6,0)," ") I TIME<0 S TIME="###"
"RTN","ECXSURG",67,0)
 Q
"RTN","ECXSURG",68,0)
SETUP S ECPACK="Surgery",ECPIECE=5,ECRTN="START^ECXSURG",ECGRP="SURG",ECHEAD="SUR",ECFILE=727.811,ECVER=7
"RTN","ECXSURG",69,0)
 Q
"RTN","ECXSURG",70,0)
 ;
"RTN","ECXSURG",71,0)
INP ; checks for in/outpatient status and gets movement number
"RTN","ECXSURG",72,0)
 S ECA=1,(ECTS,ECXADD)="" K VAIP S VAIP("D")=ECD D IN5^VADPT S ECMN=VAIP(1) I ECMN S ECA=3,ECTS=$P($G(^DIC(45.7,+VAIP(8),0)),"^",2)
"RTN","ECXSURG",73,0)
 I ECMN S ECXADD=$P(VAIP(13,1),"^",1),ECXADD=$$ECXDATE^ECXUTL(ECXADD,ECXYM)
"RTN","ECXSURG",74,0)
 K VAIP,VAERR
"RTN","ECXSURG",75,0)
 Q
"RTN","ECXSURG",76,0)
 ;
"RTN","ECXSURG",77,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSURG",78,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXTRT")
0^8^B33058363
"RTN","ECXTRT",1,0)
ECXTRT ;BIR/DMA,CML,PTD-Treating Specialty Change Extract ; [ 01/10/97  4:33 PM ]
"RTN","ECXTRT",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXTRT",3,0)
BEG ;entry point from option
"RTN","ECXTRT",4,0)
 D SETUP,^ECXTRAC,^ECXKILL
"RTN","ECXTRT",5,0)
 Q
"RTN","ECXTRT",6,0)
 ;
"RTN","ECXTRT",7,0)
START ; start package specific extract
"RTN","ECXTRT",8,0)
 S QFLG=0
"RTN","ECXTRT",9,0)
 K ECXDD D FIELD^DID(405,.19,,"SPECIFIER","ECXDD") S ECPRO=$E(+$P(ECXDD("SPECIFIER"),"P",2)) K ECXDD
"RTN","ECXTRT",10,0)
 K TEMP S TRT=0
"RTN","ECXTRT",11,0)
 F  S TRT=$O(^DIC(45.7,TRT)) Q:+TRT=0  S SPC=$P(^DIC(45.7,TRT,0),"^",2),TEMP(TRT)=SPC
"RTN","ECXTRT",12,0)
 S ECED=ECED+.3,ECD=ECSD1
"RTN","ECXTRT",13,0)
 ;loop through type 6 movements to get treating specialty and provider changes
"RTN","ECXTRT",14,0)
 F  S ECD=$O(^DGPM("ATT6",ECD)),ECDA=0 Q:'ECD  Q:ECD>ECED  F  S ECDA=$O(^DGPM("ATT6",ECD,ECDA)) Q:'ECDA  D  Q:QFLG
"RTN","ECXTRT",15,0)
 .I $D(^DGPM(ECDA,0)) S EC=^(0),DFN=+$P(EC,"^",3) I $D(^DPT(DFN,0)) S PAT=^(0) D  Q:QFLG
"RTN","ECXTRT",16,0)
 ..S ECMT=$P(EC,"^",18),ECXADM=$P(EC,"^",14),ECXADT=$P($G(^DGPM(ECXADM,0)),"^",1)
"RTN","ECXTRT",17,0)
 ..;skip the record if its the admission treat. spec. change for this episode of care
"RTN","ECXTRT",18,0)
 ..Q:ECXADM=$P(EC,"^",24)
"RTN","ECXTRT",19,0)
 ..S (ECXTRTN,ECXSPCN,ECXPRVN,ECXATTN)=""
"RTN","ECXTRT",20,0)
 ..D DATA(EC,ECPRO,.ECXMVD1,.ECXTRTN,.ECXSPCN,.ECXPRVN,.ECXATTN)
"RTN","ECXTRT",21,0)
 ..Q:'ECXSPCN
"RTN","ECXTRT",22,0)
 ..S ECXDATE=$$ECXDATE^ECXUTL(ECXMVD1,ECXYM),ECXTIME=$$ECXTIME^ECXUTL(ECXMVD1)
"RTN","ECXTRT",23,0)
 ..S ECXADMDT=$$ECXDATE^ECXUTL(ECXADT,ECXYM),ECXADMTM=$$ECXTIME^ECXUTL(ECXADT),ECXDCDT=""
"RTN","ECXTRT",24,0)
 ..;get previous movement record in same admission episode; don't continue if record not found
"RTN","ECXTRT",25,0)
 ..;variable ecxtsdt will hold the date/time when change to ecxtrtl occurred;
"RTN","ECXTRT",26,0)
 ..S ECD2=9999999.9999999-ECXMVD1,(ECXTRTL,ECXSPCL,ECXPRVL,ECXATTL,ECXTSDT,ECXLOS)=""
"RTN","ECXTRT",27,0)
 ..F  S ECD2=+$O(^DGPM("ATID6",DFN,ECD2)) Q:ECD2=""  S ECDA2=+$O(^(ECD2,0)),EC2=$G(^DGPM(ECDA2,0)) I $P(EC2,"^",14)=ECXADM D  Q:ECXSPCL
"RTN","ECXTRT",28,0)
 ...D DATA(EC2,ECPRO,.ECXMVD2,.ECXTRTL,.ECXSPCL,.ECXPRVL,.ECXATTL)
"RTN","ECXTRT",29,0)
 ...;if this record is the admission ts, can't go back any further so set variable ecxtsdt
"RTN","ECXTRT",30,0)
 ...I $P(EC2,"^",24)=ECXADM S ECXTSDT=ECXMVD2
"RTN","ECXTRT",31,0)
 ..;if new ts and losing ts aren't the same, this is an actual ts change so calculate los
"RTN","ECXTRT",32,0)
 ..I ECXTRTL'=ECXTRTN D
"RTN","ECXTRT",33,0)
 ...I 'ECXTSDT D PREVTRT(DFN,ECXTRTL,ECXMVD2,ECXADM,.ECXTSDT)
"RTN","ECXTRT",34,0)
 ...Q:'ECXTSDT
"RTN","ECXTRT",35,0)
 ...S X1=ECXMVD1,X2=ECXTSDT D ^%DTC S ECXLOS=X
"RTN","ECXTRT",36,0)
 ...D FILE
"RTN","ECXTRT",37,0)
 ..;this is a provider-only change 
"RTN","ECXTRT",38,0)
 ..I ECXTRTL=ECXTRTN D
"RTN","ECXTRT",39,0)
 ...S ECXLOS=""
"RTN","ECXTRT",40,0)
 ...D FILE
"RTN","ECXTRT",41,0)
 ;for nhcu episodes with intervening asih stays, the los calculated here is not accurate,
"RTN","ECXTRT",42,0)
 ;but it never has been; this is best solution within current extract framework;
"RTN","ECXTRT",43,0)
 ;at discharge the los calculated for nhcu apisodes will be the los since admission w/o asih los subtracted;
"RTN","ECXTRT",44,0)
 ;
"RTN","ECXTRT",45,0)
 ;loop through discharges to get last treating specialty
"RTN","ECXTRT",46,0)
 ;
"RTN","ECXTRT",47,0)
 S ECD=ECSD1
"RTN","ECXTRT",48,0)
 F  S ECD=$O(^DGPM("ATT3",ECD)),ECDA=0 Q:'ECD  Q:ECD>ECED  F  S ECDA=$O(^DGPM("ATT3",ECD,ECDA)) Q:'ECDA  D  Q:QFLG
"RTN","ECXTRT",49,0)
 .I $D(^DGPM(ECDA,0)) S EC=^(0),DFN=+$P(EC,"^",3) I $D(^DPT(DFN,0)) S PAT=^(0) D
"RTN","ECXTRT",50,0)
 ..S ECXMVD1=$P(EC,"^",1)
"RTN","ECXTRT",51,0)
 ..S (ECXDATE,ECXDCDT)=$$ECXDATE^ECXUTL(ECXMVD1,ECXYM),ECXTIME=$$ECXTIME^ECXUTL(ECXMVD1)
"RTN","ECXTRT",52,0)
 ..S ECMT=$P(EC,"^",18),ECXADM=$P(EC,"^",14),ECXADT=$P($G(^DGPM(ECXADM,0)),"^",1)
"RTN","ECXTRT",53,0)
 ..S ECXADMDT=$$ECXDATE^ECXUTL(ECXADT,ECXYM),ECXADMTM=$$ECXTIME^ECXUTL(ECXADT)
"RTN","ECXTRT",54,0)
 ..S (ECXTRTN,ECXSPCN,ECXPRVN,ECXATTN)=""
"RTN","ECXTRT",55,0)
 ..S ECD2=9999999.9999999-ECXMVD1,(ECXTRTL,ECXSPCL,ECXPRVL,ECXATTL,ECXTSDT,ECXLOS)=""
"RTN","ECXTRT",56,0)
 ..F  S ECD2=$O(^DGPM("ATID6",DFN,ECD2)) Q:ECD2=""  S ECDA2=+$O(^(ECD2,0)),EC2=$G(^DGPM(ECDA2,0)) I $P(EC2,"^",14)=ECXADM D  Q:ECXSPCL
"RTN","ECXTRT",57,0)
 ...D DATA(EC2,ECPRO,.ECXMVD2,.ECXTRTL,.ECXSPCL,.ECXPRVL,.ECXATTL)
"RTN","ECXTRT",58,0)
 ...I $P(EC2,"^",24)=ECXADM S ECXTSDT=ECXMVD2
"RTN","ECXTRT",59,0)
 ..I 'ECXTSDT D PREVTRT(DFN,ECXTRTL,ECXMVD2,ECXADM,.ECXTSDT)
"RTN","ECXTRT",60,0)
 ..Q:'ECXTSDT
"RTN","ECXTRT",61,0)
 ..S X1=ECXMVD1,X2=ECXTSDT D ^%DTC S ECXLOS=X
"RTN","ECXTRT",62,0)
 ..D FILE
"RTN","ECXTRT",63,0)
 K TEMP
"RTN","ECXTRT",64,0)
 Q
"RTN","ECXTRT",65,0)
 ;
"RTN","ECXTRT",66,0)
DATA(MOVE,PRO,DATE,TRT,SPC,PRV,ATT) ;extract treating specialty and provider data from movement record
"RTN","ECXTRT",67,0)
 ;   input
"RTN","ECXTRT",68,0)
 ;   MOVE   = contents of movement record in file #405 (required)
"RTN","ECXTRT",69,0)
 ;   PRO    = indicator for file in which person data is contained
"RTN","ECXTRT",70,0)
 ;            (required)
"RTN","ECXTRT",71,0)
 ;   output; data from record contained in MOVE
"RTN","ECXTRT",72,0)
 ;   DATE   = date/time of movement (passed by reference)
"RTN","ECXTRT",73,0)
 ;   TRT    = ien in file #45.7 for specialty from field #.09 of 
"RTN","ECXTRT",74,0)
 ;            movement record (passed by reference)
"RTN","ECXTRT",75,0)
 ;   SPC    = ien in file #42.4 pointed to by TRT (passed by reference)
"RTN","ECXTRT",76,0)
 ;   PRV    = pointer from field #.08 of movement record concatented
"RTN","ECXTRT",77,0)
 ;            to PRO (passed by reference)
"RTN","ECXTRT",78,0)
 ;   ATT    = pointer from field #.19 of movement record concatented
"RTN","ECXTRT",79,0)
 ;            to PRO (passed by reference)
"RTN","ECXTRT",80,0)
 S (PRT,SPC,PRV,ATT)=""
"RTN","ECXTRT",81,0)
 S DATE=$P(MOVE,"^",1)
"RTN","ECXTRT",82,0)
 S TRT=+$P(MOVE,"^",9)
"RTN","ECXTRT",83,0)
 ;its possible for many facility treating specialties to map to one specialty
"RTN","ECXTRT",84,0)
 S SPC=$G(TEMP(TRT))
"RTN","ECXTRT",85,0)
 S PRV=$P(MOVE,"^",8) S:PRV]"" PRV=PRO_PRV
"RTN","ECXTRT",86,0)
 S ATT=$P(MOVE,"^",19) S:ATT]"" ATT=PRO_ATT
"RTN","ECXTRT",87,0)
 Q
"RTN","ECXTRT",88,0)
 ;
"RTN","ECXTRT",89,0)
PREVTRT(DFN,PREVTRT,DATE,ADMREC,TSDATE) ;find the date on which the change to the losing treat. spec. occurred
"RTN","ECXTRT",90,0)
 ;
"RTN","ECXTRT",91,0)
 ;   input               
"RTN","ECXTRT",92,0)
 ;   DFN     = ien for patient in file #2 (required)
"RTN","ECXTRT",93,0)
 ;   DATE    = date of movement (required)
"RTN","ECXTRT",94,0)
 ;   PREVTRT = pointer value to file #45.7 for previous facilty 
"RTN","ECXTRT",95,0)
 ;             treating specialty (required)
"RTN","ECXTRT",96,0)
 ;   ADMREC  = ien in file #405 for admission movement related to
"RTN","ECXTRT",97,0)
 ;             this episode of care (required)   
"RTN","ECXTRT",98,0)
 ;   output
"RTN","ECXTRT",99,0)
 ;   TSDATE  = date/time of file #405 record which is the actual
"RTN","ECXTRT",100,0)
 ;              treat. spec. change movement (passed by reference)
"RTN","ECXTRT",101,0)
 ;
"RTN","ECXTRT",102,0)
 N ECD2,ECDA2,EC2,TRT,DONE,INVDATE,SPC
"RTN","ECXTRT",103,0)
 ;to calculate los must get date on which change to losing treat. spec. occurred
"RTN","ECXTRT",104,0)
 S DONE=0,TSDATE=""
"RTN","ECXTRT",105,0)
 ;try to find the actual change date to previous treating specialty;
"RTN","ECXTRT",106,0)
 ;variable date will hold change date when the movement prior to it has different specialty
"RTN","ECXTRT",107,0)
 S INVDATE=9999999.9999999-DATE
"RTN","ECXTRT",108,0)
 F  S INVDATE=+$O(^DGPM("ATID6",DFN,INVDATE)) Q:INVDATE=""  S ECDA2=+$O(^(INVDATE,0)) D  Q:DONE
"RTN","ECXTRT",109,0)
 .;if record # is less than admission movement, something's wrong
"RTN","ECXTRT",110,0)
 .I ECDA2<ADMREC S DONE=1 Q
"RTN","ECXTRT",111,0)
 .;if record doesn't exist, try again
"RTN","ECXTRT",112,0)
 .S EC2=$G(^DGPM(ECDA2,0)) I 'EC Q
"RTN","ECXTRT",113,0)
 .;if record doesn't belong to same inpatient episode, try again
"RTN","ECXTRT",114,0)
 .I $P(EC2,"^",14)'=ADMREC Q
"RTN","ECXTRT",115,0)
 .;if previous movement is the admission treat. spec. movement, that's specialty change date
"RTN","ECXTRT",116,0)
 .I $P(EC2,"^",24)=ADMREC S TSDATE=DATE,DONE=1 Q
"RTN","ECXTRT",117,0)
 .S TRT=+$P(EC2,"^",9),SPC=+$G(TEMP(TRT)) S:'SPC TRT=""
"RTN","ECXTRT",118,0)
 .;if specialty doesn't exist, try again
"RTN","ECXTRT",119,0)
 .I TRT="" Q
"RTN","ECXTRT",120,0)
 .;if specialty is different, then done
"RTN","ECXTRT",121,0)
 .I TRT'=PREVTRT S TSDATE=DATE,DONE=1
"RTN","ECXTRT",122,0)
 .;if specialty the same, update date and continue loop
"RTN","ECXTRT",123,0)
 .I TRT=PREVTRT S DATE=$P(EC2,"^",1)
"RTN","ECXTRT",124,0)
 Q
"RTN","ECXTRT",125,0)
 ;
"RTN","ECXTRT",126,0)
FILE ;file the extract record
"RTN","ECXTRT",127,0)
 ;fac^dfn^ssn^name^i/o^date^product^adm date^dis date^mov#^type^losing provider^losing treat spec^losing ts los^losing attending^movement type^time^adm time^new provider^new attending^new treating specialty
"RTN","ECXTRT",128,0)
 S ECODE="^"_DFN_"^"_$P(PAT,"^",9)_"^"_$E($P($P(PAT,"^"),",")_"    ",1,4)_"^3^"_ECXDATE_"^^"_ECXADMDT_"^"_ECXDCDT
"RTN","ECXTRT",129,0)
 S ECODE=ECODE_"^"_ECDA_"^6^"_ECXSPCN_"^"_ECXSPCL_"^"_ECXLOS_"^"_ECXATTL_"^"_ECMT_"^"_ECXTIME_"^"_ECXADMTM_"^"_ECXPRVN_"^"_ECXATTN_"^"_ECXPRVL_"^"
"RTN","ECXTRT",130,0)
 S EC7=-$O(^ECX(ECFILE,"AINV","")) F  S EC7=EC7+1 Q:'$D(^ECX(ECFILE,EC7))
"RTN","ECXTRT",131,0)
 S ^ECX(ECFILE,EC7,0)=EC7_"^"_EC23_"^"_ECODE,ECRN=ECRN+1 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXTRT",132,0)
 I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXTRT",133,0)
 Q
"RTN","ECXTRT",134,0)
 ;
"RTN","ECXTRT",135,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXTRT",136,0)
 S ECPACK="Treating specialty change",ECPIECE=17,ECRTN="START^ECXTRT",ECGRP="TREAT",ECHEAD="TRT",ECFILE=727.817,ECVER=7
"RTN","ECXTRT",137,0)
 Q
"RTN","ECXTRT",138,0)
 ;
"RTN","ECXTRT",139,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXTRT",140,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXUTL")
0^9^B33509994
"RTN","ECXUTL",1,0)
ECXUTL ;ALB/JAP - Utilities for DSS Extracts ;Sep 17, 1997
"RTN","ECXUTL",2,0)
 ;;3.0;DSS EXTRACTS;**1**;Dec 22, 1997
"RTN","ECXUTL",3,0)
 ;
"RTN","ECXUTL",4,0)
ECXYM(ECXFMDT) ;extrinsic function
"RTN","ECXUTL",5,0)
 ;converts any FM internal format date or date/time to a 6-character string
"RTN","ECXUTL",6,0)
 ;
"RTN","ECXUTL",7,0)
 ;   input
"RTN","ECXUTL",8,0)
 ;   ECXFMDT = date or date/time; FM internal format (required)
"RTN","ECXUTL",9,0)
 ;   output
"RTN","ECXUTL",10,0)
 ;   ECXYM = YYYYMM string
"RTN","ECXUTL",11,0)
 ;
"RTN","ECXUTL",12,0)
 N MONTH,YEAR,CENTURY,ECXYM
"RTN","ECXUTL",13,0)
 ;
"RTN","ECXUTL",14,0)
 ;error checks
"RTN","ECXUTL",15,0)
 I +ECXFMDT'=ECXFMDT S ECXYM="000000" Q ECXYM
"RTN","ECXUTL",16,0)
 I $L($P(ECXFMDT,"."))'=7 S ECXYM="000000" Q ECXYM
"RTN","ECXUTL",17,0)
 I +$E(ECXFMDT,4,5)<1!(+$E(ECXFMDT,4,5)>12) S ECXYM="000000" Q ECXYM
"RTN","ECXUTL",18,0)
 ;
"RTN","ECXUTL",19,0)
 S MONTH=$E(ECXFMDT,4,5),YEAR=$E(ECXFMDT,2,3),CENTURY=$E(ECXFMDT,1)+17
"RTN","ECXUTL",20,0)
 S ECXYM=CENTURY_YEAR_MONTH
"RTN","ECXUTL",21,0)
 Q ECXYM
"RTN","ECXUTL",22,0)
 ;
"RTN","ECXUTL",23,0)
ECXYMX(ECXYM) ;extrinsic function
"RTN","ECXUTL",24,0)
 ;converts a 6-character numeric string of format YYYYMM
"RTN","ECXUTL",25,0)
 ;to a FM external format date
"RTN","ECXUTL",26,0)
 ;
"RTN","ECXUTL",27,0)
 ;   input
"RTN","ECXUTL",28,0)
 ;   ECXYM = YYYYMM string (required)
"RTN","ECXUTL",29,0)
 ;   output
"RTN","ECXUTL",30,0)
 ;   ECXYMX = FM external format date;
"RTN","ECXUTL",31,0)
 ;            SEP 1997
"RTN","ECXUTL",32,0)
 ;   error code
"RTN","ECXUTL",33,0)
 ;   if input problem, then "000000" returned
"RTN","ECXUTL",34,0)
 ;
"RTN","ECXUTL",35,0)
 N Y,%DT,CENTURY,FMCENT,ECXYMX
"RTN","ECXUTL",36,0)
 ;
"RTN","ECXUTL",37,0)
 ;error checks
"RTN","ECXUTL",38,0)
 I ECXYM="" S ECXYMX="000000" Q ECXYMX
"RTN","ECXUTL",39,0)
 I +ECXYM'=ECXYM S ECXYMX="000000" Q ECXYMX
"RTN","ECXUTL",40,0)
 I $L(ECXYM)'=6 S ECXYMX="000000" Q ECXYMX
"RTN","ECXUTL",41,0)
 I +$E(ECXYM,1,4)<1800 S ECXYMX="000000" Q ECXYMX
"RTN","ECXUTL",42,0)
 I +$E(ECXYM,5,6)<1!(+$E(ECXYM,5,6)>12) S ECXYMX="000000" Q ECXYMX
"RTN","ECXUTL",43,0)
 ;
"RTN","ECXUTL",44,0)
 S CENTURY=$E(ECXYM,1,2)
"RTN","ECXUTL",45,0)
 S FMCENT=CENTURY-17
"RTN","ECXUTL",46,0)
 S Y=FMCENT_$E(ECXYM,3,6) D DD^%DT S ECXYMX=Y
"RTN","ECXUTL",47,0)
 ;
"RTN","ECXUTL",48,0)
 ;error checks
"RTN","ECXUTL",49,0)
 I $L(ECXYMX)'=8 S ECXYMX="000000"
"RTN","ECXUTL",50,0)
 I "JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC"'[$E(ECXYMX,1,3) S ECXYMX="000000"
"RTN","ECXUTL",51,0)
 Q ECXYMX
"RTN","ECXUTL",52,0)
 ;
"RTN","ECXUTL",53,0)
ECXDATE(ECXFMDT,ECXYM) ;extrinsic function
"RTN","ECXUTL",54,0)
 ;converts any FM internal format date or date/time to a 8-character string
"RTN","ECXUTL",55,0)
 ;
"RTN","ECXUTL",56,0)
 ;   input
"RTN","ECXUTL",57,0)
 ;   ECXFMDT = date or date/time; FM internal format (required)
"RTN","ECXUTL",58,0)
 ;   ECXYM = YYYYMM; year/month 6-character string (required)
"RTN","ECXUTL",59,0)
 ;   output
"RTN","ECXUTL",60,0)
 ;   ECXDATE = YYYYMMDD string
"RTN","ECXUTL",61,0)
 ;   error code
"RTN","ECXUTL",62,0)
 ;   "000000" returned, if problem with input
"RTN","ECXUTL",63,0)
 ;
"RTN","ECXUTL",64,0)
 N MONTH,YEAR,CENTURY,DAY,ECXDATE
"RTN","ECXUTL",65,0)
 ;
"RTN","ECXUTL",66,0)
 ;error checks
"RTN","ECXUTL",67,0)
 I +ECXYM'=ECXYM S ECXDATE="000000" Q ECXDATE
"RTN","ECXUTL",68,0)
 I $L(ECXYM)'=6 S ECXDATE="000000" Q ECXDATE
"RTN","ECXUTL",69,0)
 I +$E(ECXYM,1,4)<1800 S ECXDATE="000000" Q ECXDATE
"RTN","ECXUTL",70,0)
 I +$E(ECXYM,5,6)<1!($E(ECXYM,5,6)>12) S ECXDATE="000000" Q ECXDATE
"RTN","ECXUTL",71,0)
 ;special case where ecxfmdt is null; default to year/month of ecxym
"RTN","ECXUTL",72,0)
 I ECXFMDT="" S ECXDATE=ECXYM_"01" Q ECXDATE
"RTN","ECXUTL",73,0)
 ;error checks
"RTN","ECXUTL",74,0)
 I +ECXFMDT'=ECXFMDT S ECXDATE=ECXYM_"01" Q ECXDATE
"RTN","ECXUTL",75,0)
 I $L(ECXFMDT)<7 S ECXDATE=ECXYM_"01" Q ECXDATE
"RTN","ECXUTL",76,0)
 I +$E(ECXFMDT,4,5)>12 S ECXDATE=ECXYM_"01" Q ECXDATE
"RTN","ECXUTL",77,0)
 I +$E(ECXFMDT,6,7)>31 S ECXFMDT=$E(ECXFMDT,1,5)_"01"
"RTN","ECXUTL",78,0)
 ;default to 1st day of month
"RTN","ECXUTL",79,0)
 S DAY=$E(ECXFMDT,6,7) S:DAY="00" DAY="01"
"RTN","ECXUTL",80,0)
 ;default to month of ecxym
"RTN","ECXUTL",81,0)
 S MONTH=$E(ECXFMDT,4,5) S:MONTH="00" MONTH=$E(ECXYM,5,6)
"RTN","ECXUTL",82,0)
 S YEAR=$E(ECXFMDT,2,3)
"RTN","ECXUTL",83,0)
 S CENTURY=$E(ECXFMDT,1)+17
"RTN","ECXUTL",84,0)
 S ECXDATE=CENTURY_YEAR_MONTH_DAY
"RTN","ECXUTL",85,0)
 Q ECXDATE
"RTN","ECXUTL",86,0)
 ;
"RTN","ECXUTL",87,0)
ECXDATEX(ECXDATE) ;extrinsic function
"RTN","ECXUTL",88,0)
 ;converts an 8-character numeric string of format YYYYMMDD
"RTN","ECXUTL",89,0)
 ;to a FM external format date
"RTN","ECXUTL",90,0)
 ;
"RTN","ECXUTL",91,0)
 ;   input
"RTN","ECXUTL",92,0)
 ;   ECXDATE = YYYYMMDD string (required)
"RTN","ECXUTL",93,0)
 ;   output
"RTN","ECXUTL",94,0)
 ;   ECXDATEX = FM external format date;
"RTN","ECXUTL",95,0)
 ;              SEP 12, 1997
"RTN","ECXUTL",96,0)
 ;   error code
"RTN","ECXUTL",97,0)
 ;   if input problem, then "000000" returned
"RTN","ECXUTL",98,0)
 ;
"RTN","ECXUTL",99,0)
 N Y,%DT,CENTURY,FMCENT,ECXDATEX
"RTN","ECXUTL",100,0)
 ;
"RTN","ECXUTL",101,0)
 ;error checks
"RTN","ECXUTL",102,0)
 I +ECXDATE'=ECXDATE S ECXDATEX="000000" Q ECXDATEX
"RTN","ECXUTL",103,0)
 I $L(ECXDATE)'=8 S ECXDATEX="000000" Q ECXDATEX
"RTN","ECXUTL",104,0)
 I +$E(ECXDATE,7,8)>31 S ECXDATEX="000000" Q ECXDATEX
"RTN","ECXUTL",105,0)
 ;
"RTN","ECXUTL",106,0)
 S CENTURY=$E(ECXDATE,1,2)
"RTN","ECXUTL",107,0)
 S FMCENT=CENTURY-17
"RTN","ECXUTL",108,0)
 S Y=FMCENT_$E(ECXDATE,3,8) D DD^%DT S ECXDATEX=Y
"RTN","ECXUTL",109,0)
 ;
"RTN","ECXUTL",110,0)
 ;error checks
"RTN","ECXUTL",111,0)
 I $L(ECXDATEX)'=12 S ECXDATEX="000000"
"RTN","ECXUTL",112,0)
 I "JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC"'[$E(ECXDATEX,1,3) S ECXDATEX="000000"
"RTN","ECXUTL",113,0)
 Q ECXDATEX
"RTN","ECXUTL",114,0)
 ;
"RTN","ECXUTL",115,0)
ECXDOB(ECXFMDT) ;extrinsic function
"RTN","ECXUTL",116,0)
 ;converts a FM internal format date or date/time to a 6-character string
"RTN","ECXUTL",117,0)
 ;if ecxfmdt is null, the function returns 19420101
"RTN","ECXUTL",118,0)
 ;   input
"RTN","ECXUTL",119,0)
 ;   ECXFMDT = date or date/time (required); 
"RTN","ECXUTL",120,0)
 ;             must be valid FM internal format 
"RTN","ECXUTL",121,0)
 ;   output
"RTN","ECXUTL",122,0)
 ;   ECXDOB = YYYYMMDD string (required);
"RTN","ECXUTL",123,0)
 ;            defaults to 19420101
"RTN","ECXUTL",124,0)
 ;
"RTN","ECXUTL",125,0)
 N MONTH,YEAR,CENTURY,DAY,ECXDOB
"RTN","ECXUTL",126,0)
 ;only consider date portion
"RTN","ECXUTL",127,0)
 S ECXFMDT=$P(ECXFMDT,".",1)
"RTN","ECXUTL",128,0)
 ;special case where ecxfmdt is null
"RTN","ECXUTL",129,0)
 I ECXFMDT="" S ECXDOB="19420101" Q ECXDOB
"RTN","ECXUTL",130,0)
 ;error checks - return default
"RTN","ECXUTL",131,0)
 I +ECXFMDT'=ECXFMDT S ECXDOB="19420101" Q ECXDOB
"RTN","ECXUTL",132,0)
 I $L(ECXFMDT)<7 S ECXDOB="19420101" Q ECXDOB
"RTN","ECXUTL",133,0)
 I +ECXFMDT>DT S ECXDOB="19420101" Q ECXDOB
"RTN","ECXUTL",134,0)
 ;default to 1st day of month
"RTN","ECXUTL",135,0)
 S DAY=$E(ECXFMDT,6,7) S:DAY="00"!(+DAY>31) DAY="01"
"RTN","ECXUTL",136,0)
 ;default to 1st month of year
"RTN","ECXUTL",137,0)
 S MONTH=$E(ECXFMDT,4,5) S:MONTH="00"!(+MONTH>12) MONTH="01",DAY="01"
"RTN","ECXUTL",138,0)
 S YEAR=$E(ECXFMDT,2,3)
"RTN","ECXUTL",139,0)
 S CENTURY=$E(ECXFMDT,1)+17
"RTN","ECXUTL",140,0)
 S ECXDOB=CENTURY_YEAR_MONTH_DAY
"RTN","ECXUTL",141,0)
 Q ECXDOB
"RTN","ECXUTL",142,0)
 ;
"RTN","ECXUTL",143,0)
ECXTIME(ECXFMDT) ;extrinsic function
"RTN","ECXUTL",144,0)
 ;converts Fileman internal date/time to 6-character time string
"RTN","ECXUTL",145,0)
 ;format HHMMSS
"RTN","ECXUTL",146,0)
 ;
"RTN","ECXUTL",147,0)
 ;   input
"RTN","ECXUTL",148,0)
 ;   ECXFMDT = date or date/time (required); 
"RTN","ECXUTL",149,0)
 ;             must be valid FM internal format
"RTN","ECXUTL",150,0)
 ;   output
"RTN","ECXUTL",151,0)
 ;   ECXTIME = 6-character numeric string;
"RTN","ECXUTL",152,0)
 ;             format HHMMSS; string length always 6
"RTN","ECXUTL",153,0)
 ;
"RTN","ECXUTL",154,0)
 N J,JJ,TIME,HH,MM,SS,ECXTIME
"RTN","ECXUTL",155,0)
 ;if any non-numerics, set default
"RTN","ECXUTL",156,0)
 I +ECXFMDT'=ECXFMDT S ECXTIME="000300" Q ECXTIME
"RTN","ECXUTL",157,0)
 ;use only time portion of fileman internal format
"RTN","ECXUTL",158,0)
 S TIME=$P(ECXFMDT,".",2),TIME=$E(TIME,1,6)
"RTN","ECXUTL",159,0)
 ;if time unknown, set default
"RTN","ECXUTL",160,0)
 I TIME="" S ECXTIME="000300" Q ECXTIME
"RTN","ECXUTL",161,0)
 ;be sure time is 6 characters
"RTN","ECXUTL",162,0)
 S TIME=$$LJ^XLFSTR(TIME,6,0)
"RTN","ECXUTL",163,0)
 ;error checks -- set default
"RTN","ECXUTL",164,0)
 S HH=$E(TIME,1,2),MM=$E(TIME,3,4),SS=$E(TIME,5,6)
"RTN","ECXUTL",165,0)
 I +HH>23 S ECXTIME="000300" Q ECXTIME
"RTN","ECXUTL",166,0)
 I +MM>59 S MM="59"
"RTN","ECXUTL",167,0)
 I +SS>59 S SS="59"
"RTN","ECXUTL",168,0)
 S ECXTIME=HH_MM_SS
"RTN","ECXUTL",169,0)
 Q ECXTIME
"RTN","ECXUTL",170,0)
 ;
"RTN","ECXUTL",171,0)
ECXTIMEX(ECXTIME,ECXMIL) ;extrinsic function
"RTN","ECXUTL",172,0)
 ;converts a 6-character time string to external, user readable format
"RTN","ECXUTL",173,0)
 ;used as output transform for time fields in many dss extract files
"RTN","ECXUTL",174,0)
 ;   input
"RTN","ECXUTL",175,0)
 ;   ECXTIME = 6-character numeric string (required); 
"RTN","ECXUTL",176,0)
 ;   ECXMIL = if "1", then return military time (optional)          
"RTN","ECXUTL",177,0)
 ;   output
"RTN","ECXUTL",178,0)
 ;   ECXTIMEX = character string;
"RTN","ECXUTL",179,0)
 ;              if ECXMIL=1, format HH:MM:SS
"RTN","ECXUTL",180,0)
 ;              otherwise, hours:mins AM/PM
"RTN","ECXUTL",181,0)
 ;   error code
"RTN","ECXUTL",182,0)
 ;   if input problem, then "000000" returned
"RTN","ECXUTL",183,0)
 ;              
"RTN","ECXUTL",184,0)
 N TIME,HH,MM,SS,ECXTIMEX,J,JJ
"RTN","ECXUTL",185,0)
 ;error checks
"RTN","ECXUTL",186,0)
 I $L(ECXTIME)'=6 S ECXTIMEX="000000" Q ECXTIMEX
"RTN","ECXUTL",187,0)
 F J=1:1:6 S JJ=$E(ECXTIME,J) I $A(JJ)<48!($A(JJ)>57) S ECXTIMEX="000000" Q
"RTN","ECXUTL",188,0)
 I $D(ECXTIMEX) Q ECXTIMEX
"RTN","ECXUTL",189,0)
 S HH=$E(ECXTIME,1,2),MM=$E(ECXTIME,3,4),SS=$E(ECXTIME,5,6)
"RTN","ECXUTL",190,0)
 I +HH>23!(+MM>59)!(+SS>59) S ECXTIMEX="000000" Q ECXTIMEX
"RTN","ECXUTL",191,0)
 ;if ecxmil=1, return military time
"RTN","ECXUTL",192,0)
 I $G(ECXMIL) S ECXTIMEX=HH_":"_MM_":"_SS Q ECXTIMEX
"RTN","ECXUTL",193,0)
 ;otherwise, use am/pm format
"RTN","ECXUTL",194,0)
 S X="0."_ECXTIME
"RTN","ECXUTL",195,0)
 S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200
"RTN","ECXUTL",196,0)
 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M"
"RTN","ECXUTL",197,0)
 S ECXTIMEX=X
"RTN","ECXUTL",198,0)
 Q ECXTIMEX
"RTN","ECXUTL",199,0)
 ;
"RTN","ECXUTL",200,0)
AOIRPOW(ECXDFN,ECXAIP) ;get data on ao, ir, pow status
"RTN","ECXUTL",201,0)
 ;
"RTN","ECXUTL",202,0)
 ;   input
"RTN","ECXUTL",203,0)
 ;   ECXDFN = ien in file #2 (required)
"RTN","ECXUTL",204,0)
 ;   ECXAIP = array for returned data (required)
"RTN","ECXUTL",205,0)
 ;            (passed by reference)
"RTN","ECXUTL",206,0)
 ;
"RTN","ECXUTL",207,0)
 ;   output
"RTN","ECXUTL",208,0)
 ;   ECXAIP("AO") = agent orange status
"RTN","ECXUTL",209,0)
 ;   ECXAIP("IR") = ion. radiation status
"RTN","ECXUTL",210,0)
 ;   ECXAIP("POW") = pow status
"RTN","ECXUTL",211,0)
 ;   ECXAIP("POWL") = pow location/period
"RTN","ECXUTL",212,0)
 ;
"RTN","ECXUTL",213,0)
 N J
"RTN","ECXUTL",214,0)
 S ECXAIP("AO")="",ECXAIP("IR")="",ECXAIP("POW")="",ECXAIP("POWL")=""
"RTN","ECXUTL",215,0)
 S ECXAIP("AO")=$P($G(^DPT(ECXDFN,.321)),"^",2),ECXAIP("IR")=$P($G(^(.321)),"^",3)
"RTN","ECXUTL",216,0)
 S ECXAIP("POW")=$P($G(^DPT(ECXDFN,.52)),"^",5),ECXAIP("POWL")=$P($G(^(.52)),"^",6)
"RTN","ECXUTL",217,0)
 F J="AO","IR","POW" I ECXAIP(J)="" S ECXAIP(J)="U"
"RTN","ECXUTL",218,0)
 I ECXAIP("POWL"),ECXAIP("POW")'="Y" S ECXAIP("POWL")=""
"RTN","ECXUTL",219,0)
 Q
"RTN","ECXUTL",220,0)
 ;
"RTN","ECXUTL",221,0)
PRVCLASS(PERS,DATE) ;determine the person class and return va code
"RTN","ECXUTL",222,0)
 ;   input
"RTN","ECXUTL",223,0)
 ;   PERS  = pointer to file #200 (required)
"RTN","ECXUTL",224,0)
 ;   DATE  = date on which person class must be active (required)
"RTN","ECXUTL",225,0)
 ;           (internal Fileman format)
"RTN","ECXUTL",226,0)
 ;   output
"RTN","ECXUTL",227,0)
 ;   VACODE = VA code field from file #8932.1
"RTN","ECXUTL",228,0)
 ;            (exactly 7 characters in length)
"RTN","ECXUTL",229,0)
 N ECX,VACODE
"RTN","ECXUTL",230,0)
 S VACODE=""
"RTN","ECXUTL",231,0)
 S ECX=$$GET^XUA4A72(PERS,DATE)
"RTN","ECXUTL",232,0)
 S VACODE=$P(ECX,"^",7) I $L(VACODE)'=7 S VACODE=""
"RTN","ECXUTL",233,0)
 Q VACODE
"VER")
8.0^21.0
"^DD",727.802,727.802,36,0)
PRIMARY WARD PROVIDER^F^^0;37^K:$L(X)>11!($L(X)<1) X
"^DD",727.802,727.802,36,3)
Answer must be 1-11 characters in length.
"^DD",727.802,727.802,36,21,0)
^^2^2^2980130^^^
"^DD",727.802,727.802,36,21,1,0)
The Primary Provider associated with the Facility Treating Specialty
"^DD",727.802,727.802,36,21,2,0)
for this Admission.
"^DD",727.802,727.802,36,23,0)
^^10^10^2980130^^^
"^DD",727.802,727.802,36,23,1,0)
Source:
"^DD",727.802,727.802,36,23,2,0)
field #.08; file #405
"^DD",727.802,727.802,36,23,3,0)
 
"^DD",727.802,727.802,36,23,4,0)
The PRIMARY CARE PHYSICIAN field (#.08) associated with the PATIENT
"^DD",727.802,727.802,36,23,5,0)
MOVEMENT file (#405) record for the Treating Specialty Change record
"^DD",727.802,727.802,36,23,6,0)
related to the Admission record.
"^DD",727.802,727.802,36,23,7,0)
 
"^DD",727.802,727.802,36,23,8,0)
The value obtained is a pointer to the NEW PERSON file (#200).  A "2"
"^DD",727.802,727.802,36,23,9,0)
is prefixed to the pointer value to indicate that it points to file
"^DD",727.802,727.802,36,23,10,0)
#200.
"^DD",727.802,727.802,36,"DT")
2980126
"^DD",727.803,727.803,30,0)
PROVIDER PERSON CLASS^F^^0;31^K:$L(X)>7!($L(X)<7) X
"^DD",727.803,727.803,30,3)
Answer must be 7 characters in length.
"^DD",727.803,727.803,30,21,0)
^^1^1^2980120^^
"^DD",727.803,727.803,30,21,1,0)
The VA Code of the Person Class of the Provider for this record.
"^DD",727.803,727.803,30,23,0)
^^16^16^2980120^^
"^DD",727.803,727.803,30,23,1,0)
Source:
"^DD",727.803,727.803,30,23,2,0)
Field #.01; sub-file #44.001; file #44
"^DD",727.803,727.803,30,23,3,0)
Field #.01; sub-file #44.003; file #44
"^DD",727.803,727.803,30,23,4,0)
Field #21; sub-file #2.98; file #2
"^DD",727.803,727.803,30,23,5,0)
Field #.05; file #409.68
"^DD",727.803,727.803,30,23,6,0)
(IEN to File #9000010)
"^DD",727.803,727.803,30,23,7,0)
Field #.01; file #9000010.06
"^DD",727.803,727.803,30,23,8,0)
Field #.01; sub-file #200.05; file #200
"^DD",727.803,727.803,30,23,9,0)
Field #5; file #8932.1
"^DD",727.803,727.803,30,23,10,0)
    
"^DD",727.803,727.803,30,23,11,0)
The field will hold the VA Code associated with the active Person
"^DD",727.803,727.803,30,23,12,0)
Class of the primary Provider associated with the extracted clinic
"^DD",727.803,727.803,30,23,13,0)
visit.
"^DD",727.803,727.803,30,23,14,0)
  
"^DD",727.803,727.803,30,23,15,0)
The VA Code is always of the form "V"_six numeric digits; exactly
"^DD",727.803,727.803,30,23,16,0)
7 characters in length.
"^DD",727.803,727.803,30,"DT")
2980120
"^DD",727.808,727.808,16,0)
LOSING WARD LOS^NJ4,0^^0;17^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",727.808,727.808,16,.1)
Losing Ward LOS
"^DD",727.808,727.808,16,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",727.808,727.808,16,21,0)
^^1^1^2980120^^^^
"^DD",727.808,727.808,16,21,1,0)
Length of stay on losing ward.
"^DD",727.808,727.808,16,23,0)
^^8^8^2980120^^^^
"^DD",727.808,727.808,16,23,1,0)
Calculated as current movement date minus the date (DATE/TIME 
"^DD",727.808,727.808,16,23,2,0)
field (#.01) of the PATIENT MOVEMENT file (#405)) of the previous
"^DD",727.808,727.808,16,23,3,0)
physical movement.
"^DD",727.808,727.808,16,23,4,0)
OR 
"^DD",727.808,727.808,16,23,5,0)
Calculated as current movement date minus the date (DATE/TIME
"^DD",727.808,727.808,16,23,6,0)
field (#.01) of the PATIENT MOVEMENT file (#405) record pointed
"^DD",727.808,727.808,16,23,7,0)
to by the ADMISSION/CHECK-IN MOVEMENT field (#.14) of the 
"^DD",727.808,727.808,16,23,8,0)
current movement record.
"^DD",727.808,727.808,16,"DT")
2980120
"^DD",727.808,727.808,17,0)
PLACEHOLDER1^F^^0;18^K:$L(X)>11!($L(X)<1) X
"^DD",727.808,727.808,17,.1)
Placeholder1
"^DD",727.808,727.808,17,3)

"^DD",727.808,727.808,17,21,0)
^^1^1^2980120^^^^
"^DD",727.808,727.808,17,21,1,0)
A placeholder.
"^DD",727.808,727.808,17,23,0)
^^1^1^2980120^^^^
"^DD",727.808,727.808,17,23,1,0)
For future development; always set to null.
"^DD",727.808,727.808,17,"DT")
2980120
"^DD",727.808,727.808,22,0)
PLACEHOLDER2^F^^0;23^K:$L(X)>11!($L(X)<1) X
"^DD",727.808,727.808,22,.1)
Placeholder2
"^DD",727.808,727.808,22,3)
Answer must be 1-11 characters in length.
"^DD",727.808,727.808,22,21,0)
^^1^1^2980120^^
"^DD",727.808,727.808,22,21,1,0)
A placeholder.
"^DD",727.808,727.808,22,23,0)
^^1^1^2980120^^
"^DD",727.808,727.808,22,23,1,0)
For future development; always set to null.
"^DD",727.808,727.808,22,"DT")
2980120
"^DD",727.808,727.808,23,0)
PLACEHOLDER3^F^^0;24^K:$L(X)>11!($L(X)<1) X
"^DD",727.808,727.808,23,.1)
Placeholder3
"^DD",727.808,727.808,23,3)
Answer must be 1-11 characters in length.
"^DD",727.808,727.808,23,21,0)
^^1^1^2980120^^
"^DD",727.808,727.808,23,21,1,0)
To be used for future development; currently set to null.
"^DD",727.808,727.808,23,23,0)
^^1^1^2980120^^
"^DD",727.808,727.808,23,23,1,0)
For future development; always set to null.
"^DD",727.808,727.808,23,"DT")
2980120
"^DD",727.811,727.811,36,0)
ADMISSION DATE^FO^^0;37^K:$L(X)>8!($L(X)<8) X
"^DD",727.811,727.811,36,2)
S Y(0)=Y S Y=$$ECXDATEX^ECXUTL(Y)
"^DD",727.811,727.811,36,2.1)
S Y=$$ECXDATEX^ECXUTL(Y)
"^DD",727.811,727.811,36,3)
Answer must be 8 characters in length.
"^DD",727.811,727.811,36,21,0)
^^2^2^2980130^^^^
"^DD",727.811,727.811,36,21,1,0)
This 8-character string represents the date on which the Admission
"^DD",727.811,727.811,36,21,2,0)
associated with this Surgery extract record took place.
"^DD",727.811,727.811,36,23,0)
^^8^8^2980130^^^^
"^DD",727.811,727.811,36,23,1,0)
Source:
"^DD",727.811,727.811,36,23,2,0)
field #.01; file #405
"^DD",727.811,727.811,36,23,3,0)
 
"^DD",727.811,727.811,36,23,4,0)
If the patient on whom the surgical procedure was performed was an
"^DD",727.811,727.811,36,23,5,0)
inpatient on the procedure date, then a call to IN5^VADPT returns
"^DD",727.811,727.811,36,23,6,0)
the Admission Date in VAIP(13,1).
"^DD",727.811,727.811,36,23,7,0)
 
"^DD",727.811,727.811,36,23,8,0)
The date is expanded to Y2K format appropriate to DSS of YYYYMMDD.
"^DD",727.811,727.811,36,"DT")
2970924
"^DD",727.813,727.813,9,0)
ACCESSION AREA^F^^0;10^K:$L(X)>5!($L(X)<1) X
"^DD",727.813,727.813,9,.1)
Accession Area
"^DD",727.813,727.813,9,3)
Answer must be 1-5 characters in length.
"^DD",727.813,727.813,9,21,0)
^^5^5^2980120^^^^
"^DD",727.813,727.813,9,21,1,0)
If the patient is a regular medical center patient, this field holds
"^DD",727.813,727.813,9,21,2,0)
a pointer to file #68.
"^DD",727.813,727.813,9,21,3,0)
 
"^DD",727.813,727.813,9,21,4,0)
If the patient is a referral, this field holds the Agency Code of
"^DD",727.813,727.813,9,21,5,0)
the referrinf Institution.
"^DD",727.813,727.813,9,23,0)
^^22^22^2980120^^^^
"^DD",727.813,727.813,9,23,1,0)
1. For Lab Extract without LMIP Codes:
"^DD",727.813,727.813,9,23,2,0)
   AREA field (.01) in the ACCESSION file (#68) as pointed to by the 
"^DD",727.813,727.813,9,23,3,0)
   ACCESSION AREA field (3) within the TEST multiple (6) within the 
"^DD",727.813,727.813,9,23,4,0)
   SPECIMEN multiple (1) of the LAB ORDER ENTRY file (#69). 
"^DD",727.813,727.813,9,23,5,0)
 
"^DD",727.813,727.813,9,23,6,0)
2. For Lab Extract with LMIP Codes:
"^DD",727.813,727.813,9,23,7,0)
   Source:
"^DD",727.813,727.813,9,23,8,0)
   Field #14; file #64.03
"^DD",727.813,727.813,9,23,9,0)
   File d#6; sub-file #64.1111; sub-file #64.111; sub-file #64.11;
"^DD",727.813,727.813,9,23,10,0)
     file #64.1
"^DD",727.813,727.813,9,23,11,0)
   OR
"^DD",727.813,727.813,9,23,12,0)
   Field #14; file #64.03
"^DD",727.813,727.813,9,23,13,0)
   Field #95; file #4
"^DD",727.813,727.813,9,23,14,0)
  
"^DD",727.813,727.813,9,23,15,0)
   For laboratory procedure on a routine medical center patient,
"^DD",727.813,727.813,9,23,16,0)
   this field will contain the internal record number of the 
"^DD",727.813,727.813,9,23,17,0)
   Accession Area in the ACCESSION file (#68).
"^DD",727.813,727.813,9,23,18,0)
  
"^DD",727.813,727.813,9,23,19,0)
   For procedure on a referral patient, this field will contain
"^DD",727.813,727.813,9,23,20,0)
   the 2-character Agency Code from the AGENCY CODE field (#95)
"^DD",727.813,727.813,9,23,21,0)
   of the INSTITUTION file (#4) record which represents the 
"^DD",727.813,727.813,9,23,22,0)
   referring Institution.
"^DD",727.813,727.813,9,"DT")
2980120
"^DD",727.817,727.817,14,0)
NEW TREATING SPECIALTY^P42.4'^DIC(42.4,^0;15^Q
"^DD",727.817,727.817,14,.1)
New Treating Specialty
"^DD",727.817,727.817,14,3)

"^DD",727.817,727.817,14,21,0)
^^2^2^2980120^^^^
"^DD",727.817,727.817,14,21,1,0)
The Specialty associated with the Facility Treating Specialty to which
"^DD",727.817,727.817,14,21,2,0)
patient is being moved.
"^DD",727.817,727.817,14,23,0)
^^9^9^2980120^
"^DD",727.817,727.817,14,23,1,0)
Source:
"^DD",727.817,727.817,14,23,2,0)
Field #.09; file #405
"^DD",727.817,727.817,14,23,3,0)
Field #1; file #45.7
"^DD",727.817,727.817,14,23,4,0)
 
"^DD",727.817,727.817,14,23,5,0)
Internal entry number of SPECIALTY file (#42.4) derived from SPECIALTY
"^DD",727.817,727.817,14,23,6,0)
field (#1) of FACILITY TREATING SPECIALTY file (#45.7) record pointed
"^DD",727.817,727.817,14,23,7,0)
to by FACILITY TREATING SPECIALTY field (#.09) of PATIENT MOVEMENT 
"^DD",727.817,727.817,14,23,8,0)
file (#405) record.  The movement record is the current treating 
"^DD",727.817,727.817,14,23,9,0)
specialty movement.
"^DD",727.817,727.817,14,"DT")
2980120
"^DD",727.817,727.817,15,0)
LOSING TREATING SPECIALTY^P42.4'^DIC(42.4,^0;16^Q
"^DD",727.817,727.817,15,.1)
Losing Treating Specialty
"^DD",727.817,727.817,15,3)

"^DD",727.817,727.817,15,21,0)
^^4^4^2980120^^^^
"^DD",727.817,727.817,15,21,1,0)
The Specialty associated with the losing Facility Treating Specialty
"^DD",727.817,727.817,15,21,2,0)
for this patient movement.  If this movement is not an actual treating
"^DD",727.817,727.817,15,21,3,0)
specialty change, then it is possible for this field to be the same as
"^DD",727.817,727.817,15,21,4,0)
NEW TREATING SPECIALTY field (#14).
"^DD",727.817,727.817,15,23,0)
^^12^12^2980120^^^^
"^DD",727.817,727.817,15,23,1,0)
Using the "ATT3" or "ATT6" cross reference on the PATIENT MOVEMENT file 
"^DD",727.817,727.817,15,23,2,0)
(#405) and the patient pointer (DFN) stored in the PATIENT NO. - DFN 
"^DD",727.817,727.817,15,23,3,0)
field (4) in the TREATING SPECIALTY CHANGE EXTRACT file (#727.817), 
"^DD",727.817,727.817,15,23,4,0)
NEW TREATING SPECIALTY data is derived from the FACILITY TREATING 
"^DD",727.817,727.817,15,23,5,0)
SPECIALTY field (.09) in the PATIENT MOVEMENT file (#405). This facility 
"^DD",727.817,727.817,15,23,6,0)
treating specialty data is a pointer to the FACILITY TREATING SPECIALTY 
"^DD",727.817,727.817,15,23,7,0)
file (#45.7). Using the SPECIALTY field (1) in the FACILITY TREATING 
"^DD",727.817,727.817,15,23,8,0)
SPECIALTY file (#45.7), the pointer to the SPECIALTY file (#42.4) is 
"^DD",727.817,727.817,15,23,9,0)
obtained.
"^DD",727.817,727.817,15,23,10,0)
 
"^DD",727.817,727.817,15,23,11,0)
This Specialty is then the LOSING Specialty for the Treating Specialty
"^DD",727.817,727.817,15,23,12,0)
change occurring on the date in the TRT extract record.  
"^DD",727.817,727.817,15,"DT")
2980120
"^DD",727.817,727.817,16,0)
LOSING TREATING SPECIALTY LOS^NJ4,0^^0;17^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",727.817,727.817,16,.1)
Losing TS LOS
"^DD",727.817,727.817,16,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",727.817,727.817,16,21,0)
^^1^1^2980120^^^^
"^DD",727.817,727.817,16,21,1,0)
The length of stay on the losing treating specialty.
"^DD",727.817,727.817,16,23,0)
^^7^7^2980120^^^^
"^DD",727.817,727.817,16,23,1,0)
Calculated as current treating specialty date minus the date (DATE/TIME 
"^DD",727.817,727.817,16,23,2,0)
field (.01) of the PATIENT MOVEMENT file (#405)) of the last treating 
"^DD",727.817,727.817,16,23,3,0)
specialty change.
"^DD",727.817,727.817,16,23,4,0)
 
"^DD",727.817,727.817,16,23,5,0)
This field will only be used for actual treating specialty changes.  
"^DD",727.817,727.817,16,23,6,0)
For file #405 records which reflect provider-only changes this 
"^DD",727.817,727.817,16,23,7,0)
field will be null.
"^DD",727.817,727.817,16,"DT")
2980116
"^DD",727.817,727.817,17,0)
LOSING ATTENDING PHYSICIAN^F^^0;18^K:$L(X)>11!($L(X)<1) X
"^DD",727.817,727.817,17,.1)
Losing Attending Physician
"^DD",727.817,727.817,17,3)
Enter attending physician assigned to this patient.
"^DD",727.817,727.817,17,21,0)
^^2^2^2980120^^^^
"^DD",727.817,727.817,17,21,1,0)
The Attending Physician associated with the previous treating
"^DD",727.817,727.817,17,21,2,0)
specialty change record in file #405.
"^DD",727.817,727.817,17,23,0)
^^4^4^2980120^^^^
"^DD",727.817,727.817,17,23,1,0)
Derived from the ATTENDING PHYSICIAN field (.19) of the PATIENT MOVEMENT 
"^DD",727.817,727.817,17,23,2,0)
file (#405). If ATTENDING PHYSICIAN is a pointer to the NEW PERSON file 
"^DD",727.817,727.817,17,23,3,0)
(#200), it is stored as "2"_pointer value. If ATTENDING PHYSICIAN is a 
"^DD",727.817,727.817,17,23,4,0)
pointer to the PROVIDER file (#6), it is stored as "6"_pointer value.
"^DD",727.817,727.817,17,"DT")
2980120
"^DD",727.817,727.817,21,0)
NEW PRIMARY WARD PROVIDER^F^^0;22^K:$L(X)>11!($L(X)<1) X
"^DD",727.817,727.817,21,.1)
New Primary Ward Provider
"^DD",727.817,727.817,21,3)
Answer must be 1-11 characters in length.
"^DD",727.817,727.817,21,21,0)
^^2^2^2980120^^^
"^DD",727.817,727.817,21,21,1,0)
The new Primary Provider associated with the current patient
"^DD",727.817,727.817,21,21,2,0)
movement record in file #405.
"^DD",727.817,727.817,21,23,0)
^^10^10^2980120^^^
"^DD",727.817,727.817,21,23,1,0)
Source:
"^DD",727.817,727.817,21,23,2,0)
Field #.08; file #405
"^DD",727.817,727.817,21,23,3,0)
  
"^DD",727.817,727.817,21,23,4,0)
Internal entry number of NEW PERSON file (#200) derived from the 
"^DD",727.817,727.817,21,23,5,0)
PRIMARY CARE PHYSICIAN field (#.08) of the PATIENT MOVEMENT file
"^DD",727.817,727.817,21,23,6,0)
(#405). The movement record here is the current treating specialty
"^DD",727.817,727.817,21,23,7,0)
movement.
"^DD",727.817,727.817,21,23,8,0)
  
"^DD",727.817,727.817,21,23,9,0)
A "2" is prefixed to this pointer value, if the pointer references
"^DD",727.817,727.817,21,23,10,0)
file #200.
"^DD",727.817,727.817,21,"DT")
2980120
"^DD",727.817,727.817,22,0)
NEW ATTENDING PHYSICIAN^F^^0;23^K:$L(X)>11!($L(X)<1) X
"^DD",727.817,727.817,22,.1)
New Attending Physician
"^DD",727.817,727.817,22,3)
Answer must be 1-11 characters in length.
"^DD",727.817,727.817,22,21,0)
^^2^2^2980120^^
"^DD",727.817,727.817,22,21,1,0)
The new Attending Physician associated with the current patient
"^DD",727.817,727.817,22,21,2,0)
movement record in file #405.
"^DD",727.817,727.817,22,23,0)
^^10^10^2980120^^
"^DD",727.817,727.817,22,23,1,0)
Source:
"^DD",727.817,727.817,22,23,2,0)
Field #.19; file #405
"^DD",727.817,727.817,22,23,3,0)
  
"^DD",727.817,727.817,22,23,4,0)
Internal entry number of NEW PERSON file (#200) derived from the 
"^DD",727.817,727.817,22,23,5,0)
ATTENDING PHYSICIAN field (#.19) of the PATIENT MOVEMENT file
"^DD",727.817,727.817,22,23,6,0)
(#405). The movement record here is the current treating specialty
"^DD",727.817,727.817,22,23,7,0)
movement.
"^DD",727.817,727.817,22,23,8,0)
  
"^DD",727.817,727.817,22,23,9,0)
A "2" is prefixed to this pointer value, if the pointer references
"^DD",727.817,727.817,22,23,10,0)
file #200.
"^DD",727.817,727.817,22,"DT")
2980120
"^DD",727.817,727.817,23,0)
LOSING PRIMARY WARD PROVIDER^F^^0;24^K:$L(X)>11!($L(X)<1) X
"^DD",727.817,727.817,23,.1)
Losing Primary Ward Provider
"^DD",727.817,727.817,23,3)
Answer must be 1-11 characters in length.
"^DD",727.817,727.817,23,21,0)
^^2^2^2980120^^
"^DD",727.817,727.817,23,21,1,0)
The losing Primary Provider for the patient movement; i.e., the Primary
"^DD",727.817,727.817,23,21,2,0)
Provider of the previous treating specialty chnage record.
"^DD",727.817,727.817,23,23,0)
^^11^11^2980120^^
"^DD",727.817,727.817,23,23,1,0)
Source:
"^DD",727.817,727.817,23,23,2,0)
Field #.08; file #405
"^DD",727.817,727.817,23,23,3,0)
  
"^DD",727.817,727.817,23,23,4,0)
Internal entry number of NEW PERSON file (#200) derived from the
"^DD",727.817,727.817,23,23,5,0)
PRIMARY CARE PHYSICIAN field (#.08) of the PATIENT MOVEMENT file 
"^DD",727.817,727.817,23,23,6,0)
(#405). The movement record is not the current treating specialty 
"^DD",727.817,727.817,23,23,7,0)
movement, but the one which corresponds to the previous treating 
"^DD",727.817,727.817,23,23,8,0)
specialty or provider change.
"^DD",727.817,727.817,23,23,9,0)
  
"^DD",727.817,727.817,23,23,10,0)
A "2" is prefixed to this pointer value, if the pointer references
"^DD",727.817,727.817,23,23,11,0)
file #200.
"^DD",727.817,727.817,23,"DT")
2980120
"^DD",728.44,728.44,5,0)
ACTION TO SEND^RS^1:SEND STOP CODE;4:SEND BOTH AS ONE RECORD WITH NATIONAL CODE;5:SEND BOTH AS ONE RECORD WITHOUT NATIONAL CODE;6:DO NOT SEND;^0;6^Q
"^DD",728.44,728.44,5,3)
Select the appropriate stop code action.
"^DD",728.44,728.44,5,21,0)
^^2^2^2950713^^^^
"^DD",728.44,728.44,5,21,1,0)
This determines how alternate stop code and alternate credit stop
"^DD",728.44,728.44,5,21,2,0)
codes are combined to form a feeder key for this clinic.
"^DD",728.44,728.44,5,23,0)
^^2^2^2950713^^^^
"^DD",728.44,728.44,5,23,1,0)
This field is used in routine ECXSCX to create the feeder key for
"^DD",728.44,728.44,5,23,2,0)
this clinic.
"^DD",728.44,728.44,5,"DT")
2980120
**END**
**END**
