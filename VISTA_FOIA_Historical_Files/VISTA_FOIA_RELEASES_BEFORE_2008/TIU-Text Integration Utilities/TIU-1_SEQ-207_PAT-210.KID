Released TIU*1*210 SEQ #207
Extracted from mail message
**KIDS**:TIU*1.0*210^

**INSTALL NAME**
TIU*1.0*210
"BLD",6822,0)
TIU*1.0*210^TEXT INTEGRATION UTILITIES^0^3061206^y
"BLD",6822,1,0)
^^7^7^3060719^
"BLD",6822,1,1,0)
This patch will add a parameter to the TIU PARAMETERS file (8925.99) 
"BLD",6822,1,2,0)
called LENGTH OF SIGNER ALERT PERIOD. This parameter will be used to 
"BLD",6822,1,3,0)
determine how far back the TIU NIGHTLY TASK should search when looking 
"BLD",6822,1,4,0)
for documents needing a signature. Input transforms for fields START OF 
"BLD",6822,1,5,0)
ADD SGNR ALERT PERIOD and END OF ADD SGNR ALERT PERIOD in file 8925.99 
"BLD",6822,1,6,0)
were not working properly and were corrected. It also correctS an 
"BLD",6822,1,7,0)
undefined error in routine TIUSRVPT.
"BLD",6822,4,0)
^9.64PA^8925.99^1
"BLD",6822,4,8925.99,0)
8925.99
"BLD",6822,4,8925.99,2,0)
^9.641^8925.99^1
"BLD",6822,4,8925.99,2,8925.99,0)
TIU PARAMETERS  (File-top level)
"BLD",6822,4,8925.99,2,8925.99,1,0)
^9.6411^3.3^3
"BLD",6822,4,8925.99,2,8925.99,1,3.1,0)
START OF ADD SGNR ALERT PERIOD
"BLD",6822,4,8925.99,2,8925.99,1,3.2,0)
END OF ADD SGNR ALERT PERIOD
"BLD",6822,4,8925.99,2,8925.99,1,3.3,0)
LENGTH OF SIGNER ALERT PERIOD
"BLD",6822,4,8925.99,222)
y^n^p^^^^n^^n
"BLD",6822,4,8925.99,224)

"BLD",6822,4,"APDD",8925.99,8925.99)

"BLD",6822,4,"APDD",8925.99,8925.99,3.1)

"BLD",6822,4,"APDD",8925.99,8925.99,3.2)

"BLD",6822,4,"APDD",8925.99,8925.99,3.3)

"BLD",6822,4,"B",8925.99,8925.99)

"BLD",6822,6)
4^
"BLD",6822,6.3)
1
"BLD",6822,"ABPKG")
n
"BLD",6822,"KRN",0)
^9.67PA^8989.52^19
"BLD",6822,"KRN",.4,0)
.4
"BLD",6822,"KRN",.401,0)
.401
"BLD",6822,"KRN",.402,0)
.402
"BLD",6822,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",6822,"KRN",.402,"NM",1,0)
TIU BASIC PARAMETER EDIT    FILE #8925.99^8925.99^0
"BLD",6822,"KRN",.402,"NM","B","TIU BASIC PARAMETER EDIT    FILE #8925.99",1)
 
"BLD",6822,"KRN",.403,0)
.403
"BLD",6822,"KRN",.5,0)
.5
"BLD",6822,"KRN",.84,0)
.84
"BLD",6822,"KRN",3.6,0)
3.6
"BLD",6822,"KRN",3.8,0)
3.8
"BLD",6822,"KRN",9.2,0)
9.2
"BLD",6822,"KRN",9.8,0)
9.8
"BLD",6822,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6822,"KRN",9.8,"NM",1,0)
TIUTSK^^0^B21071583
"BLD",6822,"KRN",9.8,"NM",2,0)
TIUSRVPT^^0^B10694146
"BLD",6822,"KRN",9.8,"NM","B","TIUSRVPT",2)
 
"BLD",6822,"KRN",9.8,"NM","B","TIUTSK",1)
 
"BLD",6822,"KRN",19,0)
19
"BLD",6822,"KRN",19.1,0)
19.1
"BLD",6822,"KRN",101,0)
101
"BLD",6822,"KRN",409.61,0)
409.61
"BLD",6822,"KRN",771,0)
771
"BLD",6822,"KRN",870,0)
870
"BLD",6822,"KRN",8989.51,0)
8989.51
"BLD",6822,"KRN",8989.52,0)
8989.52
"BLD",6822,"KRN",8994,0)
8994
"BLD",6822,"KRN","B",.4,.4)
 
"BLD",6822,"KRN","B",.401,.401)
 
"BLD",6822,"KRN","B",.402,.402)
 
"BLD",6822,"KRN","B",.403,.403)
 
"BLD",6822,"KRN","B",.5,.5)
 
"BLD",6822,"KRN","B",.84,.84)
 
"BLD",6822,"KRN","B",3.6,3.6)
 
"BLD",6822,"KRN","B",3.8,3.8)
 
"BLD",6822,"KRN","B",9.2,9.2)
 
"BLD",6822,"KRN","B",9.8,9.8)
 
"BLD",6822,"KRN","B",19,19)
 
"BLD",6822,"KRN","B",19.1,19.1)
 
"BLD",6822,"KRN","B",101,101)
 
"BLD",6822,"KRN","B",409.61,409.61)
 
"BLD",6822,"KRN","B",771,771)
 
"BLD",6822,"KRN","B",870,870)
 
"BLD",6822,"KRN","B",8989.51,8989.51)
 
"BLD",6822,"KRN","B",8989.52,8989.52)
 
"BLD",6822,"KRN","B",8994,8994)
 
"BLD",6822,"QUES",0)
^9.62^^
"BLD",6822,"REQB",0)
^9.611^2^2
"BLD",6822,"REQB",1,0)
TIU*1.0*157^2
"BLD",6822,"REQB",2,0)
TIU*1.0*186^2
"BLD",6822,"REQB","B","TIU*1.0*157",1)
 
"BLD",6822,"REQB","B","TIU*1.0*186",2)
 
"FIA",8925.99)
TIU PARAMETERS
"FIA",8925.99,0)
^TIU(8925.99,
"FIA",8925.99,0,0)
8925.99P
"FIA",8925.99,0,1)
y^n^p^^^^n^^n
"FIA",8925.99,0,10)

"FIA",8925.99,0,11)

"FIA",8925.99,0,"RLRO")

"FIA",8925.99,0,"VR")
1.0^TIU
"FIA",8925.99,8925.99)
1
"FIA",8925.99,8925.99,3.1)

"FIA",8925.99,8925.99,3.2)

"FIA",8925.99,8925.99,3.3)

"KRN",.402,2345,-1)
0^1
"KRN",.402,2345,0)
TIU BASIC PARAMETER EDIT^3060201.1423^^8925.99^^^3060719
"KRN",.402,2345,"DR",1,8925.99)
.02;1.07;.05;I +$P($G(^TIU(8925.99,+DA,0)),U,4)'>0 S Y="@1";.04///@;@1;.14;.03;.06;.07;.08;1.06;3.1;3.2;3.3;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
210^3061206^101036
"PKG",470,22,1,"PAH",1,1,0)
^^7^7^3061206
"PKG",470,22,1,"PAH",1,1,1,0)
This patch will add a parameter to the TIU PARAMETERS file (8925.99) 
"PKG",470,22,1,"PAH",1,1,2,0)
called LENGTH OF SIGNER ALERT PERIOD. This parameter will be used to 
"PKG",470,22,1,"PAH",1,1,3,0)
determine how far back the TIU NIGHTLY TASK should search when looking 
"PKG",470,22,1,"PAH",1,1,4,0)
for documents needing a signature. Input transforms for fields START OF 
"PKG",470,22,1,"PAH",1,1,5,0)
ADD SGNR ALERT PERIOD and END OF ADD SGNR ALERT PERIOD in file 8925.99 
"PKG",470,22,1,"PAH",1,1,6,0)
were not working properly and were corrected. It also correctS an 
"PKG",470,22,1,"PAH",1,1,7,0)
undefined error in routine TIUSRVPT.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUSRVPT")
0^2^B10694146^B10584847
"RTN","TIUSRVPT",1,0)
TIUSRVPT ; SLC/JER - Set Methods for Documents ; 03/31/04
"RTN","TIUSRVPT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**122,175,186,210**;Jun 20, 1997;Build 1
"RTN","TIUSRVPT",3,0)
SETTEXT(TIUY,TIUDA,TIUX,SUPPRESS) ; Save Text - use Buffered I/O
"RTN","TIUSRVPT",4,0)
 N PAGES,PAGE S TIUY=0,SUPPRESS=$G(SUPPRESS,0)
"RTN","TIUSRVPT",5,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVPT",6,0)
 . S TIUY="0^0^0^Attempt to file data in a Nonexistent Entry."
"RTN","TIUSRVPT",7,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",8,0)
 S PAGE=$P($G(TIUX("HDR")),U),PAGES=$P($G(TIUX("HDR")),U,2)
"RTN","TIUSRVPT",9,0)
 I $S('PAGE:1,'PAGES:1,1:0) D  Q
"RTN","TIUSRVPT",10,0)
 . S TIUY="0^0^0^Invalid text block header"
"RTN","TIUSRVPT",11,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",12,0)
 ; I PAGE=1 D MERGTEMP^TIUEDI1(TIUDA) K ^TIU(8925,+TIUDA,"TEMP"),^("TEXT")
"RTN","TIUSRVPT",13,0)
 I PAGE=1 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVPT",14,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVPT",15,0)
 ;if done, commit changes
"RTN","TIUSRVPT",16,0)
 I 'SUPPRESS,(PAGE=PAGES),$D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSRVPT",17,0)
 . N TIUC,TIUI,TIU S (TIUC,TIUI)=0
"RTN","TIUSRVPT",18,0)
 . F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVPT",19,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVPT",20,0)
 . I TIUC>0 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVPT",21,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVPT",22,0)
 . K ^TIU(8925,TIUDA,"TEXT")
"RTN","TIUSRVPT",23,0)
 . D
"RTN","TIUSRVPT",24,0)
 . . N TIUC
"RTN","TIUSRVPT",25,0)
 . . S TIUC=0 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIUSRVPT",26,0)
 . . . I +$$ISADDNDM^TIULC1(+TIUC) Q
"RTN","TIUSRVPT",27,0)
 . . . K ^TIU(8925,+TIUC,"TEXT")
"RTN","TIUSRVPT",28,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVPT",29,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSRVPT",30,0)
 ; Acknowledge success / ask for next page
"RTN","TIUSRVPT",31,0)
 S TIUY=TIUDA_U_PAGE_U_PAGES
"RTN","TIUSRVPT",32,0)
 Q
"RTN","TIUSRVPT",33,0)
ADMNCLOS(TIUY,TIUDA,MODE,PERSON) ; Post Administrative Closure Information
"RTN","TIUSRVPT",34,0)
 N TIUX,TIUI,TIUCLBY,TIUCLTTL
"RTN","TIUSRVPT",35,0)
 I '$D(^TIU(8925,TIUDA)) S TIUY="0^Attempt to file data in a Nonexistent Entry." Q
"RTN","TIUSRVPT",36,0)
 S MODE=$G(MODE,"S")
"RTN","TIUSRVPT",37,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIUSRVPT",38,0)
 S TIUCLBY=$$SIGNAME^TIULS(PERSON)
"RTN","TIUSRVPT",39,0)
 S TIUCLTTL=$$SIGTITL^TIULS(PERSON)
"RTN","TIUSRVPT",40,0)
 S TIUX(.05)=7
"RTN","TIUSRVPT",41,0)
 S TIUX(1606)=$G(DT)
"RTN","TIUSRVPT",42,0)
 S TIUX(1607)=TIUCLBY
"RTN","TIUSRVPT",43,0)
 S TIUX(1608)=TIUCLTTL
"RTN","TIUSRVPT",44,0)
 S TIUX(1613)=MODE
"RTN","TIUSRVPT",45,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX)
"RTN","TIUSRVPT",46,0)
 S TIUI=$P($G(^TIU(8925,TIUDA,"TEXT",0)),U,3)+1
"RTN","TIUSRVPT",47,0)
 ;If scanned document set document body to informational text
"RTN","TIUSRVPT",48,0)
 I MODE="S" D
"RTN","TIUSRVPT",49,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",50,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                           *** SCANNED DOCUMENT ***",TIUI=TIUI+1
"RTN","TIUSRVPT",51,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                            SIGNATURE NOT REQUIRED",TIUI=TIUI+1
"RTN","TIUSRVPT",52,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",53,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",54,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="Administrative Closure: "_$$DATE^TIULS(DT,"MM/DD/CCYY"),TIUI=TIUI+1
"RTN","TIUSRVPT",55,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                    by: "_TIUCLBY,TIUI=TIUI+1
"RTN","TIUSRVPT",56,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                        "_TIUCLTTL
"RTN","TIUSRVPT",57,0)
 S ^TIU(8925,+TIUDA,"TEXT",0)="^^"_TIUI_U_TIUI_U_DT_"^^"
"RTN","TIUSRVPT",58,0)
 D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIUSRVPT",59,0)
 Q
"RTN","TIUSRVPT",60,0)
ERROR(ECODE) ; Register AUTOSAVE Error
"RTN","TIUSRVPT",61,0)
 N ERRDT S ERRDT=+$$NOW^XLFDT
"RTN","TIUSRVPT",62,0)
 Q:+$G(^XTMP("TIUERR","COUNT"))'<100
"RTN","TIUSRVPT",63,0)
 I '$D(^XTMP("TIUERR",0)) D
"RTN","TIUSRVPT",64,0)
 . S ^XTMP("TIUERR",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","TIUSRVPT",65,0)
 S ^XTMP("TIUERR",ERRDT,"ECODE")=ECODE
"RTN","TIUSRVPT",66,0)
 S ^XTMP("TIUERR",ERRDT,"USER")=DUZ
"RTN","TIUSRVPT",67,0)
 S ^XTMP("TIUERR",ERRDT,"TIUDA")=$G(TIUDA,"UNDEFINED")
"RTN","TIUSRVPT",68,0)
 S ^XTMP("TIUERR",ERRDT,"TIUHDR")=$G(TIUX("HDR"))
"RTN","TIUSRVPT",69,0)
 S ^XTMP("TIUERR",ERRDT,"XWBHDR")=$G(XWBS1("HDR"))
"RTN","TIUSRVPT",70,0)
 S ^XTMP("TIUERR","COUNT")=$G(^XTMP("TIUERR","COUNT"))+1
"RTN","TIUSRVPT",71,0)
 Q
"RTN","TIUTSK")
0^1^B21071583^B20710718
"RTN","TIUTSK",1,0)
TIUTSK ; SLC/JER - TIU's Nightly Daemon ;4/18/03 [10/18/04 10:34am]
"RTN","TIUTSK",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,53,100,113,157,210**;Jun 20, 1997;Build 1
"RTN","TIUTSK",3,0)
MAIN ; All records are read. DC date updated, Record purged, Alerts are 
"RTN","TIUTSK",4,0)
 ; generated if appropriate
"RTN","TIUTSK",5,0)
 N TIUDA,TIUPRM0,TIUPRM1,TIUDATE,TIUENTDT,TIUPDT,TIUODT
"RTN","TIUTSK",6,0)
 N TIUSTART,TIUEND
"RTN","TIUTSK",7,0)
 D SETPARM^TIULE
"RTN","TIUTSK",8,0)
 S TIUSTART=$$TSKPARM(1),TIUEND=$$TSKPARM(2)
"RTN","TIUTSK",9,0)
 ; Traverse "FIX" X-ref to fix temporary reference dates & back-fill
"RTN","TIUTSK",10,0)
 ; Discharge Dates
"RTN","TIUTSK",11,0)
 S TIUDA="" F  S TIUDA=$O(^TIU(8925,"FIX",1,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",12,0)
 . D UPDDCDT(TIUDA) ;Ref Date fixed/DC Date updated if missing
"RTN","TIUTSK",13,0)
 ; Traverse "F" X-ref to identify records for which the grace period
"RTN","TIUTSK",14,0)
 ; for purge has expired
"RTN","TIUTSK",15,0)
 S TIUPDT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,4))
"RTN","TIUTSK",16,0)
 S TIUODT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,5))
"RTN","TIUTSK",17,0)
 ; Traverse "F" X-ref to identify records overdue for signature or purge
"RTN","TIUTSK",18,0)
 ; NOTE: Following VHA Directive 10-92-077, the purge is disabled until
"RTN","TIUTSK",19,0)
 ;       further notice **53**
"RTN","TIUTSK",20,0)
 S TIUENTDT=($$TSKPARM(3)-1)+.999999
"RTN","TIUTSK",21,0)
 F  S TIUENTDT=$O(^TIU(8925,"F",TIUENTDT)) Q:+TIUENTDT'>0!(TIUENTDT>TIUODT)  D
"RTN","TIUTSK",22,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"F",+TIUENTDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",23,0)
 . . ; I (TIUPDT<$$FMADD^XLFDT(DT,-90)),+$$PURGE^TIULC(TIUDA) D PURGE(TIUDA) Purges old records (see NOTE above) **53**
"RTN","TIUTSK",24,0)
 . . I +$$OVERDUE(TIUDA,TIUSTART,TIUEND) D SEND^TIUALRT(TIUDA,1) ;Alert for overdue
"RTN","TIUTSK",25,0)
 ; If upload buffer rec older than 30 days, delete it & its alerts
"RTN","TIUTSK",26,0)
 S TIUDA=0 F  S TIUDA=$O(^TIU(8925.2,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",27,0)
 . N TIUDATE
"RTN","TIUTSK",28,0)
 . S TIUDATE=$P($G(^TIU(8925.2,TIUDA,0)),U,3)
"RTN","TIUTSK",29,0)
 . Q:+TIUDATE'>0
"RTN","TIUTSK",30,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>30 D
"RTN","TIUTSK",31,0)
 . . N TIUEI S TIUEI=0
"RTN","TIUTSK",32,0)
 . . ; JOEL, 12/21/00:
"RTN","TIUTSK",33,0)
 . . F  S TIUEI=$O(^TIU(8925.2,TIUDA,"ERR",TIUEI)) Q:+TIUEI'>0  D
"RTN","TIUTSK",34,0)
 . . . N TIUEDA
"RTN","TIUTSK",35,0)
 . . . S TIUEDA=+$G(^TIU(8925.2,TIUDA,"ERR",TIUEI,0)) Q:+TIUEDA'>0
"RTN","TIUTSK",36,0)
 . . . D ALERTDEL^TIUPEVNT(TIUEDA)
"RTN","TIUTSK",37,0)
 . . D BUFPURGE^TIUPUTC(TIUDA)
"RTN","TIUTSK",38,0)
 Q
"RTN","TIUTSK",39,0)
UPDDCDT(TIUDA) ; If missing DC date & Patient Movement file has DC date,
"RTN","TIUTSK",40,0)
 ;         DC date updated.
"RTN","TIUTSK",41,0)
 N DFN,DIE,DR,TIU,TIUDAD,TIUDDT,TIUD0,TIUD14,TIUDGPM
"RTN","TIUTSK",42,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUTSK",43,0)
 S TIUDGPM=+$P(TIUD14,U)
"RTN","TIUTSK",44,0)
 I +$P($G(^DGPM(+TIUDGPM,0)),U,17)'>0 D  Q
"RTN","TIUTSK",45,0)
 . I +$P(TIUD0,U,12)>0 Q
"RTN","TIUTSK",46,0)
 . S DIE=8925,DR=".12////1",DA=TIUDA D ^DIE
"RTN","TIUTSK",47,0)
 I TIUD0'="",'+$P(TIUD0,U,6),(($P(TIUD0,U,8)="")!(+$P(TIUD0,U,12)>0)) D
"RTN","TIUTSK",48,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUTSK",49,0)
 . I +$G(TIU("LDT"))>0 D
"RTN","TIUTSK",50,0)
 . . S TIUDAD=$P(TIUD0,U,6)
"RTN","TIUTSK",51,0)
 . . D FIXDC(TIUDA,TIUDAD,DFN,.TIU)
"RTN","TIUTSK",52,0)
 Q
"RTN","TIUTSK",53,0)
PURGE(DA) ; When purge criteria met, document and addenda purged
"RTN","TIUTSK",54,0)
 N DR,DIE,TIUTYP,TIUDA,X,Y S TIUDA=0
"RTN","TIUTSK",55,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",56,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D PURGE(TIUDA) I 1
"RTN","TIUTSK",57,0)
 . E  D DIK^TIURB2(TIUDA) ; Remove components entirely. 1/3/01 updated DIK^TIURB to DIK^TIURB2 - Margy
"RTN","TIUTSK",58,0)
 S DIE=8925,DR=".05///PURGED;1609////"_$$NOW^TIULC_";2///@" D ^DIE
"RTN","TIUTSK",59,0)
 S ^TIU(8925,+DA,"TEXT",0)="^^"_2_U_2_U_DT_"^^"
"RTN","TIUTSK",60,0)
 S ^TIU(8925,+DA,"TEXT",1,0)=" "
"RTN","TIUTSK",61,0)
 S ^TIU(8925,+DA,"TEXT",2,0)="  Document Purged on "_$$DATE^TIULS(DT,"MM/DD/YY")_"."
"RTN","TIUTSK",62,0)
 Q
"RTN","TIUTSK",63,0)
FIXDC(DA,PARENT,DFN,TIU) ; Stuff fixed field data
"RTN","TIUTSK",64,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUTSK",65,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUTSK",66,0)
 I +$G(PARENT)'>0 D
"RTN","TIUTSK",67,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",68,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U)
"RTN","TIUTSK",69,0)
 I +$G(PARENT)>0 D
"RTN","TIUTSK",70,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",71,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUTSK",72,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUTSK",73,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUTSK",74,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUTSK",75,0)
 S @FDARR@(.12)="@"
"RTN","TIUTSK",76,0)
 S @FDARR@(1301)=+$G(TIU("LDT"))
"RTN","TIUTSK",77,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUTSK",78,0)
 Q
"RTN","TIUTSK",79,0)
OVERDUE(TIUDA,TIUSTART,TIUEND) ;Checks whether or not a given document is overdue
"RTN","TIUTSK",80,0)
 ;This is the same as OVERDUE^TIULC exept for the following items:
"RTN","TIUTSK",81,0)
 ;    TIUPRM0 must be defined before calling
"RTN","TIUTSK",82,0)
 ;    also checks for additional signatures overdue
"RTN","TIUTSK",83,0)
 N TIUD0,TIUDATE,TIUY,TIUDPRM,TIUXTRA S TIUY=0,TIUD0=$G(^TIU(8925,TIUDA,0)),TIUXTRA=0
"RTN","TIUTSK",84,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM,TIUDA)
"RTN","TIUTSK",85,0)
 I '$D(TIUDPRM) G OVERX
"RTN","TIUTSK",86,0)
 S TIUDATE=$S($$REQVER^TIULC(TIUDA,+$P(TIUDPRM(0),U,3)):$P($G(^TIU(8925,+TIUDA,13)),U,5),$P(TIUDPRM(0),U,2):$P($G(^TIU(8925,+TIUDA,13)),U,4),1:$P($G(^TIU(8925,+TIUDA,12)),U))
"RTN","TIUTSK",87,0)
 G:+TIUDATE'>0 OVERX
"RTN","TIUTSK",88,0)
 I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)>4),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)<7) S TIUY=1 G OVERX
"RTN","TIUTSK",89,0)
 F  S TIUXTRA=$O(^TIU(8925.7,"B",TIUDA,TIUXTRA)) Q:'TIUXTRA  D
"RTN","TIUTSK",90,0)
 . I TIUDATE<$G(TIUSTART)!(TIUDATE>$G(TIUEND)) Q
"RTN","TIUTSK",91,0)
 . I '$$TSKPARM^TIUTSK(1) Q
"RTN","TIUTSK",92,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),('$P($G(^TIU(8925.7,TIUXTRA,0)),U,4)) S TIUY=1
"RTN","TIUTSK",93,0)
OVERX Q TIUY
"RTN","TIUTSK",94,0)
TSKPARM(TIUDA) ;Calculate a tiu parameter for the nightly task
"RTN","TIUTSK",95,0)
 ; TIUDA = 1 then return NIGHTLY TASK START computation
"RTN","TIUTSK",96,0)
 ; TIUDA = 2 then return NIGHTLY TASK END computation
"RTN","TIUTSK",97,0)
 N TIUDIV,TIUPARM,TIUY,TIUVAL
"RTN","TIUTSK",98,0)
 S TIUY=0
"RTN","TIUTSK",99,0)
 I TIUDA=2 S TIUY=DT
"RTN","TIUTSK",100,0)
 I TIUDA=3 D DT^DILF("P","T-12M",.TIUY)
"RTN","TIUTSK",101,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUTSK",102,0)
 I '$G(TIUPRM0) Q TIUY
"RTN","TIUTSK",103,0)
 S TIUDIV=$P(TIUPRM0,U,1)
"RTN","TIUTSK",104,0)
 I '$G(TIUDIV) Q TIUY
"RTN","TIUTSK",105,0)
 S TIUPARM=$O(^TIU(8925.99,"B",TIUDIV,""))
"RTN","TIUTSK",106,0)
 I '$G(TIUPARM) Q TIUY
"RTN","TIUTSK",107,0)
 S TIUVAL=$P($G(^TIU(8925.99,TIUPARM,3)),U,TIUDA)
"RTN","TIUTSK",108,0)
 I '$G(TIUVAL) Q TIUY
"RTN","TIUTSK",109,0)
 D DT^DILF("P","T-"_TIUVAL,.TIUY)
"RTN","TIUTSK",110,0)
 Q TIUY
"VER")
8.0^22.0
"^DD",8925.99,8925.99,3.1,0)
START OF ADD SGNR ALERT PERIOD^F^^3;1^K:$L(X)>5!($L(X)<1)!'((X?1.4N1"D")!(X?1.4N1"W")!(X?1.4N1"M")) X
"^DD",8925.99,8925.99,3.1,3)
Answer must be 1-4 NUMBERS followed by "D", "W" or "M"
"^DD",8925.99,8925.99,3.1,21,0)
^^6^6^3060330^
"^DD",8925.99,8925.99,3.1,21,1,0)
This is the length of time that the TIU NIGHTLY TASK will go back in 
"^DD",8925.99,8925.99,3.1,21,2,0)
searching for documents that have overdue additional signatures.
"^DD",8925.99,8925.99,3.1,21,3,0)
The value must be in a FileMan date range format such as 6D, 3W or 4M.
"^DD",8925.99,8925.99,3.1,21,4,0)
 
"^DD",8925.99,8925.99,3.1,21,5,0)
If no value is entered, the TIU NIGHTLY TASK will begin with the very 
"^DD",8925.99,8925.99,3.1,21,6,0)
first Document in the TIU DOCUMENTS file (8925).
"^DD",8925.99,8925.99,3.1,"AUDIT")
n
"^DD",8925.99,8925.99,3.1,"DT")
3060330
"^DD",8925.99,8925.99,3.2,0)
END OF ADD SGNR ALERT PERIOD^F^^3;2^K:$L(X)>5!($L(X)<1)!'((X?1.4N1"D")!(X?1.4N1"W")!(X?1.4N1"M")) X
"^DD",8925.99,8925.99,3.2,3)
Answer must be 1-4 NUMBERS followed by "D", "W" or "M"
"^DD",8925.99,8925.99,3.2,21,0)
^^6^6^3060330^
"^DD",8925.99,8925.99,3.2,21,1,0)
This is the length in time from the current date that the TIU NIGHTLY 
"^DD",8925.99,8925.99,3.2,21,2,0)
TASK will stop regenerating alerts for overdue additional signatures.
"^DD",8925.99,8925.99,3.2,21,3,0)
The value must be in a FileMan date range format such as 6D, 3W or 4M. 
"^DD",8925.99,8925.99,3.2,21,4,0)
 
"^DD",8925.99,8925.99,3.2,21,5,0)
If no value is entered, the TIU NIGHTLY TASK will search for documents
"^DD",8925.99,8925.99,3.2,21,6,0)
in the TIU DOCUMENT File (8925) up to the current date.
"^DD",8925.99,8925.99,3.2,"AUDIT")
n
"^DD",8925.99,8925.99,3.2,"DT")
3060330
"^DD",8925.99,8925.99,3.3,0)
LENGTH OF SIGNER ALERT PERIOD^F^^3;3^K:$L(X)>5!($L(X)<1)!'((X?1.4N1"D")!(X?1.4N1"W")!(X?1.4N1"M")) X
"^DD",8925.99,8925.99,3.3,3)
Answer must be 1-4 NUMBERS followed by "D", "W" or "M"
"^DD",8925.99,8925.99,3.3,21,0)
^^7^7^3060719^
"^DD",8925.99,8925.99,3.3,21,1,0)
This is the length of time that the TIU NIGHTLY TASK will go back prior 
"^DD",8925.99,8925.99,3.3,21,2,0)
to "today" when searching for documents that have overdue signatures. 
"^DD",8925.99,8925.99,3.3,21,3,0)
The value must be in a FileMan date range format such as 6D, 3W or 4M. 
"^DD",8925.99,8925.99,3.3,21,4,0)
 
"^DD",8925.99,8925.99,3.3,21,5,0)
If no value is entered, the TIU NIGHTLY TASK will begin searching for 
"^DD",8925.99,8925.99,3.3,21,6,0)
documents starting at 1 year prior to "today" in the TIU DOCUMENTS file 
"^DD",8925.99,8925.99,3.3,21,7,0)
(8925).
"^DD",8925.99,8925.99,3.3,"DT")
3060706
"BLD",6822,6)
^207
**END**
**END**
