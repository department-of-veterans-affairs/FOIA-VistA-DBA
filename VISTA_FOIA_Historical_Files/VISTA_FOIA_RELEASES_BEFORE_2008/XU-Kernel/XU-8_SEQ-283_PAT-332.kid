Released XU*8*332 SEQ #283
Extracted from mail message
**KIDS**:XU*8.0*332^

**INSTALL NAME**
XU*8.0*332
"BLD",797,0)
XU*8.0*332^KERNEL^0^3040713^y
"BLD",797,1,0)
^^2^2^3040408^
"BLD",797,1,1,0)
See patch XU*8*332 in the National Patch Module on FORUM for complete
"BLD",797,1,2,0)
information on this patch.
"BLD",797,4,0)
^9.64PA^^
"BLD",797,"INI")

"BLD",797,"INID")
^y
"BLD",797,"INIT")
XU8P332
"BLD",797,"KRN",0)
^9.67PA^8989.52^19
"BLD",797,"KRN",.4,0)
.4
"BLD",797,"KRN",.4,"NM",0)
^9.68A^2^2
"BLD",797,"KRN",.4,"NM",1,0)
XUSEC TERMINATION REPORT    FILE #1.1^1.1^0
"BLD",797,"KRN",.4,"NM",2,0)
XUSEC UPARROW TERM REPORT    FILE #1.1^1.1^0
"BLD",797,"KRN",.4,"NM","B","XUSEC TERMINATION REPORT    FILE #1.1",1)

"BLD",797,"KRN",.4,"NM","B","XUSEC UPARROW TERM REPORT    FILE #1.1",2)

"BLD",797,"KRN",.401,0)
.401
"BLD",797,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",797,"KRN",.401,"NM",1,0)
XUSEC TERMINATION REPORT    FILE #1.1^1.1^0
"BLD",797,"KRN",.401,"NM","B","XUSEC TERMINATION REPORT    FILE #1.1",1)

"BLD",797,"KRN",.402,0)
.402
"BLD",797,"KRN",.403,0)
.403
"BLD",797,"KRN",.5,0)
.5
"BLD",797,"KRN",.84,0)
.84
"BLD",797,"KRN",3.6,0)
3.6
"BLD",797,"KRN",3.8,0)
3.8
"BLD",797,"KRN",9.2,0)
9.2
"BLD",797,"KRN",9.8,0)
9.8
"BLD",797,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",797,"KRN",9.8,"NM",1,0)
XUSTERM1^^0^B23037964
"BLD",797,"KRN",9.8,"NM",2,0)
XUSECAD^^0^B15079770
"BLD",797,"KRN",9.8,"NM","B","XUSECAD",2)

"BLD",797,"KRN",9.8,"NM","B","XUSTERM1",1)

"BLD",797,"KRN",19,0)
19
"BLD",797,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",797,"KRN",19,"NM",1,0)
XUSER SEC OFCR^^2
"BLD",797,"KRN",19,"NM",2,0)
XUSEC ISO TERMINATION REPORT^^0
"BLD",797,"KRN",19,"NM",3,0)
XUSEC ISO Q TERMINATION REPORT^^0
"BLD",797,"KRN",19,"NM",4,0)
XUSEC UP ARROW TERM REPORT^^0
"BLD",797,"KRN",19,"NM","B","XUSEC ISO Q TERMINATION REPORT",3)

"BLD",797,"KRN",19,"NM","B","XUSEC ISO TERMINATION REPORT",2)

"BLD",797,"KRN",19,"NM","B","XUSEC UP ARROW TERM REPORT",4)

"BLD",797,"KRN",19,"NM","B","XUSER SEC OFCR",1)

"BLD",797,"KRN",19.1,0)
19.1
"BLD",797,"KRN",101,0)
101
"BLD",797,"KRN",409.61,0)
409.61
"BLD",797,"KRN",771,0)
771
"BLD",797,"KRN",870,0)
870
"BLD",797,"KRN",8989.51,0)
8989.51
"BLD",797,"KRN",8989.52,0)
8989.52
"BLD",797,"KRN",8994,0)
8994
"BLD",797,"KRN","B",.4,.4)

"BLD",797,"KRN","B",.401,.401)

"BLD",797,"KRN","B",.402,.402)

"BLD",797,"KRN","B",.403,.403)

"BLD",797,"KRN","B",.5,.5)

"BLD",797,"KRN","B",.84,.84)

"BLD",797,"KRN","B",3.6,3.6)

"BLD",797,"KRN","B",3.8,3.8)

"BLD",797,"KRN","B",9.2,9.2)

"BLD",797,"KRN","B",9.8,9.8)

"BLD",797,"KRN","B",19,19)

"BLD",797,"KRN","B",19.1,19.1)

"BLD",797,"KRN","B",101,101)

"BLD",797,"KRN","B",409.61,409.61)

"BLD",797,"KRN","B",771,771)

"BLD",797,"KRN","B",870,870)

"BLD",797,"KRN","B",8989.51,8989.51)

"BLD",797,"KRN","B",8989.52,8989.52)

"BLD",797,"KRN","B",8994,8994)

"BLD",797,"QUES",0)
^9.62^^
"BLD",797,"REQB",0)
^9.611^1^1
"BLD",797,"REQB",1,0)
XU*8.0*313^2
"BLD",797,"REQB","B","XU*8.0*313",1)

"INIT")
XU8P332
"KRN",.4,101,-1)
0^1
"KRN",.4,101,0)
XUSEC TERMINATION REPORT^3040423.1056^@^1.1^^@^3040427
"KRN",.4,101,"DXS",1,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X="NPIEN"
"KRN",.4,101,"DXS",2,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),DIP(2)=$G(X) S X="DTR"
"KRN",.4,101,"DXS",3,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P($G(^VA(200,+$P(DIP(1),U,4),0)),U),DIP(2)=$G(X) S X="USER"
"KRN",.4,101,"DXS",4,9.2)
X "N I,Y "_$P(^DD(1.1,2,0),U,5,99) S DIP(1)=X S X=DIP(1),DIP(2)=$G(X) S X="OVALUE"
"KRN",.4,101,"DXS",5,9.2)
X "N I,Y "_$P(^DD(1.1,3,0),U,5,99) S DIP(1)=X S X=DIP(1),DIP(2)=$G(X) S X="NVALUE"
"KRN",.4,101,"DXS",6,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,4.1)):^(4.1),1:"") S X=$P($G(^DIC(19,+$P(DIP(1),U,1),0)),U),DIP(2)=$G(X) S X="MIEN"
"KRN",.4,101,"F",1)
X DXS(1,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.01),"NPIEN")"~
"KRN",.4,101,"F",2)
X DXS(2,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.02),"DTR")"~
"KRN",.4,101,"F",3)
X DXS(3,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.04),"USER")"~
"KRN",.4,101,"F",4)
X DXS(4,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#2),"OVALUE")"~
"KRN",.4,101,"F",5)
X DXS(5,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#3),"NVALUE")"~
"KRN",.4,101,"F",6)
X DXS(6,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#4.1),"MIEN")"~
"KRN",.4,101,"F",7)
D TEST^XUSECAD;X;Z;"D TEST^XUSECAD"~D:'XUSECF USERH^XUSECAD;X;Z;"D:'XUSECF USERH^XUSECAD"~"*When: ";C1;X~
"KRN",.4,101,"F",8)
S X=$$FMTE^XLFDT(DIPA("DTR"),"1P");XX;Z;"S X=$$FMTE^XLFDT(DIPA("DTR"),"1P")"~W X;X;Z;"W X"~D TERM^XUSECAD;X;Z;"D TERM^XUSECAD"~
"KRN",.4,101,"F",9)
W "  Termination State: "_X;X;Z;"W "  Termination State: "_X"~
"KRN",.4,101,"F",10)
S X=" Editor:",DIP(1)=$G(X) S X="USER",X=$S(X=""!(X'?.ANP):"",$D(DIPA($E(X,1,30))):DIPA($E(X,1,30)),1:"") S Y=X,X=DIP(1),X=X S X=X_Y W X K DIP;C1;X;Z;"" Editor:"_PARAM("USER")"~
"KRN",.4,101,"F",11)
D MENU^XUSECAD;X;Z;"D MENU^XUSECAD"~W " Menu Option: "_X;C1;X;Z;"W " Menu Option: "_X"~
"KRN",.4,101,"H")
New Person Termination Audit Report
"KRN",.4,105,-1)
0^2
"KRN",.4,105,0)
XUSEC UPARROW TERM REPORT^3040423.0736^@^1.1^^@^3040423
"KRN",.4,105,"DXS",1,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X="NPIEN"
"KRN",.4,105,"DXS",2,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),DIP(2)=$G(X) S X="DTR"
"KRN",.4,105,"DXS",3,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,0)):^(0),1:"") S X=$P($G(^VA(200,+$P(DIP(1),U,4),0)),U),DIP(2)=$G(X) S X="USER"
"KRN",.4,105,"DXS",4,9.2)
X "N I,Y "_$P(^DD(1.1,2,0),U,5,99) S DIP(1)=X S X=DIP(1),DIP(2)=$G(X) S X="OVALUE"
"KRN",.4,105,"DXS",5,9.2)
X "N I,Y "_$P(^DD(1.1,3,0),U,5,99) S DIP(1)=X S X=DIP(1),DIP(2)=$G(X) S X="NVALUE"
"KRN",.4,105,"DXS",6,9.2)
S DIP(1)=$S($D(^DIA(DIA,D0,4.1)):^(4.1),1:"") S X=$P($G(^DIC(19,+$P(DIP(1),U,1),0)),U),DIP(2)=$G(X) S X="MIEN"
"KRN",.4,105,"F",1)
X DXS(1,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.01),"NPIEN")"~
"KRN",.4,105,"F",2)
X DXS(2,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.02),"DTR")"~
"KRN",.4,105,"F",3)
X DXS(3,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#.04),"USER")"~
"KRN",.4,105,"F",4)
X DXS(4,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#2),"OVALUE")"~
"KRN",.4,105,"F",5)
X DXS(5,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#3),"NVALUE")"~
"KRN",.4,105,"F",6)
X DXS(6,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM((#4.1),"MIEN")"~
"KRN",.4,105,"F",7)
D UPRPT^XUSECAD;X;Z;"D UPRPT^XUSECAD"~W X;X;Z;"W X"~
"KRN",.4,105,"H")
@
"KRN",.4,105,"SUB")
1
"KRN",.401,58,-1)
0^1
"KRN",.401,58,0)
XUSEC TERMINATION REPORT^3040422.0808^@^1.1^^@^3040427
"KRN",.401,58,2,0)
^.4014^3^3
"KRN",.401,58,2,1,0)
1.1^1^ENTRY NAME^@^^^^^^4
"KRN",.401,58,2,1,"GET")
S %=^DIC(DIA,0,"GL"),X=^DIA(DIA,D0,0),X=$S($D(@(%_+X_",0)")):$P(^(0),U,1),1:""),C=$S($D(^DD(DIA,.01,0)):$P(^(0),U,2),1:""),Y=X D:Y]"" Y^DIQ:C]"" S X=Y,C="," S DISX(1)=X
"KRN",.401,58,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,58,2,1,"TXT")
ENTRY NAME not null
"KRN",.401,58,2,2,0)
1.1^.03^FIELD NUMBER^@^^^^^^4
"KRN",.401,58,2,2,"F")
9.199999^9.2
"KRN",.401,58,2,2,"GET")
S DISX(2)=$P($G(^DIA(DIA,D0,0)),U,3)
"KRN",.401,58,2,2,"QCON")
I DISX(2)=9.2
"KRN",.401,58,2,2,"T")
9.2^9.2
"KRN",.401,58,2,2,"TXT")
FIELD NUMBER equals 9.2
"KRN",.401,58,2,3,0)
1.1^.02^DATE/TIME RECORDED^@^^^^^^1
"KRN",.401,58,2,3,"ASK")
1
"KRN",.401,58,2,3,"F")
3040100.999999^3040101^Jan 1,2004
"KRN",.401,58,2,3,"GET")
S DISX(3)=$P($G(^DIA(DIA,D0,0)),U,2)
"KRN",.401,58,2,3,"IX")
^DIA(200,"C",^DIA(200,^2
"KRN",.401,58,2,3,"QCON")
I (DISX(3)]]3040100.999999)&(DISX(3)']]3040427.24)
"KRN",.401,58,2,3,"T")
3040427.24^3040427@2400^Apr 27,2004@24:00
"KRN",.401,58,2,3,"TXT")
DATE/TIME RECORDED from Jan 1,2004 to Apr 27,2004@24:00
"KRN",.401,58,2,"B",1.1,1)

"KRN",.401,58,2,"B",1.1,2)

"KRN",.401,58,2,"B",1.1,3)

"KRN",19,120,-1)
2^1
"KRN",19,120,0)
XUSER SEC OFCR^User Security Menu^^M^82^^^^^^^^^
"KRN",19,120,10,0)
^19.01IP^12^12
"KRN",19,120,10,11,0)
970^^11
"KRN",19,120,10,11,"^")
XUSEC ISO TERMINATION REPORT
"KRN",19,120,10,12,0)
974^^12
"KRN",19,120,10,12,"^")
XUSEC UP ARROW TERM REPORT
"KRN",19,120,"U")
USER SECURITY MENU
"KRN",19,970,-1)
0^2
"KRN",19,970,0)
XUSEC ISO TERMINATION REPORT^ISO's Terminated User Report^^R^^^^^^^^KERNEL
"KRN",19,970,1,0)
^^2^2^3040713^
"KRN",19,970,1,1,0)
This is the interactive option for the ISOs, where the user can select a
"KRN",19,970,1,2,0)
beginning and ending dates.
"KRN",19,970,25)
EP1^XUSECAD
"KRN",19,970,"U")
ISO'S TERMINATED USER REPORT
"KRN",19,971,-1)
0^3
"KRN",19,971,0)
XUSEC ISO Q TERMINATION REPORT^Queueable ISO Terminated User Report^^R^^^^^^^^KERNEL
"KRN",19,971,1,0)
^^3^3^3040408^
"KRN",19,971,1,1,0)
This is a queueable version of the ISO's termination date report.  The 
"KRN",19,971,1,2,0)
report dates are from the current date minus eight(8) days to the current 
"KRN",19,971,1,3,0)
date minus one(1) day.
"KRN",19,971,25)
QUEUE^XUSECAD
"KRN",19,971,200.9)
y
"KRN",19,971,"U")
QUEUEABLE ISO TERMINATED USER 
"KRN",19,974,-1)
0^4
"KRN",19,974,0)
XUSEC UP ARROW TERM REPORT^Up Arrow Delimited Termination Report^^R^^^^^^^^KERNEL^^1
"KRN",19,974,1,0)
^^4^4^3040423^
"KRN",19,974,1,1,0)
The report produced by this option is a up arrow(^) delimited termination 
"KRN",19,974,1,2,0)
report that can be used is a spread sheet.  It is suggested that the 
"KRN",19,974,1,3,0)
report be sent to an HFS device.  If the screen is used, it will require
"KRN",19,974,1,4,0)
132 column width.
"KRN",19,974,20)
S XUSECU=""
"KRN",19,974,25)
EP1^XUSECAD
"KRN",19,974,"U")
UP ARROW DELIMITED TERMINATION
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
332^3040713
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3040713
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*332 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XU8P332")
0^^B44049
"RTN","XU8P332",1,0)
XU8P332 ;SFISC/SO- POST INSTALL ACTIVATE AUDITING ON FIELD 9.2 ;1:49 PM  8 Apr 2004
"RTN","XU8P332",2,0)
 ;;8.0;KERNEL;**332**;Jul 10, 1995
"RTN","XU8P332",3,0)
 D TURNON^DIAUTL(200,9.2) ;IA# 4397
"RTN","XU8P332",4,0)
 Q
"RTN","XUSECAD")
0^2^B15079770
"RTN","XUSECAD",1,0)
XUSECAD ;SFISC/SO- TERMINATED USERS AUDIT DISPLAY ;10:59 AM  23 Apr 2004
"RTN","XUSECAD",2,0)
 ;;8.0;KERNEL;**332**;Jul 10, 1995
"RTN","XUSECAD",3,0)
EP1 ;Ask user Beginning and Ending report dates
"RTN","XUSECAD",4,0)
 W !,"Terminated User Audit Report"_$S($D(XUSECU):" Uparrow Delimited",1:"")
"RTN","XUSECAD",5,0)
 N BD,ED
"RTN","XUSECAD",6,0)
BD ;Get Beginning Date
"RTN","XUSECAD",7,0)
 N DIR,DTOUT,DUOUT,DIRUT
"RTN","XUSECAD",8,0)
 S DIR(0)="DA^2600101:"_DT_":EX"
"RTN","XUSECAD",9,0)
 S DIR("A")="Enter the Beginning Date for report: "
"RTN","XUSECAD",10,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","XUSECAD",11,0)
 S DIR("??")="^D HELP^%DTC"
"RTN","XUSECAD",12,0)
 D ^DIR
"RTN","XUSECAD",13,0)
 I 'Y Q  ;User Timed out, '^' out, etc.
"RTN","XUSECAD",14,0)
 S BD=",,"_Y
"RTN","XUSECAD",15,0)
ED ;Get Ending Date
"RTN","XUSECAD",16,0)
 N DIR,DTOUT,DUOUT,DIRUT
"RTN","XUSECAD",17,0)
 S DIR(0)="DA^2600101:"_DT_":EX"
"RTN","XUSECAD",18,0)
 S DIR("A")="Enter the Ending Date for report: "
"RTN","XUSECAD",19,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","XUSECAD",20,0)
 S DIR("??")="^D HELP^%DTC"
"RTN","XUSECAD",21,0)
 D ^DIR
"RTN","XUSECAD",22,0)
 I 'Y Q  ;User Timed out, '^' out, etc.
"RTN","XUSECAD",23,0)
 S ED=",,"_Y
"RTN","XUSECAD",24,0)
 K DIR,DTOUT,DUOUT,DIRUT
"RTN","XUSECAD",25,0)
 I $D(XUSECU) D UPARROW K XUSECU Q
"RTN","XUSECAD",26,0)
REPORT ;Do the report
"RTN","XUSECAD",27,0)
 N L,DIC,FR,TO,BY,FLDS,DIOBEG,DIOEND
"RTN","XUSECAD",28,0)
 N DIA ;Special New For AUDIT file
"RTN","XUSECAD",29,0)
 S DIOBEG="D BEG^XUSECAD"
"RTN","XUSECAD",30,0)
 S DIOEND="D END^XUSECAD"
"RTN","XUSECAD",31,0)
 S L=0
"RTN","XUSECAD",32,0)
 S DIC="^DIA(200,"
"RTN","XUSECAD",33,0)
 S FR=BD,TO=ED,(BY,FLDS)="[XUSEC TERMINATION REPORT]"
"RTN","XUSECAD",34,0)
 D EN1^DIP
"RTN","XUSECAD",35,0)
 Q
"RTN","XUSECAD",36,0)
 ;
"RTN","XUSECAD",37,0)
QUEUE ;Queued report for last 7 days
"RTN","XUSECAD",38,0)
 S BD=",,"_$$FMADD^XLFDT(DT,-8)
"RTN","XUSECAD",39,0)
 S ED=",,"_$$FMADD^XLFDT(DT,-1)
"RTN","XUSECAD",40,0)
 D REPORT
"RTN","XUSECAD",41,0)
 K BD,ED
"RTN","XUSECAD",42,0)
 Q
"RTN","XUSECAD",43,0)
BEG ; Initialize
"RTN","XUSECAD",44,0)
 ; XUSECF = 0 - User changed
"RTN","XUSECAD",45,0)
 ;          1 - Same user
"RTN","XUSECAD",46,0)
 I $G(XUSECO)="" S (XUSECF,XUSECO)=0
"RTN","XUSECAD",47,0)
 Q
"RTN","XUSECAD",48,0)
END ; Kill variables
"RTN","XUSECAD",49,0)
 K XUSECF,XUSECO
"RTN","XUSECAD",50,0)
 Q
"RTN","XUSECAD",51,0)
TEST ; Test if user changed
"RTN","XUSECAD",52,0)
 I 'XUSECO S XUSECO=DIPA("NPIEN") Q
"RTN","XUSECAD",53,0)
 I XUSECO=DIPA("NPIEN") S XUSECF=1 Q
"RTN","XUSECAD",54,0)
 S XUSECO=DIPA("NPIEN")
"RTN","XUSECAD",55,0)
 S XUSECF=0 ;User changed
"RTN","XUSECAD",56,0)
 Q
"RTN","XUSECAD",57,0)
USERH ; Stadic User Information
"RTN","XUSECAD",58,0)
 N IEN,DIERR,Z,ZERR
"RTN","XUSECAD",59,0)
 S IEN=DIPA("NPIEN"),IEN=IEN_"," ; Get IEN in file 200
"RTN","XUSECAD",60,0)
 ; Get Name (.01)
"RTN","XUSECAD",61,0)
 ; Get SSN (9)
"RTN","XUSECAD",62,0)
 ; Get Service/Section (29)
"RTN","XUSECAD",63,0)
 ; Get Date Entered (30)
"RTN","XUSECAD",64,0)
 D GETS^DIQ(200,IEN,".01;9;29;30","","Z","ZERR")
"RTN","XUSECAD",65,0)
 W !,"User: "_$G(Z(200,IEN,.01))_"  SSN: "_$G(Z(200,IEN,9))
"RTN","XUSECAD",66,0)
 W !,"Date Entered: "_$G(Z(200,IEN,30))_"  Service/Section: "_$G(Z(200,IEN,29))
"RTN","XUSECAD",67,0)
 K DIERR,Z,ZERR
"RTN","XUSECAD",68,0)
 D GETS^DIQ(200,IEN,"16*","","Z","ZERR") ;Get Division multiple
"RTN","XUSECAD",69,0)
 I '$D(Z(200.02)) W !?4,"Division: None Listed" Q
"RTN","XUSECAD",70,0)
 S IEN=""
"RTN","XUSECAD",71,0)
 F  S IEN=$O(Z(200.02,IEN)) Q:IEN=""  W !?4,"Division: "_$G(Z(200.02,IEN,.01))_"  Default: "_$S($G(Z(200.02,IEN,1))["Y":"Yes",1:"No")
"RTN","XUSECAD",72,0)
 Q
"RTN","XUSECAD",73,0)
 ;
"RTN","XUSECAD",74,0)
 Q
"RTN","XUSECAD",75,0)
 ;
"RTN","XUSECAD",76,0)
TERM S X=$S(DIPA("OVALUE")="<no previous value>":"Terminated",1:"Reactivated")
"RTN","XUSECAD",77,0)
 Q
"RTN","XUSECAD",78,0)
 ;
"RTN","XUSECAD",79,0)
MENU N IEN,DIERR,Z,ZERR
"RTN","XUSECAD",80,0)
 S IEN=$$FIND1^DIC(19,"","X",DIPA("MIEN"),"B","","ZERR")
"RTN","XUSECAD",81,0)
 S IEN=IEN_","
"RTN","XUSECAD",82,0)
 D GETS^DIQ(19,IEN,".01;1","","Z","ZERR")
"RTN","XUSECAD",83,0)
 S X=$G(Z(19,IEN,1))_"["_$G(Z(19,IEN,.01))_"]"
"RTN","XUSECAD",84,0)
 Q
"RTN","XUSECAD",85,0)
 ;
"RTN","XUSECAD",86,0)
UPARROW ; Uparrow delimited report
"RTN","XUSECAD",87,0)
 N L,DIC,FR,TO,BY,FLDS
"RTN","XUSECAD",88,0)
 N DIA ;Special New For AUDIT file
"RTN","XUSECAD",89,0)
 S L=0
"RTN","XUSECAD",90,0)
 S DIC="^DIA(200,"
"RTN","XUSECAD",91,0)
 S FR=BD,TO=ED,BY="[XUSEC TERMINATION REPORT]",FLDS="[XUSEC UPARROW TERM REPORT]"
"RTN","XUSECAD",92,0)
 D EN1^DIP
"RTN","XUSECAD",93,0)
 Q
"RTN","XUSECAD",94,0)
 ;
"RTN","XUSECAD",95,0)
UPRPT ; Build Uparrow report line
"RTN","XUSECAD",96,0)
 N MIEN,NPIEN,DIERR,Z,ZERR
"RTN","XUSECAD",97,0)
 S NPIEN=DIPA("NPIEN"),NPIEN=NPIEN_"," ; Get IEN in file 200
"RTN","XUSECAD",98,0)
 D GETS^DIQ(200,NPIEN,".01;9;29;30","","Z","ZERR") ;Get New Person Info
"RTN","XUSECAD",99,0)
 S MIEN=$$FIND1^DIC(19,"","X",DIPA("MIEN"),"B","","ZERR")
"RTN","XUSECAD",100,0)
 S MIEN=MIEN_","
"RTN","XUSECAD",101,0)
 D GETS^DIQ(19,MIEN,".01;1","","Z","ZERR")
"RTN","XUSECAD",102,0)
LINE ; Build Report Line
"RTN","XUSECAD",103,0)
 N LN S LN=""
"RTN","XUSECAD",104,0)
 S LN=LN_$G(Z(200,NPIEN,.01))_U_$G(Z(200,NPIEN,9))_U_$G(Z(200,NPIEN,30))_U
"RTN","XUSECAD",105,0)
 S LN=LN_$G(Z(200,NPIEN,29))_U_$$FMTE^XLFDT(DIPA("DTR"),"1P")_U
"RTN","XUSECAD",106,0)
 S LN=LN_$S(DIPA("OVALUE")="<no previous value>":"Terminated",1:"Reactivated")_U
"RTN","XUSECAD",107,0)
 S LN=LN_DIPA("USER")_U_$G(Z(19,MIEN,1))_"["_$G(Z(19,MIEN,.01))_"]"
"RTN","XUSECAD",108,0)
 S X=LN
"RTN","XUSECAD",109,0)
 Q
"RTN","XUSTERM1")
0^1^B23037964
"RTN","XUSTERM1",1,0)
XUSTERM1 ;SEA/WDE - DEACTIVATE USER ;5:11 AM  20 Apr 2004
"RTN","XUSTERM1",2,0)
 ;;8.0;KERNEL;**102,180,208,222,274,313,332**;Jul 10, 1995
"RTN","XUSTERM1",3,0)
ENALL ;Interactive scan all
"RTN","XUSTERM1",4,0)
 S U="^",DTIME=$G(DTIME,60)
"RTN","XUSTERM1",5,0)
 W !!,"This option can purge all access & verify codes, mail baskets, messages,",!,"authorized senders access, keys, and electronic signature codes of users who have been terminated."
"RTN","XUSTERM1",6,0)
RD1 W !!,"Do you wish to proceed "
"RTN","XUSTERM1",7,0)
 S %=2 D YN^DICN G:%=2!(%=-1) END I %=0 S XQH="XUUSER-PURGEATT" D EN^XQH G RD1
"RTN","XUSTERM1",8,0)
RD2 W !,"Do you wish to verify each user "
"RTN","XUSTERM1",9,0)
 S %=2,XUVE=0 D YN^DICN S:%=1 XUVE=1 G:%=1 CHECK G:%=-1 END I %=0 S XQH="XUUSER-PURGEATT-VER" D EN^XQH G RD2
"RTN","XUSTERM1",10,0)
QUE W !,"Do you wish to have this queued for a later time "
"RTN","XUSTERM1",11,0)
 S %=1 D YN^DICN I %=1 D  Q
"RTN","XUSTERM1",12,0)
 . S ZTDESC="USER DEACTIVATION",ZTRTN="CHECK^XUSTERM1",ZTIO="",ZTSAVE("DUZ*")=""
"RTN","XUSTERM1",13,0)
 . D ^%ZTLOAD
"RTN","XUSTERM1",14,0)
 . Q
"RTN","XUSTERM1",15,0)
 I %=0 K X,XUVE Q
"RTN","XUSTERM1",16,0)
 ;Fall thru if user doesn't queue
"RTN","XUSTERM1",17,0)
CHECK ;Entry point for taskman.
"RTN","XUSTERM1",18,0)
 N XUDT540,XUDT90,XUDT30,FDA,XUDT
"RTN","XUSTERM1",19,0)
 S U="^",DT=$$DT^XLFDT(),XUDT90=$$HTFM^XLFDT($H-90,1),XUDT30=$$HTFM^XLFDT($H-30,1)
"RTN","XUSTERM1",20,0)
 S XUDT540=$$HTFM^XLFDT($H-540,1) ;*p332
"RTN","XUSTERM1",21,0)
 S XUDA=.6,XUVE=$G(XUVE,0)
"RTN","XUSTERM1",22,0)
 F  S XUDA=$O(^VA(200,XUDA)) Q:XUDA'>0  S XUJ=$G(^(XUDA,0)) D
"RTN","XUSTERM1",23,0)
 . S XUDT=$P(XUJ,U,11)
"RTN","XUSTERM1",24,0)
 . I $P(XUJ,U,3)]"",$L(XUDT),(XUDT'>DT) D
"RTN","XUSTERM1",25,0)
 . . D GET
"RTN","XUSTERM1",26,0)
 . . I 'XUEMP K Y D:XUVE DISP Q:$D(Y)  D ACT ;XUEMP=any data to remove
"RTN","XUSTERM1",27,0)
 . . Q
"RTN","XUSTERM1",28,0)
 . I $P(XUJ,U,3)]"",'$P(XUJ,U,8),$$NOSIGNON D DISUSER(XUDA)
"RTN","XUSTERM1",29,0)
 . I $P(XUJ,U,7) D AUSER(XUDA) ;*p332
"RTN","XUSTERM1",30,0)
 . Q
"RTN","XUSTERM1",31,0)
 ;
"RTN","XUSTERM1",32,0)
END K XUEMP,XUDA,XUI,XUJ,XUK,XUACT,XUKEY,XUGRP,XUSUR,XUNAM,XUF,XUDT,XUIN,XUVE,X,DIC,XUDB,XUDC,XUDP
"RTN","XUSTERM1",33,0)
 Q
"RTN","XUSTERM1",34,0)
 ;
"RTN","XUSTERM1",35,0)
DISUSER(XUDA) ;Set DISUSER flag and reason, Remove last menu option
"RTN","XUSTERM1",36,0)
 Q:$P(XUJ,U,7)  ;DISUSER already set *p332
"RTN","XUSTERM1",37,0)
 N %,FDA S %=XUDA_","
"RTN","XUSTERM1",38,0)
 S FDA(200,%,7)=1,FDA(200,%,9.4)="User Inactive for too long"
"RTN","XUSTERM1",39,0)
 D FILE^DIE("","FDA"),CONTCL(XUDA) ;Set Disuser
"RTN","XUSTERM1",40,0)
 Q
"RTN","XUSTERM1",41,0)
 ;
"RTN","XUSTERM1",42,0)
AUSER(XUDA) ;If DISUSERed and Last Sign > 540[18Mo.*30] days, then remove"AUSER" xref
"RTN","XUSTERM1",43,0)
 I '$D(^VA(200,"AUSER")) Q  ;xref not defined
"RTN","XUSTERM1",44,0)
 N Q S Q=$P($G(^VA(200,XUDA,1.1)),U) ;Get last sign-on
"RTN","XUSTERM1",45,0)
 I $L(Q),Q<XUDT540 K ^VA(200,"AUSER",$P(XUJ,U),XUDA)
"RTN","XUSTERM1",46,0)
 Q
"RTN","XUSTERM1",47,0)
 ;
"RTN","XUSTERM1",48,0)
NOSIGNON() ;Check last signon. Return 1 if should disable account
"RTN","XUSTERM1",49,0)
 N Q S Q=$P($G(^VA(200,XUDA,1.1)),U) ;Get last sign-on
"RTN","XUSTERM1",50,0)
 I $L(Q),Q>XUDT90 Q 0 ;Last sign-on within 90 days
"RTN","XUSTERM1",51,0)
 S Q=$P($G(^VA(200,XUDA,1.1)),U,4) ;Get last Edit date
"RTN","XUSTERM1",52,0)
 I $L(Q),Q>XUDT30 Q 0 ;User edited in last 30 days
"RTN","XUSTERM1",53,0)
 S Q=$P($G(^VA(200,XUDA,1)),U,7) ;Create Date
"RTN","XUSTERM1",54,0)
 I $L(Q),Q>XUDT30 Q 0 ;User set up in last 30 days
"RTN","XUSTERM1",55,0)
 S Q=$P($G(^VA(200,XUDA,.1)),U) ;Get verify code change date
"RTN","XUSTERM1",56,0)
 I $L(Q),(Q+30)>$H Q 0 ;Verify code changed in last 30 days
"RTN","XUSTERM1",57,0)
 Q 1
"RTN","XUSTERM1",58,0)
 ;
"RTN","XUSTERM1",59,0)
CONTCL(XUDA) ;Clear the fields for Menu "Continue"
"RTN","XUSTERM1",60,0)
 N FDA
"RTN","XUSTERM1",61,0)
 S FDA(200,XUDA_",",202.1)="@",FDA(200,XUDA_",",202.2)="@"
"RTN","XUSTERM1",62,0)
 D FILE^DIE("","FDA") ;Clear 202.1 and 202.2
"RTN","XUSTERM1",63,0)
 Q
"RTN","XUSTERM1",64,0)
 ;
"RTN","XUSTERM1",65,0)
ACT ;
"RTN","XUSTERM1",66,0)
 D ACT^XUSTERM
"RTN","XUSTERM1",67,0)
 S XUJ=^VA(200,XUDA,0) ;Get new copy of zero node
"RTN","XUSTERM1",68,0)
 Q
"RTN","XUSTERM1",69,0)
 ;
"RTN","XUSTERM1",70,0)
GET ;Kill ^DISV entries each time, should get all CPUs at some point
"RTN","XUSTERM1",71,0)
 N XUJ
"RTN","XUSTERM1",72,0)
 D GET^XUSTERM K ^DISV(XUDA),Y
"RTN","XUSTERM1",73,0)
 Q
"RTN","XUSTERM1",74,0)
DISP ;Display info and get responses.
"RTN","XUSTERM1",75,0)
 N DA,DIE,DR,XUJ
"RTN","XUSTERM1",76,0)
 S DA=XUDA
"RTN","XUSTERM1",77,0)
 L +^VA(200,DA,0):6 D DISP2 L -^VA(200,DA,0)
"RTN","XUSTERM1",78,0)
 Q
"RTN","XUSTERM1",79,0)
DISP2 ;Do the work.
"RTN","XUSTERM1",80,0)
 W !!,XUNAM," currently has:",!?3,XUJ," baskets",?25,XUK," total messages",?50,XUIN," IN basket messages",!
"RTN","XUSTERM1",81,0)
 S DR="9.21//YES",DIE=200 D ^DIE Q:$D(Y)  G:'$D(XUSUR) KEYS
"RTN","XUSTERM1",82,0)
 W !!,XUNAM," acts as surrogate for the following users:"
"RTN","XUSTERM1",83,0)
 S XUJ=0,XUI=3 F XUK=0:1 S XUJ=$O(XUSUR(XUJ)) Q:XUJ'>0  W:'(XUK#XUI) ! W ?(XUK#XUI*26),$P(^VA(200,XUJ,0),U,1) W !,"These surrogate privileges will be deleted on deactivation."
"RTN","XUSTERM1",84,0)
KEYS ;This section checks for authorized senders of mail groups and security keys.
"RTN","XUSTERM1",85,0)
 W !,"User will no longer be an authorized sender to any mail groups."
"RTN","XUSTERM1",86,0)
 I '$D(XUKEY) W !!,XUNAM," currently holds no keys." G KEYS1
"RTN","XUSTERM1",87,0)
 W !!,XUNAM," holds the following keys: "
"RTN","XUSTERM1",88,0)
 S XUJ=0,XUI=5 F XUK=0:1 S XUJ=$O(XUKEY(XUJ)) Q:XUJ'>0  W:'(XUK#XUI) ! W ?(XUK#XUI*15),$P($G(^DIC(19.1,XUJ,0)),U,1)
"RTN","XUSTERM1",89,0)
KEYS1 W ! S DR="9.22//YES" D ^DIE Q:$D(Y)
"RTN","XUSTERM1",90,0)
GROUP I '$D(XUGRP) W !!,XUNAM," currently is not a member of any MAIL GROUP." G GROUP1
"RTN","XUSTERM1",91,0)
 W !!,XUNAM," is a member of the following Mail Groups:"
"RTN","XUSTERM1",92,0)
 S XUI="" F XUI=0:0 S XUI=$O(XUGRP(XUI)) Q:XUI'>0  D
"RTN","XUSTERM1",93,0)
 . S XUJ=XUGRP(XUI)
"RTN","XUSTERM1",94,0)
 . I $P(XUJ,U,2)="PU"!$D(^XMB(3.8,"AB",XUDA,XUI)) W !?2,$P(XUJ,U,1) W:$P(XUJ,U,3) " (Organizer)" W ?40,$S(($P(XUJ,U,2)="PR"):"(Private)",1:"(Public)")
"RTN","XUSTERM1",95,0)
 . Q
"RTN","XUSTERM1",96,0)
GROUP1 W ! S DR="9.23//YES" D ^DIE Q:$D(Y)
"RTN","XUSTERM1",97,0)
 Q
"RTN","XUSTERM1",98,0)
 ;
"RTN","XUSTERM1",99,0)
DQ1 ;Terminate one person.
"RTN","XUSTERM1",100,0)
 N XUJ,XUDT,XUVE
"RTN","XUSTERM1",101,0)
 S XUJ=$G(^VA(200,XUDA,0)),XUDT=$P(XUJ,U,11) I XUDT,(XUDT'>DT) D
"RTN","XUSTERM1",102,0)
 . S XUVE=0 D GET I 'XUEMP D ACT
"RTN","XUSTERM1",103,0)
 . Q
"RTN","XUSTERM1",104,0)
 Q
"VER")
8.0^22.0
**END**
**END**
