Released PRC*5.1*75 SEQ #67
Extracted from mail message
**KIDS**:PRC*5.1*75^

**INSTALL NAME**
PRC*5.1*75
"BLD",3917,0)
PRC*5.1*75^IFCAP^0^3050128^y
"BLD",3917,1,0)
^^11^11^3050128^^
"BLD",3917,1,1,0)
This software extracts from IFCAP for National Item File (NIF) processing
"BLD",3917,1,2,0)
those active items which have been purchased within the previous 12 
"BLD",3917,1,3,0)
months, which have been received, issued, assembled, or manually adjusted
"BLD",3917,1,4,0)
in a Generic Inventory Package (GIP) inventory point within the previous 
"BLD",3917,1,5,0)
12 months, which are flagged in the ITEM MASTER file (#441) as reusable,
"BLD",3917,1,6,0)
or which are active components of active case carts or active instrument
"BLD",3917,1,7,0)
kits. At the user's option, GIP physical inventory count transactions 
"BLD",3917,1,8,0)
within the previous 12 months are also included in the analysis of 
"BLD",3917,1,9,0)
items to export.  The software then writes item data and associated last
"BLD",3917,1,10,0)
vendor data to a host file in a record format mutually agreed upon with
"BLD",3917,1,11,0)
the NIF contractor.
"BLD",3917,4,0)
^9.64PA^^
"BLD",3917,"ABPKG")
n
"BLD",3917,"INID")

"BLD",3917,"KRN",0)
^9.67PA^8989.52^19
"BLD",3917,"KRN",.4,0)
.4
"BLD",3917,"KRN",.401,0)
.401
"BLD",3917,"KRN",.402,0)
.402
"BLD",3917,"KRN",.403,0)
.403
"BLD",3917,"KRN",.5,0)
.5
"BLD",3917,"KRN",.84,0)
.84
"BLD",3917,"KRN",3.6,0)
3.6
"BLD",3917,"KRN",3.8,0)
3.8
"BLD",3917,"KRN",9.2,0)
9.2
"BLD",3917,"KRN",9.8,0)
9.8
"BLD",3917,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3917,"KRN",9.8,"NM",1,0)
PRCHITX^^0^B61601645
"BLD",3917,"KRN",9.8,"NM",2,0)
PRCHITX1^^0^B14889726
"BLD",3917,"KRN",9.8,"NM",3,0)
PRCHITX2^^1^
"BLD",3917,"KRN",9.8,"NM","B","PRCHITX",1)

"BLD",3917,"KRN",9.8,"NM","B","PRCHITX1",2)

"BLD",3917,"KRN",9.8,"NM","B","PRCHITX2",3)

"BLD",3917,"KRN",19,0)
19
"BLD",3917,"KRN",19.1,0)
19.1
"BLD",3917,"KRN",101,0)
101
"BLD",3917,"KRN",409.61,0)
409.61
"BLD",3917,"KRN",771,0)
771
"BLD",3917,"KRN",870,0)
870
"BLD",3917,"KRN",8989.51,0)
8989.51
"BLD",3917,"KRN",8989.52,0)
8989.52
"BLD",3917,"KRN",8994,0)
8994
"BLD",3917,"KRN","B",.4,.4)

"BLD",3917,"KRN","B",.401,.401)

"BLD",3917,"KRN","B",.402,.402)

"BLD",3917,"KRN","B",.403,.403)

"BLD",3917,"KRN","B",.5,.5)

"BLD",3917,"KRN","B",.84,.84)

"BLD",3917,"KRN","B",3.6,3.6)

"BLD",3917,"KRN","B",3.8,3.8)

"BLD",3917,"KRN","B",9.2,9.2)

"BLD",3917,"KRN","B",9.8,9.8)

"BLD",3917,"KRN","B",19,19)

"BLD",3917,"KRN","B",19.1,19.1)

"BLD",3917,"KRN","B",101,101)

"BLD",3917,"KRN","B",409.61,409.61)

"BLD",3917,"KRN","B",771,771)

"BLD",3917,"KRN","B",870,870)

"BLD",3917,"KRN","B",8989.51,8989.51)

"BLD",3917,"KRN","B",8989.52,8989.52)

"BLD",3917,"KRN","B",8994,8994)

"BLD",3917,"PRE")

"BLD",3917,"QUES",0)
^9.62^^
"BLD",3917,"REQB",0)
^9.611^^
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
75^3050128
"PKG",455,22,1,"PAH",1,1,0)
^^11^11^3050128
"PKG",455,22,1,"PAH",1,1,1,0)
This software extracts from IFCAP for National Item File (NIF) processing
"PKG",455,22,1,"PAH",1,1,2,0)
those active items which have been purchased within the previous 12 
"PKG",455,22,1,"PAH",1,1,3,0)
months, which have been received, issued, assembled, or manually adjusted
"PKG",455,22,1,"PAH",1,1,4,0)
in a Generic Inventory Package (GIP) inventory point within the previous 
"PKG",455,22,1,"PAH",1,1,5,0)
12 months, which are flagged in the ITEM MASTER file (#441) as reusable,
"PKG",455,22,1,"PAH",1,1,6,0)
or which are active components of active case carts or active instrument
"PKG",455,22,1,"PAH",1,1,7,0)
kits. At the user's option, GIP physical inventory count transactions 
"PKG",455,22,1,"PAH",1,1,8,0)
within the previous 12 months are also included in the analysis of 
"PKG",455,22,1,"PAH",1,1,9,0)
items to export.  The software then writes item data and associated last
"PKG",455,22,1,"PAH",1,1,10,0)
vendor data to a host file in a record format mutually agreed upon with
"PKG",455,22,1,"PAH",1,1,11,0)
the NIF contractor.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCHITX")
0^1^B61601645
"RTN","PRCHITX",1,0)
PRCHITX ;WOIFO/LKG-SELECTING ITEMS USED IN LAST 12 MONTHS ;1/27/05  10:56
"RTN","PRCHITX",2,0)
 ;;5.1;IFCAP;**75**;OCT 20, 2000
"RTN","PRCHITX",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHITX",4,0)
 D EN^DDIOL("^PRCHITX is not a valid entry point.")
"RTN","PRCHITX",5,0)
 Q
"RTN","PRCHITX",6,0)
 ;Output
"RTN","PRCHITX",7,0)
 ;^TMP($J,"I",Item#,0)=PO_Date^PO#^FCP^FSC^NSN^Mf_Part#^Station#^Stakeholder
"RTN","PRCHITX",8,0)
 ;^TMP($J,"I",Item#,1)=Vendor_ID^UOP^Pkg_Mult^Stock#^NDC^Contract#
"RTN","PRCHITX",9,0)
 ;^TMP($J,"V",Vendor#)=Vendor_Name^TIN^POC^Phone#^Accnt#
"RTN","PRCHITX",10,0)
IN ;Entry point
"RTN","PRCHITX",11,0)
 N PRCA,PRCB,PRCDT,PRCFILE,PRCI,PRCJ,PRCPODT,PRCSTAT,PRCITM,PRCDATE,PRCCNT,PRCTRANS,PRCX,PRCY,PRCV,X,X1,X2 K ^TMP($J)
"RTN","PRCHITX",12,0)
 S PRCA=0,PRCCNT=0,PRCDT=$$ONEYRAGO,X1=PRCDT,X2=-1 D C^%DTC S PRCDT=X
"RTN","PRCHITX",13,0)
 ;Purchase Orders
"RTN","PRCHITX",14,0)
 S PRCX=PRCDT
"RTN","PRCHITX",15,0)
 F  S PRCX=$O(^PRC(442,"AB",PRCX)) Q:PRCX=""  D
"RTN","PRCHITX",16,0)
 . S PRCA=""
"RTN","PRCHITX",17,0)
 . F  S PRCA=$O(^PRC(442,"AB",PRCX,PRCA)) Q:+PRCA'=PRCA  D
"RTN","PRCHITX",18,0)
 . . S PRCPODT=$$GETPODT(PRCA) I '$$DATEGTR(PRCPODT,PRCDT) Q
"RTN","PRCHITX",19,0)
 . . Q:'$$MOPOK(PRCA)
"RTN","PRCHITX",20,0)
 . . S PRCSTAT=$$GETSTAT(PRCA) Q:'$$STATUSOK(PRCSTAT)
"RTN","PRCHITX",21,0)
 . . S PRCB=0
"RTN","PRCHITX",22,0)
 . . F  S PRCB=$O(^PRC(442,PRCA,2,PRCB)) Q:+PRCB'=PRCB  D
"RTN","PRCHITX",23,0)
 . . . S PRCITM=$$GETITMID(PRCA,PRCB) Q:PRCITM=""
"RTN","PRCHITX",24,0)
 . . . Q:'$$ITEMACT(PRCITM)  Q:$$NIFITEM(PRCITM)
"RTN","PRCHITX",25,0)
 . . . S PRCDATE=$P($G(^TMP($J,"I",PRCITM,0)),"^") Q:'$$DATEGTR(PRCPODT,PRCDATE)
"RTN","PRCHITX",26,0)
 . . . S:'$D(^TMP($J,"I",PRCITM)) PRCCNT=PRCCNT+1
"RTN","PRCHITX",27,0)
 . . . S ^TMP($J,"I",PRCITM,0)=PRCPODT_"^"_$$GETPONUM(PRCA)_"^"_$$GETFCP(PRCA)_"^"_$$GETFSC(PRCA,PRCB)_"^"_$$GETNSN(PRCA,PRCB)_"^"_$$GETMPNUM(PRCITM)
"RTN","PRCHITX",28,0)
 . . . S ^TMP($J,"I",PRCITM,1)=$$GETVENDR(PRCA)_"^"_$$GETUOP(PRCA,PRCB)_"^"_$$GETPKGM(PRCA,PRCB)_"^"_$$GETSTKNO(PRCA,PRCB)_"^"_$$GETNDC(PRCA,PRCB)_"^"_$$GETCONTR(PRCA,PRCB)
"RTN","PRCHITX",29,0)
 S ^TMP($J,"I")=PRCCNT
"RTN","PRCHITX",30,0)
 ;Reusable Items
"RTN","PRCHITX",31,0)
 S PRCITM=0
"RTN","PRCHITX",32,0)
 F  S PRCITM=$O(^PRC(441,PRCITM)) Q:+PRCITM'=PRCITM  D
"RTN","PRCHITX",33,0)
 . Q:$D(^TMP($J,"I",PRCITM))  Q:'$$ITEMACT(PRCITM)  Q:'$$REUSABLE(PRCITM)  Q:$$NIFITEM(PRCITM)
"RTN","PRCHITX",34,0)
 . S PRCCNT=PRCCNT+1,^TMP($J,"I",PRCITM,0)="^^"_$$FCP(PRCITM)_"^"_$$FSC(PRCITM)_"^"_$$NSN(PRCITM)_"^"_$$GETMPNUM(PRCITM)
"RTN","PRCHITX",35,0)
 . S PRCI=$$LASTVDR(PRCITM) S:PRCI="" PRCI=$$VDRLSTD(PRCITM)
"RTN","PRCHITX",36,0)
 . I PRCI>0 D
"RTN","PRCHITX",37,0)
 . . I $P($G(^PRC(440,PRCI,10)),"^",5),$P($G(^PRC(440,PRCI,9)),"^")>0 S PRCV=$P(^(9),"^") I $P($G(^PRC(440,PRCV,10)),"^",5)'=1,$D(^PRC(441,PRCITM,2,PRCV)) S PRCI=PRCV
"RTN","PRCHITX",38,0)
 . . S ^TMP($J,"I",PRCITM,1)=PRCI_"^"_$$UOP(PRCITM,PRCI)_"^"_$$PKGMULT(PRCITM,PRCI)_"^"_$$STKNO(PRCITM,PRCI)_"^"_$$NDC(PRCITM,PRCI)_"^"_$$CONTRACT(PRCITM,PRCI)
"RTN","PRCHITX",39,0)
 S ^TMP($J,"I")=PRCCNT
"RTN","PRCHITX",40,0)
 ;Inventory Transactions
"RTN","PRCHITX",41,0)
 S PRCX="",PRCITM="",PRCA="",PRCTRANS=";A;RC;R;U;C;S;E;"_$S(PRCPHYS="Y":"P;",1:"")
"RTN","PRCHITX",42,0)
 F  S PRCX=$O(^PRCP(445.2,"AD",PRCX)) Q:PRCX=""  D
"RTN","PRCHITX",43,0)
 . F  S PRCITM=$O(^PRCP(445.2,"AD",PRCX,PRCITM)) Q:PRCITM=""  D
"RTN","PRCHITX",44,0)
 . . Q:$D(^TMP($J,"I",PRCITM))  Q:'$$ITEMACT(PRCITM)  Q:$$NIFITEM(PRCITM)
"RTN","PRCHITX",45,0)
 . . S PRCA=""
"RTN","PRCHITX",46,0)
 . . F  S PRCA=$O(^PRCP(445.2,"AD",PRCX,PRCITM,PRCA)) Q:PRCA=""  D  Q:$D(^TMP($J,"I",PRCITM))
"RTN","PRCHITX",47,0)
 . . . S PRCY=$G(^PRCP(445.2,PRCA,0)) Q:PRCY=""
"RTN","PRCHITX",48,0)
 . . . Q:PRCTRANS'[(";"_$P(PRCY,"^",4)_";")
"RTN","PRCHITX",49,0)
 . . . Q:'$$DATEGTR($P(PRCY,"^",17),PRCDT)
"RTN","PRCHITX",50,0)
 . . . S PRCCNT=PRCCNT+1,^TMP($J,"I",PRCITM,0)="^^"_$$FCPINV(PRCA)_"^"_$$FSC(PRCITM)_"^"_$$NSN(PRCITM)_"^"_$$GETMPNUM(PRCITM)
"RTN","PRCHITX",51,0)
 . . . S PRCI=$$LASTVDR(PRCITM) S:PRCI="" PRCI=$$INVVNDR(PRCA) S:PRCI="" PRCI=$$VDRLSTD(PRCITM)
"RTN","PRCHITX",52,0)
 . . . I PRCI>0 D
"RTN","PRCHITX",53,0)
 . . . . I $P($G(^PRC(440,PRCI,10)),"^",5),$P($G(^PRC(440,PRCI,9)),"^")>0 S PRCV=$P(^(9),"^") I $P($G(^PRC(440,PRCV,10)),"^",5)'=1,$D(^PRC(441,PRCITM,2,PRCV)) S PRCI=PRCV
"RTN","PRCHITX",54,0)
 . . . . S ^TMP($J,"I",PRCITM,1)=PRCI_"^"_$$UOP(PRCITM,PRCI)_"^"_$$PKGMULT(PRCITM,PRCI)_"^"_$$STKNO(PRCITM,PRCI)_"^"_$$NDC(PRCITM,PRCI)_"^"_$$CONTRACT(PRCITM,PRCI)
"RTN","PRCHITX",55,0)
 S ^TMP($J,"I")=PRCCNT
"RTN","PRCHITX",56,0)
 ;Case carts and instrument kits - processing items
"RTN","PRCHITX",57,0)
 F PRCFILE=445.7,445.8 S PRCJ=0 F  S PRCJ=$O(^PRCP(PRCFILE,"B",PRCJ)) Q:PRCJ=""  D
"RTN","PRCHITX",58,0)
 . Q:'$$ITEMACT(PRCJ)  Q:$$NIFITEM(PRCJ)
"RTN","PRCHITX",59,0)
 . S PRCITM=0 F  S PRCITM=$O(^PRCP(PRCFILE,PRCJ,1,PRCITM)) Q:+PRCITM'=PRCITM  D
"RTN","PRCHITX",60,0)
 . . Q:$D(^TMP($J,"I",PRCITM))  Q:'$$ITEMACT(PRCITM)  Q:$$NIFITEM(PRCITM)
"RTN","PRCHITX",61,0)
 . . S PRCCNT=PRCCNT+1,^TMP($J,"I",PRCITM,0)="^^"_$$FCP(PRCITM)_"^"_$$FSC(PRCITM)_"^"_$$NSN(PRCITM)_"^"_$$GETMPNUM(PRCITM)
"RTN","PRCHITX",62,0)
 . . S PRCI=$$LASTVDR(PRCITM) S:PRCI="" PRCI=$$VDRLSTD(PRCITM) S:PRCI>0 ^TMP($J,"I",PRCITM,1)=PRCI_"^"_$$UOP(PRCITM,PRCI)_"^"_$$PKGMULT(PRCITM,PRCI)_"^"_$$STKNO(PRCITM,PRCI)_"^"_$$NDC(PRCITM,PRCI)_"^"_$$CONTRACT(PRCITM,PRCI)
"RTN","PRCHITX",63,0)
 S ^TMP($J,"I")=PRCCNT
"RTN","PRCHITX",64,0)
 ;Compiling vendor info
"RTN","PRCHITX",65,0)
 S PRCI="",PRCCNT=0
"RTN","PRCHITX",66,0)
 F  S PRCI=$O(^TMP($J,"I",PRCI)) Q:PRCI=""  D
"RTN","PRCHITX",67,0)
 . S X=$P($G(^TMP($J,"I",PRCI,1)),"^") Q:X=""
"RTN","PRCHITX",68,0)
 . S:'$D(^TMP($J,"V",X)) ^TMP($J,"V",X)=$$GETVNAME(X)_"^"_$$GETTIN(X)_"^"_$$GETPOC(X)_"^"_$$GETPHONE(X)_"^"_$$ACCNT(X),PRCCNT=PRCCNT+1
"RTN","PRCHITX",69,0)
 S ^TMP($J,"V")=PRCCNT
"RTN","PRCHITX",70,0)
 Q
"RTN","PRCHITX",71,0)
ONEYRAGO() ;Returns FileMan date of one year ago
"RTN","PRCHITX",72,0)
 N X S:'$D(DT) DT=$$DT^XLFDT S X=$E(DT,1,3)-1_$E(DT,4,7)
"RTN","PRCHITX",73,0)
 Q X
"RTN","PRCHITX",74,0)
DATEGTR(X,Y) ;Tests if first date is greater than second
"RTN","PRCHITX",75,0)
 I X>Y Q 1
"RTN","PRCHITX",76,0)
 Q 0
"RTN","PRCHITX",77,0)
GETPONUM(PRCDA) ;Returns PO Number
"RTN","PRCHITX",78,0)
 N X S X=$P($G(^PRC(442,PRCDA,0)),"^")
"RTN","PRCHITX",79,0)
 Q X
"RTN","PRCHITX",80,0)
GETSTAT(PRCDA) ;Returns Supply Status Order
"RTN","PRCHITX",81,0)
 N X S X=$P($G(^PRC(442,PRCDA,7)),"^") I X="" Q X
"RTN","PRCHITX",82,0)
 S X=$P($G(^PRCD(442.3,X,0)),"^",2)
"RTN","PRCHITX",83,0)
 Q X
"RTN","PRCHITX",84,0)
STATUSOK(X) ;Checks if Supply Status Order value okay for selection
"RTN","PRCHITX",85,0)
 I ";;1;5;6;45;"[(";"_X_";") Q 0
"RTN","PRCHITX",86,0)
 Q 1
"RTN","PRCHITX",87,0)
GETPODT(PRCDA) ;Returns P.O. Date in FileMan date format
"RTN","PRCHITX",88,0)
 Q $P($G(^PRC(442,PRCDA,1)),"^",15)
"RTN","PRCHITX",89,0)
GETFCP(PRCDA) ;Returns Fund Control Point
"RTN","PRCHITX",90,0)
 Q $P($G(^PRC(442,PRCDA,0)),"^",3)
"RTN","PRCHITX",91,0)
MOPOK(PRCDA) ;Checks Method of Processing
"RTN","PRCHITX",92,0)
 N X S X=$P($G(^PRC(442,PRCDA,0)),"^",2) I X="" Q 0
"RTN","PRCHITX",93,0)
 S X=$P($G(^PRCD(442.5,X,0)),"^",2) I X="" Q 0
"RTN","PRCHITX",94,0)
 I ";IS;1358;TA;OTA;AR;"[(";"_X_";") Q 0
"RTN","PRCHITX",95,0)
 Q 1
"RTN","PRCHITX",96,0)
GETVENDR(PRCDA) ;Returns Vendor ID
"RTN","PRCHITX",97,0)
 N X S X=$P($G(^PRC(442,PRCDA,1)),"^")
"RTN","PRCHITX",98,0)
 Q X
"RTN","PRCHITX",99,0)
GETITMID(PRCDA,PRCDA1) ;Returns Item Master File Ien
"RTN","PRCHITX",100,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",5)
"RTN","PRCHITX",101,0)
 Q X
"RTN","PRCHITX",102,0)
GETUOP(PRCDA,PRCDA1) ;Returns Unit of Purchase
"RTN","PRCHITX",103,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",3) I X="" Q X
"RTN","PRCHITX",104,0)
 S X=$P($G(^PRCD(420.5,X,0)),"^")
"RTN","PRCHITX",105,0)
 Q X
"RTN","PRCHITX",106,0)
GETPKGM(PRCDA,PRCDA1) ;Returns Packaging Multiple
"RTN","PRCHITX",107,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",12)
"RTN","PRCHITX",108,0)
 Q X
"RTN","PRCHITX",109,0)
GETFSC(PRCDA,PRCDA1) ;Returns Federal Supply Classification
"RTN","PRCHITX",110,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,2)),"^",3)
"RTN","PRCHITX",111,0)
 I X="" S X=$E($P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",13),1,4)
"RTN","PRCHITX",112,0)
 Q X
"RTN","PRCHITX",113,0)
GETNSN(PRCDA,PRCDA1) ;Returns National Stock Number
"RTN","PRCHITX",114,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",13)
"RTN","PRCHITX",115,0)
 Q X
"RTN","PRCHITX",116,0)
GETSTKNO(PRCDA,PRCDA1) ;Returns Vendor Stock Number
"RTN","PRCHITX",117,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",6)
"RTN","PRCHITX",118,0)
 Q X
"RTN","PRCHITX",119,0)
GETNDC(PRCDA,PRCDA1) ;Returns National Drug Code
"RTN","PRCHITX",120,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,0)),"^",15)
"RTN","PRCHITX",121,0)
 Q X
"RTN","PRCHITX",122,0)
GETCONTR(PRCDA,PRCDA1) ;Returns Contract/BOA #
"RTN","PRCHITX",123,0)
 N X S X=$P($G(^PRC(442,PRCDA,2,PRCDA1,2)),"^",2)
"RTN","PRCHITX",124,0)
 Q X
"RTN","PRCHITX",125,0)
ITEMACT(X) ;Checks if item is active
"RTN","PRCHITX",126,0)
 I '$D(^PRC(441,X)) Q 0
"RTN","PRCHITX",127,0)
 I $P($G(^PRC(441,X,3)),"^")=1 Q 0
"RTN","PRCHITX",128,0)
 Q 1
"RTN","PRCHITX",129,0)
GETMPNUM(X) ;Returns Manufacturer Part Number
"RTN","PRCHITX",130,0)
 S X=$P($G(^PRC(441,X,3)),"^",5)
"RTN","PRCHITX",131,0)
 Q X
"RTN","PRCHITX",132,0)
GETSDESC(X) ;Returns Item Short Description
"RTN","PRCHITX",133,0)
 S X=$P($G(^PRC(441,X,0)),"^",2)
"RTN","PRCHITX",134,0)
 Q X
"RTN","PRCHITX",135,0)
GETVNAME(X) ;Returns Vendor Name
"RTN","PRCHITX",136,0)
 S X=$P($G(^PRC(440,X,0)),"^")
"RTN","PRCHITX",137,0)
 Q X
"RTN","PRCHITX",138,0)
GETTIN(X) ;Returns Tax ID Number or Social Security Number
"RTN","PRCHITX",139,0)
 S X=$P($G(^PRC(440,X,3)),"^",8)
"RTN","PRCHITX",140,0)
 Q X
"RTN","PRCHITX",141,0)
GETPOC(X) ;Returns Vendor Point of Contact
"RTN","PRCHITX",142,0)
 S X=$P($G(^PRC(440,X,0)),"^",9)
"RTN","PRCHITX",143,0)
 Q X
"RTN","PRCHITX",144,0)
GETPHONE(X) ;Returns Vendor's Phone Number
"RTN","PRCHITX",145,0)
 S X=$P($G(^PRC(440,X,0)),"^",10)
"RTN","PRCHITX",146,0)
 Q X
"RTN","PRCHITX",147,0)
REUSABLE(PRCDA) ;Returns 1 if item is reusable or 0 if not
"RTN","PRCHITX",148,0)
 N X S X=$P($G(^PRC(441,PRCDA,0)),"^",13) S X=$S(X="y":1,1:0)
"RTN","PRCHITX",149,0)
 Q X
"RTN","PRCHITX",150,0)
LASTVDR(PRCDA) ;Returns vendor ID
"RTN","PRCHITX",151,0)
 N X S X=$P($G(^PRC(441,PRCDA,0)),"^",4)
"RTN","PRCHITX",152,0)
 Q X
"RTN","PRCHITX",153,0)
CONTRACT(PRCDA,PRCDA1) ;Returns Contract #
"RTN","PRCHITX",154,0)
 N X S X=$P($G(^PRC(441,PRCDA,2,PRCDA1,0)),"^",3)
"RTN","PRCHITX",155,0)
 S X=$S(X>0:$P($G(^PRC(440,PRCDA1,4,X,0)),"^"),1:"")
"RTN","PRCHITX",156,0)
 Q X
"RTN","PRCHITX",157,0)
STKNO(PRCDA,PRCDA1) ;Returns vendor stock #
"RTN","PRCHITX",158,0)
 N X S X=$P($G(^PRC(441,PRCDA,2,PRCDA1,0)),"^",4)
"RTN","PRCHITX",159,0)
 Q X
"RTN","PRCHITX",160,0)
UOP(PRCDA,PRCDA1) ;Returns Unit of Purchase
"RTN","PRCHITX",161,0)
 N X S X=$P($G(^PRC(441,PRCDA,2,PRCDA1,0)),"^",7)
"RTN","PRCHITX",162,0)
 I X'="" S X=$P($G(^PRCD(420.5,X,0)),"^")
"RTN","PRCHITX",163,0)
 Q X
"RTN","PRCHITX",164,0)
PKGMULT(PRCDA,PRCDA1) ;Returns Packaging Multiple
"RTN","PRCHITX",165,0)
 N X S X=$P($G(^PRC(441,PRCDA,2,PRCDA1,0)),"^",8)
"RTN","PRCHITX",166,0)
 Q X
"RTN","PRCHITX",167,0)
NDC(PRCDA,PRCDA1) ;Returns NDC
"RTN","PRCHITX",168,0)
 N X S X=$P($G(^PRC(441,PRCDA,2,PRCDA1,0)),"^",5)
"RTN","PRCHITX",169,0)
 Q X
"RTN","PRCHITX",170,0)
FSC(PRCDA) ;Returns Federal Supply Classification
"RTN","PRCHITX",171,0)
 N X S X=$P($G(^PRC(441,PRCDA,0)),"^",3)
"RTN","PRCHITX",172,0)
 I X="" S X=$E($P($G(^PRC(441,PRCDA,0)),"^",5),1,4)
"RTN","PRCHITX",173,0)
 Q X
"RTN","PRCHITX",174,0)
NSN(PRCDA) ;Returns National Stock Number
"RTN","PRCHITX",175,0)
 N X S X=$P($G(^PRC(441,PRCDA,0)),"^",5)
"RTN","PRCHITX",176,0)
 Q X
"RTN","PRCHITX",177,0)
FCP(PRCDA) ;Returns FCP
"RTN","PRCHITX",178,0)
 N X,PRCA,PRCB,PRCX,PRCI S PRCI=0,PRCX=""
"RTN","PRCHITX",179,0)
 F  S PRCI=$O(^PRC(441,PRCDA,4,PRCI)) Q:+PRCI'=PRCI  D  Q:PRCX'=""
"RTN","PRCHITX",180,0)
 . S X=$P($G(^PRC(441,PRCDA,4,PRCI,0)),"^") Q:X=""
"RTN","PRCHITX",181,0)
 . S PRCA=+$E(X,1,3),PRCB=+$E(X,4,99)
"RTN","PRCHITX",182,0)
 . Q:$P($G(^PRC(420,PRCA,1,PRCB,0)),"^",19)
"RTN","PRCHITX",183,0)
 . S PRCX=$P($G(^PRC(420,PRCA,1,PRCB,0)),"^")
"RTN","PRCHITX",184,0)
 Q PRCX
"RTN","PRCHITX",185,0)
DATE(X) ;Processes date in VA FileMan format and returns date as 'DD-MON-YYYY'
"RTN","PRCHITX",186,0)
 Q:$P(X,".")'?7N ""
"RTN","PRCHITX",187,0)
 N Y,Z
"RTN","PRCHITX",188,0)
 S Y=X#100,Y=$S(Y>0:$E(100+Y,2,3)_"-",1:"")
"RTN","PRCHITX",189,0)
 S Z=$P("JAN;FEB;MAR;APR;MAY;JUN;JUL;AUG;SEP;OCT;NOV;DEC",";",X#10000\100) S:Z'="" Z=Z_"-"
"RTN","PRCHITX",190,0)
 S X=Y_Z_(X\10000+1700)
"RTN","PRCHITX",191,0)
 Q X
"RTN","PRCHITX",192,0)
GETSTATN() ;Returns station number of VistA installation
"RTN","PRCHITX",193,0)
 N X
"RTN","PRCHITX",194,0)
 S X=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHITX",195,0)
 Q X
"RTN","PRCHITX",196,0)
NIFITEM(X) ;Checks if item already has NIF Item #
"RTN","PRCHITX",197,0)
 N Y S Y=0
"RTN","PRCHITX",198,0)
 I X>0 S:+$P($G(^PRC(441,X,0)),"^",15)>0 Y=1
"RTN","PRCHITX",199,0)
 Q Y
"RTN","PRCHITX",200,0)
ACCNT(X) ;Returns vendor account number
"RTN","PRCHITX",201,0)
 N Y S Y=""
"RTN","PRCHITX",202,0)
 S:X>0 Y=$P($G(^PRC(440,X,2)),"^")
"RTN","PRCHITX",203,0)
 Q Y
"RTN","PRCHITX",204,0)
VDRLSTD(X) ;Returns vendor with highest ID from item's VENDOR multiple
"RTN","PRCHITX",205,0)
 N Y S Y=""
"RTN","PRCHITX",206,0)
 S:X>0 Y=$O(^PRC(441,X,2,"B",""),-1)
"RTN","PRCHITX",207,0)
 Q Y
"RTN","PRCHITX",208,0)
INVVNDR(PRCX) ;Returns inv's mandatory/requested source of item on trxn
"RTN","PRCHITX",209,0)
 N Y,PRCINV,PRCY,PRCZ S Y="" Q:PRCX'>0 Y
"RTN","PRCHITX",210,0)
 S PRCZ=$G(^PRCP(445.2,PRCX,0)),PRCY=$P(PRCZ,"^",5) Q:PRCY'>0 Y
"RTN","PRCHITX",211,0)
 S PRCINV=$P(PRCZ,"^"),PRCZ="" S:PRCINV>0 PRCZ=$P($G(^PRCP(445,PRCINV,1,PRCY,0)),"^",12)
"RTN","PRCHITX",212,0)
 I $P(PRCZ,";",2)="PRC(440," S PRCZ=$P(PRCZ,";") S:PRCZ>0 Y=$S($P($G(^PRC(440,PRCZ,0)),"^",11)'="S":PRCZ,1:"")
"RTN","PRCHITX",213,0)
 Q Y
"RTN","PRCHITX",214,0)
FCPINV(PRCX) ;Get FCP for Inv Transaction
"RTN","PRCHITX",215,0)
 N Y S Y="" Q:PRCX'>0 Y
"RTN","PRCHITX",216,0)
 N PRCINV S PRCINV=$P($G(^PRCP(445.2,PRCX,0)),"^")
"RTN","PRCHITX",217,0)
 I PRCINV>0 D
"RTN","PRCHITX",218,0)
 . N PRCSTA,PRCDA S PRCDA="",PRCSTA=$P($G(^PRCP(445,PRCINV,0)),"-")
"RTN","PRCHITX",219,0)
 . S:PRCSTA'="" PRCDA=$O(^PRC(420,"AE",PRCSTA,PRCINV,""))
"RTN","PRCHITX",220,0)
 . S:PRCDA>0 Y=$P($G(^PRC(420,PRCSTA,1,PRCDA,0)),"^")
"RTN","PRCHITX",221,0)
 Q Y
"RTN","PRCHITX1")
0^2^B14889726
"RTN","PRCHITX1",1,0)
PRCHITX1 ;WOIFO/LKG-WRITING ITEM DATA FOR NIF TO DAT FILES ;12/27/04  17:58
"RTN","PRCHITX1",2,0)
 ;;5.1;IFCAP;**75**;OCT 20, 2000
"RTN","PRCHITX1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHITX1",4,0)
START ;Writes .dat file of vendor and item information to host file
"RTN","PRCHITX1",5,0)
 D EN^DDIOL("This option writes item information to the .dat file.")
"RTN","PRCHITX1",6,0)
 D EN^DDIOL("It is recommended to queue this extract for a time of low user activity.",,"!!")
"RTN","PRCHITX1",7,0)
 N %ZIS,ZTRTN,ZTDESC,PRCPHYS
"RTN","PRCHITX1",8,0)
 K Y,DIR S DIR(0)="Y",DIR("A")="Include physical inventory count transactions in the analysis",DIR("B")="NO"
"RTN","PRCHITX1",9,0)
 S DIR("?",1)="Answer 'YES' if you have a large number of items that have recently been"
"RTN","PRCHITX1",10,0)
 S DIR("?",2)="added to your GIP inventory, but have not yet been received or issued."
"RTN","PRCHITX1",11,0)
 S DIR("?")="Answer 'NO' to exclude slow moving stock from NIF processing."
"RTN","PRCHITX1",12,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) G ITX
"RTN","PRCHITX1",13,0)
 S PRCPHYS=$S(Y=1:"Y",1:"N") K Y
"RTN","PRCHITX1",14,0)
 S %ZIS="Q",%ZIS("A")="Host File Device: ",%ZIS("B")="PRC_WIDE_HOST_FILE"
"RTN","PRCHITX1",15,0)
 D ^%ZIS G:POP ITX
"RTN","PRCHITX1",16,0)
 I $D(IO("Q")) D  Q
"RTN","PRCHITX1",17,0)
 . S ZTRTN="COMPILE^PRCHITX1",ZTDESC="Item Extraction for NIF",ZTSAVE("PRCPHYS")=""
"RTN","PRCHITX1",18,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","PRCHITX1",19,0)
 . D EN^DDIOL("Task #"_ZTSK) K IO("Q"),ZTSK
"RTN","PRCHITX1",20,0)
COMPILE ;invoke the item and vendor compile
"RTN","PRCHITX1",21,0)
 N X,Y,PRCSTA,PRCV,PRCW,PRCX,PRCY,PRCZ
"RTN","PRCHITX1",22,0)
 D IN^PRCHITX
"RTN","PRCHITX1",23,0)
 S PRCSTA=$$GETSTATN^PRCHITX
"RTN","PRCHITX1",24,0)
 U IO
"RTN","PRCHITX1",25,0)
VENDOR ;Write vendor data
"RTN","PRCHITX1",26,0)
 S PRCX=""
"RTN","PRCHITX1",27,0)
 F  S PRCX=$O(^TMP($J,"V",PRCX)) Q:PRCX=""  D
"RTN","PRCHITX1",28,0)
 . S PRCY=$G(^TMP($J,"V",PRCX)) Q:PRCY=""
"RTN","PRCHITX1",29,0)
 . S PRCZ="6^9^"_PRCSTA_"^"_PRCX_"^"_$P(PRCY,"^")_"^"_$P(PRCY,"^",4)_"^"_$P(PRCY,"^",3)_"^"_$P(PRCY,"^",2)_"^"_$P(PRCY,"^",5)
"RTN","PRCHITX1",30,0)
 . W PRCZ,!
"RTN","PRCHITX1",31,0)
ITEM ;Write item data
"RTN","PRCHITX1",32,0)
 S PRCX=""
"RTN","PRCHITX1",33,0)
 F  S PRCX=$O(^TMP($J,"I",PRCX)) Q:PRCX=""  D
"RTN","PRCHITX1",34,0)
 . S PRCY=$G(^TMP($J,"I",PRCX,0)) Q:PRCY=""
"RTN","PRCHITX1",35,0)
 . S PRCZ="6^0^"_PRCSTA_"^"_$P(PRCY,"^",8)_"^"_PRCX_"^"_$$GETSDESC^PRCHITX(PRCX)_"^"
"RTN","PRCHITX1",36,0)
 . W PRCZ
"RTN","PRCHITX1",37,0)
 . S X=0,Y=1
"RTN","PRCHITX1",38,0)
 . F  S X=$O(^PRC(441,PRCX,1,X)) Q:X=""  D
"RTN","PRCHITX1",39,0)
 . . S PRCZ=$G(^PRC(441,PRCX,1,X,0)),PRCZ=$TR(PRCZ,"^") Q:PRCZ=""
"RTN","PRCHITX1",40,0)
 . . W:Y>1 " " W PRCZ S Y=Y+1
"RTN","PRCHITX1",41,0)
 . S PRCZ="^^"_$P(PRCY,"^",6)_"^"_$P(PRCY,"^",4)_"^" W PRCZ
"RTN","PRCHITX1",42,0)
 . S PRCW=$G(^TMP($J,"I",PRCX,1)),PRCV=$P(PRCW,"^")
"RTN","PRCHITX1",43,0)
 . S PRCZ=$P(PRCY,"^",5)_"^^"_PRCV_"^^^^"_$P(PRCW,"^",4)_"^0^"_$P(PRCW,"^",2)_"^"_$P(PRCW,"^",3)_"^"
"RTN","PRCHITX1",44,0)
 . W PRCZ
"RTN","PRCHITX1",45,0)
 . S PRCZ=$P(PRCY,"^",3)_"^"_$P(PRCW,"^",6)_"^^"_$P(PRCW,"^",5)
"RTN","PRCHITX1",46,0)
 . W PRCZ,!
"RTN","PRCHITX1",47,0)
 D ^%ZISC
"RTN","PRCHITX1",48,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PRCHITX1",49,0)
 D:'$D(ZTQUEUED) EN^DDIOL("<DONE>")
"RTN","PRCHITX1",50,0)
 K PRCW,PRCX,PRCY,PRCZ S PRCW=$$KSP^XUPARAM("WHERE")
"RTN","PRCHITX1",51,0)
 K XMZ,XMMG,XMDUZ,XMY,XMSUB,XMTEXT
"RTN","PRCHITX1",52,0)
 S PRCX(1)="Record counts for NIF Item Extract File from Station "_PRCSTA
"RTN","PRCHITX1",53,0)
 S PRCX(2)=" "
"RTN","PRCHITX1",54,0)
 S PRCX(3)="    Number of items: "_$G(^TMP($J,"I"),0)
"RTN","PRCHITX1",55,0)
 S PRCX(4)="  Number of vendors: "_$G(^TMP($J,"V"),0)
"RTN","PRCHITX1",56,0)
 S PRCX(5)=" ",PRCX(6)="Physical count transactions were "_$S(PRCPHYS="Y":"",1:"not ")_"included in the analysis."
"RTN","PRCHITX1",57,0)
 X ^%ZOSF("UCI") S PRCY=^%ZOSF("PROD") S:PRCY'["," Y=$P(Y,",")
"RTN","PRCHITX1",58,0)
 I Y=PRCY,PRCW'["FO-",PRCW'["ISC-" S XMY("prchitem@va.gov")=""
"RTN","PRCHITX1",59,0)
 I $G(DUZ)>0,$D(^VA(200,DUZ)) D
"RTN","PRCHITX1",60,0)
 . N PRCNAME
"RTN","PRCHITX1",61,0)
 . S XMY(DUZ)=""
"RTN","PRCHITX1",62,0)
 . S PRCNAME("FILE")=200,PRCNAME("IENS")=DUZ_",",PRCNAME("FIELD")=.01
"RTN","PRCHITX1",63,0)
 . S PRCX(7)=" ",PRCX(8)="The extraction process was run by "_$$NAMEFMT^XLFNAME(.PRCNAME,"G","M")_"."
"RTN","PRCHITX1",64,0)
 S XMSUB="NIF Item Extract Statistics for Station "_PRCSTA
"RTN","PRCHITX1",65,0)
 S XMDUZ="NIF ITEM EXTRACTOR"
"RTN","PRCHITX1",66,0)
 S XMTEXT="PRCX(" D ^XMD
"RTN","PRCHITX1",67,0)
 I $G(XMZ),'$D(ZTQUEUED) D EN^DDIOL("MailMan message #"_$G(XMZ)_" with extract statistics was sent.")
"RTN","PRCHITX1",68,0)
 K XMZ,XMMG,XMDUZ,XMY,XMSUB,XMTEXT,PRCPHYS
"RTN","PRCHITX1",69,0)
ITX ;EXIT
"RTN","PRCHITX1",70,0)
 K POP,^TMP($J),DTOUT,DUOUT,DIRUT,DIROUT,Y
"RTN","PRCHITX1",71,0)
 Q
"RTN","PRCHITX2")
1^3
"VER")
8.0^22.0
**END**
**END**
