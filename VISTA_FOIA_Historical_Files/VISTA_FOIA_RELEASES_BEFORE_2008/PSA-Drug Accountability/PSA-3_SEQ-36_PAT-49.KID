Released PSA*3*49 SEQ #36
Extracted from mail message
**KIDS**:PSA*3.0*49^

**INSTALL NAME**
PSA*3.0*49
"BLD",5810,0)
PSA*3.0*49^DRUG ACCOUNTABILITY^0^3041213^y
"BLD",5810,1,0)
^^4^4^3041213^
"BLD",5810,1,1,0)
This patch will correct a syntax error in routine PSAVERA2.
"BLD",5810,1,2,0)
 
"BLD",5810,1,3,0)
Multiple options with erroneous outpatient division on 
"BLD",5810,1,4,0)
pharmacy locations.
"BLD",5810,4,0)
^9.64PA^^
"BLD",5810,"ABPKG")
n
"BLD",5810,"KRN",0)
^9.67PA^8989.52^19
"BLD",5810,"KRN",.4,0)
.4
"BLD",5810,"KRN",.401,0)
.401
"BLD",5810,"KRN",.402,0)
.402
"BLD",5810,"KRN",.403,0)
.403
"BLD",5810,"KRN",.5,0)
.5
"BLD",5810,"KRN",.84,0)
.84
"BLD",5810,"KRN",3.6,0)
3.6
"BLD",5810,"KRN",3.8,0)
3.8
"BLD",5810,"KRN",9.2,0)
9.2
"BLD",5810,"KRN",9.8,0)
9.8
"BLD",5810,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5810,"KRN",9.8,"NM",1,0)
PSAVERA2^^0^B7312918
"BLD",5810,"KRN",9.8,"NM",2,0)
PSAUTL3^^0^B22928570
"BLD",5810,"KRN",9.8,"NM",3,0)
PSAUTL1^^0^B50572615
"BLD",5810,"KRN",9.8,"NM","B","PSAUTL1",3)

"BLD",5810,"KRN",9.8,"NM","B","PSAUTL3",2)

"BLD",5810,"KRN",9.8,"NM","B","PSAVERA2",1)

"BLD",5810,"KRN",19,0)
19
"BLD",5810,"KRN",19.1,0)
19.1
"BLD",5810,"KRN",101,0)
101
"BLD",5810,"KRN",409.61,0)
409.61
"BLD",5810,"KRN",771,0)
771
"BLD",5810,"KRN",870,0)
870
"BLD",5810,"KRN",8989.51,0)
8989.51
"BLD",5810,"KRN",8989.52,0)
8989.52
"BLD",5810,"KRN",8994,0)
8994
"BLD",5810,"KRN","B",.4,.4)

"BLD",5810,"KRN","B",.401,.401)

"BLD",5810,"KRN","B",.402,.402)

"BLD",5810,"KRN","B",.403,.403)

"BLD",5810,"KRN","B",.5,.5)

"BLD",5810,"KRN","B",.84,.84)

"BLD",5810,"KRN","B",3.6,3.6)

"BLD",5810,"KRN","B",3.8,3.8)

"BLD",5810,"KRN","B",9.2,9.2)

"BLD",5810,"KRN","B",9.8,9.8)

"BLD",5810,"KRN","B",19,19)

"BLD",5810,"KRN","B",19.1,19.1)

"BLD",5810,"KRN","B",101,101)

"BLD",5810,"KRN","B",409.61,409.61)

"BLD",5810,"KRN","B",771,771)

"BLD",5810,"KRN","B",870,870)

"BLD",5810,"KRN","B",8989.51,8989.51)

"BLD",5810,"KRN","B",8989.52,8989.52)

"BLD",5810,"KRN","B",8994,8994)

"BLD",5810,"QUES",0)
^9.62^^
"BLD",5810,"REQB",0)
^9.611^1^1
"BLD",5810,"REQB",1,0)
PSA*3.0*48^1
"BLD",5810,"REQB","B","PSA*3.0*48",1)

"MBREQ")
0
"PKG",487,-1)
1^1
"PKG",487,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",487,20,0)
^9.402P^^
"PKG",487,22,0)
^9.49I^1^1
"PKG",487,22,1,0)
3.0^2971024^2981028^66481
"PKG",487,22,1,"PAH",1,0)
49^3041213
"PKG",487,22,1,"PAH",1,1,0)
^^4^4^3041213
"PKG",487,22,1,"PAH",1,1,1,0)
This patch will correct a syntax error in routine PSAVERA2.
"PKG",487,22,1,"PAH",1,1,2,0)
 
"PKG",487,22,1,"PAH",1,1,3,0)
Multiple options with erroneous outpatient division on 
"PKG",487,22,1,"PAH",1,1,4,0)
pharmacy locations.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSAUTL1")
0^3^B50572615
"RTN","PSAUTL1",1,0)
PSAUTL1 ;BIR/JMB-Prime Vendor Invoice Data Utility ;9/19/97
"RTN","PSAUTL1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**3,12,15,21,48,49**; 10/24/97
"RTN","PSAUTL1",3,0)
 ;This routine contains utilities to get the location name, display an
"RTN","PSAUTL1",4,0)
 ;error-free item, display an item with errors, and display a line ready
"RTN","PSAUTL1",5,0)
 ;for verification.
"RTN","PSAUTL1",6,0)
 ;References to global ^PS(59.4, are covered under IA #2505
"RTN","PSAUTL1",7,0)
 ;References to global ^DIC(51.5, are covered under IA #1931
"RTN","PSAUTL1",8,0)
 ;References to global ^PS(59, are covered under IA #212
"RTN","PSAUTL1",9,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAUTL1",10,0)
 ;
"RTN","PSAUTL1",11,0)
SITES ;Gets the combined IP/OP's IP & OP site names
"RTN","PSAUTL1",12,0)
 ;PSA*3*22 (DAVE B) no location defined
"RTN","PSAUTL1",13,0)
 I $G(PSALOC)'>0 S (PSAISITN,PSAOSITN)="Unknown",PSACOMB=" No location identifed" Q
"RTN","PSAUTL1",14,0)
 ;End PSA*3*22
"RTN","PSAUTL1",15,0)
 S PSAISIT=+$P($G(^PSD(58.8,PSALOC,0)),"^",3) D OPSITE
"RTN","PSAUTL1",16,0)
 I $G(PSAOSIT)="" S PSAOSIT=0
"RTN","PSAUTL1",17,0)
 S PSAISITN=$S($P($G(^PS(59.4,PSAISIT,0)),"^")'="":$P($G(^PS(59.4,PSAISIT,0)),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",18,0)
 I PSAISIT,PSAOSIT S PSACOMB=": "_PSAISITN_" (IP) "_PSAOSITN_" (OP)" Q
"RTN","PSAUTL1",19,0)
 I PSAISIT S PSACOMB=": "_PSAISITN_" (IP)" Q
"RTN","PSAUTL1",20,0)
 I PSAOSIT S PSACOMB=": "_PSAOSITN_" (OP)" Q
"RTN","PSAUTL1",21,0)
 ;DAVE B (PSA*3*12) no DA sites defined
"RTN","PSAUTL1",22,0)
 S PSACOMB="No Inpatient or Outpatient Sites defined"
"RTN","PSAUTL1",23,0)
 Q
"RTN","PSAUTL1",24,0)
OPSITE ;PSA*3*25 - check for multiple OP sites
"RTN","PSAUTL1",25,0)
 ;VMP OIFO BAY PINES;ELR;PSA*3*49  ADDED THE FOLLOWING LINE
"RTN","PSAUTL1",26,0)
 S (PSAOSIT,PSAOSITN)=""
"RTN","PSAUTL1",27,0)
 K PSAOSITC
"RTN","PSAUTL1",28,0)
 Q:'$D(PSALOC)
"RTN","PSAUTL1",29,0)
 I '$D(^PSD(58.8,+PSALOC,7)),$P(^PSD(58.8,+PSALOC,0),"^",10)'="" S PSAOSIT=$P(^PSD(58.8,+PSALOC,0),"^",10),PSAOSITN=$P($G(^PS(59,PSAOSIT,0)),"^"),PSAOSITN=$S($G(PSAOSITN)="":"Unknown",1:PSAOSITN)
"RTN","PSAUTL1",30,0)
 S XX=0 F  S XX=$O(^PSD(58.8,+PSALOC,7,XX)) Q:XX'>0  S PSAOSIT=XX,PSAOSITC=$G(PSAOSITC)+1,SN=$P($G(^PS(59,XX,0)),"^") D
"RTN","PSAUTL1",31,0)
 .I PSAOSITC=1 S PSAOSITN=SN Q
"RTN","PSAUTL1",32,0)
 .S PSAOSITN=PSAOSITN_" & "_SN
"RTN","PSAUTL1",33,0)
 I $G(PSAOSITN)="",$P(^PSD(58.8,+PSALOC,0),"^",10)'="" S PSAOSIT=$P(^PSD(58.8,+PSALOC,0),"^",10),PSAOSITN=$P($G(^PS(59,+PSAOSIT,0)),"^")
"RTN","PSAUTL1",34,0)
 S PSAOSITN=$S($G(PSAOSITN)="":"unknown",1:PSAOSITN)
"RTN","PSAUTL1",35,0)
 Q
"RTN","PSAUTL1",36,0)
 ;
"RTN","PSAUTL1",37,0)
DISPLAY ;Displays an error-free line item
"RTN","PSAUTL1",38,0)
 S PSADISP=1
"RTN","PSAUTL1",39,0)
 S PSAIEN=$P(PSADATA,"^",6),PSASUB=$P($P(PSADATA,"^",7),"~"),PSANDC=$P($P(PSADATA,"^",4),"~"),PSAVSN=$P($P(PSADATA,"^",5),"~")
"RTN","PSAUTL1",40,0)
 W !,PSALINE_"  "_$S($P($G(^PSDRUG(PSAIEN,0)),"^")'="":$P(^PSDRUG(PSAIEN,0),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",41,0)
 I PSAIEN D
"RTN","PSAUTL1",42,0)
 .I $P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" W " (Controlled Substance)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN MASTER VAULT **" Q
"RTN","PSAUTL1",43,0)
 .I $P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN PHARMACY LOCATION **"
"RTN","PSAUTL1",44,0)
 .I $D(^PSDRUG(PSAIEN,"I")) W !?5,"** INACTIVE IN DRUG FILE **"
"RTN","PSAUTL1",45,0)
 W !,"Qty Invoiced: "_+$P(PSADATA,"^")
"RTN","PSAUTL1",46,0)
 W:$P($P(PSADATA,"^",26),"~")'="" ?38,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUTL1",47,0)
 W !,"Order Unit  : "
"RTN","PSAUTL1",48,0)
 S PSAOU=$S(+$P(PSADATA,"^",12):+$P(PSADATA,"^",12),+$P($P(PSADATA,"^",2),"~",2):+$P($P(PSADATA,"^",2),"~",2),PSAIEN&(PSASUB)&(+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5)):+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",5),1:0)
"RTN","PSAUTL1",49,0)
 W $S(PSAOU:$P($G(^DIC(51.5,+PSAOU,0)),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",50,0)
 W:$E(PSANDC)'="S" ?38,"NDC: " D PSANDC1^PSAHELP W PSANDCX K PSANDCX
"RTN","PSAUTL1",51,0)
 W !,"Unit Price  : $"_$P(PSADATA,"^",3),?38,"VSN: "_$S(PSAVSN'="":PSAVSN,1:"Blank"),!
"RTN","PSAUTL1",52,0)
 I $P(PSADATA,U,13)=.5 D  ;*48 AUTO OU UPDATE FOR MCKESSON
"RTN","PSAUTL1",53,0)
 . W !,"*****>",!,"Note: The order unit was changed from EACH to ",$P($G(^DIC(51.5,+PSAOU,0)),"^")," by Drug Accountability"
"RTN","PSAUTL1",54,0)
 . W !,"      during the upload of the invoiced data. Adjustments may be necessary.",!,"*****<"
"RTN","PSAUTL1",55,0)
 W !,"Dispense Units: "_$S(+PSAIEN&($P($G(^PSDRUG(+PSAIEN,660)),"^",8)'=""):$P($G(^PSDRUG(+PSAIEN,660)),"^",8),1:"Blank")
"RTN","PSAUTL1",56,0)
 W !,"Dispense Units Per Order Unit: "_$S($P(PSADATA,"^",20):+$P(PSADATA,"^",20),+PSASUB&(+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7),1:"Blank")
"RTN","PSAUTL1",57,0)
 S PSALOC=$S($P(PSADATA,"^",19)="":+$P(PSAIN,"^",7),1:+$P(PSAIN,"^",12))
"RTN","PSAUTL1",58,0)
 Q:'+$P($G(^PSD(58.8,+PSALOC,0)),"^",14)!('$G(PSAIEN))
"RTN","PSAUTL1",59,0)
 S PSASTOCK=$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3),1:"Blank")
"RTN","PSAUTL1",60,0)
 W !,"Stock Level   : "_PSASTOCK
"RTN","PSAUTL1",61,0)
 S PSAREORD=$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5),1:"Blank") ;*48
"RTN","PSAUTL1",62,0)
 W !,"Reorder Level : "_PSAREORD,!
"RTN","PSAUTL1",63,0)
 Q
"RTN","PSAUTL1",64,0)
 ;
"RTN","PSAUTL1",65,0)
EDITDISP ;Displays a line item with errors.
"RTN","PSAUTL1",66,0)
 W @IOF,!?23,"<<< PROCESS LINE ITEM SCREEN >>>",!,"Order#: "_$P(PSAIN,"^",4)_"  Invoice#: "_$P(PSAIN,"^",2)_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN),!,PSASLN
"RTN","PSAUTL1",67,0)
EDIT1 S PSADATA=$G(^XTMP("PSAPV",PSACTRL,"IT",PSALINE))
"RTN","PSAUTL1",68,0)
 S PSALOC=$S($P(PSADATA,"^",19)="":+$P(PSAIN,"^",7),1:+$P(PSAIN,"^",12))
"RTN","PSAUTL1",69,0)
 W !,PSALINE_"  "_$S($D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")):$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"),"^",3),PSAIEN&($P($G(^PSDRUG(PSAIEN,0)),"^")'=""):$P(^PSDRUG(PSAIEN,0),"^"),1:"UNKNOWN ITEM")
"RTN","PSAUTL1",70,0)
 I PSAIEN D
"RTN","PSAUTL1",71,0)
 .I $P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" W " (Controlled Substance)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN MASTER VAULT **" Q
"RTN","PSAUTL1",72,0)
 .I $P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN PHARMACY LOCATION **"
"RTN","PSAUTL1",73,0)
 ;
"RTN","PSAUTL1",74,0)
 W !,"Qty Invoiced: "
"RTN","PSAUTL1",75,0)
 I $P(PSADATA,"^",8)'="" W $P(PSADATA,"^",8)_" ("_$S(+PSADATA:+PSADATA,$P(PSADATA,"^")=0:0,1:"Blank")_")"
"RTN","PSAUTL1",76,0)
 I $P(PSADATA,"^",8)="" W $S(+PSADATA:+PSADATA,$P(PSADATA,"^")=0:0,1:"Blank")
"RTN","PSAUTL1",77,0)
 W:$P($P(PSADATA,"^",26),"~")'="" ?38,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUTL1",78,0)
 ;
"RTN","PSAUTL1",79,0)
 W !,"Order Unit  : "
"RTN","PSAUTL1",80,0)
 I +$P(PSADATA,"^",12) D
"RTN","PSAUTL1",81,0)
 .W $P($G(^DIC(51.5,+$P(PSADATA,"^",12),0)),"^")
"RTN","PSAUTL1",82,0)
 .W " ("_$S($P($P(PSADATA,"^",2),"~")'="":$P($P(PSADATA,"^",2),"~"),$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",3),0)),"^")'="":$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",3),0)),"^"),1:"Blank")_")"
"RTN","PSAUTL1",83,0)
 I '+$P(PSADATA,"^",12) D
"RTN","PSAUTL1",84,0)
 .W $S(+$P($P(PSADATA,"^",2),"~",2):$P($P(PSADATA,"^",2),"~"),PSAIEN&(PSASUB)&(+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5)):$P($G(^DIC(51.5,+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",5),0)),"^"),1:"Blank")
"RTN","PSAUTL1",85,0)
 ;
"RTN","PSAUTL1",86,0)
 W:$E(PSANDC)'="S" ?38,"NDC: " D PSANDC1^PSAHELP W PSANDCX K PSANDCX
"RTN","PSAUTL1",87,0)
 S PSAPRICE=$P(PSADATA,"^",3)
"RTN","PSAUTL1",88,0)
 I +PSAPRICE,$L($P(PSAPRICE,".",2))<2 S PSAPRICE=$P(PSAPRICE,".")_"."_$P(PSAPRICE,".",2)_$E("00",1,(2-$L($P(PSAPRICE,".",2))))
"RTN","PSAUTL1",89,0)
 W !,"Unit Price  : $"_$S($G(PSAPRICE):PSAPRICE,PSAPRICE=0:0,1:"Blank"),?38,"VSN: "_$S(PSAVSN'="":PSAVSN,1:"Blank"),!
"RTN","PSAUTL1",90,0)
 I $P(PSADATA,U,13)=.5 D  ;*48 AUTO OU UPDATE FOR MCKESSON
"RTN","PSAUTL1",91,0)
 . N PSAOU S PSAOU=$P(PSADATA,U,12)
"RTN","PSAUTL1",92,0)
 . W !,"*****>",!,"Note: The order unit was changed from EACH to ",$P($G(^DIC(51.5,+PSAOU,0)),"^")," by Drug Accountability"
"RTN","PSAUTL1",93,0)
 . W !,"      during the upload of the invoiced data. Adjustments may be necessary.",!,"*****<"
"RTN","PSAUTL1",94,0)
 S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSALOC=$S($P(PSADATA,"^",19)="CS":+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",7))
"RTN","PSAUTL1",95,0)
DU W !,"Dispense Units: "_$S(+PSAIEN&($P($G(^PSDRUG(+PSAIEN,660)),"^",8)'=""):$P($G(^PSDRUG(+PSAIEN,660)),"^",8),1:"Blank")
"RTN","PSAUTL1",96,0)
DUOU W !,"Dispense Units Per Order Unit: "_$S($P(PSADATA,"^",20):+$P(PSADATA,"^",20),+PSASUB&(+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7),1:"Blank"),!
"RTN","PSAUTL1",97,0)
 ;
"RTN","PSAUTL1",98,0)
 Q:'+$P($G(^PSD(58.8,+PSALOC,0)),"^",14)
"RTN","PSAUTL1",99,0)
 ;
"RTN","PSAUTL1",100,0)
 S PSASTOCK=$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3),1:"Blank")
"RTN","PSAUTL1",101,0)
 W "Stock Level   : "_PSASTOCK
"RTN","PSAUTL1",102,0)
 S PSAREORD=$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5),1:"Blank")
"RTN","PSAUTL1",103,0)
 W !,"Reorder Level : "_PSAREORD,!
"RTN","PSAUTL1",104,0)
 Q
"RTN","PSAUTL3")
0^2^B22928570
"RTN","PSAUTL3",1,0)
PSAUTL3 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data Utility - CONT'D ;7/23/97
"RTN","PSAUTL3",2,0)
 ;;3.0;DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**49**; 10/24/97
"RTN","PSAUTL3",3,0)
 ;This utility displays locations & allows user to select one, many, or
"RTN","PSAUTL3",4,0)
 ;all locations.
"RTN","PSAUTL3",5,0)
 ;
"RTN","PSAUTL3",6,0)
 S PSALOC=+$O(^PSD(58.8,"ADISP","P",0))
"RTN","PSAUTL3",7,0)
 I 'PSALOC W !!?5,"No Drug Accountability location has been created yet." S PSAOUT=1 G EXIT
"RTN","PSAUTL3",8,0)
 ;
"RTN","PSAUTL3",9,0)
ORDER ;If more than one pharmacy location, collect them in alpha order.
"RTN","PSAUTL3",10,0)
 S (PSACNT,PSALOC)=0 W !
"RTN","PSAUTL3",11,0)
 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAUTL3",12,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAUTL3",13,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAUTL3",14,0)
 .I '$D(PSATRAN) Q:'$O(^PSD(58.8,PSALOC,1,0))
"RTN","PSAUTL3",15,0)
 .;VMP OIFO BAY PINES;ELR;PSA*3*49
"RTN","PSAUTL3",16,0)
 .S (PSAOSIT,PSAOSITN)=""
"RTN","PSAUTL3",17,0)
 .D SITES^PSAUTL1
"RTN","PSAUTL3",18,0)
 .S PSACNT=PSACNT+1,PSAONE=+PSALOC
"RTN","PSAUTL3",19,0)
 .S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=$P(^(0),"^",3)_"^"_$P(^(0),"^",10)_"^"_$P($G(^PSD(58.8,PSALOC,"I")),"^")
"RTN","PSAUTL3",20,0)
 I PSACNT=1 G:$G(PSATRAN)="" ONE W !?5,"There is only one active pharmacy location.",!?5,"There must be at least two to transfer drugs." S PSAOUT=1 Q
"RTN","PSAUTL3",21,0)
 S PSACHK=$O(PSALOCA("")) I PSACHK="" G EXIT
"RTN","PSAUTL3",22,0)
 G DISP
"RTN","PSAUTL3",23,0)
 ;
"RTN","PSAUTL3",24,0)
ONE ;only one
"RTN","PSAUTL3",25,0)
 S PSALOC=PSAONE
"RTN","PSAUTL3",26,0)
 I '$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="") W !,"There are no Drug Accountability pharmacy locations with data." Q
"RTN","PSAUTL3",27,0)
 S PSALOCN="",PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  S PSALOC=0,PSALOC=+$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  S PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC)
"RTN","PSAUTL3",28,0)
 G EXIT
"RTN","PSAUTL3",29,0)
 ;
"RTN","PSAUTL3",30,0)
DISP ;Displays the available pharmacy locations.
"RTN","PSAUTL3",31,0)
 W @IOF,!
"RTN","PSAUTL3",32,0)
 W:$G(PSATRAN)="F" "Choose the pharmacy location transferring the drugs:"
"RTN","PSAUTL3",33,0)
 W:$G(PSATRAN)="T" "Choose the pharmacy location receiving the transferred drugs:"
"RTN","PSAUTL3",34,0)
 W:$G(PSATRAN)="" "Choose one or many pharmacy locations:"
"RTN","PSAUTL3",35,0)
 W ! S PSACNT=0,PSALOCN=""
"RTN","PSAUTL3",36,0)
 F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAUTL3",37,0)
 .S PSALOC=0 F  S PSALOC=+$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAUTL3",38,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=""
"RTN","PSAUTL3",39,0)
 ..W !,$J(PSACNT,2)
"RTN","PSAUTL3",40,0)
 ..W:$L(PSALOCN)>76 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 ?4,PSALOCN
"RTN","PSAUTL3",41,0)
 W !
"RTN","PSAUTL3",42,0)
 ;
"RTN","PSAUTL3",43,0)
SELECT I $G(PSATRAN)="" S DIR(0)="L^1:"_PSACNT,DIR("A")="Select PHARMACY LOCATION",DIR("??")="^D HELP^PSAUTL3"
"RTN","PSAUTL3",44,0)
 I $G(PSATRAN)="F"!($G(PSATRAN)="T") S DIR(0)="N^1:"_PSACNT D
"RTN","PSAUTL3",45,0)
 .I $G(PSATRAN)="F" S DIR("A")="Select Transfer from Pharmacy",DIR("??")="^D FROMHELP^PSAUTL3"
"RTN","PSAUTL3",46,0)
 .I $G(PSATRAN)="T" S DIR(0)="N^1:"_PSACNT,DIR("A")="Select Transfer to Pharmacy",DIR("??")="^D TOHELP^PSAUTL3"
"RTN","PSAUTL3",47,0)
 S DIR("?")="Enter the number(s) of the pharmacy location"
"RTN","PSAUTL3",48,0)
 D ^DIR K DIR I 'Y S PSAOUT=1 G EXIT
"RTN","PSAUTL3",49,0)
 S PSASEL=Y F PSAPC=1:1 S PSANUM=+$P(PSASEL,",",PSAPC) Q:'PSANUM  D
"RTN","PSAUTL3",50,0)
 .S PSALOCN=$O(PSAMENU(PSANUM,"")),PSALOC=+$O(PSAMENU(PSANUM,PSALOCN,0))
"RTN","PSAUTL3",51,0)
 .S PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC)
"RTN","PSAUTL3",52,0)
 ;
"RTN","PSAUTL3",53,0)
EXIT ;Kills all variables except PSALOC array & PSAOUT
"RTN","PSAUTL3",54,0)
 K DIR,PSACOMB,PSAISIT,PSAISITN,PSAMENU,PSAONE,PSANUM,PSAOSIT,PSAOSITN,PSAPC,Y
"RTN","PSAUTL3",55,0)
 Q
"RTN","PSAUTL3",56,0)
 ;
"RTN","PSAUTL3",57,0)
FROMHELP ;Extended help to 'Select Transfer from Pharmacy'
"RTN","PSAUTL3",58,0)
 W !?5,"Enter the number of the pharmacy location that will transfer the drugs to another pharmacy."
"RTN","PSAUTL3",59,0)
 Q
"RTN","PSAUTL3",60,0)
HELP ;Extended help to 'Select PHARMACY LOCATION'
"RTN","PSAUTL3",61,0)
 W !?5,"Enter the number of the pharmacy location you want to select.",!?5,"If you want more than one pharmacy location, enter the numbers",!?5,"separated by a comma."
"RTN","PSAUTL3",62,0)
 W !!?5,"For example: Enter 1,3 or 1-3,5."
"RTN","PSAUTL3",63,0)
 Q
"RTN","PSAUTL3",64,0)
TOHELP ;Extended help to 'Select Transfer to Pharmacy'
"RTN","PSAUTL3",65,0)
 W !?5,"Enter the number of the pharmacy location that will receive the transferred the drugs."
"RTN","PSAUTL3",66,0)
 Q
"RTN","PSAUTL3",67,0)
 ;
"RTN","PSAUTL3",68,0)
SETAORD ;Set logic for "AORD" X-Ref
"RTN","PSAUTL3",69,0)
 S PSADA(1)=$O(^PSD(58.811,"B",X,0))
"RTN","PSAUTL3",70,0)
 S PSADA=0 F  S PSADA=$O(^PSD(58.811,PSADA(1),1,PSADA)) Q:'PSADA  D
"RTN","PSAUTL3",71,0)
 .S ^PSD(58.811,"AORD",X,$P($G(^PSD(58.811,PSADA(1),1,PSADA,0)),"^"),PSADA(1),PSADA)=""
"RTN","PSAUTL3",72,0)
 K PSADA
"RTN","PSAUTL3",73,0)
 Q
"RTN","PSAUTL3",74,0)
KILLAORD ;Kill logic for "AORD" X-Ref
"RTN","PSAUTL3",75,0)
 K ^PSD(58.811,"AORD",X)
"RTN","PSAUTL3",76,0)
 Q
"RTN","PSAUTL3",77,0)
 ;
"RTN","PSAUTL3",78,0)
SLOC ;Set logic for "ALOC" X-Ref on Pharmacy Location & Master Vault fields
"RTN","PSAUTL3",79,0)
 Q:'+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2)
"RTN","PSAUTL3",80,0)
 S ^PSD(58.811,"ALOC",X,+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2),DA(1),DA)=""
"RTN","PSAUTL3",81,0)
 Q
"RTN","PSAUTL3",82,0)
KLOC ;Kill logic for "ALOC" X-Ref on Pharmacy Location & Master Vault fields
"RTN","PSAUTL3",83,0)
 K ^PSD(58.811,"ALOC",X,+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2),DA(1),DA)
"RTN","PSAUTL3",84,0)
 Q
"RTN","PSAUTL3",85,0)
 ;
"RTN","PSAUTL3",86,0)
SLOCDT ;Set logic for "ALOC" X-Ref on Invoice Date field
"RTN","PSAUTL3",87,0)
 S:+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5) ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5),X,DA(1),DA)=""
"RTN","PSAUTL3",88,0)
 S:+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12) ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12),X,DA(1),DA)=""
"RTN","PSAUTL3",89,0)
 Q
"RTN","PSAUTL3",90,0)
KLOCDT ;Kill logic for "ALOC" X-Ref
"RTN","PSAUTL3",91,0)
 K ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5),X,DA(1),DA)
"RTN","PSAUTL3",92,0)
 K ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12),X,DA(1),DA)
"RTN","PSAUTL3",93,0)
 Q
"RTN","PSAVERA2")
0^1^B7312918
"RTN","PSAVERA2",1,0)
PSAVERA2 ;BHM/DB - Edit previously verified invoices #2;21DEC99
"RTN","PSAVERA2",2,0)
 ;;3.0;DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**21,49**; 10/24/97
"RTN","PSAVERA2",3,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAVERA2",4,0)
 ;
"RTN","PSAVERA2",5,0)
ASKDRUG ;Change drug
"RTN","PSAVERA2",6,0)
 S PSAGAIN=0,PSABEFOR=PSADRG,DIC(0)="AEQMZ",DIC="^PSDRUG(" D ^DIC K DIC
"RTN","PSAVERA2",7,0)
 I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVERA2",8,0)
 S PSADJFLD="D",PSAREA="",PSASUPP=0
"RTN","PSAVERA2",9,0)
 I +Y=-1 D  Q:PSASUPP!(PSAOUT)
"RTN","PSAVERA2",10,0)
 .S PSAVER=1 D SUPPLY^PSANDF Q:PSAOUT  I 'PSASUPP S PSAGAIN=1 Q
"RTN","PSAVERA2",11,0)
 .S PSA50IEN=0,PSADJ=PSAREA,PSAREA=""
"RTN","PSAVERA2",12,0)
 .D RECORD
"RTN","PSAVERA2",13,0)
 G:$G(PSAGAIN) ASKDRUG
"RTN","PSAVERA2",14,0)
 S (PSA50IEN,PSADJ,PSADRG)=+Y D RECORD,VERDISP^PSAUTL4
"RTN","PSAVERA2",15,0)
 I PSANDC'="",$O(^PSDRUG("C",PSANDC,PSA50IEN,0)) D
"RTN","PSAVERA2",16,0)
 .S PSASUB=+$O(^PSDRUG("C",PSANDC,PSA50IEN,0)),$P(^PSD(58.811,PSAIEN,1,PSAIEN1,2),"^",3)=PSASUB
"RTN","PSAVERA2",17,0)
 .I '+$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7) D DUOU^PSAVER2 Q
"RTN","PSAVERA2",18,0)
 .I +$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7),+$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7)'=+$P($G(^PSDRUG(PSABEFOR,1,PSASUB,0)),"^",7) D DUOU^PSAVER2
"RTN","PSAVERA2",19,0)
 W !,"Decrementing balance of "_PSABAL_" from "_$P($G(^PSDRUG(PSADRG,0)),"^")
"RTN","PSAVERA2",20,0)
 W !,"Increasing balance of "_PSANEWD_" by "_PSABAL_"."
"RTN","PSAVERA2",21,0)
 Q
"RTN","PSAVERA2",22,0)
 W !!,"Note that if you change the drug on this line item, the balances will be",!,"updated."
"RTN","PSAVERA2",23,0)
LOCATION ;Change pharmacy location
"RTN","PSAVERA2",24,0)
 W !,"If the location is changed, the balances will be decremented from the original",!,"location, the transaction file will record the proper changes.",!
"RTN","PSAVERA2",25,0)
LST ;List all data associated with location/drug
"RTN","PSAVERA2",26,0)
 ;get data from 58.8 & 58.81
"RTN","PSAVERA2",27,0)
 ;Show allsysnonym data from drug file.
"RTN","PSAVERA2",28,0)
RECORD ;Add adjusted data to DA Orders file
"RTN","PSAVERA2",29,0)
 K PSASUBB
"RTN","PSAVERA2",30,0)
 W !,"ok, we'll update the files now at RECORD"
"RTN","PSAVERA2",31,0)
 S PSABFR=0 F  S PSABFR=$O(^PSDRUG(PSABEFOR,1,PSABFR)) Q:PSABFR=$G(PSASUB)  Q:PSABFR'>0  S PSASUBB=PSABFR
"RTN","PSAVERA2",32,0)
 I $G(PSASUBB) S PREVDATA=$G(^PSDRUG(PSABEFOR,1,PSASUBB,0)) D
"RTN","PSAVERA2",33,0)
 .W !,"Will update old drug data with previous synonym data of : ",!,?20,PREVDATA
"RTN","PSAVERA2",34,0)
 I '$G(PSASUBB) W !,"Could not find previous sysnonym data, therefore the prices will remain as",!,"they are.",!
"VER")
8.0^22
**END**
**END**
