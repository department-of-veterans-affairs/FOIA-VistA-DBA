KIDS Distribution saved on Jun 10, 2005@15:57:49
DYNAMED IFCAP INTERFACE PATCH - PROCUREMENT AND FINANCIAL CODE
**KIDS**:PRC*5.1*81^

**INSTALL NAME**
PRC*5.1*81
"BLD",5978,0)
PRC*5.1*81^IFCAP^0^3050610^y
"BLD",5978,1,0)
^^2^2^3050609^
"BLD",5978,1,1,0)
This patch contains the software required to run the DynaMed-IFCAP 
"BLD",5978,1,2,0)
Interface.
"BLD",5978,4,0)
^9.64PA^411^8
"BLD",5978,4,410,0)
410
"BLD",5978,4,410,2,0)
^9.641^410^2
"BLD",5978,4,410,2,410,0)
CONTROL POINT ACTIVITY  (File-top level)
"BLD",5978,4,410,2,410,1,0)
^9.6411^455^1
"BLD",5978,4,410,2,410,1,455,0)
ISSUE BOOK BATCH ID
"BLD",5978,4,410,2,410.02,0)
ITEM  (sub-file)
"BLD",5978,4,410,2,410.02,1,0)
^9.6411^18^3
"BLD",5978,4,410,2,410.02,1,.01,0)
LINE ITEM NUMBER
"BLD",5978,4,410,2,410.02,1,17,0)
DM DOC ID
"BLD",5978,4,410,2,410.02,1,18,0)
DATE NEEDED BY
"BLD",5978,4,410,222)
y^n^p^^^^n^^n
"BLD",5978,4,410,224)

"BLD",5978,4,410.3,0)
410.3
"BLD",5978,4,410.3,2,0)
^9.641^410.3^2
"BLD",5978,4,410.3,2,410.3,0)
REPETITIVE ITEM LIST  (File-top level)
"BLD",5978,4,410.3,2,410.3,1,0)
^9.6411^8^1
"BLD",5978,4,410.3,2,410.3,1,8,0)
DATE/TIME IN DM
"BLD",5978,4,410.3,2,410.31,0)
ITEM  (sub-file)
"BLD",5978,4,410.3,2,410.31,1,0)
^9.6411^7^2
"BLD",5978,4,410.3,2,410.31,1,6,0)
DM DOC ID
"BLD",5978,4,410.3,2,410.31,1,7,0)
DATE NEEDED BY
"BLD",5978,4,410.3,222)
y^n^p^^^^n^^n
"BLD",5978,4,410.3,224)

"BLD",5978,4,411,0)
411
"BLD",5978,4,411,2,0)
^9.641^411^1
"BLD",5978,4,411,2,411,0)
ADMIN. ACTIVITY SITE PARAMETER  (File-top level)
"BLD",5978,4,411,2,411,1,0)
^9.6411^107^2
"BLD",5978,4,411,2,411,1,106,0)
FCP MONITOR STATUS
"BLD",5978,4,411,2,411,1,107,0)
FCP MONITOR RUNNING?
"BLD",5978,4,411,222)
y^n^p^^^^n^^n
"BLD",5978,4,411,224)

"BLD",5978,4,414.02,0)
414.02
"BLD",5978,4,414.02,222)
y^y^f^^^^n
"BLD",5978,4,414.03,0)
414.03
"BLD",5978,4,414.03,222)
y^y^f^^^^n
"BLD",5978,4,414.04,0)
414.04
"BLD",5978,4,414.04,222)
y^y^f^^^^n
"BLD",5978,4,441,0)
441
"BLD",5978,4,441,2,0)
^9.641^441^1
"BLD",5978,4,441,2,441,0)
ITEM MASTER  (File-top level)
"BLD",5978,4,441,2,441,1,0)
^9.6411^.01^1
"BLD",5978,4,441,2,441,1,.01,0)
NUMBER
"BLD",5978,4,441,222)
y^y^p^^^^n^^n
"BLD",5978,4,441,224)

"BLD",5978,4,442,0)
442
"BLD",5978,4,442,2,0)
^9.641^442.01^1
"BLD",5978,4,442,2,442.01,0)
ITEM  (sub-file)
"BLD",5978,4,442,2,442.01,1,0)
^9.6411^48^2
"BLD",5978,4,442,2,442.01,1,.01,0)
LINE ITEM NUMBER
"BLD",5978,4,442,2,442.01,1,48,0)
DM DOC ID
"BLD",5978,4,442,222)
y^n^p^^^^n^^n
"BLD",5978,4,442,224)

"BLD",5978,4,"APDD",410,410)

"BLD",5978,4,"APDD",410,410,455)

"BLD",5978,4,"APDD",410,410.02)

"BLD",5978,4,"APDD",410,410.02,.01)

"BLD",5978,4,"APDD",410,410.02,17)

"BLD",5978,4,"APDD",410,410.02,18)

"BLD",5978,4,"APDD",410.3,410.3)

"BLD",5978,4,"APDD",410.3,410.3,8)

"BLD",5978,4,"APDD",410.3,410.31)

"BLD",5978,4,"APDD",410.3,410.31,6)

"BLD",5978,4,"APDD",410.3,410.31,7)

"BLD",5978,4,"APDD",411,411)

"BLD",5978,4,"APDD",411,411,106)

"BLD",5978,4,"APDD",411,411,107)

"BLD",5978,4,"APDD",441,441)

"BLD",5978,4,"APDD",441,441,.01)

"BLD",5978,4,"APDD",442,442.01)

"BLD",5978,4,"APDD",442,442.01,.01)

"BLD",5978,4,"APDD",442,442.01,48)

"BLD",5978,4,"B",410,410)

"BLD",5978,4,"B",410.3,410.3)

"BLD",5978,4,"B",411,411)

"BLD",5978,4,"B",414.02,414.02)

"BLD",5978,4,"B",414.03,414.03)

"BLD",5978,4,"B",414.04,414.04)

"BLD",5978,4,"B",441,441)

"BLD",5978,4,"B",442,442)

"BLD",5978,"ABNS",0)
^9.66A^^
"BLD",5978,"ABPKG")
n^n
"BLD",5978,"INID")
^y
"BLD",5978,"INIT")
INIT^PRC5181P
"BLD",5978,"KRN",0)
^9.67PA^8989.52^19
"BLD",5978,"KRN",.4,0)
.4
"BLD",5978,"KRN",.4,"NM",0)
^9.68A^2^2
"BLD",5978,"KRN",.4,"NM",1,0)
PRCV DYNAMED RIL'S NEED ACTION    FILE #414.02^414.02^0
"BLD",5978,"KRN",.4,"NM",2,0)
PRCV ITEM DISPLAY    FILE #441^441^0
"BLD",5978,"KRN",.4,"NM","B","PRCV DYNAMED RIL'S NEED ACTION    FILE #414.02",1)

"BLD",5978,"KRN",.4,"NM","B","PRCV ITEM DISPLAY    FILE #441",2)

"BLD",5978,"KRN",.401,0)
.401
"BLD",5978,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",5978,"KRN",.401,"NM",1,0)
PRCV DYNAMED RIL'S NEED ACTION    FILE #414.02^414.02^0
"BLD",5978,"KRN",.401,"NM","B","PRCV DYNAMED RIL'S NEED ACTION    FILE #414.02",1)

"BLD",5978,"KRN",.402,0)
.402
"BLD",5978,"KRN",.402,"NM",0)
^9.68A^^
"BLD",5978,"KRN",.403,0)
.403
"BLD",5978,"KRN",.5,0)
.5
"BLD",5978,"KRN",.84,0)
.84
"BLD",5978,"KRN",3.6,0)
3.6
"BLD",5978,"KRN",3.6,"NM",0)
^9.68A^2^1
"BLD",5978,"KRN",3.6,"NM",2,0)
PRCV_AUDIT_FILE_ERROR^^0
"BLD",5978,"KRN",3.6,"NM","B","PRCV_AUDIT_FILE_ERROR",2)

"BLD",5978,"KRN",3.8,0)
3.8
"BLD",5978,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",5978,"KRN",3.8,"NM",1,0)
PRCV Item Vendor Edits^^0
"BLD",5978,"KRN",3.8,"NM",2,0)
PRCV Audit File Alerts^^0
"BLD",5978,"KRN",3.8,"NM","B","PRCV Audit File Alerts",2)

"BLD",5978,"KRN",3.8,"NM","B","PRCV Item Vendor Edits",1)

"BLD",5978,"KRN",9.2,0)
9.2
"BLD",5978,"KRN",9.8,0)
9.8
"BLD",5978,"KRN",9.8,"NM",0)
^9.68A^70^64
"BLD",5978,"KRN",9.8,"NM",1,0)
PRCV442A^^0^B47663562
"BLD",5978,"KRN",9.8,"NM",2,0)
PRCV442B^^0^B43908570
"BLD",5978,"KRN",9.8,"NM",3,0)
PRCVEE1^^0^B20166309
"BLD",5978,"KRN",9.8,"NM",4,0)
PRCVEE5^^0^B25590315
"BLD",5978,"KRN",9.8,"NM",7,0)
PRCVIMF^^0^B80508200
"BLD",5978,"KRN",9.8,"NM",8,0)
PRCVIT^^0^B41941579
"BLD",5978,"KRN",9.8,"NM",9,0)
PRCVLIC^^0^B43540999
"BLD",5978,"KRN",9.8,"NM",10,0)
PRCVNDR^^0^B28317964
"BLD",5978,"KRN",9.8,"NM",11,0)
PRCVPOSD^^0^B45217896
"BLD",5978,"KRN",9.8,"NM",12,0)
PRCVPOU^^0^B15199812
"BLD",5978,"KRN",9.8,"NM",13,0)
PRCVRC1^^0^B52536625
"BLD",5978,"KRN",9.8,"NM",14,0)
PRCVRC2^^0^B34815057
"BLD",5978,"KRN",9.8,"NM",15,0)
PRCVRC3^^0^B3469680
"BLD",5978,"KRN",9.8,"NM",16,0)
PRCVRCA^^0^B44922155
"BLD",5978,"KRN",9.8,"NM",17,0)
PRCVRE1^^0^B52433723
"BLD",5978,"KRN",9.8,"NM",18,0)
PRCVREA^^0^B24071162
"BLD",5978,"KRN",9.8,"NM",19,0)
PRCVRRA^^0^B2717769
"BLD",5978,"KRN",9.8,"NM",20,0)
PRCVTAP^^0^B39101448
"BLD",5978,"KRN",9.8,"NM",21,0)
PRCVTCA^^0^B47773479
"BLD",5978,"KRN",9.8,"NM",22,0)
PRCVUTSC^^0^B5336042
"BLD",5978,"KRN",9.8,"NM",23,0)
PRCVVMF^^0^B45911893
"BLD",5978,"KRN",9.8,"NM",24,0)
PRCH442^^0^B40109640
"BLD",5978,"KRN",9.8,"NM",25,0)
PRCH442A^^0^B63170859
"BLD",5978,"KRN",9.8,"NM",26,0)
PRCHEA^^0^B21455506
"BLD",5978,"KRN",9.8,"NM",27,0)
PRCHNPO4^^0^B57782504
"BLD",5978,"KRN",9.8,"NM",28,0)
PRCHSP1^^0^B40484764
"BLD",5978,"KRN",9.8,"NM",29,0)
PRCHREC^^0^B41539701
"BLD",5978,"KRN",9.8,"NM",30,0)
PRCHREC2^^0^B21606846
"BLD",5978,"KRN",9.8,"NM",31,0)
PRCFFMOM^^0^B80432218
"BLD",5978,"KRN",9.8,"NM",32,0)
PRCFFM2M^^0^B10213072
"BLD",5978,"KRN",9.8,"NM",33,0)
PRCHAM^^0^B33017257
"BLD",5978,"KRN",9.8,"NM",34,0)
PRCSEA^^0^B66774225
"BLD",5978,"KRN",9.8,"NM",35,0)
PRCSEB^^0^B17751549
"BLD",5978,"KRN",9.8,"NM",36,0)
PRCSEB0^^0^B22631602
"BLD",5978,"KRN",9.8,"NM",37,0)
PRCSECP^^0^B28160184
"BLD",5978,"KRN",9.8,"NM",38,0)
PRCSCPY^^0^B47455501
"BLD",5978,"KRN",9.8,"NM",39,0)
PRCHG^^0^B23118352
"BLD",5978,"KRN",9.8,"NM",40,0)
PRCSRIP^^0^B16688208
"BLD",5978,"KRN",9.8,"NM",41,0)
PRCSD121^^0^B22790968
"BLD",5978,"KRN",9.8,"NM",42,0)
PRCSP121^^0^B21901481
"BLD",5978,"KRN",9.8,"NM",43,0)
PRCSRIG2^^0^B42383043
"BLD",5978,"KRN",9.8,"NM",44,0)
PRCSRIE1^^0^B23990379
"BLD",5978,"KRN",9.8,"NM",45,0)
PRCSCK^^0^B58904514
"BLD",5978,"KRN",9.8,"NM",46,0)
PRCSAPP2^^0^B18964515
"BLD",5978,"KRN",9.8,"NM",47,0)
PRCHE1^^0^B23958557
"BLD",5978,"KRN",9.8,"NM",48,0)
PRCHEA1^^0^B23232021
"BLD",5978,"KRN",9.8,"NM",49,0)
PRCFAC3^^0^B19663832
"BLD",5978,"KRN",9.8,"NM",50,0)
PRCORV1^^0^B20500579
"BLD",5978,"KRN",9.8,"NM",51,0)
PRCOVUP^^0^B13130960
"BLD",5978,"KRN",9.8,"NM",52,0)
PRCSRIG1^^0^B18018274
"BLD",5978,"KRN",9.8,"NM",53,0)
PRCVITMU^^0^B7776696
"BLD",5978,"KRN",9.8,"NM",54,0)
PRCHE^^0^B42437164
"BLD",5978,"KRN",9.8,"NM",59,0)
PRC5181P^^0^B1467848
"BLD",5978,"KRN",9.8,"NM",60,0)
PRCVBLD^^0^B8594669
"BLD",5978,"KRN",9.8,"NM",61,0)
PRCVMON^^0^B73356601
"BLD",5978,"KRN",9.8,"NM",62,0)
PRCVRCG^^0^B50930241
"BLD",5978,"KRN",9.8,"NM",63,0)
PRCVSUB^^0^B4207049
"BLD",5978,"KRN",9.8,"NM",64,0)
PRCVINIT^^0^B3517241
"BLD",5978,"KRN",9.8,"NM",65,0)
PRCPSFIV^^0^B27039826
"BLD",5978,"KRN",9.8,"NM",66,0)
PRCPSFSV^^0^B13681700
"BLD",5978,"KRN",9.8,"NM",67,0)
PRCVFMS1^^0^B5222023
"BLD",5978,"KRN",9.8,"NM",68,0)
PRCVFMS2^^0^B3988824
"BLD",5978,"KRN",9.8,"NM",69,0)
PRCVIBF^^0^B39152455
"BLD",5978,"KRN",9.8,"NM",70,0)
PRCVIBH^^0^B96641654
"BLD",5978,"KRN",9.8,"NM","B","PRC5181P",59)

"BLD",5978,"KRN",9.8,"NM","B","PRCFAC3",49)

"BLD",5978,"KRN",9.8,"NM","B","PRCFFM2M",32)

"BLD",5978,"KRN",9.8,"NM","B","PRCFFMOM",31)

"BLD",5978,"KRN",9.8,"NM","B","PRCH442",24)

"BLD",5978,"KRN",9.8,"NM","B","PRCH442A",25)

"BLD",5978,"KRN",9.8,"NM","B","PRCHAM",33)

"BLD",5978,"KRN",9.8,"NM","B","PRCHE",54)

"BLD",5978,"KRN",9.8,"NM","B","PRCHE1",47)

"BLD",5978,"KRN",9.8,"NM","B","PRCHEA",26)

"BLD",5978,"KRN",9.8,"NM","B","PRCHEA1",48)

"BLD",5978,"KRN",9.8,"NM","B","PRCHG",39)

"BLD",5978,"KRN",9.8,"NM","B","PRCHNPO4",27)

"BLD",5978,"KRN",9.8,"NM","B","PRCHREC",29)

"BLD",5978,"KRN",9.8,"NM","B","PRCHREC2",30)

"BLD",5978,"KRN",9.8,"NM","B","PRCHSP1",28)

"BLD",5978,"KRN",9.8,"NM","B","PRCORV1",50)

"BLD",5978,"KRN",9.8,"NM","B","PRCOVUP",51)

"BLD",5978,"KRN",9.8,"NM","B","PRCPSFIV",65)

"BLD",5978,"KRN",9.8,"NM","B","PRCPSFSV",66)

"BLD",5978,"KRN",9.8,"NM","B","PRCSAPP2",46)

"BLD",5978,"KRN",9.8,"NM","B","PRCSCK",45)

"BLD",5978,"KRN",9.8,"NM","B","PRCSCPY",38)

"BLD",5978,"KRN",9.8,"NM","B","PRCSD121",41)

"BLD",5978,"KRN",9.8,"NM","B","PRCSEA",34)

"BLD",5978,"KRN",9.8,"NM","B","PRCSEB",35)

"BLD",5978,"KRN",9.8,"NM","B","PRCSEB0",36)

"BLD",5978,"KRN",9.8,"NM","B","PRCSECP",37)

"BLD",5978,"KRN",9.8,"NM","B","PRCSP121",42)

"BLD",5978,"KRN",9.8,"NM","B","PRCSRIE1",44)

"BLD",5978,"KRN",9.8,"NM","B","PRCSRIG1",52)

"BLD",5978,"KRN",9.8,"NM","B","PRCSRIG2",43)

"BLD",5978,"KRN",9.8,"NM","B","PRCSRIP",40)

"BLD",5978,"KRN",9.8,"NM","B","PRCV442A",1)

"BLD",5978,"KRN",9.8,"NM","B","PRCV442B",2)

"BLD",5978,"KRN",9.8,"NM","B","PRCVBLD",60)

"BLD",5978,"KRN",9.8,"NM","B","PRCVEE1",3)

"BLD",5978,"KRN",9.8,"NM","B","PRCVEE5",4)

"BLD",5978,"KRN",9.8,"NM","B","PRCVFMS1",67)

"BLD",5978,"KRN",9.8,"NM","B","PRCVFMS2",68)

"BLD",5978,"KRN",9.8,"NM","B","PRCVIBF",69)

"BLD",5978,"KRN",9.8,"NM","B","PRCVIBH",70)

"BLD",5978,"KRN",9.8,"NM","B","PRCVIMF",7)

"BLD",5978,"KRN",9.8,"NM","B","PRCVINIT",64)

"BLD",5978,"KRN",9.8,"NM","B","PRCVIT",8)

"BLD",5978,"KRN",9.8,"NM","B","PRCVITMU",53)

"BLD",5978,"KRN",9.8,"NM","B","PRCVLIC",9)

"BLD",5978,"KRN",9.8,"NM","B","PRCVMON",61)

"BLD",5978,"KRN",9.8,"NM","B","PRCVNDR",10)

"BLD",5978,"KRN",9.8,"NM","B","PRCVPOSD",11)

"BLD",5978,"KRN",9.8,"NM","B","PRCVPOU",12)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRC1",13)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRC2",14)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRC3",15)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRCA",16)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRCG",62)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRE1",17)

"BLD",5978,"KRN",9.8,"NM","B","PRCVREA",18)

"BLD",5978,"KRN",9.8,"NM","B","PRCVRRA",19)

"BLD",5978,"KRN",9.8,"NM","B","PRCVSUB",63)

"BLD",5978,"KRN",9.8,"NM","B","PRCVTAP",20)

"BLD",5978,"KRN",9.8,"NM","B","PRCVTCA",21)

"BLD",5978,"KRN",9.8,"NM","B","PRCVUTSC",22)

"BLD",5978,"KRN",9.8,"NM","B","PRCVVMF",23)

"BLD",5978,"KRN",19,0)
19
"BLD",5978,"KRN",19,"NM",0)
^9.68A^5^4
"BLD",5978,"KRN",19,"NM",1,0)
PRCV ITEM UPDATE TO DYNAMED^^0
"BLD",5978,"KRN",19,"NM",2,0)
PRCV VENDOR UPDATE TO DYNAMED^^0
"BLD",5978,"KRN",19,"NM",4,0)
PRCV DYNAMED RIL'S NEED ACTION^^0
"BLD",5978,"KRN",19,"NM",5,0)
PRCV ITEM DISPLAY WITH VENDOR#^^0
"BLD",5978,"KRN",19,"NM","B","PRCV DYNAMED RIL'S NEED ACTION",4)

"BLD",5978,"KRN",19,"NM","B","PRCV ITEM DISPLAY WITH VENDOR#",5)

"BLD",5978,"KRN",19,"NM","B","PRCV ITEM UPDATE TO DYNAMED",1)

"BLD",5978,"KRN",19,"NM","B","PRCV VENDOR UPDATE TO DYNAMED",2)

"BLD",5978,"KRN",19.1,0)
19.1
"BLD",5978,"KRN",101,0)
101
"BLD",5978,"KRN",101,"NM",0)
^9.68A^22^22
"BLD",5978,"KRN",101,"NM",1,0)
PRCV 410 2237 LINE ITEM CANCEL^^0
"BLD",5978,"KRN",101,"NM",2,0)
PRCV 442 ITEM DELETE^^0
"BLD",5978,"KRN",101,"NM",3,0)
PRCV_DYNAMED_01_EV_REQUISITION_SEND^^0
"BLD",5978,"KRN",101,"NM",4,0)
PRCV_DYNAMED_01_SU_REQUISITION_SEND^^0
"BLD",5978,"KRN",101,"NM",5,0)
PRCV_IFCAP_01_EV_DYNAMED_UPDATE^^0
"BLD",5978,"KRN",101,"NM",6,0)
PRCV_IFCAP_01_SU_DYNAMED_UPDATE^^0
"BLD",5978,"KRN",101,"NM",7,0)
PRCV_IFCAP_02_EV_OBL/AMEND^^0
"BLD",5978,"KRN",101,"NM",8,0)
PRCV_IFCAP_02_SU_OBL/AMEND^^0
"BLD",5978,"KRN",101,"NM",9,0)
PRCV_IFCAP_03_EV_REC/ADJ^^0
"BLD",5978,"KRN",101,"NM",10,0)
PRCV_IFCAP_03_SU_REC/ADJ^^0
"BLD",5978,"KRN",101,"NM",11,0)
PRCV_IFCAP_05_EV_ITEM_UPD^^0
"BLD",5978,"KRN",101,"NM",12,0)
PRCV_IFCAP_05_SU_ITEM_UPD^^0
"BLD",5978,"KRN",101,"NM",13,0)
PRCV_IFCAP_04_EV_VEND_UPD^^0
"BLD",5978,"KRN",101,"NM",14,0)
PRCV_IFCAP_04_SU_VEND_UPD^^0
"BLD",5978,"KRN",101,"NM",15,0)
PRCV_DYNAMED_20_EV_FUND_BAL_SUBSCRIBE^^0
"BLD",5978,"KRN",101,"NM",16,0)
PRCV_DYNAMED_20_SU_FUND_BAL_SUBSCRIBE^^0
"BLD",5978,"KRN",101,"NM",17,0)
PRCV_DYNAMED_21_EV_FUND_BAL_CANCEL_SUB^^0
"BLD",5978,"KRN",101,"NM",18,0)
PRCV_DYNAMED_21_SU_FUND_BAL_CANCEL_SUB^^0
"BLD",5978,"KRN",101,"NM",19,0)
PRCV_DYNAMED_22_EV_FUND_BAL_DATA^^0
"BLD",5978,"KRN",101,"NM",20,0)
PRCV_DYNAMED_22_SU_FUND_BAL_DATA^^0
"BLD",5978,"KRN",101,"NM",21,0)
PRCV_IFCAP_06_EV_IB_PROC^^0
"BLD",5978,"KRN",101,"NM",22,0)
PRCV_IFCAP_06_SU_IB_PROC^^0
"BLD",5978,"KRN",101,"NM","B","PRCV 410 2237 LINE ITEM CANCEL",1)

"BLD",5978,"KRN",101,"NM","B","PRCV 442 ITEM DELETE",2)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_01_EV_REQUISITION_SEND",3)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_01_SU_REQUISITION_SEND",4)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_20_EV_FUND_BAL_SUBSCRIBE",15)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_20_SU_FUND_BAL_SUBSCRIBE",16)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_21_EV_FUND_BAL_CANCEL_SUB",17)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_21_SU_FUND_BAL_CANCEL_SUB",18)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_22_EV_FUND_BAL_DATA",19)

"BLD",5978,"KRN",101,"NM","B","PRCV_DYNAMED_22_SU_FUND_BAL_DATA",20)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_01_EV_DYNAMED_UPDATE",5)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_01_SU_DYNAMED_UPDATE",6)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_02_EV_OBL/AMEND",7)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_02_SU_OBL/AMEND",8)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_03_EV_REC/ADJ",9)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_03_SU_REC/ADJ",10)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_04_EV_VEND_UPD",13)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_04_SU_VEND_UPD",14)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_05_EV_ITEM_UPD",11)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_05_SU_ITEM_UPD",12)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_06_EV_IB_PROC",21)

"BLD",5978,"KRN",101,"NM","B","PRCV_IFCAP_06_SU_IB_PROC",22)

"BLD",5978,"KRN",409.61,0)
409.61
"BLD",5978,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5978,"KRN",771,0)
771
"BLD",5978,"KRN",771,"NM",0)
^9.68A^16^11
"BLD",5978,"KRN",771,"NM",1,0)
PRCV_DYNAMED^^0
"BLD",5978,"KRN",771,"NM",3,0)
PRCV_IFCAP_2237^^0
"BLD",5978,"KRN",771,"NM",7,0)
PRCV_IFCAP_IT^^0
"BLD",5978,"KRN",771,"NM",9,0)
PRCV_IFCAP_PO^^0
"BLD",5978,"KRN",771,"NM",10,0)
PRCV_IFCAP_RECV^^0
"BLD",5978,"KRN",771,"NM",11,0)
PRCV_IFCAP_REQ^^0
"BLD",5978,"KRN",771,"NM",12,0)
PRCV_IFCAP_VEN^^0
"BLD",5978,"KRN",771,"NM",13,0)
PRCV_IFCAP_FBAL^^0
"BLD",5978,"KRN",771,"NM",14,0)
PRCV_IFCAP_FCAN^^0
"BLD",5978,"KRN",771,"NM",15,0)
PRCV_IFCAP_FSUB^^0
"BLD",5978,"KRN",771,"NM",16,0)
PRCV_IFCAP_IVSV^^0
"BLD",5978,"KRN",771,"NM","B","PRCV_DYNAMED",1)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_2237",3)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_FBAL",13)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_FCAN",14)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_FSUB",15)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_IT",7)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_IVSV",16)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_PO",9)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_RECV",10)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_REQ",11)

"BLD",5978,"KRN",771,"NM","B","PRCV_IFCAP_VEN",12)

"BLD",5978,"KRN",870,0)
870
"BLD",5978,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",5978,"KRN",870,"NM",1,0)
PRCVDYNA^^0
"BLD",5978,"KRN",870,"NM","B","PRCVDYNA",1)

"BLD",5978,"KRN",8989.51,0)
8989.51
"BLD",5978,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",5978,"KRN",8989.51,"NM",1,0)
PRCV COTS INVENTORY^^0
"BLD",5978,"KRN",8989.51,"NM","B","PRCV COTS INVENTORY",1)

"BLD",5978,"KRN",8989.52,0)
8989.52
"BLD",5978,"KRN",8994,0)
8994
"BLD",5978,"KRN","B",.4,.4)

"BLD",5978,"KRN","B",.401,.401)

"BLD",5978,"KRN","B",.402,.402)

"BLD",5978,"KRN","B",.403,.403)

"BLD",5978,"KRN","B",.5,.5)

"BLD",5978,"KRN","B",.84,.84)

"BLD",5978,"KRN","B",3.6,3.6)

"BLD",5978,"KRN","B",3.8,3.8)

"BLD",5978,"KRN","B",9.2,9.2)

"BLD",5978,"KRN","B",9.8,9.8)

"BLD",5978,"KRN","B",19,19)

"BLD",5978,"KRN","B",19.1,19.1)

"BLD",5978,"KRN","B",101,101)

"BLD",5978,"KRN","B",409.61,409.61)

"BLD",5978,"KRN","B",771,771)

"BLD",5978,"KRN","B",870,870)

"BLD",5978,"KRN","B",8989.51,8989.51)

"BLD",5978,"KRN","B",8989.52,8989.52)

"BLD",5978,"KRN","B",8994,8994)

"BLD",5978,"PRET")

"BLD",5978,"QUES",0)
^9.62^^
"BLD",5978,"REQB",0)
^9.611^16^15
"BLD",5978,"REQB",1,0)
PRC*5.1*1^1
"BLD",5978,"REQB",2,0)
PRC*5.1*7^1
"BLD",5978,"REQB",4,0)
PRC*5.1*13^1
"BLD",5978,"REQB",5,0)
PRC*5.1*14^1
"BLD",5978,"REQB",6,0)
PRC*5.1*22^1
"BLD",5978,"REQB",7,0)
PRC*5.1*26^1
"BLD",5978,"REQB",8,0)
PRC*5.1*28^1
"BLD",5978,"REQB",9,0)
PRC*5.1*35^1
"BLD",5978,"REQB",10,0)
PRC*5.1*38^1
"BLD",5978,"REQB",11,0)
PRC*5.1*39^1
"BLD",5978,"REQB",12,0)
PRC*5.1*51^1
"BLD",5978,"REQB",13,0)
PRC*5.1*55^1
"BLD",5978,"REQB",14,0)
PRC*5.1*56^1
"BLD",5978,"REQB",15,0)
PRC*5.1*57^1
"BLD",5978,"REQB",16,0)
PRC*5.1*70^1
"BLD",5978,"REQB","B","PRC*5.1*1",1)

"BLD",5978,"REQB","B","PRC*5.1*13",4)

"BLD",5978,"REQB","B","PRC*5.1*14",5)

"BLD",5978,"REQB","B","PRC*5.1*22",6)

"BLD",5978,"REQB","B","PRC*5.1*26",7)

"BLD",5978,"REQB","B","PRC*5.1*28",8)

"BLD",5978,"REQB","B","PRC*5.1*35",9)

"BLD",5978,"REQB","B","PRC*5.1*38",10)

"BLD",5978,"REQB","B","PRC*5.1*39",11)

"BLD",5978,"REQB","B","PRC*5.1*51",12)

"BLD",5978,"REQB","B","PRC*5.1*55",13)

"BLD",5978,"REQB","B","PRC*5.1*56",14)

"BLD",5978,"REQB","B","PRC*5.1*57",15)

"BLD",5978,"REQB","B","PRC*5.1*7",2)

"BLD",5978,"REQB","B","PRC*5.1*70",16)

"FIA",410)
CONTROL POINT ACTIVITY
"FIA",410,0)
^PRCS(410,
"FIA",410,0,0)
410I
"FIA",410,0,1)
y^n^p^^^^n^^n
"FIA",410,0,10)

"FIA",410,0,11)

"FIA",410,0,"RLRO")

"FIA",410,0,"VR")
5.1^PRC
"FIA",410,410)
1
"FIA",410,410,10)

"FIA",410,410,455)

"FIA",410,410.02)
1
"FIA",410,410.02,.01)

"FIA",410,410.02,17)

"FIA",410,410.02,18)

"FIA",410.3)
REPETITIVE ITEM LIST
"FIA",410.3,0)
^PRCS(410.3,
"FIA",410.3,0,0)
410.3I
"FIA",410.3,0,1)
y^n^p^^^^n^^n
"FIA",410.3,0,10)

"FIA",410.3,0,11)

"FIA",410.3,0,"RLRO")

"FIA",410.3,0,"VR")
5.1^PRC
"FIA",410.3,410.3)
1
"FIA",410.3,410.3,8)

"FIA",410.3,410.31)
1
"FIA",410.3,410.31,6)

"FIA",410.3,410.31,7)

"FIA",411)
ADMIN. ACTIVITY SITE PARAMETER
"FIA",411,0)
^PRC(411,
"FIA",411,0,0)
411I
"FIA",411,0,1)
y^n^p^^^^n^^n
"FIA",411,0,10)

"FIA",411,0,11)

"FIA",411,0,"RLRO")

"FIA",411,0,"VR")
5.1^PRC
"FIA",411,411)
1
"FIA",411,411,106)

"FIA",411,411,107)

"FIA",414.02)
DYNAMED IFCAP INTERFACE AUDIT
"FIA",414.02,0)
^PRCV(414.02,
"FIA",414.02,0,0)
414.02
"FIA",414.02,0,1)
y^y^f^^^^n
"FIA",414.02,0,10)

"FIA",414.02,0,11)

"FIA",414.02,0,"RLRO")

"FIA",414.02,0,"VR")
5.1^PRC
"FIA",414.02,414.02)
0
"FIA",414.02,414.021)
0
"FIA",414.03)
COTS INVENTORY SUBSCRIPTION CONTROL
"FIA",414.03,0)
^PRCV(414.03,
"FIA",414.03,0,0)
414.03P
"FIA",414.03,0,1)
y^y^f^^^^n
"FIA",414.03,0,10)

"FIA",414.03,0,11)

"FIA",414.03,0,"RLRO")

"FIA",414.03,0,"VR")
5.1^PRC
"FIA",414.03,414.03)
0
"FIA",414.03,414.031)
0
"FIA",414.03,414.0311)
0
"FIA",414.04)
RECORD CHECKSUM
"FIA",414.04,0)
^PRCV(414.04,
"FIA",414.04,0,0)
414.04
"FIA",414.04,0,1)
y^y^f^^^^n
"FIA",414.04,0,10)

"FIA",414.04,0,11)

"FIA",414.04,0,"RLRO")

"FIA",414.04,0,"VR")
5.1^PRC
"FIA",414.04,414.04)
0
"FIA",414.04,414.41)
0
"FIA",441)
ITEM MASTER
"FIA",441,0)
^PRC(441,
"FIA",441,0,0)
441Is
"FIA",441,0,1)
y^y^p^^^^n^^n
"FIA",441,0,10)

"FIA",441,0,11)

"FIA",441,0,"RLRO")

"FIA",441,0,"VR")
5.1^PRC
"FIA",441,441)
1
"FIA",441,441,.01)

"FIA",442)
PROCUREMENT & ACCOUNTING TRANSACTIONS
"FIA",442,0)
^PRC(442,
"FIA",442,0,0)
442I
"FIA",442,0,1)
y^n^p^^^^n^^n
"FIA",442,0,10)

"FIA",442,0,11)

"FIA",442,0,"RLRO")

"FIA",442,0,"VR")
5.1^PRC
"FIA",442,442)
1
"FIA",442,442,40)

"FIA",442,442.01)
1
"FIA",442,442.01,.01)

"FIA",442,442.01,48)

"INIT")
INIT^PRC5181P
"IX",410,410.02,"AH",0)
410.02^AH^generate update message to DynaMed for 2237 line item cancel^MU^^R^IR^I^410.02^^^^^A
"IX",410,410.02,"AH",.1,0)
^^2^2^3050215^
"IX",410,410.02,"AH",.1,1,0)
check for deletion action, check that DM Doc ID field (17) has data, then 
"IX",410,410.02,"AH",.1,2,0)
call PRCVLIC to build update message for DynaMed in ^XTMP
"IX",410,410.02,"AH",1)
Q
"IX",410,410.02,"AH",2)
D EN^PRCVLIC
"IX",410,410.02,"AH",2.4)
S X=(X2=""&($P($G(^PRCS(410,DA(1),"IT",DA,4)),"^",1)]""))
"IX",410,410.02,"AH",11.1,0)
^.114IA^9^9
"IX",410,410.02,"AH",11.1,1,0)
1^F^410.02^.01^^^F
"IX",410,410.02,"AH",11.1,2,0)
2^F^410.02^2^^^F
"IX",410,410.02,"AH",11.1,3,0)
3^F^410.02^3^^^F
"IX",410,410.02,"AH",11.1,4,0)
4^F^410.02^4^^^F
"IX",410,410.02,"AH",11.1,5,0)
5^F^410.02^5^^^F
"IX",410,410.02,"AH",11.1,6,0)
6^F^410.02^6^^^F
"IX",410,410.02,"AH",11.1,7,0)
7^F^410.02^7^^^F
"IX",410,410.02,"AH",11.1,8,0)
8^F^410.02^17^^^F
"IX",410,410.02,"AH",11.1,9,0)
9^F^410.02^18^^^F
"IX",414.02,414.02,"B",0)
414.02^B^Uniqueness Index for Key 'A' of File #414.02^R^^F^IR^I^414.02^^^^^LS
"IX",414.02,414.02,"B",1)
S ^PRCV(414.02,"B",X,DA)=""
"IX",414.02,414.02,"B",2)
K ^PRCV(414.02,"B",X,DA)
"IX",414.02,414.02,"B",2.5)
K ^PRCV(414.02,"B")
"IX",414.02,414.02,"B",11.1,0)
^.114IA^1^1
"IX",414.02,414.02,"B",11.1,1,0)
1^F^414.02^.01^^1
"IX",414.03,414.03,"C",0)
414.03^C^Uniqueness Index for Key 'A' of File #414.03^R^^R^IR^I^414.03^^^^^LS
"IX",414.03,414.03,"C",1)
S ^PRCV(414.03,"C",X(1),X(2),X(3),DA)=""
"IX",414.03,414.03,"C",2)
K ^PRCV(414.03,"C",X(1),X(2),X(3),DA)
"IX",414.03,414.03,"C",2.5)
K ^PRCV(414.03,"C")
"IX",414.03,414.03,"C",11.1,0)
^.114IA^3^3
"IX",414.03,414.03,"C",11.1,1,0)
1^F^414.03^.01^^1
"IX",414.03,414.03,"C",11.1,2,0)
2^F^414.03^.02^^2
"IX",414.03,414.03,"C",11.1,3,0)
3^F^414.03^.03^^3
"IX",414.04,414.04,"C",0)
414.04^C^Uniqueness Index for Key 'A' of File #414.04^R^^R^IR^I^414.04^^^^^LS
"IX",414.04,414.04,"C",1)
S ^PRCV(414.04,"C",X(1),X(2),X(3),DA)=""
"IX",414.04,414.04,"C",2)
K ^PRCV(414.04,"C",X(1),X(2),X(3),DA)
"IX",414.04,414.04,"C",2.5)
K ^PRCV(414.04,"C")
"IX",414.04,414.04,"C",11.1,0)
^.114IA^3^3
"IX",414.04,414.04,"C",11.1,1,0)
1^F^414.04^.01^^1
"IX",414.04,414.04,"C",11.1,2,0)
2^F^414.04^.02^^2
"IX",414.04,414.04,"C",11.1,3,0)
3^F^414.04^.03^^3
"IX",441,441,"AFREE",0)
441^AFREE^KEEPS TRACK OF "FREE RANGES"^MU^^F^IR^I^441^^^^^A
"IX",441,441,"AFREE",.1,0)
^^2^2^3050413^
"IX",441,441,"AFREE",.1,1,0)
This cross-reference is used to keep track of ranges of unused item 
"IX",441,441,"AFREE",.1,2,0)
numbers. Each entry in the index corresponds to a free range.
"IX",441,441,"AFREE",1)
D SET^PRCVITMU
"IX",441,441,"AFREE",1.4)

"IX",441,441,"AFREE",2)
D KILL^PRCVITMU
"IX",441,441,"AFREE",2.4)

"IX",441,441,"AFREE",2.5)
K ^PRC(441,"AFREE") S ^PRC(441,"AFREE",1,999999)=""
"IX",441,441,"AFREE",11.1,0)
^.114IA^1^1
"IX",441,441,"AFREE",11.1,1,0)
1^F^441^.01^30^^F
"IX",442,442.01,"AK",0)
442.01^AK^SET UP TRANSACTION FILE TO DYNAMED IF FIELD IS KILLED^MU^^R^IR^I^442.01^^^^^A
"IX",442,442.01,"AK",1)
Q
"IX",442,442.01,"AK",2)
D DELITEM^PRCV442B(D0)
"IX",442,442.01,"AK",2.4)
S X=(X2(1)=""&($P($G(^PRC(442,D0,2,D1,2)),"^",15)]""))
"IX",442,442.01,"AK",11.1,0)
^.114IA^8^8
"IX",442,442.01,"AK",11.1,1,0)
1^F^442.01^.01^^^F
"IX",442,442.01,"AK",11.1,2,0)
2^F^442.01^48^^^F
"IX",442,442.01,"AK",11.1,3,0)
3^F^442.01^1.5^^^F
"IX",442,442.01,"AK",11.1,4,0)
4^F^442.01^2^^^F
"IX",442,442.01,"AK",11.1,5,0)
5^F^442.01^3^^^F
"IX",442,442.01,"AK",11.1,6,0)
6^F^442.01^3.1^^^F
"IX",442,442.01,"AK",11.1,7,0)
7^F^442.01^5^^^F
"IX",442,442.01,"AK",11.1,8,0)
8^F^442.01^10^^^F
"KEY",414.02,414.02,"A",0)
414.02^A^P^454
"KEY",414.02,414.02,"A",2,0)
^.312IA^1^1
"KEY",414.02,414.02,"A",2,1,0)
.01^414.02^1
"KEY",414.03,414.03,"A",0)
414.03^A^P^456
"KEY",414.03,414.03,"A",2,0)
^.312IA^3^3
"KEY",414.03,414.03,"A",2,1,0)
.01^414.03^1
"KEY",414.03,414.03,"A",2,2,0)
.02^414.03^2
"KEY",414.03,414.03,"A",2,3,0)
.03^414.03^3
"KEY",414.04,414.04,"A",0)
414.04^A^P^452
"KEY",414.04,414.04,"A",2,0)
^.312IA^3^3
"KEY",414.04,414.04,"A",2,1,0)
.01^414.04^1
"KEY",414.04,414.04,"A",2,2,0)
.02^414.04^2
"KEY",414.04,414.04,"A",2,3,0)
.03^414.04^3
"KEYPTR",414.02,414.02,"A")
414.02^B
"KEYPTR",414.03,414.03,"A")
414.03^C
"KEYPTR",414.04,414.04,"A")
414.04^C
"KRN",.4,7476,-1)
0^1
"KRN",.4,7476,0)
PRCV DYNAMED RIL'S NEED ACTION^3050513.1052^^414.02^^@^3050609
"KRN",.4,7476,"F",2)
4~13~2~1~12~
"KRN",.4,7476,"H")
DYNAMED IFCAP INTERFACE AUDIT SEARCH
"KRN",.4,7478,-1)
0^2
"KRN",.4,7478,0)
PRCV ITEM DISPLAY^3050526.1505^@^441^^@^3050603
"KRN",.4,7478,"DXS",1,9.2)
S DIP(1)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(1),U,4),X=X S X=X>0,DIP(2)=$G(X) S X="(",DIP(3)=$G(X) S X=$P(DIP(1),U,4),X=X S Y=X,X=DIP(3),X=X S X=X
"KRN",.4,7478,"DXS",2,9.2)
S DIP(1)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(1),U,8),X=X S X=X>0,DIP(2)=$G(X) S X="(",DIP(3)=$G(X) S X=$P(DIP(1),U,8),X=X S Y=X,X=DIP(3),X=X S X=X
"KRN",.4,7478,"DXS",3,9.2)
S DIP(1)=$S($D(^PRC(441,D0,4,D1,0)):^(0),1:"") S X=$P(DIP(1),U,3),X=X S X=X>0,DIP(2)=$G(X) S X="(",DIP(3)=$G(X) S X=$P(DIP(1),U,3)
"KRN",.4,7478,"DXS",4,9.2)
S DIP(1)=$S($D(^PRC(441,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S X=X>0,DIP(2)=$G(X) S X="(",DIP(3)=$G(X) S X=$P(DIP(1),U,1)
"KRN",.4,7478,"F",1)
"NUMBER: ";C1;""~0;X;""~"NIF ITEM NUMBER: ";C40;""~51;X;""~"SHORT DESCRIPTION: ";C1;""~.05;X;""~"DESCRIPTION: ";C1;""~.1,.01;C5;""~
"KRN",.4,7478,"F",2)
"MFG PART NO.: ";C1;""~19;X;""~"BOC: ";C1;""~12;X;""~"FSC: ";C1;""~2;X;""~"NSN: ";C40;""~5;X;""~"LAST VENDOR ORDERED: ";C1;""~
"KRN",.4,7478,"F",3)
X DXS(1,9.2) S X=X_Y_") ",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X) W X K DIP;X;"";Z;"$S(INTERNAL(#9)>0:"("_INTERNAL(#9)_") ",1:"")"~
"KRN",.4,7478,"F",4)
9;X;""~"MANDATORY SOURCE: ";C1;""~
"KRN",.4,7478,"F",5)
X DXS(2,9.2) S X=X_Y_") ",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X) W X K DIP;X;"";Z;"$S(INTERNAL(#10)>0:"("_INTERNAL(#10)_") ",1:"")"~
"KRN",.4,7478,"F",6)
10;X;""~1,"FCP: ";C1;""~
"KRN",.4,7478,"F",7)
1,S DIP(1)=$S($D(^PRC(441,D0,4,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=1,DIP(3)=$G(X) S X=3,X=$E(DIP(2),DIP(3),X) W X K DIP;X;"";Z;"$E(#.01,1,3)"~
"KRN",.4,7478,"F",8)
1,":";X;""~
"KRN",.4,7478,"F",9)
1,S DIP(1)=$S($D(^PRC(441,D0,4,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),DIP(2)=$G(X) S X=4,DIP(3)=$G(X) S X=99,X=$E(DIP(2),DIP(3),X) W X K DIP;X;"";Z;"$E(#.01,4,99)"~
"KRN",.4,7478,"F",10)
1,"PREFERRED VENDOR: ";C17;""~
"KRN",.4,7478,"F",11)
1,X DXS(3,9.2) S X=X S Y=X,X=DIP(3),X=X S X=X_Y_") ",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X) W X K DIP;X;"";Z;"$S(INTERNAL(#3)>0:"("_INTERNAL(#3)_") ",1:"")"~
"KRN",.4,7478,"F",12)
1,3;X;""~6,"VENDOR: ";C1;""~
"KRN",.4,7478,"F",13)
6,X DXS(4,9.2) S X=X S Y=X,X=DIP(3),X=X S X=X_Y_") ",DIP(4)=$G(X) S X=1,DIP(5)=$G(X) S X="",X=$S(DIP(2):DIP(4),DIP(5):X) W X K DIP;X;"";Z;"$S(INTERNAL(#.01)>0:"("_INTERNAL(#.01)_") ",1:"")"~
"KRN",.4,7478,"F",14)
6,.01;X;""~6,"UNIT OF PURCHASE: ";C5;""~6,1.5;X;""~6,"UNIT COST: ";C40;X~6,1;X;L13;""~6,"PACKAGING MULTIPLE: ";C5;""~6,1.6;X;L7;""~
"KRN",.4,7478,"F",15)
6,"UNIT CONVERSION FACTOR: ";C40;""~6,10;X;L7;""~6,"VENDOR STOCK #: ";C5;""~6,3;X;""~6,"CONTRACT: ";C40;""~6,2;X;""~
"KRN",.4,7478,"H")
@
"KRN",.4,7478,"SUB")
1
"KRN",.401,103434,-1)
0^1
"KRN",.401,103434,0)
PRCV DYNAMED RIL'S NEED ACTION^3050513.1051^^414.02^^@^3050609
"KRN",.401,103434,2,0)
^.4014^2^2
"KRN",.401,103434,2,1,0)
414.02^6^DATE/TIME CREATED IN DYNAMED^^^^^^^1
"KRN",.401,103434,2,1,"GET")
S DISX(1)=$P($G(^PRCV(414.02,D0,0)),U,7)
"KRN",.401,103434,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,103434,2,1,"SER")
0.0000^0.0000
"KRN",.401,103434,2,1,"TXT")
DATE/TIME CREATED IN DYNAMED not null
"KRN",.401,103434,2,2,0)
414.02^4^RIL#^^^^^^^4
"KRN",.401,103434,2,2,"GET")
S DISX(2)=$P($G(^PRCV(414.02,D0,0)),U,5)
"KRN",.401,103434,2,2,"IX")
^PRCV(414.02,"C",^PRCV(414.02,^2
"KRN",.401,103434,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,103434,2,2,"SER")
0.0000^0.0000
"KRN",.401,103434,2,2,"TXT")
RIL# not null
"KRN",.401,103434,2,"B",414.02,1)

"KRN",.401,103434,2,"B",414.02,2)

"KRN",3.6,263,-1)
0^2
"KRN",3.6,263,0)
PRCV_AUDIT_FILE_ERROR^ERROR WHILE PROCESSING DYNAMED-RELATED DATA ITEM
"KRN",3.6,263,1,0)
^3.61A^11^11^3050314^^
"KRN",3.6,263,1,1,0)
While |1|
"KRN",3.6,263,1,2,0)
involving an item with DynaMed Doc ID #: |2|,
"KRN",3.6,263,1,3,0)
the following error occurred: |3|.
"KRN",3.6,263,1,4,0)
 
"KRN",3.6,263,1,5,0)
The DynaMed DOC ID gets saved into the Audit file when a request is 
"KRN",3.6,263,1,6,0)
received from DynaMed and a RIL is built. This value is the key used
"KRN",3.6,263,1,7,0)
to update Due-ins in Dynamed. Therefore 
"KRN",3.6,263,1,8,0)
 
"KRN",3.6,263,1,9,0)
PLEASE INCLUDE APPROPRIATE DYNAMED USERS WHEN RESOLVING THIS ERROR
"KRN",3.6,263,1,10,0)
 
"KRN",3.6,263,1,11,0)
The following data pertains to this transaction:
"KRN",3.6,263,3,0)
^3.63^5^5^3050314^^^
"KRN",3.6,263,3,1,0)
This bulletin will be used by processes within the IFCAP-DynaMed 
"KRN",3.6,263,3,2,0)
interface software to notify Control Point Officials and Control Point 
"KRN",3.6,263,3,3,0)
Clerks when an error condition occurs.  The error would occur while
"KRN",3.6,263,3,4,0)
processing a DynaMed-originating item in a RIL, a 2237, or a Purchase
"KRN",3.6,263,3,5,0)
Order.
"KRN",3.6,263,4,0)
^3.64A^3^3
"KRN",3.6,263,4,1,0)
1
"KRN",3.6,263,4,1,1,0)
^3.65^2^2^3050314^^
"KRN",3.6,263,4,1,1,1,0)
action/event/identifier ex. "canceling a line item during edit of 2237 
"KRN",3.6,263,4,1,1,2,0)
#516-05-2-076-0445"
"KRN",3.6,263,4,2,0)
2
"KRN",3.6,263,4,2,1,0)
^3.65^1^1^3050314^^
"KRN",3.6,263,4,2,1,1,0)
DM Doc ID value
"KRN",3.6,263,4,3,0)
3
"KRN",3.6,263,4,3,1,0)
^3.65^2^2^3050314^^
"KRN",3.6,263,4,3,1,1,0)
error reason, for example "an error updating the Audit file" or "the 
"KRN",3.6,263,4,3,1,2,0)
Audit file item was missing its DynaMed Doc ID value"
"KRN",3.8,4936,-1)
0^1
"KRN",3.8,4936,0)
PRCV Item Vendor Edits^PU^n^^^^
"KRN",3.8,4936,2,0)
^3.801^3^3^3050419^^
"KRN",3.8,4936,2,1,0)
This mail group will be used to alert staff who maintain the Item Master 
"KRN",3.8,4936,2,2,0)
File and Vendor File when an error occurs during attempts to update the 
"KRN",3.8,4936,2,3,0)
COTS inventory system.
"KRN",3.8,4936,3)

"KRN",3.8,4937,-1)
0^2
"KRN",3.8,4937,0)
PRCV Audit File Alerts^PU^n^^^^
"KRN",3.8,4937,2,0)
^^3^3^3050517^
"KRN",3.8,4937,2,1,0)
This mail group will be used to alert staff of inconsistencies or 
"KRN",3.8,4937,2,2,0)
problems IFCAP finds with the Audit File while processing RILs, 2237s and 
"KRN",3.8,4937,2,3,0)
Purchase Orders.
"KRN",3.8,4937,3)

"KRN",19,17128,-1)
0^1
"KRN",19,17128,0)
PRCV ITEM UPDATE TO DYNAMED^Nightly ITEM master file update to DynaMed^^R^^^^^^^n^IFCAP
"KRN",19,17128,1,0)
^19.06^3^3^3050407^^^^
"KRN",19,17128,1,1,0)
This option is not to be placed on any menu nor run by any user.  This 
"KRN",19,17128,1,2,0)
option is specifically designed to be scheduled in TaskMan to be executed 
"KRN",19,17128,1,3,0)
once a day during off-peak hours.
"KRN",19,17128,25)
NITECHK^PRCVIT
"KRN",19,17128,99)
59976,52316
"KRN",19,17128,200.9)
y
"KRN",19,17128,"U")
NIGHTLY ITEM MASTER FILE UPDAT
"KRN",19,17129,-1)
0^2
"KRN",19,17129,0)
PRCV VENDOR UPDATE TO DYNAMED^NIGHTLY VENDOR MASTER FILE UPDATE TO DYNAMED^^R^^^^^^^n^IFCAP
"KRN",19,17129,1,0)
^19.06^3^3^3050408^^^^
"KRN",19,17129,1,1,0)
This option is not to be placed on any menu nor run by any user.  This 
"KRN",19,17129,1,2,0)
option is specifically designed to be scheduled in TaskMan to be executed 
"KRN",19,17129,1,3,0)
once a day during off-peak hours.
"KRN",19,17129,25)
NITECHK^PRCVNDR
"KRN",19,17129,200.9)
y
"KRN",19,17129,"U")
NIGHTLY VENDOR MASTER FILE UPD
"KRN",19,17131,-1)
0^4
"KRN",19,17131,0)
PRCV DYNAMED RIL'S NEED ACTION^Dynamed RIL's Needing Action^^P^^^^^^^^
"KRN",19,17131,1,0)
^19.06^2^2^3050513^^^
"KRN",19,17131,1,1,0)
Report showing all RIL's created by Dynamed that still need to be acted 
"KRN",19,17131,1,2,0)
upon.
"KRN",19,17131,60)
PRCV(414.02,
"KRN",19,17131,62)
0
"KRN",19,17131,63)
[PRCV DYNAMED RIL'S NEED ACTION]
"KRN",19,17131,64)
[PRCV DYNAMED RIL'S NEED ACTION]
"KRN",19,17131,69)
I $P($G(^PRCV(414.02,D0,0)),U,11)=""&($P($G(^PRCV(414.02,D0,0)),U,8)="")&($P($G(^PRCV(414.02,D0,0)),U,9)="")
"KRN",19,17131,69.1)

"KRN",19,17131,69.2)

"KRN",19,17131,"U")
DYNAMED RIL'S NEEDING ACTION
"KRN",19,17132,-1)
0^5
"KRN",19,17132,0)
PRCV ITEM DISPLAY WITH VENDOR#^DynaMed Item Display with Vendor #^^I^^^^^^^^IFCAP^^^
"KRN",19,17132,1,0)
^^1^1^3050526^
"KRN",19,17132,1,1,0)
This option provides enhanced vendor information on an item display.
"KRN",19,17132,15)

"KRN",19,17132,30)
PRC(441,
"KRN",19,17132,31)
AEMQ
"KRN",19,17132,63)
[PRCV ITEM DISPLAY]
"KRN",19,17132,70)
HOME
"KRN",19,17132,80)
PRC(441,
"KRN",19,17132,"U")
DYNAMED ITEM DISPLAY WITH VEND
"KRN",101,8777,-1)
0^7
"KRN",101,8777,0)
PRCV_IFCAP_02_EV_OBL/AMEND^Sends PO Obligations and Amendments to Inventory System^^E^^^^^^^^
"KRN",101,8777,99)
60033,62415
"KRN",101,8777,770)
PRCV_IFCAP_PO^^ORM^O01^^^^AL^AL^2.4^
"KRN",101,8777,772)
D ORRPROC^PRCVPOSD
"KRN",101,8777,775,0)
^101.0775PA^1^1
"KRN",101,8777,775,1,0)
8778
"KRN",101,8777,775,1,"^")
PRCV_IFCAP_02_SU_OBL/AMEND
"KRN",101,8778,-1)
0^8
"KRN",101,8778,0)
PRCV_IFCAP_02_SU_OBL/AMEND^Receives Obligation and Amendment Responses^^S^^^^^^^^
"KRN",101,8778,99)
60033,62415
"KRN",101,8778,770)
^PRCV_DYNAMED^^O02^^^PRCVDYNA^^^^ORR
"KRN",101,8778,771)
D ORRPROC^PRCVPOSD
"KRN",101,8778,773)
1^1
"KRN",101,8779,-1)
0^2
"KRN",101,8779,0)
PRCV 442 ITEM DELETE^PRCV Delete Item from PO^^A^^^^^^^^
"KRN",101,8779,1,0)
^101.06^3^3^3050211^^
"KRN",101,8779,1,1,0)
This Action protocol is used to compile the values needed to prepare an 
"KRN",101,8779,1,2,0)
HL7 message to DynaMed when the user deleted a line item number record 
"KRN",101,8779,1,3,0)
from a purchase order.
"KRN",101,8779,20)
D DELJOB^PRCV442B
"KRN",101,8779,99)
60033,62415
"KRN",101,8780,-1)
0^9
"KRN",101,8780,0)
PRCV_IFCAP_03_EV_REC/ADJ^Sends Receiving Report and Adjustments to Inventory Stystem^^E^^^^^^^^
"KRN",101,8780,99)
60033,62415
"KRN",101,8780,770)
PRCV_IFCAP_RECV^^ORM^O01^^^^AL^AL^2.4^
"KRN",101,8780,772)
D ORRPROC^PRCVPOSD
"KRN",101,8780,775,0)
^101.0775PA^1^1
"KRN",101,8780,775,1,0)
8781
"KRN",101,8780,775,1,"^")
PRCV_IFCAP_03_SU_REC/ADJ
"KRN",101,8781,-1)
0^10
"KRN",101,8781,0)
PRCV_IFCAP_03_SU_REC/ADJ^Receives R. Report and Adjustment Responses ^^S^^^^^^^^
"KRN",101,8781,99)
60033,62415
"KRN",101,8781,770)
^PRCV_DYNAMED^^O02^^^PRCVDYNA^^^^ORR
"KRN",101,8781,771)
D ORRPROC^PRCVPOSD
"KRN",101,8781,773)
1^1
"KRN",101,8782,-1)
0^5
"KRN",101,8782,0)
PRCV_IFCAP_01_EV_DYNAMED_UPDATE^Update DynaMed due to order changes^^E^^^^^^^^
"KRN",101,8782,1,0)
^^1^1^3050317^
"KRN",101,8782,1,1,0)
Sends message from IFCAP to DynaMed for RIL and 2237
"KRN",101,8782,99)
60025,34294
"KRN",101,8782,770)
PRCV_IFCAP_2237^^OMN^O07^^^^AL^AL^2.4^
"KRN",101,8782,772)
D BEGIN^PRCVEE5
"KRN",101,8782,775,0)
^101.0775PA^1^1
"KRN",101,8782,775,1,0)
8783
"KRN",101,8782,775,1,"^")
PRCV_IFCAP_01_SU_DYNAMED_UPDATE
"KRN",101,8783,-1)
0^6
"KRN",101,8783,0)
PRCV_IFCAP_01_SU_DYNAMED_UPDATE^^^S^^^^^^^^
"KRN",101,8783,770)
^PRCV_DYNAMED^^O08^^^PRCVDYNA^^^^ORN
"KRN",101,8783,771)
D BEGIN^PRCVEE5
"KRN",101,8783,773)
1^1^0
"KRN",101,8784,-1)
0^4
"KRN",101,8784,0)
PRCV_DYNAMED_01_SU_REQUISITION_SEND^DYNAMED SENDS REQ TO IFCAP^^S^^^^^^^^
"KRN",101,8784,1,0)
^101.06^2^2^3050309^^^^
"KRN",101,8784,1,1,0)
This is the receiving side of the submission of a requisition from 
"KRN",101,8784,1,2,0)
DynaMed to IFCAP.  There can be multiple items per message.
"KRN",101,8784,4)
^^^REQUISITION
"KRN",101,8784,20)

"KRN",101,8784,99)
60025,34294
"KRN",101,8784,770)
^PRCV_IFCAP_REQ^^O08^^^PRCVDYNA^^^^ORN
"KRN",101,8784,771)
D BEGIN^PRCVRE1
"KRN",101,8784,773)
1^1^0
"KRN",101,8785,-1)
0^3
"KRN",101,8785,0)
PRCV_DYNAMED_01_EV_REQUISITION_SEND^RECEIVE REQUISITION FROM DYNAMED^^E^^^^^^^^
"KRN",101,8785,1,0)
^101.06^1^1^3050317^^^^
"KRN",101,8785,1,1,0)
This sends the requisition from DynaMed to IFCAP.
"KRN",101,8785,4)
^^^INVENTORY
"KRN",101,8785,99)
60025,34294
"KRN",101,8785,770)
PRCV_DYNAMED^^OMN^O07^^^^AL^AL^2.4^
"KRN",101,8785,775,0)
^101.0775PA^1^1
"KRN",101,8785,775,1,0)
8784
"KRN",101,8785,775,1,"^")
PRCV_DYNAMED_01_SU_REQUISITION_SEND
"KRN",101,8786,-1)
0^1
"KRN",101,8786,0)
PRCV 410 2237 LINE ITEM CANCEL^PRCV Cancel Line Item From 2237^^A^^^^^^^^
"KRN",101,8786,1,0)
^101.06^4^4^3050217^^
"KRN",101,8786,1,1,0)
This protocol is called when a user, while editing a 2237, deletes a line 
"KRN",101,8786,1,2,0)
item from that 2237.  The protocol calls code that gathers values used to 
"KRN",101,8786,1,3,0)
create an HL7 message for DynaMed notifying that system of the user's 
"KRN",101,8786,1,4,0)
action.
"KRN",101,8786,20)
D CREATEM^PRCVLIC
"KRN",101,8786,99)
60025,34294
"KRN",101,8787,-1)
0^11
"KRN",101,8787,0)
PRCV_IFCAP_05_EV_ITEM_UPD^Sends Item Updates to Inventory System^^E^^^^^^^^
"KRN",101,8787,99)
60038,57824
"KRN",101,8787,770)
PRCV_IFCAP_IT^^MFN^M01^^^^AL^AL^2.4^
"KRN",101,8787,772)
D MFKPROC^PRCVIMF
"KRN",101,8787,775,0)
^101.0775PA^1^1
"KRN",101,8787,775,1,0)
8788
"KRN",101,8787,775,1,"^")
PRCV_IFCAP_05_SU_ITEM_UPD
"KRN",101,8788,-1)
0^12
"KRN",101,8788,0)
PRCV_IFCAP_05_SU_ITEM_UPD^Receives Item Update Responses^^S^^^^^^^^
"KRN",101,8788,99)
60038,57824
"KRN",101,8788,770)
^PRCV_DYNAMED^^M01^^^PRCVDYNA^^^^MFK
"KRN",101,8788,771)
D MFKPROC^PRCVIMF
"KRN",101,8788,773)
1^1
"KRN",101,8789,-1)
0^13
"KRN",101,8789,0)
PRCV_IFCAP_04_EV_VEND_UPD^Sends Vendor Updates to Inventory System^^E^^^^^^^^
"KRN",101,8789,99)
60058,59350
"KRN",101,8789,770)
PRCV_IFCAP_VEN^^MFN^M01^^^^AL^AL^2.4^
"KRN",101,8789,772)
D MFKPROC^PRCVVMF
"KRN",101,8789,775,0)
^101.0775PA^1^1
"KRN",101,8789,775,1,0)
8790
"KRN",101,8789,775,1,"^")
PRCV_IFCAP_04_SU_VEND_UPD
"KRN",101,8790,-1)
0^14
"KRN",101,8790,0)
PRCV_IFCAP_04_SU_VEND_UPD^Receives Vendor Update Responses^^S^^^^^^^^
"KRN",101,8790,99)
60058,59350
"KRN",101,8790,770)
^PRCV_DYNAMED^^M01^^^PRCVDYNA^^^^MFK
"KRN",101,8790,771)

"KRN",101,8790,773)
1^1
"KRN",101,8791,-1)
0^15
"KRN",101,8791,0)
PRCV_DYNAMED_20_EV_FUND_BAL_SUBSCRIBE^Fund Balance Subscribe (EV)^^E^^^^^^^^
"KRN",101,8791,99)
60045,62096
"KRN",101,8791,770)
PRCV_DYNAMED^^QSB^Q16^^^^AL^AL^2.4^
"KRN",101,8791,775,0)
^101.0775PA^1^1
"KRN",101,8791,775,1,0)
8792
"KRN",101,8791,775,1,"^")
PRCV_DYNAMED_20_SU_FUND_BAL_SUBSCRIBE
"KRN",101,8792,-1)
0^16
"KRN",101,8792,0)
PRCV_DYNAMED_20_SU_FUND_BAL_SUBSCRIBE^Fund Balance Subscribe (SU)^^S^^^^^^^^
"KRN",101,8792,99)
60045,62096
"KRN",101,8792,770)
^PRCV_IFCAP_FSUB^^Q16^^^PRCVDYNA^^^^ACK
"KRN",101,8792,771)
D SUB^PRCVRCG(1)
"KRN",101,8792,773)
1^1^0
"KRN",101,8793,-1)
0^17
"KRN",101,8793,0)
PRCV_DYNAMED_21_EV_FUND_BAL_CANCEL_SUB^Fund Balance Cancel Subscription (EV)^^E^^^^^^^^
"KRN",101,8793,99)
60045,62096
"KRN",101,8793,770)
PRCV_DYNAMED^^QCN^J02^^^^AL^AL^2.4^
"KRN",101,8793,775,0)
^101.0775PA^1^1
"KRN",101,8793,775,1,0)
8794
"KRN",101,8793,775,1,"^")
PRCV_DYNAMED_21_SU_FUND_BAL_CANCEL_SUB
"KRN",101,8794,-1)
0^18
"KRN",101,8794,0)
PRCV_DYNAMED_21_SU_FUND_BAL_CANCEL_SUB^Fund Balance Cancel Subscription (SU)^^S^^^^^^^^
"KRN",101,8794,99)
60045,62096
"KRN",101,8794,770)
^PRCV_IFCAP_FCAN^^J02^^^PRCVDYNA^^^^ACK
"KRN",101,8794,771)
D SUB^PRCVRCG(2)
"KRN",101,8794,773)
1^1^0
"KRN",101,8795,-1)
0^19
"KRN",101,8795,0)
PRCV_DYNAMED_22_EV_FUND_BAL_DATA^Fund Balance Publish (EV)^^E^^^^^^^^
"KRN",101,8795,99)
60045,62096
"KRN",101,8795,770)
PRCV_IFCAP_FBAL^^MFN^M01^^^^AL^AL^2.4^
"KRN",101,8795,772)
D PUBACK^PRCVRCG
"KRN",101,8795,775,0)
^101.0775PA^1^1
"KRN",101,8795,775,1,0)
8796
"KRN",101,8795,775,1,"^")
PRCV_DYNAMED_22_SU_FUND_BAL_DATA
"KRN",101,8796,-1)
0^20
"KRN",101,8796,0)
PRCV_DYNAMED_22_SU_FUND_BAL_DATA^Fund Balance Publish (SU)^^S^^^^^^^^
"KRN",101,8796,99)
60045,62096
"KRN",101,8796,770)
^PRCV_DYNAMED^^M01^^^PRCVDYNA^^^^MFK
"KRN",101,8796,771)

"KRN",101,8796,773)
1^1^0
"KRN",101,8797,-1)
0^21
"KRN",101,8797,0)
PRCV_IFCAP_06_EV_IB_PROC^Sends Issue Book transaction processing responses^^E^^^^^^^^
"KRN",101,8797,99)
60059,58967
"KRN",101,8797,770)
PRCV_DYNAMED^^DFT^P03^^^^AL^AL^2.4^
"KRN",101,8797,773)
1^1
"KRN",101,8797,775,0)
^101.0775PA^1^1
"KRN",101,8797,775,1,0)
8798
"KRN",101,8797,775,1,"^")
PRCV_IFCAP_06_SU_IB_PROC
"KRN",101,8798,-1)
0^22
"KRN",101,8798,0)
PRCV_IFCAP_06_SU_IB_PROC^Receive/Process IV/SV data from DynaMed^^S^^^^^^^^
"KRN",101,8798,99)
60059,58967
"KRN",101,8798,770)
^PRCV_IFCAP_IVSV^^P03^^^PRCVDYNA^^^^ACK
"KRN",101,8798,771)
D CRT^PRCVIBH
"KRN",101,8798,773)
1^1
"KRN",771,201,-1)
0^1
"KRN",771,201,0)
PRCV_DYNAMED^a^^^^^USA
"KRN",771,201,"EC")
^~\&
"KRN",771,201,"FS")
|
"KRN",771,202,-1)
0^11
"KRN",771,202,0)
PRCV_IFCAP_REQ^a^^^^^USA
"KRN",771,202,"EC")
^~\&
"KRN",771,202,"FS")
|
"KRN",771,203,-1)
0^9
"KRN",771,203,0)
PRCV_IFCAP_PO^a^^^^^USA
"KRN",771,203,"EC")
^~\&
"KRN",771,203,"FS")
|
"KRN",771,204,-1)
0^10
"KRN",771,204,0)
PRCV_IFCAP_RECV^a^^^^^USA
"KRN",771,204,"EC")
^~\&
"KRN",771,204,"FS")
|
"KRN",771,205,-1)
0^3
"KRN",771,205,0)
PRCV_IFCAP_2237^a^^^^^USA
"KRN",771,205,"EC")
^~\&
"KRN",771,205,"FS")
|
"KRN",771,206,-1)
0^15
"KRN",771,206,0)
PRCV_IFCAP_FSUB^a^^^^^USA
"KRN",771,206,"EC")
^~\&
"KRN",771,206,"FS")
|
"KRN",771,207,-1)
0^14
"KRN",771,207,0)
PRCV_IFCAP_FCAN^a^^^^^USA
"KRN",771,207,"EC")
^~\&
"KRN",771,207,"FS")
|
"KRN",771,208,-1)
0^13
"KRN",771,208,0)
PRCV_IFCAP_FBAL^a^^^^^USA
"KRN",771,208,"EC")
^~\&
"KRN",771,208,"FS")
|
"KRN",771,209,-1)
0^16
"KRN",771,209,0)
PRCV_IFCAP_IVSV^a^^^^^USA
"KRN",771,209,"EC")
^~\&
"KRN",771,209,"FS")
|
"KRN",771,209,"SEG",0)
^771.05P
"KRN",771,210,-1)
0^12
"KRN",771,210,0)
PRCV_IFCAP_VEN^a^^^^^USA
"KRN",771,210,"EC")
^~\&
"KRN",771,210,"FS")
|
"KRN",771,211,-1)
0^7
"KRN",771,211,0)
PRCV_IFCAP_IT^a^^^^^USA
"KRN",771,211,"EC")
^~\&
"KRN",771,211,"FS")
|
"KRN",870,272,-1)
0^1
"KRN",870,272,0)
PRCVDYNA^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,272,200)
^3^^^^^^^^I
"KRN",870,272,400)
^^C^N^^
"KRN",8989.51,375,-1)
0^1
"KRN",8989.51,375,0)
PRCV COTS INVENTORY^COTS Inventory^0^^0 or 1
"KRN",8989.51,375,1)
S^0:NONE;1:DYNAMED^?/
"KRN",8989.51,375,6)
N
"KRN",8989.51,375,20,0)
^8989.512^6^6^3050418^^^^
"KRN",8989.51,375,20,1,0)
This parameter identifies which COTS product is being utilized for the 
"KRN",8989.51,375,20,2,0)
inventory management system of the site.  The current values are:
"KRN",8989.51,375,20,3,0)
 
"KRN",8989.51,375,20,4,0)
0       NONE - means no COTS product is being used and the inventory 
"KRN",8989.51,375,20,5,0)
management system in use is GIP/IFCAP
"KRN",8989.51,375,20,6,0)
1       DYNAMED - means the DynaMed product is being used
"KRN",8989.51,375,30,0)
^8989.513I^1^1
"KRN",8989.51,375,30,1,0)
1^4.2
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",131,-1)
1^1
"PKG",131,0)
IFCAP^PRC^IFCAP System Files
"PKG",131,20,0)
^9.402P^^
"PKG",131,22,0)
^9.49I^1^1
"PKG",131,22,1,0)
5.1^3001012^3001029^1942
"PKG",131,22,1,"PAH",1,0)
81^3050610
"PKG",131,22,1,"PAH",1,1,0)
^^2^2^3050610
"PKG",131,22,1,"PAH",1,1,1,0)
This patch contains the software required to run the DynaMed-IFCAP 
"PKG",131,22,1,"PAH",1,1,2,0)
Interface.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
64
"RTN","PRC5181P")
0^59^B1467848
"RTN","PRC5181P",1,0)
PRC5181P ;WOIFO/DAP-POST INSTALL TO PRC*5.1*81 ;04/27/05
"RTN","PRC5181P",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRC5181P",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRC5181P",4,0)
 Q
"RTN","PRC5181P",5,0)
 ;
"RTN","PRC5181P",6,0)
INIT ;Entry point for routine which makes a call to EN^XPAR and sets a
"RTN","PRC5181P",7,0)
 ;system level parameter to zero as described in IA #2263.
"RTN","PRC5181P",8,0)
 N PRCVER
"RTN","PRC5181P",9,0)
 D EN^XPAR("SYS","PRCV COTS INVENTORY",1,0,.PRCVER)
"RTN","PRC5181P",10,0)
 I PRCVER=0 D BMES^XPDUTL("Parameter successfully set to zero.") D MES^XPDUTL("POST-INSTALL EXE COMPLETE!")
"RTN","PRC5181P",11,0)
 I PRCVER'=0 D BMES^XPDUTL("The following error was encountered while trying to edit the parameter:") D MES^XPDUTL($P(PRCVER,"^",2))
"RTN","PRC5181P",12,0)
 ;
"RTN","PRC5181P",13,0)
 Q
"RTN","PRCFAC3")
0^49^B19663832
"RTN","PRCFAC3",1,0)
PRCFAC3 ;WISC/CTB/CLH/SJG/AS-ACCOUNTING MODULE ; 3/8/05
"RTN","PRCFAC3",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCFAC3",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCFAC3",4,0)
E10 ; Enter FMS Vendor Code Numbers into Vendor File
"RTN","PRCFAC3",5,0)
 N TAG,PRCF
"RTN","PRCFAC3",6,0)
 D HILO^PRCFQ
"RTN","PRCFAC3",7,0)
 S PRCF("X")="AS" D ^PRCFSITE Q:'%
"RTN","PRCFAC3",8,0)
 D SCREEN
"RTN","PRCFAC3",9,0)
 S PRCFA("FISCVEND")=$P($G(PRC("PARAM")),U,20)
"RTN","PRCFAC3",10,0)
 S TAG=$S(PRCFA("FISCVEND"):"E10B",'PRCFA("FISCVEND"):"E10A") D @TAG
"RTN","PRCFAC3",11,0)
OUT10 K %W,%X,%Y,D0,DA,DIC,DIE,DQ,DR,I,J,K,X,Y,DIRUT
"RTN","PRCFAC3",12,0)
 K PRCTMP,IOINHI,IOINLOW,IOINORM,PRCFA
"RTN","PRCFAC3",13,0)
 QUIT
"RTN","PRCFAC3",14,0)
E10A ; No adding by Fiscal/editing only
"RTN","PRCFAC3",15,0)
 I 'PRCFA("FISCVEND") W !!,"Only Supply may add new Vendors to the Vendor File",!,"but Fiscal may edit payment information.",!!
"RTN","PRCFAC3",16,0)
E10A1 W ! S DIC(0)="AENMQ",DIC=440 D ^DIC Q:Y<0
"RTN","PRCFAC3",17,0)
 I Y>0 S (DA,PRCFA("VEND"))=+Y D INFO K PRCTMP D EDIT^PRCFAC31
"RTN","PRCFAC3",18,0)
 Q:$D(DIRUT)
"RTN","PRCFAC3",19,0)
 I 'Y W !!,"No further action is being taken on this Vendor.",! G E10A1
"RTN","PRCFAC3",20,0)
 D SCREEN
"RTN","PRCFAC3",21,0)
 L +^PRC(440,DA):5 E  W !,$C(7),"Another user is editing this entry!" G E10A1
"RTN","PRCFAC3",22,0)
 K ^PRC(440.3,DA) S %X="^PRC(440,DA,",%Y="^PRC(440.3,DA," D %XY^%RCR
"RTN","PRCFAC3",23,0)
 D WARN
"RTN","PRCFAC3",24,0)
 S DIE=DIC,DR=$S($D(^XUSEC("PRCFA VENDOR EDIT",DUZ)):"[PRCF FMS VENEDIT1B]",1:"[PRCF FMS VENEDIT1]")
"RTN","PRCFAC3",25,0)
 D ^DIE K DIE,DR,ORDER W ! D VEDIT^PRCHE1A(PRCFA("VEND"),PRC("SITE"))
"RTN","PRCFAC3",26,0)
 L -^PRC(440,PRCFA("VEND"))
"RTN","PRCFAC3",27,0)
 ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED   **81**
"RTN","PRCFAC3",28,0)
 D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ONECHK^PRCVNDR(PRCFA("VEND"))
"RTN","PRCFAC3",29,0)
 G E10A1
"RTN","PRCFAC3",30,0)
 QUIT
"RTN","PRCFAC3",31,0)
E10B ; Adding/editing by Fiscal
"RTN","PRCFAC3",32,0)
 I PRCFA("FISCVEND") W !!,"Fiscal may add new Vendors to the Vendor File.",!!
"RTN","PRCFAC3",33,0)
E10B1 W ! S DIC(0)="AENMQL",DLAYGO=440,DIC=440 D ^DIC K DLAYGO Q:Y<0
"RTN","PRCFAC3",34,0)
 I Y>0 S (DA,PRCFA("VEND"))=+Y D INFO K PRCTMP D EDIT^PRCFAC31
"RTN","PRCFAC3",35,0)
 Q:$D(DIRUT)
"RTN","PRCFAC3",36,0)
 I 'Y W !!,"No further action is being taken on this Vendor.",! G E10B1
"RTN","PRCFAC3",37,0)
 D SCREEN
"RTN","PRCFAC3",38,0)
 L +^PRC(440,DA):5 E  W !,$C(7),"Another user is editing this entry!" G E10B1
"RTN","PRCFAC3",39,0)
 K ^PRC(440.3,DA) S %X="^PRC(440,DA,",%Y="^PRC(440.3,DA," D %XY^%RCR
"RTN","PRCFAC3",40,0)
 D WARN
"RTN","PRCFAC3",41,0)
 S DIE=DIC,DR=$S($D(^XUSEC("PRCFA VENDOR EDIT",DUZ)):"[PRCF FMS VENEDIT2B]",1:"[PRCF FMS VENEDIT2]")
"RTN","PRCFAC3",42,0)
 D ^DIE K DIE,DR,ORDER W ! D VEDIT^PRCHE1A(PRCFA("VEND"),PRC("SITE"))
"RTN","PRCFAC3",43,0)
 L -^PRC(440,PRCFA("VEND"))
"RTN","PRCFAC3",44,0)
 ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED   **81**
"RTN","PRCFAC3",45,0)
 D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ONECHK^PRCVNDR(PRCFA("VEND"))
"RTN","PRCFAC3",46,0)
 G E10B1
"RTN","PRCFAC3",47,0)
 QUIT
"RTN","PRCFAC3",48,0)
 ;
"RTN","PRCFAC3",49,0)
E11 ;LOOK VENDOR NUMBER
"RTN","PRCFAC3",50,0)
 D HILO^PRCFQ
"RTN","PRCFAC3",51,0)
 W !,"Select Vendor Name or PO Number: " R X:$S($D(DTIME):DTIME,1:30) G:X="" OUT11
"RTN","PRCFAC3",52,0)
 S X1=X,DIC=440,DIC(0)="EMN" D ^DIC G:X="^" OUT11 I +Y>0 S (PRCFA("VEND"),DA)=+Y D INFO G E11
"RTN","PRCFAC3",53,0)
 S X=X1,DIC=442,DIC(0)="EMN" D ^DIC G:X="?" E11 G:Y<0 E11 S (PRCFA("VEND"),DA)=$P($G(^PRC(442,+Y,1)),U,1) I DA="" W !!?25,$C(7),"No Vendor for this obligation number.",! G E11
"RTN","PRCFAC3",54,0)
 W !,$P(^PRC(440,PRCFA("VEND"),0),"^") D INFO G E11
"RTN","PRCFAC3",55,0)
OUT11 K %,%W,%Y,DA,DIC,I,X,X1,Y
"RTN","PRCFAC3",56,0)
 K PRCTMP,PRCFA,IOINHI,IOINLO,IONORM
"RTN","PRCFAC3",57,0)
 QUIT
"RTN","PRCFAC3",58,0)
 ;
"RTN","PRCFAC3",59,0)
E12 ;;INQUIRE TO CODE SHEET ERROR MESSAGE
"RTN","PRCFAC3",60,0)
 S DIC=421.3,DIC(0)="AEMNQ" D ^DIC I Y>0 S DA=+Y,DR=1 D EN^DIQ G E12
"RTN","PRCFAC3",61,0)
 K %,%Y,A,D0,D1,DA,DIC,DIW,DIWF,DIWL,DIWR,DIWT,DL,DN,DR,DX,I,J,K,S,X,Y Q
"RTN","PRCFAC3",62,0)
E13 ;ADD/EDIT CODE SHEET ERROR MESSAGE
"RTN","PRCFAC3",63,0)
 S DIC="^PRCF(421.3,",DIC(0)="AEMNLQ",DLAYGO=421.3 D ^DIC K DLAYGO I Y>0 S DIE=DIC,DA=+Y,DR=1 D ^DIE W ! G E13
"RTN","PRCFAC3",64,0)
 K %,%DT,D0,DA,DIC,DIE,DQ,DR,DWLW,I,J,X,X1,Y Q
"RTN","PRCFAC3",65,0)
E14 ;INQUIRE TO TRANSMISSION RECORD
"RTN","PRCFAC3",66,0)
 S:'$D(PRCFASYS) PRCFASYS="FEEFENIRSCLI"
"RTN","PRCFAC3",67,0)
 S PRCFASYS=PRCFASYS_"RR"
"RTN","PRCFAC3",68,0)
 S DIC=421.2,DIC(0)="AMENQ",DIC("S")="I PRCFASYS[$P(^(0),""-"",2)" D ^DIC I Y>0 S DA=+Y,DR="0;1" D EN^DIQ G E14
"RTN","PRCFAC3",69,0)
 K %,A,D0,DA,DIC,DL,DR,DRX,DX,S,X,Y Q
"RTN","PRCFAC3",70,0)
INFO ; Get/Print Vendor Payment Information
"RTN","PRCFAC3",71,0)
 I '$D(^PRC(440,PRCFA("VEND"),7)) W !!,$C(7),"No payment information in Vendor File.",!! Q
"RTN","PRCFAC3",72,0)
 S DIR(0)="Y",DIR("A")="Review current payment information on this Vendor",DIR("B")="YES" W ! D ^DIR K DIR
"RTN","PRCFAC3",73,0)
 I 'Y!($D(DIRUT)) Q
"RTN","PRCFAC3",74,0)
 D GET^PRCFAC31(PRCFA("VEND")),DISPLAY^PRCFAC31(PRCFA("VEND"))
"RTN","PRCFAC3",75,0)
 Q
"RTN","PRCFAC3",76,0)
SCREEN ; Control screen display
"RTN","PRCFAC3",77,0)
 I $D(IOF) W @IOF
"RTN","PRCFAC3",78,0)
HDR ; Write Option Header
"RTN","PRCFAC3",79,0)
 I $D(XQY0) W IOINHI,$P(XQY0,U,2),IOINORM,!
"RTN","PRCFAC3",80,0)
 Q
"RTN","PRCFAC3",81,0)
WARN ;WARNING IF PENDING VRQ
"RTN","PRCFAC3",82,0)
 I $P($G(^PRC(440,DA,3)),U,12)="P" W !!,"There is a FMS Vendor Request pending for this vendor.",!,"Any changes you make now may be overwritten when the Vendor",!,"Update is received.",!!
"RTN","PRCFAC3",83,0)
 Q
"RTN","PRCFFM2M")
0^32^B10213072
"RTN","PRCFFM2M",1,0)
PRCFFM2M ;WOIFO/SJG/AS-ROUTINE TO PROCESS OBLIGATIONS ;3/8/05
"RTN","PRCFFM2M",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCFFM2M",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCFFM2M",4,0)
 ;
"RTN","PRCFFM2M",5,0)
SUPP ; Entry point for FMS Documents for Supply Fund Special Control Point
"RTN","PRCFFM2M",6,0)
 ; Amendments
"RTN","PRCFFM2M",7,0)
 ; Called from PRCHMA
"RTN","PRCFFM2M",8,0)
 S DIC("S")="I +^(0)=PRC(""SITE"")",DIC=442,DIC(0)="NZ",X=PRCHPO
"RTN","PRCFFM2M",9,0)
 D ^DIC K DIC G:+Y<0 EXIT
"RTN","PRCFFM2M",10,0)
 S (XRBLD,FLG)=0,PO(0)=Y(0),PO=Y,PRCFA("PODA")=+Y,PCP=+$P(PO(0),"^",3),$P(PCP,"^",2)=$S($D(^PRC(420,PRC("SITE"),1,+PCP,0)):$P(^(0),"^",12),1:"")
"RTN","PRCFFM2M",11,0)
 S MTOP=$P(^PRC(442,PRCFA("PODA"),0),"^",2)
"RTN","PRCFFM2M",12,0)
 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,2)="" W !!,"PURCHASE ORDER HAS NOT BEEN PROPERLY SIGNED BY THE PURCHASING AGENT" Q
"RTN","PRCFFM2M",13,0)
 D DT442^PRCFFUD1(PRCHPO,PO(0),443.6,PRCHAM)
"RTN","PRCFFM2M",14,0)
 ;S PRCFA("OBLDATE")=$$EN^PRCFFUD1() D ENSFM^PRCFFMO2
"RTN","PRCFFM2M",15,0)
 S PRCFA("OBLDATE")=$$DTOBL^PRCFFUD1(PRC("RBDT"),PRC("PODT"))
"RTN","PRCFFM2M",16,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(+PO) ;D BBFYCHK^PRCFFU19(+PO)
"RTN","PRCFFM2M",17,0)
 D GENDIQ^PRCFFU7(442,+PO,".1;.07;.03;17","IEN","")
"RTN","PRCFFM2M",18,0)
 S IDFLAG="I",PRCFA("AMEND#")=PRCHAM
"RTN","PRCFFM2M",19,0)
 N PARAM S PARAM=+PCP_"^"_PRC("FY")_"^"_PRCFA("BBFY")
"RTN","PRCFFM2M",20,0)
 S PRCFMO=$$ACC^PRC0C(PRC("SITE"),PARAM)
"RTN","PRCFFM2M",21,0)
 S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCFFM2M",22,0)
 S PRCFA("DLVDATE")=+$P(^PRC(442,PRCFA("PODA"),0),"^",10)
"RTN","PRCFFM2M",23,0)
 S PRCFA("IDES")="Purchase Order Amendment Obligation"
"RTN","PRCFFM2M",24,0)
 S PRCFA("REF")=$P(PO(0),U),PRCFA("SYS")="FMS"
"RTN","PRCFFM2M",25,0)
 S PRCFA("SFC")=$P(PO(0),U,19),PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCFFM2M",26,0)
 S PRCFA("TT")=$S(PRCFA("MP")=2:"SO",PRCFA("MP")=1:"MO",PRCFA("MP")=8:"MO",1:"MO")
"RTN","PRCFFM2M",27,0)
TRANS ; Transfer amendment entry from work file to Purchase Order file
"RTN","PRCFFM2M",28,0)
 W !!,"...copying amendment information back to Purchase Order file...",! D WAIT^DICD
"RTN","PRCFFM2M",29,0)
 D DT442^PRCFFUD1(PRCFA("PODA"),PO(0),442,"")
"RTN","PRCFFM2M",30,0)
 S PRCOAMT=+^PRC(442,PRCFA("PODA"),0),$P(PRCOAMT,"^",2)=+$P(^(0),"^",3),$P(PRCOAMT,"^",3)=PRC("FYQDT"),$P(PRCOAMT,"^",5)=-$P(^(0),"^",$P(PRCFMO,"^",12)="N"+15)
"RTN","PRCFFM2M",31,0)
 S ERFLAG=""
"RTN","PRCFFM2M",32,0)
 D CHECK^PRCHAMYA(PRCFA("PODA"),PRCFA("AMEND#"),.ERFLAG)
"RTN","PRCFFM2M",33,0)
 I ERFLAG W !!,"...ERROR IN COPYING AMENDMENT INFORMATION BACK TO PURCHASE ORDER FILE..." D MSG G EXIT
"RTN","PRCFFM2M",34,0)
 D DT442^PRCFFUD1(PRCFA("PODA"),PO(0),442,PRCFA("AMEND#"))
"RTN","PRCFFM2M",35,0)
 ;  transmit amendment from IFCAP to DynaMed   **81**
"RTN","PRCFFM2M",36,0)
 D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ENT^PRCVPOU(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFM2M",37,0)
 S PRCFA("OLDPODA")=PRCFA("PODA"),PRCFA("OLDREF")=PRCFA("REF")
"RTN","PRCFFM2M",38,0)
 N PARAM S PARAM="^"_PRC("SITE")_"^"_+PCP_"^"_PRC("FY")_"^"_PRCFA("BBFY")
"RTN","PRCFFM2M",39,0)
 D DOCREQ^PRC0C(PARAM,"SPE","PRCFMO")
"RTN","PRCFFM2M",40,0)
 S (PRCFA("G/N"),PRCFMO("G/N"))=$P(PRCFMO,U,12)
"RTN","PRCFFM2M",41,0)
 D LIST^PRCFFU7(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFM2M",42,0)
 I MTOP'=25,$P($G(^PRC(442,PRCFA("PODA"),0)),U,19)=2,$G(PRCFA("AUTHE"))=1 D AMEND^PRCFFUD,FCP^PRCFFU11 G EXIT
"RTN","PRCFFM2M",43,0)
 I MTOP'=25,'PRCFA("MOMREQ") D MSG^PRCFFU8 G EXIT
"RTN","PRCFFM2M",44,0)
 D AMEND^PRCFFUD
"RTN","PRCFFM2M",45,0)
 I MTOP'=25 D STACK^PRCFFM1M
"RTN","PRCFFM2M",46,0)
 D EXIT QUIT
"RTN","PRCFFM2M",47,0)
MSG W ! S X="No further processing is being taken on this obligation.*" D MSG^PRCFQ
"RTN","PRCFFM2M",48,0)
 Q
"RTN","PRCFFM2M",49,0)
EXIT K %,AMT,C1,C,D0,DA,DI,DIC,DEL,E,I,J,N1,N2,POP,PO,PODA,PRCFA,PRCFQ,MTOP
"RTN","PRCFFM2M",50,0)
 K PTYPE,T,T1,TIME,TRDA,Y,Z,Z5,ZX
"RTN","PRCFFM2M",51,0)
 K PODATE,P,MO,GECSFMS
"RTN","PRCFFM2M",52,0)
 Q
"RTN","PRCFFMOM")
0^31^B80432218
"RTN","PRCFFMOM",1,0)
PRCFFMOM ;WOIFO/SJG/AS-ROUTINE TO PROCESS AMENDMENT OBLIGATIONS ;3/8/05
"RTN","PRCFFMOM",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCFFMOM",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCFFMOM",4,0)
 D ^PRCFSITE Q:'%  ; ask station
"RTN","PRCFFMOM",5,0)
 D OUT1 ; kill variables
"RTN","PRCFFMOM",6,0)
 ;
"RTN","PRCFFMOM",7,0)
 ; prompt for signature (E-Sig code for amendment)
"RTN","PRCFFMOM",8,0)
 S MESSAGE=""
"RTN","PRCFFMOM",9,0)
 D ESIG^PRCUESIG(DUZ,.MESSAGE)
"RTN","PRCFFMOM",10,0)
 I MESSAGE<1 D  G OUT1 ; exit if bad response
"RTN","PRCFFMOM",11,0)
 . I (MESSAGE=0)!(MESSAGE=-3) W !,$C(7),"  SIGNATURE CODE FAILURE " R X:3 ;3 TRIES or NO SIG ON FILE
"RTN","PRCFFMOM",12,0)
 . I (MESSAGE=-1)!(MESSAGE=-2) Q  ;ARROWED OUT or TIMED OUT
"RTN","PRCFFMOM",13,0)
 ;
"RTN","PRCFFMOM",14,0)
START ; get PO#
"RTN","PRCFFMOM",15,0)
 K PRCFA
"RTN","PRCFFMOM",16,0)
 K DIC("A")
"RTN","PRCFFMOM",17,0)
 S D="E"
"RTN","PRCFFMOM",18,0)
 S DIC=443.6
"RTN","PRCFFMOM",19,0)
 S DIC("S")="I +^(0)=PRC(""SITE"") S FSO=$O(^PRC(443.6,""D"",+Y,0)) I FSO=26!(FSO=31)!(FSO=36)!(FSO=45)!(FSO=71)"
"RTN","PRCFFMOM",20,0)
 S DIC("A")="Select Purchase Order Number: "
"RTN","PRCFFMOM",21,0)
 S DIC(0)="AEQZ"
"RTN","PRCFFMOM",22,0)
 D IX^DIC
"RTN","PRCFFMOM",23,0)
 K DIC("S"),DIC("A")
"RTN","PRCFFMOM",24,0)
 K FSO
"RTN","PRCFFMOM",25,0)
 G:+Y<0 OUT1
"RTN","PRCFFMOM",26,0)
 S FLG=0
"RTN","PRCFFMOM",27,0)
 S PO=Y,PO(0)=Y(0)
"RTN","PRCFFMOM",28,0)
 S PRCFA("PODA")=+Y
"RTN","PRCFFMOM",29,0)
 S PRCFPODA=+Y
"RTN","PRCFFMOM",30,0)
 I '$D(^PRC(443.6,+PO,6)) D NOA G OUT1 ; PO has no amendments
"RTN","PRCFFMOM",31,0)
 I $P(^PRC(443.6,+PO,6,0),"^",4)<0 D NOA G OUT1 ; PO has no amendments
"RTN","PRCFFMOM",32,0)
 I '$$VERIFY^PRCHES5(PRCFPODA) D MSG1 G OUT1 ; tampered PO
"RTN","PRCFFMOM",33,0)
 ;
"RTN","PRCFFMOM",34,0)
 ; get amendment #
"RTN","PRCFFMOM",35,0)
AMEND S DIC="^PRC(443.6,"_+PO_",6,"
"RTN","PRCFFMOM",36,0)
 S DIC("A")="Select AMENDMENT: "
"RTN","PRCFFMOM",37,0)
 S DIC(0)="AEMNZQ"
"RTN","PRCFFMOM",38,0)
 D ^DIC
"RTN","PRCFFMOM",39,0)
 K DIC("A")
"RTN","PRCFFMOM",40,0)
 G:Y<0 OUT1
"RTN","PRCFFMOM",41,0)
 S PO(6)=Y(0)
"RTN","PRCFFMOM",42,0)
 S PO(6,1)=^PRC(443.6,+PO,6,+Y,1)
"RTN","PRCFFMOM",43,0)
 S PRCFA("AMEND#")=+Y
"RTN","PRCFFMOM",44,0)
 S PRCFAA=+Y
"RTN","PRCFFMOM",45,0)
 ;
"RTN","PRCFFMOM",46,0)
DESC ; verify amendment is complete
"RTN","PRCFFMOM",47,0)
 I $$CHKAMEN^PRCFFU(+PO,PRCFAA) W !,?15,"Return Amendment to A&MM.",! G START
"RTN","PRCFFMOM",48,0)
 I $P($G(PO(6,1)),U,2)="" D  G START
"RTN","PRCFFMOM",49,0)
 . W ! D EN^DDIOL("This amendment is still awaiting signature by A&MM!")
"RTN","PRCFFMOM",50,0)
 . W !
"RTN","PRCFFMOM",51,0)
 ;
"RTN","PRCFFMOM",52,0)
 ; set up variables used in this option
"RTN","PRCFFMOM",53,0)
 S PRCFA("RETRAN")=0
"RTN","PRCFFMOM",54,0)
 S D0=+PO
"RTN","PRCFFMOM",55,0)
 S D1=+Y
"RTN","PRCFFMOM",56,0)
 S PRCHPO=PRCFPODA
"RTN","PRCFFMOM",57,0)
 S PRCHAM=PRCFAA
"RTN","PRCFFMOM",58,0)
 D ^PRCHSF3 ; sets up PRCH("AM") array
"RTN","PRCFFMOM",59,0)
 D ^PRCHDAM ; display amendment info
"RTN","PRCFFMOM",60,0)
 D DT442^PRCFFUD1(PRCFPODA,PO(0),443.6,PRCFA("AMEND#")) ; set up PRC array
"RTN","PRCFFMOM",61,0)
RETRAN    ; Entry point for rebuild/transmit
"RTN","PRCFFMOM",62,0)
 S PRCFA("MOD")="M^1^Modification Entry"
"RTN","PRCFFMOM",63,0)
 ;
"RTN","PRCFFMOM",64,0)
 ; check amendment record for availability
"RTN","PRCFFMOM",65,0)
 L +^PRC(443.6,PRCFPODA):1
"RTN","PRCFFMOM",66,0)
 I $T=0 D  G OUT1
"RTN","PRCFFMOM",67,0)
 . W $C(7),!
"RTN","PRCFFMOM",68,0)
 . D EN^DDIOL("This amendment is being obligated by another user!")
"RTN","PRCFFMOM",69,0)
 ;
"RTN","PRCFFMOM",70,0)
 I 'PRCFA("RETRAN"),$O(^PRC(443.6,PRCFPODA,6,PRCFAA,3,"AC",32,0)) N P2237 S P2237=$P(^PRC(443.6,PRCFPODA,0),U,12) I P2237>0 I '$$VERIFY^PRCSC2(P2237) D MSG1 G OUT1 ; tampered PO
"RTN","PRCFFMOM",71,0)
 ;
"RTN","PRCFFMOM",72,0)
 I PRCFA("RETRAN") D DT442^PRCFFUD1(PRCFPODA,PO(0),442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",73,0)
 ;
"RTN","PRCFFMOM",74,0)
 I $G(PRCRGS)<1 D OVCOM^PRCFFU10 I PRCFA("OVCOM")=1!(PRCFA("OVCOM")=2) D POFAIL^PRCFFU10,MSG G OUT1
"RTN","PRCFFMOM",75,0)
 ;
"RTN","PRCFFMOM",76,0)
 S PCP=+$P(PO(0),U,3)
"RTN","PRCFFMOM",77,0)
 S $P(PCP,U,2)=$S($D(^PRC(420,PRC("SITE"),1,+PCP,0)):$P(^(0),U,12),1:"")
"RTN","PRCFFMOM",78,0)
APP W !
"RTN","PRCFFMOM",79,0)
 D OKAM^PRCFFU I 'Y!($D(DIRUT)) G AMEND ; ask OK to amend?
"RTN","PRCFFMOM",80,0)
 D SC^PRCFFUA1 ; display FCP, cost ctr, PO/Req#
"RTN","PRCFFMOM",81,0)
 D CPBAL^PRCFFUA1 ; display cost & balances
"RTN","PRCFFMOM",82,0)
 D GET^PRCFFUA1 ; display amended (BOC) info
"RTN","PRCFFMOM",83,0)
 S FATAL=0
"RTN","PRCFFMOM",84,0)
 D OK^PRCFFUA ; ask if above BOC info is correct
"RTN","PRCFFMOM",85,0)
 S SAVEY=Y
"RTN","PRCFFMOM",86,0)
 I Y D  S Y=SAVEY K SAVEY I FATAL=1 D MSG10^PRCFFUA3 G APP1
"RTN","PRCFFMOM",87,0)
 . D GETBOC^PRCFFUA4
"RTN","PRCFFMOM",88,0)
 . D CHKBOC^PRCFFUA4
"RTN","PRCFFMOM",89,0)
 I 'Y!($D(DIRUT)) D  I FISCEDIT G RETRAN
"RTN","PRCFFMOM",90,0)
 .S FISCEDIT=0
"RTN","PRCFFMOM",91,0)
 .I $D(DIRUT) D MSG9^PRCFFUA3 Q
"RTN","PRCFFMOM",92,0)
 .I 'Y D MSG8^PRCFFUA3,POAM^PRCFFUA Q
"RTN","PRCFFMOM",93,0)
 .Q
"RTN","PRCFFMOM",94,0)
 D KILL^PRCFFUA
"RTN","PRCFFMOM",95,0)
APP1 I FATAL=1 G:PRCFA("RETRAN")=0 START Q:PRCFA("RETRAN")=1
"RTN","PRCFFMOM",96,0)
 I $D(^PRC(443.6,+PO,6)),$P(PO(6,1),"^",5)'="" D   I 'Y!($D(DIRUT)) G OUT1
"RTN","PRCFFMOM",97,0)
 . W !
"RTN","PRCFFMOM",98,0)
 . D OKAPP^PRCFFU ; amendment approved, ask 'continue?'
"RTN","PRCFFMOM",99,0)
PRT W !
"RTN","PRCFFMOM",100,0)
 D OKPRT^PRCFFU S:Y FLG=1 ; print amendment
"RTN","PRCFFMOM",101,0)
 S PRCFA("AMEND#")=PRCFAA
"RTN","PRCFFMOM",102,0)
 S PRCFA("BBFY")=$$BBFY^PRCFFU5(+PO)
"RTN","PRCFFMOM",103,0)
 S PRCFA("IDES")="Purchase Order Amendment Obligation"
"RTN","PRCFFMOM",104,0)
 S PRCFA("MP")=$P(PO(0),U,2)
"RTN","PRCFFMOM",105,0)
 S PRCFA("PODA")=PRCFPODA
"RTN","PRCFFMOM",106,0)
 S PRCFA("REF")=$P(PO(0),U)
"RTN","PRCFFMOM",107,0)
 ; the following line commented out in PRC*5*179
"RTN","PRCFFMOM",108,0)
 ; S PRCFA("SFC")=$P(PO(0),U,19)
"RTN","PRCFFMOM",109,0)
 S PRCFA("SYS")="FMS"
"RTN","PRCFFMOM",110,0)
 S PRCFA("TT")=$S(PRCFA("MP")=2:"SO",1:"MO")
"RTN","PRCFFMOM",111,0)
 I $D(GECSDATA),$E($G(GECSDATA(2100.1,GECSDATA,.01,"E")),1,3)="AR-" S PRCFA("TT")="AR"
"RTN","PRCFFMOM",112,0)
PRT1 I PRCFA("MP")=2&(PRCFA("TT")="SO") D  G:ACCEDIT=1 PRT1
"RTN","PRCFFMOM",113,0)
 . W !
"RTN","PRCFFMOM",114,0)
 . D EN^PRCFFU16(+PO)
"RTN","PRCFFMOM",115,0)
PRT11 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D  G PRT2
"RTN","PRCFFMOM",116,0)
 . D RETRANM^PRCFFMO2
"RTN","PRCFFMOM",117,0)
 . S Y=PRCFA("OBLDATE")
"RTN","PRCFFMOM",118,0)
 S Y=$$DTOBL^PRCFFUD1(PRC("RBDT"),PRC("AMENDT"))
"RTN","PRCFFMOM",119,0)
PRT2 D D^PRCFQ
"RTN","PRCFFMOM",120,0)
 S %DT="AEX"
"RTN","PRCFFMOM",121,0)
 S %DT("A")="Select Obligation Processing Date: "
"RTN","PRCFFMOM",122,0)
 S %DT("B")=Y
"RTN","PRCFFMOM",123,0)
 W !
"RTN","PRCFFMOM",124,0)
 D ^%DT
"RTN","PRCFFMOM",125,0)
 K %DT
"RTN","PRCFFMOM",126,0)
 I Y<0 D MSG H 3 G OUT1
"RTN","PRCFFMOM",127,0)
 S PRCFA("OBLDATE")=Y
"RTN","PRCFFMOM",128,0)
 S EXIT=0
"RTN","PRCFFMOM",129,0)
 D ENM^PRCFFMO2
"RTN","PRCFFMOM",130,0)
 I EXIT D MSG,KILL^PRCFFMO2 H 3 G OUT1
"RTN","PRCFFMOM",131,0)
 I PRC("RBDT")'<$P(^PRC(420,PRC("SITE"),0),"^",9),$P($$DATE^PRC0C(PRCFA("OBLDATE"),"I"),U,1,2)'=$P($$DATE^PRC0C(PRC("RBDT"),"I"),U,1,2) D MSG1^PRCFFUD G PRT11
"RTN","PRCFFMOM",132,0)
 D GENDIQ^PRCFFU7(442,+PO,".1;.07;.03;17","IEN","")
"RTN","PRCFFMOM",133,0)
EDIT ; Get budget/accounting elements
"RTN","PRCFFMOM",134,0)
 N PARAM
"RTN","PRCFFMOM",135,0)
 S PARAM=+$P(PO(0),U,3)_"^"_PRC("FY")_"^"_PRCFA("BBFY")
"RTN","PRCFFMOM",136,0)
 S PRCFMO=$$ACC^PRC0C(PRC("SITE"),PARAM)
"RTN","PRCFFMOM",137,0)
 S IDFLAG="I"
"RTN","PRCFFMOM",138,0)
 S XRBLD=0
"RTN","PRCFFMOM",139,0)
 I PRCFA("RETRAN")=1 D EN^PRCFFUB ; if selected transaction to rebuild is a 'X' decrease or cancel, set XRBLD=1, set to 2 if it is the 'E'
"RTN","PRCFFMOM",140,0)
 ;
"RTN","PRCFFMOM",141,0)
 ; determine the correct transaction type if this is not an MO document
"RTN","PRCFFMOM",142,0)
 I PRCFA("TT")'="MO",XRBLD=0 D  I "^AR^SO^"'[("^"_$P(PRCFA("TT"),":",1)) D MSG,OUT1 Q
"RTN","PRCFFMOM",143,0)
 . N PRCFATT S PRCFATT=PRCFA("TT")
"RTN","PRCFFMOM",144,0)
 . D SOAR^PRC0E(PRCFA("PODA"),.PRCFATT,1) ; ask SO or AR, if appropriate
"RTN","PRCFFMOM",145,0)
 . S PRCFA("TT")=PRCFATT K PRCFATT
"RTN","PRCFFMOM",146,0)
 ;
"RTN","PRCFFMOM",147,0)
 I PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^")="AR",PRCFA("TT")="AR" D
"RTN","PRCFFMOM",148,0)
 . I $P(PRCFA("GECS"),"^",2)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCFFMOM",149,0)
 . I $P(PRCFA("GECS"),"^",2)="M" S PRCFA("MOD")="M^1^Modification Document"
"RTN","PRCFFMOM",150,0)
 ;
"RTN","PRCFFMOM",151,0)
 I PRCFA("TT")="AR",XRBLD=0 D  I "EM"'[X D MSG,OUT1 Q
"RTN","PRCFFMOM",152,0)
 . S X="M"
"RTN","PRCFFMOM",153,0)
 . I PRCFA("RETRAN")=1,$P(PRCFA("GECS"),"^",2)="E" S X="E"
"RTN","PRCFFMOM",154,0)
 . D SC^PRC0A("",.Y,"Label document action as: ","AOM^E:Original Document;M:Modification Document",X)
"RTN","PRCFFMOM",155,0)
 . I $E(Y)="E" S PRCFA("MOD")="E^0^Original Document"
"RTN","PRCFFMOM",156,0)
 . I $E(Y)="M" S PRCFA("MOD")="M^1^Modification Document"
"RTN","PRCFFMOM",157,0)
 . S X=$E(Y)
"RTN","PRCFFMOM",158,0)
 . K Y
"RTN","PRCFFMOM",159,0)
 ;
"RTN","PRCFFMOM",160,0)
 ; check to see if transaction type or document type changed
"RTN","PRCFFMOM",161,0)
 S X=0
"RTN","PRCFFMOM",162,0)
 I XRBLD=0,$G(PRCFA("RETRAN"))=1,"^SO^AR"[("^"_$E(PRCFA("TT"),1,2)),$P(PRCFA("GECS"),"^",1,2)'=($E(PRCFA("TT"),1,2)_"^"_$E(PRCFA("MOD"))) D  I X="^" D MSG,PAUSE^PRCFFERU G OUT1
"RTN","PRCFFMOM",163,0)
 . S PRCFA("SIS")=$$GETTXNS^PRCFFERT(PO,PRCFA("AMEND#"),2) ; get other txns for this amendment
"RTN","PRCFFMOM",164,0)
 . S X=$$NEWCHK^PRCFFERT(PRCFA("TT"),$E(PRCFA("MOD"),1),PRCFA("SIS")) ; does selected txn exist?
"RTN","PRCFFMOM",165,0)
 . I X=0 S PRCFA("RETRAN")=2 ; txn doesn't exist, create
"RTN","PRCFFMOM",166,0)
 . I X'=0 S X=$$SWITCH^PRCFFERT(X,2,.GECSDATA) ; replace current GECSDATA values with values belonging to selected txn-- returns '^' if not switched
"RTN","PRCFFMOM",167,0)
 ;
"RTN","PRCFFMOM",168,0)
GO ; Prompt user for for final go-ahead for approval
"RTN","PRCFFMOM",169,0)
 D GO^PRCFFU
"RTN","PRCFFMOM",170,0)
 I 'Y!($D(DIRUT)) D MSG,OUT1 Q
"RTN","PRCFFMOM",171,0)
ESIG W !,"The Electronic Signature must now be entered to generate the "_PRCFA("TYPE")_" Document.",!
"RTN","PRCFFMOM",172,0)
 D SIG^PRCFFU4
"RTN","PRCFFMOM",173,0)
 I $D(PRCFA("SIGFAIL")) K PRCFA("SIGFAIL") H 3 G OUT1
"RTN","PRCFFMOM",174,0)
 S DA=PRCFA("PODA")
"RTN","PRCFFMOM",175,0)
 D REMOVE^PRCHES14(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",176,0)
 S MESSAGE="" ; value not used but variable is needed by next call
"RTN","PRCFFMOM",177,0)
 D ENCODE^PRCHES14(PRCFA("PODA"),PRCFA("AMEND#"),DUZ,.MESSAGE)
"RTN","PRCFFMOM",178,0)
 ;
"RTN","PRCFFMOM",179,0)
 D DT442^PRCFFUD1(PRCFA("PODA"),"",442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",180,0)
 S PRCOAMT=+^PRC(442,PRCFA("PODA"),0)
"RTN","PRCFFMOM",181,0)
 S $P(PRCOAMT,"^",2)=+$P(^PRC(442,PRCFA("PODA"),0),"^",3)
"RTN","PRCFFMOM",182,0)
 S $P(PRCOAMT,"^",3)=PRC("FYQDT")
"RTN","PRCFFMOM",183,0)
 S $P(PRCOAMT,"^",5)=-$P(^PRC(442,PRCFA("PODA"),0),"^",$P(PRCFMO,"^",12)="N"+15)
"RTN","PRCFFMOM",184,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 G TRANS1
"RTN","PRCFFMOM",185,0)
TRANS W !!,"...copying amendment information back to Purchase Order file...",! D WAIT^DICD
"RTN","PRCFFMOM",186,0)
 S ERFLAG=""
"RTN","PRCFFMOM",187,0)
 S PRCFA("DLVDATE")=$P(^PRC(442,PRCFA("PODA"),0),"^",10)
"RTN","PRCFFMOM",188,0)
 D CHECK^PRCHAMYA(PRCFA("PODA"),PRCFA("AMEND#"),.ERFLAG)
"RTN","PRCFFMOM",189,0)
 I ERFLAG W !!,"...ERROR IN COPYING AMENDMENT INFORMATION BACK TO PURCHASE ORDER FILE..." G OUT1
"RTN","PRCFFMOM",190,0)
TRANS1 D DT442^PRCFFUD1(PRCFA("PODA"),"",442,PRCFA("AMEND#"))
"RTN","PRCFFMOM",191,0)
 ;  transmit amendment from IFCAP to DynaMed   **81**
"RTN","PRCFFMOM",192,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 D
"RTN","PRCFFMOM",193,0)
 . ; No DynaMed interface if rebuild/retransmit
"RTN","PRCFFMOM",194,0)
 . I $D(PRCFA("RETRAN")),PRCFA("RETRAN")>0 Q
"RTN","PRCFFMOM",195,0)
 . D ENT^PRCVPOU(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",196,0)
 S PRCFA("OLDPODA")=PRCFA("PODA")
"RTN","PRCFFMOM",197,0)
 S PRCFA("OLDREF")=PRCFA("REF")
"RTN","PRCFFMOM",198,0)
 I PRCFA("RETRAN")>0 I XRBLD=1!(XRBLD=2) D GO^PRCFFUB H 3 Q  ; if rebuilding a 'dependent' transaction, finish work here
"RTN","PRCFFMOM",199,0)
 D LIST^PRCFFU7(PRCFA("PODA"),PRCFA("AMEND#"))
"RTN","PRCFFMOM",200,0)
 I $G(PRCFA("RETRAN"))<1 D AMEND^PRCFFUD ; create entry in 410
"RTN","PRCFFMOM",201,0)
 I PRCFA("AUTHE") D FCP^PRCFFU11,PRINT G START
"RTN","PRCFFMOM",202,0)
 I 'PRCFA("MOMREQ") D MSG^PRCFFU8 G PRINT ; skip FMS transmit,fiscal upadtes
"RTN","PRCFFMOM",203,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=1 D SETPO^PRCFFERT
"RTN","PRCFFMOM",204,0)
 I $G(PRCFA("ACCEDIT"))=1 D TAG33^PRCFFU9
"RTN","PRCFFMOM",205,0)
TRANS2 K PO
"RTN","PRCFFMOM",206,0)
 D ^PRCFFM1M
"RTN","PRCFFMOM",207,0)
 L -^PRC(443.6,PRCFA("PODA"))
"RTN","PRCFFMOM",208,0)
 I $D(PRCFA("RETRAN")),PRCFA("RETRAN")=0 D OUT1^PRCFFM1M G START
"RTN","PRCFFMOM",209,0)
 QUIT
"RTN","PRCFFMOM",210,0)
 ;
"RTN","PRCFFMOM",211,0)
PRINT ; Print out copy of Purchase Order Amendment
"RTN","PRCFFMOM",212,0)
 G:'FLG OUT1
"RTN","PRCFFMOM",213,0)
 S PRCHQ="^PRCHPAM"
"RTN","PRCFFMOM",214,0)
 S PRCHQ("DEST")="S8"
"RTN","PRCFFMOM",215,0)
 S D0=PRCFA("PODA")
"RTN","PRCFFMOM",216,0)
 S D1=PRCFA("AMEND#")
"RTN","PRCFFMOM",217,0)
 D ^PRCHQUE
"RTN","PRCFFMOM",218,0)
OUT1 K FATAL,FLG,%,%Y,DIC,I,J,K,P,PRCFA,PRCFAA,PRCFPODA,PRCFCHG,X,XRBLD,Y,Z
"RTN","PRCFFMOM",219,0)
 Q
"RTN","PRCFFMOM",220,0)
 ; Message processing
"RTN","PRCFFMOM",221,0)
NOA D NOA^PRCFFM3M Q
"RTN","PRCFFMOM",222,0)
MSG D MSG^PRCFFM3M Q
"RTN","PRCFFMOM",223,0)
MSG1 D MSG1^PRCFFM3M Q
"RTN","PRCH442")
0^24^B40109640
"RTN","PRCH442",1,0)
PRCH442 ;WISC/KMB/DL/DXH - CREATE PURCHASE CARD ORDER FROM RIL ;12.1.99
"RTN","PRCH442",2,0)
 ;;5.1;IFCAP;**13,81**;Oct 20, 2000
"RTN","PRCH442",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCH442",4,0)
START ;  entry point for delivery orders
"RTN","PRCH442",5,0)
S1 N RLFLAG S RLFLAG=1
"RTN","PRCH442",6,0)
S2 ;  entry point for purchase card orders
"RTN","PRCH442",7,0)
 N RPUSE,SS,FSC,AA,BB,CC,EE,FF,CP,FCP,IB,J,ITEM,UCOST,MAX,PMULT,VSTOCK,VENDOR,VENDOR1,NDC,CONT,UOP,CONV,SKU,SPEC,APP,QTY,ORDTOT,PDA,CTT,CNNT,NCOST,COSTTOT,REQCT
"RTN","PRCH442",8,0)
 N HM,CCDA,II,PP,IB,IJ,CTT,CTR,OUTRL,SERV,TDATE,CNNT1,ZS,ZS0,XDA,YDA,WHSE,COMMENT,PRCS,PRCVDYN,PRCKILL,GG
"RTN","PRCH442",9,0)
 W ! S DIC="^PRCS(410.3,",DIC(0)="AEMQ",DIC("S")="S PRC(""SITE"")=+^(0),PRC(""CP"")=$P(^(0),""-"",4),$P(^(0),U,5)="""" I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))" D ^DIC K DIC("S") Q:Y'>0
"RTN","PRCH442",10,0)
 K DIC S (YDA,XDA,DA)=+Y
"RTN","PRCH442",11,0)
 S:'$D(PRC("SST")) PRC("SST")="" S DIC("B")=PRC("SST") I $D(^PRC(411,"UP",+PRC("SITE"))) S DIC="^PRC(411,",DIC(0)="AEQZS",DIC("A")="Select SUBSTATION: ",DIC("S")="I $E($G(^PRC(411,+Y,0)),1,3)=PRC(""SITE"")" D ^DIC I Y>0 S PRC("SST")=+Y
"RTN","PRCH442",12,0)
 K DIC Q:Y'>0
"RTN","PRCH442",13,0)
 I '$D(PRC("PARAM")) S PRC("PARAM")=$$NODE^PRC0B("^PRC(411,PRC(""SITE""),",0)
"RTN","PRCH442",14,0)
 S COMMENT="purchase card",WHSE=+$O(^PRC(440,"AC","S",0)) S:$G(RLFLAG)=1 COMMENT="delivery"
"RTN","PRCH442",15,0)
 ; introducing prcsip as package-wide
"RTN","PRCH442",16,0)
 S OUTRL=0,PRCSIP=$P(^PRCS(410.3,XDA,0),U,3)
"RTN","PRCH442",17,0)
 S CTT=$P($G(^PRCS(410.3,XDA,1,0)),"^",4) I +CTT=0 W !,"There are no items on this repetitive item list." Q
"RTN","PRCH442",18,0)
 ;
"RTN","PRCH442",19,0)
 ;See NOIS MON-0399-51726
"RTN","PRCH442",20,0)
 KILL ^TMP($J)
"RTN","PRCH442",21,0)
 S IB=0,PRCVDYN=0
"RTN","PRCH442",22,0)
 ;
"RTN","PRCH442",23,0)
 ; PRC*5.1*81 set flag (PRCVDYN) for DynaMed RIL
"RTN","PRCH442",24,0)
 I $O(^PRCV(414.02,"C",$P(^PRCS(410.3,XDA,0),"^",1),0))]"" S PRCVDYN=1
"RTN","PRCH442",25,0)
 ;
"RTN","PRCH442",26,0)
 F  S IB=$O(^PRCS(410.3,XDA,1,IB)) Q:'IB  D  ;
"RTN","PRCH442",27,0)
 . S FF=$G(^PRCS(410.3,XDA,1,IB,0))
"RTN","PRCH442",28,0)
 . S ^TMP($J,410.3,XDA,1,"AC",$P(FF,"^",3)_";"_$P(FF,"^",5),IB)=""
"RTN","PRCH442",29,0)
 ;
"RTN","PRCH442",30,0)
 W !,"This repetitive item list has the following vendors:",!
"RTN","PRCH442",31,0)
 ;
"RTN","PRCH442",32,0)
 S HM=""
"RTN","PRCH442",33,0)
 F  S HM=$O(^TMP($J,410.3,XDA,1,"AC",HM)) Q:HM=""  D
"RTN","PRCH442",34,0)
 . W !,$P(HM,";"),?40,"NUMBER: ",$P(HM,";",2)
"RTN","PRCH442",35,0)
 ;
"RTN","PRCH442",36,0)
 W !
"RTN","PRCH442",37,0)
 S ZS=$P(^PRCS(410.3,XDA,0),"^"),PRC("SITE")=$P(ZS,"-"),CP=+$P(ZS,"-",4),CCEN=$P(ZS,"-",5)
"RTN","PRCH442",38,0)
 D FY
"RTN","PRCH442",39,0)
 S SPEC=$P($G(^PRC(420,PRC("SITE"),1,CP,0)),"^",12),(FCP,PRC("CP"))=$P($G(^PRC(420,PRC("SITE"),1,CP,0)),"^"),SERV=$P($G(^(0)),"^",10)
"RTN","PRCH442",40,0)
 S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),PRC("CP")),APP=$P($$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY")),"^",11)
"RTN","PRCH442",41,0)
PROCESS ;
"RTN","PRCH442",42,0)
 ; get item data from repetitive item list
"RTN","PRCH442",43,0)
 S VENDOR1=0,(REQCT,COSTTOT,IB)=0
"RTN","PRCH442",44,0)
 F  S VENDOR1=$O(^TMP($J,410.3,XDA,1,"AC",VENDOR1)) Q:VENDOR1=""  D PROCESS1
"RTN","PRCH442",45,0)
 W !!!,"Total number of requests generated: ",REQCT,!,"Total cost of all requests: $",$J(COSTTOT,0,2)
"RTN","PRCH442",46,0)
 Q:REQCT=0
"RTN","PRCH442",47,0)
 W !,"Generating ",COMMENT," orders...."
"RTN","PRCH442",48,0)
 I $D(EE($J)) S PP="",RPUSE=1 F  S PP=$O(EE($J,PP)) Q:PP=""  S DA=PP D
"RTN","PRCH442",49,0)
 .K CCDA D ^PRCH410
"RTN","PRCH442",50,0)
 .I $G(CCDA)'="" W !,"Request ",$P(^PRCS(410,CCDA,0),"^")," created.",!
"RTN","PRCH442",51,0)
 ;
"RTN","PRCH442",52,0)
 ; PRC*5.1*81 if DynaMed RIL and trouble with item, save RIL# to ^TMP
"RTN","PRCH442",53,0)
 I PRCVDYN,$O(^TMP($J,"PRCVHMSG","")) S ^TMP($J,"PRCVHMSG",YDA)=$P(^PRCS(410.3,YDA,0),"^",1)
"RTN","PRCH442",54,0)
 ;
"RTN","PRCH442",55,0)
 D RENUM^PRCH442A
"RTN","PRCH442",56,0)
SLIST S PRCKILL=0 I 'PRCVDYN D
"RTN","PRCH442",57,0)
 . I $G(^PRCS(410.3,YDA,0))'="" S %=2 W !,"Do you wish to re-use this list" D YN^DICN G:%=0 SLIST I %=2 S PRCKILL=1
"RTN","PRCH442",58,0)
 ;
"RTN","PRCH442",59,0)
 ; PRC*5.1*81 - send DynaMed a cancel txn for any items not moved to a PC
"RTN","PRCH442",60,0)
 I PRCVDYN D
"RTN","PRCH442",61,0)
 . I +$O(^PRCS(410.3,YDA,1,0))>0 D EN^PRCVRCA(YDA)
"RTN","PRCH442",62,0)
 ;
"RTN","PRCH442",63,0)
 I PRCVDYN!PRCKILL S DA=YDA,DIK="^PRCS(410.3," D ^DIK K DIK
"RTN","PRCH442",64,0)
 ;
"RTN","PRCH442",65,0)
 ; PRC*5.1*81 - send message to user of problems found
"RTN","PRCH442",66,0)
 I PRCVDYN,$O(^TMP($J,"PRCVHMSG","")) D DYNAMSG
"RTN","PRCH442",67,0)
 ;
"RTN","PRCH442",68,0)
 W !,"End of processing."
"RTN","PRCH442",69,0)
 K RLFLAG,PRCHPC,PRCS,^TMP($J) QUIT
"RTN","PRCH442",70,0)
 ;
"RTN","PRCH442",71,0)
PROCESS1 ;
"RTN","PRCH442",72,0)
 N PRCVDATE
"RTN","PRCH442",73,0)
 S NCOST=0,CNNT=0,PRCVDATE=""
"RTN","PRCH442",74,0)
 S IB=$O(^TMP($J,410.3,XDA,1,"AC",VENDOR1,0)),VENDOR=$P($G(^PRCS(410.3,XDA,1,IB,0)),"^",5)
"RTN","PRCH442",75,0)
 I VENDOR="" Q
"RTN","PRCH442",76,0)
 I VENDOR=WHSE,$G(SPEC)'=2 Q
"RTN","PRCH442",77,0)
 I OUTRL=1 Q
"RTN","PRCH442",78,0)
 S IB=0 F  S IB=$O(^TMP($J,410.3,XDA,1,"AC",VENDOR1,IB)) Q:IB=""  D ITEM Q:OUTRL
"RTN","PRCH442",79,0)
 Q:CNNT=0
"RTN","PRCH442",80,0)
 K PDA D SETUP^PRCH442A
"RTN","PRCH442",81,0)
 I '$D(PDA) Q
"RTN","PRCH442",82,0)
 S REQCT=REQCT+1,COSTTOT=COSTTOT+NCOST
"RTN","PRCH442",83,0)
 W !,"Request ",$P($G(^PRC(442,PDA,0)),"^")," has been created."
"RTN","PRCH442",84,0)
 W !,"The vendor for this request is: ",$P(VENDOR1,";"),"  "
"RTN","PRCH442",85,0)
 W "(",$P(VENDOR1,";",2),")"
"RTN","PRCH442",86,0)
 W !,"Total cost of request: $",$J(NCOST,0,2),!,"Total items on ",COMMENT," request: ",CNNT
"RTN","PRCH442",87,0)
 QUIT
"RTN","PRCH442",88,0)
ITEM ;
"RTN","PRCH442",89,0)
 S SS=$G(^PRCS(410.3,XDA,1,IB,0))
"RTN","PRCH442",90,0)
 I $G(RLFLAG)=1,$P(SS,"^",6)'="Y" Q
"RTN","PRCH442",91,0)
 S ITEM=$P(SS,"^"),QTY=$P(SS,"^",2),EST=$P(SS,"^",4)
"RTN","PRCH442",92,0)
 I '$D(^PRC(441,+ITEM,2,+VENDOR,0)) Q
"RTN","PRCH442",93,0)
 S ZS0=$G(^PRC(441,ITEM,2,VENDOR,0))
"RTN","PRCH442",94,0)
 S ZS=$G(^PRC(441,ITEM,0)),NSN=$P(ZS,"^",5),BOC=$P(ZS,"^",10),FSC=$P(ZS,"^",3)
"RTN","PRCH442",95,0)
 I SPEC=2 S BOC=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(ITEM),1,4)) S BOC=$S(BOC=1:2697,BOC=1:2698,BOC=8:2696,1:2699)
"RTN","PRCH442",96,0)
 I BOC'="" S BOC=$P($G(^PRCD(420.2,BOC,0)),"^"),BOC=$E(BOC,1,30)
"RTN","PRCH442",97,0)
 S SKU=$P($G(^PRC(441,ITEM,3)),"^",8)
"RTN","PRCH442",98,0)
 S UCOST=$P(ZS0,"^",2),CONT=$P(ZS0,"^",3),VSTOCK=$P(ZS0,"^",4),NDC=$P(ZS0,"^",5),UOP=$P(ZS0,"^",7),PMULT=$P(ZS0,"^",8),MAX=$P(ZS0,"^",9),CONV=$P(ZS0,"^",10)
"RTN","PRCH442",99,0)
 S:CONT'="" CONT=$P($G(^PRC(440,+VENDOR,4,CONT,0)),"^")
"RTN","PRCH442",100,0)
 S CNNT=CNNT+1
"RTN","PRCH442",101,0)
 S AA(CNNT)=CNNT_"^"_QTY_"^"_UOP_"^"_BOC_"^"_ITEM_"^"_VSTOCK_"^"_UCOST_"^^"_UCOST_"^^^"_PMULT_"^"_NSN_"^"_MAX_"^"_NDC_"^"_SKU_"^"_CONV
"RTN","PRCH442",102,0)
 ; enter item description from file
"RTN","PRCH442",103,0)
 S CNNT1=$P($G(^PRC(441,ITEM,1,0)),"^",4)
"RTN","PRCH442",104,0)
 I CNNT1'="" F J=1:1:CNNT1 S BB(CNNT,J)=$G(^PRC(441,ITEM,1,J,0))
"RTN","PRCH442",105,0)
 S TOTAL=QTY*UCOST,CC(CNNT)=TOTAL_"^"_CONT_"^"_FSC,NCOST=NCOST+TOTAL
"RTN","PRCH442",106,0)
 ;
"RTN","PRCH442",107,0)
 ; PRC*5.1*81 - save DM DOC ID and earliest DATE NEEDED BY, set any problems into ^TMP
"RTN","PRCH442",108,0)
 I PRCVDYN D
"RTN","PRCH442",109,0)
 . S $P(CC(CNNT),"^",15)=$P(^PRCS(410.3,XDA,1,IB,0),"^",7) ; DM DOC ID
"RTN","PRCH442",110,0)
 . I $P(CC(CNNT),"^",15)']"" S ^TMP($J,"PRCVHMSG",XDA,ITEM)="<missing>" ; no DOCID
"RTN","PRCH442",111,0)
 . I $P(SS,"^",8)>0,$P(SS,"^",8)<PRCVDATE S PRCVDATE=$P(SS,"^",8)
"RTN","PRCH442",112,0)
 . I PRCVDATE="" S PRCVDATE=$P(SS,"^",8)
"RTN","PRCH442",113,0)
 ;
"RTN","PRCH442",114,0)
 I $P(SS,"^",6)="Y" S $P(^PRCS(410.3,XDA,1,IB,0),"^",6)="O"
"RTN","PRCH442",115,0)
 S GG(CNNT)=IB
"RTN","PRCH442",116,0)
 QUIT
"RTN","PRCH442",117,0)
 ;
"RTN","PRCH442",118,0)
FY D NOW^%DTC S TDATE=X,SDATE=$$FMADD^XLFDT(TDATE,10),(FY,PRC("FY"))=$E(X,2,3),QTR=$E(X,4,5),PRC("QTR")=$P("2^2^2^3^3^3^4^4^4^1^1^1","^",+QTR)
"RTN","PRCH442",119,0)
 I PRC("QTR")=1 S FY=$E(100+FY+1,2,3),PRC("FY")=FY
"RTN","PRCH442",120,0)
 QUIT
"RTN","PRCH442",121,0)
 ;
"RTN","PRCH442",122,0)
DYNAMSG ; PRC*5.1*81 - Build message to user of items not in audit file
"RTN","PRCH442",123,0)
 N I,XMB,PRCDATA,PRCNT,PRCVI,PRCVIEN,PRCRIL
"RTN","PRCH442",124,0)
 S PRCVIEN=$O(^TMP($J,"PRCVHMSG",0)) Q:+PRCVIEN=0
"RTN","PRCH442",125,0)
 S PRCRIL=^TMP($J,"PRCVHMSG",PRCVIEN)
"RTN","PRCH442",126,0)
 S XMB(1)=" generating PC orders from RIL# "_PRCRIL
"RTN","PRCH442",127,0)
 S XMB(2)=" <SEE BELOW>"
"RTN","PRCH442",128,0)
 S XMB(3)=" unable to enter PO# for item in audit file (#414.02)"
"RTN","PRCH442",129,0)
 S PRCVI=0,PRCNT=0
"RTN","PRCH442",130,0)
 F  S PRCVI=$O(^TMP($J,"PRCVHMSG",PRCVIEN,PRCVI)) Q:+PRCVI=0  D
"RTN","PRCH442",131,0)
 . S PRCDATA=$G(^TMP($J,"PRCVHMSG",PRCVIEN,PRCVI))
"RTN","PRCH442",132,0)
 . F I=1,2 I $P(PRCDATA,"^",I)']"" S $P(PRCDATA,"^",I)="<missing>"
"RTN","PRCH442",133,0)
 . S PRCNT=PRCNT+1
"RTN","PRCH442",134,0)
 . S ^TMP($J,"PRCV442M",PRCNT)="ITEM# "_PRCVI_" placed on PO# "_$P(PRCDATA,"^",2)_" has DM DOC ID# "_$P(PRCDATA,"^",1)
"RTN","PRCH442",135,0)
 D DMERXMB^PRCVLIC("PRCV442M",+PRCRIL,$P(PRCRIL,"-",4))
"RTN","PRCH442",136,0)
 Q
"RTN","PRCH442A")
0^25^B63170859
"RTN","PRCH442A",1,0)
PRCH442A ;WISC/KMB/CR/DXH/DGL-CREATE PURCHASE CARD ORDER FROM RIL ;4/13/00 1:32pm
"RTN","PRCH442A",2,0)
 ;;5.1;IFCAP;**8,35,26,57,81**;Oct 20, 2000
"RTN","PRCH442A",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCH442A",4,0)
 ;
"RTN","PRCH442A",5,0)
SETUP ; create 442 entry
"RTN","PRCH442A",6,0)
 D ENPO^PRCHUTL
"RTN","PRCH442A",7,0)
 ;
"RTN","PRCH442A",8,0)
 ; PRC*5.1*81 - If this is a DynaMed RIL, double dare users who try to exit before all items on the RIL are transferred to purchase card orders
"RTN","PRCH442A",9,0)
 I '$D(DA),'PRCVDYN S OUTRIL=1 W !,"Unable to create 442 entry. Try later." Q
"RTN","PRCH442A",10,0)
 I '$D(DA) D  G SETUP:Y=0 S OUTRIL=1 Q
"RTN","PRCH442A",11,0)
 . N DIR
"RTN","PRCH442A",12,0)
 . S DIR(0)="Y",DIR("B")="NO"
"RTN","PRCH442A",13,0)
 . S DIR("A",1)=" "
"RTN","PRCH442A",14,0)
 . S DIR("A",2)="NOTE: This RIL Contains DynaMed Orders!!!"
"RTN","PRCH442A",15,0)
 . S DIR("A",3)="-----------------------------------------"
"RTN","PRCH442A",16,0)
 . S DIR("A",4)="You must enter a valid PURCHASE ORDER NUMBER to continue.  If no valid"
"RTN","PRCH442A",17,0)
 . S DIR("A",5)="PURCHASE ORDER is entered, all items remaining on the RIL will be deleted."
"RTN","PRCH442A",18,0)
 . S DIR("A",6)=" "
"RTN","PRCH442A",19,0)
 . S DIR("A")="Do you want to exit and delete the RIL?"
"RTN","PRCH442A",20,0)
 . S DIR("?")="Enter 'NO' or <return> to go back to the PURCHASE ORDER prompt"
"RTN","PRCH442A",21,0)
 . D ^DIR Q:Y=0
"RTN","PRCH442A",22,0)
 . S DIR("A")="Are you sure that you want to cancel ALL DynaMed Orders on this RIL?"
"RTN","PRCH442A",23,0)
 . D ^DIR
"RTN","PRCH442A",24,0)
 ;
"RTN","PRCH442A",25,0)
 N PRCHCPD,CP1
"RTN","PRCH442A",26,0)
 S PDA=DA L +^PRC(442,PDA):15 Q:'$T
"RTN","PRCH442A",27,0)
 S DIE="^PRC(442,",DR=".5////1"_";"_"1.4////"_APP D ^DIE ;LIT-0400-70331
"RTN","PRCH442A",28,0)
 I $G(RLFLAG)'=1 S DR=".02///25"_";"_"48///P" D ^DIE
"RTN","PRCH442A",29,0)
 I $G(RLFLAG)=1 S DR=".02///1"_";"_"47///Y"_";"_"48///D" D ^DIE
"RTN","PRCH442A",30,0)
 S $P(^PRC(442,PDA,1),"^")=VENDOR,$P(^(0),"^",3)=FCP,$P(^(0),"^",5)=CCEN,$P(^(23),"^",7)=PRC("SST"),$P(^(23),"^",14)=VENDOR
"RTN","PRCH442A",31,0)
 S DIE="^PRC(442,",DR=".03///"_SPEC_";"_".1////"_TDATE D ^DIE
"RTN","PRCH442A",32,0)
 ;
"RTN","PRCH442A",33,0)
 ; PRC*5.1*81 
"RTN","PRCH442A",34,0)
 I PRCVDYN S DR="7///"_PRCVDATE_";"_"54///Y" D ^DIE ; save earliest Need By Date in RIL for vendor in PC order delivery date, force 'Requested Receipt?' to Yes
"RTN","PRCH442A",35,0)
 ;
"RTN","PRCH442A",36,0)
 ;BUT-0701-21784 & WAS-0498-22000
"RTN","PRCH442A",37,0)
 S CP1=$P($P(^PRCS(410.3,XDA,0),U),"-",4)
"RTN","PRCH442A",38,0)
 S ^PRC(442,"E",CP1,PDA)=""
"RTN","PRCH442A",39,0)
 ;
"RTN","PRCH442A",40,0)
 S $P(^PRC(442,PDA,1),"^",10)=DUZ,^PRC(442,"D",$E(VENDOR,1,30),PDA)=""
"RTN","PRCH442A",41,0)
 I NCOST'=0 F II=1:1:CNNT D SETIT
"RTN","PRCH442A",42,0)
 I NCOST'=0 S ^PRC(442,PDA,2,0)="^442.01IA^"_CNNT_"^"_CNNT
"RTN","PRCH442A",43,0)
 S EE($J,PDA)=""
"RTN","PRCH442A",44,0)
 ;
"RTN","PRCH442A",45,0)
 N NCST,NLP,NCNT,NQTY,NSUB
"RTN","PRCH442A",46,0)
LOOP S %=1 W !,"Edit request ",$P(^PRC(442,PDA,0),"^")
"RTN","PRCH442A",47,0)
 D YN^DICN G:%=0 LOOP G:%=2 LQ
"RTN","PRCH442A",48,0)
 S (PRCHPO,DA)=PDA,PRC("PER")=DUZ,X=1
"RTN","PRCH442A",49,0)
 D ^PRCHNPO,LOOPA
"RTN","PRCH442A",50,0)
 K PRC("PER"),X,PRCHPO
"RTN","PRCH442A",51,0)
LQ L -^PRC(442,PDA) Q
"RTN","PRCH442A",52,0)
 ;
"RTN","PRCH442A",53,0)
LOOPA Q:$G(^PRC(442,PDA,2,0))=""  S NCNT=$P($G(^PRC(442,PDA,2,0)),U,4) Q:NCNT=""  S NSUB=0 F NLP=1:1:NCNT D
"RTN","PRCH442A",54,0)
 .S NQTY=$P($G(^PRC(442,PDA,2,NLP,0)),U,2),NCST=$P($G(^PRC(442,PDA,2,NLP,0)),U,9),NSUB=NSUB+(NQTY*NCST)
"RTN","PRCH442A",55,0)
 S CNNT=NCNT,NCOST=NSUB Q
"RTN","PRCH442A",56,0)
 ;
"RTN","PRCH442A",57,0)
SETIT ;set item data on 442 record
"RTN","PRCH442A",58,0)
 S ^PRC(442,PDA,2,II,0)=AA(II)
"RTN","PRCH442A",59,0)
 I CNNT1'="" F J=1:1:CNNT1 S ^PRC(442,PDA,2,II,1,J,0)=$G(BB(II,J))
"RTN","PRCH442A",60,0)
 S ^PRC(442,PDA,2,II,2)=CC(II)
"RTN","PRCH442A",61,0)
 ;
"RTN","PRCH442A",62,0)
 ; PRC*5.1*81
"RTN","PRCH442A",63,0)
 I PRCVDYN D
"RTN","PRCH442A",64,0)
 . N PRCV S PRCV=0
"RTN","PRCH442A",65,0)
 . I $P(CC(II),"^",15)]"" S PRCV=$O(^PRCV(414.02,"B",$P(CC(II),"^",15),"")) ; get ien of DM DOC ID
"RTN","PRCH442A",66,0)
 . I +PRCV=0 D  Q  ; if not in audit file update ^TMP to alert user
"RTN","PRCH442A",67,0)
 . . S ^TMP($J,"PRCVHMSG",YDA,ITEM)=$P(CC(II),"^",15)_"^"_$P(^PRC(442,PDA,0),"^",1) Q  ; update msg to user to show DM, DOC ID & PO#
"RTN","PRCH442A",68,0)
 . S $P(^PRCV(414.02,PRCV,0),"^",11)=$P(^PRC(442,PDA,0),"^",1) ; SET PO Number into Audit file
"RTN","PRCH442A",69,0)
 ;
"RTN","PRCH442A",70,0)
 S ^PRC(442,PDA,2,II,1,0)="^^"_CNNT1_"^"_CNNT1_"^"_TDATE_"^"
"RTN","PRCH442A",71,0)
 S ^PRC(442,PDA,2,"B",II,II)="",^PRC(442,PDA,2,"C",II,II)=""
"RTN","PRCH442A",72,0)
 S ^PRC(442,PDA,2,"AE",ITEM,II)="" S:BOC'="" ^PRC(442,PDA,2,"AH",+BOC,II,II)="",^PRC(442,PDA,2,"D",+BOC,II)=""
"RTN","PRCH442A",73,0)
 I $G(PRCSIP) D
"RTN","PRCH442A",74,0)
 . N DIC,DIE,DA,DLAYGO
"RTN","PRCH442A",75,0)
 . S DIC="^PRC(442,"_PDA_",2,"_II_",5,",DA(1)=II,DA(2)=PDA,X=PRCSIP
"RTN","PRCH442A",76,0)
 . S DIC(0)="L",DIC("P")=$P(^DD(442.01,47,0),U,2),DLAYGO=442
"RTN","PRCH442A",77,0)
 . D FILE^DICN
"RTN","PRCH442A",78,0)
 K DIE
"RTN","PRCH442A",79,0)
 ;
"RTN","PRCH442A",80,0)
 ; PRC*5.1*81 - delete items from RIL as they are moved to a PC order
"RTN","PRCH442A",81,0)
 I PRCVDYN D
"RTN","PRCH442A",82,0)
 . N DA,DIK
"RTN","PRCH442A",83,0)
 . S DA=GG(II),DA(1)=YDA,DIK="^PRCS(410.3,"_DA(1)_",1,"
"RTN","PRCH442A",84,0)
 . D ^DIK
"RTN","PRCH442A",85,0)
 ;
"RTN","PRCH442A",86,0)
 S PRCHCPD=TDATE,PRCHCV=VENDOR,(DA(1),PRCHCPO)=PDA,PRCHCCP=CP1,(PRCHCI,PRCHCII,X)=$P(AA(II),"^",5),DA=II
"RTN","PRCH442A",87,0)
 I PRCHCI'="" D EN3^PRCHCRD S ^PRC(442,PDA,2,"AE",PRCHCII,II)=""
"RTN","PRCH442A",88,0)
 K PRCHCCP,PRCHCPO,PRCHCV,PRCHCI,PRCHCII
"RTN","PRCH442A",89,0)
 QUIT
"RTN","PRCH442A",90,0)
 ;
"RTN","PRCH442A",91,0)
INCOM1 S FLAG=0
"RTN","PRCH442A",92,0)
INCOM2 S:$G(FLAG)="" FLAG=1
"RTN","PRCH442A",93,0)
INCOM ;
"RTN","PRCH442A",94,0)
 K ^TMP($J)
"RTN","PRCH442A",95,0)
 N ZP,LABEL,PC1,PONUM,PODATE,STAT,PANAME,ADATE,Y,XXZ,EX,P,P1,P12,P2,P23,STR,TIMEDATE
"RTN","PRCH442A",96,0)
 S:$G(FLAG)="" LABEL="INCOM" S:$G(FLAG)=0 LABEL="INCOM1" S:$G(FLAG)=1 LABEL="INCOM2"
"RTN","PRCH442A",97,0)
 W @IOF
"RTN","PRCH442A",98,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(PRC("SITE"))="^"
"RTN","PRCH442A",99,0)
 W !,"Please select a device for printing this report."
"RTN","PRCH442A",100,0)
 S %ZIS("B")="",%ZIS="MQ" D ^%ZIS Q:POP
"RTN","PRCH442A",101,0)
 I $D(IO("Q")) S ZTSAVE("*")="",ZTRTN="DETAIL^PRCH442A" D ^%ZTLOAD,^%ZISC K FLAG Q
"RTN","PRCH442A",102,0)
 D DETAIL,^%ZISC K FLAG
"RTN","PRCH442A",103,0)
 Q
"RTN","PRCH442A",104,0)
 ;
"RTN","PRCH442A",105,0)
DETAIL ;
"RTN","PRCH442A",106,0)
 S X=DT D NOW^%DTC,YX^%DTC S TIMEDATE=Y,CNT=0
"RTN","PRCH442A",107,0)
 S ZP="" F  S ZP=$O(^PRC(442,"F",25,ZP)) Q:ZP=""  D
"RTN","PRCH442A",108,0)
 .Q:$P($G(^PRC(442,ZP,7)),"^")=45
"RTN","PRCH442A",109,0)
 .Q:$D(^PRC(442,ZP,11))
"RTN","PRCH442A",110,0)
 .Q:$P($G(^PRC(442,ZP,12)),"^",2)'=""
"RTN","PRCH442A",111,0)
 .S P1=$G(^PRC(442,ZP,0)),PONUM=$P(P1,"^")
"RTN","PRCH442A",112,0)
 .I $D(PRC("SITE")) Q:$P(P1,"-")'=PRC("SITE")
"RTN","PRCH442A",113,0)
 .S PC1=$P($G(^PRC(442,ZP,23)),"^",8) I PC1="" D DETAIL1
"RTN","PRCH442A",114,0)
 .Q:PC1=""
"RTN","PRCH442A",115,0)
 .I $G(FLAG)=0 Q:$P($G(^PRC(440.5,PC1,0)),"^",8)'=DUZ
"RTN","PRCH442A",116,0)
 .I $G(FLAG)=1 I $P($G(^PRC(440.5,PC1,0)),"^",10)'=DUZ,$P($G(^PRC(440.5,PC1,0)),"^",9)'=DUZ Q
"RTN","PRCH442A",117,0)
 .S P2=$G(^PRC(442,ZP,1)),PA=$P($G(^PRC(440.5,PC1,0)),"^",8) Q:PA=""
"RTN","PRCH442A",118,0)
 .S PANAME=$P($G(^VA(200,PA,0)),"^") Q:PANAME=""
"RTN","PRCH442A",119,0)
 .S Y=$P(P2,"^",15) D DD^%DT S PODATE=Y
"RTN","PRCH442A",120,0)
 .S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",121,0)
 .S Y=$P($G(^PRC(442,ZP,12)),"^",5) D DD^%DT S ADATE=Y
"RTN","PRCH442A",122,0)
 .S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",123,0)
 D WRTE
"RTN","PRCH442A",124,0)
 W:$D(^TMP($J)) !!!,?10,"Total number of orders found: "_CNT
"RTN","PRCH442A",125,0)
 K ^TMP($J),CNT
"RTN","PRCH442A",126,0)
 Q
"RTN","PRCH442A",127,0)
 ;
"RTN","PRCH442A",128,0)
DETAIL1 ;Get tally for the PC user and exclude the Approving Official.
"RTN","PRCH442A",129,0)
 Q:$G(FLAG)=1
"RTN","PRCH442A",130,0)
 ;if the PC Coordinator is asking for the report, get the orders.
"RTN","PRCH442A",131,0)
 I $G(FLAG)="" D DETAIL2
"RTN","PRCH442A",132,0)
 Q:$P($G(^PRC(442,ZP,12)),"^",4)'=DUZ!($G(FLAG)'=0)
"RTN","PRCH442A",133,0)
 S PA=$P(^PRC(442,ZP,12),"^",4),PANAME=$P(^VA(200,PA,0),"^") Q:PANAME=""
"RTN","PRCH442A",134,0)
 S Y=$P(^PRC(442,ZP,12),"^",5) D DD^%DT S ADATE=Y,PODATE=$P(Y,"@",1)
"RTN","PRCH442A",135,0)
 S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",136,0)
 S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",137,0)
 Q
"RTN","PRCH442A",138,0)
 ;
"RTN","PRCH442A",139,0)
DETAIL2 ;Get tally for the PC Coordinator.
"RTN","PRCH442A",140,0)
 S PA=$P(^PRC(442,ZP,12),"^",4),PANAME=$P(^VA(200,PA,0),"^") Q:PANAME=""
"RTN","PRCH442A",141,0)
 S Y=$P(^PRC(442,ZP,12),"^",5) D DD^%DT S ADATE=Y,PODATE=$P(Y,"@",1)
"RTN","PRCH442A",142,0)
 S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",143,0)
 S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",144,0)
 Q
"RTN","PRCH442A",145,0)
 ;
"RTN","PRCH442A",146,0)
WRTE ;
"RTN","PRCH442A",147,0)
 U IO S (P,EX)=1
"RTN","PRCH442A",148,0)
 I '$D(^TMP($J)) D HDR W !!!!,?10,"*** NO RECORDS TO PRINT ***" Q
"RTN","PRCH442A",149,0)
 S ZP="" F  S ZP=$O(^TMP($J,ZP)) Q:ZP=""  Q:EX="^"  D
"RTN","PRCH442A",150,0)
 .D:P=1 HDR
"RTN","PRCH442A",151,0)
 .W !,$P(^TMP($J,ZP),"^"),?21,$P(^TMP($J,ZP),"^",2),?40,$P(^TMP($J,ZP),"^",3),!,?10,$P(^TMP($J,ZP),"^",4),?40,$P(^TMP($J,ZP),"^",5),!
"RTN","PRCH442A",152,0)
 .I (IOSL-$Y)<6 D HLD Q:EX="^"
"RTN","PRCH442A",153,0)
 QUIT
"RTN","PRCH442A",154,0)
 ;
"RTN","PRCH442A",155,0)
C2237 ;cancel 2237 from PC order
"RTN","PRCH442A",156,0)
 N I,N,T,X,ZX,PRCVIEN
"RTN","PRCH442A",157,0)
 Q:'$D(DA)  S YDA=DA,PRCVIEN=DA,XDA=$P($G(^PRC(442,DA,23)),"^",23) Q:XDA=""  L +^PRCS(410,XDA):15 Q:'$T
"RTN","PRCH442A",158,0)
 S PRC("CP")=$P($G(^PRC(442,YDA,0)),"^",3) Q:+PRC("CP")=""
"RTN","PRCH442A",159,0)
 S T=$P(^PRCS(410,XDA,0),"^"),$P(^(11),"^",3)="",$P(^(0),"^",2)="CA",$P(^(5),"^")=0,$P(^(6),"^")=0 K ^PRCS(410,"F",+T_"-"_+PRC("CP")_"-"_$P(T,"-",5),XDA),^PRCS(410,"F1",$P(T,"-",5)_"-"_+T_"-"_+PRC("CP"),XDA),^PRCS(410,"AQ",1,XDA)
"RTN","PRCH442A",160,0)
 K ZX I $D(^PRCS(410,XDA,4)) S ZX=^(4),X=$P(ZX,"^",8) F I=1,3,6,8 S $P(ZX,"^",I)=0
"RTN","PRCH442A",161,0)
 I $D(ZX) S ^PRCS(410,XDA,4)=ZX K ZX
"RTN","PRCH442A",162,0)
 I $D(^PRCS(410,XDA,12,0)) S N=0 F I=0:0 S N=$O(^PRCS(410,XDA,12,N)) Q:N'>0  S X=$P(^(N,0),"^",2) I X S DA(1)=XDA,DA=N D TRANK^PRCSEZZ S XDA=DA(1)
"RTN","PRCH442A",163,0)
 D ERS410^PRC0G(XDA_"^C")
"RTN","PRCH442A",164,0)
 L -^PRCS(410,XDA)
"RTN","PRCH442A",165,0)
 I $D(^PRC(443,XDA,0)) S DA=XDA,DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCH442A",166,0)
 S DA=YDA
"RTN","PRCH442A",167,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCH442A",168,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D DEL^PRCV442A(PRCVIEN)
"RTN","PRCH442A",169,0)
 QUIT
"RTN","PRCH442A",170,0)
 ;
"RTN","PRCH442A",171,0)
RENUM ;  delete delivery order items from repetitive item list
"RTN","PRCH442A",172,0)
 Q:$G(^PRCS(410.3,YDA,0))=""
"RTN","PRCH442A",173,0)
 L +^PRCS(410.3,YDA):15 Q:'$T
"RTN","PRCH442A",174,0)
 S IJ="" F  S IJ=$O(^PRCS(410.3,YDA,1,IJ)) Q:IJ=""  D
"RTN","PRCH442A",175,0)
 .I $P($G(^PRCS(410.3,YDA,1,IJ,0)),"^",6)="O" S DA=IJ,DA(1)=YDA,DIK="^PRCS(410.3,"_DA(1)_",1," D ^DIK
"RTN","PRCH442A",176,0)
 L -^PRCS(410.3,YDA)
"RTN","PRCH442A",177,0)
 I $P($G(^PRCS(410.3,YDA,1,0)),"^",4)=0 W !,"This Repetitive Item List has no more items, and will be deleted." S DA=YDA,DIK="^PRCS(410.3," D ^DIK
"RTN","PRCH442A",178,0)
 K DIK QUIT
"RTN","PRCH442A",179,0)
 ;
"RTN","PRCH442A",180,0)
HDR W @IOF
"RTN","PRCH442A",181,0)
 W !,"INCOMPLETE PURCHASE CARD ORDERS REPORT",?45,TIMEDATE,?70,"PAGE ",P
"RTN","PRCH442A",182,0)
 W !,"PURCHASE CARD ORDER",?21,"PO DATE",?40,"SUPPLY STATUS",!,?10,"BUYER",?40,"DATE PO ASSIGNED"
"RTN","PRCH442A",183,0)
 W ! F I=1:1:8 W "----------"
"RTN","PRCH442A",184,0)
 S P=P+1
"RTN","PRCH442A",185,0)
 QUIT
"RTN","PRCH442A",186,0)
 ;
"RTN","PRCH442A",187,0)
HLD G HDR:$P(IOST,"-")="P" W !,"Press return to continue, '^' to exit: " R XXZ:DTIME S:XXZ="^" EX="^" S:'$T EX="^" D:EX'["^" HDR QUIT
"RTN","PRCHAM")
0^33^B33017257
"RTN","PRCHAM",1,0)
PRCHAM ;WOIFO/ID/RSD,SF-ISC/TKW/BGJ/AS-AMENDMENTS TO P.O. ;3/8/05
"RTN","PRCHAM",2,0)
V ;;5.1;IFCAP;**14,38,81**;Oct 20, 2000
"RTN","PRCHAM",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHAM",4,0)
ENAV D LCK^PRCHAM3 G:$T Q S PRCH(0)=Y(0),PRCH(1)=^PRC(442,PRCHPO,1),PRCH(7)=^(7),PRCH(12)=^(12),(PRCHAMT,PRCHAN,PRCHDL,PRCHAREC,PRCHCHK)=0
"RTN","PRCHAM",5,0)
 I $D(^PRC(442,PRCHPO,6)) F I=0:0 S I=$O(^PRC(442,PRCHPO,6,I)) Q:'I  S PRCHAN=I
"RTN","PRCHAM",6,0)
 S PRCHAN=PRCHAN+1 W !?5,"Adjustment number: ",PRCHAN S %=1,%A="      Do you wish to continue",%B="" D ^PRCFYN G:%'=1 Q
"RTN","PRCHAM",7,0)
 S:'$D(PRCHAM) PRCHAM=PRCHAN
"RTN","PRCHAM",8,0)
 S ^PRC(443.6,PRCHPO,0)=PRCH(0),^(1)=PRCH(1),^(7)=PRCH(7),^(12)=PRCH(12),DIE="^PRC(443.6,",DR="[PRCHAMEND]" S:$D(PRCHAV) DR="[PRCHAMENDAV]"
"RTN","PRCHAM",9,0)
 D ^DIE G:$D(Y) Q I '$D(^PRC(443.6,PRCHPO,6,PRCHAN,1)) W !?5,"Can't continue without a Purchasing Agent !" G Q
"RTN","PRCHAM",10,0)
 S PRCHLC=$P(PRCH(0),U,14) Q:$D(PRCHAV)  G ^PRCHAM1
"RTN","PRCHAM",11,0)
EN S X=PRCHL1_PRCHO_PRCHL2_PRCHN,J=0,PRCHCHK=1 S:'$D(^PRC(443.6,PRCHPO,6,PRCHAN,2,0)) ^(0)="^^^^"_DT
"RTN","PRCHAM",12,0)
 F I=0:0 S I=$O(^PRC(443.6,PRCHPO,6,PRCHAN,2,I)) Q:'I  S J=J+1
"RTN","PRCHAM",13,0)
 G:PRCHL1="*" EN1 S ^PRC(443.6,PRCHPO,6,PRCHAN,2,0)="^^"_($P(^PRC(443.6,PRCHPO,6,PRCHAN,2,0),U,3)+1)_U_($P(^(0),U,4)+1)_U_DT,^PRC(443.6,PRCHPO,6,PRCHAN,2,J+1,0)=" "_X I '$D(^TMP("PRCHW",$J)) S ^PRC(443.6,PRCHPO,6,PRCHAN,2,J+2,0)="  " Q
"RTN","PRCHAM",14,0)
EN1 F I=0:0 S I=$O(^TMP("PRCHW",$J,I)) Q:'I  S X=^TMP("PRCHW",$J,I),J=J+1 S:($L(X)+1)'>255 X=" "_X S ^PRC(443.6,PRCHPO,6,PRCHAN,2,J,0)=X
"RTN","PRCHAM",15,0)
 S ^PRC(443.6,PRCHPO,6,PRCHAN,2,0)="^^"_J_U_J_DT,^(J+1,0)="  " K ^TMP("PRCHW",$J) Q
"RTN","PRCHAM",16,0)
CHK G:PRCHCHK=0 Q I PRCHAREC W !?3,"Recalculating Discounts ..." D RECAL^PRCHAM3 I $D(^TMP("PRCHW",$J)) S PRCHL1="*",(PRCHN,PRCHO,PRCHL2)="" D EN
"RTN","PRCHAM",17,0)
 S:PRCHAMT $P(^PRC(443.6,PRCHPO,6,PRCHAN,0),U,3)=PRCHAMT,$P(^(0),U,15)=$P(^PRC(443.6,PRCHPO,0),U,15)+PRCHAMT
"RTN","PRCHAM",18,0)
 I PRCHDL D UPDT^PRCHAM3
"RTN","PRCHAM",19,0)
EN2 S $P(^PRC(443.6,PRCHPO,0),U,14)=PRCHLC,%=1,%B="",%A="     Review Adjustment " W ! D ^PRCFYN I %=1 S D0=PRCHPO,D1=PRCHAN,PRCH="^PRC(443.6," D ^PRCHDAM
"RTN","PRCHAM",20,0)
 S %A="     Edit Description ",%=2,%B="Enter 'YES' to edit the Adjustment Description or 'NO' to continue." D ^PRCFYN I %=1 S DIE="^PRC(443.6,",DA=PRCHPO,DR="[PRCHAMDESC]" D ^DIE
"RTN","PRCHAM",21,0)
 I $P(^PRC(443.6,PRCHPO,0),U,2)=25!($P(^(0),U,2)=26) S NOFISCAL=1
"RTN","PRCHAM",22,0)
 S %A="     Approve and print"_$S('$G(NOFISCAL):" (in FISCAL and SUPPLY)",1:"")_" Adjustment no.: "_PRCHAN,%B="",%=2 D ^PRCFYN I %'=1 W !?10,"Adjustment Deleted !",$C(7) G Q
"RTN","PRCHAM",23,0)
 S P=+$S($D(^PRC(443.6,PRCHPO,6,PRCHAN,1)):^(1),1:"") I P="" W !?5,"Purchasing Agent Field is undefined !",$C(7) G Q
"RTN","PRCHAM",24,0)
 I P'=DUZ D ESIG^PRCHAM44
"RTN","PRCHAM",25,0)
 S DA=PRCHPO S PRCSIG="" D ESIG^PRCUESIG(P,.PRCSIG) I PRCSIG<1 S ROUTINE="PRCUESIG" G QQ
"RTN","PRCHAM",26,0)
 S PRCSUM=$$SUM^PRCUESIG(PRCHPO_"^"_$$STRING^PRCHES5(^PRC(442,PRCHPO,0),^PRC(442,PRCHPO,1),^PRC(442,PRCHPO,12)))
"RTN","PRCHAM",27,0)
 S PRCSIG="" D ENCODE^PRCHES10(PRCHPO,PRCHAN,P,.PRCSIG) S ROUTINE="PRCHAM" G:PRCSIG<1 QQ S X=$P(^PRC(443.6,PRCHPO,6,PRCHAN,1),U,4) S:X]"" $P(^PRC(443.6,PRCHPO,7),U,1)=X
"RTN","PRCHAM",28,0)
 S PRCSIG="" D RECODE^PRCHES12(PRCHPO,PRCSUM,.PRCSIG) S ROUTINE="PRCHAM" G:PRCSIG<1 QQ K PRCSUM
"RTN","PRCHAM",29,0)
 F I=2,3,5,6 I $D(^PRC(443.6,PRCHPO,I,0))#2 S $P(^(0),U,2)=$P(",442.01IA,442.03A,,442.06A,442.07",",",I)
"RTN","PRCHAM",30,0)
 I $D(^PRC(443.6,PRCHPO,7)) S X=+^(7),Y=X I X S DA=PRCHPO D UPD^PRCHSTAT S ^PRC(443.6,PRCHPO,7)=^PRC(442,PRCHPO,7)
"RTN","PRCHAM",31,0)
 D WAIT^DICD
"RTN","PRCHAM",32,0)
 ;
"RTN","PRCHAM",33,0)
 ;Check for any Adjustment for PO. If any, save the Adjustment Number
"RTN","PRCHAM",34,0)
 ;at Partial node and save the Partial Number at Adjustment Node.
"RTN","PRCHAM",35,0)
 ;If no Adjustment on PO then skip it. Patch PRC*5.1*38
"RTN","PRCHAM",36,0)
 ;
"RTN","PRCHAM",37,0)
ADJESIG G:'$D(^PRC(443.6,PRCHPO,6,0)) SKIPIT
"RTN","PRCHAM",38,0)
 S ADJDATA=$G(^PRC(443.6,PRCHPO,6,PRCHAN,0))
"RTN","PRCHAM",39,0)
 I $P(ADJDATA,U,8)'="Y" G SKIPIT
"RTN","PRCHAM",40,0)
 S PRTDATA=$G(^PRC(443.6,PRCHPO,11,PRCHAV,0))
"RTN","PRCHAM",41,0)
 S $P(PRTDATA,U,21)=PRCHAN
"RTN","PRCHAM",42,0)
 S ^PRC(443.6,PRCHPO,11,PRCHAV,0)=PRTDATA
"RTN","PRCHAM",43,0)
 S $P(ADJDATA,U,13)=PRCHAV
"RTN","PRCHAM",44,0)
 S ^PRC(443.6,PRCHPO,6,PRCHAN,0)=ADJDATA
"RTN","PRCHAM",45,0)
 K ADJDATA,PRTDATA
"RTN","PRCHAM",46,0)
 ;
"RTN","PRCHAM",47,0)
SKIPIT D WAIT^DICD S %X="^PRC(443.6,PRCHPO,",%Y="^PRC(442,PRCHPO," D %XY^%RCR I $D(PRCHNPO) S $P(^PRC(442,PRCHNPO,0),U,1)=PRCHNPO(0)
"RTN","PRCHAM",48,0)
 I $D(^PRC(442,PRCHPO,6,0)) D
"RTN","PRCHAM",49,0)
 . S $P(^PRC(442,PRCHPO,6,PRCHAN,0),U,12)=""
"RTN","PRCHAM",50,0)
 I '$D(PRCHAV) G JMP
"RTN","PRCHAM",51,0)
 S PRCSUM=$$SUM^PRCUESIG(PRCHPO_"^"_$$STRING^PRCHES1(^PRC(442,PRCHPO,11,PRCHAV,0)))
"RTN","PRCHAM",52,0)
 S PRCSIG="" D RECODE^PRCHES1(PRCHPO,PRCHAV,PRCSUM,.PRCSIG) S ROUTINE="PRCHAM" G:PRCSIG<1 QQ K PRCSUM
"RTN","PRCHAM",53,0)
 ;   Transmit RR Adj info to DynaMed  **81**
"RTN","PRCHAM",54,0)
 D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ENT^PRCVRRA(PRCHPO,PRCHAV)
"RTN","PRCHAM",55,0)
 ;
"RTN","PRCHAM",56,0)
 I $P(^PRC(442,PRCHPO,11,PRCHAV,0),U,16)="" G JMP
"RTN","PRCHAM",57,0)
 S PRCSUM=$$SUM^PRCUESIG(PRCHPO_"^"_$$STRING^PRCHES2(^PRC(442,PRCHPO,11,PRCHAV,0),^PRC(442,PRCHPO,11,PRCHAV,1)))
"RTN","PRCHAM",58,0)
 S PRCSIG="" D RECODE^PRCHES2(PRCHPO,PRCHAV,PRCSUM,.PRCSIG) S ROUTINE="PRCHAM" G:PRCSIG<1 QQ K PRCSUM,PRCHNFLG
"RTN","PRCHAM",59,0)
JMP D SETC^PRCHAM4
"RTN","PRCHAM",60,0)
 I $D(PRCHX) S I=0 F J=1:1 S I=$O(PRCHX(I)) Q:I=""  S Z=I,Y=$O(PRCHX(Z,0)) I Z]"",Y]"" S X=Z K @PRCHX(Z,Y) S:Y'="@" X=Y,@PRCHX(Z,Y)=""
"RTN","PRCHAM",61,0)
 S DA(1)=PRCHPO,N=0,DIK(1)=".01^C" F  S N=$O(^PRC(442,DA(1),2,N)) Q:'N  D
"RTN","PRCHAM",62,0)
 .S DA=N,DIK="^PRC(442,"_DA(1)_",2," D EN^DIK
"RTN","PRCHAM",63,0)
 K DA,DIK,N
"RTN","PRCHAM",64,0)
 I '$D(DT) D NOW^%DTC S DT=$P(%,".",1)
"RTN","PRCHAM",65,0)
 S PRCHCV=$S($D(^PRC(442,PRCHPO,1)):+^(1),1:0) ;I PRCHCV D ENUI^PRCHAM5
"RTN","PRCHAM",66,0)
 S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHAM",67,0)
 W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM",D0=PRCHPO,D1=PRCHAN D ^PRCHSF S D0=PRCHPO,D1=PRCHAN D ^PRCHQUE K ZTSK
"RTN","PRCHAM",68,0)
 I $D(PRC("PARAM")),$P(PRC("PARAM"),U,4)="Y",'$G(NOFISCAL) W !?3,"SEND TO FISCAL ",! S PRCHQ="^PRCHPAM",PRCHQ("DEST")="F",D0=PRCHPO,D1=PRCHAN D ^PRCHQUE
"RTN","PRCHAM",69,0)
 G Q
"RTN","PRCHAM",70,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0)
"RTN","PRCHAM",71,0)
 W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!" W !," ADJUSTMENT VOUCHER DELETED",$C(7) S DIR(0)="EAO",DIR("A")="Press <Return> to continue " D ^DIR
"RTN","PRCHAM",72,0)
Q K ^PRC(443.6,PRCHPO),AMT,I,J,K,X,Y,Z,X1,X2,PRCH,PRCHCV,PRCHPO,PRCHAMT,PRCHAN,PRCHA,PRCHAV,PRCHAREC,PRCHL1,PRCHL2,PRCHLC,PRCHO,PRCHN,PRCHNPO,PRCHD0,PRCHP0,PRCHAC,PRCHACT,PRCHDA,PRCHDT,ROUTINE
"RTN","PRCHAM",73,0)
 D KILL^PRCHAM44 K PRCHAVLD,PRCHCHK,PRCHII,PRCHITR,PRCHITSB,PRCHQTY,PRCHRPTN,PRCHRPTO,PRCHSAM1,PRCHSAM2,PRCHJJ,PRCHMM,PRCHSHIP,PRCHXX1,NOFISCAL L  Q
"RTN","PRCHE")
0^54^B42437164
"RTN","PRCHE",1,0)
PRCHE ;ID/RSD,SF-ISC/TKW/BGJ-EDIT ROUTINES FOR SUPPLY SYSTEM ;5/10/99  16:35
"RTN","PRCHE",2,0)
V ;;5.1;IFCAP;**1,28,39,81**;Oct 20, 2000
"RTN","PRCHE",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHE",4,0)
EN1 ;ITEM FILE EDIT
"RTN","PRCHE",5,0)
 N PRCVDA
"RTN","PRCHE",6,0)
 I '$D(PRC("PARAM")) S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("PARAM"))
"RTN","PRCHE",7,0)
 W !! D DISP^PRCOSS1 S DIC="^PRC(441,",DIC(0)="AEMQL",DR="[PRCHITEM]",DLAYGO=441,PRCHPO="" D DIE K PRCHPO
"RTN","PRCHE",8,0)
 S PRCVDA=$G(Y)
"RTN","PRCHE",9,0)
 I Y<0 D CHECK^PRCOSS1 Q
"RTN","PRCHE",10,0)
 S (PRCHDA,DA,DA(1))=+Y I $O(^PRC(441,DA,4,0)) S DIC="^PRC(441,"_DA(1)_",4,",DIC(0)="QEMAN" D ^DIC I Y>0 S DA=+Y,DIE=DIC,DR=3 D ^DIE,Q
"RTN","PRCHE",11,0)
 ; If either ITEM record (and FCP fields) created or updated, and
"RTN","PRCHE",12,0)
 ; this site is a DynaMed Interface site
"RTN","PRCHE",13,0)
 I $G(PRCVDA),$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D ONECHK^PRCVIT(PRCVDA)
"RTN","PRCHE",14,0)
 I $P(^PRC(441,PRCHDA,0),U,10)="",$P(PRC("PARAM"),U,16)="Y" W $C(7),!!,"Warning--BOC is missing from this item--you should",!,"re-edit the item!!",!
"RTN","PRCHE",15,0)
 I $O(^PRCP(445,"AH",PRCHDA,""))]"" D BLDSEG^PRCPHLFM(3,PRCHDA,0) ; update supply stations
"RTN","PRCHE",16,0)
 K PRCHDA G EN1
"RTN","PRCHE",17,0)
 ;
"RTN","PRCHE",18,0)
EN2 ;EDIT SITE PARAMETERS
"RTN","PRCHE",19,0)
 N X R !,"STATION NUMBER: ",X:DTIME Q:'$T!(X["^")!(X="")
"RTN","PRCHE",20,0)
 I "???"[X D EN2DSP G EN2
"RTN","PRCHE",21,0)
 I X'?3N W !,"Please enter a 3 digit number or '^' to exit.  If attempting to enter substation information, please use 'Substation Enter/Edit'." G EN2
"RTN","PRCHE",22,0)
 I $D(^PRC(411,"B",X)) G EN2A
"RTN","PRCHE",23,0)
 N PRCX
"RTN","PRCHE",24,0)
 S PRCX=$O(^DIC(4,"D",X,"")) I PRCX="" W " ?? (That is not a valid Station Number)" G EN2
"RTN","PRCHE",25,0)
 S PRCX=$P($G(^DIC(4,PRCX,0)),U,1)
"RTN","PRCHE",26,0)
 D EN^DDIOL("Do you wish to add "_X_" ("_PRCX_") as a NEW station")
"RTN","PRCHE",27,0)
 S %=0 D YN^DICN I %'=1 G EN2
"RTN","PRCHE",28,0)
 ;
"RTN","PRCHE",29,0)
EN2A S DIC="^PRC(411,",DIC(0)="LX",DR="[PRCHSITE]",DLAYGO=411 D DIE
"RTN","PRCHE",30,0)
 G EN2
"RTN","PRCHE",31,0)
EN2DSP ;Display entries from file #411 if they are Ok in file #4. Otherwise,
"RTN","PRCHE",32,0)
 ;alert user about any incomplete entry.
"RTN","PRCHE",33,0)
 N PRCDA,PRCA,J,PRCIEN,PRCINSN
"RTN","PRCHE",34,0)
 S PRCDA=0 F J=2:0 S PRCDA=$O(^PRC(411,"B",PRCDA)) Q:PRCDA=""  D
"RTN","PRCHE",35,0)
 . S PRCIEN=$O(^PRC(411,"B",PRCDA,"")) I $D(^PRC(411,PRCIEN,0))#10 D 
"RTN","PRCHE",36,0)
 .. S PRCA=$P($G(^PRC(411,PRCIEN,0)),U,1) I PRCA?3N D
"RTN","PRCHE",37,0)
 ... S PRCA(J)=$J("",5)_PRCA_"  "
"RTN","PRCHE",38,0)
 ... S PRCINSN=$O(^DIC(4,"D",PRCDA,"")) I PRCINSN']"" D  Q
"RTN","PRCHE",39,0)
 .... W !,$C(7),?5,"ENTRY "_PRCDA_" IS NOT SET UP PROPERLY IN FILE #4. PLEASE CALL IRM"
"RTN","PRCHE",40,0)
 ... S PRCA(J)=PRCA(J)_$P($G(^DIC(4,PRCINSN,0)),U,1),J=J+1
"RTN","PRCHE",41,0)
 I J>2 S PRCA(1)=" ",PRCA(J)=" " D EN^DDIOL(.PRCA)
"RTN","PRCHE",42,0)
 Q
"RTN","PRCHE",43,0)
EN3 ;EDIT VENDOR FILE
"RTN","PRCHE",44,0)
 S DIC="^PRC(440,",DIC(0)="AEMQL",DR="[PRCHVENDOR1]",DLAYGO=440 K PRCHPO D DIE Q:Y<0  G EN3
"RTN","PRCHE",45,0)
 ;
"RTN","PRCHE",46,0)
EN5 ;ENTER A NEW P.O.
"RTN","PRCHE",47,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",48,0)
EN50 D ENPO^PRCHUTL Q:'$D(PRCHPO)  D LCK1 G:'$D(DA) EN50 D ^PRCHNPO L  G EN50
"RTN","PRCHE",49,0)
 ;
"RTN","PRCHE",50,0)
EN6 ;EDIT AN INCOMPLETE P.O.
"RTN","PRCHE",51,0)
 ;Edit an Incomplete Purchase Order created by 'New Purchase Order' option only
"RTN","PRCHE",52,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",53,0)
EN60 N FLG1 S FLG1=1 D PO Q:'$D(PRCHPO)
"RTN","PRCHE",54,0)
 D LCK1 G:'$D(DA) EN60 D ^PRCHNPO L  G EN60
"RTN","PRCHE",55,0)
 ;
"RTN","PRCHE",56,0)
EN8 ;DELETE A RECEIVING REPORT
"RTN","PRCHE",57,0)
 N FLG1 S FLG1=0 D ST Q:'$D(PRC("SITE"))  G EN80^PRCHEF
"RTN","PRCHE",58,0)
 ;
"RTN","PRCHE",59,0)
EN9 ;EDIT COMMON NUMBERING SERIES
"RTN","PRCHE",60,0)
 W ! S DIC="^PRC(442.6,",DIC(0)="AEMQL",DR=".01:99",DLAYGO=442.6 D DIE Q:Y<0  I $D(^PRC(442.6,+Y)),$P(^(+Y,0),U,5)="" W !!,$C(7),"NOTE: Since you have left the USING SECTION field empty, these",!,"numbers can only be used by P&C.",!
"RTN","PRCHE",61,0)
 G EN9
"RTN","PRCHE",62,0)
 ;
"RTN","PRCHE",63,0)
EN10 ;EDIT SUPPLY EMPLOYEE INFORMATION
"RTN","PRCHE",64,0)
 K DIC,DA,X,Y S DIC="^VA(200,",DIC(0)="AEMQ" D ^DIC
"RTN","PRCHE",65,0)
 G:Y<0 EN10Q
"RTN","PRCHE",66,0)
 S DA=+Y L +^VA(200,DA):0 E  W $C(7),!,"ANOTHER USER IS EDITING THIS ENTRY!" G EN10
"RTN","PRCHE",67,0)
 K DR,DIE S DR="400;.135;.136;.151",DIE=DIC D ^DIE K DIE,DR
"RTN","PRCHE",68,0)
 L -^VA(200,DA)
"RTN","PRCHE",69,0)
 W !?5,"To edit the Signature Block Printed Name or title, Use TBOX",!
"RTN","PRCHE",70,0)
 G:'$D(DTOUT) EN10
"RTN","PRCHE",71,0)
EN10Q K DIC,DIE,X,Y,DA,DR,DTOUT,DUOUT
"RTN","PRCHE",72,0)
 Q
"RTN","PRCHE",73,0)
 ;
"RTN","PRCHE",74,0)
EN11 ;EDIT ADMINISTRATIVE CERTIFICATIONS
"RTN","PRCHE",75,0)
 S DIC="^PRC(442.7,",DIC(0)="AEMLQ",DR=".01:99",DLAYGO=442.7 D DIE Q:Y<0  G EN11
"RTN","PRCHE",76,0)
 ;
"RTN","PRCHE",77,0)
EN12 ;EDIT DELIVERY DATE
"RTN","PRCHE",78,0)
 N PRCHP D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",79,0)
 ;S PRCHP("S")="$P($G(^(7)),U,2)>19,$P($G(^(7)),U,2)<30,($P($G(^(0)),U,2)=25!($S($D(PRCHNRQ):$P($G(^(0)),U,2)=8,1:$P($G(^(0)),U,2)<8)))"
"RTN","PRCHE",80,0)
EN120 D PORQ I '$D(PRCHPO) G Q
"RTN","PRCHE",81,0)
 ;I X<20!(X>29) W " ??",$C(7) G EN120
"RTN","PRCHE",82,0)
 I "^20^21^22^23^24^25^26^27^28^29^32^34^39^44^46^47^"'[(U_X_U) W " ??",$C(7) G EN120
"RTN","PRCHE",83,0)
 D LCK1 G:'$D(DA) EN120
"RTN","PRCHE",84,0)
 S D0=DA,%=2,%B="",%A="REVIEW ORDER " D ^PRCFYN D:%=1 ^PRCHDP1
"RTN","PRCHE",85,0)
 W ! S PRCHDT=$P(^PRC(442,PRCHPO,0),U,10) S DA=PRCHPO,DIE="^PRC(442,",DR="[PRCHDEL]" D ^DIE S X=$P(^PRC(442,PRCHPO,0),U,10) I X,X'=PRCHDT,$P(^(0),U,20)="" S $P(^(0),U,20)=PRCHDT
"RTN","PRCHE",86,0)
 ; trigger bulletin for changed delivery date
"RTN","PRCHE",87,0)
 S PRCHDTT=$P(^PRC(442,PRCHPO,0),U,10) I PRCHDTT'=PRCHDT D ^PRCFACS2
"RTN","PRCHE",88,0)
 K PRCHDT D Q G EN120
"RTN","PRCHE",89,0)
 ;
"RTN","PRCHE",90,0)
EN13 ; Delete 2237 option has been de-activated.
"RTN","PRCHE",91,0)
 ; See documentation for PRC*5*128.
"RTN","PRCHE",92,0)
 Q
"RTN","PRCHE",93,0)
EN14 ;CREATE ADJUSTMENT VOUCHER
"RTN","PRCHE",94,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",95,0)
EN140 D PORQ Q:'$D(PRCHPO)
"RTN","PRCHE",96,0)
 I X=28!(X=33) W $C(7),!,"Adjustment Vouchers not allowed until after order has been Obligated!!" G EN140
"RTN","PRCHE",97,0)
 I '$O(^PRC(442,PRCHPO,11,0)) W !?3,"Order has no Receiving Reports !",$C(7) G EN140
"RTN","PRCHE",98,0)
 D ^PRCHAM4 G EN140
"RTN","PRCHE",99,0)
 ;
"RTN","PRCHE",100,0)
EN15 ;ENTER LOG DEPARTMENTS TO FCP FILE (420)
"RTN","PRCHE",101,0)
 D ST Q:'$D(PRC("SITE"))
"RTN","PRCHE",102,0)
EN150 S DIC="^PRC(420,"_PRC("SITE")_",1,",DIC(0)="AEMNQ"
"RTN","PRCHE",103,0)
 S DIC("A")="Select CONTROL POINT: ",D="B^C" D MIX^DIC1 G:Y<0 Q
"RTN","PRCHE",104,0)
 S DIE=DIC,DA(1)=PRC("SITE"),DA=+Y,DR=19 D ^DIE
"RTN","PRCHE",105,0)
 D:$P(^PRC(420,DA(1),1,DA,0),U,18)?1"11".E
"RTN","PRCHE",106,0)
 .  W !,">>> You have just assigned a LOG DEPARTMENT that should only be used for        Subsistence FCPs.  If that is NOT true, please reassign it or you will be       asked for a Food Group on every item purchased."
"RTN","PRCHE",107,0)
 G EN150
"RTN","PRCHE",108,0)
 ;
"RTN","PRCHE",109,0)
DIE S PRCHDA=-1 D ^DIC
"RTN","PRCHE",110,0)
 I Y>0 S PRCHDA=+Y,DIE=DIC,DA=+Y D LCK I $D(DA) D ^DIE
"RTN","PRCHE",111,0)
 S Y=PRCHDA K PRCHDA G Q
"RTN","PRCHE",112,0)
 ;
"RTN","PRCHE",113,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0) W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7) S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR
"RTN","PRCHE",114,0)
 ;
"RTN","PRCHE",115,0)
Q K DA,DIC,DIE,DIK,DR,DLAYGO,D0,E,I,J,L,PRCHEX,PRCHPUSH,%,ROUTINE,CHECK L
"RTN","PRCHE",116,0)
 Q
"RTN","PRCHE",117,0)
 ;
"RTN","PRCHE",118,0)
LCK1 S DIC="^PRC(442,"
"RTN","PRCHE",119,0)
 ;
"RTN","PRCHE",120,0)
LCK L @(DIC_DA_"):0") E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHE",121,0)
 Q
"RTN","PRCHE",122,0)
 ;
"RTN","PRCHE",123,0)
ST S PRCF("X")="S" D ^PRCFSITE
"RTN","PRCHE",124,0)
 Q
"RTN","PRCHE",125,0)
 ;
"RTN","PRCHE",126,0)
PO S PRCHP("A")="P.O./REQ.NO.: "
"RTN","PRCHE",127,0)
 S PRCHP("S")=$S(FLG1:"$P($G(^(7)),U,2)<10,($P(^(0),U,2)<10!($P(^(0),U,2)=25&($P($G(^(23)),U,11)=""""))!($P(^(0),U,2)=26))",1:"$P(^(0),U,2)<10!($P(^(0),U,2)=25)!($P(^(0),U,2)=26)")
"RTN","PRCHE",128,0)
 S:$G(PRCHPC)=1 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""S"""
"RTN","PRCHE",129,0)
 S:$G(PRCHPC)=2 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",130,0)
 S:$G(PRCHDELV) PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(23)),U,11)=""D"",$P(^(0),U,2)'=26"
"RTN","PRCHE",131,0)
 S:$G(PRCHPC)=3 PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P($G(^(0)),U,2)=25,$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",132,0)
 S:$G(PRCHPHAM) PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(23)),U,11)=""D"",$P(^(0),U,2)=26"
"RTN","PRCHE",133,0)
 D EN3^PRCHPAT
"RTN","PRCHE",134,0)
 Q
"RTN","PRCHE",135,0)
 ;
"RTN","PRCHE",136,0)
PORQ S:$D(PRCHNRQ) PRCHP("A")="REQUISITION NO.: "
"RTN","PRCHE",137,0)
 I $G(PRCHAUTH)=1 S PRCHP("S")="$P($G(^(23)),U,11)=""P"""
"RTN","PRCHE",138,0)
 I $G(PRCHAUTH)=2 S PRCHP("S")="$P($G(^(23)),U,11)=""D"""
"RTN","PRCHE",139,0)
 D EN3^PRCHPAT
"RTN","PRCHE",140,0)
 Q
"RTN","PRCHE1")
0^47^B23958557
"RTN","PRCHE1",1,0)
PRCHE1 ;WISC/DJM/BGJ/AS-IFCAP EDIT VENDOR FILE ;3/8/05
"RTN","PRCHE1",2,0)
V ;;5.1;IFCAP;**7,59,55,81**;Oct 20, 2000
"RTN","PRCHE1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHE1",4,0)
 ;NEW ENTER/EDIT VENDOR FILE CALLED FROM PRCHPC VEN EDIT OPTION
"RTN","PRCHE1",5,0)
 N %,%X,%Y,DIE,DIK,DIR,DIRUT,DR,PRCF,SITE,DA,PRCHV3,FLAGN,FLAG
"RTN","PRCHE1",6,0)
 N DIC,DLAYGO,IEN,Y,FISCAL,VRQ,STOP,INACT,NAME,EDIT,NEW
"RTN","PRCHE1",7,0)
 ;
"RTN","PRCHE1",8,0)
VEDIT I '$D(PRC("PARAM")) D  Q:'%
"RTN","PRCHE1",9,0)
 .  S PRCF("X")="AS"
"RTN","PRCHE1",10,0)
 .  D ^PRCFSITE
"RTN","PRCHE1",11,0)
 .  Q
"RTN","PRCHE1",12,0)
 ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED   **81**
"RTN","PRCHE1",13,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1,$D(IEN) D ONECHK^PRCVNDR(IEN)
"RTN","PRCHE1",14,0)
 S SITE=PRC("SITE")
"RTN","PRCHE1",15,0)
 S DIC="^PRC(440,"
"RTN","PRCHE1",16,0)
 S DIC(0)="AELMQ"
"RTN","PRCHE1",17,0)
 S DLAYGO=440
"RTN","PRCHE1",18,0)
 S PRCHDA=-1
"RTN","PRCHE1",19,0)
 K PRCHPO
"RTN","PRCHE1",20,0)
 D ^DIC
"RTN","PRCHE1",21,0)
 Q:Y<0
"RTN","PRCHE1",22,0)
 S (IEN,DA)=+Y
"RTN","PRCHE1",23,0)
 S (FLAGN,NEW)=$P(Y,U,3)
"RTN","PRCHE1",24,0)
 G:'$D(DA) VEDIT
"RTN","PRCHE1",25,0)
 D  G:'$D(DA) VEDIT
"RTN","PRCHE1",26,0)
 .  L +^PRC(440,DA):0
"RTN","PRCHE1",27,0)
 .  E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHE1",28,0)
 .  Q
"RTN","PRCHE1",29,0)
 D  I FLAG=0 L -^PRC(440,IEN) G VEDIT
"RTN","PRCHE1",30,0)
 .  S PRCHV3=$G(^PRC(440,DA,3))
"RTN","PRCHE1",31,0)
 .  S FLAG=0
"RTN","PRCHE1",32,0)
 .  ;
"RTN","PRCHE1",33,0)
 .  ;NO FMS VENDOR CODE - DO 'ADD' VENDOR REQUEST
"RTN","PRCHE1",34,0)
 .  I $P(PRCHV3,U,4)="" S FLAG=1
"RTN","PRCHE1",35,0)
 .  ;
"RTN","PRCHE1",36,0)
 .  ;FMS VENDOR CODE - DO 'CHANGE' VENDOR REQUEST
"RTN","PRCHE1",37,0)
 .  I $P(PRCHV3,U,4)]"" S FLAG=2
"RTN","PRCHE1",38,0)
 .  ;
"RTN","PRCHE1",39,0)
 .  I $P(PRCHV3,U,12)="P" D
"RTN","PRCHE1",40,0)
 .  .  W !!,"There is a FMS Vendor Request pending for this vendor."
"RTN","PRCHE1",41,0)
 .  .  W !,"Any changes you make now may be overwritten when the Vendor"
"RTN","PRCHE1",42,0)
 .  .  W !,"Update is received.",!!
"RTN","PRCHE1",43,0)
 .  .  Q
"RTN","PRCHE1",44,0)
 .  Q
"RTN","PRCHE1",45,0)
 K ^PRC(440.3,DA)
"RTN","PRCHE1",46,0)
 I FLAGN="" D
"RTN","PRCHE1",47,0)
 .  S %X="^PRC(440,DA,"
"RTN","PRCHE1",48,0)
 .  S %Y="^PRC(440.3,DA,"
"RTN","PRCHE1",49,0)
 .  D %XY^%RCR
"RTN","PRCHE1",50,0)
 .  Q
"RTN","PRCHE1",51,0)
 ;
"RTN","PRCHE1",52,0)
 S EDIT="[PRCHVENDOR1]"
"RTN","PRCHE1",53,0)
 ;
"RTN","PRCHE1",54,0)
 ;  NOW LETS FIND OUT IF USER WANTS TO 'REACTIVATE VENDOR', IF
"RTN","PRCHE1",55,0)
 ;  APPROPRIATE.
"RTN","PRCHE1",56,0)
 ;
"RTN","PRCHE1",57,0)
 S INACT=$P($G(^PRC(440,DA,10)),U,5)
"RTN","PRCHE1",58,0)
 I INACT=1 D
"RTN","PRCHE1",59,0)
 .  S DIR("A")="Do you want to 'Reactivate' this vendor"
"RTN","PRCHE1",60,0)
 .  S DIR("A",1)="  "
"RTN","PRCHE1",61,0)
 .  S DIR("A",2)="  "
"RTN","PRCHE1",62,0)
 .  S DIR(0)="Y"
"RTN","PRCHE1",63,0)
 .  S DIR("B")="NO"
"RTN","PRCHE1",64,0)
 .  D ^DIR
"RTN","PRCHE1",65,0)
 .  I Y'=1 S EDIT="[PRCHVENDORNOREACT]" Q
"RTN","PRCHE1",66,0)
 .  ;  OK USER WANTS TO REACTIVATE VENDOR.
"RTN","PRCHE1",67,0)
 .  S DIE="^PRC(440,"
"RTN","PRCHE1",68,0)
 .  S NAME=$P($G(^PRC(440,DA,0)),U,1)
"RTN","PRCHE1",69,0)
 .  I $E(NAME,1,2)="**" S NAME=$E(NAME,3,99)
"RTN","PRCHE1",70,0)
 .  S DR=".01////^S X=NAME;15////@;31.5////@"
"RTN","PRCHE1",71,0)
 .  D ^DIE
"RTN","PRCHE1",72,0)
 .  W !!
"RTN","PRCHE1",73,0)
 .  Q
"RTN","PRCHE1",74,0)
 .  ;  NOW THE VENDOR IS REACTIVATED.
"RTN","PRCHE1",75,0)
 ;
"RTN","PRCHE1",76,0)
 S DR=EDIT
"RTN","PRCHE1",77,0)
 S DIE=DIC
"RTN","PRCHE1",78,0)
 D ^DIE
"RTN","PRCHE1",79,0)
 ; $D(Y)=TRUE (1) -- USER '^' OUT OF TEMPLATE
"RTN","PRCHE1",80,0)
 I $D(Y) D  I FLAG=0 L -^PRC(440,IEN) G VEDIT
"RTN","PRCHE1",81,0)
 .  ; CHECK TO SEE IF BUSINESS TYPE (FPDS) FIELD HAS BEEN ENTERED
"RTN","PRCHE1",82,0)
 .  I $P($G(^PRC(440,DA,2)),"^",3)="" D
"RTN","PRCHE1",83,0)
 .  .  W $C(7),!!,"*** NOT ALL REQUIRED FIELDS HAVE BEEN ENTERED ***"
"RTN","PRCHE1",84,0)
 .  .  W !,"Failure to enter required data may affect Purchase Order"
"RTN","PRCHE1",85,0)
 .  .  W " processing",!
"RTN","PRCHE1",86,0)
 .  .  ;
"RTN","PRCHE1",87,0)
 .  .  ;See NOIS:V13-0802-N1396
"RTN","PRCHE1",88,0)
 .  I $P($G(^PRC(440,DA,1.1,0)),"^",3)="" D
"RTN","PRCHE1",89,0)
 .  .  KILL ^PRC(440,DA,1.1)
"RTN","PRCHE1",90,0)
 .  .  W $C(7),!!,"*** SOCIOECONOMIC GROUP IS MISSING ***"
"RTN","PRCHE1",91,0)
 .  .  W !,"Failure to enter required data may affect Purchase Order"
"RTN","PRCHE1",92,0)
 .  .  W " processing",!
"RTN","PRCHE1",93,0)
 .  ;
"RTN","PRCHE1",94,0)
 .  S DIR("A")="Do you want to keep the VENDOR changes"
"RTN","PRCHE1",95,0)
 .  S DIR(0)="Y"
"RTN","PRCHE1",96,0)
 .  S DIR("B")="YES"
"RTN","PRCHE1",97,0)
 .  D ^DIR
"RTN","PRCHE1",98,0)
 .  ; KILL VARIABLES SET TO USE THE READER
"RTN","PRCHE1",99,0)
 .  K DIR
"RTN","PRCHE1",100,0)
 .  ; DIRUT SET IF USER TIMES OUT OR ENTERS '^'.
"RTN","PRCHE1",101,0)
 .  Q:$D(DIRUT)
"RTN","PRCHE1",102,0)
 .  ; Y=1 -- USER WANTS TO KEEP VENDOR CHANGES
"RTN","PRCHE1",103,0)
 .  Q:Y=1
"RTN","PRCHE1",104,0)
 .  ; USER DECIDED **NOT** TO KEEP VENDOR CHANGES
"RTN","PRCHE1",105,0)
 .  ; FLAGN=1 MEANS THIS IS A NEW VENDOR (NEW DURING THIS EDIT SESSION)
"RTN","PRCHE1",106,0)
 .  I FLAGN=1 S DIK="^PRC(440," D ^DIK S FLAG=0 Q
"RTN","PRCHE1",107,0)
 .  S %X="^PRC(440.3,DA,"
"RTN","PRCHE1",108,0)
 .  S %Y="^PRC(440,DA,"
"RTN","PRCHE1",109,0)
 .  D %XY^%RCR
"RTN","PRCHE1",110,0)
 .  S FLAG=0
"RTN","PRCHE1",111,0)
 .  W !!
"RTN","PRCHE1",112,0)
 .  K ^PRC(440.3,DA)
"RTN","PRCHE1",113,0)
 .  S NAME=$P($G(^PRC(440,DA,0)),U,1)
"RTN","PRCHE1",114,0)
 .  W "Name: "_NAME,!,"DA: "_DA,!
"RTN","PRCHE1",115,0)
 .  S N1=$E(NAME,1,2)
"RTN","PRCHE1",116,0)
 .  Q:N1'["**"
"RTN","PRCHE1",117,0)
 .  S N1=$E(NAME,3,99)
"RTN","PRCHE1",118,0)
 .  K ^PRC(440,"B",N1,DA)
"RTN","PRCHE1",119,0)
 .  S ^PRC(440,"B",NAME,DA)=""
"RTN","PRCHE1",120,0)
 .  Q
"RTN","PRCHE1",121,0)
 S FISCAL=$G(^PRC(411,PRC("SITE"),9))
"RTN","PRCHE1",122,0)
 I $P(FISCAL,U,3)="Y" D  G VEDIT
"RTN","PRCHE1",123,0)
 .  Q:$$NEW^PRCOVTST(DA,PRC("SITE"),FLAG)
"RTN","PRCHE1",124,0)
 .  ;
"RTN","PRCHE1",125,0)
 .  ; SEE IF THIS IS A NEW VENDOR -- IF SO NOW MOVE THE ENTRY
"RTN","PRCHE1",126,0)
 .  ; OVER TO FILE 440.3
"RTN","PRCHE1",127,0)
 .  ;
"RTN","PRCHE1",128,0)
 .  I NEW D
"RTN","PRCHE1",129,0)
 .  .  S %X="^PRC(440,DA,"
"RTN","PRCHE1",130,0)
 .  .  S %Y="^PRC(440.3,DA,"
"RTN","PRCHE1",131,0)
 .  .  D %XY^%RCR
"RTN","PRCHE1",132,0)
 .  .  Q
"RTN","PRCHE1",133,0)
 .  ;
"RTN","PRCHE1",134,0)
 .  ; NOW SET UP TO REVIEW THIS NEW VENDOR
"RTN","PRCHE1",135,0)
 .  ;
"RTN","PRCHE1",136,0)
 .  S DIE="^PRC(440.3,"
"RTN","PRCHE1",137,0)
 .  S DR="47///^S X=FLAG;48///^S X=DA;49///^S X=PRC(""SITE"")"
"RTN","PRCHE1",138,0)
 .  D ^DIE
"RTN","PRCHE1",139,0)
 .  Q
"RTN","PRCHE1",140,0)
 ;
"RTN","PRCHE1",141,0)
GENERATE ;GO CREATE A VRQ ANS SEND IT TO AUSTIN
"RTN","PRCHE1",142,0)
 D  Q:$G(STOP)=1
"RTN","PRCHE1",143,0)
 .  I FLAG=1 D NEW^PRCOVRQ(DA,SITE) Q
"RTN","PRCHE1",144,0)
 .  I FLAG=2 D UPDATE^PRCOVRQ1(DA,SITE) Q
"RTN","PRCHE1",145,0)
 G VEDIT
"RTN","PRCHE1",146,0)
 ;
"RTN","PRCHE1",147,0)
 ;
"RTN","PRCHE1",148,0)
SEND(IEN) ;SEND OFF THE VRQ TO AUSTIN -- CALLED FROM SEND^PRCORV1
"RTN","PRCHE1",149,0)
 S VRQ=$G(^PRC(440.3,IEN,"VRQ"))
"RTN","PRCHE1",150,0)
 S FLAG=$P(VRQ,U)
"RTN","PRCHE1",151,0)
 S DA=$P(VRQ,U,2)
"RTN","PRCHE1",152,0)
 S SITE=$P(VRQ,U,3)
"RTN","PRCHE1",153,0)
 S STOP=1
"RTN","PRCHE1",154,0)
 D GENERATE
"RTN","PRCHE1",155,0)
 Q:$G(^PRC(440.3,IEN,0))]""
"RTN","PRCHE1",156,0)
 S VRQ=$O(^PRCF(422.2,"B","123-VRQ-01",0))
"RTN","PRCHE1",157,0)
 S COUNT=$P(^PRCF(422.2,VRQ,0),U,2)
"RTN","PRCHE1",158,0)
 S COUNT=$S(COUNT-1>0:COUNT-1,1:0)
"RTN","PRCHE1",159,0)
 S $P(^PRCF(422.2,VRQ,0),U,2)=COUNT
"RTN","PRCHE1",160,0)
 K ^PRC(440.3,"AD",IEN,IEN)
"RTN","PRCHE1",161,0)
 Q
"RTN","PRCHEA")
0^26^B21455506
"RTN","PRCHEA",1,0)
PRCHEA ;WOIFO/ID/RSD,SF-ISC/TKW-EDIT ROUTINES FOR SUPPLY SYSTEM ;3/5/98  11:05 AM
"RTN","PRCHEA",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCHEA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHEA",4,0)
EN3 ;ADD A REQUISITION
"RTN","PRCHEA",5,0)
 ;
"RTN","PRCHEA",6,0)
 ;Variables PRCHNRQ and PRCHZZZ9 are flags stating that this is a
"RTN","PRCHEA",7,0)
 ;REQUESITION.
"RTN","PRCHEA",8,0)
 ;
"RTN","PRCHEA",9,0)
 N PRCHP,PRCHZZZ9
"RTN","PRCHEA",10,0)
 D ST
"RTN","PRCHEA",11,0)
EN30 S (PRCHNRQ,PRCHZZZ9)=1,PRCHP("A")="REQUISITION NUMBER",PRCHP("T")=8,PRCHP("S")=1 D EN^PRCHPAT I '$D(PRCHPO) K PRCHNRQ Q
"RTN","PRCHEA",12,0)
 D LCK1 G:'$D(DA) EN30 S X=1,DA=PRCHPO D ENS^PRCHSTAT
"RTN","PRCHEA",13,0)
 S Z=$P(^PRC(442,PRCHPO,0),"-",2),$P(^PRC(442,PRCHPO,18),"^",3)=$S($E(Z):$E(Z,2,6),1:$E(Z)_$E(Z,3,6))
"RTN","PRCHEA",14,0)
 D ^PRCHNPO L
"RTN","PRCHEA",15,0)
 G EN30
"RTN","PRCHEA",16,0)
 ;
"RTN","PRCHEA",17,0)
EN4 ;EDIT A REQUISITION
"RTN","PRCHEA",18,0)
 ;
"RTN","PRCHEA",19,0)
 ;Variables PRCHNREQ and PRCHZZZ9 are flags stating that this is a
"RTN","PRCHEA",20,0)
 ;REQUESITION.
"RTN","PRCHEA",21,0)
 ;
"RTN","PRCHEA",22,0)
 N PRCHP,PRCHZZZ9
"RTN","PRCHEA",23,0)
 D ST
"RTN","PRCHEA",24,0)
EN40 S (PRCHNRQ,PRCHZZZ9)=1,PRCHP("A")="REQUISTION NUMBER: "
"RTN","PRCHEA",25,0)
 S PRCHP("S")="$P($G(^(7)),U,2)<9,($P(^(0),U,2)=5!($P(^(0),U,2)=8)!($P(^(0),U,2)=25)!($P(^(0),U,2)=26))"
"RTN","PRCHEA",26,0)
 S:$G(PRCHPC) PRCHP("S")="$P($G(^(7)),U,2)<9,$P($G(^(1)),U,10)=DUZ,$P(^(0),U,2)=25"
"RTN","PRCHEA",27,0)
 D EN3^PRCHPAT I '$D(PRCHPO) K PRCHNRQ Q
"RTN","PRCHEA",28,0)
 I 'X W " ??",$C(7) G EN40
"RTN","PRCHEA",29,0)
 D LCK1 G:'$D(DA) EN40 D ^PRCHNPO L
"RTN","PRCHEA",30,0)
 G EN40
"RTN","PRCHEA",31,0)
 ;
"RTN","PRCHEA",32,0)
EN5 ;EDIT BOC IN ITEM FILE
"RTN","PRCHEA",33,0)
 S DIC="^PRC(441,",DIC(0)="AEMQ",DR=12 D ^DIC G:Y<0 Q S DA=+Y W ! F I=0:0 S I=$O(^PRC(441,DA,1,I)) Q:'I  W !?3,^(I,0)
"RTN","PRCHEA",34,0)
 W ! S DIE=DIC D ^DIE,Q W !
"RTN","PRCHEA",35,0)
 G EN5
"RTN","PRCHEA",36,0)
 ;
"RTN","PRCHEA",37,0)
EN6 ;AMENDMENTS
"RTN","PRCHEA",38,0)
 N PRCHP S PRCHFLG=0 D ST
"RTN","PRCHEA",39,0)
EN60 K PRCHP Q:'$D(PRC("SITE"))  S PRCHP("S")="$P($G(^(7)),U,2)>19,(453328'[$P($G(^(7)),U,2)),($P(^(0),U,2)"
"RTN","PRCHEA",40,0)
 S:'$D(PRCHNRQ) PRCHP("S")=PRCHP("S")_"<8)" S:$D(PRCHNRQ) PRCHP("A")="REQUISITION NO.: ",PRCHP("S")=PRCHP("S")_"=8"
"RTN","PRCHEA",41,0)
 S PRCHFLG=1 D EN3^PRCHPAT Q:'$D(PRCHPO)
"RTN","PRCHEA",42,0)
 ;I X=28!(X=33) W $C(7),!,"Amendments not allowed until after order has been Obligated!!" G EN60
"RTN","PRCHEA",43,0)
 I 'X W $C(7)," ??" G EN60
"RTN","PRCHEA",44,0)
 D ^PRCHAM
"RTN","PRCHEA",45,0)
 G EN60
"RTN","PRCHEA",46,0)
 ;
"RTN","PRCHEA",47,0)
EN7 ;CANCEL UNOBLIGATED PO
"RTN","PRCHEA",48,0)
 N PRCHP D ST
"RTN","PRCHEA",49,0)
EN70 Q:'$D(PRC("SITE"))  S PRCHP("S")="$P($G(^(7)),U,2)<9,($P(^(0),U,2)"
"RTN","PRCHEA",50,0)
 S:'$D(PRCHNRQ) PRCHP("S")=PRCHP("S")_"<8!($P(^(0),U,2)>24))"
"RTN","PRCHEA",51,0)
 S:$D(PRCHNRQ) PRCHP("A")="REQUISITION NO.: ",PRCHP("S")=PRCHP("S")_"=8)" S:$D(PRCHIMP) PRCHP("A")="IMPREST FUND P.O.NO.: ",PRCHP("S")="($P($G(^(7)),U,2)<9!($P($G(^(7)),U,2)=22))&($P(^(0),U,2)=7)"
"RTN","PRCHEA",52,0)
 D EN3^PRCHPAT Q:'$D(PRCHPO)  I 'X W $C(7)," ??" G EN70
"RTN","PRCHEA",53,0)
 I $P(^PRC(442,PRCHPO,0),U,12) W $C(7),!!,"WARNING--2237 HAS NOT BEEN REMOVED FROM THIS ORDER!!" G EN70
"RTN","PRCHEA",54,0)
 D LCK1 G:'$D(DA) EN70 S %A="     SURE YOU WANT TO CANCEL PURCHASE ORDER ",%B="",%="" D ^PRCFYN I %'=1 W ?40," <NOTHING CANCELLED>",$C(7) G EN70
"RTN","PRCHEA",55,0)
 S X=$O(^PRCD(442.3,"C",45,0)),$P(^PRC(442,PRCHPO,0),U,15,16)="0^0" K ^(9) S (X,Y)=45,DA=PRCHPO D UPD^PRCHSTAT
"RTN","PRCHEA",56,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCHEA",57,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D DEL^PRCV442A(PRCHPO)
"RTN","PRCHEA",58,0)
 G EN70
"RTN","PRCHEA",59,0)
 ;
"RTN","PRCHEA",60,0)
EN8 ;GRAB A PO NUMBER
"RTN","PRCHEA",61,0)
 D ST
"RTN","PRCHEA",62,0)
EN80 Q:'$D(PRC("SITE"))  K PRCHX W !!,"How many Purchase Order numbers do you want: " R X:DTIME Q:X["^"  I X'=+X!(X<1)!(X>5)!'(X?1N) W " ??",$C(7),!,"Enter a number between 1 and 5." G EN80
"RTN","PRCHEA",63,0)
 S PRCHX=X,DIC="^PRC(442.6,",DIC(0)="QEAMZ",DIC("S")="I +$P(^(0),U,1)=PRC(""SITE""),($P(^(0),U,5)=2!($P(^(0),U,5)="""")!($P(^(0),U,5)=6)!($P(^(0),U,5)=7))",D="C" D IX^DIC I Y<0 K DIC Q
"RTN","PRCHEA",64,0)
 S DA=+Y D LCK K DIC G:'$D(DA) EN80 D WAIT^DICD S PRCHY=Y,PRCHY(0)=Y(0) F PRCHI=1:1:PRCHX D EN81
"RTN","PRCHEA",65,0)
 L  W !,"Here is your Purchase Order Numbers: " F I=0:0 S I=$O(PRCHX(I)) Q:'I  W !?37,PRCHX(I)
"RTN","PRCHEA",66,0)
 R !!,"Press RETURN to continue",X:DTIME K DIC,DA,PRCHX,PRCHY,Z Q
"RTN","PRCHEA",67,0)
EN81 S X=$P(PRCHY,U,2),Z=$S(+$P(PRCHY(0),U,4)<$P(PRCHY(0),U,2):+$P(PRCHY(0),U,2),1:+$P(PRCHY(0),U,4)),L=$L(X)#2-3
"RTN","PRCHEA",68,0)
EN82 I Z>$P(PRCHY(0),U,3) L  W !?3,"UPPER BOUND HAS BEEN EXCEEDED FOR COMMON NUMBERING SERIES ",$P(PRCHY,U,2),$C(7) S PRCHI=PRCHX+1 Q
"RTN","PRCHEA",69,0)
 S Z="000"_Z,Z=$E(Z,$L(Z)+L,$L(Z)),X=X_Z I $D(^PRC(442,"B",X)) S Z=Z+1,X=$P(PRCHY,U,2) G EN82
"RTN","PRCHEA",70,0)
 S $P(^PRC(442.6,+PRCHY,0),U,4)=+Z,DIC(0)="L",DIC="^PRC(442,",DLAYGO=442 D ^DIC L ^PRC(442.6,+PRCHY):5 G EN82:Y<0!'(+$P(Y,U,3)) E  S PRCHI=PRCHX+1 Q
"RTN","PRCHEA",71,0)
 S PRCHX(PRCHI)=$P(Y,U,2) D NOW^%DTC S $P(^PRC(442,+Y,12),U,4,5)=DUZ_U_X S DA=+Y,(X,Y)=1 D UPD^PRCHSTAT
"RTN","PRCHEA",72,0)
 Q
"RTN","PRCHEA",73,0)
 ;
"RTN","PRCHEA",74,0)
Q K DIC,DIE,DR,DA,PRCHREAV,PRCHX,PRCHY L  W !
"RTN","PRCHEA",75,0)
 Q
"RTN","PRCHEA",76,0)
 ;
"RTN","PRCHEA",77,0)
LCK1 S DIC="^PRC(442,"
"RTN","PRCHEA",78,0)
 ;
"RTN","PRCHEA",79,0)
LCK L @(DIC_DA_"):0") E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHEA",80,0)
 Q
"RTN","PRCHEA",81,0)
 ;
"RTN","PRCHEA",82,0)
ST S PRCF("X")="S" D ^PRCFSITE
"RTN","PRCHEA",83,0)
 Q
"RTN","PRCHEA1")
0^48^B23232021
"RTN","PRCHEA1",1,0)
PRCHEA1 ;SF-ISC/TKW/DST/AS-MORE EDIT ROUTINES FOR SUPPLY SYSTEM ;3/8/05
"RTN","PRCHEA1",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCHEA1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHEA1",4,0)
 ;
"RTN","PRCHEA1",5,0)
EN0 ;REACTIVATE VENDOR
"RTN","PRCHEA1",6,0)
 ;
"RTN","PRCHEA1",7,0)
 S PRCHREAV="I $D(^(10)),$P(^(10),U,5)"
"RTN","PRCHEA1",8,0)
 S DIC="^PRC(440,"
"RTN","PRCHEA1",9,0)
 S DIE=DIC
"RTN","PRCHEA1",10,0)
 S DIC(0)="AEMQZ"
"RTN","PRCHEA1",11,0)
 D ^DIC
"RTN","PRCHEA1",12,0)
 G Q:Y<0
"RTN","PRCHEA1",13,0)
 S DA=+Y
"RTN","PRCHEA1",14,0)
 L +^PRC(440,DA):0 E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHEA1",15,0)
 G Q:'$D(DA)
"RTN","PRCHEA1",16,0)
 ;
"RTN","PRCHEA1",17,0)
 ;NOW THE RECORD IS LOCKED
"RTN","PRCHEA1",18,0)
 ;
"RTN","PRCHEA1",19,0)
 S PRCHY=$P(Y(0),U,1)
"RTN","PRCHEA1",20,0)
 I $E(PRCHY,1,2)="**" S PRCHY=$E(PRCHY,3,99)
"RTN","PRCHEA1",21,0)
 S IEN="      "_DA
"RTN","PRCHEA1",22,0)
 S IEN=$E(IEN,$L(IEN)-5,99)
"RTN","PRCHEA1",23,0)
 W !,"Sure you want to RE-activate Vendor "_PRCHY_", NO:"_IEN
"RTN","PRCHEA1",24,0)
 S %B=""
"RTN","PRCHEA1",25,0)
 S %=2
"RTN","PRCHEA1",26,0)
 D ^PRCFYN
"RTN","PRCHEA1",27,0)
 I %=1 D
"RTN","PRCHEA1",28,0)
 .  S DR=".01////^S X=PRCHY;15////@;31.5////@"
"RTN","PRCHEA1",29,0)
 .  D ^DIE
"RTN","PRCHEA1",30,0)
 .  ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED    **81**
"RTN","PRCHEA1",31,0)
 .  D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ONECHK^PRCVNDR(DA)
"RTN","PRCHEA1",32,0)
 .  Q
"RTN","PRCHEA1",33,0)
 ;
"RTN","PRCHEA1",34,0)
 ;UNLOCK THE RECORD
"RTN","PRCHEA1",35,0)
 ;
"RTN","PRCHEA1",36,0)
 L -^PRC(440,DA)
"RTN","PRCHEA1",37,0)
 D Q
"RTN","PRCHEA1",38,0)
 G EN0
"RTN","PRCHEA1",39,0)
 ;
"RTN","PRCHEA1",40,0)
EN1 ;INACTIVATE VENDOR
"RTN","PRCHEA1",41,0)
 ;
"RTN","PRCHEA1",42,0)
 K PRCHREAV
"RTN","PRCHEA1",43,0)
 I '$D(DT) D
"RTN","PRCHEA1",44,0)
 .  D NOW^%DTC
"RTN","PRCHEA1",45,0)
 .  S DT=$P(%,".",1)
"RTN","PRCHEA1",46,0)
 .  Q
"RTN","PRCHEA1",47,0)
 N DIC
"RTN","PRCHEA1",48,0)
 S DIC="^PRC(440,"
"RTN","PRCHEA1",49,0)
 S DIC(0)="AEMQZ"
"RTN","PRCHEA1",50,0)
 D ^DIC
"RTN","PRCHEA1",51,0)
 G Q:Y<0
"RTN","PRCHEA1",52,0)
 I $D(^PRC(440,+Y,10)),$P(^(10),U,5)=1 W $C(7),!,"Please choose another vendor that is not inactivated." G EN1
"RTN","PRCHEA1",53,0)
 S (PRCHOLD,DA)=+Y
"RTN","PRCHEA1",54,0)
 S PRCHY=$P(Y(0),U,1)
"RTN","PRCHEA1",55,0)
 L +^PRC(440,DA):0 E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHEA1",56,0)
 G Q:'$D(DA)
"RTN","PRCHEA1",57,0)
 ;
"RTN","PRCHEA1",58,0)
 ;NOW THE RECORD IS LOCKED
"RTN","PRCHEA1",59,0)
 ;
"RTN","PRCHEA1",60,0)
 W !!,"Enter the Vendor you want to substitute for the inactivated vendor "
"RTN","PRCHEA1",61,0)
 S DIC("S")="I $S(PRCHOLD=+Y:0,'$D(^(10)):1,+$P(^(10),U,5)=0:1,1:0)"
"RTN","PRCHEA1",62,0)
 S DIC("A")="Select REPLACEMENT VENDOR: "
"RTN","PRCHEA1",63,0)
 S PRCHX=""
"RTN","PRCHEA1",64,0)
 S PRCHY="**"_$E($P(Y(0),U,1),1,34)
"RTN","PRCHEA1",65,0)
 D ^DIC
"RTN","PRCHEA1",66,0)
 S:Y>0 PRCHX=+Y
"RTN","PRCHEA1",67,0)
 S IENS="      "_PRCHX
"RTN","PRCHEA1",68,0)
 S IENS=$E(IENS,$L(IENS)-5,99)
"RTN","PRCHEA1",69,0)
 S IENO="      "_PRCHOLD
"RTN","PRCHEA1",70,0)
 S IENO=$E(IENO,$L(IENO)-5,99)
"RTN","PRCHEA1",71,0)
 W !!,"Sure you want to inactivate Vendor "_$P(^PRC(440,PRCHOLD,0),U)_",  NO:"_IENO
"RTN","PRCHEA1",72,0)
 W:PRCHX !," and substitute vendor "_$P(^PRC(440,PRCHX,0),U)_", NO:"_IENS
"RTN","PRCHEA1",73,0)
 S %B=""
"RTN","PRCHEA1",74,0)
 S %=2
"RTN","PRCHEA1",75,0)
 D ^PRCFYN
"RTN","PRCHEA1",76,0)
 I %=1 D
"RTN","PRCHEA1",77,0)
 .  S DIE="^PRC(440,"
"RTN","PRCHEA1",78,0)
 .  S DA=PRCHOLD
"RTN","PRCHEA1",79,0)
 .  S DR=".01////^S X=PRCHY;15////^S X=PRCHX;31.5///^S X=1"
"RTN","PRCHEA1",80,0)
 .  D ^DIE
"RTN","PRCHEA1",81,0)
 .  ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED     **81**
"RTN","PRCHEA1",82,0)
 .  D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ONECHK^PRCVNDR(DA)
"RTN","PRCHEA1",83,0)
 .  Q
"RTN","PRCHEA1",84,0)
 ;
"RTN","PRCHEA1",85,0)
 ;UNLOCK THE RECORD
"RTN","PRCHEA1",86,0)
 ;
"RTN","PRCHEA1",87,0)
 L -^PRC(440,DA)
"RTN","PRCHEA1",88,0)
 D Q
"RTN","PRCHEA1",89,0)
 G EN1
"RTN","PRCHEA1",90,0)
 ;
"RTN","PRCHEA1",91,0)
EN2 ;INACTIVATE ITEM
"RTN","PRCHEA1",92,0)
 ;
"RTN","PRCHEA1",93,0)
 K PRCHREAV
"RTN","PRCHEA1",94,0)
 I '$D(DT) D
"RTN","PRCHEA1",95,0)
 .  D NOW^%DTC
"RTN","PRCHEA1",96,0)
 .  S DT=$P(%,".",1)
"RTN","PRCHEA1",97,0)
 .  Q
"RTN","PRCHEA1",98,0)
 K DIC
"RTN","PRCHEA1",99,0)
 S DIC="^PRC(441,"
"RTN","PRCHEA1",100,0)
 S DIC(0)="AEMQZ"
"RTN","PRCHEA1",101,0)
 D ^DIC
"RTN","PRCHEA1",102,0)
 G Q:Y<0
"RTN","PRCHEA1",103,0)
 I $P(Y(0),"^",2)["*" W $C(7),!,"                ITEM ALREADY INACTIVE" G EN2
"RTN","PRCHEA1",104,0)
 S DA=+Y
"RTN","PRCHEA1",105,0)
 L +^PRC(441,DA):0 E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHEA1",106,0)
 G Q:'$D(DA)
"RTN","PRCHEA1",107,0)
 ;
"RTN","PRCHEA1",108,0)
 ;NOW THE RECORD IS LOCKED
"RTN","PRCHEA1",109,0)
 ;
"RTN","PRCHEA1",110,0)
 S PRCHOLD=DA
"RTN","PRCHEA1",111,0)
 W !!,"Enter the item you want to substitute for the inactivated item "
"RTN","PRCHEA1",112,0)
 S DIC("A")="SELECT Substitute Item: "
"RTN","PRCHEA1",113,0)
 S PRCHY="**"_$E($P(Y(0),U,2),1,58)
"RTN","PRCHEA1",114,0)
 D ^DIC
"RTN","PRCHEA1",115,0)
 S PRCHZ=$S(+Y>0:+Y,1:"")
"RTN","PRCHEA1",116,0)
 W !!,"Sure you want to inactivate Item ",PRCHOLD
"RTN","PRCHEA1",117,0)
 W:+Y>0 " and substitute Item ",+Y
"RTN","PRCHEA1",118,0)
 S %B=""
"RTN","PRCHEA1",119,0)
 S %=2
"RTN","PRCHEA1",120,0)
 D ^PRCFYN
"RTN","PRCHEA1",121,0)
 I %=1 D
"RTN","PRCHEA1",122,0)
 .  S DIE="^PRC(441,"
"RTN","PRCHEA1",123,0)
 .  S DA=PRCHOLD
"RTN","PRCHEA1",124,0)
 .  S DR=".05////^S X=PRCHY;16////^S X=1"
"RTN","PRCHEA1",125,0)
 .  S:PRCHZ DR=DR_";16.5////^S X=PRCHZ"
"RTN","PRCHEA1",126,0)
 .  D ^DIE
"RTN","PRCHEA1",127,0)
 .  ;   Send ITEM Master File updated info to DYNAMED
"RTN","PRCHEA1",128,0)
 .  D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 ONECHK^PRCVIT(DA)
"RTN","PRCHEA1",129,0)
 .  Q
"RTN","PRCHEA1",130,0)
 ;
"RTN","PRCHEA1",131,0)
 ;UNLOCK THE RECORD
"RTN","PRCHEA1",132,0)
 ;
"RTN","PRCHEA1",133,0)
 L -^PRC(441,DA)
"RTN","PRCHEA1",134,0)
 D Q
"RTN","PRCHEA1",135,0)
 G EN2
"RTN","PRCHEA1",136,0)
 ;
"RTN","PRCHEA1",137,0)
EN3 ;REACTIVATE ITEM
"RTN","PRCHEA1",138,0)
 ;
"RTN","PRCHEA1",139,0)
 S PRCHREAV="I $D(^(3)),+^(3)"
"RTN","PRCHEA1",140,0)
 S DIC="^PRC(441,"
"RTN","PRCHEA1",141,0)
 S DIE=DIC
"RTN","PRCHEA1",142,0)
 S DIC(0)="AEMQZ"
"RTN","PRCHEA1",143,0)
 D ^DIC
"RTN","PRCHEA1",144,0)
 G Q:Y<0
"RTN","PRCHEA1",145,0)
 S DA=+Y
"RTN","PRCHEA1",146,0)
 L +^PRC(441,DA):0 E  W !,$C(7),"ANOTHER USER IS EDITING THIS ENTRY!" K DA
"RTN","PRCHEA1",147,0)
 G Q:'$D(DA)
"RTN","PRCHEA1",148,0)
 ;
"RTN","PRCHEA1",149,0)
 ;NOW THE RECORD IS LOCKED
"RTN","PRCHEA1",150,0)
 ;
"RTN","PRCHEA1",151,0)
 S PRCHY=$P(Y(0),U,2)
"RTN","PRCHEA1",152,0)
 I $E(PRCHY,1,2)="**" S PRCHY=$E(PRCHY,3,99)
"RTN","PRCHEA1",153,0)
 W !,"Sure you want to RE-activate Item number ",DA
"RTN","PRCHEA1",154,0)
 S %B=""
"RTN","PRCHEA1",155,0)
 S %=2
"RTN","PRCHEA1",156,0)
 D ^PRCFYN
"RTN","PRCHEA1",157,0)
 I %=1 D
"RTN","PRCHEA1",158,0)
 .  S DR=".05////^S X=PRCHY;16////@;16.5////@"
"RTN","PRCHEA1",159,0)
 .  D ^DIE
"RTN","PRCHEA1",160,0)
 .  ;   Send ITEM Master File updated info to DYNAMED
"RTN","PRCHEA1",161,0)
 .  D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 ONECHK^PRCVIT(DA)
"RTN","PRCHEA1",162,0)
 .  Q
"RTN","PRCHEA1",163,0)
 ;
"RTN","PRCHEA1",164,0)
 ;UNLOCK THE RECORD
"RTN","PRCHEA1",165,0)
 ;
"RTN","PRCHEA1",166,0)
 L -^PRC(441,DA)
"RTN","PRCHEA1",167,0)
 D Q
"RTN","PRCHEA1",168,0)
 G EN3
"RTN","PRCHEA1",169,0)
 ;
"RTN","PRCHEA1",170,0)
Q K DIC,DIE,DR,DA,PRCHOLD,PRCHREAV,PRCHX,PRCHY,PRCHZ
"RTN","PRCHEA1",171,0)
 W !
"RTN","PRCHEA1",172,0)
 Q
"RTN","PRCHG")
0^39^B23118352
"RTN","PRCHG",1,0)
PRCHG ;ID/RSD,SF-ISC/TKW/DAP-PROCESS 2237 ;2/03/98  10:49 AM
"RTN","PRCHG",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCHG",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHG",4,0)
 ;
"RTN","PRCHG",5,0)
ES ;SIGN 2237 IN PPM
"RTN","PRCHG",6,0)
 G Q:'$D(PRC("PER"))!('$D(PRC("SITE"))) I $S('$D(^VA(200,+PRC("PER"),400)):1,$P(^(400),U,1)=4:0,$P(^(400),U,1)=2:0,1:1) W !!,"You are not a Supply Accountable Officer !",$C(7) G Q
"RTN","PRCHG",7,0)
 S P=+PRC("PER"),DA=1,PRCSIG="" D ESIG^PRCUESIG(DUZ,.PRCSIG) S ROUTINE="PRCUESIG" G:PRCSIG'=1 QQ S PRCHNM=$P(^VA(200,P,20),U,2)
"RTN","PRCHG",8,0)
 Q
"RTN","PRCHG",9,0)
 ;
"RTN","PRCHG",10,0)
ES1 ;S PRCHG=$S($D(^PRCD(442.3,+$P(^PRC(443,DA,0),U,7),0)):$P(^(0),U,2),1:""),$P(^PRC(443,DA,0),"^",3)="",P=+PRC("PER")
"RTN","PRCHG",11,0)
 S PRCHG=$P($G(^PRCD(442.3,+$P(^PRC(443,DA,0),U,7),0)),U,2),$P(^PRC(443,DA,0),"^",3)="",P=+PRC("PER")
"RTN","PRCHG",12,0)
 I PRCHG=63 S PRCFA("WHO")=3 D RET
"RTN","PRCHG",13,0)
 N DA2237 S DA2237=DA
"RTN","PRCHG",14,0)
 ;
"RTN","PRCHG",15,0)
 ;if PO is not for PPM Clerk stop processing and exit
"RTN","PRCHG",16,0)
 I PRCHG<65 K PRCHG Q
"RTN","PRCHG",17,0)
 S PRCSIG="" D ENCODE^PRCHES11(DA,DUZ,.PRCSIG) S ROUTINE=$T(+0) G:PRCSIG<1 QQ
"RTN","PRCHG",18,0)
 ;set AO name, signature date on 2237 record
"RTN","PRCHG",19,0)
 I $D(DA2237) L +^PRCS(410,DA2237):15 Q:'$T  D NOW^%DTC S $P(^PRCS(410,DA2237,7),"^",11)=P,$P(^PRCS(410,DA2237,7),"^",12)=% L -^PRCS(410,DA2237)
"RTN","PRCHG",20,0)
 Q
"RTN","PRCHG",21,0)
 ;
"RTN","PRCHG",22,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0) W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7) S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR
"RTN","PRCHG",23,0)
 ;
"RTN","PRCHG",24,0)
Q K %,DA,DIC,DIE,DR,P,PRCHNM,PRCHTDA,PRCHG,PRCHPO,PRCHS,PRCHSIT,PRCHSX,PRCHSY,PRCHSZ,PRCHX,ROUTINE
"RTN","PRCHG",25,0)
 Q
"RTN","PRCHG",26,0)
 ;
"RTN","PRCHG",27,0)
RET ;RETURN TO SERVICE--UPDATE CP BALANCES, ERASE CP OFFICIAL SIGNATURE, SEND BULLETIN BACK TO SERVICE
"RTN","PRCHG",28,0)
 S PRCHDA=DA,X=$P(^PRCS(410,DA,4),"^",8) D TRANK^PRCSES S $P(^PRCS(410,DA,7),"^",5,7)="^^",$P(^PRCS(410,DA,10),U,4)=$P(^PRC(443,DA,0),U,7),DIE="^PRCS(410,",DR=61 D ^DIE K DIE
"RTN","PRCHG",29,0)
 S DA=PRCHDA D REMOVE^PRCSC1(DA),REMOVE^PRCSC3(DA)
"RTN","PRCHG",30,0)
 ;remove AO name, signature date from 2237 record
"RTN","PRCHG",31,0)
 N PPMNODE F PPMNODE=11,12 S $P(^PRCS(410,DA,7),"^",PPMNODE)=""
"RTN","PRCHG",32,0)
 S (DA,PRCFA("TRDA"))=PRCHDA D RETURN^PRCEFIS1 S DA=PRCHDA D EN3^PRCPWI
"RTN","PRCHG",33,0)
 Q
"RTN","PRCHG",34,0)
 ;
"RTN","PRCHG",35,0)
SIT S PRCF("X")="SP" D ^PRCFSITE K PRCHNM
"RTN","PRCHG",36,0)
 Q
"RTN","PRCHG",37,0)
 ;
"RTN","PRCHG",38,0)
TR S DIC("S")="I $P(^(0),U,3)="""",$D(^PRCS(410,Y,7)),$P(^(7),U,6)]"""",+^(0)=PRC(""SITE"")"
"RTN","PRCHG",39,0)
 S DIC("S")=$S('$D(PRCFDICS):DIC("S")_" S Z=$O(^PRCD(442.3,""C"",+$P(^PRC(443,Y,0),U,7),0)) I Z'=10&(Z'=85)",1:DIC("S")_PRCFDICS)
"RTN","PRCHG",40,0)
 ;
"RTN","PRCHG",41,0)
DIC W !! K DA S DIC="^PRC(443,",DIC(0)="QEAMZ",DIC("A")="2237 TRANSACTION NUMBER: " D ^DIC S DIE=DIC K DIC S:Y>0 DA=+Y
"RTN","PRCHG",42,0)
 Q
"RTN","PRCHG",43,0)
 ;
"RTN","PRCHG",44,0)
ST S DIC("S")="I $P(^(0),U,3)]"""",$O(^PRCD(442.3,""C"",+$P(^(0),U,7),0))'=65,$D(^PRCS(410,+Y,0)),+^(0)=PRC(""SITE"")" D DIC
"RTN","PRCHG",45,0)
 Q
"RTN","PRCHG",46,0)
 ;
"RTN","PRCHG",47,0)
PPM S DR="[PRCHPPM]",DIE("NO^")="" D ^DIE K DIE,PRCHPPM D ES1
"RTN","PRCHG",48,0)
 Q
"RTN","PRCHG",49,0)
 ;
"RTN","PRCHG",50,0)
EN ;SIGN 2237 IN PPM
"RTN","PRCHG",51,0)
 D SIT Q:'$D(PRC("SITE"))  D:'$D(PRCHNM) ES G:'$D(PRCHNM) Q
"RTN","PRCHG",52,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCHG",53,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 D EN^PRCHG1
"RTN","PRCHG",54,0)
 ;
"RTN","PRCHG",55,0)
EN0 D:'$D(PRCHNM) ES G:'$D(PRCHNM) Q D TR G:'$D(DA) Q D PPM
"RTN","PRCHG",56,0)
 G EN0
"RTN","PRCHG",57,0)
 ;
"RTN","PRCHG",58,0)
EN1 ;SIGN 2237 IN PC
"RTN","PRCHG",59,0)
 D SIT Q:'$D(PRC("SITE"))
"RTN","PRCHG",60,0)
EN10 D ST G:'$D(DA) Q S DR="[PRCHPC]",DIE("NO^")="" D ^DIE K DIE
"RTN","PRCHG",61,0)
 G EN10
"RTN","PRCHG",62,0)
 ;
"RTN","PRCHG",63,0)
EN2 ;RETURN 2237 IN PC
"RTN","PRCHG",64,0)
 D SIT Q:'$D(PRC("SITE"))
"RTN","PRCHG",65,0)
EN20 ;D ST G:'$D(DA) Q S DR="[PRCHPCR]" D ^DIE K PRCHPCR S Z=$S($D(^PRCD(442.3,+$P(^PRC(443,DA,0),U,7),0)):$P(^(0),U,2),1:"") G:Z'=76 EN20
"RTN","PRCHG",66,0)
 D ST G:'$D(DA) Q S DR="[PRCHPCR]" D ^DIE K PRCHPCR S Z=$P($G(^PRCD(442.3,+$P(^PRC(443,DA,0),U,7),0)),U,2) G:Z'=76 EN20
"RTN","PRCHG",67,0)
 S $P(^PRC(443,DA,0),"^",2,4)="^^"
"RTN","PRCHG",68,0)
 S PRCFA("WHO")=2 D RET
"RTN","PRCHG",69,0)
 G EN20
"RTN","PRCHG",70,0)
 ;
"RTN","PRCHG",71,0)
EN3 ;SPLIT 2237 IN PPM
"RTN","PRCHG",72,0)
 D SIT Q:'$D(PRC("SITE"))
"RTN","PRCHG",73,0)
EN30 D TR G:'$D(DA) Q S PRCHSY(0)=Y(0),(PRCHPO,PRCHSY)=DA,(PRCHG,PRCHSZ)=1 D N^PRCHNPO3 G Q:'$D(PRCHSY)!('$O(^TMP($J,"PRCHS",0))),W1:+^TMP($J,"PRCHS",0)=+^PRCS(410,DA,10)
"RTN","PRCHG",74,0)
 S PRCHSIT=+^TMP($J,"PRCHS",0),PRCHS=PRCHSY D WAIT^DICD,^PRCHSP I PRCHSY=-1 D ERR^PRCHNPO3,Q G EN30
"RTN","PRCHG",75,0)
 W !!,"The new 2237, ",PRCHSX,", will now be printed with the old one." F DA=PRCHS,PRCHSY S PRCSF=1 D PRF1^PRCSP1
"RTN","PRCHG",76,0)
 K PRCSF D Q
"RTN","PRCHG",77,0)
 G EN30
"RTN","PRCHG",78,0)
 ;
"RTN","PRCHG",79,0)
EN4 ;EDIT A SIGNED 2237 IN PPM
"RTN","PRCHG",80,0)
 D SIT Q:'$D(PRC("SITE"))
"RTN","PRCHG",81,0)
EN40 D:'$D(PRCHNM) ES G:'$D(PRCHNM) Q S DIC("S")="I $P(^(0),U,3)]""""" D DIC G:'$D(DA) Q D PPM
"RTN","PRCHG",82,0)
 G EN40
"RTN","PRCHG",83,0)
 ;
"RTN","PRCHG",84,0)
EN5 ;DISPLAY NO.OF REQUESTS TO BE PROCESSED BY PPM
"RTN","PRCHG",85,0)
 S X=0 F I=0:0 S I=$O(^PRC(443,"AC",60,I)) Q:'I  S X=X+1
"RTN","PRCHG",86,0)
 W $C(7),!!!,?3,"There are "_X_" Requests ready to process." K X,I
"RTN","PRCHG",87,0)
 Q
"RTN","PRCHG",88,0)
 ;
"RTN","PRCHG",89,0)
W1 W !!,"You have selected all Line Items, NO action taken.",$C(7) D Q
"RTN","PRCHG",90,0)
 G EN3
"RTN","PRCHG",91,0)
 ;
"RTN","PRCHG",92,0)
STAT I $D(PRCFGPF) S DIC("S")="S Z=$P(^(0),U,2) I Z=10!(Z=60)!(Z=85)" Q
"RTN","PRCHG",93,0)
 I $D(PRCHPCR) D  Q
"RTN","PRCHG",94,0)
 . S DIC("S")="I $P(^(0),U,2)=75!($P(^(0),U,2)=76)"
"RTN","PRCHG",95,0)
 . I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D  Q
"RTN","PRCHG",96,0)
 . . N PRC2237
"RTN","PRCHG",97,0)
 . . S PRC2237=$P(^PRCS(410,DA,0),"^",1)
"RTN","PRCHG",98,0)
 . . I '$$CHKDM^PRCVLIC(PRC2237) Q
"RTN","PRCHG",99,0)
 . . I $O(^PRCS(410,"AG",PRC2237,""))]"" S DIC("S")="I $P(^(0),U,2)=75"
"RTN","PRCHG",100,0)
 I '$D(PRCHPPM) S DIC("S")="I $P(^(0),U,2)>69" Q
"RTN","PRCHG",101,0)
 K Z0 S (Z0(60),Z0(62),Z0(63),Z0(65),Z0(74))="" S:$P(^PRC(443,DA,0),U,10)=4 Z0(70)=""
"RTN","PRCHG",102,0)
 S DIC("S")="I $D(Z0(+$P(^(0),U,2)))"
"RTN","PRCHG",103,0)
 Q
"RTN","PRCHNPO4")
0^27^B57782504
"RTN","PRCHNPO4",1,0)
PRCHNPO4 ;WOIFO/RSD/RHD-CONT. OF NEW PO--COMPLETE PROCESSING IN SUPPLY ;4/22/98  06:21
"RTN","PRCHNPO4",2,0)
V ;;5.1;IFCAP;**51,56,81**;Oct 20, 2000
"RTN","PRCHNPO4",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHNPO4",4,0)
 ;
"RTN","PRCHNPO4",5,0)
PHA S ERROR="" I $G(PRCHPC)'=1 D NEW^PRCOEDC(PRCHPO,.ERROR) I ERROR'="" W !!?5,"Procurement History transaction error " G ERR^PRCHNPO
"RTN","PRCHNPO4",6,0)
 N RBD,RBDT,RBQT,RBFY,CCHK,FCHK,REFMOP S REFMOP=$P($G(^PRC(442,PRCHPO,0)),U,2)
"RTN","PRCHNPO4",7,0)
 I REFMOP=25 S RBDT=$$DATE^PRC0C($P($G(^PRC(442,PRCHPO,1)),U,15),"I"),RBFY=$E(RBDT,3,4),RBQT=$P(RBDT,"^",2),RBD=$$QTRDATE^PRC0D(RBFY,RBQT),RBD=$P(RBD,"^",7)
"RTN","PRCHNPO4",8,0)
 S PRC("CP")=$P($G(^PRC(442,PRCHPO,0)),"^",3)
"RTN","PRCHNPO4",9,0)
 S CCHK=$P($G(^PRC(442,PRCHPO,0)),U,15)
"RTN","PRCHNPO4",10,0)
 I $G(PRCHPC)="",CCHK'="" N BRCHK,BRCOST S BRCHK=$P($G(^PRC(442,PRCHPO,0)),"^",12),BRCOST=$P($G(^PRCS(410,+BRCHK,4)),"^") S:BRCOST'="" CCHK=CCHK-BRCOST
"RTN","PRCHNPO4",11,0)
 I REFMOP=25 S FCHK=$$OVCOM^PRCS0A(PRC("SITE")_"^"_PRC("CP")_"^"_$P($$DATE^PRC0C(RBD,"I"),"^",1,2),CCHK,2) I FCHK'=0 W !,"Insufficient funds for this request." H 2 G ERR^PRCHNPO
"RTN","PRCHNPO4",12,0)
 I $P($G(^PRC(442,PRCHPO,0)),U,2)=25 S FILE=442 D LIMIT^PRCHCD0 I $G(ERROR) K FILE,ERROR G ERR^PRCHNPO
"RTN","PRCHNPO4",13,0)
 ;I $G(PRCHPC)=2 S $P(^PRC(442,PRCHPO,0),U,15)=PRCHTAMT
"RTN","PRCHNPO4",14,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="D" D  G:$G(ERROR) ERR^PRCHNPO
"RTN","PRCHNPO4",15,0)
 . S PRCHITM=0 F  S PRCHITM=$O(^PRC(442,PRCHPO,2,PRCHITM)) Q:'PRCHITM  I $P($G(^PRC(442,PRCHPO,2,PRCHITM,2)),U,2)="" W !!,?5,"One or more of the items on this delivery order",!,?5,"does not contain contract number." S ERROR=1
"RTN","PRCHNPO4",16,0)
 ;
"RTN","PRCHNPO4",17,0)
FS S PRCHN("SFC")=$P(^PRC(442,PRCHPO,0),U,19)
"RTN","PRCHNPO4",18,0)
 ; SET STATUS TO 'Ordered (no Fiscal Action Required)' IF IMPREST FUNDS METHOD OF PROCESSING, OR IF SPECIAL CONTROL POINT FOR SUPPLY FUND (POSTED).
"RTN","PRCHNPO4",19,0)
 ; SET STATUS TO 'Transaction Complete' FOR CERTIFIED INVOICES ORDERED FOR SUPPLY FUND.
"RTN","PRCHNPO4",20,0)
 ; SET STATUS TO 'Pending Fiscal Action' OTHERWISE.
"RTN","PRCHNPO4",21,0)
 S PRCHSTAT=10,%A="Send to Fiscal Service"
"RTN","PRCHNPO4",22,0)
 I PRCHN("SFC")=2!(PRCHN("MP")=25) S PRCHSTAT=22,%A="Print Purchase Order"
"RTN","PRCHNPO4",23,0)
 S FILE=442 D:$D(PRCHPO) CHECK^PRCHSWCH
"RTN","PRCHNPO4",24,0)
 I $G(PRCHOBL)=1 S PRCHSTAT=22,%A="Print Purchase Order "
"RTN","PRCHNPO4",25,0)
 I PRCHN("MP")=2,PRCHN("SFC")=2 S PRCHSTAT=40
"RTN","PRCHNPO4",26,0)
 ;
"RTN","PRCHNPO4",27,0)
ASK I '$G(PRCHPC),'$G(PRCHDELV) D  G Q:%=2&(PRCHN("MP")'=25)!(%<0),FS:%=0
"RTN","PRCHNPO4",28,0)
 . W ! S %A="     "_%A,%B="",%=1 D ^PRCFYN
"RTN","PRCHNPO4",29,0)
 . S NOPRINT="" I %=2 S NOPRINT=1
"RTN","PRCHNPO4",30,0)
 S P=+$P($G(^PRC(442,PRCHPO,1)),U,10),DA=PRCHPO
"RTN","PRCHNPO4",31,0)
 I 'P W !!,"P.O. is missing the Purchasing Agent and must be re-edited !",$C(7) G Q
"RTN","PRCHNPO4",32,0)
 I P'=DUZ W !!,"You must be the Purchasing Agent listed on P.O. to sign it.",$C(7) S DIR(0)="EAO",DIR("A")="Press <Return> to continue " D ^DIR K DIR(0),DIR("A") G Q
"RTN","PRCHNPO4",33,0)
 I $G(PRCHPHAM),$P(^PRC(442,PRCHPO,0),U,15)=0 D  G:%'=1 ERR^PRCHNPO
"RTN","PRCHNPO4",34,0)
 . W !!,?5,"This pharmacy order is a no charge order." S %A="     Would you like to sign this order",%B="",%=2 D ^PRCFYN
"RTN","PRCHNPO4",35,0)
 S X=$P($G(^PRC(442,PRCHPO,1)),U)
"RTN","PRCHNPO4",36,0)
 ;
"RTN","PRCHNPO4",37,0)
 ; Begin modifications for PRC*5.1*56
"RTN","PRCHNPO4",38,0)
 I X]"",$P($G(^PRC(440,X,3)),U,2)="Y",";P;S;"[(";"_$P($G(^PRC(442,PRCHPO,23)),U,11)_";") D
"RTN","PRCHNPO4",39,0)
 . S MSG1="                   This order will not be sent via EDI."
"RTN","PRCHNPO4",40,0)
 . S MSG2="To place a Purchase Card order via EDI please use the Purchasing Agent Menu."
"RTN","PRCHNPO4",41,0)
 . W !!!,"                           ***** TAKE NOTE *****"
"RTN","PRCHNPO4",42,0)
 . W !!,?2,MSG1,!!,MSG2,!!
"RTN","PRCHNPO4",43,0)
 . K MSG1,MSG2
"RTN","PRCHNPO4",44,0)
 . Q
"RTN","PRCHNPO4",45,0)
 ; End modifications for PRC*5.1*56
"RTN","PRCHNPO4",46,0)
 I X]"",$P($G(^PRC(440,X,3)),U,2)="Y",";P;S;"'[(";"_$P($G(^PRC(442,PRCHPO,23)),U,11)_";") D  G:$G(X)="ABORT" Q I $D(DTOUT)!$D(Y) W $C(7),!!,"The 'Do You Want to Send This EDI?' question was bypassed - You must reedit PO" K DTOUT G Q
"RTN","PRCHNPO4",47,0)
 . N PRCY S PRCY=""
"RTN","PRCHNPO4",48,0)
 . I $P($G(^PRC(442,PRCHPO,0)),U,2)=25 D
"RTN","PRCHNPO4",49,0)
 . . N PRCX
"RTN","PRCHNPO4",50,0)
 . . S PRCX=$P($G(^PRC(442,PRCHPO,23)),U,8)
"RTN","PRCHNPO4",51,0)
 . . S:PRCX'="" PRCX=$P($G(^PRC(440.5,PRCX,2)),U,4)
"RTN","PRCHNPO4",52,0)
 . . D NOW^%DTC
"RTN","PRCHNPO4",53,0)
 . . I ($E(PRCX,6,7)>0&(X>PRCX))!(+$E(PRCX,6,7)=0&(X\100>(PRCX\100))) D
"RTN","PRCHNPO4",54,0)
 . . . W !!,"In File #440.5, the Expiration Date for this card is blank or this card has"
"RTN","PRCHNPO4",55,0)
 . . . W !,?5,"expired!  An EDI order will reject.  Please contact your Purchase"
"RTN","PRCHNPO4",56,0)
 . . . W !,?5,"Card Coordinator." S PRCY="NO"
"RTN","PRCHNPO4",57,0)
 . N DIE,DR,DA
"RTN","PRCHNPO4",58,0)
 . S DIE=442,DR="116///@;S Y=""@1"";@1;116Do You Want to Send This EDI?~R",DA=PRCHPO D ^DIE
"RTN","PRCHNPO4",59,0)
 . Q:$D(DTOUT)!$D(Y)
"RTN","PRCHNPO4",60,0)
 . I $P($G(^PRC(442,PRCHPO,12)),U,16)="y",PRCY="NO" D
"RTN","PRCHNPO4",61,0)
 . . S X="ABORT"
"RTN","PRCHNPO4",62,0)
 . . W !,"As you have elected to send this order EDI, please ask the Purchase Card"
"RTN","PRCHNPO4",63,0)
 . . W !,"Coordinator to update the Card's Expiration Date before completing this"
"RTN","PRCHNPO4",64,0)
 . . W !,"Purchase Order. - You must reedit this PO."
"RTN","PRCHNPO4",65,0)
 ; UPDATE STATUS, P.A.SIGNATURE & BOC DATA, IN P.O.
"RTN","PRCHNPO4",66,0)
 S PRCSIG="" D ESIG^PRCUESIG(DUZ,.PRCSIG) S ROUTINE="PRCUESIG" I PRCSIG<1 D QQ G Q
"RTN","PRCHNPO4",67,0)
 ;Following line added in P194: go create new txn # if PC order modified
"RTN","PRCHNPO4",68,0)
 ;to new FCP
"RTN","PRCHNPO4",69,0)
 D CHECKFCP^PRCHNPOA(PRCHPO)
"RTN","PRCHNPO4",70,0)
 ;I $P($G(^PRC(442,PRCHPO,23)),U,11)="D",$P(^PRC(442,PRCHPO,0),U,2)=26 S $P(^PRC(442,PRCHPO,24),U)=1
"RTN","PRCHNPO4",71,0)
 I $G(PRCHPC)!$G(PRCHDELV) D  G Q:%<0,FS:%=0
"RTN","PRCHNPO4",72,0)
 . I $G(PRCPROST) S PRCPROST=3.9,NOPRINT=1,%=2 QUIT
"RTN","PRCHNPO4",73,0)
 . S %A=$S($G(PRCHPC):"Print Purchase Card Order ",1:"Print Delivery Order")
"RTN","PRCHNPO4",74,0)
 . W ! S %A="     "_%A,%B="",%=1 D ^PRCFYN
"RTN","PRCHNPO4",75,0)
 . S NOPRINT="" I %=2 S NOPRINT=1
"RTN","PRCHNPO4",76,0)
 ;
"RTN","PRCHNPO4",77,0)
 S X=$S($G(PRCHPHAM)'="":30,1:PRCHSTAT),DA=PRCHPO D ENS^PRCHSTAT
"RTN","PRCHNPO4",78,0)
 S (D0,DA)=PRCHPO D ^PRCHSF ;CALLS ROUTINE FOR FMS PROCESSING
"RTN","PRCHNPO4",79,0)
 S %DT="T",X="NOW" D ^%DT S PRCSIG="" D ENCODE^PRCHES5(DA,DUZ,.PRCSIG)
"RTN","PRCHNPO4",80,0)
 S ROUTINE=$T(+0) I PRCSIG<1 D QQ G Q
"RTN","PRCHNPO4",81,0)
 S D0=PRCHPO K D1 S:'$D(DT) DT=$P(Y,".",1)
"RTN","PRCHNPO4",82,0)
 ;
"RTN","PRCHNPO4",83,0)
 I $G(PRCHPC)!$G(PRCHDELV) D
"RTN","PRCHNPO4",84,0)
 . I $P($G(^PRC(442,PRCHPO,23)),U,8)]"" D
"RTN","PRCHNPO4",85,0)
 . . S PRCHCD=$P(^PRC(442,PRCHPO,23),U,8)
"RTN","PRCHNPO4",86,0)
 . . S PRCHPOMT=$P(^PRC(442,PRCHPO,0),U,15)
"RTN","PRCHNPO4",87,0)
 . S PODA=DA,DA=CDA S X=$P(^PRC(442,PRCHPO,0),U,15) D ESIG^PRCH410 S DA=PODA K PODA
"RTN","PRCHNPO4",88,0)
 ; IF SUPPLY FUND, NOT CERTIFIED INVOICE, SET FLAG NOTIFYING PPM TO CREATE LOG CODE SHEETS
"RTN","PRCHNPO4",89,0)
 S PRCHPOMT=$P(^PRC(442,PRCHPO,0),U,15),PRCHCD=$P(^PRC(442,PRCHPO,23),U,8)
"RTN","PRCHNPO4",90,0)
 I $P($G(^PRC(442,PRCHPO,0)),U,2)=25,$G(PRCHCD)'="" S $P(^PRC(440.5,PRCHCD,2),U)=+$P($G(^PRC(440.5,PRCHCD,2)),U)+PRCHPOMT
"RTN","PRCHNPO4",91,0)
 I PRCHN("SFC")=2 S $P(^PRC(442,PRCHPO,18),U,12)=1
"RTN","PRCHNPO4",92,0)
 I PRCHN("SFC")=2,PRCHN("MP")'=2 S $P(^PRC(442,PRCHPO,18),U,11)="N",^PRC(442,"AE","N",PRCHPO)=""
"RTN","PRCHNPO4",93,0)
 ; IF SUPPLY FUND, CERTIFIED INVOICE, UPDATE CONTROL POINT OBLIGATED BALANCE.
"RTN","PRCHNPO4",94,0)
 ;
"RTN","PRCHNPO4",95,0)
ISMS ;I PRCHSC=9 ;;I $D(PRCHISMS)   ;CHECK ISMS SWITCH AND IF TRUE CREATE ISMS TRANSACTION
"RTN","PRCHNPO4",96,0)
 ;I PRCHSC=1 D:0 EN11^PRCHEI
"RTN","PRCHNPO4",97,0)
 ;I PRCHSC=9 S PRCHTRAN="PO1" D EN11^PRCHEI(PRCHTRAN)
"RTN","PRCHNPO4",98,0)
 ;
"RTN","PRCHNPO4",99,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCHNPO4",100,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D UPD^PRCV442A(PRCHPO)
"RTN","PRCHNPO4",101,0)
 ;
"RTN","PRCHNPO4",102,0)
EDI ;CHECK TO SEE IF IT IS AN EDI PO AND SEND TO AUSTIN
"RTN","PRCHNPO4",103,0)
 ;I $G(PRCHSTAT)'="",PRCHSTAT'=10 N PRCOPODA S PRCOPODA=PRCHPO D ^PRCOEDI
"RTN","PRCHNPO4",104,0)
 I PRCHN("MP")=25 D  S $P(^PRC(442,PRCHPO,24),U)=1 G INV
"RTN","PRCHNPO4",105,0)
 . I $G(PRCHPC)'=1 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",106,0)
 . I '$P($G(^PRC(442,PRCHPO,23)),U,11) D
"RTN","PRCHNPO4",107,0)
 . . I '$P(^PRC(442,PRCHPO,0),U,12) S DA=PRCHPO D START^PRCH410 D  Q
"RTN","PRCHNPO4",108,0)
 . . . S PODA=PRCHPO,DA=CDA S X=$P(^PRC(442,PRCHPO,0),U,15) D ESIG^PRCH410 S DA=PODA K PODA
"RTN","PRCHNPO4",109,0)
 . . I $P(^PRC(442,PRCHPO,0),U,12) D COMM^PRCSPC(PRCHPO,$P(^PRC(442,PRCHPO,0),U,10))
"RTN","PRCHNPO4",110,0)
 I $G(PRCHSTAT)'="",PRCHSTAT'=10 D  S:$P(^PRC(442,PRCHPO,0),U,2)=26 $P(^PRC(442,PRCHPO,24),U)=1 G INV
"RTN","PRCHNPO4",111,0)
 . Q:$P(^PRC(442,PRCHPO,0),U,2)=2
"RTN","PRCHNPO4",112,0)
 . N PRCOPODA S PRCOPODA=PRCHPO D ^PRCOEDI,SUPP^PRCFFMO
"RTN","PRCHNPO4",113,0)
 I $G(PRCHOBL)=2 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",114,0)
 ;I $G(PRCHOBL)=2,$G(PRCHPC)'=1 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",115,0)
 ;I $G(PRCHOBL)'=2,$G(PRCHSTAT)'="",PRCHSTAT'=10 D
"RTN","PRCHNPO4",116,0)
 ;.I $G(PRCHPC)'=1 N PRCOPODA S PRCOPODA=PRCHPO W !!,"...now generating the PHA transaction" D ^PRCOEDI
"RTN","PRCHNPO4",117,0)
 ;.D:PRCHN("MP")'=25 SUPP^PRCFFMO
"RTN","PRCHNPO4",118,0)
 ;.I PRCHN("MP")=25,'$P($G(^PRC(442,PRCHPO,23)),U,11) D
"RTN","PRCHNPO4",119,0)
 ;..I '$P(^PRC(442,PRCHPO,0),U,12) S DA=PRCHPO D START^PRCH410 D  Q
"RTN","PRCHNPO4",120,0)
 ;...S PODA=PRCHPO,DA=CDA S X=$P(^PRC(442,PRCHPO,0),U,15) D ESIG^PRCH410 S DA=PODA K PODA
"RTN","PRCHNPO4",121,0)
 ;..I $P(^PRC(442,PRCHPO,0),U,12) D COMM^PRCSPC(PRCHPO,$P(^PRC(442,PRCHPO,0),U,10))
"RTN","PRCHNPO4",122,0)
 ;update due-ins at the inventory point
"RTN","PRCHNPO4",123,0)
INV G:$P($G(^PRC(442,PRCHPO,23)),U,11)="S" PRT
"RTN","PRCHNPO4",124,0)
 G:$G(PRCHPHAM) PRT
"RTN","PRCHNPO4",125,0)
 S FLG=0 I $P(^PRC(442,PRCHPO,0),U,2)=2 D
"RTN","PRCHNPO4",126,0)
 .S N=0 F  S N=$O(^PRC(442,PRCHPO,2,N)) Q:'N!(FLG)  I $P(^(N,0),U,5)]"" S FLG=1
"RTN","PRCHNPO4",127,0)
 .K N
"RTN","PRCHNPO4",128,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)'="S" I '$G(PRCHPHAM) D
"RTN","PRCHNPO4",129,0)
 . I $P(^PRC(442,PRCHPO,0),U,2)'=2 S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",130,0)
 . I ($P(^PRC(442,PRCHPO,0),U,2)=2)&(FLG) S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",131,0)
 K FLG
"RTN","PRCHNPO4",132,0)
 ;S DA=PRCHPO D UPDATE^PRCPWIU
"RTN","PRCHNPO4",133,0)
 ;
"RTN","PRCHNPO4",134,0)
PRT ;IF IMPREST FUND PO, PRINT A COPY ON BOTH IMPREST FUND & FISCAL PRINTER.
"RTN","PRCHNPO4",135,0)
 ;IF SUPPLY FUND PO, PRINT A COPY IN P&C AND ONE IN FISCAL.
"RTN","PRCHNPO4",136,0)
 ; OTHERWISE, PRINT A COPY IN FISCAL
"RTN","PRCHNPO4",137,0)
 ;IF SUPPLY FUND PAYMENT IN ADVANCE, PRINT 2 MORE COPIES IN FISCAL.
"RTN","PRCHNPO4",138,0)
 K PRCHQ S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",139,0)
 ;
"RTN","PRCHNPO4",140,0)
 I PRCHN("MP")=12 S PRCHQ("DEST2")="IFP" D ^PRCHQUE
"RTN","PRCHNPO4",141,0)
 I '$G(NOPRINT) I PRCHN("SFC")=2!(PRCHN("MP")=25) S:PRCHN("MP")'=25 PRCHQ("DEST")="S8" D ^PRCHQUE S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",142,0)
 ;
"RTN","PRCHNPO4",143,0)
 K PRCHQ S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT"
"RTN","PRCHNPO4",144,0)
 I PRCHN("MP")'=25 S PRCHQ("DEST")="F" D ^PRCHQUE
"RTN","PRCHNPO4",145,0)
 I PRCHN("SFC")=2,PRCHN("MP")=3 F PRCHI=1,2 S (D0,DA)=PRCHPO,PRCHQ="^PRCHFPNT",PRCHQ("DEST")="F" D ^PRCHQUE
"RTN","PRCHNPO4",146,0)
 G Q
"RTN","PRCHNPO4",147,0)
 ;
"RTN","PRCHNPO4",148,0)
QQ N:'$D(ROUTINE) ROUTINE S:$G(ROUTINE)="" ROUTINE=$T(+0) N DIR
"RTN","PRCHNPO4",149,0)
 W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7)
"RTN","PRCHNPO4",150,0)
 S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR K PRCSIG
"RTN","PRCHNPO4",151,0)
 Q
"RTN","PRCHNPO4",152,0)
 ;
"RTN","PRCHNPO4",153,0)
Q L  K PRCH,PRCHAC,PRCHACT,PRCHAM,PRCHAMT,PRCHB,PRCHBO,PRCHCN,PRCHCNT,PRCHD,PRCHDA,PRCHDT,PRCHEC,PRCHEDI,PRCHER,PRCHES,PRCHEST,PRCHESTL,PRCHFPDS,PRCHI,PRCHL0,PRCHL1,PRCHL2,PRCHL3,PRCHLCNT,PRCHLI,PRCSIG,ROUTINE
"RTN","PRCHNPO4",154,0)
 K PRCHN,PRCHNM,PRCHNRQ,PRCHP,PRCHPO,PRCHPONO,PRCHQ,PRCHS,PRCHSC,PRCHSTAT,PRCHTTT,PRCHV,PRCHVAR,PRCHX,PRCHY,DIC,DIE,DR,D0,DA,X,Y,Z,I,J,K,P,ZTSK
"RTN","PRCHNPO4",155,0)
 K ERROR,ITEMCNT,M,M0,PRCHFCP,PRCHLOG,PRCHSTN,ZTDESC,ZTRTN,ZTUCI,A,B,C,V3,PRCHXXD0,F1,I1,POP,PRCHLN,SUBACC,ERROR1,NOPRINT
"RTN","PRCHNPO4",156,0)
 Q
"RTN","PRCHREC")
0^29^B41539701
"RTN","PRCHREC",1,0)
PRCHREC ;ID/RSD,SF/TKW/RHD,DWA-PROCESS RECEIVING ;6/10/97  9:40
"RTN","PRCHREC",2,0)
V ;;5.1;IFCAP;**22,81**;Oct 20, 2000
"RTN","PRCHREC",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHREC",4,0)
 ;NOTE: VARIABLE 'PRCHIMP'-IMPREST FUND, 'PRCHPOO'-GENERATE PROOF OF ORDER ON GUARANTEED DELIVERY.
"RTN","PRCHREC",5,0)
 ;
"RTN","PRCHREC",6,0)
 S PRCF("X")="SP" D ^PRCFSITE Q:'$D(PRC("SITE"))!('$D(PRC("PER")))  I '$D(DT) D NOW^%DTC S DT=$P(%,".",1)
"RTN","PRCHREC",7,0)
 D SWITCH^PRCHUTL ;SET ISMS SWITCH
"RTN","PRCHREC",8,0)
 I '$D(PRCHAUTH),'$D(PRCHIMP),$S('$D(^VA(200,+PRC("PER"),400)):1,$P(^(400),U,1)=4:0,$P(^(400),U,1)=1:0,$P(^(400),U,1)=2:0,1:1) W !!,"You are not a Supply Warehouse person !",$C(7) Q
"RTN","PRCHREC",9,0)
 I ($D(PRCHIMP)!$D(PRCHAUTH)),'$D(^VA(200,+PRC("PER"),0)) W !!,"You are not on the Employee File!",$C(7) Q
"RTN","PRCHREC",10,0)
 ;
"RTN","PRCHREC",11,0)
EN I $D(PRCHPGM),PRCHPGM="EN5^PRCHEB" S PRCHIMP=1
"RTN","PRCHREC",12,0)
 S PRCHP("S")=$S($D(PRCHIMP):"$P(^(0),U,2)=7",1:"""178""[$P(^(0),U,2)!(($P(^(0),U,2)=""25"")&($P($G(^(23)),U,11)'=""S""))")
"RTN","PRCHREC",13,0)
 I $G(PRCHAUT1) S PRCHP("S")="$P($G(^(7)),U,2)>9,$P($G(^(23)),U,11)=""P"""
"RTN","PRCHREC",14,0)
 I $G(PRCHAUTH),'$G(PRCHAUT1) S PRCHP("S")="$P($G(^(7)),U,2)>9,$P($G(^(23)),U,11)=""D"",$P(^(0),U,2)'=26"
"RTN","PRCHREC",15,0)
 D EN3^PRCHPAT I '$D(PRCHPO) K CCARDPO,PRCHIMP,PRCHNRQ Q
"RTN","PRCHREC",16,0)
 I $G(PRCHAUTH) S PRCHAUCP=$P(^PRC(442,PRCHPO,0),U,3) D  I $G(PRCHAUFG) K PRCHAUCP,PRCHAUFG Q
"RTN","PRCHREC",17,0)
 . I '$D(^PRC(420,PRC("SITE"),1,+PRCHAUCP,1,DUZ)) D  S PRCHAUFG=1
"RTN","PRCHREC",18,0)
 . . W !!,"You are not an authorized user for "_$P(PRCHAUCP," ",1,2)_" control point.",!
"RTN","PRCHREC",19,0)
 K PRCHAUCP,PRCHAUFG
"RTN","PRCHREC",20,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="D",$P(^PRC(442,PRCHPO,1),U,10)=DUZ D  Q
"RTN","PRCHREC",21,0)
 .W !,"Since you entered this delivery order, you cannot receive this order.",!
"RTN","PRCHREC",22,0)
 I $D(^PRC(443.6,PRCHPO)) S PRCHAM=$O(^PRC(443.6,PRCHPO,6,0)) D:$G(PRCHAM)]""
"RTN","PRCHREC",23,0)
 .I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,2)]"" D
"RTN","PRCHREC",24,0)
 ..W !!,?5,"Purchase Order "_$P(^PRC(442,PRCHPO,0),U)_" cannot be processed at this time due",!,?5,"to pending amendment action - please contact purchasing agent." S FIS=1
"RTN","PRCHREC",25,0)
 I $D(FIS) K PRCHAM,FIS Q
"RTN","PRCHREC",26,0)
 S PRCHENTY=$O(^PRC(442,PRCHPO,13,0))
"RTN","PRCHREC",27,0)
 S:$G(PRCHENTY) PRCP("I")=$P($G(^PRC(442,PRCHPO,13,PRCHENTY,0)),U,11)
"RTN","PRCHREC",28,0)
 I $G(PRCP("I")) S N=0,INVITEM=0 F  S N=$O(^PRC(442,PRCHPO,2,N)) Q:'N!$G(INVITEM)  S PRCHITM=$P(^PRC(442,PRCHPO,2,N,0),U,5) I PRCHITM'="",$D(^PRCP(445,PRCP("I"),1,PRCHITM)) S INVITEM=1
"RTN","PRCHREC",29,0)
 I $G(PRCHAUTH),$G(INVITEM) D ^PRCPAUTH Q:'$G(PRCP("I"))  I $G(PRCP("I")),$G(PRCHFLAG)=1 K PRCHFLAG,NOINV Q
"RTN","PRCHREC",30,0)
 I $D(^PRC(442,PRCHPO,1)),$D(^VA(200,+$P(^(1),U,10),0)) W !,?13,"PA/PPM/AUTHORIZED BUYER: ",$P(^(0),U,1),!
"RTN","PRCHREC",31,0)
 I $P(^PRC(442,PRCHPO,0),U,2)'=25 I X<10!(X>29) W " ??",$C(7) G EN
"RTN","PRCHREC",32,0)
 I $P(^PRC(442,PRCHPO,0),U,2)=25 I X<10!(X>29)&(",32,34,39,44,46,47,"'[(","_X_",")) W " ??",$C(7) G EN
"RTN","PRCHREC",33,0)
 K PRCHNRQ,PRCHIMP S:$P(^PRC(442,PRCHPO,0),U,2)=8 PRCHNRQ=1 S:$P(^(0),U,2)=7 PRCHIMP=1
"RTN","PRCHREC",34,0)
 I $P(PRC("PARAM"),U,13)'="Y",X=10 W $C(7),!,?5,"This "_$S($D(PRCHNRQ):"REQUISITION",1:"PURCHASE ORDER")_" has not been obligated.",! G EN
"RTN","PRCHREC",35,0)
 D LCK1^PRCHE G:'$D(DA) Q K DIC("S") S D0=PRCHPO,%A="REVIEW "_$S($D(PRCHNRQ):"REQUISITION",1:"PURCHASE ORDER"),%B="",%=2 D ^PRCFYN G:%<1 Q D:%=1 ^PRCHDP1
"RTN","PRCHREC",36,0)
 ;
"RTN","PRCHREC",37,0)
1 R !!,"DATE RECEIVED: TODAY//",X:DTIME G:X="^"!'$T Q S %DT="EX",%DT(0)="-NOW" S:X="" X="TODAY" D ^%DT K %DT G:Y<0 1 I Y<$P(^PRC(442,PRCHPO,1),U,15) W !?3,"Receiving Date cannot be before P.O. date!",$C(7) G 1
"RTN","PRCHREC",38,0)
 I $D(^PRC(442,PRCHPO,2,"AB",Y)) D MULT^PRCHREC2 G:'$D(Y) 1
"RTN","PRCHREC",39,0)
 S PRCHRD=Y,PRCHRT0="",(PRCHRT,PRCHRFIN)=0 D TM^PRCHREC2 S:$P(^PRC(442,PRCHPO,7),U,3)="Y"&('$D(PRCHIMP)) PRCHRFIN=1
"RTN","PRCHREC",40,0)
 D ENTD^PRCHREC4 I PRCHDLVD["^" G EN
"RTN","PRCHREC",41,0)
 I $D(PRCHIMP) S X="C" G COM^PRCHREC1
"RTN","PRCHREC",42,0)
 K PRCHR
"RTN","PRCHREC",43,0)
 G LI^PRCHREC1
"RTN","PRCHREC",44,0)
 ;
"RTN","PRCHREC",45,0)
2 G:'$D(^PRC(442,PRCHPO,2,"AB",PRCHRD)) Q S PRCHRPT=0
"RTN","PRCHREC",46,0)
 I '$D(^PRC(442,PRCHPO,11,0)) S ^PRC(442,PRCHPO,11,0)="^442.11D^1^1",^(1,0)=PRCHRD_"^^^^",PRCHRPT=1
"RTN","PRCHREC",47,0)
 E  S I=0 F  S I=$O(^PRC(442,PRCHPO,11,I)) S:I=""!(I<0) PRCHRPT=PRCHRPT+1,$P(^(0),U,3,4)=PRCHRPT_U_($P(^(0),U,4)+1),^(PRCHRPT,0)=PRCHRD_"^^^^" Q:I=""!(I<0)  S PRCHRPT=I
"RTN","PRCHREC",48,0)
 I $D(PRCHDLVD),PRCHDLVD]"" D UPDD^PRCHREC4
"RTN","PRCHREC",49,0)
 S (PRCHLC,PRCHRIT)=0 D SUB^PRCHREC2
"RTN","PRCHREC",50,0)
 S PRCHDPT=PRCHRPT,PRCHDRD=PRCHRD,PRCHDTP=0 D ^PRCHDP3
"RTN","PRCHREC",51,0)
 ;
"RTN","PRCHREC",52,0)
EN2 S (PRCHR,PRCHRES(1),PRCHRES(2))=0,Y=^PRC(442,PRCHPO,0) I $P(Y,U,6)]"",'$D(PRCHR("SA",$P(Y,U,6))) S PRCHR("SA",$P(Y,U,6))=U
"RTN","PRCHREC",53,0)
 I $P(Y,U,8)]"",'$D(PRCHR("SA",$P(Y,U,8))) S PRCHR("SA",$P(Y,U,8))=U
"RTN","PRCHREC",54,0)
 F I=1:1:2 S PRCHR=$O(PRCHR("SA",PRCHR)),X=$S(PRCHR<0!(PRCHR=""):"",1:PRCHR("SA",PRCHR)) S:PRCHR'<0 PRCHR(I)=PRCHR_U_$J(X,0,2) S:PRCHR<0 PRCHR(I)=U
"RTN","PRCHREC",55,0)
 I PRCHRPT=1 S PRCHRES(1)=+$P(^PRC(442,PRCHPO,0),U,13) S:+PRCHR(2) (PRCHRES(1),PRCHRES(2))=$J(PRCHRES(1)/2,0,2) F I=1:1:2 S $P(PRCHR(I),U,2)=$P(PRCHR(I),U,2)+PRCHRES(I)
"RTN","PRCHREC",56,0)
 S (PRCHRAM,PRCHRAMN)=$P(PRCHR(1),U,2)+$P(PRCHR(2),U,2),Y=0
"RTN","PRCHREC",57,0)
 F I=1:1:2 I +$P(PRCHR(I),U,2) S X=$P(PRCHR(I),U,2)-PRCHRES(I),X1=$J(X*PRCHRT,0,2),$P(PRCHR(I),U,2)=(X-X1+PRCHRES(I)),Y=Y+X1
"RTN","PRCHREC",58,0)
 I PRCHRT S PRCHRAMN=$J(PRCHRAM-Y,0,2) W:'$D(PRCHAV) !?38,"TERM DISCOUNT AMOUNT: ",?68,$J(Y,8,2),!?48,"NET AMOUNT: ",?66,$J(PRCHRAMN,10,2)
"RTN","PRCHREC",59,0)
 I '$P(PRCHR(1),U,2) S PRCHR(1)=PRCHR(2),PRCHR(2)="^"
"RTN","PRCHREC",60,0)
 F I=1:1:2 S:'$P(PRCHR(I),U,2) PRCHR(I)="^"
"RTN","PRCHREC",61,0)
 Q:$D(PRCHAV)
"RTN","PRCHREC",62,0)
 G ES^PRCHREC2
"RTN","PRCHREC",63,0)
 ;
"RTN","PRCHREC",64,0)
EN3 I PRCHRFIN K ^PRC(442,PRCHPO,2,"C")
"RTN","PRCHREC",65,0)
 S PRCHX=PRCHR(1)_U_PRCHR(2)_"^^^" D NOW^%DTC
"RTN","PRCHREC",66,0)
 I $P(^PRC(442,PRCHPO,0),U,19)'=3 S $P(^PRC(442,PRCHPO,11,PRCHRPT,1),U,6)="N",^PRC(442,"AF","N",PRCHPO,PRCHRPT)=""
"RTN","PRCHREC",67,0)
 S X=+$P($G(^PRCD(442.3,+^PRC(442,PRCHPO,7),0)),U,2),X1=$D(^PRC(442,PRCHPO,2,"C"))
"RTN","PRCHREC",68,0)
 S $P(PRCHX,U,8,13)=$S(X1:"",1:"F")_U_$S($D(PRCHROV):"Y",1:"")_U_%_U_PRCHRAM_U_PRCHRT0_U_PRCHLC,$P(^PRC(442,PRCHPO,11,PRCHRPT,0),U,2,14)=PRCHX,PRCSIG="" D ENCODE^PRCHES1(PRCHPO,PRCHRPT,DUZ,.PRCSIG) S ROUTINE=$T(+0) G:PRCSIG<1 QQ
"RTN","PRCHREC",69,0)
 I $P(^PRC(442,PRCHPO,0),U,2)'=25 D
"RTN","PRCHREC",70,0)
 . S:X1 X=$S(X=10:28,X=0:0,X=22:25,X=23:26,X=20:25,X=21:26,1:X)
"RTN","PRCHREC",71,0)
 . S:'X1 X=$S(X=10:33,$D(PRCHIMP):40,X=22:30,X=0:0,X=20:30,X=21:31,X=23:31,X=26:31,X=28:33,X=25:30,1:X)
"RTN","PRCHREC",72,0)
 I $P(^PRC(442,PRCHPO,0),U,2)=25 D
"RTN","PRCHREC",73,0)
 . S:X1 X=$S(X=10:28,X=0:0,X=20:25,X=21:26,X=22:25,X=23:26,X=24:32,X=29:34,X=39:46,X=44:47,1:X)
"RTN","PRCHREC",74,0)
 . S:'X1 X=$S(X=10:33,X=20:30,X=21:31,X=22:30,X=23:31,X=24:50,X=25:30,X=26:31,X=27:30,X=28:33,X=29:51,X=32:50,X=34:51,X=39:48,X=44:49,X=46:48,X=47:49,1:X)
"RTN","PRCHREC",75,0)
 I PRCHRFIN,$P($G(^PRC(442,PRCHPO,24)),U),$P($G(^PRC(442,PRCHPO,23)),U,11)="D" D
"RTN","PRCHREC",76,0)
 . I X=30 S X=40 Q
"RTN","PRCHREC",77,0)
 . I X=31 S X=41
"RTN","PRCHREC",78,0)
 I '$D(PRCHPOO) S DA=PRCHPO D ENS^PRCHSTAT
"RTN","PRCHREC",79,0)
 S X=$P(^PRC(442,PRCHPO,0),U,17),X=X+PRCHRAMN,$P(^(0),U,17)=X
"RTN","PRCHREC",80,0)
 D PRT^PRCHREC4
"RTN","PRCHREC",81,0)
 ;
"RTN","PRCHREC",82,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCHREC",83,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D REC^PRCV442A(PRCHPO,PRCHRPT,1)
"RTN","PRCHREC",84,0)
 ;
"RTN","PRCHREC",85,0)
 I $$ISMSFLAG^PRCPUX2(PRC("SITE"))=2 S PRCHSC=$P(^PRC(442,PRCHPO,1),U,7) I PRCHSC=7 S PRCHTRAN="RC1",DA=PRCHPO D EN11^PRCHEI(PRCHTRAN)
"RTN","PRCHREC",86,0)
 I $G(PRCHAUTH),'$D(NOINV),$G(INVITEM) D AUTH^PRCPPOLM I $G(PRCPFLAG)=1 D DELP^PRCHREC2
"RTN","PRCHREC",87,0)
 G Q
"RTN","PRCHREC",88,0)
 ;
"RTN","PRCHREC",89,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0) W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7) S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR K ROUTINE,PRCSIG
"RTN","PRCHREC",90,0)
 Q
"RTN","PRCHREC",91,0)
 ;
"RTN","PRCHREC",92,0)
Q S:$D(PRCHPOO) PRCFA("PARTIAL")=PRCHRPT
"RTN","PRCHREC",93,0)
 D KILL^PRCHREC4 K ROUTINE
"RTN","PRCHREC",94,0)
 Q:$D(PRCHPOO)
"RTN","PRCHREC",95,0)
 G EN
"RTN","PRCHREC2")
0^30^B21606846
"RTN","PRCHREC2",1,0)
PRCHREC2 ;ID/RSD,SF/TKW-CONT. OF RECEIVING ;1/25/93  13:17
"RTN","PRCHREC2",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCHREC2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHREC2",4,0)
 ;
"RTN","PRCHREC2",5,0)
TM K I F I=0:0 S I=$O(^PRC(442,PRCHPO,5,I)) Q:'I  I +^(I,0)>0 S I(100-^(0))=^(0)
"RTN","PRCHREC2",6,0)
 S:$O(I(0)) PRCHRT0=I($O(I(0))),PRCHRT=+PRCHRT0/100,PRCHRT0=$P(PRCHRT0,U,1)_"%"_$P(PRCHRT0,U,2)
"RTN","PRCHREC2",7,0)
 I $P(^PRC(442,PRCHPO,0),U,19)=2 S PRCHRT=0
"RTN","PRCHREC2",8,0)
 Q
"RTN","PRCHREC2",9,0)
 ;
"RTN","PRCHREC2",10,0)
MULT S I=1 F Y=Y+.12:.01 Q:'$D(^PRC(442,PRCHPO,2,"AB",Y))  S I=I+1
"RTN","PRCHREC2",11,0)
 W !?3,I," receiving report(s) for ",X," already exist.",$C(7) S %A="     Do you want to continue ",%B="",%=2 D ^PRCFYN K:%'=1 X,Y
"RTN","PRCHREC2",12,0)
 Q
"RTN","PRCHREC2",13,0)
 ;
"RTN","PRCHREC2",14,0)
WP Q:'$D(^PRC(442,PRCHPO,2,+PRCHRIT,1,0))  K ^UTILITY($J,"W") S DIWL=1,DIWR=65,DIWF="" F PRCHI=0:0 S PRCHI=$O(^PRC(442,PRCHPO,2,+PRCHRIT,1,PRCHI)) Q:'PRCHI  S X=^(PRCHI,0) N Y D DIWP^PRCUTL($G(DA))
"RTN","PRCHREC2",15,0)
 F I=0:0 S I=$O(^UTILITY($J,"W",DIWL,I)) Q:'I  W !?5,^(I,0)
"RTN","PRCHREC2",16,0)
 K PRCHI,DIWL,DIWR,DIWF,^UTILITY($J,"W")
"RTN","PRCHREC2",17,0)
 Q
"RTN","PRCHREC2",18,0)
 ;
"RTN","PRCHREC2",19,0)
DEL S %A="   Are you sure you want to delete this Receiving Report ",%B="",%=2 D ^PRCFYN I %'=1 G:'$D(PRCHRDEL) ES Q
"RTN","PRCHREC2",20,0)
 ;
"RTN","PRCHREC2",21,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCHREC2",22,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D REC^PRCV442A(PRCHPO,PRCHRPT,2)
"RTN","PRCHREC2",23,0)
 ;
"RTN","PRCHREC2",24,0)
DELP D WAIT^DICD K ^PRC(442,PRCHPO,11,PRCHRPT) S $P(^(0),U,3,4)="0^"_($P(^(0),U,4)-1)
"RTN","PRCHREC2",25,0)
 F PRCHRIT=0:0 S PRCHRIT=$O(^PRC(442,PRCHPO,2,"AB",PRCHRD,PRCHRIT)) Q:'PRCHRIT  S PRCHRI=$O(^(PRCHRIT,0)),DA=PRCHRI,DA(1)=PRCHRIT,DA(2)=PRCHPO,DIK="^PRC(442,PRCHPO,2,PRCHRIT,3," D ^DIK
"RTN","PRCHREC2",26,0)
 F PRCHRIT=0:0 S PRCHRIT=$O(^PRC(442,PRCHPO,2,PRCHRIT)) Q:'PRCHRIT  I $D(^(PRCHRIT,0)) S X=+^(0),Y=$P(^(0),"^",2),Z=0 S:$D(^(2)) Z=$P(^(2),"^",8) I Z<Y S ^PRC(442,PRCHPO,2,"C",X,PRCHRIT)=""
"RTN","PRCHREC2",27,0)
 W !!?5,"Receiving Report Deleted ",$C(7) K PRCHRD,PRCHRPT,PRCHRI,PRCHRIT,DIK,DA G:'$D(PRCHRDEL) Q^PRCHREC
"RTN","PRCHREC2",28,0)
 Q
"RTN","PRCHREC2",29,0)
 ;
"RTN","PRCHREC2",30,0)
DEL1 S DIK="^PRC(442,PRCHPO,2,+PRCHRIT,3,",DA=PRCHRDY,DA(1)=+PRCHRIT,DA(2)=PRCHPO D ^DIK K DIK W "   <DELETED> ",$C(7),!
"RTN","PRCHREC2",31,0)
 Q
"RTN","PRCHREC2",32,0)
 ;
"RTN","PRCHREC2",33,0)
SUB S PRCHRIT=$O(^PRC(442,PRCHPO,2,"AB",PRCHRD,+PRCHRIT)) Q:'PRCHRIT  S PRCHRI=+$O(^(PRCHRIT,0))
"RTN","PRCHREC2",34,0)
 G:'$D(^PRC(442,PRCHPO,2,PRCHRIT,3,PRCHRI,0)) SUB S Y=^(0),PRCHRAM=$P(Y,U,3),PRCHRDA=$P(Y,U,5),$P(Y,U,4)=PRCHRPT,^(0)=Y,PRCHLC=PRCHLC+1
"RTN","PRCHREC2",35,0)
 I $P(^PRC(442,PRCHPO,0),U,6)]"" S PRCHRS=$S($P(^PRC(442,PRCHPO,2,PRCHRIT,2),U,7)]"":$P(^(2),U,7),1:"**")
"RTN","PRCHREC2",36,0)
 I $P(^PRC(442,PRCHPO,0),U,6)="" S PRCHRS="**"
"RTN","PRCHREC2",37,0)
 S PRCHRQ1=$P(^PRC(442,PRCHPO,2,PRCHRIT,0),U,2),PRCHRIT=PRCHRIT_U_$P(^(0),U,1),PRCHRQ2=$P(^(2),U,8) S:'$D(PRCHR("SA",PRCHRS)) PRCHR("SA",PRCHRS)=0
"RTN","PRCHREC2",38,0)
 S PRCHR("SA",PRCHRS)=PRCHR("SA",PRCHRS)+PRCHRAM-PRCHRDA,^PRC(442,PRCHPO,2,+PRCHRIT,3,"AC",PRCHRPT,PRCHRI)=""
"RTN","PRCHREC2",39,0)
 I 'PRCHRFIN K:PRCHRQ1'>PRCHRQ2 ^PRC(442,PRCHPO,2,"C",$P(PRCHRIT,U,2))
"RTN","PRCHREC2",40,0)
 G SUB
"RTN","PRCHREC2",41,0)
 ;
"RTN","PRCHREC2",42,0)
ES W ! I $G(PRCHRFIN) W $C(7) S %A="Is this Receiving Report the FINAL for this ESTIMATED Purchase Order ",%B="",%=2,PRCHRFIN=0 D ^PRCFYN S:%=1 PRCHRFIN=1
"RTN","PRCHREC2",43,0)
 N RRCHK S RRCHK=$P($G(^PRC(411,PRC("SITE"),0)),"^",8)
"RTN","PRCHREC2",44,0)
 N MOPCHK S MOPCHK=$P($G(^PRC(442,PRCHPO,0)),"^",2) S:MOPCHK=25 RRCHK="N"
"RTN","PRCHREC2",45,0)
 I '$D(PRCHPOO) S %A="   Approve this receiving report "_$S($D(PRCHIMP):"and complete the P.O.",((RRCHK="Y")&('$P($G(^PRC(442,PRCHPO,24)),U))):"and print in Receiving ",1:""),%B="",%=1
"RTN","PRCHREC2",46,0)
 I '$D(PRCHPOO) D ^PRCFYN G:%'=1&($D(PRCHIMP)) DEL G:%'=1 ED
"RTN","PRCHREC2",47,0)
 S DA=PRCHPO,P=+PRC("PER") I $D(PRCHPOO) S X=$P(PRC("PER"),"^",2),PRCHNM=X G EN3^PRCHREC
"RTN","PRCHREC2",48,0)
 S PRCSIG="" D ESIG^PRCUESIG(+DUZ,.PRCSIG) S ROUTINE="PRCUESIG" G:PRCSIG'=1 QQ
"RTN","PRCHREC2",49,0)
 G EN3^PRCHREC
"RTN","PRCHREC2",50,0)
 ;
"RTN","PRCHREC2",51,0)
ED S %A="   Edit this receiving report ",%B="",%=1 D ^PRCFYN G:%'=1 DEL
"RTN","PRCHREC2",52,0)
 D ENTD^PRCHREC4 G:PRCHDLVD["^" DEL
"RTN","PRCHREC2",53,0)
 F I=0:0 S I=$O(^PRC(442,PRCHPO,2,"AB",PRCHRD,I)) Q:'I  I $D(^PRC(442,PRCHPO,2,I,0)) S ^PRC(442,PRCHPO,2,"C",+^(0),I)=""
"RTN","PRCHREC2",54,0)
 K PRCHR,^PRC(442,PRCHPO,11,PRCHRPT) S $P(^(0),U,3,4)="0^"_($P(^(0),U,4)-1) W !
"RTN","PRCHREC2",55,0)
 G LI^PRCHREC1
"RTN","PRCHREC2",56,0)
 ;
"RTN","PRCHREC2",57,0)
QQ S:'$D(ROUTINE) ROUTINE=$T(+0) W !!,$$ERR^PRCHQQ(ROUTINE,PRCSIG) W:PRCSIG=0!(PRCSIG=-3) !,"Notify Application Coordinator!",$C(7) S DIR(0)="EAO",DIR("A")="Press <return> to continue" D ^DIR K ROUTINE
"RTN","PRCHREC2",58,0)
 G DEL
"RTN","PRCHSP1")
0^28^B40484764
"RTN","PRCHSP1",1,0)
PRCHSP1 ;WOIFO/TKW,RHD/DL-TRANSFER 2237 TO PO ; 6/8/99 11:01am
"RTN","PRCHSP1",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCHSP1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHSP1",4,0)
 ;
"RTN","PRCHSP1",5,0)
 ; Entered from 2^PRCHNPO3.
"RTN","PRCHSP1",6,0)
 ; Entered from ^PRCHSP.
"RTN","PRCHSP1",7,0)
 ;
"RTN","PRCHSP1",8,0)
 ; First lets check if any 2237 entries have Item Master File
"RTN","PRCHSP1",9,0)
 ; pointers.
"RTN","PRCHSP1",10,0)
 ; Next lets see if any of the IMF records do not have the P.O.
"RTN","PRCHSP1",11,0)
 ; record Vendor.
"RTN","PRCHSP1",12,0)
 ; Last lets a.  tell user of Vendor difference and
"RTN","PRCHSP1",13,0)
 ;           b.  find out if user wants to add Vender to IMF records.
"RTN","PRCHSP1",14,0)
 ; If YES,  proceed with transferring 2237 Items to P.O.
"RTN","PRCHSP1",15,0)
 ; If NO,   go back and see if user wants to add any other 2237
"RTN","PRCHSP1",16,0)
 ;          records to this P.O.
"RTN","PRCHSP1",17,0)
 ;
"RTN","PRCHSP1",18,0)
CHECK ;
"RTN","PRCHSP1",19,0)
 S (PRCHX,FLG)=0
"RTN","PRCHSP1",20,0)
 K DIRUT
"RTN","PRCHSP1",21,0)
 S PRCHCV=$P($G(^PRC(442,PRCHPO,1)),U,1)
"RTN","PRCHSP1",22,0)
 F  S PRCHX=$O(^PRCS(410,PRCHSY,"IT",PRCHX)) Q:PRCHX=""!(PRCHX'>0)  D  Q:FLG>0!($D(DIRUT))
"RTN","PRCHSP1",23,0)
 . S N0=$G(^PRCS(410,PRCHSY,"IT",PRCHX,0))
"RTN","PRCHSP1",24,0)
 . S IMF=+$P(N0,U,5)
"RTN","PRCHSP1",25,0)
 . Q:IMF'>0
"RTN","PRCHSP1",26,0)
 . I $D(^PRC(441,IMF,2,PRCHCV,0)) Q
"RTN","PRCHSP1",27,0)
 . S DIR("A",1)="This 2237 entry will update some ITEM MASTER FILE records"
"RTN","PRCHSP1",28,0)
 . S DIR("A",2)="with a new vendor, "_$P(^PRC(440,PRCHCV,0),U)_"."
"RTN","PRCHSP1",29,0)
 . S DIR("A",3)=" "
"RTN","PRCHSP1",30,0)
 . S DIR("A")="Do you want to do this"
"RTN","PRCHSP1",31,0)
 . S DIR("B")="NO"
"RTN","PRCHSP1",32,0)
 . S DIR(0)="Y"
"RTN","PRCHSP1",33,0)
 . D ^DIR
"RTN","PRCHSP1",34,0)
 . K DIR
"RTN","PRCHSP1",35,0)
 . Q:$D(DIRUT)
"RTN","PRCHSP1",36,0)
 . S:Y=1 FLG=1  ; YES
"RTN","PRCHSP1",37,0)
 . S:Y=0 FLG=2  ; NO
"RTN","PRCHSP1",38,0)
 . Q
"RTN","PRCHSP1",39,0)
 ;
"RTN","PRCHSP1",40,0)
 I FLG=2!($D(DIRUT)) S PRCHSY=-2 K DIRUT Q
"RTN","PRCHSP1",41,0)
 K DIRUT
"RTN","PRCHSP1",42,0)
 ;
"RTN","PRCHSP1",43,0)
 ;Moves 2237,PRCHSY, into PO,PRCHPO
"RTN","PRCHSP1",44,0)
 ;
"RTN","PRCHSP1",45,0)
 S (J,K,PRCHX)=0 I $D(^PRC(442,PRCHPO,2,0)) S I=0 F  S I=$O(^PRC(442,PRCHPO,2,I)) Q:I=""!(I'>0)  S J=J+1,K=I
"RTN","PRCHSP1",46,0)
 S PRCHJ=J,PRCHK=K F PRCHJ=PRCHJ+1:1 S PRCHX=$O(^PRCS(410,PRCHSY,"IT",PRCHX)) Q:PRCHX=""!(PRCHX'>0)  D
"RTN","PRCHSP1",47,0)
 .S PRCHK=PRCHK+1,PRCHSN=^PRCS(410,PRCHSY,"IT",PRCHX,0) D IT
"RTN","PRCHSP1",48,0)
 .K ^PRCS(410,PRCHSY,"IT","AB",PRCHX)
"RTN","PRCHSP1",49,0)
 .S $P(^PRCS(410,PRCHSY,"IT",PRCHX,0),U,10)=PRCHPO
"RTN","PRCHSP1",50,0)
 .Q
"RTN","PRCHSP1",51,0)
 S PRCHJ=PRCHJ-1,^PRC(442,PRCHPO,2,0)="^442.01IA^"_PRCHK_U_PRCHJ
"RTN","PRCHSP1",52,0)
 ;
"RTN","PRCHSP1",53,0)
MV1 S X=$P($P(^PRC(442,PRCHPO,0),U,1),"-",2),$P(^PRCS(410,PRCHSY,4),U,5)=X,$P(^(10),U,3)=PRCHPO,^PRCS(410,"D",X,PRCHSY)=""
"RTN","PRCHSP1",54,0)
 S Y=^PRCS(410,PRCHSY,3),X=$G(^PRC(420,PRC("SITE"),1,+Y,0))
"RTN","PRCHSP1",55,0)
 I $P(^PRC(442,PRCHPO,0),U,3)="" S $P(^(0),U,3,5)=$P(Y,U,1,2)_U_+$P(Y,U,3),$P(^(0),U,19)=$P(X,U,12),$P(^(17),U,1)=$E($P(X,U,18),1,3),^PRC(442,"E",$P($P(Y,U,1)," ",1),PRCHPO)=""
"RTN","PRCHSP1",56,0)
 S $P(^PRC(442,PRCHPO,0),U,14)=PRCHJ,$P(^(1),U,2)=$P(Y,U,5) S:$P(^(1),U,9)="" $P(^PRC(442,PRCHPO,1),U,9)=$P(^PRCS(410,PRCHSY,1),U,3)
"RTN","PRCHSP1",57,0)
 I '$D(PRCHNRQ) S:$D(^PRCS(410,PRCHSY,9)) $P(^PRC(442,PRCHPO,0),U,13)=$P(^PRCS(410,PRCHSY,9),U,4)
"RTN","PRCHSP1",58,0)
 S:$D(^PRCS(410,PRCHSY,9)) $P(^PRC(442,PRCHPO,1),U,11)=$P(^PRCS(410,PRCHSY,9),U,1)
"RTN","PRCHSP1",59,0)
 I $D(^PRC(443,PRCHSY,0)) S $P(^PRC(442,PRCHPO,1),U,18)=$P(^(0),U,12),DA=PRCHSY,DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCHSP1",60,0)
 I PRCHS,$D(^PRC(443,PRCHS,0)),'$D(^PRCS(410,PRCHS,"IT","AB")) S $P(^PRCS(410,PRCHS,0),U,12)="O" S DA=PRCHS,DIK="^PRC(443," D ^DIK K DIK,PRCHRBST
"RTN","PRCHSP1",61,0)
 K ^PRCS(410,PRCHSY,"IT","AB"),T,PRCHSN
"RTN","PRCHSP1",62,0)
 S X=^PRC(442,PRCHPO,0),X1=$P(^(1),U,15)
"RTN","PRCHSP1",63,0)
 S PRC("FY")=$E(100+$E(X1,2,3)+$E(X1,4),2,3)
"RTN","PRCHSP1",64,0)
 I '$D(PRC("BBFY")) S PRC("BBFY")=$$BBFY^PRCSUT(+$P(X,U),PRC("FY"),+$P(X,U,3))
"RTN","PRCHSP1",65,0)
 S PRC("BBFY")=PRC("BBFY")-1700_"0000"
"RTN","PRCHSP1",66,0)
 S $P(^PRC(442,PRCHPO,23),U,2)=PRC("BBFY")
"RTN","PRCHSP1",67,0)
 Q
"RTN","PRCHSP1",68,0)
 ;
"RTN","PRCHSP1",69,0)
IT ; CALLED FROM CHECK+25^PRCHSP1 (THIS ROUTINE).  CALLED FOR EACH
"RTN","PRCHSP1",70,0)
 ; LINE ITEM TO COPY 2237 LINE ITEM INTO P.O.
"RTN","PRCHSP1",71,0)
 ;
"RTN","PRCHSP1",72,0)
 S ^PRC(442,PRCHPO,2,PRCHK,0)=PRCHJ_U_$P(PRCHSN,U,2,99),$P(^(0),U,10)=PRCHSY,$P(^(2),U,13)=PRCHX,^PRC(442,PRCHPO,2,"B",PRCHJ,PRCHK)="",^PRC(442,PRCHPO,2,"C",PRCHJ,PRCHK)=""
"RTN","PRCHSP1",73,0)
 S X=$P(PRCHSN,U,6) I X?4N1"-"2N1"-"3N1"-"4N.UN S $P(^PRC(442,PRCHPO,2,PRCHK,0),U,13)=X,$P(^(0),U,6)="" S:$D(^PRC(441.2,+X,0)) $P(^PRC(442,PRCHPO,2,PRCHK,2),U,3)=+X
"RTN","PRCHSP1",74,0)
 ; PRC*5.1*81 move DM DOC ID to new 2237
"RTN","PRCHSP1",75,0)
 S:$D(^PRCS(410,PRCHSY,"IT",PRCHX,4))#10=1 $P(^PRC(442,PRCHPO,2,PRCHK,2),U,15)=$P(^PRCS(410,PRCHSY,"IT",PRCHX,4),"^",1) ; DM DOC ID
"RTN","PRCHSP1",76,0)
 ;
"RTN","PRCHSP1",77,0)
 D MDEL
"RTN","PRCHSP1",78,0)
 I $D(^PRC(441,+$P(PRCHSN,U,5),0)) G CRD
"RTN","PRCHSP1",79,0)
 S %X="^PRCS(410,PRCHSY,""IT"",PRCHX,1,",%Y="^PRC(442,PRCHPO,2,PRCHK,1," D %XY^%RCR
"RTN","PRCHSP1",80,0)
 Q
"RTN","PRCHSP1",81,0)
 ;
"RTN","PRCHSP1",82,0)
CRD N DA
"RTN","PRCHSP1",83,0)
 S PRCHCCP=$P($P(^PRCS(410,PRCHSY,3),U,1)," ",1)
"RTN","PRCHSP1",84,0)
 S PRCHCI=+$P(PRCHSN,U,5)
"RTN","PRCHSP1",85,0)
 S PRCHCV=$S($P(^PRC(442,PRCHPO,1),U,1)]"":+$P(^(1),U,1),1:0)
"RTN","PRCHSP1",86,0)
 S PRCHCPD=+$P(^PRC(442,PRCHPO,1),U,15)
"RTN","PRCHSP1",87,0)
 S PRCHCPO=PRCHPO
"RTN","PRCHSP1",88,0)
 S:$P(^PRC(442,PRCHPO,0),U,3)]"" PRCHCCP=$P($P(^(0),U,3)," ",1)
"RTN","PRCHSP1",89,0)
 I $D(^PRCP(445,+$P(^PRCS(410,PRCHSY,0),U,6),1,PRCHCI,0)) S X=^(0),$P(^PRC(442,PRCHPO,2,PRCHK,4),U,2)=$P(X,U,9),$P(^(4),U,4,5)=$P(X,U,18)_"^"_$P(X,U,13) S:$P(X,U,18)=1 $P(^(4),U,7)="-"
"RTN","PRCHSP1",90,0)
 I '$D(^PRC(441,PRCHCI,2,PRCHCV,0)) W !,"For item, ",$P(^PRC(441,PRCHCI,0),U,2),!?5,"Enter the following information: " D  G CRDQ
"RTN","PRCHSP1",91,0)
 . ;
"RTN","PRCHSP1",92,0)
 . ; Suggested list of variables to New to make DIE and maybe DIC
"RTN","PRCHSP1",93,0)
 . ; recursive.
"RTN","PRCHSP1",94,0)
 . ;
"RTN","PRCHSP1",95,0)
 . N DIC,DIE,DO,DA,DR,DD,DL,DP,I,J,X,DC,DE,D,D1,D2,D3,D4,D5,D6,DI
"RTN","PRCHSP1",96,0)
 . N DH,DIA,DICR,DIK,DLAYGO,DM,DQ,DU,DW,DIEL,DOV,DIOV,DIEC,DB,DV
"RTN","PRCHSP1",97,0)
 . N DK,DIFLD,DIADD,D0,DG
"RTN","PRCHSP1",98,0)
 . S DIC="^PRC(441,PRCHCI,2,"
"RTN","PRCHSP1",99,0)
 . S DIC(0)="LZ"
"RTN","PRCHSP1",100,0)
 . S DLAYGO=441
"RTN","PRCHSP1",101,0)
 . S DA(1)=PRCHCI
"RTN","PRCHSP1",102,0)
 . S (DA,X)=PRCHCV
"RTN","PRCHSP1",103,0)
 . D ^DIC
"RTN","PRCHSP1",104,0)
 . S DIE=DIC
"RTN","PRCHSP1",105,0)
 . S DR="1;1.5;2;3;4;1.6;10"
"RTN","PRCHSP1",106,0)
 . S DIE("NO^")=""
"RTN","PRCHSP1",107,0)
 . D ^DIE
"RTN","PRCHSP1",108,0)
 . K DIC,DIE("NO^")
"RTN","PRCHSP1",109,0)
 . S ^PRC(442,PRCHPO,2,"AE",PRCHCI,PRCHK)=""
"RTN","PRCHSP1",110,0)
 . S DA(1)=PRCHPO
"RTN","PRCHSP1",111,0)
 . S DA=PRCHK
"RTN","PRCHSP1",112,0)
 . D EN3^PRCHCRD
"RTN","PRCHSP1",113,0)
 . S DA=PRCHPO
"RTN","PRCHSP1",114,0)
 . K DA(1)
"RTN","PRCHSP1",115,0)
 . Q
"RTN","PRCHSP1",116,0)
 ;
"RTN","PRCHSP1",117,0)
 S (DA(1),PRCHCPO)=PRCHPO
"RTN","PRCHSP1",118,0)
 S DA=PRCHK
"RTN","PRCHSP1",119,0)
 S ^PRC(442,PRCHPO,2,"AE",PRCHCI,DA)=""
"RTN","PRCHSP1",120,0)
 D EN3^PRCHCRD
"RTN","PRCHSP1",121,0)
 ;
"RTN","PRCHSP1",122,0)
CRDQ K PRCHCCP,PRCHCPO,PRCHCV,PRCHCI,PRCHCPD,DA
"RTN","PRCHSP1",123,0)
 Q
"RTN","PRCHSP1",124,0)
 ;
"RTN","PRCHSP1",125,0)
MDEL ; MOVE DELIVERY SCHEDULE INFO FROM 2237 TO P.O. FOR ONE LINE ITEM
"RTN","PRCHSP1",126,0)
 ; ENTRY.  MDEL WILL BE CALLED FOR EACH LINE ITEM.
"RTN","PRCHSP1",127,0)
 ;
"RTN","PRCHSP1",128,0)
 ; CALLED FROM IT+2^PRCHSP1 (THIS ROUTINE).
"RTN","PRCHSP1",129,0)
 ;
"RTN","PRCHSP1",130,0)
 ; PRCHSY=410 INTERNAL RECORD NUMBER
"RTN","PRCHSP1",131,0)
 ; PRCHX=410 ITEM MULTIPLE INTERNAL RECORD NUMBER
"RTN","PRCHSP1",132,0)
 ; PRCHPO=442 INTERNAL RECORD NUMBER
"RTN","PRCHSP1",133,0)
 ; PRCHK=442 ITEM MULTIPLE INTERNAL RECORD NUMBER
"RTN","PRCHSP1",134,0)
 ;
"RTN","PRCHSP1",135,0)
 NEW DIC,DR
"RTN","PRCHSP1",136,0)
 K ^TMP("PRCHSP1",$J)
"RTN","PRCHSP1",137,0)
 S PRCHPONO=$P(^PRC(442,PRCHPO,0),U,1)
"RTN","PRCHSP1",138,0)
 S PRCHITM=$P(^PRC(442,PRCHPO,2,PRCHK,0),U,1)
"RTN","PRCHSP1",139,0)
 W "."
"RTN","PRCHSP1",140,0)
 S PRCHZ1=0
"RTN","PRCHSP1",141,0)
 D RD
"RTN","PRCHSP1",142,0)
 G:'$D(^TMP("PRCHSP1",$J)) Q
"RTN","PRCHSP1",143,0)
 S PRCHZ1=""
"RTN","PRCHSP1",144,0)
 F  S PRCHZ1=$O(^TMP("PRCHSP1",$J,PRCHZ1)) Q:PRCHZ1=""  S PRCHZ2="" F  S PRCHZ2=$O(^TMP("PRCHSP1",$J,PRCHZ1,PRCHZ2)) Q:PRCHZ2=""  S PRCHZ3="" D ADDS
"RTN","PRCHSP1",145,0)
 ;
"RTN","PRCHSP1",146,0)
Q K ^TMP("PRCHSP1",$J),PRCHITM,PRCHZ,PRCHZ0,PRCHZ1,PRCHZ2,PRCHZ3
"RTN","PRCHSP1",147,0)
 Q
"RTN","PRCHSP1",148,0)
 ;
"RTN","PRCHSP1",149,0)
RD S PRCHZ1=$O(^PRCS(410,PRCHSY,"IT",PRCHX,2,PRCHZ1))
"RTN","PRCHSP1",150,0)
 ;
"RTN","PRCHSP1",151,0)
 ; PRCHZ1=DELIVERY SCHEDULE INTERNAL RECORD MULTIPLE NUMBER
"RTN","PRCHSP1",152,0)
 ;
"RTN","PRCHSP1",153,0)
 Q:PRCHZ1'>0
"RTN","PRCHSP1",154,0)
 S PRCHZ0=$G(^PRCS(410,PRCHSY,"IT",PRCHX,2,PRCHZ1,0))
"RTN","PRCHSP1",155,0)
 ;
"RTN","PRCHSP1",156,0)
 ; PRCHZ0 PIECE 2=DELIVERY REFERENCE NUMBER POINTER
"RTN","PRCHSP1",157,0)
 ;
"RTN","PRCHSP1",158,0)
 G:+$P(PRCHZ0,U,2)'>0 RD
"RTN","PRCHSP1",159,0)
 G:'$D(^PRCS(410.6,+$P(PRCHZ0,U,2),0)) RD
"RTN","PRCHSP1",160,0)
 S PRCHZ2=^PRCS(410.6,+$P(PRCHZ0,U,2),0)
"RTN","PRCHSP1",161,0)
 ;
"RTN","PRCHSP1",162,0)
 ; PRCHZ2 PIECE 4=QTY TO BE DELIVERED
"RTN","PRCHSP1",163,0)
 ;
"RTN","PRCHSP1",164,0)
 G:'$P(PRCHZ2,U,4) RD
"RTN","PRCHSP1",165,0)
 ;
"RTN","PRCHSP1",166,0)
 ; PRCHZ2 PIECE 3=LOCATION (OF FILE 410.8 RECORD)
"RTN","PRCHSP1",167,0)
 ;
"RTN","PRCHSP1",168,0)
 G:+$P(PRCHZ2,U,3)'>0 RD
"RTN","PRCHSP1",169,0)
 S X=$P($G(^PRCS(410.8,+$P(PRCHZ2,U,3),0)),U,1)
"RTN","PRCHSP1",170,0)
 S:X="" X=" "
"RTN","PRCHSP1",171,0)
 ;
"RTN","PRCHSP1",172,0)
 ; PRCHZ2 PIECE 2=DELIVERY DATE
"RTN","PRCHSP1",173,0)
 ;
"RTN","PRCHSP1",174,0)
 S ^TMP("PRCHSP1",$J,+$P(PRCHZ2,U,2),X,PRCHZ1)=PRCHZ2
"RTN","PRCHSP1",175,0)
 G RD
"RTN","PRCHSP1",176,0)
 ;
"RTN","PRCHSP1",177,0)
ADDS S PRCHZ3=$O(^TMP("PRCHSP1",$J,PRCHZ1,PRCHZ2,PRCHZ3))
"RTN","PRCHSP1",178,0)
 Q:'PRCHZ3
"RTN","PRCHSP1",179,0)
 S PRCHZ=^TMP("PRCHSP1",$J,PRCHZ1,PRCHZ2,PRCHZ3)
"RTN","PRCHSP1",180,0)
 S DIC="^PRC(442.8,"
"RTN","PRCHSP1",181,0)
 S DLAYGO=442.8
"RTN","PRCHSP1",182,0)
 S DIC(0)="L"
"RTN","PRCHSP1",183,0)
 S DIC("DR")="1///"_PRCHITM_";2///"_$P(PRCHZ,U,2)_";3////"_$P(PRCHZ,U,3)_";4///"_$P(PRCHZ,U,4),X=""""_PRCHPONO_""""
"RTN","PRCHSP1",184,0)
 D ^DIC
"RTN","PRCHSP1",185,0)
 G ADDS
"RTN","PRCORV1")
0^50^B20500579
"RTN","PRCORV1",1,0)
PRCORV1 ;WISC/DJM/BGJ/AS-IFCAP VRQ REVIEW ROUTINE, CONTINUED ;3/8/05
"RTN","PRCORV1",2,0)
V ;;5.1;IFCAP;**7,81**;Oct 20, 2000
"RTN","PRCORV1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCORV1",4,0)
REV ;COMPLETE REVIEW OF VENDOR ENTRY
"RTN","PRCORV1",5,0)
 N SPACE,VALMY,IEN,PRCOI,PRCOIN,DIC,DA,DR,DIQ,DIR,Y
"RTN","PRCORV1",6,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","PRCORV1",7,0)
 S PRCOI=0
"RTN","PRCORV1",8,0)
 S PRCOI=$O(VALMY(PRCOI)) G:'PRCOI REVQ
"RTN","PRCORV1",9,0)
 S PRCOIN=$G(^TMP("PRCORV",$J,PRCOI))
"RTN","PRCORV1",10,0)
 S IEN=+$P(PRCOIN,U,2)
"RTN","PRCORV1",11,0)
 D FULL^VALM1
"RTN","PRCORV1",12,0)
 W @IOF
"RTN","PRCORV1",13,0)
 K PRCORVP
"RTN","PRCORV1",14,0)
 S DIC="^PRC(440,",DA=IEN,DR=".01:46",DIQ="PRCORVP",DIQ(0)="E"
"RTN","PRCORV1",15,0)
 D EN^DIQ1
"RTN","PRCORV1",16,0)
 S $P(SPACE," ",24)=" "
"RTN","PRCORV1",17,0)
 W !!,"           Vendor Name: "_$$FIELD(IEN,.01)
"RTN","PRCORV1",18,0)
 W ?70,"PAGE: 1"
"RTN","PRCORV1",19,0)
 W !,"      Ordering Address: "_$$FIELD(IEN,1)
"RTN","PRCORV1",20,0)
 W:$$FIELD(IEN,2)]"" !,SPACE_$$FIELD(IEN,2)
"RTN","PRCORV1",21,0)
 S X=SPACE
"RTN","PRCORV1",22,0)
 S:$$FIELD(IEN,4.2)]"" X=X_$$FIELD(IEN,4.2)_", "
"RTN","PRCORV1",23,0)
 S:$$FIELD(IEN,4.4)]"" X=X_$$FIELD(IEN,4.4)_" "
"RTN","PRCORV1",24,0)
 S X=X_$S($L($$FIELD(IEN,4.6))=9:$E($$FIELD(IEN,4.6),1,5)_"-"_$E($$FIELD(IEN,4.6),6,9),1:$$FIELD(IEN,4.6))
"RTN","PRCORV1",25,0)
 W !,X
"RTN","PRCORV1",26,0)
 W !!,"              FMS Name: "_$$FIELD(IEN,34.5)
"RTN","PRCORV1",27,0)
 W !!,"       Payment ADDRESS: "_$$FIELD(IEN,17.3)
"RTN","PRCORV1",28,0)
 W !,SPACE_$$FIELD(IEN,17.4)
"RTN","PRCORV1",29,0)
 W:$$FIELD(IEN,17.5)]"" !,SPACE_$$FIELD(IEN,17.5)
"RTN","PRCORV1",30,0)
 W:$$FIELD(IEN,17.6)]"" !,SPACE_$$FIELD(IEN,17.6)
"RTN","PRCORV1",31,0)
 S X=SPACE
"RTN","PRCORV1",32,0)
 S:$$FIELD(IEN,17.7)]"" X=X_$$FIELD(IEN,17.7)_", "
"RTN","PRCORV1",33,0)
 S:$$FIELD(IEN,17.8)]"" X=X_$$FIELD(IEN,17.8)_" "
"RTN","PRCORV1",34,0)
 S X=X_$S($L($$FIELD(IEN,17.9))=9:$E($$FIELD(IEN,17.9),1,5)_"-"_$E($$FIELD(IEN,17.9),6,9),1:$$FIELD(IEN,17.9))
"RTN","PRCORV1",35,0)
 W !,X
"RTN","PRCORV1",36,0)
 W !!,"PAYMENT CONTACT PERSON: "_$$FIELD(IEN,17)
"RTN","PRCORV1",37,0)
 W !,"  PAYMENT PHONE NUMBER: "_$$FIELD(IEN,7.2)
"RTN","PRCORV1",38,0)
 W !
"RTN","PRCORV1",39,0)
 S DIR(0)="E"
"RTN","PRCORV1",40,0)
 D ^DIR
"RTN","PRCORV1",41,0)
 K DIR
"RTN","PRCORV1",42,0)
 W !
"RTN","PRCORV1",43,0)
 G:Y'=1 REVEXIT
"RTN","PRCORV1",44,0)
 W @IOF
"RTN","PRCORV1",45,0)
 W !!,"           VENDOR NAME: "_$$FIELD(IEN,.01)
"RTN","PRCORV1",46,0)
 W ?70,"PAGE: 2"
"RTN","PRCORV1",47,0)
 W !!,"       FMS VENDOR CODE: "_$$FIELD(IEN,34)
"RTN","PRCORV1",48,0)
 W !,"          ALT-ADDR-IND: "_$$FIELD(IEN,35)
"RTN","PRCORV1",49,0)
 W !,"            TAX ID/SSN: "_$$FIELD(IEN,38)
"RTN","PRCORV1",50,0)
 W !,"        SSN/TAX ID IND: "_$$FIELD(IEN,39)
"RTN","PRCORV1",51,0)
 W !!,"        NON-RECURRING/"
"RTN","PRCORV1",52,0)
 W !,"      RECURRUNG VENDOR: "_$$FIELD(IEN,36)
"RTN","PRCORV1",53,0)
 W !!," 1099 VENDOR INDICATOR: "_$$FIELD(IEN,41)
"RTN","PRCORV1",54,0)
 W !,"           VENDOR TYPE: "_$$FIELD(IEN,44)
"RTN","PRCORV1",55,0)
 W !,"      DUN & BRADSTREET: "_$$FIELD(IEN,18.3)
"RTN","PRCORV1",56,0)
 W !
"RTN","PRCORV1",57,0)
 S DIR(0)="E"
"RTN","PRCORV1",58,0)
 S DIR("A")="Enter RETURN to continue"
"RTN","PRCORV1",59,0)
 D ^DIR
"RTN","PRCORV1",60,0)
 K DIR
"RTN","PRCORV1",61,0)
REVEXIT S VALMBCK="R",VALMBG=1
"RTN","PRCORV1",62,0)
REVQ Q
"RTN","PRCORV1",63,0)
 ;
"RTN","PRCORV1",64,0)
EDIT ;EDIT THIS VENDOR
"RTN","PRCORV1",65,0)
 N PRCOI,PRCOIN,IEN
"RTN","PRCORV1",66,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","PRCORV1",67,0)
 S PRCOI=0
"RTN","PRCORV1",68,0)
 S PRCOI=$O(VALMY(PRCOI)) G:'PRCOI REVQ
"RTN","PRCORV1",69,0)
 S PRCOIN=$G(^TMP("PRCORV",$J,PRCOI))
"RTN","PRCORV1",70,0)
 S IEN=+$P(PRCOIN,U,2)
"RTN","PRCORV1",71,0)
 D FULL^VALM1
"RTN","PRCORV1",72,0)
 W @IOF
"RTN","PRCORV1",73,0)
 S NAME=$P($G(^PRC(440,IEN,0)),U)
"RTN","PRCORV1",74,0)
 W:NAME]"" !!,NAME
"RTN","PRCORV1",75,0)
 D HILO^PRCFQ
"RTN","PRCORV1",76,0)
 S (DA,PRCFA("VEND"))=IEN D INFO^PRCFAC3 K PRCTMP D DOIT
"RTN","PRCORV1",77,0)
 G:$D(DIRUT)!(Y'=1) EDITEX
"RTN","PRCORV1",78,0)
 D SCREEN
"RTN","PRCORV1",79,0)
 L +^PRC(440,DA):5 E  W !,$C(7),"Another user is editing this entry!" G EDITEX
"RTN","PRCORV1",80,0)
 ;K ^PRC(440.3,DA) S %X="^PRC(440,DA,",%Y="^PRC(440.3,DA," D %XY^%RCR
"RTN","PRCORV1",81,0)
 S DIE="^PRC(440,",DR="[PRCF FMS VENEDIT1B]"
"RTN","PRCORV1",82,0)
 D ^DIE K DIE,DR,ORDER
"RTN","PRCORV1",83,0)
 L -^PRC(440,PRCFA("VEND"))
"RTN","PRCORV1",84,0)
EDITEX S VALMBCK="R",VALMBG=1
"RTN","PRCORV1",85,0)
 ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED   **81**
"RTN","PRCORV1",86,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1,$D(IEN) D ONECHK^PRCVNDR(PRCFA("VEND"))
"RTN","PRCORV1",87,0)
 Q
"RTN","PRCORV1",88,0)
 ;
"RTN","PRCORV1",89,0)
SEND ;SEND THIS VRQ TO AUSTIN
"RTN","PRCORV1",90,0)
 N PRCOI,PRCOIN,IEN
"RTN","PRCORV1",91,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","PRCORV1",92,0)
 S PRCOI=0
"RTN","PRCORV1",93,0)
 S PRCOI=$O(VALMY(PRCOI)) G:'PRCOI REVQ
"RTN","PRCORV1",94,0)
 S PRCOIN=$G(^TMP("PRCORV",$J,PRCOI))
"RTN","PRCORV1",95,0)
 S IEN=+$P(PRCOIN,U,2)
"RTN","PRCORV1",96,0)
 D SEND^PRCHE1(IEN)
"RTN","PRCORV1",97,0)
 D INIT^PRCORV
"RTN","PRCORV1",98,0)
 S VALMBCK="R",VALMBG=1
"RTN","PRCORV1",99,0)
 Q
"RTN","PRCORV1",100,0)
 ;
"RTN","PRCORV1",101,0)
DELETE ;DELETE THIS VENDOR REQUEST FROM THE LOCAL IFCAP SYSTEM
"RTN","PRCORV1",102,0)
 N PRCOI,PRCOIN,IEN,VRQ,COUNT
"RTN","PRCORV1",103,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","PRCORV1",104,0)
 S PRCOI=0
"RTN","PRCORV1",105,0)
 S PRCOI=$O(VALMY(PRCOI)) G:'PRCOI REVQ
"RTN","PRCORV1",106,0)
 S PRCOIN=$G(^TMP("PRCORV",$J,PRCOI))
"RTN","PRCORV1",107,0)
 S IEN=+$P(PRCOIN,U,2)
"RTN","PRCORV1",108,0)
 S NAME=$P($G(^PRC(440,IEN,0)),U)
"RTN","PRCORV1",109,0)
 S DIR("A")="Do you want to delete "_NAME_" (YES/NO)"
"RTN","PRCORV1",110,0)
 S DIR(0)="Y"
"RTN","PRCORV1",111,0)
 S DIR("B")="NO"
"RTN","PRCORV1",112,0)
 D ^DIR
"RTN","PRCORV1",113,0)
 K DIR
"RTN","PRCORV1",114,0)
 G:Y'=1 NODELETE
"RTN","PRCORV1",115,0)
 S VRQ=$O(^PRCF(422.2,"B","123-VRQ-01",0))
"RTN","PRCORV1",116,0)
 S COUNT=$P(^PRCF(422.2,VRQ,0),U,2),COUNT=$S(COUNT-1>0:COUNT-1,1:0),$P(^PRCF(422.2,VRQ,0),U,2)=COUNT
"RTN","PRCORV1",117,0)
 K ^PRC(440.3,"AD",IEN,IEN)
"RTN","PRCORV1",118,0)
 K ^PRC(440.3,IEN)
"RTN","PRCORV1",119,0)
 D INIT^PRCORV
"RTN","PRCORV1",120,0)
NODELETE S VALMBCK="R",VALMBG=1
"RTN","PRCORV1",121,0)
 Q
"RTN","PRCORV1",122,0)
 ;
"RTN","PRCORV1",123,0)
FIELD(IEN,FIELD) ;FETCH EXTERNAL VALUE OF FIELD
"RTN","PRCORV1",124,0)
 ;FOR RECORD 'IEN' FROM FILE 440.3
"RTN","PRCORV1",125,0)
 S FIELD=$G(PRCORVP(440,IEN,FIELD,"E"))
"RTN","PRCORV1",126,0)
 Q FIELD
"RTN","PRCORV1",127,0)
 ;
"RTN","PRCORV1",128,0)
DOIT ;FIND OUT IF USER WANTS TO EDIT VENDOR RECORD
"RTN","PRCORV1",129,0)
 W !
"RTN","PRCORV1",130,0)
 S DIR(0)="Y"
"RTN","PRCORV1",131,0)
 S DIR("A")="Edit the payment information on Vendor record"
"RTN","PRCORV1",132,0)
 S DIR("B")="YES"
"RTN","PRCORV1",133,0)
 S DIR("?")="Enter 'NO' or 'N' or '^' to exit this edit session."
"RTN","PRCORV1",134,0)
 S DIR("?",1)="Enter 'YES' or 'Y' or 'RETURN' to continue."
"RTN","PRCORV1",135,0)
 D ^DIR
"RTN","PRCORV1",136,0)
 K DIR
"RTN","PRCORV1",137,0)
 W !
"RTN","PRCORV1",138,0)
 Q
"RTN","PRCORV1",139,0)
 ;
"RTN","PRCORV1",140,0)
SCREEN ; Control screen display
"RTN","PRCORV1",141,0)
 I $D(IOF) W @IOF
"RTN","PRCORV1",142,0)
HDR ; Write Option Header
"RTN","PRCORV1",143,0)
 I $D(XQY0) W IOINHI,$P(XQY0,U,2),IOINORM,!
"RTN","PRCORV1",144,0)
 Q
"RTN","PRCOVUP")
0^51^B13130960
"RTN","PRCOVUP",1,0)
PRCOVUP ;WISC/DJM/AS-VENDOR UPDATE SERVER ROUTINE ;3/8/05
"RTN","PRCOVUP",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCOVUP",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCOVUP",4,0)
IN ;THIS ROUTINE WILL BE CALLED FROM THE 'FMS' SERVER VIA FILE 423.5
"RTN","PRCOVUP",5,0)
 ;ENTRY FOR THE VENDOR UPDATE TRANSACTION (VUP).
"RTN","PRCOVUP",6,0)
 ;PRCDA IS THE INTERNAL ENTRY NUMBER FOR THE RECORD FROM FILE 423.6.
"RTN","PRCOVUP",7,0)
 N AAN,AAC,ALTADD,ENTRY1,II,LOOP,PRCMG,PRCXM,LINE,STATION,STCK,ENTRY,ENCK,VEN3,VEN7,MGP,NAME,DIE,DR,DA,MTI,FMSVC,ZIP,%X,%Y,ALTFLG,FMS,ACTIVE
"RTN","PRCOVUP",8,0)
 S LINE=$G(^PRCF(423.6,PRCDA,1,10000,0))
"RTN","PRCOVUP",9,0)
 S MGP=$O(^PRCF(423.5,"B",$P(LINE,U)_"-"_$P(LINE,U,5),0))
"RTN","PRCOVUP",10,0)
 S MGP=$G(^PRCF(423.5,MGP,0))
"RTN","PRCOVUP",11,0)
 S PRCMG=$P($G(^XMB(3.8,$P(MGP,U,2),0)),U)
"RTN","PRCOVUP",12,0)
 S LOOP=10000
"RTN","PRCOVUP",13,0)
 F  S LOOP=$O(^PRCF(423.6,PRCDA,1,LOOP)) Q:LOOP'>0  D FIND Q:LINE["{"  I $D(PRCXM) S PRCXM(4)=LINE D PERROR^PRCOSRV3
"RTN","PRCOVUP",14,0)
 D KILL^PRCOSRV3(PRCDA)
"RTN","PRCOVUP",15,0)
 Q
"RTN","PRCOVUP",16,0)
 ;
"RTN","PRCOVUP",17,0)
FIND S LINE=$G(^PRCF(423.6,PRCDA,1,LOOP,0))
"RTN","PRCOVUP",18,0)
 Q:LINE["{"
"RTN","PRCOVUP",19,0)
 S STATION=$P(LINE,U,4)
"RTN","PRCOVUP",20,0)
 S STCK=$O(^PRC(411,"B",STATION,0))
"RTN","PRCOVUP",21,0)
 I STCK'>0 S PRCXM(1)=$P($T(ERROR+1),";;",2) Q
"RTN","PRCOVUP",22,0)
 K ACTIVE
"RTN","PRCOVUP",23,0)
 S ENTRY=$P(LINE,U,5)
"RTN","PRCOVUP",24,0)
 I ENTRY>0 S ACTIVE=1 D ENCK
"RTN","PRCOVUP",25,0)
 S (ENTRY1,ALTFLG)=0
"RTN","PRCOVUP",26,0)
 S FMS=$P(LINE,U,6)
"RTN","PRCOVUP",27,0)
 I FMS="" S PRCXM(3)=$P($T(ERROR+3),";;",2) Q
"RTN","PRCOVUP",28,0)
 S AAC=$P(LINE,U,7)
"RTN","PRCOVUP",29,0)
 F  S ENTRY1=$O(^PRC(440,"D",FMS,ENTRY1)) Q:ENTRY1'>0  D  Q:$D(PRCXM)  I ALTFLG=1 S ENTRY=ENTRY1 D ENCK I $D(PRCXM) S PRCXM(4)=LINE D PERROR^PRCOSRV3
"RTN","PRCOVUP",30,0)
 .S VEN3=$G(^PRC(440,ENTRY1,3))
"RTN","PRCOVUP",31,0)
 .I VEN3="" S PRCXM(2)=$P($T(ERROR+2),";;",2),PRCXM(4)=LINE D PERROR^PRCOSRV3 Q
"RTN","PRCOVUP",32,0)
 .S ALTADD=$P(VEN3,U,5) I ALTADD=AAC S ALTFLG=1
"RTN","PRCOVUP",33,0)
 .Q
"RTN","PRCOVUP",34,0)
 Q
"RTN","PRCOVUP",35,0)
 ;
"RTN","PRCOVUP",36,0)
ENCK S ALTFLG=0
"RTN","PRCOVUP",37,0)
 S ENCK=$G(^PRC(440,ENTRY,0))
"RTN","PRCOVUP",38,0)
 I ENCK="" S PRCXM(2)=$P($T(ERROR+2),";;",2) Q
"RTN","PRCOVUP",39,0)
 K ^PRC(440.3,ENTRY)
"RTN","PRCOVUP",40,0)
 S %Y="^PRC(440.3,ENTRY,"
"RTN","PRCOVUP",41,0)
 S %X="^PRC(440,ENTRY,"
"RTN","PRCOVUP",42,0)
 D %XY^%RCR
"RTN","PRCOVUP",43,0)
 S VEN3=$G(^PRC(440,ENTRY,3))
"RTN","PRCOVUP",44,0)
 I $P(LINE,U,7)]"" S $P(VEN3,U,5)=$P(LINE,U,7)
"RTN","PRCOVUP",45,0)
 I $P(LINE,U,14)]"" S $P(VEN3,U,9)=$P(LINE,U,14)
"RTN","PRCOVUP",46,0)
 S $P(VEN3,U,12)="C"
"RTN","PRCOVUP",47,0)
 I $P(LINE,U,15)]"" S $P(VEN3,U,11)=$P(LINE,U,15)
"RTN","PRCOVUP",48,0)
 I $P(LINE,U,16)]"" S $P(VEN3,U,14)=$P(LINE,U,16)
"RTN","PRCOVUP",49,0)
 I $P(LINE,U,17)]"" S $P(VEN3,U,13)=$P(LINE,U,17)
"RTN","PRCOVUP",50,0)
 I $P(LINE,U,19)]"" S $P(VEN3,U,15)=$P(LINE,U,19)
"RTN","PRCOVUP",51,0)
 I $P(LINE,U,20)]"" S $P(VEN3,U,10)=$P(LINE,U,20)
"RTN","PRCOVUP",52,0)
 ;set fms vendor name (field is uneditable)
"RTN","PRCOVUP",53,0)
 S NAME=$P(LINE,U,8)
"RTN","PRCOVUP",54,0)
 I NAME]"" D
"RTN","PRCOVUP",55,0)
 .F II=1:1 S AAN=$E(NAME,II) Q:AAN?1AN  S NAME=$E(NAME,2,99)
"RTN","PRCOVUP",56,0)
 .S $P(VEN3,U,7)=NAME
"RTN","PRCOVUP",57,0)
 .Q
"RTN","PRCOVUP",58,0)
 S VEN7=$G(^PRC(440,ENTRY,7))
"RTN","PRCOVUP",59,0)
 I $P(LINE,U,9)]"" S $P(VEN7,U,3)=$P(LINE,U,9)
"RTN","PRCOVUP",60,0)
 I $P(LINE,U,10)]"" S $P(VEN7,U,4)=$P(LINE,U,10)
"RTN","PRCOVUP",61,0)
 I $P(LINE,U,11)]"" S $P(VEN7,U,7)=$P(LINE,U,11)
"RTN","PRCOVUP",62,0)
 S ZIP=$P(LINE,U,13) I ZIP]"" D
"RTN","PRCOVUP",63,0)
 .S $P(VEN7,U,9)=$S($L(ZIP)=9:$E(ZIP,1,5)_"-"_$E(ZIP,6,9),1:ZIP)
"RTN","PRCOVUP",64,0)
 .Q
"RTN","PRCOVUP",65,0)
 I $P(LINE,U,12)]"" S $P(VEN7,U,8)=$O(^DIC(5,"C",$P(LINE,U,12),0))
"RTN","PRCOVUP",66,0)
 S ^PRC(440,ENTRY,3)=VEN3
"RTN","PRCOVUP",67,0)
 S ^PRC(440,ENTRY,7)=VEN7
"RTN","PRCOVUP",68,0)
 S DIE="^PRC(440,"
"RTN","PRCOVUP",69,0)
 S DA=ENTRY
"RTN","PRCOVUP",70,0)
 S FMSVC=$P(LINE,U,6)
"RTN","PRCOVUP",71,0)
 S DR="34////^S X=FMSVC"
"RTN","PRCOVUP",72,0)
 S NAME=$P(ENCK,U)
"RTN","PRCOVUP",73,0)
 S MTI="" I $P(LINE,U,19)]"" S MTI=$P(LINE,U,19)
"RTN","PRCOVUP",74,0)
 I MTI="D" S NAME="**"_NAME,DR=DR_";.01////^S X=NAME;31.5////^S X=1;15////@"
"RTN","PRCOVUP",75,0)
 I $G(ACTIVE),"ACF"[MTI,$E(NAME,1,2)="**" S NAME=$E(NAME,3,99),DR=DR_";.01////^S X=NAME;31.5////@;15////@"
"RTN","PRCOVUP",76,0)
 D ^DIE
"RTN","PRCOVUP",77,0)
 D BUL^PRCOVUP4
"RTN","PRCOVUP",78,0)
 ;   SEND VENDOR UPDATE INFORMATION TO DYNAMED  **81**
"RTN","PRCOVUP",79,0)
 D:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1)=1 ONECHK^PRCVNDR(ENTRY)
"RTN","PRCOVUP",80,0)
 K ^PRC(440.3,ENTRY),ACTIVE
"RTN","PRCOVUP",81,0)
 Q
"RTN","PRCOVUP",82,0)
 ;
"RTN","PRCOVUP",83,0)
ERROR ;HERE IS THE LIST OF ERROR MESSAGES
"RTN","PRCOVUP",84,0)
 ;;The STATION number from FMS can not be found at this location.
"RTN","PRCOVUP",85,0)
 ;;The VENDOR file entry returned from FMS can not be found.
"RTN","PRCOVUP",86,0)
 ;;This FMS transaction has no FMS VENDOR CODE.
"RTN","PRCPSFIV")
0^65^B27039826
"RTN","PRCPSFIV",1,0)
PRCPSFIV ;WOIFO/RFJ,LKG-create fms iv issues code sheet ;4/27/05  14:08
"RTN","PRCPSFIV",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCPSFIV",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPSFIV",4,0)
 Q
"RTN","PRCPSFIV",5,0)
 ;
"RTN","PRCPSFIV",6,0)
 ;
"RTN","PRCPSFIV",7,0)
IV(INVPT,TRANID,TRANNO,TRANDATE,STACKDA) ;  create fms iv document
"RTN","PRCPSFIV",8,0)
 ;  tranid=transaction register id number; tranno=ib number (from 410)
"RTN","PRCPSFIV",9,0)
 ;  trandate=optional FMS acctg period, otherwise it uses the
"RTN","PRCPSFIV",10,0)
 ;                                               transaction date
"RTN","PRCPSFIV",11,0)
 ;  pass stackda for regeneration of document
"RTN","PRCPSFIV",12,0)
 ;  loop transaction register for posted items
"RTN","PRCPSFIV",13,0)
 ;  variables required:
"RTN","PRCPSFIV",14,0)
 ;    prcpwsta = whse station #;  prcppsta = buyer station #
"RTN","PRCPSFIV",15,0)
 ;    prcpwfcp = whse fcp      ;  prcppfcp = buyer fcp
"RTN","PRCPSFIV",16,0)
 ;    prcpwbfy = whse beg fy   ;  prcppbfy = buyer beg fy
"RTN","PRCPSFIV",17,0)
 N ACCT,BUYBFY,BUYEFY,BUYFUND,BUYJOB,BUYLINE,BUYTABLE,BUYXPROG,COSTCNTR,DATA,FMSLINE,GECSFMS,INVCOST,LINEDA,LINEDOC,PRCPDA,PRCPFMOD,PRCPFMS,PRCPSEC1,PROFIT,PROFLINE
"RTN","PRCPSFIV",18,0)
 N SELBFY,SELEFY,SELFUND,SELLCOST,SELLINE,SELTABLE,SELXPROG,SIGN,SUBACCT,TOTAL,TRANDA,VOUCHER
"RTN","PRCPSFIV",19,0)
 S PRCPDA=$O(^PRCS(410,"B",TRANNO,0)) I 'PRCPDA Q
"RTN","PRCPSFIV",20,0)
 I $D(^PRCS(410,PRCPDA,"IT","FMSLINE")) S PRCPFMOD=1
"RTN","PRCPSFIV",21,0)
 K PRCPFMS
"RTN","PRCPSFIV",22,0)
 S (TRANDA,TOTAL)=0 F  S TRANDA=$O(^PRCP(445.2,"T",INVPT,TRANID,TRANDA)) Q:'TRANDA  S DATA=$G(^PRCP(445.2,TRANDA,0)) I DATA'="" D
"RTN","PRCPSFIV",23,0)
 .   S LINEDA=+$P(DATA,"^",24) I 'LINEDA Q
"RTN","PRCPSFIV",24,0)
 .   I 'TRANDATE S TRANDATE=$P(DATA,"^",3)
"RTN","PRCPSFIV",25,0)
 .   D FINDLINE^PRCPSFU0(PRCPDA,LINEDA)
"RTN","PRCPSFIV",26,0)
 .   ;  invcost and sellcost is minus when coming out of the whse
"RTN","PRCPSFIV",27,0)
 .   ;  inventory point.  fms is positive when coming out of the whse.
"RTN","PRCPSFIV",28,0)
 .   S INVCOST=-$P(DATA,"^",22),SELLCOST=-$P(DATA,"^",23)
"RTN","PRCPSFIV",29,0)
 .   S PROFIT=SELLCOST-INVCOST
"RTN","PRCPSFIV",30,0)
 .   ;  total is total of unsigned amounts on all lines
"RTN","PRCPSFIV",31,0)
 .   S TOTAL=TOTAL+SELLCOST
"RTN","PRCPSFIV",32,0)
 .   I '$D(PRCPFMS(FMSLINE)) S PRCPFMS(FMSLINE)=ACCT_"^"_SUBACCT
"RTN","PRCPSFIV",33,0)
 .   S $P(PRCPFMS(FMSLINE),"^",3)=$P(PRCPFMS(FMSLINE),"^",3)+INVCOST
"RTN","PRCPSFIV",34,0)
 .   S $P(PRCPFMS(FMSLINE),"^",4)=$P(PRCPFMS(FMSLINE),"^",4)+PROFIT
"RTN","PRCPSFIV",35,0)
 I '$D(PRCPFMS) Q
"RTN","PRCPSFIV",36,0)
IVCOTS ;Entry Point for building IV for COTS inventory transaction
"RTN","PRCPSFIV",37,0)
 ;  set up document variables
"RTN","PRCPSFIV",38,0)
 S COSTCNTR=$P($G(^PRCS(410,PRCPDA,3)),"^",3),COSTCNTR=$S($D(^PRCD(420.1,+COSTCNTR,0)):$P(^(0),"^"),1:COSTCNTR)
"RTN","PRCPSFIV",39,0)
 S VOUCHER=$P($G(^PRCS(410,PRCPDA,445)),"^") S VOUCHER=$E(VOUCHER_"00000",1,6)
"RTN","PRCPSFIV",40,0)
 ;  seller=whse
"RTN","PRCPSFIV",41,0)
 ;   table=^^xprogram(fcp/prj)^^linefund^beginfy^endfy^^^job
"RTN","PRCPSFIV",42,0)
 S SELTABLE=$$ACC^PRC0C(PRCPWSTA,PRCPWFCP_"^"_$P(TRANNO,"-",2)_"^"_PRCPWBFY)
"RTN","PRCPSFIV",43,0)
 S SELXPROG=$P(SELTABLE,"^",3),SELFUND=$P(SELTABLE,"^",5),SELBFY=$E($P(SELTABLE,"^",6),3,4),SELEFY=$E($P(SELTABLE,"^",7),3,4)
"RTN","PRCPSFIV",44,0)
 I SELEFY=SELBFY S SELEFY=""
"RTN","PRCPSFIV",45,0)
 ;  buyer
"RTN","PRCPSFIV",46,0)
 S BUYTABLE=$$ACC^PRC0C(PRCPPSTA,PRCPPFCP_"^"_$P(TRANNO,"-",2)_"^"_PRCPPBFY)
"RTN","PRCPSFIV",47,0)
 S BUYXPROG=$P(BUYTABLE,"^",3),BUYFUND=$P(BUYTABLE,"^",5),BUYBFY=$E($P(BUYTABLE,"^",6),3,4),BUYEFY=$E($P(BUYTABLE,"^",7),3,4),BUYJOB=$P(BUYTABLE,"^",10)
"RTN","PRCPSFIV",48,0)
 I BUYEFY=BUYBFY S BUYEFY=""
"RTN","PRCPSFIV",49,0)
 ;
"RTN","PRCPSFIV",50,0)
 ;  build control segments in gcs
"RTN","PRCPSFIV",51,0)
 S PRCPSEC1=$$SEC1^PRC0C(PRCPWSTA) S:PRCPSEC1="" PRCPSEC1=10
"RTN","PRCPSFIV",52,0)
 I '$G(STACKDA) D CONTROL^GECSUFMS("I",PRCPWSTA,PRCPWSTA_VOUCHER,"IV",PRCPSEC1,+$G(PRCPFMOD),"Y","post issue book: "_TRANNO_"  tranid: "_TRANID)
"RTN","PRCPSFIV",53,0)
 I $G(STACKDA) D REBUILD^GECSUFM1(STACKDA,"I",PRCPSEC1,"Y","Rebuild post issue book: "_TRANNO_"  tranid: "_TRANID) S GECSFMS("DA")=STACKDA
"RTN","PRCPSFIV",54,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),TRANID)
"RTN","PRCPSFIV",55,0)
 ;
"RTN","PRCPSFIV",56,0)
 ;  build iv2 segment
"RTN","PRCPSFIV",57,0)
 S LINEDOC="IV2^"_$E(TRANDATE,2,3)_"^"_$E(TRANDATE,4,5)_"^"_$E(TRANDATE,6,7)
"RTN","PRCPSFIV",58,0)
 S $P(LINEDOC,"^",9)=$S($D(GECSFMS("BAT")):"M",1:"E")
"RTN","PRCPSFIV",59,0)
 S $P(LINEDOC,"^",21)=$E($TR($P(TRANNO,"-",2,5),"-"),1,12)
"RTN","PRCPSFIV",60,0)
 S $P(LINEDOC,"^",22)=$J($S(TOTAL<0:-TOTAL,1:TOTAL),0,2)
"RTN","PRCPSFIV",61,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC_"^~")
"RTN","PRCPSFIV",62,0)
 ;
"RTN","PRCPSFIV",63,0)
 ;  build line documents
"RTN","PRCPSFIV",64,0)
 S LINEDA=0 F  S LINEDA=$O(PRCPFMS(LINEDA)) Q:'LINEDA  S DATA=PRCPFMS(LINEDA) D
"RTN","PRCPSFIV",65,0)
 .   S ACCT=$P(DATA,"^"),SUBACCT=$P(DATA,"^",2),INVCOST=$P(DATA,"^",3),PROFIT=$P(DATA,"^",4)
"RTN","PRCPSFIV",66,0)
 .   S SIGN="I" I INVCOST<0 S INVCOST=-INVCOST,SIGN="D"
"RTN","PRCPSFIV",67,0)
 .   S SELLINE="LIN^~IVA^"_$E("000",$L(LINEDA)+1,3)_LINEDA_"^"_$J(INVCOST,0,2)_"^"_SIGN_"^^"_SELBFY_"^"_SELEFY_"^"_SELFUND_"^"_PRCPWSTA_"^^^^"_SELXPROG_"^^^^SFCS^^^0"_$S(ACCT=1:4,ACCT=2:6,ACCT=8:2,1:8)_"^^"
"RTN","PRCPSFIV",68,0)
 .   S BUYLINE="^"_BUYBFY_"^"_BUYEFY_"^"_BUYFUND_"^"_PRCPPSTA_"^^"_$E(COSTCNTR,1,4)_"00^"_$E(COSTCNTR,5,6)_"^"_BUYXPROG_"^"_SUBACCT_"^~"
"RTN","PRCPSFIV",69,0)
 .   S LINEDOC=SELLINE_BUYLINE_"IVB^01^~"
"RTN","PRCPSFIV",70,0)
 .   I INVCOST D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC)
"RTN","PRCPSFIV",71,0)
 .   I 'PROFIT Q
"RTN","PRCPSFIV",72,0)
 .   ;  create profit line
"RTN","PRCPSFIV",73,0)
 .   S SIGN="I" I PROFIT<0 S PROFIT=-PROFIT,SIGN="D"
"RTN","PRCPSFIV",74,0)
 .   S PROFLINE=LINEDA+1
"RTN","PRCPSFIV",75,0)
 .   S SELLINE="LIN^~IVA^"_$E("000",$L(PROFLINE)+1,3)_PROFLINE_"^"_$J(PROFIT,0,2)_"^"_SIGN_"^^"_SELBFY_"^"_SELEFY_"^"_SELFUND_"^"_PRCPWSTA_"^^^^"_SELXPROG_"^^^^SFPR^^^0"_($S(ACCT=1:4,ACCT=2:6,ACCT=8:2,1:8)+1)_"^^"
"RTN","PRCPSFIV",76,0)
 .   S BUYLINE="^"_BUYBFY_"^"_BUYEFY_"^"_BUYFUND_"^"_PRCPPSTA_"^^"_$E(COSTCNTR,1,4)_"00^"_$E(COSTCNTR,5,6)_"^"_BUYXPROG_"^"_SUBACCT_"^~"
"RTN","PRCPSFIV",77,0)
 .   S LINEDOC=SELLINE_BUYLINE_"IVB^01^~"
"RTN","PRCPSFIV",78,0)
 .   D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC)
"RTN","PRCPSFIV",79,0)
 ;
"RTN","PRCPSFIV",80,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCPSFIV",81,0)
 D EN^DDIOL("FMS IV "_$S($D(GECSFMS("BAT")):"MODIFICATION ",1:"")_PRCPWSTA_VOUCHER_" document automatically "_$S($G(STACKDA):"RE-",1:"")_"transmitted.","","!?4")
"RTN","PRCPSFIV",82,0)
 Q
"RTN","PRCPSFSV")
0^66^B13681700
"RTN","PRCPSFSV",1,0)
PRCPSFSV ;WOIFO/RFJ,LKG-create fms sv adjustment code sheet ;4/27/05  14:08
"RTN","PRCPSFSV",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCPSFSV",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPSFSV",4,0)
 Q
"RTN","PRCPSFSV",5,0)
 ;
"RTN","PRCPSFSV",6,0)
 ;
"RTN","PRCPSFSV",7,0)
SV(INVPT,TRANID,TRANDATE,STACKDA) ;  create fms sv document for adjustment
"RTN","PRCPSFSV",8,0)
 ;  tranid=transaction register id number
"RTN","PRCPSFSV",9,0)
 ;  pass trandate for optional FMS acctg period, otherwise it uses the
"RTN","PRCPSFSV",10,0)
 ;                                               transaction date
"RTN","PRCPSFSV",11,0)
 ;  pass stackda for regeneration of document
"RTN","PRCPSFSV",12,0)
 ;  loop transaction register for adjusted items
"RTN","PRCPSFSV",13,0)
 ;  variables required:
"RTN","PRCPSFSV",14,0)
 ;    prcpwbfy = whse beg fy  ;  prcpwfcp = whse fcp
"RTN","PRCPSFSV",15,0)
 ;    prcpwsta = whse station #
"RTN","PRCPSFSV",16,0)
 N ACCT,BFY,DATA,EFY,FUND,GECSFMS,INVCOST,LINE,LINEDOC,PRCPFMS,PRCPSEC1,REASON,SIGN,TABLE,TOTAL,TRANDA,XPROG
"RTN","PRCPSFSV",17,0)
 K PRCPFMS
"RTN","PRCPSFSV",18,0)
 S (TRANDA,TOTAL)=0 F  S TRANDA=$O(^PRCP(445.2,"T",INVPT,TRANID,TRANDA)) Q:'TRANDA  S DATA=$G(^PRCP(445.2,TRANDA,0)) I DATA'="" D
"RTN","PRCPSFSV",19,0)
 .   I '$P(DATA,"^",5) Q
"RTN","PRCPSFSV",20,0)
 .   S INVCOST=$P(DATA,"^",22) I 'INVCOST Q
"RTN","PRCPSFSV",21,0)
 .   I 'TRANDATE S TRANDATE=$P(DATA,"^",3)
"RTN","PRCPSFSV",22,0)
 .   S ACCT=$$ACCT1^PRCPUX1($P($$NSN^PRCPUX1($P(DATA,"^",5)),"-"))
"RTN","PRCPSFSV",23,0)
 .   S REASON=+$P(DATA,"^",10) I 'REASON S REASON=+$G(^PRCP(445.2,TRANDA,1))
"RTN","PRCPSFSV",24,0)
 .   S TOTAL=TOTAL+INVCOST
"RTN","PRCPSFSV",25,0)
 .   S PRCPFMS(ACCT,REASON)=$G(PRCPFMS(ACCT,REASON))+INVCOST
"RTN","PRCPSFSV",26,0)
 .   I PRCPFMS(ACCT,REASON)=0 K PRCPFMS(ACCT,REASON)
"RTN","PRCPSFSV",27,0)
 I '$D(PRCPFMS) Q
"RTN","PRCPSFSV",28,0)
 ;
"RTN","PRCPSFSV",29,0)
SVCOTS ;Entry point for SV from COTS inventory transaction
"RTN","PRCPSFSV",30,0)
 ;  set up document variables
"RTN","PRCPSFSV",31,0)
 ;   table=^^xprogram(fcp/prj)^^linefund^beginfy^endfy^^^job
"RTN","PRCPSFSV",32,0)
 S TABLE=$$ACC^PRC0C(PRCPWSTA,PRCPWFCP_"^"_$E(DT,2,3)_"^"_PRCPWBFY)
"RTN","PRCPSFSV",33,0)
 S XPROG=$P(TABLE,"^",3),FUND=$P(TABLE,"^",5),BFY=$E($P(TABLE,"^",6),3,4),EFY=$E($P(TABLE,"^",7),3,4)
"RTN","PRCPSFSV",34,0)
 I EFY=BFY S EFY=""
"RTN","PRCPSFSV",35,0)
 ;
"RTN","PRCPSFSV",36,0)
 ;  build control segments in gcs
"RTN","PRCPSFSV",37,0)
 S PRCPSEC1=$$SEC1^PRC0C(PRCPWSTA) S:PRCPSEC1="" PRCPSEC1=10
"RTN","PRCPSFSV",38,0)
 I '$G(STACKDA) D CONTROL^GECSUFMS("I",PRCPWSTA,PRCPWSTA_TRANID,"SV",PRCPSEC1,0,"","Other adjustment tranid: "_TRANID)
"RTN","PRCPSFSV",39,0)
 I $G(STACKDA) D REBUILD^GECSUFM1(STACKDA,"I",PRCPSEC1,"","Rebuild of Other adjustment tranid: "_TRANID) S GECSFMS("DA")=STACKDA
"RTN","PRCPSFSV",40,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),TRANID)
"RTN","PRCPSFSV",41,0)
 ;
"RTN","PRCPSFSV",42,0)
 ;  build iv2 segment
"RTN","PRCPSFSV",43,0)
 S LINEDOC="SV2^"_$E(TRANDATE,2,3)_"^"_$E(TRANDATE,4,5)_"^"_$E(TRANDATE,6,7)
"RTN","PRCPSFSV",44,0)
 S $P(LINEDOC,"^",7)="E"
"RTN","PRCPSFSV",45,0)
 S $P(LINEDOC,"^",16)=$J($S(TOTAL<0:-TOTAL,1:TOTAL),0,2)
"RTN","PRCPSFSV",46,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC_"^~")
"RTN","PRCPSFSV",47,0)
 ;
"RTN","PRCPSFSV",48,0)
 ;  build line documents
"RTN","PRCPSFSV",49,0)
 S (ACCT,LINE)=0 F  S ACCT=$O(PRCPFMS(ACCT)) Q:'ACCT  S REASON="" F  S REASON=$O(PRCPFMS(ACCT,REASON)) Q:REASON=""  S INVCOST=PRCPFMS(ACCT,REASON) I INVCOST D
"RTN","PRCPSFSV",50,0)
 .   S SIGN="I" I INVCOST<0 S INVCOST=-INVCOST,SIGN="D"
"RTN","PRCPSFSV",51,0)
 .   S LINE=LINE+1
"RTN","PRCPSFSV",52,0)
 .   S LINEDOC="LIN^~SVA^"_$E("000",$L(LINE)+1,3)_LINE_"^S"_$$TRANTYPE(REASON,ACCT)_"^"_BFY_"^"_EFY_"^"_FUND_"^^"_PRCPWSTA_"^^^^"_XPROG
"RTN","PRCPSFSV",53,0)
 .   S $P(LINEDOC,"^",24)="220"
"RTN","PRCPSFSV",54,0)
 .   S LINEDOC=LINEDOC_"^~SVB^"_$J(INVCOST,0,2)_"^"_SIGN_"^^G^~"
"RTN","PRCPSFSV",55,0)
 .   D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC)
"RTN","PRCPSFSV",56,0)
 ;
"RTN","PRCPSFSV",57,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCPSFSV",58,0)
 D EN^DDIOL("FMS SV "_PRCPWSTA_TRANID_" document automatically "_$S($G(STACKDA):"RE-",1:"")_"transmitted.","","!?4")
"RTN","PRCPSFSV",59,0)
 Q
"RTN","PRCPSFSV",60,0)
 ;
"RTN","PRCPSFSV",61,0)
 ;
"RTN","PRCPSFSV",62,0)
TRANTYPE(TYPE,ACCT) ;  return transaction type based on type (1-7) and acct
"RTN","PRCPSFSV",63,0)
 ;  type=1:transfer stock to VAMC whse
"RTN","PRCPSFSV",64,0)
 ;  type=2:sale of stock to OGA
"RTN","PRCPSFSV",65,0)
 ;  type=3:transfer excess stock to GSA
"RTN","PRCPSFSV",66,0)
 ;  type=4:adjustment to stock valuation
"RTN","PRCPSFSV",67,0)
 ;  type=5:writeoff damaged stock
"RTN","PRCPSFSV",68,0)
 ;  type=6:transfer transportation to stock
"RTN","PRCPSFSV",69,0)
 ;  type=7:inventory refund adjustment
"RTN","PRCPSFSV",70,0)
 I TYPE=1 Q $S(ACCT=1:"A",ACCT=2:"B",ACCT=3:"C",ACCT=8:"D",1:0)
"RTN","PRCPSFSV",71,0)
 I TYPE=2 Q $S(ACCT=1:"E",ACCT=2:"F",ACCT=3:"G",ACCT=8:"H",1:0)
"RTN","PRCPSFSV",72,0)
 I TYPE=3!(TYPE=4) Q $S(ACCT=1:"I",ACCT=2:"J",ACCT=3:"K",ACCT=8:"L",1:0)
"RTN","PRCPSFSV",73,0)
 I TYPE=5 Q $S(ACCT=1:"M",ACCT=2:"N",ACCT=3:"O",ACCT=8:"P",1:0)
"RTN","PRCPSFSV",74,0)
 I TYPE=6 Q $S(ACCT=1:"Q",ACCT=2:"R",ACCT=3:"S",ACCT=8:"T",1:0)
"RTN","PRCPSFSV",75,0)
 I TYPE=7 Q $S(ACCT=1:"U",ACCT=2:"W",ACCT=3:"X",ACCT=8:"Y",1:0)
"RTN","PRCPSFSV",76,0)
 Q 0
"RTN","PRCSAPP2")
0^46^B18964515
"RTN","PRCSAPP2",1,0)
PRCSAPP2 ;WISC/KMB/BGJ/SC-CONTINUATION OF PRCSAPP ; 3/31/05 3:07pm
"RTN","PRCSAPP2",2,0)
V ;;5.1;IFCAP;**14,81**;Oct 20, 2000
"RTN","PRCSAPP2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSAPP2",4,0)
 ;
"RTN","PRCSAPP2",5,0)
 ;PRC*5.1*81-if a 2237 trx is being approved & it originated from
"RTN","PRCSAPP2",6,0)
 ;DynaMed RIL then update DM re. approval thru a call to rtn PRCVTAP
"RTN","PRCSAPP2",7,0)
 ;
"RTN","PRCSAPP2",8,0)
FINAL ;   ask if request was reviewed. print request if needed.
"RTN","PRCSAPP2",9,0)
 ;
"RTN","PRCSAPP2",10,0)
 N PRCSDA,PRCPRIB,RPRINT,REPLY,REPLY1 S (REPLY,REPLY1)=2
"RTN","PRCSAPP2",11,0)
 ; SKIPRNT is set in PRCSEB - official can approve request here
"RTN","PRCSAPP2",12,0)
 ; immediately after creating it in PRCSEB
"RTN","PRCSAPP2",13,0)
 I '$D(SKIPRNT) S %=0 W !,"Requests need to be reviewed prior to approval.",!,"Have you reviewed this request" D YN^DICN Q:%=-1  I %=0 W !,"Enter yes or no.",! H 1 G FINAL
"RTN","PRCSAPP2",14,0)
 I '$D(SKIPRNT),%=2 S (PRCS,PRCPRIB)=DA,TRNODE(0)=0 D:PRCHQ=1 NODE^PRCS58OB(DA,.TRNODE) S RPRINT=$S(PRCHQ=1:"^PRCE58P0",PRCHQ=5:"DQ^PRCPRIB0",1:"^PRCSD12") D @RPRINT S DA=PRCS
"RTN","PRCSAPP2",15,0)
 ;ask for approval, signature
"RTN","PRCSAPP2",16,0)
 N PRCOKCB S PRCOKCB=$$OKCCBOC^PRCSCK($P(PRCSN,"^"))
"RTN","PRCSAPP2",17,0)
 I PRCOKCB S %=1 W !,"Is this request ready for approval" D YN^DICN W:%=0 !,"Enter yes or no.",! G:%=0 FINAL Q:%=-1  S REPLY=%
"RTN","PRCSAPP2",18,0)
 I 'PRCOKCB S REPLY=2
"RTN","PRCSAPP2",19,0)
 ;
"RTN","PRCSAPP2",20,0)
FINAL1 ;*******************************************************************
"RTN","PRCSAPP2",21,0)
 ;PRCVDM -flag helps in determining if ans is Y to transmit to Fiscal
"RTN","PRCSAPP2",22,0)
 ;then ONLY pass the data to DynaMed for DM related approved 2237
"RTN","PRCSAPP2",23,0)
 ;*******************************************************************
"RTN","PRCSAPP2",24,0)
 N PRCVDM
"RTN","PRCSAPP2",25,0)
 I REPLY=1 W !,"Is this request ready for transmission to A&MM/Fiscal" S %=2 D YN^DICN Q:%=-1  S REPLY1=% S:%=1 PRCVDM=1 I %=0 W !,"Enter yes or no.",! H 1 G FINAL1
"RTN","PRCSAPP2",26,0)
 ;  if ready for approval (or reviewed), store on cross-ref F,F1
"RTN","PRCSAPP2",27,0)
 D:REPLY=2 W5^PRCSEB D:REPLY=1 W51^PRCSEB Q:REPLY1=2
"RTN","PRCSAPP2",28,0)
 I $D(SKIPRNT) S MESSAGE="" D ESIG^PRCUESIG(DUZ,.MESSAGE) Q:MESSAGE'=1
"RTN","PRCSAPP2",29,0)
 ;********************************************************************
"RTN","PRCSAPP2",30,0)
 ;all of the line item data that we need to pass to DM on a DM related
"RTN","PRCSAPP2",31,0)
 ;trx. is recorded in the file 410 at this point for an approved 2237
"RTN","PRCSAPP2",32,0)
 ;********************************************************************
"RTN","PRCSAPP2",33,0)
 I $D(PRCVDM),PRCVDM=1 D EN^PRCVTAP(DA)
"RTN","PRCSAPP2",34,0)
 ;
"RTN","PRCSAPP2",35,0)
 ;  set record in 443, clean up 410, change cp uncommitted balance 
"RTN","PRCSAPP2",36,0)
 ;  using TRANS^PRCSES, in 420
"RTN","PRCSAPP2",37,0)
 D NOW^%DTC S PRCS=%
"RTN","PRCSAPP2",38,0)
 S PRCSCP=$S($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)):$P(^(0),U,12),1:"")
"RTN","PRCSAPP2",39,0)
 N PPMFLG S:$D(PPMFLG1) PPMFLG=10
"RTN","PRCSAPP2",40,0)
 L +^PRCS(410,DA):15 Q:$T=0
"RTN","PRCSAPP2",41,0)
 S $P(^PRCS(410,DA,10),U,4)=$S(PRCSCP=1!(PRCHQ=1):$O(^PRCD(442.3,"C",10,0)),1:$O(^PRCD(442.3,"C",60,0))),$P(^(11),U,3)=""
"RTN","PRCSAPP2",42,0)
 N ESTSHIP,COST S ESTSHIP=$P($G(^PRCS(410,DA,9)),"^",4),COST=$P($G(^PRCS(410,DA,4)),"^",8)
"RTN","PRCSAPP2",43,0)
 N IJ F IJ=1,8 S $P(^PRCS(410,DA,4),"^",IJ)=ESTSHIP+COST
"RTN","PRCSAPP2",44,0)
 K ^PRCS(410,"F",+PRCSN_"-"_+PRC("CP")_"-"_$P($P(PRCSN,U),"-",5),DA),^PRCS(410,"F1",$P($P(PRCSN,U),"-",5)_"-"_+PRCSN_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA)
"RTN","PRCSAPP2",45,0)
 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)=""
"RTN","PRCSAPP2",46,0)
 D ERS410^PRC0G(DA_"^A")
"RTN","PRCSAPP2",47,0)
 ;
"RTN","PRCSAPP2",48,0)
 S MESSAGE=""
"RTN","PRCSAPP2",49,0)
 D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCSAPP2",50,0)
 K MESSAGE
"RTN","PRCSAPP2",51,0)
 S X=PRCST D TRANS^PRCSES
"RTN","PRCSAPP2",52,0)
 ;
"RTN","PRCSAPP2",53,0)
 S PRCSSCP=0 F PRCSSI=1:1 S PRCSSCP=$O(^PRCS(410,DA,12,PRCSSCP)) Q:PRCSSCP'>0  I $D(^PRCS(410,DA,12,PRCSSCP,0)) S X=$P(^(0),U,2) I X S DA(1)=DA,DA=PRCSSCP D TRANS^PRCSEZZ S DA=DA(1)
"RTN","PRCSAPP2",54,0)
 K PRCSSCP,PRCSSI L -^PRCS(410,DA)
"RTN","PRCSAPP2",55,0)
 I $P(PRCSN,U,4)>1 S X=$P(PRCSN,U,1),DIC="^PRC(443,",DIC(0)="L",DLAYGO=443 D ^DIC K DIC,DLAYGO,X
"RTN","PRCSAPP2",56,0)
 I $P(PRCSN,U,4)>1 S X=$O(^PRCD(442.3,"C",60,0)) S:PRCSCP=1 X=$O(^PRCD(442.3,"C",10,0)) S $P(^PRC(443,DA,0),U,7)=X,^PRC(443,"AC",X,DA)="",$P(^PRC(443,DA,0),U,11)=$P(PRCSN,U,6)
"RTN","PRCSAPP2",57,0)
 D EN2^PRCPWI
"RTN","PRCSAPP2",58,0)
 S (PRCS,PRCPRIB)=DA,TRNODE(0)=0 D:PRCHQ=1 NODE^PRCS58OB(DA,.TRNODE)
"RTN","PRCSAPP2",59,0)
TAG ;
"RTN","PRCSAPP2",60,0)
 S PRCSDA=DA
"RTN","PRCSAPP2",61,0)
 S D0=DA,PRCHQ=$S(PRCHQ=1:"QUE^PRCE58P2",PRCHQ=5:"DQ^PRCPRIB0",1:"QUE^PRCSP12"),PRCHQ("DEST")=$S(PRCSCP=1!(PRCHQ="QUE^PRCE58P2"):"F",1:"S") D ^PRCHQUE S DA=PRCSDA Q
"RTN","PRCSAPP2",62,0)
 Q
"RTN","PRCSAPP2",63,0)
PRT ;
"RTN","PRCSAPP2",64,0)
 K IO("Q") S %ZIS("B")="HOME",%ZIS="MQ" D ^%ZIS Q:POP
"RTN","PRCSAPP2",65,0)
 I $D(IO("Q")) S D0=$G(DA),ZTRTN=$S(PRCHQ=1:"QUE^PRCE58P2",PRCHQ=5:"DQ^PRCPRIB0",1:"^PRCSP12"),ZTSAVE("PRNTALL")="",ZTSAVE("DA")="",ZTSAVE("D0")="",ZTSAVE("PRC*")="",ZTSAVE("TRNODE*")="" D ^%ZTLOAD,^%ZISC Q
"RTN","PRCSAPP2",66,0)
 I IO=IO(0) U IO D:PRCHQ=5 DQ^PRCPRIB0 D:PRCHQ=1 ^PRCE58P0 D:PRCHQ'=1&(PRCHQ'=5) ^PRCSD12 D ^%ZISC W:$Y>0 @IOF Q
"RTN","PRCSAPP2",67,0)
 U IO D:PRCHQ=5 DQ^PRCPRIB0 D:PRCHQ=1 QUE^PRCE58P2 D:PRCHQ'=1&(PRCHQ'=5) ^PRCSP12 D ^%ZISC W:$Y>0 @IOF
"RTN","PRCSAPP2",68,0)
 QUIT
"RTN","PRCSCK")
0^45^B58904514
"RTN","PRCSCK",1,0)
PRCSCK ;SF-ISC/KSS/TKW/SC-CP INPUT TEMPLATE CHECK RTN ; 3/31/05 3:12pm
"RTN","PRCSCK",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSCK",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSCK",4,0)
 ;
"RTN","PRCSCK",5,0)
 ;PRC*5.1*81-SC-Adding a display of DM date needed by data, only if 
"RTN","PRCSCK",6,0)
 ;the trx. originated from DynaMed.
"RTN","PRCSCK",7,0)
 ;
"RTN","PRCSCK",8,0)
 ;PRCSF-(FLAG) SET IF ENTERING AT TOP OF ROUTINE
"RTN","PRCSCK",9,0)
 ;
"RTN","PRCSCK",10,0)
 S (PRCSF,PRCSERR)=0 F PRCSI=0:0 S PRCSI=$O(^PRCS(410,DA,"IT",PRCSI)) Q:'PRCSI  D 2 Q:PRCSERR  S PRCSERR=0 D 1 Q:PRCSERR  D ^PRCSCK1
"RTN","PRCSCK",11,0)
 I $D(PRCSERR),PRCSERR G EX
"RTN","PRCSCK",12,0)
 D SCP0^PRCSCK1
"RTN","PRCSCK",13,0)
EX K PRCSI,PRCSF,PRCSQT,PRCSDA,PRCSDA1,PRCSDA2,PRCS Q
"RTN","PRCSCK",14,0)
1 I $D(PRCSF) S PRCSDA2=DA,PRCSDA1=PRCSI,PRCSQT=$S($D(^PRCS(410,PRCSDA2,"IT",PRCSDA1,0)):$P(^(0),U,2),1:"") I PRCSQT D QRB2
"RTN","PRCSCK",15,0)
 Q
"RTN","PRCSCK",16,0)
2 ;ENTRY POINT WITHIN SUB-FIELD - (DA & DA(1)) DEFINED, OR
"RTN","PRCSCK",17,0)
 ;SUBROUTINE OF ABOVE (PRCSI AND DA) DEFINED.PRCSF (FLAG) SET
"RTN","PRCSCK",18,0)
 Q:'$D(DA)  I '$D(PRCSF) Q:'$D(DA(1))
"RTN","PRCSCK",19,0)
 N SPEC,PRCSIDA,PRCSBOC S SPEC=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),"^",12)
"RTN","PRCSCK",20,0)
 S PRCSERR=0,PRCSJ=DA S:'$D(PRCSF) PRCSI=DA,PRCSJ=DA(1)
"RTN","PRCSCK",21,0)
 S:$D(^PRCS(410,PRCSJ,"IT",PRCSI,0)) PRCSVAR=^(0)
"RTN","PRCSCK",22,0)
 D @$S(PRCSDR["2237":9,PRCSDR["IB":8,PRCSDR["NPR":8,1:7)
"RTN","PRCSCK",23,0)
 I PRCSERR S PRCSL=$S(PRCSERR=2:"QUANTITY",PRCSERR=3:"UNIT OF PURCHASE",PRCSERR=4:"BOC",PRCSERR=5:"ITEM MASTER FILE NO.",PRCSERR=10:"INTERMEDIATE PRODUCT CODE",1:"ESTIMATED ITEM UNIT COST")
"RTN","PRCSCK",24,0)
 I PRCSERR W !,?3,$C(7),"ITEM # "_$P(^PRCS(410,PRCSJ,"IT",PRCSI,0),U,1)_" "_PRCSL_" MISSING!" S Y="@1"
"RTN","PRCSCK",25,0)
 K PRCSJ,PRCSL,PRCSVAR K:'$D(PRCSF) PRCSI Q
"RTN","PRCSCK",26,0)
3 I $D(PRCSVAR) S PRCSERR=$S($P(PRCSVAR,U,2)="":2,$P(PRCSVAR,U,3)="":3,$P(PRCSVAR,U,7)="":7,1:0)
"RTN","PRCSCK",27,0)
 Q
"RTN","PRCSCK",28,0)
4 I $D(PRCSVAR),$P(PRCSVAR,U,4)="",($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)))&($P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,12)'>1)!'$D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S PRCSERR=4
"RTN","PRCSCK",29,0)
 S PRCSIDA=+$P(^PRCS(410,PRCSJ,"IT",PRCSI,0),"^",5)
"RTN","PRCSCK",30,0)
 Q
"RTN","PRCSCK",31,0)
5 I $D(PRCSVAR),$P(PRCSVAR,U,2)="" S PRCSERR=2
"RTN","PRCSCK",32,0)
 Q
"RTN","PRCSCK",33,0)
6 I $D(PRCSVAR),$P(PRCSVAR,U,11)="",$D(^PRC(411,PRC("SITE"),0)),$P(^(0),U,18)="Y" S PRCSERR=10
"RTN","PRCSCK",34,0)
 Q
"RTN","PRCSCK",35,0)
7 I $D(^PRCS(410,PRCSJ,3)),$P(^(3),U,4),$D(^(2)),$P(^(2),U,1)'="",$D(PRCSVAR)&($P(PRCSVAR,U,5)'="") D 5 Q:PRCSERR  D 4
"RTN","PRCSCK",36,0)
 E  D 3 Q:PRCSERR  D 4
"RTN","PRCSCK",37,0)
 Q:PRCSERR  D:PRCSDR["NR]" 6
"RTN","PRCSCK",38,0)
 Q
"RTN","PRCSCK",39,0)
8 I $D(^PRCS(410,PRCSJ,3)),$P(^(3),U,4),$D(^(2)),$P(^(2),U,1)'="",$D(PRCSVAR) S PRCSERR=$S($P(PRCSVAR,U,5)="":5,$P(PRCSVAR,U,2)="":2,1:0) Q:PRCSERR  D 4 Q:PRCSERR  I PRCSDR["IB]"!(PRCSDR["NPR]") D 6
"RTN","PRCSCK",40,0)
 Q
"RTN","PRCSCK",41,0)
9 D 3 Q:PRCSERR  D 4 Q:PRCSERR  D:PRCSDR["B" 6
"RTN","PRCSCK",42,0)
 Q
"RTN","PRCSCK",43,0)
RB S PRCST=$S($D(^PRCS(410,DA,4)):$P(^(4),U,8),1:"")
"RTN","PRCSCK",44,0)
 W !,?50,"TRANSACTION BEG BAL: ",$S(PRCST:$J(PRCST,0,2),1:"0.00") G EXIT
"RTN","PRCSCK",45,0)
RB1 S (PRCS,PRCS(1))=0 F PRCSII=0:0 S PRCS=$O(^PRCS(410,DA(1),12,PRCS)) Q:PRCS'>0  S PRCS(1)=PRCS(1)+$P(^(PRCS,0),U,2)
"RTN","PRCSCK",46,0)
 D RB3
"RTN","PRCSCK",47,0)
 I PRCS(2)>PRCST(1) S PRCS(3)=PRCS(2)-PRCST(1) W $C(7),!,"This is $ ",$J(PRCS(3),0,2)," more than the total available.",!,"Please re-edit your entries!" S Y=".01"
"RTN","PRCSCK",48,0)
 E  D RB4
"RTN","PRCSCK",49,0)
 G EXIT
"RTN","PRCSCK",50,0)
RB3 S (PRCST(1),PRCS(2))=0,PRCST=$S($D(^PRCS(410,DA(1),4)):$P(^(4),U,8),1:""),PRCS(2)=PRCS(1),PRCST(1)=PRCST S:PRCS(1)["-"&(PRCST(1)["-") PRCS(2)=-PRCS(1),PRCST(1)=-PRCST Q
"RTN","PRCSCK",51,0)
RB4 W ?29,"RUNNING TOTAL: ",$S(PRCS(2):$J(PRCS(2),0,2),1:"0.00"),?64,"BAL: ",$S(PRCST(1)-PRCS(2):$J(PRCST(1)-PRCS(2),0,2),1:"0.00") Q
"RTN","PRCSCK",52,0)
EX1 K PRCSQT,PRCSDA,PRCSDA1,PRCSDA2 Q
"RTN","PRCSCK",53,0)
EXIT K PRCSII,PRCSJJ,PRCS,PRCST Q
"RTN","PRCSCK",54,0)
QRB S PRCSQT=$S($D(^PRCS(410,DA(1),"IT",DA,0)):$P(^(0),U,2),1:""),PRCSCST=$S($D(^PRCS(410,DA(1),"IT",DA,0)):$P(^(0),U,7),1:"")
"RTN","PRCSCK",55,0)
 W !?50,"QTY BEG BAL: ",PRCSQT
"RTN","PRCSCK",56,0)
 ;********************************************************************
"RTN","PRCSCK",57,0)
 ;if DM system param. is set & Item Mult node 4 exists then display
"RTN","PRCSCK",58,0)
 ;Date Needed By for DM trxs only - Patch PRC*5.1*81
"RTN","PRCSCK",59,0)
 ;********************************************************************
"RTN","PRCSCK",60,0)
 N PRCVDT,PRCVDN
"RTN","PRCSCK",61,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1,$D(^PRCS(410,DA(1),"IT",DA,4)) S PRCVDT=$P($G(^(4)),"^",2) S PRCVDN=$$FMTE^XLFDT(PRCVDT,1) W !?37,"DynaMed's DATE NEEDED BY: "_PRCVDN
"RTN","PRCSCK",62,0)
 G EXIT
"RTN","PRCSCK",63,0)
QRB1 S PRCSDA=DA,PRCSDA1=DA(1),PRCSDA2=DA(2) Q
"RTN","PRCSCK",64,0)
QRB2 Q:'$D(PRCSQT)  Q:'PRCSQT  S PRCS=0,PRCS(1)=PRCSQT F PRCSJJ=1:1 S PRCS=$O(^PRCS(410,PRCSDA2,"IT",PRCSDA1,2,PRCS)) Q:PRCS'>0  S PRCS(2)=$S($D(^PRCS(410.6,+$P(^(PRCS,0),U,2),0)):$P(^(0),U,4),1:""),PRCS(1)=PRCS(1)-PRCS(2)
"RTN","PRCSCK",65,0)
 I '$D(PRCSF) W ?55,"QTY RUN BAL: ",PRCS(1)
"RTN","PRCSCK",66,0)
 S:PRCS(1)=0 PRCSERR="" I PRCS(1)<0 W !,$C(7),?15,"Total delivery schedule quantity exceeds item quantity by "_-(PRCS(1))_"." S PRCSERR=12 I '$D(PRCSF) S Y=3
"RTN","PRCSCK",67,0)
 Q
"RTN","PRCSCK",68,0)
ISSUPFCP(STA,FCP) ;RETURN 1 IF THIS IS A SUPPLY FUND FCP, 0 IF IT ISN'T
"RTN","PRCSCK",69,0)
 Q ($P($G(^PRC(420,+STA,1,+FCP,0)),"^",12)=2)
"RTN","PRCSCK",70,0)
 ;
"RTN","PRCSCK",71,0)
SUPPLYCC() ;RETURN DEFAULT CC FOR SUPPLY FUND FCPS
"RTN","PRCSCK",72,0)
 Q "615300 Inventory and Di"
"RTN","PRCSCK",73,0)
 ;
"RTN","PRCSCK",74,0)
SUPPLBOC() ;RETURN DEFAULT BOC FOR SUPPLY FUND FCPS
"RTN","PRCSCK",75,0)
 Q 2696
"RTN","PRCSCK",76,0)
 ;
"RTN","PRCSCK",77,0)
SETY ;SETS BRANCHING LOGIC FOR INPUT TEMPLATE 'PRCPIB' AND 'PRCSENIB' (INPUT TEMPLATES FOR ISSUE BOOK REQUESTS)
"RTN","PRCSCK",78,0)
 Q:'$D(PRCSERR)
"RTN","PRCSCK",79,0)
 S Y=$S(PRCSERR=2:2,PRCSERR=4:4,PRCSERR=5:5,1:".01")
"RTN","PRCSCK",80,0)
 Q
"RTN","PRCSCK",81,0)
 ;
"RTN","PRCSCK",82,0)
CHGCCBOC(CXLTXN,RPLTXN,OFCP,MUSTCHG) ;
"RTN","PRCSCK",83,0)
 ;cxltxn = transaction # of cancelled transaction
"RTN","PRCSCK",84,0)
 ;rpltxn = transaction# of replacement transaction
"RTN","PRCSCK",85,0)
 ;ofcp =old fund control point if this was a temp transaction
"RTN","PRCSCK",86,0)
 ;mustchg=user must change (currently not ever called with this set)
"RTN","PRCSCK",87,0)
 ;returns 0 if no change required, 1 if change made,-1 if user must edit
"RTN","PRCSCK",88,0)
 ;First get FCPs. If unchanged, quit
"RTN","PRCSCK",89,0)
 N CXLCC,CXLFCP,CXLDA,CXLSTA,RPLCC,RPLFCP,RPLDA,RPLSTA,CCCNT,DONE,RV
"RTN","PRCSCK",90,0)
 N RPLBOC,I,J,DA,DR,DIE,RPLFTYPE
"RTN","PRCSCK",91,0)
 S CXLFCP=$$GETTXNCP(CXLTXN,.CXLDA,.CXLSTA)
"RTN","PRCSCK",92,0)
 S RPLFCP=$$GETTXNCP(RPLTXN,.RPLDA,.RPLSTA)
"RTN","PRCSCK",93,0)
 I (+CXLFCP'=+OFCP) S CXLFCP=OFCP
"RTN","PRCSCK",94,0)
 I +CXLFCP=+RPLFCP Q 0
"RTN","PRCSCK",95,0)
 S RPLFTYPE=$P($G(^PRCS(410,RPLDA,0)),U,4)
"RTN","PRCSCK",96,0)
 ;Set CC. Stuff if there's only one good one.  Otherwise ask.
"RTN","PRCSCK",97,0)
 S CCCNT=$$GETCCCNT^PRCSECP(RPLSTA,RPLFCP)
"RTN","PRCSCK",98,0)
 I (+CCCNT=1) S RPLCC=$P(CCCNT,U,2),$P(^PRCS(410,RPLDA,3),U,3)=RPLCC W !!,"Cost Center updated to ",RPLCC,!
"RTN","PRCSCK",99,0)
 E  D
"RTN","PRCSCK",100,0)
 . S DA=RPLDA,DIE=410,DR="15.5R~Enter a Valid Cost Center"
"RTN","PRCSCK",101,0)
 . S DIC("S")="S PRCSCC=$P(^(3),U,3) I $$VALIDCC^PRCSECP(RPLSTA,RPLFCP,+PRCSCC)"
"RTN","PRCSCK",102,0)
 . D ^DIE
"RTN","PRCSCK",103,0)
 . S RPLCC=$P(^PRCS(410,RPLDA,3),U,3)
"RTN","PRCSCK",104,0)
 ;
"RTN","PRCSCK",105,0)
 ;OK--time to deal with the BOCs now. Is there only one good one?
"RTN","PRCSCK",106,0)
 S RV=1,NEWBOC=$$GETBOCNT^PRCSECP(RPLSTA,RPLFCP,+RPLCC)
"RTN","PRCSCK",107,0)
 I +NEWBOC=1 S RPLBOC=$P(NEWBOC,U,2),DONE=1,RV=0 D
"RTN","PRCSCK",108,0)
 . W !!,"BOC updated to ",RPLBOC," for the new document.",!!
"RTN","PRCSCK",109,0)
 . I RPLFTYPE>1 D
"RTN","PRCSCK",110,0)
 .. S I=0 F  S I=$O(^PRCS(410,RPLDA,"IT",I)) Q:I=""  D
"RTN","PRCSCK",111,0)
 ... S $P(^PRCS(410,RPLDA,"IT",I,0),U,4)=RPLBOC
"RTN","PRCSCK",112,0)
 . I RPLFTYPE=1 S $P(^PRCS(410,RPLDA,3),U,6)=RPLBOC
"RTN","PRCSCK",113,0)
 I '$G(DONE) D
"RTN","PRCSCK",114,0)
 . I RPLFTYPE>1 D
"RTN","PRCSCK",115,0)
 .. S I=0 F  S I=$O(^PRCS(410,RPLDA,"IT",I)) Q:'(I?1N.N)  D
"RTN","PRCSCK",116,0)
 ... S RPLBOC=$P(^PRCS(410,RPLDA,"IT",I,0),U,4)
"RTN","PRCSCK",117,0)
 ... I RPLBOC]"" S RPLBOC(RPLBOC)=$G(RPLBOC(RPLBOC))_I_";"
"RTN","PRCSCK",118,0)
 .. S I=""
"RTN","PRCSCK",119,0)
 .. W !!,"  This document refers to the following BOC(s):",!
"RTN","PRCSCK",120,0)
 .. I $O(RPLBOC(""))="" W "    [NONE]",!!
"RTN","PRCSCK",121,0)
 .. F  S I=$O(RPLBOC(I)) Q:I=""  D
"RTN","PRCSCK",122,0)
 ... W "    BOC: ",I,":"
"RTN","PRCSCK",123,0)
 ... I '$$VALIDBOC^PRCSECP(RPLSTA,RPLFCP,RPLCC,I) W " ** INVALID **" S RV=-1
"RTN","PRCSCK",124,0)
 ... W !,"    BOC ",+I," ITEM(S): ",$E(RPLBOC(I),1,$L(RPLBOC(I))-1)
"RTN","PRCSCK",125,0)
 ... W !!
"RTN","PRCSCK",126,0)
 . I RPLFTYPE=1 D
"RTN","PRCSCK",127,0)
 .. S RPLBOC=$P($G(^PRCS(410,RPLDA,3)),U,6)
"RTN","PRCSCK",128,0)
 .. W !!,"This document uses BOC ",RPLBOC
"RTN","PRCSCK",129,0)
 .. I '$$VALIDBOC^PRCSECP(RPLSTA,RPLFCP,RPLCC,RPLBOC) W " ** INVALID **" S RV=-1
"RTN","PRCSCK",130,0)
 . I RV<0,MUSTCHG W !,"You must edit this document to correct the BOC entries now.",!
"RTN","PRCSCK",131,0)
 Q RV
"RTN","PRCSCK",132,0)
 ;
"RTN","PRCSCK",133,0)
OKCCBOC(TRANSXN) ;TRANSXN = transaction# of transaction to check
"RTN","PRCSCK",134,0)
 ;returns 1 if no change required, 0 if user must edit
"RTN","PRCSCK",135,0)
 ;First get FCP, Form type, Station, IEN and CC
"RTN","PRCSCK",136,0)
 N A,CC,FCP,DA,STA,CCCNT,DONE,RV,GOODCC
"RTN","PRCSCK",137,0)
 N BOC,BOCC,I,J,DR,DIE,FTYPE
"RTN","PRCSCK",138,0)
 S FCP=$$GETTXNCP(TRANSXN,.DA,.STA)
"RTN","PRCSCK",139,0)
 I 'DA!'STA Q 0
"RTN","PRCSCK",140,0)
 S FTYPE=$P($G(^PRCS(410,DA,0)),U,4)
"RTN","PRCSCK",141,0)
 S CC=+$P($G(^PRCS(410,DA,3)),U,3) I 'CC Q 0
"RTN","PRCSCK",142,0)
 S GOODCC=$$VALIDCC^PRCSECP(STA,FCP,CC)
"RTN","PRCSCK",143,0)
 I 'GOODCC D  Q 0
"RTN","PRCSCK",144,0)
 . S A(1,"F")="!!?10",A(1)="An invalid Cost Center ("_+CC_") was entered."
"RTN","PRCSCK",145,0)
 . S A(2,"F")="!?10",A(2)="You must re-edit this document before it can be approved."
"RTN","PRCSCK",146,0)
 . S A(3)=$C(7)
"RTN","PRCSCK",147,0)
 . D EN^DDIOL(.A)
"RTN","PRCSCK",148,0)
 ;
"RTN","PRCSCK",149,0)
 ;OK--time to deal with the BOCs now.  For 1358s, check the single BOC
"RTN","PRCSCK",150,0)
 ;
"RTN","PRCSCK",151,0)
 S BOCC=$$GETBOCNT^PRCSECP(STA,FCP,CC)
"RTN","PRCSCK",152,0)
 S RV=1
"RTN","PRCSCK",153,0)
 I FTYPE=1 D  Q RV
"RTN","PRCSCK",154,0)
 . S BOC=$P($G(^PRCS(410,DA,3)),U,6)
"RTN","PRCSCK",155,0)
 . I '$$VALIDBOC^PRCSECP(STA,FCP,CC,BOC) D  Q
"RTN","PRCSCK",156,0)
 .. S A(1,"F")="!!?10",A(1)="An invalid BOC ("_+BOC_") was entered."
"RTN","PRCSCK",157,0)
 .. I (+BOCC=1) S $P(PRCS(410,DA,3),U,6)=$P(BOCC,U,2),A(2)="It has been changed to "_+$P(BOCC,U,2)
"RTN","PRCSCK",158,0)
 .. I (+BOCC'=1) S A(2)="You must re-edit this document before it can be approved."
"RTN","PRCSCK",159,0)
 .. S A(2,"F")="!?10"
"RTN","PRCSCK",160,0)
 .. S A(3)=$C(7)
"RTN","PRCSCK",161,0)
 .. D EN^DDIOL(.A)
"RTN","PRCSCK",162,0)
 .. S RV=0
"RTN","PRCSCK",163,0)
 ;
"RTN","PRCSCK",164,0)
 ;For the other form types, check all BOCs
"RTN","PRCSCK",165,0)
 ;
"RTN","PRCSCK",166,0)
 S (I,J)=0
"RTN","PRCSCK",167,0)
 F  S I=$O(^PRCS(410,DA,"IT",I)) Q:'(I?1N.N)  D
"RTN","PRCSCK",168,0)
 . S BOC=$P(^PRCS(410,DA,"IT",I,0),U,4)
"RTN","PRCSCK",169,0)
 . I '$$VALIDBOC^PRCSECP(STA,FCP,CC,BOC) D
"RTN","PRCSCK",170,0)
 .. S J=J+1,A(J)="An invalid BOC ("_+BOC_") was entered for item "_I_"."
"RTN","PRCSCK",171,0)
 .. S A(J,"F")="!?10" I J=1 S A(J,"F")="!"_A(J,"F")
"RTN","PRCSCK",172,0)
 .. I (+BOCC=1) S $P(^PRCS(410,DA,"IT",I,0),U,4)=$P(BOCC,U,2)
"RTN","PRCSCK",173,0)
 I J S RV=0,J=J+1,A(J,"F")="!?10",A(J)=$S((+BOCC'=1):"You must re-edit this document before it can be approved.",1:"BOC(s) replaced with "_+$P(BOCC,U,2)),A(J+1)=$C(7) D EN^DDIOL(.A)
"RTN","PRCSCK",174,0)
 Q RV
"RTN","PRCSCK",175,0)
GETTXNCP(TRANSID,OUTIEN,OUTSTA) ;GET IEN AND CONTROL POINT # FOR TRANSACTION
"RTN","PRCSCK",176,0)
 S OUTIEN=+$O(^PRCS(410,"B",TRANSID,""))
"RTN","PRCSCK",177,0)
 S OUTSTA=$P($G(^PRCS(410,OUTIEN,0)),U,5)
"RTN","PRCSCK",178,0)
 Q $P($G(^PRCS(410,OUTIEN,3)),U,1)
"RTN","PRCSCPY")
0^38^B47455501
"RTN","PRCSCPY",1,0)
PRCSCPY ;WISC/KMB/DXH/DAP - COPY OLD TEMP. REQUEST TO NEW ; 7.23.99
"RTN","PRCSCPY",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSCPY",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSCPY",4,0)
 ;
"RTN","PRCSCPY",5,0)
 N X3,T,T1,PRCSDR,OLDA,NEWDA,PRCDAA,PRCSAPP,PRCSK,NEWTEMP,OLD0NODE,OLD3NODE,I,J,PRCK,PRCHFLG
"RTN","PRCSCPY",6,0)
 ;
"RTN","PRCSCPY",7,0)
START ;
"RTN","PRCSCPY",8,0)
 W !!
"RTN","PRCSCPY",9,0)
 ; S PRCSK=1 ; flag to allow any user to select any site
"RTN","PRCSCPY",10,0)
 ; next line commented out in PRC*5*140 - user responses not used
"RTN","PRCSCPY",11,0)
 ; D EN1F^PRCSUT(1) G W2:'$D(PRC("SITE")) G EXIT:Y<0
"RTN","PRCSCPY",12,0)
 S X3="H",DIC="^PRCS(410,",DIC(0)="AEQ",DIC("A")="Select transaction to be copied: "
"RTN","PRCSCPY",13,0)
 S DIC("S")="I $P(^(0),U,3)'="""",^PRCS(410,""H"",$P(^(0),U,3),+Y)=DUZ!(^(+Y)="""")" ; request must be authored by user or be unauthored
"RTN","PRCSCPY",14,0)
 D ^PRCSDIC K DIC("A"),DIC("S")
"RTN","PRCSCPY",15,0)
 G EXIT:Y<0 ; user entered '^'
"RTN","PRCSCPY",16,0)
 S (OLDA,DA)=+Y ; subscript/internal# to file 410
"RTN","PRCSCPY",17,0)
 L +^PRCS(410,DA):1 I $T=0 D EN^DDIOL("File being accessed...please try later") Q
"RTN","PRCSCPY",18,0)
 D REVIEW
"RTN","PRCSCPY",19,0)
 S PRCVFT=$P(^PRCS(410,DA,0),"^",4)
"RTN","PRCSCPY",20,0)
 ;*81 Check site parameter to see if Issue Books are allowed
"RTN","PRCSCPY",21,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVZ=1
"RTN","PRCSCPY",22,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVZ=0
"RTN","PRCSCPY",23,0)
 I PRCVZ=1,PRCVFT=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP Issue Book order." D CLEAN G START
"RTN","PRCSCPY",24,0)
 K DA,DIC,PRCVFT,PRCVZ
"RTN","PRCSCPY",25,0)
 I $D(%) G EXIT:%=-1
"RTN","PRCSCPY",26,0)
ENTRY ;
"RTN","PRCSCPY",27,0)
 D EN^DDIOL("Please enter information for the transaction being created.")
"RTN","PRCSCPY",28,0)
 W !
"RTN","PRCSCPY",29,0)
 S PRCSK=1 ; allow user to select any station on system
"RTN","PRCSCPY",30,0)
 D EN1F^PRCSUT(1) ;ask site, FY, QRTR, CP & store in PRC array, set up PRCSIP
"RTN","PRCSCPY",31,0)
 G W2:'$D(PRC("SITE")) ; only happens if there are no stations on system?
"RTN","PRCSCPY",32,0)
 G EXIT:Y<0
"RTN","PRCSCPY",33,0)
EN1 D EN^DDIOL("Please enter a new transaction in the format 'A1234'")
"RTN","PRCSCPY",34,0)
 W !
"RTN","PRCSCPY",35,0)
 S DIC("A")="Enter new temporary transaction number: "
"RTN","PRCSCPY",36,0)
 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="L",D="H"
"RTN","PRCSCPY",37,0)
 S DIC("S")="I '^(0),$P(^(0),U,3)'="""",^PRCS(410,""H"",$P(^(0),U,3),+Y)=DUZ!(^(+Y)="""")" ; only requests authored by user or unauthored will display on partial match, display doesn't filter for station,CP,FY,or QRTR
"RTN","PRCSCPY",38,0)
 D ^PRCSDIC S NEWTEMP=X K DLAYGO,DIC("A"),DIC("S") G:Y<0 EXIT
"RTN","PRCSCPY",39,0)
 I $D(^PRCS(410,"H",$P(Y,U,2)))
"RTN","PRCSCPY",40,0)
 I  D EN^DDIOL("Must be a new and different temporary number.","","!!") G EN1
"RTN","PRCSCPY",41,0)
 S (NEWDA,T1,DA)=+Y ; subscript/internal# to file 410 for new txn
"RTN","PRCSCPY",42,0)
 ;
"RTN","PRCSCPY",43,0)
PROCESS ;ERC-10/96 Revised copy of fields into new transaction
"RTN","PRCSCPY",44,0)
 L +^PRCS(410,NEWDA):1 ; lock file being created
"RTN","PRCSCPY",45,0)
 I $T=0 D EN^DDIOL("File being accessed...please try a different number or try later") G EN1
"RTN","PRCSCPY",46,0)
 D EN^DDIOL("Transaction data is being copied.","","!?10") W !
"RTN","PRCSCPY",47,0)
 S T(2)=NEWTEMP
"RTN","PRCSCPY",48,0)
 D EN2A^PRCSUT3 ; sets up sta,substa,BBFY,author,CP,ACC,rb code,etc
"RTN","PRCSCPY",49,0)
 S OLD0NODE=^PRCS(410,OLDA,0),OLD3NODE=^PRCS(410,OLDA,3)
"RTN","PRCSCPY",50,0)
 F I=2,4 S $P(^PRCS(410,NEWDA,0),U,I)=$P(OLD0NODE,U,I) ; txn type,format
"RTN","PRCSCPY",51,0)
 ; note that for any FCP that is not automated,the form type is not forced to be non repetitive.  This may be because full implementation of IFCAP is mandatory.
"RTN","PRCSCPY",52,0)
 I $D(PRCSIP) S $P(^PRCS(410,NEWDA,0),U,6)=PRCSIP ; inventory distrib point, 'AO' xref will be set by XREF subroutine
"RTN","PRCSCPY",53,0)
 S %DT="X",X="T" D ^%DT ; get today in internal date format
"RTN","PRCSCPY",54,0)
 S $P(^PRCS(410,NEWDA,1),U)=Y ; & store as date of request
"RTN","PRCSCPY",55,0)
 I $D(^PRCS(410,OLDA,2)) S ^PRCS(410,NEWDA,2)=^PRCS(410,OLDA,2) ; vendor info may not be on 1358's
"RTN","PRCSCPY",56,0)
 F I=4:1:10 S $P(^PRCS(410,NEWDA,3),U,I)=$P(OLD3NODE,U,I)
"RTN","PRCSCPY",57,0)
 I $P(OLD3NODE,U)'=PRC("CP") S PRCHFLG=1 ; different CP
"RTN","PRCSCPY",58,0)
 E  S $P(^PRCS(410,NEWDA,3),U,3)=$P(OLD3NODE,U,3)
"RTN","PRCSCPY",59,0)
 F I=4,10 I $D(^PRCS(410,OLDA,I)) S $P(^PRCS(410,NEWDA,I),U)=$P(^PRCS(410,OLDA,I),U)
"RTN","PRCSCPY",60,0)
 I $P(^PRCS(410,NEWDA,0),U,4)=1 ;1358 needs Date Committed
"RTN","PRCSCPY",61,0)
 I  S $P(^PRCS(410,NEWDA,4),U,2)=$E($P(^PRCS(410,NEWDA,1),U),1,5)_"01"
"RTN","PRCSCPY",62,0)
 S $P(^PRCS(410,DA,7),U)=DUZ ; PRC140 - this line moved from FINAL
"RTN","PRCSCPY",63,0)
 S $P(^PRCS(410,DA,14),U)=DUZ
"RTN","PRCSCPY",64,0)
 I $D(^PRCS(410,OLDA,"RM",0)) S ^PRCS(410,NEWDA,"RM",0)=$P(^PRCS(410,OLDA,"RM",0),U,1,4)_"^"_DT,PRCK=0 D
"RTN","PRCSCPY",65,0)
 . F J=0:0 S PRCK=$O(^PRCS(410,OLDA,"RM",PRCK)) Q:'PRCK  S:$D(^PRCS(410,OLDA,"RM",PRCK,0)) ^PRCS(410,NEWDA,"RM",PRCK,0)=$P(^PRCS(410,OLDA,"RM",PRCK,0),U)
"RTN","PRCSCPY",66,0)
 S T1=OLDA,DA=NEWDA
"RTN","PRCSCPY",67,0)
 D S7^PRCSECP1 ; copy 'IT' subnode from the old transaction
"RTN","PRCSCPY",68,0)
 ;new transaction has different FCP from old txn
"RTN","PRCSCPY",69,0)
 I +$G(PRCHFLG) S PRCHFLG=$$CHGCCBOC^PRCSCK($P($G(^PRCS(410,T1,0)),U),$P($G(^PRCS(410,NEWDA,0)),U),$P($G(^PRCS(410,OLDA,3)),U,3),0)
"RTN","PRCSCPY",70,0)
 ;I '$G(PRCHFLG) G P2 ; new transaction has same CP as original
"RTN","PRCSCPY",71,0)
 ;D SRCH I X'="" S:X'=1 $P(^PRCS(410,NEWDA,3),U,3)=X G P1
"RTN","PRCSCPY",72,0)
 ;S DA=NEWDA,DR=15.5,DIE="^PRCS(410," D ^DIE ; ask cost center
"RTN","PRCSCPY",73,0)
 ;I $D(Y)'=0 D XREF G EXIT ; user entered '^'
"RTN","PRCSCPY",74,0)
 I ($G(PRCHFLG)<-1) D XREF G EXIT ; user entered '^'
"RTN","PRCSCPY",75,0)
P1 K PRCHFLG
"RTN","PRCSCPY",76,0)
P2 S DIC(0)="AEMQ",DIE=DIC,DR=7 D ^DIE ; ask Date required
"RTN","PRCSCPY",77,0)
 I $D(Y)'=0 D XREF G EXIT ; user entered '^'
"RTN","PRCSCPY",78,0)
 D XREF G EDIT
"RTN","PRCSCPY",79,0)
XREF S DA=NEWDA,DIK="^PRCS(410," D IX^DIK ; set up X-refs for new transaction
"RTN","PRCSCPY",80,0)
 Q 
"RTN","PRCSCPY",81,0)
EDIT ;
"RTN","PRCSCPY",82,0)
 S %=2 D EN^DDIOL("Would you like to edit this entry")
"RTN","PRCSCPY",83,0)
 D YN^DICN G EDIT:%=0 G EXIT:%=-1 G:%=2 FINAL
"RTN","PRCSCPY",84,0)
EDIT1 ;
"RTN","PRCSCPY",85,0)
 S X=+$P($G(^PRCS(410,DA,0)),"^",4) ; X is form type
"RTN","PRCSCPY",86,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCSCPY",87,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>1&(Y<5)",PRCVY="The Issue Book and NO FORM types are not valid in this option."
"RTN","PRCSCPY",88,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>1",PRCVY="The NO FORM type is not valid in this option."
"RTN","PRCSCPY",89,0)
 I X<1 D
"RTN","PRCSCPY",90,0)
 . S DA=NEWDA
"RTN","PRCSCPY",91,0)
 . D EN^DDIOL(PRCVY)
"RTN","PRCSCPY",92,0)
 . D EN^DDIOL("Please enter another form type.","","!!")
"RTN","PRCSCPY",93,0)
 . W !
"RTN","PRCSCPY",94,0)
 . S DIC="^PRCS(410.5,"
"RTN","PRCSCPY",95,0)
 . S DIC("A")="FORM TYPE: "
"RTN","PRCSCPY",96,0)
 . S DIC(0)="AEQZ"
"RTN","PRCSCPY",97,0)
 . S DIC("S")=PRCVX
"RTN","PRCSCPY",98,0)
 . D ^DIC
"RTN","PRCSCPY",99,0)
 . S:Y=-1 Y=2
"RTN","PRCSCPY",100,0)
 . S $P(^PRCS(410,NEWDA,0),"^",4)=+Y,X=+Y
"RTN","PRCSCPY",101,0)
 . K DIC,PRCVX,PRCVY
"RTN","PRCSCPY",102,0)
 D EN^DDIOL("The form type of this request is "_$P($G(^PRCS(410.5,X,0)),"^"))
"RTN","PRCSCPY",103,0)
 ; PRC140 - 2237 form types now use temporary transaction templates
"RTN","PRCSCPY",104,0)
 S (PRCSDR,DR)="["_$S(X=1:"PRCE NEW 1358S",X=2:"PRCSEN2237S",X=3:"PRCSENPRS",X=4:"PRCSENR&NRS",X=5:"PRCSENIBS",1:"PRCSENCOD")_"]"
"RTN","PRCSCPY",105,0)
 K DTOUT,DUOUT,Y
"RTN","PRCSCPY",106,0)
 S (DIE,DIC)="^PRCS(410,"
"RTN","PRCSCPY",107,0)
 D ^DIE I $D(Y)!($D(DTOUT)) G EXIT
"RTN","PRCSCPY",108,0)
 I +$P($G(^PRCS(410,DA,0)),"^",4)=1 G FINAL ; skip line item processing if this is a 1358
"RTN","PRCSCPY",109,0)
 S DA=NEWDA D RL^PRCSUT1
"RTN","PRCSCPY",110,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G EDIT1
"RTN","PRCSCPY",111,0)
 ;
"RTN","PRCSCPY",112,0)
FINAL ;
"RTN","PRCSCPY",113,0)
 W !! D CLEAN G START
"RTN","PRCSCPY",114,0)
 ;
"RTN","PRCSCPY",115,0)
REVIEW W !!,"Would you like to review this request" S %=2
"RTN","PRCSCPY",116,0)
 D YN^DICN G REVIEW:%=0 I %'=1 Q
"RTN","PRCSCPY",117,0)
 S PRC("SITE")=+$P(^PRCS(410,DA,0),"^",5)
"RTN","PRCSCPY",118,0)
 S PRC("CP")=$P(^PRCS(410,DA,3),"^")
"RTN","PRCSCPY",119,0)
 S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=OLDA K X,PRCSF,PRCSZ Q
"RTN","PRCSCPY",120,0)
 ;
"RTN","PRCSCPY",121,0)
W2 D EN^DDIOL("You are not an authorized control point user.","","!!")
"RTN","PRCSCPY",122,0)
 D EN^DDIOL("Contact your control point official")
"RTN","PRCSCPY",123,0)
 R X:5 G EXIT
"RTN","PRCSCPY",124,0)
W3 Q  ;can this be deleted? - commented out in patch PRC*5*140
"RTN","PRCSCPY",125,0)
 D EN^DDIOL("Would you like to copy another request","","!!")
"RTN","PRCSCPY",126,0)
 S %=1 D YN^DICN G W3:%=0 G START:%=1 Q
"RTN","PRCSCPY",127,0)
 ;
"RTN","PRCSCPY",128,0)
SRCH ;FIND COST CENTER
"RTN","PRCSCPY",129,0)
 ; returns x="" if there are multiple cc's, x=1 if no cc, x=cc if only 1
"RTN","PRCSCPY",130,0)
 S X=0
"RTN","PRCSCPY",131,0)
SRCH1 S X=$O(^PRC(420,PRC("SITE"),1,+PRC("CP"),2,X))
"RTN","PRCSCPY",132,0)
 I X=""!(+X'=X) D EN^DDIOL("Transaction will be created but this control point has no active cost center","","!!") S X=1 Q
"RTN","PRCSCPY",133,0)
 I '$D(^PRCD(420.1,X,0)) G SRCH1
"RTN","PRCSCPY",134,0)
 I $P(^PRCD(420.1,X,0),U,2)=1 G SRCH1
"RTN","PRCSCPY",135,0)
 S Y=X ; found 1 cost center
"RTN","PRCSCPY",136,0)
SRCH2 S X=$O(^PRC(420,PRC("SITE"),1,+PRC("CP"),2,X))
"RTN","PRCSCPY",137,0)
 I X=""!(+X'=X) S X=$P(^PRCD(420.1,Y,0),U) Q  ; save cost center
"RTN","PRCSCPY",138,0)
 I '$D(^PRCD(420.1,X,0)) G SRCH2
"RTN","PRCSCPY",139,0)
 I $P(^PRCD(420.1,X,0),U,2)=1 G SRCH2
"RTN","PRCSCPY",140,0)
 S X="" ; system can't select cost center - there is more than 1
"RTN","PRCSCPY",141,0)
 Q
"RTN","PRCSCPY",142,0)
CLEAN I $D(OLDA) L -^PRCS(410,OLDA)
"RTN","PRCSCPY",143,0)
 I $D(NEWDA)=1 L -^PRCS(410,NEWDA)
"RTN","PRCSCPY",144,0)
 K %,DA,DIC,X,Y,PRCSERR
"RTN","PRCSCPY",145,0)
 Q
"RTN","PRCSCPY",146,0)
 ;
"RTN","PRCSCPY",147,0)
EXIT D CLEAN
"RTN","PRCSCPY",148,0)
 Q
"RTN","PRCSD121")
0^41^B22790968
"RTN","PRCSD121",1,0)
PRCSD121 ;WISC/SAW/BMM-CONTROL POINT ACTIVITY 2237 DISPLAY CON'T ; 3/30/05 9:59am
"RTN","PRCSD121",2,0)
 ;;5.1;IFCAP;**70,81**;Oct 20, 2000
"RTN","PRCSD121",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSD121",4,0)
 ;PRINT ITEMS
"RTN","PRCSD121",5,0)
 ;
"RTN","PRCSD121",6,0)
 ;BMM PRC*5.1*81 edit PRCARD to also display new fields DM Doc ID 
"RTN","PRCSD121",7,0)
 ;(410.02, 17) and Date Needed By (410.02, 18) for 2237s originating
"RTN","PRCSD121",8,0)
 ;from DynaMed requisitions
"RTN","PRCSD121",9,0)
 ;
"RTN","PRCSD121",10,0)
 I $D(^PRCS(410,DA,1)),$P(^(1),U,5)'="" S P=$P(^(1),U,5),P=$P($G(^PRCS(410.2,P,0)),U) W !,?13,P,":"
"RTN","PRCSD121",11,0)
 S DIWL=13,DIWR=51,DIWF="",P(1)=0
"RTN","PRCSD121",12,0)
 F I=1:1 K ^UTILITY($J,"W") S P(1)=$O(^PRCS(410,DA,"IT",P(1))) G VENDOR:P(1)'?1N.E D ITEM1
"RTN","PRCSD121",13,0)
ITEM1 Q:'$D(^PRCS(410,DA,"IT",P(1),0))  S Z=^(0)
"RTN","PRCSD121",14,0)
 D:IOSL-$Y<3 NEWP Q:Z1=U
"RTN","PRCSD121",15,0)
 S P(4)=$P(Z,U,6) I $L(P(4))>12 W !,$E(P(4),1,13),!,$E(P(4),13,24)
"RTN","PRCSD121",16,0)
 I $L(P(4))<13 W !,P(4)
"RTN","PRCSD121",17,0)
 ;The variable Z is equal to ^PRCS(410,DA,"IT",P(1),0)
"RTN","PRCSD121",18,0)
 S PRCS("SUB")=+$P(Z,U,4),P(3)=$P(Z,U,3) S P(3)=$S($D(^PRCD(420.5,+P(3),0)):$P(^(0),U,1),1:"")
"RTN","PRCSD121",19,0)
 S P(0)=$S($P(Z,U,2)[".":$J($P(Z,U,2),9,2),1:$J($P(Z,U,2),9))_" "_$J(P(3),4)_" "_$S($P(Z,U,7)="N/C":$J("N/C",9),1:$J($P(Z,U,7),9,4))
"RTN","PRCSD121",20,0)
 G PRCARD:$P(Z,U,5)
"RTN","PRCSD121",21,0)
 S P(2)=0 F I=1:1 S P(2)=$O(^PRCS(410,DA,"IT",P(1),1,P(2))) Q:P(2)=""  S X=^(P(2),0) S:I=1 X=$P(^PRCS(410,DA,"IT",P(1),0),U,1)_" "_X D DIWP^PRCUTL($G(DA))
"RTN","PRCSD121",22,0)
ITEM2 I '$D(^UTILITY($J,"W",DIWL)) S ^(DIWL)=1,^(DIWL,1,0)="***NO DESCRIPTION***"
"RTN","PRCSD121",23,0)
 S Z=^UTILITY($J,"W",DIWL)
"RTN","PRCSD121",24,0)
 I Z>1 F J=1:1:(Z-1) W ?13,^UTILITY($J,"W",DIWL,J,0) D:IOSL-$Y<2 NEWP Q:Z1=U  W !
"RTN","PRCSD121",25,0)
 I Z>1 W ?13,^UTILITY($J,"W",DIWL,Z,0),?52,P(0) D:IOSL-$Y<2 NEWP Q:Z1=U  W !
"RTN","PRCSD121",26,0)
 I Z<2 W ?13,^UTILITY($J,"W",DIWL,1,0),?52,P(0) D:IOSL-$Y<2 NEWP Q:Z1=U  W !
"RTN","PRCSD121",27,0)
 Q
"RTN","PRCSD121",28,0)
PRCARD S P("PR")=$P(^PRCS(410,DA,"IT",P(1),0),U,5) G ITEM2:'$D(^PRC(441,P("PR"),1,0))
"RTN","PRCSD121",29,0)
 S P("PR1")=0,X=$P(^PRCS(410,DA,"IT",P(1),0),U)_" ITEM ID NO. "_P("PR") D DIWP^PRCUTL($G(DA)) F I=1:1 S P("PR1")=$O(^PRC(441,P("PR"),1,P("PR1"))) Q:P("PR1")=""  S X=^(P("PR1"),0) D DIWP^PRCUTL($G(DA))
"RTN","PRCSD121",30,0)
 S Z="" S:$P(^PRC(441,P("PR"),0),U,5)'="" Z=Z_" (NSN: "_$P(^(0),U,5)_")" S Z1=$P(^PRCS(410,DA,3),U,4) I Z1,$D(^PRC(441,P("PR"),2,Z1,0)) S:$P(^(0),U,5)'="" Z=Z_" (NDC: "_$P(^(0),U,5)_")" S:$P(^(0),U,3) Z2=$P(^(0),U,3)
"RTN","PRCSD121",31,0)
 S:$P($G(^PRC(441,P("PR"),3)),U,7)'="" Z=Z_" FOOD GROUP: "_$P(^(3),U,7)
"RTN","PRCSD121",32,0)
 I Z1,$D(^PRC(441,P("PR"),2,Z1,0)) S Z=Z_" PKG: "_$P(^(0),U,8)_" per "_$S($D(^PRCD(420.5,+$P(^(0),U,7),0)):$P(^(0),U),1:"")
"RTN","PRCSD121",33,0)
 I Z1,$D(Z2),$D(^PRC(440,Z1,4,Z2,0)),$P(^(0),U,1)'="" S Y=$S($P(^(0),U,2):$P(^(0),U,2),1:"") X:Y ^DD("DD") S Z=Z_" (CONTRACT # "_$P(^PRC(440,Z1,4,Z2,0),U,1)_$S(Y'="":", EXPIRATION DATE: "_Y_")",1:")") K Z2
"RTN","PRCSD121",34,0)
 S X=Z D:$L(X) DIWP^PRCUTL($G(DA))
"RTN","PRCSD121",35,0)
 ;PRC*5.1*81 check DynaMed switch, if DM Doc ID exists, if so then 
"RTN","PRCSD121",36,0)
 ;add to display
"RTN","PRCSD121",37,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1,$P($G(^PRCS(410,DA,"IT",P(1),4)),U)]"" D
"RTN","PRCSD121",38,0)
 . S X="DM Doc ID: "_$P(^PRCS(410,DA,"IT",P(1),4),U)_"    Date Needed By: "_$$FMTE^XLFDT($P(^(4),U,2)) D DIWP^PRCUTL($G(DA))
"RTN","PRCSD121",39,0)
 G ITEM2
"RTN","PRCSD121",40,0)
VENDOR ;PRINT VENDOR AND REQ MESSAGES
"RTN","PRCSD121",41,0)
 N Z0
"RTN","PRCSD121",42,0)
 Q:Z1=U  I IOSL-$Y<3 D NEWP Q:Z1=U
"RTN","PRCSD121",43,0)
 I $D(^PRCS(410,DA,4)),$P(^(4),U,1)'="" W !,?13,"TOTAL COST: ","$"_$J($P(^(4),U,1),0,2)
"RTN","PRCSD121",44,0)
 W !,L I IOSL-$Y<2 D NEWP Q:Z1=U
"RTN","PRCSD121",45,0)
 G RM:'$D(^PRCS(410,DA,2))
"RTN","PRCSD121",46,0)
 I $D(^PRCS(410,DA,2)),$P(^(2),U,1)="" G RM
"RTN","PRCSD121",47,0)
 I IOSL-$Y<7 D NEWP Q:Z1=U
"RTN","PRCSD121",48,0)
 S (X,Z0)=$P(^PRCS(410,DA,3),"^",4),X=$S(X:"VENDOR INFORMATION:    NO: "_X,1:"NEW VENDOR INFORMATION: ") W !,X
"RTN","PRCSD121",49,0)
 I Z0,$D(^PRC(440,Z0,3)),$P(^(3),U,2)="Y" W ?38,"EDI"
"RTN","PRCSD121",50,0)
 I Z0,$D(^PRC(440,Z0,10)),$P(^(10),U,6)'="" W ?46,"FAX: "_$P(^(10),U,6)
"RTN","PRCSD121",51,0)
 W !,"VENDOR: ",$P(^PRCS(410,DA,2),U,1) W:$P(^(2),U,9)'="" ?42,"CONTACT: ",$P(^(2),U,9)
"RTN","PRCSD121",52,0)
 W:$P(^PRCS(410,DA,2),U,2)'="" !,?8,$P(^(2),U,2) W:$P(^(2),U,10)'="" ?44,"PHONE: ",$P(^(2),U,10)
"RTN","PRCSD121",53,0)
 S Z(1)=$Y W:$P(^PRCS(410,DA,2),U,3)'="" !,?8,$P(^(2),U,3) S Z1=$P(^(3),U,4) I Z1,$D(^PRC(440,Z1,2)),$P(^(2),U,1)'="" W:Z(1)=$Y ! W ?42,"ACCT. #: ",$P(^(2),U,1)
"RTN","PRCSD121",54,0)
 W:$P(^PRCS(410,DA,2),U,4)'="" !,?8,$P(^(2),U,4) W:$P(^(2),U,5)'="" !,?8,$P(^(2),U,5)
"RTN","PRCSD121",55,0)
 I $P(^PRCS(410,DA,2),U,6)'="" W !,?8,$P(^(2),U,6) W:+$P(^(2),U,7)'=0 ",",$P($G(^DIC(5,$P(^(2),U,7),0)),U,2) W:$P(^PRCS(410,DA,2),U,8)'="" " ",$P(^(2),U,8)
"RTN","PRCSD121",56,0)
 W !,L W !,"Ref. Voucher Number: ",! I $P($G(^PRCS(410,DA,445)),"^")'="" W $P(^(445),"^"),!
"RTN","PRCSD121",57,0)
RM I IOSL-$Y<4 D NEWP Q:Z1=U
"RTN","PRCSD121",58,0)
 I '$D(^PRCS(410,DA,"RM",0)) G DEL
"RTN","PRCSD121",59,0)
 I $D(^PRCS(410,DA,"RM",0)) W ! S P(1)=0,DIWL=1,DIWR=80,DIWF="" K ^UTILITY($J,"W") S X="SPECIAL REMARKS:" D DIWP^PRCUTL($G(DA)) F J=1:1 S P(1)=$O(^PRCS(410,DA,"RM",P(1))) Q:P(1)=""  S X=^(P(1),0) D DIWP^PRCUTL($G(DA))
"RTN","PRCSD121",60,0)
 S Z=^UTILITY($J,"W",DIWL) F K=1:1:Z D:$Y>62 NEWP^PRCSD121 W !,^UTILITY($J,"W",DIWL,K,0)
"RTN","PRCSD121",61,0)
DEL I $D(^PRCS(410,DA,9)),$P(^(9),U,1)'="" W !,?6,"DELIVER TO: ",$P(^(9),U,1)
"RTN","PRCSD121",62,0)
 W !,L Q
"RTN","PRCSD121",63,0)
NEWP ;PRINT HEADER FOR NEW PAGE
"RTN","PRCSD121",64,0)
 S Z1="" W !,"Press return to continue, uparrow (^) to exit: " R Z1:DTIME S:'$T Z1=U W @IOF Q:Z1=U
"RTN","PRCSD121",65,0)
 W !,?31,$P(^PRCS(410,DA,0),U,1) W !,L
"RTN","PRCSD121",66,0)
 W !,?16,"REQUEST, TURN-IN, AND RECEIPT FOR PROPERTY OR SERVICES" W !,L
"RTN","PRCSD121",67,0)
 Q
"RTN","PRCSEA")
0^34^B66774225
"RTN","PRCSEA",1,0)
PRCSEA ;WISC/SAW/DXH/BM/SC/DAP - CONTROL POINT ACTIVITY EDITS ; 3/31/05 2:59pm
"RTN","PRCSEA",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSEA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSEA",4,0)
 ;
"RTN","PRCSEA",5,0)
 ;PRC*5.1*81 BMM 3/23/05 when a 2237 is canceled, in CT1, add code 
"RTN","PRCSEA",6,0)
 ;to update Audit file (#414.02), and send update message to 
"RTN","PRCSEA",7,0)
 ;DynaMed thru a call to rtn PRCVTCA.
"RTN","PRCSEA",8,0)
 ;
"RTN","PRCSEA",9,0)
ENRS ;ENTER REQ
"RTN","PRCSEA",10,0)
 S PRCSK=1,X3="H"
"RTN","PRCSEA",11,0)
 D EN1F^PRCSUT(1) ; ask site,FY,QRTR,CP & set up PRC array, PRCSIP variable ; prc*5*197
"RTN","PRCSEA",12,0)
 G W2:'$D(PRC("SITE")),EXIT:Y<0 ; unauthorized user or '^' entered
"RTN","PRCSEA",13,0)
 D W6 ; display help on transaction# format
"RTN","PRCSEA",14,0)
ENRS0 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="AELQ",D="H"
"RTN","PRCSEA",15,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",16,0)
 S DIC("S")="I '^(0),$P(^(0),U,3)'="""",$D(^PRCS(410,""H"",$P(^(0),U,3),+Y)),^(+Y)=DUZ!(^(+Y)="""")" ; only requests authored by user or unauthored will display on partial match
"RTN","PRCSEA",17,0)
 D ^PRCSDIC ; lookup & preliminary validity checking
"RTN","PRCSEA",18,0)
 K DLAYGO,DIC("A"),DIC("S")
"RTN","PRCSEA",19,0)
 G:Y<0 EXIT
"RTN","PRCSEA",20,0)
 I $P(Y,U,3)'=1 W $C(7),"   Must be a new entry." G ENRS0
"RTN","PRCSEA",21,0)
 ;*81 Check site parameter to see if issue books are allowed
"RTN","PRCSEA",22,0)
 D CKPRM^PRCSEB
"RTN","PRCSEA",23,0)
 W !!,PRCVY,!
"RTN","PRCSEA",24,0)
 S (PDA,T1,DA)=+Y
"RTN","PRCSEA",25,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...try a different transaction number or try later" G ENRS0
"RTN","PRCSEA",26,0)
 S T(2)=$P(Y,U,2)
"RTN","PRCSEA",27,0)
 D EN2A^PRCSUT3 ; saves CP,sta,substa,txn name,user,BBFY,RB stat,acct data in new txn (nodes 0,3,6,11 of file 410)
"RTN","PRCSEA",28,0)
 S $P(^PRCS(410,DA,14),"^")=DUZ ; originator (entered by)
"RTN","PRCSEA",29,0)
 S $P(^PRCS(410,DA,7),"^")=DUZ,$P(^PRCS(410,DA,7),"^",2)=$P($G(^VA(200,DUZ,20)),"^",3) ; requestor default
"RTN","PRCSEA",30,0)
 I $G(PRCSIP) S $P(^PRCS(410,DA,0),"^",6)=PRCSIP,^PRCS(410,"AO",PRCSIP,DA)="" ; PRCSIP was set up in PRCSUT & is inventory distribution point
"RTN","PRCSEA",31,0)
 S PRCS="" ; set PRCS=1 if CP is automated, i.e. it uses IFCAP to send requests to A&MM
"RTN","PRCSEA",32,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS=1
"RTN","PRCSEA",33,0)
TYPE ;
"RTN","PRCSEA",34,0)
 W !!,"This transaction is assigned temporary transaction number: ",T(2)
"RTN","PRCSEA",35,0)
 S DIC("A")="FORM TYPE: ",DIC="^PRCS(410.5,",DIC(0)="AEQZ"
"RTN","PRCSEA",36,0)
 S DIC("S")=PRCVX ; only allow selection of 2237's
"RTN","PRCSEA",37,0)
 D ^DIC
"RTN","PRCSEA",38,0)
 S DA=PDA
"RTN","PRCSEA",39,0)
 ;if user didn't enter a form type, go ask whether to backout and act
"RTN","PRCSEA",40,0)
 ;accordingly: go let them re-enter a form type or exit
"RTN","PRCSEA",41,0)
 I Y<0 G:'$$BACKOUT(T(2),DA) TYPE L -^PRCS(420,DA) G EXIT
"RTN","PRCSEA",42,0)
 ;
"RTN","PRCSEA",43,0)
 I Y<2 W "??" G TYPE
"RTN","PRCSEA",44,0)
 K PRCVX,PRCVY
"RTN","PRCSEA",45,0)
 S $P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y ; form type
"RTN","PRCSEA",46,0)
 ; if CP is not automated (file 420), user's response will be overwritten with non-recuring (type 2). Although user's selection is changed 'behind the scenes', 
"RTN","PRCSEA",47,0)
 ; the scenario is unlikely to occur because full implementation of IFCAP was made mandatory and sites are now automated.
"RTN","PRCSEA",48,0)
 S:'PRCS&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSEA",49,0)
 K PRCSERR ; flag denoting item info is missing
"RTN","PRCSEA",50,0)
 S DIC(0)="AEMQ",(DIC,DIE)="^PRCS(410,"
"RTN","PRCSEA",51,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237S",X=3:"PRCSENPRS",X=4:"PRCSENR&NRS",1:"PRCSENIBS")_"]"
"RTN","PRCSEA",52,0)
EN1 K DTOUT,DUOUT,Y
"RTN","PRCSEA",53,0)
 D ^DIE
"RTN","PRCSEA",54,0)
 S DA=PDA
"RTN","PRCSEA",55,0)
 I $D(Y)!($D(DTOUT)) D DOR L -^PRCS(410,DA) G EXIT
"RTN","PRCSEA",56,0)
 D RL^PRCSUT1 ; sets up 'IT' & '10' nodes
"RTN","PRCSEA",57,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G EN1 ; missing required field ('item')
"RTN","PRCSEA",58,0)
 D DOR ; populate date of request field if it is nil
"RTN","PRCSEA",59,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",60,0)
 S T="enter" D W5 G EXIT:%'=1
"RTN","PRCSEA",61,0)
 W !! K PRCS("SUB")
"RTN","PRCSEA",62,0)
 G ENRS
"RTN","PRCSEA",63,0)
 ;
"RTN","PRCSEA",64,0)
EDRS ;EDIT REQ
"RTN","PRCSEA",65,0)
 ; following line commented out by PRC*5*140 - user responses not used to limit selection of txn and sometimes resulted in bad info being set into the selected txn
"RTN","PRCSEA",66,0)
 ; S PRCSK=1 D EN1F^PRCSUT(1) G W2:'$D(PRC("SITE")),EXIT:Y<0 ; ask sta,FY,QRTR,CP ; prc*5*197
"RTN","PRCSEA",67,0)
 ; if the above line is reactivated, programmer should note that the transaction selected may not be of the same FY,QRTR,sta, subst, and CP specified by the user
"RTN","PRCSEA",68,0)
 D W6 ; format doc for txn#
"RTN","PRCSEA",69,0)
 S X3="H" S DIC="^PRCS(410,",DIC(0)="AEQ",D="H"
"RTN","PRCSEA",70,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",71,0)
 S DIC("S")="I '^(0),$P(^(0),U,3)'="""",$P(^(0),U,4)'=1,^PRCS(410,""H"",$P(^(0),U,3),+Y)=DUZ!(^(+Y)="""")" ; request must be authored by user or unauthored & cannot be a 1358
"RTN","PRCSEA",72,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("A"),DIC("S")
"RTN","PRCSEA",73,0)
 S (PDA,DA,T1)=+Y
"RTN","PRCSEA",74,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...please try later" G EDRS
"RTN","PRCSEA",75,0)
 ; following line commented out in PRC*5*140 - PRCSUT3 needs PRC("SST") or MYY to do something, neither exists in this option
"RTN","PRCSEA",76,0)
 ; D EN2B^PRCSUT3
"RTN","PRCSEA",77,0)
 S PRC("SITE")=+$P(^PRCS(410,PDA,0),"^",5)
"RTN","PRCSEA",78,0)
 S PRC("CP")=$P(^PRCS(410,PDA,3),"^")
"RTN","PRCSEA",79,0)
 I $P(^PRCS(410,PDA,0),"^",6)="" D  ; prc*5*197
"RTN","PRCSEA",80,0)
 . N PRCSIP D IP^PRCSUT
"RTN","PRCSEA",81,0)
 . I $D(PRCSIP) S $P(^PRC(410,DA,0),U,6)=PRCSIP
"RTN","PRCSEA",82,0)
 S X=+$P(^PRCS(410,DA,0),"^",4) I X<1 D FORM
"RTN","PRCSEA",83,0)
 ;*81 Check site parameter to see if Issue Books are allowed
"RTN","PRCSEA",84,0)
 D CKPRM
"RTN","PRCSEA",85,0)
 I PRCVD=1 S PRCVZ=1
"RTN","PRCSEA",86,0)
 I PRCVD'=1 S PRCVZ=0
"RTN","PRCSEA",87,0)
 W !,"The form type for this transaction is ",$P($G(^PRCS(410.5,X,0)),"^"),!
"RTN","PRCSEA",88,0)
 I PRCVZ=1,X=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP issue book order." S T="edit" D W5 G:%'=1 EXIT W !! K PRCS("SUB") G EDRS
"RTN","PRCSEA",89,0)
 ;
"RTN","PRCSEA",90,0)
 S DIC(0)="AEMQ",(DIC,DIE)="^PRCS(410,"
"RTN","PRCSEA",91,0)
 ;P182--Modified next 3 lines to use new templates if supply fund FCP
"RTN","PRCSEA",92,0)
 S (DR,PRCSDR)="["_$S(X=1:"PRCE NEW 1358S",X=2:"PRCSEN2237S",X=3:"PRCSENPRS",X=4:"PRCSENR&NRS",1:"PRCSENIBS")_"]"
"RTN","PRCSEA",93,0)
ED1 K DTOUT,DUOUT,Y
"RTN","PRCSEA",94,0)
 D ^DIE
"RTN","PRCSEA",95,0)
 S DA=PDA
"RTN","PRCSEA",96,0)
 I $D(Y)!($D(DTOUT)) L -^PRCS(410,DA) G EXIT
"RTN","PRCSEA",97,0)
 D RL^PRCSUT1
"RTN","PRCSEA",98,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G ED1
"RTN","PRCSEA",99,0)
 K PRCSERR S $P(^PRCS(410,DA,14),"^")=DUZ
"RTN","PRCSEA",100,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",101,0)
 S T="edit" D W5 G EXIT:%'=1
"RTN","PRCSEA",102,0)
 W !! K PRCS("SUB")
"RTN","PRCSEA",103,0)
 G EDRS
"RTN","PRCSEA",104,0)
 ;
"RTN","PRCSEA",105,0)
CT ;CANCEL A (PERMANENT) TRANS
"RTN","PRCSEA",106,0)
 D EN3^PRCSUT
"RTN","PRCSEA",107,0)
 G W2:'$D(PRC("SITE")),EXIT:Y<0
"RTN","PRCSEA",108,0)
 S DIC="^PRCS(410,",DIC(0)="AEMQ"
"RTN","PRCSEA",109,0)
 ;S DIC("S")="I $P(^(0),""^"",4)=.5!($S('$D(^(7)):1,1:$P(^(7),""^"",6)="""")) I +^(0)>0,$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEA",110,0)
 S DIC("S")="I $P(^(0),U,2)=""O""!($P(^(0),U,2)=""A""&($P(^(0),U,4)=1)),$S('$D(^(7)):1,1:$P(^(7),""^"",6)=""""),$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),U,5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEA",111,0)
 S DIC("A")="Select TRANSACTION: "
"RTN","PRCSEA",112,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("S"),DIC("A")
"RTN","PRCSEA",113,0)
CT1 W !,"Cancel this transaction" S %=2 D YN^DICN G CT1:%=0,EXIT:%'=1
"RTN","PRCSEA",114,0)
 S DA=+Y
"RTN","PRCSEA",115,0)
 L +^PRCS(410,DA):1 I $T=0 W !,"File is being accessed...please try later" G CT
"RTN","PRCSEA",116,0)
 S T=$P(^PRCS(410,DA,0),"^"),$P(^(11),"^",3)="",$P(^(0),"^",2)="CA",$P(^(5),"^")=0,$P(^(6),"^")=0
"RTN","PRCSEA",117,0)
 K ^PRCS(410,"F",+T_"-"_+PRC("CP")_"-"_$P(T,"-",5),DA),^PRCS(410,"F1",$P(T,"-",5)_"-"_+T_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA)
"RTN","PRCSEA",118,0)
 K ZX
"RTN","PRCSEA",119,0)
 I $D(^PRCS(410,DA,4)) S ZX=^(4),X=$P(ZX,"^",8) F I=1,3,6,8 S $P(ZX,"^",I)=0
"RTN","PRCSEA",120,0)
 I $D(ZX) S ^PRCS(410,DA,4)=ZX K ZX
"RTN","PRCSEA",121,0)
 I $D(^PRCS(410,DA,12,0)) S N=0 F I=0:0 S N=$O(^PRCS(410,DA,12,N)) Q:N'>0  S X=$P(^(N,0),"^",2) I X S DA(1)=DA,DA=N D TRANK^PRCSEZZ S DA=DA(1)
"RTN","PRCSEA",122,0)
 D ERS410^PRC0G(DA_"^C")
"RTN","PRCSEA",123,0)
 W !,"Enter comments for this cancellation",!
"RTN","PRCSEA",124,0)
 S DIE=DIC,DR=60
"RTN","PRCSEA",125,0)
 D ^DIE
"RTN","PRCSEA",126,0)
 ;PRC*5.1*81 if DM trx, update Audit file and send msg to DM
"RTN","PRCSEA",127,0)
 D EN^PRCVTCA(DA)
"RTN","PRCSEA",128,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",129,0)
 I $D(^PRC(443,DA,0)) S DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCSEA",130,0)
 S T="cancel" D W4 G EXIT:%'=1
"RTN","PRCSEA",131,0)
 W !! G CT
"RTN","PRCSEA",132,0)
 ;
"RTN","PRCSEA",133,0)
DT ;DELETE A (TEMPORARY) TRANS
"RTN","PRCSEA",134,0)
 S X3="H"
"RTN","PRCSEA",135,0)
 D W6 ; format doc for txn#
"RTN","PRCSEA",136,0)
 S DIC="^PRCS(410,",DIC(0)="AEQ",DIC("A")="Select TRANSACTION: ",D="H"
"RTN","PRCSEA",137,0)
 S DIC("S")="S W=$P(^(0),""^"",5),W(1)=+^(3) I '^(0),$P(^(0),""^"",3)'="""",^PRCS(410,""H"",$P(^(0),""^"",3),+Y)=DUZ!(^(+Y)="""")!($D(^PRC(420,""A"",DUZ,W,W(1),1)))!($D(^(2)))"
"RTN","PRCSEA",138,0)
 D ^PRCSDIC G EXIT:Y<0
"RTN","PRCSEA",139,0)
 K DIC("S"),DIC("A")
"RTN","PRCSEA",140,0)
 S DA=+Y
"RTN","PRCSEA",141,0)
 L +^PRCS(410,DA):5 I $T=0 W !,"File is being accessed...please try later" G DT
"RTN","PRCSEA",142,0)
DT1 W !,"Delete this transaction" S %=2 D YN^DICN G DT1:%=0,EXIT:%'=1
"RTN","PRCSEA",143,0)
 ;The following line was commented out in patch 182; should NOT manually
"RTN","PRCSEA",144,0)
 ;change or reset last assigned IEN # in node zero.
"RTN","PRCSEA",145,0)
 ;S PRCSDA=$P(^PRCS(410,0),U,3),DIK=DIC
"RTN","PRCSEA",146,0)
 S DIK=DIC
"RTN","PRCSEA",147,0)
 W !,"Okay....."
"RTN","PRCSEA",148,0)
 D ^DIK K DIK
"RTN","PRCSEA",149,0)
 L -^PRCS(410,DA)
"RTN","PRCSEA",150,0)
 ;The following line was commented out in patch 182; should NOT manually
"RTN","PRCSEA",151,0)
 ;change or reset last assigned IEN # in node zero.
"RTN","PRCSEA",152,0)
 ;S $P(^PRCS(410,0),U,3)=PRCSDA
"RTN","PRCSEA",153,0)
 K PRCSDA
"RTN","PRCSEA",154,0)
 W "It's deleted"
"RTN","PRCSEA",155,0)
 S T="delete" D W4 G EXIT:%'=1
"RTN","PRCSEA",156,0)
 W !! G DT
"RTN","PRCSEA",157,0)
 ;
"RTN","PRCSEA",158,0)
 ;
"RTN","PRCSEA",159,0)
DOR ; Date of Request
"RTN","PRCSEA",160,0)
 I $D(^PRCS(410,DA,1)),$P(^PRCS(410,DA,1),"^")'="" Q
"RTN","PRCSEA",161,0)
 S %DT="X",X="T" D ^%DT S $P(^PRCS(410,DA,1),"^")=Y
"RTN","PRCSEA",162,0)
 Q
"RTN","PRCSEA",163,0)
FORM ;*81 Allow user to change txn to a valid form and check site parameter to see if issue books are allowed
"RTN","PRCSEA",164,0)
 D CKPRM
"RTN","PRCSEA",165,0)
 I PRCVD=1 S PRCVX1="I Y>1&(Y<5)",PRCVY1="The Issue Book and NO FORM type are not valid in this option."
"RTN","PRCSEA",166,0)
 I PRCVD'=1 S PRCVX1="I Y>1",PRCVY1="The NO FORM type is not valid in this option."
"RTN","PRCSEA",167,0)
 W !,PRCVY1,!
"RTN","PRCSEA",168,0)
 W !,"Please enter another form type",!
"RTN","PRCSEA",169,0)
 S PRCSDAA=DA,DIC="^PRCS(410.5,",DIC("A")="FORM TYPE: ",DIC(0)="AEQZ"
"RTN","PRCSEA",170,0)
 S DIC("S")=PRCVX1
"RTN","PRCSEA",171,0)
 D ^DIC
"RTN","PRCSEA",172,0)
 S:Y=-1 Y=2
"RTN","PRCSEA",173,0)
 S DA=PRCSDAA,$P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y
"RTN","PRCSEA",174,0)
 K DIC,PRCVX1,PRCVY1,PRCVD
"RTN","PRCSEA",175,0)
 Q
"RTN","PRCSEA",176,0)
 ;
"RTN","PRCSEA",177,0)
 ;Allow user the option of re entering a form type.  If they decline,
"RTN","PRCSEA",178,0)
 ;kill off the transaction and return 1; else return 0
"RTN","PRCSEA",179,0)
BACKOUT(TRNNAME,TRNDA) ;
"RTN","PRCSEA",180,0)
 N DIK,Y,%,DA
"RTN","PRCSEA",181,0)
 W !!,"WARNING: WITHOUT A FORM TYPE, TRANSACTION """,TRNNAME,""" WILL BE DELETED!",$C(7)
"RTN","PRCSEA",182,0)
 W !,"Are you sure you want to delete this transaction" S %=2 D YN^DICN
"RTN","PRCSEA",183,0)
 I %=0 G BACKOUT
"RTN","PRCSEA",184,0)
 I %=2 Q 0
"RTN","PRCSEA",185,0)
 S DIK="^PRCS(410,",DA=TRNDA
"RTN","PRCSEA",186,0)
 D ^DIK
"RTN","PRCSEA",187,0)
 Q 1
"RTN","PRCSEA",188,0)
 ;
"RTN","PRCSEA",189,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact control point official" R X:5 G EXIT
"RTN","PRCSEA",190,0)
W3 Q  ; can this subroutine be deleted? commented out in patch PRC*5*140
"RTN","PRCSEA",191,0)
 W !!,"This transaction is assigned temporary transaction number: ",X Q
"RTN","PRCSEA",192,0)
W4 W !!,"Would you like to ",T," another transaction" S %=2 D YN^DICN G W4:%=0 Q
"RTN","PRCSEA",193,0)
W5 W !!,"Would you like to ",T," another request" S %=1 D YN^DICN G W5:%=0 Q
"RTN","PRCSEA",194,0)
W6 W !!,"For the transaction number, use an uppercase alpha as the first character,",!," and then 2-15 alphanumerics, as in 'ADP1'.",! Q
"RTN","PRCSEA",195,0)
 ;*81 Site parameter pull 
"RTN","PRCSEA",196,0)
CKPRM S PRCVD=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCSEA",197,0)
 Q
"RTN","PRCSEA",198,0)
 ;
"RTN","PRCSEA",199,0)
EXIT K %,C,D,DA,DIC,DIE,DR,PRCS,PDA,PRCSL,T,X,Y,Z,T1,X3,TYPE,PRCVZ
"RTN","PRCSEA",200,0)
 I $D(PRCSERR) K PRCSERR
"RTN","PRCSEA",201,0)
 Q
"RTN","PRCSEB")
0^35^B17751549
"RTN","PRCSEB",1,0)
PRCSEB ;SF-ISC/LJP/SAW/DXH/DAP - CPA EDITS CON'T ;7.26.99
"RTN","PRCSEB",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSEB",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSEB",4,0)
ENRB ;ENTER CP CLERK REQUEST FROM OPTION PRCSENRB
"RTN","PRCSEB",5,0)
 D ENF^PRCSUT(1) G W2:'$D(PRC("SITE")) G EXIT:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCSEB",6,0)
 D EN1^PRCSUT3 Q:'X  S PRCSX1=X D EN2^PRCSUT3 Q:'$D(PRCSX1)  S X=PRCSX1,T1=DA  D W L +^PRCS(410,DA):15 G ENRB:$T=0 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),"^",11)="Y" PRCS2=1
"RTN","PRCSEB",7,0)
 ;
"RTN","PRCSEB",8,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCSEB",9,0)
 D CKPRM
"RTN","PRCSEB",10,0)
 W !!,PRCVY,!!
"RTN","PRCSEB",11,0)
TYPE ;
"RTN","PRCSEB",12,0)
 S PRCDAA=DA,DIC="^PRCS(410.5,",DIC(0)="AEQZ",DIC("A")="FORM TYPE: ",DIC("S")=PRCVX D ^DIC S TYPE=+Y,DA=PRCDAA
"RTN","PRCSEB",13,0)
 I TYPE<2 W "??    EXIT NOT ALLOWED" G TYPE
"RTN","PRCSEB",14,0)
 K PRCVX,PRCVY
"RTN","PRCSEB",15,0)
 S $P(^PRCS(410,DA,0),"^",4)=TYPE S:$G(PRCSIP) $P(^PRCS(410,DA,0),"^",6)=PRCSIP S (DIE,DIC)="^PRCS(410,",X=TYPE
"RTN","PRCSEB",16,0)
 ;NOTE THAT THE FOLLOWING LINE OVERWRITES THE USER'S SELECTION OF FORM
"RTN","PRCSEB",17,0)
 ;TYPE IF THE FUND CONTROL POINT IS NOT 'AUTOMATED'
"RTN","PRCSEB",18,0)
 S:'$D(PRCS2)&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSEB",19,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",1:"PRCSENIB")_"]"
"RTN","PRCSEB",20,0)
EN1 K DTOUT,DUOUT,Y S PRCSDAA=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=PRCSDAA L -^PRCS(410,DA) G EXIT
"RTN","PRCSEB",21,0)
 S DA=PRCSDAA D RL^PRCSUT1
"RTN","PRCSEB",22,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G EN1
"RTN","PRCSEB",23,0)
 K PRCSERR
"RTN","PRCSEB",24,0)
 I PRCSDR="[PRCSENCOD]" D W7^PRCSEB0 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSEB",25,0)
 S:$P($G(^PRCS(410,DA,7)),"^")="" $P(^PRCS(410,DA,7),"^")=DUZ
"RTN","PRCSEB",26,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I $D(PRCS2),+^PRCS(410,DA,0) D W6
"RTN","PRCSEB",27,0)
 S DA=PRCSDAA L -^PRCS(410,DA) D W3 G EXIT:%'=1 W !! K PRCS,PRCS2
"RTN","PRCSEB",28,0)
 G ENRB
"RTN","PRCSEB",29,0)
W W !!,"This transaction is assigned transaction number: ",X Q
"RTN","PRCSEB",30,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSEB",31,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSEB",32,0)
W3 W !!,"Would you like to enter another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEB",33,0)
W5 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)="" K ^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA),^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA) Q
"RTN","PRCSEB",34,0)
W51 S:'$D(^PRCS(410,DA,11)) ^(11)="" S $P(^(11),U,3)=1,(^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA),^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA),^PRCS(410,"AQ",1,DA))="" Q
"RTN","PRCSEB",35,0)
W6 N JUMP,SKIPRNT,OK,TEST,TEST1,CURQTR,CURQTR1
"RTN","PRCSEB",36,0)
W61 ;
"RTN","PRCSEB",37,0)
 N REPORT2 I $P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),1,DUZ,0)),"^",2)'=1 S REPORT2=1 D T1^PRCSAPP1
"RTN","PRCSEB",38,0)
 I $P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),1,DUZ,0)),"^",2)'=1 S %=1 W !,"Is this request ready for approval" D YN^DICN D:%=1 W51 D:%=0 W61 D:%=2 W5 Q
"RTN","PRCSEB",39,0)
 S PRCSN=^PRCS(410,DA,0),PRCHQ=$P(PRCSN,"^",4),PRC("FY")=$P(PRCSN,"-",2),PRC("QTR")=$P(PRCSN,"-",3)
"RTN","PRCSEB",40,0)
 S (CURQTR,CURQTR1)=PRC("QTR"),(JUMP,TEST,TEST1,OK)=0
"RTN","PRCSEB",41,0)
 D T1^PRCSAPP1 I OK=1 S SKIPRNT=1 D FINAL^PRCSAPP2
"RTN","PRCSEB",42,0)
 Q
"RTN","PRCSEB",43,0)
 ;*81 Site Parameter Check
"RTN","PRCSEB",44,0)
CKPRM I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>1&(Y<5)",PRCVY="The form types 1358, Issue Book, and NO FORM are no longer used within this option."
"RTN","PRCSEB",45,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>1",PRCVY="The form types 1358 and NO FORM are no longer used within this option"
"RTN","PRCSEB",46,0)
 Q
"RTN","PRCSEB",47,0)
 ;
"RTN","PRCSEB",48,0)
EXIT K %,C,D,DA,DIC,DIE,DQ,DR,PRCS,PRCS2,PRCSDAA,PRCSDR,PRCSERR,PRCSL,PRCSTT,I,N,T,T1,T2,X,X1,PRCSX3,Y,Z Q
"RTN","PRCSEB0")
0^36^B22631602
"RTN","PRCSEB0",1,0)
PRCSEB0 ;SF-ISC/LJP/SAW/DGL/DAP-CPA EDITS CON'T ; 7/29/99 1:01pm
"RTN","PRCSEB0",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSEB0",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSEB0",4,0)
EDTD ;EDIT TRANSACTION DATA
"RTN","PRCSEB0",5,0)
 N TYPE,TYPE1,CHECK,JUMP S JUMP=1
"RTN","PRCSEB0",6,0)
 D EN3F^PRCSUT(1) G W2:'$D(PRC("SITE")),EXIT:Y<0
"RTN","PRCSEB0",7,0)
 S DIC="^PRCS(410,",DIE=DIC,DIC(0)="AEQM" S DIC("S")="I $P(^(0),U,4)'=1" S:$D(PRCSFT) DIC("S")="I $P(^(0),U,4)=1"
"RTN","PRCSEB0",8,0)
 S DIC("S")=DIC("S")_",$D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSEB0",9,0)
 D ^PRCSDIC G EXIT:Y<0 K DIC("S") S (DA,PRCSDAA,PRCSY,T1)=+Y L +^PRCS(410,DA):15 G EDTD:$T=0
"RTN","PRCSEB0",10,0)
 S TYPE=$P(^PRCS(410,DA,0),"^",4)
"RTN","PRCSEB0",11,0)
EDTD1 S X=^PRCS(410,DA,0) S:+X PRC("FY")=$P(X,"-",2),PRC("QTR")=+$P(X,"-",3) S PRCSX3=$P(X,"^",2) G ASK:PRCSX3="" I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),"^",11)="Y" S PRCS2=1
"RTN","PRCSEB0",12,0)
EDTD3 I $D(^PRCS(410,DA,7)),$P(^(7),U,6)]"" G EDTD4
"RTN","PRCSEB0",13,0)
 I $D(PRCSEM) S DIE=DIC,DR="[PRCSENMDR]" D ^DIE S DA=T1 L -^PRCS(410,DA) G EXIT
"RTN","PRCSEB0",14,0)
 I PRCSX3'="O" S DR=$S(PRCSX3="C"&('$D(PRCS2)):"[PRCSENC]",PRCSX3="C"&($D(PRCS2)):"[PRCSENCI]",PRCSX3="A":"[PRCSENA]",1:"[PRCSENCT]") S:PRCSX3="A"&($P(^PRCS(410,PRCSY,0),U,4)=1) DR="[PRCSENA 1358]" S DIE=DIC D ^DIE S DA=PRCSY
"RTN","PRCSEB0",15,0)
 D:PRCSX3="A"&($O(^PRCS(410,PRCSY,12,0))) SCPC0^PRCSED
"RTN","PRCSEB0",16,0)
 I PRCSX3="A",$P(^PRCS(410,DA,0),U,4)=1 S X=$P(^(4),U,6),X1=$P(^(3),U,7) I $J(X,0,2)'=$J(X1,0,2)!('X)!('X1) W $C(7),!,"Adj $ Amt does not equal the total of BOC $ Amts.",!,"Please correct the error.",! K DR G EDTD3
"RTN","PRCSEB0",17,0)
 I PRCSX3="A",$P(^PRCS(410,DA,0),"^",4)=1 D W6^PRCSEB
"RTN","PRCSEB0",18,0)
 I PRCSX3'="O" G EDTD2
"RTN","PRCSEB0",19,0)
EDTD4 I $D(^PRCS(410,DA,7)),$P(^(7),"^",6)'="" S DR="[PRCSEDS]" D ^DIE D W1 G EDTD2
"RTN","PRCSEB0",20,0)
EDTD5 ;*81 Loop now checks site parameter to see if Issue Books should be allowed
"RTN","PRCSEB0",21,0)
 S X=+$P(^PRCS(410,DA,0),"^",4) I X<2 D
"RTN","PRCSEB0",22,0)
 .I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>1&(Y<5)",PRCVY="The 1358, Issue Book, and NO FORM types are not valid for use in this option."
"RTN","PRCSEB0",23,0)
 .I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>1",PRCVY="The 1358 and NO FORM types are not valid for use in this option."
"RTN","PRCSEB0",24,0)
 .W !,PRCVY,!
"RTN","PRCSEB0",25,0)
 .W !,"Please enter another form type.",!
"RTN","PRCSEB0",26,0)
 .S PRCDAA=DA,DIC="^PRCS(410.5,",DIC("A")="FORM TYPE: ",DIC(0)="AEQZ",DIC("S")=PRCVX,DIC("B")=4 D ^DIC S:Y=-1 Y=4 S DA=PRCDAA K DIC
"RTN","PRCSEB0",27,0)
 .K PRCVX,PRCVY
"RTN","PRCSEB0",28,0)
 .S $P(^PRCS(410,DA,0),"^",4)=+Y,X=+Y
"RTN","PRCSEB0",29,0)
 I $G(PRCSIP) S $P(^PRCS(410,DA,0),"^",6)=PRCSIP
"RTN","PRCSEB0",30,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVZ=1
"RTN","PRCSEB0",31,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVZ=0
"RTN","PRCSEB0",32,0)
 W !,"The form type for this transaction is ",$P($G(^PRCS(410.5,X,0)),"^"),!
"RTN","PRCSEB0",33,0)
 I PRCVZ=1,X=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP Issue Book order." D W3 G:%'=1 EXIT W !! K PRCS,PRCS2 G EDTD
"RTN","PRCSEB0",34,0)
 ;P182--Removed reference to TEMPREQ in following line: no longer used.
"RTN","PRCSEB0",35,0)
 ;Q:$D(TEMPREQ)  S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSEB0",36,0)
 K PRCVZ
"RTN","PRCSEB0",37,0)
 S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSEB0",38,0)
 G EDTD2:X=""
"RTN","PRCSEB0",39,0)
 S (PRCSDR,DR)="["_$S(X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",1:"PRCSENIB")_"]"
"RTN","PRCSEB0",40,0)
ED1 K DTOUT,DUOUT,Y S PRCSDAA=DA D ^DIE I $D(DTOUT) S DA=PRCSDAA G EXIT
"RTN","PRCSEB0",41,0)
 S DA=PRCSDAA D RL^PRCSUT1
"RTN","PRCSEB0",42,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G ED1
"RTN","PRCSEB0",43,0)
 K PRCSERR
"RTN","PRCSEB0",44,0)
 I PRCSDR="[PRCSENCOD]" D W7 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSEB0",45,0)
 S:$P($G(^PRCS(410,DA,7)),U)="" $P(^PRCS(410,DA,7),U)=DUZ,$P(^PRCS(410,DA,7),U,2)=$P($G(^VA(200,DUZ,20)),U,3)
"RTN","PRCSEB0",46,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I $D(PRCS2),+^PRCS(410,DA,0) D W6^PRCSEB
"RTN","PRCSEB0",47,0)
EDTD2 S DA=PRCSDAA L -^PRCS(410,DA) G EXIT:$D(PRCSQ) D W3 G EXIT:%'=1 W !! K PRCS,PRCS2 G EDTD
"RTN","PRCSEB0",48,0)
ASK W !!,"This transaction does not have a valid transaction type (e.g.,O for Obligation, A for Adjustment, C for Ceiling).  Please enter one now.",! S DR="1" D ^DIE K DR G EDTD1
"RTN","PRCSEB0",49,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSEB0",50,0)
W2 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSEB0",51,0)
W3 W !!,"Would you like to edit another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSEB0",52,0)
W7 W !,"Do you wish to enter obligation data" S %=1 D YN^DICN Q:%=-1!(%=2)  G W7:%=0 S:%=1 PRCSOB=1 Q
"RTN","PRCSEB0",53,0)
EXIT K %,C,D,DA,DIC,DIE,DQ,DR,PRCS,PRCS2,PRCSDAA,PRCSDR,PRCSL,PRCSTT,I,N,T,T1,T2,X,X1,PRCSX3,Y,Z,Z7,PRCVZ Q
"RTN","PRCSECP")
0^37^B28160184
"RTN","PRCSECP",1,0)
PRCSECP ;SF-ISC/KSS,LJP/DAP-COPY A TRANSACTION ;10-30-91/10:50
"RTN","PRCSECP",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSECP",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSECP",4,0)
A I '$D(DT) S %DT="",X="T" D ^%DT S DT=Y
"RTN","PRCSECP",5,0)
 W @IOF,!!
"RTN","PRCSECP",6,0)
B D EN3^PRCSUT ;GO GET STATION AND CONTROL POINT
"RTN","PRCSECP",7,0)
 I '$D(PRC("SITE"))!('$D(PRC("CP")))!(Y<0)!('$D(X))!($G(X)[U) D END Q
"RTN","PRCSECP",8,0)
 N GET,GET1 S DIC="^PRCS(410,",DIC(0)="AEQM"
"RTN","PRCSECP",9,0)
 S DIC("S")="S PRCST=$P(^(0),U,2) I $D(^(3)),+^(3)=+PRC(""CP""),$P(^(0),""^"",5)=PRC(""SITE"") I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2))) I PRCST=""O""!(PRCST=""CA"")"
"RTN","PRCSECP",10,0)
 S DIC("A")="Select the Transaction to be copied: "
"RTN","PRCSECP",11,0)
C W ! D ^PRCSDIC K PRCST
"RTN","PRCSECP",12,0)
 I (X[U)!(Y<0) D END Q
"RTN","PRCSECP",13,0)
 S DA=+Y D W1
"RTN","PRCSECP",14,0)
 S PRCVFT=$P(^PRCS(410,DA,0),"^",4)
"RTN","PRCSECP",15,0)
 ;*81 Check site parameter to see if Issue Books are allowed
"RTN","PRCSECP",16,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVZ=1
"RTN","PRCSECP",17,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVZ=0
"RTN","PRCSECP",18,0)
 I PRCVZ=1,PRCVFT=5 W !,"All Supply Warehouse requests must be processed in the new Inventory System.",!!,"Please cancel this IFCAP issue book order." D W3 G:%'=1 END W !! K PRCS,PRCS2 G B
"RTN","PRCSECP",19,0)
 W !!,"Would you like to proceed " S %=1 D YN^DICN G C:%'=1
"RTN","PRCSECP",20,0)
 S DIC="^PRCS(410," L +^PRCS(410,DA):15 G END:$T=0
"RTN","PRCSECP",21,0)
 S T1=DA,T2=^PRCS(410,DA,0),T5=$P(T2,U,4),T4=$P(T2,U,2),T2=$P(T2,U),T3=$P(^(3),U)
"RTN","PRCSECP",22,0)
 K ^TMP($J)
"RTN","PRCSECP",23,0)
 S ^TMP($J,"OLDDA")=DA,^("OLDTXN")=$P(T2,U,1),^("OLDFCP")=PRC("CP")
"RTN","PRCSECP",24,0)
 W !!,"Now enter the information for the new transaction number.",!
"RTN","PRCSECP",25,0)
 ;L -^PRCS(410,DA)
"RTN","PRCSECP",26,0)
 K DA,DIC,Y D EN1^PRCSUT K DA,DIC
"RTN","PRCSECP",27,0)
 I ('$D(PRC("SITE")))!('$D(PRC("QTR")))!('$D(PRC("CP"))) G UNLKEND
"RTN","PRCSECP",28,0)
 S X1=X,PRCSAPP=$P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,3)
"RTN","PRCSECP",29,0)
 I PRC("CP")'=T3,PRCSAPP["_" D PRCFY^PRCSUT2 I (PRCSAPP["_") G UNLKEND
"RTN","PRCSECP",30,0)
 S X=X1 D EN1^PRCSUT3 I 'X G UNLKEND
"RTN","PRCSECP",31,0)
 S X1=X D EN2^PRCSUT3 I ('$D(X1)) G UNLKEND
"RTN","PRCSECP",32,0)
 S (X,^TMP($J,"NEWTXN"))=X1
"RTN","PRCSECP",33,0)
 W !!,"This transaction is assigned transaction number: ",X
"RTN","PRCSECP",34,0)
 ;L +^PRCS(410,DA):15 G B:$T=0
"RTN","PRCSECP",35,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) S:$P(^(0),U,11)="Y" PRCS2=1
"RTN","PRCSECP",36,0)
TYPE ;
"RTN","PRCSECP",37,0)
 S PRCSX=$P(^PRCS(410,T1,0),"^",4)
"RTN","PRCSECP",38,0)
 ;*81 Check site parameter to see if issue books should be allowed
"RTN","PRCSECP",39,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 S PRCVX="I Y>(.5)&(Y<5)",PRCVY="The Issue Book and NO FORM types are no longer used."
"RTN","PRCSECP",40,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 S PRCVX="I Y>(.5)",PRCVY="The NO FORM type is no longer used."
"RTN","PRCSECP",41,0)
 I PRCSX<1 W !,PRCVY,!,"Please enter another form type.",! S PRCDAA=DA,DIC="^PRCS(410.5,",DIC("S")=PRCVX,DIC("A")="FORM TYPE: ",DIC(0)="AEQZ" D ^DIC S:Y=-1 Y=2 S DA=PRCDAA,PRCSX=+Y
"RTN","PRCSECP",42,0)
 S (DIE,DIC)="^PRCS(410,"
"RTN","PRCSECP",43,0)
 K PRCVX,PRCVY
"RTN","PRCSECP",44,0)
 S $P(^PRCS(410,DA,0),"^",4)=PRCSX
"RTN","PRCSECP",45,0)
 W !,"The form type for this request is: ",$P($G(^PRCS(410.5,PRCSX,0)),"^"),!
"RTN","PRCSECP",46,0)
 W !,?10,"Transaction data is being copied...",!
"RTN","PRCSECP",47,0)
 D @$S(PRCSX=1:"S1^PRCSECP1",1:"S2^PRCSECP1") S DIK="^PRCS(410," D IX^DIK
"RTN","PRCSECP",48,0)
 S (DIC,DIE)="^PRCS(410,"
"RTN","PRCSECP",49,0)
 ;P182--removed warning about changed CC/BOC;replaced w/following call
"RTN","PRCSECP",50,0)
 S X=$$CHGCCBOC^PRCSCK(^TMP($J,"OLDTXN"),^TMP($J,"NEWTXN"),^TMP($J,"OLDFCP"),0)
"RTN","PRCSECP",51,0)
 S X=PRCSX S:'$D(PRCS2)&(X>2) $P(^PRCS(410,DA,0),"^",4)=2,X=2
"RTN","PRCSECP",52,0)
 S (PRCSDR,DR)="["_$S(X=1:"PRCE NEW 1358",X=2:"PRCSEN2237B",X=3:"PRCSENPR",X=4:"PRCSENR&NR",X=5:"PRCSENIB",1:"PRCSENCOD")_"]"
"RTN","PRCSECP",53,0)
D K DTOUT,DUOUT,Y S COPYDA=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=COPYDA G END
"RTN","PRCSECP",54,0)
 S DA=COPYDA D RL^PRCSUT1
"RTN","PRCSECP",55,0)
 D ^PRCSCK I $D(PRCSERR),PRCSERR G D
"RTN","PRCSECP",56,0)
 K PRCSERR
"RTN","PRCSECP",57,0)
 I PRCSDR="[PRCSENCOD]" D W7^PRCSEB0 D:$D(PRCSOB) ENOD1^PRCSEB1 K PRCSOB
"RTN","PRCSECP",58,0)
 D:PRCSDR'="[PRCSENCOD]" W1 I PRCSDR'="[PRCSENCOD]",$D(PRCS2),+^PRCS(410,DA,0) D W6^PRCSEB
"RTN","PRCSECP",59,0)
 S DA=COPYDA L -^PRCS(410,DA) D W3 G END:%'=1 W !! K PRCS,PRCS2
"RTN","PRCSECP",60,0)
 G B
"RTN","PRCSECP",61,0)
 ;
"RTN","PRCSECP",62,0)
UNLKEND S DA=^TMP($J,"OLDDA") L -^PRCS(410,DA)
"RTN","PRCSECP",63,0)
END K %,D0,DA,DIC,DIE,DIK,DR,N,P,PRCSAPP,COPYDA,PRCSDR,PRCSERR,PRCSI,PRCSIP,PRCSJ,PRCSJ,PRCSL,PRCST1,PRCSTMP,PRCSTT,PRCSX,PRCSZ,T1,T2,T3,T4,T5,X,X1,Y,PRCVZ,PRCVFT
"RTN","PRCSECP",64,0)
 K ^TMP($J)
"RTN","PRCSECP",65,0)
 Q
"RTN","PRCSECP",66,0)
W1 W !!,"Would you like to review this request" S %=2 D YN^DICN G W1:%=0 Q:%'=1  S (N,PRCSZ)=DA,PRCSF=1 D PRF1^PRCSP1 S DA=PRCSZ K X,PRCSF,PRCSZ Q
"RTN","PRCSECP",67,0)
W3 W !!,"Would you like to copy another request" S %=1 D YN^DICN G W3:%=0 Q
"RTN","PRCSECP",68,0)
 ;
"RTN","PRCSECP",69,0)
GETCCCNT(STA,FCP) ;How many valid Cost Centers for this Control Point
"RTN","PRCSECP",70,0)
 ;return count and first CC
"RTN","PRCSECP",71,0)
 N GOODCC,CC,FIRSTCC
"RTN","PRCSECP",72,0)
 S GOODCC=0,(CC,FIRSTCC)=""
"RTN","PRCSECP",73,0)
 F  S CC=$O(^PRC(420,+STA,1,+FCP,2,CC)) Q:CC=""  D
"RTN","PRCSECP",74,0)
 . I $$VALIDCC(STA,FCP,CC) S GOODCC=GOODCC+1 I FIRSTCC="" S FIRSTCC=$E($P(^PRCD(420.1,+CC,0),U,1),1,23)
"RTN","PRCSECP",75,0)
 Q GOODCC_"^"_FIRSTCC
"RTN","PRCSECP",76,0)
 ;
"RTN","PRCSECP",77,0)
VALIDCC(STA,FCP,CC) ;Is this STATION,FCP,COST CENTER combination valid?
"RTN","PRCSECP",78,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",79,0)
 ;point to some active BOC
"RTN","PRCSECP",80,0)
 N X,VALID,BOC,GOODBOC
"RTN","PRCSECP",81,0)
 S BOC="",GOODBOC=0
"RTN","PRCSECP",82,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))  I (+X=+CC) D  ;FCP => CC
"RTN","PRCSECP",83,0)
 . S X=$G(^PRCD(420.1,CC,0)) I X]"",'$P(X,U,2) D  ;    CC IS ACTIVE
"RTN","PRCSECP",84,0)
 .. F  S BOC=$O(^PRCD(420.1,+CC,1,BOC)) Q:BOC=""!GOODBOC  D
"RTN","PRCSECP",85,0)
 ... S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) S GOODBOC=1
"RTN","PRCSECP",86,0)
 Q GOODBOC
"RTN","PRCSECP",87,0)
 ;
"RTN","PRCSECP",88,0)
GETBOCNT(STA,FCP,CC) ;How many valid BOCs for this STATION,FCP,COST CENTER
"RTN","PRCSECP",89,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",90,0)
 ;point to some active BOC
"RTN","PRCSECP",91,0)
 N X,VALID,BOC,GOODBOC,TOTBOCS,FIRSTBOC
"RTN","PRCSECP",92,0)
 S BOC="",GOODBOC=0,TOTBOCS=0,FIRSTBOC=""
"RTN","PRCSECP",93,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))  I (+X=+CC) D  ;FCP => CC
"RTN","PRCSECP",94,0)
 . S X=$G(^PRCD(420.1,CC,0)) I X]"",'$P(X,U,2) D  ;    CC IS ACTIVE
"RTN","PRCSECP",95,0)
 .. F  S BOC=$O(^PRCD(420.1,+CC,1,BOC)) Q:BOC=""  D
"RTN","PRCSECP",96,0)
 ... S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) D
"RTN","PRCSECP",97,0)
 .... S TOTBOCS=TOTBOCS+1 I FIRSTBOC="" S FIRSTBOC=$E($P(^PRCD(420.2,+BOC,0),U,1),1,23)
"RTN","PRCSECP",98,0)
 Q TOTBOCS_"^"_FIRSTBOC
"RTN","PRCSECP",99,0)
 ;
"RTN","PRCSECP",100,0)
VALIDBOC(STA,FCP,CC,BOC) ;Is this STATION,FCP,COST CENTER,BOC VALID?
"RTN","PRCSECP",101,0)
 ;To be valid, station/FCP must point to CC, CC must be active,CC must
"RTN","PRCSECP",102,0)
 ;point to BOC,and BOC must be active
"RTN","PRCSECP",103,0)
 N X,VALID,GOODBOC
"RTN","PRCSECP",104,0)
 S GOODBOC=0
"RTN","PRCSECP",105,0)
 S X=$G(^PRC(420,+STA,1,+FCP,2,+CC,0))
"RTN","PRCSECP",106,0)
 I (+X=+CC) S X=$G(^PRCD(420.1,+CC,0)) I X]"",'$P(X,U,2) D
"RTN","PRCSECP",107,0)
 . S X=$G(^PRCD(420.1,+CC,1,+BOC,0))
"RTN","PRCSECP",108,0)
 . I X]"" S X=$G(^PRCD(420.2,+BOC,0)) I X]"",'$P(X,U,2) S GOODBOC=1
"RTN","PRCSECP",109,0)
 Q GOODBOC
"RTN","PRCSECP",110,0)
 ;
"RTN","PRCSP121")
0^42^B21901481
"RTN","PRCSP121",1,0)
PRCSP121 ;WISC/SAW/BMM-CONTROL POINT ACTIVITY 2237 PRINTOUT CON'T ; 3/29/05 1:50pm
"RTN","PRCSP121",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCSP121",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSP121",4,0)
 ;
"RTN","PRCSP121",5,0)
 ;PRINT ITEMS  ;  REW fixed next line for Archiving "just in case"
"RTN","PRCSP121",6,0)
 ;
"RTN","PRCSP121",7,0)
 ;PRC*5.1*81 BMM edit PRCARD to add DM Doc ID (410.02, 17) and Date 
"RTN","PRCSP121",8,0)
 ;Needed By (410.02, 18) fields to printout
"RTN","PRCSP121",9,0)
 ;
"RTN","PRCSP121",10,0)
 I $D(^PRCS(410,DA,1)),$P(^(1),U,5)'="" S P=$P(^(1),U,5),P=$P($G(^PRCS(410.2,P,0),">>>  PRCS(410.2,"_P_",0) is not defined but referenced in PRCSP121 for record: "_DA_" <<<"),U) W !,?12,"|",P,":",?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|"
"RTN","PRCSP121",11,0)
 S DIWL=19,DIWR=35,DIWF="",P(1)=0
"RTN","PRCSP121",12,0)
 F I=1:1 K ^UTILITY($J,"W") S P(1)=$O(^PRCS(410,DA,"IT",P(1))) G VENDOR:P(1)'>0 D ITEM1
"RTN","PRCSP121",13,0)
ITEM1 Q:'$D(^PRCS(410,DA,"IT",P(1),0))  S Z=^(0),P(4)=$P(Z,U,6)
"RTN","PRCSP121",14,0)
 S PRCS("SUB")=+$P(Z,U,4),P(3)=$P(Z,U,3) S P(3)=$S($D(^PRCD(420.5,+P(3),0)):$P(^(0),U),1:"")
"RTN","PRCSP121",15,0)
 S P(0)="|"_$S($P(Z,U,2)[".":$J($P(Z,U,2),9,2),1:$J($P(Z,U,2),9))_"|"_$J(P(3),4)_"|"_$S($P(Z,U,7)="N/C":$J("N/C",9),1:$J($P(Z,U,7),9,4))_"|"
"RTN","PRCSP121",16,0)
 G PRCARD:$P(Z,U,5)
"RTN","PRCSP121",17,0)
 S P(2)=0 F I=1:1 S P(2)=$O(^PRCS(410,DA,"IT",P(1),1,P(2))) Q:P(2)=""  S X=^(P(2),0) S:I=1 X=$P(^PRCS(410,DA,"IT",P(1),0),U)_" "_X D DIWP^PRCUTL($G(DA))
"RTN","PRCSP121",18,0)
ITEM2 I '$D(^UTILITY($J,"W",DIWL)) S ^(DIWL)=1,^(DIWL,1,0)="***NO DESCRIPTION***"
"RTN","PRCSP121",19,0)
 S Z=^UTILITY($J,"W",DIWL)
"RTN","PRCSP121",20,0)
 I $L(P(4))>12 W !,$E(P(4),1,12),"|",?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|",!,$E(P(4),13,24)
"RTN","PRCSP121",21,0)
 I $L(P(4))<13 W !,P(4)
"RTN","PRCSP121",22,0)
 I Z>1 F J=1:1:(Z-1) W ?12,"|",^UTILITY($J,"W",DIWL,J,0),?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|" D:$Y>61 NEWP W !
"RTN","PRCSP121",23,0)
 I Z>1 W ?12,"|",^UTILITY($J,"W",DIWL,Z,0),?38,P(0),?73,"|",?84,"|" D:$Y>61 NEWP W !,?12,"|",?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|"
"RTN","PRCSP121",24,0)
 I Z<2 W ?12,"|",^UTILITY($J,"W",DIWL,1,0),?38,P(0),?73,"|",?84,"|" D:$Y>61 NEWP W !,?12,"|",?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|"
"RTN","PRCSP121",25,0)
 Q
"RTN","PRCSP121",26,0)
PRCARD S P("PR")=$P(^PRCS(410,DA,"IT",P(1),0),U,5) G ITEM2:'$D(^PRC(441,P("PR"),1,0))
"RTN","PRCSP121",27,0)
 S P("PR1")=0,X=$P(^PRCS(410,DA,"IT",P(1),0),U)_" ITEM ID NO. "_P("PR") D DIWP^PRCUTL($G(DA)) F I=1:1 S P("PR1")=$O(^PRC(441,P("PR"),1,P("PR1"))) Q:P("PR1")=""  S X=^(P("PR1"),0) D DIWP^PRCUTL($G(DA))
"RTN","PRCSP121",28,0)
 S Z="" S:$P(^PRC(441,P("PR"),0),U,5)'="" Z=Z_" (NSN: "_$P(^(0),U,5)_")" S Z1=$P(^PRCS(410,DA,3),U,4) I Z1,$D(^PRC(441,P("PR"),2,Z1,0)) S:$P(^(0),U,5)'="" Z=Z_" (NDC: "_$P(^(0),U,5)_")" S:$P(^(0),U,3) Z2=$P(^(0),U,3)
"RTN","PRCSP121",29,0)
 S:$P($G(^PRC(441,P("PR"),3)),U,7)'="" Z=Z_" FOOD GROUP: "_$P(^(3),U,7)
"RTN","PRCSP121",30,0)
 I Z1,$D(^PRC(441,P("PR"),2,Z1,0)) S Z=Z_" PKG: "_$P(^(0),U,8)_" per "_$S($D(^PRCD(420.5,+$P(^(0),U,7),0)):$P(^(0),U),1:"")
"RTN","PRCSP121",31,0)
 I $D(Z2),$D(^PRC(440,+Z1,4,+Z2,0)),$P(^(0),U)'="" S Y=$S($P(^(0),U,2):$P(^(0),U,2),1:"") X:Y ^DD("DD") S Z=Z_" (CONTRACT # "_$P(^PRC(440,Z1,4,Z2,0),U)_$S(Y'="":", EXPIRATION DATE: "_Y_")",1:")") K Z2
"RTN","PRCSP121",32,0)
 S X=Z D:$L(X) DIWP^PRCUTL($G(DA))
"RTN","PRCSP121",33,0)
 ;PRC*5.1*81 add DM Doc ID and Date Needed By fields to ^UTILITY
"RTN","PRCSP121",34,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1,$P($G(^PRCS(410,DA,"IT",P(1),4)),U)]"" D
"RTN","PRCSP121",35,0)
 . S X="DM Doc ID: "_$P(^PRCS(410,DA,"IT",P(1),4),U)_"    Date Needed By: "_$$FMTE^XLFDT($P(^(4),U,2)) D DIWP^PRCUTL($G(DA))
"RTN","PRCSP121",36,0)
 G ITEM2
"RTN","PRCSP121",37,0)
VENDOR ;PRINT VENDOR AND REQ MESSAGES
"RTN","PRCSP121",38,0)
 N Z0
"RTN","PRCSP121",39,0)
 I $Y>60 D NEWP
"RTN","PRCSP121",40,0)
 I $D(^PRCS(410,DA,4)),$P(^(4),U)'="" W !,?12,"|TOTAL COST: ","$"_$J($P(^(4),U),0,2),?38,"|",?48,"|",?53,"|",?63,"|",?73,"|",?84,"|"
"RTN","PRCSP121",41,0)
 W !,$E(L,1,12),"|",$E(L,1,25),"|",$E(L,1,9),"|",$E(L,1,4),"|",$E(L,1,9),"|",$E(L,1,9),"|",$E(L,1,10),"|",$E(L,1,5) I $Y>60 D NEWP
"RTN","PRCSP121",42,0)
 G RM:'$D(^PRCS(410,DA,2))
"RTN","PRCSP121",43,0)
 I $D(^PRCS(410,DA,2)),$P(^(2),U)="" G RM
"RTN","PRCSP121",44,0)
 I $Y>56 D NEWP
"RTN","PRCSP121",45,0)
 S (X,Z0)=$P(^PRCS(410,DA,3),U,4),X=$S(X:"VENDOR INFORMATION:    NO. "_X,1:"NEW VENDOR INFORMATION:") W !,X
"RTN","PRCSP121",46,0)
 I Z0,$D(^PRC(440,Z0,3)),$P(^(3),U,2)="Y" W ?38,"EDI"
"RTN","PRCSP121",47,0)
 I Z0,$D(^PRC(440,Z0,10)),$P(^(10),U,6)'="" W ?46,"FAX: "_$P(^(10),U,6)
"RTN","PRCSP121",48,0)
 S X=^PRCS(410,DA,2) W !,"VENDOR: ",$P(X,U) W:$P(X,U,9)'="" ?42,"CONTACT: ",$P(X,U,9)
"RTN","PRCSP121",49,0)
 W:$P(X,U,2)'="" !,?8,$P(X,U,2) W:$P(X,U,10)'="" ?44,"PHONE: ",$P(X,U,10)
"RTN","PRCSP121",50,0)
 W:$P(X,U,3)'="" !,?8,$P(X,U,3) S Z1=$P(^PRCS(410,DA,3),U,4) I Z1,$D(^PRC(440,Z1,2)),$P(^(2),U)'="" W ?42,"ACCT. #: ",$P(^(2),U)
"RTN","PRCSP121",51,0)
 W:$P(X,U,4)'="" !,?8,$P(X,U,4) W:$P(X,U,5)'="" !,?8,$P(X,U,5)
"RTN","PRCSP121",52,0)
 I $P(X,U,6)'="" W !,?8,$P(X,U,6) W:+$P(X,U,7)'=0 ",",$P($G(^DIC(5,$P(X,U,7),0)),U,2) W:$P(X,U,8)'="" " ",$P(X,U,8)
"RTN","PRCSP121",53,0)
 W !,L W !,"Ref. Voucher Number: ",! W:$P($G(^PRCS(410,DA,445)),"^")'="" $P(^(445),"^"),!
"RTN","PRCSP121",54,0)
RM I $Y>68 D NEWP
"RTN","PRCSP121",55,0)
 Q
"RTN","PRCSP121",56,0)
NEWP ;PRINT HEADER FOR NEW PAGE
"RTN","PRCSP121",57,0)
 W !,"VA FORM 90-2237-ADP MAR 1985" W:$Y>0 @IOF
"RTN","PRCSP121",58,0)
 S PRCS("P")=PRCS("P")+1 W !,?36,$P(^PRCS(410,DA,0),U),?83,"PAGE ",PRCS("P"),!,L
"RTN","PRCSP121",59,0)
 W !,?16,"REQUEST, TURN-IN, AND RECEIPT FOR PROPERTY OR SERVICES",! I $D(ZTDESC("NOPRINT")) W ?37,"**REPRINT**",!
"RTN","PRCSP121",60,0)
 W !,L
"RTN","PRCSP121",61,0)
 Q
"RTN","PRCSRIE1")
0^44^B23990379
"RTN","PRCSRIE1",1,0)
PRCSRIE1 ;WISC/SAW/DXH/SC/BMM - DELETE/REPLACE REPETITIVE ITEM LIST ; 3/31/05 3:22pm
"RTN","PRCSRIE1",2,0)
V ;;5.1;IFCAP;**13,81**;Oct 20, 2000
"RTN","PRCSRIE1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIE1",4,0)
 ;
"RTN","PRCSRIE1",5,0)
 ;BMM patch PRC*5.1*81 in EDIT, added DMCHK to ensure RILs from
"RTN","PRCSRIE1",6,0)
 ;DynaMed are not edited.  First check that DynaMed switch is on.
"RTN","PRCSRIE1",7,0)
 ;*81-SC-if it is DM RIL trx, then right before deleting update Audit
"RTN","PRCSRIE1",8,0)
 ;File 414.02 & send a msg to DynaMed thru a call to rtn PRCVRCA.
"RTN","PRCSRIE1",9,0)
 ;
"RTN","PRCSRIE1",10,0)
EDIT ;EDIT REP ITEM
"RTN","PRCSRIE1",11,0)
 D DISP^PRCOSS3
"RTN","PRCSRIE1",12,0)
 S DIC="^PRCS(410.3,",DIC(0)="AEMQZ",DIC("S")="S PRC(""SITE"")=+^(0),PRC(""CP"")=$P(^(0),""-"",4),$P(^(0),U,5)="""" I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSRIE1",13,0)
 S DIC("A")="Select REPETITIVE ITEM LIST #: " D ^DIC K DIC("S") I Y'>0 G EXIT
"RTN","PRCSRIE1",14,0)
 S (PRCSDA,DA)=+Y,PRCSNO=$P(^PRCS(410.3,DA,0),U)
"RTN","PRCSRIE1",15,0)
 ;PRC*5.1*81 can't edit if DynaMed RIL
"RTN","PRCSRIE1",16,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q"),$$DMCHK(DA) W !!,"** This RIL originated from DynaMed and cannot be edited **" H 3 G EXIT
"RTN","PRCSRIE1",17,0)
 L +^PRCS(410.3,DA):1
"RTN","PRCSRIE1",18,0)
 I $T=0 W !!,?15,"** Record in use, try to edit later **",! G EDIT
"RTN","PRCSRIE1",19,0)
 S PRC("SITE")=+Y(0),PRC("CP")=$P(Y(0),"-",4),DR="[PRCSRI]",DIE=DIC,DIE("NO^")=1 D ^DIE D CALC L -^PRCS(410.3,DA) K DIE("NO^")
"RTN","PRCSRIE1",20,0)
W2 W !!,"Would you like to edit another repetitive item list entry" S %=2 D YN^DICN G W2:%=0,EXIT:%=2!(%<1) W !! K PRCSV,PRCSV1 G EDIT
"RTN","PRCSRIE1",21,0)
CALC ;CALCULATE TOTAL COST
"RTN","PRCSRIE1",22,0)
 W !,"Let me total the cost for this Repetitive Item List entry (#",PRCSNO,")"
"RTN","PRCSRIE1",23,0)
 S (N,PRCSTC)="" F I=0:1 S N=$O(^PRCS(410.3,PRCSDA,1,"B",N)) Q:N=""  S N(1)="",N(1)=$O(^(N,N(1))) I $D(^PRCS(410.3,PRCSDA,1,N(1),0)) S N(2)=^(0),PRCSTC=PRCSTC+($P(N(2),"^",2)*($P(N(2),"^",4)))
"RTN","PRCSRIE1",24,0)
 W !,"Total number of items: ",I,"    Total cost (all items): $",$J(PRCSTC,0,2) S $P(^PRCS(410.3,PRCSDA,0),"^",2)=PRCSTC K N,PRCSTC
"RTN","PRCSRIE1",25,0)
 ;Karen's new stuff
"RTN","PRCSRIE1",26,0)
CHECK ;
"RTN","PRCSRIE1",27,0)
 S ZIP=0 F  S ZIP=$O(^PRCS(410.3,PRCSDA,1,ZIP)) Q:+ZIP=0  D
"RTN","PRCSRIE1",28,0)
 .S K0=^PRCS(410.3,PRCSDA,1,ZIP,0),V0=$P(K0,"^",5),V1=$P(K0,"^")
"RTN","PRCSRIE1",29,0)
 .S K1=$P($G(^PRC(441,+V1,2,+V0,0)),"^",3) S:K1'="" $P(K0,"^",6)="Y" S:K1="" $P(K0,"^",6)="N"
"RTN","PRCSRIE1",30,0)
 .S ^PRCS(410.3,PRCSDA,1,ZIP,0)=K0
"RTN","PRCSRIE1",31,0)
 K ZIP,K0,K1,V0,V1 QUIT
"RTN","PRCSRIE1",32,0)
DEL ;DELETE REPETITIVE ITEM LIST ENTRY
"RTN","PRCSRIE1",33,0)
 S DIC="^PRCS(410.3,",DIC(0)="AEMQZ",DIC("S")="S PRC(""SITE"")=+^(0),PRC(""CP"")=+$P(^(0),""-"",4),$P(^(0),U,5)="""" I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSRIE1",34,0)
 S DIC("A")="Select REPETITIVE ITEM LIST #: " D ^DIC K DIC("S") I Y'>0 G EXIT
"RTN","PRCSRIE1",35,0)
 S DA=+Y L +^PRCS(410.3,DA):1
"RTN","PRCSRIE1",36,0)
 I $T=0 W !!,?15,"** Record in use, try to delete later **",! G DEL
"RTN","PRCSRIE1",37,0)
DEL1 W !,"Are you sure you want to delete this Repetitive Item List entry" S %=2 D YN^DICN G DEL1:%=0 I %<0!(%=2) L -^PRCS(410.3,DA) G EXIT
"RTN","PRCSRIE1",38,0)
 ;PRC*5.1*81 if it is DM RIL, then update Audit File & send msg to DM
"RTN","PRCSRIE1",39,0)
 S DIK=DIC D EN^PRCVRCA(DA) L -^PRCS(410.3,DA) W !,"Okay....." D ^DIK W "It's deleted."
"RTN","PRCSRIE1",40,0)
DEL2 W !,"Would you like to delete another Repetitive Item List entry" S %=2 D YN^DICN G DEL2:%=0,EXIT:%=2,EXIT:%<0 W !! G DEL
"RTN","PRCSRIE1",41,0)
REPL ;REPLACE EXISTING REPETITIVE ITEM LIST ENTRY NUMBER
"RTN","PRCSRIE1",42,0)
 W !!,"Select the existing Repetitive Item List entry number to be replaced.",!
"RTN","PRCSRIE1",43,0)
 S DIC="^PRCS(410.3,",DIC(0)="AEMQZ",DIC("S")="S PRC(""SITE"")=+^(0),PRC(""CP"")=$P(^(0),""-"",4),$P(^(0),U,5)="""" I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSRIE1",44,0)
 S DIC("A")="Select REPETITIVE ITEM LIST #: " D ^DIC K DIC("S") I Y'>0 G EXIT
"RTN","PRCSRIE1",45,0)
 S DA=+Y L +^PRCS(410.3):15 G:$T=0 REPL
"RTN","PRCSRIE1",46,0)
 S T1=+Y,T2=$P(Y(0),"^"),PRC("SITE")=+^PRCS(410.3,DA,0),PRC("CP")=$P(^(0),"-",4) K DA,DIC,Y
"RTN","PRCSRIE1",47,0)
 W !!,"Now enter the information for the new Repetitive Item List entry number.",!
"RTN","PRCSRIE1",48,0)
 D EN^PRCSUT G W5^PRCSUT3:'$D(PRC("SITE")) G EXIT:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCSRIE1",49,0)
 K ^PRCS(410.3,"B",T2,T1),^PRCS(410.3,"C",$P(T2,"-",5),T1)
"RTN","PRCSRIE1",50,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)>1 S Y="NONE" G STF
"RTN","PRCSRIE1",51,0)
 S DIC="^PRC(420,PRC(""SITE""),1,+PRC(""CP""),2,",DIC(0)="AEMNQZ" D ^DIC I Y'>0 G EXIT
"RTN","PRCSRIE1",52,0)
 S Y=$P(Y(0),"^") I '$D(^PRCD(420.1,Y,0)) G EXIT
"RTN","PRCSRIE1",53,0)
STF S X=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("QTR")_"-"_$P(PRC("CP")," ")_"-"_Y
"RTN","PRCSRIE1",54,0)
 S $P(^PRCS(410.3,T1,0),"^")=X,^PRCS(410.3,"B",X,T1)="",^PRCS(410.3,"C",Y,T1)=""
"RTN","PRCSRIE1",55,0)
 L -^PRCS(410.3)
"RTN","PRCSRIE1",56,0)
REPL1 W !!,"Would you like to replace another Repetitive Item List entry number" S %=2 D YN^DICN G REPL1:%=0,EXIT:%<0,EXIT:%=2 I %=1 W !! G REPL
"RTN","PRCSRIE1",57,0)
SUB ;ASK BOC IF ONE DOES NOT EXIST FOR ITEM IN FILE 441
"RTN","PRCSRIE1",58,0)
 S Z0=$P(^PRCS(410.3,DA(1),1,DA,0),"^"),DIC="^PRCD(420.2,",DIC(0)="AEMQ",DIC("A")="Select BOC: "
"RTN","PRCSRIE1",59,0)
SUB1 D ^DIC I Y'>0 W !,$C(7),"Sorry, but you must select a budget object code for this item." G SUB1
"RTN","PRCSRIE1",60,0)
 S $P(^PRC(441,Z0,0),"^",10)=+Y S DIC=DIE K Y,Z0 Q
"RTN","PRCSRIE1",61,0)
VENDORH ;HELP PROMPT FOR VENDOR FIELD IN FILE 410.3
"RTN","PRCSRIE1",62,0)
 S:$D(D) ZD=D S X="?",Z0=$P(^PRCS(410.3,DA(1),1,DA,0),"^") Q:'Z0  Q:'$D(^PRC(441,Z0,2,0))
"RTN","PRCSRIE1",63,0)
 S DIC="^PRC(441,Z0,2,",DIC(0)="QEM" S:$G(PRCSIP) DIC("S")="I $O(^PRCP(445,PRCSIP,1,Z0,5,""B"",(+Y_"";PRC(440,""),0))" D ^DIC S DIC=DIE S:$D(ZD) D=ZD K ZD,DIC("S") Q
"RTN","PRCSRIE1",64,0)
EXIT K %,DA,DIC,DIE,DR,PRCSL,T1,T2,X,Y Q
"RTN","PRCSRIE1",65,0)
 ;
"RTN","PRCSRIE1",66,0)
DMCHK(DA) ;check that RIL is not from DynaMed, set flag
"RTN","PRCSRIE1",67,0)
 ;DA is RIL IEN in file 410.3
"RTN","PRCSRIE1",68,0)
 ;
"RTN","PRCSRIE1",69,0)
 N PRCVD,PRCVFG S (PRCVD,PRCVFG)=0
"RTN","PRCSRIE1",70,0)
D1 S PRCVD=$O(^PRCS(410.3,DA,1,PRCVD)) G:+PRCVD=0 D2
"RTN","PRCSRIE1",71,0)
 I $$GET1^DIQ(410.31,PRCVD_","_DA_",",6)'="" S PRCVFG=1 G D2
"RTN","PRCSRIE1",72,0)
 G D1
"RTN","PRCSRIE1",73,0)
D2 Q PRCVFG
"RTN","PRCSRIE1",74,0)
 ;
"RTN","PRCSRIG1")
0^52^B18018274
"RTN","PRCSRIG1",1,0)
PRCSRIG1 ;WISC/SAW/KMB/LJP/SC-GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE (CON'T) ;3-3-93/14:30 ; 3/31/05 3:48pm
"RTN","PRCSRIG1",2,0)
V ;;5.1;IFCAP;**13,81**;Oct 20, 2000
"RTN","PRCSRIG1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIG1",4,0)
 ;
"RTN","PRCSRIG1",5,0)
 ;PRC*5.1*81, RIL that originated thru DynaMed is NOT allowed to be
"RTN","PRCSRIG1",6,0)
 ;RE-USED for generating 2237(s),hence removed this prompt for DM
"RTN","PRCSRIG1",7,0)
 ;trxs. only.
"RTN","PRCSRIG1",8,0)
 ;
"RTN","PRCSRIG1",9,0)
 U IO S PRCSNO=$P(^PRCS(410.3,PRCSRID0,0),"^"),PRC("SITE")=+PRCSNO,PRC("CP")=$S($D(^PRC(420,PRC("SITE"),1,+$P(PRCSNO,"-",4),0)):$P(^(0),"^"),1:"")
"RTN","PRCSRIG1",10,0)
 I PRC("CP")="" W !!,"Control Point ",$P(PRCSNO,"-",4),"no longer exists.  You will have to transfer",!,"this repetitive item list to an existing control point before you can continue." K PRC("CP") G EXIT
"RTN","PRCSRIG1",11,0)
 ;Create transaction number 
"RTN","PRCSRIG1",12,0)
 D:'$D(DT) DT^DICRW S PRCSTIME=$E(DT,4,5),PRCSQUAR=$P("2^2^2^3^3^3^4^4^4^1^1^1","^",PRCSTIME)
"RTN","PRCSRIG1",13,0)
 S:PQTR=1 PRCSQUAR=$P(PRCSNO,"-",3)
"RTN","PRCSRIG1",14,0)
 S Z1=$P(PRCSNO,"-")_"-"_PRC("FY")_"-"_PRCSQUAR_"-"_$P(PRCSNO,"-",4)
"RTN","PRCSRIG1",15,0)
 S Z2=$P(Z1,"-",1,2)_"-"_$P(Z1,"-",4)
"RTN","PRCSRIG1",16,0)
 S PRCSCC=$P(PRCSNO,"-",5),PRCSCC=$S($D(^PRCD(420.1,+PRCSCC,0)):$E($P(^(0),"^"),1,30),1:PRCSCC) S:PRCSCC="NONE" PRCSCC="" S X="N",%DT="T" D ^%DT S PRCSD1=$P(Y,".") X ^DD("DD") S PRCSD=Y,X="T+30" D ^%DT S PRCSD(1)=Y
"RTN","PRCSRIG1",17,0)
 ;
"RTN","PRCSRIG1",18,0)
 ;See NOIS MON-0399-51726
"RTN","PRCSRIG1",19,0)
 KILL ^TMP($J)
"RTN","PRCSRIG1",20,0)
 S IB=0
"RTN","PRCSRIG1",21,0)
 F  S IB=$O(^PRCS(410.3,PRCSRID0,1,IB)) Q:'IB  D  ;
"RTN","PRCSRIG1",22,0)
 . S FF=$G(^PRCS(410.3,PRCSRID0,1,IB,0))
"RTN","PRCSRIG1",23,0)
 . S ^TMP($J,410.3,PRCSRID0,1,"AC",$P(FF,"^",3)_";"_$P(FF,"^",5),IB)=""
"RTN","PRCSRIG1",24,0)
 ;
"RTN","PRCSRIG1",25,0)
 ; Loop thru RIL entry numbers. PRCSV1 is the vendor for
"RTN","PRCSRIG1",26,0)
 ;the item, from the Rep. Item List. Starting here, loop
"RTN","PRCSRIG1",27,0)
 ;thru the vendor to get the items ordered from that vendor,
"RTN","PRCSRIG1",28,0)
 ;using PRCSRI for the item.
"RTN","PRCSRIG1",29,0)
 S (PRCSV1,PRCSTC)="",(PRCSCT,PRCSCT(1),PRCSIT)=0
"RTN","PRCSRIG1",30,0)
 F PRCSRIJ=0:1 S PRCSV1=$O(^TMP($J,410.3,PRCSRID0,1,"AC",PRCSV1)) Q:PRCSV1=""  S PRCSCT=PRCSCT+1,PRCSCT(1)=PRCSCT(1)+1 D:'PRCSRIJ HDRG D ITEMG^PRCSRIG2
"RTN","PRCSRIG1",31,0)
 I 'PRCSRIJ W !,"Items have not yet been entered for Repetitive Item List # ",PRCSNO G CLS
"RTN","PRCSRIG1",32,0)
 D:IOSL-$Y<3 HOLD,HDRG W !!,"Total no. of requests generated: ",PRCSCT,"    Total no. of items (all requests): ",PRCSIT,!,"Total committed (estimated) cost (all requests) : ","$"_$J(PRCSTC,0,2)
"RTN","PRCSRIG1",33,0)
SV ;
"RTN","PRCSRIG1",34,0)
 I (IO'=IO(0))!($D(ZTQUEUED)) D ^%ZISC
"RTN","PRCSRIG1",35,0)
 G EXIT:$D(ZTQUEUED)
"RTN","PRCSRIG1",36,0)
 ;patch *81 -DynaMed trx. is not allowed to be re-used
"RTN","PRCSRIG1",37,0)
 N PRCVSY,PRCVID
"RTN","PRCSRIG1",38,0)
 S PRCVSY=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCSRIG1",39,0)
 I PRCVSY=1 S PRCVID=$$ITDMID(PRCSRID0)
"RTN","PRCSRIG1",40,0)
 I PRCVSY=1,PRCVID=1 G CHK1
"RTN","PRCSRIG1",41,0)
 U IO(0) S %=2 W !,"Do you wish to re-use this list " D YN^DICN G:%=1 JMP G:%=0 SV
"RTN","PRCSRIG1",42,0)
CHK1 I PRCSCT=PRCSCT(1) S DIK="^PRCS(410.3,",DA=PRCSRID0 D ^DIK G CLS
"RTN","PRCSRIG1",43,0)
JMP D RLR^PRCSUT1
"RTN","PRCSRIG1",44,0)
 S $P(^PRCS(410.3,PRCSRID0,0),U,5)="",DIK="^PRCS(410.3,",DA=PRCSRID0 D IX^DIK
"RTN","PRCSRIG1",45,0)
CLS ;
"RTN","PRCSRIG1",46,0)
 D:$D(ZTSK) KILL^%ZTLOAD G EXIT
"RTN","PRCSRIG1",47,0)
 ;
"RTN","PRCSRIG1",48,0)
HDRG W @IOF,"GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE",?55,"DATE: ",PRCSD,!,"Requests Generated From Repetitive Item List Entry # ",PRCSNO,! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG1",49,0)
 Q
"RTN","PRCSRIG1",50,0)
 ;
"RTN","PRCSRIG1",51,0)
HOLD Q:IO'=IO(0)!($D(ZTQUEUED))  W !,"Press return to continue: " R Z(1):DTIME Q
"RTN","PRCSRIG1",52,0)
ASK S %=2 W !,"Do you wish to edit this request" D YN^DICN D ASK:%=0 G:%=2 EN1 Q:%'=1
"RTN","PRCSRIG1",53,0)
EN W ! K DTOUT,DUOUT,Y S DIE="^PRCS(410,",(PRCSDR,DR)="[PRCSENPR]",T1=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=T1 Q
"RTN","PRCSRIG1",54,0)
 S DA=T1 D RL^PRCSUT1,^PRCSCK I $D(PRCSERR),PRCSERR G EN
"RTN","PRCSRIG1",55,0)
EN1 W ! D W6^PRCSEB Q
"RTN","PRCSRIG1",56,0)
 ;*****************************************************************
"RTN","PRCSRIG1",57,0)
 ; PRCSRID0 represents the ien of the record in file 410.3
"RTN","PRCSRIG1",58,0)
 ; patch *81 --itdmid removes Re-use Ques for DM related RIL
"RTN","PRCSRIG1",59,0)
 ;*****************************************************************
"RTN","PRCSRIG1",60,0)
ITDMID(PRCSRID0) ; check DynaMed DOC ID existence for an item
"RTN","PRCSRIG1",61,0)
 ;N PRCVA,PRCVB,PRCVFLG
"RTN","PRCSRIG1",62,0)
 ;S PRCVA=0
"RTN","PRCSRIG1",63,0)
 ;S PRCVFLG=0 ; 0 means that there is no DM ID on a item
"RTN","PRCSRIG1",64,0)
 ;S PRCVA=$O(^PRCS(410.3,PRCSRID0,1,PRCVA)) D
"RTN","PRCSRIG1",65,0)
 ;.Q:+$G(PRCVA)'>0
"RTN","PRCSRIG1",66,0)
 ;.S PRCVB=$$GET1^DIQ(410.31,PRCVA_","_PRCSRID0_",",6) ; DM doc id
"RTN","PRCSRIG1",67,0)
 ;.I PRCVB'="" S PRCVFLG=1 Q
"RTN","PRCSRIG1",68,0)
 ;Q PRCVFLG
"RTN","PRCSRIG1",69,0)
 ;
"RTN","PRCSRIG1",70,0)
 ;Remove the prompt if entry is set in 414.02 Audit File 'C' x-ref
"RTN","PRCSRIG1",71,0)
 N PRCVFLG,PRCVL,PRCVM
"RTN","PRCSRIG1",72,0)
 S PRCVM=$$GET1^DIQ(410.3,PRCSRID0_",",.01) ; ext value of RIL trx
"RTN","PRCSRIG1",73,0)
 S PRCVL=""
"RTN","PRCSRIG1",74,0)
 S PRCVFLG=0
"RTN","PRCSRIG1",75,0)
 S PRCVL=$O(^PRCV(414.02,"C",PRCVM,PRCVL))
"RTN","PRCSRIG1",76,0)
 I PRCVL'="" S PRCVFLG=1 Q 1
"RTN","PRCSRIG1",77,0)
 Q PRCVFLG
"RTN","PRCSRIG1",78,0)
 ;
"RTN","PRCSRIG1",79,0)
 ;
"RTN","PRCSRIG1",80,0)
EXIT K %,%DT,%ZIS,PRCSRID0,DA,DIC,DIE,DIK,PRCSRIJ,K,L,PRCSRIM,PRCS,PRCSCS
"RTN","PRCSRIG1",81,0)
 K PRCSCT,PRCSCC,PRCSD,PRCSD1,PRCSRI,PRCSIT,PRCSL,PRCSNO,PRCSS,PRCSTC
"RTN","PRCSRIG1",82,0)
 K PRCSV1,PX,T1,X,X1,X2,Y,Z,Z1,Z2
"RTN","PRCSRIG1",83,0)
 K PRCSTIME,PRCSQUAR,^TMP($J) Q
"RTN","PRCSRIG2")
0^43^B42383043
"RTN","PRCSRIG2",1,0)
PRCSRIG2 ;SF-ISC/LJP/KMB/BMM-GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE (CON'T) ; 3/25/05 3:05pm
"RTN","PRCSRIG2",2,0)
V ;;5.1;IFCAP;**13,81**;Oct 20, 2000
"RTN","PRCSRIG2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIG2",4,0)
 ;PRCSRI is the ordered item from the RIL.  PX(3) is
"RTN","PRCSRIG2",5,0)
 ;the ordered item from the Item Master File. PRCSV1 is
"RTN","PRCSRIG2",6,0)
 ;the vendor from the RIL. X2 is the vendor listed for
"RTN","PRCSRIG2",7,0)
 ;the item from the Item Master File. PX(1) holds Item
"RTN","PRCSRIG2",8,0)
 ;Master File data, PX(2) holds Vendor File data.
"RTN","PRCSRIG2",9,0)
 ;
"RTN","PRCSRIG2",10,0)
 ;2/16/05 BMM per PRC*5.1*81, added code in ITEMG1 to capture
"RTN","PRCSRIG2",11,0)
 ;data from two new fields in files 410 and 410.3:
"RTN","PRCSRIG2",12,0)
 ;DM Doc ID (410 #17, 410.3 #6) and Date Needed (410 #18, 410.3 #7)
"RTN","PRCSRIG2",13,0)
 ;added variables PRCVDN, PRCVDTN in ITEMG
"RTN","PRCSRIG2",14,0)
 ;
"RTN","PRCSRIG2",15,0)
 ;3/9/05 BMM per PRC*5.1*81, added sub UPDAUD to update the DM Audit
"RTN","PRCSRIG2",16,0)
 ;file when a 2237 is created.
"RTN","PRCSRIG2",17,0)
 ;
"RTN","PRCSRIG2",18,0)
ITEMG N STOP,PRCVDN,PRCVDTN S (PRCSRI,PRCSCS,STOP)="",(PRCSIT(1),K)=0
"RTN","PRCSRIG2",19,0)
 S (PRCVDN,PRCVDTN)=""
"RTN","PRCSRIG2",20,0)
 F PRCSRIM=0:1 S PRCSRI=$O(^TMP($J,410.3,PRCSRID0,1,"AC",PRCSV1,PRCSRI)) Q:PRCSRI=""  S PRCSIT=PRCSIT+1,PRCSIT(1)=PRCSIT(1)+1 D ITEMG1 D:STOP'=1 ITEMG3 S STOP=""
"RTN","PRCSRIG2",21,0)
 D:$D(DA) ITEMG2 I $D(PRCSL),PRCSL L
"RTN","PRCSRIG2",22,0)
 D:IOSL-$Y<2 HOLD,HDRG W !!,"  Finished building request.",!,"This request contains ",PRCSIT(1)_$S(PRCSIT(1)=1:" item.",1:" items."),"  The total cost for this request is $",$J(PRCSCS,0,2),! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG2",23,0)
 S PRCSTC=PRCSTC+PRCSCS Q
"RTN","PRCSRIG2",24,0)
 ;
"RTN","PRCSRIG2",25,0)
ITEMG1 S PX=^PRCS(410.3,PRCSRID0,1,PRCSRI,0),PX(3)=$P(PX,"^"),PX(1)=^PRC(441,PX(3),0),X2=$P(PX,"^",5),PX(2)=^PRC(440,X2,0),PRCVDN=$P(PX,"^",7),PRCVDTN=$P(PX,"^",8)
"RTN","PRCSRIG2",26,0)
 ; If a discrepancy is found, set STOP=1, skip item
"RTN","PRCSRIG2",27,0)
 I $D(PX(1)),$P(PX(1),"^",10)'?4N W !,"The budget object code for this item is not entered in the Item Master File.",!,"This item cannot be processed.",! S STOP=1
"RTN","PRCSRIG2",28,0)
 I '$D(^PRC(441,PX(3),2,X2,0)) D:IOSL-$Y<2 HOLD,HDRG W !,$C(7),"WARNING!!! Item # ",PX(3)," is not available from ",$P(PRCSV1,";"),"  (",$P(PRCSV1,";",2),")",!,"This item cannot be processed.",! S PRCSIT=PRCSIT-1,PRCSIT(1)=PRCSIT(1)-1 S STOP=1
"RTN","PRCSRIG2",29,0)
 Q
"RTN","PRCSRIG2",30,0)
 ;
"RTN","PRCSRIG2",31,0)
ITEMG3 I 'K S Z=Z1,X=Z2 D EN1^PRCSUT3 G:'X EX S X1=X D EN2^PRCSUT3 G:'$D(X1) EX L +^PRCS(410,DA):15 G:$T=0 EX
"RTN","PRCSRIG2",32,0)
 D:IOSL-$Y<7 HOLD,HDRG
"RTN","PRCSRIG2",33,0)
 I 'K W !,"A request with Transaction Number ",$P(Y(0),"^")," has been generated.",!!,"The vendor for this request is ",$P(PRCSV1,";"),"  (",$P(PRCSV1,";",2),")",!,"Now entering items for this request."
"RTN","PRCSRIG2",34,0)
 ;PRC*5.1*81 update audit file for 2237 creation
"RTN","PRCSRIG2",35,0)
 I 'K S PRCV2=$P(Y(0),"^",1)
"RTN","PRCSRIG2",36,0)
 ;S K=K+1,X(3)=^PRC(441,PX(3),2,X2,0) I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)<1 S PRCSS=$S($P(PX(1),"^",10):$E($P(^PRCD(420.2,$P(PX(1),"^",10),0),"^"),1,30),1:"")
"RTN","PRCSRIG2",37,0)
 ;
"RTN","PRCSRIG2",38,0)
 ;For a Supply Fund Requests adding code to derive BOC from NSN
"RTN","PRCSRIG2",39,0)
 S K=K+1
"RTN","PRCSRIG2",40,0)
 S X(3)=^PRC(441,PX(3),2,X2,0)
"RTN","PRCSRIG2",41,0)
 S ITNSN=$E($P($G(^PRC(441,+PX(3),0)),U,5),1,4)
"RTN","PRCSRIG2",42,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) D
"RTN","PRCSRIG2",43,0)
 . I $P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,12)'=2!($P(^(0),U,12)'=4) D
"RTN","PRCSRIG2",44,0)
 . . S PRCSS=$S($P(PX(1),"^",10):$E($P(^PRCD(420.2,$P(PX(1),"^",10),0),"^"),1,30),1:"")
"RTN","PRCSRIG2",45,0)
 . . Q
"RTN","PRCSRIG2",46,0)
 . I $P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,12)=2!($P(^(0),U,12)=4) D
"RTN","PRCSRIG2",47,0)
 . . S ITACCT=$$ACCT^PRCPUX1(ITNSN)
"RTN","PRCSRIG2",48,0)
 . . S ITBOC=$S(ITACCT=1:2697,ITACCT=2:2698,ITACCT=3:2699,ITACCT=6:2699,ITACCT=8:2696,1:2699)
"RTN","PRCSRIG2",49,0)
 . . S PRCSS=$E($P(^PRCD(420.2,ITBOC,0),U,1),1,30)
"RTN","PRCSRIG2",50,0)
 . . Q
"RTN","PRCSRIG2",51,0)
 . Q
"RTN","PRCSRIG2",52,0)
 S:'$D(PRCSS) PRCSS="" S ^PRCS(410,DA,"IT",K,0)=K_"^"_$P(PX,"^",2)_"^"_$P(X(3),"^",7)_"^"_PRCSS_"^"_PX(3)_"^"_$P(X(3),"^",4)_"^"_$P(PX,"^",4),^PRCS(410,DA,"IT",K,1,0)="^^1^1^"_PRCSD1_"^^",^(1,0)=$P(PX(1),"^",2)
"RTN","PRCSRIG2",53,0)
 ;PRC*5.1*81 add DM Doc ID, Date Needed to new line item
"RTN","PRCSRIG2",54,0)
 ;
"RTN","PRCSRIG2",55,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D
"RTN","PRCSRIG2",56,0)
 . Q:'$D(^PRCV(414.02,"C",PRCSNO))
"RTN","PRCSRIG2",57,0)
 . S ^PRCS(410,DA,"IT",K,4)=PRCVDN_"^"_PRCVDTN
"RTN","PRCSRIG2",58,0)
 . D UPDAUD(PRCV2)
"RTN","PRCSRIG2",59,0)
 S ^PRCS(410,DA,"IT","B",K,K)="",^PRCS(410,DA,"IT","AB",K,K)="" S:PRCSS ^PRCS(410,"AD",PRCSS,DA)=""
"RTN","PRCSRIG2",60,0)
 S PRCSCS=PRCSCS+($P(PX,"^",2)*($P(PX,"^",4))) G EX2
"RTN","PRCSRIG2",61,0)
 ;
"RTN","PRCSRIG2",62,0)
ITEMG2 S ^PRCS(410,DA,"IT",0)="^"_"410.02AI"_"^"_K_"^"_K,%=$P(^PRCS(410.3,PRCSRID0,0),"^",3),$P(^PRCS(410,DA,0),"^",2)="O" S:% $P(^(0),"^",6)=%,^PRCS(410,"AO",%,DA)="" S $P(^PRCS(410,DA,0),"^",4)=$S($D(^PRC(440,"AC","S",X2)):5,1:3)
"RTN","PRCSRIG2",63,0)
 S ^PRCS(410,DA,1)=PRCSD1_"^^"_"ST"_"^"_PRCSD(1),^(2)=PX(2),^PRCS(410,DA,3)=$P(^PRCS(410,DA,3),"^",1,2)_"^"_PRCSCC_"^"_X2_"^"_$S($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)):$P(^(0),"^",10),1:"")
"RTN","PRCSRIG2",64,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSRIG2",65,0)
 S:PRC("ACC") $P(^PRCS(410,DA,3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSRIG2",66,0)
 S ^PRCS(410,DA,4)=PRCSCS_"^"_PRCSD1_"^^^^^^"_PRCSCS,^(10)=K,^(7)=+PRC("PER")_"^"_$P(PRC("PER"),"^",3) S:'$D(^(11)) ^(11)=""
"RTN","PRCSRIG2",67,0)
 S ^PRCS(410,"E",$E($P(PX(2),"^"),1,30),DA)="" S:PRCSCC ^PRCS(410,"AC",$E(PRCSCC,1,30),DA)=""
"RTN","PRCSRIG2",68,0)
 I IO'=IO(0)!$D(ZTQUEUED) S $P(^PRCS(410,DA,11),U,3)=1,^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA)="",^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA)=""
"RTN","PRCSRIG2",69,0)
 I IO'=IO(0)!$D(ZTQUEUED) S ^PRCS(410,"AQ",1,DA)="" L -^PRCS(410,DA) G END
"RTN","PRCSRIG2",70,0)
 S PRC("QTR")=$P($P(^PRCS(410,DA,0),U),"-",3) D ASK^PRCSRIG1 L -^PRCS(410,DA)
"RTN","PRCSRIG2",71,0)
END K DA,PRCSDR,PRCSCQT,PRCSOCK,PRCSOCP,PRCSOCS,PRCST,PRCST1,PX,X2 Q
"RTN","PRCSRIG2",72,0)
 ;
"RTN","PRCSRIG2",73,0)
HDRG W @IOF,"GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE",?55,"DATE: ",PRCSD,!,"Requests Generated From Repetitive Item List Entry # ",PRCSNO,! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG2",74,0)
 Q
"RTN","PRCSRIG2",75,0)
 ;
"RTN","PRCSRIG2",76,0)
HOLD Q:IO'=IO(0)!($D(ZTQUEUED))  W !,"Press return to continue: " R Z(1):DTIME Q
"RTN","PRCSRIG2",77,0)
EX K PX,X,X1,X2,Z S PRCSCT=PRCSCT-1 W $C(7),!,"Could not create a request" Q
"RTN","PRCSRIG2",78,0)
EX1 K X,X2 D KRL K PX Q
"RTN","PRCSRIG2",79,0)
EX2 K PRCSS,Y D KRL K PX(3),X(3) Q
"RTN","PRCSRIG2",80,0)
KRL Q
"RTN","PRCSRIG2",81,0)
 ;
"RTN","PRCSRIG2",82,0)
UPDAUD(PRCV2) ;per PRC*5.1*81, update DM Audit file (#414.02) when 2237 is created
"RTN","PRCSRIG2",83,0)
 ;PRCV2 - 2237's .01 value
"RTN","PRCSRIG2",84,0)
 ;PRCVDYN - DM Doc ID for each item
"RTN","PRCSRIG2",85,0)
 ;PRCSRID0 - RIL IEN from above
"RTN","PRCSRIG2",86,0)
 ;
"RTN","PRCSRIG2",87,0)
 ;first check DM flag
"RTN","PRCSRIG2",88,0)
 ;Q:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1
"RTN","PRCSRIG2",89,0)
 N PRCVA,PRCVAC,PRCVC,PRCVDI,PRCVDYN,PRCVI,PRCVIEN,PRCVFCP
"RTN","PRCSRIG2",90,0)
 N PRCVFL,PRCVJ,PRCVST,PRCVTMP,XMB
"RTN","PRCSRIG2",91,0)
 S (PRCVC,PRCVDYN,PRCVIEN)="",PRCVFL=0
"RTN","PRCSRIG2",92,0)
 ;get #items for RIL in 414.02
"RTN","PRCSRIG2",93,0)
 ;F PRCVI=0:1 S PRCVC=$O(^PRCV(414.02,"C",PRCSNO,PRCVC)) Q:PRCVC=""
"RTN","PRCSRIG2",94,0)
 ;for each item, update entry in 414.02
"RTN","PRCSRIG2",95,0)
 ;F PRCVJ=1:1:PRCVI Q:PRCVFL=1  D
"RTN","PRCSRIG2",96,0)
 S PRCVJ=PRCSRI D
"RTN","PRCSRIG2",97,0)
 . S PRCVDYN=$$GET1^DIQ(410.31,PRCVJ_","_PRCSRID0_",",6)
"RTN","PRCSRIG2",98,0)
 . ;
"RTN","PRCSRIG2",99,0)
 . I PRCVDYN="" D  Q
"RTN","PRCSRIG2",100,0)
 . . ;DM Doc ID missing
"RTN","PRCSRIG2",101,0)
 . . S PRCVTMP="PRCSRIG2",PRCVST=$P(PRCSNO,"-")
"RTN","PRCSRIG2",102,0)
 . . S PRCVFCP=$P(PRCSNO,"-",4)
"RTN","PRCSRIG2",103,0)
 . . S XMB(1)="creating a new 2237 record"
"RTN","PRCSRIG2",104,0)
 . . S XMB(2)=" <missing>"
"RTN","PRCSRIG2",105,0)
 . . S XMB(3)="DM doc ID value missing from line item in 2237"
"RTN","PRCSRIG2",106,0)
 . . S ^TMP($J,"PRCSRIG2",1,0)=""
"RTN","PRCSRIG2",107,0)
 . . S ^TMP($J,"PRCSRIG2",2,0)="2237 #: "_PRCV2
"RTN","PRCSRIG2",108,0)
 . . S ^TMP($J,"PRCSRIG2",3,0)="Item #: "_PX(3)
"RTN","PRCSRIG2",109,0)
 . . D DMERXMB^PRCVLIC(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCSRIG2",110,0)
 . ;
"RTN","PRCSRIG2",111,0)
 . S PRCVIEN=$O(^PRCV(414.02,"B",PRCVDYN,0))
"RTN","PRCSRIG2",112,0)
 . S PRCVA(414.02,PRCVIEN_",",7)=PRCV2
"RTN","PRCSRIG2",113,0)
 . D FILE^DIE("","PRCVA")
"RTN","PRCSRIG2",114,0)
 . I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCSRIG2",115,0)
 . . ;error updating Audit file
"RTN","PRCSRIG2",116,0)
 . . S PRCVTMP="PRCSRIG2",PRCVST=$P(PRCSNO,"-")
"RTN","PRCSRIG2",117,0)
 . . S PRCVFCP=$P(PRCSNO,"-",4)
"RTN","PRCSRIG2",118,0)
 . . S XMB(1)="updating the DynaMed IFCAP Interface Audit file (#414.02)"
"RTN","PRCSRIG2",119,0)
 . . S XMB(2)=PRCVDYN
"RTN","PRCSRIG2",120,0)
 . . S XMB(3)="unable to add update to Audit file entry"
"RTN","PRCSRIG2",121,0)
 . . S ^TMP($J,"PRCSRIG2",1,0)=""
"RTN","PRCSRIG2",122,0)
 . . S ^TMP($J,"PRCSRIG2",2,0)="2237 #: "_PRCV2
"RTN","PRCSRIG2",123,0)
 . . S ^TMP($J,"PRCSRIG2",3,0)="Item #: "_PX(3)
"RTN","PRCSRIG2",124,0)
 . . S ^TMP($J,"PRCSRIG2",4,0)="Error text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCSRIG2",125,0)
 . . D DMERXMB^PRCVLIC(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCSRIG2",126,0)
 Q
"RTN","PRCSRIG2",127,0)
 ;
"RTN","PRCSRIP")
0^40^B16688208
"RTN","PRCSRIP",1,0)
PRCSRIP ;WISC/SAW/BMM-PRINT/DISPLAY ITEMS BY VENDOR FROM REPETITIVE ITEM LIST FILE ;8/18/94  14:24 ;
"RTN","PRCSRIP",2,0)
V ;;5.1;IFCAP;**13,81**;Oct 20, 2000
"RTN","PRCSRIP",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIP",4,0)
 ;
"RTN","PRCSRIP",5,0)
 ;BMM 2/22/05 per PRC*5.1*81 add code to display DM DOC ID and Date
"RTN","PRCSRIP",6,0)
 ;Needed fields for RILs originating in DynaMed
"RTN","PRCSRIP",7,0)
 ;
"RTN","PRCSRIP",8,0)
 S DIC="^PRCS(410.3,",DIC(0)="AEMQ",DIC("S")="S PRC(""SITE"")=+^(0),PRC(""CP"")=+$P(^(0),""-"",4) I $D(^PRC(420,""A"",DUZ,PRC(""SITE""),+PRC(""CP""),1))!($D(^(2)))"
"RTN","PRCSRIP",9,0)
 S DIC("A")="Select REPETITIVE ITEM LIST #: " D ^DIC K DIC("S") I Y'>0 G EXIT
"RTN","PRCSRIP",10,0)
 S D0=+Y G EXIT:$G(^PRCS(410.3,D0,0))=""
"RTN","PRCSRIP",11,0)
 ;
"RTN","PRCSRIP",12,0)
 ;See NOIS MON-0399-51726
"RTN","PRCSRIP",13,0)
 D SORT
"RTN","PRCSRIP",14,0)
 ;
"RTN","PRCSRIP",15,0)
 S %ZIS("B")="HOME",%ZIS="MQ" D ^%ZIS G EXIT:POP I $D(IO("Q")) S ZTRTN="QUE^PRCSRIP",ZTSAVE("D0")="" D ^%ZTLOAD G EXIT
"RTN","PRCSRIP",16,0)
QUE U IO S PRCSNO=$P(^PRCS(410.3,D0,0),"^") D NOW^%DTC S Y=% D DD^%DT S PRCSD=Y
"RTN","PRCSRIP",17,0)
 S (N,PRCSP,PRCSIT,PRCSTC,Z(1))=""
"RTN","PRCSRIP",18,0)
 I $G(ZTRTN)="QUE^PRCSRIP" D SORT ;See NOIS MON-0399-51726
"RTN","PRCSRIP",19,0)
 F J=0:1 S N=$O(^TMP($J,410.3,D0,1,"AC",N)) Q:N=""  D:'J HDRL D:IOSL-($Y#IOSL)<4 HOLD Q:Z(1)=U  D:IOSL-($Y#IOSL)<4 HDRL W !!,"VENDOR: ",$P(N,";")," (",$P(N,";",2),")",! D ITEML
"RTN","PRCSRIP",20,0)
 I 'J W !,"Items have not yet been entered for Repetitive Item List # ",PRCSNO
"RTN","PRCSRIP",21,0)
 I J D:IOSL-($Y#IOSL)<4 HOLD Q:Z(1)=U  D:IOSL-($Y#IOSL)<4 HDRL W !!,"TOTAL # OF ITEMS (ALL VENDORS): ",$J(PRCSIT,4),?40,"TOTAL COST (ALL VENDORS): ",$J(PRCSTC,9,2)
"RTN","PRCSRIP",22,0)
 I (IO'=IO(0))!($D(ZTQUEUED)) D ^%ZISC
"RTN","PRCSRIP",23,0)
 G EXIT
"RTN","PRCSRIP",24,0)
 ;
"RTN","PRCSRIP",25,0)
ITEML ;PRC*5.1*81 redirect to ITEML1D instead of ITEML1 if a DynaMed RIL
"RTN","PRCSRIP",26,0)
 ;
"RTN","PRCSRIP",27,0)
 N PRCVDF,PRCVDN
"RTN","PRCSRIP",28,0)
 S (N(1),PRCSC,PRCVDF,PRCVDN)=""
"RTN","PRCSRIP",29,0)
 ;check Inventory flag
"RTN","PRCSRIP",30,0)
 S PRCVDF=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCSRIP",31,0)
 F K=0:1 S N(1)=$O(^TMP($J,410.3,D0,1,"AC",N,N(1))) Q:N(1)=""  D  Q:Z(1)=U
"RTN","PRCSRIP",32,0)
 . ;PRC*5.1*81 if flag=1 then DM RIL, use different display
"RTN","PRCSRIP",33,0)
 . S PRCVDN=$$GET1^DIQ(410.31,N(1)_","_D0_",",6)
"RTN","PRCSRIP",34,0)
 . I PRCVDF=1,PRCVDN'="" D ITEML1D(PRCVDN) Q
"RTN","PRCSRIP",35,0)
 . D ITEML1
"RTN","PRCSRIP",36,0)
 Q:Z(1)=U  D:IOSL-($Y#IOSL)<3 HDRL W !!,"TOTAL # OF ITEMS: ",$J(K,4),?25,"TOTAL COST: ",$J(PRCSC,9,2),! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIP",37,0)
 S PRCSIT=PRCSIT+K,PRCSTC=PRCSTC+PRCSC Q
"RTN","PRCSRIP",38,0)
 ;
"RTN","PRCSRIP",39,0)
ITEML1 I IOSL-($Y#IOSL)<2 D HOLD Q:Z(1)=U  D HDRL W !!,"VENDOR: ",$P(N,";")," (",$P(N,";",2),")",!
"RTN","PRCSRIP",40,0)
 S X=^PRCS(410.3,D0,1,N(1),0) W !,$P(X,"^"),?12 W:$D(^PRC(441,$P(X,"^"),0)) $E($P(^(0),"^",2),1,42) W ?54,$S($P(X,"^",2)[".":$J($P(X,"^",2),9,2),1:$J($P(X,"^",2),9)),?66,$J($P(X,"^",4),9,2)
"RTN","PRCSRIP",41,0)
 I $D(^PRC(441,$P(X,"^"),2,+$P(X,"^",5),0)) W ?78,$S($D(^PRCD(420.5,+$P(^(0),"^",7),0)):$P(^(0),"^"),1:"")
"RTN","PRCSRIP",42,0)
 S PRCSC=PRCSC+($P(X,"^",2)*($P(X,"^",4))) Q
"RTN","PRCSRIP",43,0)
 ;
"RTN","PRCSRIP",44,0)
HOLD Q:IO'=IO(0)!($D(ZTQUEUED))  S Z(1)="" W !,"Press return to continue, uparrow (^) to exit: " R Z(1):DTIME S:'$T Z(1)=U Q
"RTN","PRCSRIP",45,0)
HDRL S PRCSP=PRCSP+1 W @IOF,"REPETITIVE ITEM LIST #: ",PRCSNO,?50,"DATE: ",PRCSD,"  PAGE ",PRCSP
"RTN","PRCSRIP",46,0)
 W !,"ITEM NO.",?12,"SHORT DESCRIPTION",?55,"QUANTITY",?66,"UNIT COST",?77,"U/P",! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIP",47,0)
 Q
"RTN","PRCSRIP",48,0)
 ;
"RTN","PRCSRIP",49,0)
SORT ;See NOIS MON-0399-51726
"RTN","PRCSRIP",50,0)
 KILL ^TMP($J)
"RTN","PRCSRIP",51,0)
 N II,FF S II=0
"RTN","PRCSRIP",52,0)
 F  S II=$O(^PRCS(410.3,D0,1,II)) Q:'II  D  ;
"RTN","PRCSRIP",53,0)
 . S FF=$G(^PRCS(410.3,D0,1,II,0))
"RTN","PRCSRIP",54,0)
 . S ^TMP($J,410.3,D0,1,"AC",$P(FF,"^",3)_";"_$P(FF,"^",5),II)=""
"RTN","PRCSRIP",55,0)
 Q
"RTN","PRCSRIP",56,0)
 ;
"RTN","PRCSRIP",57,0)
EXIT K %,%DT,%ZIS,D0,DIC,I,J,K,L,N,PRCSC,PRCSD,PRCSIT,PRCSNO,PRCSP,PRCSTC
"RTN","PRCSRIP",58,0)
 K PRCS,X,Y,Z,IEN410,^TMP($J) Q
"RTN","PRCSRIP",59,0)
 ;
"RTN","PRCSRIP",60,0)
ITEML1D(PRCVDN) ;PRC*5.1*81
"RTN","PRCSRIP",61,0)
 ;display items from DynaMed RIL, include DM Doc ID and
"RTN","PRCSRIP",62,0)
 ;Date Needed
"RTN","PRCSRIP",63,0)
 ;PRCVDN is DM Doc ID
"RTN","PRCSRIP",64,0)
 ;
"RTN","PRCSRIP",65,0)
 N PRCVED,PRCVFMD
"RTN","PRCSRIP",66,0)
 I IOSL-($Y#IOSL)<2 D HOLD Q:Z(1)=U  D HDRL W !!,"VENDOR: ",$P(N,";")," (",$P(N,";",2),")",!
"RTN","PRCSRIP",67,0)
 S X=^PRCS(410.3,D0,1,N(1),0) W !,$P(X,"^"),?12 W:$D(^PRC(441,$P(X,"^"),0)) $E($P(^(0),"^",2),1,42) W ?54,$S($P(X,"^",2)[".":$J($P(X,"^",2),9,2),1:$J($P(X,"^",2),9)),?66,$J($P(X,"^",4),9,2)
"RTN","PRCSRIP",68,0)
 I $D(^PRC(441,$P(X,"^"),2,+$P(X,"^",5),0)) W ?78,$S($D(^PRCD(420.5,+$P(^(0),"^",7),0)):$P(^(0),"^"),1:"")
"RTN","PRCSRIP",69,0)
 ;S PRCVFMD=$$HL7TFM^XLFDT($P(X,"^",8))
"RTN","PRCSRIP",70,0)
 S PRCVED=$$FMTE^XLFDT($P(X,"^",8))
"RTN","PRCSRIP",71,0)
 W !,"DM DOC ID: ",$P(X,"^",7),?45,"DATE NEEDED BY: ",PRCVED
"RTN","PRCSRIP",72,0)
 S PRCSC=PRCSC+($P(X,"^",2)*($P(X,"^",4)))
"RTN","PRCSRIP",73,0)
 Q
"RTN","PRCSRIP",74,0)
 ;
"RTN","PRCV442A")
0^1^B47663562
"RTN","PRCV442A",1,0)
PRCV442A ;WOIFO/CC-GET PO VALUES TO SEND TO DYNAMED;1/29/05
"RTN","PRCV442A",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCV442A",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCV442A",4,0)
 Q
"RTN","PRCV442A",5,0)
 ;
"RTN","PRCV442A",6,0)
ITEM(POIEN,PRCVLINE,PRCVDATA,PRCVERR) ; Get Item data to send to DynaMed
"RTN","PRCV442A",7,0)
 ;
"RTN","PRCV442A",8,0)
 ;   POIEN    = the ien of the purchase order
"RTN","PRCV442A",9,0)
 ;   PRCVLINE = the ien of the line item number in the purchase order
"RTN","PRCV442A",10,0)
 ;   PRCVDATA = information from the PO level to keep for reference
"RTN","PRCV442A",11,0)
 ;               2237 number ^ expected delivery date
"RTN","PRCV442A",12,0)
 ;   PRCVERR  = flag to indicate if the item is not qualified for 
"RTN","PRCV442A",13,0)
 ;              transmission to DynaMed as it has no DM DOC ID or an
"RTN","PRCV442A",14,0)
 ;              error occurred
"RTN","PRCV442A",15,0)
 ;
"RTN","PRCV442A",16,0)
 N PRCV,PRCVDD,PRCVL,PRCVI
"RTN","PRCV442A",17,0)
 S PRCVDD="",PRCVERR=0,PRCVI=PRCVLINE_","_POIEN_","
"RTN","PRCV442A",18,0)
 D GETS^DIQ(442.01,PRCVI,".01;1.5;2;3;3.1;2;5;10;48","IE","PRCVL")
"RTN","PRCV442A",19,0)
 I $D(^TMP("DIERR",$J)) S PRCVERR=3 Q  ; item not on file in PO
"RTN","PRCV442A",20,0)
 S $P(PRCV,"^",1)=PRCVL(442.01,PRCVI,48,"I") ; DM Doc ID (#48 N2P15)
"RTN","PRCV442A",21,0)
 I $P(PRCV,"^",1)']"" S PRCVERR=1 Q  ; this is not a DM item
"RTN","PRCV442A",22,0)
 S $P(PRCV,"^",2)=PRCVL(442.01,PRCVI,1.5,"I") ; Item IEN (#1.5 N0 P5))
"RTN","PRCV442A",23,0)
 S $P(PRCV,"^",8)=$$GET1^DIQ(441,(PRCVL(442.01,PRCVI,1.5,"I")),51) ; NIF
"RTN","PRCV442A",24,0)
 S $P(PRCV,"^",3)=PRCVL(442.01,PRCVI,.01,"E") ; line item# #.01 n0,p1
"RTN","PRCV442A",25,0)
 S $P(PRCV,"^",6)=PRCVL(442.01,PRCVI,2,"I") ; QTY ORDERED (#2 N0 P 2)
"RTN","PRCV442A",26,0)
 S $P(PRCV,"^",5)=PRCVL(442.01,PRCVI,3,"E") ; UOP (#3 N 0 P 3)
"RTN","PRCV442A",27,0)
 S $P(PRCV,"^",9)=PRCVL(442.01,PRCVI,"3.1","E") ; pkg multiple (#3.1 N0 P12)
"RTN","PRCV442A",28,0)
 S $P(PRCV,"^",7)=PRCVL(442.01,PRCVI,5,"I") ; unit price (#5 N0 P 9)
"RTN","PRCV442A",29,0)
 S $P(PRCV,"^",4)=PRCVL(442.01,PRCVI,10,"E") ; 2237 IEN (#10 N0 P10)
"RTN","PRCV442A",30,0)
 I $P(PRCV,"^",4)']"" S $P(PRCV,"^",4)=$P(PRCVDATA,"^",1)
"RTN","PRCV442A",31,0)
 D DD(POIEN,PRCVL(442.01,PRCVI,.01,"E"),.PRCVDD) ; delivery date
"RTN","PRCV442A",32,0)
 S $P(PRCV,"^",13)=PRCVDD I PRCVDD="" S $P(PRCV,"^",13)=$P(PRCVDATA,"^",2)
"RTN","PRCV442A",33,0)
 S ^TMP("PRCV442A",$J,POIEN,PRCVLINE)=PRCV
"RTN","PRCV442A",34,0)
 ; 
"RTN","PRCV442A",35,0)
 Q
"RTN","PRCV442A",36,0)
 ;
"RTN","PRCV442A",37,0)
DD(POIEN,PRCVLINE,PRCVDD) ; get the earliest delivery date for the item
"RTN","PRCV442A",38,0)
 ;
"RTN","PRCV442A",39,0)
 ;   POIEN    = the ien of the purchase order
"RTN","PRCV442A",40,0)
 ;   PRCVLINE = the ien of the line item number in the purchase order
"RTN","PRCV442A",41,0)
 ;   PRCVDD   = the purchase order's expected delivery date
"RTN","PRCV442A",42,0)
 ;
"RTN","PRCV442A",43,0)
 N PRCVDS,PRCVDZ
"RTN","PRCV442A",44,0)
 S PRCVDZ="",PRCVDS=0
"RTN","PRCV442A",45,0)
 F  S PRCVDS=$O(^PRC(442.8,"AC",POIEN,PRCVLINE,PRCVDS)) Q:+PRCVDS'>0!(PRCVDS']"")  D
"RTN","PRCV442A",46,0)
 . S PRCVDZ=$P($G(^PRC(442.8,PRCVDS,0)),"^",3) ; get date from delivery schedule for item
"RTN","PRCV442A",47,0)
 . I PRCVDZ<PRCVDD S PRCVDD=PRCVDZ
"RTN","PRCV442A",48,0)
 . I PRCVDD']"" S PRCVDD=PRCVDZ
"RTN","PRCV442A",49,0)
 . Q
"RTN","PRCV442A",50,0)
 Q
"RTN","PRCV442A",51,0)
 ;
"RTN","PRCV442A",52,0)
PO(POIEN,PRCVDATA,PRCVERR) ; get PO information, station, DUZ
"RTN","PRCV442A",53,0)
 ;
"RTN","PRCV442A",54,0)
 ;   POIEN     = the ien of the purchase order
"RTN","PRCV442A",55,0)
 ;   PRCVDATA  = information from the PO level to keep for reference
"RTN","PRCV442A",56,0)
 ;               2237 number ^ expected delivery date
"RTN","PRCV442A",57,0)
 ;   PRCVERR   = flag to indicate if the order is not a qualified DynaMed
"RTN","PRCV442A",58,0)
 ;               PO.  1 - indicates MOP is not suitable for a DM order
"RTN","PRCV442A",59,0)
 ;
"RTN","PRCV442A",60,0)
 N PRCV,PRCVV,PRCVP,PRCVPO
"RTN","PRCV442A",61,0)
 S PRCVERR=0,PRCVPO=POIEN_","
"RTN","PRCV442A",62,0)
 D GETS^DIQ(442,PRCVPO,".01;.02;.07;5;7;17;62","IE","PRCVP")
"RTN","PRCV442A",63,0)
 I $D(^TMP("DIERR",$J)) S PRCVERR=2 Q  ; PO not on file
"RTN","PRCV442A",64,0)
 I PRCVP(442,PRCVPO,.02,"I")'=1,PRCVP(442,PRCVPO,.02,"I")'=25 S PRCVERR=1 Q  ; MOP (#.02 - n0,p2)
"RTN","PRCV442A",65,0)
 S $P(PRCV,"^",1)=PRCVP(442,PRCVPO,.01,"E") ; PO# (#.01 n0,p1)
"RTN","PRCV442A",66,0)
 S $P(PRCV,"^",4)=PRCVP(442,PRCVPO,5,"I") ; vendor IEN (#5 n1 p1)
"RTN","PRCV442A",67,0)
 ; get FMS vendor ID & alt addr code from file 440, #34&#35 - n3 p4&5
"RTN","PRCV442A",68,0)
 D GETS^DIQ(440,PRCVP(442,PRCVPO,5,"I")_",","34:35","E","PRCVV")
"RTN","PRCV442A",69,0)
 I $D(^TMP("DIERR",$J)) G PO1 ; vendor info not on file
"RTN","PRCV442A",70,0)
 S $P(PRCV,"^",5)=PRCVV(440,PRCVP(442,PRCVPO,5,"I")_",",34,"E") ; FMS vendor ID
"RTN","PRCV442A",71,0)
 S $P(PRCV,"^",6)=PRCVV(440,PRCVP(442,PRCVPO,5,"I")_",",35,"E") ; FMA alt add ind
"RTN","PRCV442A",72,0)
PO1 S $P(PRCV,"^",7)=PRCVP(442,PRCVPO,17,"I") ; date signed (un-amended POs) n12 p3
"RTN","PRCV442A",73,0)
 S PRCVDATA=PRCVP(442,PRCVPO,62,"E") ; for PC orders MOP=25, 2237 is in #62 N23,P23
"RTN","PRCV442A",74,0)
 I PRCVDATA']"" S PRCVDATA=PRCVP(442,PRCVPO,.07,"E") ; for inv/rec MOP=1, 2237 is in #.07 - n0,p12
"RTN","PRCV442A",75,0)
 S $P(PRCVDATA,"^",2)=PRCVP(442,PRCVPO,7,"I") ; delivery date (#7 n0p10)
"RTN","PRCV442A",76,0)
 ;
"RTN","PRCV442A",77,0)
 ; get Station Number, DUZ
"RTN","PRCV442A",78,0)
 S $P(PRCV,"^",8)=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCV442A",79,0)
 S $P(PRCV,"^",3)=DUZ
"RTN","PRCV442A",80,0)
 ;
"RTN","PRCV442A",81,0)
 S ^TMP("PRCV442A",$J,POIEN)=PRCV
"RTN","PRCV442A",82,0)
 Q
"RTN","PRCV442A",83,0)
 ;
"RTN","PRCV442A",84,0)
RR(POIEN,PRCVLINE,PRCVRR,PRCVERR,ACTION) ; get receipt data for item
"RTN","PRCV442A",85,0)
 ;
"RTN","PRCV442A",86,0)
 ;   POIEN    = the ien of the purchase order
"RTN","PRCV442A",87,0)
 ;   PRCVLINE = the ien of the line item number in the purchase order
"RTN","PRCV442A",88,0)
 ;   PRCVRR   = the ien of the receiving report of interest
"RTN","PRCV442A",89,0)
 ;   PRCVERR  = flag to indicate if the order does not qualify for
"RTN","PRCV442A",90,0)
 ;              transmission to DynaMed or error occurred
"RTN","PRCV442A",91,0)
 ;   ACTION   = flag  1 - approved report ; 2- deleted report
"RTN","PRCV442A",92,0)
 ;
"RTN","PRCV442A",93,0)
 N PRCV,PRCVI,PRCVCR,PRCVDEL,PRCVR
"RTN","PRCV442A",94,0)
 S PRCVI=PRCVRR_","_PRCVLINE_","_POIEN_","
"RTN","PRCV442A",95,0)
 D GETS^DIQ(442.08,PRCVI,"1;2;3;4","I","PRCVR")
"RTN","PRCV442A",96,0)
 I $D(^TMP("DIERR",$J)) S PRCVERR=4 G RR2  ; RR not on file
"RTN","PRCV442A",97,0)
 S PRCVDEL="" I ACTION=2 S PRCVDEL="-"
"RTN","PRCV442A",98,0)
 S PRCV=$G(^TMP("PRCV442A",$J,POIEN,PRCVLINE))
"RTN","PRCV442A",99,0)
 S $P(PRCV,"^",10)=PRCVDEL_PRCVR(442.08,PRCVI,1,"I") ; qty received (#1, NO P2)
"RTN","PRCV442A",100,0)
 S $P(PRCV,"^",11)=PRCVDEL_PRCVR(442.08,PRCVI,2,"I") ; total item cost (#2 NO P3)
"RTN","PRCV442A",101,0)
 S $P(PRCV,"^",12)=PRCVDEL_PRCVR(442.08,PRCVI,4,"I") ; total discount for item(#4, N0 P5)
"RTN","PRCV442A",102,0)
 S ^TMP("PRCV442A",$J,POIEN,PRCVLINE)=PRCV
"RTN","PRCV442A",103,0)
RR2 S PRCVCR=$$GET1^DIQ(442.11,(PRCVRR_","_POIEN_","),10,"I") ; warehouse signed(#10, N0 P11)
"RTN","PRCV442A",104,0)
 I 'PRCVERR S $P(^TMP("PRCV442A",$J,POIEN),"^",7)=PRCVCR ; D/T warehouse signed
"RTN","PRCV442A",105,0)
 I ACTION=2 D RRAUD^PRCV442B(POIEN,PRCV,PRCVCR)
"RTN","PRCV442A",106,0)
 Q
"RTN","PRCV442A",107,0)
 ;
"RTN","PRCV442A",108,0)
UPD(POIEN) ; Update DynaMed of Approved POs with DynaMed items on them
"RTN","PRCV442A",109,0)
 ;
"RTN","PRCV442A",110,0)
 ; POIEN    The IEN of the Purchase Order
"RTN","PRCV442A",111,0)
 ;
"RTN","PRCV442A",112,0)
 N PRCVDATA,PRCVERR,PRCVLINE
"RTN","PRCV442A",113,0)
 S PRCVERR=0
"RTN","PRCV442A",114,0)
 K ^TMP("PRCV442A",$J)
"RTN","PRCV442A",115,0)
 D PO(POIEN,.PRCVDATA,.PRCVERR)
"RTN","PRCV442A",116,0)
 I PRCVERR=1 Q  ; not a DynaMed order
"RTN","PRCV442A",117,0)
 I PRCVERR>0 S PRCVERR=PRCVERR_"U" G TMPERR Q
"RTN","PRCV442A",118,0)
 S PRCVLINE=0
"RTN","PRCV442A",119,0)
 F  S PRCVLINE=$O(^PRC(442,POIEN,2,PRCVLINE)) Q:+PRCVLINE'>0!(PRCVLINE']"")  D
"RTN","PRCV442A",120,0)
 . D ITEM(POIEN,PRCVLINE,PRCVDATA,.PRCVERR)
"RTN","PRCV442A",121,0)
 . I PRCVERR=1 Q
"RTN","PRCV442A",122,0)
 . I PRCVERR>0 S PRCVERR=PRCVERR_"U" D TMPERR Q
"RTN","PRCV442A",123,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))]"" D
"RTN","PRCV442A",124,0)
 . S $P(^TMP("PRCV442A",$J,POIEN),"^",2)=1
"RTN","PRCV442A",125,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))']"" S PRCVERR=1 D Q Q  ; no item detail
"RTN","PRCV442A",126,0)
 D EN^PRCVPOSD(POIEN)
"RTN","PRCV442A",127,0)
 Q
"RTN","PRCV442A",128,0)
 ;
"RTN","PRCV442A",129,0)
DEL(POIEN) ; Update DynaMed of DynaMed items on a cancelled PC order
"RTN","PRCV442A",130,0)
 ;
"RTN","PRCV442A",131,0)
 ; POIEN    The IEN of the Purchase Order
"RTN","PRCV442A",132,0)
 ;
"RTN","PRCV442A",133,0)
 N PRCVDATA,PRCVDDAT,PRCVERR,PRCVLINE
"RTN","PRCV442A",134,0)
 S PRCVERR=0
"RTN","PRCV442A",135,0)
 K ^TMP("PRCV442A",$J)
"RTN","PRCV442A",136,0)
 D PO(POIEN,.PRCVDATA,.PRCVERR)
"RTN","PRCV442A",137,0)
 I PRCVERR=1 Q
"RTN","PRCV442A",138,0)
 I PRCVERR>0 S PRCVERR=PRCVERR_"D" G TMPERR Q
"RTN","PRCV442A",139,0)
 S PRCVDDAT=$$NOW^XLFDT
"RTN","PRCV442A",140,0)
 S $P(^TMP("PRCV442A",$J,POIEN),"^",7)=PRCVDDAT
"RTN","PRCV442A",141,0)
 S PRCVLINE=0
"RTN","PRCV442A",142,0)
 S $P(^TMP("PRCV442A",$J,POIEN),"^",2)=5
"RTN","PRCV442A",143,0)
 F  S PRCVLINE=$O(^PRC(442,POIEN,2,PRCVLINE)) Q:+PRCVLINE'>0!(PRCVLINE']"")  D
"RTN","PRCV442A",144,0)
 . D ITEM(POIEN,PRCVLINE,PRCVDATA,.PRCVERR)
"RTN","PRCV442A",145,0)
 . I PRCVERR=1 Q
"RTN","PRCV442A",146,0)
 . I PRCVERR>0 S PRCVERR=PRCVERR_"D" D TMPERR Q
"RTN","PRCV442A",147,0)
 . D DELAUD^PRCV442B($P(^TMP("PRCV442A",$J,POIEN,PRCVLINE),"^",1),PRCVDDAT,DUZ,POIEN,$P(^TMP("PRCV442A",$J,POIEN,PRCVLINE),"^",3),"") ; update DynaMed audit file
"RTN","PRCV442A",148,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))']"" S PRCVERR=1 D Q Q  ; no item detail
"RTN","PRCV442A",149,0)
 D EN^PRCVPOSD(POIEN)
"RTN","PRCV442A",150,0)
 Q
"RTN","PRCV442A",151,0)
 ;
"RTN","PRCV442A",152,0)
REC(POIEN,PARTIAL,ACTION) ; Update DynaMed of Receiving Report activity
"RTN","PRCV442A",153,0)
 ; 
"RTN","PRCV442A",154,0)
 ; POIEN    The IEN of the Purchase Order 
"RTN","PRCV442A",155,0)
 ; PARTIAL  The number of the Receiving Report
"RTN","PRCV442A",156,0)
 ; ACTION   1-signed ; 2-deleted
"RTN","PRCV442A",157,0)
 ;
"RTN","PRCV442A",158,0)
 N PRCVERR,PRCVLINE,PRCVRR,PRCVDATA
"RTN","PRCV442A",159,0)
 ; Find all the items in the RR, get the fields needed
"RTN","PRCV442A",160,0)
 K ^TMP("PRCV442A",$J)
"RTN","PRCV442A",161,0)
 S PRCVERR=0
"RTN","PRCV442A",162,0)
 D PO(POIEN,.PRCVDATA,.PRCVERR)
"RTN","PRCV442A",163,0)
 I PRCVERR=1 D Q Q  ; order has MOP not used for DynaMed items
"RTN","PRCV442A",164,0)
 I PRCVERR>0 S PRCVERR=PRCVERR_ACTION D TMPERR Q
"RTN","PRCV442A",165,0)
 S PRCVLINE=0
"RTN","PRCV442A",166,0)
 F  S PRCVLINE=$O(^PRC(442,POIEN,2,PRCVLINE)) Q:+PRCVLINE'>0!(PRCVLINE']"")  D
"RTN","PRCV442A",167,0)
 . S PRCVRR=0
"RTN","PRCV442A",168,0)
 . F  S PRCVRR=$O(^PRC(442,POIEN,2,PRCVLINE,3,PRCVRR)) Q:+PRCVRR'>0!(PRCVRR']"")  I $P(^PRC(442,POIEN,2,PRCVLINE,3,PRCVRR,0),"^",4)=PARTIAL D
"RTN","PRCV442A",169,0)
 . . D ITEM(POIEN,PRCVLINE,PRCVDATA,.PRCVERR)
"RTN","PRCV442A",170,0)
 . . I PRCVERR=1 Q  ; this is not a DM item
"RTN","PRCV442A",171,0)
 . . I PRCVERR>0 S PRCVERR=PRCVERR_ACTION D TMPERR Q
"RTN","PRCV442A",172,0)
 . . D RR(POIEN,PRCVLINE,PRCVRR,.PRCVERR,ACTION)
"RTN","PRCV442A",173,0)
 . . I PRCVERR>1 S PRCVERR=PRCVERR_ACTION D TMPERR ; sends blanks to DM?
"RTN","PRCV442A",174,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))]"" D
"RTN","PRCV442A",175,0)
 . S $P(^TMP("PRCV442A",$J,POIEN),"^",2)=$S(ACTION=2:4,1:3)
"RTN","PRCV442A",176,0)
 . D EN^PRCVPOSD(POIEN)
"RTN","PRCV442A",177,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))']"" S PRCVERR=1 D Q ; no item detail
"RTN","PRCV442A",178,0)
 Q
"RTN","PRCV442A",179,0)
 ;
"RTN","PRCV442A",180,0)
TMPERR ;
"RTN","PRCV442A",181,0)
 ; D TMPERR^PRCV442B
"RTN","PRCV442A",182,0)
 Q
"RTN","PRCV442A",183,0)
 ;
"RTN","PRCV442A",184,0)
Q I PRCVERR K ^TMP("PRCV442A",$J)
"RTN","PRCV442A",185,0)
 Q
"RTN","PRCV442B")
0^2^B43908570
"RTN","PRCV442B",1,0)
PRCV442B ;WOIFO/CC-GET DATA WHEN ITEM DELETED, SET UP AUDIT FILE;1/29/05
"RTN","PRCV442B",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCV442B",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCV442B",4,0)
 Q
"RTN","PRCV442B",5,0)
 ;
"RTN","PRCV442B",6,0)
RRAUD(POIEN,PRCV,PRCVCR) ; set deleted Receiving Report into audit file
"RTN","PRCV442B",7,0)
 ;
"RTN","PRCV442B",8,0)
 ;   POIEN  = the ien of the purchase order from which the receiving
"RTN","PRCV442B",9,0)
 ;            report is being deleted.
"RTN","PRCV442B",10,0)
 ;   PRCV   = the string of info about the item (from PRCV442A)
"RTN","PRCV442B",11,0)
 ;            DM DOC ID ^ Item ien ^ line item # ^ 2237 ien ^ UOP ^ 
"RTN","PRCV442B",12,0)
 ;            qty ordered ^ unit price ^ NIF ^ pkg mult ^ qty rec'd
"RTN","PRCV442B",13,0)
 ;            ^ total item cost ^ total discount ^ delivery date
"RTN","PRCV442B",14,0)
 ;   PRCVCR = the date/time the receiving report was created
"RTN","PRCV442B",15,0)
 ;
"RTN","PRCV442B",16,0)
 N PRCVDAT,PRCVRA,PRCVRN,PRCVIEN,PRCVY
"RTN","PRCV442B",17,0)
 S PRCVID=$P(PRCV,"^",1) Q:PRCVID']""  ; DM DOC ID
"RTN","PRCV442B",18,0)
 S PRCVDAT=$$NOW^XLFDT ; get date/time to use as deleted date/time
"RTN","PRCV442B",19,0)
 S PRCVRN=$O(^PRCV(414.02,"B",PRCVID,0)) ; find DM DOC ID record
"RTN","PRCV442B",20,0)
 I +PRCVRN'>0 D MAIL("X1",POIEN,PRCVID,$P(PRCV,"^",2)) Q  ; notify users that DM DOC ID record not in audit file
"RTN","PRCV442B",21,0)
 S PRCVIEN="+1,"_PRCVRN_","
"RTN","PRCV442B",22,0)
 S PRCVRA(414.021,PRCVIEN,.01)=PRCVDAT ; D/T RR deleted
"RTN","PRCV442B",23,0)
 S PRCVRA(414.021,PRCVIEN,1)=DUZ ; user deleting RR
"RTN","PRCV442B",24,0)
 S PRCVRA(414.021,PRCVIEN,2)=PRCVCR ; RR create D/T
"RTN","PRCV442B",25,0)
 S PRCVRA(414.021,PRCVIEN,3)=0-$P(PRCV,"^",10) ; Qty
"RTN","PRCV442B",26,0)
 S PRCVRA(414.021,PRCVIEN,4)=0-$P(PRCV,"^",11) ; total cost
"RTN","PRCV442B",27,0)
 S PRCVRA(414.021,PRCVIEN,5)=0-$P(PRCV,"^",12) ; discount
"RTN","PRCV442B",28,0)
 D UPDATE^DIE("","PRCVRA","PRCVY")
"RTN","PRCV442B",29,0)
 I $D(^TMP("DIERR",$J)) D MAIL("X5",POIEN,PRCVID,$P(PRCV,"^",2)) ; tell users that Audit file could not be updated
"RTN","PRCV442B",30,0)
 S $P(^TMP("PRCV442A",$J,POIEN),"^",7)=PRCVDAT
"RTN","PRCV442B",31,0)
 Q
"RTN","PRCV442B",32,0)
 ;
"RTN","PRCV442B",33,0)
DELAUD(PRCVID,PRCVDATE,PRCVDUZ,POIEN,PRCVITEM,PRCVIT) ; UPDATE AUDIT FILE FOR DELETED ITEMS
"RTN","PRCV442B",34,0)
 ;
"RTN","PRCV442B",35,0)
 ; PRCVID   = the DM Doc ID of the item being deleted
"RTN","PRCV442B",36,0)
 ; PRCVDATE = the date/time the item is deleted or PO is cancelled
"RTN","PRCV442B",37,0)
 ; PRCVDUZ  = the user deleting the item or canceling the PO
"RTN","PRCV442B",38,0)
 ; POIEN    = the ien of the purchase order from which the receiving
"RTN","PRCV442B",39,0)
 ;            report is being deleted.
"RTN","PRCV442B",40,0)
 ; PRCVITEM = the item number
"RTN","PRCV442B",41,0)
 ; PRCVIT   = set to 1 if deleted at line item level, else PC cancel
"RTN","PRCV442B",42,0)
 ;
"RTN","PRCV442B",43,0)
 N PRCVD,PRCVDA,PRCVIEN,PRCVY
"RTN","PRCV442B",44,0)
 S PRCVY="C" I PRCVIT=1 S PRCVY="D"
"RTN","PRCV442B",45,0)
 S PRCVDA=$O(^PRCV(414.02,"B",PRCVID,0)) ; find DM DOC ID record
"RTN","PRCV442B",46,0)
 I PRCVDA']"" D MAIL(PRCVY_1,POIEN,PRCVID,PRCVITEM) Q  ; DM DOC ID not in audit file
"RTN","PRCV442B",47,0)
 S PRCVD(414.02,PRCVDA_",",8)=PRCVDATE
"RTN","PRCV442B",48,0)
 S PRCVD(414.02,PRCVDA_",",9)=PRCVDUZ
"RTN","PRCV442B",49,0)
 D UPDATE^DIE("","PRCVD")
"RTN","PRCV442B",50,0)
 I $D(^TMP("DIERR",$J)) D MAIL(PRCVY_5,POIEN,PRCVID,PRCVITEM) ; tell user audit file not updated
"RTN","PRCV442B",51,0)
 Q
"RTN","PRCV442B",52,0)
 ;
"RTN","PRCV442B",53,0)
 ;
"RTN","PRCV442B",54,0)
DELITEM(POIEN) ; delete line item, get key info for DYNAMED
"RTN","PRCV442B",55,0)
 ; called from "AK" cross ref in DD - .01 of file 442.01 (Item multiple)
"RTN","PRCV442B",56,0)
 ;
"RTN","PRCV442B",57,0)
 ; POIEN = the ien of the purchase order (file 442)
"RTN","PRCV442B",58,0)
 ;
"RTN","PRCV442B",59,0)
 N PRCV,PRCVP
"RTN","PRCV442B",60,0)
 S PRCVP=""
"RTN","PRCV442B",61,0)
 D OP^XQCHK I $P(XQOPT,"^",1)="PRCHPC PO REMOVE 2237" Q  ; this option does not cancel item out of IFCAP
"RTN","PRCV442B",62,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 Q  ; DM interface not active
"RTN","PRCV442B",63,0)
 D GETS^DIQ(442,POIEN_",",".01;.02;.07;5;7;62","IE","PRCVP") ; get PO data
"RTN","PRCV442B",64,0)
 S $P(PRCV,"^",7)=POIEN,POIEN=POIEN_","
"RTN","PRCV442B",65,0)
 I $D(^TMP("DIERR",$J)) G DELITEM1 ; PO data not on file,send to DM anyway
"RTN","PRCV442B",66,0)
 S $P(PRCV,"^",8)=PRCVP(442,POIEN,.02,"I") ; MOP (#.02 - n0,p2)
"RTN","PRCV442B",67,0)
 S $P(PRCV,"^",1)=PRCVP(442,POIEN,.01,"E") ; PO# (#.01 n0,p1)
"RTN","PRCV442B",68,0)
 S $P(PRCV,"^",4)=PRCVP(442,POIEN,5,"I") ; vendor IEN (#5 n1 p1)
"RTN","PRCV442B",69,0)
 S $P(PRCV,"^",5)=PRCVP(442,POIEN,62,"E") ; for PC orders MOP=25, 2237 is in #62 N23,P23
"RTN","PRCV442B",70,0)
 S $P(PRCV,"^",6)=PRCVP(442,POIEN,.07,"E") ; for inv/rec MOP=1, 2237 is in #.07 - n0,p12
"RTN","PRCV442B",71,0)
 S $P(PRCV,"^",2)=PRCVP(442,POIEN,7,"I") ; delivery date (#7 n0p10)
"RTN","PRCV442B",72,0)
DELITEM1 S $P(PRCV,"^",10)=$$NOW^XLFDT
"RTN","PRCV442B",73,0)
 S $P(PRCV,"^",11)=DA
"RTN","PRCV442B",74,0)
 ;
"RTN","PRCV442B",75,0)
 ; get DUZ
"RTN","PRCV442B",76,0)
 S $P(PRCV,"^",3)=DUZ
"RTN","PRCV442B",77,0)
 ;
"RTN","PRCV442B",78,0)
 ; X1 is the array of variables set in the execution of the 'AK' cross reference
"RTN","PRCV442B",79,0)
 S X1(999999)=PRCV ; save PO data to variables passed to background job
"RTN","PRCV442B",80,0)
 ;
"RTN","PRCV442B",81,0)
 D OPKG^XUHUI("","PRCV 442 ITEM DELETE","K","AK") ; invoke background job
"RTN","PRCV442B",82,0)
 K X1(999999) ; not to go back DD
"RTN","PRCV442B",83,0)
 Q
"RTN","PRCV442B",84,0)
 ;
"RTN","PRCV442B",85,0)
DELJOB ; send deleted item's info to DynaMed (collected by DELITEM subroutine)
"RTN","PRCV442B",86,0)
 ; called from protocol PRCV 442 ITEM DELETE and jobbed by TaskMan
"RTN","PRCV442B",87,0)
 ; builds
"RTN","PRCV442B",88,0)
 ; PRCVI (string for each item)  
"RTN","PRCV442B",89,0)
 ;   DM DOC ID ^ Item ien ^ line item # ^ 2237 ien ^ UOP ^ qty ordered
"RTN","PRCV442B",90,0)
 ;   ^ unit price ^ NIF ^ pkg mult ^ qty rec'd ^ total item cost ^
"RTN","PRCV442B",91,0)
 ;   total discount ^ delivery date
"RTN","PRCV442B",92,0)
 ; PRCV (header) variable -
"RTN","PRCV442B",93,0)
 ;   PO# ^ txn type ^ DUZ ^ vendor IEN ^ FMS vendor # ^Alt add ind ^
"RTN","PRCV442B",94,0)
 ;   txn D/T ^ Station# ^ Purchasing Station
"RTN","PRCV442B",95,0)
 ;
"RTN","PRCV442B",96,0)
 N POIEN,PRCV,PRCVERR,PRCVI,PRCVP,PRCVV,PRCV2237
"RTN","PRCV442B",97,0)
 ; QUIT IF mop'1 AND '=25
"RTN","PRCV442B",98,0)
 S PRCVP=XUHUIX1(999999) I $P(PRCVP,"^",8)'=1,$P(PRCVP,"^",8)'=25 Q
"RTN","PRCV442B",99,0)
 S POIEN=$P(PRCVP,"^",7)
"RTN","PRCV442B",100,0)
 K ^TMP("PRCV442A",$J,POIEN)
"RTN","PRCV442B",101,0)
 S PRCV=$P(PRCVP,"^",1,4),$P(PRCV,"^",7)=$P(PRCVP,"^",10)
"RTN","PRCV442B",102,0)
 ; get FMS vendor ID & alt addr code from file 440, #34&#35 - n3 p4&5
"RTN","PRCV442B",103,0)
 I $P(PRCV,"^",4)]"" D GETS^DIQ(440,$P(PRCV,"^",4)_",","34:35","E","PRCVV")
"RTN","PRCV442B",104,0)
 I $D(^TMP("DIERR",$J)) G DELJOB1 ; vendor data not on file
"RTN","PRCV442B",105,0)
 S $P(PRCV,"^",2)=5 ; DELETE
"RTN","PRCV442B",106,0)
 S $P(PRCV,"^",5)=PRCVV(440,$P(PRCV,"^",4)_",",34,"E") ; FMS vendor ID
"RTN","PRCV442B",107,0)
 S $P(PRCV,"^",6)=PRCVV(440,$P(PRCV,"^",4)_",",35,"E") ; FMA alt add ind
"RTN","PRCV442B",108,0)
 ; get Station Number
"RTN","PRCV442B",109,0)
DELJOB1 S $P(PRCV,"^",8)=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCV442B",110,0)
 S ^TMP("PRCV442A",$J,POIEN)=PRCV
"RTN","PRCV442B",111,0)
 S PRCVI=XUHUIX1(2)_"^"_XUHUIX1(3)_"^"_XUHUIX1(1)_"^^^"_XUHUIX1(4)_"^"_XUHUIX1(7)_"^^"_XUHUIX1(6)
"RTN","PRCV442B",112,0)
 S $P(PRCVI,"^",5)=$$GET1^DIQ(420.5,XUHUIX1(5),.01,"E") ; UOP
"RTN","PRCV442B",113,0)
 S $P(PRCVI,"^",8)=$$GET1^DIQ(441,XUHUIX1(3),51) ; NIF
"RTN","PRCV442B",114,0)
 S $P(PRCVI,"^",13)=$P(PRCVP,"^",2) ; DELIVERY DATE FOR PO
"RTN","PRCV442B",115,0)
 S PRCV2237=XUHUIX1(8)
"RTN","PRCV442B",116,0)
 I PRCV2237]"" S PRCV2237=$$GET1^DIQ(410,PRCV2237,.01,"E")
"RTN","PRCV442B",117,0)
 I PRCV2237']"" S PRCV2237=$P(PRCVP,"^",6)
"RTN","PRCV442B",118,0)
 I PRCV2237']"" S PRCV2237=$P(PRCVP,"^",5)
"RTN","PRCV442B",119,0)
 S $P(PRCVI,"^",4)=PRCV2237
"RTN","PRCV442B",120,0)
 D DELAUD($P(PRCVI,"^",1),$P(PRCV,"^",7),$P(PRCV,"^",3),POIEN,$P(PRCVI,"^",2),1)
"RTN","PRCV442B",121,0)
 S ^TMP("PRCV442A",$J,POIEN,$P(PRCVP,"^",11))=PRCVI
"RTN","PRCV442B",122,0)
 I $O(^TMP("PRCV442A",$J,POIEN,""))']"" S PRCVERR=1 D Q  Q  ; no DynaMed items
"RTN","PRCV442B",123,0)
 D EN^PRCVPOSD(POIEN)
"RTN","PRCV442B",124,0)
 Q
"RTN","PRCV442B",125,0)
 ;
"RTN","PRCV442B",126,0)
MAIL(PRCVCODE,PRCVPIEN,PRCVID,PRCVITEM) ; PREPARE VALUES FOR MESSAGE TO USERS
"RTN","PRCV442B",127,0)
 ;
"RTN","PRCV442B",128,0)
 ; $E(PRCVCODE,1) = U if the error occurred approving a PO
"RTN","PRCV442B",129,0)
 ;                = C if the error occurred canceling a PO
"RTN","PRCV442B",130,0)
 ;                = D if error occurred while deleting a line item
"RTN","PRCV442B",131,0)
 ;                = R if the error occurred signing a Receipt Report
"RTN","PRCV442B",132,0)
 ;                = X if the error occurred deleting a Receipt Report
"RTN","PRCV442B",133,0)
 ; $E(PRCVCODE,2) = DM Doc ID not in Audit File
"RTN","PRCV442B",134,0)
 ;                = 2 if the PO data could not be found
"RTN","PRCV442B",135,0)
 ;                = 3 if the item data could not be found
"RTN","PRCV442B",136,0)
 ;                = 4 if the receiving report info for item was not found
"RTN","PRCV442B",137,0)
 ;                = 5 if data could not be saved in audit file
"RTN","PRCV442B",138,0)
 ;
"RTN","PRCV442B",139,0)
 ; PRCVPIEN       IEN of selected purchase order
"RTN","PRCV442B",140,0)
 ; PRCVID         DM Doc ID of affected item
"RTN","PRCV442B",141,0)
 ; PRCVITEM       ien of item (item#)
"RTN","PRCV442B",142,0)
 ;
"RTN","PRCV442B",143,0)
 N PRCVSITE,PRCVFCP,PRCVPO,XMB
"RTN","PRCV442B",144,0)
 K ^TMP($J,"PRCV442B")
"RTN","PRCV442B",145,0)
 S XMB(1)=$S($E(PRCVCODE,1)="C":"cancelling a PC order",$E(PRCVCODE,1)="D":"deleting a line item from a purchase order",1:"deleting a receiving report")
"RTN","PRCV442B",146,0)
 S XMB(2)=PRCVID
"RTN","PRCV442B",147,0)
 S XMB(3)=" "_PRCVID_" is not in file 414.02 - can't add related data"
"RTN","PRCV442B",148,0)
 I $E(PRCVCODE,2)=5 D
"RTN","PRCV442B",149,0)
 . S XMB(3)="System can't update Audit File (414.02) for "_PRCVID
"RTN","PRCV442B",150,0)
 . D TMPERR
"RTN","PRCV442B",151,0)
 S PRCVPO=$P($G(^PRC(442,PRCVPIEN,0)),"^",1)
"RTN","PRCV442B",152,0)
 S ^TMP($J,"PRCV442B",1)="Purchase Order# "_PRCVPO
"RTN","PRCV442B",153,0)
 S ^TMP($J,"PRCV442B",2)="ITEM# "_PRCVITEM
"RTN","PRCV442B",154,0)
 S ^TMP($J,"PRCV442B")=2
"RTN","PRCV442B",155,0)
 S PRCVSITE=PRCVPO+0 I PRCVSITE=0 S PRCVSITE=PRC("SITE")
"RTN","PRCV442B",156,0)
 S PRCVFCP=$P($G(^PRC(442,PRCVPIEN,0)),"^",3)
"RTN","PRCV442B",157,0)
 S PRCVFCP=$P(PRCVFCP," ",1)
"RTN","PRCV442B",158,0)
 D DMERXMB^PRCVLIC("PRCV442B",PRCVSITE,PRCVFCP)
"RTN","PRCV442B",159,0)
 K ^TMP($J,"PRCV442B")
"RTN","PRCV442B",160,0)
 Q
"RTN","PRCV442B",161,0)
 ;
"RTN","PRCV442B",162,0)
TMPERR ;
"RTN","PRCV442B",163,0)
 ;
"RTN","PRCV442B",164,0)
 ;
"RTN","PRCV442B",165,0)
 N PRCJ,PRCK S PRCK=$G(^TMP($J,"PRCV442B")),PRCJ=0
"RTN","PRCV442B",166,0)
 F  S PRCJ=$O(^TMP("DIERR",$J,PRCJ)) Q:PRCJ'?1.N  D
"RTN","PRCV442B",167,0)
 . I $D(^TMP("DIERR",$J,PRCJ,"TEXT",1)) D
"RTN","PRCV442B",168,0)
 . . S PRCK=PRCK+1,^TMP($J,"PRCV442B",PRCK)="Reason: "_^TMP("DIERR",$J,PRCJ,"TEXT",1)
"RTN","PRCV442B",169,0)
 . . S:$D(^TMP("DIERR",$J,PRCJ,"PARAM","IENS")) ^TMP($J,"PRCV442B",PRCK)=$E(^TMP($J,"PRCV442B",PRCK),1,220)_"-IENS: "_^TMP("DIERR",$J,PRCJ,"PARAM","IENS")
"RTN","PRCV442B",170,0)
 S:PRCK>0 ^TMP($J,"PRCV442B")=PRCK
"RTN","PRCV442B",171,0)
 K ^TMP("DIERR",$J)
"RTN","PRCV442B",172,0)
 Q
"RTN","PRCV442B",173,0)
 ;
"RTN","PRCV442B",174,0)
FCP(PRCVPO) ; return FCP for PO#
"RTN","PRCV442B",175,0)
 ;
"RTN","PRCV442B",176,0)
 ;    PRCVPO = the external purchase order number
"RTN","PRCV442B",177,0)
 ;    returns -1 if the PO or its FCP cannot be found
"RTN","PRCV442B",178,0)
 ;
"RTN","PRCV442B",179,0)
 N PRCVF,PRCVI
"RTN","PRCV442B",180,0)
 S PRCVF=-1
"RTN","PRCV442B",181,0)
 S PRCVI=$O(^PRC(442,"B",PRCVPO,0))
"RTN","PRCV442B",182,0)
 I PRCVI]"" D
"RTN","PRCV442B",183,0)
 . S PRCVI=$$GET1^DIQ(442,PRCVI_",",1,"E")
"RTN","PRCV442B",184,0)
 . I PRCVI]"" S PRCVF=$P(PRCVI," ",1)
"RTN","PRCV442B",185,0)
 Q PRCVF
"RTN","PRCV442B",186,0)
 ;
"RTN","PRCV442B",187,0)
Q I PRCVERR K ^TMP("PRCV442A",$J)
"RTN","PRCV442B",188,0)
 Q
"RTN","PRCVBLD")
0^60^B8594669
"RTN","PRCVBLD",1,0)
PRCVBLD ;ISC-SF/GJW - Build fund balance notifications ; 6/6/05 1:12pm
"RTN","PRCVBLD",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVBLD",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVBLD",4,0)
 ;
"RTN","PRCVBLD",5,0)
EN ;
"RTN","PRCVBLD",6,0)
 ;
"RTN","PRCVBLD",7,0)
 ;=============================================================
"RTN","PRCVBLD",8,0)
 ;Format of input array (passed by name):
"RTN","PRCVBLD",9,0)
 ;
"RTN","PRCVBLD",10,0)
 ;array("1QBAL") = 1st quarter uncommited balance
"RTN","PRCVBLD",11,0)
 ;array("2QBAL") = 2nd quarter uncommited balance
"RTN","PRCVBLD",12,0)
 ;array("3QBAL") = 3rd quarter uncommited balance
"RTN","PRCVBLD",13,0)
 ;array("4QBAL") = 4th quarter uncommited balance
"RTN","PRCVBLD",14,0)
 ;array("FY") = fiscal year (2 or 4 digits)
"RTN","PRCVBLD",15,0)
 ;array("TIME") = time of transaction (FM format)
"RTN","PRCVBLD",16,0)
 ;array("FCP_NUM") = FCP number (only)
"RTN","PRCVBLD",17,0)
 ;array("STAT") = station number
"RTN","PRCVBLD",18,0)
 ;=============================================================
"RTN","PRCVBLD",19,0)
 ;
"RTN","PRCVBLD",20,0)
BLD1(PRCVOBJ) ;simple build (fund balance notification)
"RTN","PRCVBLD",21,0)
 N PRCVMSG,PROTOCOL,SEG,I,NOW,FCPEXT,ANIENS
"RTN","PRCVBLD",22,0)
 N PRCVFS,PRCVCS,PRCVRS,PRCVES,PRCVSS
"RTN","PRCVBLD",23,0)
 N $ES,$ET S $ET="ETRAP^PRCVBLD"
"RTN","PRCVBLD",24,0)
 S PRCVMSG=$NA(^TMP("HLS",$J)) ;accumulate message here
"RTN","PRCVBLD",25,0)
 S PROTOCOL="PRCV_DYNAMED_22_EV_FUND_BAL_DATA"
"RTN","PRCVBLD",26,0)
 D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","PRCVBLD",27,0)
 I $G(HL) D  Q  ; error occurred
"RTN","PRCVBLD",28,0)
 .; put error handler here for init failure
"RTN","PRCVBLD",29,0)
 .S PRCVERR=$P(HL,2)
"RTN","PRCVBLD",30,0)
 .S $EC=",U1_HL7_SYSTEM_ERROR,"
"RTN","PRCVBLD",31,0)
 S PRCVFS=$G(HL("FS")) ;field separator
"RTN","PRCVBLD",32,0)
 S PRCVCS=$E(HL("ECH"),1) ;component separator
"RTN","PRCVBLD",33,0)
 S PRCVRS=$E(HL("ECH"),2) ;repetition separator
"RTN","PRCVBLD",34,0)
 S PRCVES=$E(HL("ECH"),3) ;encoding character
"RTN","PRCVBLD",35,0)
 S PRCVSS=$E(HL("ECH"),4) ;subcomponent separator
"RTN","PRCVBLD",36,0)
 S ANIENS=$G(@PRCVOBJ@("FCP_NUM"))_","_$G(@PRCVOBJ@("STAT"))_","
"RTN","PRCVBLD",37,0)
 S FCPEXT=$P($$GET1^DIQ(420.01,ANIENS,.01)," ",1)
"RTN","PRCVBLD",38,0)
 ;MFI segment
"RTN","PRCVBLD",39,0)
 S SEG="MFI"_PRCVFS_"420"_PRCVCS_"CP"_PRCVFS_PRCVFS_"UPD"_PRCVFS
"RTN","PRCVBLD",40,0)
 S SEG=SEG_$$FMTHL7^XLFDT($$NOW^XLFDT)_PRCVFS_PRCVFS_"AL"
"RTN","PRCVBLD",41,0)
 S @PRCVMSG@(1)=SEG
"RTN","PRCVBLD",42,0)
 ;MFE segment
"RTN","PRCVBLD",43,0)
 S SEG="MFE"_PRCVFS_"MUP"_PRCVFS_PRCVFS_PRCVFS
"RTN","PRCVBLD",44,0)
 S SEG=SEG_FCPEXT_PRCVFS_"CE"
"RTN","PRCVBLD",45,0)
 S @PRCVMSG@(2)=SEG
"RTN","PRCVBLD",46,0)
 ;FT1 segment
"RTN","PRCVBLD",47,0)
 S SEG="FT1"_PRCVFS_PRCVFS_PRCVFS_$$YEAR($G(@PRCVOBJ@("FY")))
"RTN","PRCVBLD",48,0)
 S SEG=SEG_PRCVFS_$$FMTHL7^XLFDT($G(@PRCVOBJ@("TIME")))
"RTN","PRCVBLD",49,0)
 S SEG=SEG_PRCVFS_PRCVFS_"BAL"_PRCVFS_"AVAIL_BAL"
"RTN","PRCVBLD",50,0)
 S SEG=SEG_PRCVFS_PRCVFS_PRCVFS_PRCVFS
"RTN","PRCVBLD",51,0)
 S SEG=SEG_+$G(@PRCVOBJ@("1QBAL"))_PRCVSS_"USD"_PRCVRS
"RTN","PRCVBLD",52,0)
 S SEG=SEG_+$G(@PRCVOBJ@("2QBAL"))_PRCVSS_"USD"_PRCVRS
"RTN","PRCVBLD",53,0)
 S SEG=SEG_+$G(@PRCVOBJ@("3QBAL"))_PRCVSS_"USD"_PRCVRS
"RTN","PRCVBLD",54,0)
 S SEG=SEG_+$G(@PRCVOBJ@("4QBAL"))_PRCVSS_"USD"_PRCVFS
"RTN","PRCVBLD",55,0)
 ;Assorted HL7 noise (not directly used by this interface)
"RTN","PRCVBLD",56,0)
 S NOW=$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","PRCVBLD",57,0)
 F I=1:1:8 S SEG=SEG_PRCVFS
"RTN","PRCVBLD",58,0)
 F I=1:1:16 S SEG=SEG_PRCVCS
"RTN","PRCVBLD",59,0)
 S SEG=SEG_NOW_PRCVSS_NOW
"RTN","PRCVBLD",60,0)
 S SEG=SEG_PRCVFS
"RTN","PRCVBLD",61,0)
 F I=1:1:16 S SEG=SEG_PRCVCS
"RTN","PRCVBLD",62,0)
 S SEG=SEG_NOW_PRCVSS_NOW
"RTN","PRCVBLD",63,0)
 F I=1:1:3 S SEG=SEG_PRCVFS
"RTN","PRCVBLD",64,0)
 F I=1:1:16 S SEG=SEG_PRCVCS
"RTN","PRCVBLD",65,0)
 S SEG=SEG_NOW_PRCVSS_NOW
"RTN","PRCVBLD",66,0)
 S @PRCVMSG@(3)=SEG
"RTN","PRCVBLD",67,0)
 Q
"RTN","PRCVBLD",68,0)
 ;
"RTN","PRCVBLD",69,0)
YEAR(PRCVY) ;Expand a (possibly) 2-digit year
"RTN","PRCVBLD",70,0)
 I PRCVY'?2N Q PRCVY
"RTN","PRCVBLD",71,0)
 Q $S(PRCVY>90:"19"_PRCVY,1:"20"_PRCVY)
"RTN","PRCVBLD",72,0)
 ;
"RTN","PRCVBLD",73,0)
 ;
"RTN","PRCVBLD",74,0)
ETRAP ;
"RTN","PRCVBLD",75,0)
 D ^%ZTER
"RTN","PRCVBLD",76,0)
 K PRCVERR ;We want this variable in the error trap
"RTN","PRCVBLD",77,0)
 D UNWIND^%ZTER
"RTN","PRCVBLD",78,0)
 Q
"RTN","PRCVEE1")
0^3^B20166309
"RTN","PRCVEE1",1,0)
PRCVEE1 ;WOIFO/VAC-EDIT/CANCELLATION FOR RIL/2237 FROM IFCAP TO DYNAMED ; 5/4/05 10:41am
"RTN","PRCVEE1",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVEE1",3,0)
 ;PER VHA Directive 10-93-142, this routine should not be modified
"RTN","PRCVEE1",4,0)
 ;
"RTN","PRCVEE1",5,0)
 ;This routine will pass changes, cancellations and approvals from
"RTN","PRCVEE1",6,0)
 ;IFCAP to DynaMed because of changes in RIL's or 2237's
"RTN","PRCVEE1",7,0)
BEGIN(REF,PRCVDT) ;
"RTN","PRCVEE1",8,0)
 ; REF is passed in as node for ^XTMP(REF)
"RTN","PRCVEE1",9,0)
 ; PRCVDT is passed in as node for ^XTMP(REF,PRCVDT)
"RTN","PRCVEE1",10,0)
 ;  Note: PRCVDT is really two data elements $H and comma delimited
"RTN","PRCVEE1",11,0)
 ; There are two XTMP structures for this process.  The first is
"RTN","PRCVEE1",12,0)
 ;  for the original message sent from IFCAP. The first node is 
"RTN","PRCVEE1",13,0)
 ;  "PRCVUP*"+the RIL or 2237 number. The second node is $H. The third
"RTN","PRCVEE1",14,0)
 ;  node is either 0,1 or 2.  Zero is the standard ^XTMP structure
"RTN","PRCVEE1",15,0)
 ;  plus $H. The 1 node contains header information common to all
"RTN","PRCVEE1",16,0)
 ;  items.  The 2 node contains detail information to be sent.
"RTN","PRCVEE1",17,0)
 ;  Subordinate to the 2 node is a counter node unique for each item.
"RTN","PRCVEE1",18,0)
 ;  Under the 1 and 2 nodes, will reside an "ERR" node with
"RTN","PRCVEE1",19,0)
 ;  subordinate counters for multiple errors per item.  The second
"RTN","PRCVEE1",20,0)
 ;  ^XTMP is a pointer to the PRCVUP*xxx node.  The first node is 
"RTN","PRCVEE1",21,0)
 ;  "PRCVMID*"+the Message Control ID for the original message.
"RTN","PRCVEE1",22,0)
 ;  The 1 node contains the PRCVUP*+xxx and $H to point back to the
"RTN","PRCVEE1",23,0)
 ;  original XTMP("PRCVUP*"+RIL/2237)
"RTN","PRCVEE1",24,0)
 ; PRCPRO - Procedure call ID
"RTN","PRCVEE1",25,0)
 ; PRCERR - Error array for processing message errors
"RTN","PRCVEE1",26,0)
 ; PRCFS - Field separator
"RTN","PRCVEE1",27,0)
 ; PRCCS - Component separator
"RTN","PRCVEE1",28,0)
 ; PRCRS - Repetition separator
"RTN","PRCVEE1",29,0)
 ; PRCEE - Escape separator
"RTN","PRCVEE1",30,0)
 ; PRCSC - Sub-component separator
"RTN","PRCVEE1",31,0)
 ; PRCMID - Message Control ID for sent message
"RTN","PRCVEE1",32,0)
 ; ORCDAT - a single field that holds an ORC Segment
"RTN","PRCVEE1",33,0)
 ; RQD - an array of fields for the RQD segment
"RTN","PRCVEE1",34,0)
 ; RQ1 - an array of fields for the RQ1 segment
"RTN","PRCVEE1",35,0)
 ; ORC - an array of fields for the ORC segment
"RTN","PRCVEE1",36,0)
 ; PRCCNT - a record counter
"RTN","PRCVEE1",37,0)
 ; PRCVY - Loop counter
"RTN","PRCVEE1",38,0)
 N PRCPRO,PRCERR,PRCFS,PRCCS,PRCRS,PRCEE,PRCSC,PRCDP
"RTN","PRCVEE1",39,0)
 N ORCDAT,I,J,K,Y,X,X1,X2,XX,RQD,ORC,PRCCNT,RQ1
"RTN","PRCVEE1",40,0)
 N ODATE,PRCDTS,PRCDT,PRCMID,PRCVMID,DETAIL,HLA,HL,ERRCNT
"RTN","PRCVEE1",41,0)
 N PRCVERR,PRCVY,PRCDATA,PRCSITE,PRCFCP
"RTN","PRCVEE1",42,0)
 S PRCDATA=$P(REF,"*",2)
"RTN","PRCVEE1",43,0)
 S PRCSITE=$P(PRCDATA,"-",1),PRCFCP=$P(PRCDATA,"-",4)
"RTN","PRCVEE1",44,0)
 S PRCERR="OK"
"RTN","PRCVEE1",45,0)
 I REF="" Q
"RTN","PRCVEE1",46,0)
 S PRCDTS=$$NOW^XLFDT
"RTN","PRCVEE1",47,0)
 S PRCDT=$$FMTHL7^XLFDT(PRCDTS),ERRCNT=1
"RTN","PRCVEE1",48,0)
 D BUILD
"RTN","PRCVEE1",49,0)
 D SEND
"RTN","PRCVEE1",50,0)
 D CLEAN
"RTN","PRCVEE1",51,0)
 Q
"RTN","PRCVEE1",52,0)
BUILD ;Create the ORC record for the message
"RTN","PRCVEE1",53,0)
 S PRCCNT=1
"RTN","PRCVEE1",54,0)
 S PRCPRO="PRCV_IFCAP_01_EV_DYNAMED_UPDATE"
"RTN","PRCVEE1",55,0)
 K HL D INIT^HLFNC2(PRCPRO,.HL)
"RTN","PRCVEE1",56,0)
 I $G(HL) S PRCVERR(ERRCNT)="Error Generating Message to DynaMed" D MSGRTN Q
"RTN","PRCVEE1",57,0)
 S PRCFS=HL("FS"),PRCCS=$E(HL("ECH"),1),PRCRS=$E(HL("ECH"),2),PRCEE=$E(HL("ECH"),3),PRCSC=$E(HL("ECH"),4)
"RTN","PRCVEE1",58,0)
 ;
"RTN","PRCVEE1",59,0)
ORC ;Build ORC Segment
"RTN","PRCVEE1",60,0)
 S ORCDAT=$G(^XTMP(REF,PRCVDT,1))
"RTN","PRCVEE1",61,0)
 Q:ORCDAT=""
"RTN","PRCVEE1",62,0)
 F I=1:1:21 S ORC(I)=""
"RTN","PRCVEE1",63,0)
 ;Convert a $H node value to a HL7 date format
"RTN","PRCVEE1",64,0)
 S ODATE=$$HTFM^XLFDT(PRCVDT) S ORC(9)=$$FMTHL7^XLFDT(ODATE)
"RTN","PRCVEE1",65,0)
 S ORC(21)=$P(ORCDAT,U,2)
"RTN","PRCVEE1",66,0)
 S ORC(10)=$P(ORCDAT,U,3)_PRCCS_$P(ORCDAT,U,4)_PRCCS_$P(ORCDAT,U,5)
"RTN","PRCVEE1",67,0)
 S $P(ORC(10),PRCCS,9)=ORC(21)
"RTN","PRCVEE1",68,0)
 ;S HLA("HLS",PRCCNT)="ORC"_PRCFS
"RTN","PRCVEE1",69,0)
 ;
"RTN","PRCVEE1",70,0)
RQD ;Build RQD segment
"RTN","PRCVEE1",71,0)
 S PRCVY=0 F K=1:1 S PRCVY=$O(^XTMP(REF,PRCVDT,2,PRCVY)) Q:PRCVY=""  D
"RTN","PRCVEE1",72,0)
 .S DETAIL=$G(^XTMP(REF,PRCVDT,2,PRCVY))
"RTN","PRCVEE1",73,0)
 .Q:DETAIL=""
"RTN","PRCVEE1",74,0)
 .S ORC(1)=$P(DETAIL,PRCCS,1)
"RTN","PRCVEE1",75,0)
 .S HLA("HLS",PRCCNT)="ORC"_PRCFS
"RTN","PRCVEE1",76,0)
 .F I=1:1:10 S RQD(I)=""
"RTN","PRCVEE1",77,0)
 .F I=1:1:20 S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_ORC(I)_PRCFS
"RTN","PRCVEE1",78,0)
 .S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_ORC(21)
"RTN","PRCVEE1",79,0)
 .S PRCCNT=PRCCNT+1
"RTN","PRCVEE1",80,0)
 .S HLA("HLS",PRCCNT)="RQD"_PRCFS
"RTN","PRCVEE1",81,0)
 .S RQD(1)=PRCVY
"RTN","PRCVEE1",82,0)
 .S RQD(2)=$P(DETAIL,U,7)
"RTN","PRCVEE1",83,0)
 .S RQD(3)=$P(DETAIL,U,2)
"RTN","PRCVEE1",84,0)
 .S RQD(4)=$P(DETAIL,U,11)
"RTN","PRCVEE1",85,0)
 .S RQD(5)=$P(DETAIL,U,3)
"RTN","PRCVEE1",86,0)
 .S RQD(6)=$P(DETAIL,U,9)
"RTN","PRCVEE1",87,0)
 .S RQD(9)=$P(REF,"*",2)
"RTN","PRCVEE1",88,0)
 .S RQD(10)=$P(DETAIL,U,8)
"RTN","PRCVEE1",89,0)
 .S RQD(10)=$$FMTHL7^XLFDT(RQD(10))
"RTN","PRCVEE1",90,0)
 .F J=1:1:9 S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_RQD(J)_PRCFS
"RTN","PRCVEE1",91,0)
 .S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_RQD(10)
"RTN","PRCVEE1",92,0)
 .S PRCCNT=PRCCNT+1
"RTN","PRCVEE1",93,0)
 .;Build RQ1 segment
"RTN","PRCVEE1",94,0)
 .F I=1:1:5 S RQ1(I)=""
"RTN","PRCVEE1",95,0)
 .S HLA("HLS",PRCCNT)="RQ1"_PRCFS
"RTN","PRCVEE1",96,0)
 .S RQ1(1)=$P(DETAIL,U,6)
"RTN","PRCVEE1",97,0)
 .S RQ1(2)=$P(DETAIL,U,10)
"RTN","PRCVEE1",98,0)
 .S RQ1(3)=$P(DETAIL,U,12)
"RTN","PRCVEE1",99,0)
 .S RQ1(4)=$P(DETAIL,U,4)_PRCCS_PRCCS_PRCCS_$P(DETAIL,U,5)
"RTN","PRCVEE1",100,0)
 .S RQ1(5)=$P(DETAIL,U,15)
"RTN","PRCVEE1",101,0)
 .F J=1:1:4 S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_RQ1(J)_PRCFS
"RTN","PRCVEE1",102,0)
 .S HLA("HLS",PRCCNT)=HLA("HLS",PRCCNT)_RQ1(5)
"RTN","PRCVEE1",103,0)
 .S PRCCNT=PRCCNT+1
"RTN","PRCVEE1",104,0)
 Q
"RTN","PRCVEE1",105,0)
SEND ;Send record to HL7 interface to DynaMed
"RTN","PRCVEE1",106,0)
 S PRCDP="" D GENERATE^HLMA(PRCPRO,"LM",1,.PRCDP)
"RTN","PRCVEE1",107,0)
 I $P(PRCDP,PRCCS,2)'="" S PRCVERR(ERRCNT)="Generated "_$P(PRCDP,U,3)  D MSGRTN
"RTN","PRCVEE1",108,0)
 ;
"RTN","PRCVEE1",109,0)
 ;Get the Message Control ID
"RTN","PRCVEE1",110,0)
 S PRCMID=$P(PRCDP,U,1)
"RTN","PRCVEE1",111,0)
 S XX=$$HTFM^XLFDT($H,1)
"RTN","PRCVEE1",112,0)
 S X1=$$FMADD^XLFDT(XX,5)
"RTN","PRCVEE1",113,0)
 S PRCVMID="PRCVMID*"_PRCMID
"RTN","PRCVEE1",114,0)
 S ^XTMP(PRCVMID,0)=X1_U_XX_"^ACK 2237/RIL message from DynaMed"
"RTN","PRCVEE1",115,0)
 S ^XTMP(PRCVMID,1)=REF_U_PRCVDT
"RTN","PRCVEE1",116,0)
 Q
"RTN","PRCVEE1",117,0)
MSGRTN ;Send message to Fund Control Point users for update
"RTN","PRCVEE1",118,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVEE1",119,0)
 S XMSUB="TRANSMISSION ERRORS FOR  "_$P(REF,"*",2)
"RTN","PRCVEE1",120,0)
 S XMDUZ="IFCAP OUTBOUND ERROR MESSAGE FOR RIL/2237"
"RTN","PRCVEE1",121,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVEE1",122,0)
 D GETFCPU^PRCVLIC(.XMY,PRCSITE,PRCFCP)
"RTN","PRCVEE1",123,0)
 D ^XMD
"RTN","PRCVEE1",124,0)
 K XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVEE1",125,0)
 Q
"RTN","PRCVEE1",126,0)
CLEAN ;Clean up variables
"RTN","PRCVEE1",127,0)
 K ODATE,PRCPRO,PRCERR,PRCFS,PRCCS,PRCRS,PRCEE,PRCSC
"RTN","PRCVEE1",128,0)
 K DETAIL,HLA("HLS"),PRCDP,PRCERR,PRCMID,PRCVMID,PRCDT,PRCDTS
"RTN","PRCVEE1",129,0)
 K ORCDAT,I,J,K,Y,X,X1,X2,XX,HLA,RQD,RQ1,ORC,PRCCNT,PRCVY
"RTN","PRCVEE1",130,0)
 K XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ,ERRCNT,PRCVERR
"RTN","PRCVEE1",131,0)
 K PRCDATA,PRCSITE,PRCFCP
"RTN","PRCVEE1",132,0)
 Q
"RTN","PRCVEE1",133,0)
 ;
"RTN","PRCVEE5")
0^4^B25590315
"RTN","PRCVEE5",1,0)
PRCVEE5 ;WOIFO/VAC - Routine to handle Error Messages sent from DynaMed ; 5/16/05 4:34pm
"RTN","PRCVEE5",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVEE5",3,0)
 ;PER VHA Directive 10-93-142, this routine should not be modified
"RTN","PRCVEE5",4,0)
 ;
"RTN","PRCVEE5",5,0)
 ;This routine reads an ACK from DynaMed in answer to a message sent
"RTN","PRCVEE5",6,0)
 ;regarding an Edit/Cancel/Approval to a RIL/2237.
"RTN","PRCVEE5",7,0)
 ;ERRTXT - Text of the error message severity
"RTN","PRCVEE5",8,0)
 ;MSGDAT -A single field that holds an error segment
"RTN","PRCVEE5",9,0)
 ;MSGDAT2 - MSGDAT without the segment identifier
"RTN","PRCVEE5",10,0)
 ;MSGDAT3 - Message type/Event type
"RTN","PRCVEE5",11,0)
 ;MSGTYP - Indicates if there are errors in the message
"RTN","PRCVEE5",12,0)
 ;PRCCNT - Record counter -indicates the message line number
"RTN","PRCVEE5",13,0)
 ;PRCERCD - Error code returned
"RTN","PRCVEE5",14,0)
 ;PRCERTX - Error text returned with error code
"RTN","PRCVEE5",15,0)
 ;PRCFLD - Field where error occurred
"RTN","PRCVEE5",16,0)
 ;PRCSEG - Segment where error has occurred
"RTN","PRCVEE5",17,0)
 ;PRCSEQ - Sequence number where error occurred
"RTN","PRCVEE5",18,0)
 ;PRCTYP - Type of form RIL or 2237
"RTN","PRCVEE5",19,0)
 ;PRCVACK - Acknowledgement type AA, AE, AR, etc
"RTN","PRCVEE5",20,0)
 ;PRCVAEC - Application error code string returned in message - ERR-5
"RTN","PRCVEE5",21,0)
 ;PRCVDT - Second node level of ^XTMP
"RTN","PRCVEE5",22,0)
 ;PRCVEC - Error component - ERR-3
"RTN","PRCVEE5",23,0)
 ;PRCVERR - Array of email message
"RTN","PRCVEE5",24,0)
 ;PRCVID - RIL/2237 ID - ERR-6
"RTN","PRCVEE5",25,0)
 ;PRCVLOC - Error Location component - ERR-2
"RTN","PRCVEE5",26,0)
 ;PRCMID - Message ID of original message
"RTN","PRCVEE5",27,0)
 ;PRCVMID2 - Cross reference into ^XTMP
"RTN","PRCVEE5",28,0)
 ;PRCVPTR - First node level of ^XTMP
"RTN","PRCVEE5",29,0)
 ;PRCVSEV - Severity Component ERR-4
"RTN","PRCVEE5",30,0)
 ;PRCVTYP - Original Form Type - RIL or 2237
"RTN","PRCVEE5",31,0)
 ;SSTOP - Stop flag
"RTN","PRCVEE5",32,0)
 ;PRCFS - Field separator
"RTN","PRCVEE5",33,0)
 ;PRCCS - Component separator
"RTN","PRCVEE5",34,0)
 ;PRCRS - Repetition separator
"RTN","PRCVEE5",35,0)
 ;PRCSC - Sub-component separator
"RTN","PRCVEE5",36,0)
 ;PRCDET - Array of field names inside of HL7 segments
"RTN","PRCVEE5",37,0)
 ;PRCFCP - Fund Control Point for message
"RTN","PRCVEE5",38,0)
 ;PRCSITE and PRCSITE0 - Receiving facility number
"RTN","PRCVEE5",39,0)
 ;ERRCNT - a counter
"RTN","PRCVEE5",40,0)
 ;^TMP - Global to hold error message information
"RTN","PRCVEE5",41,0)
BEGIN N I,J
"RTN","PRCVEE5",42,0)
 N PRCFS,PRCCS,PRCDET,ERRCNT,ERRTXT
"RTN","PRCVEE5",43,0)
 N MSGDAT,PRCCNT,MSGTYP
"RTN","PRCVEE5",44,0)
 N MSGDAT2,MSGDAT3,PRCERCD,PRCERTX,PRCFLD,PRCFCP,PRCSITE,PRCSITE0
"RTN","PRCVEE5",45,0)
 N PRCSEG,PRCSEQ,PRCTYP,PRCVACK,PRCVAEC,PRCVDT,PRCVEC,PRCVERR
"RTN","PRCVEE5",46,0)
 N PRCVID,PRCVLOC,PRCVMID,PRCVMID2,PRCVPTR,PRCVSEV,PRCVTYP,SSTOP
"RTN","PRCVEE5",47,0)
 S PRCFS=HL("FS"),PRCCS=$E(HL("ECH"),1)
"RTN","PRCVEE5",48,0)
 K ^TMP($J)
"RTN","PRCVEE5",49,0)
SETUP ;Set up array for HL7 crosswalk
"RTN","PRCVEE5",50,0)
 S PRCDET("ORC",1)="Order Control"
"RTN","PRCVEE5",51,0)
 S PRCDET("ORC",9)="Date/Time Created"
"RTN","PRCVEE5",52,0)
 S PRCDET("ORC",10)="Entered by"
"RTN","PRCVEE5",53,0)
 S PRCDET("ORC",21)="Ordering Facility"
"RTN","PRCVEE5",54,0)
 S PRCDET("RQD",1)="Line number"
"RTN","PRCVEE5",55,0)
 S PRCDET("RQD",2)="DM Document ID"
"RTN","PRCVEE5",56,0)
 S PRCDET("RQD",3)="Item number"
"RTN","PRCVEE5",57,0)
 S PRCDET("RQD",4)="Packaging Multiple"
"RTN","PRCVEE5",58,0)
 S PRCDET("RQD",5)="Quantity"
"RTN","PRCVEE5",59,0)
 S PRCDET("RQD",6)="Unit of purchase"
"RTN","PRCVEE5",60,0)
 S PRCDET("RQD",9)="Identifier"
"RTN","PRCVEE5",61,0)
 S PRCDET("RQD",10)="Date needed"
"RTN","PRCVEE5",62,0)
 S PRCDET("RQ1",1)="Unit cost"
"RTN","PRCVEE5",63,0)
 S PRCDET("RQ1",2)="Vendor Stock Number"
"RTN","PRCVEE5",64,0)
 S PRCDET("RQ1",3)="BOC"
"RTN","PRCVEE5",65,0)
 S PRCDET("RQ1",4)="Vendor and/or FMS Vendor"
"RTN","PRCVEE5",66,0)
 S PRCDET("RQ1",5)="NIF number"
"RTN","PRCVEE5",67,0)
 S MSGTYP="",PRCVTYP=""
"RTN","PRCVEE5",68,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVEE5",69,0)
 .S ^TMP($J,I)=HLNODE,J=0
"RTN","PRCVEE5",70,0)
 .F  S J=$O(HLNODE(J)) Q:'J  S ^TMP($J,I,J)=HLNODE(J)
"RTN","PRCVEE5",71,0)
 ;
"RTN","PRCVEE5",72,0)
 S PRCCNT="",SSTOP="GO"
"RTN","PRCVEE5",73,0)
 F I=1:1:2 S PRCCNT=$G(^TMP($J,I)) Q:PRCCNT=""  Q:SSTOP="STOP"  D
"RTN","PRCVEE5",74,0)
 .S MSGDAT=$G(^TMP($J,I))
"RTN","PRCVEE5",75,0)
 .Q:MSGDAT=""
"RTN","PRCVEE5",76,0)
 .S MSGDAT2=$P(MSGDAT,PRCFS,2,21)
"RTN","PRCVEE5",77,0)
 .I $E(MSGDAT,1,3)="MSH" D  Q
"RTN","PRCVEE5",78,0)
 ..S MSGDAT3=$P(MSGDAT2,PRCFS,8)
"RTN","PRCVEE5",79,0)
 ..I MSGDAT3'["ORN"_PRCCS_"O08" D
"RTN","PRCVEE5",80,0)
 ...S SSTOP="STOP",MSGTYP="NOK"
"RTN","PRCVEE5",81,0)
 ...S PRCVTYP="ACK",PRCVID=$P(MSGDAT2,PRCFS,9)
"RTN","PRCVEE5",82,0)
 ...S PRCVERR(1)="IN "_PRCVTYP_" "_PRCVID_" there was a bad message type"
"RTN","PRCVEE5",83,0)
 ...S PRCVPTR="*"_$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)_"- - -076"
"RTN","PRCVEE5",84,0)
 .I $E(MSGDAT,1,3)="MSA" D  Q
"RTN","PRCVEE5",85,0)
 ..S PRCVACK=$P(MSGDAT2,PRCFS,1)
"RTN","PRCVEE5",86,0)
 ..S PRCVMID=$P(MSGDAT2,PRCFS,2)
"RTN","PRCVEE5",87,0)
 ..S PRCVMID2="PRCVMID*"_PRCVMID
"RTN","PRCVEE5",88,0)
 ..S PRCVPTR=$P($G(^XTMP(PRCVMID2,1)),U,1)
"RTN","PRCVEE5",89,0)
 ..S PRCVDT=$P($G(^XTMP(PRCVMID2,1)),U,2)
"RTN","PRCVEE5",90,0)
 ..I PRCVACK="AA" D  Q
"RTN","PRCVEE5",91,0)
 ...S MSGTYP="OK"
"RTN","PRCVEE5",92,0)
 ..I (PRCVACK="AE")!(PRCVACK="AR") D  Q
"RTN","PRCVEE5",93,0)
 ...S MSGTYP="NOK"
"RTN","PRCVEE5",94,0)
 I $E(MSGTYP,1,2)="OK" D VALID Q
"RTN","PRCVEE5",95,0)
 I PRCVTYP="ACK" D NOVALID Q
"RTN","PRCVEE5",96,0)
ERROR ;Now process error messages
"RTN","PRCVEE5",97,0)
 ;
"RTN","PRCVEE5",98,0)
 S ERRCNT=1
"RTN","PRCVEE5",99,0)
 S PRCCNT="" F I=3:1 S PRCCNT=$G(^TMP($J,I)) Q:PRCCNT=""  D
"RTN","PRCVEE5",100,0)
 .S MSGDAT=$G(^TMP($J,I))
"RTN","PRCVEE5",101,0)
 .Q:MSGDAT=""
"RTN","PRCVEE5",102,0)
 .S MSGDAT2=$P(MSGDAT,PRCFS,2,7)
"RTN","PRCVEE5",103,0)
 .S PRCVLOC=$P(MSGDAT2,PRCFS,2)
"RTN","PRCVEE5",104,0)
 .S PRCVEC=$P(MSGDAT2,PRCFS,3)
"RTN","PRCVEE5",105,0)
 .S PRCVSEV=$P(MSGDAT2,PRCFS,4)
"RTN","PRCVEE5",106,0)
 .S PRCVAEC=$P(MSGDAT2,PRCFS,5)
"RTN","PRCVEE5",107,0)
 .S PRCVID=$P(MSGDAT2,PRCFS,6)
"RTN","PRCVEE5",108,0)
 .S PRCVTYP="RIL"
"RTN","PRCVEE5",109,0)
 .I PRCVID?.N1"-".N1"-".N1"-".E1"-".N S PRCVTYP="2237"
"RTN","PRCVEE5",110,0)
 .S PRCSEG=$P(PRCVLOC,PRCCS,1)
"RTN","PRCVEE5",111,0)
 .S PRCSEQ=$P(PRCVLOC,PRCCS,2)
"RTN","PRCVEE5",112,0)
 .S PRCFLD=$P(PRCVLOC,PRCCS,3)
"RTN","PRCVEE5",113,0)
 .S PRCERCD=$P(PRCVAEC,PRCCS,1)
"RTN","PRCVEE5",114,0)
 .S PRCERTX=$P(PRCVAEC,PRCCS,2)
"RTN","PRCVEE5",115,0)
 .S ERRTXT="Error"
"RTN","PRCVEE5",116,0)
 .I PRCVSEV="W" S ERRTXT="Warning"
"RTN","PRCVEE5",117,0)
 .S PRCVERR(ERRCNT)="In "_PRCVTYP_" "_PRCVID_" the following occurred"
"RTN","PRCVEE5",118,0)
 .S ERRCNT=ERRCNT+1
"RTN","PRCVEE5",119,0)
 .S PRCVERR(ERRCNT)="For Line item "_PRCSEQ_" the "_PRCDET(PRCSEG,PRCFLD)_" had the following "_ERRTXT_": "
"RTN","PRCVEE5",120,0)
 .S ERRCNT=ERRCNT+1
"RTN","PRCVEE5",121,0)
 .S PRCVERR(ERRCNT)=PRCERTX
"RTN","PRCVEE5",122,0)
 .S ERRCNT=ERRCNT+1
"RTN","PRCVEE5",123,0)
 D NOVALID
"RTN","PRCVEE5",124,0)
 Q
"RTN","PRCVEE5",125,0)
VALID ;Do NOTHING to notify user that message is ok.
"RTN","PRCVEE5",126,0)
 D CLEANUP
"RTN","PRCVEE5",127,0)
 Q
"RTN","PRCVEE5",128,0)
NOVALID ;Mailman message
"RTN","PRCVEE5",129,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVEE5",130,0)
 S XMSUB="IFCAP to DynaMed "_PRCVTYP_" Errors "_PRCVID_" "
"RTN","PRCVEE5",131,0)
 S XMDUZ="IFCAP/DynaMed Interface"
"RTN","PRCVEE5",132,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVEE5",133,0)
 ;S XMY("CARR.VICTOR@CSL.FO-WASH.MED.VA.GOV")=""
"RTN","PRCVEE5",134,0)
 S PRCFCP=$P(PRCVPTR,"-",4)
"RTN","PRCVEE5",135,0)
 S PRCSITE0=$P(PRCVPTR,"-",1)
"RTN","PRCVEE5",136,0)
 S PRCSITE=$P(PRCSITE0,"*",2)
"RTN","PRCVEE5",137,0)
 D GETFCPU^PRCVLIC(.XMY,PRCSITE,PRCFCP)
"RTN","PRCVEE5",138,0)
 D ^XMD
"RTN","PRCVEE5",139,0)
 K XMSUB,XMMG,XMDUZ,XMTEXT,XMY,XMZ
"RTN","PRCVEE5",140,0)
 D CLEANUP
"RTN","PRCVEE5",141,0)
 Q
"RTN","PRCVEE5",142,0)
 ;
"RTN","PRCVEE5",143,0)
CLEANUP ; Clean up data
"RTN","PRCVEE5",144,0)
 K MSGTYP,MSGDAT,MSGDAT2,MSGDAT3,ERRTXT
"RTN","PRCVEE5",145,0)
 K PRCCNT,PRCFS,PRCCS,I,J,SSTOP,PRCFCP,PRCSITE,PRCSITE0
"RTN","PRCVEE5",146,0)
 K ^TMP($J),ERRCNT,PRCERCD,PRCERTX,PRCFLD,PRCSEG,PRCSEQ
"RTN","PRCVEE5",147,0)
 K PRCTYP,PRCVACK,PRCVAEC,PRCVDT,PRCVEC,PRCVERR,PRCVID,PRCVLOC
"RTN","PRCVEE5",148,0)
 K PRCVMID,PRCVMID2,PRCVPTR,PRCVSEV,PRCVTYP,PRCDET
"RTN","PRCVEE5",149,0)
 ;
"RTN","PRCVFMS1")
0^67^B5222023
"RTN","PRCVFMS1",1,0)
PRCVFMS1 ;WOIFO/LKG-GENERATE IV FROM COTS INV TRANS ;4/12/05  14:10
"RTN","PRCVFMS1",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVFMS1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVFMS1",4,0)
 Q
"RTN","PRCVFMS1",5,0)
 ; PRCNODE = First subscript of the ^TMP global used to exchange data
"RTN","PRCVFMS1",6,0)
 ; PRCPDA = IEN of Original Issue Book entry in File #410
"RTN","PRCVFMS1",7,0)
 ; PRCPFMOD = Document Action ("E":Original; "M":Modification)
"RTN","PRCVFMS1",8,0)
 ; PRCPPSTA = Primary Inventory Point's Station Number
"RTN","PRCVFMS1",9,0)
 ; PRCPPFCP = Primary Inventory Point's Fund Control Point
"RTN","PRCVFMS1",10,0)
 ; PRCPPBFY = Primary Inventory Point FCP's Beginning Budget Fiscal Year
"RTN","PRCVFMS1",11,0)
 ; PRCPWSTA = Warehouse's Station Number
"RTN","PRCVFMS1",12,0)
 ; PRCPWFCP = Warehouse's Fund Control Point
"RTN","PRCVFMS1",13,0)
 ; PRCPWBFY = Warehouse FCP's Beginning Budget Fiscal Year
"RTN","PRCVFMS1",14,0)
ENT(PRCNODE,PRCPDA) ;Entry point
"RTN","PRCVFMS1",15,0)
 N PRCPFMOD,PRC1,PRC2,PRCPWSTA,PRCPWFCP,PRCPWBFY,PRCFY,PRCDAA,PRCSX1,PRCRI
"RTN","PRCVFMS1",16,0)
 N ACCT,BUYBFY,BUYEFY,BUYFUND,BUYJOB,BUYLINE,BUYTABLE,BUYXPROG,COSTCNTR,DATA,FMSLINE,GECSFMS,INVCOST,LINEDA,LINEDOC,PRCPFMS,PRCPSEC1,PROFIT,PROFLINE
"RTN","PRCVFMS1",17,0)
 N TOTAL,TRANDATE,TRANNO,TRANDA,TRANID,PRCPPSTA,PRCPPFCP,PRCPPBFY,PRC,PRCX
"RTN","PRCVFMS1",18,0)
 N SELBFY,SELEFY,SELFUND,SELLINE,SELTABLE,SELXPROG,SIGN,STACKDA,SUBACCT,VOUCHER
"RTN","PRCVFMS1",19,0)
 N GECSDATA,D,DIC
"RTN","PRCVFMS1",20,0)
 S PRC1=$G(^TMP(PRCNODE,$J,1)),PRC2=$G(^TMP(PRCNODE,$J,2))
"RTN","PRCVFMS1",21,0)
 S PRCPFMOD=$S($P(PRC1,"^",4)="E":0,1:1),(PRCPPSTA,PRCPWSTA)=$P(PRC1,"^")
"RTN","PRCVFMS1",22,0)
 S PRCPWFCP=$P(PRC2,"^"),PRCPPFCP=$P(PRC2,"^",2),TRANDATE=$P(PRC1,"^",5),TRANID=$P(PRC1,"^",2)
"RTN","PRCVFMS1",23,0)
 S TRANNO=$P($G(^PRCS(410,PRCPDA,0)),"^")
"RTN","PRCVFMS1",24,0)
 S PRCFY=$S($E(TRANDATE,4,5)<10:$E(TRANDATE,2,3),1:$E(101+$E(TRANDATE,2,3),2,3))
"RTN","PRCVFMS1",25,0)
 S PRCPPBFY=$$BBFY^PRCSUT(PRCPPSTA,PRCFY,PRCPPFCP,1),PRCPWBFY=$$BBFY^PRCSUT(PRCPWSTA,PRCFY,PRCPWFCP,1)
"RTN","PRCVFMS1",26,0)
 S TRANDA=0,TOTAL=0
"RTN","PRCVFMS1",27,0)
 F  S TRANDA=$O(^TMP(PRCNODE,$J,3,TRANDA)) Q:+TRANDA'=TRANDA  D
"RTN","PRCVFMS1",28,0)
 . N PRC445 S PRC445=$G(^TMP(PRCNODE,$J,3,TRANDA,0))
"RTN","PRCVFMS1",29,0)
 . S FMSLINE=$P(PRC445,"^"),PRCPFMS(FMSLINE)=$P(PRC445,"^",2)_"^"_$P(PRC445,"^",3)_"^"_$P(PRC445,"^",4)_"^"_($P(PRC445,"^",5)-$P(PRC445,"^",4))
"RTN","PRCVFMS1",30,0)
 . S TOTAL=TOTAL+$P(PRC445,"^",5)
"RTN","PRCVFMS1",31,0)
 D IVCOTS^PRCPSFIV
"RTN","PRCVFMS1",32,0)
 Q $S($G(GECSFMS("DA"))>0:1,1:0)
"RTN","PRCVFMS2")
0^68^B3988824
"RTN","PRCVFMS2",1,0)
PRCVFMS2 ;WOIFO/LKG-GENERATE SV FROM COTS INV TRANS ;4/12/05  14:11
"RTN","PRCVFMS2",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVFMS2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVFMS2",4,0)
 Q
"RTN","PRCVFMS2",5,0)
 ; Assuming handoff via ^TMP globals of structure
"RTN","PRCVFMS2",6,0)
 ; ^TMP(PRCNODE,$J,1)=Station#^BatchID^Trancode^DocAction^Transdate^Userid
"RTN","PRCVFMS2",7,0)
 ; ^TMP(PRCNODE,$J,2)=SellerFCP^BuyerFCP^BuyerCostCenter^BuyerSubCostCenter
"RTN","PRCVFMS2",8,0)
 ; ^TMP(PRCNODE,$J,3,0)=NumberOfItems
"RTN","PRCVFMS2",9,0)
 ; ^TMP(PRCNODE,$J,3,counter,0)=FMSLineID^AccntCode^BOC^InventoryValue^SalesValue^ReasonCode
"RTN","PRCVFMS2",10,0)
 ; PRCNODE = First subscript of ^TMP global containing the data
"RTN","PRCVFMS2",11,0)
 ; assumed Transdate is date stored in VA FileMan format
"RTN","PRCVFMS2",12,0)
 ;
"RTN","PRCVFMS2",13,0)
ENT(PRCNODE) ;Entrance point for generating SV from COTS inventory transaction
"RTN","PRCVFMS2",14,0)
 N ACCT,BFY,DATA,EFY,FUND,GECSFMS,INVCOST,INVPT,LINE,LINEDOC,PRCPFMS,PRCPSEC1,REASON,SIGN,STACKDA,TABLE,TOTAL,TRANDA,TRANID,TRANDATE,XPROG
"RTN","PRCVFMS2",15,0)
 N PRCPWBFY,PRCPWSTA,PRCPWFCP,PRCTMP1,PRCFY,PRC,GECSDATA,D,DIC
"RTN","PRCVFMS2",16,0)
 S PRCTMP1=$G(^TMP(PRCNODE,$J,1))
"RTN","PRCVFMS2",17,0)
 I $P(PRCTMP1,"^",3)'="SV" Q
"RTN","PRCVFMS2",18,0)
 S TRANDATE=$P(PRCTMP1,"^",5),PRCFY=$S($E(TRANDATE,4,5)<10:$E(TRANDATE,2,3),1:$E(101+$E(TRANDATE,2,3),2,3))
"RTN","PRCVFMS2",19,0)
 S PRCPWSTA=$P(PRCTMP1,"^"),PRCPWFCP=$P($G(^TMP(PRCNODE,$J,2)),"^")
"RTN","PRCVFMS2",20,0)
 S PRCPWBFY=$$BBFY^PRCSUT(PRCPWSTA,PRCFY,PRCPWFCP,1)
"RTN","PRCVFMS2",21,0)
 S TRANDA=0,INVPT=""
"RTN","PRCVFMS2",22,0)
 F  S TRANDA=$O(^PRCP(445,"AC","W",TRANDA)) Q:+TRANDA'=TRANDA  I $P($P($G(^PRCP(445,TRANDA,0)),"^"),"-")=PRCPWSTA S INVPT=TRANDA Q
"RTN","PRCVFMS2",23,0)
 Q:INVPT'>0
"RTN","PRCVFMS2",24,0)
 S TRANID="A"_$$ORDERNO^PRCPUTRX(INVPT)
"RTN","PRCVFMS2",25,0)
 S TRANDA=0,TOTAL=0
"RTN","PRCVFMS2",26,0)
 F  S TRANDA=$O(^TMP(PRCNODE,$J,3,TRANDA)) Q:+TRANDA'=TRANDA  D
"RTN","PRCVFMS2",27,0)
 . N X S X=$G(^TMP(PRCNODE,$J,3,TRANDA,0)) Q:X=""
"RTN","PRCVFMS2",28,0)
 . S INVCOST=$P(X,"^",4) Q:+INVCOST=0
"RTN","PRCVFMS2",29,0)
 . S ACCT=$P(X,"^",2),REASON=$P(X,"^",6) Q:ACCT=""  Q:REASON=""
"RTN","PRCVFMS2",30,0)
 . S TOTAL=TOTAL+INVCOST,PRCPFMS(ACCT,REASON)=INVCOST
"RTN","PRCVFMS2",31,0)
 D SVCOTS^PRCPSFSV
"RTN","PRCVFMS2",32,0)
 Q $S($G(GECSFMS("DA"))>0:1,1:0)
"RTN","PRCVIBF")
0^69^B39152455
"RTN","PRCVIBF",1,0)
PRCVIBF ;WOIFO/AS-FUND PROCESSING USING DATA FROM DYNAMED ;4/11/05  15:15
"RTN","PRCVIBF",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVIBF",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVIBF",4,0)
 ;
"RTN","PRCVIBF",5,0)
INIT(NOD) ;
"RTN","PRCVIBF",6,0)
 ;  1. Find out it is IV or SV
"RTN","PRCVIBF",7,0)
 ;
"RTN","PRCVIBF",8,0)
 NEW RTVAL
"RTN","PRCVIBF",9,0)
 I '$D(^TMP(NOD,$J)) D ERR(1) G EXIT
"RTN","PRCVIBF",10,0)
PROCESS ;
"RTN","PRCVIBF",11,0)
 NEW DUZ
"RTN","PRCVIBF",12,0)
 NEW %,ACCOD,ACT,BATCHID,BOC,CC,DA,PRC,PRCPDA,PRCHQ,PRCPORD,DIC,PRCSCP,RECORD1,RECORD10,RECORD2,RECORD3,RECORD4,T
"RTN","PRCVIBF",13,0)
 NEW DATIME,DESC,IEN,ITM,ITOT,IVAL,ND,TRNODE,Z,SVAL,STOT
"RTN","PRCVIBF",14,0)
 NEW PRCVI,PRCVDT,PRCSN,CC2
"RTN","PRCVIBF",15,0)
 D NOW^%DTC
"RTN","PRCVIBF",16,0)
 S PRCVDT=DT,DATIME=%,U="^",ND=$G(^TMP(NOD,$J,1)),PRC("SITE")=$P(ND,U)
"RTN","PRCVIBF",17,0)
 S BATCHID=$P(ND,U,2),Z=$P(ND,U,3),ACT=$P(ND,U,4)
"RTN","PRCVIBF",18,0)
 D DUZ^XUP($P(ND,U,6)) ;DBIA #4129 DUZ^XUP
"RTN","PRCVIBF",19,0)
 ;  Return PRC("FY"), PRC("QTR") using fileman date X
"RTN","PRCVIBF",20,0)
 S X=$P(ND,U,5) D FYQ^PRCFSITE
"RTN","PRCVIBF",21,0)
 S ND=$G(^TMP(NOD,$J,2))
"RTN","PRCVIBF",22,0)
 S PRC("SCP")=$P(ND,U),PRC("CP")=$P(ND,U,2),CC=$P(ND,U,3),CC2=$P(ND,U,4)
"RTN","PRCVIBF",23,0)
 S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),PRC("CP"),1)
"RTN","PRCVIBF",24,0)
 I Z="IV",PRC("SCP")="" S PRC("SCP")=4537
"RTN","PRCVIBF",25,0)
 ;  If adjustment...
"RTN","PRCVIBF",26,0)
 I ACT'="E" D ADJ G EXIT
"RTN","PRCVIBF",27,0)
 ;
"RTN","PRCVIBF",28,0)
 ;        Issue Book Fund Commitment
"RTN","PRCVIBF",29,0)
 ;  1. get data from DynaMed by HL7 message
"RTN","PRCVIBF",30,0)
TRANS ;  2. get new transaction number
"RTN","PRCVIBF",31,0)
 S X=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("CP")
"RTN","PRCVIBF",32,0)
 S Z=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("QTR")_"-"_PRC("CP")
"RTN","PRCVIBF",33,0)
 D EN1^PRCSUT3
"RTN","PRCVIBF",34,0)
NOD0 ;  3. create file 410, node 0 and 3
"RTN","PRCVIBF",35,0)
 S PRC("CP")=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),"^")
"RTN","PRCVIBF",36,0)
 D EN2^PRCSUT3
"RTN","PRCVIBF",37,0)
 ; Failed if --> I '$D(PRCSX1)
"RTN","PRCVIBF",38,0)
 ;S X=PRCSX1,T1=DA
"RTN","PRCVIBF",39,0)
 S RTVAL=DA_"^0"
"RTN","PRCVIBF",40,0)
 ;    Transaction type = O:Obligation, A:Adjustment, CA:Cancelled
"RTN","PRCVIBF",41,0)
 S $P(^PRCS(410,DA,0),"^",2)="O"
"RTN","PRCVIBF",42,0)
 ;    Form Type = 5, Issue Book
"RTN","PRCVIBF",43,0)
 S $P(^PRCS(410,DA,0),"^",4)=5
"RTN","PRCVIBF",44,0)
 ;
"RTN","PRCVIBF",45,0)
NODE2 ;  4. create file 410, node 2
"RTN","PRCVIBF",46,0)
 S IEN=$O(^PRC(440,"AC","S",0)),ND=$G(^PRC(440,+IEN,0))
"RTN","PRCVIBF",47,0)
 I IEN D
"RTN","PRCVIBF",48,0)
 . S ^PRCS(410,DA,2)=$P(ND,"^",1,10)
"RTN","PRCVIBF",49,0)
 . S $P(^PRCS(410,DA,3),"^",4)=+IEN
"RTN","PRCVIBF",50,0)
 ;
"RTN","PRCVIBF",51,0)
 ;  5. Date of request (P1), Priority of Request (ST), Date required (P4)
"RTN","PRCVIBF",52,0)
 S ^PRCS(410,DA,1)=PRCVDT_"^^ST^"_PRCVDT
"RTN","PRCVIBF",53,0)
CC ;  6. Cost Center
"RTN","PRCVIBF",54,0)
 S CC=CC_CC2,CC=$P($G(^PRCD(420.1,CC,0)),"^")
"RTN","PRCVIBF",55,0)
 S $P(^PRCS(410,DA,3),"^",3)=CC
"RTN","PRCVIBF",56,0)
 ;  7. Create Items
"RTN","PRCVIBF",57,0)
ITEM ;     FIND UPDATE^DIE USAGE
"RTN","PRCVIBF",58,0)
 ;
"RTN","PRCVIBF",59,0)
 S CC=$G(^TMP(NOD,$J,3,0)),(STOT,ITOT)=0
"RTN","PRCVIBF",60,0)
 F PRCVI=1:1:CC D
"RTN","PRCVIBF",61,0)
 . S ND=$G(^TMP(NOD,$J,3,PRCVI,0)) Q:ND=""
"RTN","PRCVIBF",62,0)
 . S ACCOD=$P(ND,U,2),IVAL=$P(ND,U,4),SVAL=$P(ND,U,5)
"RTN","PRCVIBF",63,0)
 . S BOC=$P(ND,U,3) I BOC S BOC=$E($P($G(^PRCD(420.2,+BOC,0)),U),1,30)
"RTN","PRCVIBF",64,0)
 . S ITM=999999,DESC=$P($G(^PRC(441,ITM,0)),"^",2)
"RTN","PRCVIBF",65,0)
 . I DESC="" S DESC="DYNAMED ITEM"
"RTN","PRCVIBF",66,0)
 . S ACT=$G(^PRCS(410,DA,"IT",0)) I ACT="" S ^(0)="^410.02AI^0^0"
"RTN","PRCVIBF",67,0)
 . S $P(^PRCS(410,DA,"IT",0),"^",3,4)=PRCVI_"^"_PRCVI
"RTN","PRCVIBF",68,0)
 . S ^PRCS(410,DA,"IT",PRCVI,0)=PRCVI_"^^^"_BOC_U_ITM_"^^^"_CC
"RTN","PRCVIBF",69,0)
 . S ^PRCS(410,DA,"IT",PRCVI,1,0)="^^1^1^"_PRCVDT
"RTN","PRCVIBF",70,0)
 . S ^PRCS(410,DA,"IT",PRCVI,1,1,0)=DESC
"RTN","PRCVIBF",71,0)
 . ;Node 445 in "IT"
"RTN","PRCVIBF",72,0)
 . ;   how to handle ACCT-BOC    (CAME FROM DYNAMED)
"RTN","PRCVIBF",73,0)
 . S ^PRCS(410,DA,"IT",PRCVI,445)="A"_ACCOD_"-"_$P(ND,U,3)_U_$P(ND,U)_"^^"_IVAL_U_SVAL
"RTN","PRCVIBF",74,0)
 . S ^PRCS(410,DA,"IT","AB",PRCVI,PRCVI)=""
"RTN","PRCVIBF",75,0)
 . S ^PRCS(410,DA,"IT","B",PRCVI,PRCVI)=""
"RTN","PRCVIBF",76,0)
 . S ^PRCS(410,DA,"IT","AG",ITM,PRCVI)=""
"RTN","PRCVIBF",77,0)
 . S STOT=STOT+SVAL
"RTN","PRCVIBF",78,0)
 ;   End of item loop
"RTN","PRCVIBF",79,0)
 S $P(^PRCS(410,DA,10),U)=PRCVI
"RTN","PRCVIBF",80,0)
 ;
"RTN","PRCVIBF",81,0)
TOT ;   TOTAL COST and Date Commited
"RTN","PRCVIBF",82,0)
 S ^PRCS(410,DA,4)=ITOT_U_PRCVDT_U_STOT_"^^^^^"_STOT
"RTN","PRCVIBF",83,0)
 ;  5. Get DUZ of requestor and Approving Official, Total Amount
"RTN","PRCVIBF",84,0)
 S $P(^PRCS(410,DA,7),U)=DUZ
"RTN","PRCVIBF",85,0)
445 ;
"RTN","PRCVIBF",86,0)
 S $P(^PRCS(410,DA,445),"^",5)=BATCHID
"RTN","PRCVIBF",87,0)
COMMIT ;
"RTN","PRCVIBF",88,0)
 S PRCSN=^PRCS(410,DA,0),PRCHQ=$P(PRCSN,"^",4)
"RTN","PRCVIBF",89,0)
 ;S (CURQTR,CURQTR1)=PRC("QTR")
"RTN","PRCVIBF",90,0)
 S $P(^PRCS(410,DA,11),U,3)=1,^PRCS(410,"AQ",1,DA)=""
"RTN","PRCVIBF",91,0)
 S ^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA)=""
"RTN","PRCVIBF",92,0)
 S ^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA)=""
"RTN","PRCVIBF",93,0)
 ;  Copied from FINAL1^PRCSAPP2
"RTN","PRCVIBF",94,0)
 ;  set record in 443, clean up 410, change cp uncommitted balance 
"RTN","PRCVIBF",95,0)
 ;  using TRANS^PRCSES, in 420
"RTN","PRCVIBF",96,0)
 S PRCSCP=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),U,12)
"RTN","PRCVIBF",97,0)
 L +^PRCS(410,DA):15 Q:$T=0
"RTN","PRCVIBF",98,0)
 S $P(^PRCS(410,DA,10),U,4)=$O(^PRCD(442.3,"C",60,0))
"RTN","PRCVIBF",99,0)
 I PRCSCP=1!(PRCHQ=1) S $P(^PRCS(410,DA,10),U,4)=$O(^PRCD(442.3,"C",10,0))
"RTN","PRCVIBF",100,0)
 K ^PRCS(410,"F",+PRCSN_"-"_+PRC("CP")_"-"_$P($P(PRCSN,U),"-",5),DA)
"RTN","PRCVIBF",101,0)
 K ^PRCS(410,"F1",$P($P(PRCSN,U),"-",5)_"-"_+PRCSN_"-"_+PRC("CP"),DA)
"RTN","PRCVIBF",102,0)
 K ^PRCS(410,"AQ",1,DA)
"RTN","PRCVIBF",103,0)
 S $P(^PRCS(410,DA,11),U,3)=""
"RTN","PRCVIBF",104,0)
 D ERS410^PRC0G(DA_"^A")
"RTN","PRCVIBF",105,0)
 L -^PRCS(410,DA)
"RTN","PRCVIBF",106,0)
ESIG ;
"RTN","PRCVIBF",107,0)
 S MESSAGE=""
"RTN","PRCVIBF",108,0)
 D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCVIBF",109,0)
 K MESSAGE
"RTN","PRCVIBF",110,0)
 S X=STOT D TRANS^PRCSES
"RTN","PRCVIBF",111,0)
 ;    no sub-cp processing  (removed the code)
"RTN","PRCVIBF",112,0)
 I $P(PRCSN,U,4)>1 D
"RTN","PRCVIBF",113,0)
 . S X=$P(PRCSN,U,1),DIC="^PRC(443,",DIC(0)="L",DLAYGO=443
"RTN","PRCVIBF",114,0)
 . D ^DIC K DIC,DLAYGO,X
"RTN","PRCVIBF",115,0)
 . S X=$O(^PRCD(442.3,"C",60,0))
"RTN","PRCVIBF",116,0)
 . S:PRCSCP=1 X=$O(^PRCD(442.3,"C",10,0))
"RTN","PRCVIBF",117,0)
 . S $P(^PRC(443,DA,0),U,7)=X,^PRC(443,"AC",X,DA)=""
"RTN","PRCVIBF",118,0)
 . S $P(^PRC(443,DA,0),U,11)=$P(PRCSN,U,6)
"RTN","PRCVIBF",119,0)
 ;   No sub-cp  so no --->        increment due-ins and due-outs
"RTN","PRCVIBF",120,0)
 ;   D EN2^PRCPWI
"RTN","PRCVIBF",121,0)
 ;
"RTN","PRCVIBF",122,0)
 S TRNODE(0)=0 D:PRCHQ=1 NODE^PRCS58OB(DA,.TRNODE)
"RTN","PRCVIBF",123,0)
POSTING ;
"RTN","PRCVIBF",124,0)
 ;   Buyer and Seller's FCP provided by DynaMed
"RTN","PRCVIBF",125,0)
 ;
"RTN","PRCVIBF",126,0)
 ;S (PRCPINPT,WHSE)=$O(^PRCP(445,"B",PRC("SITE")_"-WHSE",0))
"RTN","PRCVIBF",127,0)
 S PRCPDA=DA
"RTN","PRCVIBF",128,0)
 ;   get reference voucher (Obligation) number
"RTN","PRCVIBF",129,0)
 S PRCPORD=$$IBCNS^PRCPWPU1(PRC("SITE")_"-I"_$E(PRC("FY"),2))
"RTN","PRCVIBF",130,0)
 I PRCPORD="" D ERR(2) G EXIT
"RTN","PRCVIBF",131,0)
 S $P(^PRCS(410,PRCPDA,445),U)=PRCPORD
"RTN","PRCVIBF",132,0)
 S $P(^PRCS(410,PRCPDA,445),U,3,4)=STOT_U_DT
"RTN","PRCVIBF",133,0)
 S ^PRCS(410,"AS",BATCHID,PRCPDA)=""
"RTN","PRCVIBF",134,0)
 ;
"RTN","PRCVIBF",135,0)
FILE ;
"RTN","PRCVIBF",136,0)
 D IB^PRCS0B(PRC("SITE")_U_PRC("SITE"),PRC("CP")_U_PRC("SCP"),PRCPDA,STOT_U_STOT)
"RTN","PRCVIBF",137,0)
FINAL ;
"RTN","PRCVIBF",138,0)
 ;   All issue book from DynaMed are FINAL
"RTN","PRCVIBF",139,0)
 S $P(^PRCS(410,PRCPDA,4),U,4)=DT
"RTN","PRCVIBF",140,0)
 ;   change status
"RTN","PRCVIBF",141,0)
 S $P(^PRCS(410,PRCPDA,10),U,4)=$O(^PRCD(442.3,"C",40,0))
"RTN","PRCVIBF",142,0)
 ;   Accountable officer and date signed
"RTN","PRCVIBF",143,0)
 S $P(^PRCS(410,PRCPDA,7),U,11,12)=DUZ_U_DATIME
"RTN","PRCVIBF",144,0)
 ;   remove any worksheet file for 2237
"RTN","PRCVIBF",145,0)
 N DA,DIC,DIK
"RTN","PRCVIBF",146,0)
 S DIK="^PRC(443,",DA=PRCPDA D ^DIK
"RTN","PRCVIBF",147,0)
EXIT ;
"RTN","PRCVIBF",148,0)
 Q RTVAL
"RTN","PRCVIBF",149,0)
 ;
"RTN","PRCVIBF",150,0)
ADJ ;
"RTN","PRCVIBF",151,0)
 ; Adjustment 
"RTN","PRCVIBF",152,0)
 ;   Get IEN from "AS"
"RTN","PRCVIBF",153,0)
 S DA=$O(^PRCS(410,"AS",BATCHID,0))
"RTN","PRCVIBF",154,0)
 I 'DA D ERR(3) Q
"RTN","PRCVIBF",155,0)
 S RTVAL=DA_"^0"
"RTN","PRCVIBF",156,0)
 ;
"RTN","PRCVIBF",157,0)
 S CC=$G(^TMP(NOD,$J,3,0)),STOT=0
"RTN","PRCVIBF",158,0)
 F PRCVI=1:1:CC D
"RTN","PRCVIBF",159,0)
 . S ND=$G(^TMP(NOD,$J,3,PRCVI,0)) Q:ND=""
"RTN","PRCVIBF",160,0)
 . S STOT=STOT+$P(ND,U,5)
"RTN","PRCVIBF",161,0)
 ;  Update following code to generate new 410 for Buyer and Seller
"RTN","PRCVIBF",162,0)
 I 'STOT D ERR(4) G EXIT
"RTN","PRCVIBF",163,0)
 S CC=$P($G(^PRCS(410,DA,4)),"^",5)_"-ADJ"
"RTN","PRCVIBF",164,0)
 I STOT D
"RTN","PRCVIBF",165,0)
 . N A,B,BUY,SAL
"RTN","PRCVIBF",166,0)
 . S BUY=PRC("SITE")_U_PRC("CP")_U_"A"_"^^"_DT_U_STOT_U_CC
"RTN","PRCVIBF",167,0)
 . S A=^PRCS(410,DA,0),B=$P($G(^(3)),"^",11)
"RTN","PRCVIBF",168,0)
 . S A=$P($$QTRDATE^PRC0D($P(A,"-",2),$P(A,"-",3)),"^",7)
"RTN","PRCVIBF",169,0)
 . S $P(BUY,"^",10,11)=A_"^"_+$$DATE^PRC0C(B,"I"),SAL=BUY
"RTN","PRCVIBF",170,0)
 . D A410^PRC0F(.PRCPXX,BUY)
"RTN","PRCVIBF",171,0)
 . S $P(SAL,U,2)=PRC("SCP"),$P(SAL,U,6)=-STOT
"RTN","PRCVIBF",172,0)
 . D A410^PRC0F(.PRCPXX,SAL)
"RTN","PRCVIBF",173,0)
 . K PRCPXX
"RTN","PRCVIBF",174,0)
 Q
"RTN","PRCVIBF",175,0)
DMITEM ;
"RTN","PRCVIBF",176,0)
 ;  Initiate new item number for DynaMed interface
"RTN","PRCVIBF",177,0)
 NEW FDA,RESULT
"RTN","PRCVIBF",178,0)
 S FDA(441,"?+1,",.01)=999999
"RTN","PRCVIBF",179,0)
 S FDA(441,"?+1,",.05)="ITEM FOR DYNAMED ISSUE BOOK PROCESSING"
"RTN","PRCVIBF",180,0)
 S FDA(441,"?+1,",2)=9999
"RTN","PRCVIBF",181,0)
 S FDA(441,"?+1,",12)=2696
"RTN","PRCVIBF",182,0)
 D UPDATE^DIE("E","FDA","RESULT")
"RTN","PRCVIBF",183,0)
 S FDA(1)="Item created for use when processing IVSV transaction in support"
"RTN","PRCVIBF",184,0)
 S FDA(2)="of the DynaMed-IFCAP interface"
"RTN","PRCVIBF",185,0)
 D WP^DIE(441,"999999,",.1,"KA","FDA")
"RTN","PRCVIBF",186,0)
 Q
"RTN","PRCVIBF",187,0)
ERR(N) ;
"RTN","PRCVIBF",188,0)
 ;  if error, send HL7 app ACK of AE
"RTN","PRCVIBF",189,0)
 S N=$P($T(ERCODE+N),";;",2)
"RTN","PRCVIBF",190,0)
 S RTVAL="^"_+N_"^"_$P(N,"^",2)
"RTN","PRCVIBF",191,0)
 Q
"RTN","PRCVIBF",192,0)
ERCODE ;
"RTN","PRCVIBF",193,0)
 ;;201^MISSING TMP GLOBAL
"RTN","PRCVIBF",194,0)
 ;;207^Reference Voucher Number generation failed
"RTN","PRCVIBF",195,0)
 ;;209^Original Transaction ID not found
"RTN","PRCVIBF",196,0)
 ;;211^Adjustment amount missing.
"RTN","PRCVIBF",197,0)
 ;;
"RTN","PRCVIBH")
0^70^B96641654
"RTN","PRCVIBH",1,0)
PRCVIBH ;WOIFO/DST - Issue Book Processing, from DynaMed to IFCAP ;1/25/05  9:17
"RTN","PRCVIBH",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVIBH",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVIBH",4,0)
 ;
"RTN","PRCVIBH",5,0)
 ; IV - Internal Voucher, SV - Standard Voucher
"RTN","PRCVIBH",6,0)
 Q
"RTN","PRCVIBH",7,0)
CRT ; Process Issue Book transactions sent from DynaMed to IFCAP
"RTN","PRCVIBH",8,0)
 K HLERR
"RTN","PRCVIBH",9,0)
 N %,PRCVDT,PRCVI,PRCVJ,PRCVK,PRCVIBF,PRCVSUB,PRCVSITE
"RTN","PRCVIBH",10,0)
 D:'$D(U) DT^DICRW
"RTN","PRCVIBH",11,0)
 D NOW^%DTC S PRCVDT=%
"RTN","PRCVIBH",12,0)
 S PRCVSUB="PRCVFMS2;"_HL("MID")
"RTN","PRCVIBH",13,0)
 K ^TMP(PRCVSUB),^TMP($J,"PRCVIB")
"RTN","PRCVIBH",14,0)
 F PRCVI=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVIBH",15,0)
 . S ^TMP($J,"PRCVIB",PRCVI)=HLNODE,PRCVJ=0
"RTN","PRCVIBH",16,0)
 . F  S PRCVJ=$O(HLNODE(PRCVJ)) Q:'PRCVJ  S ^TMP($J,"PRCVIB",PRCVI,PRCVJ)=HLNODE(PRCVJ)
"RTN","PRCVIBH",17,0)
 . Q
"RTN","PRCVIBH",18,0)
 ; 
"RTN","PRCVIBH",19,0)
MAIN ; Main routine
"RTN","PRCVIBH",20,0)
 ; Check HL7 message type and message event
"RTN","PRCVIBH",21,0)
 ; PRCVEA - Error message array
"RTN","PRCVIBH",22,0)
 ; PRCVTDT - Transaction Date 
"RTN","PRCVIBH",23,0)
 ; PRCVDAC - Document Action
"RTN","PRCVIBH",24,0)
 N PRCVFS,PRCVRS,PRCVCS,PRCVES,PRCVSS,PRCVCC,PRCVSCC
"RTN","PRCVIBH",25,0)
 N PRCVEA,PRCVTDT,PRCVBID,PRCVLID,PRCVND,PRCVSEG,PRCVY,X,X1,X2
"RTN","PRCVIBH",26,0)
 ;
"RTN","PRCVIBH",27,0)
 S PRCVK=0
"RTN","PRCVIBH",28,0)
 S PRCVFS=$G(HL("FS")),PRCVCS=$E($G(HL("ECH"))),PRCVRS=$E($G(HL("ECH")),2),PRCVES=$E($G(HL("ECH")),U,3),PRCVSS=$E($G(HL("ECH")),U,4)
"RTN","PRCVIBH",29,0)
 ;
"RTN","PRCVIBH",30,0)
HEADER I HL("MTN")'="DFT"!(HL("ETN")'="P03") D  Q
"RTN","PRCVIBH",31,0)
 . D ADDERR("PRCV1"_U_"Wrong Message or Event Type: "_HL("MTN")_U_HL("ETN"))
"RTN","PRCVIBH",32,0)
 . D GENACK("AR",HL("MID"),PRCVDT,.PRCVEA)
"RTN","PRCVIBH",33,0)
 . Q
"RTN","PRCVIBH",34,0)
 ;
"RTN","PRCVIBH",35,0)
 S X1=$P(PRCVDT,"."),X2=14 D C^%DTC
"RTN","PRCVIBH",36,0)
 S ^TMP(PRCVSUB,$J,0)=X_U_$P(PRCVDT,".")_"^IB Sent from DynaMed to IFCAP"
"RTN","PRCVIBH",37,0)
 ;
"RTN","PRCVIBH",38,0)
 ; Check each segments - EVN,PID,FT1
"RTN","PRCVIBH",39,0)
 ;   PRCVTCD - Transaction Code - "IV" or "SV"
"RTN","PRCVIBH",40,0)
 ;   PRCVSTN - Station Number
"RTN","PRCVIBH",41,0)
 ;
"RTN","PRCVIBH",42,0)
START N PREVSEG,PRCVSTN,PRCVDAC,PRCVTDT,PRCVTCD
"RTN","PRCVIBH",43,0)
 S PRCVSITE=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVIBH",44,0)
 S PREVSEG=""
"RTN","PRCVIBH",45,0)
 S PRCVI=0
"RTN","PRCVIBH",46,0)
 D NOW^%DTC S PRCVDT=%
"RTN","PRCVIBH",47,0)
 F  S PRCVI=$O(^TMP($J,"PRCVIB",PRCVI)) Q:'PRCVI  D
"RTN","PRCVIBH",48,0)
 . S PRCVND=$G(^TMP($J,"PRCVIB",PRCVI))
"RTN","PRCVIBH",49,0)
 . S PRCVSEG=$P(PRCVND,PRCVFS)
"RTN","PRCVIBH",50,0)
 . Q:PRCVSEG="MSH"!(PRCVSEG="")
"RTN","PRCVIBH",51,0)
 . I $$CHKSEQ(PRCVSEG) K ^TMP($J,"PRCVIB") S PRCVI="" Q
"RTN","PRCVIBH",52,0)
 . S PREVSEG=PRCVSEG
"RTN","PRCVIBH",53,0)
 . D @PRCVSEG
"RTN","PRCVIBH",54,0)
 . Q
"RTN","PRCVIBH",55,0)
 I PRCVSEG'="FT1" D ADDERR("PRCV1"_U_"No Item line for this transaction.")
"RTN","PRCVIBH",56,0)
 ; 
"RTN","PRCVIBH",57,0)
 ; If errored, send AE ACK, clean up and QUIT
"RTN","PRCVIBH",58,0)
ERR I $D(PRCVEA)!(PRCVTCD']"") D XTMP("AE"),FIN Q
"RTN","PRCVIBH",59,0)
OK ; Calling IFCAP and FMS routines for Issue Book and FMS update
"RTN","PRCVIBH",60,0)
 ;
"RTN","PRCVIBH",61,0)
 I PRCVTCD="SV" D
"RTN","PRCVIBH",62,0)
 . I '$$ENT^PRCVFMS2(PRCVSUB) D
"RTN","PRCVIBH",63,0)
 .. D ADDERR("PRCV3"_U_"Error in generating FMS Code Sheet.")
"RTN","PRCVIBH",64,0)
 .. D XTMP("AE")
"RTN","PRCVIBH",65,0)
 .. Q
"RTN","PRCVIBH",66,0)
 . Q
"RTN","PRCVIBH",67,0)
 I PRCVTCD="IV" D
"RTN","PRCVIBH",68,0)
 . S PRCVIBF=$$INIT^PRCVIBF(PRCVSUB)
"RTN","PRCVIBH",69,0)
 . ; PRCVIBF - return "IEN of 410^Error Code^Error Description"
"RTN","PRCVIBH",70,0)
 . ; If errored, move ^TMP to ^XTMP and quit
"RTN","PRCVIBH",71,0)
 . I '+PRCVIBF D  Q
"RTN","PRCVIBH",72,0)
 .. D ADDERR("PRCV3"_U_$P(PRCVIBF,U,2)_"-"_$P(PRCVIBF,U,3))
"RTN","PRCVIBH",73,0)
 .. D XTMP("AE")
"RTN","PRCVIBH",74,0)
 .. Q
"RTN","PRCVIBH",75,0)
 . I '$$ENT^PRCVFMS1(PRCVSUB,+PRCVIBF) D
"RTN","PRCVIBH",76,0)
 .. D ADDERR("PRCV3"_U_"Error in generating FMS Code Sheet.")
"RTN","PRCVIBH",77,0)
 .. D XTMP("AE")
"RTN","PRCVIBH",78,0)
 .. Q
"RTN","PRCVIBH",79,0)
 . Q
"RTN","PRCVIBH",80,0)
 ;
"RTN","PRCVIBH",81,0)
 I '$D(PRCVEA) D GENACK("AA",HL("MID"),PRCVDT)
"RTN","PRCVIBH",82,0)
 D FIN
"RTN","PRCVIBH",83,0)
 Q
"RTN","PRCVIBH",84,0)
 ;
"RTN","PRCVIBH",85,0)
CHKSEQ(SEG) ; SEG - Segment name
"RTN","PRCVIBH",86,0)
 N SEGERR,PREV1,PREV2,PRCVER1
"RTN","PRCVIBH",87,0)
 S SEGERR=0
"RTN","PRCVIBH",88,0)
 S PREV1=$P($P($T(@(SEG_1)),";;",2),U)
"RTN","PRCVIBH",89,0)
 S PREV2=$P($P($T(@(SEG_1)),";;",2),U,2)
"RTN","PRCVIBH",90,0)
 I PREVSEG=PREV1!(PREVSEG=PREV2) Q SEGERR
"RTN","PRCVIBH",91,0)
 S SEGERR=1
"RTN","PRCVIBH",92,0)
 S PRCVER1=$P($P($T(@(SEG_1)),";;",2),U,4)_SEG
"RTN","PRCVIBH",93,0)
 D ADDERR("PRCV1"_U_PRCVER1)
"RTN","PRCVIBH",94,0)
 Q SEGERR
"RTN","PRCVIBH",95,0)
 ;
"RTN","PRCVIBH",96,0)
EVN ; Process EVN segment
"RTN","PRCVIBH",97,0)
 ;
"RTN","PRCVIBH",98,0)
 S PRCVSTN=$P(PRCVND,PRCVFS,8)
"RTN","PRCVIBH",99,0)
 I PRCVSTN']"" D ADDERR("PRCV2"_U_"Station Number is missing.",8)
"RTN","PRCVIBH",100,0)
 I PRCVSTN'=PRCVSITE D ADDERR("PRCV2"_U_"Invalid Station Number: "_PRCVSTN,8)
"RTN","PRCVIBH",101,0)
 S PRCVDAC=$P(PRCVND,PRCVFS,5)
"RTN","PRCVIBH",102,0)
 I "EMX"'[PRCVDAC!(PRCVDAC']"") D ADDERR("PRCV2"_U_"Invalid Document Action: "_PRCVDAC,5)
"RTN","PRCVIBH",103,0)
 S PRCVTDT=$P(PRCVND,PRCVFS,3)
"RTN","PRCVIBH",104,0)
 I PRCVTDT']"" D ADDERR("PRCV2"_U_"Transaction Date is missing.",3) Q
"RTN","PRCVIBH",105,0)
 S PRCVTDT=$$HL7TFM^XLFDT(PRCVTDT,"L",0)
"RTN","PRCVIBH",106,0)
 I $P(PRCVTDT,".")>PRCVDT D ADDERR("PRCV2"_U_"Invalid Transaction Date: "_PRCVTDT,3)
"RTN","PRCVIBH",107,0)
 Q
"RTN","PRCVIBH",108,0)
 ;
"RTN","PRCVIBH",109,0)
PID ; Process PID segment
"RTN","PRCVIBH",110,0)
 ;
"RTN","PRCVIBH",111,0)
 N PRCVDUZ,PRCVFCP1,PRCVFCP2,PRCVBOC,PRCVTERM
"RTN","PRCVIBH",112,0)
 ;
"RTN","PRCVIBH",113,0)
 S PRCVBID=$P(PRCVND,PRCVFS,4)
"RTN","PRCVIBH",114,0)
 I PRCVBID']"" D ADDERR("PRCV2"_U_"Batch ID is missing.",4)
"RTN","PRCVIBH",115,0)
 S PRCVTCD=$P(PRCVND,PRCVFS,5)
"RTN","PRCVIBH",116,0)
 I PRCVTCD']"" D ADDERR("PRCV2"_U_"Transaction Code is missing.",5)
"RTN","PRCVIBH",117,0)
 I PRCVTCD'="IV",(PRCVTCD'="SV") D ADDERR("PRCV2"_U_"Invalid Transaction Code: "_PRCVTCD,5)
"RTN","PRCVIBH",118,0)
 ; Check User ID, Termination Date and is authorized FCP user
"RTN","PRCVIBH",119,0)
 S PRCVDUZ=$P(PRCVND,PRCVFS,3)
"RTN","PRCVIBH",120,0)
 I PRCVDUZ']"" D ADDERR("PRCV2"_U_"User ID is missing.",3)
"RTN","PRCVIBH",121,0)
 I PRCVDUZ]"" D
"RTN","PRCVIBH",122,0)
 . I '$$FIND1^DIC(200,"","","`"_PRCVDUZ,"","","PRCVERR") D ADDERR("PRCV2"_U_"Invalid User ID: "_PRCVDUZ,3)
"RTN","PRCVIBH",123,0)
 . E  D
"RTN","PRCVIBH",124,0)
 .. S PRCVTERM=$$GET1^DIQ(200,PRCVDUZ_",",9.2,"I")
"RTN","PRCVIBH",125,0)
 .. I +PRCVTERM>0,(PRCVTERM<DT) D ADDERR("PRCV2"_U_"Invalid User ID: "_PRCVDUZ,3)
"RTN","PRCVIBH",126,0)
 .. Q
"RTN","PRCVIBH",127,0)
 .Q
"RTN","PRCVIBH",128,0)
 S PRCVFCP1=$P(PRCVND,PRCVFS,22)
"RTN","PRCVIBH",129,0)
 I PRCVFCP1']"" D ADDERR("PRCV2"_U_$S(PRCVTCD="IV":"Seller's",1:"Warehouse's")_" Fund Control Point is missing.",22)
"RTN","PRCVIBH",130,0)
 I '$D(^PRC(420,PRCVSITE,1,+PRCVFCP1)) D ADDERR("PRCV2"_U_"Invalid "_$S(PRCVTCD="IV":"Seller's",1:"Warehouse's")_" Fund Control Point.",22)
"RTN","PRCVIBH",131,0)
 I $D(^PRC(420,PRCVSITE,1,+PRCVFCP1)),$P(^PRC(420,PRCVSITE,1,+PRCVFCP1,0),U,19) D ADDERR("PRCV2"_U_"Inactivated "_$S(PRCVTCD="IV":"Seller's",1:"Warehouse's")_" Fund Control Point.",22)
"RTN","PRCVIBH",132,0)
 I PRCVTCD="IV" D
"RTN","PRCVIBH",133,0)
 . S PRCVFCP2=$P(PRCVND,PRCVFS,24)
"RTN","PRCVIBH",134,0)
 . I PRCVFCP2']"" D ADDERR("PRCV2"_U_"Buyer's Fund Control Point is missing.",24)
"RTN","PRCVIBH",135,0)
 . E  D
"RTN","PRCVIBH",136,0)
 .. I '$D(^PRC(420,PRCVSITE,1,+PRCVFCP2)) D ADDERR("PRCV2"_U_"Invalid Buyer's Fund Control Point.",24)
"RTN","PRCVIBH",137,0)
 .. I $D(^PRC(420,PRCVSITE,1,+PRCVFCP2)),$P(^PRC(420,PRCVSITE,1,+PRCVFCP2,0),U,19) D ADDERR("PRCV2"_U_"Inactivated Buyer's Fund Control Point.",24)
"RTN","PRCVIBH",138,0)
 .. Q
"RTN","PRCVIBH",139,0)
 . S PRCVCC=$P(PRCVND,PRCVFS,19)
"RTN","PRCVIBH",140,0)
 . I PRCVCC']"" D ADDERR("PRCV2"_U_"Buyer's Cost Center is missing.",19)
"RTN","PRCVIBH",141,0)
 . S PRCVSCC=$P(PRCVND,PRCVFS,20)
"RTN","PRCVIBH",142,0)
 . I PRCVSCC']"" D ADDERR("PRCV2"_U_"Buyer's Sub-cost Center is missing.",20)
"RTN","PRCVIBH",143,0)
 . I PRCVCC,(PRCVSCC'="") D
"RTN","PRCVIBH",144,0)
 .. I '$D(^PRCD(420.1,PRCVCC_PRCVSCC)) D ADDERR("PRCV2"_U_"Invalid Buyer's Cost Center. Cost Center not defined in Cost Center file 420.1",19) Q
"RTN","PRCVIBH",145,0)
 .. I '$D(^PRC(420,PRCVSTN,1,+PRCVFCP2,2,PRCVCC_PRCVSCC)) D ADDERR("PRCV2"_U_"Invalid Buyer's Cost Center. Cost Center not used for this Fund Control Point.",19)
"RTN","PRCVIBH",146,0)
 .. Q
"RTN","PRCVIBH",147,0)
 . Q
"RTN","PRCVIBH",148,0)
 I PRCVDUZ]"",('$D(^PRC(420,PRCVSTN,1,$S(PRCVTCD="IV":+PRCVFCP2,1:+PRCVFCP1),1,PRCVDUZ))) D ADDERR("PRCV2"_U_"Unauthorized User for this FCP.",3)
"RTN","PRCVIBH",149,0)
 S ^TMP(PRCVSUB,$J,1)=PRCVSTN_U_PRCVBID_U_PRCVTCD_U_PRCVDAC_U_PRCVTDT_U_PRCVDUZ
"RTN","PRCVIBH",150,0)
 S ^TMP(PRCVSUB,$J,2)=PRCVFCP1_U_$G(PRCVFCP2)_U_$G(PRCVCC)_U_$G(PRCVSCC)
"RTN","PRCVIBH",151,0)
 Q
"RTN","PRCVIBH",152,0)
 ;
"RTN","PRCVIBH",153,0)
FT1 ; Process FT1 segment
"RTN","PRCVIBH",154,0)
 N PRCVACC,PRCVBOC,PRCVINV,PRCVSAL,PRCVRCD
"RTN","PRCVIBH",155,0)
 ;
"RTN","PRCVIBH",156,0)
 S PRCVLID=$P(PRCVND,PRCVFS,3)
"RTN","PRCVIBH",157,0)
 I 'PRCVLID D ADDERR("PRCV2"_U_"Line ID is missing.",3)
"RTN","PRCVIBH",158,0)
 S PRCVACC=$P(PRCVND,PRCVFS,9)
"RTN","PRCVIBH",159,0)
 I 'PRCVACC D ADDERR("PRCV2"_U_"Account Code is missing.",9)
"RTN","PRCVIBH",160,0)
 I PRCVACC,((PRCVACC'?1N)!("12368"'[PRCVACC)) D ADDERR("PRCV2"_U_"Invalid Account Code: "_PRCVACC,9)
"RTN","PRCVIBH",161,0)
 I PRCVTCD="IV" D
"RTN","PRCVIBH",162,0)
 . S PRCVBOC=$P(PRCVND,PRCVFS,10)
"RTN","PRCVIBH",163,0)
 . I 'PRCVBOC D ADDERR("PRCV2"_U_"Budget Object Code is missing.",10)
"RTN","PRCVIBH",164,0)
 . I '$D(^PRCD(420.1,PRCVCC_PRCVSCC,1,PRCVBOC)) D ADDERR("PRCV2"_U_"Invalid Budget Object Code for this Cost Center: "_PRCVBOC,10)
"RTN","PRCVIBH",165,0)
 . I $P($G(^PRCD(420.2,PRCVBOC,0)),"^",2)=1 D ADDERR("PRCV2"_U_"Inactivated Budget Object Code."_PRCVBOC,10)
"RTN","PRCVIBH",166,0)
 . S PRCVSAL=$P(PRCVND,PRCVFS,13)
"RTN","PRCVIBH",167,0)
 . I 'PRCVSAL D ADDERR("PRCV2"_U_"Sale Value is missing.",13)
"RTN","PRCVIBH",168,0)
 . Q
"RTN","PRCVIBH",169,0)
 S PRCVINV=$P(PRCVND,PRCVFS,12)
"RTN","PRCVIBH",170,0)
 I 'PRCVINV D ADDERR("PRCV2"_U_"Inventory Value is missing.",12)
"RTN","PRCVIBH",171,0)
 I PRCVTCD="SV" D
"RTN","PRCVIBH",172,0)
 . S PRCVRCD=$P(PRCVND,PRCVFS,8)
"RTN","PRCVIBH",173,0)
 . I PRCVRCD']"" D ADDERR("PRCV2"_U_"Reason Code is missing.",8)
"RTN","PRCVIBH",174,0)
 . I PRCVRCD'?1N!(PRCVRCD<1)!(PRCVRCD>7) D ADDERR("PRCV2"_U_"Invalid Reason Code: "_PRCVRCD,8)
"RTN","PRCVIBH",175,0)
 . Q
"RTN","PRCVIBH",176,0)
 S ^TMP(PRCVSUB,$J,3,0)=PRCVLID
"RTN","PRCVIBH",177,0)
 S ^TMP(PRCVSUB,$J,3,PRCVLID,0)=PRCVLID_U_PRCVACC_U_$G(PRCVBOC)_U_PRCVINV_U_$G(PRCVSAL)_U_$G(PRCVRCD)
"RTN","PRCVIBH",178,0)
 Q
"RTN","PRCVIBH",179,0)
 ;
"RTN","PRCVIBH",180,0)
GENACK(PRCVAC,PRCVMCID,PRCVDT,PRCVOCCR) ;
"RTN","PRCVIBH",181,0)
 ;
"RTN","PRCVIBH",182,0)
 ;PRCVAC - Acknowledgment Code
"RTN","PRCVIBH",183,0)
 ;PRCVMCID - Message Control ID which you're acknowledging
"RTN","PRCVIBH",184,0)
 ;PRCVDT - Date/Time of Transaction
"RTN","PRCVIBH",185,0)
 ;PRCVOCCR - Error message array
"RTN","PRCVIBH",186,0)
 ;
"RTN","PRCVIBH",187,0)
 N PRCVFS,PRCVCNT,PRCVCS,PRCVI,PRCVJ,PRCVND,PRCVRES
"RTN","PRCVIBH",188,0)
 ;
"RTN","PRCVIBH",189,0)
 S PRCVFS=$G(HL("FS")),PRCVCS=$E($G(HL("ECH"))),PRCVRS=$E($G(HL("ECH")),2),PRCVES=$E($G(HL("ECH")),U,3),PRCVSS=$E($G(HL("ECH")),U,4)
"RTN","PRCVIBH",190,0)
 S PRCVRES="",PRCVJ=0,PRCVI=1
"RTN","PRCVIBH",191,0)
 ;
"RTN","PRCVIBH",192,0)
 ; MSA Segment
"RTN","PRCVIBH",193,0)
 S HLA("HLA",1)="MSA"_PRCVFS_PRCVAC_PRCVFS_PRCVMCID_PRCVFS_$G(PRCVBID)
"RTN","PRCVIBH",194,0)
 ; 
"RTN","PRCVIBH",195,0)
 ; ERR Segment
"RTN","PRCVIBH",196,0)
 I $G(PRCVOCCR)'="" D
"RTN","PRCVIBH",197,0)
 . F  S PRCVJ=$O(PRCVOCCR(PRCVJ)) Q:'PRCVJ  D
"RTN","PRCVIBH",198,0)
 .. S PRCVI=PRCVI+1
"RTN","PRCVIBH",199,0)
 .. S HLA("HLA",PRCVI)="ERR"_PRCVFS_PRCVOCCR(PRCVJ)
"RTN","PRCVIBH",200,0)
 .. Q
"RTN","PRCVIBH",201,0)
 . Q
"RTN","PRCVIBH",202,0)
 ;
"RTN","PRCVIBH",203,0)
 D GENACK^HLMA1(HL("EID"),$G(HLMTIENS),HL("EIDS"),"LM",1,PRCVRES)
"RTN","PRCVIBH",204,0)
 I $P($G(PRCVRES),U,2) D
"RTN","PRCVIBH",205,0)
 . K XMB,XMZ
"RTN","PRCVIBH",206,0)
 . S XMB="PRCV HL7 ERROR"
"RTN","PRCVIBH",207,0)
 . S XMB(1)="PRCVIB"
"RTN","PRCVIBH",208,0)
 . S XMB(2)="Application Acknowledgement"
"RTN","PRCVIBH",209,0)
 . S XMB(3)="PRCV_IFCAP_06_SU_IB_PROC"
"RTN","PRCVIBH",210,0)
 . S XMB(4)=PRCVRES
"RTN","PRCVIBH",211,0)
 . S XMDUZ="PRCV HL7 Generator"
"RTN","PRCVIBH",212,0)
 . D ^XMB
"RTN","PRCVIBH",213,0)
 . K XMB,XMDUZ,XMZ
"RTN","PRCVIBH",214,0)
 . Q
"RTN","PRCVIBH",215,0)
 ;
"RTN","PRCVIBH",216,0)
 K HLA("HLA"),^TMP("HLA",$J)
"RTN","PRCVIBH",217,0)
 K PRCVAC,X
"RTN","PRCVIBH",218,0)
 Q
"RTN","PRCVIBH",219,0)
 ;
"RTN","PRCVIBH",220,0)
ADDERR(PRCVER,PRCVFD) ;
"RTN","PRCVIBH",221,0)
 ; PRCVER - Error message
"RTN","PRCVIBH",222,0)
 ; PRCVFD - Field number, if any 
"RTN","PRCVIBH",223,0)
 ;
"RTN","PRCVIBH",224,0)
 S PRCVK=PRCVK+1
"RTN","PRCVIBH",225,0)
 S PRCVEA=PRCVK
"RTN","PRCVIBH",226,0)
 S:'$G(PRCVLID) PRCVLID=1
"RTN","PRCVIBH",227,0)
 S:'$G(PRCVFD) PRCVLID="",PRCVFD=""
"RTN","PRCVIBH",228,0)
 S PRCVEA(PRCVK)=PRCVFS_$G(PRCVSEG)_U_PRCVLID_U_PRCVFD_PRCVFS_"207^Application Internal Error^HL70357"_PRCVFS_"E"_PRCVFS_PRCVER_PRCVFS_PRCVLID
"RTN","PRCVIBH",229,0)
 Q
"RTN","PRCVIBH",230,0)
 ;
"RTN","PRCVIBH",231,0)
XTMP(AC) ; Move ^TMP(PRCVSUB,$j) to ^XTMP
"RTN","PRCVIBH",232,0)
 ;
"RTN","PRCVIBH",233,0)
 ; AC - Acknowledgement
"RTN","PRCVIBH",234,0)
 ;
"RTN","PRCVIBH",235,0)
 S ^XTMP(PRCVSUB,0)=$$FMADD^XLFDT(PRCVDT,14)_U_PRCVDT_U_"IB Data from DynaMed with error"
"RTN","PRCVIBH",236,0)
 F PRCVI=1,2 S ^XTMP(PRCVSUB,PRCVI)=^TMP(PRCVSUB,$J,PRCVI)
"RTN","PRCVIBH",237,0)
 I $D(^TMP(PRCVSUB,$J,3,0)) D
"RTN","PRCVIBH",238,0)
 . S ^XTMP(PRCVSUB,3,0)=^TMP(PRCVSUB,$J,3,0)
"RTN","PRCVIBH",239,0)
 . S PRCVI=0
"RTN","PRCVIBH",240,0)
 . F  S PRCVI=$O(^TMP(PRCVSUB,$J,3,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIBH",241,0)
 .. S ^XTMP(PRCVSUB,3,PRCVI)=^TMP(PRCVSUB,$J,3,PRCVI,0)
"RTN","PRCVIBH",242,0)
 .. Q
"RTN","PRCVIBH",243,0)
 D GENACK(AC,HL("MID"),PRCVDT,.PRCVEA)
"RTN","PRCVIBH",244,0)
 S ^XTMP(PRCVSUB,4,0)=PRCVEA
"RTN","PRCVIBH",245,0)
 S PRCVI=0
"RTN","PRCVIBH",246,0)
 F  S PRCVI=$O(PRCVEA(PRCVI)) Q:'PRCVI  D
"RTN","PRCVIBH",247,0)
 . S ^XTMP(PRCVSUB,4,PRCVI)=PRCVEA(PRCVI)
"RTN","PRCVIBH",248,0)
 . Q
"RTN","PRCVIBH",249,0)
 Q
"RTN","PRCVIBH",250,0)
 ;
"RTN","PRCVIBH",251,0)
FIN ; Clean up
"RTN","PRCVIBH",252,0)
 ;
"RTN","PRCVIBH",253,0)
 ; K ^TMP($J,"PRCVIB")
"RTN","PRCVIBH",254,0)
 ; K ^TMP(PRCVSUB,$J)
"RTN","PRCVIBH",255,0)
 K PRCVEA
"RTN","PRCVIBH",256,0)
 Q
"RTN","PRCVIBH",257,0)
 ;
"RTN","PRCVIBH",258,0)
TXT ; 
"RTN","PRCVIBH",259,0)
EVN1 ;;^EVN^^Missing segment ^100^Missing line item info.
"RTN","PRCVIBH",260,0)
PID1 ;;EVN^^^Missing segment ^100^Missing line item info.
"RTN","PRCVIBH",261,0)
FT11 ;;PID^FT1^^Missing segment ^100^Missing line item info.
"RTN","PRCVIMF")
0^7^B80508200
"RTN","PRCVIMF",1,0)
PRCVIMF ;WOIFO/DST - DynaMed ITEM update HL7 messaging interface; 03/07/05
"RTN","PRCVIMF",2,0)
 ;;5.1;IFCAP;**81**;Oct 20,2000
"RTN","PRCVIMF",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVIMF",4,0)
 ;
"RTN","PRCVIMF",5,0)
 Q
"RTN","PRCVIMF",6,0)
 ;
"RTN","PRCVIMF",7,0)
EN(PRCVIN) ;Entry point for API Call
"RTN","PRCVIMF",8,0)
 ;
"RTN","PRCVIMF",9,0)
 N PRCVSEG,PRCVFLD,PRCVFS,PRCVCS,PRCVRS,PRCVI,PRCVN,PRCVCON
"RTN","PRCVIMF",10,0)
 N PRCVDT1,PRCVDUZ,PRCVND0,PRCVND2,PRCVND3,PRCVSTN,PRCVUP,PRCVERR
"RTN","PRCVIMF",11,0)
 N PRCVDP,PRCVPRO
"RTN","PRCVIMF",12,0)
 K HLA
"RTN","PRCVIMF",13,0)
 ;
"RTN","PRCVIMF",14,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 Q
"RTN","PRCVIMF",15,0)
 I $D(PRCVIN)=0 Q
"RTN","PRCVIMF",16,0)
 S PRCVN=0
"RTN","PRCVIMF",17,0)
 D HDRBLD
"RTN","PRCVIMF",18,0)
 I $G(PRCVERR) D FIN Q
"RTN","PRCVIMF",19,0)
 D MSGBLD
"RTN","PRCVIMF",20,0)
 ;
"RTN","PRCVIMF",21,0)
 S PRCVDP=""
"RTN","PRCVIMF",22,0)
 D GENERATE^HLMA(PRCVPRO,"LM",1,.PRCVDP)
"RTN","PRCVIMF",23,0)
 I +$P(PRCVDP,U,2) S PRCVERR(1)="Error generating message through VistA HL7 package for ITEM Update with ITEM # "_PRCVIN D CLIFP
"RTN","PRCVIMF",24,0)
 D FIN
"RTN","PRCVIMF",25,0)
 ;
"RTN","PRCVIMF",26,0)
 Q
"RTN","PRCVIMF",27,0)
 ;
"RTN","PRCVIMF",28,0)
HDRBLD ;Generate message header, MFI Segment
"RTN","PRCVIMF",29,0)
 ;
"RTN","PRCVIMF",30,0)
 K HL S PRCVPRO="PRCV_IFCAP_05_EV_ITEM_UPD"
"RTN","PRCVIMF",31,0)
 D INIT^HLFNC2(PRCVPRO,.HL)
"RTN","PRCVIMF",32,0)
 I $G(HL) S PRCVERR(1)="Error generating message through VistA HL7 package for ITEM Update involving ITEM # "_PRCVIN D CLIFP Q
"RTN","PRCVIMF",33,0)
 S PRCVCS=$E(HL("ECH")),PRCVRS=$E(HL("ECH"),2),PRCVFS=HL("FS")
"RTN","PRCVIMF",34,0)
 ;
"RTN","PRCVIMF",35,0)
 ;PRCVDT Transaction Date/Time w/offset
"RTN","PRCVIMF",36,0)
 D NOW^%DTC
"RTN","PRCVIMF",37,0)
 S PRCVDT=$$FMTHL7^XLFDT(%)
"RTN","PRCVIMF",38,0)
 ;
"RTN","PRCVIMF",39,0)
 ;Build MFI Segment
"RTN","PRCVIMF",40,0)
 S PRCVN=PRCVN+1
"RTN","PRCVIMF",41,0)
 S HLA("HLS",PRCVN)="MFI"_PRCVFS_"OME"_PRCVFS_"441"_PRCVCS_"ITEM MASTER"_PRCVFS_"UPD"_PRCVFS_PRCVDT_PRCVFS_PRCVFS_"AL"
"RTN","PRCVIMF",42,0)
 ;
"RTN","PRCVIMF",43,0)
 Q
"RTN","PRCVIMF",44,0)
 ;
"RTN","PRCVIMF",45,0)
MSGBLD ; Build Message Body
"RTN","PRCVIMF",46,0)
 ; PRCVFLD - Field
"RTN","PRCVIMF",47,0)
 ;
"RTN","PRCVIMF",48,0)
 ; ITEM short description
"RTN","PRCVIMF",49,0)
 S PRCVND0=^TMP("PRCVIT",$J,PRCVIN,0)
"RTN","PRCVIMF",50,0)
 S PRCVFLD=$$CONV^PRCVUTSC($P(PRCVND0,U,2),"C",HLFS_HLECH)
"RTN","PRCVIMF",51,0)
 ; Station Number
"RTN","PRCVIMF",52,0)
 S PRCVSTN=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVIMF",53,0)
 ; 
"RTN","PRCVIMF",54,0)
 ; MFE segment
"RTN","PRCVIMF",55,0)
 ;
"RTN","PRCVIMF",56,0)
 S PRCVN=PRCVN+1
"RTN","PRCVIMF",57,0)
 S HLA("HLS",PRCVN)="MFE"_PRCVFS_"MUP"_PRCVFS_PRCVIN_PRCVFS_PRCVDT_PRCVFS_PRCVIN_PRCVCS_PRCVFLD_PRCVCS_PRCVSTN_PRCVFS_"CE"
"RTN","PRCVIMF",58,0)
 ;
"RTN","PRCVIMF",59,0)
 ; ZIT segment
"RTN","PRCVIMF",60,0)
 ;
"RTN","PRCVIMF",61,0)
 N PRCVN1,PRCVNM
"RTN","PRCVIMF",62,0)
 S PRCVN=PRCVN+1
"RTN","PRCVIMF",63,0)
 S PRCVN1=1
"RTN","PRCVIMF",64,0)
 S PRCVND3=$G(^TMP("PRCVIT",$J,PRCVIN,3))
"RTN","PRCVIMF",65,0)
 ; Case/Cart Tray/instrument kit
"RTN","PRCVIMF",66,0)
 S HLA("HLS",PRCVN)="ZIT"_PRCVFS_PRCVSTN_PRCVFS_$P(PRCVND0,U,6)_PRCVFS
"RTN","PRCVIMF",67,0)
 ; Description (Word Processing field)
"RTN","PRCVIMF",68,0)
 I $D(^TMP("PRCVIT",$J,PRCVIN,1)) D
"RTN","PRCVIMF",69,0)
 . S PRCVFLD=$$CONV^PRCVUTSC(^TMP("PRCVIT",$J,PRCVIN,1,1),"C",HLFS_HLECH)
"RTN","PRCVIMF",70,0)
 . S HLA("HLS",PRCVN,PRCVN1)=PRCVFLD
"RTN","PRCVIMF",71,0)
 . S PRCVI=1
"RTN","PRCVIMF",72,0)
 . F  S PRCVI=$O(^TMP("PRCVIT",$J,PRCVIN,1,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIMF",73,0)
 .. S PRCVN1=PRCVN1+1
"RTN","PRCVIMF",74,0)
 .. S HLA("HLS",PRCVN,PRCVN1)=PRCVRS_$$CONV^PRCVUTSC(^TMP("PRCVIT",$J,PRCVIN,1,PRCVI),"C",HLFS_HLECH)
"RTN","PRCVIMF",75,0)
 .. Q
"RTN","PRCVIMF",76,0)
 . Q
"RTN","PRCVIMF",77,0)
 S PRCVSEG=PRCVFS
"RTN","PRCVIMF",78,0)
 ; FSC
"RTN","PRCVIMF",79,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND0,U,3)_PRCVFS
"RTN","PRCVIMF",80,0)
 ; National Stock Number
"RTN","PRCVIMF",81,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND0,U,5)_PRCVFS
"RTN","PRCVIMF",82,0)
 ; National Stock Number Verified Date
"RTN","PRCVIMF",83,0)
 I $P(PRCVND3,U,6)'="" S PRCVSEG=PRCVSEG_$$FMTHL7^XLFDT($P(PRCVND3,U,6))
"RTN","PRCVIMF",84,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",85,0)
 ; Hazardous Material
"RTN","PRCVIMF",86,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND0,U,14)_PRCVFS
"RTN","PRCVIMF",87,0)
 S PRCVFLD=""
"RTN","PRCVIMF",88,0)
 ; Last Vendor Ordered
"RTN","PRCVIMF",89,0)
 I $P(PRCVND0,U,4)'="" S PRCVFLD=$P(PRCVND0,U,4)_PRCVCS_$P(^PRC(440,$P(PRCVND0,U,4),0),U)_PRCVCS_PRCVSTN
"RTN","PRCVIMF",90,0)
 S PRCVSEG=PRCVSEG_PRCVFLD_PRCVFS
"RTN","PRCVIMF",91,0)
 ; Mandatory Source
"RTN","PRCVIMF",92,0)
 S PRCVFLD=""
"RTN","PRCVIMF",93,0)
 I $P(PRCVND0,U,7)'="" S PRCVFLD=$P(PRCVND0,U,7)_PRCVCS_$P(^PRC(440,$P(PRCVND0,U,7),0),U)_PRCVCS_PRCVSTN
"RTN","PRCVIMF",94,0)
 S PRCVSEG=PRCVSEG_PRCVFLD_PRCVFS
"RTN","PRCVIMF",95,0)
 ; Budget Object Code
"RTN","PRCVIMF",96,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND0,U,9)_PRCVFS
"RTN","PRCVIMF",97,0)
 ; Created/Inactivated By
"RTN","PRCVIMF",98,0)
 S PRCVDUZ=$P(PRCVND0,U,10)
"RTN","PRCVIMF",99,0)
 S PRCVDT1=""
"RTN","PRCVIMF",100,0)
 I PRCVDUZ]"" D
"RTN","PRCVIMF",101,0)
 . I $P(PRCVND0,U,8)]"" S PRCVDT1=$$FMTHL7^XLFDT($P(PRCVND0,U,8))
"RTN","PRCVIMF",102,0)
 . S PRCVNM("FILE")=200,PRCVNM("FIELD")=.01,PRCVNM("IENS")=PRCVDUZ_","
"RTN","PRCVIMF",103,0)
 . S PRCVFLD=$P($$HLNAME^XLFNAME(.PRCVNM," ","^"),"^",1,2)
"RTN","PRCVIMF",104,0)
 . S PRCVFLD=PRCVDUZ_PRCVCS_$P(PRCVFLD,"^")_PRCVCS_$P(PRCVFLD,"^",2)_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVSTN_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVDT1
"RTN","PRCVIMF",105,0)
 . I ($P(PRCVND3,U)]"")!($P(PRCVND3,U,3)]"") D
"RTN","PRCVIMF",106,0)
 .. S PRCVDUZ=$P(PRCVND3,U,3)
"RTN","PRCVIMF",107,0)
 .. S PRCVDT1=""
"RTN","PRCVIMF",108,0)
 .. S PRCVSEG=PRCVSEG_PRCVFLD_PRCVRS
"RTN","PRCVIMF",109,0)
 .. I $P(PRCVND3,U,2)]"" S PRCVDT1=$$FMTHL7^XLFDT($P(PRCVND3,U,2))
"RTN","PRCVIMF",110,0)
 .. S PRCVNM("FILE")=200,PRCVNM("FIELD")=.01,PRCVNM("IENS")=PRCVDUZ_","
"RTN","PRCVIMF",111,0)
 .. S PRCVFLD=$P($$HLNAME^XLFNAME(.PRCVNM," ","^"),"^",1,2)
"RTN","PRCVIMF",112,0)
 .. S PRCVFLD=PRCVDUZ_PRCVCS_$P(PRCVFLD,"^")_PRCVCS_$P(PRCVFLD,"^",2)_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVSTN_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVDT1
"RTN","PRCVIMF",113,0)
 .. Q
"RTN","PRCVIMF",114,0)
 . S PRCVSEG=PRCVSEG_PRCVFLD
"RTN","PRCVIMF",115,0)
 . Q
"RTN","PRCVIMF",116,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",117,0)
 ; Replacement Item
"RTN","PRCVIMF",118,0)
 I $P(PRCVND3,U,4)>0 D
"RTN","PRCVIMF",119,0)
 . S PRCVFLD=$$CONV^PRCVUTSC($P(^PRC(441,$P(PRCVND3,U,4),0),U,2),"C",HLFS_HLECH)
"RTN","PRCVIMF",120,0)
 . S PRCVFLD=$P(PRCVND3,U,4)_PRCVCS_PRCVFLD_PRCVCS_PRCVSTN
"RTN","PRCVIMF",121,0)
 . S PRCVSEG=PRCVSEG_PRCVFLD
"RTN","PRCVIMF",122,0)
 . Q
"RTN","PRCVIMF",123,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",124,0)
 ; MFG Part No.
"RTN","PRCVIMF",125,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND3,U,5)_PRCVFS
"RTN","PRCVIMF",126,0)
 ; Food Group
"RTN","PRCVIMF",127,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND3,U,7)_PRCVFS
"RTN","PRCVIMF",128,0)
 ; Stock Keeping Unit - SKU (required field in DynaMed)
"RTN","PRCVIMF",129,0)
 S PRCVFLD=$P(PRCVND3,U,8)
"RTN","PRCVIMF",130,0)
 ; If no SKU in IFCAP, set default to "EACH"
"RTN","PRCVIMF",131,0)
 I PRCVFLD']"" S PRCVFLD=$O(^PRCD(420.5,"C","EACH",0))
"RTN","PRCVIMF",132,0)
 S PRCVFLD=$P(^PRCD(420.5,PRCVFLD,0),U)_PRCVCS_$P(^PRCD(420.5,PRCVFLD,0),U,2)_PRCVCS_"IFCAP"
"RTN","PRCVIMF",133,0)
 S PRCVSEG=PRCVSEG_PRCVFLD_PRCVFS
"RTN","PRCVIMF",134,0)
 ; Drug Type Code
"RTN","PRCVIMF",135,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND3,U,9)_PRCVFS
"RTN","PRCVIMF",136,0)
 ; Reusable Item Indicator
"RTN","PRCVIMF",137,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND0,U,11)_PRCVFS
"RTN","PRCVIMF",138,0)
 ; Standard Industrial Classification Code - SIC Code
"RTN","PRCVIMF",139,0)
 S PRCVSEG=PRCVSEG_$P(PRCVND3,U,10)_PRCVFS
"RTN","PRCVIMF",140,0)
 ;
"RTN","PRCVIMF",141,0)
 S PRCVN1=PRCVN1+1
"RTN","PRCVIMF",142,0)
 S HLA("HLS",PRCVN,PRCVN1)=PRCVSEG
"RTN","PRCVIMF",143,0)
 ; Pre_NIF_Long Description (Word Processing field)
"RTN","PRCVIMF",144,0)
 S PRCVFLD=""
"RTN","PRCVIMF",145,0)
 I $D(^TMP("PRCVIT",$J,PRCVIN,6)) D
"RTN","PRCVIMF",146,0)
 . S PRCVN1=PRCVN1+1
"RTN","PRCVIMF",147,0)
 . S PRCVFLD=$$CONV^PRCVUTSC(^TMP("PRCVIT",$J,PRCVIN,6,1),"C",HLFS_HLECH)
"RTN","PRCVIMF",148,0)
 . S HLA("HLS",PRCVN,PRCVN1)=PRCVFLD
"RTN","PRCVIMF",149,0)
 . S PRCVI=1
"RTN","PRCVIMF",150,0)
 . F  S PRCVI=$O(^TMP("PRCVIT",$J,PRCVIN,6,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIMF",151,0)
 .. S PRCVN1=PRCVN1+1
"RTN","PRCVIMF",152,0)
 .. S HLA("HLS",PRCVN,PRCVN1)=PRCVRS_$$CONV^PRCVUTSC(^TMP("PRCVIT",$J,PRCVIN,6,PRCVI),"C",HLFS_HLECH)
"RTN","PRCVIMF",153,0)
 .. Q
"RTN","PRCVIMF",154,0)
 . Q
"RTN","PRCVIMF",155,0)
 S HLA("HLS",PRCVN,PRCVN1)=HLA("HLS",PRCVN,PRCVN1)_PRCVFS
"RTN","PRCVIMF",156,0)
 ; NIF Item Number
"RTN","PRCVIMF",157,0)
 ; Last part of ZIT Segment
"RTN","PRCVIMF",158,0)
 I $P($G(PRCVND0),U,13) D
"RTN","PRCVIMF",159,0)
 . S PRCVN1=PRCVN1+1
"RTN","PRCVIMF",160,0)
 . S HLA("HLS",PRCVN,PRCVN1)=$P(PRCVND0,U,13)
"RTN","PRCVIMF",161,0)
 . Q
"RTN","PRCVIMF",162,0)
 ;
"RTN","PRCVIMF",163,0)
 ; ZCP segments
"RTN","PRCVIMF",164,0)
 ;
"RTN","PRCVIMF",165,0)
 S PRCVSEG=""
"RTN","PRCVIMF",166,0)
 S PRCVI=0
"RTN","PRCVIMF",167,0)
 F  S PRCVI=$O(^TMP("PRCVIT",$J,PRCVIN,4,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIMF",168,0)
 . S PRCVSEG=^TMP("PRCVIT",$J,PRCVIN,4,PRCVI)
"RTN","PRCVIMF",169,0)
 . S PRCVSEG=$P(PRCVSEG,U)_PRCVFS_$P(PRCVSEG,U,2)_PRCVFS_$P(PRCVSEG,U,3)
"RTN","PRCVIMF",170,0)
 . I $P(PRCVSEG,"|",3)]"" S PRCVSEG=PRCVSEG_PRCVCS_$P(^PRC(440,$P(PRCVSEG,"|",3),0),U)_PRCVCS_PRCVSTN
"RTN","PRCVIMF",171,0)
 . S PRCVN=PRCVN+1
"RTN","PRCVIMF",172,0)
 . S HLA("HLS",PRCVN)="ZCP"_PRCVFS_PRCVSEG
"RTN","PRCVIMF",173,0)
 . Q
"RTN","PRCVIMF",174,0)
 I $D(^TMP("PRCVIT",$J,PRCVIN,2)) D
"RTN","PRCVIMF",175,0)
 . S PRCVI=0
"RTN","PRCVIMF",176,0)
 . F  S PRCVI=$O(^TMP("PRCVIT",$J,PRCVIN,2,PRCVI)) Q:'PRCVI  D ZVI
"RTN","PRCVIMF",177,0)
 . Q
"RTN","PRCVIMF",178,0)
 ;
"RTN","PRCVIMF",179,0)
 Q
"RTN","PRCVIMF",180,0)
 ;
"RTN","PRCVIMF",181,0)
 ; Clean trailing BAR "|" - not used for now
"RTN","PRCVIMF",182,0)
BAR ;
"RTN","PRCVIMF",183,0)
 ; N PRCVL,PRCVL1
"RTN","PRCVIMF",184,0)
 ; S PRCVI=2
"RTN","PRCVIMF",185,0)
 ; F  S PRCVI=$O(HLA("HLS",PRCVI)) Q:'PRCVI  D
"RTN","PRCVIMF",186,0)
 ; . S PRCVL=$L(HLA("HLS",PRCVI))
"RTN","PRCVIMF",187,0)
 ; . F PRCVL1=PRCVL:-1 Q:PRCVL1<0  D
"RTN","PRCVIMF",188,0)
 ; .. I $E(HLA("HLS",PRCVI),PRCVL1)'="|" S PRCVL1=0 Q
"RTN","PRCVIMF",189,0)
 ; .. S HLA("HLS",PRCVI)=$E(HLA("HLS",PRCVI),1,PRCVL1-1)
"RTN","PRCVIMF",190,0)
 ; .. Q
"RTN","PRCVIMF",191,0)
 ; . Q
"RTN","PRCVIMF",192,0)
 Q
"RTN","PRCVIMF",193,0)
 ;
"RTN","PRCVIMF",194,0)
ZVI ; ZVI segment
"RTN","PRCVIMF",195,0)
 ;
"RTN","PRCVIMF",196,0)
 ; Vendor
"RTN","PRCVIMF",197,0)
 S PRCVSEG=""
"RTN","PRCVIMF",198,0)
 S PRCVND2=^TMP("PRCVIT",$J,PRCVIN,2,PRCVI)
"RTN","PRCVIMF",199,0)
 S PRCVSEG="ZVI"_PRCVFS_$P(PRCVND2,U)_PRCVCS_$P(^PRC(440,$P(PRCVND2,U),0),U)_PRCVCS_PRCVSTN
"RTN","PRCVIMF",200,0)
 ; Vendor Stock Number
"RTN","PRCVIMF",201,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,4)
"RTN","PRCVIMF",202,0)
 ; National Drug Code
"RTN","PRCVIMF",203,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,5)
"RTN","PRCVIMF",204,0)
 ; Contract
"RTN","PRCVIMF",205,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",206,0)
 I $P(PRCVND2,U,3)]"" D
"RTN","PRCVIMF",207,0)
 . S PRCVCON=$G(^PRC(440,$P(PRCVND2,U),4,$P(PRCVND2,U,3),0))
"RTN","PRCVIMF",208,0)
 . S PRCVSEG=PRCVSEG_$P(PRCVCON,U)_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_$$FMTHL7^XLFDT($P(PRCVCON,U,2))
"RTN","PRCVIMF",209,0)
 . Q
"RTN","PRCVIMF",210,0)
 ; Unit Cost
"RTN","PRCVIMF",211,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,2)_PRCVCS_"USD"
"RTN","PRCVIMF",212,0)
 ; Date of Unit Price
"RTN","PRCVIMF",213,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",214,0)
 I $P(PRCVND2,U,6)]"" S PRCVSEG=PRCVSEG_$$FMTHL7^XLFDT($P(PRCVND2,U,6))
"RTN","PRCVIMF",215,0)
 ; Unit of Purchase - required field in DynaMed
"RTN","PRCVIMF",216,0)
 S PRCVSEG=PRCVSEG_PRCVFS
"RTN","PRCVIMF",217,0)
 ; If no Unit of Purchase in IFCAP, set default to "EACH"
"RTN","PRCVIMF",218,0)
 I $P(PRCVND2,U,7)="" S $P(PRCVND2,U,7)=$O(^PRCD(420.5,"C","EACH",0))
"RTN","PRCVIMF",219,0)
 S PRCVUP=^PRCD(420.5,$P(PRCVND2,U,7),0)
"RTN","PRCVIMF",220,0)
 S PRCVSEG=PRCVSEG_$P(PRCVUP,U)_PRCVCS_$P(PRCVUP,U,2)_PRCVCS_"IFCAP"
"RTN","PRCVIMF",221,0)
 ; Packaging Multiple
"RTN","PRCVIMF",222,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,8)
"RTN","PRCVIMF",223,0)
 ; Unit of Conversion Factor
"RTN","PRCVIMF",224,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,10)
"RTN","PRCVIMF",225,0)
 ; Required Order Multiple
"RTN","PRCVIMF",226,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,11)
"RTN","PRCVIMF",227,0)
 ; Minimum Order Quantity
"RTN","PRCVIMF",228,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,12)
"RTN","PRCVIMF",229,0)
 ; Maximum Order Quantity
"RTN","PRCVIMF",230,0)
 S PRCVSEG=PRCVSEG_PRCVFS_$P(PRCVND2,U,9)
"RTN","PRCVIMF",231,0)
 ;
"RTN","PRCVIMF",232,0)
 S PRCVN=PRCVN+1
"RTN","PRCVIMF",233,0)
 S HLA("HLS",PRCVN)=PRCVSEG
"RTN","PRCVIMF",234,0)
 Q
"RTN","PRCVIMF",235,0)
 ;
"RTN","PRCVIMF",236,0)
 ;
"RTN","PRCVIMF",237,0)
MFKPROC ;Process MFK^M01 response message
"RTN","PRCVIMF",238,0)
 ;
"RTN","PRCVIMF",239,0)
 ;Uses HLNEXT twice to bypass the MSH segment and go directly to the MSA segment
"RTN","PRCVIMF",240,0)
 N VAL
"RTN","PRCVIMF",241,0)
 X HLNEXT
"RTN","PRCVIMF",242,0)
 X HLNEXT
"RTN","PRCVIMF",243,0)
 S VAL=$$FLD^HLCSUTL(HLNODE,2)
"RTN","PRCVIMF",244,0)
 I VAL'="AA" D ERROR
"RTN","PRCVIMF",245,0)
 D FIN
"RTN","PRCVIMF",246,0)
 Q
"RTN","PRCVIMF",247,0)
 ;
"RTN","PRCVIMF",248,0)
ERROR ;Process ERR Segments
"RTN","PRCVIMF",249,0)
 N N,PRCVERM,PRCVIT
"RTN","PRCVIMF",250,0)
 S PRCVERC=0 F N=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVIMF",251,0)
 . S VAL=$$FLD^HLCSUTL(HLNODE,1)
"RTN","PRCVIMF",252,0)
 . I VAL="MFA" S PRCVIT=$P($$FLD^HLCSUTL(HLNODE,6),U)
"RTN","PRCVIMF",253,0)
 . I VAL="ERR" D
"RTN","PRCVIMF",254,0)
 .. S PRCVERC=PRCVERC+1
"RTN","PRCVIMF",255,0)
 .. S PRCVERM=$$FLD^HLCSUTL(HLNODE,6)
"RTN","PRCVIMF",256,0)
 .. S PRCVERR(PRCVERC)="Unable to update item in DynaMed during an ITEM Update to the Inventory System the following error(s) occurred:"
"RTN","PRCVIMF",257,0)
 .. S PRCVERC=PRCVERC+1
"RTN","PRCVIMF",258,0)
 .. S PRCVERR(PRCVERC)=$P(PRCVERM,U,2)
"RTN","PRCVIMF",259,0)
 .. Q
"RTN","PRCVIMF",260,0)
 . Q
"RTN","PRCVIMF",261,0)
 ;
"RTN","PRCVIMF",262,0)
 D CLIFP
"RTN","PRCVIMF",263,0)
 Q
"RTN","PRCVIMF",264,0)
 ;
"RTN","PRCVIMF",265,0)
CLIFP ;Call partner app w/ mail message for users on error
"RTN","PRCVIMF",266,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVIMF",267,0)
 S XMSUB="Item Number: "_PRCVIT_" - Inventory System ITEM Update Errors "_$$HTE^XLFDT($H)
"RTN","PRCVIMF",268,0)
 S XMDUZ="IFCAP/COTS Inventory Interface"
"RTN","PRCVIMF",269,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVIMF",270,0)
 S XMY("G.PRCV Item Vendor Edits")=""
"RTN","PRCVIMF",271,0)
 D ^XMD
"RTN","PRCVIMF",272,0)
 Q
"RTN","PRCVIMF",273,0)
 ;
"RTN","PRCVIMF",274,0)
FIN ;Clean up variables
"RTN","PRCVIMF",275,0)
 K ^TMP("PRCVIT",$J)
"RTN","PRCVIMF",276,0)
 K PRCVI,PRCVN,PRCVDP,PRCVPRO,HL,HLA,PRCVCS,PRCVRS,PRCVFS,PRCVDT,%
"RTN","PRCVIMF",277,0)
 K VAL,PRCVERC,PRCVERM,PRCVERR
"RTN","PRCVIMF",278,0)
 ;
"RTN","PRCVIMF",279,0)
 Q
"RTN","PRCVINIT")
0^64^B3517241
"RTN","PRCVINIT",1,0)
PRCVINIT ;WOIFO/DAP-ITEM/VENDOR FILE INITIALIZATION CALLING; 05/23/05
"RTN","PRCVINIT",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVINIT",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVINIT",4,0)
 ;
"RTN","PRCVINIT",5,0)
 Q
"RTN","PRCVINIT",6,0)
 ;
"RTN","PRCVINIT",7,0)
INIT ;Entry call for the routine, allows users to initialize 
"RTN","PRCVINIT",8,0)
 ;the item and vendor file checksums while offering enhanced feedback
"RTN","PRCVINIT",9,0)
 ;
"RTN","PRCVINIT",10,0)
 ;Verify that site parameter is properly set for use of COTS Inventory Interface
"RTN","PRCVINIT",11,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 W !,"The site parameter is not properly set for",!,"use of the COTS Inventory interface!",! Q
"RTN","PRCVINIT",12,0)
 ;
"RTN","PRCVINIT",13,0)
 ;If checksums have already been initialized for the site this routine will quit to avoid errors caused by re-initiating the checksums
"RTN","PRCVINIT",14,0)
 I $D(^PRCV(414.04,1,0)) W !,"Item or Vendor file checksum has already been initialized!",! Q
"RTN","PRCVINIT",15,0)
 ;
"RTN","PRCVINIT",16,0)
 W !,"Item file checksum initialization beginning...",!
"RTN","PRCVINIT",17,0)
 D INIT^PRCVIT
"RTN","PRCVINIT",18,0)
 I $D(^PRCV(414.04,1,0)) W !,"Item file checksum initialization complete!",!
"RTN","PRCVINIT",19,0)
 I '$D(^PRCV(414.04,1,0)) W !,"Item file checksum initialization failed!",! Q
"RTN","PRCVINIT",20,0)
 ;
"RTN","PRCVINIT",21,0)
 W !,"Vendor file checksum initialization beginning...",!
"RTN","PRCVINIT",22,0)
 D INIT^PRCVNDR
"RTN","PRCVINIT",23,0)
 I $D(^PRCV(414.04,2,0)) W !,"Vendor file checksum initialization complete!",!
"RTN","PRCVINIT",24,0)
 I '$D(^PRCV(414.04,2,0)) W !,"Vendor file checksum initialization failed!",! Q
"RTN","PRCVINIT",25,0)
 ;
"RTN","PRCVINIT",26,0)
 Q 
"RTN","PRCVIT")
0^8^B41941579
"RTN","PRCVIT",1,0)
PRCVIT ;WOIFO/DST - Send ITEM master file update to DYNAMED ; 3/2/05 5:07pm
"RTN","PRCVIT",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVIT",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVIT",4,0)
 ;
"RTN","PRCVIT",5,0)
 Q
"RTN","PRCVIT",6,0)
NITECHK ;
"RTN","PRCVIT",7,0)
 ;    Once a day check
"RTN","PRCVIT",8,0)
 ;    Compare a checksum and set a record to update
"RTN","PRCVIT",9,0)
 ;
"RTN","PRCVIT",10,0)
 ; If not DynaMed, don't do it
"RTN","PRCVIT",11,0)
 Q:'$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVIT",12,0)
 ;
"RTN","PRCVIT",13,0)
 N PRCND,PRCVL,PRCVP,PRCVAL,PRCVIT,PRCVN,PRCVSTN
"RTN","PRCVIT",14,0)
 N PRCVFN
"RTN","PRCVIT",15,0)
 S PRCVP=67280421310721,PRCVN=99999
"RTN","PRCVIT",16,0)
 S PRCVFN=$O(^PRCV(414.04,"D","ITEM",0))
"RTN","PRCVIT",17,0)
 ;    Clear old flag
"RTN","PRCVIT",18,0)
 K ^TMP("PRCVIT",$J)
"RTN","PRCVIT",19,0)
 S PRCVSTN=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVIT",20,0)
 F  S PRCVN=$O(^PRC(441,PRCVN)) Q:'PRCVN  D
"RTN","PRCVIT",21,0)
 . S PRCVAL=$$CHKSUM()
"RTN","PRCVIT",22,0)
 . ;  Compare to existing CheckSum
"RTN","PRCVIT",23,0)
 . ;  Kick off HL7 interface message to DynaMed, if not the same
"RTN","PRCVIT",24,0)
 . I PRCVAL,PRCVAL'=$P($G(^PRCV(414.04,PRCVFN,1,PRCVN,0)),U,2) D
"RTN","PRCVIT",25,0)
 .. S ^PRCV(414.04,PRCVFN,1,PRCVN,0)=PRCVN_U_PRCVAL
"RTN","PRCVIT",26,0)
 .. D GETDATA(PRCVN)
"RTN","PRCVIT",27,0)
 .. I $D(^TMP("PRCVIT",$J,PRCVN)) D EN^PRCVIMF(PRCVN)
"RTN","PRCVIT",28,0)
 .. Q
"RTN","PRCVIT",29,0)
 . Q
"RTN","PRCVIT",30,0)
 K ^TMP("PRCVIT",$J)
"RTN","PRCVIT",31,0)
 Q
"RTN","PRCVIT",32,0)
 ;
"RTN","PRCVIT",33,0)
ONECHK(PRCVN) ;
"RTN","PRCVIT",34,0)
 ;   Checksum to one ITEM only
"RTN","PRCVIT",35,0)
 Q:PRCVN<99999
"RTN","PRCVIT",36,0)
 N PRCND,PRCVL,PRCVFN,PRCVP,PRCVAL,PRCVIT
"RTN","PRCVIT",37,0)
 K ^TMP("PRCVIT",$J,PRCVN)
"RTN","PRCVIT",38,0)
 S PRCVP=67280421310721
"RTN","PRCVIT",39,0)
 S PRCVFN=$O(^PRCV(414.04,"D","ITEM",0))
"RTN","PRCVIT",40,0)
 S PRCVAL=$$CHKSUM()
"RTN","PRCVIT",41,0)
 ;   If checksum not equal 0, get data to DynaMed
"RTN","PRCVIT",42,0)
 I PRCVAL,PRCVAL'=$P($G(^PRCV(414.04,PRCVFN,1,PRCVN,0)),U,2) D
"RTN","PRCVIT",43,0)
 . D GETDATA(PRCVN)
"RTN","PRCVIT",44,0)
 . S ^PRCV(414.04,PRCVFN,1,PRCVN,0)=PRCVN_U_PRCVAL
"RTN","PRCVIT",45,0)
 . I $D(^TMP("PRCVIT",$J,PRCVN)) D EN^PRCVIMF(PRCVN)
"RTN","PRCVIT",46,0)
 . Q
"RTN","PRCVIT",47,0)
 K ^TMP("PRCVIT",$J,PRCVN)
"RTN","PRCVIT",48,0)
 Q
"RTN","PRCVIT",49,0)
INIT ;
"RTN","PRCVIT",50,0)
 ;   Initialize checksum global at installation
"RTN","PRCVIT",51,0)
 N PRCVN,PRCVP,RESULT,FDA
"RTN","PRCVIT",52,0)
 ;
"RTN","PRCVIT",53,0)
 S FDA(414.04,"?+1,",.01)="ITEM"
"RTN","PRCVIT",54,0)
 S FDA(414.04,"?+1,",.02)=441
"RTN","PRCVIT",55,0)
 S FDA(414.04,"?+1,",.03)="Item file checksum (on partial field)"
"RTN","PRCVIT",56,0)
 D UPDATE^DIE("E","FDA","RESULT")
"RTN","PRCVIT",57,0)
 S PRCVP=67280421310721,PRCVN=99999
"RTN","PRCVIT",58,0)
 F  S PRCVN=$O(^PRC(441,PRCVN)) Q:'PRCVN  D
"RTN","PRCVIT",59,0)
 . S FDA(414.41,"?+1,"_RESULT(1)_",",.01)=PRCVN
"RTN","PRCVIT",60,0)
 . S FDA(414.41,"?+1,"_RESULT(1)_",",1)=$$CHKSUM()
"RTN","PRCVIT",61,0)
 . D UPDATE^DIE("E","FDA")
"RTN","PRCVIT",62,0)
 Q
"RTN","PRCVIT",63,0)
 ;
"RTN","PRCVIT",64,0)
CHKSUM() ;
"RTN","PRCVIT",65,0)
 N PRCVST
"RTN","PRCVIT",66,0)
 S PRCVAL=0
"RTN","PRCVIT",67,0)
 ;        Node 0
"RTN","PRCVIT",68,0)
 S PRCVIT=$G(^PRC(441,PRCVN,0))
"RTN","PRCVIT",69,0)
 ;  Piece 1 - ITEM Number
"RTN","PRCVIT",70,0)
 ;  Piece 2 - ITEM Short Description
"RTN","PRCVIT",71,0)
 ;  Piece 3 - FSC - Federal Supply Classification
"RTN","PRCVIT",72,0)
 ;  Piece 4 - Last vendor ordered
"RTN","PRCVIT",73,0)
 ;  Piece 5 - NSN - National Stock Number
"RTN","PRCVIT",74,0)
 ;  Piece 6 - Case/Cart Tray/instrument kit
"RTN","PRCVIT",75,0)
 ;  Piece 8 - Mandatory Source
"RTN","PRCVIT",76,0)
 ;  Piece 9 - Date Item Created
"RTN","PRCVIT",77,0)
 ;  Piece 10 - BOC
"RTN","PRCVIT",78,0)
 ;  Piece 11 - DUZ
"RTN","PRCVIT",79,0)
 ;  Piece 13 - Reusable Item
"RTN","PRCVIT",80,0)
 ;  Piece 14 - Hazardous material
"RTN","PRCVIT",81,0)
 ;  Piece 15 - NIF ITEM number
"RTN","PRCVIT",82,0)
 S PRCVI=0
"RTN","PRCVIT",83,0)
 F PRCVI=1:1:6,8:1:11,13:1:15 D
"RTN","PRCVIT",84,0)
 . S PRCVST=$P(PRCVIT,U,PRCVI)
"RTN","PRCVIT",85,0)
 . S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",86,0)
 . Q
"RTN","PRCVIT",87,0)
 ;        Node 1 - Description
"RTN","PRCVIT",88,0)
 ;
"RTN","PRCVIT",89,0)
 S PRCVI=0
"RTN","PRCVIT",90,0)
 F  S PRCVI=$O(^PRC(441,PRCVN,1,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",91,0)
 . S PRCVST=^PRC(441,PRCVN,1,PRCVI,0)
"RTN","PRCVIT",92,0)
 . S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",93,0)
 . Q
"RTN","PRCVIT",94,0)
 ;        Node 2 - Vendors
"RTN","PRCVIT",95,0)
 S PRCVI=0
"RTN","PRCVIT",96,0)
 F  S PRCVI=$O(^PRC(441,PRCVN,2,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",97,0)
 . S PRCVST=^PRC(441,PRCVN,2,PRCVI,0)
"RTN","PRCVIT",98,0)
 . S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",99,0)
 . Q
"RTN","PRCVIT",100,0)
 ;        Node 3
"RTN","PRCVIT",101,0)
 ;  Piece 1 - Inactivated ITEM?
"RTN","PRCVIT",102,0)
 ;  Piece 2 - Date Inactivated
"RTN","PRCVIT",103,0)
 ;  Piece 3 - Inactivated By
"RTN","PRCVIT",104,0)
 ;  Piece 4 - Replacement Item
"RTN","PRCVIT",105,0)
 ;  Piece 5 - MFG Part No.
"RTN","PRCVIT",106,0)
 ;  Piece 6 - NSN Verified
"RTN","PRCVIT",107,0)
 ;  Piece 7 - Food Group
"RTN","PRCVIT",108,0)
 ;  Piece 8 - SKU
"RTN","PRCVIT",109,0)
 ;  Piece 9 - Drug Type Code
"RTN","PRCVIT",110,0)
 ;  Piece 10 - SIC Code
"RTN","PRCVIT",111,0)
 ;
"RTN","PRCVIT",112,0)
 ; Check the whole node 3
"RTN","PRCVIT",113,0)
 ;
"RTN","PRCVIT",114,0)
 S PRCVST=$G(^PRC(441,PRCVN,3))
"RTN","PRCVIT",115,0)
 I PRCVST]"" S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",116,0)
 ;
"RTN","PRCVIT",117,0)
 ;        Node 4 - Fund Control Point
"RTN","PRCVIT",118,0)
 S PRCVI=0
"RTN","PRCVIT",119,0)
 F  S PRCVI=$O(^PRC(441,PRCVN,4,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",120,0)
 . S PRCVST=$G(^PRC(441,PRCVN,4,PRCVI,0))
"RTN","PRCVIT",121,0)
 . S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",122,0)
 . Q
"RTN","PRCVIT",123,0)
 ;        Node 6 - Pre_NIF Long Description
"RTN","PRCVIT",124,0)
 S PRCVI=0
"RTN","PRCVIT",125,0)
 F  S PRCVI=$O(^PRC(441,PRCVN,6,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",126,0)
 . S PRCVST=^PRC(441,PRCVN,6,PRCVI,0)
"RTN","PRCVIT",127,0)
 . S PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVIT",128,0)
 . Q
"RTN","PRCVIT",129,0)
 ;
"RTN","PRCVIT",130,0)
 Q PRCVAL
"RTN","PRCVIT",131,0)
 ;
"RTN","PRCVIT",132,0)
GETDATA(PRCVNM) ;
"RTN","PRCVIT",133,0)
 ;     Get all field required, 
"RTN","PRCVIT",134,0)
 ;        Node 0
"RTN","PRCVIT",135,0)
 ;
"RTN","PRCVIT",136,0)
 N PRCVND,PRCVI,PRCVJ,PRCVCON,PRCVERR
"RTN","PRCVIT",137,0)
 S PRCVERR=0
"RTN","PRCVIT",138,0)
 S PRCVIT=$G(^PRC(441,PRCVNM,0))
"RTN","PRCVIT",139,0)
 S PRCVND=$P(PRCVIT,U,1,6)
"RTN","PRCVIT",140,0)
 S PRCVJ=6
"RTN","PRCVIT",141,0)
 F PRCVI=8:1:11,13,14,15 D
"RTN","PRCVIT",142,0)
 . S PRCVJ=PRCVJ+1
"RTN","PRCVIT",143,0)
 . S $P(PRCVND,U,PRCVJ)=$P(PRCVIT,U,PRCVI)
"RTN","PRCVIT",144,0)
 . Q
"RTN","PRCVIT",145,0)
 S $P(PRCVND,U,11)="N"
"RTN","PRCVIT",146,0)
 S:$P(PRCVIT,U,13)="Y"!("y") $P(PRCVND,U,11)="Y"
"RTN","PRCVIT",147,0)
 S ^TMP("PRCVIT",$J,PRCVNM,0)=PRCVND
"RTN","PRCVIT",148,0)
 ;
"RTN","PRCVIT",149,0)
 ;        Node 1 - Description
"RTN","PRCVIT",150,0)
 S PRCVI=0
"RTN","PRCVIT",151,0)
 F  S PRCVI=$O(^PRC(441,PRCVNM,1,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",152,0)
 . S ^TMP("PRCVIT",$J,PRCVNM,1,PRCVI)=^PRC(441,PRCVNM,1,PRCVI,0)
"RTN","PRCVIT",153,0)
 . Q
"RTN","PRCVIT",154,0)
 ;        Node 2 - Vendors
"RTN","PRCVIT",155,0)
 S PRCVI=0
"RTN","PRCVIT",156,0)
 F  S PRCVI=$O(^PRC(441,PRCVNM,2,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",157,0)
 . S PRCVND=^PRC(441,PRCVNM,2,PRCVI,0)
"RTN","PRCVIT",158,0)
 . ; Check if the contract exists in Vendor File
"RTN","PRCVIT",159,0)
 . ; If not, send a message to Control Point officer
"RTN","PRCVIT",160,0)
 . I $P(PRCVND,U)']"" S $P(PRCVND,U)=0
"RTN","PRCVIT",161,0)
 . I $P(PRCVND,U,3)']"" S $P(PRCVND,U,3)=0
"RTN","PRCVIT",162,0)
 . S PRCVCON=$G(^PRC(440,$P(PRCVND,U),4,$P(PRCVND,U,3),0))
"RTN","PRCVIT",163,0)
 . I $P(PRCVND,U)>0,($P(PRCVND,U,3)>0),($P(PRCVCON,U)']"") D
"RTN","PRCVIT",164,0)
 .. S PRCVERR=PRCVERR+1
"RTN","PRCVIT",165,0)
 .. S PRCVERR(PRCVERR)="Contract # "_$P(PRCVND,U,3)_" of VENDOR - "_$P(PRCVND,U)_", "_$P($G(^PRC(440,$P(PRCVND,U),0)),U)_", for ITEM # "_PRCVNM_" does not exist in IFCAP Vendor file."
"RTN","PRCVIT",166,0)
 .. S $P(PRCVND,U,3)=""
"RTN","PRCVIT",167,0)
 .. Q
"RTN","PRCVIT",168,0)
 . ; Check exp. date of contract, QUIT if expired more than 365 days
"RTN","PRCVIT",169,0)
 . I $P(PRCVCON,U,3)]"",($P(PRCVCON,U,3)<$$FMADD^XLFDT(DT,-365)) S $P(PRCVND,U,3)=""
"RTN","PRCVIT",170,0)
 . ; Conversion on PRCVND
"RTN","PRCVIT",171,0)
 . S:$P(PRCVND,U,2)="" $P(PRCVND,U,2)=0
"RTN","PRCVIT",172,0)
 . S:$P(PRCVND,U,8)="" $P(PRCVND,U,8)=1
"RTN","PRCVIT",173,0)
 . S ^TMP("PRCVIT",$J,PRCVNM,2,PRCVI)=PRCVND
"RTN","PRCVIT",174,0)
 . Q
"RTN","PRCVIT",175,0)
 ;        Node 3
"RTN","PRCVIT",176,0)
 I $D(^PRC(441,PRCVNM,3)) S ^TMP("PRCVIT",$J,PRCVNM,3)=^PRC(441,PRCVNM,3)
"RTN","PRCVIT",177,0)
 ;
"RTN","PRCVIT",178,0)
 ;        Node 4 - Fund Control Point
"RTN","PRCVIT",179,0)
 S PRCVI=0
"RTN","PRCVIT",180,0)
 F  S PRCVI=$O(^PRC(441,PRCVNM,4,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",181,0)
 . S PRCVND=^PRC(441,PRCVNM,4,PRCVI,0)
"RTN","PRCVIT",182,0)
 . S $P(PRCVND,U)=$E($P(PRCVND,U),4,7)
"RTN","PRCVIT",183,0)
 . S ^TMP("PRCVIT",$J,PRCVNM,4,PRCVI)=PRCVND
"RTN","PRCVIT",184,0)
 . Q
"RTN","PRCVIT",185,0)
 ;
"RTN","PRCVIT",186,0)
 ;        Node 6 - Pre_NIF Long Description
"RTN","PRCVIT",187,0)
 S PRCVI=0
"RTN","PRCVIT",188,0)
 F  S PRCVI=$O(^PRC(441,PRCVNM,6,PRCVI)) Q:'PRCVI  D
"RTN","PRCVIT",189,0)
 . S ^TMP("PRCVIT",$J,PRCVNM,6,PRCVI)=^PRC(441,PRCVNM,6,PRCVI,0)
"RTN","PRCVIT",190,0)
 . Q
"RTN","PRCVIT",191,0)
 ; If there are error(s), inform user by e-mail 
"RTN","PRCVIT",192,0)
 I PRCVERR>0 D XMD
"RTN","PRCVIT",193,0)
 Q
"RTN","PRCVIT",194,0)
 ;
"RTN","PRCVIT",195,0)
XMD ; Send a message to Control Point officer/clerk for data mismatch
"RTN","PRCVIT",196,0)
 ;
"RTN","PRCVIT",197,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVIT",198,0)
 S XMSUB="Inventory System ITEM Update Info "_$$HTE^XLFDT($H)
"RTN","PRCVIT",199,0)
 S XMDUZ="IFCAP/COTS Inventory Interface"
"RTN","PRCVIT",200,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVIT",201,0)
 ; S PRCVERR(1)="Contract "_PRCVCON_" of VENDOR # "_$P(PRCVND,U)_" for ITEM # "_PRCVNM_" does not existed in IFCAP Vendor file."
"RTN","PRCVIT",202,0)
 S XMY("G.PRCV Item Vendor Edits")=""
"RTN","PRCVIT",203,0)
 D ^XMD
"RTN","PRCVIT",204,0)
 Q
"RTN","PRCVIT",205,0)
 ;
"RTN","PRCVIT",206,0)
CKINC(PRCVF,PRCVS) ;incremental checksum
"RTN","PRCVIT",207,0)
 N LEN,FIB,C,I,PRCVAL,TEST
"RTN","PRCVIT",208,0)
 S TEST=PRCVF
"RTN","PRCVIT",209,0)
 S PRCVF=+$G(PRCVF)
"RTN","PRCVIT",210,0)
 S PRCVS=$G(PRCVS)
"RTN","PRCVIT",211,0)
 ;No change on null input
"RTN","PRCVIT",212,0)
 Q:PRCVS="" PRCVF
"RTN","PRCVIT",213,0)
 S LEN=$L(PRCVS)
"RTN","PRCVIT",214,0)
 S PRCVAL=0
"RTN","PRCVIT",215,0)
 S FIB(1)=1,FIB(2)=1
"RTN","PRCVIT",216,0)
 F I=1:1:LEN D
"RTN","PRCVIT",217,0)
 .S C=$E(PRCVS,I)
"RTN","PRCVIT",218,0)
 .S:I>2 FIB(I)=FIB(I-1)+FIB(I-2)#2147483647
"RTN","PRCVIT",219,0)
 .S PRCVAL=(PRCVF+PRCVAL+($A(C)*FIB(I)))#PRCVP
"RTN","PRCVIT",220,0)
 Q PRCVAL
"RTN","PRCVITMU")
0^53^B7776696
"RTN","PRCVITMU",1,0)
PRCVITMU ;WOIFO/GJW - Item utilities ; 4/20/05 5:20pm
"RTN","PRCVITMU",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVITMU",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVITMU",4,0)
 ;
"RTN","PRCVITMU",5,0)
TRANS ;Called by the input transform on 441/.01
"RTN","PRCVITMU",6,0)
 N PRCVX,PRCVFLG
"RTN","PRCVITMU",7,0)
 S PRCVFLG=0
"RTN","PRCVITMU",8,0)
 Q:'$D(X)
"RTN","PRCVITMU",9,0)
 S X=$TR(X,"new","NEW") ;other letters are irrelevant
"RTN","PRCVITMU",10,0)
 D:X="NEW"
"RTN","PRCVITMU",11,0)
 .S PRCVFLG=1
"RTN","PRCVITMU",12,0)
 .D NEW
"RTN","PRCVITMU",13,0)
 Q:'$D(X)
"RTN","PRCVITMU",14,0)
 I +X'=X K X Q
"RTN","PRCVITMU",15,0)
 I X?.E1"."1N.N K X Q
"RTN","PRCVITMU",16,0)
 I X<$S(PRCVFLG:$$MIN,1:$$AMIN) K X Q
"RTN","PRCVITMU",17,0)
 Q
"RTN","PRCVITMU",18,0)
 ;
"RTN","PRCVITMU",19,0)
CHK() ;
"RTN","PRCVITMU",20,0)
 Q $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVITMU",21,0)
 ;
"RTN","PRCVITMU",22,0)
MIN() ;
"RTN","PRCVITMU",23,0)
 Q $S($$CHK:150000,1:1)
"RTN","PRCVITMU",24,0)
 ;
"RTN","PRCVITMU",25,0)
AMIN() ;
"RTN","PRCVITMU",26,0)
 Q $S($$CHK:100000,1:1)
"RTN","PRCVITMU",27,0)
NEW ;
"RTN","PRCVITMU",28,0)
 N MIN
"RTN","PRCVITMU",29,0)
 S MIN=150000 ;starting value for allocating item #'s at DM sites
"RTN","PRCVITMU",30,0)
 I '$$CHK D
"RTN","PRCVITMU",31,0)
 .;call appropriate routine
"RTN","PRCVITMU",32,0)
 .D EN2^PRCHUTL
"RTN","PRCVITMU",33,0)
 E  D
"RTN","PRCVITMU",34,0)
 .S PRCVX=$O(^PRC(441,"AFREE",MIN-1))
"RTN","PRCVITMU",35,0)
 .S PRCVX(1)=$O(^PRC(441,"AFREE",PRCVX),-1)
"RTN","PRCVITMU",36,0)
 .S PRCVX(2)=$O(^PRC(441,"AFREE",PRCVX(1)))
"RTN","PRCVITMU",37,0)
 .S X=$S(PRCVX(1)'<MIN:PRCVX(1),1:PRCVX(2))
"RTN","PRCVITMU",38,0)
 Q
"RTN","PRCVITMU",39,0)
 ;
"RTN","PRCVITMU",40,0)
SET ;
"RTN","PRCVITMU",41,0)
 N ROOT,FIRST,SECOND
"RTN","PRCVITMU",42,0)
 S ROOT=$NA(^PRC(441,"AFREE"))
"RTN","PRCVITMU",43,0)
 S:'$D(@ROOT) @ROOT@(1,999999)=""
"RTN","PRCVITMU",44,0)
 S FIRST=$$FIND(X)
"RTN","PRCVITMU",45,0)
 I FIRST="" D  Q
"RTN","PRCVITMU",46,0)
 .;Do we need anything here?
"RTN","PRCVITMU",47,0)
 S SECOND=$O(@ROOT@(FIRST,""))
"RTN","PRCVITMU",48,0)
 ;Remove X from free list
"RTN","PRCVITMU",49,0)
 K @ROOT@(FIRST,SECOND)
"RTN","PRCVITMU",50,0)
 I SECOND>FIRST D
"RTN","PRCVITMU",51,0)
 .S:FIRST=X @ROOT@(FIRST+1,SECOND)=""
"RTN","PRCVITMU",52,0)
 .S:SECOND=X @ROOT@(FIRST,SECOND-1)=""
"RTN","PRCVITMU",53,0)
 .I ((FIRST'=X)&(SECOND'=X)) D
"RTN","PRCVITMU",54,0)
 ..S @ROOT@(FIRST,X-1)=""
"RTN","PRCVITMU",55,0)
 ..S @ROOT@(X+1,SECOND)=""
"RTN","PRCVITMU",56,0)
 Q
"RTN","PRCVITMU",57,0)
 ;
"RTN","PRCVITMU",58,0)
KILL ;
"RTN","PRCVITMU",59,0)
 N ROOT,FIRST,SECOND,LOWER,UPPER
"RTN","PRCVITMU",60,0)
 S ROOT=$NA(^PRC(441,"AFREE"))
"RTN","PRCVITMU",61,0)
 S:'$D(@ROOT) @ROOT@(1,999999)=""
"RTN","PRCVITMU",62,0)
 S FIRST=$$FIND(X)
"RTN","PRCVITMU",63,0)
 I FIRST'="" D
"RTN","PRCVITMU",64,0)
 .;return it to free list
"RTN","PRCVITMU",65,0)
 .S SECOND=$O(@ROOT@(FIRST,""))
"RTN","PRCVITMU",66,0)
 .I ((X<FIRST)!(X>SECOND)) D
"RTN","PRCVITMU",67,0)
 ..;Error
"RTN","PRCVITMU",68,0)
 E  D
"RTN","PRCVITMU",69,0)
 .S @ROOT@(X,X)=""
"RTN","PRCVITMU",70,0)
 .;Can lists be merged?
"RTN","PRCVITMU",71,0)
 .;Could X+1 be a lower limit?
"RTN","PRCVITMU",72,0)
 .I $D(@ROOT@(X+1)) D
"RTN","PRCVITMU",73,0)
 ..S UPPER=$O(@ROOT@(X+1,""))
"RTN","PRCVITMU",74,0)
 ..S LOWER=X+1
"RTN","PRCVITMU",75,0)
 ..I UPPER'="" D
"RTN","PRCVITMU",76,0)
 ...K @ROOT@(X)
"RTN","PRCVITMU",77,0)
 ...K @ROOT@(LOWER)
"RTN","PRCVITMU",78,0)
 ...S @ROOT@(X,UPPER)=""
"RTN","PRCVITMU",79,0)
 .;Could X-1 be an upper limit?
"RTN","PRCVITMU",80,0)
 .S LOWER=$$FIND(X-1)
"RTN","PRCVITMU",81,0)
 .I LOWER'="" D
"RTN","PRCVITMU",82,0)
 ..S UPPER=$O(@ROOT@(LOWER,""))
"RTN","PRCVITMU",83,0)
 ..I $G(UPPER)=(X-1) D
"RTN","PRCVITMU",84,0)
 ...K @ROOT@(X)
"RTN","PRCVITMU",85,0)
 ...K @ROOT@(LOWER)
"RTN","PRCVITMU",86,0)
 ...S @ROOT@(LOWER,X)=""
"RTN","PRCVITMU",87,0)
 Q
"RTN","PRCVITMU",88,0)
 ;
"RTN","PRCVITMU",89,0)
FIND(I) ;
"RTN","PRCVITMU",90,0)
 N ROOT,X,Y
"RTN","PRCVITMU",91,0)
 S ROOT=$NA(^PRC(441,"AFREE"))
"RTN","PRCVITMU",92,0)
 Q:$D(@ROOT@(I)) I
"RTN","PRCVITMU",93,0)
 S X=$O(@ROOT@(I),-1)
"RTN","PRCVITMU",94,0)
 S:X="" X=$O(@ROOT@(""))
"RTN","PRCVITMU",95,0)
 Q:X="" ""
"RTN","PRCVITMU",96,0)
 S Y=$O(@ROOT@(X,""))
"RTN","PRCVITMU",97,0)
 I Y<I D
"RTN","PRCVITMU",98,0)
 .;W !,"NOT FOUND!"
"RTN","PRCVITMU",99,0)
 .S X=""
"RTN","PRCVITMU",100,0)
 Q X
"RTN","PRCVLIC")
0^9^B43540999
"RTN","PRCVLIC",1,0)
PRCVLIC ;WOIFO/BMM - update message for 2237 line item cancel; 2/11/05 ; 3/24/05 2:50pm
"RTN","PRCVLIC",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVLIC",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVLIC",4,0)
 ;
"RTN","PRCVLIC",5,0)
 Q
"RTN","PRCVLIC",6,0)
 ;
"RTN","PRCVLIC",7,0)
EN ;code to send update to DM notifying of canceled line item
"RTN","PRCVLIC",8,0)
 ;in 2237
"RTN","PRCVLIC",9,0)
 ;DA, DA(1) are defined since this code is called from a MUMPS
"RTN","PRCVLIC",10,0)
 ;cross-reference
"RTN","PRCVLIC",11,0)
 ;
"RTN","PRCVLIC",12,0)
 ;do not process if 2237 # not cross-referenced in DynaMed IFCAP
"RTN","PRCVLIC",13,0)
 ;Audit file #414.02
"RTN","PRCVLIC",14,0)
 ;
"RTN","PRCVLIC",15,0)
 ;FIELDS RETRIEVED:
"RTN","PRCVLIC",16,0)
 ;.01 - transaction number
"RTN","PRCVLIC",17,0)
 ;.5 - station number
"RTN","PRCVLIC",18,0)
 ;5 - Dt requested
"RTN","PRCVLIC",19,0)
 ;12 - vendor number
"RTN","PRCVLIC",20,0)
 ;
"RTN","PRCVLIC",21,0)
 ;OTHER DATA RETRIEVED:
"RTN","PRCVLIC",22,0)
 ;DUZ - PRCVDZ
"RTN","PRCVLIC",23,0)
 ;PRCVLN, PRCVFN - last name, first name from New Person (#200)
"RTN","PRCVLIC",24,0)
 ;
"RTN","PRCVLIC",25,0)
 Q:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1
"RTN","PRCVLIC",26,0)
 N PRCVA,PRCVFH,PRCVNM
"RTN","PRCVLIC",27,0)
 ;create PRCVA array of header fields in 410
"RTN","PRCVLIC",28,0)
 S PRCVFH=".01;.5;5;12"
"RTN","PRCVLIC",29,0)
 D GETS^DIQ(410,DA(1)_",",PRCVFH,"I","PRCVA")
"RTN","PRCVLIC",30,0)
 ;quit if 2237# not in 414.02
"RTN","PRCVLIC",31,0)
 Q:'$D(^PRCV(414.02,"D",PRCVA(410,DA(1)_",",.01,"I")))
"RTN","PRCVLIC",32,0)
 D:'$D(DT) DT^DICRW
"RTN","PRCVLIC",33,0)
 ;add other data to PRCVA
"RTN","PRCVLIC",34,0)
 S PRCVA(410,DA(1)_",","DT")=$$NOW^XLFDT
"RTN","PRCVLIC",35,0)
 S PRCVA(410,DA(1)_",","DT7")=$$FMADD^XLFDT($$NOW^XLFDT,7,"","","")
"RTN","PRCVLIC",36,0)
 S PRCVA(410,DA(1)_",","DUZ")=DUZ,PRCVNM=$$GET1^DIQ(200,DUZ_",",.01)
"RTN","PRCVLIC",37,0)
 S PRCVA(410,DA(1)_",","LN")=$P(PRCVNM,",")
"RTN","PRCVLIC",38,0)
 S PRCVA(410,DA(1)_",","FN")=$P(PRCVNM,",",2)
"RTN","PRCVLIC",39,0)
 S PRCVA(410,DA(1)_",","DA1")=DA(1)
"RTN","PRCVLIC",40,0)
 ;add PRCVA to data in job
"RTN","PRCVLIC",41,0)
 M X1(9999)=PRCVA(410,DA(1)_",")
"RTN","PRCVLIC",42,0)
 ;call Kernel API, job off rest
"RTN","PRCVLIC",43,0)
 D OPKG^XUHUI("","PRCV 410 2237 LINE ITEM CANCEL","K","AH")
"RTN","PRCVLIC",44,0)
 K X1(9999)
"RTN","PRCVLIC",45,0)
 ;
"RTN","PRCVLIC",46,0)
 Q
"RTN","PRCVLIC",47,0)
 ;
"RTN","PRCVLIC",48,0)
CREATEM ;use data from 410 and 441 to create ^XTMP structure for sending
"RTN","PRCVLIC",49,0)
 ;message to DynaMed
"RTN","PRCVLIC",50,0)
 ;
"RTN","PRCVLIC",51,0)
 ;XUHUIX1 ARRAY SHOULD BE:
"RTN","PRCVLIC",52,0)
 ;XUHUIX1(9999,.01,"I") - transaction number (file 410, field .01)
"RTN","PRCVLIC",53,0)
 ;XUHUIX1(9999,.5,"I") - station number (410, 0.5)
"RTN","PRCVLIC",54,0)
 ;XUHUIX1(9999,5,"I") - date requested (410, 5)
"RTN","PRCVLIC",55,0)
 ;XUHUIX1(9999,12,"I") - vendor number (410, 12)
"RTN","PRCVLIC",56,0)
 ;XUHUIX1(9999,"DT") - FM date now
"RTN","PRCVLIC",57,0)
 ;XUHUIX1(9999,"DT7") - FM date 7 days from now
"RTN","PRCVLIC",58,0)
 ;XUHUIX1(9999,"DUZ") - user DUZ
"RTN","PRCVLIC",59,0)
 ;XUHUIX1(9999,"FN") - user first name
"RTN","PRCVLIC",60,0)
 ;XUHUIX1(9999,"LN") - user last name
"RTN","PRCVLIC",61,0)
 ;XUHUIX1(9999,"DA1") - DA(1), IEN of 2237 in 410
"RTN","PRCVLIC",62,0)
 ;XUHUIX1(1) - LINE ITEM NUMBER  (410.02,.01)
"RTN","PRCVLIC",63,0)
 ;XUHUIX1(2) - QUANTITY  (410.02,2)
"RTN","PRCVLIC",64,0)
 ;XUHUIX1(3) - UNIT OF PURCHASE  (410.02,3)
"RTN","PRCVLIC",65,0)
 ;XUHUIX1(4) - BOC  (410.02,4)
"RTN","PRCVLIC",66,0)
 ;XUHUIX1(5) - ITEM MASTER FILE NO.  (410.02,5)
"RTN","PRCVLIC",67,0)
 ;XUHUIX1(6) - STOCK NUMBER  (410.02,6)
"RTN","PRCVLIC",68,0)
 ;XUHUIX1(7) - EST. ITEM (UNIT) COST  (410.02,7)
"RTN","PRCVLIC",69,0)
 ;XUHUIX1(8) - DM DOC ID  (410.02,17)
"RTN","PRCVLIC",70,0)
 ;XUHUIX1(9) - DATE NEEDED BY  (410.02,18)
"RTN","PRCVLIC",71,0)
 ;
"RTN","PRCVLIC",72,0)
 ;other variables/data:
"RTN","PRCVLIC",73,0)
 ;PRCVST - station number
"RTN","PRCVLIC",74,0)
 ;PRCVNIF - NIF #
"RTN","PRCVLIC",75,0)
 ;PRCVPM - packaging multiple
"RTN","PRCVLIC",76,0)
 ;PRCVFV - FMS Vendor #
"RTN","PRCVLIC",77,0)
 ;PRCV2237 - ^XTMP message id
"RTN","PRCVLIC",78,0)
 ;PRCVNR - number of records (always 1)
"RTN","PRCVLIC",79,0)
 ;
"RTN","PRCVLIC",80,0)
 N PRCV2237,PRCVCT,PRCVDTD,PRCVDZ,PRCVFV,PRCVH,PRCVLI,PRCVND
"RTN","PRCVLIC",81,0)
 N PRCVNR,PRCVOCC,PRCVUP,PRCVPM,PRCVST,PRCVUM
"RTN","PRCVLIC",82,0)
 S PRCVH=$H,PRCVOCC="CA",PRCVNR=1,(PRCVUP,PRCVND,PRCVUM)=""
"RTN","PRCVLIC",83,0)
 S (PRCVPM,PRCVFV)=0
"RTN","PRCVLIC",84,0)
 S PRCVST=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVLIC",85,0)
 ;S PRCVST=XUHUIX1(9999,.5,"I")
"RTN","PRCVLIC",86,0)
 ;now- line items in PRCVLI, rest in XUHUIX1
"RTN","PRCVLIC",87,0)
 ;get NIF#, pkging multiple from 441
"RTN","PRCVLIC",88,0)
 S PRCVITM=XUHUIX1(5),PRCVVN=XUHUIX1(9999,12,"I")
"RTN","PRCVLIC",89,0)
 S PRCVNIF=$$GET1^DIQ(441,PRCVITM_",",51)
"RTN","PRCVLIC",90,0)
 S PRCVPM=$$GET1^DIQ(441.01,PRCVVN_","_PRCVITM_",",1.6)
"RTN","PRCVLIC",91,0)
 S PRCVFV=$$GET1^DIQ(440,PRCVVN_",",34)
"RTN","PRCVLIC",92,0)
 S PRCVUP=$P($G(^PRCD(420.5,XUHUIX1(3),0)),U)
"RTN","PRCVLIC",93,0)
 ;now- build ^XTMP
"RTN","PRCVLIC",94,0)
 S PRCV2237="PRCVUP*"_XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",95,0)
 ;0 node
"RTN","PRCVLIC",96,0)
 S PRCVND=XUHUIX1(9999,"DT7")_"^"_XUHUIX1(9999,"DT")
"RTN","PRCVLIC",97,0)
 K ^XTMP(PRCV2237,PRCVH)
"RTN","PRCVLIC",98,0)
 S PRCVUM="^Transmit message to DynaMed for updates"
"RTN","PRCVLIC",99,0)
 S ^XTMP(PRCV2237,0)=PRCVND_PRCVUM
"RTN","PRCVLIC",100,0)
 S ^XTMP(PRCV2237,PRCVH,0)=PRCVND_"^Line item cancel message to DynaMed"
"RTN","PRCVLIC",101,0)
 ;1 node
"RTN","PRCVLIC",102,0)
 S PRCVND=PRCVNR_"^"_PRCVST_"^"_XUHUIX1(9999,"DUZ")
"RTN","PRCVLIC",103,0)
 S PRCVND=PRCVND_"^"_XUHUIX1(9999,"LN")_"^"_XUHUIX1(9999,"FN")
"RTN","PRCVLIC",104,0)
 S PRCVND=PRCVND_"^"_XUHUIX1(9999,"DA1")
"RTN","PRCVLIC",105,0)
 S ^XTMP(PRCV2237,PRCVH,1)=PRCVND
"RTN","PRCVLIC",106,0)
 ;2 node
"RTN","PRCVLIC",107,0)
 S PRCVND=PRCVOCC_"^"_XUHUIX1(5)_"^"_XUHUIX1(2)
"RTN","PRCVLIC",108,0)
 S PRCVND=PRCVND_"^"_XUHUIX1(9999,12,"I")_"^"_PRCVFV
"RTN","PRCVLIC",109,0)
 S PRCVND=PRCVND_"^"_XUHUIX1(7)_"^"_XUHUIX1(8)_"^"_XUHUIX1(9)
"RTN","PRCVLIC",110,0)
 S PRCVND=PRCVND_"^"_PRCVUP_"^"_XUHUIX1(6)_"^"_PRCVPM
"RTN","PRCVLIC",111,0)
 S PRCVND=PRCVND_"^"_$P(XUHUIX1(4)," ")_"^"_PRCVNIF
"RTN","PRCVLIC",112,0)
 S ^XTMP(PRCV2237,PRCVH,2,1)=PRCVND
"RTN","PRCVLIC",113,0)
 ;
"RTN","PRCVLIC",114,0)
 ;call Vic's code to process the data you put in ^XTMP
"RTN","PRCVLIC",115,0)
 D BEGIN^PRCVEE1(PRCV2237,PRCVH)
"RTN","PRCVLIC",116,0)
 ;
"RTN","PRCVLIC",117,0)
 ;update Audit file
"RTN","PRCVLIC",118,0)
 D UPDAUD
"RTN","PRCVLIC",119,0)
 ;
"RTN","PRCVLIC",120,0)
 Q
"RTN","PRCVLIC",121,0)
 ;
"RTN","PRCVLIC",122,0)
UPDAUD ;update the Audit file entry for this DM Doc ID
"RTN","PRCVLIC",123,0)
 ;XUHUIX1(8) is DM Doc ID
"RTN","PRCVLIC",124,0)
 ;adding 2237# (414.02 #7), Date/Time Removed From IFCAP
"RTN","PRCVLIC",125,0)
 ;(414.02, 8), and Who Deleted (414.02, 9)
"RTN","PRCVLIC",126,0)
 ;
"RTN","PRCVLIC",127,0)
 ;note: the error of DM Doc ID being null won't happen here because
"RTN","PRCVLIC",128,0)
 ;this code isn't called unless the protocol "PRCV 410 2237 LINE ITEM
"RTN","PRCVLIC",129,0)
 ;CANCEL" fires, and that won't fire unless the cross reference on the
"RTN","PRCVLIC",130,0)
 ;410.02 Line Item field fires, and that won't happen if the DM Doc ID
"RTN","PRCVLIC",131,0)
 ;field of the 2237 line item being canceled is NULL.
"RTN","PRCVLIC",132,0)
 ;
"RTN","PRCVLIC",133,0)
 N PRCVAIEN,PRCVMSG,PRCVADR
"RTN","PRCVLIC",134,0)
 S PRCVAIEN=$O(^PRCV(414.02,"B",XUHUIX1(8),0))
"RTN","PRCVLIC",135,0)
 ;if no entry found in Audit file, send bulletin
"RTN","PRCVLIC",136,0)
 I PRCVAIEN="" D  Q
"RTN","PRCVLIC",137,0)
 . S XMB(1)="canceling a line item during edit of 2237 #"
"RTN","PRCVLIC",138,0)
 . S XMB(1)=XMB(1)_XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",139,0)
 . S XMB(2)=XUHUIX1(8)
"RTN","PRCVLIC",140,0)
 . S XMB(3)="the item is missing from the DynaMed Audit file (#414.02)"
"RTN","PRCVLIC",141,0)
 . K ^TMP($J,"PRCVLIC") S PRCVTMP="PRCVLIC"
"RTN","PRCVLIC",142,0)
 . S ^TMP($J,"PRCVLIC",1,0)=""
"RTN","PRCVLIC",143,0)
 . S ^TMP($J,"PRCVLIC",2,0)="2237 #: "_XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",144,0)
 . S ^TMP($J,"PRCVLIC",3,0)="Date/time deleted: "_XUHUIX1(9999,"DT")
"RTN","PRCVLIC",145,0)
 . S ^TMP($J,"PRCVLIC",4,0)="Who deleted: "_XUHUIX1(9999,"LN")_","_XUHUIX1(9999,"FN")_" ("_XUHUIX1(9999,"DUZ")_")"
"RTN","PRCVLIC",146,0)
 . S ^TMP($J,"PRCVLIC",5,0)="Item #: "_XUHUIX1(5)
"RTN","PRCVLIC",147,0)
 . S PRCVFCP=$P(XUHUIX1(9999,.01,"I"),"-",4)
"RTN","PRCVLIC",148,0)
 . S PRCVST=XUHUIX1(9999,.5,"I")
"RTN","PRCVLIC",149,0)
 . D DMERXMB(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCVLIC",150,0)
 ;
"RTN","PRCVLIC",151,0)
 N PRCVA
"RTN","PRCVLIC",152,0)
 S PRCVA(414.02,PRCVAIEN_",",7)=XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",153,0)
 S PRCVA(414.02,PRCVAIEN_",",8)=XUHUIX1(9999,"DT")
"RTN","PRCVLIC",154,0)
 S PRCVA(414.02,PRCVAIEN_",",9)=XUHUIX1(9999,"DUZ")
"RTN","PRCVLIC",155,0)
 D FILE^DIE("","PRCVA")
"RTN","PRCVLIC",156,0)
 ;
"RTN","PRCVLIC",157,0)
 I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVLIC",158,0)
 . S XMB(1)="canceling a line item during edit of 2237 #"
"RTN","PRCVLIC",159,0)
 . S XMB(1)=XMB(1)_XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",160,0)
 . S XMB(2)=XUHUIX1(8)
"RTN","PRCVLIC",161,0)
 . S XMB(3)="error while updating DynaMed Audit file (#414.02)"
"RTN","PRCVLIC",162,0)
 . K ^TMP($J,"PRCVLIC") S PRCVTMP="PRCVLIC"
"RTN","PRCVLIC",163,0)
 . S ^TMP($J,"PRCVLIC",1,0)=""
"RTN","PRCVLIC",164,0)
 . S ^TMP($J,"PRCVLIC",2,0)="2237 #: "_XUHUIX1(9999,.01,"I")
"RTN","PRCVLIC",165,0)
 . S ^TMP($J,"PRCVLIC",3,0)="Item #: "_XUHUIX1(5)
"RTN","PRCVLIC",166,0)
 . S ^TMP($J,"PRCVLIC",4,0)="Date/time deleted: "_XUHUIX1(9999,"DT")
"RTN","PRCVLIC",167,0)
 . S ^TMP($J,"PRCVLIC",5,0)="Who deleted: "_XUHUIX1(9999,"LN")_","_XUHUIX1(9999,"FN")_" ("_XUHUIX1(9999,"DUZ")_")"
"RTN","PRCVLIC",168,0)
 . S ^TMP($J,"PRCVLIC",6,0)="Error text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCVLIC",169,0)
 . S PRCVFCP=$P(XUHUIX1(9999,.01,"I"),"-",4)
"RTN","PRCVLIC",170,0)
 . S PRCVST=XUHUIX1(9999,.5,"I")
"RTN","PRCVLIC",171,0)
 . D DMERXMB(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCVLIC",172,0)
 Q
"RTN","PRCVLIC",173,0)
 ;
"RTN","PRCVLIC",174,0)
DMERXMB(PRCVTMP,PRCVST,PRCVFCP) ;create a bulletin to send to FCP users 
"RTN","PRCVLIC",175,0)
 ;notifying of line item missing a DM Doc ID value or error 
"RTN","PRCVLIC",176,0)
 ;updating the Audit file.
"RTN","PRCVLIC",177,0)
 ;
"RTN","PRCVLIC",178,0)
 ;the bulletin has these variable components:
"RTN","PRCVLIC",179,0)
 ;XMB - bulletin name (PRCV_AUDIT_FILE_ERROR)
"RTN","PRCVLIC",180,0)
 ;XMB(1) - action/event/identifier ex. "line item cancel during edit 
"RTN","PRCVLIC",181,0)
 ;  of 2237 #516-05-2-076-0445"
"RTN","PRCVLIC",182,0)
 ;XMB(2) - DM Doc ID value
"RTN","PRCVLIC",183,0)
 ;XMB(3) - error reason, either "an error updating the Audit file" or
"RTN","PRCVLIC",184,0)
 ;  "the item was missing its DynaMed Doc ID value" 
"RTN","PRCVLIC",185,0)
 ;XMTEXT - overflow global in ^TMP, contains values that would've
"RTN","PRCVLIC",186,0)
 ;  been added to Audit file had error not occurred
"RTN","PRCVLIC",187,0)
 ;XMSUB - set in Bulletin file, "ERROR UPDATING DYNAMED AUDIT FILE"
"RTN","PRCVLIC",188,0)
 ;XMY - array of FCP users to receive bulletin, built in GETFCPU
"RTN","PRCVLIC",189,0)
 ;XMDUZ - new value ensures bulletin is seen by user as new mail
"RTN","PRCVLIC",190,0)
 ;
"RTN","PRCVLIC",191,0)
 ;input parameters
"RTN","PRCVLIC",192,0)
 ;PRCVTMP - suscript for ^TMP array in bulletin
"RTN","PRCVLIC",193,0)
 ;PRCVFCP - fund control point
"RTN","PRCVLIC",194,0)
 ;PRCVST - station number
"RTN","PRCVLIC",195,0)
 ;
"RTN","PRCVLIC",196,0)
 N XMY,XMDUZ
"RTN","PRCVLIC",197,0)
 I $G(PRCVTMP)'="" S XMTEXT="^TMP($J,"""_PRCVTMP_""","
"RTN","PRCVLIC",198,0)
 S XMB="PRCV_AUDIT_FILE_ERROR"
"RTN","PRCVLIC",199,0)
 S XMDUZ="DOCUMENT PROCESSOR"
"RTN","PRCVLIC",200,0)
 ;D GETFCPU(.XMY,PRCVST,PRCVFCP)
"RTN","PRCVLIC",201,0)
 ;send to special mail group
"RTN","PRCVLIC",202,0)
 S XMY("G.PRCV Audit File Alerts")=""
"RTN","PRCVLIC",203,0)
 D ^XMB
"RTN","PRCVLIC",204,0)
 Q
"RTN","PRCVLIC",205,0)
 ;
"RTN","PRCVLIC",206,0)
GETFCPU(PRCVXMY,PRCVST,PRCVFCP) ;retrieve all the FCP users who are Control
"RTN","PRCVLIC",207,0)
 ;Point Officials or Control Point Clerks and are enabled to
"RTN","PRCVLIC",208,0)
 ;receive the bulletin
"RTN","PRCVLIC",209,0)
 ;PRCVFCP is fund control point
"RTN","PRCVLIC",210,0)
 ;PRCVST is station number
"RTN","PRCVLIC",211,0)
 ;
"RTN","PRCVLIC",212,0)
 N A,I,PRCVX K PRCVXMY
"RTN","PRCVLIC",213,0)
 S PRCVX="",PRCVFCP=+PRCVFCP
"RTN","PRCVLIC",214,0)
 F I=0:0 S PRCVX=$O(^PRC(420,PRCVST,1,PRCVFCP,1,PRCVX)) Q:PRCVX=""  D
"RTN","PRCVLIC",215,0)
 . S A=$G(^(PRCVX,0))
"RTN","PRCVLIC",216,0)
 . I $P(A,U,3)="Y",($P(A,U,2)=1!($P(A,U,2)=2)) S PRCVXMY(PRCVX)=""
"RTN","PRCVLIC",217,0)
 ;S (PRCVXMY(36002),PRCVXMY(35994),PRCVXMY(35993))=""
"RTN","PRCVLIC",218,0)
 Q
"RTN","PRCVLIC",219,0)
 ;
"RTN","PRCVLIC",220,0)
CHKDM(PRCVSUB) ;function that checks if the given value in PRCVSUB
"RTN","PRCVLIC",221,0)
 ;is in the Audit file index passed in PRCVIND.
"RTN","PRCVLIC",222,0)
 ;1=yes, 0=no
"RTN","PRCVLIC",223,0)
 ;
"RTN","PRCVLIC",224,0)
 N PRCVP2,PRCVPC,PRCVPI,PRCVVAL
"RTN","PRCVLIC",225,0)
 S (PRCVPI,PRCVP2,PRCVVAL)=0
"RTN","PRCVLIC",226,0)
D1 I $D(^PRCV(414.02,"D",PRCVSUB)) S PRCVVAL=1 G EX
"RTN","PRCVLIC",227,0)
 ;not there, check for child
"RTN","PRCVLIC",228,0)
 S PRCVPI=$O(^PRCS(410,"B",PRCVSUB,0))
"RTN","PRCVLIC",229,0)
 I +PRCVPI=0 G EX
"RTN","PRCVLIC",230,0)
 S PRCVPC=$P($G(^PRCS(410,PRCVPI,10)),U,2)
"RTN","PRCVLIC",231,0)
 I +PRCVPC=0 G EX
"RTN","PRCVLIC",232,0)
 S PRCVSUB=PRCVPC G D1
"RTN","PRCVLIC",233,0)
EX Q PRCVVAL
"RTN","PRCVLIC",234,0)
 ;
"RTN","PRCVMON")
0^61^B73356601
"RTN","PRCVMON",1,0)
PRCVMON ;ISC-SF/GJW;Monitor subscriptions ; 6/6/05 3:48pm
"RTN","PRCVMON",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVMON",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVMON",4,0)
 ;
"RTN","PRCVMON",5,0)
 ;
"RTN","PRCVMON",6,0)
INIT ;Create initial set of FCP balances
"RTN","PRCVMON",7,0)
 N I,J,K,IENS,OUT,STAT,FCP
"RTN","PRCVMON",8,0)
 N IENS1,BAL,NODE
"RTN","PRCVMON",9,0)
 S I=""
"RTN","PRCVMON",10,0)
 F  S I=$O(^PRCV(414.03,"AC",1,I)) Q:I=""  D
"RTN","PRCVMON",11,0)
 .S IENS=I_","
"RTN","PRCVMON",12,0)
 .D GETS^DIQ(414.03,IENS,"@;.01;.02","I","OUT")
"RTN","PRCVMON",13,0)
 .S STAT=$G(OUT(414.03,IENS,.01,"I"))
"RTN","PRCVMON",14,0)
 .S FCP=$G(OUT(414.03,IENS,.02,"I"))
"RTN","PRCVMON",15,0)
 .K OUT
"RTN","PRCVMON",16,0)
 .S J=0
"RTN","PRCVMON",17,0)
 .;The pattern match is needed because IENs in this subfile
"RTN","PRCVMON",18,0)
 .;are actually strings, not (canonic) numbers
"RTN","PRCVMON",19,0)
 .F  S J=$O(^PRC(420,STAT,1,FCP,4,J)) Q:((J="")!(J?1.A))  D
"RTN","PRCVMON",20,0)
 ..;Unfortunately, an IEN of "00" confuses Fileman, so it is
"RTN","PRCVMON",21,0)
 ..;necessary to use a global read instead of a Fileman call.
"RTN","PRCVMON",22,0)
 ..I $$FY4(J)'<$$GETFY D
"RTN","PRCVMON",23,0)
 ...S NODE=$G(^PRC(420,STAT,1,FCP,4,J,0))
"RTN","PRCVMON",24,0)
 ...F K=1:1:4 D
"RTN","PRCVMON",25,0)
 ....S BAL(K)=+$P(NODE,"^",K+1)
"RTN","PRCVMON",26,0)
 ...D UPD(STAT,FCP,J,.BAL)
"RTN","PRCVMON",27,0)
 Q
"RTN","PRCVMON",28,0)
 ;
"RTN","PRCVMON",29,0)
 ;Reset values to contents of PRCVAL
"RTN","PRCVMON",30,0)
RESET(PRCVAL) ;
"RTN","PRCVMON",31,0)
 N STAT,FCP,FY,I,MYBAL
"RTN","PRCVMON",32,0)
 S STAT=""
"RTN","PRCVMON",33,0)
 F  S STAT=$O(@PRCVAL@(STAT)) Q:STAT=""  D
"RTN","PRCVMON",34,0)
 .S FY=""
"RTN","PRCVMON",35,0)
 .F  S FY=$O(@PRCVAL@(STAT,FY)) Q:FY=""  D
"RTN","PRCVMON",36,0)
 ..I $$FY4(FY)'<$$GETFY D
"RTN","PRCVMON",37,0)
 ...S FCP=""
"RTN","PRCVMON",38,0)
 ...F  S FCP=$O(@PRCVAL@(STAT,FY,FCP)) Q:FCP=""  D
"RTN","PRCVMON",39,0)
 ....F I=1:1:4 D
"RTN","PRCVMON",40,0)
 .....S MYBAL(I)=$G(@PRCVAL@(STAT,FY,FCP,I))
"RTN","PRCVMON",41,0)
 ....;update 414.03
"RTN","PRCVMON",42,0)
 ....D UPD(STAT,FCP,FY,.MYBAL)
"RTN","PRCVMON",43,0)
 Q
"RTN","PRCVMON",44,0)
 ;
"RTN","PRCVMON",45,0)
 ;Schedule the task
"RTN","PRCVMON",46,0)
SCHED ;
"RTN","PRCVMON",47,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTPRI,ZTSK
"RTN","PRCVMON",48,0)
 ;Quit if not a DM site
"RTN","PRCVMON",49,0)
 I '$$CHK D  Q
"RTN","PRCVMON",50,0)
 .W !,"This task may not be scheduled at a non-Dynamed site."
"RTN","PRCVMON",51,0)
 I $$ISRUN D  Q
"RTN","PRCVMON",52,0)
 .W !,$C(7),"The FCP monitor is already running!"
"RTN","PRCVMON",53,0)
 ;
"RTN","PRCVMON",54,0)
 ;Go ahead and schedule the task
"RTN","PRCVMON",55,0)
 S ZTRTN="RUN^PRCVMON"
"RTN","PRCVMON",56,0)
 S ZTDESC="FCP Balance Monitor"
"RTN","PRCVMON",57,0)
 S ZTDTH=$H ;right now
"RTN","PRCVMON",58,0)
 S ZTIO=""
"RTN","PRCVMON",59,0)
 S ZTPRI=3
"RTN","PRCVMON",60,0)
 D ^%ZTLOAD
"RTN","PRCVMON",61,0)
 D ISQED^%ZTLOAD
"RTN","PRCVMON",62,0)
 I $L($G(ZTSK(0)))>0 D
"RTN","PRCVMON",63,0)
 .D SETRUN(1)
"RTN","PRCVMON",64,0)
 .W !,"The FCP monitor (task # ",$G(ZTSK),") was scheduled"
"RTN","PRCVMON",65,0)
 .W " to run at ",$$HTE^XLFDT(ZTSK("D"))
"RTN","PRCVMON",66,0)
 Q
"RTN","PRCVMON",67,0)
 ;
"RTN","PRCVMON",68,0)
DIFF(PRCVX,PRCVY) ;
"RTN","PRCVMON",69,0)
 N T1,T2,VAL
"RTN","PRCVMON",70,0)
 ;check for wrap-around
"RTN","PRCVMON",71,0)
 I PRCVY<PRCVX D
"RTN","PRCVMON",72,0)
 .S T1=86400-PRCVX
"RTN","PRCVMON",73,0)
 .S T2=PRCVY
"RTN","PRCVMON",74,0)
 .S VAL=T1+T2
"RTN","PRCVMON",75,0)
 Q:PRCVY<PRCVX VAL
"RTN","PRCVMON",76,0)
 S VAL=PRCVY-PRCVX
"RTN","PRCVMON",77,0)
 Q VAL
"RTN","PRCVMON",78,0)
 ;
"RTN","PRCVMON",79,0)
RUN ;
"RTN","PRCVMON",80,0)
 N STAT,FCP,OUT,OUT1,OUT2,FY,FY2,FYIEN,VAL,VAL2,DELTA
"RTN","PRCVMON",81,0)
 N I,J,K,IX,IENS,IENS1,IENS2,IENS3,MROOT,PRCVQUIT
"RTN","PRCVMON",82,0)
 S PRCVSTRT=$P($H,",",2)
"RTN","PRCVMON",83,0)
 S DELTA=0
"RTN","PRCVMON",84,0)
 ;Quit if not a DM site
"RTN","PRCVMON",85,0)
 I '$$CHK D  Q
"RTN","PRCVMON",86,0)
 .D SETRUN(0)
"RTN","PRCVMON",87,0)
 N $ET,$ES S $ET="D TRAP^PRCVMON"
"RTN","PRCVMON",88,0)
 ;
"RTN","PRCVMON",89,0)
 D INIT ;initialize 414.03 from 420 (one time only)
"RTN","PRCVMON",90,0)
 S PRCVQUIT=0
"RTN","PRCVMON",91,0)
 ;loop through the active subscriptions
"RTN","PRCVMON",92,0)
LOOP ;
"RTN","PRCVMON",93,0)
 H 1 ;breathing room
"RTN","PRCVMON",94,0)
 ;Asked to stop?
"RTN","PRCVMON",95,0)
 S:$D(PRCVEND) DELTA=+$G(DELTA)+$$DIFF(PRCVSTRT,PRCVEND)
"RTN","PRCVMON",96,0)
 I +$G(DELTA)'<120 D
"RTN","PRCVMON",97,0)
 .I $$S^%ZTLOAD S PRCVQUIT=1
"RTN","PRCVMON",98,0)
 .I $$SHLDSTP S PRCVQUIT=1
"RTN","PRCVMON",99,0)
 .S PRCVSTRT=$P($H,",",2)
"RTN","PRCVMON",100,0)
 .S DELTA=0
"RTN","PRCVMON",101,0)
 G:PRCVQUIT DONE
"RTN","PRCVMON",102,0)
ONCE ;
"RTN","PRCVMON",103,0)
 S VAL=$NA(^TMP("PRCVAL",$J)) ;values from 420
"RTN","PRCVMON",104,0)
 S VAL2=$NA(^TMP("PRCVAL2",$J)) ;values from 414.03
"RTN","PRCVMON",105,0)
 ;
"RTN","PRCVMON",106,0)
 ;for each subscription type
"RTN","PRCVMON",107,0)
 S I=""
"RTN","PRCVMON",108,0)
 F  S I=$O(^PRCV(414.03,"AC",1,I)) Q:I=""  D
"RTN","PRCVMON",109,0)
 .S IENS=I_","
"RTN","PRCVMON",110,0)
 .D GETS^DIQ(414.03,IENS,"@;.01;.02","I","OUT")
"RTN","PRCVMON",111,0)
 .S STAT=$G(OUT(414.03,IENS,.01,"I"))
"RTN","PRCVMON",112,0)
 .S FCP=$G(OUT(414.03,IENS,.02,"I"))
"RTN","PRCVMON",113,0)
 .K OUT
"RTN","PRCVMON",114,0)
 .;get a list of values from file 420
"RTN","PRCVMON",115,0)
 .S IENS1=","_FCP_","_STAT_","
"RTN","PRCVMON",116,0)
 .D LIST^DIC(420.06,IENS1,"@;.01;1;2;3;4","P",,,,"B",,,"OUT1")
"RTN","PRCVMON",117,0)
 .S J=""
"RTN","PRCVMON",118,0)
 .F  S J=$O(OUT1("DILIST",J)) Q:J=""  D
"RTN","PRCVMON",119,0)
 ..S FYIEN=$P($G(OUT1("DILIST",J,0)),"^",1)
"RTN","PRCVMON",120,0)
 ..S FY=$P($G(OUT1("DILIST",J,0)),"^",2)
"RTN","PRCVMON",121,0)
 ..I $$FY4(FY)'<$$GETFY D
"RTN","PRCVMON",122,0)
 ...S @VAL@(STAT,FY,FCP,1)=$P($G(OUT1("DILIST",J,0)),"^",3)
"RTN","PRCVMON",123,0)
 ...S @VAL@(STAT,FY,FCP,2)=$P($G(OUT1("DILIST",J,0)),"^",4)
"RTN","PRCVMON",124,0)
 ...S @VAL@(STAT,FY,FCP,3)=$P($G(OUT1("DILIST",J,0)),"^",5)
"RTN","PRCVMON",125,0)
 ...S @VAL@(STAT,FY,FCP,4)=$P($G(OUT1("DILIST",J,0)),"^",6)
"RTN","PRCVMON",126,0)
 .K OUT1
"RTN","PRCVMON",127,0)
 .S K=0
"RTN","PRCVMON",128,0)
 .F  S K=$O(^PRCV(414.03,I,1,K)) Q:+K'>0  D
"RTN","PRCVMON",129,0)
 ..S IENS2=K_","_I_","
"RTN","PRCVMON",130,0)
 ..S FY2=$$GET1^DIQ(414.031,IENS2,.01)
"RTN","PRCVMON",131,0)
 ..S IENS3=","_IENS2
"RTN","PRCVMON",132,0)
 ..D LIST^DIC(414.0311,IENS3,"@;.01;1","P",,,,"B",,,"OUT2","MROOT")
"RTN","PRCVMON",133,0)
 ..I $$FY4(FY2)'<$$GETFY D
"RTN","PRCVMON",134,0)
 ...F IX=1:1:4 D
"RTN","PRCVMON",135,0)
 ....S @VAL2@(STAT,FY2,FCP,IX)=$P($G(OUT2("DILIST",IX,0)),"^",3)
"RTN","PRCVMON",136,0)
 ...K OUT2
"RTN","PRCVMON",137,0)
 ;Reset the values in 414.03
"RTN","PRCVMON",138,0)
 ;The old values are not needed, as they have been captured in ^TMP.
"RTN","PRCVMON",139,0)
 D RESET(VAL)
"RTN","PRCVMON",140,0)
 ;Now, compare the values
"RTN","PRCVMON",141,0)
 D COMP2(VAL,VAL2)
"RTN","PRCVMON",142,0)
 K @VAL,@VAL2
"RTN","PRCVMON",143,0)
 H 10 ;breathing room
"RTN","PRCVMON",144,0)
 S PRCVEND=$P($H,",",2) ;seconds since midnight
"RTN","PRCVMON",145,0)
 Q:'$D(PRCVQUIT)
"RTN","PRCVMON",146,0)
 G LOOP
"RTN","PRCVMON",147,0)
DONE ;
"RTN","PRCVMON",148,0)
 K PRCVSTRT,PRCVEND
"RTN","PRCVMON",149,0)
 D SETRUN(0)
"RTN","PRCVMON",150,0)
 Q
"RTN","PRCVMON",151,0)
 ;
"RTN","PRCVMON",152,0)
COMP2(PRCVNEW,PRCVOLD) ;
"RTN","PRCVMON",153,0)
 N STAT,FY,FCP,PRCVTMP1,PRCVTMP2
"RTN","PRCVMON",154,0)
 S STAT=""
"RTN","PRCVMON",155,0)
 F  S STAT=$O(@PRCVNEW@(STAT)) Q:STAT=""  D
"RTN","PRCVMON",156,0)
 .S FY=""
"RTN","PRCVMON",157,0)
 .F  S FY=$O(@PRCVNEW@(STAT,FY)) Q:FY=""  D
"RTN","PRCVMON",158,0)
 ..S FCP=""
"RTN","PRCVMON",159,0)
 ..F  S FCP=$O(@PRCVNEW@(STAT,FY,FCP)) Q:FCP=""  D
"RTN","PRCVMON",160,0)
 ...K PRCVTMP1,PRCVTMP2
"RTN","PRCVMON",161,0)
 ...M PRCVTMP1=@PRCVNEW@(STAT,FY,FCP)
"RTN","PRCVMON",162,0)
 ...M PRCVTMP2=@PRCVOLD@(STAT,FY,FCP)
"RTN","PRCVMON",163,0)
 ...D CHECK(.PRCVTMP1,.PRCVTMP2,STAT,FY,FCP)
"RTN","PRCVMON",164,0)
 K PRCVTMP1,PRCVTMP2
"RTN","PRCVMON",165,0)
 Q
"RTN","PRCVMON",166,0)
 ;
"RTN","PRCVMON",167,0)
CHECK(PRCVNBAL,PRCVOBAL,PRCVSTAT,PRCVFY,PRCVCP) ;
"RTN","PRCVMON",168,0)
 N I,CHG
"RTN","PRCVMON",169,0)
 Q:$$FY4(PRCVFY)<$$GETFY  ;don't send anything for past years
"RTN","PRCVMON",170,0)
 S CHG=0 ;assume no change
"RTN","PRCVMON",171,0)
 F I=1:1:4 I +$G(PRCVNBAL(I))'=+$G(PRCVOBAL(I)) S CHG=1
"RTN","PRCVMON",172,0)
 I CHG D SEND(PRCVSTAT,PRCVFY,PRCVCP,.PRCVNBAL)
"RTN","PRCVMON",173,0)
 Q
"RTN","PRCVMON",174,0)
 ;
"RTN","PRCVMON",175,0)
SEND(PRCVSTAT,PRCVFY,PRCVCP,PRCVBAL) ;
"RTN","PRCVMON",176,0)
 N OBJ,PROTO,MYOPTNS,MYRES
"RTN","PRCVMON",177,0)
 S OBJ=$NA(^TMP($J,"PRCV_FBAL"))
"RTN","PRCVMON",178,0)
 S @OBJ@("TIME")=$$NOW^XLFDT
"RTN","PRCVMON",179,0)
 S @OBJ@("STAT")=$G(PRCVSTAT)
"RTN","PRCVMON",180,0)
 S @OBJ@("FCP_NUM")=$G(PRCVCP)
"RTN","PRCVMON",181,0)
 S @OBJ@("FY")=$G(PRCVFY)
"RTN","PRCVMON",182,0)
 S @OBJ@("1QBAL")=$G(PRCVBAL(1))
"RTN","PRCVMON",183,0)
 S @OBJ@("2QBAL")=$G(PRCVBAL(2))
"RTN","PRCVMON",184,0)
 S @OBJ@("3QBAL")=$G(PRCVBAL(3))
"RTN","PRCVMON",185,0)
 S @OBJ@("4QBAL")=$G(PRCVBAL(4))
"RTN","PRCVMON",186,0)
 D BLD1^PRCVBLD(OBJ)
"RTN","PRCVMON",187,0)
 S PROTO="PRCV_DYNAMED_22_EV_FUND_BAL_DATA"
"RTN","PRCVMON",188,0)
 S MYOPTNS("NAMESPACE")="PRCV"
"RTN","PRCVMON",189,0)
 D GENERATE^HLMA(PROTO,"GM",1,.MYRES,,.MYOPTNS)
"RTN","PRCVMON",190,0)
 K @OBJ
"RTN","PRCVMON",191,0)
 Q
"RTN","PRCVMON",192,0)
 ;
"RTN","PRCVMON",193,0)
 ;Update 414.03
"RTN","PRCVMON",194,0)
UPD(PRCVSTAT,PRCVFCP,PRCVFY,PRCVBAL) ;
"RTN","PRCVMON",195,0)
 N OUT,VAL,IEN,IENS1,IENS2,MYFDA,I
"RTN","PRCVMON",196,0)
 N MROOT
"RTN","PRCVMON",197,0)
 S VAL(1)=PRCVSTAT
"RTN","PRCVMON",198,0)
 S VAL(2)=PRCVFCP
"RTN","PRCVMON",199,0)
 S VAL(3)=1
"RTN","PRCVMON",200,0)
 D FIND^DIC(414.03,,"@;.01;.02;.03","KX",.VAL,,,,,"OUT","MROOT")
"RTN","PRCVMON",201,0)
 S IEN=$G(OUT("DILIST",2,1))
"RTN","PRCVMON",202,0)
 S IENS1="?+1"_","_IEN_","
"RTN","PRCVMON",203,0)
 S MYFDA(414.031,IENS1,.01)=PRCVFY
"RTN","PRCVMON",204,0)
 S I=""
"RTN","PRCVMON",205,0)
 F  S I=$O(PRCVBAL(I)) Q:I=""  D
"RTN","PRCVMON",206,0)
 .S IENS2="?+"_(I+1)_","_IENS1
"RTN","PRCVMON",207,0)
 .S MYFDA(414.0311,IENS2,.01)=I
"RTN","PRCVMON",208,0)
 .S MYFDA(414.0311,IENS2,1)=$G(PRCVBAL(I))
"RTN","PRCVMON",209,0)
 D UPDATE^DIE("EK","MYFDA",,"MROOT")
"RTN","PRCVMON",210,0)
 Q
"RTN","PRCVMON",211,0)
 ;
"RTN","PRCVMON",212,0)
TRAP ;
"RTN","PRCVMON",213,0)
 ;clear the 'run' flag
"RTN","PRCVMON",214,0)
 D SETRUN(0)
"RTN","PRCVMON",215,0)
 ;Have the temporary globals been deleted?
"RTN","PRCVMON",216,0)
 S VAL=$G(VAL),VAL2=$G(VAL2)
"RTN","PRCVMON",217,0)
 I VAL?1"^".E1"(".E K @VAL
"RTN","PRCVMON",218,0)
 I VAL2?1"^".E1"(".E K @VAL2
"RTN","PRCVMON",219,0)
 D ^%ZTER
"RTN","PRCVMON",220,0)
 D UNWIND^%ZTER
"RTN","PRCVMON",221,0)
 Q
"RTN","PRCVMON",222,0)
 ;
"RTN","PRCVMON",223,0)
 ;Provide a convenient way to enable/disable monitor
"RTN","PRCVMON",224,0)
GETSTAT() ;
"RTN","PRCVMON",225,0)
 N PRMY,IENS
"RTN","PRCVMON",226,0)
 S PRMY=$$PSTAT
"RTN","PRCVMON",227,0)
 S IENS=PRMY_","
"RTN","PRCVMON",228,0)
 Q +$$GET1^DIQ(411,IENS,106,"I")
"RTN","PRCVMON",229,0)
 ;
"RTN","PRCVMON",230,0)
SETSTAT(PRCVST) ;
"RTN","PRCVMON",231,0)
 N FDA,IENS,PRMY,STATE
"RTN","PRCVMON",232,0)
 S PRCVST=$G(PRCVST)
"RTN","PRCVMON",233,0)
 S STATE=$$EXTERNAL^DILFD(411,106,,PRCVST)
"RTN","PRCVMON",234,0)
 I STATE="" D  Q
"RTN","PRCVMON",235,0)
 .W:IO=IO(0) !,"Invalid status!"
"RTN","PRCVMON",236,0)
 W:IO=IO(0) !,"Setting status to ",STATE
"RTN","PRCVMON",237,0)
 S PRMY=$$PSTAT
"RTN","PRCVMON",238,0)
 S IENS=PRMY_","
"RTN","PRCVMON",239,0)
 S FDA(411,IENS,106)=PRCVST
"RTN","PRCVMON",240,0)
 D UPDATE^DIE("","FDA")
"RTN","PRCVMON",241,0)
 Q
"RTN","PRCVMON",242,0)
 ;
"RTN","PRCVMON",243,0)
SETRUN(PRCVST) ;
"RTN","PRCVMON",244,0)
 N FDA,IENS,PRMY
"RTN","PRCVMON",245,0)
 S PRCVST=+$G(PRCVST)
"RTN","PRCVMON",246,0)
 Q:((PRCVST'=0)&(PRCVST'=1))
"RTN","PRCVMON",247,0)
 S PRMY=$$PSTAT
"RTN","PRCVMON",248,0)
 S IENS=PRMY_","
"RTN","PRCVMON",249,0)
 S FDA(411,IENS,107)=PRCVST
"RTN","PRCVMON",250,0)
 D UPDATE^DIE("","FDA")
"RTN","PRCVMON",251,0)
 Q
"RTN","PRCVMON",252,0)
ISRUN() ;
"RTN","PRCVMON",253,0)
 N PRMY,IENS
"RTN","PRCVMON",254,0)
 S PRMY=$$PSTAT
"RTN","PRCVMON",255,0)
 S IENS=PRMY_","
"RTN","PRCVMON",256,0)
 Q +$$GET1^DIQ(411,IENS,107,"I")
"RTN","PRCVMON",257,0)
 ;
"RTN","PRCVMON",258,0)
GETFY() ;
"RTN","PRCVMON",259,0)
 N DATE,YEAR,MON,FY
"RTN","PRCVMON",260,0)
 ;Get the calendar year
"RTN","PRCVMON",261,0)
 S DATE=$$DT^XLFDT
"RTN","PRCVMON",262,0)
 S YEAR=($E(DATE,1)+17)*100+$E(DATE,2,3)
"RTN","PRCVMON",263,0)
 S MON=+$E(DATE,4,5)
"RTN","PRCVMON",264,0)
 S FY=$S(MON>9:YEAR+1,1:YEAR)
"RTN","PRCVMON",265,0)
 Q FY
"RTN","PRCVMON",266,0)
 ;
"RTN","PRCVMON",267,0)
FY4(PRCVFY) ;
"RTN","PRCVMON",268,0)
 I $L(PRCVFY)'<4 Q PRCVFY
"RTN","PRCVMON",269,0)
 I +$G(PRCVFY)'<30 Q 1900+PRCVFY
"RTN","PRCVMON",270,0)
 Q 2000+PRCVFY
"RTN","PRCVMON",271,0)
 ;
"RTN","PRCVMON",272,0)
 ;Various simple checks
"RTN","PRCVMON",273,0)
CHK() ;
"RTN","PRCVMON",274,0)
 Q $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVMON",275,0)
 ;
"RTN","PRCVMON",276,0)
 ;Primary station
"RTN","PRCVMON",277,0)
PSTAT() ;
"RTN","PRCVMON",278,0)
 N PRMY
"RTN","PRCVMON",279,0)
 I '$D(^PRC(411,"AC","Y")) Q 0  ;no primary station in x-ref
"RTN","PRCVMON",280,0)
 Q $O(^PRC(411,"AC","Y",""))
"RTN","PRCVMON",281,0)
 ;
"RTN","PRCVMON",282,0)
 ;Should the monitor stop?
"RTN","PRCVMON",283,0)
SHLDSTP() ;
"RTN","PRCVMON",284,0)
 N FLG
"RTN","PRCVMON",285,0)
 S FLG=$$GETSTAT
"RTN","PRCVMON",286,0)
 Q $S(FLG=0:1,FLG=1:0,FLG=2:1,1:1)
"RTN","PRCVMON",287,0)
 ;
"RTN","PRCVMON",288,0)
PUSH1(PRCVSTAT,PRCVFY,PRCVCP) ;
"RTN","PRCVMON",289,0)
 N OBJ,PROTO,MYOPTNS,MYRES
"RTN","PRCVMON",290,0)
 S OBJ=$NA(^TMP($J,"PRCV_FBAL"))
"RTN","PRCVMON",291,0)
 S @OBJ@("TIME")=$$NOW^XLFDT
"RTN","PRCVMON",292,0)
 S @OBJ@("STAT")=$G(PRCVSTAT)
"RTN","PRCVMON",293,0)
 S @OBJ@("FCP_NUM")=$G(PRCVCP)
"RTN","PRCVMON",294,0)
 S @OBJ@("FY")=$G(PRCVFY)
"RTN","PRCVMON",295,0)
 S @OBJ@("1QBAL")=+$P($G(^PRC(420,PRCVSTAT,1,PRCVCP,4,PRCVFY,0)),"^",2)
"RTN","PRCVMON",296,0)
 S @OBJ@("2QBAL")=+$P($G(^PRC(420,PRCVSTAT,1,PRCVCP,4,PRCVFY,0)),"^",3)
"RTN","PRCVMON",297,0)
 S @OBJ@("3QBAL")=+$P($G(^PRC(420,PRCVSTAT,1,PRCVCP,4,PRCVFY,0)),"^",4)
"RTN","PRCVMON",298,0)
 S @OBJ@("4QBAL")=+$P($G(^PRC(420,PRCVSTAT,1,PRCVCP,4,PRCVFY,0)),"^",5)
"RTN","PRCVMON",299,0)
 D BLD1^PRCVBLD(OBJ)
"RTN","PRCVMON",300,0)
 S PROTO="PRCV_DYNAMED_22_EV_FUND_BAL_DATA"
"RTN","PRCVMON",301,0)
 S MYOPTNS("NAMESPACE")="PRCV"
"RTN","PRCVMON",302,0)
 D GENERATE^HLMA(PROTO,"GM",1,.MYRES,,.MYOPTNS)
"RTN","PRCVMON",303,0)
 ;W:IO=IO(0) !,"Message generated: ",$P(MYRES,"^",1)
"RTN","PRCVMON",304,0)
 K @OBJ
"RTN","PRCVMON",305,0)
 Q
"RTN","PRCVNDR")
0^10^B28317964
"RTN","PRCVNDR",1,0)
PRCVNDR ;WOIFO/AS-SEND VENDOR UPDATE INFOMATION TO DYNAMED ; 2/21/05 5:07pm
"RTN","PRCVNDR",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVNDR",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVNDR",4,0)
 ;
"RTN","PRCVNDR",5,0)
NITECHK ;
"RTN","PRCVNDR",6,0)
 ;    Once a day check
"RTN","PRCVNDR",7,0)
 ;    Compare checksum and set flag to updated record
"RTN","PRCVNDR",8,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1)'=1 Q
"RTN","PRCVNDR",9,0)
 N PRCVP,PRCVP2,PRCVAL,PRCVND,PRCVN,NOD,PRCVST,PRCVCNT
"RTN","PRCVNDR",10,0)
 S PRCVP=67280421310721,PRCVP2=2147483647,PRCVN=0
"RTN","PRCVNDR",11,0)
 S NOD=+$O(^PRCV(414.04,"D","VENDOR",0))
"RTN","PRCVNDR",12,0)
 F  S PRCVN=$O(^PRC(440,PRCVN)) Q:'PRCVN  D
"RTN","PRCVNDR",13,0)
 . S PRCVAL=$$CHKSUM()
"RTN","PRCVNDR",14,0)
 . ;  Compare to existing CheckSum
"RTN","PRCVNDR",15,0)
 . ;  Set a flag if the not the same
"RTN","PRCVNDR",16,0)
 . I PRCVAL,PRCVAL'=$P($G(^PRCV(414.04,NOD,1,PRCVN,0)),"^",2) D
"RTN","PRCVNDR",17,0)
 .. S ^PRCV(414.04,NOD,1,PRCVN,0)=PRCVN_"^"_PRCVAL
"RTN","PRCVNDR",18,0)
 .. D GETDATA(PRCVN)
"RTN","PRCVNDR",19,0)
 .. I $D(^TMP("PRCVNDR",$J,PRCVN)) D EN^PRCVVMF(PRCVN)
"RTN","PRCVNDR",20,0)
 .. K ^TMP("PRCVNDR",$J)
"RTN","PRCVNDR",21,0)
 Q
"RTN","PRCVNDR",22,0)
ONECHK(PRCVN) ;
"RTN","PRCVNDR",23,0)
 ;   Checksum to one vendor only
"RTN","PRCVNDR",24,0)
 N PRCVP,PRCVP2,PRCVAL,PRCVND,NOD,PRCVST,PRCVCNT
"RTN","PRCVNDR",25,0)
 S PRCVP=67280421310721,PRCVP2=2147483647
"RTN","PRCVNDR",26,0)
 S NOD=+$O(^PRCV(414.04,"D","VENDOR",0))
"RTN","PRCVNDR",27,0)
 S PRCVAL=$$CHKSUM
"RTN","PRCVNDR",28,0)
 ;   If checksum not equal to original record, get data to DynaMed
"RTN","PRCVNDR",29,0)
 I PRCVAL,PRCVAL'=$P($G(^PRCV(414.04,NOD,1,PRCVN,0)),"^",2) D
"RTN","PRCVNDR",30,0)
 . S ^PRCV(414.04,NOD,1,PRCVN,0)=PRCVN_"^"_PRCVAL
"RTN","PRCVNDR",31,0)
 . D GETDATA(PRCVN)
"RTN","PRCVNDR",32,0)
 . I $D(^TMP("PRCVNDR",$J,PRCVN)) D EN^PRCVVMF(PRCVN)
"RTN","PRCVNDR",33,0)
 . K ^TMP("PRCVNDR",$J)
"RTN","PRCVNDR",34,0)
 Q
"RTN","PRCVNDR",35,0)
INIT ;
"RTN","PRCVNDR",36,0)
 ;   Initialize checksum global at installation
"RTN","PRCVNDR",37,0)
 NEW FDA,RESULT,PRCVN,PRCVP,PRCVP2,PRCVAL,PRCVST,PRCVCNT
"RTN","PRCVNDR",38,0)
 S FDA(414.04,"?+1,",.01)="VENDOR"
"RTN","PRCVNDR",39,0)
 S FDA(414.04,"?+1,",.02)=440
"RTN","PRCVNDR",40,0)
 S FDA(414.04,"?+1,",.03)="Vendor file checksum (on partial field)"
"RTN","PRCVNDR",41,0)
 D UPDATE^DIE("E","FDA","RESULT")
"RTN","PRCVNDR",42,0)
 S PRCVP=67280421310721,PRCVP2=2147483647,PRCVN=0
"RTN","PRCVNDR",43,0)
 F  S PRCVN=$O(^PRC(440,PRCVN)) Q:'PRCVN  D
"RTN","PRCVNDR",44,0)
 . S FDA(414.41,"?+1,"_RESULT(1)_",",.01)=PRCVN
"RTN","PRCVNDR",45,0)
 . S FDA(414.41,"?+1,"_RESULT(1)_",",1)=$$CHKSUM()
"RTN","PRCVNDR",46,0)
 . D UPDATE^DIE("E","FDA")
"RTN","PRCVNDR",47,0)
 Q
"RTN","PRCVNDR",48,0)
CHKSUM() ;
"RTN","PRCVNDR",49,0)
 S PRCVAL=0
"RTN","PRCVNDR",50,0)
 ;        Node 0
"RTN","PRCVNDR",51,0)
 S PRCVND=$G(^PRC(440,PRCVN,0))
"RTN","PRCVNDR",52,0)
 ;  Vendor Name
"RTN","PRCVNDR",53,0)
 S PRCVST=$P(PRCVND,"^",1),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",54,0)
 ;  Ordering Address 1
"RTN","PRCVNDR",55,0)
 S PRCVST=$P(PRCVND,"^",2),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",56,0)
 ;  Ordering Address 2
"RTN","PRCVNDR",57,0)
 S PRCVST=$P(PRCVND,"^",3),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",58,0)
 ;  Ordering Address 3
"RTN","PRCVNDR",59,0)
 S PRCVST=$P(PRCVND,"^",4),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",60,0)
 ;  Ordering Address 4
"RTN","PRCVNDR",61,0)
 S PRCVST=$P(PRCVND,"^",5),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",62,0)
 ;  Ordering City
"RTN","PRCVNDR",63,0)
 S PRCVST=$P(PRCVND,"^",6),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",64,0)
 ;  Ordering State
"RTN","PRCVNDR",65,0)
 S PRCVST=$P(PRCVND,"^",7),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",66,0)
 ;  Ordering Zip Code
"RTN","PRCVNDR",67,0)
 S PRCVST=$P(PRCVND,"^",8),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",68,0)
 ;  Contact Person
"RTN","PRCVNDR",69,0)
 S PRCVST=$P(PRCVND,"^",9),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",70,0)
 ;  Contact Phone Number
"RTN","PRCVNDR",71,0)
 S PRCVST=$P(PRCVND,"^",10),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",72,0)
 ;
"RTN","PRCVNDR",73,0)
 ;        Node 3
"RTN","PRCVNDR",74,0)
 S PRCVND=$G(^PRC(440,PRCVN,3))
"RTN","PRCVNDR",75,0)
 ;  Vendor EDI Indicator
"RTN","PRCVNDR",76,0)
 S PRCVST=$P(PRCVND,"^",2),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",77,0)
 ;  EDI Vendor Number
"RTN","PRCVNDR",78,0)
 S PRCVST=$P(PRCVND,"^",3),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",79,0)
 ;  FMS Vendor ID
"RTN","PRCVNDR",80,0)
 S PRCVST=$P(PRCVND,"^",4),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",81,0)
 ;  Alternate Address Indicator
"RTN","PRCVNDR",82,0)
 S PRCVST=$P(PRCVND,"^",5),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",83,0)
 ;
"RTN","PRCVNDR",84,0)
 ;        Node 10
"RTN","PRCVNDR",85,0)
 S PRCVND=$G(^PRC(440,PRCVN,10))
"RTN","PRCVNDR",86,0)
 ;  Contact FAX Number
"RTN","PRCVNDR",87,0)
 S PRCVST=$P(PRCVND,"^",6),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",88,0)
 ;  Inactivated Vendor Indicator
"RTN","PRCVNDR",89,0)
 S PRCVST=$P(PRCVND,"^",5),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",90,0)
 ;  Date Inactivated
"RTN","PRCVNDR",91,0)
 S PRCVST=$P(PRCVND,"^",3),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",92,0)
 ;
"RTN","PRCVNDR",93,0)
 ;  Dun and Bradstreet Vendor ID
"RTN","PRCVNDR",94,0)
 S PRCVST=$P($G(^PRC(440,PRCVN,7)),"^",12),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",95,0)
 ;  Account Number
"RTN","PRCVNDR",96,0)
 S PRCVST=$P($G(^PRC(440,PRCVN,2)),"^",1),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",97,0)
 ;
"RTN","PRCVNDR",98,0)
 ;        Node 4
"RTN","PRCVNDR",99,0)
 S PRCVCNT=0 F  S PRCVCNT=$O(^PRC(440,PRCVN,4,PRCVCNT)) Q:'PRCVCNT  D
"RTN","PRCVNDR",100,0)
 . S PRCVND=$G(^PRC(440,PRCVN,4,PRCVCNT,0))
"RTN","PRCVNDR",101,0)
 . ; Contract Number
"RTN","PRCVNDR",102,0)
 . S PRCVST=$P(PRCVND,"^",1),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",103,0)
 . ; Contract Expiration Date
"RTN","PRCVNDR",104,0)
 . S PRCVST=$P(PRCVND,"^",2),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",105,0)
 . ; Contract Beginning Date
"RTN","PRCVNDR",106,0)
 . S PRCVST=$P(PRCVND,"^",3),PRCVAL=$$CKINC(PRCVAL,PRCVST)
"RTN","PRCVNDR",107,0)
 Q PRCVAL
"RTN","PRCVNDR",108,0)
 ;
"RTN","PRCVNDR",109,0)
GETDATA(PRCVNM) ;
"RTN","PRCVNDR",110,0)
 ;     Get all field required, 
"RTN","PRCVNDR",111,0)
 ;        Node 0
"RTN","PRCVNDR",112,0)
 S PRCVND=$G(^PRC(440,PRCVNM,0))
"RTN","PRCVNDR",113,0)
 ;  State
"RTN","PRCVNDR",114,0)
 S $P(PRCVND,"^",7)=$P($G(^DIC(5,+$P(PRCVND,"^",7),0)),"^",2)
"RTN","PRCVNDR",115,0)
 ;  Name, Address 1, 2, 3, 4, City, State, Zip, Contact Person, Phone
"RTN","PRCVNDR",116,0)
 S ^TMP("PRCVNDR",$J,PRCVNM,0)=$P(PRCVND,"^",1,10)
"RTN","PRCVNDR",117,0)
 ;  Station number
"RTN","PRCVNDR",118,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,0),"^",11)=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVNDR",119,0)
 ;
"RTN","PRCVNDR",120,0)
 ;        Node 3
"RTN","PRCVNDR",121,0)
 S PRCVND=$G(^PRC(440,PRCVNM,3))
"RTN","PRCVNDR",122,0)
 ;  Vendor EDI Indicator, EDI Number, FMS ID, ALT address indicator
"RTN","PRCVNDR",123,0)
 S ^TMP("PRCVNDR",$J,PRCVNM,1)=$P(PRCVND,"^",2,5)
"RTN","PRCVNDR",124,0)
 ;
"RTN","PRCVNDR",125,0)
 ;        Node 10
"RTN","PRCVNDR",126,0)
 S PRCVND=$G(^PRC(440,PRCVNM,10))
"RTN","PRCVNDR",127,0)
 ;  Date inactivated
"RTN","PRCVNDR",128,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,2),"^",1)=$P(PRCVND,"^",3)
"RTN","PRCVNDR",129,0)
 ;  Inactivated Vendor Indicator
"RTN","PRCVNDR",130,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,2),"^",2)=$P(PRCVND,"^",5)
"RTN","PRCVNDR",131,0)
 ;  Contact FAX Number
"RTN","PRCVNDR",132,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,2),"^",3)=$P(PRCVND,"^",6)
"RTN","PRCVNDR",133,0)
 ;  Dun and Bradstreet Vendor ID
"RTN","PRCVNDR",134,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,2),"^",4)=$P($G(^PRC(440,PRCVNM,7)),"^",12)
"RTN","PRCVNDR",135,0)
 ;  Account Number
"RTN","PRCVNDR",136,0)
 S $P(^TMP("PRCVNDR",$J,PRCVNM,2),"^",5)=$P($G(^PRC(440,PRCVNM,2)),"^")
"RTN","PRCVNDR",137,0)
 ;
"RTN","PRCVNDR",138,0)
 ;        Node 4
"RTN","PRCVNDR",139,0)
 S PRCVCNT=0 F  S PRCVCNT=$O(^PRC(440,PRCVNM,4,PRCVCNT)) Q:'PRCVCNT  D
"RTN","PRCVNDR",140,0)
 . S PRCVND=$G(^PRC(440,PRCVNM,4,PRCVCNT,0))
"RTN","PRCVNDR",141,0)
 . ; Contract Number, Expiration Date, Beginning Date
"RTN","PRCVNDR",142,0)
 . S ^TMP("PRCVNDR",$J,PRCVNM,3,PRCVCNT)=$P(PRCVND,"^",1,3)
"RTN","PRCVNDR",143,0)
 Q
"RTN","PRCVNDR",144,0)
CKINC(PRCVF,PRCVS) ;incremental checksum
"RTN","PRCVNDR",145,0)
 N PRCVL,PRCVB,PRCVC,PRCVI,PRCVAL
"RTN","PRCVNDR",146,0)
 S PRCVF=+$G(PRCVF)
"RTN","PRCVNDR",147,0)
 S PRCVS=$G(PRCVS)
"RTN","PRCVNDR",148,0)
 ;No change on null input
"RTN","PRCVNDR",149,0)
 Q:PRCVS="" PRCVF
"RTN","PRCVNDR",150,0)
 S PRCVL=$L(PRCVS)
"RTN","PRCVNDR",151,0)
 S PRCVAL=0
"RTN","PRCVNDR",152,0)
 S PRCVB(1)=1,PRCVB(2)=1
"RTN","PRCVNDR",153,0)
 F PRCVI=1:1:PRCVL D
"RTN","PRCVNDR",154,0)
 .S PRCVC=$E(PRCVS,PRCVI)
"RTN","PRCVNDR",155,0)
 .S:PRCVI>2 PRCVB(PRCVI)=(PRCVB(PRCVI-1)+PRCVB(PRCVI-2))#PRCVP2
"RTN","PRCVNDR",156,0)
 .S PRCVAL=(PRCVF+PRCVAL+($A(PRCVC)*PRCVB(PRCVI)))#PRCVP
"RTN","PRCVNDR",157,0)
 Q PRCVAL
"RTN","PRCVPOSD")
0^11^B45217896
"RTN","PRCVPOSD",1,0)
PRCVPOSD ;WOIFO/DAP-DYNAMED COMBINED PO EVENTS SEND ; 12/13/04
"RTN","PRCVPOSD",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVPOSD",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVPOSD",4,0)
 ;
"RTN","PRCVPOSD",5,0)
 ;This routine is used to send an ORM^O01 HL7 message to the DynaMed inventory system to report one of four Purchase Order operations.
"RTN","PRCVPOSD",6,0)
 ;1-Purchase Order Obligations
"RTN","PRCVPOSD",7,0)
 ;2-Amendments to Obligated Purchase Orders
"RTN","PRCVPOSD",8,0)
 ;3-Purchase Order Receiving Reports
"RTN","PRCVPOSD",9,0)
 ;4-Adjustments to Purchase Order Receiving Reports
"RTN","PRCVPOSD",10,0)
 ;
"RTN","PRCVPOSD",11,0)
 Q
"RTN","PRCVPOSD",12,0)
 ;
"RTN","PRCVPOSD",13,0)
EN(PRCVX) ;Entry point for API Call
"RTN","PRCVPOSD",14,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 Q
"RTN","PRCVPOSD",15,0)
 I $D(PRCVX)=0 Q
"RTN","PRCVPOSD",16,0)
 N HLA
"RTN","PRCVPOSD",17,0)
 S PRCVCNT=0,PRCVERG=0
"RTN","PRCVPOSD",18,0)
 D HDRBLD
"RTN","PRCVPOSD",19,0)
 I PRCVERG=1 K PRCVERG Q
"RTN","PRCVPOSD",20,0)
 S N=0 F  S N=$O(^TMP("PRCV442A",$J,PRCVX,N)) Q:+N=0  D
"RTN","PRCVPOSD",21,0)
 . D MSGBLD
"RTN","PRCVPOSD",22,0)
 . Q
"RTN","PRCVPOSD",23,0)
 ;
"RTN","PRCVPOSD",24,0)
 S PRCVDP="" D GENERATE^HLMA(PRCVPRO,"LM",1,.PRCVDP)
"RTN","PRCVPOSD",25,0)
 I +$P(PRCVDP,"^",2) S PRCVERR(1)="Error generating message through VistA HL7 package for PO # "_PRCVPO,PRCVERD=PRCVPO D CLIFP
"RTN","PRCVPOSD",26,0)
 ;
"RTN","PRCVPOSD",27,0)
 K ^TMP("PRCV442A",$J,PRCVX)
"RTN","PRCVPOSD",28,0)
 D FIN
"RTN","PRCVPOSD",29,0)
 K PRCVERG
"RTN","PRCVPOSD",30,0)
 ;
"RTN","PRCVPOSD",31,0)
 Q
"RTN","PRCVPOSD",32,0)
 ;
"RTN","PRCVPOSD",33,0)
HDRBLD ;Build message elements from provided header level data
"RTN","PRCVPOSD",34,0)
 ;
"RTN","PRCVPOSD",35,0)
 ;PRCVPO Purchase Order #
"RTN","PRCVPOSD",36,0)
 S PRCVPO=$P(^TMP("PRCV442A",$J,PRCVX),"^",1)
"RTN","PRCVPOSD",37,0)
 ;PRCVTT Transaction Type
"RTN","PRCVPOSD",38,0)
 S PRCVTT=$P(^TMP("PRCV442A",$J,PRCVX),"^",2)
"RTN","PRCVPOSD",39,0)
 I PRCVTT=1 S PRCVT1="NW",PRCVT2="CG",PRCVPRO="PRCV_IFCAP_02_EV_OBL/AMEND"
"RTN","PRCVPOSD",40,0)
 I PRCVTT=2 S PRCVT1="XO",PRCVT2="AJ",PRCVPRO="PRCV_IFCAP_02_EV_OBL/AMEND"
"RTN","PRCVPOSD",41,0)
 I PRCVTT=3 S PRCVT1="SC",PRCVT2="CG",PRCVPRO="PRCV_IFCAP_03_EV_REC/ADJ"
"RTN","PRCVPOSD",42,0)
 I PRCVTT=4 S PRCVT1="XX",PRCVT2="AJ",PRCVPRO="PRCV_IFCAP_03_EV_REC/ADJ"
"RTN","PRCVPOSD",43,0)
 I PRCVTT=5 S PRCVT1="CA",PRCVT2="AJ",PRCVPRO="PRCV_IFCAP_02_EV_OBL/AMEND"
"RTN","PRCVPOSD",44,0)
 ;PRCVDZ IFCAP User DUZ
"RTN","PRCVPOSD",45,0)
 S PRCVDZ=$P(^TMP("PRCV442A",$J,PRCVX),"^",3)
"RTN","PRCVPOSD",46,0)
 ;Retrieve user name based on DUZ from file 200 using $$HLNAME^XLFNAME call as detailed in DBIA #3065
"RTN","PRCVPOSD",47,0)
 S PRCVDNM("FILE")=200,PRCVDNM("FIELD")=.01,PRCVDNM("IENS")=PRCVDZ_","
"RTN","PRCVPOSD",48,0)
 S PRCVDNM=$P($$HLNAME^XLFNAME(.PRCVDNM," ","^"),"^",1,2)
"RTN","PRCVPOSD",49,0)
 S PRCVNML=$P(PRCVDNM,"^",1)
"RTN","PRCVPOSD",50,0)
 S PRCVNMF=$P(PRCVDNM,"^",2)
"RTN","PRCVPOSD",51,0)
 ;PRCVVNI Vendor Number IEN
"RTN","PRCVPOSD",52,0)
 S PRCVVNI=$P(^TMP("PRCV442A",$J,PRCVX),"^",4)
"RTN","PRCVPOSD",53,0)
 ;PRCVVNF Vendor Number FMS
"RTN","PRCVPOSD",54,0)
 S PRCVVNF=$P(^TMP("PRCV442A",$J,PRCVX),"^",5)
"RTN","PRCVPOSD",55,0)
 ;
"RTN","PRCVPOSD",56,0)
 ;##### FMS ALTERNATE ADDRESS INDICATOR #####
"RTN","PRCVPOSD",57,0)
 ;PIECE 6
"RTN","PRCVPOSD",58,0)
 ;
"RTN","PRCVPOSD",59,0)
 ;PRCVDT Transaction Date / Time
"RTN","PRCVPOSD",60,0)
 S PRCVDT=$P(^TMP("PRCV442A",$J,PRCVX),"^",7)
"RTN","PRCVPOSD",61,0)
 S PRCVDT=$$FMTHL7^XLFDT(PRCVDT)
"RTN","PRCVPOSD",62,0)
 ;PRCVSTA Station #
"RTN","PRCVPOSD",63,0)
 S PRCVSTA=$P(^TMP("PRCV442A",$J,PRCVX),"^",8)
"RTN","PRCVPOSD",64,0)
 ;PRCVPSTA Purchasing Station #
"RTN","PRCVPOSD",65,0)
 S PRCVPSTA=+(PRCVPO)
"RTN","PRCVPOSD",66,0)
 ;
"RTN","PRCVPOSD",67,0)
 K HL D INIT^HLFNC2(PRCVPRO,.HL)
"RTN","PRCVPOSD",68,0)
 I $G(HL) S PRCVERR(1)="Error generating message through VistA HL7 package for PO # "_PRCVPO,PRCVERD=PRCVPO D CLIFP D FIN Q
"RTN","PRCVPOSD",69,0)
 ;
"RTN","PRCVPOSD",70,0)
 S PRCVCS=$E(HL("ECH")),PRCVFS=HL("FS")
"RTN","PRCVPOSD",71,0)
 ;
"RTN","PRCVPOSD",72,0)
 Q
"RTN","PRCVPOSD",73,0)
 ;
"RTN","PRCVPOSD",74,0)
MSGBLD ;Generate repeating message body for all line level data
"RTN","PRCVPOSD",75,0)
 ;
"RTN","PRCVPOSD",76,0)
 ;PRCVDDN DynaMed Document Number
"RTN","PRCVPOSD",77,0)
 S PRCVDDN=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",1)
"RTN","PRCVPOSD",78,0)
 ;S PRCVDDN=$E(PRCVDDN,1,4)_"-"_$E(PRCVDDN,5,8)_"-"_$E(PRCVDDN,9,11)
"RTN","PRCVPOSD",79,0)
 ;PRCVIN Item Number
"RTN","PRCVPOSD",80,0)
 S PRCVIN=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",2)
"RTN","PRCVPOSD",81,0)
 ;PRCVLN PO Line Number
"RTN","PRCVPOSD",82,0)
 S PRCVLN=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",3)
"RTN","PRCVPOSD",83,0)
 ;PRCVTN 2237 Transaction Number
"RTN","PRCVPOSD",84,0)
 S PRCVTN=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",4)
"RTN","PRCVPOSD",85,0)
 ;PRCVUOP Unit Of Purchase
"RTN","PRCVPOSD",86,0)
 S PRCVUOP=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",5)
"RTN","PRCVPOSD",87,0)
 ;PRCVQO Quantity Ordered
"RTN","PRCVPOSD",88,0)
 S PRCVQO=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",6)
"RTN","PRCVPOSD",89,0)
 ;PRCVUP Unit Price
"RTN","PRCVPOSD",90,0)
 S PRCVUP=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",7)
"RTN","PRCVPOSD",91,0)
 ;PRCVNIF NIF Number
"RTN","PRCVPOSD",92,0)
 S PRCVNIF=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",8)
"RTN","PRCVPOSD",93,0)
 ;I PRCVNIF="" S PRCVNIF="1234"
"RTN","PRCVPOSD",94,0)
 ;PRCVPM Packaging Multiple
"RTN","PRCVPOSD",95,0)
 S PRCVPM=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",9)
"RTN","PRCVPOSD",96,0)
 ;PRCVQR Quantity Received
"RTN","PRCVPOSD",97,0)
 S PRCVQR=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",10)
"RTN","PRCVPOSD",98,0)
 ;PRCVTIC Total Item Cost
"RTN","PRCVPOSD",99,0)
 S PRCVTIC=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",11)
"RTN","PRCVPOSD",100,0)
 ;PRCVDIC Discounted Item Cost
"RTN","PRCVPOSD",101,0)
 S PRCVDIC=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",12)
"RTN","PRCVPOSD",102,0)
 ;PRCVERD Expected Delivery Date
"RTN","PRCVPOSD",103,0)
 S PRCVERD=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",13)
"RTN","PRCVPOSD",104,0)
 S PRCVERD=$$FMTHL7^XLFDT(PRCVERD)
"RTN","PRCVPOSD",105,0)
 ;PRCVAT Amendment/Adjustment Type
"RTN","PRCVPOSD",106,0)
 S PRCVAT=$P(^TMP("PRCV442A",$J,PRCVX,N),"^",14)
"RTN","PRCVPOSD",107,0)
 I PRCVAT=1 S PRCVAT="1^Line Item Edit"
"RTN","PRCVPOSD",108,0)
 I PRCVAT=2 S PRCVAT="2^Line Item Delete"
"RTN","PRCVPOSD",109,0)
 I PRCVAT=3 S PRCVAT="3^Change Vendor"
"RTN","PRCVPOSD",110,0)
 I PRCVAT=4 S PRCVAT="4^Replace PO Number"
"RTN","PRCVPOSD",111,0)
 I PRCVAT=5 S PRCVAT="5^Authority Edit"
"RTN","PRCVPOSD",112,0)
 ;
"RTN","PRCVPOSD",113,0)
 ;Build ORC Segment
"RTN","PRCVPOSD",114,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVPOSD",115,0)
 S HLA("HLS",PRCVCNT)="ORC"_PRCVFS_PRCVT1_PRCVFS_PRCVPO_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVDT_PRCVFS
"RTN","PRCVPOSD",116,0)
 S HLA("HLS",PRCVCNT)=HLA("HLS",PRCVCNT)_PRCVDZ_PRCVCS_PRCVNML_PRCVCS_PRCVNMF_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVSTA_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVAT_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVPSTA
"RTN","PRCVPOSD",117,0)
 ;
"RTN","PRCVPOSD",118,0)
 ;Build RQD Segment
"RTN","PRCVPOSD",119,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVPOSD",120,0)
 S HLA("HLS",PRCVCNT)="RQD"_PRCVFS_PRCVLN_PRCVFS_PRCVDDN_PRCVFS_PRCVIN_PRCVFS_PRCVPM_PRCVFS_PRCVQO_PRCVFS_PRCVUOP
"RTN","PRCVPOSD",121,0)
 S HLA("HLS",PRCVCNT)=HLA("HLS",PRCVCNT)_PRCVFS_PRCVFS_PRCVFS_PRCVTN_PRCVFS_PRCVERD
"RTN","PRCVPOSD",122,0)
 ;
"RTN","PRCVPOSD",123,0)
 ;Build RQ1 Segment
"RTN","PRCVPOSD",124,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVPOSD",125,0)
 S HLA("HLS",PRCVCNT)="RQ1"_PRCVFS_PRCVUP_PRCVFS_PRCVFS_PRCVFS_PRCVVNI_PRCVCS_PRCVCS_PRCVCS_PRCVVNF_PRCVFS_PRCVNIF
"RTN","PRCVPOSD",126,0)
 ;
"RTN","PRCVPOSD",127,0)
 ;Build FT1 Segment
"RTN","PRCVPOSD",128,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVPOSD",129,0)
 S HLA("HLS",PRCVCNT)="FT1"_PRCVFS_PRCVFS_PRCVFS_PRCVFS_PRCVDT_PRCVFS_PRCVFS_PRCVT2_PRCVFS_PRCVPO_PRCVFS
"RTN","PRCVPOSD",130,0)
 S HLA("HLS",PRCVCNT)=HLA("HLS",PRCVCNT)_PRCVFS_PRCVFS_PRCVQR_PRCVFS_PRCVTIC_PRCVFS_PRCVDIC
"RTN","PRCVPOSD",131,0)
 ;
"RTN","PRCVPOSD",132,0)
 Q
"RTN","PRCVPOSD",133,0)
 ;
"RTN","PRCVPOSD",134,0)
ORRPROC ;Process ORR^O02 response message
"RTN","PRCVPOSD",135,0)
 ;
"RTN","PRCVPOSD",136,0)
 ;Uses HLNEXT twice to bypass the MSH segment and go directly to the MSA segment
"RTN","PRCVPOSD",137,0)
 X HLNEXT
"RTN","PRCVPOSD",138,0)
 ;
"RTN","PRCVPOSD",139,0)
 X HLNEXT
"RTN","PRCVPOSD",140,0)
 S VAL=$$FLD^HLCSUTL(HLNODE,2)
"RTN","PRCVPOSD",141,0)
 I VAL'="AA" D ERROR
"RTN","PRCVPOSD",142,0)
 ;
"RTN","PRCVPOSD",143,0)
 D FIN
"RTN","PRCVPOSD",144,0)
 ;
"RTN","PRCVPOSD",145,0)
 Q
"RTN","PRCVPOSD",146,0)
 ;
"RTN","PRCVPOSD",147,0)
ERROR ;Process ERR Segments
"RTN","PRCVPOSD",148,0)
 S PRCVERC=1 F N=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVPOSD",149,0)
 . S VAL=$$FLD^HLCSUTL(HLNODE,1)
"RTN","PRCVPOSD",150,0)
 . I VAL="ERR" S PRCVERC=PRCVERC+1,PRCVERM=$$FLD^HLCSUTL(HLNODE,6),PRCVERD=$$FLD^HLCSUTL(HLNODE,7)
"RTN","PRCVPOSD",151,0)
 . S PRCVPO2=$P(PRCVERD,"~",1)
"RTN","PRCVPOSD",152,0)
 . S PRCVERR(PRCVERC)="At Line Number "_$P(PRCVERD,"~",2)_" involving Document ID "_$P(PRCVERD,"~",3)_" the following errors occurred:"
"RTN","PRCVPOSD",153,0)
 . S PRCVERC=PRCVERC+1
"RTN","PRCVPOSD",154,0)
 . S PRCVERR(PRCVERC)=$P(PRCVERM,"^",2)
"RTN","PRCVPOSD",155,0)
 . Q
"RTN","PRCVPOSD",156,0)
 S PRCVERR(1)="PO # "_PRCVPO2_" failed to update in the DynaMed system"
"RTN","PRCVPOSD",157,0)
 ;
"RTN","PRCVPOSD",158,0)
 D CLIFP
"RTN","PRCVPOSD",159,0)
 ;
"RTN","PRCVPOSD",160,0)
 Q
"RTN","PRCVPOSD",161,0)
 ;
"RTN","PRCVPOSD",162,0)
CLIFP ;Call partner app w/ mail message for users on error
"RTN","PRCVPOSD",163,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVPOSD",164,0)
 I $D(PRCVPO) S PRCVPO2=PRCVPO
"RTN","PRCVPOSD",165,0)
 S XMSUB="Inventory System PO # "_PRCVPO2_" Errors "_$$HTE^XLFDT($H)
"RTN","PRCVPOSD",166,0)
 S XMDUZ="IFCAP/COTS Inventory Interface"
"RTN","PRCVPOSD",167,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVPOSD",168,0)
 ;
"RTN","PRCVPOSD",169,0)
 S PRCVSIT=+PRCVPO2,PRCVFCP=$$FCP^PRCV442B(PRCVPO2)
"RTN","PRCVPOSD",170,0)
 D GETFCPU^PRCVLIC(.XMY,PRCVSIT,PRCVFCP)
"RTN","PRCVPOSD",171,0)
 ;
"RTN","PRCVPOSD",172,0)
 D ^XMD
"RTN","PRCVPOSD",173,0)
 S PRCVERG=1
"RTN","PRCVPOSD",174,0)
 K PRCVPO2,PRCVFCP,PRCVSIT
"RTN","PRCVPOSD",175,0)
 ;
"RTN","PRCVPOSD",176,0)
 Q
"RTN","PRCVPOSD",177,0)
 ;
"RTN","PRCVPOSD",178,0)
FIN ;Clean up variables
"RTN","PRCVPOSD",179,0)
 K PRCVINP,PRCVCNT,PRCVPO,PRCVTT,PRCVT1,PRCVT2,PRCVDZ,PRCVDNM,PRCVNML,PRCVNMF,PRCVVNI,PRCVVNF,PRCVDT,PRCVERD,PRCVSTA,N,PRCVX
"RTN","PRCVPOSD",180,0)
 K PRCVPRO,PRCVCS,PRCVFS,PRCVLN,PRCVDDN,PRCVIN,PRCVTN,PRCVUOP,PRCVQO,PRCVUP,PRCVNIF,PRCVPM,PRCVQR,PRCVTIC,PRCVDIC,PRCVAT,PRCVPSTA
"RTN","PRCVPOSD",181,0)
 K HLA,VAL,PRCVDP,PRCVERC,PRCVERM,PRCVERD,PRCVERR
"RTN","PRCVPOSD",182,0)
 ;
"RTN","PRCVPOSD",183,0)
 Q
"RTN","PRCVPOU")
0^12^B15199812
"RTN","PRCVPOU",1,0)
PRCVPOU ;WOIFO/AS-SEND PO AMENDMENT TO DYNAMED ; 01/24/05
"RTN","PRCVPOU",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVPOU",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVPOU",4,0)
 ;
"RTN","PRCVPOU",5,0)
 ; PO amendment
"RTN","PRCVPOU",6,0)
 ; Input: PRCHPO (PO number)
"RTN","PRCVPOU",7,0)
 ;        PRCHAM (amendment number)
"RTN","PRCVPOU",8,0)
 ; Called from PRCHAM (Amendment to Purchase Order/Card)
"RTN","PRCVPOU",9,0)
 ;             PRCFFMOM (Amendment Processing)
"RTN","PRCVPOU",10,0)
 ;
"RTN","PRCVPOU",11,0)
 Q
"RTN","PRCVPOU",12,0)
ENT(PRCHPO,PRCHAM) ;
"RTN","PRCVPOU",13,0)
 N AMEND,PRCV,CHG,FLD,ITM,NPO,NXT,ALL,EXT,AMD,PRCVP,DIQ,DIC,DA,DR,DONE
"RTN","PRCVPOU",14,0)
 S AMEND=0,DIQ="PRCVP",DIQ(0)="IE",DIC=442,DA=PRCHPO,DR=".07;7;62"
"RTN","PRCVPOU",15,0)
 D EN^DIQ1
"RTN","PRCVPOU",16,0)
 S EXT=PRCVP(442,PRCHPO,62,"E"),DONE=0
"RTN","PRCVPOU",17,0)
 I EXT']"" S EXT=PRCVP(442,PRCHPO,.07,"E")
"RTN","PRCVPOU",18,0)
 S $P(EXT,"^",2)=PRCVP(442,PRCHPO,7,"I") ; delivery date
"RTN","PRCVPOU",19,0)
 F  S AMEND=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND)) Q:AMEND'>0  D
"RTN","PRCVPOU",20,0)
 . S NXT="E"_+AMEND
"RTN","PRCVPOU",21,0)
 . I $T(@NXT)'="" D @NXT
"RTN","PRCVPOU",22,0)
 Q
"RTN","PRCVPOU",23,0)
E22 ;Line Item Delete
"RTN","PRCVPOU",24,0)
 S FLD=0 K PRCV("DEL"),^TMP("PRCV442A",$J,PRCHPO)
"RTN","PRCVPOU",25,0)
 F  S FLD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",22,FLD)) Q:FLD'>0  D
"RTN","PRCVPOU",26,0)
 . S CHG=0
"RTN","PRCVPOU",27,0)
 . F  S CHG=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",22,FLD,CHG)) Q:CHG'>0  D
"RTN","PRCVPOU",28,0)
 .. S ITM=+$P($G(^PRC(442,PRCHPO,6,PRCHAM,3,CHG,0)),"^",4)
"RTN","PRCVPOU",29,0)
 .. S PRCV("DEL",ITM)=""
"RTN","PRCVPOU",30,0)
 .. ; only item with DM document ID will be passed back
"RTN","PRCVPOU",31,0)
 .. D ITEM
"RTN","PRCVPOU",32,0)
 .. ; Insert Amendment Type of "Line Item Delete"
"RTN","PRCVPOU",33,0)
 .. S:$D(^TMP("PRCV442A",$J,PRCHPO,ITM)) $P(^(ITM),"^",14)=2
"RTN","PRCVPOU",34,0)
 ;    create header only if item exist
"RTN","PRCVPOU",35,0)
 I $D(^TMP("PRCV442A",$J,PRCHPO)) D 
"RTN","PRCVPOU",36,0)
 . D HEADER
"RTN","PRCVPOU",37,0)
 . ;    If there is no Line Item Edit, send out this message
"RTN","PRCVPOU",38,0)
 . I '$D(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",23)) D SEND
"RTN","PRCVPOU",39,0)
 Q
"RTN","PRCVPOU",40,0)
E23 ;Line Item Edit
"RTN","PRCVPOU",41,0)
 ;  If delivery date changed, send all items, Quit
"RTN","PRCVPOU",42,0)
 I PRCFA("DLVDATE")'=$P(EXT,"^",2) S ALL=1 D ALLITEM Q
"RTN","PRCVPOU",43,0)
 ;
"RTN","PRCVPOU",44,0)
 S FLD=0 K PRCV("EDT")
"RTN","PRCVPOU",45,0)
 ;    remove duplicated line item
"RTN","PRCVPOU",46,0)
 F  S FLD=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",23,FLD)) Q:'FLD  D
"RTN","PRCVPOU",47,0)
 . S CHG=0
"RTN","PRCVPOU",48,0)
 . F  S CHG=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",23,FLD,CHG)) Q:'CHG  D
"RTN","PRCVPOU",49,0)
 .. S ITM=+$P($G(^PRC(442,PRCHPO,6,PRCHAM,3,CHG,0)),"^",4)
"RTN","PRCVPOU",50,0)
 .. ;   no transmission if item already deleted
"RTN","PRCVPOU",51,0)
 .. S:'$D(PRCV("DEL",ITM)) PRCV("EDT",ITM)=""
"RTN","PRCVPOU",52,0)
 ;
"RTN","PRCVPOU",53,0)
 ; Process edited line items after duplicated lines removed
"RTN","PRCVPOU",54,0)
 S ITM=0
"RTN","PRCVPOU",55,0)
 F  S ITM=$O(PRCV("EDT",ITM)) Q:'ITM  D
"RTN","PRCVPOU",56,0)
 . D ITEM
"RTN","PRCVPOU",57,0)
 . ; Insert Amendment Type of "Line Item Edit"
"RTN","PRCVPOU",58,0)
 . S:$D(^TMP("PRCV442A",$J,PRCHPO,ITM)) $P(^(ITM),"^",14)=1
"RTN","PRCVPOU",59,0)
 ;
"RTN","PRCVPOU",60,0)
 ;    create header only if item exist
"RTN","PRCVPOU",61,0)
 I $D(^TMP("PRCV442A",$J,PRCHPO)) D HEADER,SEND S DONE=1
"RTN","PRCVPOU",62,0)
 Q
"RTN","PRCVPOU",63,0)
E31 ; Change Vendor
"RTN","PRCVPOU",64,0)
 ;    Send new vendor only
"RTN","PRCVPOU",65,0)
 ;       New vendor already in 442
"RTN","PRCVPOU",66,0)
 ;          No need to find it elsewhere
"RTN","PRCVPOU",67,0)
 S ALL=3
"RTN","PRCVPOU",68,0)
 D ALLITEM S DONE=1
"RTN","PRCVPOU",69,0)
 Q
"RTN","PRCVPOU",70,0)
E32 ; Replace PO Number
"RTN","PRCVPOU",71,0)
 ;    Send new PO number information including DynaMed Doc ID
"RTN","PRCVPOU",72,0)
 S NPO=$P($G(^PRC(442,PRCHPO,23)),"^",4)
"RTN","PRCVPOU",73,0)
 Q:'NPO
"RTN","PRCVPOU",74,0)
 S PRCHPO=NPO
"RTN","PRCVPOU",75,0)
 S ALL=4
"RTN","PRCVPOU",76,0)
 D ALLITEM
"RTN","PRCVPOU",77,0)
 Q
"RTN","PRCVPOU",78,0)
E34 ; Authority Edit
"RTN","PRCVPOU",79,0)
 Q:DONE    ; if Change Vendor and Line Edit already done.
"RTN","PRCVPOU",80,0)
 ;  If change to delivery date only without any other amendment
"RTN","PRCVPOU",81,0)
 ;  Authority Edit became No Charge Amendment
"RTN","PRCVPOU",82,0)
 I $P($G(^PRC(442,PRCHPO,6,PRCHAM,0)),"^",4)'=5,PRCFA("DLVDATE")'=$P(EXT,"^",2) D
"RTN","PRCVPOU",83,0)
 . S ALL=1 D ALLITEM
"RTN","PRCVPOU",84,0)
 ;    Send PO Cancelled only
"RTN","PRCVPOU",85,0)
 Q:$P($G(^PRC(442,PRCHPO,6,PRCHAM,0)),"^",4)'=5
"RTN","PRCVPOU",86,0)
 ; change amendment type to Cancel
"RTN","PRCVPOU",87,0)
 S ALL=5
"RTN","PRCVPOU",88,0)
 D ALLITEM
"RTN","PRCVPOU",89,0)
 Q
"RTN","PRCVPOU",90,0)
 ;
"RTN","PRCVPOU",91,0)
HEADER ;
"RTN","PRCVPOU",92,0)
 ; Get PO header information
"RTN","PRCVPOU",93,0)
 D PO^PRCV442A(PRCHPO)
"RTN","PRCVPOU",94,0)
 ;   Change transaction type to PO Amendment
"RTN","PRCVPOU",95,0)
 S $P(^TMP("PRCV442A",$J,PRCHPO),"^",2)=2
"RTN","PRCVPOU",96,0)
 ;   Amendment signed date
"RTN","PRCVPOU",97,0)
 S $P(^TMP("PRCV442A",$J,PRCHPO),"^",7)=$P($G(^PRC(442,PRCHPO,6,PRCHAM,1)),"^",3)
"RTN","PRCVPOU",98,0)
 Q
"RTN","PRCVPOU",99,0)
ITEM ;
"RTN","PRCVPOU",100,0)
 D ITEM^PRCV442A(PRCHPO,ITM,EXT)
"RTN","PRCVPOU",101,0)
 Q
"RTN","PRCVPOU",102,0)
ALLITEM ;
"RTN","PRCVPOU",103,0)
 ; If header level amendment, send all items to DynaMed
"RTN","PRCVPOU",104,0)
 ;     1.   Collect all deleted item
"RTN","PRCVPOU",105,0)
 K ^TMP("PRCV442A",$J,PRCHPO),PRCV("DEL")
"RTN","PRCVPOU",106,0)
 S AMD=0 F  S AMD=$O(^PRC(442,PRCHPO,6,AMD)) Q:'AMD  D
"RTN","PRCVPOU",107,0)
 . S FLD=0
"RTN","PRCVPOU",108,0)
 . F  S FLD=$O(^PRC(442,PRCHPO,6,AMD,3,"AC",22,FLD)) Q:'FLD  D
"RTN","PRCVPOU",109,0)
 .. S CHG=0
"RTN","PRCVPOU",110,0)
 .. F  S CHG=$O(^PRC(442,PRCHPO,6,AMD,3,"AC",22,FLD,CHG)) Q:'CHG  D
"RTN","PRCVPOU",111,0)
 ... S ITM=+$P($G(^PRC(442,PRCHPO,6,AMD,3,CHG,0)),"^",4)
"RTN","PRCVPOU",112,0)
 ... S PRCV("DEL",ITM)=""
"RTN","PRCVPOU",113,0)
 ;     2.   pickup all items to DynaMed except deleted items
"RTN","PRCVPOU",114,0)
 S ITM=0 F  S ITM=$O(^PRC(442,PRCHPO,2,ITM)) Q:'ITM  D
"RTN","PRCVPOU",115,0)
 . I '$D(PRCV("DEL",ITM)) D ITEM
"RTN","PRCVPOU",116,0)
 . S:$D(^TMP("PRCV442A",$J,PRCHPO,ITM)) $P(^(ITM),"^",14)=ALL
"RTN","PRCVPOU",117,0)
 ;    create header and send only if item exist
"RTN","PRCVPOU",118,0)
 I $D(^TMP("PRCV442A",$J,PRCHPO)) D HEADER,SEND
"RTN","PRCVPOU",119,0)
 Q
"RTN","PRCVPOU",120,0)
SEND ;
"RTN","PRCVPOU",121,0)
 ;  Do not send if no item collected
"RTN","PRCVPOU",122,0)
 Q:'$O(^TMP("PRCV442A",$J,PRCHPO,0))
"RTN","PRCVPOU",123,0)
 M ^TMP("ASU442A",$J)=^TMP("PRCV442A",$J)
"RTN","PRCVPOU",124,0)
 D EN^PRCVPOSD(PRCHPO)
"RTN","PRCVPOU",125,0)
 Q
"RTN","PRCVRC1")
0^13^B52536625
"RTN","PRCVRC1",1,0)
PRCVRC1 ;WOIFO/BMM - silently build RIL for DynaMed ; 3/24/05 2:43pm
"RTN","PRCVRC1",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRC1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRC1",4,0)
 ;
"RTN","PRCVRC1",5,0)
 ;^XTMP format for incoming DM data is set:
"RTN","PRCVRC1",6,0)
 ;^XTMP("PRCVRE*ID",0)=termination date^entry date^ Transmit message 
"RTN","PRCVRC1",7,0)
 ;to DynaMed for updates^date/time of this XTMP node built (debugging)
"RTN","PRCVRC1",8,0)
 ;^XTMP("PRCVRE*ID",0,"ERR")=Error message flag
"RTN","PRCVRC1",9,0)
 ;^XTMP("PRCVRE*ID",1)=Item counter/last item entered^FCP^CC^
"RTN","PRCVRC1",10,0)
 ;Order Control Code^Site Number^Date/Time message created^DUZ^
"RTN","PRCVRC1",11,0)
 ;Entered By Last Name^Entered by First Name
"RTN","PRCVRC1",12,0)
 ;^XTMP("PRCVRE*ID",1,n)=item #^quantity^vendor #^cost^Date Needed^
"RTN","PRCVRC1",13,0)
 ;DynaMed Document Number^NIF #^BOC
"RTN","PRCVRC1",14,0)
 ;^XTMP("PRCVRE*ID",1,n,"ERR")=error message
"RTN","PRCVRC1",15,0)
 ;
"RTN","PRCVRC1",16,0)
 ;need to validate the NIF# and BOC but not save to a file in IFCAP. 
"RTN","PRCVRC1",17,0)
 ;send a message back to DM if validation fails
"RTN","PRCVRC1",18,0)
 ;
"RTN","PRCVRC1",19,0)
 ;pseudocode
"RTN","PRCVRC1",20,0)
 ;calling routine sends PRCVRE_message ID as parameter
"RTN","PRCVRC1",21,0)
 ;get information from ^XTMP
"RTN","PRCVRC1",22,0)
 ;  validate NIF# and BOC, send back alerts if necessary
"RTN","PRCVRC1",23,0)
 ;look up the information on Item and Vendor that we need
"RTN","PRCVRC1",24,0)
 ;silently create the RIL in 410.3
"RTN","PRCVRC1",25,0)
 ;  first create 410.3 record using Entry Number (site-FY-qtr-
"RTN","PRCVRC1",26,0)
 ;    fcp-cc-txn#), 
"RTN","PRCVRC1",27,0)
 ;if error - make ERR node for item in ^XTMP, he needs error code,
"RTN","PRCVRC1",28,0)
 ;  severity, fields involved.  if error is IFCAP (FileMan API) and 
"RTN","PRCVRC1",29,0)
 ;  not DM, send Vic an err at top level (1-node in XTMP) and he'll 
"RTN","PRCVRC1",30,0)
 ;  reject entire msg.  else if FileMan API error is item-level then 
"RTN","PRCVRC1",31,0)
 ;  add to item-level ERR node
"RTN","PRCVRC1",32,0)
 ;
"RTN","PRCVRC1",33,0)
 ;summary info
"RTN","PRCVRC1",34,0)
 ;PRCVEF - error flag, set if any errors found with detail line
"RTN","PRCVRC1",35,0)
 ;PRCVLN1 - summary info line for record
"RTN","PRCVRC1",36,0)
 ;PRCVCTR - #detail line records
"RTN","PRCVRC1",37,0)
 ;PRCVDUZ - user DUZ
"RTN","PRCVRC1",38,0)
 ;PRCVIEN - new ien for RIL being created
"RTN","PRCVRC1",39,0)
 ;PRCVGL - global (first) subscript for ^XTMP
"RTN","PRCVRC1",40,0)
 ;PRCVMID - message id from PRCVGL (ID from comments above)
"RTN","PRCVRC1",41,0)
 ;PRCVFN, PRCVLN - user first and last name
"RTN","PRCVRC1",42,0)
 ;PRCVFCP - FCP
"RTN","PRCVRC1",43,0)
 ;PRCVHF - flag to prevent adding the header to the RIL if errors
"RTN","PRCVRC1",44,0)
 ;PRCVCC - CC
"RTN","PRCVRC1",45,0)
 ;PRCVOCC - Order Control Code
"RTN","PRCVRC1",46,0)
 ;PRCVST - site
"RTN","PRCVRC1",47,0)
 ;PRCVDT - date/time message created
"RTN","PRCVRC1",48,0)
 ;PRCVQTR - fiscal quarter
"RTN","PRCVRC1",49,0)
 ;PRCVFY - fiscal year
"RTN","PRCVRC1",50,0)
 ;PRCVSTR - becomes the RIL#, ST-FY-QTR-FCP-CC-TN
"RTN","PRCVRC1",51,0)
 ;PRCVTN - transaction#
"RTN","PRCVRC1",52,0)
 ;PRCVAS - data for Audit File #414.02,
"RTN","PRCVRC1",53,0)
 ;   PRCVAS=DN-ITM-VN-DUZ-STR-DT-$$NOW^XLFDT
"RTN","PRCVRC1",54,0)
 ;PRCVAH - header data for Audit File, DUZ-LN-FN-STR-DT-$$NOW
"RTN","PRCVRC1",55,0)
 ;
"RTN","PRCVRC1",56,0)
 ;detail info
"RTN","PRCVRC1",57,0)
 ;PRCVMC - count of detail messages that get posted to 410.3. used
"RTN","PRCVRC1",58,0)
 ;  to determine if any detail records were posted at all (if not
"RTN","PRCVRC1",59,0)
 ;  then header is deleted and no RIL is created)
"RTN","PRCVRC1",60,0)
 ;PRCVA - array of values to add a detail record to 410.3
"RTN","PRCVRC1",61,0)
 ;PRCVDTL - each detail info line w/data below
"RTN","PRCVRC1",62,0)
 ;PRCVEL - counter for going through the detail records
"RTN","PRCVRC1",63,0)
 ;PRCVNIF - NIF #
"RTN","PRCVRC1",64,0)
 ;PRCVBOC - budget object code
"RTN","PRCVRC1",65,0)
 ;PRCVLF - flag to prevent adding a line item to the RIL if errors
"RTN","PRCVRC1",66,0)
 ;PRCVVN - vendor name
"RTN","PRCVRC1",67,0)
 ;PRCVCST - item unit cost
"RTN","PRCVRC1",68,0)
 ;PRCVQTY - quantity
"RTN","PRCVRC1",69,0)
 ;PRCVITM - item #
"RTN","PRCVRC1",70,0)
 ;PRCVDN - DynaMed document number
"RTN","PRCVRC1",71,0)
 ;PRCVDTN - date needed
"RTN","PRCVRC1",72,0)
 ;PRCVDR - date/time RIL is created
"RTN","PRCVRC1",73,0)
 ;
"RTN","PRCVRC1",74,0)
 Q
"RTN","PRCVRC1",75,0)
 ;
"RTN","PRCVRC1",76,0)
EN(PRCVGL) ;entry point
"RTN","PRCVRC1",77,0)
 Q:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1
"RTN","PRCVRC1",78,0)
 N PRCVA,PRCVAH,PRCVAS,PRCVBOC,PRCVCC,PRCVCST,PRCVCTR,PRCVDR
"RTN","PRCVRC1",79,0)
 N PRCVDT,PRCVDTL,PRCVDN,PRCVDTN,PRCVDUZ,PRCVEF,PRCVEL,PRCVFCP
"RTN","PRCVRC1",80,0)
 N PRCVFN,PRCVFY,PRCVHF,PRCVITM,PRCVIEN,PRCVLN,PRCVLN1,PRCVMID
"RTN","PRCVRC1",81,0)
 N PRCVMC,PRCVNIF,PRCVOCC,PRCVQTR,PRCVQTY,PRCVST,PRCVSTR,PRCVVN
"RTN","PRCVRC1",82,0)
 N PRCVVNM,PRCVTC,PRCVTN
"RTN","PRCVRC1",83,0)
 S (PRCVAH,PRCVAS,PRCVVNM,PRCVBOC,PRCVCC,PRCVFN,PRCVDR)=""
"RTN","PRCVRC1",84,0)
 S (PRCVCST,PRCVTC,PRCVDUZ,PRCVDT)=0,(PRCVDTL,PRCVDTN,PRCVA)=""
"RTN","PRCVRC1",85,0)
 S (PRCVEL,PRCVITM,PRCVLN,PRCVLN1)="",(PRCVFCP,PRCVFY,PRCVST)=0
"RTN","PRCVRC1",86,0)
 S (PRCVOCC,PRCVSTR,PRCVIEN)="",(PRCVNIF,PRCVQTR,PRCVQTY)=0
"RTN","PRCVRC1",87,0)
 S (PRCVCTR,PRCVMC,PRCVVN,PRCVTC,PRCVTN,PRCVIEN,PRCVHF)=0
"RTN","PRCVRC1",88,0)
 D:'$D(U) DT^DICRW
"RTN","PRCVRC1",89,0)
 ;check for existence of ^XTMP global, else quit
"RTN","PRCVRC1",90,0)
 I '$D(^XTMP(PRCVGL,0)) G EXIT
"RTN","PRCVRC1",91,0)
 ;get header and summary data on records, quit if undef
"RTN","PRCVRC1",92,0)
 S PRCVLN1=$G(^XTMP(PRCVGL,1))
"RTN","PRCVRC1",93,0)
 I PRCVLN1="" D  G EXIT
"RTN","PRCVRC1",94,0)
 . D SENDMSG^PRCVRC2(2,PRCVGL,"",1)
"RTN","PRCVRC1",95,0)
 ;get message id - not needed for now
"RTN","PRCVRC1",96,0)
 ;S PRCVMID=$P(PRCVGL,"*",2)
"RTN","PRCVRC1",97,0)
 ;get data for other fields from ^XTMP
"RTN","PRCVRC1",98,0)
 S PRCVCTR=$P(PRCVLN1,U)+1
"RTN","PRCVRC1",99,0)
 I +PRCVCTR=1!(PRCVCTR'=+PRCVCTR) D  S PRCVHF=1
"RTN","PRCVRC1",100,0)
 . D SENDMSG^PRCVRC2(1,PRCVGL,"",1)
"RTN","PRCVRC1",101,0)
 S PRCVDUZ=$P(PRCVLN1,U,7)
"RTN","PRCVRC1",102,0)
 S PRCVST=$P(PRCVLN1,U,5)
"RTN","PRCVRC1",103,0)
 S PRCVFCP=$P(PRCVLN1,U,2)
"RTN","PRCVRC1",104,0)
 I '$$CHKFCP^PRCVRC2(PRCVFCP,PRCVST) D  S PRCVHF=1
"RTN","PRCVRC1",105,0)
 . D SENDMSG^PRCVRC2(25,PRCVGL,"",2)
"RTN","PRCVRC1",106,0)
 S PRCVCC=$P(PRCVLN1,U,3)
"RTN","PRCVRC1",107,0)
 ;check FCP and CC
"RTN","PRCVRC1",108,0)
 I '$$VALIDCC^PRCSECP(PRCVST,PRCVFCP,PRCVCC) D  S PRCVHF=1
"RTN","PRCVRC1",109,0)
 . D SENDMSG^PRCVRC2(3,PRCVGL,"",3)
"RTN","PRCVRC1",110,0)
 ;S PRCVOCC=$O(PRCVLN1,U,4)     not needed
"RTN","PRCVRC1",111,0)
 ;Date/time message created
"RTN","PRCVRC1",112,0)
 S PRCVDT=$P(PRCVLN1,U,6)
"RTN","PRCVRC1",113,0)
 ;check that PRCVDT is not in future
"RTN","PRCVRC1",114,0)
 I '$$CHKDT^PRCVRC2(PRCVDT) D  S PRCVHF=1
"RTN","PRCVRC1",115,0)
 . D SENDMSG^PRCVRC2(4,PRCVGL,"",6)
"RTN","PRCVRC1",116,0)
 ;get date/time RIL created (now)
"RTN","PRCVRC1",117,0)
 S PRCVDR=$$NOW^XLFDT
"RTN","PRCVRC1",118,0)
 K PRCVA S PRCVA(410.3,"+1,",8)=PRCVDT
"RTN","PRCVRC1",119,0)
 S PRCVA(410.3,"+1,",4)=PRCVDR
"RTN","PRCVRC1",120,0)
 ;make Entry Number - in 410.3 not 410.31 multiple
"RTN","PRCVRC1",121,0)
 S PRCVQTR=$$GETQTR^PRCVRC2(PRCVDT)
"RTN","PRCVRC1",122,0)
 I 'PRCVQTR D SENDMSG^PRCVRC2(5,PRCVGL,"",6) S PRCVHF=1
"RTN","PRCVRC1",123,0)
 S PRCVFY=$$GETFY^PRCVRC2(PRCVDT)
"RTN","PRCVRC1",124,0)
 I 'PRCVFY D SENDMSG^PRCVRC2(6,PRCVGL,"",6) S PRCVHF=1
"RTN","PRCVRC1",125,0)
 S PRCVSTR=PRCVST_"-"_PRCVFY_"-"_PRCVQTR_"-"_PRCVFCP_"-"_PRCVCC
"RTN","PRCVRC1",126,0)
 S PRCVTN=$$GETTXN^PRCVRC2(PRCVSTR)
"RTN","PRCVRC1",127,0)
 I PRCVTN=0 D SENDMSG^PRCVRC2(7,PRCVGL,"",1) S PRCVHF=1
"RTN","PRCVRC1",128,0)
 S PRCVSTR=PRCVSTR_"-"_PRCVTN
"RTN","PRCVRC1",129,0)
 S PRCVA(410.3,"+1,",.01)=PRCVSTR
"RTN","PRCVRC1",130,0)
 ;validate DUZ
"RTN","PRCVRC1",131,0)
 S PRCVDUZ=$P(PRCVLN1,U,7)
"RTN","PRCVRC1",132,0)
 I '$$CHKDUZ^PRCVRC2(PRCVDUZ) D  S PRCVHF=1
"RTN","PRCVRC1",133,0)
 . D SENDMSG^PRCVRC2(8,PRCVGL,"",7)
"RTN","PRCVRC1",134,0)
 ;create new RIL entry, new IEN in PRCVIEN(1)
"RTN","PRCVRC1",135,0)
 I 'PRCVHF D
"RTN","PRCVRC1",136,0)
 . D UPDATE^DIE("","PRCVA","PRCVIEN")
"RTN","PRCVRC1",137,0)
 . S PRCVIEN=$G(PRCVIEN(1))
"RTN","PRCVRC1",138,0)
 I PRCVHF K PRCVA
"RTN","PRCVRC1",139,0)
 ;user info- convert last name, first name to uppercase
"RTN","PRCVRC1",140,0)
 S PRCVLN=$$MAKECAP^PRCVRC2($P(PRCVLN1,U,8))
"RTN","PRCVRC1",141,0)
 S PRCVFN=$$MAKECAP^PRCVRC2($P(PRCVLN1,U,9))
"RTN","PRCVRC1",142,0)
 ;create header values string for Audit file
"RTN","PRCVRC1",143,0)
 S PRCVAH=PRCVDUZ_"^"_$E(PRCVLN_","_PRCVFN,1,35)_"^"_PRCVSTR
"RTN","PRCVRC1",144,0)
 S PRCVAH=PRCVAH_"^"_PRCVDR_"^"_PRCVDT
"RTN","PRCVRC1",145,0)
 ;
"RTN","PRCVRC1",146,0)
 ;get detail records. this is done inside loop to get all XTMP
"RTN","PRCVRC1",147,0)
 ;nodes for this FCP/CC
"RTN","PRCVRC1",148,0)
 S PRCVEL=1
"RTN","PRCVRC1",149,0)
D1 S PRCVEL=PRCVEL+1,PRCVEF=0,PRCVAS=""
"RTN","PRCVRC1",150,0)
 G:PRCVEL>PRCVCTR EXIT
"RTN","PRCVRC1",151,0)
 S (PRCVDTL,PRCVVN)="" K PRCVA
"RTN","PRCVRC1",152,0)
 ;if no detail node then skip
"RTN","PRCVRC1",153,0)
 G:'$D(^XTMP(PRCVGL,2,PRCVEL-1)) D1
"RTN","PRCVRC1",154,0)
 ;detail info string
"RTN","PRCVRC1",155,0)
 S PRCVDTL=$G(^XTMP(PRCVGL,2,PRCVEL-1))
"RTN","PRCVRC1",156,0)
 ;get DynaMed doc id
"RTN","PRCVRC1",157,0)
 S PRCVDN=$P(PRCVDTL,U,6)
"RTN","PRCVRC1",158,0)
 I PRCVDN="" D  S PRCVEF=1
"RTN","PRCVRC1",159,0)
 . D SENDMSG^PRCVRC2(24,PRCVGL,PRCVEL-1,1)
"RTN","PRCVRC1",160,0)
 I $D(^PRCV(414.02,"B",PRCVDN)) D  S PRCVEF=1
"RTN","PRCVRC1",161,0)
 . D SENDMSG^PRCVRC2(22,PRCVGL,PRCVEL-1,6)
"RTN","PRCVRC1",162,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",6)=PRCVDN
"RTN","PRCVRC1",163,0)
 ;Item
"RTN","PRCVRC1",164,0)
 S PRCVITM=$P(PRCVDTL,U)
"RTN","PRCVRC1",165,0)
 I '$$CHKITM^PRCVRC2(PRCVITM) D  S PRCVEF=1
"RTN","PRCVRC1",166,0)
 . D SENDMSG^PRCVRC2(9,PRCVGL,PRCVEL-1,1)
"RTN","PRCVRC1",167,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",.01)=PRCVITM
"RTN","PRCVRC1",168,0)
 ;Quantity
"RTN","PRCVRC1",169,0)
 S PRCVQTY=$P(PRCVDTL,U,2)
"RTN","PRCVRC1",170,0)
 I PRCVQTY'=+PRCVQTY D  S PRCVEF=1
"RTN","PRCVRC1",171,0)
 . D SENDMSG^PRCVRC2(10,PRCVGL,PRCVEL-1,2)
"RTN","PRCVRC1",172,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",1)=PRCVQTY
"RTN","PRCVRC1",173,0)
 ;Est. Item Unit Cost
"RTN","PRCVRC1",174,0)
 S PRCVCST=$P(PRCVDTL,U,4)
"RTN","PRCVRC1",175,0)
 I '(PRCVCST?.N.1".".2N) D  S PRCVEF=1
"RTN","PRCVRC1",176,0)
 . D SENDMSG^PRCVRC2(11,PRCVGL,PRCVEL-1,4)
"RTN","PRCVRC1",177,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",3)=PRCVCST
"RTN","PRCVRC1",178,0)
 ;Date Needed
"RTN","PRCVRC1",179,0)
 S PRCVDTN=$P(PRCVDTL,U,5)
"RTN","PRCVRC1",180,0)
 ;check that date needed is today or in future
"RTN","PRCVRC1",181,0)
 I '$$CHKDTN^PRCVRC2(PRCVDTN) D  S PRCVEF=1
"RTN","PRCVRC1",182,0)
 . D SENDMSG^PRCVRC2(12,PRCVGL,PRCVEL-1,5)
"RTN","PRCVRC1",183,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",7)=PRCVDTN
"RTN","PRCVRC1",184,0)
 ;Vendor # (pointer to 440)
"RTN","PRCVRC1",185,0)
 S PRCVVN=$P(PRCVDTL,U,3)
"RTN","PRCVRC1",186,0)
 I '$$CHKVEND^PRCVRC2(PRCVVN) D  S PRCVEF=1
"RTN","PRCVRC1",187,0)
 . D SENDMSG^PRCVRC2(13,PRCVGL,PRCVEL-1,3)
"RTN","PRCVRC1",188,0)
 ;check that vendor and item relate
"RTN","PRCVRC1",189,0)
 I '$$CHKVI^PRCVRC2(PRCVVN,PRCVITM) D  S PRCVEF=1
"RTN","PRCVRC1",190,0)
 . D SENDMSG^PRCVRC2(14,PRCVGL,PRCVEL-1,3)
"RTN","PRCVRC1",191,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",4)=PRCVVN
"RTN","PRCVRC1",192,0)
 ;Vendor name
"RTN","PRCVRC1",193,0)
 S PRCVVNM=$$GET1^DIQ(440,PRCVVN_",",.01)
"RTN","PRCVRC1",194,0)
 I PRCVVNM="" D  S PRCVEF=1
"RTN","PRCVRC1",195,0)
 . D SENDMSG^PRCVRC2(15,PRCVGL,PRCVEL-1,3)
"RTN","PRCVRC1",196,0)
 S PRCVA(410.31,"+1,"_PRCVIEN_",",2)=PRCVVNM
"RTN","PRCVRC1",197,0)
 ;create string to add entry to Audit file 414.02
"RTN","PRCVRC1",198,0)
 S PRCVAS=PRCVDN_"^"_PRCVITM_"^"_PRCVVN_"^"_PRCVAH_"^"_PRCVDTN
"RTN","PRCVRC1",199,0)
 ;add item record to 410.3 (if no errors)
"RTN","PRCVRC1",200,0)
 I 'PRCVEF D
"RTN","PRCVRC1",201,0)
 . D UPDATE^DIE("","PRCVA")
"RTN","PRCVRC1",202,0)
 . I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVRC1",203,0)
 . . D SENDMSG^PRCVRC2(16,PRCVGL,PRCVEL-1,6)
"RTN","PRCVRC1",204,0)
 . S PRCVMC=PRCVMC+1
"RTN","PRCVRC1",205,0)
 . ;add new item entry to DM Audit file
"RTN","PRCVRC1",206,0)
 . D ADDAUD^PRCVRC2(PRCVAS)
"RTN","PRCVRC1",207,0)
 . ;accumulate total cost
"RTN","PRCVRC1",208,0)
 . S PRCVTC=PRCVTC+(PRCVCST*PRCVQTY)
"RTN","PRCVRC1",209,0)
 ;
"RTN","PRCVRC1",210,0)
 S PRCVNIF=$P(PRCVDTL,U,7)
"RTN","PRCVRC1",211,0)
 ;validate NIF#
"RTN","PRCVRC1",212,0)
 I '$$CHKNIF^PRCVRC2(PRCVITM,PRCVNIF) D
"RTN","PRCVRC1",213,0)
 . D SENDMSG^PRCVRC2(17,PRCVGL,PRCVEL-1,7)
"RTN","PRCVRC1",214,0)
 S PRCVBOC=$P(PRCVDTL,U,8)
"RTN","PRCVRC1",215,0)
 ;validate BOC
"RTN","PRCVRC1",216,0)
 I '$$CHKBOC^PRCVRC2(PRCVITM,PRCVBOC) D
"RTN","PRCVRC1",217,0)
 . D SENDMSG^PRCVRC2(18,PRCVGL,PRCVEL-1,8)
"RTN","PRCVRC1",218,0)
 ;validate site/FCP/CC/BOC combination
"RTN","PRCVRC1",219,0)
 I '$$VALIDBOC^PRCSECP(PRCVST,PRCVFCP,PRCVCC,PRCVBOC) D
"RTN","PRCVRC1",220,0)
 . D SENDMSG^PRCVRC2(19,PRCVGL,PRCVEL-1,8)
"RTN","PRCVRC1",221,0)
D2 G D1
"RTN","PRCVRC1",222,0)
 ;
"RTN","PRCVRC1",223,0)
EXIT ;
"RTN","PRCVRC1",224,0)
 ;add total cost to entry
"RTN","PRCVRC1",225,0)
 I PRCVHF=0 D
"RTN","PRCVRC1",226,0)
 . K PRCVA S PRCVA(410.3,PRCVIEN_",",2)=PRCVTC
"RTN","PRCVRC1",227,0)
 . D UPDATE^DIE("","PRCVA")
"RTN","PRCVRC1",228,0)
 ;if no detail records added to RIL then kill it
"RTN","PRCVRC1",229,0)
 I PRCVMC=0,PRCVIEN>0 S DIK="^PRCS(410.3,",DA=PRCVIEN D ^DIK
"RTN","PRCVRC1",230,0)
 ;kill vars
"RTN","PRCVRC1",231,0)
 K PRCVA,PRCVBOC,PRCVCC,PRCVCST,PRCVCTR,PRCVDR,PRCVDT,PRCVDTL
"RTN","PRCVRC1",232,0)
 K PRCVDTN,PRCVDUZ,PRCVEF,PRCVEL,PRCVFCP,PRCVFN,PRCVFY,PRCVHF
"RTN","PRCVRC1",233,0)
 K PRCVITM,PRCVLN,PRCVLN1,PRCVMID,PRCVNIF,PRCVOCC,PRCVQTR
"RTN","PRCVRC1",234,0)
 K PRCVQTY,PRCVST,PRCVSTR,PRCVVN,PRCVVNM,PRCVTC,PRCVTN
"RTN","PRCVRC1",235,0)
 Q
"RTN","PRCVRC1",236,0)
 ;
"RTN","PRCVRC2")
0^14^B34815057
"RTN","PRCVRC2",1,0)
PRCVRC2 ;WOIFO/BMM - silently build RIL for DynaMed ; 12/16/04
"RTN","PRCVRC2",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRC2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRC2",4,0)
 ;
"RTN","PRCVRC2",5,0)
 ;validation, error code for PRCVRC1
"RTN","PRCVRC2",6,0)
 ;
"RTN","PRCVRC2",7,0)
 Q
"RTN","PRCVRC2",8,0)
 ;
"RTN","PRCVRC2",9,0)
GETFY(PRCVDT) ;return the fiscal year, PRCVDT is date/time the DM
"RTN","PRCVRC2",10,0)
 ;message was created (thus the date/time for RIL)
"RTN","PRCVRC2",11,0)
 ;
"RTN","PRCVRC2",12,0)
 Q $E(100+$E(PRCVDT,2,3)+$E(PRCVDT,4),2,3)
"RTN","PRCVRC2",13,0)
 ;
"RTN","PRCVRC2",14,0)
GETQTR(PRCVDT) ;return the fiscal quarter, PRCVDT is date/time the DM
"RTN","PRCVRC2",15,0)
 ;message was created (thus the date/time for RIL)
"RTN","PRCVRC2",16,0)
 ;
"RTN","PRCVRC2",17,0)
 N QTR S QTR=+$E(PRCVDT,4,5)
"RTN","PRCVRC2",18,0)
 Q $P("2^2^2^3^3^3^4^4^4^1^1^1","^",+QTR)
"RTN","PRCVRC2",19,0)
 ;
"RTN","PRCVRC2",20,0)
GETTXN(PRCVSTR) ;obtain current transaction number (if exists) from
"RTN","PRCVRC2",21,0)
 ;Transaction Number file (#410.1)
"RTN","PRCVRC2",22,0)
 ;increment transaction for current use, update 410.1 entry
"RTN","PRCVRC2",23,0)
 ;return new transaction number for this RIL
"RTN","PRCVRC2",24,0)
 ;PRCVSTR is Entry Number, comes in as "station-fy-qtr-fcp-cc"
"RTN","PRCVRC2",25,0)
 ;TXN is transaction #, PRCVRN is IEN for 410.1 entry
"RTN","PRCVRC2",26,0)
 ;NOTE: CHECK 410 too, look in EN1^PRCSUT3, lines 8-10 etc.
"RTN","PRCVRC2",27,0)
 ;
"RTN","PRCVRC2",28,0)
 Q:$G(PRCVSTR)="" 0
"RTN","PRCVRC2",29,0)
 N TXN,PRCVE,PRCVRN S TXN="",(PRCVRN,PRCVE)=0
"RTN","PRCVRC2",30,0)
 ;check if Entry Number def in 410.1
"RTN","PRCVRC2",31,0)
 K ATXN
"RTN","PRCVRC2",32,0)
 D FIND^DIC(410.1,,"1","BX",PRCVSTR,,,,,"ATXN")
"RTN","PRCVRC2",33,0)
 ;
"RTN","PRCVRC2",34,0)
 S TXN=+$G(ATXN("DILIST","ID",1,1))
"RTN","PRCVRC2",35,0)
 S PRCVRN=$G(ATXN("DILIST",2,1))
"RTN","PRCVRC2",36,0)
 I TXN<1 D  Q:PRCVE=1 0
"RTN","PRCVRC2",37,0)
 . ;TXN=0 so Entry Number not def, create new
"RTN","PRCVRC2",38,0)
 . K PRCVAT S PRCVAT(410.1,"+1,",.01)=PRCVSTR
"RTN","PRCVRC2",39,0)
 . S PRCVAT(410.1,"+1,",2)=DT
"RTN","PRCVRC2",40,0)
 . S PRCVAT(410.1,"+1,",1)=1
"RTN","PRCVRC2",41,0)
 . D UPDATE^DIE("","PRCVAT","PRCVRN")
"RTN","PRCVRC2",42,0)
 . ;don't send msg here
"RTN","PRCVRC2",43,0)
 . ;I $D(^TMP("DIERR",$J)) D SENDMSG(7,PRCVGL,0,1) S PRCVE=1 Q
"RTN","PRCVRC2",44,0)
 . I $D(^TMP("DIERR",$J)) S PRCVE=1 Q
"RTN","PRCVRC2",45,0)
 . S PRCVRN=PRCVRN(1)
"RTN","PRCVRC2",46,0)
 S TXN=TXN+1
"RTN","PRCVRC2",47,0)
 K PRCVSA S PRCVSA(410.1,PRCVRN_",",1)=TXN
"RTN","PRCVRC2",48,0)
 D FILE^DIE("","PRCVSA")
"RTN","PRCVRC2",49,0)
 ;don't send msg here
"RTN","PRCVRC2",50,0)
 ;I $D(^TMP("DILIST",$J)) D SENDMSG(7,PRCVGL,0,1) Q 0
"RTN","PRCVRC2",51,0)
 I $D(^TMP("DILIST",$J)) Q 0
"RTN","PRCVRC2",52,0)
 S TXN="000"_TXN,TXN=$E(TXN,$L(TXN)-3,$L(TXN))
"RTN","PRCVRC2",53,0)
 Q TXN
"RTN","PRCVRC2",54,0)
 ;
"RTN","PRCVRC2",55,0)
CHKDT(INDT) ;check the incoming date (date/time message created) against
"RTN","PRCVRC2",56,0)
 ;the present date.  date/time message created must be today or in
"RTN","PRCVRC2",57,0)
 ;the past.  if INDT is today or before today then return 1, else 
"RTN","PRCVRC2",58,0)
 ;return 0
"RTN","PRCVRC2",59,0)
 ;both dates are in Fileman format ex. 3050503.12446
"RTN","PRCVRC2",60,0)
 ;
"RTN","PRCVRC2",61,0)
 Q:$G(INDT)="" 0
"RTN","PRCVRC2",62,0)
 N %,PRESENT,PRCVDIFF
"RTN","PRCVRC2",63,0)
 D NOW^%DTC S PRESENT=%
"RTN","PRCVRC2",64,0)
 S PRCVDIFF=$$FMDIFF^XLFDT(PRESENT,INDT,1)
"RTN","PRCVRC2",65,0)
 I PRCVDIFF'<0 Q 1
"RTN","PRCVRC2",66,0)
 Q 0
"RTN","PRCVRC2",67,0)
 ;
"RTN","PRCVRC2",68,0)
CHKDTN(INDT) ;check the incoming date (Date Needed By from DynaMed)
"RTN","PRCVRC2",69,0)
 ;against the present date.  Date Needed By must be today or in the
"RTN","PRCVRC2",70,0)
 ;future.  if INDT is today or after today then return 1, else return 0
"RTN","PRCVRC2",71,0)
 ;both dates are in FileMan format ex. 3050503.12446
"RTN","PRCVRC2",72,0)
 ;
"RTN","PRCVRC2",73,0)
 Q:$G(INDT)="" 0
"RTN","PRCVRC2",74,0)
 N %,PRESENT,PRCVDIFF
"RTN","PRCVRC2",75,0)
 D NOW^%DTC S PRESENT=%
"RTN","PRCVRC2",76,0)
 S PRCVDIFF=$$FMDIFF^XLFDT(PRESENT,INDT,1)
"RTN","PRCVRC2",77,0)
 I PRCVDIFF'>0 Q 1
"RTN","PRCVRC2",78,0)
 Q 0
"RTN","PRCVRC2",79,0)
 ;
"RTN","PRCVRC2",80,0)
CHKBOC(ITEM,BOC) ;test BOC from passed-in detail record
"RTN","PRCVRC2",81,0)
 ;
"RTN","PRCVRC2",82,0)
 Q:$G(ITEM)="" 0
"RTN","PRCVRC2",83,0)
 N PRCVIBOC
"RTN","PRCVRC2",84,0)
 S PRCVIBOC=$$GET1^DIQ(441,ITEM_",",12,"I")
"RTN","PRCVRC2",85,0)
 I PRCVIBOC'=BOC Q 0
"RTN","PRCVRC2",86,0)
 Q 1
"RTN","PRCVRC2",87,0)
 ;
"RTN","PRCVRC2",88,0)
CHKFCP(PRCVFCP,PRCVST) ;validate that FCP is in 420
"RTN","PRCVRC2",89,0)
 ;
"RTN","PRCVRC2",90,0)
 Q:$G(PRCVFCP)=""!($G(PRCVST)="") 0
"RTN","PRCVRC2",91,0)
 N PRCVE,PRCVN,PRCVVAL
"RTN","PRCVRC2",92,0)
 S PRCVVAL=1,PRCVN=0
"RTN","PRCVRC2",93,0)
 S PRCVN=$$FIND1^DIC(420.01,","_PRCVST_",","",PRCVFCP_" ","B","","PRCVE")
"RTN","PRCVRC2",94,0)
 I +PRCVN'>0 S PRCVVAL=0
"RTN","PRCVRC2",95,0)
 Q PRCVVAL
"RTN","PRCVRC2",96,0)
 ;
"RTN","PRCVRC2",97,0)
CHKITM(PRCVITM) ;check extracted item number:
"RTN","PRCVRC2",98,0)
 ;1. must be greater than 100000
"RTN","PRCVRC2",99,0)
 ;2. must be defined in Item Master (#441) file
"RTN","PRCVRC2",100,0)
 ;3. must not be inactive (441 field 16 '=1)
"RTN","PRCVRC2",101,0)
 ;
"RTN","PRCVRC2",102,0)
 Q:$G(PRCVITM)="" 0
"RTN","PRCVRC2",103,0)
 N CITM S CITM=0
"RTN","PRCVRC2",104,0)
 ;N NITM
"RTN","PRCVRC2",105,0)
 ;S NITM=$$FIND1^DIC(441,"","X",PRCVITM,"","","ATXN")
"RTN","PRCVRC2",106,0)
 ;I '$D(ATXN) Q 1
"RTN","PRCVRC2",107,0)
 I PRCVITM'<100000,$D(^PRC(441,"B",PRCVITM)) D
"RTN","PRCVRC2",108,0)
 . I +$$GET1^DIQ(441,PRCVITM_",",16,"I")=0 S CITM=1
"RTN","PRCVRC2",109,0)
 Q CITM
"RTN","PRCVRC2",110,0)
 ;
"RTN","PRCVRC2",111,0)
CHKVEND(VENDN) ;check that vendor in Vendor file is active.
"RTN","PRCVRC2",112,0)
 ;VENDN is Vendor number
"RTN","PRCVRC2",113,0)
 ;
"RTN","PRCVRC2",114,0)
 Q:+VENDN=0 0
"RTN","PRCVRC2",115,0)
 N NVNDP,CHKFLG
"RTN","PRCVRC2",116,0)
 S CHKFLG=0
"RTN","PRCVRC2",117,0)
 I $D(^PRC(440,VENDN,0)),$$GET1^DIQ(440,VENDN_",",32,"I")="" S CHKFLG=1
"RTN","PRCVRC2",118,0)
 Q CHKFLG
"RTN","PRCVRC2",119,0)
 ;
"RTN","PRCVRC2",120,0)
CHKVI(VENDN,ITMN) ;check that vendor VENDN sells item ITMN
"RTN","PRCVRC2",121,0)
 ;can't use $$FIND1^DIC since could be >1 cross-ref and >1 node
"RTN","PRCVRC2",122,0)
 ;
"RTN","PRCVRC2",123,0)
 N ITMNN,VENDP,CHKFLG
"RTN","PRCVRC2",124,0)
 S (VENDP,ITMNN,CHKFLG)=0
"RTN","PRCVRC2",125,0)
 Q:+VENDN=0!(+ITMN=0) CHKFLG
"RTN","PRCVRC2",126,0)
 ;get item ien, quit if undef
"RTN","PRCVRC2",127,0)
 S ITMNN=$O(^PRC(441,"B",ITMN,0))
"RTN","PRCVRC2",128,0)
 Q:ITMNN="" CHKFLG
"RTN","PRCVRC2",129,0)
 ;get pointer to vendor ien
"RTN","PRCVRC2",130,0)
 S VENDP=$O(^PRC(441,ITMNN,2,"B",VENDN,0))
"RTN","PRCVRC2",131,0)
 ;check that vendor is defined
"RTN","PRCVRC2",132,0)
 I VENDP>0,$D(^PRC(440,VENDP,0)) S CHKFLG=1
"RTN","PRCVRC2",133,0)
 ;if item file defined and vendor for item defined, good
"RTN","PRCVRC2",134,0)
 Q CHKFLG
"RTN","PRCVRC2",135,0)
 ;
"RTN","PRCVRC2",136,0)
CHKDUZ(INDUZ) ;validate that DUZ against New Person (#200)
"RTN","PRCVRC2",137,0)
 ;
"RTN","PRCVRC2",138,0)
 N DUZFLG S DUZFLG=0
"RTN","PRCVRC2",139,0)
 Q:$G(INDUZ)="" DUZFLG
"RTN","PRCVRC2",140,0)
 I $D(^VA(200,INDUZ,0)) S DUZFLG=1
"RTN","PRCVRC2",141,0)
 Q DUZFLG
"RTN","PRCVRC2",142,0)
 ;
"RTN","PRCVRC2",143,0)
CHKNIF(ITEM,NIF) ;use the passed-in item to check that the passed-in
"RTN","PRCVRC2",144,0)
 ;NIF# is correct.  return 1 if valid, 0 if not valid
"RTN","PRCVRC2",145,0)
 ;
"RTN","PRCVRC2",146,0)
 N PRCVINIF
"RTN","PRCVRC2",147,0)
 S PRCVINIF=$$GET1^DIQ(441,ITEM_",",51)
"RTN","PRCVRC2",148,0)
 I PRCVINIF=NIF Q 1
"RTN","PRCVRC2",149,0)
 Q 0
"RTN","PRCVRC2",150,0)
 ;
"RTN","PRCVRC2",151,0)
MAKECAP(INSTR) ;take INSTR and return an all-caps version of it
"RTN","PRCVRC2",152,0)
 ;
"RTN","PRCVRC2",153,0)
 Q:$G(INSTR)="" ""
"RTN","PRCVRC2",154,0)
 N X,Y
"RTN","PRCVRC2",155,0)
 S X=INSTR X ^%ZOSF("UPPERCASE")
"RTN","PRCVRC2",156,0)
 Q Y
"RTN","PRCVRC2",157,0)
 ;
"RTN","PRCVRC2",158,0)
SENDMSG(EC,PRCVGL,CTR,ERPC) ;send an alert or error message back to
"RTN","PRCVRC2",159,0)
 ;DynaMed via VIE by posting "ERR" node to appropriate ^XTMP node
"RTN","PRCVRC2",160,0)
 ;
"RTN","PRCVRC2",161,0)
 ;the error text is currently stored in the routine PRCVRC3
"RTN","PRCVRC2",162,0)
 ;
"RTN","PRCVRC2",163,0)
 ;EC is the error code
"RTN","PRCVRC2",164,0)
 ;use EC to get the description and severity
"RTN","PRCVRC2",165,0)
 ;the message is built in ECSTR and the "ERR" node in ^XTMP is 
"RTN","PRCVRC2",166,0)
 ;  created using passed-in message id in MID.  the error message 
"RTN","PRCVRC2",167,0)
 ;  is appended to "ERR" and is separated by other error messages 
"RTN","PRCVRC2",168,0)
 ;  already there with a carat ("^")
"RTN","PRCVRC2",169,0)
 ;PRCVGL is the ^XTMP subscript and CTR is the detail counter #
"RTN","PRCVRC2",170,0)
 ;ERPC is the data piece in the line item node or header node to 
"RTN","PRCVRC2",171,0)
 ;  which the error pertains
"RTN","PRCVRC2",172,0)
 ;
"RTN","PRCVRC2",173,0)
 N X S X="PRCVRC3"
"RTN","PRCVRC2",174,0)
 X ^%ZOSF("TEST") I '$T Q
"RTN","PRCVRC2",175,0)
 N ECSTR,OVERSTR,ERRCTR
"RTN","PRCVRC2",176,0)
 S ERPC=$G(ERPC)
"RTN","PRCVRC2",177,0)
 S ECSTR=ERPC_"^"_$P($T(ET+EC^PRCVRC3),";;",2),CTR=+CTR
"RTN","PRCVRC2",178,0)
 I CTR'=0 D
"RTN","PRCVRC2",179,0)
 . S ERRCTR=+$O(^XTMP(PRCVGL,2,CTR,"ERR",""),-1)
"RTN","PRCVRC2",180,0)
 . S ERRCTR=ERRCTR+1,^XTMP(PRCVGL,2,CTR,"ERR",ERRCTR)=ECSTR
"RTN","PRCVRC2",181,0)
 I CTR=0 D
"RTN","PRCVRC2",182,0)
 . S ERRCTR=+$O(^XTMP(PRCVGL,1,"ERR",""),-1)
"RTN","PRCVRC2",183,0)
 . S ERRCTR=ERRCTR+1,^XTMP(PRCVGL,1,"ERR",ERRCTR)=ECSTR
"RTN","PRCVRC2",184,0)
 Q
"RTN","PRCVRC2",185,0)
 ;
"RTN","PRCVRC2",186,0)
ADDAUD(ADDSTR) ;add "^"-pieces from ADDSTR as fields to a new record in
"RTN","PRCVRC2",187,0)
 ;the Audit file #410.02
"RTN","PRCVRC2",188,0)
 ;
"RTN","PRCVRC2",189,0)
 ;ADDSTR pieces: DynaMed Doc ID ^ Item # ^ Vendor ^ User DUZ ^
"RTN","PRCVRC2",190,0)
 ;  Last name,First name ^ RIL# ^ date/time RIL created ^
"RTN","PRCVRC2",191,0)
 ;  date/time message created (DynaMed requisition) ^ date needed
"RTN","PRCVRC2",192,0)
 ;
"RTN","PRCVRC2",193,0)
 Q:$G(ADDSTR)=""
"RTN","PRCVRC2",194,0)
 ;
"RTN","PRCVRC2",195,0)
 ;set up entry
"RTN","PRCVRC2",196,0)
 N PRCVA,PRCVI,PRCVP,PRCVRIL,PRCVTMP S PRCVA="",PRCVP=0
"RTN","PRCVRC2",197,0)
 F PRCVI=.01,1,2,3,13,4,5,6,12 S PRCVP=PRCVP+1 D
"RTN","PRCVRC2",198,0)
 . S PRCVA(414.02,"+1,",PRCVI)=$P(ADDSTR,U,PRCVP)
"RTN","PRCVRC2",199,0)
 ;add record to Audit File
"RTN","PRCVRC2",200,0)
 D UPDATE^DIE("","PRCVA")
"RTN","PRCVRC2",201,0)
 ;if error, send bulletin
"RTN","PRCVRC2",202,0)
 I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVRC2",203,0)
 . S PRCVTMP="PRCVRC2",PRCVRIL=$P(ADDSTR,U,5)
"RTN","PRCVRC2",204,0)
 . S XMB(1)="creating an entry in the DynaMed Audit File (#414.02)"
"RTN","PRCVRC2",205,0)
 . S XMB(2)=$P(ADDSTR,U)
"RTN","PRCVRC2",206,0)
 . S XMB(3)="unable to create Audit File entry"
"RTN","PRCVRC2",207,0)
 . S ^TMP($J,"PRCVRC2",1,0)="",PRCVP=1
"RTN","PRCVRC2",208,0)
 . S ^TMP($J,"PRCVRC2",2,0)="DynaMed Doc ID: "_$P(ADDSTR,U)
"RTN","PRCVRC2",209,0)
 . S ^TMP($J,"PRCVRC2",3,0)="Item #: "_$P(ADDSTR,U,2)
"RTN","PRCVRC2",210,0)
 . S ^TMP($J,"PRCVRC2",4,0)="Vendor #: "_$P(ADDSTR,U,3)
"RTN","PRCVRC2",211,0)
 . S ^TMP($J,"PRCVRC2",5,0)="User DUZ: "_$P(ADDSTR,U,4)
"RTN","PRCVRC2",212,0)
 . S ^TMP($J,"PRCVRC2",6,0)="RIL #: "_$P(ADDSTR,U,5)
"RTN","PRCVRC2",213,0)
 . S ^TMP($J,"PRCVRC2",7,0)="Message date/time: "_$P(ADDSTR,U,6)
"RTN","PRCVRC2",214,0)
 . S ^TMP($J,"PRCVRC2",8,0)="RIL create date: "_PRCVRIL
"RTN","PRCVRC2",215,0)
 . S ^TMP($J,"PRCVRC2",9,0)="Date Needed: "_$P(ADDSTR,U,8)
"RTN","PRCVRC2",216,0)
 . S ^TMP($J,"PRCVRC2",10,0)="Error: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCVRC2",217,0)
 . S PRCVST=$P(PRCVRIL,"-"),PRCVFCP=$P(PRCVRIL,"-",4)
"RTN","PRCVRC2",218,0)
 . D DMERXMB^PRCVLIC(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCVRC2",219,0)
 Q
"RTN","PRCVRC2",220,0)
 ;
"RTN","PRCVRC3")
0^15^B3469680
"RTN","PRCVRC3",1,0)
PRCVRC3 ;WOIFO/BMM - silently build RIL for DynaMed ; 12/16/04
"RTN","PRCVRC3",2,0)
V ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRC3",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRC3",4,0)
 ;
"RTN","PRCVRC3",5,0)
 ;error codes and text for PRCVRC1
"RTN","PRCVRC3",6,0)
 ;
"RTN","PRCVRC3",7,0)
 Q
"RTN","PRCVRC3",8,0)
 ;
"RTN","PRCVRC3",9,0)
 ;below- each error message is listed with code, description, and
"RTN","PRCVRC3",10,0)
 ;severity level.  this is another method we may use for handling
"RTN","PRCVRC3",11,0)
 ;errors
"RTN","PRCVRC3",12,0)
 ;
"RTN","PRCVRC3",13,0)
ET ;
"RTN","PRCVRC3",14,0)
 ;;1^Malformed XTMP global^E
"RTN","PRCVRC3",15,0)
 ;;2^No message data for passed-in message id^E
"RTN","PRCVRC3",16,0)
 ;;3^FCP/CC combination invalid^E
"RTN","PRCVRC3",17,0)
 ;;4^Invalid date/time mesg created^E
"RTN","PRCVRC3",18,0)
 ;;5^Invalid fy for date/time mesg created^E
"RTN","PRCVRC3",19,0)
 ;;6^Invalid qtr for date/time mesg created^E
"RTN","PRCVRC3",20,0)
 ;;7^Error generating transaction number^E
"RTN","PRCVRC3",21,0)
 ;;8^Invalid or missing DUZ^E
"RTN","PRCVRC3",22,0)
 ;;9^Item invalid or inactivated^E
"RTN","PRCVRC3",23,0)
 ;;10^Quantity not numeric^E
"RTN","PRCVRC3",24,0)
 ;;11^Item unit cost not numeric^E
"RTN","PRCVRC3",25,0)
 ;;12^Date Needed not in future^E
"RTN","PRCVRC3",26,0)
 ;;13^Vendor not in Vendor file^E
"RTN","PRCVRC3",27,0)
 ;;14^Invalid vendor/item relationship^E
"RTN","PRCVRC3",28,0)
 ;;15^Invalid vendor name found^E
"RTN","PRCVRC3",29,0)
 ;;16^Unable to add detail record to RIL^E
"RTN","PRCVRC3",30,0)
 ;;17^Invalid NIF number for item^W
"RTN","PRCVRC3",31,0)
 ;;18^Invalid BOC for item^W
"RTN","PRCVRC3",32,0)
 ;;19^Invalid site/FCP/CC/BOC combination^W
"RTN","PRCVRC3",33,0)
 ;;20^Duplicate message control ID^E
"RTN","PRCVRC3",34,0)
 ;;21^Missing message control ID^E
"RTN","PRCVRC3",35,0)
 ;;22^Duplicate DM Doc ID^E
"RTN","PRCVRC3",36,0)
 ;;23^Error creating Audit file entry^E
"RTN","PRCVRC3",37,0)
 ;;24^Missing DynaMed Document ID^E
"RTN","PRCVRC3",38,0)
 ;;25^FCP invalid^E
"RTN","PRCVRC3",39,0)
 ;
"RTN","PRCVRCA")
0^16^B44922155
"RTN","PRCVRCA",1,0)
PRCVRCA ;WOIFO/SC-SEND RIL CANCELLATION TO DYNAMED ; 5/31/05 2:24pm
"RTN","PRCVRCA",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRCA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRCA",4,0)
 Q
"RTN","PRCVRCA",5,0)
 ;PRCVRCA is called by routine PRCSRIE1.
"RTN","PRCVRCA",6,0)
 ;This routine is extracting RIL cancellation data and passing it to
"RTN","PRCVRCA",7,0)
 ;routine PRCVEE1 which formats data into HL7 Message and then
"RTN","PRCVRCA",8,0)
 ;sends data to DynaMed. It also updates relevant info in Audit File
"RTN","PRCVRCA",9,0)
 ;#414.02. A bulletin is send if DM DOC ID is missing from an item
"RTN","PRCVRCA",10,0)
 ;or if record doesn't get updated properly in Audit File.
"RTN","PRCVRCA",11,0)
 ;
"RTN","PRCVRCA",12,0)
EN(PRCVDA) ;
"RTN","PRCVRCA",13,0)
 ;  Input PRCVDA = ien of top entry of the file
"RTN","PRCVRCA",14,0)
 ;quit if system parameter is not set to DynaMed
"RTN","PRCVRCA",15,0)
 N PRCVSYS
"RTN","PRCVRCA",16,0)
 S PRCVSYS=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVRCA",17,0)
 Q:PRCVSYS'=1
"RTN","PRCVRCA",18,0)
 ;
"RTN","PRCVRCA",19,0)
 N PRCVRIEN,PRCVDUZ,PRCVNO,PRCVIT,PRCVEXTN,PRCVFLDS
"RTN","PRCVRCA",20,0)
 N PRCVSTA,CNT,PRCVTM,PRCVCRDT,PRCVPGDT,PRCVL,PRCVDT
"RTN","PRCVRCA",21,0)
 N PRCVI,PRCVJ,PRCVK,PRCVDID,PRCVITN,PRCVQTY,PRCVCOST,PRCVDNB
"RTN","PRCVRCA",22,0)
 N PRCVDTCR,PRCVNAM,PRCVIEN,PRCVTIME,PRCVOCD,PRCVNAME
"RTN","PRCVRCA",23,0)
 N PRCVFCP,PRCVTMGL,PRCVDMRL
"RTN","PRCVRCA",24,0)
 ;
"RTN","PRCVRCA",25,0)
 S PRCVDUZ=DUZ
"RTN","PRCVRCA",26,0)
 S PRCVRIEN=PRCVDA
"RTN","PRCVRCA",27,0)
 S PRCVTIME=$H
"RTN","PRCVRCA",28,0)
 S PRCVEXTN=$$GET1^DIQ(410.3,PRCVRIEN_",",.01) ;.01 value of RIL trx
"RTN","PRCVRCA",29,0)
 ;
"RTN","PRCVRCA",30,0)
 ;Quit if RIL .01 value is not found in Audit File 414.02 'C' x-ref
"RTN","PRCVRCA",31,0)
 S PRCVDMRL=""
"RTN","PRCVRCA",32,0)
 S PRCVDMRL=$O(^PRCV(414.02,"C",PRCVEXTN,PRCVDMRL)) Q:PRCVDMRL=""
"RTN","PRCVRCA",33,0)
 ;
"RTN","PRCVRCA",34,0)
 S PRCVFCP=$P($G(PRCVEXTN),"-",4)
"RTN","PRCVRCA",35,0)
 S PRCVNO="PRCVUP*"_PRCVEXTN ; Ext val in XTMP
"RTN","PRCVRCA",36,0)
 ;S PRCVNO="PRCVUP*"_PRCVRIEN ; IEN in setting up XTMP global
"RTN","PRCVRCA",37,0)
 S PRCVSTA=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVRCA",38,0)
 S PRCVNAME=$$GET1^DIQ(200,PRCVDUZ_",",.01,"E")
"RTN","PRCVRCA",39,0)
 ;
"RTN","PRCVRCA",40,0)
 S CNT=0
"RTN","PRCVRCA",41,0)
 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVRCA",42,0)
 D SETUP0 ; set up XTMP global's zero node
"RTN","PRCVRCA",43,0)
 D ITEM ;   process all of the items
"RTN","PRCVRCA",44,0)
 I CNT>0 D SETUP1 ; if there is a line item then set Node 1
"RTN","PRCVRCA",45,0)
 I CNT'>0 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVRCA",46,0)
 ;Call HL7 Message builder routine ONLY if there are DM line items
"RTN","PRCVRCA",47,0)
 ;PRCVNO is comprised of "PRCVUP*Trx#" & Trx#: Sta-fy-Qtr-FCP-cc-seq#
"RTN","PRCVRCA",48,0)
 ;PRCVTIME is time stamp in $H format
"RTN","PRCVRCA",49,0)
 I CNT>0 D BEGIN^PRCVEE1(PRCVNO,PRCVTIME) ; passing EXT value .01
"RTN","PRCVRCA",50,0)
 D EXIT
"RTN","PRCVRCA",51,0)
 Q
"RTN","PRCVRCA",52,0)
 ;
"RTN","PRCVRCA",53,0)
ITEM ;
"RTN","PRCVRCA",54,0)
 ;N PRCVARR
"RTN","PRCVRCA",55,0)
 S PRCVI=0
"RTN","PRCVRCA",56,0)
 F  S PRCVI=$O(^PRCS(410.3,PRCVRIEN,1,PRCVI)) Q:PRCVI'>0!(+PRCVI=0)  D
"RTN","PRCVRCA",57,0)
 . N PRCVARR
"RTN","PRCVRCA",58,0)
 . S PRCVFLDS=".01;1;2;3;4;6;7"
"RTN","PRCVRCA",59,0)
 . D GETS^DIQ(410.31,PRCVI_","_PRCVRIEN_",",PRCVFLDS,"I","PRCVARR")
"RTN","PRCVRCA",60,0)
 . D SETUP ; DO a setup in XTMP struct
"RTN","PRCVRCA",61,0)
 . Q
"RTN","PRCVRCA",62,0)
 Q
"RTN","PRCVRCA",63,0)
 ;
"RTN","PRCVRCA",64,0)
 ;
"RTN","PRCVRCA",65,0)
SETUP ;set up XTMP ITEM node(S) & UPDATE audit file for each item on a RIL
"RTN","PRCVRCA",66,0)
 ;Order Control code^Item ien^Qty^Vendor ien^^Cost^DynaMed doc ID^Date Needed By
"RTN","PRCVRCA",67,0)
 ;
"RTN","PRCVRCA",68,0)
 S PRCVOCD="CA" ; order control code  ALWAYS=CA for RIL cancel
"RTN","PRCVRCA",69,0)
 S PRCVITN=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",.01,"I") ;item ien N0P1
"RTN","PRCVRCA",70,0)
 S PRCVDID=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",6,"I") ;DM docId N0P7
"RTN","PRCVRCA",71,0)
 S PRCVQTY=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",1,"I") ; qty N0P2
"RTN","PRCVRCA",72,0)
 S PRCVNAM=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",2,"I") ;vendor text name N0P3
"RTN","PRCVRCA",73,0)
 S PRCVCOST=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",3,"I") ;est unit cost N0P4
"RTN","PRCVRCA",74,0)
 S PRCVIEN=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",4,"I") ;vendor ien N0P5
"RTN","PRCVRCA",75,0)
 S PRCVDNB=PRCVARR(410.31,PRCVI_","_PRCVRIEN_",",7,"I") ;dt needed by N0P8
"RTN","PRCVRCA",76,0)
 I $G(PRCVDID)="" D IDBULET Q  ; I DMdocid is missing send a bulletin
"RTN","PRCVRCA",77,0)
 ;
"RTN","PRCVRCA",78,0)
 ;
"RTN","PRCVRCA",79,0)
 S CNT=CNT+1
"RTN","PRCVRCA",80,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",1)=PRCVOCD
"RTN","PRCVRCA",81,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",2)=PRCVITN
"RTN","PRCVRCA",82,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",3)=PRCVQTY
"RTN","PRCVRCA",83,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",4)=PRCVIEN
"RTN","PRCVRCA",84,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",6)=PRCVCOST
"RTN","PRCVRCA",85,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",7)=PRCVDID
"RTN","PRCVRCA",86,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",8)=PRCVDNB
"RTN","PRCVRCA",87,0)
 ;
"RTN","PRCVRCA",88,0)
 ;update Audit File 414.02 for RIL cancel fields 8 and 9
"RTN","PRCVRCA",89,0)
 ;#8 Date/Time removed from IFCAP      #9 Who deleted
"RTN","PRCVRCA",90,0)
 D NOW^%DTC
"RTN","PRCVRCA",91,0)
 N PRCVZ,PRCVX
"RTN","PRCVRCA",92,0)
 S PRCVZ=0
"RTN","PRCVRCA",93,0)
 S PRCVZ=$O(^PRCV(414.02,"B",PRCVDID,PRCVZ))
"RTN","PRCVRCA",94,0)
 I +$G(PRCVZ)'>0 D RDBULET Q  ; if record is missing fr 414.02 file
"RTN","PRCVRCA",95,0)
 ;S PRCVX(414.02,PRCVZ_",",1)=PRCVITN ; item ien
"RTN","PRCVRCA",96,0)
 ;S PRCVX(414.02,PRCVZ_",",2)=PRCVIEN ; vendor ien
"RTN","PRCVRCA",97,0)
 ;S PRCVX(414.02,PRCVZ_",",4)=PRCVEXTN ;    RIL .01 value
"RTN","PRCVRCA",98,0)
 S PRCVX(414.02,PRCVZ_",",8)=% ;           int dt/time for removing
"RTN","PRCVRCA",99,0)
 S PRCVX(414.02,PRCVZ_",",9)=PRCVDUZ ;     who deleted
"RTN","PRCVRCA",100,0)
 D UPDATE^DIE("","PRCVX")
"RTN","PRCVRCA",101,0)
 I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVRCA",102,0)
 . S XMB(1)="cancelling a Repetitive Item Entry (RIL)#: "_$G(PRCVEXTN)
"RTN","PRCVRCA",103,0)
 . S XMB(2)=$G(PRCVDID)
"RTN","PRCVRCA",104,0)
 . S XMB(3)="ERROR while updating the AUDIT FILE #414.02"
"RTN","PRCVRCA",105,0)
 . K ^TMP($J,"PRCVRCA") S PRCVTMGL="PRCVRCA"
"RTN","PRCVRCA",106,0)
 . S ^TMP($J,"PRCVRCA",1,0)=""
"RTN","PRCVRCA",107,0)
 . S ^TMP($J,"PRCVRCA",2,0)="RIL #: "_$G(PRCVEXTN)
"RTN","PRCVRCA",108,0)
 . S ^TMP($J,"PRCVRCA",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVRCA",109,0)
 . S ^TMP($J,"PRCVRCA",4,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVRCA",110,0)
 . S ^TMP($J,"PRCVRCA",5,0)="Deleted By: "_$G(PRCVNAME)_"  (DUZ: "_$G(PRCVDUZ)_")"
"RTN","PRCVRCA",111,0)
 . S ^TMP($J,"PRCVRCA",6,0)="Date/Time of deletion: "_$G(PRCVTM)
"RTN","PRCVRCA",112,0)
 . S ^TMP($J,"PRCVRCA",7,0)="Error Text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCVRCA",113,0)
 . D DMERXMB^PRCVLIC(PRCVTMGL,PRCVSTA,PRCVFCP)
"RTN","PRCVRCA",114,0)
 Q
"RTN","PRCVRCA",115,0)
 ;
"RTN","PRCVRCA",116,0)
SETUP0 ;set up XTMP 0 node
"RTN","PRCVRCA",117,0)
 D NOW^%DTC,YX^%DTC
"RTN","PRCVRCA",118,0)
 S PRCVTM=Y ;date/time in ext format
"RTN","PRCVRCA",119,0)
 S PRCVCRDT=DT
"RTN","PRCVRCA",120,0)
 S PRCVPGDT=$$FMADD^XLFDT(DT,5) ; purge XTMP global in 5 days
"RTN","PRCVRCA",121,0)
 ;adding this extra 0 node to comply w SACC 4/28/05
"RTN","PRCVRCA",122,0)
 S ^XTMP(PRCVNO,0)=PRCVPGDT_"^"_PRCVCRDT_"^"_"RIL Cancellation Update to DynaMed"
"RTN","PRCVRCA",123,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",1)=PRCVPGDT
"RTN","PRCVRCA",124,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",2)=PRCVCRDT
"RTN","PRCVRCA",125,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",3)="RIL Cancellation Update to DynaMed: "_PRCVTM
"RTN","PRCVRCA",126,0)
 Q
"RTN","PRCVRCA",127,0)
 ;
"RTN","PRCVRCA",128,0)
SETUP1 ;set up XTMP 1 node
"RTN","PRCVRCA",129,0)
 ;Number of records^Site^Date/Time msg created^DUZ^Entered By Last Name^Entered By First Name^ien of the record
"RTN","PRCVRCA",130,0)
 ;
"RTN","PRCVRCA",131,0)
 S PRCVDTCR=$$GET1^DIQ(410.3,PRCVRIEN_",",4) ; Trx dt/tm in IFCAP
"RTN","PRCVRCA",132,0)
 I $D(PRCVNAME),PRCVNAME]"" D NAMECOMP^XLFNAME(.PRCVNAME)
"RTN","PRCVRCA",133,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",1)=CNT ;       total no of items
"RTN","PRCVRCA",134,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",2)=PRCVSTA ;   Sta
"RTN","PRCVRCA",135,0)
 ;S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDTCR ; dt/time created
"RTN","PRCVRCA",136,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDUZ ;   DUZ
"RTN","PRCVRCA",137,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",4)=PRCVNAME("FAMILY")
"RTN","PRCVRCA",138,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",5)=PRCVNAME("GIVEN")
"RTN","PRCVRCA",139,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",6)=PRCVRIEN ;  ien of RIL
"RTN","PRCVRCA",140,0)
 Q
"RTN","PRCVRCA",141,0)
 ;
"RTN","PRCVRCA",142,0)
IDBULET ; send a bulletin if DM DOC ID is missing
"RTN","PRCVRCA",143,0)
 I PRCVDID="" D  Q
"RTN","PRCVRCA",144,0)
 . S XMB(1)="cancelling a Repetitive Item Entry (RIL)#: "_$G(PRCVEXTN)
"RTN","PRCVRCA",145,0)
 . S XMB(2)="    ...None Found"
"RTN","PRCVRCA",146,0)
 . S XMB(3)="The line item ien: "_$G(PRCVITN)_" is missing it's DM DOC ID"
"RTN","PRCVRCA",147,0)
 . K ^TMP($J,"PRCVRCA") S PRCVTMGL="PRCVRCA"
"RTN","PRCVRCA",148,0)
 . S ^TMP($J,"PRCVRCA",1,0)=""
"RTN","PRCVRCA",149,0)
 . S ^TMP($J,"PRCVRCA",2,0)="RIL #: "_$G(PRCVEXTN)
"RTN","PRCVRCA",150,0)
 . S ^TMP($J,"PRCVRCA",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVRCA",151,0)
 . S ^TMP($J,"PRCVRCA",4,0)="Vendor Name: "_$G(PRCVNAM)
"RTN","PRCVRCA",152,0)
 . S ^TMP($J,"PRCVRCA",5,0)="Deleted By: "_$G(PRCVNAME)_"  (DUZ: "_$G(PRCVDUZ)_")"
"RTN","PRCVRCA",153,0)
 . S ^TMP($J,"PRCVRCA",6,0)="Date/Time of deletion: "_$G(PRCVTM)
"RTN","PRCVRCA",154,0)
 . D DMERXMB^PRCVLIC(PRCVTMGL,PRCVSTA,PRCVFCP)
"RTN","PRCVRCA",155,0)
 Q
"RTN","PRCVRCA",156,0)
 ;
"RTN","PRCVRCA",157,0)
 ;PRCVZ - record in Audit File
"RTN","PRCVRCA",158,0)
RDBULET ;if record is missing from file 414.02
"RTN","PRCVRCA",159,0)
 I PRCVZ']"" D  Q
"RTN","PRCVRCA",160,0)
 . S XMB(1)="processing a cancel of a Repetitive Item Entry (RIL)#: "_$G(PRCVEXTN)
"RTN","PRCVRCA",161,0)
 . S XMB(2)=$G(PRCVDID)
"RTN","PRCVRCA",162,0)
 . S XMB(3)="the record related to DM DOC ID is missing in AUDIT FILE #414.02"
"RTN","PRCVRCA",163,0)
 . K ^TMP($J,"PRCVRCA") S PRCVTMGL="PRCVRCA"
"RTN","PRCVRCA",164,0)
 . S ^TMP($J,"PRCVRCA",1,0)=""
"RTN","PRCVRCA",165,0)
 . S ^TMP($J,"PRCVRCA",2,0)="RIL #: "_$G(PRCVEXTN)
"RTN","PRCVRCA",166,0)
 . S ^TMP($J,"PRCVRCA",3,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVRCA",167,0)
 . S ^TMP($J,"PRCVRCA",4,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVRCA",168,0)
 . D DMERXMB^PRCVLIC(PRCVTMGL,PRCVSTA,PRCVFCP)
"RTN","PRCVRCA",169,0)
 Q
"RTN","PRCVRCA",170,0)
 ;
"RTN","PRCVRCA",171,0)
EXIT ;kill variables and quit
"RTN","PRCVRCA",172,0)
 K %,X,Y
"RTN","PRCVRCA",173,0)
 Q
"RTN","PRCVRCA",174,0)
 ;
"RTN","PRCVRCA",175,0)
 ;
"RTN","PRCVRCG")
0^62^B50930241
"RTN","PRCVRCG",1,0)
PRCVRCG ;ISC-SF/GJW; Receive messages ; 5/24/05 10:56am
"RTN","PRCVRCG",2,0)
 ;;5.1;IFCAP;**81**;Oct. 20, 2000
"RTN","PRCVRCG",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRCG",4,0)
 ;
"RTN","PRCVRCG",5,0)
SUB(PRCVACT) ;
"RTN","PRCVRCG",6,0)
 N PRCVFS,PRCVCS,PRCVRS,PRCVES,PRCVSS,HLQUIT,HLNODE
"RTN","PRCVRCG",7,0)
 N PRCVMSG,PRCVMID,PRCVSEG,X,PRCVEVN,PRCVEVT,PRCVSTAT,PRCVCP
"RTN","PRCVRCG",8,0)
 N HLQUIT,HLNODE,X1,MYERR,MYSEQ
"RTN","PRCVRCG",9,0)
 S PRCVFS=$G(HL("FS"))
"RTN","PRCVRCG",10,0)
 S PRCVCS=$E($G(HL("ECH")),1)
"RTN","PRCVRCG",11,0)
 S PRCVRS=$E($G(HL("ECH")),2)
"RTN","PRCVRCG",12,0)
 S PRCVES=$E($G(HL("ECH")),3)
"RTN","PRCVRCG",13,0)
 S PRCVSS=$E($G(HL("ECH")),4)
"RTN","PRCVRCG",14,0)
 S (HLQUIT,HLNODE)=0
"RTN","PRCVRCG",15,0)
 ;Note: the following variable is KILLed to avoid certain
"RTN","PRCVRCG",16,0)
 ;problems with $$REPROC^HLUTIL
"RTN","PRCVRCG",17,0)
 K HLDONE1
"RTN","PRCVRCG",18,0)
 S PRCVMSG=$G(HL("MTN"))
"RTN","PRCVRCG",19,0)
 S PRCVMID=$G(HL("MID"))
"RTN","PRCVRCG",20,0)
 I ((PRCVACT=1)&(PRCVMSG'="QSB"))!((PRCVACT=2)&(PRCVMSG'="QCN")) D  Q
"RTN","PRCVRCG",21,0)
 .;Error: wrong message type
"RTN","PRCVRCG",22,0)
 .S MYERR("HL_CODE")="HL200"
"RTN","PRCVRCG",23,0)
 .S MYERR("HL_TEXT")="Unsupported Message Type"
"RTN","PRCVRCG",24,0)
 .S MYSEQ("FIELD_POS")=9 ;message type
"RTN","PRCVRCG",25,0)
 .S MYSEQ("SEG_POS")=1
"RTN","PRCVRCG",26,0)
 .D ACK("AR",PRCVMID,"MSH",.MYSEQ,.MYERR)
"RTN","PRCVRCG",27,0)
 X HLNEXT I HLQUIT'>0 D  Q
"RTN","PRCVRCG",28,0)
 .;Error: MSH segment not found
"RTN","PRCVRCG",29,0)
 .S MYERR("HL_CODE")="HL100"
"RTN","PRCVRCG",30,0)
 .S MYERR("HL_TEXT")="Segment Sequence Error"
"RTN","PRCVRCG",31,0)
 .S MYSEQ("SEG_POS")=1
"RTN","PRCVRCG",32,0)
 .D ACK("AE",$G(PRCVMID),"MSH",1,.MYERR)
"RTN","PRCVRCG",33,0)
 X HLNEXT I HLQUIT'>0 D  Q
"RTN","PRCVRCG",34,0)
 .;Error: no segments after MSH
"RTN","PRCVRCG",35,0)
 S PRCVSEG=$$FLD^HLCSUTL(.HLNODE,1)
"RTN","PRCVRCG",36,0)
 I ((PRCVACT=1)&(PRCVSEG'="QPD")) D  Q
"RTN","PRCVRCG",37,0)
 .;Error: QPD segment expected
"RTN","PRCVRCG",38,0)
 .S MYERR("HL_CODE")="HL100"
"RTN","PRCVRCG",39,0)
 .S MYERR("HL_TEXT")="Segment Sequence Error"
"RTN","PRCVRCG",40,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",41,0)
 .D ACK("AE",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",42,0)
 I ((PRCVACT=2)&(PRCVSEG'="QID")) D  Q
"RTN","PRCVRCG",43,0)
 .;Error: QID segment expected
"RTN","PRCVRCG",44,0)
 .S MYERR("HL_CODE")="HL100"
"RTN","PRCVRCG",45,0)
 .S MYERR("HL_TEXT")="Segment Sequence Error"
"RTN","PRCVRCG",46,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",47,0)
 .D ACK("AE",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",48,0)
 S X=$$FLD^HLCSUTL(.HLNODE,$S(PRCVACT=1:2,PRCVACT=2:3,1:999))
"RTN","PRCVRCG",49,0)
 I (X="") D  Q
"RTN","PRCVRCG",50,0)
 .S MYERR("HL_CODE")="HL101"
"RTN","PRCVRCG",51,0)
 .S MYERR("HL_TEXT")="Required field missing"
"RTN","PRCVRCG",52,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",53,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVSEG="QPD":1,PRCVSEG="QID":2,1:"")
"RTN","PRCVRCG",54,0)
 .D ACK("AE",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",55,0)
 S PRCVEVN=$P(X,PRCVCS,1)
"RTN","PRCVRCG",56,0)
 S PRCVEVT=$P(X,PRCVCS,2)
"RTN","PRCVRCG",57,0)
 I PRCVEVN'="Q16" D  Q
"RTN","PRCVRCG",58,0)
 .;Error: wrong event code
"RTN","PRCVRCG",59,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",60,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",61,0)
 .S MYSEQ("SEG_POS")=1
"RTN","PRCVRCG",62,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVACT=1:2,PRCVACT=1:2)
"RTN","PRCVRCG",63,0)
 .S MYSEQ("CMP_POS")=1
"RTN","PRCVRCG",64,0)
 .D ACK("AR",PRCVMID,$S(PRCVACT=1:"QPD",1:"QID"),.MYSEQ,.MYERR)
"RTN","PRCVRCG",65,0)
 I PRCVEVT'="Fund_Subscription" D  Q
"RTN","PRCVRCG",66,0)
 .;Error: wrong event
"RTN","PRCVRCG",67,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",68,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",69,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",70,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVACT=1:2,PRCVACT=1:2)
"RTN","PRCVRCG",71,0)
 .S MYSEQ("CMP_POS")=2
"RTN","PRCVRCG",72,0)
 .D ACK("AR",PRCVMID,$S(PRCVACT=1:"QPD",1:"QID"),.MYSEQ,.MYERR)
"RTN","PRCVRCG",73,0)
 I ((PRCVACT=2)&(PRCVEVT'="Fund_Subscription")) D  Q
"RTN","PRCVRCG",74,0)
 .;Error: wrong event
"RTN","PRCVRCG",75,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",76,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",77,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",78,0)
 .S MYSEQ("FIELD_POS")=2
"RTN","PRCVRCG",79,0)
 .S MYSEQ("CMP_POS")=2
"RTN","PRCVRCG",80,0)
 .D ACK("AR",PRCVMID,"QID",.MYSEQ,.MYERR)
"RTN","PRCVRCG",81,0)
 S X=$$FLD^HLCSUTL(.HLNODE,$S(PRCVACT=1:3,PRCVACT=2:2,1:999))
"RTN","PRCVRCG",82,0)
 I (X="") D  Q
"RTN","PRCVRCG",83,0)
 .S MYERR("HL_CODE")="HL101"
"RTN","PRCVRCG",84,0)
 .S MYERR("HL_TEXT")="Required field missing"
"RTN","PRCVRCG",85,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",86,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVSEG="QPD":3,PRCVSEG="QID":2,1:"")
"RTN","PRCVRCG",87,0)
 .D ACK("AE",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",88,0)
 S PRCVSTAT=$P(X,"-",1)
"RTN","PRCVRCG",89,0)
 S PRCVCP=+$P(X,"-",2)
"RTN","PRCVRCG",90,0)
 I '$D(^PRC(420,PRCVSTAT,0)) D  Q
"RTN","PRCVRCG",91,0)
 .;invalid station number
"RTN","PRCVRCG",92,0)
 .S MYERR("HL_CODE")="HL204"
"RTN","PRCVRCG",93,0)
 .S MYERR("HL_TEXT")="Unknown key identfier"
"RTN","PRCVRCG",94,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",95,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVSEG="QPD":2,PRCVSEG="QID":1,1:"")
"RTN","PRCVRCG",96,0)
 .D ACK("AR",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",97,0)
 I '$D(^PRC(420,PRCVSTAT,1,PRCVCP,0)) D  Q
"RTN","PRCVRCG",98,0)
 .;invalid station/FCP pair
"RTN","PRCVRCG",99,0)
 .S MYERR("HL_CODE")="HL204"
"RTN","PRCVRCG",100,0)
 .S MYERR("HL_TEXT")="Unknown key identfier"
"RTN","PRCVRCG",101,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",102,0)
 .S MYSEQ("FIELD_POS")=$S(PRCVSEG="QPD":2,PRCVSEG="QID":1,1:"")
"RTN","PRCVRCG",103,0)
 .D ACK("AR",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",104,0)
 G:PRCVACT=2 DEL
"RTN","PRCVRCG",105,0)
 S X1=$$ADDSUB^PRCVSUB(PRCVSTAT,PRCVCP,1)
"RTN","PRCVRCG",106,0)
 I $P(X1,"^",1)["?" D  Q
"RTN","PRCVRCG",107,0)
 .;Duplicate
"RTN","PRCVRCG",108,0)
 .;S MYERR("SEVERITY")="W"
"RTN","PRCVRCG",109,0)
 .D ACK("AA",PRCVMID)
"RTN","PRCVRCG",110,0)
 I $P(X1,"^",1)="E" D  Q
"RTN","PRCVRCG",111,0)
 .;Fileman generated error
"RTN","PRCVRCG",112,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",113,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",114,0)
 .S MYSEQ("SEG_POS")=2
"RTN","PRCVRCG",115,0)
 .D ACK("AR",PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",116,0)
 G:PRCVACT=2 DONE ;end of message
"RTN","PRCVRCG",117,0)
 X HLNEXT I HLQUIT'>0 D  Q
"RTN","PRCVRCG",118,0)
 .;Error: RCP segment expected
"RTN","PRCVRCG",119,0)
 .S MYERR("HL_CODE")="HL100"
"RTN","PRCVRCG",120,0)
 .S MYERR("HL_TEXT")="Segment sequence error"
"RTN","PRCVRCG",121,0)
 .S MYSEQ("SEG_POS")=3
"RTN","PRCVRCG",122,0)
 .D ACK("AE",PRCVMID,PRCVSEG,.MYSEQ,.MYERR)
"RTN","PRCVRCG",123,0)
 G DONE
"RTN","PRCVRCG",124,0)
DEL ;
"RTN","PRCVRCG",125,0)
 S X1=$$DELSUB^PRCVSUB(PRCVSTAT,+PRCVCP,1)
"RTN","PRCVRCG",126,0)
 I X1["E" D  Q
"RTN","PRCVRCG",127,0)
 .;Error during Fileman call
"RTN","PRCVRCG",128,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",129,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",130,0)
 .S MYSEQ("SEG_POS")=1
"RTN","PRCVRCG",131,0)
 .S MYSEQ("FIELD_POS")=1
"RTN","PRCVRCG",132,0)
 .D ACK("AE",PRCVMID,"QID",.MYSEQ,.MYERR)
"RTN","PRCVRCG",133,0)
 I X1'["@" D  Q
"RTN","PRCVRCG",134,0)
 .;Deletion error
"RTN","PRCVRCG",135,0)
 .S MYERR("HL_CODE")="HL207"
"RTN","PRCVRCG",136,0)
 .S MYERR("HL_TEXT")="Application internal error"
"RTN","PRCVRCG",137,0)
 .S MYSEQ("SEG_POS")=1
"RTN","PRCVRCG",138,0)
 .S MYSEQ("FIELD_POS")=1
"RTN","PRCVRCG",139,0)
 .D ACK("AE",PRCVMID,"QID",.MYSEQ,.MYERR)
"RTN","PRCVRCG",140,0)
DONE ;
"RTN","PRCVRCG",141,0)
 ;Success!
"RTN","PRCVRCG",142,0)
 D ACK("AA",PRCVMID)
"RTN","PRCVRCG",143,0)
 Q
"RTN","PRCVRCG",144,0)
 ;
"RTN","PRCVRCG",145,0)
ACK(PRCVSTAT,PRCVOMID,PRCVSID,PRCVSEQ,PRCVERR) ;
"RTN","PRCVRCG",146,0)
 N HLA,ERR,I,SEV,PRCVEID,PRCVAPP,PRCVEIDS,PRCVRES
"RTN","PRCVRCG",147,0)
 ;Make sure the parameters are defined
"RTN","PRCVRCG",148,0)
 S PRCVSTAT=$G(PRCVSTAT),PRCVOMID=$G(PRCVOMID),PRCVSID=$G(PRCVSID)
"RTN","PRCVRCG",149,0)
 S HLA("HLA",1)="MSA"_PRCVFS_$G(PRCVSTAT)_PRCVFS_$G(PRCVOMID)
"RTN","PRCVRCG",150,0)
 S SEV=$S($D(PRCVERR("SEVERITY")):$G(PRCVERR("SEVERITY")),1:"E")
"RTN","PRCVRCG",151,0)
 ;set some variables
"RTN","PRCVRCG",152,0)
 S PRCVEID=$G(HL("EID"))
"RTN","PRCVRCG",153,0)
 S PRCVEIDS=$G(HL("EIDS"))
"RTN","PRCVRCG",154,0)
 ;S PRCVAPP=$$FIND1^DIC(771,,"MX","PRCV_DYNAMED")
"RTN","PRCVRCG",155,0)
 Q:(($L(PRCVEID)=0)!($L($G(HLMTIENS))=0)!($L(PRCVEIDS)=0))
"RTN","PRCVRCG",156,0)
 S PRCVRES=""
"RTN","PRCVRCG",157,0)
 S:PRCVSTAT="AA" HLA("HLA",1)=HLA("HLA",1)_PRCVFS_"OK"
"RTN","PRCVRCG",158,0)
 D:$L(PRCVSID)>0
"RTN","PRCVRCG",159,0)
 .S ERR="ERR"_PRCVFS_PRCVFS_PRCVSID_PRCVCS_$G(PRCVSEQ("SEG_POS"))
"RTN","PRCVRCG",160,0)
 .S ERR=ERR_PRCVCS_$G(PRCVSEQ("FIELD_POS"))_PRCVFS
"RTN","PRCVRCG",161,0)
 .;S ERR=ERR_PRCVCS_$G(PRCVSEQ("FIELD_POS"))_PRCVCS
"RTN","PRCVRCG",162,0)
 .;S ERR=ERR_$G(PRCVSEQ("FIELD_REP"))_PRCVCS_$G(PRCVSEQ("CMP_POS"))
"RTN","PRCVRCG",163,0)
 .;S ERR=ERR_PRCVCS_$G(PRCVSEQ("SUBCMP_POS"))_PRCVFS
"RTN","PRCVRCG",164,0)
 .;S ERR=ERR_$G(PRCVSEQ("FIELD_REP"))_PRCVFS
"RTN","PRCVRCG",165,0)
 .S ERR=ERR_$G(PRCVERR("HL_CODE"))_PRCVCS_$G(PRCVERR("HL_TEXT"))
"RTN","PRCVRCG",166,0)
 .S ERR=ERR_PRCVCS_"0357"_PRCVFS_SEV_PRCVFS
"RTN","PRCVRCG",167,0)
 .I $D(PRCVERR("APP",1)) D
"RTN","PRCVRCG",168,0)
 ..;application error(s)
"RTN","PRCVRCG",169,0)
 ..S ERR=ERR_$G(PRCVERR("APP",1,"CODE"))_PRCVCS_$G(PRCVERR("APP",1,"TEXT"))
"RTN","PRCVRCG",170,0)
 ..S I=1
"RTN","PRCVRCG",171,0)
 ..F  S I=$O(PRCVERR("APP",I)) Q:((I="")!(I>10))  D
"RTN","PRCVRCG",172,0)
 ...S ERR=ERR_PRCVRS
"RTN","PRCVRCG",173,0)
 ...S ERR=ERR_$G(PRCVERR("APP",I,"CODE"))_PRCVCS
"RTN","PRCVRCG",174,0)
 ...S ERR=ERR_$G(PRCVERR("APP",I,"TEXT"))
"RTN","PRCVRCG",175,0)
 .S HLA("HLA",2)=ERR
"RTN","PRCVRCG",176,0)
 D GENACK^HLMA1(PRCVEID,$G(HLMTIENS),PRCVEIDS,"LM",1,.PRCVRES)
"RTN","PRCVRCG",177,0)
 Q
"RTN","PRCVRCG",178,0)
 ;
"RTN","PRCVRCG",179,0)
PUBACK ;
"RTN","PRCVRCG",180,0)
 N PRCVFS,PRCVCS,PRCVRS,PRCVES,PRCVSS,HLQUIT,HLNODE,X
"RTN","PRCVRCG",181,0)
 N ATYPE,OMID,SEQ,ERR,I,X1,ECNT,RFAC
"RTN","PRCVRCG",182,0)
 S PRCVFS=$G(HL("FS"))
"RTN","PRCVRCG",183,0)
 S PRCVCS=$E($G(HL("ECH")),1)
"RTN","PRCVRCG",184,0)
 S PRCVRS=$E($G(HL("ECH")),2)
"RTN","PRCVRCG",185,0)
 S PRCVES=$E($G(HL("ECH")),3)
"RTN","PRCVRCG",186,0)
 S PRCVSS=$E($G(HL("ECH")),4)
"RTN","PRCVRCG",187,0)
 S (HLQUIT,HLNODE)=0
"RTN","PRCVRCG",188,0)
 ;Note: the following variable is KILLed to avoid certain
"RTN","PRCVRCG",189,0)
 ;problems with $$REPROC^HLUTIL
"RTN","PRCVRCG",190,0)
 K HLDONE1
"RTN","PRCVRCG",191,0)
 S PRCVMSG=$G(HL("MTN"))
"RTN","PRCVRCG",192,0)
 S PRCVMID=$G(HL("MID"))
"RTN","PRCVRCG",193,0)
 Q:HL("MTN")'="MFK"
"RTN","PRCVRCG",194,0)
 X HLNEXT ;read MSH
"RTN","PRCVRCG",195,0)
 I HLQUIT'>0 Q
"RTN","PRCVRCG",196,0)
 S X=$$FLD^HLCSUTL(.HLNODE,1)
"RTN","PRCVRCG",197,0)
 Q:X'="MSH"
"RTN","PRCVRCG",198,0)
 S RFAC=$P($$FLD^HLCSUTL(.HLNODE,6),PRCVCS,1)
"RTN","PRCVRCG",199,0)
 X HLNEXT ;read MSA
"RTN","PRCVRCG",200,0)
 I HLQUIT'>0 Q
"RTN","PRCVRCG",201,0)
 S X=$$FLD^HLCSUTL(.HLNODE,1)
"RTN","PRCVRCG",202,0)
 Q:X'="MSA"
"RTN","PRCVRCG",203,0)
 S ATYPE=$$FLD^HLCSUTL(.HLNODE,2)
"RTN","PRCVRCG",204,0)
 ;No need to go further
"RTN","PRCVRCG",205,0)
 Q
"RTN","PRCVRE1")
0^17^B52433723
"RTN","PRCVRE1",1,0)
PRCVRE1 ;WOIFO/VC-Transmit HL7 message to IFCAP for requisition received from DynaMed ; 11/3/04 3:13pm ; 5/6/05 3:43pm
"RTN","PRCVRE1",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRE1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified
"RTN","PRCVRE1",4,0)
 ;
"RTN","PRCVRE1",5,0)
 ;An exemption from the 245 character length standard for a variable
"RTN","PRCVRE1",6,0)
 ;   has been requested from the SACC for reading HL7 segments into
"RTN","PRCVRE1",7,0)
 ;   a single variable.  The limit is request to be 1K and if longer
"RTN","PRCVRE1",8,0)
 ;   than that the system will exit with an Application ACK reject.
"RTN","PRCVRE1",9,0)
 ;   Submitted 4/14/05.
"RTN","PRCVRE1",10,0)
 ;
"RTN","PRCVRE1",11,0)
 ;This routine processes messages from DynaMed to IFCAP to build a RIL
"RTN","PRCVRE1",12,0)
 ;
"RTN","PRCVRE1",13,0)
 ;HL("MID") - Message Control ID
"RTN","PRCVRE1",14,0)
 ;HL7DT - Today's date in HL7 format
"RTN","PRCVRE1",15,0)
 ;PRCDT - Date value
"RTN","PRCVRE1",16,0)
 ;ORC Segment will repeat for each item
"RTN","PRCVRE1",17,0)
 ;  PRCORD - Order control should be NW for new order - ORC-1
"RTN","PRCVRE1",18,0)
 ;  PRCFCP - Fund control Point - ORC-3
"RTN","PRCVRE1",19,0)
 ;  PRCDATE - Date and time item entered - ORC-9
"RTN","PRCVRE1",20,0)
 ;  PRCEMP - Enter by - ORC-10 DUZ^Lname^Fname^Approving Authority
"RTN","PRCVRE1",21,0)
 ;  PRCCC - Cost Center - ORC-17
"RTN","PRCVRE1",22,0)
 ;  PRCSITE - Site Code should be 516 - ORC-21
"RTN","PRCVRE1",23,0)
 ;RQD Segment will repeat for each item
"RTN","PRCVRE1",24,0)
 ;  PRCCTR - Item counter - RQD-1
"RTN","PRCVRE1",25,0)
 ;  PRCDOC - DynaMed Document number - unique per item - RQD-2
"RTN","PRCVRE1",26,0)
 ;  PRCITM - Item number $p1 of RQD-3
"RTN","PRCVRE1",27,0)
 ;  PRCQTY - Item quantity - RQD-5
"RTN","PRCVRE1",28,0)
 ;  PRCNEED - Date Needed - RQD-10
"RTN","PRCVRE1",29,0)
 ;RQ1 Segment one segment for each RQD segment
"RTN","PRCVRE1",30,0)
 ;  PRCCOST - Estimated Unit Cost - RQ1-1
"RTN","PRCVRE1",31,0)
 ;  PRCBOC -  BOC Number - RQ1-3
"RTN","PRCVRE1",32,0)
 ;  PRCVND - Vendor number - pointer to file 440 - RQ1-4
"RTN","PRCVRE1",33,0)
 ;  PRCNIF - National Item File number - RQ1-5
"RTN","PRCVRE1",34,0)
 ;PRCTYP - Repetitive Item List type - default to blank
"RTN","PRCVRE1",35,0)
 ;Message builds an ^XTMP to pass data to IFCAP RIL build routine.
"RTN","PRCVRE1",36,0)
 ; The first node is "PRCVRE*"+the Message Control ID. The next nodes
"RTN","PRCVRE1",37,0)
 ; are 0,1, and 2. The 0 node is the standard ^XTMP structure plus
"RTN","PRCVRE1",38,0)
 ; $H. The $H is used to measure transmission timing. The 1 node holds
"RTN","PRCVRE1",39,0)
 ; header data common to all detail items being transmitted. The 2
"RTN","PRCVRE1",40,0)
 ; node holds detail information about each item ordered in a counter
"RTN","PRCVRE1",41,0)
 ; sub-node.
"RTN","PRCVRE1",42,0)
 ; Under the 1 and 2 nodes are "ERR" subnodes that hold error 
"RTN","PRCVRE1",43,0)
 ; information about each item.  There can be multiple errors
"RTN","PRCVRE1",44,0)
 ; associated with each item, therefore there are multiple sub-nodes
"RTN","PRCVRE1",45,0)
 ; possible under each "ERR" node.
"RTN","PRCVRE1",46,0)
 ;Counters
"RTN","PRCVRE1",47,0)
 ;  PRCCNT, ACKCNT,PRCCC1,PRCFCP1,X,X1,X2,X8,X9,I,II,LL,ERRCNT
"RTN","PRCVRE1",48,0)
 ;ERRCOD - Error code from IFCAP
"RTN","PRCVRE1",49,0)
 ;ERRDAT - Error data from IFCAP
"RTN","PRCVRE1",50,0)
 ;ERRSTR - Error text from IFCAP
"RTN","PRCVRE1",51,0)
 ;ERRSUB - A substring of ERRSTR
"RTN","PRCVRE1",52,0)
 ;ERRS - Error substring from IFCAP
"RTN","PRCVRE1",53,0)
 ;SEVER - Error severity value - W or E
"RTN","PRCVRE1",54,0)
 ;TOT,TOTERR,TOTGOOD,TOTREC - Counters of errors returned to DM
"RTN","PRCVRE1",55,0)
 ;FLDNO - Field identified in an error message
"RTN","PRCVRE1",56,0)
 ;ERRVAL - ERROR FLAG
"RTN","PRCVRE1",57,0)
 ;ERRARY - Message Error array sent to Prosthetics
"RTN","PRCVRE1",58,0)
 ;ERRLOC - Location of error sent in ACK
"RTN","PRCVRE1",59,0)
 ;PRCCS, PRCFS, PRCRS - Field delimiters
"RTN","PRCVRE1",60,0)
 ;PRCNODE - Message segment identifier
"RTN","PRCVRE1",61,0)
 ;Temporary Globals
"RTN","PRCVRE1",62,0)
 ;  ^TMP("PRCVRIL",$J,"ACK") - Acknowledgement is ok
"RTN","PRCVRE1",63,0)
 ;  ^TMP("PRCVRIL",$J,"NAK") - Acknowledgement is not ok
"RTN","PRCVRE1",64,0)
 ;  ^TMP("HLA",$J) - Message array sent to DynaMed
"RTN","PRCVRE1",65,0)
 ;  ^XTMP("PRCVRE*"_Message Control ID,) - Data sent to IFCAP
"RTN","PRCVRE1",66,0)
 ;Temporary variables
"RTN","PRCVRE1",67,0)
 ;   TMP,MSGFLG,X, X1
"RTN","PRCVRE1",68,0)
 ;PRCHD - Array to hold map between HL7 and XTMP for Header info
"RTN","PRCVRE1",69,0)
 ;PRCDET - Array to hold map between HL7 and XTMP for Detail info
"RTN","PRCVRE1",70,0)
 ;PRCVERR - Array to hold error messages for MailMan
"RTN","PRCVRE1",71,0)
 ;PRCSUB - XTMP first node
"RTN","PRCVRE1",72,0)
 ;PRCSUB2 - Second $p of PRCSUB equal to Message Control ID
"RTN","PRCVRE1",73,0)
 ;PRCVRES - Return variable from GENACK - Note:this doesn't work.
"RTN","PRCVRE1",74,0)
 ;PRCVINDX - Index number into XTMP to keep track of number of items
"RTN","PRCVRE1",75,0)
 ;
"RTN","PRCVRE1",76,0)
 Q
"RTN","PRCVRE1",77,0)
 ;
"RTN","PRCVRE1",78,0)
BEGIN N PRCORD,DYNADATE,PRCDATE,PRCEMP,PRCSITE
"RTN","PRCVRE1",79,0)
 N PRCDOC,PRCITM,PRCQTY,PRCFCP,PRCCC
"RTN","PRCVRE1",80,0)
 N PRCCOST,PRCVND,PRCBOC,PRCNEED,PRCNIF
"RTN","PRCVRE1",81,0)
 N PRCSUB,PRCSUB2,PRCDT,PRCVINDX
"RTN","PRCVRE1",82,0)
 N ERRARY,PRCCS,PRCFS,PRCRS,PRCNODE,PRCNODE2
"RTN","PRCVRE1",83,0)
 N ACKCNT,NODE1,NODE2,PRCCTR,PRCCNT,PRCI,PRCJ,MID
"RTN","PRCVRE1",84,0)
 N X,X1,X2,X8,X9,XX,TMP,PRCCC1,PRCFCP1,LENVAL
"RTN","PRCVRE1",85,0)
 ; Fields used in PRCVREA are NEWed and KILLed here
"RTN","PRCVRE1",86,0)
 N MSG,MSGFLG,DOCID,ERRCNT,ERRCOD,ERRDAT,ERRS,ERRSTR,ERRSUB,FLDNO
"RTN","PRCVRE1",87,0)
 N I,IL,ERRTXT,I,II,III,J,SEVER,TOT,TOTERR,TOTGOOD,TOTREC
"RTN","PRCVRE1",88,0)
 N PRCDET,PRCHD,PRCVERR,MYRESULT,ERRLOC,PRCVRES
"RTN","PRCVRE1",89,0)
 D:'$D(U) DT^DICRW
"RTN","PRCVRE1",90,0)
 S PRCDT=$$NOW^XLFDT
"RTN","PRCVRE1",91,0)
 S HL7DT=$$FMTHL7^XLFDT(PRCDT),PRCDT=HL7DT
"RTN","PRCVRE1",92,0)
 S PRCSUB="PRCVRE*"_HL("MID") K ^XTMP(PRCSUB)
"RTN","PRCVRE1",93,0)
 D BUILD
"RTN","PRCVRE1",94,0)
 S PRCCNT=0
"RTN","PRCVRE1",95,0)
 S PRCFS=$G(HL("FS")),PRCCS=$E($G(HL("ECH"))),PRCRS=$E($G(HL("ECH")),2)
"RTN","PRCVRE1",96,0)
 D START
"RTN","PRCVRE1",97,0)
 D CLEANUP
"RTN","PRCVRE1",98,0)
 Q
"RTN","PRCVRE1",99,0)
 ;
"RTN","PRCVRE1",100,0)
START ;This will read the incoming message from DynaMed and build ^TMP
"RTN","PRCVRE1",101,0)
 ;
"RTN","PRCVRE1",102,0)
SETACK ; Set up information for the ACK or NAK
"RTN","PRCVRE1",103,0)
 ;
"RTN","PRCVRE1",104,0)
 K ^TMP("PRCVRIL",$J)
"RTN","PRCVRE1",105,0)
 S ^TMP("PRCVRIL",$J,"ACK",1)="MSA"_PRCFS_"AA"_PRCFS_HL("MID")
"RTN","PRCVRE1",106,0)
 S ^TMP("PRCVRIL",$J,"NAK",1)="MSA"_PRCFS_"AE"_PRCFS_HL("MID")
"RTN","PRCVRE1",107,0)
 S ^TMP("PRCVRIL",$J,"NAK",2)="ERR"_PRCFS
"RTN","PRCVRE1",108,0)
 S ACKCNT=2
"RTN","PRCVRE1",109,0)
 ;
"RTN","PRCVRE1",110,0)
 ;If this is not the right message quit
"RTN","PRCVRE1",111,0)
 ;
"RTN","PRCVRE1",112,0)
 I HL("MTN")'="OMN" D  Q
"RTN","PRCVRE1",113,0)
 .S $P(^TMP("PRCVRIL",$J,"NAK",ACKCNT),PRCFS,2)="Wrong Message Type: "_HL("MTN")
"RTN","PRCVRE1",114,0)
 .D NAKIT^PRCVREA
"RTN","PRCVRE1",115,0)
 I HL("ETN")'="O07" D  Q
"RTN","PRCVRE1",116,0)
 .S $P(^TMP("PRCVRIL",$J,"NAK",ACKCNT),PRCFS,2)="Wrong Event Type: "_HL("ETN")
"RTN","PRCVRE1",117,0)
 .D NAKIT^PRCVREA
"RTN","PRCVRE1",118,0)
 ;
"RTN","PRCVRE1",119,0)
 S ERRARY(1)="OK"
"RTN","PRCVRE1",120,0)
 ;
"RTN","PRCVRE1",121,0)
 ;Read the message and build the ^TMP global
"RTN","PRCVRE1",122,0)
 ;
"RTN","PRCVRE1",123,0)
 K ^TMP("PRCVRE",$J)
"RTN","PRCVRE1",124,0)
 S PRCI=""
"RTN","PRCVRE1",125,0)
 F PRCI=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVRE1",126,0)
 .S ^TMP("PRCVRE",$J,PRCSUB,PRCI)=HLNODE,PRCJ=0
"RTN","PRCVRE1",127,0)
 .F  S PRCJ=$O(HLNODE(PRCJ)) Q:'PRCJ  S ^TMP("PRCVRE",$J,PRCSUB,PRCI,PRCJ)=HLNODE(PRCJ)
"RTN","PRCVRE1",128,0)
 .I $E(HLNODE,1,3)="ORC" D
"RTN","PRCVRE1",129,0)
 ..S PRCFCP=$P(HLNODE,PRCFS,4),PRCCC=$P(HLNODE,PRCFS,18)
"RTN","PRCVRE1",130,0)
 ..S TMP($J,PRCFCP,PRCCC)=""
"RTN","PRCVRE1",131,0)
 ;
"RTN","PRCVRE1",132,0)
 ;Validate that there is only one FCP and CC
"RTN","PRCVRE1",133,0)
 S PRCFCP="",PRCFCP1=""
"RTN","PRCVRE1",134,0)
 F X8=1:1 S PRCFCP=$O(TMP($J,PRCFCP)) Q:PRCFCP=""  D
"RTN","PRCVRE1",135,0)
 .S PRCFCP1=X8
"RTN","PRCVRE1",136,0)
 .S PRCCC=""
"RTN","PRCVRE1",137,0)
 .F X9=1:1 S PRCCC=$O(TMP($J,PRCFCP,PRCCC)) Q:PRCCC=""  D
"RTN","PRCVRE1",138,0)
 ..S PRCCC1=X9
"RTN","PRCVRE1",139,0)
 I (PRCFCP1>1)!(PRCCC1>1) D  Q
"RTN","PRCVRE1",140,0)
 .S $P(^TMP("PRCVRIL",$J,"NAK",2),PRCFS,2)="Message contains multiple FCP's or CC's: "_HL("ETN") D NAKIT^PRCVREA
"RTN","PRCVRE1",141,0)
 ;
"RTN","PRCVRE1",142,0)
PARSIT ;Read the ^TMP global and build the ^XTMP global to pass to IFCAP
"RTN","PRCVRE1",143,0)
 ;
"RTN","PRCVRE1",144,0)
 S PRCI=0,PRCJ=0,LENVAL="OK"
"RTN","PRCVRE1",145,0)
 F  S PRCI=$O(^TMP("PRCVRE",$J,PRCSUB,PRCI)) Q:PRCI=""  Q:LENVAL="NOTOK"  D
"RTN","PRCVRE1",146,0)
 .S NODE1=$G(^TMP("PRCVRE",$J,PRCSUB,PRCI)) Q:NODE1=""
"RTN","PRCVRE1",147,0)
 .F PRCJ=1:1 D  Q:$G(^TMP("PRCVRE",$J,PRCSUB,PRCI,PRCJ))=""
"RTN","PRCVRE1",148,0)
 ..S NODE2=$G(^TMP("PRCVRE",$J,PRCSUB,PRCI,PRCJ))
"RTN","PRCVRE1",149,0)
 ..I $L(NODE1)+$L(NODE2)>1024 S LENVAL="NOTOK" Q
"RTN","PRCVRE1",150,0)
 ..S NODE1=NODE1_NODE2
"RTN","PRCVRE1",151,0)
 .Q:LENVAL="NOTOK"
"RTN","PRCVRE1",152,0)
 .S PRCNODE=$E(NODE1,1,3)
"RTN","PRCVRE1",153,0)
 .;
"RTN","PRCVRE1",154,0)
 .; IF MSH segment ignore the record
"RTN","PRCVRE1",155,0)
 .;
"RTN","PRCVRE1",156,0)
 .I PRCNODE="MSH" Q
"RTN","PRCVRE1",157,0)
 .S PRCNODE2=$E(NODE1,5,$L(NODE1))
"RTN","PRCVRE1",158,0)
 .;
"RTN","PRCVRE1",159,0)
 .; If ORC segment process the record
"RTN","PRCVRE1",160,0)
 .;
"RTN","PRCVRE1",161,0)
 .I PRCNODE="ORC" D  Q
"RTN","PRCVRE1",162,0)
 ..I $D(^XTMP(PRCSUB,1))'=0 Q
"RTN","PRCVRE1",163,0)
 ..S PRCORD=$P(PRCNODE2,PRCFS,1),DYNADATE=$P(PRCNODE2,PRCFS,9),PRCEMP=$P($P(PRCNODE2,PRCFS,10),PRCCS,1,3),PRCSITE=$P(PRCNODE2,PRCFS,21)
"RTN","PRCVRE1",164,0)
 ..S PRCFCP=$P(PRCNODE2,PRCFS,3),PRCCC=$P(PRCNODE2,PRCFS,17)
"RTN","PRCVRE1",165,0)
 ..S PRCDATE=$$HL7TFM^XLFDT(DYNADATE)
"RTN","PRCVRE1",166,0)
 ..S $P(^XTMP(PRCSUB,1),U,1)=0
"RTN","PRCVRE1",167,0)
 ..S $P(^XTMP(PRCSUB,1),U,4)=PRCORD,$P(^XTMP(PRCSUB,1),U,5)=PRCSITE
"RTN","PRCVRE1",168,0)
 ..S $P(^XTMP(PRCSUB,1),U,6)=PRCDATE,$P(^XTMP(PRCSUB,1),U,7)=PRCEMP
"RTN","PRCVRE1",169,0)
 .;
"RTN","PRCVRE1",170,0)
 .; If RQD segment process the record
"RTN","PRCVRE1",171,0)
 .;
"RTN","PRCVRE1",172,0)
 .I PRCNODE="RQD" D  Q
"RTN","PRCVRE1",173,0)
 ..S PRCCTR=$P(PRCNODE2,PRCFS,1)
"RTN","PRCVRE1",174,0)
 ..S PRCDOC=$P(PRCNODE2,PRCFS,2),PRCITM=$P(PRCNODE2,PRCFS,3)
"RTN","PRCVRE1",175,0)
 ..S PRCQTY=$P(PRCNODE2,PRCFS,5),DYNADATE=$P(PRCNODE2,PRCFS,10)
"RTN","PRCVRE1",176,0)
 ..S PRCNEED=$$HL7TFM^XLFDT(DYNADATE)
"RTN","PRCVRE1",177,0)
 .;
"RTN","PRCVRE1",178,0)
 .;If RQ1 segment process the record and build the XTMP global record
"RTN","PRCVRE1",179,0)
 .;
"RTN","PRCVRE1",180,0)
 .I PRCNODE="RQ1" D  Q
"RTN","PRCVRE1",181,0)
 ..S PRCCOST=$P(PRCNODE2,PRCFS,1),PRCBOC=$P(PRCNODE2,PRCFS,3),PRCVND=$P(PRCNODE2,PRCFS,4),PRCNIF=$P(PRCNODE2,PRCFS,5)
"RTN","PRCVRE1",182,0)
 ..;
"RTN","PRCVRE1",183,0)
 ..; Now build the XTMP record
"RTN","PRCVRE1",184,0)
 ..;
"RTN","PRCVRE1",185,0)
 ..S PRCVINDX=$P($G(^XTMP(PRCSUB,1)),U,1)
"RTN","PRCVRE1",186,0)
 ..I PRCCTR>PRCVINDX S $P(^XTMP(PRCSUB,1),U,1)=PRCCTR
"RTN","PRCVRE1",187,0)
 ..S $P(^XTMP(PRCSUB,1),U,2)=PRCFCP
"RTN","PRCVRE1",188,0)
 ..S $P(^XTMP(PRCSUB,1),U,3)=PRCCC
"RTN","PRCVRE1",189,0)
 ..S ^XTMP(PRCSUB,2,PRCCTR)=PRCITM_U_PRCQTY_U_PRCVND_U_PRCCOST_U_PRCNEED_U_PRCDOC_U_PRCNIF_U_PRCBOC
"RTN","PRCVRE1",190,0)
 ;
"RTN","PRCVRE1",191,0)
 I LENVAL="NOTOK" D  Q
"RTN","PRCVRE1",192,0)
 .S $P(^TMP("PRCVRIL",$J,"NAK",2),PRCFS,2)="HL7 Segment length greater than 1K"
"RTN","PRCVRE1",193,0)
 .D NAKIT^PRCVREA
"RTN","PRCVRE1",194,0)
 .K ^XTMP(PRCSUB)
"RTN","PRCVRE1",195,0)
 D CALLIT^PRCVREA
"RTN","PRCVRE1",196,0)
 Q
"RTN","PRCVRE1",197,0)
 ;
"RTN","PRCVRE1",198,0)
BUILD ;Build the ^XTMP global zero node record.
"RTN","PRCVRE1",199,0)
 ;
"RTN","PRCVRE1",200,0)
 S XX=$$HTFM^XLFDT($H,1)
"RTN","PRCVRE1",201,0)
 S X1=$$FMADD^XLFDT(XX,5)
"RTN","PRCVRE1",202,0)
 S ^XTMP(PRCSUB,0)=X1_U_XX_"^Transmit message to IFCAP to build the RIL"_U_$H
"RTN","PRCVRE1",203,0)
 Q
"RTN","PRCVRE1",204,0)
 ;
"RTN","PRCVRE1",205,0)
CLEANUP ;This area will kill all temporary globals and variables
"RTN","PRCVRE1",206,0)
 ;
"RTN","PRCVRE1",207,0)
 K ^TMP("PRCVRE",$J),TMP($J)
"RTN","PRCVRE1",208,0)
 K ^TMP("HLA",$J)
"RTN","PRCVRE1",209,0)
 K ^TMP("PRCVRIL",$J)
"RTN","PRCVRE1",210,0)
 K PRCCTR,PRCCNT,PRCORD,DYNADATE,PRCDATE,PRCEMP,PRCSITE,PRCDOC
"RTN","PRCVRE1",211,0)
 K PRCITM,PRCQTY,PRCFCP,PRCCC,PRCNIF,PRCBOC
"RTN","PRCVRE1",212,0)
 K PRCCOST,PRCVND,PRCSUB,PRCSUB2,PRCDT,PRCNEED
"RTN","PRCVRE1",213,0)
 K PRCFS,PRCCS,PRCRS,PRCVINDX
"RTN","PRCVRE1",214,0)
 K ERRARY
"RTN","PRCVRE1",215,0)
 K PRCFS,PRCRS,PRCNODE,PRCNODE2,PRCI,PRCJ
"RTN","PRCVRE1",216,0)
 K ACKCNT,NODE1,NODE2,LENVAL
"RTN","PRCVRE1",217,0)
 K X,X1,X2,X8,X9,XX,TMP,PRCCC1,PRCFCP1
"RTN","PRCVRE1",218,0)
 ;Fields killed here are used in PRCVREA
"RTN","PRCVRE1",219,0)
 K MID,MSG,MSGFLG,MYRESULT,PRCDET,PRCHD,ERRLOC,ERRSUB
"RTN","PRCVRE1",220,0)
 K DOCID,ERRCNT,ERRCOD,ERRDAT,ERRS,ERRSTR,I,II,III,IL,J,ERRTXT,SEVER
"RTN","PRCVRE1",221,0)
 K TOT,TOTERR,TOTGOOD,TOTREC,FLDNO,PRCVERR,PRCVRES
"RTN","PRCVRE1",222,0)
 Q
"RTN","PRCVREA")
0^18^B24071162
"RTN","PRCVREA",1,0)
PRCVREA ;WOIFO/VC-Transmit HL7 message to IFCAP for RIL(cont);11/24/03 ; 4/26/05 2:42pm
"RTN","PRCVREA",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVREA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified
"RTN","PRCVREA",4,0)
 ;
"RTN","PRCVREA",5,0)
CALLIT ;Call the IFCAP RIL build Routine
"RTN","PRCVREA",6,0)
 ;
"RTN","PRCVREA",7,0)
 D EN^PRCVRC1(PRCSUB)
"RTN","PRCVREA",8,0)
 ;
"RTN","PRCVREA",9,0)
SETUP S PRCHD(1)=""
"RTN","PRCVREA",10,0)
 S PRCHD(2)="ORC"_PRCCS_PRCCS_3
"RTN","PRCVREA",11,0)
 S PRCHD(2,"T")="FUND CONTROL POINT"
"RTN","PRCVREA",12,0)
 S PRCHD(3)="ORC"_PRCCS_PRCCS_17
"RTN","PRCVREA",13,0)
 S PRCHD(3,"T")="COST CENTER"
"RTN","PRCVREA",14,0)
 S PRCHD(4)=""
"RTN","PRCVREA",15,0)
 S PRCHD(5)="ORC"_PRCCS_PRCCS_21
"RTN","PRCVREA",16,0)
 S PRCHD(5,"T")="SITE NUMBER"
"RTN","PRCVREA",17,0)
 S PRCHD(6)=""
"RTN","PRCVREA",18,0)
 S PRCHD(7)="ORC"_PRCCS_PRCCS_10
"RTN","PRCVREA",19,0)
 S PRCHD(7,"T")="DUZ"
"RTN","PRCVREA",20,0)
 S PRCHD(8)="ORC"_PRCCS_PRCCS_10
"RTN","PRCVREA",21,0)
 S PRCHD(8,"T")="LAST NAME"
"RTN","PRCVREA",22,0)
 S PRCHD(9)="ORC"_PRCCS_PRCCS_11
"RTN","PRCVREA",23,0)
 S PRCHD(9,"T")="FIRST NAME"
"RTN","PRCVREA",24,0)
 S PRCDET(1)="RQD"_PRCCS_PRCCS_3
"RTN","PRCVREA",25,0)
 S PRCDET(1,"T")="ITEM NUMBER"
"RTN","PRCVREA",26,0)
 S PRCDET(2)="RQD"_PRCCS_PRCCS_5
"RTN","PRCVREA",27,0)
 S PRCDET(2,"T")="QUANTITY"
"RTN","PRCVREA",28,0)
 S PRCDET(3)="RQ1"_PRCCS_PRCCS_4
"RTN","PRCVREA",29,0)
 S PRCDET(3,"T")="VENDOR ID"
"RTN","PRCVREA",30,0)
 S PRCDET(4)="RQ1"_PRCCS_PRCCS_1
"RTN","PRCVREA",31,0)
 S PRCDET(4,"T")="UNIT COST"
"RTN","PRCVREA",32,0)
 S PRCDET(5)="RQD"_PRCCS_PRCCS_10
"RTN","PRCVREA",33,0)
 S PRCDET(5,"T")="DATE NEEDED"
"RTN","PRCVREA",34,0)
 S PRCDET(6)="RQD"_PRCCS_PRCCS_2
"RTN","PRCVREA",35,0)
 S PRCDET(6,"T")="DYNAMED DOCUMENT ID"
"RTN","PRCVREA",36,0)
 S PRCDET(7)="RQ1"_PRCCS_PRCCS_5
"RTN","PRCVREA",37,0)
 S PRCDET(7,"T")="NIF NUMBER"
"RTN","PRCVREA",38,0)
 S PRCDET(8)="RQ1"_PRCCS_PRCCS_3
"RTN","PRCVREA",39,0)
 S PRCDET(8,"T")="BOC"
"RTN","PRCVREA",40,0)
 ;Check if IFCAP has returned any errors
"RTN","PRCVREA",41,0)
 ;
"RTN","PRCVREA",42,0)
 S ERRCNT=1
"RTN","PRCVREA",43,0)
 S PRCVERR(0)="0"
"RTN","PRCVREA",44,0)
HEAD ;If there are errors in the "1" sub-segment, add all errors to all
"RTN","PRCVREA",45,0)
 ;   line items
"RTN","PRCVREA",46,0)
 S ERRCNT=1,MSGFLG=0,PRCSUB2=$P(PRCSUB,"*",2)
"RTN","PRCVREA",47,0)
 I $D(^XTMP(PRCSUB,1,"ERR"))>0 D
"RTN","PRCVREA",48,0)
 .S II=0
"RTN","PRCVREA",49,0)
 .F I=1:1 S II=$O(^XTMP(PRCSUB,1,"ERR",II)) Q:II=""  D
"RTN","PRCVREA",50,0)
 ..S ERRDAT=$G(^XTMP(PRCSUB,1,"ERR",II))
"RTN","PRCVREA",51,0)
 ..Q:ERRDAT=""
"RTN","PRCVREA",52,0)
 ..S MSGFLG=1
"RTN","PRCVREA",53,0)
 ..S FLDNO=$P(ERRDAT,U,1),ERRCOD="PRCV"_$P(ERRDAT,U,2),ERRTXT=$P(ERRDAT,U,3)
"RTN","PRCVREA",54,0)
 ..S SEVER=$P(ERRDAT,U,4)
"RTN","PRCVREA",55,0)
 ..S ERRSTR="ERR"_PRCFS_PRCFS_PRCHD(FLDNO)_PRCFS_"207"_PRCCS_"Application internal error"_PRCCS_"HL70357"_PRCFS_SEVER_PRCFS_ERRCOD_PRCCS_ERRTXT_PRCFS
"RTN","PRCVREA",56,0)
 ..S PRCVERR(ERRCNT)="Error in Requisition Header for "_PRCHD(FLDNO,"T")_" from HL7 MESSAGE "_PRCSUB2_" "_ERRCOD_" "_ERRTXT,ERRCNT=ERRCNT+1
"RTN","PRCVREA",57,0)
 ..S J=0
"RTN","PRCVREA",58,0)
 ..F IL=1:1 S J=$O(^XTMP(PRCSUB,2,J)) Q:J=""  D
"RTN","PRCVREA",59,0)
 ...S ERRSUB=$P(ERRSTR,PRCFS,3)
"RTN","PRCVREA",60,0)
 ...S $P(ERRSUB,U,2)=J
"RTN","PRCVREA",61,0)
 ...S $P(ERRSTR,PRCFS,3)=ERRSUB
"RTN","PRCVREA",62,0)
 ...;S $P($P(ERRSTR,PRCFS,3),U,2)=J
"RTN","PRCVREA",63,0)
 ...S $P(ERRSTR,PRCFS,7)=$P($G(^XTMP(PRCSUB,2,J)),U,6)
"RTN","PRCVREA",64,0)
 ...S ^TMP("PRCVRIL",$J,"NAK",ACKCNT)=ERRSTR,ACKCNT=ACKCNT+1
"RTN","PRCVREA",65,0)
DETAIL ;If there are errors in the detail lines, add them
"RTN","PRCVREA",66,0)
 S II=0
"RTN","PRCVREA",67,0)
 F I=1:1 S II=$O(^XTMP(PRCSUB,2,II)) Q:II=""  D
"RTN","PRCVREA",68,0)
 .S DOCID=$P(^XTMP(PRCSUB,2,II),U,6)
"RTN","PRCVREA",69,0)
 .S III=0
"RTN","PRCVREA",70,0)
 .F J=1:1 S III=$O(^XTMP(PRCSUB,2,II,"ERR",III)) Q:III=""  D
"RTN","PRCVREA",71,0)
 ..S ERRDAT=$G(^XTMP(PRCSUB,2,II,"ERR",III))
"RTN","PRCVREA",72,0)
 ..Q:ERRDAT=""
"RTN","PRCVREA",73,0)
 ..S MSGFLG=1
"RTN","PRCVREA",74,0)
 ..S FLDNO=$P(ERRDAT,U,1),ERRCOD="PRCV"_$P(ERRDAT,U,2),ERRTXT=$P(ERRDAT,U,3)
"RTN","PRCVREA",75,0)
 ..S ERRLOC=PRCDET(FLDNO),$P(ERRLOC,U,2)=II
"RTN","PRCVREA",76,0)
 ..S SEVER=$P(ERRDAT,U,4)
"RTN","PRCVREA",77,0)
 ..S ERRSTR="ERR"_PRCFS_PRCFS_ERRLOC_PRCFS_"207"_PRCCS_"Application internal error"_PRCCS_"HL70357"_PRCFS_SEVER_PRCFS_ERRCOD_PRCCS_ERRTXT_PRCFS_DOCID
"RTN","PRCVREA",78,0)
 ..S ^TMP("PRCVRIL",$J,"NAK",ACKCNT)=ERRSTR,ACKCNT=ACKCNT+1
"RTN","PRCVREA",79,0)
 ..S PRCVERR(ERRCNT)="Error in detail for Message Control ID "_PRCSUB2_". Field in error - "_PRCDET(FLDNO,"T")_". "_ERRTXT_" DynaMed Doc ID "_DOCID
"RTN","PRCVREA",80,0)
 ..S ERRCNT=ERRCNT+1
"RTN","PRCVREA",81,0)
 ;
"RTN","PRCVREA",82,0)
 I MSGFLG=0 D ACKIT,CLEANUP^PRCVRE1 Q
"RTN","PRCVREA",83,0)
SETNTE ; If there are errors set an NTE segment
"RTN","PRCVREA",84,0)
 ;
"RTN","PRCVREA",85,0)
 S TOT=0,TOTREC=0,TOTERR=0
"RTN","PRCVREA",86,0)
 F I=1:1 S TOT=$O(^XTMP(PRCSUB,2,TOT)) Q:TOT=""  D
"RTN","PRCVREA",87,0)
 .S TOTREC=TOT
"RTN","PRCVREA",88,0)
 .I $D(^XTMP(PRCSUB,2,TOT,"ERR"))>0 D
"RTN","PRCVREA",89,0)
 ..S ERRS=0
"RTN","PRCVREA",90,0)
 ..F J=1:1 S ERRS=$O(^XTMP(PRCSUB,2,TOT,"ERR",ERRS)) Q:ERRS=""  D
"RTN","PRCVREA",91,0)
 ...S SEVER=$P($G(^XTMP(PRCSUB,2,TOT,"ERR",ERRS)),U,4)
"RTN","PRCVREA",92,0)
 ...I SEVER'="W" S TOTERR=TOTERR+1,ERRS=99
"RTN","PRCVREA",93,0)
 I $D(^XTMP(PRCSUB,2,"ERR",1))>1 S TOTERR=TOTREC
"RTN","PRCVREA",94,0)
 S TOTGOOD=TOTREC-TOTERR
"RTN","PRCVREA",95,0)
 S ^TMP("PRCVRIL",$J,"NAK",ACKCNT)="NTE"_PRCFS_PRCFS_PRCFS_TOTREC_"-"_TOTERR_"-"_TOTGOOD,ACKCNT=ACKCNT+1
"RTN","PRCVREA",96,0)
 D NAKIT,CLEANUP^PRCVRE1 Q
"RTN","PRCVREA",97,0)
 ;
"RTN","PRCVREA",98,0)
NAKIT ;Send an acknowledgement that the message is rejected
"RTN","PRCVREA",99,0)
 ;
"RTN","PRCVREA",100,0)
 I HL("APAT")'="AL" Q
"RTN","PRCVREA",101,0)
 S MSG=""
"RTN","PRCVREA",102,0)
 F I=1:1 S MSG=$O(^TMP("PRCVRIL",$J,"NAK",MSG)) Q:MSG=""  D
"RTN","PRCVREA",103,0)
 .S ^TMP("HLA",$J,I)=^TMP("PRCVRIL",$J,"NAK",MSG)
"RTN","PRCVREA",104,0)
 S PRCVRES=""
"RTN","PRCVREA",105,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.PRCVRES)
"RTN","PRCVREA",106,0)
 ;I +$P(PRCVRES,U,2) D
"RTN","PRCVREA",107,0)
 ;.S PRCVERR(ERRCNT)="Application ACK not processed. Contact EVS."
"RTN","PRCVREA",108,0)
MAIL ;Send MailMan message with error
"RTN","PRCVREA",109,0)
 Q:LENVAL="NOTOK"
"RTN","PRCVREA",110,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVREA",111,0)
 S XMSUB="RIL build errors in HL7 message "_HL("MID")_" "
"RTN","PRCVREA",112,0)
 S XMDUZ="IFCAP/DynaMed Interface"
"RTN","PRCVREA",113,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVREA",114,0)
 D GETFCPU^PRCVLIC(.XMY,PRCSITE,PRCFCP)
"RTN","PRCVREA",115,0)
 D ^XMD
"RTN","PRCVREA",116,0)
 K XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVREA",117,0)
 Q
"RTN","PRCVREA",118,0)
 ;
"RTN","PRCVREA",119,0)
ACKIT ;Send an acknowledgement that everything went fine
"RTN","PRCVREA",120,0)
 ;
"RTN","PRCVREA",121,0)
 I HL("APAT")'="AL" Q
"RTN","PRCVREA",122,0)
 F I=1:1:1 S ^TMP("HLA",$J,I)=$G(^TMP("PRCVRIL",$J,"ACK",I))
"RTN","PRCVREA",123,0)
 ;
"RTN","PRCVREA",124,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.PRCVRES)
"RTN","PRCVREA",125,0)
 ;I +P(PRCVRES,U,2) D
"RTN","PRCVREA",126,0)
 ;.I $D(ERRCNT)=0 S ERRCNT=1
"RTN","PRCVREA",127,0)
 ;.S PRCVERR(ERRCNT)="Application ACK not processed. Contact EVS."
"RTN","PRCVREA",128,0)
 ;.D MAIL
"RTN","PRCVREA",129,0)
 Q
"RTN","PRCVRRA")
0^19^B2717769
"RTN","PRCVRRA",1,0)
PRCVRRA ;WOIFO/AS-SEND RECEIVING REPORT ADJUSTMENT TO DYNAMED ; 01/24/05
"RTN","PRCVRRA",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVRRA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVRRA",4,0)
 ;
"RTN","PRCVRRA",5,0)
 ; PO amendment
"RTN","PRCVRRA",6,0)
 ; Input: PRCVPO (PO number)
"RTN","PRCVRRA",7,0)
 ;        PRCVADJ (Adjustment number from PRCHAV)
"RTN","PRCVRRA",8,0)
 ; Called from PRCHAM
"RTN","PRCVRRA",9,0)
 ;
"RTN","PRCVRRA",10,0)
 Q
"RTN","PRCVRRA",11,0)
ENT(PRCVPO,PRCVADJ) ;
"RTN","PRCVRRA",12,0)
 N PRCV1,PRCV,PRCVCHG,PRCVFLD,PRCVNPO,PRCVAMD,PRCVNXT,PRCVALL,PRCVEXT
"RTN","PRCVRRA",13,0)
 N PRCVP,PRCVERR
"RTN","PRCVRRA",14,0)
 ;  Get partial header information to PRCVEXT
"RTN","PRCVRRA",15,0)
 S PRCV1=0
"RTN","PRCVRRA",16,0)
 D GETS^DIQ(442,PRCVPO_",",".07;7;62","IE","PRCVP")
"RTN","PRCVRRA",17,0)
 S PRCVEXT=PRCVP(442,PRCVPO_",",62,"E")
"RTN","PRCVRRA",18,0)
 I PRCVEXT']"" S PRCVEXT=PRCVP(442,PRCVPO_",",.07,"E")
"RTN","PRCVRRA",19,0)
 S $P(PRCVEXT,"^",2)=PRCVP(442,PRCVPO_",",7,"I") ; delivery date
"RTN","PRCVRRA",20,0)
 ;
"RTN","PRCVRRA",21,0)
 D HEADER
"RTN","PRCVRRA",22,0)
 F  S PRCV1=$O(^PRC(442,PRCVPO,2,PRCV1)) Q:'PRCV1  D
"RTN","PRCVRRA",23,0)
 . Q:'$D(^PRC(442,PRCVPO,2,PRCV1,3,PRCVADJ,0))
"RTN","PRCVRRA",24,0)
 . D ITEM^PRCV442A(PRCVPO,PRCV1,PRCVEXT,.PRCVERR)
"RTN","PRCVRRA",25,0)
 . I 'PRCVERR D
"RTN","PRCVRRA",26,0)
 .. D RR^PRCV442A(PRCVPO,PRCV1,PRCVADJ,.PRCVERR,1)
"RTN","PRCVRRA",27,0)
 .. I $D(^TMP("PRCV442A",$J,PRCVPO,PRCV1)) S $P(^(PRCV1),"^",14)=1
"RTN","PRCVRRA",28,0)
 D SEND
"RTN","PRCVRRA",29,0)
 K ^TMP("PRCV442A",$J)
"RTN","PRCVRRA",30,0)
 Q
"RTN","PRCVRRA",31,0)
HEADER ;
"RTN","PRCVRRA",32,0)
 ; Get PO header information
"RTN","PRCVRRA",33,0)
 D PO^PRCV442A(PRCVPO)
"RTN","PRCVRRA",34,0)
 ;   Change transaction type to RR Adjustment
"RTN","PRCVRRA",35,0)
 S $P(^TMP("PRCV442A",$J,PRCVPO),"^",2)=4
"RTN","PRCVRRA",36,0)
 Q
"RTN","PRCVRRA",37,0)
SEND ;
"RTN","PRCVRRA",38,0)
 ;  Do not send if no item collected
"RTN","PRCVRRA",39,0)
 Q:'$O(^TMP("PRCV442A",$J,PRCVPO,0))
"RTN","PRCVRRA",40,0)
 ;   Adjustment signed date
"RTN","PRCVRRA",41,0)
 S $P(^TMP("PRCV442A",$J,PRCVPO),"^",7)=$P($G(^PRC(442,PRCVPO,6,PRCHAM,1)),"^",3)
"RTN","PRCVRRA",42,0)
 D EN^PRCVPOSD(PRCVPO)
"RTN","PRCVRRA",43,0)
 Q
"RTN","PRCVSUB")
0^63^B4207049
"RTN","PRCVSUB",1,0)
PRCVSUB ;ISC-SF/GJW ; 6/6/05 11:38am
"RTN","PRCVSUB",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVSUB",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVSUB",4,0)
 ;
"RTN","PRCVSUB",5,0)
ADDSUB(PRCVSTAT,PRCVENT,PRCVTYP,PRCVMID) ;
"RTN","PRCVSUB",6,0)
 N FDA,RESULT,MROOT,VAL,ERRNO
"RTN","PRCVSUB",7,0)
 D ISEND(PRCVSTAT,PRCVENT)
"RTN","PRCVSUB",8,0)
 S FDA(414.03,"?+1,",.01)=+$G(PRCVSTAT)
"RTN","PRCVSUB",9,0)
 S FDA(414.03,"?+1,",.02)=$G(PRCVENT)
"RTN","PRCVSUB",10,0)
 S FDA(414.03,"?+1,",.03)=$G(PRCVTYP)
"RTN","PRCVSUB",11,0)
 S FDA(414.03,"?+1,",1)=$$NOW^XLFDT
"RTN","PRCVSUB",12,0)
 S FDA(414.03,"?+1,",2)=1
"RTN","PRCVSUB",13,0)
 S FDA(414.03,"?+1,",3)=$G(PRCVMID)
"RTN","PRCVSUB",14,0)
 ;need "E" because the type field is a set of codes
"RTN","PRCVSUB",15,0)
 D UPDATE^DIE("EK","FDA","RESULT","MROOT")
"RTN","PRCVSUB",16,0)
 I $D(MROOT("DIERR")) D  ;error(s) occured
"RTN","PRCVSUB",17,0)
 .S VAL="E",ERRNO=""
"RTN","PRCVSUB",18,0)
 .F  S ERRNO=$O(MROOT("DIERR","E",ERRNO)) Q:ERRNO=""  D
"RTN","PRCVSUB",19,0)
 ..S VAL=VAL_"^"_ERRNO
"RTN","PRCVSUB",20,0)
 E  D
"RTN","PRCVSUB",21,0)
 .S VAL=$G(RESULT(1,0))_"^"_$G(RESULT(1))
"RTN","PRCVSUB",22,0)
 Q VAL
"RTN","PRCVSUB",23,0)
 ;
"RTN","PRCVSUB",24,0)
FINDSUB(PRCVSTAT,PRCVENT,PRCVTYP) ;
"RTN","PRCVSUB",25,0)
 N OUT,MROOT,VALUES,VAL,ERRNO
"RTN","PRCVSUB",26,0)
 S VALUES(1)=+$G(PRCVSTAT)
"RTN","PRCVSUB",27,0)
 S VALUES(2)=$G(PRCVENT)
"RTN","PRCVSUB",28,0)
 S VALUES(3)=$G(PRCVTYP)
"RTN","PRCVSUB",29,0)
 S VAL=$$FIND1^DIC(414.03,,"K",.VALUES,,,"MROOT")
"RTN","PRCVSUB",30,0)
 I $D(MROOT("DIERR")) D  ;error(s) occured
"RTN","PRCVSUB",31,0)
 .S VAL=-1,ERRNO=""
"RTN","PRCVSUB",32,0)
 .F  S ERRNO=$O(MROOT("DIERR","E",ERRNO)) Q:ERRNO=""  D
"RTN","PRCVSUB",33,0)
 ..S VAL=VAL_"^"_ERRNO
"RTN","PRCVSUB",34,0)
 Q VAL
"RTN","PRCVSUB",35,0)
 ;
"RTN","PRCVSUB",36,0)
DELSUB(PRCVSTAT,PRCVENT,PRCVTYP) ;
"RTN","PRCVSUB",37,0)
 N VAL,IENS,MYFDA,MROOT,ERRNO
"RTN","PRCVSUB",38,0)
 S VAL=$$FINDSUB(PRCVSTAT,PRCVENT,PRCVTYP)
"RTN","PRCVSUB",39,0)
 Q:+VAL'>0 VAL
"RTN","PRCVSUB",40,0)
 S IENS=+VAL_","
"RTN","PRCVSUB",41,0)
 S MYFDA(414.03,IENS,.01)="@"
"RTN","PRCVSUB",42,0)
 D FILE^DIE(,"MYFDA","MROOT")
"RTN","PRCVSUB",43,0)
 Q:'$D(MROOT("DIERR")) "@^"_+VAL
"RTN","PRCVSUB",44,0)
 ;an error occured in FILE^DIE
"RTN","PRCVSUB",45,0)
 S VAL="E",ERRNO=""
"RTN","PRCVSUB",46,0)
 F  S ERRNO=$O(MROOT("DIERR","E",ERRNO)) Q:ERRNO=""  D
"RTN","PRCVSUB",47,0)
 .S VAL=VAL_"^"_ERRNO
"RTN","PRCVSUB",48,0)
 Q VAL
"RTN","PRCVSUB",49,0)
 ;
"RTN","PRCVSUB",50,0)
 ;immediate send
"RTN","PRCVSUB",51,0)
ISEND(PRCVSTAT,PRCVFCP) ;
"RTN","PRCVSUB",52,0)
 N ROOT,I
"RTN","PRCVSUB",53,0)
 S ROOT=$NA(^PRC(420,PRCVSTAT,1,PRCVFCP,4,"B"))
"RTN","PRCVSUB",54,0)
 S I=""
"RTN","PRCVSUB",55,0)
 F  S I=$O(@ROOT@(I)) Q:I=""  D
"RTN","PRCVSUB",56,0)
 .I $$FY4^PRCVMON(I)'<$$GETFY^PRCVMON D
"RTN","PRCVSUB",57,0)
 ..D PUSH1^PRCVMON(PRCVSTAT,I,PRCVFCP)
"RTN","PRCVSUB",58,0)
 Q
"RTN","PRCVTAP")
0^20^B39101448
"RTN","PRCVTAP",1,0)
PRCVTAP ;WOIFO/SC-2237 APPROVAL TO DYNAMED ; 5/31/05 2:30pm
"RTN","PRCVTAP",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVTAP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVTAP",4,0)
 Q
"RTN","PRCVTAP",5,0)
 ;PRCVTAP is called by routine PRCSAPP2
"RTN","PRCVTAP",6,0)
 ;This routine is extracting 2237 APPROVED data and passing that info
"RTN","PRCVTAP",7,0)
 ;to routine PRCVEE1 which formats data into HL7 Message and then
"RTN","PRCVTAP",8,0)
 ;sends data to DynaMed. It also updates relevant info in Audit File
"RTN","PRCVTAP",9,0)
 ;#414.02.  A bulletin is send if DM DOC ID is missing from an item 
"RTN","PRCVTAP",10,0)
 ;or if record doesn't get updated properly in Audit File.
"RTN","PRCVTAP",11,0)
 ;
"RTN","PRCVTAP",12,0)
EN(PRCVDA) ;
"RTN","PRCVTAP",13,0)
 ;  Input         PRCVDA = ien of top entry of the file
"RTN","PRCVTAP",14,0)
 ;Quit if system parameter is not set to DynaMed
"RTN","PRCVTAP",15,0)
 N PRCVSYS
"RTN","PRCVTAP",16,0)
 S PRCVSYS=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVTAP",17,0)
 Q:PRCVSYS'=1
"RTN","PRCVTAP",18,0)
 ;
"RTN","PRCVTAP",19,0)
 N PRCVRIEN,PRCVDUZ,PRCVNO,PRCVIT,PRCVEXTN,PRCVV,PRCVFLDS
"RTN","PRCVTAP",20,0)
 N PRCVSTA,CNT,PRCVTM,K,PRCVCRDT,PRCVPGDT,PRCVL,PRCVDT
"RTN","PRCVTAP",21,0)
 N PRCVI,PRCVJ,PRCVK,PRCVDID,PRCVITN,PRCVQTY,PRCVCST,PRCVDNB
"RTN","PRCVTAP",22,0)
 N PRCVDTCR,PRCVNAME,PRCVIEN,PRCVTIME,PRCVOCD,PRCV2IEN
"RTN","PRCVTAP",23,0)
 N PRCVAR,PRCVFMS,PRCVUOP,PRCVSTK,PRCVPKG,PRCVBOC,PRCVNIF
"RTN","PRCVTAP",24,0)
 N PRCVFCP,PRCVTMG,PRCVTT
"RTN","PRCVTAP",25,0)
 ;
"RTN","PRCVTAP",26,0)
 S PRCVDUZ=DUZ
"RTN","PRCVTAP",27,0)
 S PRCV2IEN=PRCVDA ; ien of the 2237 trx.
"RTN","PRCVTAP",28,0)
 S PRCVTIME=$H
"RTN","PRCVTAP",29,0)
 S PRCVEXTN=$$GET1^DIQ(410,PRCV2IEN_",",.01) ;.01 value of 2237 trx
"RTN","PRCVTAP",30,0)
 ;
"RTN","PRCVTAP",31,0)
 ;Quit if DM 2237 .01 value is not found in Audit file 414.02 'D' xref
"RTN","PRCVTAP",32,0)
 ;And check if child 2237 that was split has a parent 2237 (in
"RTN","PRCVTAP",33,0)
 ;file 410, node 10, piece 2, fld51) is recorded in Audit File 414.02
"RTN","PRCVTAP",34,0)
 ;'D' x-ref.
"RTN","PRCVTAP",35,0)
 S PRCVTT=$$CHKDM^PRCVLIC(PRCVEXTN) Q:PRCVTT'=1
"RTN","PRCVTAP",36,0)
 ;
"RTN","PRCVTAP",37,0)
 D NOW^%DTC,YX^%DTC
"RTN","PRCVTAP",38,0)
 S PRCVTM=Y ;date/time in ext format MAR 07, 2005@16:08
"RTN","PRCVTAP",39,0)
 S PRCVFCP=$P($G(PRCVEXTN),"-",4)
"RTN","PRCVTAP",40,0)
 S PRCVNO="PRCVUP*"_PRCVEXTN ; .01 val in the XTMP subscript
"RTN","PRCVTAP",41,0)
 ;S PRCVNO="PRCVUP*"_PRCV2IEN ; ien in the XTMP subscript
"RTN","PRCVTAP",42,0)
 S PRCVSTA=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVTAP",43,0)
 S PRCVNAME=$$GET1^DIQ(200,PRCVDUZ_",",.01,"E")
"RTN","PRCVTAP",44,0)
 ;
"RTN","PRCVTAP",45,0)
 S CNT=0
"RTN","PRCVTAP",46,0)
 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVTAP",47,0)
 D SETUP0 ; set up XTMP global's zero node
"RTN","PRCVTAP",48,0)
 D ITEM ;   process all of the items
"RTN","PRCVTAP",49,0)
 I CNT>0 D SETUP1 ; if there is a line item then set Node 1
"RTN","PRCVTAP",50,0)
 I CNT'>0 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVTAP",51,0)
 ;Call HL7 Message builder/transmitter routine
"RTN","PRCVTAP",52,0)
 ;PRCVNO is comprised of "PRCVUP*Trx#" & Trx# is Sta-fy-Qtr-FCP-seq#
"RTN","PRCVTAP",53,0)
 ;PRCVTIME is time stamp in $H format
"RTN","PRCVTAP",54,0)
 I CNT>0 D BEGIN^PRCVEE1(PRCVNO,PRCVTIME)
"RTN","PRCVTAP",55,0)
 D EXIT
"RTN","PRCVTAP",56,0)
 Q
"RTN","PRCVTAP",57,0)
 ;
"RTN","PRCVTAP",58,0)
ITEM ;
"RTN","PRCVTAP",59,0)
 ;N PRCVAR
"RTN","PRCVTAP",60,0)
 S (PRCVI,PRCVJ,PRCVL)=0
"RTN","PRCVTAP",61,0)
 S PRCVIEN=$$GET1^DIQ(410,PRCV2IEN_",",12,"I") ;vendor ien F410N3P4
"RTN","PRCVTAP",62,0)
 S PRCVFMS=$$GET1^DIQ(440,PRCVIEN_",",34,"I") ;FMS vendor ien F440N3P4
"RTN","PRCVTAP",63,0)
 ;
"RTN","PRCVTAP",64,0)
 F  S PRCVI=$O(^PRCS(410,PRCV2IEN,"IT",PRCVI)) Q:PRCVI'>0!(+PRCVI=0)  D
"RTN","PRCVTAP",65,0)
 . N PRCVAR
"RTN","PRCVTAP",66,0)
 . S PRCVFLDS="2;3;4;5;6;7;17"
"RTN","PRCVTAP",67,0)
 . D GETS^DIQ(410.02,PRCVI_","_PRCV2IEN_",",PRCVFLDS,"","PRCVAR")
"RTN","PRCVTAP",68,0)
 . S PRCVDNB=$$GET1^DIQ(410.02,PRCVI_","_PRCV2IEN_",",18,"I")
"RTN","PRCVTAP",69,0)
 . D SETUP ; DO a setup in XTMP struct
"RTN","PRCVTAP",70,0)
 . Q
"RTN","PRCVTAP",71,0)
 Q
"RTN","PRCVTAP",72,0)
 ;
"RTN","PRCVTAP",73,0)
 ;
"RTN","PRCVTAP",74,0)
SETUP ;set up XTMP ITEM node(S) & UPDATE audit file for each item on a RIL
"RTN","PRCVTAP",75,0)
 ;Order Control code^Item ien^Qty^Vendor ien^^Cost^DynaMed doc ID^Date Needed By^Unit of Purchase^Vendor Stock Number^Packaging Mult.^BOC^Nif #
"RTN","PRCVTAP",76,0)
 ;
"RTN","PRCVTAP",77,0)
 S PRCVOCD="NW" ; order control code for 2237 approval
"RTN","PRCVTAP",78,0)
 S PRCVQTY=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",2) ; qty N0P2
"RTN","PRCVTAP",79,0)
 S PRCVUOP=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",3) ; unit of purchase N0P3
"RTN","PRCVTAP",80,0)
 S PRCVBOC=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",4) ; BOC w descr N0P4
"RTN","PRCVTAP",81,0)
 S PRCVITN=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",5) ; item ien N0P5
"RTN","PRCVTAP",82,0)
 S PRCVSTK=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",6) ; stock # N0P6
"RTN","PRCVTAP",83,0)
 S PRCVCST=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",7) ; unit cost N0P7
"RTN","PRCVTAP",84,0)
 S PRCVDID=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",17) ; DM doc id N4P1
"RTN","PRCVTAP",85,0)
 I PRCVDID="" D  Q  ; if DM doc id is missing, send a bulletin
"RTN","PRCVTAP",86,0)
 . S XMB(1)="doing an approval of the 2237 #: "_PRCVEXTN
"RTN","PRCVTAP",87,0)
 . S XMB(2)="    ...None Found"
"RTN","PRCVTAP",88,0)
 . S XMB(3)="The line item ien: "_$G(PRCVITN)_" is missing it's DM DOC ID."
"RTN","PRCVTAP",89,0)
 . K ^TMP($J,"PRCVTAP") S PRCVTMG="PRCVTAP"
"RTN","PRCVTAP",90,0)
 . S ^TMP($J,"PRCVTAP",1,0)=""
"RTN","PRCVTAP",91,0)
 . S ^TMP($J,"PRCVTAP",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTAP",92,0)
 . S ^TMP($J,"PRCVTAP",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTAP",93,0)
 . D DMERXMB^PRCVLIC(PRCVTMG,PRCVSTA,PRCVFCP)
"RTN","PRCVTAP",94,0)
 . Q
"RTN","PRCVTAP",95,0)
 ;S PRCVDNB=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",18) ; dt needed in external FM format N4P2
"RTN","PRCVTAP",96,0)
 ;S PRCVDT=$$HLDATE^HLFNC(PRCVDNB,"DT") ; YYYYMMDD -- hl7 format
"RTN","PRCVTAP",97,0)
 ;S PRCVDT=$$FMTE^XLFDT(PRCVDNB,"7D") ; YYYY/M/D or YYYY/MM/DD
"RTN","PRCVTAP",98,0)
 S PRCVPKG=$$GET1^DIQ(441.01,PRCVIEN_","_PRCVITN_",",1.6) ; pkg mult F441.01N0P8
"RTN","PRCVTAP",99,0)
 S PRCVNIF=$$GET1^DIQ(441,PRCVITN_",",51) ; nif no F441N0P15
"RTN","PRCVTAP",100,0)
 ;
"RTN","PRCVTAP",101,0)
 ;
"RTN","PRCVTAP",102,0)
 S CNT=CNT+1
"RTN","PRCVTAP",103,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",1)=PRCVOCD
"RTN","PRCVTAP",104,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",2)=PRCVITN
"RTN","PRCVTAP",105,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",3)=PRCVQTY
"RTN","PRCVTAP",106,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",4)=PRCVIEN
"RTN","PRCVTAP",107,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",5)=PRCVFMS
"RTN","PRCVTAP",108,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",6)=PRCVCST
"RTN","PRCVTAP",109,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",7)=PRCVDID
"RTN","PRCVTAP",110,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",8)=PRCVDNB
"RTN","PRCVTAP",111,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",9)=PRCVUOP
"RTN","PRCVTAP",112,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",10)=PRCVSTK
"RTN","PRCVTAP",113,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",11)=PRCVPKG
"RTN","PRCVTAP",114,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",12)=+PRCVBOC
"RTN","PRCVTAP",115,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",13)=PRCVNIF
"RTN","PRCVTAP",116,0)
 QUIT
"RTN","PRCVTAP",117,0)
 ;
"RTN","PRCVTAP",118,0)
 ;*****************************************************************
"RTN","PRCVTAP",119,0)
 ;UPDATE to Audit File 414.02 is NOT needed at this time, however
"RTN","PRCVTAP",120,0)
 ;leaving the code in as commented lines for future use.
"RTN","PRCVTAP",121,0)
 ;*****************************************************************
"RTN","PRCVTAP",122,0)
 ;update Audit File 414.02 for 2237 approval
"RTN","PRCVTAP",123,0)
 ;audit file field numbers #1/#2/#3/#7/#12
"RTN","PRCVTAP",124,0)
 ;
"RTN","PRCVTAP",125,0)
 N PRCVZ,PRCVARR
"RTN","PRCVTAP",126,0)
 ;S PRCVZ=""
"RTN","PRCVTAP",127,0)
 ;S PRCVZ=$O(^PRCV(414.02,"B",PRCVDID,PRCVZ))
"RTN","PRCVTAP",128,0)
 ;I +$G(PRCVZ)'>0 D BULLET Q  ;if record is missing fr 414.02 file
"RTN","PRCVTAP",129,0)
 ;S PRCVARR(414.02,PRCVZ_",",1)=PRCVITN
"RTN","PRCVTAP",130,0)
 ;S PRCVARR(414.02,PRCVZ_",",2)=PRCVIEN
"RTN","PRCVTAP",131,0)
 ;S PRCVARR(414.02,PRCVZ_",",3)=PRCVDUZ
"RTN","PRCVTAP",132,0)
 ;S PRCVARR(414.02,PRCVZ_",",7)=PRCVEXTN
"RTN","PRCVTAP",133,0)
 ;S PRCVARR(414.02,PRCVZ_",",12)=PRCVDNB
"RTN","PRCVTAP",134,0)
 ;D UPDATE^DIE("","PRCVARR")
"RTN","PRCVTAP",135,0)
 ;I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVTAP",136,0)
 ;.S XMB(1)="processing an approval of 2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTAP",137,0)
 ;.S XMB(2)=$G(PRCVDID)
"RTN","PRCVTAP",138,0)
 ;.S XMB(3)="ERROR while updating AUDIT FILE #414.02"
"RTN","PRCVTAP",139,0)
 ;.K ^TMP($J,"PRCVTAP") S PRCVTMG="PRCVTAP"
"RTN","PRCVTAP",140,0)
 ;.S ^TMP($J,"PRCVTAP",1,0)=""
"RTN","PRCVTAP",141,0)
 ;.S ^TMP($J,"PRCVTAP",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTAP",142,0)
 ;.S ^TMP($J,"PRCVTAP",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTAP",143,0)
 ;.S ^TMP($J,"PRCVTAP",4,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVTAP",144,0)
 ;.S ^TMP($J,"PRCVTAP",5,0)="Error Text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCVTAP",145,0)
 ;.D DMERXMB^PRCVLIC(PRCVTMG,PRCVSTA,PRCVFCP)
"RTN","PRCVTAP",146,0)
 ;QUIT
"RTN","PRCVTAP",147,0)
 ;
"RTN","PRCVTAP",148,0)
SETUP0 ;set up XTMP 0 node
"RTN","PRCVTAP",149,0)
 ;Termination Date^Entry Date^Descriptive Text_Time in ext format
"RTN","PRCVTAP",150,0)
 ;D NOW^%DTC,YX^%DTC
"RTN","PRCVTAP",151,0)
 ;S PRCVTM=Y ;date/time in ext format MAR 07, 2005@16:08
"RTN","PRCVTAP",152,0)
 S PRCVCRDT=DT ; DT is FM internal dt 3050307
"RTN","PRCVTAP",153,0)
 S PRCVPGDT=$$FMADD^XLFDT(DT,5) ; purge XTMP global in 5 days
"RTN","PRCVTAP",154,0)
 ;adding extra 0 node to comply w SACC std 4/28/05
"RTN","PRCVTAP",155,0)
 S ^XTMP(PRCVNO,0)=PRCVPGDT_"^"_PRCVCRDT_"^"_"Transmit message to DynaMed for updates"
"RTN","PRCVTAP",156,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",1)=PRCVPGDT
"RTN","PRCVTAP",157,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",2)=PRCVCRDT
"RTN","PRCVTAP",158,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",3)="2237 Approval Update to DynaMed: "_PRCVTM
"RTN","PRCVTAP",159,0)
 Q
"RTN","PRCVTAP",160,0)
 ;
"RTN","PRCVTAP",161,0)
SETUP1 ;set up XTMP 1 node
"RTN","PRCVTAP",162,0)
 ;Number of records^Site^DUZ^Entered By Last Name^Entered By First Name^IEN of 2237
"RTN","PRCVTAP",163,0)
 ;
"RTN","PRCVTAP",164,0)
 I $D(PRCVNAME),PRCVNAME]"" D NAMECOMP^XLFNAME(.PRCVNAME)
"RTN","PRCVTAP",165,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^")=CNT ; total no of items
"RTN","PRCVTAP",166,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",2)=PRCVSTA ; Sta
"RTN","PRCVTAP",167,0)
 ;S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDTCR ; dt/time created
"RTN","PRCVTAP",168,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDUZ ; DUZ
"RTN","PRCVTAP",169,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",4)=PRCVNAME("FAMILY")
"RTN","PRCVTAP",170,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",5)=PRCVNAME("GIVEN")
"RTN","PRCVTAP",171,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",6)=PRCV2IEN ; ien of 2237
"RTN","PRCVTAP",172,0)
 Q
"RTN","PRCVTAP",173,0)
 ;
"RTN","PRCVTAP",174,0)
 ;PRCVZ - record in Audit File
"RTN","PRCVTAP",175,0)
BULLET ;Send a bulletin if record is missing from audit file
"RTN","PRCVTAP",176,0)
 I PRCVZ="" D  Q
"RTN","PRCVTAP",177,0)
 .S XMB(1)="processing an approval of 2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTAP",178,0)
 .S XMB(2)=$G(PRCVDID)
"RTN","PRCVTAP",179,0)
 .S XMB(3)="the record related to DM DOC ID is missing in AUDIT FILE #414.02"
"RTN","PRCVTAP",180,0)
 .K ^TMP($J,"PRCVTAP") S PRCVTMG="PRCVTAP"
"RTN","PRCVTAP",181,0)
 .S ^TMP($J,"PRCVTAP",1,0)=""
"RTN","PRCVTAP",182,0)
 .S ^TMP($J,"PRCVTAP",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTAP",183,0)
 .S ^TMP($J,"PRCVTAP",3,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVTAP",184,0)
 .S ^TMP($J,"PRCVTAP",4,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTAP",185,0)
 .D DMERXMB^PRCVLIC(PRCVTMG,PRCVSTA,PRCVFCP)
"RTN","PRCVTAP",186,0)
 Q
"RTN","PRCVTAP",187,0)
 ;
"RTN","PRCVTAP",188,0)
 ;
"RTN","PRCVTAP",189,0)
EXIT ;kill variables and quit
"RTN","PRCVTAP",190,0)
 K %,X,Y
"RTN","PRCVTAP",191,0)
 Q
"RTN","PRCVTAP",192,0)
 ;
"RTN","PRCVTAP",193,0)
 ;
"RTN","PRCVTCA")
0^21^B47773479
"RTN","PRCVTCA",1,0)
PRCVTCA ;WOIFO/SC-2237 CANCEL TO DYNAMED ; 5/31/05 2:31pm
"RTN","PRCVTCA",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVTCA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVTCA",4,0)
 Q
"RTN","PRCVTCA",5,0)
 ;PRCVTCA is called by routine PRCSEA
"RTN","PRCVTCA",6,0)
 ;This routine is extracting 2237 data when a user enters thru an
"RTN","PRCVTCA",7,0)
 ;option Cancel a Permanent Transaction [PRCSCT] and passing that
"RTN","PRCVTCA",8,0)
 ;info to routine PRCVEE1 which formats data into HL7 Message and
"RTN","PRCVTCA",9,0)
 ;then sends data to DynaMed. It also updates relevant info in Audit
"RTN","PRCVTCA",10,0)
 ;File #414.02.  A bulletin is send if DM DOC ID is missing from an
"RTN","PRCVTCA",11,0)
 ;item or if record doesn't get updated properly in Audit File.
"RTN","PRCVTCA",12,0)
 ;
"RTN","PRCVTCA",13,0)
EN(PRCVDA) ;
"RTN","PRCVTCA",14,0)
 ;  Input     PRCVDA = ien of top entry of the file
"RTN","PRCVTCA",15,0)
 ;Quit if system parameter is not set to DynaMed
"RTN","PRCVTCA",16,0)
 N PRCVSYS
"RTN","PRCVTCA",17,0)
 S PRCVSYS=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCVTCA",18,0)
 Q:PRCVSYS'=1
"RTN","PRCVTCA",19,0)
 ;
"RTN","PRCVTCA",20,0)
 N PRCVRIEN,PRCVDUZ,PRCVNO,PRCVIT,PRCVEXTN,PRCVV,PRCVFLDS
"RTN","PRCVTCA",21,0)
 N PRCVSTA,CNT,PRCVTM,K,PRCVCRDT,PRCVPGDT,PRCVL,PRCVDT
"RTN","PRCVTCA",22,0)
 N PRCVI,PRCVJ,PRCVK,PRCVDID,PRCVITN,PRCVQTY,PRCVCST,PRCVDNB
"RTN","PRCVTCA",23,0)
 N PRCVDTCR,PRCVNAME,PRCVIEN,PRCVTIME,PRCVOCD,PRCV2IEN
"RTN","PRCVTCA",24,0)
 N PRCVAR,PRCVFMS,PRCVUOP,PRCVSTK,PRCVPKG,PRCVBOC,PRCVNIF
"RTN","PRCVTCA",25,0)
 N PRCVFCP,PRCVTMP,PRCVTT
"RTN","PRCVTCA",26,0)
 ;
"RTN","PRCVTCA",27,0)
 S PRCVDUZ=DUZ
"RTN","PRCVTCA",28,0)
 S PRCV2IEN=PRCVDA ; ien of the 2237 trx.
"RTN","PRCVTCA",29,0)
 S PRCVTIME=$H
"RTN","PRCVTCA",30,0)
 S PRCVEXTN=$$GET1^DIQ(410,PRCV2IEN_",",.01) ;.01 value of 2237 trx
"RTN","PRCVTCA",31,0)
 ;
"RTN","PRCVTCA",32,0)
 ;Quit if DM 2237 .01 value is not found in Audit file 414.02 'D' xref
"RTN","PRCVTCA",33,0)
 ;And check if child 2237 that was split has a parent 2237 (in
"RTN","PRCVTCA",34,0)
 ;file 410,node10,piece 2,fld51) is recorded in Audit File 414.02
"RTN","PRCVTCA",35,0)
 ;'D' x-ref.
"RTN","PRCVTCA",36,0)
 S PRCVTT=$$CHKDM^PRCVLIC(PRCVEXTN) Q:PRCVTT'=1
"RTN","PRCVTCA",37,0)
 ;
"RTN","PRCVTCA",38,0)
 D NOW^%DTC,YX^%DTC
"RTN","PRCVTCA",39,0)
 S PRCVTM=Y ;date/time in ext format MAR 07, 2005@16:08
"RTN","PRCVTCA",40,0)
 S PRCVFCP=$P($G(PRCVEXTN),"-",4)
"RTN","PRCVTCA",41,0)
 S PRCVNO="PRCVUP*"_PRCVEXTN ; .01 val in the XTMP subscript
"RTN","PRCVTCA",42,0)
 ;S PRCVNO="PRCVUP*"_PRCV2IEN ; ien in the XTMP subscript
"RTN","PRCVTCA",43,0)
 S PRCVSTA=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCVTCA",44,0)
 S PRCVNAME=$$GET1^DIQ(200,PRCVDUZ_",",.01,"E")
"RTN","PRCVTCA",45,0)
 ;
"RTN","PRCVTCA",46,0)
 S CNT=0
"RTN","PRCVTCA",47,0)
 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVTCA",48,0)
 D SETUP0 ; set up XTMP global's zero node
"RTN","PRCVTCA",49,0)
 D ITEM ;   process all of the items
"RTN","PRCVTCA",50,0)
 I CNT>0 D SETUP1 ; if there is a line item then set Node 1
"RTN","PRCVTCA",51,0)
 I CNT'>0 K ^XTMP(PRCVNO,PRCVTIME)
"RTN","PRCVTCA",52,0)
 ;Call HL7 Message builder/transmitter routine
"RTN","PRCVTCA",53,0)
 ;PRCVNO is comprised of "PRCVUP*Trx#" & Trx# is Sta-fy-Qtr-FCP-seq#
"RTN","PRCVTCA",54,0)
 ;PRCVTIME is time stamp in $H format
"RTN","PRCVTCA",55,0)
 I CNT>0 D BEGIN^PRCVEE1(PRCVNO,PRCVTIME)
"RTN","PRCVTCA",56,0)
 D EXIT
"RTN","PRCVTCA",57,0)
 Q
"RTN","PRCVTCA",58,0)
 ;
"RTN","PRCVTCA",59,0)
ITEM ;
"RTN","PRCVTCA",60,0)
 ;N PRCVAR
"RTN","PRCVTCA",61,0)
 S (PRCVI,PRCVJ,PRCVL)=0
"RTN","PRCVTCA",62,0)
 S PRCVIEN=$$GET1^DIQ(410,PRCV2IEN_",",12,"I") ;vendor ien F410N3P4
"RTN","PRCVTCA",63,0)
 S PRCVFMS=$$GET1^DIQ(440,PRCVIEN_",",34,"I") ;FMS vendor ien F440N3P4
"RTN","PRCVTCA",64,0)
 ;
"RTN","PRCVTCA",65,0)
 F  S PRCVI=$O(^PRCS(410,PRCV2IEN,"IT",PRCVI)) Q:PRCVI'>0!(+PRCVI=0)  D
"RTN","PRCVTCA",66,0)
 . N PRCVAR
"RTN","PRCVTCA",67,0)
 . S PRCVFLDS="2;3;4;5;6;7;17"
"RTN","PRCVTCA",68,0)
 . D GETS^DIQ(410.02,PRCVI_","_PRCV2IEN_",",PRCVFLDS,"","PRCVAR")
"RTN","PRCVTCA",69,0)
 . S PRCVDNB=$$GET1^DIQ(410.02,PRCVI_","_PRCV2IEN_",",18,"I")
"RTN","PRCVTCA",70,0)
 . D SETUP ; DO a setup in XTMP struct
"RTN","PRCVTCA",71,0)
 . Q
"RTN","PRCVTCA",72,0)
 Q
"RTN","PRCVTCA",73,0)
 ;
"RTN","PRCVTCA",74,0)
 ;
"RTN","PRCVTCA",75,0)
SETUP ;set up XTMP ITEM node(S) & UPDATE audit file for each item on a RIL
"RTN","PRCVTCA",76,0)
 ;Order Control code^Item ien^Qty^Vendor ien^^Cost^DynaMed doc ID^Date Needed By^Unit of Purchase^Vendor Stock Number^Packaging Mult.^BOC^Nif #
"RTN","PRCVTCA",77,0)
 ;
"RTN","PRCVTCA",78,0)
 S PRCVOCD="CA" ; order control code for entire 2237 cancellation
"RTN","PRCVTCA",79,0)
 S PRCVQTY=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",2) ; qty N0P2
"RTN","PRCVTCA",80,0)
 S PRCVUOP=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",3) ; unit of purchase N0P3
"RTN","PRCVTCA",81,0)
 S PRCVBOC=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",4) ; BOC w descr N0P4
"RTN","PRCVTCA",82,0)
 S PRCVITN=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",5) ; item ien N0P5
"RTN","PRCVTCA",83,0)
 S PRCVSTK=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",6) ; stock # N0P6
"RTN","PRCVTCA",84,0)
 S PRCVCST=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",7) ; unit cost N0P7
"RTN","PRCVTCA",85,0)
 S PRCVDID=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",17) ; DM doc id N4P1
"RTN","PRCVTCA",86,0)
 I PRCVDID="" D  Q  ; if DM doc id is missing, send a bulletin
"RTN","PRCVTCA",87,0)
 . S XMB(1)="processing a CANCEL of the 2237 #: "_PRCVEXTN
"RTN","PRCVTCA",88,0)
 . S XMB(2)="    ...None Found"
"RTN","PRCVTCA",89,0)
 . S XMB(3)="The line item ien: "_$G(PRCVITN)_" is missing it's DM DOC ID."
"RTN","PRCVTCA",90,0)
 . K ^TMP($J,"PRCVTCA") S PRCVTMP="PRCVTCA"
"RTN","PRCVTCA",91,0)
 . S ^TMP($J,"PRCVTCA",1,0)=""
"RTN","PRCVTCA",92,0)
 . S ^TMP($J,"PRCVTCA",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTCA",93,0)
 . S ^TMP($J,"PRCVTCA",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTCA",94,0)
 . D DMERXMB^PRCVLIC(PRCVTMP,PRCVSTA,PRCVFCP)
"RTN","PRCVTCA",95,0)
 . Q
"RTN","PRCVTCA",96,0)
 ;S PRCVDNB=PRCVAR(410.02,PRCVI_","_PRCV2IEN_",",18) ; dt needed in external FM format N4P2
"RTN","PRCVTCA",97,0)
 ;S PRCVDT=$$HLDATE^HLFNC(PRCVDNB,"DT") ; YYYYMMDD -- hl7 format
"RTN","PRCVTCA",98,0)
 ;S PRCVDT=$$FMTE^XLFDT(PRCVDNB,"7D") ; YYYY/M/D or YYYY/MM/DD
"RTN","PRCVTCA",99,0)
 S PRCVPKG=$$GET1^DIQ(441.01,PRCVIEN_","_PRCVITN_",",1.6) ; pkg mult F441.01N0P8
"RTN","PRCVTCA",100,0)
 S PRCVNIF=$$GET1^DIQ(441,PRCVITN_",",51) ; nif no F441N0P15
"RTN","PRCVTCA",101,0)
 ;
"RTN","PRCVTCA",102,0)
 ;
"RTN","PRCVTCA",103,0)
 S CNT=CNT+1
"RTN","PRCVTCA",104,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",1)=PRCVOCD
"RTN","PRCVTCA",105,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",2)=PRCVITN
"RTN","PRCVTCA",106,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",3)=PRCVQTY
"RTN","PRCVTCA",107,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",4)=PRCVIEN
"RTN","PRCVTCA",108,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",5)=PRCVFMS
"RTN","PRCVTCA",109,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",6)=PRCVCST
"RTN","PRCVTCA",110,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",7)=PRCVDID
"RTN","PRCVTCA",111,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",8)=PRCVDNB
"RTN","PRCVTCA",112,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",9)=PRCVUOP
"RTN","PRCVTCA",113,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",10)=PRCVSTK
"RTN","PRCVTCA",114,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",11)=PRCVPKG
"RTN","PRCVTCA",115,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",12)=+PRCVBOC
"RTN","PRCVTCA",116,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,2,CNT),"^",13)=PRCVNIF
"RTN","PRCVTCA",117,0)
 ;
"RTN","PRCVTCA",118,0)
 ;update Audit File 414.02 for 2237 CANCEL fields 8 and 9
"RTN","PRCVTCA",119,0)
 ;#8 date/time removed from IFCAP    #9 who deleted
"RTN","PRCVTCA",120,0)
 D NOW^%DTC
"RTN","PRCVTCA",121,0)
 N PRCVZ,PRCVARR
"RTN","PRCVTCA",122,0)
 S PRCVZ=""
"RTN","PRCVTCA",123,0)
 S PRCVZ=$O(^PRCV(414.02,"B",PRCVDID,PRCVZ))
"RTN","PRCVTCA",124,0)
 I +$G(PRCVZ)'>0 D BULLET Q  ;if record is missing fr 414.02 file
"RTN","PRCVTCA",125,0)
 S PRCVARR(414.02,PRCVZ_",",8)=% ; int dt/time for removing
"RTN","PRCVTCA",126,0)
 S PRCVARR(414.02,PRCVZ_",",9)=PRCVDUZ ; who deleted
"RTN","PRCVTCA",127,0)
 D UPDATE^DIE("","PRCVARR")
"RTN","PRCVTCA",128,0)
 I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCVTCA",129,0)
 .S XMB(1)="processing CANCEL of a 2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTCA",130,0)
 .S XMB(2)=$G(PRCVDID)
"RTN","PRCVTCA",131,0)
 .S XMB(3)="ERROR while updating AUDIT FILE #414.02"
"RTN","PRCVTCA",132,0)
 .K ^TMP($J,"PRCVTCA") S PRCVTMP="PRCVTCA"
"RTN","PRCVTCA",133,0)
 .S ^TMP($J,"PRCVTCA",1,0)=""
"RTN","PRCVTCA",134,0)
 .S ^TMP($J,"PRCVTCA",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTCA",135,0)
 .S ^TMP($J,"PRCVTCA",3,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTCA",136,0)
 .S ^TMP($J,"PRCVTCA",4,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVTCA",137,0)
 .S ^TMP($J,"PRCVTCA",5,0)="Deleted By: "_$G(PRCVNAME)_"  (DUZ: "_$G(PRCVDUZ)_")"
"RTN","PRCVTCA",138,0)
 .S ^TMP($J,"PRCVTCA",6,0)="Error Text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCVTCA",139,0)
 .D DMERXMB^PRCVLIC(PRCVTMP,PRCVSTA,PRCVFCP)
"RTN","PRCVTCA",140,0)
 QUIT
"RTN","PRCVTCA",141,0)
 ;
"RTN","PRCVTCA",142,0)
SETUP0 ;set up XTMP 0 node
"RTN","PRCVTCA",143,0)
 ;Termination Date^Entry Date^Descriptive Text_Time in ext format
"RTN","PRCVTCA",144,0)
 ;D NOW^%DTC,YX^%DTC
"RTN","PRCVTCA",145,0)
 ;S PRCVTM=Y ;date/time in ext format MAR 07, 2005@16:08
"RTN","PRCVTCA",146,0)
 S PRCVCRDT=DT ; DT is FM internal dt 3050307
"RTN","PRCVTCA",147,0)
 S PRCVPGDT=$$FMADD^XLFDT(DT,5) ; purge XTMP global in 5 days
"RTN","PRCVTCA",148,0)
 ;adding extra 0 node to comply w SACC std 4/28/05
"RTN","PRCVTCA",149,0)
 S ^XTMP(PRCVNO,0)=PRCVPGDT_"^"_PRCVCRDT_"^"_"Transmit message to DynaMed for updates"
"RTN","PRCVTCA",150,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",1)=PRCVPGDT
"RTN","PRCVTCA",151,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",2)=PRCVCRDT
"RTN","PRCVTCA",152,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,0),"^",3)="2237 Cancellation Update to DynaMed: "_PRCVTM
"RTN","PRCVTCA",153,0)
 Q
"RTN","PRCVTCA",154,0)
 ;
"RTN","PRCVTCA",155,0)
SETUP1 ;set up XTMP 1 node
"RTN","PRCVTCA",156,0)
 ;Number of records^Site^DUZ^Entered By Last Name^Entered By First Name^IEN of 2237
"RTN","PRCVTCA",157,0)
 ;
"RTN","PRCVTCA",158,0)
 I $D(PRCVNAME),PRCVNAME]"" D NAMECOMP^XLFNAME(.PRCVNAME)
"RTN","PRCVTCA",159,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^")=CNT ; total no of items
"RTN","PRCVTCA",160,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",2)=PRCVSTA ; Sta
"RTN","PRCVTCA",161,0)
 ;S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDTCR ; dt/time created
"RTN","PRCVTCA",162,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",3)=PRCVDUZ ; DUZ
"RTN","PRCVTCA",163,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",4)=PRCVNAME("FAMILY")
"RTN","PRCVTCA",164,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",5)=PRCVNAME("GIVEN")
"RTN","PRCVTCA",165,0)
 S $P(^XTMP(PRCVNO,PRCVTIME,1),"^",6)=PRCV2IEN ; ien of 2237
"RTN","PRCVTCA",166,0)
 Q
"RTN","PRCVTCA",167,0)
 ;
"RTN","PRCVTCA",168,0)
 ;PRCVZ - record in Audit File
"RTN","PRCVTCA",169,0)
BULLET ;Send a bulletin if record is missing from audit file
"RTN","PRCVTCA",170,0)
 I PRCVZ="" D  Q
"RTN","PRCVTCA",171,0)
 .S XMB(1)="processing CANCEL of 2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTCA",172,0)
 .S XMB(2)=$G(PRCVDID)
"RTN","PRCVTCA",173,0)
 .S XMB(3)="the record related to DM DOC ID is missing in AUDIT FILE #414.02"
"RTN","PRCVTCA",174,0)
 .K ^TMP($J,"PRCVTCA") S PRCVTMP="PRCVTCA"
"RTN","PRCVTCA",175,0)
 .S ^TMP($J,"PRCVTCA",1,0)=""
"RTN","PRCVTCA",176,0)
 .S ^TMP($J,"PRCVTCA",2,0)="2237 #: "_$G(PRCVEXTN)
"RTN","PRCVTCA",177,0)
 .S ^TMP($J,"PRCVTCA",3,0)="DM DOC ID: "_$G(PRCVDID)
"RTN","PRCVTCA",178,0)
 .S ^TMP($J,"PRCVTCA",4,0)="Item's IEN: "_$G(PRCVITN)
"RTN","PRCVTCA",179,0)
 .D DMERXMB^PRCVLIC(PRCVTMP,PRCVSTA,PRCVFCP)
"RTN","PRCVTCA",180,0)
 Q
"RTN","PRCVTCA",181,0)
 ;
"RTN","PRCVTCA",182,0)
 ;
"RTN","PRCVTCA",183,0)
EXIT ;kill variables and quit
"RTN","PRCVTCA",184,0)
 K %,X,Y
"RTN","PRCVTCA",185,0)
 Q
"RTN","PRCVTCA",186,0)
 ;
"RTN","PRCVTCA",187,0)
 ;
"RTN","PRCVUTSC")
0^22^B5336042
"RTN","PRCVUTSC",1,0)
PRCVUTSC ;WOIFO/DST - Convert non-formatted string ; 2/11/03 4:52pm
"RTN","PRCVUTSC",2,0)
 ;;5.1;IFCAP;**81**;Oct 20, 2000
"RTN","PRCVUTSC",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVUTSC",4,0)
 ;
"RTN","PRCVUTSC",5,0)
CONV(STR,ACT,SC) ; 
"RTN","PRCVUTSC",6,0)
 ; 
"RTN","PRCVUTSC",7,0)
 ; Initial data for HL7, HL() array, will be used in this routine.
"RTN","PRCVUTSC",8,0)
 ; Such as HL("ECH"), HL("FS")...
"RTN","PRCVUTSC",9,0)
 ;
"RTN","PRCVUTSC",10,0)
 ; Input:
"RTN","PRCVUTSC",11,0)
 ;       STR - A string to be convert
"RTN","PRCVUTSC",12,0)
 ;       ACT - Action, E - from escape sequences to special char
"RTN","PRCVUTSC",13,0)
 ;                     C - from special char to escape sequences
"RTN","PRCVUTSC",14,0)
 ;       SC  - String of special character used in this HL7 message
"RTN","PRCVUTSC",15,0)
 ;               SC char 1 - Field separator
"RTN","PRCVUTSC",16,0)
 ;                  char 2 - Component separator
"RTN","PRCVUTSC",17,0)
 ;                  char 3 - Repetition separator
"RTN","PRCVUTSC",18,0)
 ;                  char 4 - Escape sequence character
"RTN","PRCVUTSC",19,0)
 ;                  char 5 - Subcomponent separator
"RTN","PRCVUTSC",20,0)
 ;
"RTN","PRCVUTSC",21,0)
 ; Output:
"RTN","PRCVUTSC",22,0)
 ;       STR1 - A converted string
"RTN","PRCVUTSC",23,0)
 ;        
"RTN","PRCVUTSC",24,0)
 N LEN,SP,SP1,STR1,PRCVFS,PRCVCS,PRCVRS,PRCVES,PRCVSS
"RTN","PRCVUTSC",25,0)
 I $L($G(STR))=0!($L($G(ACT))=0) Q ""
"RTN","PRCVUTSC",26,0)
 S PRCVFS=$E(SC,1)
"RTN","PRCVUTSC",27,0)
 S PRCVCS=$E(SC,2)
"RTN","PRCVUTSC",28,0)
 S PRCVRS=$E(SC,3)
"RTN","PRCVUTSC",29,0)
 S PRCVES=$E(SC,4)
"RTN","PRCVUTSC",30,0)
 S PRCVSS=$E(SC,5)
"RTN","PRCVUTSC",31,0)
 S LEN=$L(STR)
"RTN","PRCVUTSC",32,0)
 I ACT="C" D TOC Q STR1
"RTN","PRCVUTSC",33,0)
 ;
"RTN","PRCVUTSC",34,0)
TOE ; Converted from Escape Sequences to special characters
"RTN","PRCVUTSC",35,0)
 ; PRCVFS <== \F\  Field separator
"RTN","PRCVUTSC",36,0)
 ; PRCVCS <== \S\  Component separator
"RTN","PRCVUTSC",37,0)
 ; PRCVRS <== \R\  Repetition separator
"RTN","PRCVUTSC",38,0)
 ; PRCVES <== \E\  Escape sequence character
"RTN","PRCVUTSC",39,0)
 ; PRCVSS <== \T\  Sub-component separator
"RTN","PRCVUTSC",40,0)
 ;
"RTN","PRCVUTSC",41,0)
 N I,J,K,LEN1,SE,SE1,SP,STR2
"RTN","PRCVUTSC",42,0)
 S LEN1=0
"RTN","PRCVUTSC",43,0)
 S STR1=STR
"RTN","PRCVUTSC",44,0)
 ;
"RTN","PRCVUTSC",45,0)
 ; Go through special characters listed in CH and converted, one by one.
"RTN","PRCVUTSC",46,0)
 ;
"RTN","PRCVUTSC",47,0)
 F K=1:1 Q:$P($T(CH+K),";;",2)']""  D
"RTN","PRCVUTSC",48,0)
 . S SE=$P($P($T(CH+K),";;",2),";",2)  ; correspond special character
"RTN","PRCVUTSC",49,0)
 . F I=1:1 S STR2(I)=$P(STR1,SE,I) Q:STR2(I)=""  S SE1(I)=SE
"RTN","PRCVUTSC",50,0)
 . K STR2(I)
"RTN","PRCVUTSC",51,0)
 . F J=1:1:I-1 S LEN1=LEN1+$L(STR2(J))+$L(SE1(J))
"RTN","PRCVUTSC",52,0)
 . I LEN1>$L(STR1) K SE1(I-1)
"RTN","PRCVUTSC",53,0)
 . S LEN1=0
"RTN","PRCVUTSC",54,0)
 . S SP=$P($P($T(CH+K),";;",2),";",1)
"RTN","PRCVUTSC",55,0)
 . S STR2=""
"RTN","PRCVUTSC",56,0)
 . F I=1:1 Q:$G(STR2(I))']""  D
"RTN","PRCVUTSC",57,0)
 .. S STR2=STR2_STR2(I)
"RTN","PRCVUTSC",58,0)
 .. S:$D(SE1(I)) STR2=STR2_@SP
"RTN","PRCVUTSC",59,0)
 . S STR1=STR2
"RTN","PRCVUTSC",60,0)
 . K SP,STR2
"RTN","PRCVUTSC",61,0)
 Q STR1
"RTN","PRCVUTSC",62,0)
 ;
"RTN","PRCVUTSC",63,0)
TOC ; Converted from special characters to Escape Sequences
"RTN","PRCVUTSC",64,0)
 ; PRCVFS ==> \F\  Field separator
"RTN","PRCVUTSC",65,0)
 ; PRCVCS ==> \S\  Component separator
"RTN","PRCVUTSC",66,0)
 ; PRCVRS ==> \R\  Repetition separator
"RTN","PRCVUTSC",67,0)
 ; PRCVES ==> \E\  Escape sequence character
"RTN","PRCVUTSC",68,0)
 ; PRCVSS ==> \T\  Sub-component separator
"RTN","PRCVUTSC",69,0)
 ;
"RTN","PRCVUTSC",70,0)
 N C1,I
"RTN","PRCVUTSC",71,0)
 S STR1=""
"RTN","PRCVUTSC",72,0)
 F I=1:1:LEN D
"RTN","PRCVUTSC",73,0)
 . S C1=$E(STR,I)
"RTN","PRCVUTSC",74,0)
 . S STR1=STR1_$S(C1=PRCVFS:"\F\",C1=PRCVCS:"\S\",C1=PRCVRS:"\R\",C1=PRCVES:"\E\",C1=PRCVSS:"\T\",1:C1)
"RTN","PRCVUTSC",75,0)
 . Q
"RTN","PRCVUTSC",76,0)
 Q
"RTN","PRCVUTSC",77,0)
 ;
"RTN","PRCVUTSC",78,0)
CH ; Convert characters
"RTN","PRCVUTSC",79,0)
 ;;PRCVFS;\F\;Field separator
"RTN","PRCVUTSC",80,0)
 ;;PRCVCS;\S\;Component separator
"RTN","PRCVUTSC",81,0)
 ;;PRCVRS;\R\;Repetition separator
"RTN","PRCVUTSC",82,0)
 ;;PRCVES;\E\;Escape sequence character
"RTN","PRCVUTSC",83,0)
 ;;PRCVSS;\T\;Subcomponent separator
"RTN","PRCVUTSC",84,0)
 ;;
"RTN","PRCVVMF")
0^23^B45911893
"RTN","PRCVVMF",1,0)
PRCVVMF ;WOIFO/DAP-DYNAMED VENDOR UPDATE HL7 MESSAGING ROUTINE; 03/02/05
"RTN","PRCVVMF",2,0)
 ;;5.1;IFCAP;**81**;Oct 20,2000
"RTN","PRCVVMF",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCVVMF",4,0)
 ;
"RTN","PRCVVMF",5,0)
 Q
"RTN","PRCVVMF",6,0)
 ;
"RTN","PRCVVMF",7,0)
EN(PRCVVN) ;Entry point for API Call
"RTN","PRCVVMF",8,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1 Q
"RTN","PRCVVMF",9,0)
 I $D(PRCVVN)=0 Q
"RTN","PRCVVMF",10,0)
 N HLA
"RTN","PRCVVMF",11,0)
 S PRCVCNT=0,PRCVERG=0
"RTN","PRCVVMF",12,0)
 D HDRBLD
"RTN","PRCVVMF",13,0)
 I PRCVERG=1 K PRCVERG Q
"RTN","PRCVVMF",14,0)
 ;
"RTN","PRCVVMF",15,0)
 D MSGBLD
"RTN","PRCVVMF",16,0)
 ;
"RTN","PRCVVMF",17,0)
 S PRCVDP=""
"RTN","PRCVVMF",18,0)
 D GENERATE^HLMA(PRCVPRO,"LM",1,.PRCVDP)
"RTN","PRCVVMF",19,0)
 I +$P(PRCVDP,"^",2) S PRCVERR(1)="Error generating message through VistA HL7 package for Vendor Update involving vendor # "_PRCVVN D CLIFP
"RTN","PRCVVMF",20,0)
 ;
"RTN","PRCVVMF",21,0)
 K ^TMP("PRCVNDR",$J,PRCVVN)
"RTN","PRCVVMF",22,0)
 ;
"RTN","PRCVVMF",23,0)
 D FIN
"RTN","PRCVVMF",24,0)
 K PRCVERG
"RTN","PRCVVMF",25,0)
 ;
"RTN","PRCVVMF",26,0)
 Q
"RTN","PRCVVMF",27,0)
 ;
"RTN","PRCVVMF",28,0)
HDRBLD ;Generate message header, MFI Segment
"RTN","PRCVVMF",29,0)
 ;
"RTN","PRCVVMF",30,0)
 K HL S PRCVPRO="PRCV_IFCAP_04_EV_VEND_UPD"
"RTN","PRCVVMF",31,0)
 D INIT^HLFNC2(PRCVPRO,.HL)
"RTN","PRCVVMF",32,0)
 I $G(HL) S PRCVERR(1)="Error generating message through VistA HL7 package for Vendor Update involving vendor # "_PRCVVN D CLIFP D FIN Q
"RTN","PRCVVMF",33,0)
 ;
"RTN","PRCVVMF",34,0)
 S PRCVCS=$E(HL("ECH")),PRCVRS=$E(HL("ECH"),2),PRCVSS=$E(HL("ECH"),4),PRCVFS=HL("FS")
"RTN","PRCVVMF",35,0)
 ;
"RTN","PRCVVMF",36,0)
 ;PRCVDT Transaction Date/Time w/offset
"RTN","PRCVVMF",37,0)
 D NOW^%DTC
"RTN","PRCVVMF",38,0)
 S PRCVDT=$$FMTHL7^XLFDT(%)
"RTN","PRCVVMF",39,0)
 ;
"RTN","PRCVVMF",40,0)
 ;Build MFI Segment
"RTN","PRCVVMF",41,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVVMF",42,0)
 S HLA("HLS",PRCVCNT)="MFI"_PRCVFS_"OME"_PRCVFS_"440"_PRCVCS_"VENDOR"_PRCVFS_"UPD"_PRCVFS_PRCVDT_PRCVFS_PRCVFS_"AL"
"RTN","PRCVVMF",43,0)
 ;
"RTN","PRCVVMF",44,0)
 Q
"RTN","PRCVVMF",45,0)
 ;
"RTN","PRCVVMF",46,0)
MSGBLD ;Build Message Body
"RTN","PRCVVMF",47,0)
 ;
"RTN","PRCVVMF",48,0)
 ;PRCVNM Vendor Name
"RTN","PRCVVMF",49,0)
 S PRCVNM=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",1)
"RTN","PRCVVMF",50,0)
 ;Address Fields - HL7 String Conversions
"RTN","PRCVVMF",51,0)
 S PRCV1="C",PRCV2=HL("FS")_HL("ECH")
"RTN","PRCVVMF",52,0)
 ;PRCVAD1 Address 1
"RTN","PRCVVMF",53,0)
 S PRCVAD1=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",2)
"RTN","PRCVVMF",54,0)
 I PRCVAD1'="" D
"RTN","PRCVVMF",55,0)
 . S PRCVAD1=$$CONV^PRCVUTSC(PRCVAD1,PRCV1,PRCV2)
"RTN","PRCVVMF",56,0)
 . Q
"RTN","PRCVVMF",57,0)
 ;PRCVAD2 Address 2
"RTN","PRCVVMF",58,0)
 S PRCVAD2=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",3)
"RTN","PRCVVMF",59,0)
 I PRCVAD2'="" D
"RTN","PRCVVMF",60,0)
 . S PRCVAD2=$$CONV^PRCVUTSC(PRCVAD2,PRCV1,PRCV2)
"RTN","PRCVVMF",61,0)
 . Q
"RTN","PRCVVMF",62,0)
 ;PRCVAD3 Address 3
"RTN","PRCVVMF",63,0)
 S PRCVAD3=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",4)
"RTN","PRCVVMF",64,0)
 I PRCVAD3'="" D
"RTN","PRCVVMF",65,0)
 . S PRCVAD3=$$CONV^PRCVUTSC(PRCVAD3,PRCV1,PRCV2)
"RTN","PRCVVMF",66,0)
 . Q
"RTN","PRCVVMF",67,0)
 ;PRCVAD4 Address 4
"RTN","PRCVVMF",68,0)
 S PRCVAD4=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",5)
"RTN","PRCVVMF",69,0)
 I PRCVAD4'="" D
"RTN","PRCVVMF",70,0)
 . S PRCVAD4=$$CONV^PRCVUTSC(PRCVAD4,PRCV1,PRCV2)
"RTN","PRCVVMF",71,0)
 . Q
"RTN","PRCVVMF",72,0)
 ;PRCVCT City
"RTN","PRCVVMF",73,0)
 S PRCVCT=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",6)
"RTN","PRCVVMF",74,0)
 ;PRCVST State
"RTN","PRCVVMF",75,0)
 S PRCVST=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",7)
"RTN","PRCVVMF",76,0)
 ;PRCVZP Zip Code
"RTN","PRCVVMF",77,0)
 S PRCVZP=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",8)
"RTN","PRCVVMF",78,0)
 ;PRCVCPS Contact Person
"RTN","PRCVVMF",79,0)
 S PRCVCPS=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",9)
"RTN","PRCVVMF",80,0)
 ;PRCVCPH Contact Phone #
"RTN","PRCVVMF",81,0)
 S PRCVCPH=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",10)
"RTN","PRCVVMF",82,0)
 ;PRCVSTAT Station #
"RTN","PRCVVMF",83,0)
 S PRCVSTAT=$P(^TMP("PRCVNDR",$J,PRCVVN,0),"^",11)
"RTN","PRCVVMF",84,0)
 ;PRCVEDI Vendor EDI #
"RTN","PRCVVMF",85,0)
 S PRCVEDI=$P(^TMP("PRCVNDR",$J,PRCVVN,1),"^",2)
"RTN","PRCVVMF",86,0)
 ;PRCVFMS Vendor FMS #
"RTN","PRCVVMF",87,0)
 S PRCVFMS=$P(^TMP("PRCVNDR",$J,PRCVVN,1),"^",3)
"RTN","PRCVVMF",88,0)
 ;PRCVALT Alternate Address Indicator
"RTN","PRCVVMF",89,0)
 S PRCVALT=$P(^TMP("PRCVNDR",$J,PRCVVN,1),"^",4)
"RTN","PRCVVMF",90,0)
 ;PRCVINA Inactivation Date
"RTN","PRCVVMF",91,0)
 S PRCVINA=$P(^TMP("PRCVNDR",$J,PRCVVN,2),"^",1)
"RTN","PRCVVMF",92,0)
 I PRCVINA'="" S PRCVINA=$$FMTHL7^XLFDT(PRCVINA)
"RTN","PRCVVMF",93,0)
 ;PRCVCFX Contact FAX #
"RTN","PRCVVMF",94,0)
 S PRCVCFX=$P(^TMP("PRCVNDR",$J,PRCVVN,2),"^",3)
"RTN","PRCVVMF",95,0)
 ;PRCVDNB Dun and Bradstreet #
"RTN","PRCVVMF",96,0)
 S PRCVDNB=$P(^TMP("PRCVNDR",$J,PRCVVN,2),"^",4)
"RTN","PRCVVMF",97,0)
 ;PRCVACN Account Number
"RTN","PRCVVMF",98,0)
 S PRCVACN=$P(^TMP("PRCVNDR",$J,PRCVVN,2),"^",5)
"RTN","PRCVVMF",99,0)
 ;
"RTN","PRCVVMF",100,0)
 ;Handling Repeating Contract Number Array and Building HL7 Field ZVD.6
"RTN","PRCVVMF",101,0)
 S N=0,B=0,PRCVCNA="" F  S N=$O(^TMP("PRCVNDR",$J,PRCVVN,3,N)) Q:+N=0  D
"RTN","PRCVVMF",102,0)
 . S PRCVED=$P(^TMP("PRCVNDR",$J,PRCVVN,3,N),"^",2)
"RTN","PRCVVMF",103,0)
 . S V=$$FMADD^XLFDT(PRCVED,366) I (%<V)!(PRCVED="") D
"RTN","PRCVVMF",104,0)
 .. S B=B+1,PRCVCN=$P(^TMP("PRCVNDR",$J,PRCVVN,3,N),"^",1)
"RTN","PRCVVMF",105,0)
 .. S PRCVBD=$P(^TMP("PRCVNDR",$J,PRCVVN,3,N),"^",3)
"RTN","PRCVVMF",106,0)
 .. I PRCVBD'="" S PRCVBD=$$FMTHL7^XLFDT(PRCVBD)
"RTN","PRCVVMF",107,0)
 .. I PRCVED'="" S PRCVED=$$FMTHL7^XLFDT(PRCVED)
"RTN","PRCVVMF",108,0)
 .. S PRCVCNA(B)=PRCVRS_PRCVCN_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_PRCVBD_PRCVCS_PRCVED
"RTN","PRCVVMF",109,0)
 .. Q
"RTN","PRCVVMF",110,0)
 . Q
"RTN","PRCVVMF",111,0)
 ;
"RTN","PRCVVMF",112,0)
 I $D(PRCVCNA(1)) S PRCVCNA(1)=$P(PRCVCNA(1),PRCVRS,2)
"RTN","PRCVVMF",113,0)
 ;
"RTN","PRCVVMF",114,0)
 ;Build MFE Segment
"RTN","PRCVVMF",115,0)
 S PRCVCNT=PRCVCNT+1
"RTN","PRCVVMF",116,0)
 S HLA("HLS",PRCVCNT)="MFE"_PRCVFS_"MUP"_PRCVFS_PRCVVN_PRCVFS_PRCVFS_PRCVVN_PRCVCS_PRCVNM_PRCVCS_PRCVSTAT_PRCVFS_"CE"
"RTN","PRCVVMF",117,0)
 ;
"RTN","PRCVVMF",118,0)
 ;Build ZVD Segment
"RTN","PRCVVMF",119,0)
 S PRCVCNT=PRCVCNT+1,R=0
"RTN","PRCVVMF",120,0)
 S HLA("HLS",PRCVCNT)="ZVD"_PRCVFS_PRCVNM_PRCVCS_PRCVCS_PRCVVN_PRCVCS_PRCVCS_PRCVCS_PRCVCS_"IFCAP"_PRCVCS_PRCVSTAT_PRCVRS_PRCVNM_PRCVCS_PRCVCS_PRCVEDI_PRCVCS_PRCVCS_PRCVCS_PRCVCS_"EDI"_PRCVCS_PRCVSTAT_PRCVRS
"RTN","PRCVVMF",121,0)
 S HLA("HLS",PRCVCNT)=HLA("HLS",PRCVCNT)_PRCVNM_PRCVCS_PRCVCS_PRCVFMS_PRCVCS_PRCVCS_PRCVCS_PRCVCS_"FMS"_PRCVCS_PRCVSTAT_PRCVRS_PRCVNM_PRCVCS_PRCVCS_PRCVDNB_PRCVCS_PRCVCS_PRCVCS_PRCVCS_"Dun and Bradstreet"_PRCVCS_PRCVSTAT
"RTN","PRCVVMF",122,0)
 S HLA("HLS",PRCVCNT,1)=PRCVFS_PRCVAD1_PRCVSS_PRCVAD2_PRCVSS_PRCVAD3_PRCVSS_PRCVAD4_PRCVCS_PRCVCS_PRCVCT_PRCVCS_PRCVST_PRCVCS_PRCVZP_PRCVFS_PRCVACN_PRCVFS_PRCVCPS_PRCVFS
"RTN","PRCVVMF",123,0)
 S HLA("HLS",PRCVCNT,2)=PRCVCPH_PRCVCS_PRCVCS_"PH"_PRCVRS_PRCVCFX_PRCVCS_PRCVCS_"FX"_PRCVFS_PRCVCS_PRCVINA_PRCVFS
"RTN","PRCVVMF",124,0)
 ;
"RTN","PRCVVMF",125,0)
 I $D(PRCVCNA) S W=0,R=2 F  S W=$O(PRCVCNA(W)) Q:+W=0  D
"RTN","PRCVVMF",126,0)
 . S R=R+1
"RTN","PRCVVMF",127,0)
 . S HLA("HLS",PRCVCNT,R)=PRCVCNA(W)
"RTN","PRCVVMF",128,0)
 . Q
"RTN","PRCVVMF",129,0)
 ;
"RTN","PRCVVMF",130,0)
 I R<2 S R=2
"RTN","PRCVVMF",131,0)
 S HLA("HLS",PRCVCNT,R+1)=PRCVFS_PRCVALT
"RTN","PRCVVMF",132,0)
 ;
"RTN","PRCVVMF",133,0)
 Q
"RTN","PRCVVMF",134,0)
 ;
"RTN","PRCVVMF",135,0)
MFKPROC ;Process MFK^M01 response message
"RTN","PRCVVMF",136,0)
 ;
"RTN","PRCVVMF",137,0)
 ;Uses HLNEXT twice to bypass the MSH segment and go directly to the MSA segment
"RTN","PRCVVMF",138,0)
 X HLNEXT
"RTN","PRCVVMF",139,0)
 ;
"RTN","PRCVVMF",140,0)
 X HLNEXT
"RTN","PRCVVMF",141,0)
 S VAL=$$FLD^HLCSUTL(HLNODE,2)
"RTN","PRCVVMF",142,0)
 I VAL'="AA" D ERROR
"RTN","PRCVVMF",143,0)
 ;
"RTN","PRCVVMF",144,0)
 D FIN
"RTN","PRCVVMF",145,0)
 ;
"RTN","PRCVVMF",146,0)
 Q
"RTN","PRCVVMF",147,0)
 ;
"RTN","PRCVVMF",148,0)
ERROR ;Process ERR Segments
"RTN","PRCVVMF",149,0)
 S PRCVERC=2,PRCVERR(1)="Unable to update Vendor in DynaMed."
"RTN","PRCVVMF",150,0)
 S PRCVERR(2)="During a Vendor Update to DynaMed the following errors occurred:"
"RTN","PRCVVMF",151,0)
 F M=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","PRCVVMF",152,0)
 . S VAL=$$FLD^HLCSUTL(HLNODE,1)
"RTN","PRCVVMF",153,0)
 . I VAL="MFA" S PRCVME=$$FLD^HLCSUTL(HLNODE,3)
"RTN","PRCVVMF",154,0)
 . I VAL="ERR" D
"RTN","PRCVVMF",155,0)
 .. S PRCVERC=PRCVERC+1,PRCVERM=$$FLD^HLCSUTL(HLNODE,6)
"RTN","PRCVVMF",156,0)
 .. S PRCVERR(PRCVERC)=$P(PRCVERM,"^",2)
"RTN","PRCVVMF",157,0)
 .. Q
"RTN","PRCVVMF",158,0)
 . Q
"RTN","PRCVVMF",159,0)
 ;
"RTN","PRCVVMF",160,0)
 D CLIFP
"RTN","PRCVVMF",161,0)
 ;
"RTN","PRCVVMF",162,0)
 Q
"RTN","PRCVVMF",163,0)
 ;
"RTN","PRCVVMF",164,0)
CLIFP ;Call partner app w/ mail message for users on error
"RTN","PRCVVMF",165,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ
"RTN","PRCVVMF",166,0)
 S XMSUB="DynaMed Vendor # "_PRCVME_" Update Errors "_$$HTE^XLFDT($H)
"RTN","PRCVVMF",167,0)
 S XMDUZ="IFCAP/COTS Inventory Interface"
"RTN","PRCVVMF",168,0)
 S XMTEXT="PRCVERR("
"RTN","PRCVVMF",169,0)
 S XMY("G.PRCV Item Vendor Edits")=""
"RTN","PRCVVMF",170,0)
 ;
"RTN","PRCVVMF",171,0)
 D ^XMD
"RTN","PRCVVMF",172,0)
 S PRCVERG=1
"RTN","PRCVVMF",173,0)
 ;
"RTN","PRCVVMF",174,0)
 Q
"RTN","PRCVVMF",175,0)
 ;
"RTN","PRCVVMF",176,0)
FIN ;Clean up variables
"RTN","PRCVVMF",177,0)
 K PRCVVN,PRCVCNT,PRCVDP,PRCVPRO,HL,PRCVCS,PRCVRS,PRCVFS,PRCVDT,%,PRCVNM,PRCVAD1,PRCVAD2,PRCVAD3,PRCVAD4,PRCVME
"RTN","PRCVVMF",178,0)
 K PRCVCT,PRCVST,PRCVZP,PRCVCPS,PRCVCPH,PRCVSTAT,PRCVEDI,PRCVFMS,PRCVALT,PRCVINA,PRCVCFX,PRCVDNB,PRCVACN
"RTN","PRCVVMF",179,0)
 K N,PRCVCNA,PRCVCN,PRCVBD,PRCVED,VAL,PRCVERC,PRCVERM,PRCVERR,PRCV1,PRCV2,STR1,PRCVSS,V,W,R,B,M
"RTN","PRCVVMF",180,0)
 ;
"RTN","PRCVVMF",181,0)
 Q
"SEC","^DIC",414.02,414.02,0,"AUDIT")
@
"SEC","^DIC",414.02,414.02,0,"DD")
@
"SEC","^DIC",414.02,414.02,0,"DEL")
@
"SEC","^DIC",414.02,414.02,0,"LAYGO")
@
"SEC","^DIC",414.02,414.02,0,"RD")
@
"SEC","^DIC",414.02,414.02,0,"WR")
@
"SEC","^DIC",414.03,414.03,0,"AUDIT")
@
"SEC","^DIC",414.03,414.03,0,"DD")
@
"SEC","^DIC",414.03,414.03,0,"DEL")
@
"SEC","^DIC",414.03,414.03,0,"LAYGO")
@
"SEC","^DIC",414.03,414.03,0,"RD")
@
"SEC","^DIC",414.03,414.03,0,"WR")
@
"SEC","^DIC",414.04,414.04,0,"AUDIT")
@
"SEC","^DIC",414.04,414.04,0,"DD")
@
"SEC","^DIC",414.04,414.04,0,"DEL")
@
"SEC","^DIC",414.04,414.04,0,"LAYGO")
@
"SEC","^DIC",414.04,414.04,0,"RD")
@
"SEC","^DIC",414.04,414.04,0,"WR")
@
"UP",410,410.02,-1)
410^IT
"UP",410,410.02,0)
410.02
"UP",410.3,410.31,-1)
410.3^1
"UP",410.3,410.31,0)
410.31
"UP",442,442.01,-1)
442^2
"UP",442,442.01,0)
442.01
"VER")
8.0^22.0
"^DD",410,410,10,0)
ITEM^410.02AI^^IT;0
"^DD",410,410,10,21,0)
^.001^1^1^3050214^^^^
"^DD",410,410,10,21,1,0)
This is the item(s) being ordered on this request.
"^DD",410,410,10,"DT")
2910917
"^DD",410,410,455,0)
ISSUE BOOK BATCH ID^F^^445;5^K:$L(X)>25!($L(X)<1) X
"^DD",410,410,455,1,0)
^.1
"^DD",410,410,455,1,1,0)
410^AS
"^DD",410,410,455,1,1,1)
S ^PRCS(410,"AS",$E(X,1,30),DA)=""
"^DD",410,410,455,1,1,2)
K ^PRCS(410,"AS",$E(X,1,30),DA)
"^DD",410,410,455,1,1,"%D",0)
^^3^3^3050321^
"^DD",410,410,455,1,1,"%D",1,0)
This cross reference is used for background, but not user interactive 
"^DD",410,410,455,1,1,"%D",2,0)
lookup of file #410 entries associated with a given Issue Book from a 
"^DD",410,410,455,1,1,"%D",3,0)
COTS inventory system.
"^DD",410,410,455,1,1,"DT")
3050321
"^DD",410,410,455,3)
Answer must be 1-25 characters in length.
"^DD",410,410,455,21,0)
^^2^2^3050321^
"^DD",410,410,455,21,1,0)
This is the Batch ID of the Issue Book sent from the COTS inventory 
"^DD",410,410,455,21,2,0)
system to uniquely identify the Issue Book.
"^DD",410,410,455,"DT")
3050321
"^DD",410,410.02,0)
ITEM SUB-FIELD^NL^445.05^24
"^DD",410,410.02,0,"NM","ITEM")

"^DD",410,410.02,.01,0)
LINE ITEM NUMBER^MRNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",410,410.02,.01,1,0)
^.1^^-1
"^DD",410,410.02,.01,1,1,0)
410.02^B
"^DD",410,410.02,.01,1,1,1)
S ^PRCS(410,DA(1),"IT","B",$E(X,1,30),DA)=""
"^DD",410,410.02,.01,1,1,2)
K ^PRCS(410,DA(1),"IT","B",$E(X,1,30),DA)
"^DD",410,410.02,.01,1,3,0)
410.02^AB
"^DD",410,410.02,.01,1,3,1)
S ^PRCS(410,DA(1),"IT","AB",$E(X,1,30),DA)=""
"^DD",410,410.02,.01,1,3,2)
K ^PRCS(410,DA(1),"IT","AB",$E(X,1,30),DA)
"^DD",410,410.02,.01,1,3,"%D",0)
^^4^4^2940216^^
"^DD",410,410.02,.01,1,3,"%D",1,0)
This cross reference is set for each line item of
"^DD",410,410.02,.01,1,3,"%D",2,0)
a transaction, from the "IT" item cross reference.
"^DD",410,410.02,.01,1,3,"%D",3,0)
Listed from "AB" and the line item number, on
"^DD",410,410.02,.01,1,3,"%D",4,0)
consecutive nodes, are the line item data.
"^DD",410,410.02,.01,1,4,0)
410.02^AD^MUMPS
"^DD",410,410.02,.01,1,4,1)
S Z(1)=$S($D(^PRCS(410,DA(1),3)):$P(^(3),U,3),1:"") S ^PRCS(410,DA(1),"IT",DA,0)=$P(^PRCS(410,DA(1),"IT",DA,0)_"^^^^^^^",U,1,7)_U_Z(1) K Z(1)
"^DD",410,410.02,.01,1,4,2)
Q
"^DD",410,410.02,.01,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 999
"^DD",410,410.02,.01,21,0)
^^1^1^2910514^
"^DD",410,410.02,.01,21,1,0)
This is the item number for this request.
"^DD",410,410.02,.01,"DT")
3050222
"^DD",410,410.02,17,0)
DM DOC ID^FI^^4;1^K:$L(X)>16!($L(X)<9) X
"^DD",410,410.02,17,3)
Answer must be 9-16 characters in length
"^DD",410,410.02,17,10)
DynaMed --Information Control
"^DD",410,410.02,17,21,0)
^^8^8^3050228^
"^DD",410,410.02,17,21,1,0)
This is DynaMed's unique number associated with each item that is sent on
"^DD",410,410.02,17,21,2,0)
a request order from DynaMed. It is composed of 1 digit for Year
"^DD",410,410.02,17,21,3,0)
concatenated with 3 digit Julian Date a dash, concatenated with 4 digit
"^DD",410,410.02,17,21,4,0)
Sequential Number and a dash, concatenated up to 6 characters (ex
"^DD",410,410.02,17,21,5,0)
YDDD-9999-CCCCCC).
"^DD",410,410.02,17,21,6,0)
 
"^DD",410,410.02,17,21,7,0)
This number is provided by DynaMed, a user's input is not required. 
"^DD",410,410.02,17,21,8,0)
DynaMed allows 16 characters maximum. 
"^DD",410,410.02,17,23,0)
^^4^4^3050228^^
"^DD",410,410.02,17,23,1,0)
This number will be associated with an order request from DynaMed.  Each
"^DD",410,410.02,17,23,2,0)
order request will identify a single item in Item Master File in IFCAP.  
"^DD",410,410.02,17,23,3,0)
The DM DOC ID is also recorded in a DynaMed IFCAP Interface Audit File
"^DD",410,410.02,17,23,4,0)
#414.02 (a new file created for DynaMed interface).
"^DD",410,410.02,17,"DT")
3050228
"^DD",410,410.02,18,0)
DATE NEEDED BY^DI^^4;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",410,410.02,18,3)
(No range limit on date)
"^DD",410,410.02,18,10)
DynaMed --Information Control
"^DD",410,410.02,18,21,0)
^^4^4^3050228^
"^DD",410,410.02,18,21,1,0)
This field holds a date when DynaMed anticipates an item should arrive. It
"^DD",410,410.02,18,21,2,0)
is received in a Repetitive Item List(RIL) transaction for each item and
"^DD",410,410.02,18,21,3,0)
then carried on to 2237 and then to Purchase Order as the item is
"^DD",410,410.02,18,21,4,0)
processed through IFCAP.
"^DD",410,410.02,18,23,0)
^^2^2^3050228^^^
"^DD",410,410.02,18,23,1,0)
This field reflects item's needed by date in DynaMed.  It is best NOT to
"^DD",410,410.02,18,23,2,0)
edit this date.
"^DD",410,410.02,18,"DT")
3050228
"^DD",410.3,410.3,8,0)
DATE/TIME IN DM^DI^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",410.3,410.3,8,3)
(No range limit on date)
"^DD",410.3,410.3,8,10)
DynaMed --Information Control
"^DD",410.3,410.3,8,21,0)
^^3^3^3050114^
"^DD",410.3,410.3,8,21,1,0)
This date and time signifies when a Requisition was generated in 
"^DD",410.3,410.3,8,21,2,0)
DynaMed. This date is passed by DynaMed and it is used to determine 
"^DD",410.3,410.3,8,21,3,0)
Fiscal Year and Quarter for the transaction in IFCAP.
"^DD",410.3,410.3,8,23,0)
^^3^3^3050114^
"^DD",410.3,410.3,8,23,1,0)
This is the date that determines Fiscal Year and Quarter for the 
"^DD",410.3,410.3,8,23,2,0)
transaction in IFCAP package.
"^DD",410.3,410.3,8,23,3,0)
A user is not allowed to edit this field.
"^DD",410.3,410.3,8,"DT")
3050228
"^DD",410.3,410.31,6,0)
DM DOC ID^FI^^0;7^K:$L(X)>16!($L(X)<9) X
"^DD",410.3,410.31,6,3)
Answer must be 9-16 characters in length.
"^DD",410.3,410.31,6,10)
DynaMed --Information Control
"^DD",410.3,410.31,6,21,0)
^^8^8^3050228^
"^DD",410.3,410.31,6,21,1,0)
This is DynaMed's unique number associated with each item that is sent on
"^DD",410.3,410.31,6,21,2,0)
a request order from DynaMed. It is composed of 1 digit for Year
"^DD",410.3,410.31,6,21,3,0)
concatenated with 3 digit Julian Date a dash, concatenated with 4 digit
"^DD",410.3,410.31,6,21,4,0)
Sequential Number and a dash, concatenated up to 6 characters (ex
"^DD",410.3,410.31,6,21,5,0)
YDDD-9999-CCCCCC).
"^DD",410.3,410.31,6,21,6,0)
 
"^DD",410.3,410.31,6,21,7,0)
This number is provided by DynaMed, a user's input is not required. 
"^DD",410.3,410.31,6,21,8,0)
DynaMed allows 16 characters maximum. 
"^DD",410.3,410.31,6,23,0)
^.001^9^9^3050228^^^^
"^DD",410.3,410.31,6,23,1,0)
This number will be associated with an order request from DynaMed.  Each 
"^DD",410.3,410.31,6,23,2,0)
order request will identify a single item in Item Master File in IFCAP.
"^DD",410.3,410.31,6,23,3,0)
 
"^DD",410.3,410.31,6,23,4,0)
The DM DOC ID will also be recorded in a New Audit File (DYNAMED IFCAP 
"^DD",410.3,410.31,6,23,5,0)
INTERFACE AUDIT file #414.02 created for DynaMed Interface) and a cross
"^DD",410.3,410.31,6,23,6,0)
reference will be established to ensure that requests bearing the same
"^DD",410.3,410.31,6,23,7,0)
Document ID are only processed once by IFCAP.
"^DD",410.3,410.31,6,23,8,0)
 
"^DD",410.3,410.31,6,23,9,0)
A user is not allowed to edit this field.
"^DD",410.3,410.31,6,"DT")
3050228
"^DD",410.3,410.31,7,0)
DATE NEEDED BY^DI^^0;8^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",410.3,410.31,7,3)
(No range limit on date)
"^DD",410.3,410.31,7,10)
DynaMed --Information Control
"^DD",410.3,410.31,7,21,0)
^^4^4^3050531^^
"^DD",410.3,410.31,7,21,1,0)
This date is entered on the DynaMed system at the time the item is 
"^DD",410.3,410.31,7,21,2,0)
being requested.  This Date is received in a transaction from DynaMed,
"^DD",410.3,410.31,7,21,3,0)
it resides first in the RIL, it is pushed to the 2237, and then to the
"^DD",410.3,410.31,7,21,4,0)
Purchase Order as the item is processed through IFCAP.
"^DD",410.3,410.31,7,23,0)
^.001^1^1^3050531^^^^
"^DD",410.3,410.31,7,23,1,0)
A user is not allowed to edit this field.
"^DD",410.3,410.31,7,"DT")
3050531
"^DD",411,411,106,0)
FCP MONITOR STATUS^*S^0:NOT USED;1:ENABLED;2:NOT ENABLED;^60;2^Q
"^DD",411,411,106,.1)
Fund monitor status
"^DD",411,411,106,3)
Choose "NOT ENABLED" to ask monitor to stop
"^DD",411,411,106,12)
The only valid option at non-Dynamed sited is "NOT USED"
"^DD",411,411,106,12.1)
S DIC("S")="I (($$CHK^PRCVMON)!(Y'>0))"
"^DD",411,411,106,21,0)
^^4^4^3050519^
"^DD",411,411,106,21,1,0)
This field is used to control the state of the FCP monitor and should be 
"^DD",411,411,106,21,2,0)
populated for the primary station only (others are ignored). To ask the 
"^DD",411,411,106,21,3,0)
monitor to stop, set this field to "NOT ENABLED", to allow it to start, 
"^DD",411,411,106,21,4,0)
set it to "ENABLED".
"^DD",411,411,106,"DT")
3050524
"^DD",411,411,107,0)
FCP MONITOR RUNNING?^SI^0:NO;1:YES;^60;3^Q
"^DD",411,411,107,.1)
FCP Monitor Running
"^DD",411,411,107,3)
This field should be set to YES if the monitor is running
"^DD",411,411,107,21,0)
^^2^2^3050524^
"^DD",411,411,107,21,1,0)
This flag is set to 1 ("YES") to indicate that the FCP monitor is 
"^DD",411,411,107,21,2,0)
running. Users should not edit this field.
"^DD",411,411,107,"DT")
3050524
"^DD",414.02,414.02,0)
FIELD^^13^14
"^DD",414.02,414.02,0,"DDA")
N
"^DD",414.02,414.02,0,"DT")
3050413
"^DD",414.02,414.02,0,"IX","C",414.02,4)

"^DD",414.02,414.02,0,"IX","D",414.02,7)

"^DD",414.02,414.02,0,"NM","DYNAMED IFCAP INTERFACE AUDIT")

"^DD",414.02,414.02,.01,0)
DM DOC ID^RFI^^0;1^K:$L(X)>16!($L(X)<9)!'(X'?1P.E) X
"^DD",414.02,414.02,.01,1,0)
^.1^^0
"^DD",414.02,414.02,.01,3)
Answer must be 9-16 characters in length.
"^DD",414.02,414.02,.01,21,0)
^^9^9^3050301^
"^DD",414.02,414.02,.01,21,1,0)
This is DynaMed's unique number associated with each item that is sent on 
"^DD",414.02,414.02,.01,21,2,0)
a request order from DynaMed.
"^DD",414.02,414.02,.01,21,3,0)
 
"^DD",414.02,414.02,.01,21,4,0)
It is composed of 1 digit for Year concatenated with 3 digit Julian Date
"^DD",414.02,414.02,.01,21,5,0)
and a dash, concatenated with 4 digit Sequential Number and a dash,
"^DD",414.02,414.02,.01,21,6,0)
concatenated up to 6 characters for the stockroom(ex YDDD-9999-CCCCCC).
"^DD",414.02,414.02,.01,21,7,0)
 
"^DD",414.02,414.02,.01,21,8,0)
This number is provided by DynaMed, a user's input is not required.
"^DD",414.02,414.02,.01,21,9,0)
DynaMed allows 16 characters maximum.
"^DD",414.02,414.02,.01,23,0)
^^6^6^3050301^
"^DD",414.02,414.02,.01,23,1,0)
This number will be associated with an order request from DynaMed.  Each 
"^DD",414.02,414.02,.01,23,2,0)
order request will identify a single item in Item Master File in IFCAP. 
"^DD",414.02,414.02,.01,23,3,0)
It is recorded in this file for auditing purpose and to ensure that 
"^DD",414.02,414.02,.01,23,4,0)
requests bearing the same Document ID are only processed once by IFCAP.
"^DD",414.02,414.02,.01,23,5,0)
 
"^DD",414.02,414.02,.01,23,6,0)
A user is not allowed to edit this field.
"^DD",414.02,414.02,.01,"DT")
3050304
"^DD",414.02,414.02,1,0)
ITEM^P441'^PRC(441,^0;2^Q
"^DD",414.02,414.02,1,3)
This field holds Item's internal entry number(IEN).
"^DD",414.02,414.02,1,21,0)
^^2^2^3050228^
"^DD",414.02,414.02,1,21,1,0)
An item's Internal Entry Number(IEN) is stored in this field. It is
"^DD",414.02,414.02,1,21,2,0)
updated when RIL record is built in IFCAP.
"^DD",414.02,414.02,1,23,0)
^.001^1^1^3050228^^^
"^DD",414.02,414.02,1,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,1,"DT")
3050228
"^DD",414.02,414.02,2,0)
VENDOR^P440'^PRC(440,^0;3^Q
"^DD",414.02,414.02,2,3)
This fields holds Vendor's internal entry number(IEN).
"^DD",414.02,414.02,2,21,0)
^^2^2^3050228^
"^DD",414.02,414.02,2,21,1,0)
A vendor's Internal Entry Number(IEN) is stored in this field. It is 
"^DD",414.02,414.02,2,21,2,0)
populated when a RIL record is built in IFCAP for DynaMed.
"^DD",414.02,414.02,2,23,0)
^^1^1^3050228^
"^DD",414.02,414.02,2,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,2,"DT")
3050228
"^DD",414.02,414.02,3,0)
ENTERED BY^P200'^VA(200,^0;4^Q
"^DD",414.02,414.02,3,3)
It identifies a person who entered the transaction (ex. RIL, 2237 or PC order transaction).
"^DD",414.02,414.02,3,21,0)
^^1^1^3050301^^
"^DD",414.02,414.02,3,21,1,0)
The user's DUZ, who entered the transaction is placed in this field.
"^DD",414.02,414.02,3,23,0)
^.001^1^1^3050228^^^^
"^DD",414.02,414.02,3,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,3,"DT")
3050301
"^DD",414.02,414.02,4,0)
RIL#^F^^0;5^K:$L(X)>25!($L(X)<12) X
"^DD",414.02,414.02,4,1,0)
^.1
"^DD",414.02,414.02,4,1,1,0)
414.02^C
"^DD",414.02,414.02,4,1,1,1)
S ^PRCV(414.02,"C",$E(X,1,30),DA)=""
"^DD",414.02,414.02,4,1,1,2)
K ^PRCV(414.02,"C",$E(X,1,30),DA)
"^DD",414.02,414.02,4,1,1,"%D",0)
^^1^1^3050309^
"^DD",414.02,414.02,4,1,1,"%D",1,0)
Index a RIL # for lookup.
"^DD",414.02,414.02,4,1,1,"DT")
3050309
"^DD",414.02,414.02,4,3)
Answer must be 12-25 characters in length.
"^DD",414.02,414.02,4,21,0)
^^1^1^3050223^
"^DD",414.02,414.02,4,21,1,0)
This field holds a reference to RIL File 410.3, field .01 'Entry Number'.
"^DD",414.02,414.02,4,23,0)
^^1^1^3050223^
"^DD",414.02,414.02,4,23,1,0)
This data should not be edited.
"^DD",414.02,414.02,4,"DT")
3050309
"^DD",414.02,414.02,5,0)
DATE/TIME CREATED IN IFCAP^D^^0;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",414.02,414.02,5,3)
This time stamp refers to when a transactions was created in IFCAP.
"^DD",414.02,414.02,5,21,0)
^^3^3^3050228^
"^DD",414.02,414.02,5,21,1,0)
This field refers to Date and Time stamp when a transaction was created in
"^DD",414.02,414.02,5,21,2,0)
IFCAP.  (ex. A transaction can be from REPETITIVE ITEM LIST (RIL) File
"^DD",414.02,414.02,5,21,3,0)
#410.3 or CONTROL POINT ACTIVITY (CPA) File #410)
"^DD",414.02,414.02,5,23,0)
^.001^2^2^3050228^^
"^DD",414.02,414.02,5,23,1,0)
The data should be stored in internal FileMan format.  This field should
"^DD",414.02,414.02,5,23,2,0)
not be edited by a user.
"^DD",414.02,414.02,5,"DT")
3050228
"^DD",414.02,414.02,6,0)
DATE/TIME CREATED IN DYNAMED^D^^0;7^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",414.02,414.02,6,3)
This time stamp refers to date & time when a Requisition was generated in DynaMed. 
"^DD",414.02,414.02,6,21,0)
^^2^2^3050223^
"^DD",414.02,414.02,6,21,1,0)
This time stamp refers to date & time when a Requisition was created in 
"^DD",414.02,414.02,6,21,2,0)
DynaMed.
"^DD",414.02,414.02,6,23,0)
^^1^1^3050223^^
"^DD",414.02,414.02,6,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,6,"DT")
3050223
"^DD",414.02,414.02,7,0)
2237#^F^^0;8^K:$L(X)>18!($L(X)<3) X
"^DD",414.02,414.02,7,1,0)
^.1
"^DD",414.02,414.02,7,1,1,0)
414.02^D
"^DD",414.02,414.02,7,1,1,1)
S ^PRCV(414.02,"D",$E(X,1,30),DA)=""
"^DD",414.02,414.02,7,1,1,2)
K ^PRCV(414.02,"D",$E(X,1,30),DA)
"^DD",414.02,414.02,7,1,1,"%D",0)
^^1^1^3050309^
"^DD",414.02,414.02,7,1,1,"%D",1,0)
Index a 2237 # for a lookup. 
"^DD",414.02,414.02,7,1,1,"DT")
3050309
"^DD",414.02,414.02,7,3)
Answer must be 3-18 characters in length. This field holds the reference to entry made in CPA File #410.
"^DD",414.02,414.02,7,21,0)
^^2^2^3050228^
"^DD",414.02,414.02,7,21,1,0)
This field holds the reference to entry made in CONTROL POINT ACTIVITY 
"^DD",414.02,414.02,7,21,2,0)
File #410, field .01 'Transaction Number'.
"^DD",414.02,414.02,7,23,0)
^.001^1^1^3050228^^^
"^DD",414.02,414.02,7,23,1,0)
This field should not be edited.
"^DD",414.02,414.02,7,"DT")
3050309
"^DD",414.02,414.02,8,0)
DATE/TIME REMOVED FROM IFCAP^D^^0;9^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",414.02,414.02,8,3)
This refers to when a transaction was deleted from IFCAP.
"^DD",414.02,414.02,8,21,0)
^^2^2^3050223^^
"^DD",414.02,414.02,8,21,1,0)
This date and time will inform when a transaction (such as RIL or 2237)
"^DD",414.02,414.02,8,21,2,0)
was deleted from IFCAP.
"^DD",414.02,414.02,8,23,0)
^^1^1^3050223^^
"^DD",414.02,414.02,8,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,8,"DT")
3050223
"^DD",414.02,414.02,9,0)
WHO DELETED^P200'^VA(200,^0;10^Q
"^DD",414.02,414.02,9,3)
This field identifies the person who deleted a transaction containing this DM DOC ID from a file (ex. files 410, 410.3).
"^DD",414.02,414.02,9,21,0)
^^2^2^3050301^
"^DD",414.02,414.02,9,21,1,0)
This field will hold the DUZ of the person who deleted the transaction 
"^DD",414.02,414.02,9,21,2,0)
containing this DM DOC ID from a file (ex. 410, 410.3 or 442).
"^DD",414.02,414.02,9,23,0)
^.001^1^1^3050301^^^^
"^DD",414.02,414.02,9,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,9,"DT")
3050301
"^DD",414.02,414.02,10,0)
PC ORDER#^F^^0;11^K:$L(X)>15!($L(X)<10) X
"^DD",414.02,414.02,10,3)
Answer must be 10-15 characters in length. It is a Purchase Card Order#.
"^DD",414.02,414.02,10,21,0)
^^4^4^3050228^
"^DD",414.02,414.02,10,21,1,0)
This field will hold a Purchase Card Order external number that is 
"^DD",414.02,414.02,10,21,2,0)
PROCUREMENT & ACCOUNTIN G TRANSACTIONS File #442, field's .01 value.
"^DD",414.02,414.02,10,21,3,0)
 
"^DD",414.02,414.02,10,21,4,0)
It is only meant for orders related to Purchase Card.
"^DD",414.02,414.02,10,23,0)
^.001^1^1^3050228^^
"^DD",414.02,414.02,10,23,1,0)
This field should not be edited by a user.
"^DD",414.02,414.02,10,"DT")
3050228
"^DD",414.02,414.02,11,0)
RECEIVING^414.021DA^^1;0
"^DD",414.02,414.02,11,21,0)
^^1^1^3050218^
"^DD",414.02,414.02,11,21,1,0)
This multiple is used to hold details about Receiving.
"^DD",414.02,414.02,12,0)
DATE NEEDED BY^DI^^0;12^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",414.02,414.02,12,3)
(No range limit on date)
"^DD",414.02,414.02,12,10)
DynaMed --Information Control
"^DD",414.02,414.02,12,21,0)
^^2^2^3050223^
"^DD",414.02,414.02,12,21,1,0)
This field is provided by DynaMed, it is this date that DynaMed 
"^DD",414.02,414.02,12,21,2,0)
anticipates receiving an item.
"^DD",414.02,414.02,12,23,0)
^^3^3^3050223^^
"^DD",414.02,414.02,12,23,1,0)
This date is received from DynaMed on a requisition which is entered in 
"^DD",414.02,414.02,12,23,2,0)
RIL, and then carried on to 2237, Purchase Order as the item is processed 
"^DD",414.02,414.02,12,23,3,0)
through IFCAP.
"^DD",414.02,414.02,12,"DT")
3050225
"^DD",414.02,414.02,13,0)
ENTERED BY NAME^F^^2;1^K:$L(X)>35!($L(X)<1) X
"^DD",414.02,414.02,13,3)
Answer must be 1-35 characters in length.
"^DD",414.02,414.02,13,21,0)
^.001^6^6^3050413^^
"^DD",414.02,414.02,13,21,1,0)
Enter the name of the user who entered this requisition in DynaMed in
"^DD",414.02,414.02,13,21,2,0)
the format Family(Last),Given(First).  This name corresponds to the data
"^DD",414.02,414.02,13,21,3,0)
in the ENTERED BY field #3.
"^DD",414.02,414.02,13,21,4,0)
 
"^DD",414.02,414.02,13,21,5,0)
The value must be 1-35 characters in length and should contain only 
"^DD",414.02,414.02,13,21,6,0)
uppercase alpha characters.
"^DD",414.02,414.02,13,"DT")
3050413
"^DD",414.02,414.021,0)
RECEIVING SUB-FIELD^^5^6
"^DD",414.02,414.021,0,"DT")
3050223
"^DD",414.02,414.021,0,"IX","B",414.021,.01)

"^DD",414.02,414.021,0,"NM","RECEIVING")

"^DD",414.02,414.021,0,"UP")
414.02
"^DD",414.02,414.021,.01,0)
DATE/TIME RR DELETED^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",414.02,414.021,.01,1,0)
^.1
"^DD",414.02,414.021,.01,1,1,0)
414.021^B
"^DD",414.02,414.021,.01,1,1,1)
S ^PRCV(414.02,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",414.02,414.021,.01,1,1,2)
K ^PRCV(414.02,DA(1),1,"B",$E(X,1,30),DA)
"^DD",414.02,414.021,.01,3)
A Date/Time when Receiving Report was deleted.
"^DD",414.02,414.021,.01,21,0)
^^2^2^3050301^
"^DD",414.02,414.021,.01,21,1,0)
This field refers to the date and time stamp when a certain Receiving
"^DD",414.02,414.021,.01,21,2,0)
Report(or Partial) was deleted in IFCAP.
"^DD",414.02,414.021,.01,23,0)
^^1^1^3050223^
"^DD",414.02,414.021,.01,23,1,0)
This date should be in FileMan internal format.
"^DD",414.02,414.021,.01,"DT")
3050301
"^DD",414.02,414.021,1,0)
RR DELETED BY^P200'^VA(200,^0;2^Q
"^DD",414.02,414.021,1,3)
This field identifies the person who deleted a Receiving Report.
"^DD",414.02,414.021,1,"DT")
3050531
"^DD",414.02,414.021,2,0)
DATE/TIME RR CREATED^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",414.02,414.021,2,3)
A Date/Time when this Receiving Report was created.
"^DD",414.02,414.021,2,21,0)
^^1^1^3050301^^
"^DD",414.02,414.021,2,21,1,0)
A date and time stamp when this Receiving Report was created in IFCAP.
"^DD",414.02,414.021,2,23,0)
^^1^1^3050301^^
"^DD",414.02,414.021,2,23,1,0)
It should be in FileMan internal format.
"^DD",414.02,414.021,2,"DT")
3050301
"^DD",414.02,414.021,3,0)
QTY RECEIVED^RNJ9,2^^0;4^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."3.N) X
"^DD",414.02,414.021,3,3)
Type a number between 0 and 999999, 2 Decimal Digits
"^DD",414.02,414.021,3,21,0)
^^1^1^3050228^
"^DD",414.02,414.021,3,21,1,0)
A quantity received for an item on a purchase order.
"^DD",414.02,414.021,3,23,0)
^^2^2^3050301^
"^DD",414.02,414.021,3,23,1,0)
In IFCAP a quantity for an item can be entered in decimals.
"^DD",414.02,414.021,3,23,2,0)
(However, in DynaMed quantities will not allowed to be in decimals.)
"^DD",414.02,414.021,3,"DT")
3050301
"^DD",414.02,414.021,4,0)
RR ITEM COST^NJ11,2^^0;5^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."3.N) X
"^DD",414.02,414.021,4,3)
Type a number between 0 and 99999999, 2 Decimal Digits
"^DD",414.02,414.021,4,21,0)
^^1^1^3050228^^
"^DD",414.02,414.021,4,21,1,0)
This is a unit cost of an item.
"^DD",414.02,414.021,4,23,0)
^^1^1^3050228^^^
"^DD",414.02,414.021,4,23,1,0)
It should not be modified by a user.
"^DD",414.02,414.021,4,"DT")
3050228
"^DD",414.02,414.021,5,0)
RR ITEM DISCNT^NJ12,3^^0;6^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."4.N) X
"^DD",414.02,414.021,5,3)
Type a number between 0 and 99999999, 3 Decimal Digits
"^DD",414.02,414.021,5,21,0)
^^1^1^3050223^
"^DD",414.02,414.021,5,21,1,0)
This is a discount on an item.
"^DD",414.02,414.021,5,23,0)
^^1^1^3050223^
"^DD",414.02,414.021,5,23,1,0)
A user should NOT modify.
"^DD",414.02,414.021,5,"DT")
3050223
"^DD",414.03,414.03,0)
FIELD^^10^7
"^DD",414.03,414.03,0,"DDA")
N
"^DD",414.03,414.03,0,"DT")
3050315
"^DD",414.03,414.03,0,"IX","AC",414.03,.03)

"^DD",414.03,414.03,0,"NM","COTS INVENTORY SUBSCRIPTION CONTROL")

"^DD",414.03,414.03,.01,0)
STATION^P411'^PRC(411,^0;1^Q
"^DD",414.03,414.03,.01,1,0)
^.1^^0
"^DD",414.03,414.03,.01,3)
This must be the station number or 0 if none
"^DD",414.03,414.03,.01,21,0)
^^2^2^3050228^
"^DD",414.03,414.03,.01,21,1,0)
This is the station number associated with the IFCAP object being 
"^DD",414.03,414.03,.01,21,2,0)
moniored. It is required, but may be 0.
"^DD",414.03,414.03,.01,"DT")
3050315
"^DD",414.03,414.03,.02,0)
SUBSCRIPTION^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",414.03,414.03,.02,3)
This is the entity associated with the subscription
"^DD",414.03,414.03,.02,21,0)
^^3^3^3050228^
"^DD",414.03,414.03,.02,21,1,0)
This is the object (e.g., fund control point) being monitored. This field 
"^DD",414.03,414.03,.02,21,2,0)
is an identifying string (required) and field .03 identifies the type of 
"^DD",414.03,414.03,.02,21,3,0)
objct. The format of the string depends on the object type.
"^DD",414.03,414.03,.02,"DT")
3050315
"^DD",414.03,414.03,.03,0)
SUBSCRIPTION TYPE^S^1:FCP Running Balance;^0;3^Q
"^DD",414.03,414.03,.03,1,0)
^.1
"^DD",414.03,414.03,.03,1,1,0)
414.03^AC
"^DD",414.03,414.03,.03,1,1,1)
S ^PRCV(414.03,"AC",$E(X,1,30),DA)=""
"^DD",414.03,414.03,.03,1,1,2)
K ^PRCV(414.03,"AC",$E(X,1,30),DA)
"^DD",414.03,414.03,.03,1,1,"%D",0)
^^1^1^3050228^
"^DD",414.03,414.03,.03,1,1,"%D",1,0)
This cross-reference is used to sort subscriptions by type.
"^DD",414.03,414.03,.03,1,1,"DT")
3050228
"^DD",414.03,414.03,.03,3)
This is the type of entity controlling the subscription
"^DD",414.03,414.03,.03,21,0)
^^4^4^3050228^
"^DD",414.03,414.03,.03,21,1,0)
This field is a code that specifies the subscription type. The 
"^DD",414.03,414.03,.03,21,2,0)
interpretation of field .02 depends on the value of this code. These two 
"^DD",414.03,414.03,.03,21,3,0)
fields are intended to provide support for multiple types of 
"^DD",414.03,414.03,.03,21,4,0)
subscriptions within the one file.
"^DD",414.03,414.03,.03,"DT")
3050315
"^DD",414.03,414.03,1,0)
CREATED^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",414.03,414.03,1,3)
This is the date/time the subscription was created
"^DD",414.03,414.03,1,21,0)
^^1^1^3050310^
"^DD",414.03,414.03,1,21,1,0)
This is the date/time that this subscription was created.
"^DD",414.03,414.03,1,"DT")
3050310
"^DD",414.03,414.03,2,0)
ACTIVE^S^1:YES;0:NO;^0;5^Q
"^DD",414.03,414.03,2,3)
Set to 'NO' to inactivate the subscription
"^DD",414.03,414.03,2,"DT")
3050310
"^DD",414.03,414.03,3,0)
SUBSCRIPTION MID^NJ9,0^^0;6^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",414.03,414.03,3,3)
This is the MID of the subscription request (QSB)
"^DD",414.03,414.03,3,21,0)
^^2^2^3050310^
"^DD",414.03,414.03,3,21,1,0)
This is the message control ID (MID) of the HL7 message requesting that 
"^DD",414.03,414.03,3,21,2,0)
this subscription be created.
"^DD",414.03,414.03,3,"DT")
3050310
"^DD",414.03,414.03,10,0)
ATTRIBUTE SET^414.031^^1;0
"^DD",414.03,414.03,10,21,0)
^^4^4^3050310^
"^DD",414.03,414.03,10,21,1,0)
This subfile is used to store attribute values for the object associated 
"^DD",414.03,414.03,10,21,2,0)
with the subscription. Since the file is designed to work with various 
"^DD",414.03,414.03,10,21,3,0)
types of objects, attributes are stored as simple key/value pairs, where 
"^DD",414.03,414.03,10,21,4,0)
both the key and  value are free text.
"^DD",414.03,414.031,0)
ATTRIBUTE SET SUB-FIELD^^1^2
"^DD",414.03,414.031,0,"DT")
3050214
"^DD",414.03,414.031,0,"IX","B",414.031,.01)

"^DD",414.03,414.031,0,"NM","ATTRIBUTE SET")

"^DD",414.03,414.031,0,"UP")
414.03
"^DD",414.03,414.031,.01,0)
FISCAL YEAR^F^^0;1^K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",414.03,414.031,.01,1,0)
^.1
"^DD",414.03,414.031,.01,1,1,0)
414.031^B
"^DD",414.03,414.031,.01,1,1,1)
S ^PRCV(414.03,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",414.03,414.031,.01,1,1,2)
K ^PRCV(414.03,DA(1),1,"B",$E(X,1,30),DA)
"^DD",414.03,414.031,.01,3)
Enter the 2 digit fiscal year
"^DD",414.03,414.031,.01,21,0)
^^3^3^3050310^
"^DD",414.03,414.031,.01,21,1,0)
Financial applications frequently need to assign a fiscal year to an 
"^DD",414.03,414.031,.01,21,2,0)
object itself. Accordingly, the fiscal year is stored here in an optional 
"^DD",414.03,414.031,.01,21,3,0)
field. Applications not needing this field can leave it blank.
"^DD",414.03,414.031,.01,"DT")
3050310
"^DD",414.03,414.031,1,0)
ATTRIBUTE^414.0311^^1;0
"^DD",414.03,414.031,1,"DT")
3050214
"^DD",414.03,414.0311,0)
ATTRIBUTE SUB-FIELD^^1^2
"^DD",414.03,414.0311,0,"DT")
3050214
"^DD",414.03,414.0311,0,"IX","B",414.0311,.01)

"^DD",414.03,414.0311,0,"NM","ATTRIBUTE")

"^DD",414.03,414.0311,0,"UP")
414.031
"^DD",414.03,414.0311,.01,0)
ATTRIBUTE^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1.N) X
"^DD",414.03,414.0311,.01,1,0)
^.1
"^DD",414.03,414.0311,.01,1,1,0)
414.0311^B
"^DD",414.03,414.0311,.01,1,1,1)
S ^PRCV(414.03,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",414.03,414.0311,.01,1,1,2)
K ^PRCV(414.03,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",414.03,414.0311,.01,3)
Enter a numeric attribute key (0 decimal digits)
"^DD",414.03,414.0311,.01,"DT")
3050214
"^DD",414.03,414.0311,1,0)
VALUE^F^^0;2^K:$L(X)>45!($L(X)<1) X
"^DD",414.03,414.0311,1,3)
Answer must be 1-45 characters in length
"^DD",414.03,414.0311,1,"DT")
3050214
"^DD",414.04,414.04,0)
FIELD^^1^4
"^DD",414.04,414.04,0,"DDA")
N
"^DD",414.04,414.04,0,"DT")
3050329
"^DD",414.04,414.04,0,"IX","D",414.04,.01)

"^DD",414.04,414.04,0,"NM","RECORD CHECKSUM")

"^DD",414.04,414.04,.01,0)
CHECKSUM NAME^RFX^^0;1^K:(($L(X)<1)!($L(X)>10)) X
"^DD",414.04,414.04,.01,.1)
Checksum Name for your application
"^DD",414.04,414.04,.01,1,0)
^.1^^-1
"^DD",414.04,414.04,.01,1,1,0)
414.04^D
"^DD",414.04,414.04,.01,1,1,1)
S ^PRCV(414.04,"D",$E(X,1,30),DA)=""
"^DD",414.04,414.04,.01,1,1,2)
K ^PRCV(414.04,"D",$E(X,1,30),DA)
"^DD",414.04,414.04,.01,1,1,"DT")
3050331
"^DD",414.04,414.04,.01,3)
Enter checksum name for your application
"^DD",414.04,414.04,.01,21,0)
^^4^4^3050401^
"^DD",414.04,414.04,.01,21,1,0)
Checksum name for your specific application. We could define different 
"^DD",414.04,414.04,.01,21,2,0)
checksum name for same file number used in different application.
"^DD",414.04,414.04,.01,21,3,0)
For example, file 440 could have two checksum name, "VND1" and "VND2", to 
"^DD",414.04,414.04,.01,21,4,0)
store checksum for different applications.
"^DD",414.04,414.04,.01,"DT")
3050401
"^DD",414.04,414.04,.02,0)
FILE NUMBER^RNJ8,3^^0;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."4N.N) X
"^DD",414.04,414.04,.02,.1)
File Number
"^DD",414.04,414.04,.02,3)
Type a Number between 0 and 9999, 3 Decimal Digits
"^DD",414.04,414.04,.02,21,0)
^.001^1^1^3050329^^
"^DD",414.04,414.04,.02,21,1,0)
This is the number of the file we will perform checksum with.
"^DD",414.04,414.04,.02,"DT")
3050329
"^DD",414.04,414.04,.03,0)
DESCRIPTION^RF^^0;3^K:$L(X)>50!($L(X)<1) X
"^DD",414.04,414.04,.03,.1)
CHECKSUM DESCRIPTION
"^DD",414.04,414.04,.03,3)
Enter description/purpose of this checksum.
"^DD",414.04,414.04,.03,21,0)
^^1^1^3050329^
"^DD",414.04,414.04,.03,21,1,0)
Enter the description or purpose of this checksum.
"^DD",414.04,414.04,.03,"DT")
3050329
"^DD",414.04,414.04,1,0)
RECORD NUMBER^414.41^^1;0
"^DD",414.04,414.41,0)
RECORD NUMBER SUB-FIELD^^4^5
"^DD",414.04,414.41,0,"DT")
3050329
"^DD",414.04,414.41,0,"NM","RECORD NUMBER")

"^DD",414.04,414.41,0,"UP")
414.04
"^DD",414.04,414.41,.01,0)
RECORD NUMBER^RNJ6,0^^0;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",414.04,414.41,.01,1,0)
^.1^^0
"^DD",414.04,414.41,.01,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",414.04,414.41,.01,21,0)
^^1^1^3050329^
"^DD",414.04,414.41,.01,21,1,0)
Enter record number (or the IEN) of the file being performed checksum.
"^DD",414.04,414.41,.01,"DT")
3050331
"^DD",414.04,414.41,1,0)
CHECKSUM^NJ14,0^^0;2^K:+X'=X!(X>99999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",414.04,414.41,1,3)
Checksum will be generated
"^DD",414.04,414.41,1,"DT")
3050329
"^DD",414.04,414.41,2,0)
TIME OF CHECKSUM^D^^0;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",414.04,414.41,2,"DT")
3050329
"^DD",414.04,414.41,3,0)
UPDATE SENT^S^1:SENT;0:NOT SENT;^0;4^Q
"^DD",414.04,414.41,3,"DT")
3050329
"^DD",414.04,414.41,4,0)
TIME SENT^D^^0;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",414.04,414.41,4,"DT")
3050329
"^DD",441,441,.01,0)
NUMBER^RNJ6,0X^^0;1^D TRANS^PRCVITMU I $D(X) S DINUM=X
"^DD",441,441,.01,1,0)
^.1^^-1
"^DD",441,441,.01,1,1,0)
441^B
"^DD",441,441,.01,1,1,1)
S ^PRC(441,"B",$E(X,1,30),DA)=""
"^DD",441,441,.01,1,1,2)
K ^PRC(441,"B",$E(X,1,30),DA)
"^DD",441,441,.01,3)
Enter 'NEW' if you want the next available number
"^DD",441,441,.01,21,0)
^.001^1^1^3041130^^
"^DD",441,441,.01,21,1,0)
This is the item number.
"^DD",441,441,.01,"DT")
3050419
"^DD",442,442,40,0)
ITEM^442.01IA^^2;0
"^DD",442,442,40,21,0)
^.001^1^1^3050209^^^^
"^DD",442,442,40,21,1,0)
This is the name of the item on this purchase request.
"^DD",442,442,40,"DT")
2961114
"^DD",442,442.01,0)
ITEM SUB-FIELD^NL^48^53
"^DD",442,442.01,0,"NM","ITEM")

"^DD",442,442.01,.01,0)
LINE ITEM NUMBER^MRNJ2,0X^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",442,442.01,.01,.1)

"^DD",442,442.01,.01,1,0)
^.1^^-1
"^DD",442,442.01,.01,1,1,0)
^^TRIGGER^442^15
"^DD",442,442.01,.01,1,1,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA S Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,14) S DIU=X K Y X ^DD(442.01,.01,1,1,1.1) X ^DD(442.01,.01,1,1,1.4)
"^DD",442,442.01,.01,1,1,1.1)
S X=DIV S Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,14)+1
"^DD",442,442.01,.01,1,1,1.4)
S DIH=$S($D(^PRC(442,DIV(0),0)):^(0),1:""),DIV=X X "F %=0:0 Q:$L($P(DIH,U,13,99))  S DIH=DIH_U" S %=$P(DIH,U,15,999),DIU=$P(DIH,U,14),^(0)=$P(DIH,U,1,13)_U_DIV_$S(%]"":U_%,1:""),DIH=442,DIG=15 D ^DICR:$N(^DD(DIH,DIG,1,0))>0
"^DD",442,442.01,.01,1,1,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA S Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,14) S DIU=X K Y X ^DD(442.01,.01,1,1,2.1) X ^DD(442.01,.01,1,1,2.4)
"^DD",442,442.01,.01,1,1,2.1)
S X=DIV S Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,14)-1
"^DD",442,442.01,.01,1,1,2.4)
S DIH=$S($D(^PRC(442,DIV(0),0)):^(0),1:""),DIV=X X "F %=0:0 Q:$L($P(DIH,U,13,99))  S DIH=DIH_U" S %=$P(DIH,U,15,999),DIU=$P(DIH,U,14),^(0)=$P(DIH,U,1,13)_U_DIV_$S(%]"":U_%,1:""),DIH=442,DIG=15 D ^DICR:$N(^DD(DIH,DIG,1,0))>0
"^DD",442,442.01,.01,1,1,"CREATE VALUE")
lineItem+1
"^DD",442,442.01,.01,1,1,"DELETE VALUE")
lineItem-1
"^DD",442,442.01,.01,1,1,"FIELD")
lineItem Count
"^DD",442,442.01,.01,1,2,0)
442.01^B
"^DD",442,442.01,.01,1,2,1)
S ^PRC(442,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",442,442.01,.01,1,2,2)
K ^PRC(442,DA(1),2,"B",$E(X,1,30),DA)
"^DD",442,442.01,.01,1,3,0)
442.01^C^MUMPS
"^DD",442,442.01,.01,1,3,1)
I ('$D(^PRC(442,DA(1),2,DA,2)))!($P(^(0),"^",2)>$S($D(^(2)):$P(^(2),"^",8),1:0)) S ^PRC(442,DA(1),2,"C",X,DA)=""
"^DD",442,442.01,.01,1,3,2)
K ^PRC(442,DA(1),2,"C",X,DA)
"^DD",442,442.01,.01,1,3,"%D",0)
^.101^6^6^3050120^^^^
"^DD",442,442.01,.01,1,3,"%D",1,0)
This X-REF is used to control receipt of items by setting this "C" X-REF
"^DD",442,442.01,.01,1,3,"%D",2,0)
when the QUANTITY field value is more than the QUANTITY PREVIOUSLY
"^DD",442,442.01,.01,1,3,"%D",3,0)
RECEIVED field value.  When this X-REF is used, only those LINE ITEM
"^DD",442,442.01,.01,1,3,"%D",4,0)
NUMBERs that have outstanding due-ins will be able to be selected.
"^DD",442,442.01,.01,1,3,"%D",5,0)
 
"^DD",442,442.01,.01,1,3,"%D",6,0)
The KILL section will just remove this X-REF.
"^DD",442,442.01,.01,1,3,"DT")
3050120
"^DD",442,442.01,.01,1,4,0)
442.01^AZAPSCH^MUMPS
"^DD",442,442.01,.01,1,4,1)
Q
"^DD",442,442.01,.01,1,4,2)
N DAA,DS,DIK,PR S DAA=DA N DA S PR=$G(PRCHPONO,$P(^PRC(442,D0,0),U)),DS="",DIK="^PRC(442.8," F  S DS=$O(^PRC(442.8,"AC",PR,DAA,DS)) Q:DS=""  S DA=DS D ^DIK
"^DD",442,442.01,.01,1,4,"%D",0)
^^2^2^2970207^^^^
"^DD",442,442.01,.01,1,4,"%D",1,0)
To delete entries in file 442.8 that correspond to an item in field #40
"^DD",442,442.01,.01,1,4,"%D",2,0)
in file #442 that is being deleted.
"^DD",442,442.01,.01,1,4,"DT")
2960306
"^DD",442,442.01,.01,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 999
"^DD",442,442.01,.01,21,0)
^^1^1^2971203^^^^
"^DD",442,442.01,.01,21,1,0)
This is the number of the line item.
"^DD",442,442.01,.01,"DT")
3050304
"^DD",442,442.01,48,0)
DM DOC ID^FI^^2;15^K:$L(X)>16!($L(X)<9) X
"^DD",442,442.01,48,3)
Answer must be 9-16 characters in length.
"^DD",442,442.01,48,10)
DynaMed - Information Control
"^DD",442,442.01,48,21,0)
^^7^7^3050606^
"^DD",442,442.01,48,21,1,0)
This is a unique number associated with each item ordered by DynaMed.  It
"^DD",442,442.01,48,21,2,0)
is formatted as YDDD-NNNN-CCCCCC where:
"^DD",442,442.01,48,21,3,0)
 
"^DD",442,442.01,48,21,4,0)
             Y is the single digit for year,  
"^DD",442,442.01,48,21,5,0)
           DDD is the 3 digit Julian date, a dash,
"^DD",442,442.01,48,21,6,0)
          NNNN is the 4 digit sequential number and a dash 
"^DD",442,442.01,48,21,7,0)
        CCCCCC represents up to 6 characters for the stockroom.
"^DD",442,442.01,48,23,0)
^.001^4^4^3050606^^^
"^DD",442,442.01,48,23,1,0)
The DM DOC ID is associated with an order request from DynaMed for 
"^DD",442,442.01,48,23,2,0)
replenishing a stockroom with of an item defined in the ITEM MASTER FILE
"^DD",442,442.01,48,23,3,0)
(#440).  The DM DOC ID must be included in all messages updating DynaMed 
"^DD",442,442.01,48,23,4,0)
on the progress of their order request.
"^DD",442,442.01,48,"DT")
3050304
"^DIC",414.02,414.02,0)
DYNAMED IFCAP INTERFACE AUDIT^414.02
"^DIC",414.02,414.02,0,"GL")
^PRCV(414.02,
"^DIC",414.02,414.02,"%",0)
^1.005^^0
"^DIC",414.02,414.02,"%D",0)
^1.001^6^6^3050608^^
"^DIC",414.02,414.02,"%D",1,0)
This file retains data that is normally deleted from IFCAP files.  The
"^DIC",414.02,414.02,"%D",2,0)
data held in this file will be retained for a brief period of time (TBD)
"^DIC",414.02,414.02,"%D",3,0)
and purged after this retention period.
"^DIC",414.02,414.02,"%D",4,0)
 
"^DIC",414.02,414.02,"%D",5,0)
It holds data that is specifically related to interface of IFCAP package
"^DIC",414.02,414.02,"%D",6,0)
to DynaMed (an outside entity).
"^DIC",414.02,"B","DYNAMED IFCAP INTERFACE AUDIT",414.02)

"^DIC",414.03,414.03,0)
COTS INVENTORY SUBSCRIPTION CONTROL^414.03
"^DIC",414.03,414.03,0,"GL")
^PRCV(414.03,
"^DIC",414.03,414.03,"%",0)
^1.005^^0
"^DIC",414.03,414.03,"%D",0)
^^6^6^3050214^^^
"^DIC",414.03,414.03,"%D",1,0)
In the event that an external system needs to be notified when an event 
"^DIC",414.03,414.03,"%D",2,0)
of some type occurs, a publish/subscribe interface allows messages to be 
"^DIC",414.03,414.03,"%D",3,0)
sent to that system when the event occurs. This file contains a list of 
"^DIC",414.03,414.03,"%D",4,0)
active subscriptions, and records are added or deleted in response to 
"^DIC",414.03,414.03,"%D",5,0)
"subscribe" or "cancel" messages received from the external system. More 
"^DIC",414.03,414.03,"%D",6,0)
than one type of subscription is supported.
"^DIC",414.03,"B","COTS INVENTORY SUBSCRIPTION CONTROL",414.03)

"^DIC",414.04,414.04,0)
RECORD CHECKSUM^414.04
"^DIC",414.04,414.04,0,"GL")
^PRCV(414.04,
"^DIC",414.04,414.04,"%",0)
^1.005^^0
"^DIC",414.04,414.04,"%D",0)
^^5^5^3050308^
"^DIC",414.04,414.04,"%D",1,0)
This file is use to store checksums associated with objects such as file 
"^DIC",414.04,414.04,"%D",2,0)
records. The reason for this level of generality is that it is at times 
"^DIC",414.04,414.04,"%D",3,0)
convenient to associated a checksum with a subset of fields in a file (or 
"^DIC",414.04,414.04,"%D",4,0)
possibly other objects). This means it may be necessary to support more 
"^DIC",414.04,414.04,"%D",5,0)
than one checksum on the same file or other type of object class.
"^DIC",414.04,"B","RECORD CHECKSUM",414.04)

**END**
**END**
