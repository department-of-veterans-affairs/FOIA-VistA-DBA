Released PSO*7*165 SEQ #175
Extracted from mail message
**KIDS**:PSO*7.0*165^

**INSTALL NAME**
PSO*7.0*165
"BLD",4725,0)
PSO*7.0*165^OUTPATIENT PHARMACY^0^3041029^y
"BLD",4725,1,0)
^^13^13^3041029^
"BLD",4725,1,1,0)
This supported #1878 has been updated to include new data elements at the
"BLD",4725,1,2,0)
request of Pharmacy Benefit Management (PBM).  See DBIA #1878 for
"BLD",4725,1,3,0)
complete description.
"BLD",4725,1,4,0)
 
"BLD",4725,1,5,0)
The follow data elements from the Prescription file (#52) were added.
"BLD",4725,1,6,0)
 NDC (original, refill, partial)
"BLD",4725,1,7,0)
 LOGIN DATE (original, refill, partial)
"BLD",4725,1,8,0)
 TPB RX
"BLD",4725,1,9,0)
 EXPANDED PATIENT INSTRUCTIONS 
"BLD",4725,1,10,0)
 FINISHING PERSON
"BLD",4725,1,11,0)
 MEDICATION INSTRUCTION sub-file fields:
"BLD",4725,1,12,0)
 DOSAGE INSTRUCTION, DISPENSE UNITS PER DOSE, UNITS, NOUN, 
"BLD",4725,1,13,0)
 DURATION, CONJUNCTION, ROUTE, SCHEDULE, VERB
"BLD",4725,4,0)
^9.64PA^^
"BLD",4725,"KRN",0)
^9.67PA^8989.52^19
"BLD",4725,"KRN",.4,0)
.4
"BLD",4725,"KRN",.401,0)
.401
"BLD",4725,"KRN",.402,0)
.402
"BLD",4725,"KRN",.403,0)
.403
"BLD",4725,"KRN",.5,0)
.5
"BLD",4725,"KRN",.84,0)
.84
"BLD",4725,"KRN",3.6,0)
3.6
"BLD",4725,"KRN",3.8,0)
3.8
"BLD",4725,"KRN",9.2,0)
9.2
"BLD",4725,"KRN",9.8,0)
9.8
"BLD",4725,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4725,"KRN",9.8,"NM",1,0)
PSOORDER^^0^B68319447
"BLD",4725,"KRN",9.8,"NM","B","PSOORDER",1)

"BLD",4725,"KRN",19,0)
19
"BLD",4725,"KRN",19.1,0)
19.1
"BLD",4725,"KRN",101,0)
101
"BLD",4725,"KRN",409.61,0)
409.61
"BLD",4725,"KRN",771,0)
771
"BLD",4725,"KRN",870,0)
870
"BLD",4725,"KRN",8989.51,0)
8989.51
"BLD",4725,"KRN",8989.52,0)
8989.52
"BLD",4725,"KRN",8994,0)
8994
"BLD",4725,"KRN","B",.4,.4)

"BLD",4725,"KRN","B",.401,.401)

"BLD",4725,"KRN","B",.402,.402)

"BLD",4725,"KRN","B",.403,.403)

"BLD",4725,"KRN","B",.5,.5)

"BLD",4725,"KRN","B",.84,.84)

"BLD",4725,"KRN","B",3.6,3.6)

"BLD",4725,"KRN","B",3.8,3.8)

"BLD",4725,"KRN","B",9.2,9.2)

"BLD",4725,"KRN","B",9.8,9.8)

"BLD",4725,"KRN","B",19,19)

"BLD",4725,"KRN","B",19.1,19.1)

"BLD",4725,"KRN","B",101,101)

"BLD",4725,"KRN","B",409.61,409.61)

"BLD",4725,"KRN","B",771,771)

"BLD",4725,"KRN","B",870,870)

"BLD",4725,"KRN","B",8989.51,8989.51)

"BLD",4725,"KRN","B",8989.52,8989.52)

"BLD",4725,"KRN","B",8994,8994)

"BLD",4725,"QUES",0)
^9.62^^
"BLD",4725,"REQB",0)
^9.611^1^1
"BLD",4725,"REQB",1,0)
PSO*7.0*103^2
"BLD",4725,"REQB","B","PSO*7.0*103",1)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
165^3041029^5
"PKG",141,22,1,"PAH",1,1,0)
^^13^13^3041029
"PKG",141,22,1,"PAH",1,1,1,0)
This supported #1878 has been updated to include new data elements at the
"PKG",141,22,1,"PAH",1,1,2,0)
request of Pharmacy Benefit Management (PBM).  See DBIA #1878 for
"PKG",141,22,1,"PAH",1,1,3,0)
complete description.
"PKG",141,22,1,"PAH",1,1,4,0)
 
"PKG",141,22,1,"PAH",1,1,5,0)
The follow data elements from the Prescription file (#52) were added.
"PKG",141,22,1,"PAH",1,1,6,0)
 NDC (original, refill, partial)
"PKG",141,22,1,"PAH",1,1,7,0)
 LOGIN DATE (original, refill, partial)
"PKG",141,22,1,"PAH",1,1,8,0)
 TPB RX
"PKG",141,22,1,"PAH",1,1,9,0)
 EXPANDED PATIENT INSTRUCTIONS 
"PKG",141,22,1,"PAH",1,1,10,0)
 FINISHING PERSON
"PKG",141,22,1,"PAH",1,1,11,0)
 MEDICATION INSTRUCTION sub-file fields:
"PKG",141,22,1,"PAH",1,1,12,0)
 DOSAGE INSTRUCTION, DISPENSE UNITS PER DOSE, UNITS, NOUN, 
"PKG",141,22,1,"PAH",1,1,13,0)
 DURATION, CONJUNCTION, ROUTE, SCHEDULE, VERB
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOORDER")
0^1^B68319447
"RTN","PSOORDER",1,0)
PSOORDER ;BHAM ISC/SAB- utility routine to return Rx data ; 04/09/96 10:30 am
"RTN","PSOORDER",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,20,9,46,103,165**;DEC 1997
"RTN","PSOORDER",3,0)
 ;^PS(55 supported by DBIA 2228
"RTN","PSOORDER",4,0)
 ;^PSDRUG supported by DBIA 221
"RTN","PSOORDER",5,0)
 ;^VA(200 supported by DBIA 10060
"RTN","PSOORDER",6,0)
 ;^SC supported by DBIA 10040
"RTN","PSOORDER",7,0)
 ;^DPT supported by DBIA 10035
"RTN","PSOORDER",8,0)
 ;^PSNAPIS supported by DBIA 2531
"RTN","PSOORDER",9,0)
 ;^PSNDF supported by DBIA 2195
"RTN","PSOORDER",10,0)
 ;^PS(50.7 supported by DBIA 2223
"RTN","PSOORDER",11,0)
 ;^PS(50.606 supported by DBIA 2174
"RTN","PSOORDER",12,0)
 ;^PS(51.2 supported by DBIA 2226
"RTN","PSOORDER",13,0)
 ;^PS(50.607 supported by DBIA 2221
"RTN","PSOORDER",14,0)
 ;
"RTN","PSOORDER",15,0)
 ;for full break down of data returned see DBIA #1878
"RTN","PSOORDER",16,0)
 ;
"RTN","PSOORDER",17,0)
EN(DFN,RX) ;
"RTN","PSOORDER",18,0)
 K ^TMP("PSOR",$J)
"RTN","PSOORDER",19,0)
 N SIG,SG,IEN,CMOP,CMIN,CMIND,HDST,I,LSFD,PSO2,PSOCF,PSOCST,PSODR,PSODT,PSOLFD,PSOFD,PSOID,PSOJ,PSOPR,PSOPLCL,PSOPLPR,PSOREF,PSORF,PSORFCL,PSORFPR,PSOST,PSOX,RX0,RX0,RX1,RX3,RX3,RXH,RXP,ST0,SUS,FPN
"RTN","PSOORDER",20,0)
 Q:'$D(^PSRX(RX,0))!('$D(^PSRX(RX,2)))!('$D(^PSRX(RX,3)))!($G(^PSRX(RX,"STA"))=13)
"RTN","PSOORDER",21,0)
 I $G(DFN)'="",$P($G(^PSRX(RX,0)),"^",2)'=$G(DFN) Q
"RTN","PSOORDER",22,0)
 I '$G(DFN) S DFN=+$P($G(^PSRX(RX,0)),"^",2)
"RTN","PSOORDER",23,0)
 K PSOLOUD D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORDER",24,0)
 S:$G(^PSRX(RX,"IB"))]"" ^TMP("PSOR",$J,RX,"IB")=$P(^PSRX(RX,"IB"),"^",1,2)
"RTN","PSOORDER",25,0)
 S RX0=^PSRX(RX,0),RX2=^(2),RX3=^(3),RXH=$G(^("H")),PSORF=$P(RX0,"^",9),LSFD=$P(RX2,"^",2),ST0=$P($G(^("STA")),"^"),OERR=$G(^("OR1")) D
"RTN","PSOORDER",26,0)
 .F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I $D(^PSRX(RX,1,I,0)) S RX1(I)=^PSRX(RX,1,I,0),PSORF=PSORF-1,LSFD=+RX1(I),PSOCST=$P(RX1(I),"^",4)*+$P(RX1(I),"^",11) D
"RTN","PSOORDER",27,0)
 ..S PSORFPR=$P(RX0,"^",4) I PSORFPR S PSORFPR=PSORFPR_";"_$P($G(^VA(200,PSORFPR,0)),"^")
"RTN","PSOORDER",28,0)
 ..S PSORFCL=$P(RX1(I),"^",7) I PSORFCL S PSORFCL=PSORFCL_";"_$P($G(^VA(200,PSORFCL,0)),"^")
"RTN","PSOORDER",29,0)
 ..S ^TMP("PSOR",$J,RX,"REF",I,0)=+RX1(I)_"^"_$G(PSORFPR)_"^"_$G(PSORFCL)_"^"_$P(RX1(I),"^",4)_"^"_+$P(RX1(I),"^",10)_"^"_+$P(RX1(I),"^",11)_"^"
"RTN","PSOORDER",30,0)
 ..S ^TMP("PSOR",$J,RX,"REF",I,0)=^TMP("PSOR",$J,RX,"REF",I,0)_PSOCST_"^"_$P(RX1(I),"^",18)_"^"_$P(RX1(I),"^",16)_"^"
"RTN","PSOORDER",31,0)
 ..S ^TMP("PSOR",$J,RX,"REF",I,0)=^TMP("PSOR",$J,RX,"REF",I,0)_$S($P(RX1(I),"^",2)="M":"M;MAIL",1:"W;WINDOW")_"^"_$P(RX1(I),"^",9)_"^"_$P(RX1(I),"^",8)_"^"_$P($G(^PSRX(RX,1,I,1)),"^",3)
"RTN","PSOORDER",32,0)
 .F I=0:0 S I=$O(^PSRX(RX,"P",I)) Q:'I  I $D(^PSRX(RX,"P",I,0)) S RXP(I)=^PSRX(RX,"P",I,0) D
"RTN","PSOORDER",33,0)
 ..S PSOCST=$P(RXP(I),"^",4)*+$P(RXP(I),"^",11)
"RTN","PSOORDER",34,0)
 ..S PSOPLPR=$P(RX0,"^",4) I PSOPLPR S PSOPLPR=PSOPLPR_";"_$P($G(^VA(200,PSOPLPR,0)),"^")
"RTN","PSOORDER",35,0)
 ..S PSOPLCL=$P(RXP(I),"^",7) I PSOPLCL S PSOPLCL=PSOPLCL_";"_$P($G(^VA(200,PSOPLCL,0)),"^")
"RTN","PSOORDER",36,0)
 ..S ^TMP("PSOR",$J,RX,"RPAR",I,0)=+RXP(I)_"^"_$G(PSOPLPR)_"^"_$G(PSOPLCL)_"^"_$P(RXP(I),"^",4)_"^"_+$P(RXP(I),"^",10)_"^"
"RTN","PSOORDER",37,0)
 ..S ^TMP("PSOR",$J,RX,"RPAR",I,0)=^TMP("PSOR",$J,RX,"RPAR",I,0)_+$P(RXP(I),"^",11)_"^"_PSOCST_"^"_$P(RXP(I),"^",19)_"^"_$P(RXP(I),"^",16)_"^"
"RTN","PSOORDER",38,0)
 ..S ^TMP("PSOR",$J,RX,"RPAR",I,0)=^TMP("PSOR",$J,RX,"RPAR",I,0)_$S($P(RXP(I),"^",2)="M":"M;MAIL",1:"W;WINDOW")_"^"_$P(RXP(I),"^",9)_"^"_$P(RXP(I),"^",8)_"^"_$P(RXP(I),"^",12)
"RTN","PSOORDER",39,0)
 .S MI=0 F I=0:0 S I=$O(^PSRX(RX,6,I)) Q:'I  S RP(I)=^PSRX(RX,6,I,0) D
"RTN","PSOORDER",40,0)
 ..S UN=$P(RP(I),"^",3) I UN S PSOX=$G(^PS(50.607,UN,0)) S UN=UN_";"_$P(PSOX,"^")
"RTN","PSOORDER",41,0)
 ..S RT=$P(RP(I),"^",7) I RT S PSOX=$G(^PS(51.2,RT,0)) S RT=RT_";"_$P(PSOX,"^")
"RTN","PSOORDER",42,0)
 ..S MI=MI+1,^TMP("PSOR",$J,RX,"MI",MI,0)=$P(RP(I),"^")_"^"_$P(RP(I),"^",2)_"^"_UN_"^"_$P(RP(I),"^",4)_"^"_$P(RP(I),"^",5)_"^"_$P(RP(I),"^",6)_"^"_RT_"^"_$P(RP(I),"^",8)_"^"_$P(RP(I),"^",9)
"RTN","PSOORDER",43,0)
 .F I=0:0 S I=$O(^PSRX(RX,"INS1",I)) Q:'I  S ^TMP("PSOR",$J,RX,"PI",I,0)=^PSRX(RX,"INS1",I,0)
"RTN","PSOORDER",44,0)
 K MI,RP,PSOX,UN,RT
"RTN","PSOORDER",45,0)
 S PSOLFD=+$G(RX3),PSODR=+$P(RX0,"^",6),PSOPR=$P(RX0,"^",4),PSOREF=$P(RX0,"^",9),PSOID=$P(RX0,"^",13),PSOST=$P($G(^PSRX(RX,"STA")),"^"),PSODT=$P(RX2,"^",6)
"RTN","PSOORDER",46,0)
 D ODT S PSOFD=$P(RX2,"^",2),PSOX=$S($D(^PSDRUG(PSODR,0)):$P(^(0),"^"),1:"NOT ON FILE"),PSODR=PSODR_";"_PSOX
"RTN","PSOORDER",47,0)
 S PSOPR=$P(RX0,"^",4) I PSOPR S PSOX=$G(^VA(200,PSOPR,0)) S PSOPR=PSOPR_";"_$P(PSOX,"^")
"RTN","PSOORDER",48,0)
 S CLK=$P(RX0,"^",16) I CLK S PSOX=$G(^VA(200,CLK,0)) S CLK=CLK_";"_$P(PSOX,"^")
"RTN","PSOORDER",49,0)
 S VPR=$P(RX2,"^",10) I VPR S PSOX=$G(^VA(200,VPR,0)) S VPR=VPR_";"_$P(PSOX,"^")
"RTN","PSOORDER",50,0)
 S FPN=$P(OERR,"^",5) I FPN S PSOX=$G(^VA(200,FPN,0)) S FPN=FPN_";"_$P(PSOX,"^")
"RTN","PSOORDER",51,0)
 S CLN=$P(RX0,"^",5) I CLN S PSOX=$G(^SC(CLN,0)) S CLN=CLN_";"_$P(PSOX,"^")
"RTN","PSOORDER",52,0)
 S RXP=$P(RX0,"^",3)_";"_$P($G(^PS(53,+$P(RX0,"^",3),0)),"^")
"RTN","PSOORDER",53,0)
 S MW=$S($P(RX0,"^",11)="W":"W;WINDOW",1:"M;MAIL")
"RTN","PSOORDER",54,0)
 S PSOX="A;ACTIVE" S:$D(^PS(52.4,RX,0)) PSOX="N;NON-VERIFIED" S:$O(^PS(52.5,"B",RX,0))&($G(^PS(52.5,+$O(^PS(52.5,"B",RX,0)),"P"))'=1) PSOX="S;SUSPENDED"
"RTN","PSOORDER",55,0)
 I ST0<12,$P(RX2,"^",6)<DT S ST0=11
"RTN","PSOORDER",56,0)
 S PSOX=$P("Error^A;Active^N;Non-Verified^R;Refill^H;Hold^N;Non-Verified^S;Suspended^^^^^D;Done^E;Expired^DC;Discontinued^D;Deleted^DC;Discontinued^DC;Discontinued (Edit)^H;Provider Hold^","^",ST0+2)
"RTN","PSOORDER",57,0)
 D:PSOX="H;Hold"
"RTN","PSOORDER",58,0)
 .S RXH=$G(^PSRX(RX,"H"))
"RTN","PSOORDER",59,0)
 .S HDST=$S(+RXH=1:"Insufficient QTY in Stock",+RXH=2:"Drug Interaction",+RXH=3:"Patient Reaction",+RXH=4:"Physician to be Contacted",+RXH=5:"Allergy Reactions",+RXH=6:"Drug Reaction",1:"Other--See Comments")
"RTN","PSOORDER",60,0)
 .S ^TMP("PSOR",$J,RX,"HOLD",0)=HDST_"^"_$P(RXH,"^",2)_"^"_$P(RXH,"^",3)
"RTN","PSOORDER",61,0)
 S PSOCF=+$P(RX0,"^",17)*(+$P(RX0,"^",7)) ;cost of original fill;
"RTN","PSOORDER",62,0)
 S ^TMP("PSOR",$J,RX,0)=PSOID_"^"_PSOFD_"^"_PSOLFD_"^"_$G(PSOX)_"^"_$P(RX0,"^")_"^"_$P(RX0,"^",7)_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",9)_"^"_$G(PSORF)_"^"_+$P(RX0,"^",17)_"^"_$G(PSOCF)_"^"_$G(PSODT)_"^"_$P(RX2,"^",13)_"^"_$P(RX2,"^",15)
"RTN","PSOORDER",63,0)
 S ^TMP("PSOR",$J,RX,0)=^TMP("PSOR",$J,RX,0)_"^"_$S($P($G(^PSRX(RX,"PC")),"^"):"Yes",1:"No")_"^"_$G(DFN)_";"_$P($G(^DPT(+$G(DFN),0)),"^")_"^"_$P(RX2,"^")
"RTN","PSOORDER",64,0)
 S ^TMP("PSOR",$J,RX,1)=PSOPR_"^"_CLK_"^"_VPR_"^"_CLN_"^"_RXP_"^"_MW_"^"_$P(RX2,"^",9)_"^"_$P(OERR,"^",2)_"^"_FPN_"^"_$P(RX2,"^",7)_"^"_$P($G(^PSRX(RX,"TPB")),"^")
"RTN","PSOORDER",65,0)
 S ^TMP("PSOR",$J,RX,"DRUG",0)=$G(PSODR)
"RTN","PSOORDER",66,0)
 I +$G(^PSDRUG(+$P(RX0,"^",6),"ND")),+$P($G(^("ND")),"^",3) D
"RTN","PSOORDER",67,0)
 .I $T(^PSNAPIS)]"" S PSOXN=$$PROD2^PSNAPIS($P(^PSDRUG(+$P(RX0,"^",6),"ND"),"^"),$P(^PSDRUG(+$P(RX0,"^",6),"ND"),"^",3)) S ^TMP("PSOR",$J,RX,"DRUG",0)=^TMP("PSOR",$J,RX,"DRUG",0)_"^"_$P($G(PSOXN),"^")_"^"_$P($G(PSOXN),"^",2) D  Q
"RTN","PSOORDER",68,0)
 ..S ^TMP("PSOR",$J,RX,"DRUG",0)=^TMP("PSOR",$J,RX,"DRUG",0)_"^"_$P(^PSDRUG(+$P(RX0,"^",6),0),"^",2) K PSOXN
"RTN","PSOORDER",69,0)
 .S ^TMP("PSOR",$J,RX,"DRUG",0)=^TMP("PSOR",$J,RX,"DRUG",0)_"^"_$P($G(^PSNDF($P(^PSDRUG(+$P(RX0,"^",6),"ND"),"^"),5,+$P(^PSDRUG(+$P(RX0,"^",6),"ND"),"^",3),2)),"^")_"^"_$P($G(^(2)),"^",2)_"^"_$P(^PSDRUG(+$P(RX0,"^",6),0),"^",2)
"RTN","PSOORDER",70,0)
 S ^TMP("PSOR",$J,RX,"DRUGOI",0)=$S(+$P(OERR,"^"):$P(OERR,"^")_";"_$P($G(^PS(50.7,+$P(OERR,"^"),0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"),1:"Not Matched to an Orderable Item")
"RTN","PSOORDER",71,0)
 ;returns activity log
"RTN","PSOORDER",72,0)
 F I=0:0 S I=$O(^PSRX(RX,"A",I)) Q:'I  D
"RTN","PSOORDER",73,0)
 .S ZR=$P(^PSRX(RX,"A",I,0),"^",2),RF=+$P(^(0),"^",4)
"RTN","PSOORDER",74,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL") D
"RTN","PSOORDER",75,0)
 ..S REA=$S(ZR="H":"HOLD",ZR="U":"UNHOLD",ZR="C":"DISCONTINUED",ZR="E":"EDIT",ZR="L":"RENEWED",ZR="P":"PARTIAL",ZR="R":"REINSTATE",ZR="W":"REPRINT REQUEST",ZR="S":"SUSPENDED",ZR="I":"RETURNED TO STOCK",ZR="V":"INTERVENTION",1:0) I REA'=0 Q
"RTN","PSOORDER",76,0)
 ..S REA=$S(ZR="D":"DELETED",ZR="A":"PENDING/DRUG INTERACTION",ZR="B":"PROCESSED",ZR="X":"X-INTERFACE",1:"EDIT")
"RTN","PSOORDER",77,0)
 .S ^TMP("PSOR",$J,RX,"ACT",I,0)=$P(^PSRX(RX,"A",I,0),"^")_"^"_REA_"^"_$S($P(^(0),"^",3):$P(^(0),"^",3)_";"_$P($G(^VA(200,$P(^(0),"^",3),0)),"^"),1:"Unknown")_"^"_RFT_"^"_$P(^PSRX(RX,"A",I,0),"^",5) K REA,ZR,RFT,RF
"RTN","PSOORDER",78,0)
 S SUS=$O(^PS(52.5,"B",RX,0)) I SUS D
"RTN","PSOORDER",79,0)
 .S ^TMP("PSOR",$J,RX,"SUS",0)=$S(+$G(^PS(52.5,SUS,"P")):"Printed",1:"Not Printed")
"RTN","PSOORDER",80,0)
 .I $P($G(^PS(52.5,SUS,0)),"^",7)]"" S CMIN=$P(^PS(52.5,SUS,0),"^",7) D
"RTN","PSOORDER",81,0)
 ..S CMIND=$S(CMIN="Q":"Queued for Transmission",CMIN="X":"Transmission Completed",CMIN="L":"Loading Transmission",1:"Printed Locally"),^TMP("PSOR",$J,RX,"SUS",0)=^TMP("PSOR",$J,RX,"SUS",0)_"^"_CMIND
"RTN","PSOORDER",82,0)
 I '$P($G(^PSRX(RX,"SIG")),"^",2) S ^TMP("PSOR",$J,RX,"SIG",1,0)=$P($G(^PSRX(RX,"SIG")),"^") D  G CMOP
"RTN","PSOORDER",83,0)
 .;expands and save SIG
"RTN","PSOORDER",84,0)
 .S IEN=1,(SIG,X)=$P($G(^PSRX(RX,"SIG")),"^") D:'$G(PSUPSO) SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORDER",85,0)
 .F SG=1:1:$L(SIG) S:$L($G(^TMP("PSOR",$J,RX,"SIG1",IEN,0)))>75 IEN=IEN+1 S:$P(SIG," ",SG)'="" ^TMP("PSOR",$J,RX,"SIG1",IEN,0)=$G(^TMP("PSOR",$J,RX,"SIG1",IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORDER",86,0)
 E  F I=0:0 S I=$O(^PSRX(RX,"SIG1",I)) Q:'I  S ^TMP("PSOR",$J,RX,"SIG",I,0)=$G(^PSRX(RX,"SIG1",I,0)),^TMP("PSOR",$J,RX,"SIG1",I,0)=$G(^(0))
"RTN","PSOORDER",87,0)
CMOP F I=0:0 S I=$O(^PSRX(RX,4,I)) Q:'I  I $D(^PSRX(RX,4,I,0)) S CMOP=^PSRX(RX,4,I,0) D
"RTN","PSOORDER",88,0)
 .S ^TMP("PSOR",$J,RX,"CMOP",I,0)=$P(CMOP,"^")_"^"_$P(CMOP,"^",2)_"^"_$P(CMOP,"^",3)_"^"_$S($P(CMOP,"^",4)=1:"1;Dispensed",$P(CMOP,"^",4)=2:"2;Retransmitted",$P(CMOP,"^",4)=3:"3;Not Dispensed",1:"0;Transmitted")_"^"_$P(CMOP,"^",5)
"RTN","PSOORDER",89,0)
 .S ^TMP("PSOR",$J,RX,"CMOP",I,0)=^TMP("PSOR",$J,RX,"CMOP",I,0)_"^"_$P(CMOP,"^",8)
"RTN","PSOORDER",90,0)
 .S:$P(CMOP,"^",4)=3 ^TMP("PSOR",$J,RX,"CMOP",1,1,0)=$G(^PSRX(RX,4,I,1,0))
"RTN","PSOORDER",91,0)
 K SIG,SG,IEN,CMOP,CMIN,CMIND,HDST,I,LSFD,PSO2,PSOCF,PSOCST,PSODR,PSODT,PSOLFD,PSOFD,PSOID,PSOJ,PSOPR,PSOPLCL,PSOPLPR,PSOREF,PSORF,PSORFCL,PSORFPR,PSOST,PSOX,RX,RX0,RX0,RX1,RX3,RX3,RXH,RXP,ST0,SUS,FPN
"RTN","PSOORDER",92,0)
 Q
"RTN","PSOORDER",93,0)
ODT ;canceled or expiration date
"RTN","PSOORDER",94,0)
 I +PSOST=12!(+PSOST=14)!(+PSOST=15) D
"RTN","PSOORDER",95,0)
 .I $P(^PSRX(RX,3),"^",5) S PSODT=$P(^PSRX(RX,3),"^",5) Q
"RTN","PSOORDER",96,0)
 .F PSOJ=0:0 S PSOJ=$O(^PSRX(RX,"A",PSOJ)) Q:PSOJ'>0  I $P($G(^PSRX(RX,"A",PSOJ,0)),"^")<PSODT,+$P($G(^(0)),"^",2)="C" S PSODT=+$P($G(^(0)),"^")
"RTN","PSOORDER",97,0)
 Q
"VER")
8.0^22.0
**END**
**END**
