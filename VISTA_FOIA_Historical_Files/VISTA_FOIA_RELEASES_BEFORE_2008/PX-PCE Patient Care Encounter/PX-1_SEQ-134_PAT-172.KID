Released PX*1*172 SEQ #134
Extracted from mail message
**KIDS**:PX*1.0*172^

**INSTALL NAME**
PX*1.0*172
"BLD",6505,0)
PX*1.0*172^PCE PATIENT CARE ENCOUNTER^0^3051130^y
"BLD",6505,1,0)
^^1^1^3051129^
"BLD",6505,1,1,0)
Fix problem that allows users to look at their own medical records.
"BLD",6505,4,0)
^9.64PA^^
"BLD",6505,"ABPKG")
n
"BLD",6505,"KRN",0)
^9.67PA^8989.52^19
"BLD",6505,"KRN",.4,0)
.4
"BLD",6505,"KRN",.401,0)
.401
"BLD",6505,"KRN",.402,0)
.402
"BLD",6505,"KRN",.403,0)
.403
"BLD",6505,"KRN",.5,0)
.5
"BLD",6505,"KRN",.84,0)
.84
"BLD",6505,"KRN",3.6,0)
3.6
"BLD",6505,"KRN",3.8,0)
3.8
"BLD",6505,"KRN",9.2,0)
9.2
"BLD",6505,"KRN",9.8,0)
9.8
"BLD",6505,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6505,"KRN",9.8,"NM",1,0)
PXCEAE^^0^B32083294
"BLD",6505,"KRN",9.8,"NM",2,0)
PXCEEXP^^0^B8315485
"BLD",6505,"KRN",9.8,"NM",3,0)
PXCEINTR^^0^B12439731
"BLD",6505,"KRN",9.8,"NM",4,0)
PXCESDAM^^0^B31853082
"BLD",6505,"KRN",9.8,"NM","B","PXCEAE",1)

"BLD",6505,"KRN",9.8,"NM","B","PXCEEXP",2)

"BLD",6505,"KRN",9.8,"NM","B","PXCEINTR",3)

"BLD",6505,"KRN",9.8,"NM","B","PXCESDAM",4)

"BLD",6505,"KRN",19,0)
19
"BLD",6505,"KRN",19.1,0)
19.1
"BLD",6505,"KRN",101,0)
101
"BLD",6505,"KRN",409.61,0)
409.61
"BLD",6505,"KRN",771,0)
771
"BLD",6505,"KRN",870,0)
870
"BLD",6505,"KRN",8989.51,0)
8989.51
"BLD",6505,"KRN",8989.52,0)
8989.52
"BLD",6505,"KRN",8994,0)
8994
"BLD",6505,"KRN","B",.4,.4)

"BLD",6505,"KRN","B",.401,.401)

"BLD",6505,"KRN","B",.402,.402)

"BLD",6505,"KRN","B",.403,.403)

"BLD",6505,"KRN","B",.5,.5)

"BLD",6505,"KRN","B",.84,.84)

"BLD",6505,"KRN","B",3.6,3.6)

"BLD",6505,"KRN","B",3.8,3.8)

"BLD",6505,"KRN","B",9.2,9.2)

"BLD",6505,"KRN","B",9.8,9.8)

"BLD",6505,"KRN","B",19,19)

"BLD",6505,"KRN","B",19.1,19.1)

"BLD",6505,"KRN","B",101,101)

"BLD",6505,"KRN","B",409.61,409.61)

"BLD",6505,"KRN","B",771,771)

"BLD",6505,"KRN","B",870,870)

"BLD",6505,"KRN","B",8989.51,8989.51)

"BLD",6505,"KRN","B",8989.52,8989.52)

"BLD",6505,"KRN","B",8994,8994)

"BLD",6505,"QUES",0)
^9.62^^
"BLD",6505,"REQB",0)
^9.611^2^2
"BLD",6505,"REQB",1,0)
PX*1.0*147^1
"BLD",6505,"REQB",2,0)
PX*1.0*156^1
"BLD",6505,"REQB","B","PX*1.0*147",1)

"BLD",6505,"REQB","B","PX*1.0*156",2)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
172^3051130
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3051130
"PKG",413,22,1,"PAH",1,1,1,0)
Fix problem that allows users to look at their own medical records.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PXCEAE")
0^1^B32083294
"RTN","PXCEAE",1,0)
PXCEAE ;ISL/dee,ISA/KWP - Main routine for the List Manager display of a visit and related v-files ;04/26/99
"RTN","PXCEAE",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**37,67,99,147,156,172**;Aug 12, 1996
"RTN","PXCEAE",3,0)
 ;; ;
"RTN","PXCEAE",4,0)
 Q
"RTN","PXCEAE",5,0)
EN ;+ -- main entry point for PXCE DISPLAY VISIT
"RTN","PXCEAE",6,0)
 Q:$G(PXCEVIEN)'>0
"RTN","PXCEAE",7,0)
 ;The selection list for the AICS' package interface used in help messages
"RTN","PXCEAE",8,0)
 N PXCEHLST
"RTN","PXCEAE",9,0)
 ;
"RTN","PXCEAE",10,0)
 N PXCEAEVW S PXCEAEVW="B"
"RTN","PXCEAE",11,0)
 N PXCEVDEL S PXCEVDEL=0
"RTN","PXCEAE",12,0)
 ;
"RTN","PXCEAE",13,0)
 I '$D(PXCEPAT) N PXCEPAT D
"RTN","PXCEAE",14,0)
 . S PXCEPAT=$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",5)
"RTN","PXCEAE",15,0)
 ; next 3 lines PX*1.0*172
"RTN","PXCEAE",16,0)
 N PXREC,PXPTSSN,PXDUZ S PXDUZ=DUZ,PXPTSSN=$P($G(^DPT(PXCEPAT,0)),U,9)
"RTN","PXCEAE",17,0)
 D SEC^PXCEEXP(.PXREC,PXDUZ,PXPTSSN)
"RTN","PXCEAE",18,0)
 I PXREC W !!,"Security regulations prohibit computer access to your own medical record." H 3 Q
"RTN","PXCEAE",19,0)
 S PXCECAT="AEP" D PATINFO^PXCEPAT(.PXCEPAT) K PXCECAT
"RTN","PXCEAE",20,0)
 ;
"RTN","PXCEAE",21,0)
 I '$D(PXCEHLOC) N PXCEHLOC S PXCEHLOC=$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",22)
"RTN","PXCEAE",22,0)
 ;+If not called from encounter viewer lock ^PXLCKUSR
"RTN","PXCEAE",23,0)
 ;+and create ^XTMP("PXLCKUSR",VISIEN)=DUZ
"RTN","PXCEAE",24,0)
 I PXCEKEYS'["V" D
"RTN","PXCEAE",25,0)
 .N PXRESVAL,PXVISIEN,PXMSG,PXUSR
"RTN","PXCEAE",26,0)
 .S PXMSG="",PXVISIEN=PXCEVIEN
"RTN","PXCEAE",27,0)
 .I $D(^XTMP("PXLCKUSR",PXVISIEN)) S PXUSR=$G(^VA(200,^XTMP("PXLCKUSR",PXVISIEN),0)),PXUSR=$S(PXUSR="":"Unknown",1:$P(PXUSR,"^")),PXMSG="Encounter Locked by "_PXUSR
"RTN","PXCEAE",28,0)
 .S PXRESVAL=$$LOCK^PXUALOCK("^PXLCKUSR("_PXVISIEN_")",5,0,PXMSG,0)
"RTN","PXCEAE",29,0)
 .I 'PXRESVAL Q
"RTN","PXCEAE",30,0)
 .S PXRESVAL=$$CREATE^PXUAXTMP("PXLCKUSR",PXVISIEN,365,"PCE Encounter Lock",DUZ)
"RTN","PXCEAE",31,0)
 .I 'PXRESVAL D UNLOCK^PXUALOCK("^PXLCKUSR("_PXVISIEN_")") Q
"RTN","PXCEAE",32,0)
 .D EN^VALM("PXCE ADD/EDIT MENU")
"RTN","PXCEAE",33,0)
 .D UNLOCK^PXUALOCK("^PXLCKUSR("_PXVISIEN_")"),DELETE^PXUAXTMP("PXLCKUSR",PXVISIEN)
"RTN","PXCEAE",34,0)
 I PXCEKEYS["V",$D(^TMP("VALM DATA",$J,VALMEVL,"EXP")),^("EXP")]"" X ^("EXP")
"RTN","PXCEAE",35,0)
 Q
"RTN","PXCEAE",36,0)
 ;
"RTN","PXCEAE",37,0)
GETVIEN ;Ask the user which visit.
"RTN","PXCEAE",38,0)
 N PXCEVIDX
"RTN","PXCEAE",39,0)
 S PXCEVIDX=+$P(XQORNOD(0),"^",3)
"RTN","PXCEAE",40,0)
 S:PXCEVIDX'>0 PXCEVIDX=$$SEL1^PXCE("")
"RTN","PXCEAE",41,0)
 Q:PXCEVIDX'>0
"RTN","PXCEAE",42,0)
 S PXCEVIEN=$G(^TMP("PXCEIDX",$J,PXCEVIDX))
"RTN","PXCEAE",43,0)
 ;Check that it is not related to a no show or canceled apppointment
"RTN","PXCEAE",44,0)
 D APPCHECK^PXCESDAM(.PXCEVIEN)
"RTN","PXCEAE",45,0)
 Q:'$D(PXCEVIEN)
"RTN","PXCEAE",46,0)
 ;Cannot edit future visits
"RTN","PXCEAE",47,0)
 I $P(+^AUPNVSIT(PXCEVIEN,0),".")>DT D  Q
"RTN","PXCEAE",48,0)
 . W !!,$C(7),"Can not update future encounters."
"RTN","PXCEAE",49,0)
 . D WAIT^PXCEHELP
"RTN","PXCEAE",50,0)
 . K PXCEVIEN
"RTN","PXCEAE",51,0)
 ;Check if the visit can be associated with an appointment.
"RTN","PXCEAE",52,0)
 S PXCEAPPM=$G(^DPT($P(^AUPNVSIT(PXCEVIEN,0),"^",5),"S",+^AUPNVSIT(PXCEVIEN,0),0))
"RTN","PXCEAE",53,0)
 I $P(PXCEVIEN,"^",7)="E" D  I 'Y K PXCEVIEN Q
"RTN","PXCEAE",54,0)
 . W !!,"This is a historical encounter for documenting a clinical encounter only"
"RTN","PXCEAE",55,0)
 . W !,"and will not be used by Scheduling, Billing or Workload credit."
"RTN","PXCEAE",56,0)
 . D PAUSE^PXCEHELP
"RTN","PXCEAE",57,0)
 Q
"RTN","PXCEAE",58,0)
 ;
"RTN","PXCEAE",59,0)
HDR ; -- header code
"RTN","PXCEAE",60,0)
 I '$D(^AUPNVSIT(PXCEVIEN,0)) S VALMQUIT=1 Q
"RTN","PXCEAE",61,0)
 K VALMHDR
"RTN","PXCEAE",62,0)
 N VISIT0
"RTN","PXCEAE",63,0)
 ;
"RTN","PXCEAE",64,0)
 ;PATIENT
"RTN","PXCEAE",65,0)
 S VISIT0=^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCEAE",66,0)
 S VALMHDR(1)=$E(PXCEPAT("NAME"),1,26)
"RTN","PXCEAE",67,0)
 S VALMHDR(1)=$E(VALMHDR(1)_$E("    ",1,(27-$L(VALMHDR(1))))_PXCEPAT("SSN")_"                                           ",1,40)
"RTN","PXCEAE",68,0)
 S VALMHDR(1)=VALMHDR(1)_"Clinic:  "_$S($P(VISIT0,"^",22)>0:$P(^SC($P(VISIT0,"^",22),0),"^"),1:"")
"RTN","PXCEAE",69,0)
 ;
"RTN","PXCEAE",70,0)
 ;DATE
"RTN","PXCEAE",71,0)
 S VALMHDR(2)=$E("Encounter Date  "_$S($P(VISIT0,"^",1)>0:$$DATE^PXCEDATE($P(VISIT0,"^",1)),1:"")_"                                           ",1,40)
"RTN","PXCEAE",72,0)
 S VALMHDR(2)=VALMHDR(2)_"Clinic Stop:  "_$S($P(VISIT0,"^",8)>0:$$DISPLY08^PXCECSTP($P(VISIT0,"^",8)),1:"")
"RTN","PXCEAE",73,0)
 ;
"RTN","PXCEAE",74,0)
 S VALMSG="+ Next Screen   - Prev Screen   ?? More Actions"
"RTN","PXCEAE",75,0)
 ;
"RTN","PXCEAE",76,0)
 Q
"RTN","PXCEAE",77,0)
 ;
"RTN","PXCEAE",78,0)
KEYS(PXCEPROT,PXCEEND) ;Set up ^XQORM("KEY") array so that can edit an item by having its 
"RTN","PXCEAE",79,0)
 ;  number be and action to edit it.
"RTN","PXCEAE",80,0)
 N PXCEPIEN,PXCEINDX
"RTN","PXCEAE",81,0)
 S PXCEPIEN=$O(^ORD(101,"B",PXCEPROT,0))_"^1"
"RTN","PXCEAE",82,0)
 F PXCEINDX=1:1:PXCEEND S XQORM("KEY",PXCEINDX)=PXCEPIEN
"RTN","PXCEAE",83,0)
 ;
"RTN","PXCEAE",84,0)
 Q
"RTN","PXCEAE",85,0)
 ;
"RTN","PXCEAE",86,0)
INIT ; -- init variables and list array
"RTN","PXCEAE",87,0)
 D BUILD^PXCEAE1(PXCEVIEN,PXCEAEVW,"^TMP(""PXCEAE"",$J)","^TMP(""PXCEAEIX"",$J)")
"RTN","PXCEAE",88,0)
 I '$D(VALMBCK) K VALMHDR S VALMBCK="R"
"RTN","PXCEAE",89,0)
 Q
"RTN","PXCEAE",90,0)
 ;
"RTN","PXCEAE",91,0)
HELP ; -- help code
"RTN","PXCEAE",92,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PXCEAE",93,0)
 Q
"RTN","PXCEAE",94,0)
 ;
"RTN","PXCEAE",95,0)
EXIT ; -- exit code
"RTN","PXCEAE",96,0)
 ;
"RTN","PXCEAE",97,0)
 ;Check for incomplete ENCOUNTER if not already removed.
"RTN","PXCEAE",98,0)
 N PXQUIT
"RTN","PXCEAE",99,0)
 S PXQUIT=1
"RTN","PXCEAE",100,0)
 D:'$G(PXCEEXIT) CHECK^PXCEVFI5
"RTN","PXCEAE",101,0)
 ;
"RTN","PXCEAE",102,0)
 D CLEAN^VALM10
"RTN","PXCEAE",103,0)
 K ^TMP("PXCEAE",$J),^TMP("PXCEAEIX",$J)
"RTN","PXCEAE",104,0)
 D EVENT^PXKMAIN
"RTN","PXCEAE",105,0)
 K PXCEVIEN,PXCEAPPM
"RTN","PXCEAE",106,0)
 Q
"RTN","PXCEAE",107,0)
 ;
"RTN","PXCEAE",108,0)
EXPND ; -- expand code
"RTN","PXCEAE",109,0)
 S PXCEAEVW=$S(PXCEAEVW="B":"D",1:"B")
"RTN","PXCEAE",110,0)
 D BUILD^PXCEAE1(PXCEVIEN,PXCEAEVW,"^TMP(""PXCEAE"",$J)","^TMP(""PXCEAEIX"",$J)")
"RTN","PXCEAE",111,0)
 D DONE^PXCE
"RTN","PXCEAE",112,0)
 Q
"RTN","PXCEAE",113,0)
 ;
"RTN","PXCEAE",114,0)
EDIT ; -- edit a V-File entry
"RTN","PXCEAE",115,0)
 N PXCEFIDX
"RTN","PXCEAE",116,0)
 S PXCEFIDX=+$P(XQORNOD(0),"^",3)
"RTN","PXCEAE",117,0)
 D DOMANY(PXCEFIDX,"E","EN^PXCEVFIL(PXCECAT)")
"RTN","PXCEAE",118,0)
 Q
"RTN","PXCEAE",119,0)
 ;
"RTN","PXCEAE",120,0)
DEL ; -- delete a V-File entries
"RTN","PXCEAE",121,0)
 I PXCEKEYS'["D",PXCEKEYS'["d" W !!!,$C(7),"Error: You do not have delete access." D WAIT^PXCEHELP Q
"RTN","PXCEAE",122,0)
 D DOMANY(0,"D","DEL^PXCEVFI2(PXCECAT)")
"RTN","PXCEAE",123,0)
 Q
"RTN","PXCEAE",124,0)
 ;
"RTN","PXCEAE",125,0)
DOMANY(PXCEFIDX,WHATDO,WHATTODO) ;Process one or more V-File entries
"RTN","PXCEAE",126,0)
 ;WHATDO is E for edit and D for delete
"RTN","PXCEAE",127,0)
 ;WHATTODO is the routine to call
"RTN","PXCEAE",128,0)
 ;
"RTN","PXCEAE",129,0)
 I WHATDO="D" N PXCEDELV S PXCEDELV=0
"RTN","PXCEAE",130,0)
 D FULL^VALM1
"RTN","PXCEAE",131,0)
 I WHATDO="E" D
"RTN","PXCEAE",132,0)
 . S:PXCEFIDX'>0 PXCEFIDX=$$SEL^PXCEAE2("Edit",1)
"RTN","PXCEAE",133,0)
 E  I WHATDO="D" D
"RTN","PXCEAE",134,0)
 . S:PXCEFIDX'>0 PXCEFIDX=$$SEL^PXCEAE2("Delete",2)
"RTN","PXCEAE",135,0)
 E  W "??",$C(7) Q
"RTN","PXCEAE",136,0)
 Q:+PXCEFIDX'>0
"RTN","PXCEAE",137,0)
 N PXCEINDX,PXCEFIX1,PXCEFIX2
"RTN","PXCEAE",138,0)
 F PXCEINDX=1:1 S PXCEFIX1=$P(PXCEFIDX,",",PXCEINDX) Q:PXCEFIX1']""  D
"RTN","PXCEAE",139,0)
 . I $L(PXCEFIX1,"-")=1 D
"RTN","PXCEAE",140,0)
 .. I WHATDO="D",PXCEFIX1=1 S PXCEDELV=1
"RTN","PXCEAE",141,0)
 .. E  D DO1(PXCEFIX1,WHATDO,WHATTODO)
"RTN","PXCEAE",142,0)
 . E  F PXCEFIX2=$P(PXCEFIX1,"-",1):1:$P(PXCEFIX1,"-",2) D
"RTN","PXCEAE",143,0)
 .. I WHATDO="D",PXCEFIX2=1 S PXCEDELV=1
"RTN","PXCEAE",144,0)
 .. E  D DO1(PXCEFIX2,WHATDO,WHATTODO)
"RTN","PXCEAE",145,0)
 I WHATDO="D",PXCEDELV D DO1(1,WHATDO,WHATTODO)
"RTN","PXCEAE",146,0)
 D INIT
"RTN","PXCEAE",147,0)
 Q
"RTN","PXCEAE",148,0)
 ;
"RTN","PXCEAE",149,0)
DO1(PXCEFIDX,WHATDO,WHATTODO) ;Process one V-File entry
"RTN","PXCEAE",150,0)
 ;PXCEFIDX is and index into ^TMP("PXCEAEIX",$J, which tells the V-File
"RTN","PXCEAE",151,0)
 ;  and the IEN to process
"RTN","PXCEAE",152,0)
 ;WHATDO is E for edit and D for delete
"RTN","PXCEAE",153,0)
 ;WHATTODO is the routine to call
"RTN","PXCEAE",154,0)
 ;
"RTN","PXCEAE",155,0)
 N PXCEONE,PXCECAT,PXCEFIEN
"RTN","PXCEAE",156,0)
 S PXCEONE=$G(^TMP("PXCEAEIX",$J,PXCEFIDX))
"RTN","PXCEAE",157,0)
 S PXCEFIEN=+PXCEONE
"RTN","PXCEAE",158,0)
 S PXCECAT=$P(PXCEONE,"^",2)
"RTN","PXCEAE",159,0)
 I PXCECAT="CSTP",WHATDO="E" W !!!,$C(7),"You cannot edit stop codes." S PXCENOER=1 D WAIT^PXCEHELP Q
"RTN","PXCEAE",160,0)
 I PXCECAT="VST",$P(^AUPNVSIT(PXCEFIEN,0),"^",7)="E" S PXCECAT="HIST"
"RTN","PXCEAE",161,0)
 D @$S("~VST~HIST~CSTP~CPT~IMM~PED~POV~PRV~SK~TRT~HF~XAM~"[("~"_PXCECAT_"~"):WHATTODO,1:"QUIT")
"RTN","PXCEAE",162,0)
 Q
"RTN","PXCEAE",163,0)
 ;
"RTN","PXCEAE",164,0)
QUIT Q
"RTN","PXCEAE",165,0)
 ;
"RTN","PXCEEXP")
0^2^B8315485
"RTN","PXCEEXP",1,0)
PXCEEXP ;ISL/dee - Main routine for the List Manager display for encounter profile of a visit and related v-files ;6/20/96
"RTN","PXCEEXP",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**172**;Aug 12, 1996
"RTN","PXCEEXP",3,0)
 ;;
"RTN","PXCEEXP",4,0)
 Q
"RTN","PXCEEXP",5,0)
EN ; -- main entry point for PXCE ENCOUNTER PROFILE
"RTN","PXCEEXP",6,0)
 N PXCEVIEN,PXCEQUIT
"RTN","PXCEEXP",7,0)
 I PXCEVIEW["V" D
"RTN","PXCEEXP",8,0)
 . D GETVIEN^PXCEAE
"RTN","PXCEEXP",9,0)
 E  I PXCEVIEW["A" D
"RTN","PXCEEXP",10,0)
 . S PXCEVIEN=$$SELAPPM^PXCESDAM
"RTN","PXCEEXP",11,0)
 . S:'PXCEVIEN PXCEVIEN=0
"RTN","PXCEEXP",12,0)
 E  Q
"RTN","PXCEEXP",13,0)
EN1 ;
"RTN","PXCEEXP",14,0)
 I $G(PXCEVIEN)'>0 D  G QUIT
"RTN","PXCEEXP",15,0)
 . W !!,"There is no data stored in PCE to display."
"RTN","PXCEEXP",16,0)
 . D WAIT^PXCEHELP
"RTN","PXCEEXP",17,0)
 N PXCEAEVW
"RTN","PXCEEXP",18,0)
 I '$D(PXCEPAT) N PXCEKPAT D
"RTN","PXCEEXP",19,0)
 . S PXCEKPAT=1
"RTN","PXCEEXP",20,0)
 . S PXCEPAT=$P($G(^AUPNVSIT(PXCEVIEN,0)),"^",5)
"RTN","PXCEEXP",21,0)
 . D PATINFO^PXCEPAT(.PXCEPAT)
"RTN","PXCEEXP",22,0)
 S PXCEAEVW="D"
"RTN","PXCEEXP",23,0)
 ; next 3 lines added per PX*1.0*172
"RTN","PXCEEXP",24,0)
 N PXPTSSN,PXREC,PXDUZ S PXDUZ=DUZ,PXPTSSN=$TR($G(PXCEPAT("SSN")),"-")
"RTN","PXCEEXP",25,0)
 D SEC(.PXREC,PXDUZ,PXPTSSN)
"RTN","PXCEEXP",26,0)
 I PXREC W !!,"Security regulations prohibit computer access to your own medical record." H 3 G QUIT
"RTN","PXCEEXP",27,0)
 D EN^VALM("PXCE ENCOUNTER PROFILE")
"RTN","PXCEEXP",28,0)
QUIT ;
"RTN","PXCEEXP",29,0)
 D MAKELIST^PXCENEW,DONE^PXCE
"RTN","PXCEEXP",30,0)
 Q
"RTN","PXCEEXP",31,0)
 ;
"RTN","PXCEEXP",32,0)
SEC(PXREC,PXDUZ,PXPTSSN) ; added per PX*1.0*172
"RTN","PXCEEXP",33,0)
 N PXNPSSN S PXREC=0
"RTN","PXCEEXP",34,0)
 S PXNPSSN=$$GET1^DIQ(200,PXDUZ_",",9,"I","","PXNPERR")
"RTN","PXCEEXP",35,0)
 I PXNPSSN=PXPTSSN S PXREC=1
"RTN","PXCEEXP",36,0)
 Q
"RTN","PXCEEXP",37,0)
 ;
"RTN","PXCEEXP",38,0)
HDR ; -- header code
"RTN","PXCEEXP",39,0)
 K VALMHDR
"RTN","PXCEEXP",40,0)
 N VISIT0
"RTN","PXCEEXP",41,0)
 ;
"RTN","PXCEEXP",42,0)
 ;PATIENT
"RTN","PXCEEXP",43,0)
 S VISIT0=^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCEEXP",44,0)
 S VALMHDR(1)=$E(PXCEPAT("NAME"),1,26)
"RTN","PXCEEXP",45,0)
 S VALMHDR(1)=$E(VALMHDR(1)_$E("    ",1,(27-$L(VALMHDR(1))))_PXCEPAT("SSN")_"                                           ",1,40)
"RTN","PXCEEXP",46,0)
 S VALMHDR(1)=VALMHDR(1)_"Clinic:  "_$S($P(VISIT0,"^",22)>0:$P(^SC($P(VISIT0,"^",22),0),"^"),1:"")
"RTN","PXCEEXP",47,0)
 ;
"RTN","PXCEEXP",48,0)
 ;DATE
"RTN","PXCEEXP",49,0)
 S VALMHDR(2)=$E("Encounter Date  "_$S($P(VISIT0,"^",1)>0:$$DATE^PXCEDATE($P(VISIT0,"^",1)),1:"")_"                                           ",1,40)
"RTN","PXCEEXP",50,0)
 S VALMHDR(2)=VALMHDR(2)_"Clinic Stop:  "_$S($P(VISIT0,"^",8)>0:$$DISPLY08^PXCECSTP($P(VISIT0,"^",8)),1:"")
"RTN","PXCEEXP",51,0)
 ;
"RTN","PXCEEXP",52,0)
 S VALMSG="+ Next Screen   - Prev Screen   ?? More Actions"
"RTN","PXCEEXP",53,0)
 Q
"RTN","PXCEEXP",54,0)
 ;
"RTN","PXCEEXP",55,0)
INIT ; -- init variables and list array
"RTN","PXCEEXP",56,0)
 D BUILD^PXCEAE1(PXCEVIEN,PXCEAEVW,"^TMP(""PXCEAE"",$J)","^TMP(""PXCEAEIX"",$J)")
"RTN","PXCEEXP",57,0)
 I '$D(VALMBCK) K VALMHDR S VALMBCK="R"
"RTN","PXCEEXP",58,0)
 Q
"RTN","PXCEEXP",59,0)
 ;
"RTN","PXCEEXP",60,0)
HELP ; -- help code
"RTN","PXCEEXP",61,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PXCEEXP",62,0)
 Q
"RTN","PXCEEXP",63,0)
 ;
"RTN","PXCEEXP",64,0)
EXIT ; -- exit code
"RTN","PXCEEXP",65,0)
 D CLEAN^VALM10
"RTN","PXCEEXP",66,0)
 K ^TMP("PXCEAE",$J),^TMP("PXCEAEIX",$J)
"RTN","PXCEEXP",67,0)
 D:$D(PXCEKPAT) PATKILL^PXCEPAT
"RTN","PXCEEXP",68,0)
 K PXCEVIEN
"RTN","PXCEEXP",69,0)
 Q
"RTN","PXCEEXP",70,0)
 ;
"RTN","PXCEEXP",71,0)
EXPND ; -- expand code
"RTN","PXCEEXP",72,0)
 S VALMBG=1
"RTN","PXCEEXP",73,0)
 S PXCEAEVW=$S(PXCEAEVW="D":"B",1:"D")
"RTN","PXCEEXP",74,0)
 D BUILD^PXCEAE1(PXCEVIEN,PXCEAEVW,"^TMP(""PXCEAE"",$J)","^TMP(""PXCEAEIX"",$J)")
"RTN","PXCEEXP",75,0)
 D DONE^PXCE
"RTN","PXCEEXP",76,0)
 Q
"RTN","PXCEEXP",77,0)
 ;
"RTN","PXCEINTR")
0^3^B12439731
"RTN","PXCEINTR",1,0)
PXCEINTR ;ISL/dee - PCE List Manager call to do interview questions ;7/9/96
"RTN","PXCEINTR",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**172**;Aug 12, 1996
"RTN","PXCEINTR",3,0)
 ;
"RTN","PXCEINTR",4,0)
 Q
"RTN","PXCEINTR",5,0)
 ;
"RTN","PXCEINTR",6,0)
GETVIEN() ;Ask the user which visit or to add a new one.
"RTN","PXCEINTR",7,0)
 N PXCEVIDX,PXCEVIEN
"RTN","PXCEINTR",8,0)
 S PXCEVIDX=$$SEL1^PXCE("",1)
"RTN","PXCEINTR",9,0)
 Q:PXCEVIDX="A" ""
"RTN","PXCEINTR",10,0)
 Q:PXCEVIDX'>0 -1
"RTN","PXCEINTR",11,0)
 S PXCEVIEN=$G(^TMP("PXCEIDX",$J,PXCEVIDX))
"RTN","PXCEINTR",12,0)
 ;Check that it is not related to a no show or canceled apppointment
"RTN","PXCEINTR",13,0)
 D APPCHECK^PXCESDAM(.PXCEVIEN)
"RTN","PXCEINTR",14,0)
 Q:'$D(PXCEVIEN) -1
"RTN","PXCEINTR",15,0)
 ;Cannot edit future visits
"RTN","PXCEINTR",16,0)
 I $P(+^AUPNVSIT(PXCEVIEN,0),".")>DT D  Q -1
"RTN","PXCEINTR",17,0)
 . W !!,$C(7),"Can not update future encounters."
"RTN","PXCEINTR",18,0)
 . D WAIT^PXCEHELP
"RTN","PXCEINTR",19,0)
 . K PXCEVIEN
"RTN","PXCEINTR",20,0)
 I $P(^AUPNVSIT(PXCEVIEN,0),"^",7)="E" D  Q -1
"RTN","PXCEINTR",21,0)
 . W !!,"You can not do the Checkout Interview on an Historical encounter."
"RTN","PXCEINTR",22,0)
 . D WAIT^PXCEHELP
"RTN","PXCEINTR",23,0)
 Q PXCEVIEN
"RTN","PXCEINTR",24,0)
 ;
"RTN","PXCEINTR",25,0)
INTRVIEW ;Do Interview form Encounter List.
"RTN","PXCEINTR",26,0)
 ; Allows the adding of new encounters.
"RTN","PXCEINTR",27,0)
 N PXCEVIEN
"RTN","PXCEINTR",28,0)
 S PXCEVIEN=$$GETVIEN
"RTN","PXCEINTR",29,0)
 Q:PXCEVIEN=-1
"RTN","PXCEINTR",30,0)
 ;
"RTN","PXCEINTR",31,0)
 N PXCEAPPM,PXCERET,PXCEWHAT
"RTN","PXCEINTR",32,0)
 S PXCEWHAT="ADDEDIT"
"RTN","PXCEINTR",33,0)
 I '$D(PXCEPAT) N PXCEPAT S PXCEPAT=""
"RTN","PXCEINTR",34,0)
 I '$D(PXCEHLOC) N PXCEHLOC S PXCEHLOC=""
"RTN","PXCEINTR",35,0)
 N PXREC S PXREC=0  ; PX*1.0*172 new logic added to dot structure below
"RTN","PXCEINTR",36,0)
 I PXCEVIEN>0 D  G:PXREC INTRVQ
"RTN","PXCEINTR",37,0)
 . S PXCEPAT=$P(^AUPNVSIT(PXCEVIEN,0),"^",5)
"RTN","PXCEINTR",38,0)
 . N PXDUZ,PXPTSSN S PXDUZ=DUZ,PXPTSSN=$P($G(^DPT(PXCEPAT,0)),U,9)
"RTN","PXCEINTR",39,0)
 . D SEC^PXCEEXP(.PXREC,PXDUZ,PXPTSSN)
"RTN","PXCEINTR",40,0)
 . I PXREC W !!,"Security regulations prohibit computer access to your own medical record." H 3 Q
"RTN","PXCEINTR",41,0)
 . S PXCEHLOC=$P(^AUPNVSIT(PXCEVIEN,0),"^",22)
"RTN","PXCEINTR",42,0)
 . I $$VSTAPPT^PXUTL1(PXCEPAT,+^AUPNVSIT(PXCEVIEN,0),$P(^(0),"^",22),PXCEVIEN) S PXCEAPPM=+^AUPNVSIT(PXCEVIEN,0),PXCEWHAT="INTV"
"RTN","PXCEINTR",43,0)
 S PXCERET=$$INTV^PXAPI(PXCEWHAT,"PX","PXCE DATA ENTRY",.PXCEVIEN,.PXCEHLOC,.PXCEPAT,$G(PXCEAPPM))
"RTN","PXCEINTR",44,0)
INTRVQ Q
"RTN","PXCEINTR",45,0)
 ;
"RTN","PXCEINTR",46,0)
SDINTRVW(PXCEWHAT) ;Do Interview form Appointment List.
"RTN","PXCEINTR",47,0)
 N PXCEVIEN
"RTN","PXCEINTR",48,0)
 N PXCEAPDT S PXCEAPDT=""
"RTN","PXCEINTR",49,0)
 I '$D(PXCEPAT) N PXCEPAT S PXCEPAT=""
"RTN","PXCEINTR",50,0)
 I '$D(PXCEHLOC) N PXCEHLOC S PXCEHLOC=""
"RTN","PXCEINTR",51,0)
 S PXCEVIEN=$$SELAPPM^PXCESDAM
"RTN","PXCEINTR",52,0)
 Q:PXCEVIEN=-1
"RTN","PXCEINTR",53,0)
 ; next 3 lines added per PX*1.0*172
"RTN","PXCEINTR",54,0)
 N PXREC,PXDUZ,PXPTSSN S PXDUZ=DUZ,PXPTSSN=$TR($G(PXCEPAT("SSN")),"-")
"RTN","PXCEINTR",55,0)
 D SEC^PXCEEXP(.PXREC,PXDUZ,PXPTSSN)
"RTN","PXCEINTR",56,0)
 I PXREC W !!,"Security regulations prohibit computer access to your own medical record." H 3 G SDINTRVQ
"RTN","PXCEINTR",57,0)
 I 'PXCEVIEN D
"RTN","PXCEINTR",58,0)
 . I PXCEWHAT'="INTV",PXCEWHAT'="ADQ" D
"RTN","PXCEINTR",59,0)
 .. W $C(7),!,"There is no Encounter for this Appointment."
"RTN","PXCEINTR",60,0)
 .. D WAIT^PXCEHELP
"RTN","PXCEINTR",61,0)
 .. K PXCEVIEN
"RTN","PXCEINTR",62,0)
 . E  S PXCEVIEN=""
"RTN","PXCEINTR",63,0)
 I '$D(PXCEVIEN) G SDINTRVQ
"RTN","PXCEINTR",64,0)
 N PXCERET
"RTN","PXCEINTR",65,0)
 S PXCERET=$$INTV^PXAPI(PXCEWHAT,"PX","PXCE DATA ENTRY",.PXCEVIEN,.PXCEHLOC,.PXCEPAT,PXCEAPDT)
"RTN","PXCEINTR",66,0)
SDINTRVQ Q
"RTN","PXCEINTR",67,0)
 ;
"RTN","PXCEINTR",68,0)
UPDATENC ;From the Update Encounter Screen
"RTN","PXCEINTR",69,0)
 I $P(^AUPNVSIT(PXCEVIEN,0),"^",7)="E" D  Q
"RTN","PXCEINTR",70,0)
 . W !!,"You can not do the Checkout Interview on an Historical encounter."
"RTN","PXCEINTR",71,0)
 . D WAIT^PXCEHELP
"RTN","PXCEINTR",72,0)
 D FULL^VALM1
"RTN","PXCEINTR",73,0)
 I $$INTV^PXAPI($S($$VSTAPPT^PXUTL1(PXCEPAT,+^AUPNVSIT(PXCEVIEN,0),+$G(PXCEHLOC),PXCEVIEN):"INTV",1:"ADDEDIT"),"PX","PXCE DATA ENTRY",PXCEVIEN,PXCEHLOC,PXCEPAT)
"RTN","PXCEINTR",74,0)
 Q
"RTN","PXCEINTR",75,0)
 ;
"RTN","PXCESDAM")
0^4^B31853082
"RTN","PXCESDAM",1,0)
PXCESDAM ;ISL/dee,ALB/Zoltan - PCE List Manager display of appointments ;11/20/98
"RTN","PXCESDAM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,34,147,172**;Aug 12, 1996
"RTN","PXCESDAM",3,0)
 ;
"RTN","PXCESDAM",4,0)
 ;Originally Developed using code from:
"RTN","PXCESDAM",5,0)
SDAM ;MJK/ALB - Appt Mgt ; 12/1/91
"RTN","PXCESDAM",6,0)
 ;;5.3;Scheduling;;Aug 13, 1993
"RTN","PXCESDAM",7,0)
 Q
"RTN","PXCESDAM",8,0)
 ;
"RTN","PXCESDAM",9,0)
 ; -- kill off handle data
"RTN","PXCESDAM",10,0)
EN ; -- main entry point
"RTN","PXCESDAM",11,0)
 D FULL^VALM1
"RTN","PXCESDAM",12,0)
 D EN^VALM("PXCE SDAM MENU")
"RTN","PXCESDAM",13,0)
 D MAKELIST^PXCENEW
"RTN","PXCESDAM",14,0)
 Q
"RTN","PXCESDAM",15,0)
 ;
"RTN","PXCESDAM",16,0)
INIT ; -- set up appt man vars
"RTN","PXCESDAM",17,0)
 K I,X,SDB,XQORNOD,SDFN,SDCLN,DA,DR,DIE,DNM,DQ,%B
"RTN","PXCESDAM",18,0)
 S $P(PXCEVIEW,"^",2)="A"
"RTN","PXCESDAM",19,0)
 I PXCEVIEW["P" D INTSDAM1^PXCESDA1
"RTN","PXCESDAM",20,0)
 I PXCEVIEW["H" D INTSDAM3^PXCESDA3
"RTN","PXCESDAM",21,0)
 Q
"RTN","PXCESDAM",22,0)
 ;
"RTN","PXCESDAM",23,0)
FNL ; -- what to do after action
"RTN","PXCESDAM",24,0)
 D CLEAN^VALM10
"RTN","PXCESDAM",25,0)
 K ^TMP("SDAM",$J),^TMP("SDAMIDX",$J),^TMP("VALMIDX",$J)
"RTN","PXCESDAM",26,0)
 K SDAMCNT,SDFLDD,SDACNT,VALMHCNT,SDPRD,SDFN,SDCLN,SDAMLIST,SDT,SDATA,SDY,X,SDCL,Y,SDDA,VALMY
"RTN","PXCESDAM",27,0)
 Q
"RTN","PXCESDAM",28,0)
 ;
"RTN","PXCESDAM",29,0)
EXIT ; -- exit action for protocol
"RTN","PXCESDAM",30,0)
 D:PXCEVIEW'["P" PATKILL^PXCEPAT
"RTN","PXCESDAM",31,0)
 Q
"RTN","PXCESDAM",32,0)
 ;
"RTN","PXCESDAM",33,0)
EXPND ; -- expand code
"RTN","PXCESDAM",34,0)
 D EN^PXCEEXP
"RTN","PXCESDAM",35,0)
 Q
"RTN","PXCESDAM",36,0)
 ;
"RTN","PXCESDAM",37,0)
SEL ;
"RTN","PXCESDAM",38,0)
 N PXCEVIEN
"RTN","PXCESDAM",39,0)
 N PXCEAPDT S PXCEAPDT=""
"RTN","PXCESDAM",40,0)
 I '$D(PXCEPAT) N PXCEPAT S PXCEPAT=""
"RTN","PXCESDAM",41,0)
 I '$D(PXCEHLOC) N PXCEHLOC S PXCEHLOC=""
"RTN","PXCESDAM",42,0)
 S PXCEVIEN=$$SELAPPM
"RTN","PXCESDAM",43,0)
 I PXCEVIEN=-1 G SELQ
"RTN","PXCESDAM",44,0)
 ; next 3 lines PX*1.0*172
"RTN","PXCESDAM",45,0)
 N PXREC,PXDUZ,PXPTSSN S PXDUZ=DUZ,PXPTSSN=$TR($G(PXCEPAT("SSN")),"-")
"RTN","PXCESDAM",46,0)
 D SEC^PXCEEXP(.PXREC,PXDUZ,PXPTSSN)
"RTN","PXCESDAM",47,0)
 I PXREC W !!,"Security regulations prohibit computer access to your own medical record." H 3 G SELQ
"RTN","PXCESDAM",48,0)
 ;
"RTN","PXCESDAM",49,0)
 D APPCHECK(.PXCEVIEN,PXCEHLOC,PXCEAPDT,PXCEPAT)
"RTN","PXCESDAM",50,0)
 I '$D(PXCEVIEN) G SELQ
"RTN","PXCESDAM",51,0)
 D:PXCEVIEN="" EN^PXCEVFIL("APPM")
"RTN","PXCESDAM",52,0)
 D:PXCEVIEN>0 EN^PXCEAE
"RTN","PXCESDAM",53,0)
SELQ K ^UTILITY("VASD",$J)
"RTN","PXCESDAM",54,0)
 Q
"RTN","PXCESDAM",55,0)
 ;
"RTN","PXCESDAM",56,0)
SELAPPM() ;
"RTN","PXCESDAM",57,0)
 N SDW,SDERR
"RTN","PXCESDAM",58,0)
 S SDW=+$P(XQORNOD(0),"^",3)
"RTN","PXCESDAM",59,0)
 I SDW'>0 K SDW D SELSDAM I '$D(SDW)!SDERR Q -1
"RTN","PXCESDAM",60,0)
 I $P($P(^TMP("SDAMIDX",$J,SDW),"^",3),".",1)>DT D  Q -1
"RTN","PXCESDAM",61,0)
 . W !!,$C(7),"Can not update future encounters."
"RTN","PXCESDAM",62,0)
 . D WAIT^PXCEHELP
"RTN","PXCESDAM",63,0)
 D FULL^VALM1
"RTN","PXCESDAM",64,0)
 N PXCEVIEN,PXCEINDX
"RTN","PXCESDAM",65,0)
 I '$D(PXCEAPDT) N PXCEAPDT
"RTN","PXCESDAM",66,0)
 I '$D(PXCEPAT) N PXCEPAT
"RTN","PXCESDAM",67,0)
 I '$D(PXCEHLOC) N PXCEHLOC
"RTN","PXCESDAM",68,0)
 S PXCEAPDT=$P(^TMP("SDAMIDX",$J,SDW),"^",3)
"RTN","PXCESDAM",69,0)
 I $G(PXCEPAT)="" S PXCEPAT=$P(^TMP("SDAMIDX",$J,SDW),"^",2) D PATINFO^PXCEPAT(.PXCEPAT) I $D(DIRUT) Q -1
"RTN","PXCESDAM",70,0)
 I $G(PXCEHLOC)="" S PXCEHLOC=$P(^TMP("SDAMIDX",$J,SDW),"^",4)
"RTN","PXCESDAM",71,0)
 ;
"RTN","PXCESDAM",72,0)
 ;Look for visits for this patient at the appointment date and time.
"RTN","PXCESDAM",73,0)
 S PXCEVIEN=$$APPT2VST^PXUTL1(PXCEPAT,PXCEAPDT,PXCEHLOC)
"RTN","PXCESDAM",74,0)
 Q $S(PXCEVIEN>0:PXCEVIEN,1:"")
"RTN","PXCESDAM",75,0)
 ;
"RTN","PXCESDAM",76,0)
SELSDAM ; -- select processing
"RTN","PXCESDAM",77,0)
 N BG,LST,Y
"RTN","PXCESDAM",78,0)
 N DIRUT,DTOUT,DUOUT,DIROUT,DIR,DA
"RTN","PXCESDAM",79,0)
 S BG=1
"RTN","PXCESDAM",80,0)
 S LST=+$O(@VALMAR@("IDX",VALMCNT,0))
"RTN","PXCESDAM",81,0)
 I LST=BG S SDERR=0,SDW=BG Q
"RTN","PXCESDAM",82,0)
 I 'LST W !!,$C(7),"There are no '",VALM("ENTITY"),"s' to select.",! D WAIT^PXCEHELP S SDERR=1 Q
"RTN","PXCESDAM",83,0)
 S Y=+$P($P(XQORNOD(0),U,4),"=",2)
"RTN","PXCESDAM",84,0)
 I 'Y S DIR(0)="N^"_BG_":"_LST,DIR("A")="Select "_VALM("ENTITY") D ^DIR I $D(DIRUT) S SDERR=1 Q
"RTN","PXCESDAM",85,0)
 ;
"RTN","PXCESDAM",86,0)
 ; -- check was valid entries
"RTN","PXCESDAM",87,0)
 S SDERR=0,SDW=Y
"RTN","PXCESDAM",88,0)
 I SDW<BG!(SDW>LST) D
"RTN","PXCESDAM",89,0)
 .W !,$C(7),"Selection '",SDW,"' is not a valid choice."
"RTN","PXCESDAM",90,0)
 .S SDERR=1
"RTN","PXCESDAM",91,0)
 .D WAIT^PXCEHELP
"RTN","PXCESDAM",92,0)
 Q
"RTN","PXCESDAM",93,0)
 ;
"RTN","PXCESDAM",94,0)
APPCHECK(PXCEVIEN,PXCEHLOC,PXCEAPDT,PXCEPAT) ; Pass in PXCEVIEN and kills it if should not be selected.
"RTN","PXCESDAM",95,0)
 I PXCEVIEN="" D  Q
"RTN","PXCESDAM",96,0)
 . I $$CANCEL($G(PXCEHLOC),$G(PXCEAPDT),$G(PXCEPAT)) K PXCEVIEN
"RTN","PXCESDAM",97,0)
 N VASD,VAERR
"RTN","PXCESDAM",98,0)
 S VASD("W")=345678
"RTN","PXCESDAM",99,0)
 S VASD("F")=+^AUPNVSIT(PXCEVIEN,0)-.0000001
"RTN","PXCESDAM",100,0)
 S VASD("T")=VASD("F")+.0000002
"RTN","PXCESDAM",101,0)
 S VASD("C",+$P(^AUPNVSIT(PXCEVIEN,0),"^",22))=""
"RTN","PXCESDAM",102,0)
 D SDA^VADPT
"RTN","PXCESDAM",103,0)
 I $D(^UTILITY("VASD",$J)) D
"RTN","PXCESDAM",104,0)
 . I 'PXCEVIEN D
"RTN","PXCESDAM",105,0)
 .. W !,$C(7),"PCE has no data related to this appointment."
"RTN","PXCESDAM",106,0)
 .. W !,"You cannot add data for an appointment that has a status of ",$P(^UTILITY("VASD",$J,1,"E"),"^",3)
"RTN","PXCESDAM",107,0)
 .. K PXCEVIEN
"RTN","PXCESDAM",108,0)
 .. D WAIT^PXCEHELP
"RTN","PXCESDAM",109,0)
 . E  I PXCEKEYS["S" D
"RTN","PXCESDAM",110,0)
 .. N DIR,DA
"RTN","PXCESDAM",111,0)
 .. W !,$C(7),"Appointment has a status of ",$P(^UTILITY("VASD",$J,1,"E"),"^",3)
"RTN","PXCESDAM",112,0)
 .. S DIR("A",1)="WARNING: Data stored in PCE related to this appointment"
"RTN","PXCESDAM",113,0)
 .. S DIR("A",2)="  will NOT be used for Workload or Billing.  This is a bad encounter"
"RTN","PXCESDAM",114,0)
 .. S DIR("A")="Do you want to continue with this encounter"
"RTN","PXCESDAM",115,0)
 .. S DIR("B")="NO"
"RTN","PXCESDAM",116,0)
 .. S DIR(0)="Y"
"RTN","PXCESDAM",117,0)
 .. D ^DIR
"RTN","PXCESDAM",118,0)
 .. I Y'=1 K PXCEVIEN
"RTN","PXCESDAM",119,0)
 . E  D
"RTN","PXCESDAM",120,0)
 .. W !,$C(7),"Appointment has a status of ",$P(^UTILITY("VASD",$J,1,"E"),"^",3)
"RTN","PXCESDAM",121,0)
 .. W !,"WARNING: Data stored in PCE related to this appointment"
"RTN","PXCESDAM",122,0)
 .. W !,"  will NOT be used for Workload or Billing.  This is a bad encounter"
"RTN","PXCESDAM",123,0)
 .. W !,"You must use a PCE Superviser option to access the encounter."
"RTN","PXCESDAM",124,0)
 .. K PXCEVIEN
"RTN","PXCESDAM",125,0)
 .. D WAIT^PXCEHELP
"RTN","PXCESDAM",126,0)
 ;
"RTN","PXCESDAM",127,0)
 ; Exit if we already know it should not be selected.
"RTN","PXCESDAM",128,0)
 I $D(PXCEVIEN)["0" Q
"RTN","PXCESDAM",129,0)
 ;
"RTN","PXCESDAM",130,0)
 ;If Supervisor then ask if want to edit ancillary package data
"RTN","PXCESDAM",131,0)
 I PXCEKEYS["S",$P($G(^AUPNVSIT(PXCEVIEN,150)),"^",3)="A" D
"RTN","PXCESDAM",132,0)
 . N DIR,DA
"RTN","PXCESDAM",133,0)
 . W $C(7)
"RTN","PXCESDAM",134,0)
 . S DIR("A",1)="WARNING: Data stored in PCE came from another package and should"
"RTN","PXCESDAM",135,0)
 . S DIR("A",2)="  only be changed in that package.  If it is changed by PCE it will"
"RTN","PXCESDAM",136,0)
 . S DIR("A",3)="  not agree with what is in the originating package."
"RTN","PXCESDAM",137,0)
 . S DIR("A")="Do you want to continue with this encounter"
"RTN","PXCESDAM",138,0)
 . S DIR("B")="NO"
"RTN","PXCESDAM",139,0)
 . S DIR(0)="Y"
"RTN","PXCESDAM",140,0)
 . D ^DIR
"RTN","PXCESDAM",141,0)
 . I Y'=1 K PXCEVIEN
"RTN","PXCESDAM",142,0)
 Q
"RTN","PXCESDAM",143,0)
 ;
"RTN","PXCESDAM",144,0)
CANCEL(PXHL,PXDT,PXDFN) ; True if the appointment is cancelled or no-showed.
"RTN","PXCESDAM",145,0)
 N STATUS,CANC
"RTN","PXCESDAM",146,0)
 S CANC=0
"RTN","PXCESDAM",147,0)
 I PXHL,PXDT,PXDFN,PXHL=+$G(^DPT(PXDFN,"S",PXDT,0)) D
"RTN","PXCESDAM",148,0)
 . S STATUS=$P(^DPT(PXDFN,"S",PXDT,0),U,2)
"RTN","PXCESDAM",149,0)
 . I STATUS["N"!(STATUS["C") S CANC=1
"RTN","PXCESDAM",150,0)
 Q CANC
"VER")
8.0^22.0
"BLD",6505,6)
^134
**END**
**END**
