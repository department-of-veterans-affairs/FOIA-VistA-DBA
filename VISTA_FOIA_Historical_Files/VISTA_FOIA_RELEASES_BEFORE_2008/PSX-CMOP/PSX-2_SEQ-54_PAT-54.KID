Released PSX*2*54 SEQ #54
Extracted from mail message
**KIDS**:PSX*2.0*54^

**INSTALL NAME**
PSX*2.0*54
"BLD",4855,0)
PSX*2.0*54^CMOP^0^3061124^y
"BLD",4855,1,0)
^^142^142^3061124^
"BLD",4855,1,1,0)
As part of the Outpatient Pharmacy V. 7.0 Laser Labels Phase II project, 
"BLD",4855,1,2,0)
a new commercial data source is utilized to provide warning label source
"BLD",4855,1,3,0)
information. The new warning labels are enabled for printing on the laser 
"BLD",4855,1,4,0)
labels when the WARNING LABEL SOURCE field (#16) of the PHARMACY SYSTEM
"BLD",4855,1,5,0)
file (#59.7) is set to "N" for "New". Parameters for using the new 
"BLD",4855,1,6,0)
warning labels are set using the Pharmacy System Parameters Edit [PSS SYS 
"BLD",4855,1,7,0)
EDIT] option.
"BLD",4855,1,8,0)
 
"BLD",4855,1,9,0)
For the Consolidated Mail Outpatient Pharmacy (CMOP) to utilize the new 
"BLD",4855,1,10,0)
warning labels, this patch uses a new CMOP WARNING LABEL SOURCE field 
"BLD",4855,1,11,0)
(#16.1) in the PHARMACY SYSTEM file (#59.7), also set by using the 
"BLD",4855,1,12,0)
Pharmacy System Parameters Edit [PSS SYS EDIT] option. This should be set
"BLD",4855,1,13,0)
to "N" for "New" to send the new warnings to CMOP. This field is added by 
"BLD",4855,1,14,0)
patch PSS*1*120.
"BLD",4855,1,15,0)
 
"BLD",4855,1,16,0)
If the BAD ADDRESS INDICATOR field (#.121) in the PATIENT file (#2) is set
"BLD",4855,1,17,0)
and there is no active temporary address for the patient, the fill will
"BLD",4855,1,18,0)
appear on the CMOP reject log and will remain in suspense, but unmarked
"BLD",4855,1,19,0)
for CMOP. It will print when the local print from suspense is done to be 
"BLD",4855,1,20,0)
filled locally.
"BLD",4855,1,21,0)
 
"BLD",4855,1,22,0)
 
"BLD",4855,1,23,0)
**************** NOTE ***************************************************
"BLD",4855,1,24,0)
As the CMOP side also had to make programming changes, verify that the
"BLD",4855,1,25,0)
CMOP that your site sends to can receive the new warning label format.
"BLD",4855,1,26,0)
Then after setting the CMOP WARNING LABEL SOURCE field (#16.1) to "New",
"BLD",4855,1,27,0)
send a small batch and verify that it was received and able to be
"BLD",4855,1,28,0)
processed successfully. (As of the release of this patch, only the Bedford
"BLD",4855,1,29,0)
CMOP was not yet ready to receive the new format).
"BLD",4855,1,30,0)
**************************************************************************
"BLD",4855,1,31,0)
 
"BLD",4855,1,32,0)
This patch adds the sending of the INTEGRATION CONTROL NUMBER field 
"BLD",4855,1,33,0)
(#991.01) from the PATIENT file (#2) if it is a national number. This 
"BLD",4855,1,34,0)
number is concatenated with the letter "V" and the ICN CHECKSUM field
"BLD",4855,1,35,0)
(#991.02) from the PATIENT file (#2) and is sent as the 18th subscript of
"BLD",4855,1,36,0)
the PID segment. (See example under item 1 below).
"BLD",4855,1,37,0)
 
"BLD",4855,1,38,0)
 
"BLD",4855,1,39,0)
When the CMOP WARNING LABEL SOURCE is "New", the format and/or content of
"BLD",4855,1,40,0)
the following segments will be changed:
"BLD",4855,1,41,0)
 
"BLD",4855,1,42,0)
1. For the Patient Identification (PID) segment, the Patient Medication
"BLD",4855,1,43,0)
Instruction (PMI) preference will be sent as "ENG" for English or "SPA"
"BLD",4855,1,44,0)
for Spanish instead of the current numeric values.
"BLD",4855,1,45,0)
 
"BLD",4855,1,46,0)
   Example:
"BLD",4855,1,47,0)
PID||000007890^1^M11||OPPATIENT^ONE||||12345 S MAIN ST^ADDRESS |
"BLD",4855,1,48,0)
LINE2^MADISON ^WI^53705|(000)555-1212|SPA||1011007381V739824
"BLD",4855,1,49,0)
 
"BLD",4855,1,50,0)
2. Currently, the first part of the English language medication 
"BLD",4855,1,51,0)
instruction (SIG) is sent in the RX1 segment and continuations are sent in
"BLD",4855,1,52,0)
NTE|7 segments. Additional fields added to the NTE|7| segment when the 
"BLD",4855,1,53,0)
new|
"BLD",4855,1,54,0)
warning source flag is set are:
"BLD",4855,1,55,0)
 
"BLD",4855,1,56,0)
NTE|7|RX NUMBER|LANGUAGE CODE|NUMBER|TEXT  (TEXT is up to 100 characters |
"BLD",4855,1,57,0)
per NTE|7| segment) 
"BLD",4855,1,58,0)
Where: 
"BLD",4855,1,59,0)
       RX NUMBER is the external prescription number from the PRESCRIPTION
"BLD",4855,1,60,0)
         file (#52). 
"BLD",4855,1,61,0)
       LANGUAGE CODE will be "ENG" for English or "SPA" for Spanish. 
"BLD",4855,1,62,0)
       NUMBER is a sequence number for the SIG lines starting at 1 for
"BLD",4855,1,63,0)
         each different language code.
"BLD",4855,1,64,0)
 
"BLD",4855,1,65,0)
   Example:
"BLD",4855,1,66,0)
RX1|500-300993-1||||||90|D0132^DOXEPIN HCL 25MG CAP^L|||11|
"BLD",4855,1,67,0)
20061122|11| |20071123|20061122|300993||TAKE TWO CAPSULES MOUTH THREE
"BLD",4855,1,68,0)
TIMES A DAY FOR 7 D AYS, THEN TAKE ONE CAPSULE
"BLD",4855,1,69,0)
NTE|7|300993|ENG|1|TWICE A DAY FOR 7 DAYS, THEN TAKE ONE CAPSULE AT |
"BLD",4855,1,70,0)
BEDTIME FOR 7 DAYS, THEN TAKE
"BLD",4855,1,71,0)
NTE|7|300993|ENG|2|ONE CAPSULE EVERY OTHER DAY FOR 7 DAYS |
"BLD",4855,1,72,0)
NTE|7|300993|SPA|1|TAKE DOS CAPSULES MOUTH THREE TIMES A DAY PARA 7 DIAS, 
"BLD",4855,1,73,0)
|
"BLD",4855,1,74,0)
THEN TAKE UNO CAPSULE
"BLD",4855,1,75,0)
NTE|7|300993|SPA|2|TWICE A DAY PARA 7 DIAS, THEN TAKE UNO CAPSULE AT |
"BLD",4855,1,76,0)
BEDTIME PARA 7 DIAS, THEN
"BLD",4855,1,77,0)
NTE|7|300993|SPA|3|TAKE UNO CAPSULE EVERY OTHER DAY PARA 7 DIAS |
"BLD",4855,1,78,0)
 
"BLD",4855,1,79,0)
 
"BLD",4855,1,80,0)
3. Instead of sending warning label numbers in the ZX1 segment, the 
"BLD",4855,1,81,0)
warning label text will be sent in the new NTE|11|segments.
"BLD",4855,1,82,0)
 
"BLD",4855,1,83,0)
Note: A maximum of 5 warning labels can be printed, so only the first 5 
"BLD",4855,1,84,0)
for a drug will be sent to CMOP. If the patient has a PMI Language 
"BLD",4855,1,85,0)
Preference other than English, the first 5 warning labels in each 
"BLD",4855,1,86,0)
language will be sent.
"BLD",4855,1,87,0)
 
"BLD",4855,1,88,0)
The fields for the new warning labels are: 
"BLD",4855,1,89,0)
NTE|11|RX NUMBER|LANGUAGE CODE|RECORD NUMBER|WARNING LABEL TEXT|
"BLD",4855,1,90,0)
Where: 
"BLD",4855,1,91,0)
       RX NUMBER is the external prescription number from the  
"BLD",4855,1,92,0)
         PRESCRIPTION file (#52). 
"BLD",4855,1,93,0)
       LANGUAGE CODE will be "ENG" for English or "SPA" for Spanish. 
"BLD",4855,1,94,0)
       RECORD NUMBER is either the internal entry number from the RX 
"BLD",4855,1,95,0)
         CONSULT file (#54) or the internal entry number from the WARNING
"BLD",4855,1,96,0)
         LABEL-ENGLISH file (#50.625) followed by an "N" when the LANGUAGE
"BLD",4855,1,97,0)
         CODE is "ENG" or the internal entry number from the WARNING
"BLD",4855,1,98,0)
         LABEL-SPANISH file (#50.626) followed by an "N" when the LANGUAGE
"BLD",4855,1,99,0)
         CODE is "SPA". 
"BLD",4855,1,100,0)
       WARNING LABEL TEXT is the complete text of the specified warning 
"BLD",4855,1,101,0)
         number (maximum length is 200 characters). 
"BLD",4855,1,102,0)
   
"BLD",4855,1,103,0)
   Example: 
"BLD",4855,1,104,0)
ZX1|300993|514^TROY|M|1|(1of12)|WHITE,ELAINE|1|(***/***)|20061122|1|1|1|30
"BLD",4855,1,105,0)
|
"BLD",4855,1,106,0)
|500
"BLD",4855,1,107,0)
-5294709|SCL50|UNKNOWN|
"BLD",4855,1,108,0)
NTE|11|300993|ENG|1N|May cause drowsiness.  Alcohol may intensify this |
"BLD",4855,1,109,0)
effect. Use care when operating a car or dangerous machines.
"BLD",4855,1,110,0)
NTE|11|300993|ENG|62N|May cause dizziness|
"BLD",4855,1,111,0)
NTE|11|300993|ENG|11N|Avoid prolonged or excessive exposure to direct |
"BLD",4855,1,112,0)
and/or ar
"BLD",4855,1,113,0)
tificial sunlight while taking this medication.
"BLD",4855,1,114,0)
NTE|11|300993|ENG|61N|May cause blurred vision|
"BLD",4855,1,115,0)
NTE|11|300993|ENG|13N|It is very important that you take or use this |
"BLD",4855,1,116,0)
exactly as directed.  Do not skip doses or discontinue unless directed by
"BLD",4855,1,117,0)
your doctor.
"BLD",4855,1,118,0)
NTE|11|300993|SPA|1N|Puede causar somnolencia. El alcohol puede |
"BLD",4855,1,119,0)
intensificar es te efecto. Tenga cuidado cuando conduzca veh!culos
"BLD",4855,1,120,0)
automotores u opere maquinar ia peligrosa.
"BLD",4855,1,121,0)
NTE|11|300993|SPA|62N|Puede causar mareo.|
"BLD",4855,1,122,0)
NTE|11|300993|SPA|11N|Evite exponerse excesivamente o por per!odos |
"BLD",4855,1,123,0)
prolongados a los rayos solares directos y/o artificiales mientras tome
"BLD",4855,1,124,0)
este medicamento.
"BLD",4855,1,125,0)
NTE|11|300993|SPA|61N|Puede causar visi"n borrosa.|
"BLD",4855,1,126,0)
NTE|11|300993|SPA|13N|Es muy importante que lo tome o lo use exactamente |
"BLD",4855,1,127,0)
seg#n las indicaciones. No omita ninguna dosis ni lo deje de usar a menos
"BLD",4855,1,128,0)
que lo mande el mdico.
"BLD",4855,1,129,0)
 
"BLD",4855,1,130,0)
 
"BLD",4855,1,131,0)
Also included in this patch is a fix for several Remedy tickets regarding 
"BLD",4855,1,132,0)
a null subscript when a prescription was discontinued during transmission.
"BLD",4855,1,133,0)
If the prescription was discontinued, the CMOP TRANSMISSION file (#550.2)
"BLD",4855,1,134,0)
reference for that prescription is cleaned up.
"BLD",4855,1,135,0)
 
"BLD",4855,1,136,0)
Also added to this patch is the check for the value of the PROJ 112/SHAD
"BLD",4855,1,137,0)
field (#122.01) in the PRESCRIPTION file (#52) as an additional
"BLD",4855,1,138,0)
Environmental Indicator check to determine whether to send a copay or no 
"BLD",4855,1,139,0)
copay indicator to CMOP. The patch that creates this new field, PSO*7*225,
"BLD",4855,1,140,0)
will be released along with Computerized Patient Record System (CPRS)
"BLD",4855,1,141,0)
GUI27. The added check in this patch will have no effect until PSO*7*225 
"BLD",4855,1,142,0)
is installed.
"BLD",4855,4,0)
^9.64PA^^
"BLD",4855,6.3)
6
"BLD",4855,"KRN",0)
^9.67PA^8989.52^19
"BLD",4855,"KRN",.4,0)
.4
"BLD",4855,"KRN",.401,0)
.401
"BLD",4855,"KRN",.402,0)
.402
"BLD",4855,"KRN",.403,0)
.403
"BLD",4855,"KRN",.5,0)
.5
"BLD",4855,"KRN",.84,0)
.84
"BLD",4855,"KRN",3.6,0)
3.6
"BLD",4855,"KRN",3.8,0)
3.8
"BLD",4855,"KRN",9.2,0)
9.2
"BLD",4855,"KRN",9.8,0)
9.8
"BLD",4855,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4855,"KRN",9.8,"NM",1,0)
PSXBLD^^0^B68209583
"BLD",4855,"KRN",9.8,"NM",2,0)
PSXRXQU^^0^B15657498
"BLD",4855,"KRN",9.8,"NM",3,0)
PSXBLD2^^0^B1742280
"BLD",4855,"KRN",9.8,"NM",4,0)
PSXERR^^0^B35308373
"BLD",4855,"KRN",9.8,"NM",5,0)
PSXMISC1^^0^B38388550
"BLD",4855,"KRN",9.8,"NM","B","PSXBLD",1)

"BLD",4855,"KRN",9.8,"NM","B","PSXBLD2",3)

"BLD",4855,"KRN",9.8,"NM","B","PSXERR",4)

"BLD",4855,"KRN",9.8,"NM","B","PSXMISC1",5)

"BLD",4855,"KRN",9.8,"NM","B","PSXRXQU",2)

"BLD",4855,"KRN",19,0)
19
"BLD",4855,"KRN",19.1,0)
19.1
"BLD",4855,"KRN",101,0)
101
"BLD",4855,"KRN",409.61,0)
409.61
"BLD",4855,"KRN",771,0)
771
"BLD",4855,"KRN",870,0)
870
"BLD",4855,"KRN",8989.51,0)
8989.51
"BLD",4855,"KRN",8989.52,0)
8989.52
"BLD",4855,"KRN",8994,0)
8994
"BLD",4855,"KRN","B",.4,.4)

"BLD",4855,"KRN","B",.401,.401)

"BLD",4855,"KRN","B",.402,.402)

"BLD",4855,"KRN","B",.403,.403)

"BLD",4855,"KRN","B",.5,.5)

"BLD",4855,"KRN","B",.84,.84)

"BLD",4855,"KRN","B",3.6,3.6)

"BLD",4855,"KRN","B",3.8,3.8)

"BLD",4855,"KRN","B",9.2,9.2)

"BLD",4855,"KRN","B",9.8,9.8)

"BLD",4855,"KRN","B",19,19)

"BLD",4855,"KRN","B",19.1,19.1)

"BLD",4855,"KRN","B",101,101)

"BLD",4855,"KRN","B",409.61,409.61)

"BLD",4855,"KRN","B",771,771)

"BLD",4855,"KRN","B",870,870)

"BLD",4855,"KRN","B",8989.51,8989.51)

"BLD",4855,"KRN","B",8989.52,8989.52)

"BLD",4855,"KRN","B",8994,8994)

"BLD",4855,"QUES",0)
^9.62^^
"BLD",4855,"REQB",0)
^9.611^3^2
"BLD",4855,"REQB",1,0)
PSX*2.0*50^2
"BLD",4855,"REQB",3,0)
PSX*2.0*52^2
"BLD",4855,"REQB","B","PSX*2.0*50",1)

"BLD",4855,"REQB","B","PSX*2.0*52",3)

"MBREQ")
0
"PKG",526,-1)
1^1
"PKG",526,0)
CMOP^PSX^CONSOLIDATED MAIL OUTPATIENT PHARMACY
"PKG",526,20,0)
^9.402P^^
"PKG",526,22,0)
^9.49I^1^1
"PKG",526,22,1,0)
2.0^3000210^3000217^11853
"PKG",526,22,1,"PAH",1,0)
54^3061124
"PKG",526,22,1,"PAH",1,1,0)
^^142^142^3061124
"PKG",526,22,1,"PAH",1,1,1,0)
As part of the Outpatient Pharmacy V. 7.0 Laser Labels Phase II project, 
"PKG",526,22,1,"PAH",1,1,2,0)
a new commercial data source is utilized to provide warning label source
"PKG",526,22,1,"PAH",1,1,3,0)
information. The new warning labels are enabled for printing on the laser 
"PKG",526,22,1,"PAH",1,1,4,0)
labels when the WARNING LABEL SOURCE field (#16) of the PHARMACY SYSTEM
"PKG",526,22,1,"PAH",1,1,5,0)
file (#59.7) is set to "N" for "New". Parameters for using the new 
"PKG",526,22,1,"PAH",1,1,6,0)
warning labels are set using the Pharmacy System Parameters Edit [PSS SYS 
"PKG",526,22,1,"PAH",1,1,7,0)
EDIT] option.
"PKG",526,22,1,"PAH",1,1,8,0)
 
"PKG",526,22,1,"PAH",1,1,9,0)
For the Consolidated Mail Outpatient Pharmacy (CMOP) to utilize the new 
"PKG",526,22,1,"PAH",1,1,10,0)
warning labels, this patch uses a new CMOP WARNING LABEL SOURCE field 
"PKG",526,22,1,"PAH",1,1,11,0)
(#16.1) in the PHARMACY SYSTEM file (#59.7), also set by using the 
"PKG",526,22,1,"PAH",1,1,12,0)
Pharmacy System Parameters Edit [PSS SYS EDIT] option. This should be set
"PKG",526,22,1,"PAH",1,1,13,0)
to "N" for "New" to send the new warnings to CMOP. This field is added by 
"PKG",526,22,1,"PAH",1,1,14,0)
patch PSS*1*120.
"PKG",526,22,1,"PAH",1,1,15,0)
 
"PKG",526,22,1,"PAH",1,1,16,0)
If the BAD ADDRESS INDICATOR field (#.121) in the PATIENT file (#2) is set
"PKG",526,22,1,"PAH",1,1,17,0)
and there is no active temporary address for the patient, the fill will
"PKG",526,22,1,"PAH",1,1,18,0)
appear on the CMOP reject log and will remain in suspense, but unmarked
"PKG",526,22,1,"PAH",1,1,19,0)
for CMOP. It will print when the local print from suspense is done to be 
"PKG",526,22,1,"PAH",1,1,20,0)
filled locally.
"PKG",526,22,1,"PAH",1,1,21,0)
 
"PKG",526,22,1,"PAH",1,1,22,0)
 
"PKG",526,22,1,"PAH",1,1,23,0)
**************** NOTE ***************************************************
"PKG",526,22,1,"PAH",1,1,24,0)
As the CMOP side also had to make programming changes, verify that the
"PKG",526,22,1,"PAH",1,1,25,0)
CMOP that your site sends to can receive the new warning label format.
"PKG",526,22,1,"PAH",1,1,26,0)
Then after setting the CMOP WARNING LABEL SOURCE field (#16.1) to "New",
"PKG",526,22,1,"PAH",1,1,27,0)
send a small batch and verify that it was received and able to be
"PKG",526,22,1,"PAH",1,1,28,0)
processed successfully. (As of the release of this patch, only the Bedford
"PKG",526,22,1,"PAH",1,1,29,0)
CMOP was not yet ready to receive the new format).
"PKG",526,22,1,"PAH",1,1,30,0)
**************************************************************************
"PKG",526,22,1,"PAH",1,1,31,0)
 
"PKG",526,22,1,"PAH",1,1,32,0)
This patch adds the sending of the INTEGRATION CONTROL NUMBER field 
"PKG",526,22,1,"PAH",1,1,33,0)
(#991.01) from the PATIENT file (#2) if it is a national number. This 
"PKG",526,22,1,"PAH",1,1,34,0)
number is concatenated with the letter "V" and the ICN CHECKSUM field
"PKG",526,22,1,"PAH",1,1,35,0)
(#991.02) from the PATIENT file (#2) and is sent as the 18th subscript of
"PKG",526,22,1,"PAH",1,1,36,0)
the PID segment. (See example under item 1 below).
"PKG",526,22,1,"PAH",1,1,37,0)
 
"PKG",526,22,1,"PAH",1,1,38,0)
 
"PKG",526,22,1,"PAH",1,1,39,0)
When the CMOP WARNING LABEL SOURCE is "New", the format and/or content of
"PKG",526,22,1,"PAH",1,1,40,0)
the following segments will be changed:
"PKG",526,22,1,"PAH",1,1,41,0)
 
"PKG",526,22,1,"PAH",1,1,42,0)
1. For the Patient Identification (PID) segment, the Patient Medication
"PKG",526,22,1,"PAH",1,1,43,0)
Instruction (PMI) preference will be sent as "ENG" for English or "SPA"
"PKG",526,22,1,"PAH",1,1,44,0)
for Spanish instead of the current numeric values.
"PKG",526,22,1,"PAH",1,1,45,0)
 
"PKG",526,22,1,"PAH",1,1,46,0)
   Example:
"PKG",526,22,1,"PAH",1,1,47,0)
PID||000007890^1^M11||OPPATIENT^ONE||||12345 S MAIN ST^ADDRESS |
"PKG",526,22,1,"PAH",1,1,48,0)
LINE2^MADISON ^WI^53705|(000)555-1212|SPA||1011007381V739824
"PKG",526,22,1,"PAH",1,1,49,0)
 
"PKG",526,22,1,"PAH",1,1,50,0)
2. Currently, the first part of the English language medication 
"PKG",526,22,1,"PAH",1,1,51,0)
instruction (SIG) is sent in the RX1 segment and continuations are sent in
"PKG",526,22,1,"PAH",1,1,52,0)
NTE|7 segments. Additional fields added to the NTE|7| segment when the 
"PKG",526,22,1,"PAH",1,1,53,0)
new|
"PKG",526,22,1,"PAH",1,1,54,0)
warning source flag is set are:
"PKG",526,22,1,"PAH",1,1,55,0)
 
"PKG",526,22,1,"PAH",1,1,56,0)
NTE|7|RX NUMBER|LANGUAGE CODE|NUMBER|TEXT  (TEXT is up to 100 characters |
"PKG",526,22,1,"PAH",1,1,57,0)
per NTE|7| segment) 
"PKG",526,22,1,"PAH",1,1,58,0)
Where: 
"PKG",526,22,1,"PAH",1,1,59,0)
       RX NUMBER is the external prescription number from the PRESCRIPTION
"PKG",526,22,1,"PAH",1,1,60,0)
         file (#52). 
"PKG",526,22,1,"PAH",1,1,61,0)
       LANGUAGE CODE will be "ENG" for English or "SPA" for Spanish. 
"PKG",526,22,1,"PAH",1,1,62,0)
       NUMBER is a sequence number for the SIG lines starting at 1 for
"PKG",526,22,1,"PAH",1,1,63,0)
         each different language code.
"PKG",526,22,1,"PAH",1,1,64,0)
 
"PKG",526,22,1,"PAH",1,1,65,0)
   Example:
"PKG",526,22,1,"PAH",1,1,66,0)
RX1|500-300993-1||||||90|D0132^DOXEPIN HCL 25MG CAP^L|||11|
"PKG",526,22,1,"PAH",1,1,67,0)
20061122|11| |20071123|20061122|300993||TAKE TWO CAPSULES MOUTH THREE
"PKG",526,22,1,"PAH",1,1,68,0)
TIMES A DAY FOR 7 D AYS, THEN TAKE ONE CAPSULE
"PKG",526,22,1,"PAH",1,1,69,0)
NTE|7|300993|ENG|1|TWICE A DAY FOR 7 DAYS, THEN TAKE ONE CAPSULE AT |
"PKG",526,22,1,"PAH",1,1,70,0)
BEDTIME FOR 7 DAYS, THEN TAKE
"PKG",526,22,1,"PAH",1,1,71,0)
NTE|7|300993|ENG|2|ONE CAPSULE EVERY OTHER DAY FOR 7 DAYS |
"PKG",526,22,1,"PAH",1,1,72,0)
NTE|7|300993|SPA|1|TAKE DOS CAPSULES MOUTH THREE TIMES A DAY PARA 7 DIAS, 
"PKG",526,22,1,"PAH",1,1,73,0)
|
"PKG",526,22,1,"PAH",1,1,74,0)
THEN TAKE UNO CAPSULE
"PKG",526,22,1,"PAH",1,1,75,0)
NTE|7|300993|SPA|2|TWICE A DAY PARA 7 DIAS, THEN TAKE UNO CAPSULE AT |
"PKG",526,22,1,"PAH",1,1,76,0)
BEDTIME PARA 7 DIAS, THEN
"PKG",526,22,1,"PAH",1,1,77,0)
NTE|7|300993|SPA|3|TAKE UNO CAPSULE EVERY OTHER DAY PARA 7 DIAS |
"PKG",526,22,1,"PAH",1,1,78,0)
 
"PKG",526,22,1,"PAH",1,1,79,0)
 
"PKG",526,22,1,"PAH",1,1,80,0)
3. Instead of sending warning label numbers in the ZX1 segment, the 
"PKG",526,22,1,"PAH",1,1,81,0)
warning label text will be sent in the new NTE|11|segments.
"PKG",526,22,1,"PAH",1,1,82,0)
 
"PKG",526,22,1,"PAH",1,1,83,0)
Note: A maximum of 5 warning labels can be printed, so only the first 5 
"PKG",526,22,1,"PAH",1,1,84,0)
for a drug will be sent to CMOP. If the patient has a PMI Language 
"PKG",526,22,1,"PAH",1,1,85,0)
Preference other than English, the first 5 warning labels in each 
"PKG",526,22,1,"PAH",1,1,86,0)
language will be sent.
"PKG",526,22,1,"PAH",1,1,87,0)
 
"PKG",526,22,1,"PAH",1,1,88,0)
The fields for the new warning labels are: 
"PKG",526,22,1,"PAH",1,1,89,0)
NTE|11|RX NUMBER|LANGUAGE CODE|RECORD NUMBER|WARNING LABEL TEXT|
"PKG",526,22,1,"PAH",1,1,90,0)
Where: 
"PKG",526,22,1,"PAH",1,1,91,0)
       RX NUMBER is the external prescription number from the  
"PKG",526,22,1,"PAH",1,1,92,0)
         PRESCRIPTION file (#52). 
"PKG",526,22,1,"PAH",1,1,93,0)
       LANGUAGE CODE will be "ENG" for English or "SPA" for Spanish. 
"PKG",526,22,1,"PAH",1,1,94,0)
       RECORD NUMBER is either the internal entry number from the RX 
"PKG",526,22,1,"PAH",1,1,95,0)
         CONSULT file (#54) or the internal entry number from the WARNING
"PKG",526,22,1,"PAH",1,1,96,0)
         LABEL-ENGLISH file (#50.625) followed by an "N" when the LANGUAGE
"PKG",526,22,1,"PAH",1,1,97,0)
         CODE is "ENG" or the internal entry number from the WARNING
"PKG",526,22,1,"PAH",1,1,98,0)
         LABEL-SPANISH file (#50.626) followed by an "N" when the LANGUAGE
"PKG",526,22,1,"PAH",1,1,99,0)
         CODE is "SPA". 
"PKG",526,22,1,"PAH",1,1,100,0)
       WARNING LABEL TEXT is the complete text of the specified warning 
"PKG",526,22,1,"PAH",1,1,101,0)
         number (maximum length is 200 characters). 
"PKG",526,22,1,"PAH",1,1,102,0)
   
"PKG",526,22,1,"PAH",1,1,103,0)
   Example: 
"PKG",526,22,1,"PAH",1,1,104,0)
ZX1|300993|514^TROY|M|1|(1of12)|WHITE,ELAINE|1|(***/***)|20061122|1|1|1|30
"PKG",526,22,1,"PAH",1,1,105,0)
|
"PKG",526,22,1,"PAH",1,1,106,0)
|500
"PKG",526,22,1,"PAH",1,1,107,0)
-5294709|SCL50|UNKNOWN|
"PKG",526,22,1,"PAH",1,1,108,0)
NTE|11|300993|ENG|1N|May cause drowsiness.  Alcohol may intensify this |
"PKG",526,22,1,"PAH",1,1,109,0)
effect. Use care when operating a car or dangerous machines.
"PKG",526,22,1,"PAH",1,1,110,0)
NTE|11|300993|ENG|62N|May cause dizziness|
"PKG",526,22,1,"PAH",1,1,111,0)
NTE|11|300993|ENG|11N|Avoid prolonged or excessive exposure to direct |
"PKG",526,22,1,"PAH",1,1,112,0)
and/or ar
"PKG",526,22,1,"PAH",1,1,113,0)
tificial sunlight while taking this medication.
"PKG",526,22,1,"PAH",1,1,114,0)
NTE|11|300993|ENG|61N|May cause blurred vision|
"PKG",526,22,1,"PAH",1,1,115,0)
NTE|11|300993|ENG|13N|It is very important that you take or use this |
"PKG",526,22,1,"PAH",1,1,116,0)
exactly as directed.  Do not skip doses or discontinue unless directed by
"PKG",526,22,1,"PAH",1,1,117,0)
your doctor.
"PKG",526,22,1,"PAH",1,1,118,0)
NTE|11|300993|SPA|1N|Puede causar somnolencia. El alcohol puede |
"PKG",526,22,1,"PAH",1,1,119,0)
intensificar es te efecto. Tenga cuidado cuando conduzca veh!culos
"PKG",526,22,1,"PAH",1,1,120,0)
automotores u opere maquinar ia peligrosa.
"PKG",526,22,1,"PAH",1,1,121,0)
NTE|11|300993|SPA|62N|Puede causar mareo.|
"PKG",526,22,1,"PAH",1,1,122,0)
NTE|11|300993|SPA|11N|Evite exponerse excesivamente o por per!odos |
"PKG",526,22,1,"PAH",1,1,123,0)
prolongados a los rayos solares directos y/o artificiales mientras tome
"PKG",526,22,1,"PAH",1,1,124,0)
este medicamento.
"PKG",526,22,1,"PAH",1,1,125,0)
NTE|11|300993|SPA|61N|Puede causar visi"n borrosa.|
"PKG",526,22,1,"PAH",1,1,126,0)
NTE|11|300993|SPA|13N|Es muy importante que lo tome o lo use exactamente |
"PKG",526,22,1,"PAH",1,1,127,0)
seg#n las indicaciones. No omita ninguna dosis ni lo deje de usar a menos
"PKG",526,22,1,"PAH",1,1,128,0)
que lo mande el mdico.
"PKG",526,22,1,"PAH",1,1,129,0)
 
"PKG",526,22,1,"PAH",1,1,130,0)
 
"PKG",526,22,1,"PAH",1,1,131,0)
Also included in this patch is a fix for several Remedy tickets regarding 
"PKG",526,22,1,"PAH",1,1,132,0)
a null subscript when a prescription was discontinued during transmission.
"PKG",526,22,1,"PAH",1,1,133,0)
If the prescription was discontinued, the CMOP TRANSMISSION file (#550.2)
"PKG",526,22,1,"PAH",1,1,134,0)
reference for that prescription is cleaned up.
"PKG",526,22,1,"PAH",1,1,135,0)
 
"PKG",526,22,1,"PAH",1,1,136,0)
Also added to this patch is the check for the value of the PROJ 112/SHAD
"PKG",526,22,1,"PAH",1,1,137,0)
field (#122.01) in the PRESCRIPTION file (#52) as an additional
"PKG",526,22,1,"PAH",1,1,138,0)
Environmental Indicator check to determine whether to send a copay or no 
"PKG",526,22,1,"PAH",1,1,139,0)
copay indicator to CMOP. The patch that creates this new field, PSO*7*225,
"PKG",526,22,1,"PAH",1,1,140,0)
will be released along with Computerized Patient Record System (CPRS)
"PKG",526,22,1,"PAH",1,1,141,0)
GUI27. The added check in this patch will have no effect until PSO*7*225 
"PKG",526,22,1,"PAH",1,1,142,0)
is installed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSXBLD")
0^1^B68209583^B54134734
"RTN","PSXBLD",1,0)
PSXBLD ;BIR/BAB-Build HL7 Data for CMOP Rx Queue ;24 Jun 2002  5:19 PM
"RTN","PSXBLD",2,0)
 ;;2.0;CMOP;**3,23,29,28,43,41,50,54**;11 Apr 97;Build 6
"RTN","PSXBLD",3,0)
 ;
"RTN","PSXBLD",4,0)
 ;Reference to  ^PSRX(       supported by DBIA #1977
"RTN","PSXBLD",5,0)
 ;Reference to  ^PSDRUG(     supported by DBIA #1983
"RTN","PSXBLD",6,0)
 ;Reference to  ^PS(51,      supported by DBIA #1980
"RTN","PSXBLD",7,0)
 ;Reference to  ^PS(52.5     supported by DBIA #1978
"RTN","PSXBLD",8,0)
 ;Reference to  ^PS(53,      supported by DBIA #1975
"RTN","PSXBLD",9,0)
 ;Reference to  ^PS(55,      supported by DBIA #2228
"RTN","PSXBLD",10,0)
 ;Reference to  ^PS(59,      supported by DBIA #1976
"RTN","PSXBLD",11,0)
 ;Reference to  ^PS(59.7,    supported by DBIA #694
"RTN","PSXBLD",12,0)
 ;Reference to  ^DPT(        supported by DBIA #3097
"RTN","PSXBLD",13,0)
 ;Reference to IBCP^PSOLBL   supported by DBIA #2477
"RTN","PSXBLD",14,0)
 ;Reference to OTHL1^PSOLBL3 supported by DBIA #4071
"RTN","PSXBLD",15,0)
 ;Reference to EN^PSOHLSN1   supported by DBIA #2385
"RTN","PSXBLD",16,0)
 ;Reference to PROD2^PSNAPIS supported by DBIA #2531
"RTN","PSXBLD",17,0)
 ;Reference to DRUG^PSSWRNA supported by DBIA #4449
"RTN","PSXBLD",18,0)
EN ; build entries into 550.1 by alpha patient
"RTN","PSXBLD",19,0)
 D SET^PSXSYS
"RTN","PSXBLD",20,0)
 ;Clear 550.1
"RTN","PSXBLD",21,0)
 ; of entries
"RTN","PSXBLD",22,0)
 K DIK,DA S DIK="^PSX(550.1,",DA=0 F  S DA=$O(^PSX(550.1,DA)) Q:DA'>0  D ^DIK
"RTN","PSXBLD",23,0)
 ; walk down the PTNM,DFN,RX,FILL 'C' index of PSX(550.2,PSXBAT,15,'C' - RX multiple
"RTN","PSXBLD",24,0)
 ; Alpha order by patient name
"RTN","PSXBLD",25,0)
 S PSXNM="",ZCNT=0,PSXMSG=0 ;PSXMSG now starts at 1 every batch incremented in NEWMSG^PSXRXQU
"RTN","PSXBLD",26,0)
 S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXBLD",27,0)
 F  S PSXNM=$O(^PSX(550.2,PSXBAT,15,"C",PSXNM)) Q:PSXNM']""  D
"RTN","PSXBLD",28,0)
 . S DFN="" F  S DFN=$O(^PSX(550.2,PSXBAT,15,"C",PSXNM,DFN)) Q:DFN'>0  D
"RTN","PSXBLD",29,0)
 .. S MSG=0 K PSX,PSXORD
"RTN","PSXBLD",30,0)
 .. D NEWMSG^PSXRXQU,ORD,MRX^PSXBLD1,LOADMSG^PSXRXQU
"RTN","PSXBLD",31,0)
 D DIV^PSXBLD1 ;build NTE1
"RTN","PSXBLD",32,0)
 K MSG,PSXNM,DFN,RX,RXF,REG,PSCAP,X,Y,PSXPTR,PSSWSITE
"RTN","PSXBLD",33,0)
 Q
"RTN","PSXBLD",34,0)
ORD ; PSXMSG was returned by call to NEWMSG^PSXRXQU
"RTN","PSXBLD",35,0)
 ; Loop RXs, RXFs in Transmission PSXBAT
"RTN","PSXBLD",36,0)
 S REG=$S($P($G(^PS(55,DFN,0)),"^",3)=1:1,1:""),PSCAP=+$P($G(^PS(55,DFN,0)),"^",2),RX=0 K RXY,RXY1
"RTN","PSXBLD",37,0)
 S RX=0 F  S RX=$O(^PSX(550.2,PSXBAT,15,"C",PSXNM,DFN,RX)) Q:RX'>0  D
"RTN","PSXBLD",38,0)
 . S REC=$O(^PS(52.5,"B",RX,0))
"RTN","PSXBLD",39,0)
 . I 'REC D DEL5502 Q  ;RX was removed from 52.5 during transmission
"RTN","PSXBLD",40,0)
 . S RXY=^PSRX(RX,0),RXF=$O(^PSX(550.2,PSXBAT,15,"C",PSXNM,DFN,RX,0))
"RTN","PSXBLD",41,0)
 . S PTR=RX S:RXF>0 RXY1=$G(^PSRX(RX,1,RXF,0)) D ORC ;builds RX HL7 segments into PSXORD(
"RTN","PSXBLD",42,0)
 . I PSXFLAG=1 S ^PS(52.5,REC,"P")=1,^PS(52.5,"ADL",DT,REC)="" ;update print node
"RTN","PSXBLD",43,0)
 . D RXMSG^PSXRXQU ;put RX,RXF  into PSXMSG 550.1 RX multiple ; returns PSXRXMDA
"RTN","PSXBLD",44,0)
 . ;D FILE^PSXRXU ;update 52 & 52.5
"RTN","PSXBLD",45,0)
 . I PSXFLAG=1 D EN^PSOHLSN1(RX,"SC","ZU","Transmitted to CMOP","")
"RTN","PSXBLD",46,0)
 K PSCLN,ZDU,FDT,DRUG,RXN,WARN,TECH,QTY,PHYS,DAYS,LSTFIL,COPAY,DEA,P,PTST,REF,VRPH,RXY,RXY1
"RTN","PSXBLD",47,0)
 Q
"RTN","PSXBLD",48,0)
ORC ;builds RX HL7 segments into PSXORD(
"RTN","PSXBLD",49,0)
 Q:($G(RXF)>0&($G(RXY1)=""))
"RTN","PSXBLD",50,0)
 N PSOLBLCP
"RTN","PSXBLD",51,0)
 S PSX(RX)=RXF,MSG=MSG+1,FDT=$P(^PSRX(RX,2),"^",2),PSXORD(MSG)="ORC|NW|"
"RTN","PSXBLD",52,0)
 S X=+$G(^PSRX(RX,"IB")),COPAY=$S(X=1:1,X=2:1,1:"") K X S RXN=$P(RXY,"^"),VRPH=$P($G(^PSRX(RX,2)),"^",10)
"RTN","PSXBLD",53,0)
 D COPAYCK ; DO ADDITIONAL CHECKS TO DETERMINE CURRENT COPAY STATUS
"RTN","PSXBLD",54,0)
 S (DRUG,WARN,DEA)="" I $D(^PSDRUG(+$P(RXY,"^",6),0)) S DRUG=$P(^(0),"^"),WARN=$P(^(0),"^",8),DEA=$P(^(0),"^",3) S Y=DRUG D STRIP S DRUG=Y K Y
"RTN","PSXBLD",55,0)
 I '$D(PSSWSITE) S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXBLD",56,0)
 I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" D
"RTN","PSXBLD",57,0)
 .S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),DFN)
"RTN","PSXBLD",58,0)
 I $G(DRUG) S ZDU=$P($G(^PSDRUG(DRUG,660)),"^",8)
"RTN","PSXBLD",59,0)
 S ISD=$P(RXY,"^",13),ISD=ISD+17000000
"RTN","PSXBLD",60,0)
 G:RXF>0 REF
"RTN","PSXBLD",61,0)
 S TECH=+$P(RXY,"^",16),QTY=$P(RXY,"^",7),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN"),DAYS=$P(RXY,"^",8)
"RTN","PSXBLD",62,0)
 S ZFIL=$G(^PSRX(RX,3))
"RTN","PSXBLD",63,0)
 S LSTFIL=$S(+$P(ZFIL,"^",4):$P(ZFIL,"^",4),1:+$P(ZFIL,"^"))
"RTN","PSXBLD",64,0)
 S LSTFIL=LSTFIL+17000000
"RTN","PSXBLD",65,0)
 S EXPDT=$P(^PSRX(RX,2),U,6) S:+EXPDT EXPDT=EXPDT+17000000
"RTN","PSXBLD",66,0)
 G RX1
"RTN","PSXBLD",67,0)
REF ;
"RTN","PSXBLD",68,0)
 S TECH=+$P(RXY1,"^",7),QTY=$P(RXY1,"^",4),PHYS=$S($D(^VA(200,+$P(RXY1,"^",17),0)):$P(^(0),"^"),1:"UNKNOWN"),DAYS=$P(RXY1,"^",10)
"RTN","PSXBLD",69,0)
 S FDT=$P(RXY1,"^")
"RTN","PSXBLD",70,0)
 S ZFIL=$G(^PSRX(RX,3))
"RTN","PSXBLD",71,0)
 S LSTFIL=$S(+$P(ZFIL,"^",4):$P(ZFIL,"^",4),1:+$P(ZFIL,"^"))
"RTN","PSXBLD",72,0)
 S LSTFIL=LSTFIL+17000000
"RTN","PSXBLD",73,0)
 S EXPDT=$P(^PSRX(RX,2),"^",6),EXPDT=EXPDT+17000000
"RTN","PSXBLD",74,0)
RX1 ;
"RTN","PSXBLD",75,0)
 S X="RX1|",$P(X,"|",13)=QTY,$P(X,"|",21)=ISD,$P(X,"|",25)=EXPDT
"RTN","PSXBLD",76,0)
 S $P(X,"|",2)=+$P(PSXSYS,"^",2)_"-"_$P(RXY,"^")_"-"_(RXF+1)
"RTN","PSXBLD",77,0)
 S Y1=$P($G(^PSDRUG($P(RXY,"^",6),"ND")),U,3)
"RTN","PSXBLD",78,0)
 D DGST
"RTN","PSXBLD",79,0)
 S $P(X,"|",15)=$S($L($G(PSXDGST)):PSXDGST_"^L",1:"^^L")
"RTN","PSXBLD",80,0)
 S $P(X,"|",20)=$P(RXY,"^",9),$P(X,"|",22)=+$P(RXY,"^",9)-RXF
"RTN","PSXBLD",81,0)
 S $P(X,"|",26)=LSTFIL,$P(X,"|",27)=$P(RXY,"^")
"RTN","PSXBLD",82,0)
 K ZFIL S MSG=MSG+1,PSXORD(MSG)=X_"||||",FLG=0 D SIG K MAX,FLG,X
"RTN","PSXBLD",83,0)
ZX1 ;
"RTN","PSXBLD",84,0)
 S REFDIV=$S($P($G(^PS(59.7,1,40.1)),"^",4):$P(^(40.1),"^",4),1:PSOSITE)
"RTN","PSXBLD",85,0)
 S X="ZX1|"_$P(RXY,"^")_"|"_$P($G(^PS(59,REFDIV,0)),"^",6)_"^"_$P($G(^(0)),"^")_"|M|"
"RTN","PSXBLD",86,0)
 K REFDIV
"RTN","PSXBLD",87,0)
 ; Count number of CMOP rxs for this patient order
"RTN","PSXBLD",88,0)
 S Y=1,Y1=RX F  S Y1=$O(^TMP($J,"PSX",PSXNM,DFN,Y1)) Q:'Y1  S Y=Y+1
"RTN","PSXBLD",89,0)
 S $P(X,"|",5)=Y,$P(X,"|",6)="("_(RXF+1)_"of"_(1+$P(RXY,"^",9))_")",$P(X,"|",8)=REG K Y,Y1 S $P(X,"|",7)=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$E($P(^(0),"^",1),1,20),1:"UNKNOWN"),$P(X,"|",8)=REG K Y,Y1
"RTN","PSXBLD",90,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),$P(X,"|",9)="("_$G(TECH)_"/"_$S($D(VRPH):VRPH,1:" ")_")" S:$L($P(X,"|",9))>12 $P(X,"|",9)="(***/***)"
"RTN","PSXBLD",91,0)
 I '+$G(PSOINST) D:'+$G(PSXSYS) SET^PSXSYS S PSOINST=+$P(PSXSYS,"^",2)
"RTN","PSXBLD",92,0)
 S $P(X,"|",10)=1700+$E(FDT,1,3)_$E(FDT,4,7),$P(X,"|",11)=COPAY,$P(X,"|",13)=PSCAP,$P(X,"|",14)=DAYS,$P(X,"|",16)=PSOINST_"-"_RX
"RTN","PSXBLD",93,0)
 ;Addition for CS transmissions...1 if CS, "" if not...
"RTN","PSXBLD",94,0)
 S PSXCSB=$P(^PSRX(RX,0),"^",6),PSXCSC=$P($G(^PSDRUG(PSXCSB,0)),"^",3)
"RTN","PSXBLD",95,0)
 F PSXCSD=3:1:5 I PSXCSC[PSXCSD S PSXCSRX=1
"RTN","PSXBLD",96,0)
 S $P(X,"|",15)=$G(PSXCSRX) K PSXCSRX,PSXCSC,PSXCSB,PSXCSD
"RTN","PSXBLD",97,0)
 D WARN
"RTN","PSXBLD",98,0)
 S PTST=$G(^PS(53,$P(RXY,"^",3),0)),RNEW=1,REF=+$P(^PSRX(RX,0),"^",9)-RXF S:REF<0 REF=0 I REF=0 S:('$P(PTST,"^",5))!(DEA["A"&(DEA'["B"))!(DEA["W") RNEW=0
"RTN","PSXBLD",99,0)
 S $P(X,"|",12)=RNEW,PTST=$P(PTST,"^",2),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",1),1:"UNKNOWN") S $P(X,"|",18)=$E((PTST),1,20),$P(X,"|",19)=$E(PSCLN,1,20)
"RTN","PSXBLD",100,0)
 ;
"RTN","PSXBLD",101,0)
 K RNEW,SIG,SGY,ISD,EXPDT
"RTN","PSXBLD",102,0)
 S MSG=MSG+1,PSXORD(MSG)=X
"RTN","PSXBLD",103,0)
 S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXBLD",104,0)
 I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" D NEWWARN^PSXBLD2
"RTN","PSXBLD",105,0)
 Q
"RTN","PSXBLD",106,0)
A I $D(^PS(51,"A",X)) S %=^(X),X=$P(%,"^",1) I $P(%,"^",2)'="" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSXBLD",107,0)
 I (+$G(FLG)=0)&(($L(SGY)+$L(X))'>70) S SGY=SGY_X_" " Q
"RTN","PSXBLD",108,0)
 I (+$G(FLG)=1)&(($L(SGY)+$L(X))'>100) S SGY=SGY_X_" " Q
"RTN","PSXBLD",109,0)
 I $G(FLG)=1 S MSG=MSG+1,PSXORD(MSG)=$TR("NTE|7||"_SGY,"\","/"),SGY=X_" " Q
"RTN","PSXBLD",110,0)
 S PSXORD(MSG)=$TR(PSXORD(MSG)_SGY,"\","/"),SGY=X_" ",FLG=1
"RTN","PSXBLD",111,0)
 Q
"RTN","PSXBLD",112,0)
SIG ;
"RTN","PSXBLD",113,0)
 G:($P(^PSRX(RX,"SIG"),"^",2)=1) EXPAND
"RTN","PSXBLD",114,0)
 S SIG=$P(^PSRX(RX,"SIG"),"^")
"RTN","PSXBLD",115,0)
 S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D A:X]""
"RTN","PSXBLD",116,0)
 I SGY]"",FLG=0 S PSXORD(MSG)=$TR(PSXORD(MSG)_SGY,"\","/")
"RTN","PSXBLD",117,0)
 I SGY]"",FLG=1 S MSG=MSG+1,PSXORD(MSG)=$TR("NTE|7||"_SGY,"\","/")
"RTN","PSXBLD",118,0)
 I $D(^DPT(DFN,"NHC")),^("NHC")="Y" S MSG=MSG+1,PSXORD(MSG)=$TR("NTE|7||Exp:______ Mfg:______","\","/")
"RTN","PSXBLD",119,0)
 K SIG,%,J,Z,SGY,X
"RTN","PSXBLD",120,0)
 Q
"RTN","PSXBLD",121,0)
STRIP ;strip out any HL7 delimiters
"RTN","PSXBLD",122,0)
 F %="|","~","^","\" F  Q:Y'[%  S Y=$P(Y,%,1)_" "_$P(Y,%,2,999)
"RTN","PSXBLD",123,0)
 ;replace "&" in sig with escape sequence "\T\"
"RTN","PSXBLD",124,0)
 ;S:Y["&" Y=$P(Y,"&",1)_"\T\"_$P(Y,"&",2,999)
"RTN","PSXBLD",125,0)
 Q
"RTN","PSXBLD",126,0)
EXPAND ;expands the sig
"RTN","PSXBLD",127,0)
 N NTESEQ
"RTN","PSXBLD",128,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="C80"
"RTN","PSXBLD",129,0)
 S XX=0 F  S XX=$O(^PSRX(RX,"SIG1",XX)) Q:XX'>0  S X=^(XX,0) S Y=X D STRIP S X=Y D ^DIWP
"RTN","PSXBLD",130,0)
 S YY=0 F  S YY=$O(^UTILITY($J,"W",1,YY)) Q:YY'>0  D
"RTN","PSXBLD",131,0)
 .I YY=1 S NTESEQ=1,PSXORD(MSG)=$TR($G(PSXORD(MSG))_$G(^(YY,0)),"\","/") Q
"RTN","PSXBLD",132,0)
 .S MSG=$G(MSG)+1,PSXORD(MSG)=$TR("NTE|7||"_$G(^(YY,0)),"\","/") D
"RTN","PSXBLD",133,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" S PSXORD(MSG)=$P(PSXORD(MSG),"|",1,2)_"|"_$P(RXY,"^")_"|ENG|"_NTESEQ_"|"_$P(PSXORD(MSG),"|",4,99),NTESEQ=NTESEQ+1
"RTN","PSXBLD",134,0)
 .Q
"RTN","PSXBLD",135,0)
 K XX,YY,DIWL,DIWR,DIWF,X,Y,^UTILITY($J,"W"),Z
"RTN","PSXBLD",136,0)
 I $$PATCH^XPDUTL("PSO*7.0*117"),$P($G(^PS(55,DFN,"LAN")),"^",1),$P($G(^PS(55,DFN,"LAN")),"^",2)=2 D OTHL1^PSOLBL3(RX) D  Q:'$O(SIG2(0))  ;ONLY SEND SPANISH SIG IF PMI PREF (ON PID SEGMENT) IS ALSO SPANISH
"RTN","PSXBLD",137,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  I $O(SIG2(XX))="",SIG2(XX)="" K SIG2(XX) Q  ; IF LAST ENTRY IS NULL, REMOVE IT
"RTN","PSXBLD",138,0)
 S NTESEQ=1
"RTN","PSXBLD",139,0)
 S DIWL=1,DIWR=80,DIWF="C80",(XX,YY)=0
"RTN","PSXBLD",140,0)
 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) S Y=X D STRIP S X=Y D ^DIWP
"RTN","PSXBLD",141,0)
 S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXBLD",142,0)
 F  S YY=$O(^UTILITY($J,"W",1,YY)) Q:YY'>0  S MSG=$G(MSG)+1,PSXORD(MSG)=$TR("NTE|7||"_$G(^(YY,0)),"\","/") I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" D
"RTN","PSXBLD",143,0)
 .S PSXORD(MSG)=$P(PSXORD(MSG),"|",1,2)_"|"_$P(RXY,"^")_"|SPA|"_NTESEQ_"|"_$P(PSXORD(MSG),"|",4,99),NTESEQ=NTESEQ+1
"RTN","PSXBLD",144,0)
 K XX,YY,DIWL,DIWR,DIWF,X,Y,^UTILITY($J,"W"),SIG2,PSSWSITE
"RTN","PSXBLD",145,0)
 Q
"RTN","PSXBLD",146,0)
DGST ; returns PSXDGST
"RTN","PSXBLD",147,0)
 N RXNUM,RXEX,PTRA,PTRB,ZX,PSXPTR
"RTN","PSXBLD",148,0)
 S PSXPTR=RX K PSXDGST
"RTN","PSXBLD",149,0)
 S RXNUM=$P($G(^PSRX(PSXPTR,0)),"^",6),RXEX=$P($G(^PSRX(PSXPTR,0)),"^",1)
"RTN","PSXBLD",150,0)
 I $G(^PSDRUG(RXNUM,"ND"))'="" D
"RTN","PSXBLD",151,0)
 .S PTRA=$P($G(^PSDRUG(RXNUM,"ND")),U,1),PTRB=$P($G(^PSDRUG(RXNUM,"ND")),U,3)
"RTN","PSXBLD",152,0)
 .I $G(PTRA)'="" S ZX=$$PROD2^PSNAPIS(PTRA,PTRB),DRUGCHK=$P($G(ZX),"^",3)
"RTN","PSXBLD",153,0)
 S:$G(DRUGCHK)'="" PSXDGST=$P(ZX,"^",2)_"^"_$P(ZX,"^")
"RTN","PSXBLD",154,0)
 Q
"RTN","PSXBLD",155,0)
COPAYCK ; RECHECK COPAY STATUS FOR EACH FILL
"RTN","PSXBLD",156,0)
 N PSOLBLPS,PSOLBLDR,PSODBQ,PSOQI
"RTN","PSXBLD",157,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSXBLD",158,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) S COPAY="" Q
"RTN","PSXBLD",159,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S") S COPAY="" Q
"RTN","PSXBLD",160,0)
 S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSXBLD",161,0)
 I PSOQI["1" S COPAY="" Q
"RTN","PSXBLD",162,0)
 I $G(PSOLBLCP)="" D IBCP^PSOLBL ; CHECK WHETHER EXEMPT (SC OR INCOME EXEMPT - OR IF SERVICE-CONNECTED QUESTION NEEDS TO BE ASKED KEEP COPAY AS IT WAS)
"RTN","PSXBLD",163,0)
 I $G(PSOLBLCP)=0 S COPAY="" Q
"RTN","PSXBLD",164,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") S COPAY="" Q
"RTN","PSXBLD",165,0)
 S COPAY=1
"RTN","PSXBLD",166,0)
 Q
"RTN","PSXBLD",167,0)
 ;
"RTN","PSXBLD",168,0)
DEL5502 ; RX was removed from 52.5 during transmission
"RTN","PSXBLD",169,0)
 N DA,DIK
"RTN","PSXBLD",170,0)
 S DA=$O(^PSX(550.2,PSXBAT,15,"B",RX,0))
"RTN","PSXBLD",171,0)
 S DA(1)=PSXBAT,DIK="^PSX(550.2,"_DA(1)_",15," D ^DIK
"RTN","PSXBLD",172,0)
 Q
"RTN","PSXBLD",173,0)
WARN ;
"RTN","PSXBLD",174,0)
 I '$D(PSSWSITE) S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXBLD",175,0)
 I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" Q
"RTN","PSXBLD",176,0)
 S L=+$L(WARN,",") S W1="" F J=1:1:L S W=$P(WARN,",",J) I +W>0,(+W'>20) S:+W1>0 W1=W1_"~"_W S:+W1=0 W1=W1_W
"RTN","PSXBLD",177,0)
 S:+W1>0 $P(X,"|",17)=W1 K WARN,J,W,L,W1
"RTN","PSXBLD",178,0)
 Q
"RTN","PSXBLD2")
0^3^B1742280^n/a
"RTN","PSXBLD2",1,0)
PSXBLD2 ;BIR/EJW-New warning label Data for Transmission ;10/26/04
"RTN","PSXBLD2",2,0)
 ;;2.0;CMOP;**54**;11 Apr 97;Build 6
"RTN","PSXBLD2",3,0)
 ;
"RTN","PSXBLD2",4,0)
 ;Reference to  ^PS(55,    supported by DBIA #2228
"RTN","PSXBLD2",5,0)
 ;Reference to WTEXT^PSSWRNA supported by DBIA #4444
"RTN","PSXBLD2",6,0)
NEWWARN ;
"RTN","PSXBLD2",7,0)
 N J,TEXT,W
"RTN","PSXBLD2",8,0)
 F J=1:1:5 S W=$P(WARN,",",J) Q:W=""  D
"RTN","PSXBLD2",9,0)
 .S TEXT=$$WTEXT^PSSWRNA(W) I TEXT'="" S MSG=MSG+1,PSXORD(MSG)="NTE|11|"_$P(RXY,"^")_"|ENG|"_W_"|"_TEXT
"RTN","PSXBLD2",10,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",2)'=2 Q
"RTN","PSXBLD2",11,0)
 I '$P($G(^PS(55,DFN,"LAN")),"^") Q  ; DON'T SEND SPANISH WARNING LABELS UNLESS PATIENT ALSO HAS OTHER LANGUAGE PREFERENCE 
"RTN","PSXBLD2",12,0)
 ; SEND SPANISH WARNINGS ALSO
"RTN","PSXBLD2",13,0)
 F J=1:1:5 S W=$P(WARN,",",J) Q:W=""  D
"RTN","PSXBLD2",14,0)
 .S TEXT=$$WTEXT^PSSWRNA(W,2) I TEXT'="" S MSG=MSG+1,PSXORD(MSG)="NTE|11|"_$P(RXY,"^")_"|SPA|"_W_"|"_TEXT
"RTN","PSXBLD2",15,0)
 Q
"RTN","PSXERR")
0^4^B35308373^B33005571
"RTN","PSXERR",1,0)
PSXERR ;BIR/BAB,WPB,HTW,PWC-Error Processing Utility ;MAR 1,2002@13:13:34
"RTN","PSXERR",2,0)
 ;;2.0;CMOP;**1,3,28,30,42,41,52,54**;11 Apr 97;Build 6
"RTN","PSXERR",3,0)
 ; Reference to ^PS(59,  supported by DBIA #1976
"RTN","PSXERR",4,0)
 ; Reference to file #52 supported by DBIA #1977
"RTN","PSXERR",5,0)
 ; This routine will be used to send mail messages when errors
"RTN","PSXERR",6,0)
 ; have occurred during the processing of prescription data for
"RTN","PSXERR",7,0)
 ; the Consolidated Mail Outpatient Pharmacy system.
"RTN","PSXERR",8,0)
EN S ERRTXT(1)="An error has been encountered while processing prescription data for the"
"RTN","PSXERR",9,0)
 S ERRTXT(2)="Consolidated Mail Outpatient Pharmacy system."
"RTN","PSXERR",10,0)
 S X=PSXJOB,XMSUB="CMOP Error Encountered"
"RTN","PSXERR",11,0)
 I $G(PSOSITE) S XMSUB=$$GET1^DIQ(59,PSOSITE,.06)_" "_XMSUB
"RTN","PSXERR",12,0)
 S XY=$S(X=1:"Transmission of Batch Data",X=2:"Re-Transmission of Batch Data",X=3:"Purge of CMOP RX QUEUE file",X=4:"Filing of CMOP Dispense Data",X=5:"Background Auto-transmission of Data",X=6:"Release Data",X=7:"Data Validation",1:"")
"RTN","PSXERR",13,0)
 D NOW^%DTC S Y=% X ^DD("DD") S DTTM=$P(Y,":",1,2) K Y
"RTN","PSXERR",14,0)
 S ERRTXT(3)=""
"RTN","PSXERR",15,0)
 S ERRTXT(4)="Date/Time    :  "_DTTM
"RTN","PSXERR",16,0)
 S ERRTXT(5)="Process      :  "_XY
"RTN","PSXERR",17,0)
 S ERRTXT(6)="Error Type   :  "_TYPE
"RTN","PSXERR",18,0)
 S ERRTXT(7)=""
"RTN","PSXERR",19,0)
 S ERRTXT(8)="Description  :  "_$G(DESCRTN)
"RTN","PSXERR",20,0)
 S ERRTXT(9)=""
"RTN","PSXERR",21,0)
 S ERRTXT(PSXCT+2)="Action Taken:  "_ACTION,ERRTXT(PSXCT+3)=""
"RTN","PSXERR",22,0)
 S ERRTXT(PSXCT+4)="Recommended action:  "_RECM
"RTN","PSXERR",23,0)
 D MAIL
"RTN","PSXERR",24,0)
EXIT K ERRTXT,PSXM,PSXCT,PSXGRP,XMSUB,XMY,XMTEXT,XMDUZ,%,XMDUN,XMZ,ACTION,DESCRTN,DTTM,ERROR,FILL,FLG,MSG,P1,P2,PSXCT,RECM,RXP,TYPE,X,PSXJOB,PSXREF,XY
"RTN","PSXERR",25,0)
 Q
"RTN","PSXERR",26,0)
ER1 ;errors encountered while building the mail message for transmission
"RTN","PSXERR",27,0)
 Q:$P($G(PSXER),"^",2)=""
"RTN","PSXERR",28,0)
 S ERRTXT(10)="The following data is missing in the OUTPATIENT SITE file (#59).",ERRTXT(11)=""
"RTN","PSXERR",29,0)
 S PSXCT=11,PSXCT=PSXCT+1,PSXJOB=1
"RTN","PSXERR",30,0)
 F XX=2:1 Q:$P(PSXER,"^",XX)=""  D
"RTN","PSXERR",31,0)
 .S ERR=$P(PSXER,"^",XX),PSXCT=PSXCT+1,MSG=$P($T(DERR+ERR),";;",2) S ERRTXT(PSXCT)=MSG
"RTN","PSXERR",32,0)
 S PSXCT=PSXCT+1,ERRTXT(PSXCT)=""
"RTN","PSXERR",33,0)
 S PSXERFLG=1,ACTION="No data transmission will occur without this information.",RECM="Correct invalid data.",TYPE="Invalid or missing data"
"RTN","PSXERR",34,0)
 D EN
"RTN","PSXERR",35,0)
 Q
"RTN","PSXERR",36,0)
ER2 ;errors encountered while building the mail message for retransmission
"RTN","PSXERR",37,0)
 S P1=$P($G(PSXERR),U,1),P2=$P($G(PSXERR),U,2)
"RTN","PSXERR",38,0)
 S ERROR=$P($T(DATAERR+10),";;",2)
"RTN","PSXERR",39,0)
 I P1=2 S PSXCT=PSXCT+1,ERRTXT(PSXCT)=$P($G(ERROR),"^",1)_$P($G(ERROR),"^",P2)
"RTN","PSXERR",40,0)
 S PSXCT=PSXCT+1,ERRTXT(PSXCT)=""
"RTN","PSXERR",41,0)
 S PSXCT=PSXCT+1,ERRTXT(PSXCT)=$S(P2=5:"The retransmitted batch will be placed in a hold status.  Please release the correct batch when ready.",P2'=5:"The retransmitted batch was not downloaded into the files.",1:"")
"RTN","PSXERR",42,0)
 K PSXERR
"RTN","PSXERR",43,0)
 Q
"RTN","PSXERR",44,0)
ER4 S PSXCT=11
"RTN","PSXERR",45,0)
 S RECM="Call IRM to check data and correct"
"RTN","PSXERR",46,0)
 S TYPE="Missing Data - No match found for return data."
"RTN","PSXERR",47,0)
 S ACTION="Return data not filed for Rx listed, background release not performed."
"RTN","PSXERR",48,0)
 S ERRTXT(PSXCT)=" RX#    FILL#    BATCH#   SEQUENCE#  "
"RTN","PSXERR",49,0)
 F I=1:1 S PSXCT=PSXCT+1 Q:$G(PSXER(I))']""  S ERRTXT(PSXCT)=PSXER(I)
"RTN","PSXERR",50,0)
 D EN
"RTN","PSXERR",51,0)
 K PSXER,I
"RTN","PSXERR",52,0)
 Q
"RTN","PSXERR",53,0)
ER6 S PSXCT=11
"RTN","PSXERR",54,0)
 S RECM="Call IRM to check data and correct"
"RTN","PSXERR",55,0)
 S TYPE="Invalid data "
"RTN","PSXERR",56,0)
 S DESCRTN="During processing of Vendor return data, CMOP attempted to release the following Rx.  This Rx has already been Released locally!.  This will invalidate your stock levels for this drug!"
"RTN","PSXERR",57,0)
 S ACTION="Rx was not released by CMOP."
"RTN","PSXERR",58,0)
 S ERRTXT(PSXCT)="RX#  "_$P(^PSRX(RXP,0),"^")_"     FILL#  "_$G(PSXREF)
"RTN","PSXERR",59,0)
 D EN
"RTN","PSXERR",60,0)
 Q
"RTN","PSXERR",61,0)
ER7 ;Set up prescription data for message.
"RTN","PSXERR",62,0)
 Q:$P($G(PSXRXERR),"^",3)=""
"RTN","PSXERR",63,0)
 N DFN,RX,VA
"RTN","PSXERR",64,0)
 S ERRTXT(10)="RX #       Fill       Data Field         SSN          NAME"
"RTN","PSXERR",65,0)
 S ERRTXT(11)=""
"RTN","PSXERR",66,0)
 S:PSXERFLG=0 PSXCT=11
"RTN","PSXERR",67,0)
 S RXNM=$P(PSXRXERR,"^",1),FILL=$P(PSXRXERR,"^",2)
"RTN","PSXERR",68,0)
 S RXF=$S(FILL=0:"Original ",FILL>0:"Refill #"_FILL,1:"")
"RTN","PSXERR",69,0)
 S PSXCT=PSXCT+1,FLG=0,BLANK=$J(" ",50)
"RTN","PSXERR",70,0)
 F XX=3:1 Q:$P(PSXRXERR,"^",XX)=""  D
"RTN","PSXERR",71,0)
 .S RX(2,"E")=$$GET1^DIQ(52,RXN,2)      ; patient name
"RTN","PSXERR",72,0)
 .S RX(2,"I")=$$GET1^DIQ(52,RXN,2,"I")  ; DFN
"RTN","PSXERR",73,0)
 .S DFN=RX(2,"I") D PID^VADPT
"RTN","PSXERR",74,0)
 .S ERR=$P(PSXRXERR,"^",XX),PSXCT=PSXCT+1,CNT=ERR-1
"RTN","PSXERR",75,0)
 .S MSG=$P($T(DATAERR+CNT),";;",2)
"RTN","PSXERR",76,0)
 .I FLG=0 S ERRTXT(PSXCT)=RXNM_"  "_RXF_"  "_$E(MSG_BLANK,1,17)_"  "_VA("PID")_" "_(RX(2,"E")),FLG=1 Q
"RTN","PSXERR",77,0)
 .I FLG=1 S ERRTXT(PSXCT)="                         "_MSG,FLG=1 Q
"RTN","PSXERR",78,0)
 S PSXCT=PSXCT+1,ERRTXT(PSXCT)=""
"RTN","PSXERR",79,0)
 K PSXRXERR,RXNM,RXF,DAYS,CNT,ERR,DRUG,FDATE,PHAR,PHY,PSTAT,QTY,REF,RXERR,SIG,XX,BLANK
"RTN","PSXERR",80,0)
 S PSXERFLG=1,ACTION="Rx's not sent to CMOP but still suspended for transmission.",RECM="Correct invalid data.",TYPE="Invalid or missing data"
"RTN","PSXERR",81,0)
 I $G(PSOBAI) S ACTION="Rx's not sent to CMOP. If Bad Address Indicator, will remain on suspense but unmarked for CMOP." K PSOBAI
"RTN","PSXERR",82,0)
 Q
"RTN","PSXERR",83,0)
MAIL ;Transmit.
"RTN","PSXERR",84,0)
 S XMDUZ=.5,XMTEXT="ERRTXT("
"RTN","PSXERR",85,0)
 K XMY ; get mail group to notify and save in PSXGRP
"RTN","PSXERR",86,0)
 D GRP^PSXNOTE
"RTN","PSXERR",87,0)
 D ^XMD
"RTN","PSXERR",88,0)
 Q
"RTN","PSXERR",89,0)
DATAERR ;list of errrors that can occur while checking the rx prior to transmit
"RTN","PSXERR",90,0)
 ;;Quantity
"RTN","PSXERR",91,0)
 ;;Prescribing Physician
"RTN","PSXERR",92,0)
 ;;Days supply
"RTN","PSXERR",93,0)
 ;;Drug id
"RTN","PSXERR",94,0)
 ;;SIG
"RTN","PSXERR",95,0)
 ;;Patient status
"RTN","PSXERR",96,0)
 ;;Fill date
"RTN","PSXERR",97,0)
 ;;Clerk not entered
"RTN","PSXERR",98,0)
 ;;Patient Address
"RTN","PSXERR",99,0)
 ;;Original batch ^not on file.^is currently processing.^is closed.^is already on hold.
"RTN","PSXERR",100,0)
 ;;Fill has already been transmitted
"RTN","PSXERR",101,0)
 ;;Spaces in Rx number
"RTN","PSXERR",102,0)
 ;;Duplicate Rx
"RTN","PSXERR",103,0)
 ;;Patient Mail Status Change
"RTN","PSXERR",104,0)
 ;;Drug Warnings >11 Characters
"RTN","PSXERR",105,0)
 ;;Patient in the Merging Process
"RTN","PSXERR",106,0)
 ;;RX OERR/CPRS Locked
"RTN","PSXERR",107,0)
 ;;Test Patient
"RTN","PSXERR",108,0)
 ;;Bad Address Indicator no active temporary address
"RTN","PSXERR",109,0)
DERR ;list of errors for transmission
"RTN","PSXERR",110,0)
 ;;State
"RTN","PSXERR",111,0)
 ;;Site
"RTN","PSXERR",112,0)
 ;;Name
"RTN","PSXERR",113,0)
 ;;Street Address
"RTN","PSXERR",114,0)
 ;;City
"RTN","PSXERR",115,0)
 ;;Zip Code
"RTN","PSXERR",116,0)
 ;;Area Code
"RTN","PSXERR",117,0)
 ;;Phone Number
"RTN","PSXERR",118,0)
 ;;Refillable Instructions
"RTN","PSXERR",119,0)
 ;;Nonrefillable Instructions
"RTN","PSXERR",120,0)
 ;;Station number is missing in the Institution file
"RTN","PSXERR",121,0)
 ;;Package file entry for Outpatient Pharmacy is bad
"RTN","PSXERR",122,0)
 Q
"RTN","PSXMISC1")
0^5^B38388550^B32974838
"RTN","PSXMISC1",1,0)
PSXMISC1 ;BIR/WPB,BAB-Transmission Data Validation ;MAR 1,2002@13:13:34
"RTN","PSXMISC1",2,0)
 ;;2.0;CMOP;**3,18,23,28,30,42,41,52,54**;11 Apr 97;Build 6
"RTN","PSXMISC1",3,0)
 ;Reference to ^PSDRUG(  supported by DBIA #1983
"RTN","PSXMISC1",4,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXMISC1",5,0)
 ;Reference to ^PSRX(    supported by DBIA #1977
"RTN","PSXMISC1",6,0)
 ;Reference to ^PS(55,   supported by DBIA #2228
"RTN","PSXMISC1",7,0)
 ;Reference to PROD2^PSNAPIS supported by DBIA #2531
"RTN","PSXMISC1",8,0)
 ;Reference to ^PSSLOCK supported by DBIA #2789
"RTN","PSXMISC1",9,0)
 ;Reference to CHKRX^PSOBAI supported by DBIA #4910
"RTN","PSXMISC1",10,0)
CHKDATA ;checks the data elements in PSRX before putting the rx in 550.2
"RTN","PSXMISC1",11,0)
 Q:'$D(^PS(52.5,REC,0))
"RTN","PSXMISC1",12,0)
 K DRUGCHK,PSXRXERR,PSXDGST,WARNS
"RTN","PSXMISC1",13,0)
 S (RXN,PSXPTR)=$P($G(^PS(52.5,REC,0)),"^",1) I PSXPTR="" S PSXOK=8 Q
"RTN","PSXMISC1",14,0)
 D PSOL^PSSLOCK(RXN) S PSOMSG=+PSOMSG ; sets PSOMSG
"RTN","PSXMISC1",15,0)
 I ($P(^PS(52.5,REC,0),U,3)'=XDFN)!($P(^PSRX(PSXPTR,0),U,2)'=XDFN) S PSXOK=8 Q
"RTN","PSXMISC1",16,0)
 I '$D(^PSRX(PSXPTR,0)) S PSXOK=8 Q
"RTN","PSXMISC1",17,0)
 S RXNUM=$P($G(^PSRX(PSXPTR,0)),"^",6),RXEX=$P($G(^PSRX(PSXPTR,0)),"^",1)
"RTN","PSXMISC1",18,0)
 I $G(^PSDRUG(RXNUM,"ND"))'="" D
"RTN","PSXMISC1",19,0)
 .S PTRA=$P($G(^PSDRUG(RXNUM,"ND")),U,1),PTRB=$P($G(^PSDRUG(RXNUM,"ND")),U,3)
"RTN","PSXMISC1",20,0)
 .I $G(PTRA)'="" S ZX=$$PROD2^PSNAPIS(PTRA,PTRB),DRUGCHK=$P($G(ZX),"^",3)
"RTN","PSXMISC1",21,0)
 S:$G(DRUGCHK)'="" PSXDGST=$P(ZX,"^",2)_"^"_$P(ZX,"^")
"RTN","PSXMISC1",22,0)
 I '$D(DRUGCHK) S DRUGCHK=0
"RTN","PSXMISC1",23,0)
 S:'$D(^PSDRUG("AQ",RXNUM)) PSXOK=1
"RTN","PSXMISC1",24,0)
 S:$G(DRUGCHK)'=1 PSXOK=1
"RTN","PSXMISC1",25,0)
 I $P(^PSDRUG(RXNUM,2),"^",3)'["O" S PSXOK=1,PSXCK=RXNUM D UNMARK^PSXUTL
"RTN","PSXMISC1",26,0)
 S:$P($G(^PSRX(PSXPTR,"STA")),U,1)'=5 PSXOK=5
"RTN","PSXMISC1",27,0)
 ;gets the fill number by ordering thru the refill node for the last
"RTN","PSXMISC1",28,0)
 ;refill number
"RTN","PSXMISC1",29,0)
 S FILNUM=0 F REF=0:0 S REF=$O(^PSRX(PSXPTR,1,REF)) Q:REF'>0  S:REF>0 FILNUM=REF S:REF="" FILNUM=0
"RTN","PSXMISC1",30,0)
 ;I $G(PSXFLAG)=2 S PSXOK=0 Q
"RTN","PSXMISC1",31,0)
 S RXF=FILNUM
"RTN","PSXMISC1",32,0)
 S REL=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,18),RXF=0:$P($G(^PSRX(RXN,2)),U,13),1:"") I $G(REL)'="" S PSXOK=6
"RTN","PSXMISC1",33,0)
 S:((PSXOK=0)&(FILNUM>0)&($P($G(^PSRX(PSXPTR,1,FILNUM,0)),"^",2)'="M")) PSXOK=3
"RTN","PSXMISC1",34,0)
 S:((PSXOK=0)&(FILNUM'>0)&($P($G(^PSRX(PSXPTR,0)),"^",11)'="M")) PSXOK=3
"RTN","PSXMISC1",35,0)
 I $G(^PS(52.5,REC,"P"))="1" S PSXOK=4
"RTN","PSXMISC1",36,0)
 S PSXDIV=$S(FILNUM=0:$P($G(^PSRX(PSXPTR,2)),U,9),FILNUM>0:$P($G(^PSRX(PSXPTR,1,FILNUM,0)),"^",9),1:"")
"RTN","PSXMISC1",37,0)
 ;If trans div does not match Rx div eliminate
"RTN","PSXMISC1",38,0)
 I PSXDIV'=PSOSITE S PSXOK=7 Q
"RTN","PSXMISC1",39,0)
 ; Changes for Controlled subs 
"RTN","PSXMISC1",40,0)
 N PSXCSC,PSXCSD S PSXCSRX=""
"RTN","PSXMISC1",41,0)
 S PSXCSC=$P($G(^PSDRUG(RXNUM,0)),"^",3)
"RTN","PSXMISC1",42,0)
 ;Can't trans DEA schedule 1 or 2
"RTN","PSXMISC1",43,0)
 I $G(PSXCSC)[1!$G(PSXCSC)[2 S PSXOK=10 Q
"RTN","PSXMISC1",44,0)
 ;If CS must be DEA 3-5 to qualify
"RTN","PSXMISC1",45,0)
 F PSXCSD=3:1:5 I PSXCSC[PSXCSD S PSXCSRX=1
"RTN","PSXMISC1",46,0)
 ;If not CS drug and CS trans eliminate
"RTN","PSXMISC1",47,0)
 I ($G(PSXCSRX)<1)&($G(PSXCS)=1) S PSXOK=9 Q
"RTN","PSXMISC1",48,0)
 ;If CS drug and not CS trans eliminate
"RTN","PSXMISC1",49,0)
 I ($G(PSXCSRX)=1)&($G(PSXCS)<1) S PSXOK=9 Q
"RTN","PSXMISC1",50,0)
 ; Checks for do not mail and expiration date thereof
"RTN","PSXMISC1",51,0)
 ; moved to under NOGO
"RTN","PSXMISC1",52,0)
 ;
"RTN","PSXMISC1",53,0)
 G:PSXOK'=0 STOP
"RTN","PSXMISC1",54,0)
NOGO ;any rx that does not pass the following checks will not be transmitted
"RTN","PSXMISC1",55,0)
 ;and an error message will be generated and sent to the user who
"RTN","PSXMISC1",56,0)
 ;initiated the transmission.  All that pass the checks will be sent.
"RTN","PSXMISC1",57,0)
 S RXERR=0,PSXRXERR=RXEX_"^"_RXF
"RTN","PSXMISC1",58,0)
 I RXEX[" " S RXERR=13,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",59,0)
 S QTY=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,4),RXF=0:$P($G(^PSRX(RXN,0)),U,7),1:"") G:$G(QTY)'=""&($G(QTY)>0)&(QTY?.N)!(QTY?.N1".".N) NG1 S RXERR=2,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",60,0)
NG1 S PHY=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,17),RXF=0:$P($G(^PSRX(RXN,0)),U,4),1:"") I PHY="" S RXERR=3,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",61,0)
 S DAYS=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,10),RXF=0:$P($G(^PSRX(RXN,0)),U,8),1:"") I (DAYS'>0)!(DAYS="") S RXERR=4,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",62,0)
 S PHARCLK=$S(RXF>0:$P($G(^PSRX(RXN,1,RXF,0)),U,7),RXF=0:$P($G(^PSRX(RXN,0)),U,16),1:"") I PHARCLK="" S RXERR=9,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",63,0)
 S DRUG=$P($G(^PSRX(RXN,0)),U,6),PSTAT=$P($G(^(0)),U,3),FDATE=$P($G(^PSRX(RXN,2)),U,2)
"RTN","PSXMISC1",64,0)
 D TSTSIG
"RTN","PSXMISC1",65,0)
 S DFN=$P($G(^PSRX(RXN,0)),U,2) D ADD^VADPT I ($G(VAPA(1))="")!($G(VAPA(4))="")!($P($G(VAPA(5)),"^",2)="")!($G(VAPA(6))'>0)!($P($G(VAPA(11)),"^",2)'>0) S RXERR=10,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",66,0)
 D DEM^VADPT
"RTN","PSXMISC1",67,0)
 I VADM(1)["MERGING" S RXERR=17,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",68,0)
 ;MVP OIFO BAY PINES;ELR;PSX*2*52  CHANGED RXERR FROM 10 TO 19. ADDED NEW ERROR IN PSXERR
"RTN","PSXMISC1",69,0)
 I $G(VA("PID"))["000-00" S RXERR=19,PSXRXERR=PSXRXERR_"^"_RXERR ; SSN ["000-00" indicates test patient
"RTN","PSXMISC1",70,0)
 S (CNTR,XC,DUPFLG)=0,DUPRX="" F  S XC=$O(^PSRX("B",RXEX,XC)) Q:XC'>0  S CNTR=CNTR+1,DUPRX=DUPRX_"^"_XC
"RTN","PSXMISC1",71,0)
 I CNTR>1 D
"RTN","PSXMISC1",72,0)
 .Q:$P(DUPRX,"^",3)=""
"RTN","PSXMISC1",73,0)
 .F I2=2:1 S I1=$P(DUPRX,"^",I2) Q:I1=""  S PSREC=$O(^PS(52.5,"B",I1,"")) Q:$G(PSREC)'>0  S:($P(^PS(52.5,PSREC,0),"^",2)<PSXDTRG&($P(^PS(52.5,PSREC,0),"^",7)="Q")) DUPFLG=1
"RTN","PSXMISC1",74,0)
 S:$G(DUPFLG)>0 PSXRXERR=PSXRXERR_"^"_"14"
"RTN","PSXMISC1",75,0)
 K CNTR,XC,DUPRX,I2,I1,PSREC,DUPFLG
"RTN","PSXMISC1",76,0)
 I $D(^PSRX(PSXPTR,4,0)) D
"RTN","PSXMISC1",77,0)
 .S RXERR=""
"RTN","PSXMISC1",78,0)
 .S ZX=0 F  S ZX=$O(^PSRX(PSXPTR,4,ZX)) Q:ZX'>0  D
"RTN","PSXMISC1",79,0)
 ..I $P(^PSRX(PSXPTR,4,ZX,0),"^",3)=RXF&($P(^PSRX(PSXPTR,4,ZX,0),"^",4)'=3) S RXERR=12
"RTN","PSXMISC1",80,0)
 ..I $P(^PSRX(PSXPTR,4,ZX,0),"^",3)=RXF&($P(^PSRX(PSXPTR,4,ZX,0),"^",4)=3) S RXERR=""
"RTN","PSXMISC1",81,0)
 .I RXERR'="" S PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",82,0)
 I DRUG="" S RXERR=5,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",83,0)
 I DRUG S WARNS=$P(^PSDRUG(DRUG,0),"^",8) D
"RTN","PSXMISC1",84,0)
 .;IF USING NEW WARNING SOURCE, LENGTH OF OLD WARNINGS DOESN'T MATTER
"RTN","PSXMISC1",85,0)
 .I '$D(PSSWSITE) S PSSWSITE=+$O(^PS(59.7,0))
"RTN","PSXMISC1",86,0)
 .I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" Q
"RTN","PSXMISC1",87,0)
 .I $G(WARNS) S:$L(WARNS)>11 RXERR=16,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",88,0)
 I SIG="" S RXERR=6,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",89,0)
 I PSTAT="" S RXERR=7,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",90,0)
 I FDATE'?7N S RXERR=8,PSXRXERR=PSXRXERR_"^"_RXERR
"RTN","PSXMISC1",91,0)
 I '$$MAILOK(RXN) D
"RTN","PSXMISC1",92,0)
 . S COM="Removed from CMOP Suspense - Mail Status Change" D NOW^%DTC S DTTM=% K % D ACTLOG^PSXRPPL
"RTN","PSXMISC1",93,0)
 . D DELETE^PSXRPPL S PSXOK=1
"RTN","PSXMISC1",94,0)
 . ;MVP OIFO BAY PINES;ELR;PSX*2*5 DELETE MM MSG FOR DO NOT MAIL
"RTN","PSXMISC1",95,0)
 . ;S RXERR=15,PSXRXERR=PSXRXERR_"^"_RXERR ;mail message to users
"RTN","PSXMISC1",96,0)
 I '$$ADDROK(RXN) D
"RTN","PSXMISC1",97,0)
 . S COM="Removed from CMOP Suspense - Bad Address Indicator" D NOW^%DTC S DTTM=% K % D ACTLOG^PSXRPPL
"RTN","PSXMISC1",98,0)
 . D DELETE^PSXRPPL S PSXOK=1,PSOBAI=1
"RTN","PSXMISC1",99,0)
 . S RXERR=20,PSXRXERR=PSXRXERR_"^"_RXERR ;mail message to users
"RTN","PSXMISC1",100,0)
PSOMSG I +PSOMSG=0 S RXERR=18,PSXRXERR=PSXRXERR_"^"_RXERR ; from PSSLOCK
"RTN","PSXMISC1",101,0)
 I $P($G(PSXRXERR),"^",3)'="" S PSXOK=8 D ER7^PSXERR
"RTN","PSXMISC1",102,0)
STOP K DAYS,DRUG,FDATE,PHARCLK,PHY,PSTAT,QTY,RXERR,RXEX,SIG,VAPA(1),DRUGCHK,PTRA,PTRB,REL,RXNUM,PHARCLK1,ZX,VAPA(4),VAPA(5),VAPA(6)
"RTN","PSXMISC1",103,0)
 Q
"RTN","PSXMISC1",104,0)
 ;
"RTN","PSXMISC1",105,0)
TSTSIG ; include testing for BAD characters in SIG
"RTN","PSXMISC1",106,0)
 I $P(^PSRX(RXN,"SIG"),"^",2)'>0 S SIG=$P(^PSRX(RXN,"SIG"),"^") D TSTCHAR
"RTN","PSXMISC1",107,0)
 I $P(^PSRX(RXN,"SIG"),"^",2)=1 N L S L=0 F  S L=$O(^PSRX(RXN,"SIG1",L)) Q:L'>0  S SIG=$G(^PSRX(RXN,"SIG1",L,0)) D TSTCHAR Q:SIG=""
"RTN","PSXMISC1",108,0)
 Q
"RTN","PSXMISC1",109,0)
TSTCHAR ; test each character of SIG for certain characters
"RTN","PSXMISC1",110,0)
 N I,C
"RTN","PSXMISC1",111,0)
 I '$D(^TMP($J,"PSXCHAR")) D
"RTN","PSXMISC1",112,0)
 . F I=0:1:31 S ^TMP($J,"PSXCHAR",I)=""
"RTN","PSXMISC1",113,0)
 . F I=92,94,124,127 S ^TMP($J,"PSXCHAR",I)=""
"RTN","PSXMISC1",114,0)
 F I=1:1:$L(SIG) S C=$A($E(SIG,I)) I $D(^TMP($J,"PSXCHAR",C)) S SIG="" Q
"RTN","PSXMISC1",115,0)
 Q
"RTN","PSXMISC1",116,0)
MAILOK(TRX) ; return 1 if patient still in mail status & ok to CMOP
"RTN","PSXMISC1",117,0)
 N PSOMDT,PSOMC,DFN
"RTN","PSXMISC1",118,0)
 S DFN=$P(^PSRX(TRX,0),"^",2),PSOMDT=$P($G(^PS(55,DFN,0)),"^",5),PSOMC=$P($G(^PS(55,DFN,0)),"^",3)
"RTN","PSXMISC1",119,0)
 I (PSOMC>1&(PSOMDT>DT))!(PSOMC>1&(PSOMDT<1)) Q 0
"RTN","PSXMISC1",120,0)
 Q 1
"RTN","PSXMISC1",121,0)
ADDROK(TRX) ; return 1 if patient does not have BAD ADDRESS INDICATOR set or has an active temporary address
"RTN","PSXMISC1",122,0)
 I $T(CHKRX^PSOBAI)']"" Q 1
"RTN","PSXMISC1",123,0)
 N PSORX,PSOBADR
"RTN","PSXMISC1",124,0)
 S PSORX=TRX
"RTN","PSXMISC1",125,0)
 S PSOBADR=$$CHKRX^PSOBAI(PSORX)
"RTN","PSXMISC1",126,0)
 I '$P(PSOBADR,"^") Q 1
"RTN","PSXMISC1",127,0)
 I $P(PSOBADR,"^",2)=1 Q 1
"RTN","PSXMISC1",128,0)
 Q 0
"RTN","PSXRXQU")
0^2^B15657498^B13155316
"RTN","PSXRXQU",1,0)
PSXRXQU ;BIR/BAB,WPB-CMOP RX QUEUE File Utility ;22 Feb 2002  3:24 PM
"RTN","PSXRXQU",2,0)
 ;;2.0;CMOP;**7,12,25,33,40,41,54**;11 Apr 97;Build 6
"RTN","PSXRXQU",3,0)
 ;
"RTN","PSXRXQU",4,0)
 ;Reference to ^PS(55, supported by DBIA #2228
"RTN","PSXRXQU",5,0)
PURGE ;Purge 550.1 of any entries w/Message Status "IN TRANSITION"
"RTN","PSXRXQU",6,0)
 Q:'$D(^PSX(550.1,"AB"))  S MSG="" F  S MSG=$O(^PSX(550.1,"AB",MSG)) Q:'MSG  S DIK=550.1,DA=MSG D ^DIK
"RTN","PSXRXQU",7,0)
 K DIK,MSG,DA
"RTN","PSXRXQU",8,0)
 Q
"RTN","PSXRXQU",9,0)
 ;-------------------------------------------------------------
"RTN","PSXRXQU",10,0)
NEWMSG ;Increment & create entry in RX QUEUE file, put pid/demog in 'T' ; return PSXMSG, PSX=3
"RTN","PSXRXQU",11,0)
 ;550.1 has been dinumed
"RTN","PSXRXQU",12,0)
 D NOW^%DTC
"RTN","PSXRXQU",13,0)
 S PSXMSG=PSXMSG+1,X=PSXMSG
"RTN","PSXRXQU",14,0)
 K DO,DD S DIC(0)="L",DIC="^PSX(550.1,",DIC("DR")="1///3;2////"_%_";3////^S X=PSXBAT",DLAYGO=550.1
"RTN","PSXRXQU",15,0)
 D ^DIC K DIC,DUOUT,DTOUT
"RTN","PSXRXQU",16,0)
MSH ; build patients MSH HL7 segment
"RTN","PSXRXQU",17,0)
 ;D RX5502 ;load RX,Fill,Pat,Ord
"RTN","PSXRXQU",18,0)
 D DEM^VADPT,ADD^VADPT,TSOUT^PSXUTL S ^PSX(550.1,PSXMSG,"T",1,0)="MSH|^~\&|VISTA||CMOP Automated System||"_PSXTS_"||ORM|"_PSXMSG_"|P|2.1|" K PSXTS ;*33
"RTN","PSXRXQU",19,0)
 S X1=$P(VADM(2),"^")
"RTN","PSXRXQU",20,0)
 S I="" F  S I=$O(VAPA(I)) Q:I=""  S VAPA(I)=$$STRIP(VAPA(I)) ; strip bad characters
"RTN","PSXRXQU",21,0)
 F YT=1:1:4 S VAPA(YT)=$TR(VAPA(YT),"\","/")
"RTN","PSXRXQU",22,0)
PID ; build patients PID HL7 segment
"RTN","PSXRXQU",23,0)
 S ^PSX(550.1,PSXMSG,"T",2,0)="PID|||"_$P(VADM(2),"^")_"^"_(X1#11)_"^M11||"_$P(PSXNM,",")_"^"_$P(PSXNM,",",2)_"||||||"_VAPA(1)_"^"_VAPA(2)_"^"_VAPA(4)_"^"_$P($G(^DIC(5,+VAPA(5),0)),"^",2)_"^"_$P(VAPA(11),"^",2)
"RTN","PSXRXQU",24,0)
 ; Telephone #
"RTN","PSXRXQU",25,0)
 S XX=$$HLPHONE^HLFNC(VAPA(8)) S:XX["(" XX="("_$P(XX,"(",2,99)
"RTN","PSXRXQU",26,0)
 S $P(^PSX(550.1,PSXMSG,"T",2,0),"|",14)=XX
"RTN","PSXRXQU",27,0)
 ; Add other language flag
"RTN","PSXRXQU",28,0)
 S PSXLANG=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSXRXQU",29,0)
 I $G(PSXLANG)'>1 S PSXLANG=1
"RTN","PSXRXQU",30,0)
 I PSXLANG>1,'$P($G(^PS(55,DFN,"LAN")),"^") S PSXLANG=1 ; DON'T MARK AS SPANISH IF NO SPANISH SIG
"RTN","PSXRXQU",31,0)
 I $P($G(^PS(59.7,PSSWSITE,10)),"^",10)="N" S PSXLANG=$S(PSXLANG=1:"ENG",1:"SPA")
"RTN","PSXRXQU",32,0)
 S $P(^PSX(550.1,PSXMSG,"T",2,0),"|",15)=$G(PSXLANG) K PSXLANG
"RTN","PSXRXQU",33,0)
 ; GET PATIENT ICN - DON'T SEND IF LOCAL ICN ONLY
"RTN","PSXRXQU",34,0)
 S PSXICN=$$MPINODE^MPIFAPI(DFN) D
"RTN","PSXRXQU",35,0)
 .I PSXICN<0 S PSXICN="" Q
"RTN","PSXRXQU",36,0)
 .I $P(PSXICN,"^",4)=1 S PSXICN="" Q
"RTN","PSXRXQU",37,0)
 .S PSXICN=$P(PSXICN,"^")_"V"_$P(PSXICN,"^",2)
"RTN","PSXRXQU",38,0)
 S $P(^PSX(550.1,PSXMSG,"T",2,0),"|",18)=$G(PSXICN) K PSXICN
"RTN","PSXRXQU",39,0)
 S TDT=$P(VAPA(10),"^")
"RTN","PSXRXQU",40,0)
 I $G(VAPA(3))]""!($G(TDT)]"") D
"RTN","PSXRXQU",41,0)
 .I $G(TDT)>1 S TDT=TDT+17000000,TDT1=$E(TDT,1,4),TDT2=$E(TDT,5,6),TDT3=$E(TDT,7,8) S:TDT2'>0 TDT2="01" S:TDT3'>0 TDT3="01" S TDT=$G(TDT1)_$G(TDT2)_$G(TDT3)
"RTN","PSXRXQU",42,0)
 .S ^PSX(550.1,PSXMSG,"T",3,0)="NTE|8||"_$S($G(TDT)>1:"1\F\"_TDT_"\F\"_VAPA(3),1:"\F\\F\"_VAPA(3))
"RTN","PSXRXQU",43,0)
 K VADM,VAPA,X1,TDT,YT,TDT1,TDT2,TDT3
"RTN","PSXRXQU",44,0)
 Q
"RTN","PSXRXQU",45,0)
LOADMSG ; set RXs HL7 text into PSXMSG 'T', set PSXBAT 1////1
"RTN","PSXRXQU",46,0)
 S PSX=3
"RTN","PSXRXQU",47,0)
 S X="" F  Q:'$D(PSXORD("M"))  S X=$O(PSXORD("M",X)) Q:'X  S PSX=PSX+1 S ^PSX(550.1,PSXMSG,"T",PSX,0)=$G(PSXORD("M",X))
"RTN","PSXRXQU",48,0)
 K PSXORD("M"),X
"RTN","PSXRXQU",49,0)
 S X="" F  Q:'$D(PSXORD("E"))  S X=$O(PSXORD("E",X)) Q:'X  S PSX=PSX+1 S ^PSX(550.1,PSXMSG,"T",PSX,0)=$G(PSXORD("E",X))
"RTN","PSXRXQU",50,0)
 K PSXORD("E"),X
"RTN","PSXRXQU",51,0)
 I '$D(PSXORD) Q  ;PSX*2*33
"RTN","PSXRXQU",52,0)
 S X="" F  S X=$O(PSXORD(X)) Q:'X  S PSX=PSX+1 S ^PSX(550.1,PSXMSG,"T",PSX,0)=$G(PSXORD(X))
"RTN","PSXRXQU",53,0)
 S ^PSX(550.1,PSXMSG,"T",0)="^550.11A^"_PSX_"^"_PSX
"RTN","PSXRXQU",54,0)
 K X1,VAPA,VADM
"RTN","PSXRXQU",55,0)
QMSG ;Queue message for transmission
"RTN","PSXRXQU",56,0)
 S DA=PSXMSG,DIE="^PSX(550.1," S DR="1////1" L +^PSX(550.1,DA):600
"RTN","PSXRXQU",57,0)
 D ^DIE L -^PSX(550.1,DA) K DA,DIE,DR,PSXORD
"RTN","PSXRXQU",58,0)
 Q
"RTN","PSXRXQU",59,0)
ACKN ;Flag message as Acknowledged
"RTN","PSXRXQU",60,0)
 K BEG
"RTN","PSXRXQU",61,0)
 G LOGACK^PSXPURG
"RTN","PSXRXQU",62,0)
PROC ;Flag message as Processed
"RTN","PSXRXQU",63,0)
 ;--------------------------------------------------------
"RTN","PSXRXQU",64,0)
STAT ;Display status of CMOP RX QUEUE
"RTN","PSXRXQU",65,0)
 N X,PSX1,PSX2 S PSX1=$G(^PSX(550.1,0)) Q:PSX1=""
"RTN","PSXRXQU",66,0)
 S PSX1=+$P(PSX1,"^",3),PSX2=+$O(^PSX(550.1,"AS",0))
"RTN","PSXRXQU",67,0)
 W !!,"Next Order Number to Transmit : ",$S(PSX2:PSX2,1:PSX1)
"RTN","PSXRXQU",68,0)
 W !!,"Last Order Number Generated     : ",PSX1
"RTN","PSXRXQU",69,0)
 Q
"RTN","PSXRXQU",70,0)
SUSP ; put RXs ien int 550.1 RX multiple
"RTN","PSXRXQU",71,0)
RXMSG ; put RX ien into 550.1 RX multiple , returns PSXRXMDA DA within 'M'essage multiple
"RTN","PSXRXQU",72,0)
 S:'$D(^PSX(550.1,PSXMSG,2,0)) ^PSX(550.1,PSXMSG,2,0)="^550.1101PA^^"
"RTN","PSXRXQU",73,0)
SET ;
"RTN","PSXRXQU",74,0)
 K DD,DO,DIC
"RTN","PSXRXQU",75,0)
 S DA(1)=PSXMSG,(X,DA)=RX,DIC("DR")="1////"_RXF,DIC="^PSX(550.1,"_PSXMSG_",2,",DIC(0)="FZ"
"RTN","PSXRXQU",76,0)
 D FILE^DICN G:$P(Y,"^",3)'=1 SET K DA,X,DIC,DIC("DR")
"RTN","PSXRXQU",77,0)
 S PSXRXMDA=+Y
"RTN","PSXRXQU",78,0)
 Q
"RTN","PSXRXQU",79,0)
STRIP(X) ;EP Strip control characters out and replace with " "
"RTN","PSXRXQU",80,0)
 ; $A(124) = Pipe Character '|'
"RTN","PSXRXQU",81,0)
 N I,Z
"RTN","PSXRXQU",82,0)
 F I=1:1:$L(X) S Z=$E(X,I),Z=$A(Z) I (Z<32)!(Z>126)!(Z=124) S X=$E(X,1,I-1)_" "_$E(X,I+1,999)
"RTN","PSXRXQU",83,0)
 Q X
"RTN","PSXRXQU",84,0)
 ;
"VER")
8.0^22.0
"BLD",4855,6)
^54
**END**
**END**
