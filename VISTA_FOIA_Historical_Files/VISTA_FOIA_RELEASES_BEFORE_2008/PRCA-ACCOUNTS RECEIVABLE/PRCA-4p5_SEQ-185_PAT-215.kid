EMERGENCY Released PRCA*4.5*215 SEQ #185
Extracted from mail message
**KIDS**:PRCA*4.5*215^

**INSTALL NAME**
PRCA*4.5*215
"BLD",4799,0)
PRCA*4.5*215^ACCOUNTS RECEIVABLE^0^3040323^y
"BLD",4799,1,0)
^^1^1^3040302^
"BLD",4799,1,1,0)
BAD DEBT REPORT CORRECTION
"BLD",4799,4,0)
^9.64PA^^
"BLD",4799,"KRN",0)
^9.67PA^8989.52^19
"BLD",4799,"KRN",.4,0)
.4
"BLD",4799,"KRN",.401,0)
.401
"BLD",4799,"KRN",.402,0)
.402
"BLD",4799,"KRN",.403,0)
.403
"BLD",4799,"KRN",.5,0)
.5
"BLD",4799,"KRN",.84,0)
.84
"BLD",4799,"KRN",3.6,0)
3.6
"BLD",4799,"KRN",3.8,0)
3.8
"BLD",4799,"KRN",9.2,0)
9.2
"BLD",4799,"KRN",9.8,0)
9.8
"BLD",4799,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4799,"KRN",9.8,"NM",1,0)
RCRJRBD^^0^B42259480
"BLD",4799,"KRN",9.8,"NM",2,0)
RCRJRBDR^^0^B57327710
"BLD",4799,"KRN",9.8,"NM","B","RCRJRBD",1)

"BLD",4799,"KRN",9.8,"NM","B","RCRJRBDR",2)

"BLD",4799,"KRN",19,0)
19
"BLD",4799,"KRN",19.1,0)
19.1
"BLD",4799,"KRN",101,0)
101
"BLD",4799,"KRN",409.61,0)
409.61
"BLD",4799,"KRN",771,0)
771
"BLD",4799,"KRN",870,0)
870
"BLD",4799,"KRN",8989.51,0)
8989.51
"BLD",4799,"KRN",8989.52,0)
8989.52
"BLD",4799,"KRN",8994,0)
8994
"BLD",4799,"KRN","B",.4,.4)

"BLD",4799,"KRN","B",.401,.401)

"BLD",4799,"KRN","B",.402,.402)

"BLD",4799,"KRN","B",.403,.403)

"BLD",4799,"KRN","B",.5,.5)

"BLD",4799,"KRN","B",.84,.84)

"BLD",4799,"KRN","B",3.6,3.6)

"BLD",4799,"KRN","B",3.8,3.8)

"BLD",4799,"KRN","B",9.2,9.2)

"BLD",4799,"KRN","B",9.8,9.8)

"BLD",4799,"KRN","B",19,19)

"BLD",4799,"KRN","B",19.1,19.1)

"BLD",4799,"KRN","B",101,101)

"BLD",4799,"KRN","B",409.61,409.61)

"BLD",4799,"KRN","B",771,771)

"BLD",4799,"KRN","B",870,870)

"BLD",4799,"KRN","B",8989.51,8989.51)

"BLD",4799,"KRN","B",8989.52,8989.52)

"BLD",4799,"KRN","B",8994,8994)

"BLD",4799,"QUES",0)
^9.62^^
"BLD",4799,"REQB",0)
^9.611^1^1
"BLD",4799,"REQB",1,0)
PRCA*4.5*203^2
"BLD",4799,"REQB","B","PRCA*4.5*203",1)

"MBREQ")
0
"PKG",158,-1)
1^1
"PKG",158,0)
ACCOUNTS RECEIVABLE^PRCA^FMS
"PKG",158,20,0)
^9.402P^1^1
"PKG",158,20,1,0)
2^^PRCAMRG
"PKG",158,20,1,1)

"PKG",158,20,"B",2,1)

"PKG",158,22,0)
^9.49I^1^1
"PKG",158,22,1,0)
4.5^2950320^2960423
"PKG",158,22,1,"PAH",1,0)
215^3040323^98
"PKG",158,22,1,"PAH",1,1,0)
^^1^1^3040323
"PKG",158,22,1,"PAH",1,1,1,0)
BAD DEBT REPORT CORRECTION
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCRJRBD")
0^1^B42259480
"RTN","RCRJRBD",1,0)
RCRJRBD ;WISC/RFJ,TJK-bad debt extractor and report ;1 Feb 98
"RTN","RCRJRBD",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,193,203,215**;Mar 20, 1995
"RTN","RCRJRBD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBD",4,0)
 Q
"RTN","RCRJRBD",5,0)
 ;
"RTN","RCRJRBD",6,0)
 ;
"RTN","RCRJRBD",7,0)
START(DATEEND) ;  run bad debt report
"RTN","RCRJRBD",8,0)
 ;  the DATEEND is the last day of the month being run
"RTN","RCRJRBD",9,0)
 ;  from the routine RCRJRCOL which is the data extractor.  The
"RTN","RCRJRBD",10,0)
 ;  current receivable dollars is stored in ^TMP($J,"RCRJRBD",SGL)
"RTN","RCRJRBD",11,0)
 ;  where SGL is the standard general ledger 1319, 1338, or 1339.
"RTN","RCRJRBD",12,0)
 ;
"RTN","RCRJRBD",13,0)
 N ACTDATE,ACTUALCA,ACTUALWO,BEGDATE,BILLDA,CATEGORY
"RTN","RCRJRBD",14,0)
 N COLLECT,CONTRACT,DR,ENDDATE,FUND,PAY,PAYMENT,PRIN,PRINCPAL
"RTN","RCRJRBD",15,0)
 N RCRJFMM,RCRJDATE,SGL,TRANDA,TRANDATE,TRANTYPE,VALUE,WRITEOFF
"RTN","RCRJRBD",16,0)
 N RCPRIN,RCTOMCCF,RCVALUE,RSC
"RTN","RCRJRBD",17,0)
 ;
"RTN","RCRJRBD",18,0)
 ;  lock the bad debt file for storing data, lock cannot fail
"RTN","RCRJRBD",19,0)
 ;  this lock can be used to monitor if the report is running
"RTN","RCRJRBD",20,0)
 L +^RC(348.1)
"RTN","RCRJRBD",21,0)
 ;
"RTN","RCRJRBD",22,0)
 ;  calculate the base percentages from past data
"RTN","RCRJRBD",23,0)
 ;  example:  DATEEND=2980331  => BEGDATE=2970300
"RTN","RCRJRBD",24,0)
 ;                             => ENDDATE=2980229
"RTN","RCRJRBD",25,0)
 ;   add one day to ending date to go to next month
"RTN","RCRJRBD",26,0)
 S BEGDATE=($E(DATEEND,1,3)-1)_$E(DATEEND,4,5)_"00"
"RTN","RCRJRBD",27,0)
 S ENDDATE=($$FMADD^XLFDT($E(DATEEND,1,5)_"00",-1))+1
"RTN","RCRJRBD",28,0)
 ;  loop bills activated between these dates
"RTN","RCRJRBD",29,0)
 S ACTDATE=BEGDATE
"RTN","RCRJRBD",30,0)
 F  S ACTDATE=$O(^PRCA(430,"ACTDT",ACTDATE)) Q:'ACTDATE!(ACTDATE>ENDDATE)  D
"RTN","RCRJRBD",31,0)
 . S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",ACTDATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRBD",32,0)
 . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",33,0)
 . . ;  do not look at prepayments
"RTN","RCRJRBD",34,0)
 . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",35,0)
 . . ;
"RTN","RCRJRBD",36,0)
 . . ;  only look at bills with a 0 principal balance
"RTN","RCRJRBD",37,0)
 . . I $P($G(^PRCA(430,BILLDA,7)),"^") Q
"RTN","RCRJRBD",38,0)
 . . ;
"RTN","RCRJRBD",39,0)
 . . ;  only report fund 5287.* and 4032 bills
"RTN","RCRJRBD",40,0)
 . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",41,0)
 . . I $E(FUND,1,4)'=5287,$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",42,0)
 . . ;
"RTN","RCRJRBD",43,0)
 . . ;  derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",44,0)
 . . S SGL=$$SGL(CATEGORY,FUND)
"RTN","RCRJRBD",45,0)
 . . ;
"RTN","RCRJRBD",46,0)
 . . ;  determine the original amount of the bill (add increase
"RTN","RCRJRBD",47,0)
 . . ;  adjustments below)
"RTN","RCRJRBD",48,0)
 . . S PRIN=$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRBD",49,0)
 . . S PAY=0
"RTN","RCRJRBD",50,0)
 . . ;
"RTN","RCRJRBD",51,0)
 . . ;  get the $ transations for bills
"RTN","RCRJRBD",52,0)
 . . S TRANDA=0
"RTN","RCRJRBD",53,0)
 . . F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",54,0)
 . . . S TRANTYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRBD",55,0)
 . . . I "^1^2^34^43^"'[("^"_TRANTYPE_"^") Q
"RTN","RCRJRBD",56,0)
 . . . S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRBD",57,0)
 . . . ;  increase adjustments or re-establish
"RTN","RCRJRBD",58,0)
 . . . I TRANTYPE=1!(TRANTYPE=43) S PRIN=PRIN+$P(VALUE,"^") Q
"RTN","RCRJRBD",59,0)
 . . . ;  payments
"RTN","RCRJRBD",60,0)
 . . . I TRANTYPE=2!(TRANTYPE=34) S PAY=PAY+$P(VALUE,"^") Q
"RTN","RCRJRBD",61,0)
 . . ;
"RTN","RCRJRBD",62,0)
 . . ;  payment cannot be greater than principle
"RTN","RCRJRBD",63,0)
 . . I PAY>PRIN S PAY=PRIN
"RTN","RCRJRBD",64,0)
 . . ;
"RTN","RCRJRBD",65,0)
 . . ;  store the data
"RTN","RCRJRBD",66,0)
 . . S PRINCPAL(SGL)=$G(PRINCPAL(SGL))+PRIN
"RTN","RCRJRBD",67,0)
 . . S PAYMENT(SGL)=$G(PAYMENT(SGL))+PAY
"RTN","RCRJRBD",68,0)
 . . ;
"RTN","RCRJRBD",69,0)
 ;
"RTN","RCRJRBD",70,0)
 ;  calculate the writeoffs from 2/0/98
"RTN","RCRJRBD",71,0)
 ;  2/0/98 is when fms cleared out actual writeoffs and contract adj
"RTN","RCRJRBD",72,0)
 K ^XTMP("PRCABDET")
"RTN","RCRJRBD",73,0)
 S ^XTMP("PRCABDET",0)=$$FMADD^XLFDT(DT,10)_"^"_DT_"^BAD DEBT REPORT AUDIT"
"RTN","RCRJRBD",74,0)
 F TRANTYPE=8,9,10,11,35 D
"RTN","RCRJRBD",75,0)
 . S TRANDATE=2980200
"RTN","RCRJRBD",76,0)
 . ;  do not pick up transactions after the end date
"RTN","RCRJRBD",77,0)
 . F  S TRANDATE=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE)) Q:'TRANDATE!($P(TRANDATE,".")>DATEEND)  D
"RTN","RCRJRBD",78,0)
 . . S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",79,0)
 . . . ;  do not look at decrease adj which are not contract adj
"RTN","RCRJRBD",80,0)
 . . . I TRANTYPE=35,'$P($G(^PRCA(433,TRANDA,8)),"^",8) Q
"RTN","RCRJRBD",81,0)
 . . . ;
"RTN","RCRJRBD",82,0)
 . . . S BILLDA=$P($G(^PRCA(433,TRANDA,0)),"^",2)
"RTN","RCRJRBD",83,0)
 . . . I 'BILLDA Q
"RTN","RCRJRBD",84,0)
 . . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",85,0)
 . . . ;  do not look at prepayments
"RTN","RCRJRBD",86,0)
 . . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",87,0)
 . . . ;
"RTN","RCRJRBD",88,0)
 . . . ;  only report fund 5287.* and 4032 (ltc) bills
"RTN","RCRJRBD",89,0)
 . . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",90,0)
 . . . I $E(FUND,1,4)'=5287,$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",91,0)
 . . . ;
"RTN","RCRJRBD",92,0)
 . . . ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",93,0)
 . . . S SGL=$$SGL(CATEGORY,FUND)
"RTN","RCRJRBD",94,0)
 . . . ;
"RTN","RCRJRBD",95,0)
 . . . ;  get the principal transaction value
"RTN","RCRJRBD",96,0)
 . . . S RCVALUE=+$P($$TRANBAL^RCRJRCOT(TRANDA),"^")
"RTN","RCRJRBD",97,0)
 . . . ;  temp variable for value (used below)
"RTN","RCRJRBD",98,0)
 . . . S RCPRIN=RCVALUE
"RTN","RCRJRBD",99,0)
 . . . ;
"RTN","RCRJRBD",100,0)
 . . . ;  add actual writeoff amount for fiscal year
"RTN","RCRJRBD",101,0)
 . . . I TRANTYPE'=35 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))+RCVALUE
"RTN","RCRJRBD",102,0)
 . . . ;  add actual contract adjustments for fiscal year
"RTN","RCRJRBD",103,0)
 . . . I TRANTYPE=35 S ACTUALCA(SGL)=$G(ACTUALCA(SGL))+RCVALUE
"RTN","RCRJRBD",104,0)
 . . . S RSC=$$CALCRSC^RCXFMSUR(BILLDA)
"RTN","RCRJRBD",105,0)
 . . . S ^XTMP("PRCABDET",BILLDA,CATEGORY,FUND,RSC,SGL,TRANDA,TRANDATE,TRANTYPE,RCPRIN,RCVALUE,0,0)=""
"RTN","RCRJRBD",106,0)
 ;
"RTN","RCRJRBD",107,0)
 ;  remove all the entries from the bad debt file
"RTN","RCRJRBD",108,0)
 D DELETALL
"RTN","RCRJRBD",109,0)
 ;
"RTN","RCRJRBD",110,0)
 ;  calculate percentages and store them
"RTN","RCRJRBD",111,0)
 F SGL=1319,1319.2,1338,1339 D
"RTN","RCRJRBD",112,0)
 . ;  collection %
"RTN","RCRJRBD",113,0)
 . S COLLECT=0 I $G(PRINCPAL(SGL)) S COLLECT=$J($G(PAYMENT(SGL))/PRINCPAL(SGL)*100,0,2)
"RTN","RCRJRBD",114,0)
 . S DR=".02////"_+COLLECT_";"
"RTN","RCRJRBD",115,0)
 . ;
"RTN","RCRJRBD",116,0)
 . ;  current month receivable (this is built in the routine
"RTN","RCRJRBD",117,0)
 . ;  RCRJRCO1 and is stored in ^TMP($J,"RCRJRBD",SGL))
"RTN","RCRJRBD",118,0)
 . S DR=DR_".07////"_+$G(^TMP($J,"RCRJRBD",SGL))_";"
"RTN","RCRJRBD",119,0)
 . ;
"RTN","RCRJRBD",120,0)
 . ;  calculate allowance estimate for 1319 and 1338
"RTN","RCRJRBD",121,0)
 . ;  .08 allowance estimate = (writeoff % * current receivables)
"RTN","RCRJRBD",122,0)
 . ;  .09 actual writeoffs fytd
"RTN","RCRJRBD",123,0)
 . I SGL=1319!(SGL=1319.2)!(SGL=1338) D
"RTN","RCRJRBD",124,0)
 . . S WRITEOFF=100-COLLECT
"RTN","RCRJRBD",125,0)
 . . S DR=DR_".03////"_WRITEOFF_";"
"RTN","RCRJRBD",126,0)
 . . S DR=DR_".08////"_$J((WRITEOFF/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",127,0)
 . . S DR=DR_".09////"_+$G(ACTUALWO(SGL))_";"
"RTN","RCRJRBD",128,0)
 . ;  calculate allowance estimate for 1339
"RTN","RCRJRBD",129,0)
 . ;  .08 allowance estimate = (contract % * current receivables)
"RTN","RCRJRBD",130,0)
 . ;  .09 actual contract adjustments fytd
"RTN","RCRJRBD",131,0)
 . I SGL=1339 D
"RTN","RCRJRBD",132,0)
 . . S CONTRACT=100-COLLECT
"RTN","RCRJRBD",133,0)
 . . S DR=DR_".04////"_CONTRACT_";"
"RTN","RCRJRBD",134,0)
 . . S DR=DR_".08////"_$J((CONTRACT/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",135,0)
 . . S DR=DR_".09////"_+$G(ACTUALCA(SGL))_";"
"RTN","RCRJRBD",136,0)
 . ;
"RTN","RCRJRBD",137,0)
 . ;  set changed locally flag to no
"RTN","RCRJRBD",138,0)
 . S DR=DR_".1////0;"
"RTN","RCRJRBD",139,0)
 . D STORE(SGL,DR)
"RTN","RCRJRBD",140,0)
 ;
"RTN","RCRJRBD",141,0)
 L -^RC(348.1)
"RTN","RCRJRBD",142,0)
 ;
"RTN","RCRJRBD",143,0)
 ;  put the report in a mail message (rcrjfmm=1)
"RTN","RCRJRBD",144,0)
 S RCRJFMM=1
"RTN","RCRJRBD",145,0)
 S RCRJDATE=DATEEND
"RTN","RCRJRBD",146,0)
 D DQ^RCRJRBDR
"RTN","RCRJRBD",147,0)
 Q
"RTN","RCRJRBD",148,0)
 ;
"RTN","RCRJRBD",149,0)
 ;
"RTN","RCRJRBD",150,0)
STORE(SGL,DR) ;  store data for Standard Ledger Account
"RTN","RCRJRBD",151,0)
 N D0,DA,DD,DI,DIC,DIE,DINUM,DO,DQ,X,Y
"RTN","RCRJRBD",152,0)
 S DIC="^RC(348.1,",DIC(0)="L",(X,DINUM)=SGL,DIC("DR")=DR
"RTN","RCRJRBD",153,0)
 D FILE^DICN
"RTN","RCRJRBD",154,0)
 Q
"RTN","RCRJRBD",155,0)
 ;
"RTN","RCRJRBD",156,0)
 ;
"RTN","RCRJRBD",157,0)
DELETALL ;  delete all the entries from the bad debt file
"RTN","RCRJRBD",158,0)
 N %,DA,DIC,DIK,X,Y
"RTN","RCRJRBD",159,0)
 S DIK="^RC(348.1,"
"RTN","RCRJRBD",160,0)
 S DA=0 F  S DA=$O(^RC(348.1,DA)) Q:'DA  D ^DIK
"RTN","RCRJRBD",161,0)
 Q
"RTN","RCRJRBD",162,0)
 ;
"RTN","RCRJRBD",163,0)
 ;
"RTN","RCRJRBD",164,0)
WD3() ;  return the third work day of the month
"RTN","RCRJRBD",165,0)
 N J,P,V,X
"RTN","RCRJRBD",166,0)
 S J=0 F P=$E(DT,1,5)_"01":1 S V=$$DOW^XLFDT(P,1) I V,V<6,'$D(^HOLIDAY("B",P)) S J=J+1 Q:J=3
"RTN","RCRJRBD",167,0)
 S X=+$E(P,6,7)
"RTN","RCRJRBD",168,0)
 Q X
"RTN","RCRJRBD",169,0)
 ;
"RTN","RCRJRBD",170,0)
 ;
"RTN","RCRJRBD",171,0)
PREVMONT(FORDATE) ; return the previous month's date
"RTN","RCRJRBD",172,0)
 N PREVDATE
"RTN","RCRJRBD",173,0)
 S PREVDATE=$E(FORDATE,1,5)-1
"RTN","RCRJRBD",174,0)
 I $E(PREVDATE,4,5)="00" S PREVDATE=($E(PREVDATE,1,3)-1)_12
"RTN","RCRJRBD",175,0)
 Q PREVDATE_"00"
"RTN","RCRJRBD",176,0)
 ;
"RTN","RCRJRBD",177,0)
 ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",178,0)
SGL(CATEGORY,FUND) ;
"RTN","RCRJRBD",179,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2 ; breakout long term care as a subset
"RTN","RCRJRBD",180,0)
 I CATEGORY=8 Q 1339   ; crime or per. vio.
"RTN","RCRJRBD",181,0)
 I CATEGORY=9 Q 1339   ; reimbursable health insurance
"RTN","RCRJRBD",182,0)
 I CATEGORY=10 Q 1338  ; tort feasor
"RTN","RCRJRBD",183,0)
 I CATEGORY=21 Q 1339  ; medicare
"RTN","RCRJRBD",184,0)
 Q 1319
"RTN","RCRJRBDR")
0^2^B57327710
"RTN","RCRJRBDR",1,0)
RCRJRBDR ;WISC/RFJ,TJK-bad debt report generator ;1 Feb 98
"RTN","RCRJRBDR",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,191,203,215**;Mar 20, 1995
"RTN","RCRJRBDR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBDR",4,0)
 Q
"RTN","RCRJRBDR",5,0)
 ;
"RTN","RCRJRBDR",6,0)
 ;
"RTN","RCRJRBDR",7,0)
PRINT ;  print report on printer, called from menu option
"RTN","RCRJRBDR",8,0)
 N RCRJDATE
"RTN","RCRJRBDR",9,0)
 W !!,"This option will print the Bad Debt Report.  This report is automatically"
"RTN","RCRJRBDR",10,0)
 W !,"generated on the day after the EOAM.  The estimated value can be locally"
"RTN","RCRJRBDR",11,0)
 W !,"changed on the first workday after the EOAM."
"RTN","RCRJRBDR",12,0)
 W !,"On the next to last workday of the month, the report is transmitted to FMS.",!
"RTN","RCRJRBDR",13,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCRJRBDR",14,0)
 I $D(IO("Q")) D  Q
"RTN","RCRJRBDR",15,0)
 . S ZTRTN="DQ^RCRJRBDR",ZTDESC="Bad Debt Report"
"RTN","RCRJRBDR",16,0)
 . D ^%ZTLOAD
"RTN","RCRJRBDR",17,0)
 ;
"RTN","RCRJRBDR",18,0)
 W !,"please wait"
"RTN","RCRJRBDR",19,0)
 D DQ
"RTN","RCRJRBDR",20,0)
 Q
"RTN","RCRJRBDR",21,0)
 ;
"RTN","RCRJRBDR",22,0)
 ;
"RTN","RCRJRBDR",23,0)
DQ ;  generate the report
"RTN","RCRJRBDR",24,0)
 ;  rcrjfmm = flag to put in mail message (if $g(rcrjfmm)) (optional)
"RTN","RCRJRBDR",25,0)
 ;  rcrjdate = date month and year for report (optional)
"RTN","RCRJRBDR",26,0)
 ;  rcrjfxsv = fms document id number if sent to fms (optional)
"RTN","RCRJRBDR",27,0)
 ;             (newed and set by rcxfmssv, label Q)
"RTN","RCRJRBDR",28,0)
 ;
"RTN","RCRJRBDR",29,0)
 N %,%I,CHANGED,DATA,DATA1319,DATA1338,DATA1339,DATALTC,DATEREPT,ENDDATE,X
"RTN","RCRJRBDR",30,0)
 N LINE,RCRJFLAG,SCREEN,SPACE,Y
"RTN","RCRJRBDR",31,0)
 ;
"RTN","RCRJRBDR",32,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",33,0)
 S SPACE="",$P(SPACE," ",81)=""
"RTN","RCRJRBDR",34,0)
 ;  the date of the report is for previous month if the DT is before the EOAM date of the current month,  it is for the current month if the date is after the EOAM cut-off date.
"RTN","RCRJRBDR",35,0)
 I $G(RCRJDATE) S RCRJDATE=$E($$LDATE^RCRJR(RCRJDATE),1,5)_"00"
"RTN","RCRJRBDR",36,0)
 I '$G(RCRJDATE) D
"RTN","RCRJRBDR",37,0)
 .I $E(DT,6,7)'>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRBDR",38,0)
 .I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCRJRBDR",39,0)
 S Y=$E(RCRJDATE,1,5)_"00" D DD^%DT S DATEREPT=Y
"RTN","RCRJRBDR",40,0)
 S LINE=0
"RTN","RCRJRBDR",41,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",42,0)
 D SETLINE($E(SPACE,1,32)_"Bad Debt Report")
"RTN","RCRJRBDR",43,0)
 D SETLINE($E(SPACE,1,13)_"Allowance for Bad Debt and Contract Adjustment Report")
"RTN","RCRJRBDR",44,0)
 D SETLINE($E(SPACE,1,27)_"for the month of "_DATEREPT)
"RTN","RCRJRBDR",45,0)
 I $D(RCRJFXSV) D
"RTN","RCRJRBDR",46,0)
 . D SETLINE(" ")
"RTN","RCRJRBDR",47,0)
 . I $E(RCRJFXSV,1,2)="SV" D SETLINE($E(SPACE,1,13)_"***** Report sent to FMS, doc id: "_RCRJFXSV_" *****") Q
"RTN","RCRJRBDR",48,0)
 . ;  report errored out or did not get generated to fms
"RTN","RCRJRBDR",49,0)
 . D SETLINE($E(SPACE,1,10)_"***** NOTICE:  Report was NOT sent to FMS, the message is *****")
"RTN","RCRJRBDR",50,0)
 . D SETLINE($E(SPACE,1,10)_"***** "_RCRJFXSV_" *****")
"RTN","RCRJRBDR",51,0)
 ;
"RTN","RCRJRBDR",52,0)
 ;  show mccf
"RTN","RCRJRBDR",53,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",54,0)
 D SETLINE($E(SPACE,1,26)_"Medical Care Collection Fund")
"RTN","RCRJRBDR",55,0)
 D SETLINE($E(SPACE,1,26)_" Series of 5287 Funds")
"RTN","RCRJRBDR",56,0)
 D SETLINE($E(SPACE,1,26)_"----------------------------")
"RTN","RCRJRBDR",57,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",58,0)
 D SETLINE("Calculated           "_$J("            ",18)_$J(" Third Party",18))
"RTN","RCRJRBDR",59,0)
 D SETLINE("Percentages          "_$J(" First Party",18)_$J("Contract Adj",18)_$J("Tort Feasors",18))
"RTN","RCRJRBDR",60,0)
 D SETLINE("For                  "_$J("    SGL 1319",18)_$J("    SGL 1339",18)_$J("    SGL 1338",18))
"RTN","RCRJRBDR",61,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",62,0)
 S DATA1319=$G(^RC(348.1,+$O(^RC(348.1,"B",1319,0)),0))
"RTN","RCRJRBDR",63,0)
 S DATA1338=$G(^RC(348.1,+$O(^RC(348.1,"B",1338,0)),0))
"RTN","RCRJRBDR",64,0)
 S DATA1339=$G(^RC(348.1,+$O(^RC(348.1,"B",1339,0)),0))
"RTN","RCRJRBDR",65,0)
 D SETLINE("Collection          %"_$J($P(DATA1319,"^",2),18,2)_$J($P(DATA1339,"^",2),18,2)_$J($P(DATA1338,"^",2),18,2))
"RTN","RCRJRBDR",66,0)
 D SETLINE("Write-Off           %"_$J($P(DATA1319,"^",3),18,2)_$J($P(DATA1339,"^",3),18,2)_$J($P(DATA1338,"^",3),18,2))
"RTN","RCRJRBDR",67,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATA1319,"^",4),18,2)_$J($P(DATA1339,"^",4),18,2)_$J($P(DATA1338,"^",4),18,2))
"RTN","RCRJRBDR",68,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",69,0)
 D SETLINE("TOTAL               %"_$J(100,18,2)_$J(100,18,2)_$J(100,18,2))
"RTN","RCRJRBDR",70,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",71,0)
 ;
"RTN","RCRJRBDR",72,0)
 S DATALTC=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.2,0)),0))
"RTN","RCRJRBDR",73,0)
 D SETLINE($E(SPACE,1,26)_"  Extended (LTC) Care Fund 4032")
"RTN","RCRJRBDR",74,0)
 D SETLINE($E(SPACE,1,26)_"---------------------------------")
"RTN","RCRJRBDR",75,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",76,0)
 D SETLINE("Calculated           "_$J("   Fund 4032",18))
"RTN","RCRJRBDR",77,0)
 D SETLINE("Percentages          "_$J(" First Party",18))
"RTN","RCRJRBDR",78,0)
 D SETLINE("For                  "_$J("    SGL 1319",18))
"RTN","RCRJRBDR",79,0)
 D SETLINE("---------------------"_$J("------------",18))
"RTN","RCRJRBDR",80,0)
 D SETLINE("Collection          %"_$J($P(DATALTC,"^",2),18,2))
"RTN","RCRJRBDR",81,0)
 D SETLINE("Write-Off           %"_$J($P(DATALTC,"^",3),18,2))
"RTN","RCRJRBDR",82,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATALTC,"^",4),18,2))
"RTN","RCRJRBDR",83,0)
 D SETLINE("---------------------"_$J("------------",18))
"RTN","RCRJRBDR",84,0)
 D SETLINE("TOTAL               %"_$J(100,18,2))
"RTN","RCRJRBDR",85,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",86,0)
 ;
"RTN","RCRJRBDR",87,0)
 ;  show totals
"RTN","RCRJRBDR",88,0)
 ;  1319 mccf allowance
"RTN","RCRJRBDR",89,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 MCCF):")
"RTN","RCRJRBDR",90,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",91,0)
 S CHANGED="  " I $P(DATA1319,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",92,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1319,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",93,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1319,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",94,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",95,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1319,"^",8)+$P(DATA1319,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",96,0)
 I $P(DATA1319,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",97,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",98,0)
 ;
"RTN","RCRJRBDR",99,0)
 ;  1319 ltc allowance
"RTN","RCRJRBDR",100,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 LTC 4032):")
"RTN","RCRJRBDR",101,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",102,0)
 S CHANGED="  " I $P(DATALTC,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",103,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATALTC,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",104,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATALTC,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",105,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",106,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATALTC,"^",8)+$P(DATALTC,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",107,0)
 I $P(DATALTC,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",108,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",109,0)
 ;
"RTN","RCRJRBDR",110,0)
 ;  1339 allowance
"RTN","RCRJRBDR",111,0)
 D SETLINE("Allowance for Contract Adj - Third Party (SGL 1339):")
"RTN","RCRJRBDR",112,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",113,0)
 S CHANGED="  " I $P(DATA1339,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",114,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1339,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",115,0)
 D SETLINE($E("Bad Debt Contract Adj (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1339,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",116,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",117,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1339,"^",8)+$P(DATA1339,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",118,0)
 I $P(DATA1339,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",119,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",120,0)
 ;
"RTN","RCRJRBDR",121,0)
 ;  1338 allowance
"RTN","RCRJRBDR",122,0)
 D SETLINE("Allowance for Bad Debt - Tort Feasors (SGL 1338):")
"RTN","RCRJRBDR",123,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",124,0)
 S CHANGED="  " I $P(DATA1338,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",125,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1338,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",126,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1338,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",127,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",128,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1338,"^",8)+$P(DATA1338,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",129,0)
 I $P(DATA1338,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",130,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",131,0)
 D SETLINE("Report Footnotes:")
"RTN","RCRJRBDR",132,0)
 D SETLINE("-----------------")
"RTN","RCRJRBDR",133,0)
 ;
"RTN","RCRJRBDR",134,0)
 D ENDOFREP^RCRJRBDT
"RTN","RCRJRBDR",135,0)
 ;
"RTN","RCRJRBDR",136,0)
 ;  put report in mailman
"RTN","RCRJRBDR",137,0)
 I $G(RCRJFMM) D  D Q Q
"RTN","RCRJRBDR",138,0)
 . N XMY
"RTN","RCRJRBDR",139,0)
 . S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRBDR",140,0)
 . S %=$$SENDMSG^RCRJRCOR("BAD DEBT REPORT",.XMY)
"RTN","RCRJRBDR",141,0)
 ;
"RTN","RCRJRBDR",142,0)
 ;  print report
"RTN","RCRJRBDR",143,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCRJRBDR",144,0)
 U IO W @IOF
"RTN","RCRJRBDR",145,0)
 S LINE=1 F  S LINE=$O(^TMP($J,"RCRJRCORMM",LINE)) Q:'LINE!($G(RCRJFLAG))  D
"RTN","RCRJRBDR",146,0)
 . I $Y>(IOSL-5) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  W @IOF F %=2:1:5 W !,^TMP($J,"RCRJRCORMM",%)
"RTN","RCRJRBDR",147,0)
 . W !,^TMP($J,"RCRJRCORMM",LINE)
"RTN","RCRJRBDR",148,0)
 I '$G(RCRJFLAG),SCREEN R !!,"<end of report, press return to continue>",X:DTIME
"RTN","RCRJRBDR",149,0)
 D ^%ZISC
"RTN","RCRJRBDR",150,0)
 ;
"RTN","RCRJRBDR",151,0)
Q K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",152,0)
 Q
"RTN","RCRJRBDR",153,0)
 ;
"RTN","RCRJRBDR",154,0)
 ;
"RTN","RCRJRBDR",155,0)
SETLINE(DATA) ;  build the line for the report
"RTN","RCRJRBDR",156,0)
 S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCRJRBDR",157,0)
 Q
"VER")
8.0^22.0
**END**
**END**
