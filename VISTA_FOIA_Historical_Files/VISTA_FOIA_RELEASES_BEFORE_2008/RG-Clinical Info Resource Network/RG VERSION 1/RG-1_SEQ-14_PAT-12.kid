Released RG*1*12 SEQ #14
Extracted from mail message
**KIDS**:RG*1.0*12^

**INSTALL NAME**
RG*1.0*12
"BLD",1107,0)
RG*1.0*12^CLINICAL INFO RESOURCE NETWORK^0^3010309^y
"BLD",1107,1,0)
^^3^3^3001129^
"BLD",1107,1,1,0)
CIRN EXCEPTION HANDLING ENHANCEMENTS
"BLD",1107,1,2,0)
Refer to patch RG*1*12 in the FORUM Patch Module for a complete
"BLD",1107,1,3,0)
description.
"BLD",1107,4,0)
^9.64PA^^
"BLD",1107,"ABNS",0)
^9.66A^^
"BLD",1107,"ABPKG")
^^
"BLD",1107,"KRN",0)
^9.67PA^19^17
"BLD",1107,"KRN",.4,0)
.4
"BLD",1107,"KRN",.401,0)
.401
"BLD",1107,"KRN",.402,0)
.402
"BLD",1107,"KRN",.403,0)
.403
"BLD",1107,"KRN",.5,0)
.5
"BLD",1107,"KRN",.84,0)
.84
"BLD",1107,"KRN",3.6,0)
3.6
"BLD",1107,"KRN",3.8,0)
3.8
"BLD",1107,"KRN",9.2,0)
9.2
"BLD",1107,"KRN",9.8,0)
9.8
"BLD",1107,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",1107,"KRN",9.8,"NM",1,0)
RGEVPRG^^0^B40504454
"BLD",1107,"KRN",9.8,"NM",2,0)
RGEX01^^0^B29257136
"BLD",1107,"KRN",9.8,"NM",3,0)
RGEXHND1^^0^B33598621
"BLD",1107,"KRN",9.8,"NM",5,0)
RGEX03^^0^B48368804
"BLD",1107,"KRN",9.8,"NM",6,0)
RGDRM01^^0^B7861686
"BLD",1107,"KRN",9.8,"NM",7,0)
RGDRM03^^0^B3467584
"BLD",1107,"KRN",9.8,"NM","B","RGDRM01",6)

"BLD",1107,"KRN",9.8,"NM","B","RGDRM03",7)

"BLD",1107,"KRN",9.8,"NM","B","RGEVPRG",1)

"BLD",1107,"KRN",9.8,"NM","B","RGEX01",2)

"BLD",1107,"KRN",9.8,"NM","B","RGEX03",5)

"BLD",1107,"KRN",9.8,"NM","B","RGEXHND1",3)

"BLD",1107,"KRN",19,0)
19
"BLD",1107,"KRN",19,"NM",0)
^9.68A^10^10
"BLD",1107,"KRN",19,"NM",1,0)
RG MERGE PATIENT^^1^
"BLD",1107,"KRN",19,"NM",2,0)
VAFC EXCEPTION HANDLER^^0
"BLD",1107,"KRN",19,"NM",3,0)
RG ADMIN COORD MENU^^2
"BLD",1107,"KRN",19,"NM",4,0)
RG EXCEPTION MENU^^2
"BLD",1107,"KRN",19,"NM",5,0)
RG EXCEPTION TF INQUIRY^^0
"BLD",1107,"KRN",19,"NM",6,0)
RGCIRN CMOR USER MENU^^0
"BLD",1107,"KRN",19,"NM",7,0)
RGCIRN CMOR INDIV^^0
"BLD",1107,"KRN",19,"NM",8,0)
RGCIRN CMOR STATUS^^0
"BLD",1107,"KRN",19,"NM",9,0)
RGCIRN CMOR DUP SCORES^^0
"BLD",1107,"KRN",19,"NM",10,0)
RGCIRN CMOR DUP STATS^^0
"BLD",1107,"KRN",19,"NM","B","RG ADMIN COORD MENU",3)

"BLD",1107,"KRN",19,"NM","B","RG EXCEPTION MENU",4)

"BLD",1107,"KRN",19,"NM","B","RG EXCEPTION TF INQUIRY",5)

"BLD",1107,"KRN",19,"NM","B","RG MERGE PATIENT",1)

"BLD",1107,"KRN",19,"NM","B","RGCIRN CMOR DUP SCORES",9)

"BLD",1107,"KRN",19,"NM","B","RGCIRN CMOR DUP STATS",10)

"BLD",1107,"KRN",19,"NM","B","RGCIRN CMOR INDIV",7)

"BLD",1107,"KRN",19,"NM","B","RGCIRN CMOR STATUS",8)

"BLD",1107,"KRN",19,"NM","B","RGCIRN CMOR USER MENU",6)

"BLD",1107,"KRN",19,"NM","B","VAFC EXCEPTION HANDLER",2)

"BLD",1107,"KRN",19.1,0)
19.1
"BLD",1107,"KRN",101,0)
101
"BLD",1107,"KRN",101,"NM",0)
^9.68A^15^15
"BLD",1107,"KRN",101,"NM",1,0)
RG EXCPT PATIENT SORT^^0
"BLD",1107,"KRN",101,"NM",2,0)
RG EXCPT MAIN MENU^^0
"BLD",1107,"KRN",101,"NM",3,0)
RG EXCPT ACTION MENU^^0
"BLD",1107,"KRN",101,"NM",4,0)
RG EXCPT TF INQUIRY^^0
"BLD",1107,"KRN",101,"NM",5,0)
RG EXCPT DATE SORT^^0
"BLD",1107,"KRN",101,"NM",6,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",1107,"KRN",101,"NM",7,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",1107,"KRN",101,"NM",8,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",1107,"KRN",101,"NM",9,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",1107,"KRN",101,"NM",10,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",1107,"KRN",101,"NM",11,0)
RG EXCPT SELECT^^0
"BLD",1107,"KRN",101,"NM",12,0)
RG EXCPT SELECT TYPE^^0
"BLD",1107,"KRN",101,"NM",13,0)
RG EXCPT SING PATIENT INIT^^0
"BLD",1107,"KRN",101,"NM",14,0)
RG EXCPT TYPE SORT^^0
"BLD",1107,"KRN",101,"NM",15,0)
RG EXCPT UPDATE STATUS^^0
"BLD",1107,"KRN",101,"NM","B","RG EXCPT ACTION MENU",3)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT DATE SORT",5)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",6)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",7)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",8)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT MAIN MENU",2)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",9)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",10)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",1)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT SELECT",11)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",12)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT SING PATIENT INIT",13)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT TF INQUIRY",4)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT TYPE SORT",14)

"BLD",1107,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",15)

"BLD",1107,"KRN",409.61,0)
409.61
"BLD",1107,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",1107,"KRN",409.61,"NM",1,0)
RG EXCPT SUMMARY^^0
"BLD",1107,"KRN",409.61,"NM","B","RG EXCPT SUMMARY",1)

"BLD",1107,"KRN",771,0)
771
"BLD",1107,"KRN",771,"NM",0)
^9.68A^^
"BLD",1107,"KRN",870,0)
870
"BLD",1107,"KRN",8994,0)
8994
"BLD",1107,"KRN","B",.4,.4)

"BLD",1107,"KRN","B",.401,.401)

"BLD",1107,"KRN","B",.402,.402)

"BLD",1107,"KRN","B",.403,.403)

"BLD",1107,"KRN","B",.5,.5)

"BLD",1107,"KRN","B",.84,.84)

"BLD",1107,"KRN","B",3.6,3.6)

"BLD",1107,"KRN","B",3.8,3.8)

"BLD",1107,"KRN","B",9.2,9.2)

"BLD",1107,"KRN","B",9.8,9.8)

"BLD",1107,"KRN","B",19,19)

"BLD",1107,"KRN","B",19.1,19.1)

"BLD",1107,"KRN","B",101,101)

"BLD",1107,"KRN","B",409.61,409.61)

"BLD",1107,"KRN","B",771,771)

"BLD",1107,"KRN","B",870,870)

"BLD",1107,"KRN","B",8994,8994)

"BLD",1107,"QUES",0)
^9.62^^
"BLD",1107,"REQB",0)
^9.611^4^4
"BLD",1107,"REQB",1,0)
RG*1.0*3^2
"BLD",1107,"REQB",2,0)
DG*5.3*333^2
"BLD",1107,"REQB",3,0)
RG*1.0*6^2
"BLD",1107,"REQB",4,0)
RG*1.0*10^2
"BLD",1107,"REQB","B","DG*5.3*333",2)

"BLD",1107,"REQB","B","RG*1.0*10",4)

"BLD",1107,"REQB","B","RG*1.0*3",1)

"BLD",1107,"REQB","B","RG*1.0*6",3)

"KRN",19,5488,-1)
0^2
"KRN",19,5488,0)
VAFC EXCEPTION HANDLER^Patient Data Review^^R^^^^^^^^REGISTRATION
"KRN",19,5488,1,0)
^^4^4^2990201^^^^
"KRN",19,5488,1,1,0)
This option is used to review demographic data that is logged 
"KRN",19,5488,1,2,0)
into the PATIENT DATA EXCEPTION file (#391.98) from other sites.
"KRN",19,5488,1,3,0)
It allows a user to upload or merge the data into the receiving
"KRN",19,5488,1,4,0)
site's database.
"KRN",19,5488,25)
EN^VAFCEHLM
"KRN",19,5488,"U")
PATIENT DATA REVIEW
"KRN",19,5663,-1)
2^3
"KRN",19,5663,0)
RG ADMIN COORD MENU^CIRN Patient Admin Coordinator Menu^^M^^^^^^^^272^^^
"KRN",19,5663,10,0)
^19.01IP^40^11
"KRN",19,5663,10,37,0)
5922^CMOR^25
"KRN",19,5663,10,37,"^")
RGCIRN CMOR USER MENU
"KRN",19,5663,10,38,0)
6403^MSG^50
"KRN",19,5663,10,38,"^")
RG EXCEPTION MENU
"KRN",19,5663,10,39,0)
5488^PDR^5
"KRN",19,5663,10,39,"^")
VAFC EXCEPTION HANDLER
"KRN",19,5663,"U")
CIRN PATIENT ADMIN COORDINATOR
"KRN",19,5676,-1)
0^8
"KRN",19,5676,0)
RGCIRN CMOR STATUS^CMOR Score Calculation Status^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5676,1,0)
^^2^2^2981020^^
"KRN",19,5676,1,1,0)
This option allows the users to status the progress of the CIRN Master of
"KRN",19,5676,1,2,0)
Record (CMOR) score initialization process.
"KRN",19,5676,25)
DISPLAY^RGVCCMR1
"KRN",19,5676,"U")
CMOR SCORE CALCULATION STATUS
"KRN",19,5678,-1)
0^7
"KRN",19,5678,0)
RGCIRN CMOR INDIV^Calculate Individual Patient CMOR Score^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5678,1,0)
^^4^4^2981020^^
"KRN",19,5678,1,1,0)
This option allows for the calculation of a CMOR patient activity score
"KRN",19,5678,1,2,0)
for an individual patient.  After it is calculated, the score is filed in
"KRN",19,5678,1,3,0)
the PATIENT file (#2), in fields CMOR ACTIVITY SCORE (#991.06) and SCORE
"KRN",19,5678,1,4,0)
CALCULATION DATE (#991.07).
"KRN",19,5678,25)
INDIV^RGVCCMR1
"KRN",19,5678,"U")
CALCULATE INDIVIDUAL PATIENT C
"KRN",19,5916,-1)
0^9
"KRN",19,5916,0)
RGCIRN CMOR DUP SCORES^Duplicate Record by CMOR Score^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5916,1,0)
^^11^11^2981020^^
"KRN",19,5916,1,1,0)
This option provides a listing of the CMOR scores from the DUPLICATE
"KRN",19,5916,1,2,0)
RECORD file (#15). It will display the number of duplicates per every 100
"KRN",19,5916,1,3,0)
points.
"KRN",19,5916,1,4,0)
 
"KRN",19,5916,1,5,0)
For example:  
"KRN",19,5916,1,6,0)
There may be 10 patients with a score between 100 and 199. A NO SCORE
"KRN",19,5916,1,7,0)
means that the pair of potential dupes had no score (no activity in the
"KRN",19,5916,1,8,0)
last three years).
"KRN",19,5916,1,9,0)
 
"KRN",19,5916,1,10,0)
The total entries for the PATIENT file (#2) and the DUPLICATE RECORD
"KRN",19,5916,1,11,0)
file (#15) is also displayed.
"KRN",19,5916,25)
RGMTDPSC
"KRN",19,5916,"U")
DUPLICATE RECORD BY CMOR SCORE
"KRN",19,5917,-1)
0^10
"KRN",19,5917,0)
RGCIRN CMOR DUP STATS^Duplicate Record Statistics^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5917,1,0)
^^2^2^2981020^^^
"KRN",19,5917,1,1,0)
This option provides the user with the percentiles of the patients in the
"KRN",19,5917,1,2,0)
various status categories for merge and verification status.
"KRN",19,5917,25)
RGMTDPCT
"KRN",19,5917,"U")
DUPLICATE RECORD STATISTICS
"KRN",19,5922,-1)
0^6
"KRN",19,5922,0)
RGCIRN CMOR USER MENU^CMOR User Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5922,1,0)
^^3^3^2990302^^^
"KRN",19,5922,1,1,0)
This menu contains options for CIRN Master of Record (CMOR) 
"KRN",19,5922,1,2,0)
for calculating individual scores, status of CMOR calculation,
"KRN",19,5922,1,3,0)
and scoring options based on CMOR scores.
"KRN",19,5922,10,0)
^19.01IP^4^4
"KRN",19,5922,10,1,0)
5678^IND^5
"KRN",19,5922,10,1,"^")
RGCIRN CMOR INDIV
"KRN",19,5922,10,2,0)
5676^CSS^10
"KRN",19,5922,10,2,"^")
RGCIRN CMOR STATUS
"KRN",19,5922,10,3,0)
5916^DRS^15
"KRN",19,5922,10,3,"^")
RGCIRN CMOR DUP SCORES
"KRN",19,5922,10,4,0)
5917^STAT^20
"KRN",19,5922,10,4,"^")
RGCIRN CMOR DUP STATS
"KRN",19,5922,99)
57588,47728
"KRN",19,5922,"U")
CMOR USER MENU
"KRN",19,6403,-1)
2^4
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^^^^^^^^272
"KRN",19,6403,10,0)
^19.01IP^3^3
"KRN",19,6403,10,3,0)
6712^^10
"KRN",19,6403,10,3,"^")
RG EXCEPTION TF INQUIRY
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6712,-1)
0^5
"KRN",19,6712,0)
RG EXCEPTION TF INQUIRY^Treating Facility Inquiry^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6712,1,0)
^19.06^3^3^3001206^^
"KRN",19,6712,1,1,0)
This option displays Clinical Information Resource Network - Patient
"KRN",19,6712,1,2,0)
Demographics and Master Patient Index (CIRN PD/MPI) information for
"KRN",19,6712,1,3,0)
a selected patient.
"KRN",19,6712,25)
PDAT^RGEX01
"KRN",19,6712,"U")
TREATING FACILITY INQUIRY
"KRN",19,6725,-1)
1^1
"KRN",19,6725,0)
RG MERGE PATIENT
"KRN",101,1692,-1)
0^2
"KRN",101,1692,0)
RG EXCPT MAIN MENU^CIRN EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^^2^2^3000125^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^SE^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SN^7^^^Sort by Patient Name
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
58381,50206
"KRN",101,1693,-1)
0^11
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^^3^3^2991102^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the CIRN Exceptions screen in the CIRN Exception Handling
"KRN",101,1693,1,3,0)
option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
58043,62323
"KRN",101,1694,-1)
0^3
"KRN",101,1694,0)
RG EXCPT ACTION MENU^CIRN EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^^4^4^3000225^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the CIRN
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1694,4)
40
"KRN",101,1694,10,0)
^101.01PA^10^10
"KRN",101,1694,10,3,0)
1695^UPD^50^^^Update Status to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^42^^^MPI Display Only Query
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,5,0)
1697^SPI^45^^^Single Patient Init to MPI
"KRN",101,1694,10,5,"^")
RG EXCPT SING PATIENT INIT
"KRN",101,1694,10,6,0)
1698^ED^47^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^PI^35^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^30^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^40^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,10,10,0)
1806^TF^60^^^Treating Facility Inquiry
"KRN",101,1694,10,10,"^")
RG EXCPT TF INQUIRY
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
58389,24752
"KRN",101,1695,-1)
0^15
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^^3^3^3000125^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the CIRN Exception Handling option [RG CIRN 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
58043,62323
"KRN",101,1696,-1)
0^6
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^^2^2^3000125^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
58043,62323
"KRN",101,1697,-1)
0^13
"KRN",101,1697,0)
RG EXCPT SING PATIENT INIT^Single Patient Init to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1697,1,0)
^^3^3^3000125^^^
"KRN",101,1697,1,1,0)
This protocol allows the user to perform a Single Patient
"KRN",101,1697,1,2,0)
Initialization to the MPI from the CIRN Exception Handling option
"KRN",101,1697,1,3,0)
[RG CIRN EXCEPTION HANDLING].
"KRN",101,1697,20)
D INTL^RGEX03
"KRN",101,1697,99)
58043,62323
"KRN",101,1698,-1)
0^7
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^^2^2^3000125^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
58043,62323
"KRN",101,1699,-1)
0^14
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^^2^2^2991029^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
CIRN Exception Handling Option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
58043,62323
"KRN",101,1700,-1)
0^5
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^^2^2^2991029^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
58043,62323
"KRN",101,1701,-1)
0^1
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^^2^2^2991029^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SN" D SORT^RGEX01
"KRN",101,1701,99)
58043,62323
"KRN",101,1702,-1)
0^12
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^^4^4^2991105^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the CIRN Exceptions screen in the CIRN Exception Handling
"KRN",101,1702,1,4,0)
option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
58043,62323
"KRN",101,1703,-1)
0^10
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^^2^2^2991029^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
58043,62323
"KRN",101,1704,-1)
0^9
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^^2^2^2991029^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
CIRN Exception Handling option [RG CIRN EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
58043,62323
"KRN",101,1705,-1)
0^8
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^^3^3^2991029^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the CIRN Exception Handling option 
"KRN",101,1705,1,3,0)
[RG CIRN EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
58043,62323
"KRN",101,1806,-1)
0^4
"KRN",101,1806,0)
RG EXCPT TF INQUIRY^Treating Facility Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1806,1,0)
^101.06^3^3^3001206^^
"KRN",101,1806,1,1,0)
This protocol displays Clinical Information Resource Network - 
"KRN",101,1806,1,2,0)
Patient Demographics and Master Patient Index (CIRN PD/MPI) 
"KRN",101,1806,1,3,0)
information for the selected patient.
"KRN",101,1806,2,0)
^101.02A^1^1
"KRN",101,1806,2,1,0)
TF
"KRN",101,1806,2,"B","TF",1)

"KRN",101,1806,20)
D PDAT^RGEX03
"KRN",101,1806,99)
58381,53707
"KRN",409.61,230,-1)
0^1
"KRN",409.61,230,0)
RG EXCPT SUMMARY^1^^80^5^18^1^1^^RG EXCPT MAIN MENU^CIRN EXCEPTION HANDLING^1^^1
"KRN",409.61,230,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,230,"ARRAY")
 ^TMP("RGEXC",$J)
"KRN",409.61,230,"COL",0)
^409.621^4^4
"KRN",409.61,230,"COL",1,0)
Patient^6^21^Patient^H^0
"KRN",409.61,230,"COL",2,0)
SSN^28^9^SSN^H^0
"KRN",409.61,230,"COL",3,0)
Date^39^8^Dt Rec'd^^0
"KRN",409.61,230,"COL",4,0)
Exception Type^49^30^Exception Type^^0
"KRN",409.61,230,"COL","AIDENT",0,1)

"KRN",409.61,230,"COL","AIDENT",0,2)

"KRN",409.61,230,"COL","AIDENT",0,3)

"KRN",409.61,230,"COL","AIDENT",0,4)

"KRN",409.61,230,"COL","B","Date",3)

"KRN",409.61,230,"COL","B","Exception Type",4)

"KRN",409.61,230,"COL","B","Patient",1)

"KRN",409.61,230,"COL","B","SSN",2)

"KRN",409.61,230,"FNL")
D EXIT^RGEX01
"KRN",409.61,230,"HDR")
D HDR^RGEX01
"KRN",409.61,230,"HLP")
D HELP^RGEX01
"KRN",409.61,230,"INIT")
D INIT^RGEX01
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
12^3010309
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3010309
"PKG",272,22,1,"PAH",1,1,1,0)
CIRN EXCEPTION HANDLING ENHANCEMENTS
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*12 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RGDRM01")
0^6^B7861686
"RTN","RGDRM01",1,0)
RGDRM01 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;02/22/00
"RTN","RGDRM01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6,10,12**;30 Apr 99
"RTN","RGDRM01",3,0)
 ;
"RTN","RGDRM01",4,0)
 ;Reference to ^DPT( supported by IA #2070
"RTN","RGDRM01",5,0)
 ;Reference to ^DPT("AICN" supported by IA #2070
"RTN","RGDRM01",6,0)
 ;
"RTN","RGDRM01",7,0)
CKICNS(DFNFRM,DFNTO) ;Check ICN's and CMORs of FROM and TO records of
"RTN","RGDRM01",8,0)
 ; duplicate record pair
"RTN","RGDRM01",9,0)
 N CMORFRM,CMORTO,RETURN,ICNFRM,ICNTO,LOCFRM,LOCTO
"RTN","RGDRM01",10,0)
 S RETURN="1^OK to merge"
"RTN","RGDRM01",11,0)
 I ($G(DFNFRM)'>0)!($G(DFNTO)'>0) S RETURN="0^DFN NOT PASSED" G EXIT
"RTN","RGDRM01",12,0)
 S CMORFRM=$$GETVCCI^MPIF001(DFNFRM)
"RTN","RGDRM01",13,0)
 S CMORTO=$$GETVCCI^MPIF001(DFNTO)
"RTN","RGDRM01",14,0)
 S ICNFRM=$$GETICN^MPIF001(DFNFRM)
"RTN","RGDRM01",15,0)
 ; If FROM record has no ICN quit
"RTN","RGDRM01",16,0)
 I ICNFRM<0 G EXIT
"RTN","RGDRM01",17,0)
 S ICNTO=$$GETICN^MPIF001(DFNTO)
"RTN","RGDRM01",18,0)
 S LOCFRM=$$IFLOCAL^MPIF001(DFNFRM)
"RTN","RGDRM01",19,0)
 S LOCTO=$$IFLOCAL^MPIF001(DFNTO)
"RTN","RGDRM01",20,0)
 ; If both records have local ICNs, delete FROM data, keep TO data 
"RTN","RGDRM01",21,0)
 I (LOCFRM=1)&(LOCTO=1) S ICN=$P(ICNFRM,"V",1) D DEL D DEL^RGDRM03 G EXIT
"RTN","RGDRM01",22,0)
 S HOME=$$SITE^VASITE()
"RTN","RGDRM01",23,0)
 ; If both records have National ICNs, log an exception
"RTN","RGDRM01",24,0)
 I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&($E(ICNTO,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNTO>0)) D  G EXIT
"RTN","RGDRM01",25,0)
 . S RETURN="0^CANNOT MERGE RECORDS "_DFNFRM_" AND "_DFNTO_", both records have national ICNs assigned and must be resolved before merging."
"RTN","RGDRM01",26,0)
 . ; exception is logged when RETURN is passed back to RGDRM03
"RTN","RGDRM01",27,0)
 . ; Q RETURN
"RTN","RGDRM01",28,0)
 ; If FROM record is local and TO record is null, merge
"RTN","RGDRM01",29,0)
 I (LOCFRM=1)&(ICNTO<0) D MRGICN D MRGCMOR^RGDRM03
"RTN","RGDRM01",30,0)
 ; If FROM record is National and TO record is local, merge
"RTN","RGDRM01",31,0)
 E  I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&(LOCTO=1) D MRGICN D MRGCMOR^RGDRM03
"RTN","RGDRM01",32,0)
 ; If FROM record is National and TO record is null, merge
"RTN","RGDRM01",33,0)
 E  I ($E(ICNFRM,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNFRM>0))&(ICNTO<1) D MRGICN D MRGCMOR^RGDRM03
"RTN","RGDRM01",34,0)
 ; If FROM record is local and TO record is National, delete FROM data, keep TO data
"RTN","RGDRM01",35,0)
 E  I (LOCFRM=1)&(LOCTO=0)&(ICNTO>0) S ICN=$P(ICNFRM,"V",1) D DEL D DEL^RGDRM03 G EXIT
"RTN","RGDRM01",36,0)
 ;
"RTN","RGDRM01",37,0)
EXIT ;
"RTN","RGDRM01",38,0)
 Q RETURN
"RTN","RGDRM01",39,0)
MRGICN ;Set ICN and ICN Checksum in TO record to values in FROM record
"RTN","RGDRM01",40,0)
 N ICN,CKSUM,DIQUIET,RGRSICN
"RTN","RGDRM01",41,0)
 S DIQUIET=1,RGRSICN=1
"RTN","RGDRM01",42,0)
 S ICN=$P(ICNFRM,"V",1),CKSUM=$P(ICNFRM,"V",2)
"RTN","RGDRM01",43,0)
 L +^DPT(DFNTO):10
"RTN","RGDRM01",44,0)
 S DIE="^DPT(",DA=DFNTO,DR="991.01///^S X=ICN;991.02///^S X=CKSUM"
"RTN","RGDRM01",45,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM01",46,0)
 L -^DPT(DFNTO)
"RTN","RGDRM01",47,0)
 S ICNTO="" S ICNTO=$$GETICN^MPIF001(DFNTO)
"RTN","RGDRM01",48,0)
 ;Make sure local icn flag is not set if national just got assigned
"RTN","RGDRM01",49,0)
 I ($E(ICNTO,1,3)'=$E($P(HOME,"^",3),1,3)&(ICNTO>0)) D
"RTN","RGDRM01",50,0)
 . L +^DPT(DFNTO):10
"RTN","RGDRM01",51,0)
 . S DIE="^DPT(",DA=DFNTO,DR="991.04///@"
"RTN","RGDRM01",52,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGDRM01",53,0)
 . L -^DPT(DFNTO)
"RTN","RGDRM01",54,0)
 ; set local icn flag to Y if local just got assigned
"RTN","RGDRM01",55,0)
 I $E(ICNTO,1,3)=$E($P(HOME,"^",3),1,3) D
"RTN","RGDRM01",56,0)
 . L +^DPT(DFNTO):10
"RTN","RGDRM01",57,0)
 . S DIE="^DPT(",DA=DFNTO,DR="991.04///^S X=1"
"RTN","RGDRM01",58,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGDRM01",59,0)
 . L -^DPT(DFNTO)
"RTN","RGDRM01",60,0)
 ;Delete ICN, ICN Checksum and Locally Assigned ICN fields in FROM record
"RTN","RGDRM01",61,0)
DEL S DIQUIET=1,RGRSICN=1
"RTN","RGDRM01",62,0)
 L +^DPT(DFNFRM):10
"RTN","RGDRM01",63,0)
 S DIE="^DPT(",DA=DFNFRM,DR="991.01///@;991.02///@;991.04///@"
"RTN","RGDRM01",64,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM01",65,0)
 K ^DPT("AICN",ICN,DFNFRM)
"RTN","RGDRM01",66,0)
 L -^DPT(DFNFRM)
"RTN","RGDRM01",67,0)
 Q
"RTN","RGDRM03")
0^7^B3467584
"RTN","RGDRM03",1,0)
RGDRM03 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;03/17/00
"RTN","RGDRM03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6,12**;30 Apr 99
"RTN","RGDRM03",3,0)
 ;
"RTN","RGDRM03",4,0)
 ;Reference to ^DPT( supported by IA #2070
"RTN","RGDRM03",5,0)
 ;Reference to RMOVPAIR^XDRDVAL1 supported by IA #3168
"RTN","RGDRM03",6,0)
 ;
"RTN","RGDRM03",7,0)
EN(ARRAY) ; Entry point
"RTN","RGDRM03",8,0)
 F DFNFRM=0:0 S DFNFRM=$O(@ARRAY@(DFNFRM)) Q:DFNFRM'>0  D
"RTN","RGDRM03",9,0)
 . S DFNTO=$O(@ARRAY@(DFNFRM,""))
"RTN","RGDRM03",10,0)
 . S IENFRM=$O(@ARRAY@(DFNFRM,DFNTO,""))
"RTN","RGDRM03",11,0)
 . S IENTO=$O(@ARRAY@(DFNFRM,DFNTO,IENFRM,""))
"RTN","RGDRM03",12,0)
 . S RETURN=$$CKICNS^RGDRM01(DFNFRM,DFNTO)
"RTN","RGDRM03",13,0)
 . I $P(RETURN,"^",1)=1 D
"RTN","RGDRM03",14,0)
 .. D MRGTF^RGDRM02(DFNFRM,DFNTO)
"RTN","RGDRM03",15,0)
 .. D MRGSUB^RGDRM02(DFNFRM,DFNTO)
"RTN","RGDRM03",16,0)
 . I $P(RETURN,"^",1)<1 D
"RTN","RGDRM03",17,0)
 .. D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(233,$P(RETURN,"^",2),DFNTO),STOP^RGHLLOG(0)
"RTN","RGDRM03",18,0)
 ..; remove pair from merge
"RTN","RGDRM03",19,0)
 .. S IEN=""
"RTN","RGDRM03",20,0)
 .. S IEN=+$G(@ARRAY@(DFNFRM,DFNTO,IENFRM,IENTO))
"RTN","RGDRM03",21,0)
 .. D RMOVPAIR^XDRDVAL1(DFNFRM,DFNTO,IEN,ARRAY)
"RTN","RGDRM03",22,0)
 ; Check to see if there are any pairs left to merge
"RTN","RGDRM03",23,0)
 K IEN,IENTO,IENFRM
"RTN","RGDRM03",24,0)
 Q
"RTN","RGDRM03",25,0)
MRGCMOR ; If the 'FROM' record has a CMOR and the 'TO' record does not, set the
"RTN","RGDRM03",26,0)
 ; field in the 'TO' record and delete the field in the 'FROM' record.
"RTN","RGDRM03",27,0)
 ; The CMOR score will be recalculated for the TO record when 
"RTN","RGDRM03",28,0)
 ; merge completes.
"RTN","RGDRM03",29,0)
 L +^DPT(DFNTO):10
"RTN","RGDRM03",30,0)
 S DIE="^DPT(",DA=DFNTO,DR="991.03///^S X=CMORFRM"
"RTN","RGDRM03",31,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM03",32,0)
 L -^DPT(DFNTO)
"RTN","RGDRM03",33,0)
DEL ; Delete field in 'FROM' record
"RTN","RGDRM03",34,0)
 L +^DPT(DFNFRM):10
"RTN","RGDRM03",35,0)
 S DIE="^DPT(",DA=DFNFRM,DR="991.03///@;991.06///@;991.07///@"
"RTN","RGDRM03",36,0)
 D ^DIE K DIE,DA,DR
"RTN","RGDRM03",37,0)
 L -^DPT(DFNFRM)
"RTN","RGDRM03",38,0)
 Q
"RTN","RGDRM03",39,0)
EXIT ;
"RTN","RGDRM03",40,0)
 Q RETURN
"RTN","RGDRM03",41,0)
GETSCR(DFN) ; Get CMOR score and calculation date given IEN (DFN) of patient file (#2)
"RTN","RGDRM03",42,0)
 Q:'DFN
"RTN","RGDRM03",43,0)
 N SCORE,SCOREDT,RETURN,SCR
"RTN","RGDRM03",44,0)
 I '$D(^DPT(DFN,"MPI")) S RETURN="-1^No MPI Node" G EXIT2
"RTN","RGDRM03",45,0)
 S DIC="^DPT(",DR="991.06;991.07",DA=DFN,DIQ="SCR",DIQ(0)="I"
"RTN","RGDRM03",46,0)
 D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","RGDRM03",47,0)
 S SCORE=$G(SCR(2,DFN,991.06,"I"))
"RTN","RGDRM03",48,0)
 S SCOREDT=$G(SCR(2,DFN,991.07,"I"))
"RTN","RGDRM03",49,0)
 S RETURN=SCORE_"^"_SCOREDT
"RTN","RGDRM03",50,0)
EXIT2 ;
"RTN","RGDRM03",51,0)
 Q RETURN
"RTN","RGEVPRG")
0^1^B40504454
"RTN","RGEVPRG",1,0)
RGEVPRG ;BAY/ALS-OPTIONS TO PURGE CIRN EXCEPTIONS ;08/23/99
"RTN","RGEVPRG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12**;30 Apr 99
"RTN","RGEVPRG",3,0)
 ;
"RTN","RGEVPRG",4,0)
MAIN ;
"RTN","RGEVPRG",5,0)
 Q:($D(^TMP("RGEXC")))!($D(^TMP("RGEXC2")))
"RTN","RGEVPRG",6,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):5 E  Q
"RTN","RGEVPRG",7,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RGEVPRG",8,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",1)=$$NOW^XLFDT
"RTN","RGEVPRG",9,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="R"
"RTN","RGEVPRG",10,0)
 D PROC
"RTN","RGEVPRG",11,0)
 D PRGDUP
"RTN","RGEVPRG",12,0)
 D PRG30
"RTN","RGEVPRG",13,0)
 D PRGZZ
"RTN","RGEVPRG",14,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",2)=$$NOW^XLFDT
"RTN","RGEVPRG",15,0)
 S $P(^RGSITE(991.8,1,"EXCPRG"),"^",3)="C"
"RTN","RGEVPRG",16,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEVPRG",17,0)
 Q
"RTN","RGEVPRG",18,0)
PRGPAT ;Purge by Patient
"RTN","RGEVPRG",19,0)
 W !
"RTN","RGEVPRG",20,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: "
"RTN","RGEVPRG",21,0)
 D ^DIC K DIC G:Y<0 QUIT  S RGDFN=+Y
"RTN","RGEVPRG",22,0)
 S EXCT="",FLAG=0
"RTN","RGEVPRG",23,0)
 F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:EXCT=""  D
"RTN","RGEVPRG",24,0)
 . I $D(^RGHL7(991.1,"ADFN",EXCT,RGDFN)) S FLAG=1 Q
"RTN","RGEVPRG",25,0)
 I FLAG=0 W !,"There are no exceptions on file for this patient." G PRGPAT
"RTN","RGEVPRG",26,0)
 I $$IFLOCAL^MPIF001(RGDFN) W !,"This patient does not have a national ICN assigned, do not purge." Q
"RTN","RGEVPRG",27,0)
 S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",28,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",29,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file for "_VADM(1)_"?   YES//  "
"RTN","RGEVPRG",30,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",31,0)
 . S EXCT="",CNT=0
"RTN","RGEVPRG",32,0)
 . F  S EXCT=$O(^RGHL7(991.1,"ADFN",EXCT)) Q:'EXCT  D
"RTN","RGEVPRG",33,0)
 .. S IEN=0
"RTN","RGEVPRG",34,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",35,0)
 ... S IEN2=0
"RTN","RGEVPRG",36,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCT,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",37,0)
 .... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",38,0)
 .... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",39,0)
 .... E  I NUM>1 D DEL
"RTN","RGEVPRG",40,0)
 . W !,"All exceptions purged for "_VADM(1)_"   DFN: "_RGDFN
"RTN","RGEVPRG",41,0)
 K EXCT,DFN,FLAG,VADM,CNT,IEN,IEN2,NUM,RGDFN,Y
"RTN","RGEVPRG",42,0)
QUIT Q
"RTN","RGEVPRG",43,0)
 ;
"RTN","RGEVPRG",44,0)
PRGDT ; Purge by Date
"RTN","RGEVPRG",45,0)
 W !!,"Enter a date for the purge. All exceptions on file, on or before that date, will be deleted."
"RTN","RGEVPRG",46,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGEVPRG",47,0)
 S DIR(0)="DA^:DT:EPX",DIR("A")="Enter Date for Purge: "
"RTN","RGEVPRG",48,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","RGEVPRG",49,0)
 S PURDT=Y
"RTN","RGEVPRG",50,0)
 S PDATE=$$FMTE^XLFDT(PURDT)
"RTN","RGEVPRG",51,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",52,0)
 S DIR("A")="Are you sure you want to purge all exceptions on file dated on or before "_PDATE_"?  YES//  "
"RTN","RGEVPRG",53,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",54,0)
 . S EXCDT="",CNT=0
"RTN","RGEVPRG",55,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",56,0)
 .. I ($P(EXCDT,".",1)=PURDT)!($P(EXCDT,".",1)<PURDT) D
"RTN","RGEVPRG",57,0)
 ... S IEN=0
"RTN","RGEVPRG",58,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",59,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1
"RTN","RGEVPRG",60,0)
 .... S CNT=CNT+NUM
"RTN","RGEVPRG",61,0)
 .... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",62,0)
 .... D ^DIK K DIK,DA
"RTN","RGEVPRG",63,0)
 I CNT=0 W !,"There are no exceptions dated on or before "_PDATE_", no data to purge."
"RTN","RGEVPRG",64,0)
 E  I CNT>0 W !,CNT_" exceptions, dated on or before "_PDATE_" have been purged!"
"RTN","RGEVPRG",65,0)
 K PDATE,PURDT,EXCDT,CNT,IEN,NUM,Y
"RTN","RGEVPRG",66,0)
 Q
"RTN","RGEVPRG",67,0)
PRG30   ; Purge Exceptions over 30 days old
"RTN","RGEVPRG",68,0)
 S TODAY=""
"RTN","RGEVPRG",69,0)
 S TODAY=$$NOW^XLFDT D
"RTN","RGEVPRG",70,0)
 . S EXCDT="",CNT=0,DIFF=""
"RTN","RGEVPRG",71,0)
 . F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEVPRG",72,0)
 .. S DIFF=$$FMDIFF^XLFDT(TODAY,EXCDT)
"RTN","RGEVPRG",73,0)
 .. I DIFF>30 D
"RTN","RGEVPRG",74,0)
 ... S IEN=0
"RTN","RGEVPRG",75,0)
 ... F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEVPRG",76,0)
 .... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:'NUM
"RTN","RGEVPRG",77,0)
 .... S IEN2=0
"RTN","RGEVPRG",78,0)
 .... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",79,0)
 ..... S STAT=""
"RTN","RGEVPRG",80,0)
 ..... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)
"RTN","RGEVPRG",81,0)
 ..... ; Only delete PROCESSED exceptions
"RTN","RGEVPRG",82,0)
 ..... I STAT>0 D
"RTN","RGEVPRG",83,0)
 ...... I NUM>1 D DEL
"RTN","RGEVPRG",84,0)
 ...... E  I NUM=1 D
"RTN","RGEVPRG",85,0)
 ....... S CNT=CNT+NUM
"RTN","RGEVPRG",86,0)
 ....... S DIK="^RGHL7(991.1,",DA=IEN
"RTN","RGEVPRG",87,0)
 ....... D ^DIK K DIK,DA
"RTN","RGEVPRG",88,0)
 K DIFF,TODAY,EXCDT,CNT,IEN,IEN2,NUM,STAT
"RTN","RGEVPRG",89,0)
 Q
"RTN","RGEVPRG",90,0)
PRGEXC ; Purge by Exception Type
"RTN","RGEVPRG",91,0)
 ;S DIC="^RGHL7(991.11,",DIC(0)="QEAM"
"RTN","RGEVPRG",92,0)
 ;S DIC("A")="Enter an exception type to purge: "
"RTN","RGEVPRG",93,0)
 ;D ^DIC K DIC G:Y<200 QUIT  S EXCTYP=+Y,ETYPE=X
"RTN","RGEVPRG",94,0)
 ;S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEVPRG",95,0)
 ;S DIR("A")="*WARNING* This will permanently delete all "_ETYPE_" exceptions. Are you sure you want to do this?  YES//  "
"RTN","RGEVPRG",96,0)
 ;D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEVPRG",97,0)
 ;. S CNT=0,IEN=""
"RTN","RGEVPRG",98,0)
 ;. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",99,0)
 ;.. S IEN2=0
"RTN","RGEVPRG",100,0)
 ;.. F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",101,0)
 ;... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",102,0)
 ;... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",103,0)
 ;... E  I NUM>1 D DEL
"RTN","RGEVPRG",104,0)
 ;I CNT=0 W !,"There are no "_ETYPE_" exceptions on file."
"RTN","RGEVPRG",105,0)
 ;E  I CNT>0 W !,CNT_" "_ETYPE_" Exceptions purged!"
"RTN","RGEVPRG",106,0)
 ;K ETYPE,CNT,IEN,IEN2,NUM,X,Y
"RTN","RGEVPRG",107,0)
 ;Q
"RTN","RGEVPRG",108,0)
PRGDUP ; Purge Duplicate Entries
"RTN","RGEVPRG",109,0)
 S EXCTYP="",CNT=0
"RTN","RGEVPRG",110,0)
 K ^TMP("RGEVDUP",$J)
"RTN","RGEVPRG",111,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",112,0)
 . S RGDFN=""
"RTN","RGEVPRG",113,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",114,0)
 .. S IEN=0
"RTN","RGEVPRG",115,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",116,0)
 ... S IEN2=0
"RTN","RGEVPRG",117,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",118,0)
 .... S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEVPRG",119,0)
 .... I '$D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D  Q
"RTN","RGEVPRG",120,0)
 ..... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",121,0)
 .... I $D(^TMP("RGEVDUP",$J,RGDFN,EXCTYP)) D
"RTN","RGEVPRG",122,0)
 ..... S OLDNODE=^TMP("RGEVDUP",$J,RGDFN,EXCTYP)
"RTN","RGEVPRG",123,0)
 ..... S OLDDT=$P(OLDNODE,"^")
"RTN","RGEVPRG",124,0)
 ..... I EXCDT>OLDDT D  Q
"RTN","RGEVPRG",125,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",126,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=$P(OLDNODE,"^",2) D ^DIK K DIK,DA
"RTN","RGEVPRG",127,0)
 ...... E  I NUM>1 D
"RTN","RGEVPRG",128,0)
 ....... S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGEVPRG",129,0)
 ....... S DIK="^RGHL7(991.1,"_DA(1)_",1," D ^DIK K DIK,DA
"RTN","RGEVPRG",130,0)
 ...... S CNT=CNT+1
"RTN","RGEVPRG",131,0)
 ...... S ^TMP("RGEVDUP",$J,RGDFN,EXCTYP)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGEVPRG",132,0)
 ..... I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGEVPRG",133,0)
 ...... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",134,0)
 ...... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA S CNT=CNT+1
"RTN","RGEVPRG",135,0)
 ...... E  I NUM>1 D DEL
"RTN","RGEVPRG",136,0)
 ; W !,CNT_" Duplicate entries"
"RTN","RGEVPRG",137,0)
 K OLDDT,OLDNODE,EXCDT,CNT,IEN,IEN2,NUM,RGDFN
"RTN","RGEVPRG",138,0)
 Q
"RTN","RGEVPRG",139,0)
PRGZZ ;Purge ZZ (Duplicate indicator) patients from exception file.
"RTN","RGEVPRG",140,0)
 S EXCTYP="",CNT=""
"RTN","RGEVPRG",141,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",142,0)
 . S RGDFN=""
"RTN","RGEVPRG",143,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEVPRG",144,0)
 .. S IEN=0
"RTN","RGEVPRG",145,0)
 .. F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEVPRG",146,0)
 ... S IEN2=0
"RTN","RGEVPRG",147,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",148,0)
 .... S DFN=RGDFN D DEM^VADPT
"RTN","RGEVPRG",149,0)
 .... I ($E($G(VADM(1)),1,2)="ZZ")!(VADM(1)="")!($E($G(VADM(1)),1,7)="MERGING") D
"RTN","RGEVPRG",150,0)
 ..... S NUM="" S NUM=$P(^RGHL7(991.1,IEN,1,0),"^",4)
"RTN","RGEVPRG",151,0)
 ..... I NUM=1 S DIK="^RGHL7(991.1,",DA=IEN D ^DIK K DIK,DA
"RTN","RGEVPRG",152,0)
 ..... E  I NUM>1 D DEL
"RTN","RGEVPRG",153,0)
 K EXCTYP,RGDFN,DFN,IEN,IEN2,NUM,VADM
"RTN","RGEVPRG",154,0)
 Q
"RTN","RGEVPRG",155,0)
DEL ;
"RTN","RGEVPRG",156,0)
 S CNT=CNT+1
"RTN","RGEVPRG",157,0)
 S DA(1)=IEN,DA=IEN2
"RTN","RGEVPRG",158,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",159,0)
 D ^DIK K DIK,DA
"RTN","RGEVPRG",160,0)
 Q
"RTN","RGEVPRG",161,0)
PROC ; 
"RTN","RGEVPRG",162,0)
 S EXCTYP=""
"RTN","RGEVPRG",163,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEVPRG",164,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEVPRG",165,0)
 . I (EXCTYP=209)!(EXCTYP=213)!(EXCTYP=214)!(EXCTYP=218) D
"RTN","RGEVPRG",166,0)
 .. S IEN=0
"RTN","RGEVPRG",167,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEVPRG",168,0)
 ... S IEN2=0,ICN="",RGDFN=""
"RTN","RGEVPRG",169,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEVPRG",170,0)
 .... S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEVPRG",171,0)
 .... S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEVPRG",172,0)
 .... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEVPRG",173,0)
 ..... L +^RGHL7(991.1,IEN):10
"RTN","RGEVPRG",174,0)
 ..... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEVPRG",175,0)
 ..... D ^DIE K DIE,DA,DR
"RTN","RGEVPRG",176,0)
 ..... L -^RGHL7(991.1,IEN)
"RTN","RGEVPRG",177,0)
 K EXCTYP,HOME,ICN,IEN,IEN2,RGDFN
"RTN","RGEVPRG",178,0)
 Q
"RTN","RGEX01")
0^2^B29257136
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR CIRN EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12**;30 Apr 99
"RTN","RGEX01",3,0)
 ;
"RTN","RGEX01",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX01",5,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",6,0)
 N STDT,ENDDT,PRGSTAT,XFLAG
"RTN","RGEX01",7,0)
 S XFLAG=0
"RTN","RGEX01",8,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGEX01",9,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",10,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",11,0)
 I PRGSTAT="" D
"RTN","RGEX01",12,0)
 . W $C(7)
"RTN","RGEX01",13,0)
 . W !!,"The CIRN Exception Purge process has not been run."
"RTN","RGEX01",14,0)
 . S DIR(0)="YA",DIR("B")="NO"
"RTN","RGEX01",15,0)
 . S DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",16,0)
 . S DIR("A")="Do you want to run it now? "
"RTN","RGEX01",17,0)
 . D ^DIR K DIR
"RTN","RGEX01",18,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",19,0)
 . I Y>0 D
"RTN","RGEX01",20,0)
 .. W !!,"The CIRN Exception Purge process will now run."
"RTN","RGEX01",21,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",22,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",23,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The CIRN Exception Purge process is currently running.",!,"Please try this option again in ten minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",24,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",25,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",26,0)
 . W !!,"The CIRN Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",27,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",28,0)
 . S DIR("A")="Do you want to run the CIRN Exception Purge process now? "
"RTN","RGEX01",29,0)
 . D ^DIR K DIR,RGANS S RGANS=Y
"RTN","RGEX01",30,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",31,0)
 . L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 D
"RTN","RGEX01",32,0)
 ..I '$T S RGANS=1 Q
"RTN","RGEX01",33,0)
 ..L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",34,0)
 . I RGANS>0 D
"RTN","RGEX01",35,0)
 .. W !!,"The CIRN Exception Purge process will now run."
"RTN","RGEX01",36,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",37,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",38,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",39,0)
 K RGANS
"RTN","RGEX01",40,0)
 D WAIT^DICD
"RTN","RGEX01",41,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",42,0)
 Q
"RTN","RGEX01",43,0)
 ;
"RTN","RGEX01",44,0)
HDR ; -- header code
"RTN","RGEX01",45,0)
 S VALMHDR(1)="CIRN Exception Handling"
"RTN","RGEX01",46,0)
 S VALMHDR(2)=""
"RTN","RGEX01",47,0)
 Q
"RTN","RGEX01",48,0)
 ;
"RTN","RGEX01",49,0)
INIT ; -- init variables and list array
"RTN","RGEX01",50,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",51,0)
 K @VALMAR
"RTN","RGEX01",52,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",53,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",54,0)
 E  I RGSORT="SN" D PATLST^RGEXHND1
"RTN","RGEX01",55,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",56,0)
 Q
"RTN","RGEX01",57,0)
 ;
"RTN","RGEX01",58,0)
SORT ;
"RTN","RGEX01",59,0)
 D INIT
"RTN","RGEX01",60,0)
 S VALMBCK="R"
"RTN","RGEX01",61,0)
 Q
"RTN","RGEX01",62,0)
HELP ; -- help code
"RTN","RGEX01",63,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",64,0)
 Q
"RTN","RGEX01",65,0)
HLPPRG ;
"RTN","RGEX01",66,0)
 W !,"Enter Y(YES) to run the CIRN Exception Purge process now."
"RTN","RGEX01",67,0)
 W !!,"Enter N(NO) to go directly into the CIRN Exception Handling option."
"RTN","RGEX01",68,0)
 Q
"RTN","RGEX01",69,0)
 ;
"RTN","RGEX01",70,0)
EXIT ; -- exit code
"RTN","RGEX01",71,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",72,0)
 Q
"RTN","RGEX01",73,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",74,0)
 D NOW^%DTC
"RTN","RGEX01",75,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",76,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",77,0)
 D ^%ZTLOAD
"RTN","RGEX01",78,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",79,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",80,0)
 Q
"RTN","RGEX01",81,0)
 ;
"RTN","RGEX01",82,0)
EXPND ; -- expand code
"RTN","RGEX01",83,0)
 Q
"RTN","RGEX01",84,0)
CUREX() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION
"RTN","RGEX01",85,0)
 ;LOG file (#991.1) that currently need to be resolved
"RTN","RGEX01",86,0)
 S STAT="",EXCTYP="",RGEX=0
"RTN","RGEX01",87,0)
 F  S STAT=$O(^RGHL7(991.1,"ASTAT",STAT)) Q:STAT=""!RGEX=1  D
"RTN","RGEX01",88,0)
 . F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT",STAT,EXCTYP)) Q:'EXCTYP!RGEX=1  D
"RTN","RGEX01",89,0)
 .. I (EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)))&(STAT=0) S RGEX=1
"RTN","RGEX01",90,0)
 K STAT,EXCTYP
"RTN","RGEX01",91,0)
 Q RGEX
"RTN","RGEX01",92,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",93,0)
 ; DFN must be defined
"RTN","RGEX01",94,0)
 Q:'$D(DFN)
"RTN","RGEX01",95,0)
 S EXCTYP=""
"RTN","RGEX01",96,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX01",97,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",98,0)
 . S RGDFN="",ICN=""
"RTN","RGEX01",99,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",100,0)
 .. I DFN=RGDFN D
"RTN","RGEX01",101,0)
 ... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",102,0)
 ... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",103,0)
 ... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",104,0)
 .... ;Exclude Death exceptions, they must be processed manually.
"RTN","RGEX01",105,0)
 .... I (EXCTYP>217)!(EXCTYP<215) D
"RTN","RGEX01",106,0)
 ..... S IEN=0
"RTN","RGEX01",107,0)
 ..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",108,0)
 ...... S IEN2=0
"RTN","RGEX01",109,0)
 ...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",110,0)
 ....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",111,0)
 ....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",112,0)
 ....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",113,0)
 ....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",114,0)
 K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",115,0)
 Q
"RTN","RGEX01",116,0)
PDAT ;
"RTN","RGEX01",117,0)
 K DIRUT
"RTN","RGEX01",118,0)
 W !,"This report prints CIRN PD/MPI Data for a selected patient."
"RTN","RGEX01",119,0)
 W !,"The information displayed includes the Integration Control"
"RTN","RGEX01",120,0)
 W !,"Number (ICN), CIRN Master of Record (CMOR), CIRN Activity"
"RTN","RGEX01",121,0)
 W !,"Score, Subscription Control Number, Treating Facility and"
"RTN","RGEX01",122,0)
 W !,"Subscriber lists, CMOR History and CMOR Change Request History."
"RTN","RGEX01",123,0)
 W !!,"The information is pulled from the Patient (#2) file, Treating"
"RTN","RGEX01",124,0)
 W !,"Facility List (#391.91) file, Subscription Control (#774) file"
"RTN","RGEX01",125,0)
 W !,"and MPIF CMOR Request (#984.9) file."
"RTN","RGEX01",126,0)
ASK ;Ask for PATIENT
"RTN","RGEX01",127,0)
 I $D(DIRUT) G QUIT
"RTN","RGEX01",128,0)
 W !!,"Patient lookup can be done by Patient Name/SSN or by ICN.",!
"RTN","RGEX01",129,0)
 N DFN,ICN
"RTN","RGEX01",130,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGEX01",131,0)
 D MIX^DIC1 K DIC
"RTN","RGEX01",132,0)
 G:Y<0 QUIT
"RTN","RGEX01",133,0)
 S DFN=+Y
"RTN","RGEX01",134,0)
 D START^VAFCPDAT
"RTN","RGEX01",135,0)
 G ASK
"RTN","RGEX01",136,0)
 Q
"RTN","RGEX01",137,0)
QUIT ;
"RTN","RGEX01",138,0)
 K DFN,ICN,D,Y
"RTN","RGEX03")
0^5^B48368804
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR CIRN EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12**;30 Apr 99
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;
"RTN","RGEX03",11,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",12,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",13,0)
 Q
"RTN","RGEX03",14,0)
 ;
"RTN","RGEX03",15,0)
HDR ; -- header code
"RTN","RGEX03",16,0)
 S VALMHDR(1)="CIRN EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",17,0)
 S VALMHDR(2)=""
"RTN","RGEX03",18,0)
 Q
"RTN","RGEX03",19,0)
 ;
"RTN","RGEX03",20,0)
INIT ; -- init variables and list array
"RTN","RGEX03",21,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",22,0)
 K @VALMAR
"RTN","RGEX03",23,0)
 I DATA="" Q
"RTN","RGEX03",24,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",25,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",26,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",29,0)
 D ADDTMP
"RTN","RGEX03",30,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",33,0)
 D ADDTMP
"RTN","RGEX03",34,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",36,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",37,0)
 D ADDTMP
"RTN","RGEX03",38,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",40,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",41,0)
 D ADDTMP
"RTN","RGEX03",42,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",43,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",44,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",45,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",46,0)
 D ADDTMP
"RTN","RGEX03",47,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",48,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",50,0)
 D ADDTMP
"RTN","RGEX03",51,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",52,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",53,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",54,0)
 D ADDTMP
"RTN","RGEX03",55,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",57,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",58,0)
 D ADDTMP
"RTN","RGEX03",59,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",60,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",61,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",62,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",63,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",64,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",65,0)
 D ADDTMP
"RTN","RGEX03",66,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",67,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",68,0)
 S VAFCDFN=DFN
"RTN","RGEX03",69,0)
 Q
"RTN","RGEX03",70,0)
ADDTMP ;
"RTN","RGEX03",71,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",72,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",73,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",74,0)
 Q
"RTN","RGEX03",75,0)
 ;
"RTN","RGEX03",76,0)
UPD ;
"RTN","RGEX03",77,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",78,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",79,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",80,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",81,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",82,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",83,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",84,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",85,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",86,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",87,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",88,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",89,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",90,0)
 . D INIT
"RTN","RGEX03",91,0)
 K DIR,DIRUT
"RTN","RGEX03",92,0)
 S VALMBCK="R"
"RTN","RGEX03",93,0)
 Q
"RTN","RGEX03",94,0)
PA ;Patient Audit
"RTN","RGEX03",95,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",96,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",97,0)
 K QFLG
"RTN","RGEX03",98,0)
PAQ Q
"RTN","RGEX03",99,0)
HI ;Hinq Inquiry
"RTN","RGEX03",100,0)
 S VALMBCK=""
"RTN","RGEX03",101,0)
 D HINQ^DG10
"RTN","RGEX03",102,0)
 D PAUSE^VALM1
"RTN","RGEX03",103,0)
 S VALMBCK="R"
"RTN","RGEX03",104,0)
 Q
"RTN","RGEX03",105,0)
DISP ; Display Only Query
"RTN","RGEX03",106,0)
 S VALMBCK=""
"RTN","RGEX03",107,0)
 D FULL^VALM1
"RTN","RGEX03",108,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",109,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",110,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",111,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",112,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",113,0)
 D PAUSE^VALM1
"RTN","RGEX03",114,0)
 S VALMBCK="R"
"RTN","RGEX03",115,0)
 K MPIVAR
"RTN","RGEX03",116,0)
 Q
"RTN","RGEX03",117,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",118,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",119,0)
 D FULL^VALM1
"RTN","RGEX03",120,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",121,0)
 D PAUSE^VALM1
"RTN","RGEX03",122,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",123,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",124,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",125,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",126,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",127,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",128,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",129,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",130,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",131,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",132,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",133,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",134,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",135,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",136,0)
 D INIT
"RTN","RGEX03",137,0)
 S VALMBCK="R"
"RTN","RGEX03",138,0)
 Q
"RTN","RGEX03",139,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",140,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",141,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",142,0)
 D FULL^VALM1
"RTN","RGEX03",143,0)
 D ELIG^VADPT
"RTN","RGEX03",144,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",145,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",146,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",147,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",148,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",149,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",150,0)
 .. S VALMBCK="R"
"RTN","RGEX03",151,0)
 . E  D SENS
"RTN","RGEX03",152,0)
 E  D SENS
"RTN","RGEX03",153,0)
 Q
"RTN","RGEX03",154,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",155,0)
 N RESULT,RGSENS,SENSTV,DA,DR,DIC,DIQ
"RTN","RGEX03",156,0)
 ;S DIC=38.1,DR="2",DA=DFN,DIQ="RGSENS",DIQ(0)="I"
"RTN","RGEX03",157,0)
 ;D EN^DIQ1
"RTN","RGEX03",158,0)
 ;S SENSTV=$G(RGSENS(38.1,DFN,2,"I"))
"RTN","RGEX03",159,0)
 ;I SENSTV=1 D
"RTN","RGEX03",160,0)
 D PTSEC^DGSEC4(.RESULT,DFN)
"RTN","RGEX03",161,0)
 I RESULT(1)>0 D
"RTN","RGEX03",162,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","RGEX03",163,0)
 .. W !!,"PATIENT MARKED SENSITIVE."
"RTN","RGEX03",164,0)
 .. W !!,"You do not have the proper security to"
"RTN","RGEX03",165,0)
 .. W !,"edit this patient's data."
"RTN","RGEX03",166,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",167,0)
 .. S VALMBCK="R"
"RTN","RGEX03",168,0)
 . E  D EDIT
"RTN","RGEX03",169,0)
 E  D EDIT
"RTN","RGEX03",170,0)
 Q
"RTN","RGEX03",171,0)
EDIT ; edit patient data
"RTN","RGEX03",172,0)
 S ACCESS=0
"RTN","RGEX03",173,0)
 D REC
"RTN","RGEX03",174,0)
 Q:ACCESS=0
"RTN","RGEX03",175,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",176,0)
 S DR=".01//^S X=NAME;.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",177,0)
 L +^DPT(DFN):10
"RTN","RGEX03",178,0)
 D ^DIE
"RTN","RGEX03",179,0)
 L -^DPT(DFN)
"RTN","RGEX03",180,0)
 S DATAOLD=DATA
"RTN","RGEX03",181,0)
 D DEATH
"RTN","RGEX03",182,0)
 D DEM^VADPT
"RTN","RGEX03",183,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",184,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",185,0)
 D INIT
"RTN","RGEX03",186,0)
 S VALMBCK="R"
"RTN","RGEX03",187,0)
 K DIE,DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",188,0)
QUIT Q
"RTN","RGEX03",189,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",190,0)
 ; check for security key
"RTN","RGEX03",191,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",192,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",193,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",194,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",195,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",196,0)
 . D PAUSE^VALM1
"RTN","RGEX03",197,0)
 . S VALMBCK="R"
"RTN","RGEX03",198,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",199,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",200,0)
 . W !,"own medical record."
"RTN","RGEX03",201,0)
 . D PAUSE^VALM1
"RTN","RGEX03",202,0)
 . S VALMBCK="R"
"RTN","RGEX03",203,0)
 E  S ACCESS=1
"RTN","RGEX03",204,0)
 Q
"RTN","RGEX03",205,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",206,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",207,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",208,0)
 . S DOD=""
"RTN","RGEX03",209,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",210,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",211,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",212,0)
 . D ^DIE
"RTN","RGEX03",213,0)
 . L -^DPT(DFN)
"RTN","RGEX03",214,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",215,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",216,0)
 Q
"RTN","RGEX03",217,0)
INQ ; Patient Inquiry
"RTN","RGEX03",218,0)
 S VALMBCK=""
"RTN","RGEX03",219,0)
 D FULL^VALM1
"RTN","RGEX03",220,0)
 D EN^DGRPD
"RTN","RGEX03",221,0)
 D PAUSE^VALM1
"RTN","RGEX03",222,0)
 D CLEAN^VALM10
"RTN","RGEX03",223,0)
 D INIT
"RTN","RGEX03",224,0)
 S VALMBCK="R"
"RTN","RGEX03",225,0)
 Q
"RTN","RGEX03",226,0)
PDAT ; Call VAFCPDAT, CIRN Data report to list CMOR, Treating Facilities,
"RTN","RGEX03",227,0)
 ; Subscribers etc.
"RTN","RGEX03",228,0)
 S VALMBCK=""
"RTN","RGEX03",229,0)
 D FULL^VALM1
"RTN","RGEX03",230,0)
 D START^VAFCPDAT
"RTN","RGEX03",231,0)
 ;D PAUSE^VALM1
"RTN","RGEX03",232,0)
 S VALMBCK="R"
"RTN","RGEX03",233,0)
 Q
"RTN","RGEX03",234,0)
HELP ; -- help code
"RTN","RGEX03",235,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",236,0)
 Q
"RTN","RGEX03",237,0)
 ;
"RTN","RGEX03",238,0)
EXIT ; -- exit code
"RTN","RGEX03",239,0)
 S VALMBCK=""
"RTN","RGEX03",240,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",241,0)
 S VALMBCK="R"
"RTN","RGEX03",242,0)
 Q
"RTN","RGEX03",243,0)
 ;
"RTN","RGEX03",244,0)
EXPND ; -- expand code
"RTN","RGEX03",245,0)
 Q
"RTN","RGEX03",246,0)
 ;
"RTN","RGEXHND1")
0^3^B33598621
"RTN","RGEXHND1",1,0)
RGEXHND1 ;BAY/ALS-CIRN EXCEPTION HANDLING UTILITY ;10/08/99
"RTN","RGEXHND1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12**;30 Apr 99
"RTN","RGEXHND1",3,0)
DTLIST ;List exceptions by date
"RTN","RGEXHND1",4,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",5,0)
 S EXCDT="",EXCTYP="",CNT=0
"RTN","RGEXHND1",6,0)
 F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEXHND1",7,0)
 . S IEN=0
"RTN","RGEXHND1",8,0)
 . F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEXHND1",9,0)
 .. S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",10,0)
 ... S IEN2=0
"RTN","RGEXHND1",11,0)
 ... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",12,0)
 .... S EXCTYP=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",3)
"RTN","RGEXHND1",13,0)
 .... I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D ADDREC
"RTN","RGEXHND1",14,0)
 K I,NUM,EXCDT,EXCTYP
"RTN","RGEXHND1",15,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",16,0)
 Q
"RTN","RGEXHND1",17,0)
NDATA ; There is no data matching the criteria
"RTN","RGEXHND1",18,0)
 S CNT=CNT+1,STRING=""
"RTN","RGEXHND1",19,0)
 S STRING=$$SETSTR^VALM1("There were no exceptions found.",STRING,5,35)
"RTN","RGEXHND1",20,0)
 S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",21,0)
 S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",22,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",23,0)
 Q
"RTN","RGEXHND1",24,0)
EXCLST ;List exceptions by type
"RTN","RGEXHND1",25,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",26,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",27,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",28,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",29,0)
 .. S IEN=0
"RTN","RGEXHND1",30,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",31,0)
 ... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",32,0)
 .... S IEN2=0
"RTN","RGEXHND1",33,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",34,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",35,0)
 ..... D ADDREC
"RTN","RGEXHND1",36,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",37,0)
 Q
"RTN","RGEXHND1",38,0)
PATLST ;List exceptions by patient
"RTN","RGEXHND1",39,0)
 K ^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEXHND1",40,0)
 S CNT=0,EXCDT="",EXCTYP="",NDX=0,NAME=""
"RTN","RGEXHND1",41,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",42,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",43,0)
 .. S DFN=""
"RTN","RGEXHND1",44,0)
 .. F  S DFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN)) Q:'DFN  D
"RTN","RGEXHND1",45,0)
 ... S IEN=0
"RTN","RGEXHND1",46,0)
 ... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEXHND1",47,0)
 .... S IEN2=0
"RTN","RGEXHND1",48,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",49,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",50,0)
 ..... D DEM^VADPT S NAME=VADM(1) Q:NAME=""
"RTN","RGEXHND1",51,0)
 ..... S NDX=NDX+1
"RTN","RGEXHND1",52,0)
 ..... S ^TMP("RGEX01",$J,NAME,NDX)=$G(VADM(1))_"^"_IEN_"^"_IEN2_"^"_EXCTYP_"^"_EXCDT
"RTN","RGEXHND1",53,0)
 D PATTMP
"RTN","RGEXHND1",54,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",55,0)
 K DFN
"RTN","RGEXHND1",56,0)
 Q
"RTN","RGEXHND1",57,0)
PATTMP ;
"RTN","RGEXHND1",58,0)
 S NM=""
"RTN","RGEXHND1",59,0)
 F  S NM=$O(^TMP("RGEX01",$J,NM)) Q:NM=""  D
"RTN","RGEXHND1",60,0)
 . S NDX=0
"RTN","RGEXHND1",61,0)
 . F  S NDX=$O(^TMP("RGEX01",$J,NM,NDX)) Q:'NDX  D
"RTN","RGEXHND1",62,0)
 .. S IEN=$P(^TMP("RGEX01",$J,NM,NDX),"^",2)
"RTN","RGEXHND1",63,0)
 .. S IEN2=$P(^TMP("RGEX01",$J,NM,NDX),"^",3)
"RTN","RGEXHND1",64,0)
 .. S EXCTYP=$P(^TMP("RGEX01",$J,NM,NDX),"^",4)
"RTN","RGEXHND1",65,0)
 .. S EXCDT=$P(^TMP("RGEX01",$J,NM,NDX),"^",5)
"RTN","RGEXHND1",66,0)
 .. D ADDREC
"RTN","RGEXHND1",67,0)
 K NDX,NM,NAME
"RTN","RGEXHND1",68,0)
 Q
"RTN","RGEXHND1",69,0)
SELTYP ; List all exceptions of type selected by user
"RTN","RGEXHND1",70,0)
 S EXCTYPE="",FLAG=0,ETYPE=""
"RTN","RGEXHND1",71,0)
 K DIR,Y,DIC
"RTN","RGEXHND1",72,0)
 S DIR("A")="Enter an exception type to view: "
"RTN","RGEXHND1",73,0)
 ;S DIR(0)="PM^991.11:QAM"
"RTN","RGEXHND1",74,0)
 S DIR(0)="SAM^209:Required field(s) DOB or Name Missing;213:SSN Match Failed;214:Name Doesn't Match;215:Death Entry on MPI not VISTA;216:Death Entry on Vista not MPI;217:Death Entries on MPI and Vista DON'T MATCH;218:Potential Matches Returned"
"RTN","RGEXHND1",75,0)
 S DIR("?")="^D HLPSEL^RGEXHND1"
"RTN","RGEXHND1",76,0)
 D ^DIR
"RTN","RGEXHND1",77,0)
 I Y<1 S RGSORT="SD" D SORT^RGEX01  Q
"RTN","RGEXHND1",78,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RGEXHND1",79,0)
 S EXCTYPE=+Y,ETYPE=$P(^RGHL7(991.11,EXCTYPE,10),"^",1)
"RTN","RGEXHND1",80,0)
 I EXCTYPE=(209)!((EXCTYPE>212)&(EXCTYPE<219)) S FLAG=1
"RTN","RGEXHND1",81,0)
 I FLAG=1 D ADDSEL
"RTN","RGEXHND1",82,0)
 E  I FLAG=0 D
"RTN","RGEXHND1",83,0)
 . W !,"Not a valid selection."
"RTN","RGEXHND1",84,0)
 . D SELTYP
"RTN","RGEXHND1",85,0)
 K FLAG,Y,DIR,DIC,DTOUT,DUOUT
"RTN","RGEXHND1",86,0)
 Q
"RTN","RGEXHND1",87,0)
ADDSEL ;
"RTN","RGEXHND1",88,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",89,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",90,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",91,0)
 . I EXCTYP=EXCTYPE D
"RTN","RGEXHND1",92,0)
 .. S IEN=0
"RTN","RGEXHND1",93,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",94,0)
 ... S IEN2=0
"RTN","RGEXHND1",95,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",96,0)
 .... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3)
"RTN","RGEXHND1",97,0)
 .... D ADDREC
"RTN","RGEXHND1",98,0)
 I CNT<1 D
"RTN","RGEXHND1",99,0)
 . W !,"There are no "_ETYPE
"RTN","RGEXHND1",100,0)
 . W !,"exceptions that need processing."
"RTN","RGEXHND1",101,0)
 . D SELTYP
"RTN","RGEXHND1",102,0)
 Q
"RTN","RGEXHND1",103,0)
HLPSEL ;
"RTN","RGEXHND1",104,0)
 D FULL^VALM1
"RTN","RGEXHND1",105,0)
 ;W !,"The following exception types are handled by this option:"
"RTN","RGEXHND1",106,0)
 ;W !!,"Required field(s) Date of Birth or Name missing",?50,"(209)"
"RTN","RGEXHND1",107,0)
 ;W !,"SSN Match Failed",?50,"(213)"
"RTN","RGEXHND1",108,0)
 ;W !,"Name Doesn't Match",?50,"(214)"
"RTN","RGEXHND1",109,0)
 ;W !,"Death Entry on MPI not in VISTA",?50,"(215)"
"RTN","RGEXHND1",110,0)
 ;W !,"Death Entry on Vista not in MPI",?50,"(216)"
"RTN","RGEXHND1",111,0)
 ;W !,"Death Entries on MPI and Vista DO NOT MATCH",?50,"(217)"
"RTN","RGEXHND1",112,0)
 ;W !,"Potential Matches Returned",?50,"(218)"
"RTN","RGEXHND1",113,0)
 S VALMBCK="R"
"RTN","RGEXHND1",114,0)
 Q
"RTN","RGEXHND1",115,0)
ADDREC ;
"RTN","RGEXHND1",116,0)
 S ETEXT="",RGDFN="",ICN="",RGNM="",STAT="",DOD=""
"RTN","RGEXHND1",117,0)
 S ETEXT=$P($G(^RGHL7(991.11,EXCTYP,10)),"^",1)
"RTN","RGEXHND1",118,0)
 S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEXHND1",119,0)
 S STAT=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",5)
"RTN","RGEXHND1",120,0)
 S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEXHND1",121,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEXHND1",122,0)
 I (STAT<1)!(STAT="") DO
"RTN","RGEXHND1",123,0)
 .;Only list exceptions that are Not Processed
"RTN","RGEXHND1",124,0)
 .; only list patients with local ICN
"RTN","RGEXHND1",125,0)
 . I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGEXHND1",126,0)
 .. S DFN=RGDFN D DEM^VADPT
"RTN","RGEXHND1",127,0)
 .. S RGNM=VADM(1)
"RTN","RGEXHND1",128,0)
 .. S RGSSN=$P($G(VADM(2)),"^",1)
"RTN","RGEXHND1",129,0)
 .. S DOB=$G(VADM(3))
"RTN","RGEXHND1",130,0)
 .. S DOD=$P($P($G(VADM(6)),"^",2),"@",1)
"RTN","RGEXHND1",131,0)
 .. S EXDATE=$P($$FMTE^XLFDT(EXCDT,2),"@",1)
"RTN","RGEXHND1",132,0)
 .. S CNT=CNT+1
"RTN","RGEXHND1",133,0)
 .. S STRING=""
"RTN","RGEXHND1",134,0)
 .. I ICN<0 S ICN=""
"RTN","RGEXHND1",135,0)
 .. S STRING=$$SETSTR^VALM1(CNT,STRING,1,4)
"RTN","RGEXHND1",136,0)
 .. S STRING=$$SETSTR^VALM1($E(RGNM,1,22),STRING,6,21)
"RTN","RGEXHND1",137,0)
 .. S STRING=$$SETSTR^VALM1(RGSSN,STRING,28,10)
"RTN","RGEXHND1",138,0)
 .. S STRING=$$SETSTR^VALM1(EXDATE,STRING,39,8)
"RTN","RGEXHND1",139,0)
 .. S STRING=$$SETSTR^VALM1(ETEXT,STRING,49,32)
"RTN","RGEXHND1",140,0)
 .. S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",141,0)
 .. S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",142,0)
 .. S ^TMP("RGEXC",$J,CNT,"DATA")=RGNM_"^"_RGSSN_"^"_$P($$FMTE^XLFDT(EXCDT),"@",1)_"^"_ETEXT_"^"_DFN_"^"_ICN_"^"_DOB_"^"_STAT_"^"_IEN_"^"_IEN2_"^"_CNT_"^"_DOD
"RTN","RGEXHND1",143,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",144,0)
 K RGDFN,RGNM,RGSSN,EXDATE,ETEXT,ICN,DOB,STAT,VADM,HOME,STRING,DOD
"RTN","RGEXHND1",145,0)
 Q
"RTN","RGEXHND1",146,0)
SELECT ;
"RTN","RGEXHND1",147,0)
 I $G(STRING)["no exceptions found" D SORT^RGEX01  Q
"RTN","RGEXHND1",148,0)
 N VALMY
"RTN","RGEXHND1",149,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","RGEXHND1",150,0)
 I '$D(VALMY) Q
"RTN","RGEXHND1",151,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",152,0)
 S DATA="",CNT=""
"RTN","RGEXHND1",153,0)
 S CNT=$O(VALMY(0))
"RTN","RGEXHND1",154,0)
 S DATA=$G(^TMP("RGEXC",$J,CNT,"DATA"))
"RTN","RGEXHND1",155,0)
 I '$D(DATA) S CNT=0 Q
"RTN","RGEXHND1",156,0)
 D CLEAN^VALM10
"RTN","RGEXHND1",157,0)
 D EN^RGEX03(DATA)
"RTN","RGEXHND1",158,0)
 I RGSORT="VT" D
"RTN","RGEXHND1",159,0)
 . K @VALMAR
"RTN","RGEXHND1",160,0)
 . D ADDSEL
"RTN","RGEXHND1",161,0)
 E  I RGSORT'="VT" D SORT^RGEX01
"RTN","RGEXHND1",162,0)
 ;
"RTN","RGEXHND1",163,0)
 Q
"RTN","RGEXHND1",164,0)
QUIT ;
"VER")
8.0^22.0
**END**
**END**
