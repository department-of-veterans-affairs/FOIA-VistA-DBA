Released GMRC*3*18 SEQ #16
Extracted from mail message
**KIDS**:GMRC*3.0*18^

**INSTALL NAME**
GMRC*3.0*18
"BLD",2541,0)
GMRC*3.0*18^CONSULT/REQUEST TRACKING^0^3001220^y
"BLD",2541,1,0)
^^2^2^3000906^
"BLD",2541,1,1,0)
A description of this build can be found on the NATIONAL PATCH MODULE UNDER 
"BLD",2541,1,2,0)
GMRC*3.0*18.
"BLD",2541,4,0)
^9.64PA^8989.51^1
"BLD",2541,4,8989.51,0)
8989.51
"BLD",2541,4,8989.51,222)
n^n^f^^y^^y^r^n
"BLD",2541,4,8989.51,223)

"BLD",2541,4,8989.51,224)
I $P(^(0),"^",1)="GMRC CONSULT LIST DAYS"
"BLD",2541,4,"B",8989.51,8989.51)

"BLD",2541,"INID")
^y
"BLD",2541,"INIT")
GMRCYP18
"BLD",2541,"KRN",0)
^9.67PA^19^17
"BLD",2541,"KRN",.4,0)
.4
"BLD",2541,"KRN",.401,0)
.401
"BLD",2541,"KRN",.402,0)
.402
"BLD",2541,"KRN",.403,0)
.403
"BLD",2541,"KRN",.5,0)
.5
"BLD",2541,"KRN",.84,0)
.84
"BLD",2541,"KRN",3.6,0)
3.6
"BLD",2541,"KRN",3.8,0)
3.8
"BLD",2541,"KRN",9.2,0)
9.2
"BLD",2541,"KRN",9.8,0)
9.8
"BLD",2541,"KRN",9.8,"NM",0)
^9.68A^16^13
"BLD",2541,"KRN",9.8,"NM",3,0)
GMRCTIU^^0^B13550057
"BLD",2541,"KRN",9.8,"NM",4,0)
GMRCSLMA^^0^B13426803
"BLD",2541,"KRN",9.8,"NM",5,0)
GMRCEDIT^^0^B11470474
"BLD",2541,"KRN",9.8,"NM",6,0)
GMRCA1^^0^B27899532
"BLD",2541,"KRN",9.8,"NM",8,0)
GMRCACMT^^0^B22419347
"BLD",2541,"KRN",9.8,"NM",9,0)
GMRCGUIB^^0^B30571932
"BLD",2541,"KRN",9.8,"NM",10,0)
GMRCACTM^^0^B3635976
"BLD",2541,"KRN",9.8,"NM",11,0)
GMRCT^^0^B22357159
"BLD",2541,"KRN",9.8,"NM",12,0)
GMRCSLM2^^0^B40765812
"BLD",2541,"KRN",9.8,"NM",13,0)
GMRCSTS^^0^B37911312
"BLD",2541,"KRN",9.8,"NM",14,0)
GMRCSTS1^^0^B28140651
"BLD",2541,"KRN",9.8,"NM",15,0)
GMRCASV^^0^B61316668
"BLD",2541,"KRN",9.8,"NM",16,0)
GMRCASV1^^0^B2462925
"BLD",2541,"KRN",9.8,"NM","B","GMRCA1",6)

"BLD",2541,"KRN",9.8,"NM","B","GMRCACMT",8)

"BLD",2541,"KRN",9.8,"NM","B","GMRCACTM",10)

"BLD",2541,"KRN",9.8,"NM","B","GMRCASV",15)

"BLD",2541,"KRN",9.8,"NM","B","GMRCASV1",16)

"BLD",2541,"KRN",9.8,"NM","B","GMRCEDIT",5)

"BLD",2541,"KRN",9.8,"NM","B","GMRCGUIB",9)

"BLD",2541,"KRN",9.8,"NM","B","GMRCSLM2",12)

"BLD",2541,"KRN",9.8,"NM","B","GMRCSLMA",4)

"BLD",2541,"KRN",9.8,"NM","B","GMRCSTS",13)

"BLD",2541,"KRN",9.8,"NM","B","GMRCSTS1",14)

"BLD",2541,"KRN",9.8,"NM","B","GMRCT",11)

"BLD",2541,"KRN",9.8,"NM","B","GMRCTIU",3)

"BLD",2541,"KRN",19,0)
19
"BLD",2541,"KRN",19.1,0)
19.1
"BLD",2541,"KRN",101,0)
101
"BLD",2541,"KRN",101,"NM",0)
^9.68A^3^3
"BLD",2541,"KRN",101,"NM",1,0)
GMRCACT EDIT/RESUBMIT CONSULT^^0
"BLD",2541,"KRN",101,"NM",2,0)
GMRCACTM SERVICE ACTION MENU^^2
"BLD",2541,"KRN",101,"NM",3,0)
GMRCACTM USER REVIEW SCREEN^^2
"BLD",2541,"KRN",101,"NM","B","GMRCACT EDIT/RESUBMIT CONSULT",1)

"BLD",2541,"KRN",101,"NM","B","GMRCACTM SERVICE ACTION MENU",2)

"BLD",2541,"KRN",101,"NM","B","GMRCACTM USER REVIEW SCREEN",3)

"BLD",2541,"KRN",409.61,0)
409.61
"BLD",2541,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",2541,"KRN",409.61,"NM",1,0)
GMRC EDIT CONSULT^^0
"BLD",2541,"KRN",409.61,"NM","B","GMRC EDIT CONSULT",1)

"BLD",2541,"KRN",771,0)
771
"BLD",2541,"KRN",870,0)
870
"BLD",2541,"KRN",8994,0)
8994
"BLD",2541,"KRN","B",.4,.4)

"BLD",2541,"KRN","B",.401,.401)

"BLD",2541,"KRN","B",.402,.402)

"BLD",2541,"KRN","B",.403,.403)

"BLD",2541,"KRN","B",.5,.5)

"BLD",2541,"KRN","B",.84,.84)

"BLD",2541,"KRN","B",3.6,3.6)

"BLD",2541,"KRN","B",3.8,3.8)

"BLD",2541,"KRN","B",9.2,9.2)

"BLD",2541,"KRN","B",9.8,9.8)

"BLD",2541,"KRN","B",19,19)

"BLD",2541,"KRN","B",19.1,19.1)

"BLD",2541,"KRN","B",101,101)

"BLD",2541,"KRN","B",409.61,409.61)

"BLD",2541,"KRN","B",771,771)

"BLD",2541,"KRN","B",870,870)

"BLD",2541,"KRN","B",8994,8994)

"BLD",2541,"QUES",0)
^9.62^^
"BLD",2541,"REQB",0)
^9.611^^
"DATA",8989.51,4710,0)
GMRC CONSULT LIST DAYS^CONSULT LIST DAYS^0^^Days^0
"DATA",8989.51,4710,1)
N^0:10000:0^Enter the number of days you wish to gather Consults for.
"DATA",8989.51,4710,6)

"DATA",8989.51,4710,20,0)
^8989.512^3^3^3000919^^^^
"DATA",8989.51,4710,20,1,0)
This parameter is used to allow a site to set the number of days that will 
"DATA",8989.51,4710,20,2,0)
be searched backwards for a Consult to be associated with a NOTE.  A default 
"DATA",8989.51,4710,20,3,0)
parameter of 365 days will be set at the Package Level.
"DATA",8989.51,4710,30,0)
^8989.513I^3^3
"DATA",8989.51,4710,30,1,0)
6^4
"DATA",8989.51,4710,30,2,0)
9^9.4
"DATA",8989.51,4710,30,3,0)
7^4.2
"FIA",8989.51)
PARAMETER DEFINITION
"FIA",8989.51,0)
^XTV(8989.51,
"FIA",8989.51,0,0)
8989.51I
"FIA",8989.51,0,1)
n^n^f^^y^^y^r^n
"FIA",8989.51,0,10)

"FIA",8989.51,0,11)
I $P(^(0),"^",1)="GMRC CONSULT LIST DAYS"
"FIA",8989.51,0,"RLRO")

"FIA",8989.51,0,"VR")
3.0^GMRC
"FIA",8989.51,8989.51)
0
"FIA",8989.51,8989.512)
0
"FIA",8989.51,8989.513)
0
"INIT")
GMRCYP18
"KRN",101,1393,-1)
2^3
"KRN",101,1393,0)
GMRCACTM USER REVIEW SCREEN^Consult/Request Review^^M^.5^^^^^^^128
"KRN",101,1393,10,0)
^101.01PA^17^7
"KRN",101,1393,10,17,0)
5684^ER^10^
"KRN",101,1393,10,17,"^")
GMRCACT EDIT/RESUBMIT CONSULT
"KRN",101,2112,-1)
2^2
"KRN",101,2112,0)
GMRCACTM SERVICE ACTION MENU^Service Action Menu^^Q^18^^^^^^^128
"KRN",101,2112,10,0)
^101.01PA^26^15
"KRN",101,2112,10,26,0)
5684^ER^26^
"KRN",101,2112,10,26,"^")
GMRCACT EDIT/RESUBMIT CONSULT
"KRN",101,5684,-1)
0^1
"KRN",101,5684,0)
GMRCACT EDIT/RESUBMIT CONSULT^Edit/Resubmit^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5684,1,0)
^101.06^2^2^3001116^^^^
"KRN",101,5684,1,1,0)
This protocol will allow the provider or update user to edit and resubmit a 
"KRN",101,5684,1,2,0)
canceled consult.
"KRN",101,5684,4)
^3
"KRN",101,5684,10,0)
^101.01PA
"KRN",101,5684,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5684,20)
D EDTSUB^GMRCA1(""),ENTRY^GMRCSLMA("L")
"KRN",101,5684,99)
58314,34651
"KRN",409.61,652,-1)
0^1
"KRN",409.61,652,0)
GMRC EDIT CONSULT^1^1^80^5^19^1^1^^GMRCACT EDIT CONSULT/REQUEST^Edit Consult Order^1^^1
"KRN",409.61,652,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,652,"ARRAY")
 ^TMP("GMRCR",$J,"EDLIST")
"KRN",409.61,652,"COL",0)
^409.621^2^2
"KRN",409.61,652,"COL",1,0)
FIELD^1^15^  Field Name
"KRN",409.61,652,"COL",2,0)
CONTENTS^30^30^  Current Field Contents
"KRN",409.61,652,"COL","B","CONTENTS",2)

"KRN",409.61,652,"COL","B","FIELD",1)

"KRN",409.61,652,"FNL")
D KILL^VALM10(),EXIT^GMRCEDIT
"KRN",409.61,652,"HDR")

"KRN",409.61,652,"HLP")
D HELP^GMRCEDIT
"KRN",409.61,652,"INIT")
D EN^GMRCEDT1(GMRCDA),INIT^GMRCEDIT,HDR^GMRCEDIT
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
18^3001220
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3001220
"PKG",128,22,1,"PAH",1,1,1,0)
A description of this build can be found on the NATIONAL PATCH MODULE UNDER 
"PKG",128,22,1,"PAH",1,1,2,0)
GMRC*3.0*18.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","GMRCA1")
0^6^B27899532
"RTN","GMRCA1",1,0)
GMRCA1 ;SLC/DLT,DCM - Actions taken from Review Screens ; 11/25/2000
"RTN","GMRCA1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,18**;DEC 27, 1997
"RTN","GMRCA1",3,0)
 ; Patch 18 addS the option to Edit/Resubmit a canceled consult
"RTN","GMRCA1",4,0)
 ; This routine invokes IA #867,#2424
"RTN","GMRCA1",5,0)
 ;
"RTN","GMRCA1",6,0)
DC(GMRCO,GMRCA) ;Discontinue/Cancel(Deny) logic
"RTN","GMRCA1",7,0)
 ;GMRCO = File 123 IEN of consult
"RTN","GMRCA1",8,0)
 ;GMRCA = Action to take: 6=DISCONTINUED, 19=CANCELLED
"RTN","GMRCA1",9,0)
 ;GMRCOM=comments array
"RTN","GMRCA1",10,0)
 I '$G(GMRCA) S GMRCMSG="This Action not defined!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",11,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",12,0)
 D DC^GMRCADC(GMRCO,GMRCA)
"RTN","GMRCA1",13,0)
 D END
"RTN","GMRCA1",14,0)
 Q
"RTN","GMRCA1",15,0)
 ;
"RTN","GMRCA1",16,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCA1",17,0)
 N GMRCA,GMRCLCK
"RTN","GMRCA1",18,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",19,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",20,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",21,0)
 I '$$LOCK(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",22,0)
 S GMRCLCK=1
"RTN","GMRCA1",23,0)
 D COMMENT^GMRCACMT(+GMRCO)
"RTN","GMRCA1",24,0)
 D END
"RTN","GMRCA1",25,0)
 Q
"RTN","GMRCA1",26,0)
 ;
"RTN","GMRCA1",27,0)
EDTSUB(GMRCO) ;Patch 18 Edit/Resubmit a canceled consult
"RTN","GMRCA1",28,0)
 N GMRCA,GMRCLCK,GMRCDFN,GMRCMSG
"RTN","GMRCA1",29,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",30,0)
 S XQORM("M")=3
"RTN","GMRCA1",31,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",32,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",33,0)
 ;
"RTN","GMRCA1",34,0)
 ; Check to see if Provider or Update user is doing Edit/Resubmit
"RTN","GMRCA1",35,0)
 I '$$VALPROV^GMRCEDIT(GMRCO) D
"RTN","GMRCA1",36,0)
 .S GMRCMSG="0^You are not the provider of this Consult or a Update User"
"RTN","GMRCA1",37,0)
 I $P(^GMR(123,GMRCO,0),"^",12)'=13 D     ; If not a canceled Consult
"RTN","GMRCA1",38,0)
 . S GMRCMSG="0^This consult is no longer editable."
"RTN","GMRCA1",39,0)
 I $D(GMRCMSG) D EXAC^GMRCADC($P(GMRCMSG,"^",2)) D END S GMRCQUT=1 Q
"RTN","GMRCA1",40,0)
 I '$$LOCK(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",41,0)
 S GMRCLCK=1
"RTN","GMRCA1",42,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2) ; Get patient DFN
"RTN","GMRCA1",43,0)
 I $D(GMRCQUT) Q
"RTN","GMRCA1",44,0)
 D EN^GMRCEDIT(GMRCO,","_+GMRCDFN)  ; Bring up Edit & Resubmit screen.
"RTN","GMRCA1",45,0)
 D END
"RTN","GMRCA1",46,0)
 Q
"RTN","GMRCA1",47,0)
 ;
"RTN","GMRCA1",48,0)
RC(GMRCO,GMRCSCH) ;Service tracking request received or scheduled
"RTN","GMRCA1",49,0)
 ; GMRCSCH=1  - schedule action
"RTN","GMRCA1",50,0)
 K GMRCQUT,GMRCQIT,GMRCSEL,GMRCAGN
"RTN","GMRCA1",51,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",52,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",53,0)
 I '$$LOCK(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",54,0)
 ;
"RTN","GMRCA1",55,0)
 N GMRCDA,GMRCIFN,GMRCLCK,GMRCAD
"RTN","GMRCA1",56,0)
 S GMRCLCK=1
"RTN","GMRCA1",57,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",58,0)
 S DFN=$P(GMRC(0),"^",2)
"RTN","GMRCA1",59,0)
 I $S($P(GMRC(0),"^",12)=2:1,$P(^(0),"^",12)=1:1,$P(^(0),"^",12)=13:1,1:0) D  S GMRCQUT=1 D END Q
"RTN","GMRCA1",60,0)
 .S GMRCMSG="This consult has already been "_$S($P(GMRC(0),"^",12)=2:"Completed",$P(^(0),"^",12)=13:"Cancelled",1:"Discontinued")_"."
"RTN","GMRCA1",61,0)
 .S GMRCMSG(1)=" This action may not be taken now."
"RTN","GMRCA1",62,0)
 .D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCA1",63,0)
 .K GMRCMSG
"RTN","GMRCA1",64,0)
 .Q
"RTN","GMRCA1",65,0)
 ;I $P(^GMR(123.5,$P(GMRC(0),"^",5),0),"^",2)=9 S GMRCMSG=$P(^(0),"^",1)_" is an INACTIVE service. No Receive action is possible",GMRCMSG(1)="for this consult on this Service!" D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",66,0)
 I '$G(GMRCSCH),$P(GMRC(0),"^",12)'=5 D  Q
"RTN","GMRCA1",67,0)
 . S GMRCMSG="The receive action may only be taken when the consult"
"RTN","GMRCA1",68,0)
 . S GMRCMSG=GMRCMSG_" has a pending status."
"RTN","GMRCA1",69,0)
 . D EXAC^GMRCADC(GMRCMSG),END
"RTN","GMRCA1",70,0)
 . S GMRCQUT=1
"RTN","GMRCA1",71,0)
 I $G(GMRCSCH),"56"'[$P(GMRC(0),"^",12) D  Q
"RTN","GMRCA1",72,0)
 . S GMRCMSG="This consult may not be scheduled with the current status"
"RTN","GMRCA1",73,0)
 . D EXAC^GMRCADC(GMRCMSG),END
"RTN","GMRCA1",74,0)
 . S GMRCQUT=1
"RTN","GMRCA1",75,0)
 ;
"RTN","GMRCA1",76,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",77,0)
 N GETPROV
"RTN","GMRCA1",78,0)
 S GETPROV=$S($G(GMRCSCH):"Who scheduled it?",1:"Who received it?")
"RTN","GMRCA1",79,0)
 D GETPROV^GMRCAU K GETPROV I $D(GMRCQIT) D END S GMRCQIT="Q",GMRCQUT=1 Q
"RTN","GMRCA1",80,0)
 I '$G(GMRCSCH) S GMRCAD=$$GETDT^GMRCUTL1("Date/Time Actually Received")
"RTN","GMRCA1",81,0)
 I $G(GMRCSCH) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCA1",82,0)
 I GMRCAD="^" D  Q
"RTN","GMRCA1",83,0)
 . W !,$C(7) D EXAC^GMRCADC("Consult not updated with Received action.")
"RTN","GMRCA1",84,0)
 . D END
"RTN","GMRCA1",85,0)
 . S GMRCQUT=1
"RTN","GMRCA1",86,0)
 ;The activity date is stored in GMRCAD
"RTN","GMRCA1",87,0)
 I '$G(GMRCSCH) D
"RTN","GMRCA1",88,0)
 . S GMRCA=21 ;for "Received"
"RTN","GMRCA1",89,0)
 . I $P(GMRC(0),"^",12)=5 S GMRCSTS=6,$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCA1",90,0)
 . E  S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCA1",91,0)
 I $G(GMRCSCH) S GMRCA=8,GMRCSTS=8
"RTN","GMRCA1",92,0)
 D STATUS^GMRCP
"RTN","GMRCA1",93,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCA1",94,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCWARD),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCA1",95,0)
 I $G(GMRCSCH),$P(GMRCOM,U,2)=1 D
"RTN","GMRCA1",96,0)
 . N TXT S TXT="Scheduled Consult: "
"RTN","GMRCA1",97,0)
 . D PROCALRT^GMRCACMT(TXT,"",20,GMRCO)
"RTN","GMRCA1",98,0)
 D END
"RTN","GMRCA1",99,0)
 Q
"RTN","GMRCA1",100,0)
 ;
"RTN","GMRCA1",101,0)
RT(GMRCO) ;Results Display logic
"RTN","GMRCA1",102,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",103,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",104,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",105,0)
 D RT^GMRCART(GMRCO)
"RTN","GMRCA1",106,0)
 D END
"RTN","GMRCA1",107,0)
 Q
"RTN","GMRCA1",108,0)
 ;
"RTN","GMRCA1",109,0)
PS(GMRCO) ;Print Service Copy (CPRS entry point)
"RTN","GMRCA1",110,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCA1",111,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",112,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",113,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",114,0)
 D EN^GMRCP5(GMRCO)
"RTN","GMRCA1",115,0)
 D END
"RTN","GMRCA1",116,0)
 Q
"RTN","GMRCA1",117,0)
 ;
"RTN","GMRCA1",118,0)
END ;kill off variables and exit
"RTN","GMRCA1",119,0)
 I $G(GMRCLCK) D UNLOCK(GMRCO)
"RTN","GMRCA1",120,0)
 I '$D(GMRC("NMBR")) K GMRCSEL,GMRCO
"RTN","GMRCA1",121,0)
 K GMRC(0),GMRCA,GMRCACTM,GMRCAGN,GMRCDFN,GMRCENTR,GMRCFL,GMRCIEN,GMRCMSG,GMRCOM,GMRCO,GMRCORFN,GMRCORN,GMRCORTX,GMRCRTFL,GMRCSEL,GMRCSTS,GMRCTRLC,GMRCEND,GMRCSA,GMRCSR,GMRCBM,GMRCTM,GMRCADUZ,ORIFN,OREND,SF,STS
"RTN","GMRCA1",122,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCA1",123,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCA1",124,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCA1",125,0)
 Q
"RTN","GMRCA1",126,0)
LOCK(GMRCIFN) ;;lock a consult record using OE/RR order number
"RTN","GMRCA1",127,0)
 N GMRCORD,GMRCLOCK
"RTN","GMRCA1",128,0)
 S GMRCORD=$P($G(^GMR(123,GMRCIFN,0)),U,3) Q:'GMRCORD 1
"RTN","GMRCA1",129,0)
 S GMRCLOCK=$$LOCK1^ORX2(GMRCORD) I +GMRCLOCK Q 1
"RTN","GMRCA1",130,0)
 ;Q:$G(GMRCGUI)
"RTN","GMRCA1",131,0)
 D EXAC^GMRCADC($P(GMRCLOCK,U,2))
"RTN","GMRCA1",132,0)
 Q 0
"RTN","GMRCA1",133,0)
UNLOCK(GMRCIFN) ;unlock a consult record using OE/RR order number
"RTN","GMRCA1",134,0)
 N GMRCORD
"RTN","GMRCA1",135,0)
 S GMRCORD=$P($G(^GMR(123,GMRCIFN,0)),U,3) Q:'GMRCORD
"RTN","GMRCA1",136,0)
 D UNLK1^ORX2(GMRCORD)
"RTN","GMRCA1",137,0)
 Q
"RTN","GMRCACMT")
0^8^B22419347
"RTN","GMRCACMT",1,0)
GMRCACMT ;SLC/DLT,DCM - Comment Action and alerting ; 11/25/2000
"RTN","GMRCACMT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,14,18**;DEC 27, 1997
"RTN","GMRCACMT",3,0)
 ; This routine invokes IA #10060
"RTN","GMRCACMT",4,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCACMT",5,0)
 K GMRCQIT,GMRCQUT N GMRCA
"RTN","GMRCACMT",6,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCACMT",7,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW
"RTN","GMRCACMT",8,0)
 S GMRCOM=1,GMRCA=20,GMRCPROV=$P(^GMR(123,GMRCO,0),"^",14) D AUDIT^GMRCP
"RTN","GMRCACMT",9,0)
 ;GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the word-processing logic should be executed. If an actual comment is added, $P(GMRCOM,"^",2)=1 (send alert), if not GMRCOM=1 and no '^' exists (do not send alert)
"RTN","GMRCACMT",10,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCACMT",11,0)
 ;continue if no lock problems occurred
"RTN","GMRCACMT",12,0)
 I $P(GMRCOM,"^",2) D PROCALRT("",1,20,GMRCO)
"RTN","GMRCACMT",13,0)
 D END
"RTN","GMRCACMT",14,0)
 Q
"RTN","GMRCACMT",15,0)
 ;
"RTN","GMRCACMT",16,0)
PROCALRT(GMRCORTX,GMRCDELR,ACTION,GMRCO) ;Process alert for comments
"RTN","GMRCACMT",17,0)
 ;If GMRCDELR=1, the ordering provider can be deleted from the list.
"RTN","GMRCACMT",18,0)
 N GMRCADUZ,GMRCANS,NOTIF,GMRCQIT
"RTN","GMRCACMT",19,0)
 S GMRCANS=$$READ("Y","Do You Wish To Send An Alert With This Comment","N","Enter Y to continue with recipient prompts. Otherwise, enter N.",1)
"RTN","GMRCACMT",20,0)
 I (GMRCANS[U)!(GMRCANS=0) D END Q
"RTN","GMRCACMT",21,0)
 ;
"RTN","GMRCACMT",22,0)
 D WHOTO
"RTN","GMRCACMT",23,0)
 I $G(GMRCQIT) D END Q  ;User "^" at requesting provider.
"RTN","GMRCACMT",24,0)
 ;
"RTN","GMRCACMT",25,0)
 ; Patch 18 changes Notification #27 to #63.
"RTN","GMRCACMT",26,0)
 S NOTIF=$S(ACTION=20:63,1:23)
"RTN","GMRCACMT",27,0)
 ; Use NEW SERVICE CONSULT/REQUEST (27) for the ADD COMMENT action to
"RTN","GMRCACMT",28,0)
 ;     prevent the forced PAO entries that occur with the
"RTN","GMRCACMT",29,0)
 ;     CONSULT/REQUEST RESOLUTION (23) notification.
"RTN","GMRCACMT",30,0)
 D SENDMSG(NOTIF,+GMRCO)
"RTN","GMRCACMT",31,0)
 Q
"RTN","GMRCACMT",32,0)
 ;
"RTN","GMRCACMT",33,0)
SENDMSG(NOTIF,GMRCO) ;Send the alert
"RTN","GMRCACMT",34,0)
 N GMRCDFN
"RTN","GMRCACMT",35,0)
 I '$D(GMRCADUZ) S GMRCADUZ=""
"RTN","GMRCACMT",36,0)
 W !,"Processing Alerts..."
"RTN","GMRCACMT",37,0)
 S GMRCDFN=$P($G(^GMR(123,+GMRCO,0)),"^",2)
"RTN","GMRCACMT",38,0)
 S GMRCORTX=$S($L(GMRCORTX):GMRCORTX,1:"Comment Added to Consult ")_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCACMT",39,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTIF,.GMRCADUZ,0)
"RTN","GMRCACMT",40,0)
 Q
"RTN","GMRCACMT",41,0)
 ;
"RTN","GMRCACMT",42,0)
END ;kill off variables and exit
"RTN","GMRCACMT",43,0)
 K GMRC,GMRCA,GMRCMSG,GMRCOM,GMRCO,GMRCORTX,GMRCERR,GMRCERMS,GMRCQUT,GMRCUT
"RTN","GMRCACMT",44,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCACMT",45,0)
 K DTOUT,DIROUT,DUOUT,DIRUT
"RTN","GMRCACMT",46,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCACMT",47,0)
 Q
"RTN","GMRCACMT",48,0)
 ;
"RTN","GMRCACMT",49,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCACMT",50,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCACMT",51,0)
 ;Returns GMRCADUZ array of users to send an alert to and GMRCQIT if "^"
"RTN","GMRCACMT",52,0)
 N GMRCRP,GMRCANS
"RTN","GMRCACMT",53,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting provider entry
"RTN","GMRCACMT",54,0)
 I +GMRCRP S GMRCRP=$P($G(^VA(200,+GMRCRP,0)),U,1) ;provider name
"RTN","GMRCACMT",55,0)
 ;GMRCRP is now the requestor name or null
"RTN","GMRCACMT",56,0)
 I $L(GMRCRP) D  I GMRCANS[U S GMRCQIT=1 Q
"RTN","GMRCACMT",57,0)
 . S GMRCANS=$$READ("Y","Send Alert To Requesting Provider "_GMRCRP,"N","Enter Y to send an alert to the ordering provider, otherwise enter N.",1)
"RTN","GMRCACMT",58,0)
 . S:GMRCANS=1 GMRCADUZ($P(^GMR(123,+GMRCO,0),"^",14))=""
"RTN","GMRCACMT",59,0)
 . Q
"RTN","GMRCACMT",60,0)
 ;
"RTN","GMRCACMT",61,0)
ANDTO ;Ask for additional recipients
"RTN","GMRCACMT",62,0)
 D NAMELIST("Send Alert to: ",.GMRCADUZ,GMRCDELR)
"RTN","GMRCACMT",63,0)
 Q
"RTN","GMRCACMT",64,0)
 ;
"RTN","GMRCACMT",65,0)
NAMELIST(GMRCP,GMRCOLD,GMRCDELR) ;manage the list of recipients
"RTN","GMRCACMT",66,0)
 ;
"RTN","GMRCACMT",67,0)
 ; GMRCP - Prompt
"RTN","GMRCACMT",68,0)
 ; GMRCOLD - Original list with ordering provider.
"RTN","GMRCACMT",69,0)
 ; GMRCDELR - 1 means the original list may have names deleted
"RTN","GMRCACMT",70,0)
 ; Returns final list in GMRCOLD array
"RTN","GMRCACMT",71,0)
 ;
"RTN","GMRCACMT",72,0)
 N GMRCNEW,GMRCNT,GMRCDUZ,GMRCUSER,GMRCQ,GMRCADD,DIC,X,Y
"RTN","GMRCACMT",73,0)
 ;
"RTN","GMRCACMT",74,0)
 M GMRCNEW=GMRCOLD
"RTN","GMRCACMT",75,0)
 I GMRCDELR=1 K GMRCOLD S GMRCOLD="" ;Remove mandatory users from GMRCOLD
"RTN","GMRCACMT",76,0)
 S GMRCNT=0 F  D  Q:(GMRCUSER[U)
"RTN","GMRCACMT",77,0)
 .S GMRCUSER=$$READ("FAO;3;46",$S(GMRCNT:"And ",1:"")_GMRCP,"","^D NAMEHELP^GMRCACMT")
"RTN","GMRCACMT",78,0)
 .S:'$L(GMRCUSER) GMRCUSER=U Q:(GMRCUSER[U)
"RTN","GMRCACMT",79,0)
 .I ($E(GMRCUSER,1)="-") S GMRCADD=0,GMRCUSER=$E(GMRCUSER,2,$L(GMRCUSER))
"RTN","GMRCACMT",80,0)
 .E  S GMRCADD=1
"RTN","GMRCACMT",81,0)
 .;
"RTN","GMRCACMT",82,0)
 .S X=GMRCUSER,DIC=200,DIC(0)="EMQ" D ^DIC
"RTN","GMRCACMT",83,0)
 .;
"RTN","GMRCACMT",84,0)
 .I (Y>0) D  I 1
"RTN","GMRCACMT",85,0)
 ..;W $E($P(Y,U,2),$L(GMRCUSER)+1,$L($P(Y,U,2)))
"RTN","GMRCACMT",86,0)
 ..;
"RTN","GMRCACMT",87,0)
 ..I GMRCADD D
"RTN","GMRCACMT",88,0)
 ...I $D(GMRCNEW(+Y)) W " already in the list." Q
"RTN","GMRCACMT",89,0)
 ...S GMRCNEW(+Y)="" W " added to the list." S GMRCNT=GMRCNT+1
"RTN","GMRCACMT",90,0)
 ..;
"RTN","GMRCACMT",91,0)
 ..I 'GMRCADD D
"RTN","GMRCACMT",92,0)
 ...I $D(GMRCOLD(+Y)) W " can't delete this name from the list." Q
"RTN","GMRCACMT",93,0)
 ...I '$D(GMRCNEW(+Y)) W " not currently in the list." Q
"RTN","GMRCACMT",94,0)
 ...K GMRCNEW(+Y) S GMRCNT=GMRCNT-1 W " deleted from the list."
"RTN","GMRCACMT",95,0)
 .;
"RTN","GMRCACMT",96,0)
 .E  I $L(GMRCUSER) W "  Name not found."
"RTN","GMRCACMT",97,0)
 ;
"RTN","GMRCACMT",98,0)
 M GMRCOLD=GMRCNEW
"RTN","GMRCACMT",99,0)
 Q
"RTN","GMRCACMT",100,0)
 ;
"RTN","GMRCACMT",101,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;read logic
"RTN","GMRCACMT",102,0)
 ;
"RTN","GMRCACMT",103,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCACMT",104,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCACMT",105,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCACMT",106,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCACMT",107,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCACMT",108,0)
 ;
"RTN","GMRCACMT",109,0)
 ;  Returns "^" or answer
"RTN","GMRCACMT",110,0)
 ;
"RTN","GMRCACMT",111,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCACMT",112,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCACMT",113,0)
 S DIR(0)=GMRC0
"RTN","GMRCACMT",114,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCACMT",115,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCACMT",116,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCACMT",117,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCACMT",118,0)
 D ^DIR
"RTN","GMRCACMT",119,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCACMT",120,0)
 Q Y
"RTN","GMRCACMT",121,0)
 ;
"RTN","GMRCACMT",122,0)
 ;
"RTN","GMRCACMT",123,0)
NAMEHELP ;Help for the recipient list logic
"RTN","GMRCACMT",124,0)
 N GMRCDUZ
"RTN","GMRCACMT",125,0)
 W !,"Enter the name of the user to send the alert to,"
"RTN","GMRCACMT",126,0)
 W !," or put a '-' in front of a name to delete from the list."
"RTN","GMRCACMT",127,0)
 W !
"RTN","GMRCACMT",128,0)
 W !,"  Example:"
"RTN","GMRCACMT",129,0)
 W !,"     SMITH,FRED  ->  to add Fred to the list."
"RTN","GMRCACMT",130,0)
 W !,"     -SMITH,FRED ->  to delete Fred from the list."
"RTN","GMRCACMT",131,0)
 W !,"Already selected: "
"RTN","GMRCACMT",132,0)
 W !
"RTN","GMRCACMT",133,0)
 S GMRCDUZ=0 F  S GMRCDUZ=$O(GMRCNEW(GMRCDUZ)) Q:'GMRCDUZ  D
"RTN","GMRCACMT",134,0)
 .W !,?5,$P(^VA(200,GMRCDUZ,0),U,1)
"RTN","GMRCACMT",135,0)
 .W:$D(GMRCOLD(GMRCDUZ)) "  <mandatory>"
"RTN","GMRCACMT",136,0)
 W !
"RTN","GMRCACMT",137,0)
 Q
"RTN","GMRCACMT",138,0)
 ;
"RTN","GMRCACTM")
0^10^B3635976
"RTN","GMRCACTM",1,0)
GMRCACTM ; SLC/DLT,DCM - Set GMRCACTM with action menu based on Service ; 11/25/2000
"RTN","GMRCACTM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,11,18**;DEC 27, 1997
"RTN","GMRCACTM",3,0)
CPRS(GMRCPM,GUI) ;Entry point for setting menu actions for CPRS user
"RTN","GMRCACTM",4,0)
 ;GMRCPM=a list of File 123 IEN's to check for menu actions.
"RTN","GMRCACTM",5,0)
 ;       Passed in as '300;303;295;309;313'
"RTN","GMRCACTM",6,0)
 ;GUI =1 if coming from the GUI; return field name in ORFLG also
"RTN","GMRCACTM",7,0)
 ;Menu access is passed out in ORFLG as, for example,
"RTN","GMRCACTM",8,0)
 ;2=Extended menu actions allowed - If ORFLG(DUZ)>1 then extended menu actions are allowed
"RTN","GMRCACTM",9,0)
 ; 8 Sep 2000 - Patch 18 updates ORFLG to turn on Edit/Resubmit in GUI
"RTN","GMRCACTM",10,0)
 ; Piece 6 is to turn on Edit/Resubmit.
"RTN","GMRCACTM",11,0)
 ; This routine invokes IA #2425
"RTN","GMRCACTM",12,0)
 ;
"RTN","GMRCACTM",13,0)
 I '$L(GMRCPM) S ORFLG=1 Q
"RTN","GMRCACTM",14,0)
 K ORFLG
"RTN","GMRCACTM",15,0)
 N I,GMRCSS,GMRCIEN
"RTN","GMRCACTM",16,0)
 F I=1:1 S ORFLG=1,GMRCIEN=$P(GMRCPM,";",I) Q:GMRCIEN=""  D
"RTN","GMRCACTM",17,0)
 .S ORFLG(GMRCIEN)=1 ;set default answer to read only
"RTN","GMRCACTM",18,0)
 .S GMRCSS=+$P($G(^GMR(123,+GMRCIEN,0)),"^",5)
"RTN","GMRCACTM",19,0)
 .Q:'+$G(GMRCSS)
"RTN","GMRCACTM",20,0)
 .;when service is defined, check for service user 
"RTN","GMRCACTM",21,0)
 .D EN
"RTN","GMRCACTM",22,0)
 .S ORFLG(GMRCIEN)=ORFLG
"RTN","GMRCACTM",23,0)
 .I $$VALPROV^GMRCEDIT(GMRCIEN) S $P(ORFLG(GMRCIEN),U,6)=1
"RTN","GMRCACTM",24,0)
 .Q
"RTN","GMRCACTM",25,0)
 Q
"RTN","GMRCACTM",26,0)
 ;
"RTN","GMRCACTM",27,0)
EN ;Set GMRCACTM with appropriate menu of actions given user characteristics
"RTN","GMRCACTM",28,0)
 ;If ORFLG is DEFINED then GMRCACTM is returned as a set of codes:
"RTN","GMRCACTM",29,0)
 ;    1 = GMRCACTM USER REVIEW SCREEN - simple actions
"RTN","GMRCACTM",30,0)
 ;    2 = GMRCACTM SERVICE ACTION menu  - all actions possible for
"RTN","GMRCACTM",31,0)
 ;        clinical user in service
"RTN","GMRCACTM",32,0)
 ;    3 = GMRCACTM ADMIN ACTION menu - administrative user
"RTN","GMRCACTM",33,0)
 ;    4 = GMRCACTM TRK MEDICINE CONSULTS menu - all actions that the user of the medicine package can take.
"RTN","GMRCACTM",34,0)
 ; initialize GMRCACTM for read only
"RTN","GMRCACTM",35,0)
 S GMRCACTM="GMRCACTM USER REVIEW SCREEN"
"RTN","GMRCACTM",36,0)
 ; medicine options will get the medicine interface
"RTN","GMRCACTM",37,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" S GMRCACTM="GMRCACTM MEDICINE PKG MENU" Q
"RTN","GMRCACTM",38,0)
 ;
"RTN","GMRCACTM",39,0)
 ; if service and entry aren't defined, assume read only access
"RTN","GMRCACTM",40,0)
 I '$D(XQADATA),$S('+$G(GMRCSS):1,1:0) D  Q
"RTN","GMRCACTM",41,0)
 .I $D(ORFLG) S ORFLG(GMRCIEN)=1 K GMRCACTM
"RTN","GMRCACTM",42,0)
 .Q
"RTN","GMRCACTM",43,0)
 ;
"RTN","GMRCACTM",44,0)
 ;Check first for local variations of the action menu. 
"RTN","GMRCACTM",45,0)
 ;using locally developed options
"RTN","GMRCACTM",46,0)
 ;N GMRCOPT,LOCALMNU
"RTN","GMRCACTM",47,0)
 ;I +$G(GMRCSS) D
"RTN","GMRCACTM",48,0)
 ;. S GMRCOPT=$P($G(^GMR(123.5,+GMRCSS,123)),"^",10)
"RTN","GMRCACTM",49,0)
 ;. S LOCALMNU=$P($G(^GMR(123.5,+GMRCSS,123)),"^",3)
"RTN","GMRCACTM",50,0)
 ;. I +$G(^ORD(101,+LOCALMNU,0)) D
"RTN","GMRCACTM",51,0)
 ;.. S GMRCACTM=$P($G(ORD(101,+LOCALMNU,0)),"^",1)
"RTN","GMRCACTM",52,0)
 ;.. I $D(ORFLG) S ORFLG=2 K GMRCACTM
"RTN","GMRCACTM",53,0)
 ;. Q
"RTN","GMRCACTM",54,0)
 ;
"RTN","GMRCACTM",55,0)
 ;Get the users service update level
"RTN","GMRCACTM",56,0)
 N GMRCFLG
"RTN","GMRCACTM",57,0)
 S GMRCFLG=$$VALID^GMRCAU(+GMRCSS,"",,$G(GUI))
"RTN","GMRCACTM",58,0)
 ;
"RTN","GMRCACTM",59,0)
 ;If ORFLG is all that should be returned, than set and exit
"RTN","GMRCACTM",60,0)
 I $D(ORFLG) D  Q
"RTN","GMRCACTM",61,0)
 . K GMRCACTM
"RTN","GMRCACTM",62,0)
 . I GMRCFLG=0 S ORFLG=1 Q
"RTN","GMRCACTM",63,0)
 . S ORFLG=GMRCFLG Q
"RTN","GMRCACTM",64,0)
 ;
"RTN","GMRCACTM",65,0)
 ;Process the GMRCFLG value to get the GMRCACTM defined.
"RTN","GMRCACTM",66,0)
 I GMRCFLG>0 D SETACTM Q
"RTN","GMRCACTM",67,0)
 Q
"RTN","GMRCACTM",68,0)
 ;
"RTN","GMRCACTM",69,0)
SETACTM ;Set GMRCACTM with local update menu or the GMRCACTM SERVICE ACTION MENU
"RTN","GMRCACTM",70,0)
 S GMRCACTM=$S($P($G(^GMR(123.5,GMRCSS,123)),"^",3):$P(^ORD(101,$P(^(123),"^",3),0),"^"),1:"GMRCACTM SERVICE ACTION MENU")
"RTN","GMRCACTM",71,0)
 Q
"RTN","GMRCACTM",72,0)
 ;
"RTN","GMRCASV")
0^15^B61316668
"RTN","GMRCASV",1,0)
GMRCASV ;SLC/KCM,DLT - Build ^TMP("GMRCS" of Svc(s)/Specialties ; 11/25/2000
"RTN","GMRCASV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,12,18**;DEC 27, 1997
"RTN","GMRCASV",3,0)
 ; This routine invokes IA #2426
"RTN","GMRCASV",4,0)
 ;
"RTN","GMRCASV",5,0)
ASRV ;Ask for service/specialty group {output} GMRCDG,GMRCBUF,GMRCACT,^TMP("GMRCS",$J,^TMP("GMRCSLIST",$J
"RTN","GMRCASV",6,0)
 K GMRCQUT
"RTN","GMRCASV",7,0)
 N GMRCSEL
"RTN","GMRCASV",8,0)
 D SERV0 D:GMRCDG SERV1
"RTN","GMRCASV",9,0)
 K W,X,Y Q
"RTN","GMRCASV",10,0)
SERV0 ;Assume that the lookup must begin with ALL SERVICES, or value of GMRCSVNM
"RTN","GMRCASV",11,0)
 ;GMRCASV=the ask prompt text
"RTN","GMRCASV",12,0)
 ;GMRCSVNM=text to use for default name
"RTN","GMRCASV",13,0)
 S GMRCDG=0
"RTN","GMRCASV",14,0)
 S:$G(GMRCASV)["Forward" GMRCTO=1
"RTN","GMRCASV",15,0)
 F  D ASKPRMPT S:X["^^" DIROUT=1 S:X["^" GMRCQUT=1 Q:X["^"  D @$S(X["?":"LISTALL",1:"LKUP") D:($L($G(GMRCSVNM))&GMRCDG) LISTSRV Q:GMRCDG
"RTN","GMRCASV",16,0)
 Q
"RTN","GMRCASV",17,0)
ASKPRMPT ;Write the prompt and do the Read to get the user text entered in X
"RTN","GMRCASV",18,0)
 W !!,$S($D(GMRCASV):GMRCASV,1:"Select Service/Specialty: ")_$S($L($G(GMRCSVNM)):GMRCSVNM,1:"ALL SERVICES")_"// "
"RTN","GMRCASV",19,0)
 R X:DTIME
"RTN","GMRCASV",20,0)
 I '$T S X="^"
"RTN","GMRCASV",21,0)
 I X'["^" S X=$S($G(GMRCASV)["Forward"&('$L(X)):"^",'$L(X):"ALL SERVICES",1:X) Q
"RTN","GMRCASV",22,0)
 Q
"RTN","GMRCASV",23,0)
SERV1 ;Create selected SERVICE ^TMP array of service information
"RTN","GMRCASV",24,0)
 ;If GMRCTO=1 then the BILD section will not include disabled or tracking services which the user cannot send to.
"RTN","GMRCASV",25,0)
 N GMRCDGT
"RTN","GMRCASV",26,0)
 S GMRCBUF=GMRCDG
"RTN","GMRCASV",27,0)
 I GMRCBUF>0 D
"RTN","GMRCASV",28,0)
 . K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCASV",29,0)
 . S GMRCDGT=0,GMRCSEL="BILD" D EN
"RTN","GMRCASV",30,0)
 . S GMRCGRP("NAM")=^GMR(123.5,GMRCBUF,0)
"RTN","GMRCASV",31,0)
 . S (GMRCDG,GMRCGRP("ROOT"))=GMRCBUF
"RTN","GMRCASV",32,0)
 . S GMRCGRP("NAM")=$S($L($P(GMRCGRP("NAM"),"^",3)):$P(GMRCGRP("NAM"),"^",3),1:$E($P(GMRCGRP("NAM"),"^"),1,5))
"RTN","GMRCASV",33,0)
 K GMRCSEQ,GMRCBUF
"RTN","GMRCASV",34,0)
 Q
"RTN","GMRCASV",35,0)
LKUP ;Ask the user for the service; use the value of x for lookup; branch to list on ??
"RTN","GMRCASV",36,0)
 ; Patch 18 added Identifier to 123.5 in place of DIC("W")
"RTN","GMRCASV",37,0)
 ; Remove commented line in next patch.
"RTN","GMRCASV",38,0)
 ;S DIC="^GMR(123.5,",DIC(0)="MNEQZ",DIC("W")="W ""   ""_$P(Y,""^"",2)"
"RTN","GMRCASV",39,0)
 S DIC="^GMR(123.5,",DIC(0)="MNEQZ"
"RTN","GMRCASV",40,0)
 D ^DIC K DIC I '$D(Y(0)) D LISTALL Q
"RTN","GMRCASV",41,0)
 N W,GMRCEXCL I +$G(GMRCTO) D
"RTN","GMRCASV",42,0)
 . S W=Y(0),GMRCDG=+Y
"RTN","GMRCASV",43,0)
 . S GMRCEXCL=0 D EXCLUDE
"RTN","GMRCASV",44,0)
 . I GMRCEXCL=1 S GMRCSVNM=Y(0,0),GMRCEXCL=0 Q
"RTN","GMRCASV",45,0)
 . K GMRCSVNM ;Service selected is not a grouper for lookup
"RTN","GMRCASV",46,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a disabled service!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",47,0)
 . N GMRCDAD D CHECKDAD
"RTN","GMRCASV",48,0)
 . I GMRCEXCL=90 S GMRCMSG="You have selected a service that is not part of the ALL SERVICES hierarchy!",GMRCMSG(1)="Contact Consult ADPAC" D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",49,0)
 . ;I GMRCEXCL=9 S GMRCMSG="You have selected a service whose parent is disabled!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",50,0)
 . I GMRCEXCL=2 S GMRCMSG="You have selected a service whose parent is a tracking service!",GMRCMSG(1)="You do not have authorization to send consults to this service." D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",51,0)
 I +$G(GMRCEXCL) S Y=0,GMRCDG=0
"RTN","GMRCASV",52,0)
 S:Y>0 GMRCDG=+Y ;falls to here when service is a grouper or not excluded
"RTN","GMRCASV",53,0)
 Q
"RTN","GMRCASV",54,0)
 ;
"RTN","GMRCASV",55,0)
QUEUE ; queue up the print
"RTN","GMRCASV",56,0)
 N ZTRTN,ZTSK,ZTIO,ZTDTH,ZTDESC
"RTN","GMRCASV",57,0)
 S ZTRTN="PRTLST^GMRCASV",ZTDESC="Consult Service Hierarchy List"
"RTN","GMRCASV",58,0)
 S ZTIO=ION,ZTDTH=$H
"RTN","GMRCASV",59,0)
 D ^%ZTLOAD
"RTN","GMRCASV",60,0)
 I $G(ZTSK) W !,"Queued to Print, Task # ",ZTSK
"RTN","GMRCASV",61,0)
 E  W !,"Sorry, Try again Later"
"RTN","GMRCASV",62,0)
 Q
"RTN","GMRCASV",63,0)
 ;
"RTN","GMRCASV",64,0)
LISTOPT ;called from option to list hierarchy
"RTN","GMRCASV",65,0)
 S %ZIS="Q"
"RTN","GMRCASV",66,0)
 D ^%ZIS I POP Q
"RTN","GMRCASV",67,0)
 I $D(IO("Q")) D QUEUE D ^%ZISC,HOME^%ZIS Q
"RTN","GMRCASV",68,0)
 D PRTLST
"RTN","GMRCASV",69,0)
 D ^%ZISC,HOME^%ZIS
"RTN","GMRCASV",70,0)
 Q
"RTN","GMRCASV",71,0)
 ;
"RTN","GMRCASV",72,0)
PRTLST ;queued entry point or just print it
"RTN","GMRCASV",73,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCASV",74,0)
 U IO
"RTN","GMRCASV",75,0)
 N GMRCPRT,GMRCPG,GMRCTO,GMRCDG,GMRCOUT
"RTN","GMRCASV",76,0)
 N DUOUT,DTOUT,DIROUT
"RTN","GMRCASV",77,0)
 S GMRCPG=0,GMRCPRT=1
"RTN","GMRCASV",78,0)
 D PAGE(.GMRCPG)
"RTN","GMRCASV",79,0)
 D LISTALL I $D(GMRCOUT) Q
"RTN","GMRCASV",80,0)
 I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",81,0)
 W !!,"Services not currently part of the Consults Hierarchy:"
"RTN","GMRCASV",82,0)
 N SERV S SERV=1
"RTN","GMRCASV",83,0)
 F  S SERV=$O(^GMR(123.5,SERV)) Q:'SERV  Q:$D(GMRCOUT)  D
"RTN","GMRCASV",84,0)
 . I '$D(^GMR(123.5,"APC",SERV)) D
"RTN","GMRCASV",85,0)
 .. I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",86,0)
 .. W !,?3,$P(^GMR(123.5,SERV,0),U) I '$P(^(0),U,2) Q
"RTN","GMRCASV",87,0)
 .. N USE S USE=$P(^GMR(123.5,SERV,0),U,2)
"RTN","GMRCASV",88,0)
 .. W "  ("
"RTN","GMRCASV",89,0)
 .. W $S(USE=1:"Grouper Only",USE=9:"Disabled",1:"Tracking Only")_")"
"RTN","GMRCASV",90,0)
 K GMRCDG D EXIT
"RTN","GMRCASV",91,0)
 Q
"RTN","GMRCASV",92,0)
LISTALL ;display LIST of Services in their hierarchy beginning with ALL SERVICES
"RTN","GMRCASV",93,0)
 S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0)) Q:'GMRCDG
"RTN","GMRCASV",94,0)
 S GMRCSEL="DISP" W:'$D(GMRCPRT) @IOF D EN
"RTN","GMRCASV",95,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",96,0)
 Q
"RTN","GMRCASV",97,0)
LISTSRV ;display LIST of sub-services beginning with a selected service
"RTN","GMRCASV",98,0)
 S GMRC1=0,GMRCDG=$O(^GMR(123.5,"B",GMRCSVNM,0)) Q:'GMRCDG
"RTN","GMRCASV",99,0)
 S GMRCSEL="DISP" W @IOF D EN
"RTN","GMRCASV",100,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",101,0)
 Q
"RTN","GMRCASV",102,0)
EN ;Setup Specialty groups   entry: GMRCDG,GMRCSEL   exit: GMRCGRP if GMRCSEL="BILD"
"RTN","GMRCASV",103,0)
 N GMRCSTK,PARENT,GMRCUSG,GMRCEXCL
"RTN","GMRCASV",104,0)
 S GMRCSTK=0,PARENT=0 ;beginning service logic
"RTN","GMRCASV",105,0)
 D @GMRCSEL Q:$D(DUOUT)!($D(DIROUT))!($D(GMRCOUT))
"RTN","GMRCASV",106,0)
EN1 ;GMRCSTK is used to manage the level of stacks under beginning service
"RTN","GMRCASV",107,0)
 S GMRCSTK=1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCSTK(0)=0,GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",108,0)
 F  S GMRCNAM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM)) D  D @$S(+GMRCMEM'>0:"POP",1:"PROC") Q:GMRCSTK<1
"RTN","GMRCASV",109,0)
 . I $G(GMRCEXCL) S GMRCMEM=0 Q  ;Exclude children of excluded parent
"RTN","GMRCASV",110,0)
 . I '$L(GMRCNAM) S GMRCMEM=0 ;No more 10th node children
"RTN","GMRCASV",111,0)
 . E  S GMRCMEM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM,""))
"RTN","GMRCASV",112,0)
 K DUOUT,GMRCMEM,GMRCNAM,GMRCSTK,GMRCSEL
"RTN","GMRCASV",113,0)
 Q
"RTN","GMRCASV",114,0)
POP ;Go back one level in service stack hierarchy and initialize exclude
"RTN","GMRCASV",115,0)
 S GMRCSTK=GMRCSTK-1,GMRCMEM=$P(GMRCSTK(GMRCSTK),"^",2),GMRCNAM=$P(GMRCSTK(GMRCSTK),"^",3),GMRCEXCL=0
"RTN","GMRCASV",116,0)
 Q
"RTN","GMRCASV",117,0)
PROC ;GMRCMEM is the member ien in the 10th node being processed
"RTN","GMRCASV",118,0)
 ;GMRCDG is the ien of file 123.5 being processed
"RTN","GMRCASV",119,0)
 ;GMRCNAM is the services name
"RTN","GMRCASV",120,0)
 S $P(GMRCSTK(GMRCSTK),"^",2)=GMRCMEM
"RTN","GMRCASV",121,0)
 S $P(GMRCSTK(GMRCSTK),"^",3)=GMRCNAM
"RTN","GMRCASV",122,0)
 Q:'$D(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0))  ;ghost "AC" x-ref 
"RTN","GMRCASV",123,0)
 S GMRCDG=$P(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0),"^",1)
"RTN","GMRCASV",124,0)
 S PARENT=+GMRCSTK(GMRCSTK)
"RTN","GMRCASV",125,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",126,0)
 I $G(GMRCTO)=1 S GMRCEXCL=0 D EXCLUDE S:GMRCEXCL=1 GMRCEXCL=0 ;Includes grouper only
"RTN","GMRCASV",127,0)
 D:'+$G(GMRCEXCL) @GMRCSEL G:($D(DUOUT)!$D(DIROUT)) EXIT
"RTN","GMRCASV",128,0)
 ;Initialize a stack level entry to process children of the multiple
"RTN","GMRCASV",129,0)
 S GMRCSTK=GMRCSTK+1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",130,0)
 Q
"RTN","GMRCASV",131,0)
DISP ;Display individual entries alphabetically for each service as processed
"RTN","GMRCASV",132,0)
 Q:$D(GMRCOUT)
"RTN","GMRCASV",133,0)
 I $Y>(IOSL-4) D READ S:$D(DUOUT)!($D(DIROUT)) GMRCSTK=0 G:GMRCSTK=0 EXIT
"RTN","GMRCASV",134,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",135,0)
 S GMRCUSG=$P(W,"^",2)
"RTN","GMRCASV",136,0)
 W !,?((GMRCSTK*2)),$S(GMRCUSG=9:"<",1:"")_$P(W,"^")_$S(GMRCUSG=9:">",1:"")_"  "_$S(GMRCUSG=1:"(Grouper Only)",GMRCUSG=2:"(Tracking Only)",GMRCUSG=9:"<Disabled>",1:"")
"RTN","GMRCASV",137,0)
 Q
"RTN","GMRCASV",138,0)
BILD ;The following logic will build an array for review for GUI
"RTN","GMRCASV",139,0)
 ;GMRCDGT=sequential number,GMRCDG=service pointer,
"RTN","GMRCASV",140,0)
 ;W=^GMR(123.5,GMRCDG,0),1st piece is name, 2nd piece usage
"RTN","GMRCASV",141,0)
 ;If GMRCTO=1 then services that only consults can be sent to will be
"RTN","GMRCASV",142,0)
 ;included with the exception of "grouper only" which keeps the
"RTN","GMRCASV",143,0)
 ;hierarchy in order.
"RTN","GMRCASV",144,0)
 N CHILD
"RTN","GMRCASV",145,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",146,0)
 S ^TMP("GMRCS",$J,GMRCDG)=$P(W,"^")
"RTN","GMRCASV",147,0)
 S GMRCDGT=GMRCDGT+1
"RTN","GMRCASV",148,0)
 S CHILD=$O(^GMR(123.5,GMRCDG,10,0)) S CHILD=$S(+CHILD:"+",1:"")
"RTN","GMRCASV",149,0)
 S ^TMP("GMRCSLIST",$J,GMRCDGT)=GMRCDG_U_$P(W,"^")_U_PARENT_U_CHILD_U_$P(W,"^",2)
"RTN","GMRCASV",150,0)
 Q
"RTN","GMRCASV",151,0)
EXCLUDE ;This logic excludes services the user cannot send a consult to.
"RTN","GMRCASV",152,0)
 ;If GMRCTO=1 the user is forwarding or sending a consult
"RTN","GMRCASV",153,0)
 ;W=zeroth node of service,GMRCDG=ien of service,GMRCO=ien of consult (optional)
"RTN","GMRCASV",154,0)
 Q:'$L($G(W))
"RTN","GMRCASV",155,0)
 S GMRCEXCL=+$P(W,"^",2) ;Include grouper for hierarchy building only
"RTN","GMRCASV",156,0)
 I GMRCEXCL=2 D  ;tracking service exclusion check
"RTN","GMRCASV",157,0)
 . N GMRCSRV I +$G(GMRCO) S GMRCSRV=$P($G(^GMR(123,+GMRCO,0)),"^",5) I $D(^GMR(123.5,"APC",+GMRCDG,+GMRCSRV)) S GMRCEXCL=0 Q  ;Checks if parent is the consults current service
"RTN","GMRCASV",158,0)
 . I $$VALID^GMRCAU(+GMRCDG,,DUZ) S GMRCEXCL=0 ;update user?
"RTN","GMRCASV",159,0)
 . Q
"RTN","GMRCASV",160,0)
 Q
"RTN","GMRCASV",161,0)
CHECKDAD ;Check the service usage statuses for a selected services parents
"RTN","GMRCASV",162,0)
 ;There are two passes, one to get any user accessible parent
"RTN","GMRCASV",163,0)
 ;and the second pass is through the GMRCDAD array to check the parents usage
"RTN","GMRCASV",164,0)
 ;The GMRCEXCL value is returned for exclusion due to parent
"RTN","GMRCASV",165,0)
 S GMRCDAD=""
"RTN","GMRCASV",166,0)
 ;FIRST PASS
"RTN","GMRCASV",167,0)
 F  S GMRCDAD=$O(^GMR(123.5,"APC",+GMRCDG,GMRCDAD)) Q:GMRCDAD=""  D  I $P($G(GMRCDAD(+GMRCDAD)),U,2)="OK" S GMRCEXCL="OK"
"RTN","GMRCASV",168,0)
 . S GMRCDAD(+GMRCDAD)=$P(^GMR(123.5,+GMRCDAD,0),U,2) ;dads service usage
"RTN","GMRCASV",169,0)
 . ;I $P($G(^GMR(123.5,+GMRCDAD,0)),U,1)="ALL SERVICES" S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^ALL" Q  ;If one of the dad's is all services, than OK to send to if not previously excluded.
"RTN","GMRCASV",170,0)
 . I GMRCDAD(+GMRCDAD)=1 S $P(GMRCDAD(+GMRCDAD),"^",2)="OK" Q  ;Groupers Only are OK!
"RTN","GMRCASV",171,0)
 . I $$VALID^GMRCAU(+GMRCDAD,,DUZ) S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^Update access" ;update user?
"RTN","GMRCASV",172,0)
 . Q
"RTN","GMRCASV",173,0)
 I GMRCEXCL="OK" S GMRCEXCL=0 Q  ;There is a parent which user has access to.
"RTN","GMRCASV",174,0)
 ;Second Pass of the GMRCDAD array (multiple parents)
"RTN","GMRCASV",175,0)
 S GMRCDAD=$O(GMRCDAD("")) I 'GMRCDAD S GMRCEXCL=90 Q  ;Not part of hierarchy; missing dad
"RTN","GMRCASV",176,0)
 ;Use first parent found in hierarchy.
"RTN","GMRCASV",177,0)
 S GMRCEXCL=+GMRCDAD(GMRCDAD)
"RTN","GMRCASV",178,0)
 Q
"RTN","GMRCASV",179,0)
READ ;;Hold screen
"RTN","GMRCASV",180,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","GMRCASV",181,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","GMRCASV",182,0)
 N X W !?5,"Press RETURN to continue, ^ to exit: " R X:DTIME
"RTN","GMRCASV",183,0)
 S:X="^" DUOUT=1 S:'$T!(X="^^") DIROUT=1
"RTN","GMRCASV",184,0)
 I $D(DUOUT)!$D(DIROUT) S:$D(GMRCPRT) GMRCOUT=1
"RTN","GMRCASV",185,0)
 W @IOF
"RTN","GMRCASV",186,0)
 I '$D(DTOUT),('$D(DUOUT))&($D(GMRCPRT)) D PAGE(.GMRCPG)
"RTN","GMRCASV",187,0)
 Q
"RTN","GMRCASV",188,0)
PAGE(PG) ;print header and increment page
"RTN","GMRCASV",189,0)
 S PG=PG+1
"RTN","GMRCASV",190,0)
 W !,"Consult Hierarchy list",?30,$$HTE^XLFDT($H),?60,"Page: ",PG
"RTN","GMRCASV",191,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCASV",192,0)
 Q
"RTN","GMRCASV",193,0)
EXIT ;Kill off variables and quit
"RTN","GMRCASV",194,0)
 K DIROUT,DUOUT,DTOUT,DIRUT
"RTN","GMRCASV",195,0)
 Q
"RTN","GMRCASV1")
0^16^B2462925
"RTN","GMRCASV1",1,0)
GMRCASV1 ;SLC/JFR - HIERARCHY MGMT cont'd ; 11/25/2000
"RTN","GMRCASV1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**18**;DEC 27, 1997
"RTN","GMRCASV1",3,0)
 Q  ; don't start at the top
"RTN","GMRCASV1",4,0)
GUI(GMRCARR,GMRCSTRT,GMRCWHY,GMRCSYN) ;;return CSLT services for GUI
"RTN","GMRCASV1",5,0)
 ;Input:
"RTN","GMRCASV1",6,0)
 ; GMRCARR - passed in as the array to return results in
"RTN","GMRCASV1",7,0)
 ; GMRCSTRT- service to begin building from
"RTN","GMRCASV1",8,0)
 ; GMRCWHY - 0 for display, 1 for forwarding or ordering
"RTN","GMRCASV1",9,0)
 ; GMRCSYN - Boolean: 1=return synonyms, 0=do not
"RTN","GMRCASV1",10,0)
 ;Output: Array formatted as follows-
"RTN","GMRCASV1",11,0)
 ;      svc ien^svc name or syn^parent^has children^svc usage
"RTN","GMRCASV1",12,0)
 ; This routine invokes IA #3252
"RTN","GMRCASV1",13,0)
 ;
"RTN","GMRCASV1",14,0)
 N GMRCDG,GMRCGRP,GMRCTO
"RTN","GMRCASV1",15,0)
 S GMRCDG=GMRCSTRT,GMRCTO=GMRCWHY
"RTN","GMRCASV1",16,0)
 D SERV1^GMRCASV I '$D(^TMP("GMRCSLIST",$J)) Q
"RTN","GMRCASV1",17,0)
 I '$G(GMRCSYN) M @GMRCARR=^TMP("GMRCSLIST",$J) Q  ;no synonyms needed
"RTN","GMRCASV1",18,0)
 N GMRC,GMRCSVC,GMRCS,NEXT,PIEC
"RTN","GMRCASV1",19,0)
 S GMRC=0,NEXT=$O(^TMP("GMRCSLIST",$J,""),-1)+1
"RTN","GMRCASV1",20,0)
 F  S GMRC=$O(^TMP("GMRCSLIST",$J,GMRC)) Q:'GMRC!($P(^(GMRC),U,5)="S")   D
"RTN","GMRCASV1",21,0)
 . I $P(^TMP("GMRCSLIST",$J,GMRC),U,5)=1 Q
"RTN","GMRCASV1",22,0)
 . S GMRCSVC=+^TMP("GMRCSLIST",$J,GMRC)
"RTN","GMRCASV1",23,0)
 . S GMRCS=0
"RTN","GMRCASV1",24,0)
 . F  S GMRCS=$O(^GMR(123.5,GMRCSVC,2,GMRCS)) Q:'GMRCS  D
"RTN","GMRCASV1",25,0)
 .. S PIEC(1)=GMRCSVC
"RTN","GMRCASV1",26,0)
 .. S PIEC(2)=$P(^GMR(123.5,GMRCSVC,0),U)
"RTN","GMRCASV1",27,0)
 .. S PIEC(2)=^GMR(123.5,GMRCSVC,2,GMRCS,0)_"  <"_PIEC(2)_">"
"RTN","GMRCASV1",28,0)
 .. S ^TMP("GMRCSLIST",$J,NEXT)=PIEC(1)_"^"_PIEC(2)_"^^^S"
"RTN","GMRCASV1",29,0)
 .. S NEXT=NEXT+1
"RTN","GMRCASV1",30,0)
 .. Q
"RTN","GMRCASV1",31,0)
 . Q
"RTN","GMRCASV1",32,0)
 M @GMRCARR=^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",33,0)
 K ^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",34,0)
 Q
"RTN","GMRCEDIT")
0^5^B11470474
"RTN","GMRCEDIT",1,0)
GMRCEDIT ;SLC/DCM,JFR - EDIT CANCELLED CONSULT-MAIN DRIVER ; 11/25/2000
"RTN","GMRCEDIT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,10,18**;DEC 27, 1997
"RTN","GMRCEDIT",3,0)
 ; Patch 18 newed variable DFN and added line tag VALPROV
"RTN","GMRCEDIT",4,0)
 ; This routine invokes IA #2638,#2713,#2801,#10060
"RTN","GMRCEDIT",5,0)
EN(XQCON,XQDFN) ; -- main entry point for GMRCEDIT
"RTN","GMRCEDIT",6,0)
 ;XQDFN=XQAID   XQCON=XQADATA from CPRS alerts
"RTN","GMRCEDIT",7,0)
 N GMRCNOTF,GMRCCORY,GMRCDA,GMRCO,DFN
"RTN","GMRCEDIT",8,0)
 S DFN=$P(XQDFN,",",2),GMRCDA=$S(XQCON=+XQCON:+XQCON,+$P($P(XQCON,",",2),";",2):+$P($P(XQCON,",",2),";",2),XQCON?1N.N1",GMRC".E:+XQCON,1:$P($P(XQCON,";",3),",",1))
"RTN","GMRCEDIT",9,0)
 S GMRCNOTF=+$P(XQDFN,",",3)
"RTN","GMRCEDIT",10,0)
 I '+GMRCDA S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN),END Q
"RTN","GMRCEDIT",11,0)
 S GMRCDAP=GMRCDA
"RTN","GMRCEDIT",12,0)
 I '$$LOCK^GMRCA1(+GMRCDAP) D END Q
"RTN","GMRCEDIT",13,0)
 N GMRCLCK S GMRCLCK=1 ;JFR
"RTN","GMRCEDIT",14,0)
 ;S GMRCDAP=GMRCDA I +$P(^GMR(123,+GMRCDA,0),"^",5)
"RTN","GMRCEDIT",15,0)
 S GMRCOK=$P(^ORD(100.01,$P(^GMR(123,+GMRCDA,0),"^",12),0),"^",1),GMRCOK=$S(GMRCOK["CANCELLED":1,1:0)
"RTN","GMRCEDIT",16,0)
 I '$D(GMRCOK) S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN),END Q
"RTN","GMRCEDIT",17,0)
 S GMRCPNM=$P(^DPT(DFN,0),"^",1),GMRCPROV=$P(^GMR(123,GMRCDA,0),"^",14) I +GMRCPROV S GMRCPROV=$P(^VA(200,GMRCPROV,0),"^",1)
"RTN","GMRCEDIT",18,0)
 D EN^VALM("GMRC EDIT CONSULT")  ;********* CALL TO LIST MANAGER
"RTN","GMRCEDIT",19,0)
 I $S($O(GMRCED(0)):1,$D(^TMP("GMRCED",$J)):1,1:0),'$D(GMRCRSUB) D
"RTN","GMRCEDIT",20,0)
 . N DIR,DTOUT,DUOUT,X,Y
"RTN","GMRCEDIT",21,0)
 . W !,$C(7),"This Consult Has Not Been Resubmitted!!"
"RTN","GMRCEDIT",22,0)
 . W !,"Resubmit Or All Edits Will Be Lost!!",!!
"RTN","GMRCEDIT",23,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to resubmit now? ",DIR("B")="YES"
"RTN","GMRCEDIT",24,0)
 . D ^DIR I $D(DUOUT)!($D(DTOUT))!(Y<1) W !!,"No changes made!" Q
"RTN","GMRCEDIT",25,0)
 . D EN^GMRCEDT2(GMRCDAP)
"RTN","GMRCEDIT",26,0)
 . Q
"RTN","GMRCEDIT",27,0)
 S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN)
"RTN","GMRCEDIT",28,0)
 D END
"RTN","GMRCEDIT",29,0)
 Q
"RTN","GMRCEDIT",30,0)
 ;
"RTN","GMRCEDIT",31,0)
HDR ; -- header code
"RTN","GMRCEDIT",32,0)
 S VALMHDR(1)="Edit Consult for Patient "_GMRCPNM_"  Consult Number: "_GMRCDA
"RTN","GMRCEDIT",33,0)
 S VALMHDR(2)="Sending Provider: "_GMRCPROV
"RTN","GMRCEDIT",34,0)
 Q
"RTN","GMRCEDIT",35,0)
 ;
"RTN","GMRCEDIT",36,0)
INIT ; -- init variables and list array
"RTN","GMRCEDIT",37,0)
 K ^TMP("GMRCR",$J,"EDLIST")
"RTN","GMRCEDIT",38,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""EDLIST"")"
"RTN","GMRCEDIT",39,0)
 F LINE=1:1:GMRCLNO S DSPLINE=$O(^TMP("GMRCR",$J,"ED",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCEDIT",40,0)
 S VALMCNT=GMRCLNO,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCEDIT",41,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCEDIT",42,0)
 Q
"RTN","GMRCEDIT",43,0)
 ;
"RTN","GMRCEDIT",44,0)
HELP ; -- help code
"RTN","GMRCEDIT",45,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCEDIT",46,0)
 Q
"RTN","GMRCEDIT",47,0)
 ;
"RTN","GMRCEDIT",48,0)
VALPROV(GMRCIEN) ; Check Provider or Update authority.      
"RTN","GMRCEDIT",49,0)
 I DUZ=$P(^GMR(123,+GMRCIEN,0),"^",14) Q 1
"RTN","GMRCEDIT",50,0)
 I $$VALID^GMRCAU($P(^GMR(123,+GMRCIEN,0),"^",5)) Q 1
"RTN","GMRCEDIT",51,0)
 Q 0
"RTN","GMRCEDIT",52,0)
EXIT ;
"RTN","GMRCEDIT",53,0)
 ;Don't kill anything here
"RTN","GMRCEDIT",54,0)
 Q
"RTN","GMRCEDIT",55,0)
END ; -- exit code
"RTN","GMRCEDIT",56,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(+GMRCDAP) ;JFR
"RTN","GMRCEDIT",57,0)
 K ^TMP("GMRCR",$J,"EDLIST"),^TMP("GMRCR",$J,"ED")
"RTN","GMRCEDIT",58,0)
 K ^TMP("GMRCED",$J),^TMP("GMRCSUB",$J),^TMP("GMRCFLD20",$J)
"RTN","GMRCEDIT",59,0)
 K CMDA,DFN,DIC,DIE,DR,DA,FLDA,FLDNM,GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCANS,GMRCDIAG,GMRCED,GMRCEDCM,GMRCIND,GMRCINO,GMRCKEEP,GMRCLNO,GMRCND,GMRCND1,GMRCO,GMRCOK,GMRCPC,GMRCPL,GMRCPR,GMRCPNM,GMRCPROC,GMRCPROV,GMRCREQ,GMRCRQT
"RTN","GMRCEDIT",60,0)
 K GMRCFLD,GMRCOUNT,GMRCRSUB,GMRCSS,GMRCURG,GMRCDA,GMRCDAP,GMRCDA1,ND,TRKDA,XQAKILL
"RTN","GMRCEDIT",61,0)
 Q
"RTN","GMRCEDIT",62,0)
 ;
"RTN","GMRCEDIT",63,0)
EXPND ; -- expand code
"RTN","GMRCEDIT",64,0)
 Q
"RTN","GMRCEDIT",65,0)
 ;
"RTN","GMRCGUIB")
0^9^B30571932
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR - GUI actions for consults ; 11/25/2000
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",22,0)
 D ^DIE
"RTN","GMRCGUIB",23,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",24,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",25,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",26,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",27,0)
 Q
"RTN","GMRCGUIB",28,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult record
"RTN","GMRCGUIB",29,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",30,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",31,0)
 ; GMRCADUZ= array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",32,0)
 ; GMRCWHO= IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",33,0)
 ; GMRCWHN= date time of activity in FM format
"RTN","GMRCGUIB",34,0)
 ;
"RTN","GMRCGUIB",35,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",36,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",37,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",38,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",39,0)
 Q:'$D(GMRCADUZ)
"RTN","GMRCGUIB",40,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",41,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",42,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",43,0)
 ;
"RTN","GMRCGUIB",44,0)
 ; Patch 18 changed MSG 27 to 63 "Consult/request update"
"RTN","GMRCGUIB",45,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",46,0)
 Q
"RTN","GMRCGUIB",47,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",48,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",49,0)
 ;Input variables:
"RTN","GMRCGUIB",50,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",51,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",52,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",53,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",54,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",55,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",56,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",57,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",58,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",59,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",60,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",61,0)
 ;
"RTN","GMRCGUIB",62,0)
 ;Output:
"RTN","GMRCGUIB",63,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIB",64,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",65,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",66,0)
 ;
"RTN","GMRCGUIB",67,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",68,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",69,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",70,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",71,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",72,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",73,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",74,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",75,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",76,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",77,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",78,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",79,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",80,0)
 .Q
"RTN","GMRCGUIB",81,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",82,0)
 .N I
"RTN","GMRCGUIB",83,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",84,0)
 .Q
"RTN","GMRCGUIB",85,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",86,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",87,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",88,0)
 .Q
"RTN","GMRCGUIB",89,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",90,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",91,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",92,0)
 .N DA
"RTN","GMRCGUIB",93,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",94,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",95,0)
 .Q
"RTN","GMRCGUIB",96,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",97,0)
 ;
"RTN","GMRCGUIB",98,0)
 ; Patch #18 changed GMRCA=20:27 TO 20:63
"RTN","GMRCGUIB",99,0)
 I +$G(GMRCALF) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",100,0)
 I $S(GMRCA=10:1,1:0) D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",101,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",102,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",103,0)
 ;
"RTN","GMRCGUIB",104,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",105,0)
 ; Input variables:
"RTN","GMRCGUIB",106,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",107,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",108,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",109,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",110,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",111,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",112,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",113,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",114,0)
 ;
"RTN","GMRCGUIB",115,0)
 ;Output:
"RTN","GMRCGUIB",116,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",117,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",118,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",119,0)
        ;
"RTN","GMRCGUIB",120,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",121,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",122,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",123,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",124,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",125,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",126,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",127,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",128,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",129,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",130,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",131,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",132,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",133,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",134,0)
 I $D(GMRCADUZ),$O(GMRCMT(0)) D
"RTN","GMRCGUIB",135,0)
 . N TXT S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",136,0)
 . ; Patch 18 changed alert 27 to 63 "Consult/request update"
"RTN","GMRCGUIB",137,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",138,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",139,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",140,0)
DOCLIST(GMRCAR,GMRCDA)  ;return list of linked TIU documents
"RTN","GMRCGUIB",141,0)
 ; Input:
"RTN","GMRCGUIB",142,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",143,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",144,0)
 ;
"RTN","GMRCGUIB",145,0)
 ; Output:
"RTN","GMRCGUIB",146,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",147,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",148,0)
 ;       GMRCAR(50,1)="ien;TIU(8925,"
"RTN","GMRCGUIB",149,0)
 ;       GMRCAR(50,2)="ien;TIU(8925,"
"RTN","GMRCGUIB",150,0)
 ;
"RTN","GMRCGUIB",151,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",152,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",153,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",154,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",155,0)
 . Q:RES'["TIU(8925"
"RTN","GMRCGUIB",156,0)
 . S GMRCAR(50,CNT)=RES,CNT=CNT+1
"RTN","GMRCGUIB",157,0)
 Q
"RTN","GMRCSLM2")
0^12^B40765812
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM - List Manager routine - Detailed consult display and printing ; 11/25/2000
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,18**;DEC 27,1997
"RTN","GMRCSLM2",3,0)
 ; Patch 18 chg the Eligibility to use VAEL(1) instead of VAEL(6)
"RTN","GMRCSLM2",4,0)
 ; Patch 18 newed GMRCOITM.
"RTN","GMRCSLM2",5,0)
 ; This routine invokes IA #616,872,875,10040,10060,10061
"RTN","GMRCSLM2",6,0)
DT(GMRCO) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",7,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",8,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",9,0)
 ;;Pass in variable GMRCOER=2 if calling from the GUI, GMRCOER=1 if call is from CPRS consults tab
"RTN","GMRCSLM2",10,0)
 ;;Pass in variable GMRCOER=0 (or as <UNDEFINED>) if call is from consults routines
"RTN","GMRCSLM2",11,0)
 K GMRCQUT
"RTN","GMRCSLM2",12,0)
 N DFN,GMRCD,GMRCDA,ORIFN,GMRCSF
"RTN","GMRCSLM2",13,0)
 S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",14,0)
 I $S('GMRCO:1,'$D(^GMR(123,+GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",15,0)
 .S GMRCMSG="The consult entry selected for the Detailed Display is unknown." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",16,0)
 .Q
"RTN","GMRCSLM2",17,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",18,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",19,0)
 S X="SDUTL3" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",20,0)
 .N PR S PR=$$OUTPTPR^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Provider:   "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",21,0)
 .S PR=$$OUTPTTM^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Team:       "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",22,0)
 .Q
"RTN","GMRCSLM2",23,0)
 N VAIN,VAEL
"RTN","GMRCSLM2",24,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Pat. Status:   "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 I $D(VAIN(4)),$L($P(VAIN(4),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",26,0)
 D ELIG^VADPT
"RTN","GMRCSLM2",27,0)
 I $L($P(VAEL(1),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Primary Eligibility:"_$E(TAB,1,3)_$P(VAEL(1),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",28,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",29,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Order Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",31,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Attention:"_$E(TAB,1,13)_$P($G(^VA(200,$P(GMRCO(0),"^",11),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",33,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Requesting Provider: "_$E(TAB,1,2)_$S($P(GMRCO(0),"^",14)]"":$P($G(^VA(200,$P(GMRCO(0),"^",14),0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",34,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",35,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",36,0)
 .Q
"RTN","GMRCSLM2",37,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,17)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",38,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,15)_$S($L($P(GMRCO(0),"^",9)):$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",39,0)
 S X="ORX8" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",40,0)
 .N GMRCOITM S GMRCOITM=$$OI^ORX8(ORIFN)
"RTN","GMRCSLM2",41,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Orderable Item:"_$E(TAB,1,8)_$P(GMRCOITM,U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",42,0)
 .Q
"RTN","GMRCSLM2",43,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^ORD(101,+GMRCPRNM,0)),"^",2),1:"Consult Request")
"RTN","GMRCSLM2",44,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",45,0)
 .S GMRCTYPE=$S(+$P(GMRCO(0),"^",17):$P(^ORD(101,+$P(GMRCO(0),"^",17),0),"^"),1:"")
"RTN","GMRCSLM2",46,0)
 .S GMRCTYPE=$S(GMRCTYPE="GMRCOR REQUEST":"Procedure",1:"Request Type")
"RTN","GMRCSLM2",47,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",48,0)
 .Q
"RTN","GMRCSLM2",49,0)
 S GMRCD=$G(^GMR(123,+GMRCO,30)) I $L(GMRCD) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",50,0)
 I $D(^GMR(123,+GMRCO,20,0)) D
"RTN","GMRCSLM2",51,0)
 .I $O(^GMR(123,+GMRCO,20,1)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Reason For Request:",GMRCCT=GMRCCT+1 D  Q
"RTN","GMRCSLM2",52,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,20,LN)) Q:LN=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^(LN,0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",53,0)
 ..Q
"RTN","GMRCSLM2",54,0)
 .S FLG=1,LINE="Reason For Request:"_$E(TAB,1,4) D WPSET^GMRCUTIL("^GMR(123,+GMRCO,20)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM2",55,0)
 .Q
"RTN","GMRCSLM2",56,0)
 S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",57,0)
 ;get status, last action, and significant findings
"RTN","GMRCSLM2",58,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",59,0)
 S GMRCA=$P(^GMR(123,+GMRCO,0),"^",13),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Last Action:"_$E(TAB,1,11)_$S(+GMRCA:$P($G(^GMR(123.1,GMRCA,0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",60,0)
 I $L($P(GMRCO(0),"^",19)) D
"RTN","GMRCSLM2",61,0)
 .S GMRCSF=$P(GMRCO(0),"^",19)
"RTN","GMRCSLM2",62,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings:  "_$S(GMRCSF="Y":"YES",GMRCSF="N":"NO",1:"Unknown")
"RTN","GMRCSLM2",63,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",64,0)
 .Q
"RTN","GMRCSLM2",65,0)
 D ACTLOG^GMRCSLM4(+GMRCO)
"RTN","GMRCSLM2",66,0)
 D GETRSLTS^GMRCTIUP(GMRCO,.GMRCAR) ;GMRCAR=Array results from TIU and Medicine Package is returned in
"RTN","GMRCSLM2",67,0)
 I $O(GMRCAR(0)) S GMRCND=0 F  S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  D
"RTN","GMRCSLM2",68,0)
 .I $E($P(GMRCND,";",2),1,4)="MCAR" S GMRCSR=GMRCND D  Q
"RTN","GMRCSLM2",69,0)
 ..S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8)
"RTN","GMRCSLM2",70,0)
 ..D EN^GMRCSLM3(+GMRCO,GMRCSR,.GMRCCT)
"RTN","GMRCSLM2",71,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",72,0)
 ..Q
"RTN","GMRCSLM2",73,0)
 .I $E($P(GMRCND,";",2),1,3)="TIU" S DR=".01;.05;.09;1201;1202;1204;1208;1302;1501",GMRCTUFN=$P(GMRCND,";",1) D
"RTN","GMRCSLM2",74,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",75,0)
 ..D EXTRACT^TIULQ(GMRCTUFN,"LOCAL",.GMRCERR,DR)
"RTN","GMRCSLM2",76,0)
 ..I '$O(LOCAL("")) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="No TIU results exist for Note # "_GMRCTUFN_".",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="The Note has been DELETED from TIU!!",GMRCCT=GMRCCT+1 Q
"RTN","GMRCSLM2",77,0)
 ..; I '$L($G(LOCAL(GMRCTUFN,1501,"E"))) D TIU^GMRCSLMU(GMRCTUFN,.GMRCCT,.LOCAL) K LOCAL Q
"RTN","GMRCSLM2",78,0)
 ..K GMRCCNM
"RTN","GMRCSLM2",79,0)
 ..S GMRCTUFN=$P(GMRCND,";",1)
"RTN","GMRCSLM2",80,0)
 ..S:$L(LOCAL(GMRCTUFN,.01,"E")) GMRCCNM=LOCAL(GMRCTUFN,.01,"E"),^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80-$L(GMRCCNM)\2)="",^(0)=^(0)_" "_GMRCCNM_" "_^(0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",81,0)
 ..K LOCAL
"RTN","GMRCSLM2",82,0)
 ..D DSPLAY^GMRCTIU(GMRCTUFN,.GMRCCT)
"RTN","GMRCSLM2",83,0)
 ..S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",84,0)
 ..K DR
"RTN","GMRCSLM2",85,0)
 ..Q
"RTN","GMRCSLM2",86,0)
 .Q
"RTN","GMRCSLM2",87,0)
 I $S('$D(GMRCOER):1,'GMRCOER:1,1:0),$D(VALMAR) D CLEAN^VALM10
"RTN","GMRCSLM2",88,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",89,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRC(0),GMRC(40),GMRCD,GMRCDVDL,GMRCO,GMRCAR,GMRCRB,GMRCLA,GMRCSR,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",90,0)
 I $D(GMRCOER),'GMRCOER D:$D(VALMEVL) KILL^VALM10() D:$D(VALMAR) CLEAN^VALM10
"RTN","GMRCSLM2",91,0)
 Q
"RTN","GMRCSLMA")
0^4^B13426803
"RTN","GMRCSLMA",1,0)
GMRCSLMA ;SLC/DLT - List Manager protocol entry, exit actions ; 11/25/2000
"RTN","GMRCSLMA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,18**;DEC 27, 1997
"RTN","GMRCSLMA",3,0)
 ; This routine invokes IA #875,#2638
"RTN","GMRCSLMA",4,0)
 ;Variables used in entry and exit actions
"RTN","GMRCSLMA",5,0)
 ; GMRCALFL is 1 flags the action is executing from an alert
"RTN","GMRCSLMA",6,0)
 ;        set logic is GMRCALFL=$S($D(XQAID)&($D(XQADATA):1,1:0)
"RTN","GMRCSLMA",7,0)
 ; VALMBCK="R" to refresh screen
"RTN","GMRCSLMA",8,0)
 ;        =NULL to clear bottom portion of screen and prompt for action
"RTN","GMRCSLMA",9,0)
 ;        =Q to exit List manager
"RTN","GMRCSLMA",10,0)
 ; GMRC("NMBR") = the currently highlighed entry in the list
"RTN","GMRCSLMA",11,0)
 ; BLK=
"RTN","GMRCSLMA",12,0)
 ; LNCT= Set to 1 if the GMRCALFL flag is 1
"RTN","GMRCSLMA",13,0)
 ; GMRCQUT= if defined than exit list manager?
"RTN","GMRCSLMA",14,0)
 ; GMRCEN = defined if branched to date range prompt by EN^GMRCSLM
"RTN","GMRCSLMA",15,0)
 ; GMRCOER= used to indicate whether CPRS or consults initiated action
"RTN","GMRCSLMA",16,0)
 ;         0 for Consults List Manager
"RTN","GMRCSLMA",17,0)
 ;         1 for GUI
"RTN","GMRCSLMA",18,0)
 ;         2 for CPRS Consults tab to Detailed Display
"RTN","GMRCSLMA",19,0)
 ; ^TMP("GMRC",$J,"CURRENT","MENU"))= the action menu for user
"RTN","GMRCSLMA",20,0)
 ;        based on the service by EN^GMRCMENU
"RTN","GMRCSLMA",21,0)
 ;Entry points called:
"RTN","GMRCSLMA",22,0)
 ;  AD^GMRCSLM1  ;Loop through AD cross-reference doing SET
"RTN","GMRCSLMA",23,0)
 ;  SET^GMRCSLM1 ;Format entries into ^TMP("GMRCR",$J,"CS"
"RTN","GMRCSLMA",24,0)
 ;  INIT^GMRCSLM ;Initialize variables and list array
"RTN","GMRCSLMA",25,0)
 ;  END^GMRCSLM1 ;Resets BLK and LNCT and kills variables
"RTN","GMRCSLMA",26,0)
 ;  HDR^GMRCSLM  ;Reset the VALMHDR values
"RTN","GMRCSLMA",27,0)
 ;  AGAIN^GMRCSLMV(GMRC("NMBR")) ;Reset the video attribute only, do not redisplay
"RTN","GMRCSLMA",28,0)
 ;  RESET^GMRCSLMV(GMRC("NMBR")) ;turn reverse video off when another item is selected
"RTN","GMRCSLMA",29,0)
 ;
"RTN","GMRCSLMA",30,0)
ENTRY(TYPE) ; -- Entry action for list manager actions
"RTN","GMRCSLMA",31,0)
 ;Actions: RT,DT
"RTN","GMRCSLMA",32,0)
 ;TYPE="" when the list and header have no change
"RTN","GMRCSLMA",33,0)
 ;TYPE["L"
"RTN","GMRCSLMA",34,0)
 ;    Assumes Rebuild the list due to change in the list information
"RTN","GMRCSLMA",35,0)
 ;    Use for GMRCACT CANCEL REQUEST, GMRCACT DISCONTINUE
"RTN","GMRCSLMA",36,0)
 ;            GMRCACT COMPLETE,GMRCACT EDIT/RESUBMIT
"RTN","GMRCSLMA",37,0)
 ;TYPE["H"
"RTN","GMRCSLMA",38,0)
 ;    Assumes need to rebuild the header too due to change in the list
"RTN","GMRCSLMA",39,0)
 ;        manager used while processing the action
"RTN","GMRCSLMA",40,0)
 ;    Use for GMRCACT COMPLETE, DD, RT, since it goes to TIU
"RTN","GMRCSLMA",41,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",42,0)
 ;Q:$D(GMRCQUT)
"RTN","GMRCSLMA",43,0)
 ;
"RTN","GMRCSLMA",44,0)
 I $D(GMRCALFL) D  Q  ;Processing from an alert, quit
"RTN","GMRCSLMA",45,0)
 . K ^TMP("GMRCR",$J,"CS"),GMRCDA
"RTN","GMRCSLMA",46,0)
 . S BLK=0,LNCT=1
"RTN","GMRCSLMA",47,0)
 . S VALMBCK="R"
"RTN","GMRCSLMA",48,0)
 . D SET^GMRCSLM1
"RTN","GMRCSLMA",49,0)
 . D INIT^GMRCSLM
"RTN","GMRCSLMA",50,0)
 . ;D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",51,0)
 . Q
"RTN","GMRCSLMA",52,0)
 ;
"RTN","GMRCSLMA",53,0)
 ;Processing from Consults action
"RTN","GMRCSLMA",54,0)
 I $G(TYPE)["L" D AD^GMRCSLM1,INIT^GMRCSLM S VALMBG=1
"RTN","GMRCSLMA",55,0)
 I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",56,0)
 Q
"RTN","GMRCSLMA",57,0)
 ;alert logic not flushed out
"RTN","GMRCSLMA",58,0)
 ;. I $G(TYPE)["L" D
"RTN","GMRCSLMA",59,0)
 ;. . ; rebuild the list
"RTN","GMRCSLMA",60,0)
 ;. . K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCSLMA",61,0)
 ;. . D SET^GMRCSLM1
"RTN","GMRCSLMA",62,0)
 ;. . D INIT^GMRCSLM
"RTN","GMRCSLMA",63,0)
 ;. I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",64,0)
 ;. I $G(TYPE)["L" D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",65,0)
 ;. Q
"RTN","GMRCSLMA",66,0)
 ;
"RTN","GMRCSLMA",67,0)
EXIT(LINE) ; -- Exit action for list manager to refresh screen and reset the menu
"RTN","GMRCSLMA",68,0)
 ;Actions using this: RT,DT
"RTN","GMRCSLMA",69,0)
 ;LINE contains "A" Re-highlight line on list
"RTN","GMRCSLMA",70,0)
 ;LINE contains "R" Remove highlight on list
"RTN","GMRCSLMA",71,0)
 ;Used by GMRCACT CANCEL REQUEST,GMRCACT COMMENT ORDERS,
"RTN","GMRCSLMA",72,0)
 ;        GMRCACT EDIT/RESUBMIT
"RTN","GMRCSLMA",73,0)
 I "A"[LINE,$D(GMRC("NMBR")) D AGAIN^GMRCSLMV(GMRC("NMBR")) ;DD entry and RD exit action
"RTN","GMRCSLMA",74,0)
 I "R"[LINE,$D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",75,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",76,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",77,0)
 S VALMBG=1
"RTN","GMRCSLMA",78,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",79,0)
 Q
"RTN","GMRCSLMA",80,0)
 ;
"RTN","GMRCSLMA",81,0)
PHDR ; -- protocol header code called from the protocol action menus
"RTN","GMRCSLMA",82,0)
 ;S VALMSG=$$MSG
"RTN","GMRCSLMA",83,0)
 D SHOW^VALM
"RTN","GMRCSLMA",84,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT
"RTN","GMRCSLMA",85,0)
 S XQORM("A")="Select: "
"RTN","GMRCSLMA",86,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",87,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",88,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",89,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",90,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",91,0)
 S XQORM("KEY","PS")=$O(^ORD(101,"B","GMRCACT PRINT CONSULT FORM",0))_"^1"
"RTN","GMRCSLMA",92,0)
 S XQORM("KEY","CM")=$O(^ORD(101,"B","GMRCACT COMMENT ORDERS",0))_"^1"
"RTN","GMRCSLMA",93,0)
 K GMRCNMBR
"RTN","GMRCSLMA",94,0)
 Q
"RTN","GMRCSLMA",95,0)
 ;I '+$G(OVRRIDE),$$VALID^GMRCAU(+$G(GMRCSS)) D  ;set 2.5 mnem's into XQORM("KEY")
"RTN","GMRCSLMA",96,0)
 ;. S XQORM("KEY","AC")="$O(^ORD(101,"B","GMRCACT ADMIN COMPLETE",0)_"^1"
"RTN","GMRCSLMA",97,0)
 ;. S XQORM("KEY","DY")=$O(^ORD(101,"B","GMRCACT CANCEL",0))_"^1"
"RTN","GMRCSLMA",98,0)
 ;. S XQORM("KEY","ED")=$O(^ORD(101,"B","GMRC CHANGE ORDERS",0))_"^1"
"RTN","GMRCSLMA",99,0)
 Q
"RTN","GMRCSLMA",100,0)
MSG() ; -- LMgr message bar
"RTN","GMRCSLMA",101,0)
 Q "Enter the number of the item you wish to act on, or select an action."
"RTN","GMRCSLMA",102,0)
 ;
"RTN","GMRCSLMA",103,0)
MARGIN ; -- Reset bottom margin if menu display off
"RTN","GMRCSLMA",104,0)
 N BM S BM=$S(VALMMENU:17,1:21) Q:BM=VALM("BM")  ; no change
"RTN","GMRCSLMA",105,0)
 S VALM("BM")=BM,VALM("LINES")=VALM("BM")-VALM("TM")+1,VALMBCK="R"
"RTN","GMRCSLMA",106,0)
 Q
"RTN","GMRCSLMA",107,0)
 ;
"RTN","GMRCSLMA",108,0)
SELEXIT ; -- Exit action for list manager when selection criteria changed
"RTN","GMRCSLMA",109,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",110,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",111,0)
 Q:($D(GMRCQUT)!$D(GMRCQUIT))  ;status exit using GMRCQUIT??
"RTN","GMRCSLMA",112,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",113,0)
 D AD^GMRCSLM1
"RTN","GMRCSLMA",114,0)
 D INIT^GMRCSLM ;from select patient, select service
"RTN","GMRCSLMA",115,0)
 D HDR^GMRCSLM  ;from select patient, select date range
"RTN","GMRCSLMA",116,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",117,0)
 Q
"RTN","GMRCSLMA",118,0)
 ;
"RTN","GMRCSTS")
0^13^B37911312
"RTN","GMRCSTS",1,0)
GMRCSTS ;SLC/DLT,JFR,MA - Group update status of consult and order; 11/25/2000
"RTN","GMRCSTS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18**;DEC 27, 1997
"RTN","GMRCSTS",3,0)
 ; Patch 18 - Change UPDCMT to use Editor to add comment and
"RTN","GMRCSTS",4,0)
 ; Added Scheduled consults to selection list.
"RTN","GMRCSTS",5,0)
 N GMRCTO,GMRCDG,GMRCSVC,GMRCSVCN,GMRCEND,GMRCSTRT,GMRCSTOP,GMRCGRP
"RTN","GMRCSTS",6,0)
 N GMRCCVT,GMRCM,GMRCMT,GMRCDO,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",7,0)
 D GETSRV I 'GMRCDG D END Q
"RTN","GMRCSTS",8,0)
 D GETDTR I GMRCEND D END Q
"RTN","GMRCSTS",9,0)
 S GMRCM=$$METHOD I GMRCEND D END Q
"RTN","GMRCSTS",10,0)
 S GMRCCVT=$$UPD1 I GMRCEND D END Q
"RTN","GMRCSTS",11,0)
 D UPDCMT(.GMRCMT)
"RTN","GMRCSTS",12,0)
 D VERIFY I GMRCEND D END Q
"RTN","GMRCSTS",13,0)
 D GETENTS^GMRCSTS1(GMRCSVC,GMRCSTRT,GMRCSTOP,GMRCM)
"RTN","GMRCSTS",14,0)
 S GMRCDO=$$WHATTODO I 'GMRCDO D END Q
"RTN","GMRCSTS",15,0)
 D DEVICE I $G(GMRCEND) D END Q
"RTN","GMRCSTS",16,0)
 I $D(IO("Q")) D QUEUE,^%ZISC,END Q
"RTN","GMRCSTS",17,0)
 D PRINT^GMRCSTS1(GMRCM,GMRCCVT,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO)
"RTN","GMRCSTS",18,0)
 D END Q
"RTN","GMRCSTS",19,0)
GETSRV ;Get a service that the user is authorized to update status for
"RTN","GMRCSTS",20,0)
 D ^GMRCASV Q:'GMRCDG
"RTN","GMRCSTS",21,0)
 S GMRCSVC=+GMRCDG,GMRCSVCN=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCSTS",22,0)
 I $P($G(^GMR(123.5,+GMRCDG,0)),"^",4)=DUZ Q  ;user has special privileges
"RTN","GMRCSTS",23,0)
 ;Check for parent service authorization
"RTN","GMRCSTS",24,0)
 N AUTH,PARENT
"RTN","GMRCSTS",25,0)
 I $P(^GMR(123.5,1,0),U,4)=DUZ Q
"RTN","GMRCSTS",26,0)
 S (AUTH,PARENT)=0 F  S PARENT=$O(^GMR(123.5,"APC",+GMRCDG,PARENT)) Q:'PARENT  S:$P($G(^GMR(123.5,+PARENT,0)),U,4)=DUZ AUTH=PARENT
"RTN","GMRCSTS",27,0)
 I 'AUTH D UNAUTH S GMRCDG=0 G GETSRV
"RTN","GMRCSTS",28,0)
 Q
"RTN","GMRCSTS",29,0)
 ;
"RTN","GMRCSTS",30,0)
UNAUTH ;Unauthorized to do special update processing for service or its parent.
"RTN","GMRCSTS",31,0)
 N GMRCMSG
"RTN","GMRCSTS",32,0)
 W !
"RTN","GMRCSTS",33,0)
 S GMRCMSG="You are not defined as the SPECIAL UPDATES INDIVIDUAL for the"
"RTN","GMRCSTS",34,0)
 S GMRCMSG(1)=GMRCSVCN_" service or its parent service."
"RTN","GMRCSTS",35,0)
 S GMRCDG=0
"RTN","GMRCSTS",36,0)
 D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCSTS",37,0)
 Q
"RTN","GMRCSTS",38,0)
 ;
"RTN","GMRCSTS",39,0)
GETDTR ;Get the date range
"RTN","GMRCSTS",40,0)
 ;END=# of days (T-END) for stop default limitations
"RTN","GMRCSTS",41,0)
 ;GMRCSTRT=Start date/time
"RTN","GMRCSTS",42,0)
 ;GMRCSTOP=Stop date/time
"RTN","GMRCSTS",43,0)
 ;GMRCEND=1 if user timed out or "^"
"RTN","GMRCSTS",44,0)
 S GMRCEND=0
"RTN","GMRCSTS",45,0)
 N X1,X2,X,END
"RTN","GMRCSTS",46,0)
 S X1=$$DT^XLFDT,X2=-30 D C^%DTC S END=X K X
"RTN","GMRCSTS",47,0)
 D START Q:GMRCEND
"RTN","GMRCSTS",48,0)
 D STOP Q:GMRCEND
"RTN","GMRCSTS",49,0)
 Q
"RTN","GMRCSTS",50,0)
 ;
"RTN","GMRCSTS",51,0)
START ;Get the start date
"RTN","GMRCSTS",52,0)
 N DIR,Y,ORDER,FIRST,GMRCIEN
"RTN","GMRCSTS",53,0)
 S ORDER=$O(^GMR(123,"AC",0)),GMRCIEN=$O(^GMR(123,"AC",+ORDER,""))
"RTN","GMRCSTS",54,0)
 I +$G(GMRCIEN) D
"RTN","GMRCSTS",55,0)
 . S Y=$P($G(^GMR(123,GMRCIEN,0)),U,1)
"RTN","GMRCSTS",56,0)
 . X ^DD("DD") S FIRST=$P(Y,"@",1)
"RTN","GMRCSTS",57,0)
 . S DIR("B")=FIRST
"RTN","GMRCSTS",58,0)
 . W !!,"The first order in Consults has an entry date of "_DIR("B"),!
"RTN","GMRCSTS",59,0)
 . Q
"RTN","GMRCSTS",60,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Start Date"
"RTN","GMRCSTS",61,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","GMRCSTS",62,0)
 D ^DIR
"RTN","GMRCSTS",63,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",64,0)
 S GMRCSTRT=Y
"RTN","GMRCSTS",65,0)
 Q
"RTN","GMRCSTS",66,0)
 ;
"RTN","GMRCSTS",67,0)
STOP ;Get the stop date
"RTN","GMRCSTS",68,0)
 N DIR,Y,X
"RTN","GMRCSTS",69,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Stop Date"
"RTN","GMRCSTS",70,0)
 D ^DIR
"RTN","GMRCSTS",71,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",72,0)
 I Y<GMRCSTRT S GMRCSTOP=GMRCSTRT,GMRCSTRT=Y
"RTN","GMRCSTS",73,0)
 E  S GMRCSTOP=Y
"RTN","GMRCSTS",74,0)
 Q
"RTN","GMRCSTS",75,0)
 ;
"RTN","GMRCSTS",76,0)
METHOD() ;Get method to determine which consults to change
"RTN","GMRCSTS",77,0)
 N DIR,Y,X
"RTN","GMRCSTS",78,0)
 ;S DIR(0)="SM^P:Pending;A:Active;S:Scheduled;ALL:For All"
"RTN","GMRCSTS",79,0)
 ;S DIR("A")="Status(es) to search for updating"
"RTN","GMRCSTS",80,0)
 S DIR("A",1)=""
"RTN","GMRCSTS",81,0)
 S DIR("A",2)=""
"RTN","GMRCSTS",82,0)
 S DIR("A",3)="                  1 = Pending"
"RTN","GMRCSTS",83,0)
 S DIR("A",4)="                  2 = Active"
"RTN","GMRCSTS",84,0)
 S DIR("A",5)="                  3 = Scheduled"
"RTN","GMRCSTS",85,0)
 S DIR("A",6)="                  4 = All"
"RTN","GMRCSTS",86,0)
 S DIR("A",7)=""
"RTN","GMRCSTS",87,0)
 S DIR("A",8)="    Enter any combination of numbers separated"
"RTN","GMRCSTS",88,0)
 S DIR("A")="    by a comma or hyphen"
"RTN","GMRCSTS",89,0)
 S DIR(0)="LO^1:4"
"RTN","GMRCSTS",90,0)
 D ^DIR
"RTN","GMRCSTS",91,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1
"RTN","GMRCSTS",92,0)
 Q Y
"RTN","GMRCSTS",93,0)
 S DIR(0)="SM^S:Order Status of Pending or Active;R:Result Activity"
"RTN","GMRCSTS",94,0)
 S DIR("A")="Method to find Consults to Update"
"RTN","GMRCSTS",95,0)
 D ^DIR
"RTN","GMRCSTS",96,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",97,0)
 Q Y
"RTN","GMRCSTS",98,0)
 ;
"RTN","GMRCSTS",99,0)
VERIFY ;Verify the criteria is correct
"RTN","GMRCSTS",100,0)
 W !
"RTN","GMRCSTS",101,0)
 D UPDCRIT^GMRCSTS1(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS",102,0)
 N DIR
"RTN","GMRCSTS",103,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="NO"
"RTN","GMRCSTS",104,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",105,0)
 Q
"RTN","GMRCSTS",106,0)
UPD1() ;Determine update status
"RTN","GMRCSTS",107,0)
 N DIR,X,Y
"RTN","GMRCSTS",108,0)
 W !!,"If orders in the date range still have the selected status, this option"
"RTN","GMRCSTS",109,0)
 W !,"will change their status in consults, and update the order."
"RTN","GMRCSTS",110,0)
 W !!,"You may change the status to COMPLETE or DISCONTINUED."
"RTN","GMRCSTS",111,0)
 W !
"RTN","GMRCSTS",112,0)
 S DIR(0)="SAM^D:Discontinued;C:Complete"
"RTN","GMRCSTS",113,0)
 S DIR("A")="Change their status to: "
"RTN","GMRCSTS",114,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",115,0)
 Q $S(Y="D":"1^DC",1:"2^C")
"RTN","GMRCSTS",116,0)
 ;
"RTN","GMRCSTS",117,0)
DEVICE ; device for printout of entries to group update
"RTN","GMRCSTS",118,0)
 N %ZIS,POP
"RTN","GMRCSTS",119,0)
 W !!,"The device selected will print a list of entries from file 123 that will be"
"RTN","GMRCSTS",120,0)
 W !,"updated to ",$S(+GMRCCVT=1:"DISCONTINUED",1:"COMPLETE"),"."
"RTN","GMRCSTS",121,0)
 W !!,"If you choose to update records, the update of the consult entries will take"
"RTN","GMRCSTS",122,0)
 W !,"place upon completion of the report."
"RTN","GMRCSTS",123,0)
 W !!,"It is highly advised that a printer be selected!"
"RTN","GMRCSTS",124,0)
RETRY S %ZIS="QM",%ZIS("A")="Select device for report: ",%ZIS("B")=""
"RTN","GMRCSTS",125,0)
 D ^%ZIS I POP S GMRCEND=1 Q
"RTN","GMRCSTS",126,0)
 I $E(IOST,1,2)="C-" D  G:Y<1 RETRY
"RTN","GMRCSTS",127,0)
 . W !!,$C(7),"You have not chosen a printer!  If you do not choose a printer there will",!,"be no record of the entries that were updated."
"RTN","GMRCSTS",128,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",129,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to use this device"
"RTN","GMRCSTS",130,0)
 . S DIR("B")="NO" D ^DIR I $D(DIRUT) S GMRCEND=1
"RTN","GMRCSTS",131,0)
 Q
"RTN","GMRCSTS",132,0)
QUEUE ; send task for print and update
"RTN","GMRCSTS",133,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK
"RTN","GMRCSTS",134,0)
 S ZTRTN="PRTTSK^GMRCSTS1",ZTDESC="UPDATE OF RECORDS FILE 123"
"RTN","GMRCSTS",135,0)
 S ZTIO=ION
"RTN","GMRCSTS",136,0)
 S ZTSAVE("^TMP(""GMRCLS"",$J,")="",ZTSAVE("GMRC*")=""
"RTN","GMRCSTS",137,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task # ",ZTSK
"RTN","GMRCSTS",138,0)
 I '$G(ZTSK) W !,"Unable to queue report!  Try again later."
"RTN","GMRCSTS",139,0)
 Q
"RTN","GMRCSTS",140,0)
UPDCMT(COMMENT) ; get comment to stuff in consult activity
"RTN","GMRCSTS",141,0)
 W !
"RTN","GMRCSTS",142,0)
 N DWPK,DWLW,DIC,DIWEPSE,INDEX
"RTN","GMRCSTS",143,0)
 W !,"Enter the Comment to be applied to all selected Consults"
"RTN","GMRCSTS",144,0)
 S DIC="^TMP(""GMRCTMP"","_$J_",1,",DWLW=80,DWPK=1,DIWEPSE=1
"RTN","GMRCSTS",145,0)
 D EN^DIWE
"RTN","GMRCSTS",146,0)
 S INDEX=0
"RTN","GMRCSTS",147,0)
 F   S INDEX=$O(^TMP("GMRCTMP",$J,1,INDEX))  Q:'INDEX  D
"RTN","GMRCSTS",148,0)
 . S COMMENT(INDEX,0)=^TMP("GMRCTMP",$J,1,INDEX,0)
"RTN","GMRCSTS",149,0)
 K ^TMP("GMRCTMP",$J)
"RTN","GMRCSTS",150,0)
 Q
"RTN","GMRCSTS",151,0)
WHATTODO() ;how to handle the update
"RTN","GMRCSTS",152,0)
 N DIR
"RTN","GMRCSTS",153,0)
 S DIR(0)="SO^1:Print report only;2:Print report & update records;3:Quit"
"RTN","GMRCSTS",154,0)
 S DIR("A")="Choose the method to handle the report"
"RTN","GMRCSTS",155,0)
 D ^DIR I $D(DIRUT)!(Y=3) Q 0
"RTN","GMRCSTS",156,0)
 Q +Y
"RTN","GMRCSTS",157,0)
END K ^TMP("GMRCLS",$J) Q
"RTN","GMRCSTS1")
0^14^B28140651
"RTN","GMRCSTS1",1,0)
GMRCSTS1 ;SLC/JFR,MA - GROUP UPDATE OF CONSULTS cont'd ; 11/25/2000
"RTN","GMRCSTS1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18**;DEC 27, 1997
"RTN","GMRCSTS1",3,0)
 ; Patch 18 modified PRTTSK to stop for acknowledgement between
"RTN","GMRCSTS1",4,0)
 ; printing the report and continuing with the group update.
"RTN","GMRCSTS1",5,0)
PROCESS(GMRCCVT,GMRCMT) ;Update consult status by service and date range
"RTN","GMRCSTS1",6,0)
 N GMRCO,GMRCSTS,GMRCTRLC,GMRCORNP,GMRCDEV,GMRCFF,GMRCAD,ORIFN
"RTN","GMRCSTS1",7,0)
 N GMRCOM1,ORIFN
"RTN","GMRCSTS1",8,0)
 Q:'GMRCCVT
"RTN","GMRCSTS1",9,0)
 I '$D(^TMP("GMRCLS",$J)) Q  ;no entries to update
"RTN","GMRCSTS1",10,0)
 S GMRCIEN=0 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCSTS1",11,0)
 . Q:'$L($G(^GMR(123,GMRCIEN,0)))
"RTN","GMRCSTS1",12,0)
 . D AUDIT(GMRCIEN,+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",13,0)
 . D STSUPD(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",14,0)
 . D CPRSUPDT(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",15,0)
 Q
"RTN","GMRCSTS1",16,0)
PRINT(GMRCM,GMRCCVT,GMRCSVC,GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO) ;untasked print of records to update
"RTN","GMRCSTS1",17,0)
PRTTSK ; print the report then start the processing
"RTN","GMRCSTS1",18,0)
 ; GMRCM= status of records to find A:active, P:pending, B:Both
"RTN","GMRCSTS1",19,0)
 ; GMRCCVT= status to update records with  1:dc,  2:complete
"RTN","GMRCSTS1",20,0)
 ; GMRCSVC= IEN from file 123.5
"RTN","GMRCSTS1",21,0)
 ; GMRCMT= array (passed by reference) of comment to stuff in records
"RTN","GMRCSTS1",22,0)
 ; GMRCSTRT= first entry date to find/update
"RTN","GMRCSTS1",23,0)
 ; GMRCSTOP= last entry date to find/update
"RTN","GMRCSTS1",24,0)
 ; GMRCDO= 1:print only, 2:print and update records
"RTN","GMRCSTS1",25,0)
 ; GMRCSTAT= Status of consult for the report (P,A,S)
"RTN","GMRCSTS1",26,0)
 N GMRCIEN,GMRCDFN,GMRCPG,GMRCEND,GMRCSTAT
"RTN","GMRCSTS1",27,0)
 S GMRCIEN=0
"RTN","GMRCSTS1",28,0)
 U IO
"RTN","GMRCSTS1",29,0)
 D HDR(1) S GMRCPG=2
"RTN","GMRCSTS1",30,0)
 I '$D(^TMP("GMRCLS",$J)) D  D END
"RTN","GMRCSTS1",31,0)
 . W !,"No records found meeting search criteria"
"RTN","GMRCSTS1",32,0)
 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN!($G(GMRCEND))  D
"RTN","GMRCSTS1",33,0)
 . I $Y>(IOSL-5) D HDR(GMRCPG) Q:$G(GMRCEND)  S GMRCPG=GMRCPG+1
"RTN","GMRCSTS1",34,0)
 . Q:'$G(^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",35,0)
 . I $P(^GMR(123,GMRCIEN,0),U,12)=1!($P(^(0),U,12)=2) Q
"RTN","GMRCSTS1",36,0)
 . W !,GMRCIEN,?8,$$FMTE^XLFDT(+^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",37,0)
 . W ?29,$E($$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.01),1,26)
"RTN","GMRCSTS1",38,0)
 . W ?56,$$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.09)
"RTN","GMRCSTS1",39,0)
 . S GMRCSTAT=+^TMP("GMRCLS",$J,GMRCIEN)
"RTN","GMRCSTS1",40,0)
 . W ?70,$S(GMRCSTAT=5:"p",GMRCSTAT=6:"a",GMRCSTAT=8:"s",1:"?")
"RTN","GMRCSTS1",41,0)
 . W " to ",$S(+GMRCCVT=1:"dc",1:"c")
"RTN","GMRCSTS1",42,0)
 I GMRCDO=2,'$D(ZTQUEUED) D  ; Not task
"RTN","GMRCSTS1",43,0)
 . S DIR(0)="S^Y:To Update;N:To Quit without Updating"
"RTN","GMRCSTS1",44,0)
 . S DIR("A")="Enter update status "
"RTN","GMRCSTS1",45,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) Q
"RTN","GMRCSTS1",46,0)
 . D ^DIR
"RTN","GMRCSTS1",47,0)
 . I Y="Y" D PROCESS(+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",48,0)
 I GMRCDO=2,$D(ZTQUEUED) D PROCESS(+GMRCCVT,.GMRCMT) ; Tasked
"RTN","GMRCSTS1",49,0)
END D ^%ZISC K ^TMP("GMRCLS",$J)
"RTN","GMRCSTS1",50,0)
 Q
"RTN","GMRCSTS1",51,0)
 ;
"RTN","GMRCSTS1",52,0)
HDR(PAGE) ; print the header for the report
"RTN","GMRCSTS1",53,0)
 I PAGE'=1,$E(IOST,1,2)["C-" N Y D  I '+Y S GMRCEND=1 Q
"RTN","GMRCSTS1",54,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTS1",55,0)
 W @IOF
"RTN","GMRCSTS1",56,0)
 W !,"Group status update of consults in file 123",?70,"Page: ",PAGE W:PAGE'=1 !
"RTN","GMRCSTS1",57,0)
 I PAGE=1 W !,?49,"Printed: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCSTS1",58,0)
 I PAGE=1 D UPDCRIT(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS1",59,0)
 W !,"Consult",?70,"Status"
"RTN","GMRCSTS1",60,0)
 W !,"Number    Requested          Patient                    SSN           Change"
"RTN","GMRCSTS1",61,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMRCSTS1",62,0)
 Q
"RTN","GMRCSTS1",63,0)
GETENTS(SERV,STRDT,STPDT,SRCH)  ;loop "AE" x-ref and dump into ^TMP
"RTN","GMRCSTS1",64,0)
 N IDT,IEN,STOPI,STRTI,STS,INDEX
"RTN","GMRCSTS1",65,0)
 W !!,"Searching database for entries matching search criteria",!
"RTN","GMRCSTS1",66,0)
 S STOPI=(9999999-STPDT)-1,STRTI=(9999999-STRDT)
"RTN","GMRCSTS1",67,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",68,0)
 . I $P(SRCH,",",INDEX)=+4 S SRCH="1,2,3,"
"RTN","GMRCSTS1",69,0)
 ; Convert SRCH from 1,2,3 to 5,6,8 (pending,active,scheduled)
"RTN","GMRCSTS1",70,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",71,0)
 . I $P(SRCH,",",INDEX)=+1 S STS=+5 D GETDATA
"RTN","GMRCSTS1",72,0)
 . I $P(SRCH,",",INDEX)=+2 S STS=+6 D GETDATA
"RTN","GMRCSTS1",73,0)
 . I $P(SRCH,",",INDEX)=+3 S STS=+8 D GETDATA
"RTN","GMRCSTS1",74,0)
GETDATA ; Write ^GMR(123,IEN,0) to TMP
"RTN","GMRCSTS1",75,0)
 S IDT=STOPI
"RTN","GMRCSTS1",76,0)
 F  S IDT=$O(^GMR(123,"AE",SERV,+STS,IDT)) Q:'IDT!(IDT>STRTI)  D
"RTN","GMRCSTS1",77,0)
 . S IEN=0 F  S IEN=$O(^GMR(123,"AE",SERV,+STS,IDT,IEN)) Q:'IEN  D
"RTN","GMRCSTS1",78,0)
 .. S ^TMP("GMRCLS",$J,IEN)=+STS_U_+^GMR(123,IEN,0)
"RTN","GMRCSTS1",79,0)
 .. W "."
"RTN","GMRCSTS1",80,0)
 Q
"RTN","GMRCSTS1",81,0)
AUDIT(GMRCO,UPDSTS,GMRCOM) ;Update the processing activity of the consult
"RTN","GMRCSTS1",82,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",83,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",84,0)
 N DA,DIE,GMRCA,GMRCDT,GMRCSTS
"RTN","GMRCSTS1",85,0)
 S GMRCDT=$$NOW^XLFDT,GMRCA=$S(UPDSTS=1:6,1:10)
"RTN","GMRCSTS1",86,0)
 S GMRCSTS=$P(^GMR(123,GMRCO,0),U,12)
"RTN","GMRCSTS1",87,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCSTS1",88,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCSTS1",89,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCSTS1",90,0)
 S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCDT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCSTS1",91,0)
 D ^DIE
"RTN","GMRCSTS1",92,0)
 S ^GMR(123,+GMRCO,40,DA,1,0)="^^1^1^"_GMRCDT_"^"
"RTN","GMRCSTS1",93,0)
 I $D(GMRCOM) D
"RTN","GMRCSTS1",94,0)
 . M ^GMR(123,+GMRCO,40,DA,1)=GMRCOM
"RTN","GMRCSTS1",95,0)
 I '$D(GMRCOM) D
"RTN","GMRCSTS1",96,0)
 . N COMMENT
"RTN","GMRCSTS1",97,0)
 . S COMMENT="Status updated from "
"RTN","GMRCSTS1",98,0)
 . S COMMENT=COMMENT_$P(^ORD(100.01,+GMRCSTS,0),"^",1)
"RTN","GMRCSTS1",99,0)
 . S COMMENT=COMMENT_" to "_$S(+UPDSTS=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",100,0)
 . S COMMENT=COMMENT_" during group status update process."
"RTN","GMRCSTS1",101,0)
 . S ^GMR(123,+GMRCO,40,DA,1,1,0)=COMMENT
"RTN","GMRCSTS1",102,0)
 K DIE,GMRCA,GMRCDT
"RTN","GMRCSTS1",103,0)
 Q
"RTN","GMRCSTS1",104,0)
STSUPD(GMRCO,UPDSTS) ;change status of consult to COMPLETE or DC
"RTN","GMRCSTS1",105,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",106,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",107,0)
 N DIE,DA,DR,X
"RTN","GMRCSTS1",108,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCSTS1",109,0)
 S DR="8////^S X=+UPDSTS"
"RTN","GMRCSTS1",110,0)
 D ^DIE
"RTN","GMRCSTS1",111,0)
 Q
"RTN","GMRCSTS1",112,0)
CPRSUPDT(GMRCO,UPDSTS) ;Update CPRS order with new status
"RTN","GMRCSTS1",113,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",114,0)
 ;UPDSTS= status to update CPRS with
"RTN","GMRCSTS1",115,0)
 N GMRCDFN,CTRLCODE
"RTN","GMRCSTS1",116,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCSTS1",117,0)
 S CTRLCODE=$S(UPDSTS=1:"OD",1:"RE")
"RTN","GMRCSTS1",118,0)
 ; send HL7 message to CPRS to update order status
"RTN","GMRCSTS1",119,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,"","",CTRLCODE,DUZ,"","",1)
"RTN","GMRCSTS1",120,0)
 Q
"RTN","GMRCSTS1",121,0)
UPDCRIT(UPD,STS,SVC,CMT,START,STOP) ;print update criteria on page 1
"RTN","GMRCSTS1",122,0)
 N INDEX,GMRCSTS
"RTN","GMRCSTS1",123,0)
 F INDEX=1:1  Q:$P(STS,",",INDEX)=""  D
"RTN","GMRCSTS1",124,0)
 . I STS[+4 S GMRCSTS="Active, Pending, and Scheduled" Q
"RTN","GMRCSTS1",125,0)
 . I $P(STS,",",INDEX)=+1 S $P(GMRCSTS,",",INDEX)="Pending"
"RTN","GMRCSTS1",126,0)
 . I $P(STS,",",INDEX)=+2 S $P(GMRCSTS,",",INDEX)="Active"
"RTN","GMRCSTS1",127,0)
 . I $P(STS,",",INDEX)=+3 S $P(GMRCSTS,",",INDEX)="Scheduled"
"RTN","GMRCSTS1",128,0)
 W !,"Records will be updated for:"
"RTN","GMRCSTS1",129,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCSTS1",130,0)
 W !,"          Service: "_$$GET1^DIQ(123.5,SVC,.01)
"RTN","GMRCSTS1",131,0)
 W !,"        Beginning: "_$$FMTE^XLFDT(START)
"RTN","GMRCSTS1",132,0)
 W !,"           Ending: "_$$FMTE^XLFDT(STOP)
"RTN","GMRCSTS1",133,0)
 W !,"           Update: "_GMRCSTS_" "_" Consults"
"RTN","GMRCSTS1",134,0)
 W !,"               To: "_$S(+UPD=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",135,0)
 I $D(CMT) W !,"   Update Comment:" D
"RTN","GMRCSTS1",136,0)
 . N I S I=0 F  S I=$O(CMT(I)) Q:'I  D
"RTN","GMRCSTS1",137,0)
 .. W !,CMT(I,0)
"RTN","GMRCSTS1",138,0)
 W !,$$REPEAT^XLFSTR("-",78),!
"RTN","GMRCSTS1",139,0)
 Q
"RTN","GMRCT")
0^11^B22357159
"RTN","GMRCT",1,0)
GMRCT ; SLC/DLT\JFR - Get DUZ's of users for notification to service ; 11/25/2000
"RTN","GMRCT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,11,18**;Dec 27, 1997
"RTN","GMRCT",3,0)
EN(GMRCSRV,USER,TEST) ;Get who is to be notified for alert action
"RTN","GMRCT",4,0)
 ; return them in array GMRCADUZ(DUZ)=""
"RTN","GMRCT",5,0)
 N GMRCLIS,GMRCHKD,GMRCNT,GMRCLP,GMRCQUIT
"RTN","GMRCT",6,0)
 D RECIP(GMRCSRV,$G(TEST)) I $D(TEST),$G(USER),$D(GMRCADUZ(USER)) Q
"RTN","GMRCT",7,0)
 I '$P(^GMR(123.5,+GMRCSRV,0),U,8) Q  ; don't check parents
"RTN","GMRCT",8,0)
 S GMRCHKD(GMRCSRV)="",GMRCNT=1
"RTN","GMRCT",9,0)
 D FINDPAR^GMRCAU(GMRCSRV,.GMRCNT) I '$D(GMRCLIS) Q
"RTN","GMRCT",10,0)
 S GMRCLP=0
"RTN","GMRCT",11,0)
 F  S GMRCLP=$O(GMRCLIS(GMRCLP)) Q:'GMRCLP  D  I $D(GMRCQUIT) Q
"RTN","GMRCT",12,0)
 . I +$P(GMRCLIS(GMRCLP),U,2) K GMRCLIS(GMRCLP) Q  ;been checked
"RTN","GMRCT",13,0)
 . I '$D(GMRCHKD(+GMRCLIS(GMRCLP))) D
"RTN","GMRCT",14,0)
 .. ; check parent 
"RTN","GMRCT",15,0)
 .. D RECIP(+GMRCLIS(GMRCLP),$G(TEST)) I $G(USER),$D(GMRCADUZ(USER)) D  Q
"RTN","GMRCT",16,0)
 ... S GMRCQUIT=1
"RTN","GMRCT",17,0)
 .. S GMRCHKD(+GMRCLIS(GMRCLP))=""
"RTN","GMRCT",18,0)
 . S $P(GMRCLIS(GMRCLP),U,2)=1
"RTN","GMRCT",19,0)
 . I $P(^GMR(123.5,+GMRCLIS(GMRCLP),0),U,8) D  ;check parents, fld .08 =1
"RTN","GMRCT",20,0)
 .. D FINDPAR^GMRCAU(+GMRCLIS(GMRCLP),.GMRCNT)
"RTN","GMRCT",21,0)
 . S GMRCLP=0 ;start back at top and don't miss any
"RTN","GMRCT",22,0)
 Q
"RTN","GMRCT",23,0)
RECIP(GMRCSS,NOTNULL) ;gather recipients for GMRCSS
"RTN","GMRCT",24,0)
 N GMRCTM,GMRCTMI,GMRCLST,GMRCER,GMRCHL,GMRCSSI,GMRCU,GMRCWL
"RTN","GMRCT",25,0)
 I $D(^GMR(123.5,GMRCSS,123)),$P(^GMR(123.5,GMRCSS,123),"^",8) S GMRCADUZ($P(^(123),"^",8))=$S($G(NOTNULL):$$NOTSERV($P(^(123),"^",8)),1:"")
"RTN","GMRCT",26,0)
 I $D(^GMR(123.5,GMRCSS,123.1)) D TEAM
"RTN","GMRCT",27,0)
 I $D(^GMR(123.5,GMRCSS,123.2)),+$G(GMRCO) D LOC
"RTN","GMRCT",28,0)
 I $D(^GMR(123.5,GMRCSS,123.33)) D ADMU
"RTN","GMRCT",29,0)
 I $D(^GMR(123.5,GMRCSS,123.34)) D ADMT
"RTN","GMRCT",30,0)
 Q
"RTN","GMRCT",31,0)
LOC ;Find the patients location and match to location assignments
"RTN","GMRCT",32,0)
 S GMRCWL="",GMRCHL=""
"RTN","GMRCT",33,0)
 I +$G(GMRCO) S GMRCHL=$P(^GMR(123,+GMRCO,0),"^",4) I GMRCHL S GMRCWL=$G(^SC(GMRCHL,42)) S:GMRCWL GMRCWL=GMRCWL_";DIC(42," S GMRCHL=GMRCHL_";SC("
"RTN","GMRCT",34,0)
 E  S:+$G(GMRCWLI) GMRCWL=GMRCWLI_";DIC(42," S:+$G(GMRCHLI) GMRCHL=GMRCHLI_";SC("
"RTN","GMRCT",35,0)
 I +GMRCWL S GMRCSSI=$O(^GMR(123.5,GMRCSS,123.2,"B",GMRCWL,"")) I GMRCSSI D LOC1
"RTN","GMRCT",36,0)
 I +GMRCHL S GMRCSSI=$O(^GMR(123.5,GMRCSS,123.2,"B",GMRCHL,"")) I GMRCSSI D LOC1
"RTN","GMRCT",37,0)
 Q
"RTN","GMRCT",38,0)
LOC1 ;Get user and/or team assigned to location
"RTN","GMRCT",39,0)
 I $P(^GMR(123.5,GMRCSS,123.2,GMRCSSI,0),"^",2) S GMRCADUZ($P(^(0),"^",2))=$S($G(NOTNULL):$$NOTSERV($P(^(0),"^",2)),1:"")
"RTN","GMRCT",40,0)
 I $P(^GMR(123.5,GMRCSS,123.2,GMRCSSI,0),"^",3) S GMRCTMI=$P(^(0),"^",3) D TEAM1
"RTN","GMRCT",41,0)
 Q
"RTN","GMRCT",42,0)
ADMU ;Get notification recips from admin users field (123.33)
"RTN","GMRCT",43,0)
 ;Loop "AC" x-ref to get those admin users marked as notif recipients
"RTN","GMRCT",44,0)
 N RECIP
"RTN","GMRCT",45,0)
 S RECIP=0
"RTN","GMRCT",46,0)
 F  S RECIP=$O(^GMR(123.5,GMRCSS,123.33,"AC",1,RECIP)) Q:'RECIP  D
"RTN","GMRCT",47,0)
 . S GMRCADUZ(RECIP)=$S($G(NOTNULL):$$NOTSERV(RECIP),1:"")
"RTN","GMRCT",48,0)
 Q
"RTN","GMRCT",49,0)
ADMT ;Get notification recips from admin teams field (123.34)
"RTN","GMRCT",50,0)
 ;Loop "AC" x-ref to get those admin teams marked as notif recipients
"RTN","GMRCT",51,0)
 ;call TEAM1 to get list of users and add to recip list
"RTN","GMRCT",52,0)
 N GMRCTMI S GMRCTMI=0
"RTN","GMRCT",53,0)
 F  S GMRCTMI=$O(^GMR(123.5,GMRCSS,123.34,"AC",1,GMRCTMI)) Q:'GMRCTMI  D
"RTN","GMRCT",54,0)
 . D TEAM1
"RTN","GMRCT",55,0)
TEAM ;Loop through Teams to send all users notifications
"RTN","GMRCT",56,0)
 S GMRCTM=0 F  S GMRCTM=$O(^GMR(123.5,GMRCSS,123.1,GMRCTM)) Q:'+GMRCTM  S GMRCTMI=$P($G(^GMR(123.5,GMRCSS,123.1,GMRCTM,0)),"^") I GMRCTMI D TEAM1
"RTN","GMRCT",57,0)
 Q
"RTN","GMRCT",58,0)
TEAM1 ;Get user DUZ's from Team pointed to in File
"RTN","GMRCT",59,0)
 S GMRCLST="" D TEAMPROV^ORQPTQ1(.GMRCLST,GMRCTMI)
"RTN","GMRCT",60,0)
 Q:$S('$O(GMRCLST(0)):1,$P(GMRCLST(1),"^",2)="No providers found.":1,1:0)
"RTN","GMRCT",61,0)
 S GMRCU=0 F  S GMRCU=$O(GMRCLST(GMRCU)) Q:GMRCU=""  D
"RTN","GMRCT",62,0)
 . I '$G(NOTNULL) D  Q
"RTN","GMRCT",63,0)
 .. S GMRCADUZ($P(GMRCLST(GMRCU),"^",1)_U_GMRCTMI)=""
"RTN","GMRCT",64,0)
 . S GMRCADUZ($P(GMRCLST(GMRCU),"^",1))=$S($G(NOTNULL):$$NOTSERV(GMRCU),1:"")
"RTN","GMRCT",65,0)
 K GMRCLST
"RTN","GMRCT",66,0)
 Q
"RTN","GMRCT",67,0)
NOTSERV(RECIP) ;set GMRCADUZ(RECIP)=all services they receive for
"RTN","GMRCT",68,0)
 I '$D(GMRCADUZ(RECIP)) Q $P(^GMR(123.5,+GMRCSS,0),U)
"RTN","GMRCT",69,0)
 Q GMRCADUZ(RECIP)_"~"_$P(^GMR(123.5,+GMRCSS,0),U)
"RTN","GMRCT",70,0)
TEST ; called from GMRC NOTIF RECIPIENTS
"RTN","GMRCT",71,0)
 N GMRCSRV,GMRCUSR,GMRCADUZ
"RTN","GMRCT",72,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","GMRCT",73,0)
 S DIR(0)="PO^123.5:EM",DIR("A")="Select Consult Service"
"RTN","GMRCT",74,0)
 S DIR("?")="Choose the consult service to check update status of user"
"RTN","GMRCT",75,0)
 S DIR("??")="^D TESTHELP^GMRCAU(""ALL SERVICES"")" D ^DIR
"RTN","GMRCT",76,0)
 I $D(DIRUT) Q
"RTN","GMRCT",77,0)
 S GMRCSRV=+Y
"RTN","GMRCT",78,0)
 N DIR
"RTN","GMRCT",79,0)
 S DIR(0)="PO^200:EM",DIR("A")="Choose notification recipient"
"RTN","GMRCT",80,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCT",81,0)
 S GMRCUSR=+Y
"RTN","GMRCT",82,0)
 D EN(GMRCSRV,GMRCUSR,1)
"RTN","GMRCT",83,0)
 I $D(GMRCADUZ(GMRCUSR)) D
"RTN","GMRCT",84,0)
 . W !!,"This user is a notification recipients for "_GMRCADUZ(GMRCUSR),!
"RTN","GMRCT",85,0)
 . I GMRCADUZ(GMRCUSR)'=$P(^GMR(123.5,GMRCSRV,0),U) D
"RTN","GMRCT",86,0)
 .. D HIER(GMRCADUZ(GMRCUSR))
"RTN","GMRCT",87,0)
 . W !!
"RTN","GMRCT",88,0)
 I '$D(GMRCADUZ(GMRCUSR)) W !!,"This user is not a notification recipient.",!!
"RTN","GMRCT",89,0)
 G TEST
"RTN","GMRCT",90,0)
HIER(SERV) ;ask to see the hierarchy
"RTN","GMRCT",91,0)
 N DIR,DIRUT,DUOUT,DTOUT
"RTN","GMRCT",92,0)
 S DIR(0)="Y"
"RTN","GMRCT",93,0)
 S DIR("A")="View hierarchy from this service to the selected service"
"RTN","GMRCT",94,0)
 S DIR("B")="NO"
"RTN","GMRCT",95,0)
 D ^DIR
"RTN","GMRCT",96,0)
 I Y>0 D TESTHELP^GMRCAU(SERV)
"RTN","GMRCT",97,0)
 Q
"RTN","GMRCT",98,0)
TSTINTRO ; entry action for GMRC USER NOTIFICATION
"RTN","GMRCT",99,0)
 W !,"This option will list how a given user became a notification recipient"
"RTN","GMRCT",100,0)
 W !,"for a selected consult service. If the PROCESS PARENTS FOR NOTIFS field is"
"RTN","GMRCT",101,0)
 W !,"set to YES, all the parents of the service will also be processed to"
"RTN","GMRCT",102,0)
 W !,"determine if the user is a recipient via that service.",!!
"RTN","GMRCT",103,0)
 Q
"RTN","GMRCTIU")
0^3^B13550057
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - TIU utilities for exchanging info with Consults ; 11/25/2000
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,18**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
 ; This routine invokes IA #3161
"RTN","GMRCTIU",4,0)
GET(GMRCO,GMRCTUFN,GMRCTUST,GMRCAUTH) ;Receive the IEN of TIU file for a patient from TIU; also receive TIU status update.
"RTN","GMRCTIU",5,0)
 ;GMRCO=IFN from file 123
"RTN","GMRCTIU",6,0)
 ;GMRCTUFN=TIU IFN
"RTN","GMRCTIU",7,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",8,0)
 ;GMRCAUTH=Author of Document
"RTN","GMRCTIU",9,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCAD
"RTN","GMRCTIU",10,0)
 S GMRCA=$S($G(GMRCTUST)["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9)
"RTN","GMRCTIU",11,0)
 I '+$G(GMRCA) S GMRCA=99,GMRCSTS=99
"RTN","GMRCTIU",12,0)
 D:+$G(GMRCA) STATUS^GMRCTIU1
"RTN","GMRCTIU",13,0)
 K GMRCOM,GMRCND,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS
"RTN","GMRCTIU",14,0)
 Q
"RTN","GMRCTIU",15,0)
 ;
"RTN","GMRCTIU",16,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",17,0)
 ;GMRCTUFN=TIU IEN of results record     LINECT=line count for list manager
"RTN","GMRCTIU",18,0)
 ;K VALMAR
"RTN","GMRCTIU",19,0)
 N ND,GMRCARR
"RTN","GMRCTIU",20,0)
 D RPC^TIUSRV(.GMRCARR,GMRCTUFN)
"RTN","GMRCTIU",21,0)
 S ND=0
"RTN","GMRCTIU",22,0)
 F  S ND=$O(@GMRCARR@(ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=@GMRCARR@(ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",23,0)
 ;D CLEAN^VALM10
"RTN","GMRCTIU",24,0)
 K @GMRCARR,RESFL,GMRCTIUY
"RTN","GMRCTIU",25,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",26,0)
 Q
"RTN","GMRCTIU",27,0)
ENTER(GMRCO) ; Complete a consult with TIU note
"RTN","GMRCTIU",28,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",29,0)
 D ENTER^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",30,0)
 Q
"RTN","GMRCTIU",31,0)
 ;
"RTN","GMRCTIU",32,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",33,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",34,0)
 D ADDEND^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",35,0)
 Q
"RTN","GMRCTIU",36,0)
 ;
"RTN","GMRCTIU",37,0)
SEND(DFN,OVRRIDE) ;Get the patients consult list and return in ^TMP for TIU
"RTN","GMRCTIU",38,0)
 ;DFN=Patient's Internal file number from file 2
"RTN","GMRCTIU",39,0)
 ;OVRRIDE=BOOLEAN flag to override user validation
"RTN","GMRCTIU",40,0)
 N GMRCI,TAB
"RTN","GMRCTIU",41,0)
 Q:DFN=""!(DFN<1)
"RTN","GMRCTIU",42,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",43,0)
 K ^TMP("GMRCR",$J,"TIU")
"RTN","GMRCTIU",44,0)
 D GETCONSL(DFN,2,$G(OVRRIDE)) ;2=returns TIU format in ^TMP array
"RTN","GMRCTIU",45,0)
 Q
"RTN","GMRCTIU",46,0)
 ;
"RTN","GMRCTIU",47,0)
RPCLIST(GMRCY,DFN) ;Get the patients consult list and return in GMRCY for GUI
"RTN","GMRCTIU",48,0)
 N GMRCI
"RTN","GMRCTIU",49,0)
 I '+$G(DFN) S GMRCY(0)=0
"RTN","GMRCTIU",50,0)
 D GETCONSL(DFN,1) ;1=returns GUI format in GMRCY array
"RTN","GMRCTIU",51,0)
 ; The consults will be returned from GETCONSL in the GMRCY array.
"RTN","GMRCTIU",52,0)
 S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",53,0)
 Q
"RTN","GMRCTIU",54,0)
GETCONSL(DFN,ORIGIN,OVRRIDE) ;Get the patients consults
"RTN","GMRCTIU",55,0)
 ;ORIGIN is whether the request is for GUI=1 or LM=2.
"RTN","GMRCTIU",56,0)
 ; 11/29/00 MA - If some see's this change "F" to "AD" below.
"RTN","GMRCTIU",57,0)
 ;The logic loops through the "F" cross-reference to find consults
"RTN","GMRCTIU",58,0)
 ;The output will be formatted in GMRCY for the GUI if ORIGIN is 1.
"RTN","GMRCTIU",59,0)
 ;The output will be formatted in ^TMP("GMRCR",$J,"TIU" if ORIGIN is 2.
"RTN","GMRCTIU",60,0)
 ;
"RTN","GMRCTIU",61,0)
 N GMRCQIT,GMRC,GMRCDT,GMRCEDT,GMRCYR,GMRCSP,GMRCST,GMRCSTS
"RTN","GMRCTIU",62,0)
 N GMRCTIU,GMRCTIUC,GMRCSS,GMRCSVC,GMRCPROC,GMRCNOTE,Y,GMRCDAT
"RTN","GMRCTIU",63,0)
 ;
"RTN","GMRCTIU",64,0)
 ; Aug 2000 - MA changed routine to use Parameter global to set the
"RTN","GMRCTIU",65,0)
 ; number of days to look backward when getting a list of consults.
"RTN","GMRCTIU",66,0)
 S GMRCYR=9999999-$$FMADD^XLFDT(DT,-$$GET^XPAR("ALL","GMRC CONSULT LIST DAYS")),GMRCDAT=0
"RTN","GMRCTIU",67,0)
 F  S GMRCDAT=$O(^GMR(123,"AD",DFN,GMRCDAT)) Q:'GMRCDAT  D
"RTN","GMRCTIU",68,0)
 . Q:GMRCDAT>GMRCYR
"RTN","GMRCTIU",69,0)
 . N GMRCDA S GMRCDA=0
"RTN","GMRCTIU",70,0)
 . F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCDAT,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCTIU",71,0)
 .. S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",72,0)
 .. S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",73,0)
 .. I "25689"'[GMRCST Q  ;only return statuses c,p,a,s,pr
"RTN","GMRCTIU",74,0)
 .. S GMRCDT=+GMRC(0)
"RTN","GMRCTIU",75,0)
 .. S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",76,0)
 .. I '+$G(OVRRIDE) Q:'$$VALID^GMRCAU(GMRCSS,GMRCDA) 
"RTN","GMRCTIU",77,0)
 .. S GMRCTIUC=0
"RTN","GMRCTIU",78,0)
 .. D GETLIST^GMRCTIUL(GMRCDA,0,1,.GMRCTIUC)
"RTN","GMRCTIU",79,0)
 .. I ORIGIN=1 D BLDGMRCY Q
"RTN","GMRCTIU",80,0)
 .. I ORIGIN=2 D BLDTMP Q
"RTN","GMRCTIU",81,0)
 .. Q
"RTN","GMRCTIU",82,0)
 . Q
"RTN","GMRCTIU",83,0)
 Q
"RTN","GMRCTIU",84,0)
 ;
"RTN","GMRCTIU",85,0)
BLDGMRCY ;Build the GMRCY array of existing consults
"RTN","GMRCTIU",86,0)
 S GMRCSTS=$P($G(^ORD(100.01,+GMRCST,0)),"^",1)
"RTN","GMRCTIU",87,0)
 S GMRCSS=$P(GMRC(0),U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U)
"RTN","GMRCTIU",88,0)
 S GMRCPROC=$P($G(^ORD(101,+$P(GMRC(0),U,8),0)),U,2)
"RTN","GMRCTIU",89,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",90,0)
 S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC_U_GMRCSTS_U_+GMRCTIUC(0)
"RTN","GMRCTIU",91,0)
 Q
"RTN","GMRCTIU",92,0)
BLDTMP ;Build TMP global for TIU
"RTN","GMRCTIU",93,0)
 S GMRCSTS=$G(^ORD(100.01,+GMRCST,.1))
"RTN","GMRCTIU",94,0)
 S GMRCSP=$$ORTX^GMRCAU(GMRCDA)
"RTN","GMRCTIU",95,0)
 S GMRCNOTE=$S(GMRCTIUC(0)=1:" note",1:" notes")
"RTN","GMRCTIU",96,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCDT,"D")
"RTN","GMRCTIU",97,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",98,0)
 S ^TMP("GMRCR",$J,"TIU",GMRCI,0)=$J(GMRCI,3)_"> "_$E(GMRCEDT_TAB,1,12)_" C#"_$E(GMRCDA_TAB,1,9)_$E(GMRCSP_TAB,1,21)_$E(GMRCSTS_TAB,1,4)_$E(+GMRCTIUC(0)_GMRCNOTE_TAB,1,10)
"RTN","GMRCTIU",99,0)
 S ^TMP("GMRCR",$J,"TIU","B",GMRCI,GMRCDA)=""
"RTN","GMRCTIU",100,0)
 Q
"RTN","GMRCYP18")
0^^B1444909
"RTN","GMRCYP18",1,0)
GMRCYP18 ;SLC/MA - Post Install for patch 18 ; 11/25/2000
"RTN","GMRCYP18",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**18**;DEC 27, 1997
"RTN","GMRCYP18",3,0)
EN ;
"RTN","GMRCYP18",4,0)
 ; Set the default pkg parameter for GMRC CONSULT LIST DAYS
"RTN","GMRCYP18",5,0)
 D EN^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC CONSULT LIST DAYS",1,365,.ERROR)
"RTN","GMRCYP18",6,0)
 I ERROR D 
"RTN","GMRCYP18",7,0)
 . D BMES^XPDUTL("POST INSTALL FAILED WHEN UPDATING THE PARAMETER ""GMRC CONSULT LIST DAYS, ERROR="""_ERROR)
"RTN","GMRCYP18",8,0)
 . D BMES^XPDUTL("POST INSTALL FAILED WHEN UPDATING THE PARAMETER ""GMRC CONSULT LIST DAYS, ERROR="""_ERROR)
"RTN","GMRCYP18",9,0)
IDENT ; This will add the Identifier for "USAGE" in the DD and 123.5
"RTN","GMRCYP18",10,0)
 S $P(^GMR(123.5,0),"^",2)="123.5I"
"RTN","GMRCYP18",11,0)
 S ^DD(123.5,0,"ID","USAGE")="D EN^DDIOL(""   ""_$$GET1^DIQ(123.5,+Y,2),"""",""?0"")"
"RTN","GMRCYP18",12,0)
 Q
"VER")
8.0^22.0
"^DD",8989.51,8989.51,0)
FIELD^^30^18
"^DD",8989.51,8989.51,0,"DDA")
N
"^DD",8989.51,8989.51,0,"DT")
2970621
"^DD",8989.51,8989.51,0,"ID","WRITE")
N X S X=^(0) D EN^DDIOL($P(X,U,2),"","?36")
"^DD",8989.51,8989.51,0,"IX","AG",8989.513,.02)

"^DD",8989.51,8989.51,0,"IX","B",8989.51,.01)

"^DD",8989.51,8989.51,0,"IX","C",8989.51,.02)

"^DD",8989.51,8989.51,0,"IX","D",8989.51,.01)

"^DD",8989.51,8989.51,0,"NM","PARAMETER DEFINITION")

"^DD",8989.51,8989.51,0,"PT",8989.5,.02)

"^DD",8989.51,8989.51,0,"PT",8989.52,.04)

"^DD",8989.51,8989.51,0,"PT",8989.521,.02)

"^DD",8989.51,8989.51,0,"VRPK")
XT
"^DD",8989.51,8989.51,.01,0)
NAME^RFX^^0;1^D VALID01^XPARDD1
"^DD",8989.51,8989.51,.01,1,0)
^.1
"^DD",8989.51,8989.51,.01,1,1,0)
8989.51^B
"^DD",8989.51,8989.51,.01,1,1,1)
S ^XTV(8989.51,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.51,.01,1,1,2)
K ^XTV(8989.51,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.51,.01,1,2,0)
8989.51^D^KWIC
"^DD",8989.51,8989.51,.01,1,2,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^XTV(8989.51,"D",I,DA)=""
"^DD",8989.51,8989.51,.01,1,2,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^XTV(8989.51,"D",I,DA)
"^DD",8989.51,8989.51,.01,1,2,"DT")
3000225
"^DD",8989.51,8989.51,.01,3)
Answer must be 3-30 characters in length.  Name must be unique.
"^DD",8989.51,8989.51,.01,21,0)
^.001^2^2^3000701^^
"^DD",8989.51,8989.51,.01,21,1,0)
This is the name of the parameter.  It should be namespaced according to the 
"^DD",8989.51,8989.51,.01,21,2,0)
package from which the parameter originated.
"^DD",8989.51,8989.51,.01,"DT")
3000225
"^DD",8989.51,8989.51,.02,0)
DISPLAY TEXT^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.02,1,0)
^.1
"^DD",8989.51,8989.51,.02,1,1,0)
8989.51^C^MUMPS
"^DD",8989.51,8989.51,.02,1,1,1)
S ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)=""
"^DD",8989.51,8989.51,.02,1,1,2)
K ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)
"^DD",8989.51,8989.51,.02,1,1,"%D",0)
^^2^2^2970606^
"^DD",8989.51,8989.51,.02,1,1,"%D",1,0)
Cross references display text for lookup.  Display text is put in upper
"^DD",8989.51,8989.51,.02,1,1,"%D",2,0)
case so lookup will be case insensitive.
"^DD",8989.51,8989.51,.02,1,1,"DT")
2960409
"^DD",8989.51,8989.51,.02,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.02,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.02,21,1,0)
This is the displayable name for the parameter (allows mixed case, 
"^DD",8989.51,8989.51,.02,21,2,0)
non-namespaced names).
"^DD",8989.51,8989.51,.02,"DT")
2960409
"^DD",8989.51,8989.51,.03,0)
MULTIPLE VALUED^S^1:Yes;0:No;^0;3^Q
"^DD",8989.51,8989.51,.03,3)
Enter 'Yes' if multiple instances of the parameter are allowed for any single entity.
"^DD",8989.51,8989.51,.03,21,0)
^^3^3^2980705^
"^DD",8989.51,8989.51,.03,21,1,0)
If this field is set to 'Yes', multiple instances of the parameter will be 
"^DD",8989.51,8989.51,.03,21,2,0)
allowed for a single entity.  Otherwise, the value of the instance field
"^DD",8989.51,8989.51,.03,21,3,0)
for a given Entity-Parameter combination will always be '1'.
"^DD",8989.51,8989.51,.03,"DT")
2960207
"^DD",8989.51,8989.51,.04,0)
INSTANCE TERM^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.04,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.04,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,.04,21,1,0)
This is a free text term that can be used when prompting for a new instance of 
"^DD",8989.51,8989.51,.04,21,2,0)
the parameter (in the case where the parameter in multiple valued).  If not 
"^DD",8989.51,8989.51,.04,21,3,0)
entered, the word "Instance" will be used.
"^DD",8989.51,8989.51,.04,"DT")
2960207
"^DD",8989.51,8989.51,.05,0)
VALUE TERM^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.05,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.05,21,0)
^^2^2^2970626^
"^DD",8989.51,8989.51,.05,21,1,0)
This contains text that is issued as a prompt for the value.  If nothing
"^DD",8989.51,8989.51,.05,21,2,0)
is here, the prompt will be the word 'Value:'.
"^DD",8989.51,8989.51,.05,"DT")
2960612
"^DD",8989.51,8989.51,.06,0)
PROHIBIT EDITING^S^1:Yes;0:No;^0;6^Q
"^DD",8989.51,8989.51,.06,3)
Choose 'Disallow Editing' if editing of this field should not be allowed.
"^DD",8989.51,8989.51,.06,21,0)
^^2^2^2970306^
"^DD",8989.51,8989.51,.06,21,1,0)
This field prevents the parameter value from being edited with Fileman or
"^DD",8989.51,8989.51,.06,21,2,0)
any Parameters tools.
"^DD",8989.51,8989.51,.06,"DT")
2970317
"^DD",8989.51,8989.51,1.1,0)
VALUE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;M:M code;C:constant;^1;1^Q
"^DD",8989.51,8989.51,1.1,3)
Enter the type of data this parameter will contain.
"^DD",8989.51,8989.51,1.1,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,1.1,21,1,0)
This is the type of data this parameter will contain.  This field is used to 
"^DD",8989.51,8989.51,1.1,21,2,0)
define a call to the reader (^DIR) in most cases.
"^DD",8989.51,8989.51,1.1,"DT")
2960528
"^DD",8989.51,8989.51,1.2,0)
VALUE DOMAIN^F^^1;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,1.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,1.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.2,21,1,0)
This is a string that may be used to further specify the data type.  The 
"^DD",8989.51,8989.51,1.2,21,2,0)
string stored here should be appropriate for the second ^-piece of DIR(0) 
"^DD",8989.51,8989.51,1.2,21,3,0)
when used with the data type field.
"^DD",8989.51,8989.51,1.2,"DT")
2960207
"^DD",8989.51,8989.51,1.3,0)
VALUE HELP^F^^1;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,1.3,3)
Enter a line of help text to be displayed when entering a parameter value.
"^DD",8989.51,8989.51,1.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,1.3,21,2,0)
requests help or encounters an error while entering the VALUE field in the 
"^DD",8989.51,8989.51,1.3,21,3,0)
PARAMETERS file.
"^DD",8989.51,8989.51,1.3,"DT")
2960207
"^DD",8989.51,8989.51,2,0)
VALUE VALIDATION CODE^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,2,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,2,9)
@
"^DD",8989.51,8989.51,2,21,0)
^^2^2^2980705^
"^DD",8989.51,8989.51,2,21,1,0)
This field contains the M code that is placed in the third piece of DIR(0)
"^DD",8989.51,8989.51,2,21,2,0)
when validating a value in the PARAMETERS file.
"^DD",8989.51,8989.51,2,"DT")
2960207
"^DD",8989.51,8989.51,3,0)
VALUE SCREEN CODE^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,3,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,3,9)
@
"^DD",8989.51,8989.51,3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,3,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,3,21,2,0)
VALUE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,3,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,3,"DT")
2960207
"^DD",8989.51,8989.51,6.1,0)
INSTANCE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;^6;1^Q
"^DD",8989.51,8989.51,6.1,3)
Enter the type of data allowed for the INSTANCE field of the parameter.
"^DD",8989.51,8989.51,6.1,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.1,21,1,0)
This is the type of data that is contained in the INSTANCE field of the 
"^DD",8989.51,8989.51,6.1,21,2,0)
PARAMETERS file, if multiple parameter instances per entity are allowed.  
"^DD",8989.51,8989.51,6.1,21,3,0)
This field is used to define a call to the reader.
"^DD",8989.51,8989.51,6.1,"DT")
2960207
"^DD",8989.51,8989.51,6.2,0)
INSTANCE DOMAIN^F^^6;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,6.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,6.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.2,21,1,0)
This may be used to further define the data type for the INSTANCE field of 
"^DD",8989.51,8989.51,6.2,21,2,0)
the parameter.  The string stored here should be appropriate for the second 
"^DD",8989.51,8989.51,6.2,21,3,0)
^-piece of DIR(0) when used with the data type field.
"^DD",8989.51,8989.51,6.2,"DT")
2960207
"^DD",8989.51,8989.51,6.3,0)
INSTANCE HELP^F^^6;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,6.3,3)
Enter a line of help text to be displayed when entering the parameter instance.
"^DD",8989.51,8989.51,6.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,6.3,21,2,0)
requests help or encounters an error while entering the INSTANCE field of 
"^DD",8989.51,8989.51,6.3,21,3,0)
the PARAMETERS file.
"^DD",8989.51,8989.51,6.3,"DT")
2960207
"^DD",8989.51,8989.51,7,0)
INSTANCE VALIDATION CODE^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,7,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,7,9)
@
"^DD",8989.51,8989.51,7,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,7,21,1,0)
This field contains M code that is placed in the third piece of DIR(0) when 
"^DD",8989.51,8989.51,7,21,2,0)
validating the INSTANCE field in the PARAMETERS file.
"^DD",8989.51,8989.51,7,"DT")
2960207
"^DD",8989.51,8989.51,8,0)
INSTANCE SCREEN CODE^K^^8;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,8,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,8,9)
@
"^DD",8989.51,8989.51,8,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,8,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,8,21,2,0)
INSTANCE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,8,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,8,"DT")
2960207
"^DD",8989.51,8989.51,20,0)
DESCRIPTION^8989.512^^20;0
"^DD",8989.51,8989.51,20,21,0)
^^1^1^2970626^
"^DD",8989.51,8989.51,20,21,1,0)
A description of the parameter may be entered here.
"^DD",8989.51,8989.51,30,0)
ALLOWABLE ENTITIES^8989.513I^^30;0
"^DD",8989.51,8989.51,30,21,0)
^^2^2^2960213^^
"^DD",8989.51,8989.51,30,21,1,0)
This multiple contains a list of entities (pointers to files) for which the 
"^DD",8989.51,8989.51,30,21,2,0)
parameter may be validly set.
"^DD",8989.51,8989.512,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8989.51,8989.512,0,"DT")
2960207
"^DD",8989.51,8989.512,0,"NM","DESCRIPTION")

"^DD",8989.51,8989.512,0,"UP")
8989.51
"^DD",8989.51,8989.512,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",8989.51,8989.512,.01,3)
Enter a description of the parameter and how it is used.
"^DD",8989.51,8989.512,.01,21,0)
^^1^1^2960207^
"^DD",8989.51,8989.512,.01,21,1,0)
This is text that describes the purpose and use of the parameter.
"^DD",8989.51,8989.512,.01,"DT")
2960207
"^DD",8989.51,8989.513,0)
ALLOWABLE ENTITIES SUB-FIELD^^.02^2
"^DD",8989.51,8989.513,0,"DT")
2970621
"^DD",8989.51,8989.513,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8989.51,8989.513,0,"IX","B",8989.513,.01)

"^DD",8989.51,8989.513,0,"NM","ALLOWABLE ENTITIES")

"^DD",8989.51,8989.513,0,"UP")
8989.51
"^DD",8989.51,8989.513,.01,0)
PRECEDENCE^MRNJ6,2^^0;1^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",8989.51,8989.513,.01,1,0)
^.1
"^DD",8989.51,8989.513,.01,1,1,0)
8989.513^B
"^DD",8989.51,8989.513,.01,1,1,1)
S ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.513,.01,1,1,2)
K ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.513,.01,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",8989.51,8989.513,.01,21,0)
^^6^6^2960213^^^
"^DD",8989.51,8989.513,.01,21,1,0)
A single parameter may be set for several different types of entities.  This 
"^DD",8989.51,8989.513,.01,21,2,0)
lists the order in which entities are searched for a defined value.  For 
"^DD",8989.51,8989.513,.01,21,3,0)
example, if a parameter may be set for a package, a location, and a user, 
"^DD",8989.51,8989.513,.01,21,4,0)
and the respective precedents are 3, 2, 1, the value of the user parameter 
"^DD",8989.51,8989.513,.01,21,5,0)
would be returned.  If it did not exist, the value of the location 
"^DD",8989.51,8989.513,.01,21,6,0)
parameter.  If that did not exist, then the value of the package parameter.
"^DD",8989.51,8989.513,.01,"DT")
2960213
"^DD",8989.51,8989.513,.02,0)
ENTITY FILE^RP8989.518'^XTV(8989.518,^0;2^Q
"^DD",8989.51,8989.513,.02,1,0)
^.1
"^DD",8989.51,8989.513,.02,1,1,0)
8989.51^AG^MUMPS
"^DD",8989.51,8989.513,.02,1,1,1)
D AGS^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,2)
D AGK^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,"%D",0)
^^5^5^2980422^
"^DD",8989.51,8989.513,.02,1,1,"%D",1,0)
The AG x-ref has the format ^XTV(8989.51,PARAM,30,"AG",GLOBAL REF,DA)="".
"^DD",8989.51,8989.513,.02,1,1,"%D",2,0)
 
"^DD",8989.51,8989.513,.02,1,1,"%D",3,0)
It is used to screen the parameters that may be selected for a given entity 
"^DD",8989.51,8989.513,.02,1,1,"%D",4,0)
in the PARAMETERS file.  The global root is used because the entity is a 
"^DD",8989.51,8989.513,.02,1,1,"%D",5,0)
variable pointer.
"^DD",8989.51,8989.513,.02,1,1,"DT")
2960207
"^DD",8989.51,8989.513,.02,3)
Choose a file from which entities for this parameter are identified.
"^DD",8989.51,8989.513,.02,21,0)
^^3^3^2980422^
"^DD",8989.51,8989.513,.02,21,1,0)
This identifies an entity for which the parameter can be legally entered.  
"^DD",8989.51,8989.513,.02,21,2,0)
Entities are simply variable pointers.  The files which are eligible to be
"^DD",8989.51,8989.513,.02,21,3,0)
entities are listed in the PARAMETER ENTITY file.
"^DD",8989.51,8989.513,.02,"DT")
2970621
"^DIC",8989.51,8989.51,0)
PARAMETER DEFINITION^8989.51
"^DIC",8989.51,8989.51,0,"GL")
^XTV(8989.51,
"^DIC",8989.51,8989.51,"%D",0)
^^3^3^2980920^
"^DIC",8989.51,8989.51,"%D",1,0)
This file contains the characteristics of parameters.  Entries in this
"^DIC",8989.51,8989.51,"%D",2,0)
file must be namespaced and they are exported by the package which owns
"^DIC",8989.51,8989.51,"%D",3,0)
them.
"^DIC",8989.51,"B","PARAMETER DEFINITION",8989.51)

**END**
**END**
