Released XU*8*262 SEQ #240
Extracted from mail message
**KIDS**:XU*8.0*262^

**INSTALL NAME**
XU*8.0*262
"BLD",2207,0)
XU*8.0*262^KERNEL^0^3030327^y
"BLD",2207,4,0)
^9.64PA^^
"BLD",2207,"ABPKG")
n
"BLD",2207,"KRN",0)
^9.67PA^19^17
"BLD",2207,"KRN",.4,0)
.4
"BLD",2207,"KRN",.401,0)
.401
"BLD",2207,"KRN",.402,0)
.402
"BLD",2207,"KRN",.403,0)
.403
"BLD",2207,"KRN",.5,0)
.5
"BLD",2207,"KRN",.84,0)
.84
"BLD",2207,"KRN",3.6,0)
3.6
"BLD",2207,"KRN",3.8,0)
3.8
"BLD",2207,"KRN",9.2,0)
9.2
"BLD",2207,"KRN",9.8,0)
9.8
"BLD",2207,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",2207,"KRN",9.8,"NM",1,0)
XUMFP^^0^B22178504
"BLD",2207,"KRN",9.8,"NM",2,0)
XUMFPZL7^^0^B2126203
"BLD",2207,"KRN",9.8,"NM",4,0)
XUMFH^^0^B73467108
"BLD",2207,"KRN",9.8,"NM",5,0)
XUMFPMFS^^0^B18122564
"BLD",2207,"KRN",9.8,"NM","B","XUMFH",4)

"BLD",2207,"KRN",9.8,"NM","B","XUMFP",1)

"BLD",2207,"KRN",9.8,"NM","B","XUMFPMFS",5)

"BLD",2207,"KRN",9.8,"NM","B","XUMFPZL7",2)

"BLD",2207,"KRN",19,0)
19
"BLD",2207,"KRN",19.1,0)
19.1
"BLD",2207,"KRN",101,0)
101
"BLD",2207,"KRN",409.61,0)
409.61
"BLD",2207,"KRN",771,0)
771
"BLD",2207,"KRN",870,0)
870
"BLD",2207,"KRN",8994,0)
8994
"BLD",2207,"KRN","B",.4,.4)

"BLD",2207,"KRN","B",.401,.401)

"BLD",2207,"KRN","B",.402,.402)

"BLD",2207,"KRN","B",.403,.403)

"BLD",2207,"KRN","B",.5,.5)

"BLD",2207,"KRN","B",.84,.84)

"BLD",2207,"KRN","B",3.6,3.6)

"BLD",2207,"KRN","B",3.8,3.8)

"BLD",2207,"KRN","B",9.2,9.2)

"BLD",2207,"KRN","B",9.8,9.8)

"BLD",2207,"KRN","B",19,19)

"BLD",2207,"KRN","B",19.1,19.1)

"BLD",2207,"KRN","B",101,101)

"BLD",2207,"KRN","B",409.61,409.61)

"BLD",2207,"KRN","B",771,771)

"BLD",2207,"KRN","B",870,870)

"BLD",2207,"KRN","B",8994,8994)

"BLD",2207,"QUES",0)
^9.62^^
"BLD",2207,"REQB",0)
^9.611^5^5
"BLD",2207,"REQB",1,0)
XU*8.0*206^0
"BLD",2207,"REQB",2,0)
XU*8.0*209^0
"BLD",2207,"REQB",3,0)
XU*8.0*212^0
"BLD",2207,"REQB",4,0)
XU*8.0*217^0
"BLD",2207,"REQB",5,0)
XU*8.0*218^0
"BLD",2207,"REQB","B","XU*8.0*206",1)

"BLD",2207,"REQB","B","XU*8.0*209",2)

"BLD",2207,"REQB","B","XU*8.0*212",3)

"BLD",2207,"REQB","B","XU*8.0*217",4)

"BLD",2207,"REQB","B","XU*8.0*218",5)

"MBREQ")
0
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
262^3030327^9147
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XUMFH")
0^4^B73467108
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler ;06/28/00
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206,209,217,218,262**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO,HLSCS,CDSYS
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S (ERROR,CNT,TYPE,ARRAY)=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH",46,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",47,0)
 ;
"RTN","XUMFH",48,0)
 Q
"RTN","XUMFH",49,0)
 ;
"RTN","XUMFH",50,0)
QRD ; -- QRD segment
"RTN","XUMFH",51,0)
 ;
"RTN","XUMFH",52,0)
 Q:ERROR
"RTN","XUMFH",53,0)
 ;
"RTN","XUMFH",54,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",55,0)
 ;
"RTN","XUMFH",56,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",57,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",58,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",59,0)
 I WHO="" D  Q
"RTN","XUMFH",60,0)
 .S ERROR="1^QRD segment has null missing WHO parameter"
"RTN","XUMFH",61,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",62,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",63,0)
 I WHAT="" D  Q
"RTN","XUMFH",64,0)
 .S ERROR="1^QRD segment has null missing WHAT parameter"
"RTN","XUMFH",65,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",66,0)
 ;
"RTN","XUMFH",67,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",68,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",69,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",70,0)
 ;
"RTN","XUMFH",71,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",72,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",73,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",74,0)
 ;
"RTN","XUMFH",75,0)
 S IFN=+WHAT
"RTN","XUMFH",76,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",77,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",78,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",79,0)
 S:$L(XREF)>1 PARAM("CDSYS")=XREF
"RTN","XUMFH",80,0)
 ;
"RTN","XUMFH",81,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",82,0)
 ;
"RTN","XUMFH",83,0)
 Q
"RTN","XUMFH",84,0)
 ;
"RTN","XUMFH",85,0)
MFI ; -- MFI segment
"RTN","XUMFH",86,0)
 ;
"RTN","XUMFH",87,0)
 Q:ERROR
"RTN","XUMFH",88,0)
 Q:$G(IFN)
"RTN","XUMFH",89,0)
 ;
"RTN","XUMFH",90,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH",91,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH",92,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",93,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",94,0)
 I 'IFN D  Q
"RTN","XUMFH",95,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH",96,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",97,0)
 ;
"RTN","XUMFH",98,0)
 Q
"RTN","XUMFH",99,0)
 ;
"RTN","XUMFH",100,0)
MFE ; -- MFE segment
"RTN","XUMFH",101,0)
 ;
"RTN","XUMFH",102,0)
 Q:ERROR
"RTN","XUMFH",103,0)
 Q:$G(IEN)
"RTN","XUMFH",104,0)
 ;
"RTN","XUMFH",105,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",106,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",107,0)
 S:KEY IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",108,0)
 S IEN=$S(IEN:IEN,KEY["ALL":"ALL",$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH",109,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH",110,0)
 .D EM("MFE segment couldn't resolve IEN",.ERR)
"RTN","XUMFH",111,0)
 .K ERR
"RTN","XUMFH",112,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",113,0)
 ;
"RTN","XUMFH",114,0)
 Q
"RTN","XUMFH",115,0)
 ;
"RTN","XUMFH",116,0)
ZL7 ; -- Generic Master File
"RTN","XUMFH",117,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",118,0)
ZFT ; -- VHA Facility Type segment
"RTN","XUMFH",119,0)
LOC ; -- Location Identification segment
"RTN","XUMFH",120,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",121,0)
 ;
"RTN","XUMFH",122,0)
 Q:ERROR
"RTN","XUMFH",123,0)
 ;
"RTN","XUMFH",124,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",125,0)
 ;
"RTN","XUMFH",126,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1,SEQ,SEQ1,SEQ2,SEQ3
"RTN","XUMFH",127,0)
 ;
"RTN","XUMFH",128,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",129,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 S XUMF=7
"RTN","XUMFH",132,0)
 ;
"RTN","XUMFH",133,0)
 S SEG=$P(HLNODE,HLFS)
"RTN","XUMFH",134,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",135,0)
 S SEQ=0
"RTN","XUMFH",136,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",137,0)
 .S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFH",138,0)
 .S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",0))
"RTN","XUMFH",139,0)
 .I SEQ3 D SUBCOMP Q
"RTN","XUMFH",140,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",141,0)
 .I FIELD=".01" D
"RTN","XUMFH",142,0)
 ..N FDA,IEN1
"RTN","XUMFH",143,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",144,0)
 ..S VALUE=$$VALUE(.HLNODE,SEQ1)
"RTN","XUMFH",145,0)
 ..S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",146,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",147,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",148,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",149,0)
 ..I $D(ERR) D
"RTN","XUMFH",150,0)
 ...D EM("update DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",151,0)
 ...K ERR
"RTN","XUMFH",152,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",153,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",154,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",155,0)
 .S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",156,0)
 .S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",157,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",158,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",159,0)
 ;
"RTN","XUMFH",160,0)
 M FDA=FDA1
"RTN","XUMFH",161,0)
 ;
"RTN","XUMFH",162,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",163,0)
 I $D(ERR) D
"RTN","XUMFH",164,0)
 .D EM("file DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",165,0)
 .K ERR
"RTN","XUMFH",166,0)
 ;
"RTN","XUMFH",167,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",168,0)
 D:POST'="" @(POST)
"RTN","XUMFH",169,0)
 ;
"RTN","XUMFH",170,0)
 Q
"RTN","XUMFH",171,0)
 ;
"RTN","XUMFH",172,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",173,0)
 ;
"RTN","XUMFH",174,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",175,0)
 ;
"RTN","XUMFH",176,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",177,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",178,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",179,0)
 S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",180,0)
 S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",181,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",182,0)
 ;
"RTN","XUMFH",183,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH",184,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH",185,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",186,0)
 .N FDA,IEN
"RTN","XUMFH",187,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",188,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",189,0)
 .I $D(ERR) D
"RTN","XUMFH",190,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",191,0)
 ..K ERR
"RTN","XUMFH",192,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",193,0)
 I 'MULT D
"RTN","XUMFH",194,0)
 .N FDA,IEN
"RTN","XUMFH",195,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",196,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",197,0)
 .I $D(ERR) D
"RTN","XUMFH",198,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",199,0)
 ..K ERR
"RTN","XUMFH",200,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",201,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",202,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",203,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",204,0)
 ;
"RTN","XUMFH",205,0)
 Q
"RTN","XUMFH",206,0)
 ;
"RTN","XUMFH",207,0)
VALUE(HLNODE,SEQ) ; -- handle HL7 continuation nodes
"RTN","XUMFH",208,0)
 ;
"RTN","XUMFH",209,0)
 N I,X,Y,N,T,Z,NODE
"RTN","XUMFH",210,0)
 ;
"RTN","XUMFH",211,0)
 S SEQ=$P($G(SEQ),".") Q:'SEQ ""
"RTN","XUMFH",212,0)
 ;
"RTN","XUMFH",213,0)
 M Z=HLNODE
"RTN","XUMFH",214,0)
 S Z(0)=HLNODE
"RTN","XUMFH",215,0)
 ;
"RTN","XUMFH",216,0)
 S I=0
"RTN","XUMFH",217,0)
 F  S I=$O(Z(I)) Q:'I  D
"RTN","XUMFH",218,0)
 .Q:$E(Z(I),1)=HLFS
"RTN","XUMFH",219,0)
 .S X=$P(Z(I),HLFS)
"RTN","XUMFH",220,0)
 .S Y=$O(Z(I),-1)
"RTN","XUMFH",221,0)
 .S Z(Y)=Z(Y)_X
"RTN","XUMFH",222,0)
 .S:$L(Z(I),HLFS)'="" Z(I)=HLFS_$P(Z(I),HLFS,2,999)
"RTN","XUMFH",223,0)
 .K:$L(Z(I),HLFS)="" Z(I)
"RTN","XUMFH",224,0)
 ;
"RTN","XUMFH",225,0)
 S X=0
"RTN","XUMFH",226,0)
 F  S X=$O(Z(X)) Q:'X  D
"RTN","XUMFH",227,0)
 .S X(X)=$L(Z(X),HLFS)-1
"RTN","XUMFH",228,0)
 S X(0)=$L(Z,HLFS)-1
"RTN","XUMFH",229,0)
 ;
"RTN","XUMFH",230,0)
 S (X,N,T)=""
"RTN","XUMFH",231,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",232,0)
 .S T=T+$P(X(X),U),N(T+1)=X
"RTN","XUMFH",233,0)
 ;
"RTN","XUMFH",234,0)
 S (X,Y)=""
"RTN","XUMFH",235,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",236,0)
 .S $P(X(X),U,2)=Y
"RTN","XUMFH",237,0)
 .S Y=+X(X)+Y
"RTN","XUMFH",238,0)
 ;
"RTN","XUMFH",239,0)
 S NODE=$G(N(+$O(N(SEQ)))) Q:NODE="" ""
"RTN","XUMFH",240,0)
 ;
"RTN","XUMFH",241,0)
 Q $P(Z(NODE),HLFS,(SEQ-($P(X(NODE),U,2))+1))
"RTN","XUMFH",242,0)
 ;
"RTN","XUMFH",243,0)
SUBCOMP ; -- subcomponents
"RTN","XUMFH",244,0)
 ;
"RTN","XUMFH",245,0)
 S SEQ3=0
"RTN","XUMFH",246,0)
 F  S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3)) Q:'SEQ3  D
"RTN","XUMFH",247,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,0))
"RTN","XUMFH",248,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,FIELD))
"RTN","XUMFH",249,0)
 .S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",250,0)
 .S VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",251,0)
 .S VALUE=$P(VALUE,HLSCS,SEQ3)
"RTN","XUMFH",252,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLSCS,0)
"RTN","XUMFH",253,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",254,0)
 ;
"RTN","XUMFH",255,0)
 Q
"RTN","XUMFH",256,0)
 ;
"RTN","XUMFH",257,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",258,0)
 ;
"RTN","XUMFH",259,0)
 I $G(KEY)="" D  Q
"RTN","XUMFH",260,0)
 .D EM("Null KEY found in the following segment: "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",261,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",262,0)
 ;
"RTN","XUMFH",263,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",264,0)
 ;
"RTN","XUMFH",265,0)
 Q
"RTN","XUMFH",266,0)
 ;
"RTN","XUMFH",267,0)
REPLY ; -- master file response
"RTN","XUMFH",268,0)
 ;
"RTN","XUMFH",269,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",270,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",271,0)
 ;
"RTN","XUMFH",272,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",273,0)
 ;
"RTN","XUMFH",274,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",275,0)
 .S IFN=+$G(WHAT) I 'IFN D  Q
"RTN","XUMFH",276,0)
 ..S ERROR="1^REPLY MFQ couldn't resolve IFN"
"RTN","XUMFH",277,0)
 ..D EM(ERROR,.ERR)
"RTN","XUMFH",278,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",279,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",280,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",281,0)
 ;
"RTN","XUMFH",282,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",283,0)
 ;
"RTN","XUMFH",284,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",285,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",286,0)
 ;
"RTN","XUMFH",287,0)
 Q
"RTN","XUMFH",288,0)
 ;
"RTN","XUMFH",289,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",290,0)
 ;
"RTN","XUMFH",291,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",292,0)
 ;
"RTN","XUMFH",293,0)
 Q
"RTN","XUMFH",294,0)
 ;
"RTN","XUMFH",295,0)
EM(ERROR,ERR,XMSUB,XMY) ; -- error message
"RTN","XUMFH",296,0)
 ;
"RTN","XUMFH",297,0)
 N X,XMTEXT,FLG
"RTN","XUMFH",298,0)
 ;
"RTN","XUMFH",299,0)
 S FLG=0
"RTN","XUMFH",300,0)
 ;
"RTN","XUMFH",301,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMFH",302,0)
 ;
"RTN","XUMFH",303,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMFH",304,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMFH",305,0)
 S:$G(XMSUB)="" XMSUB="MFS ERROR"
"RTN","XUMFH",306,0)
 S XMY("G.XUMF ERROR")=""
"RTN","XUMFH",307,0)
 S XMTEXT="X("
"RTN","XUMFH",308,0)
 ;
"RTN","XUMFH",309,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH",310,0)
 .I X(X)="" K X(X) Q
"RTN","XUMFH",311,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMFH",312,0)
 .I X(X)["ASSOCIATION" S FLG=1 K X(X) Q
"RTN","XUMFH",313,0)
 .I X(X)["INSTITUTION" S FLG=1 K X(X) Q
"RTN","XUMFH",314,0)
 ;
"RTN","XUMFH",315,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMFH",316,0)
 ;
"RTN","XUMFH",317,0)
 D ^XMD
"RTN","XUMFH",318,0)
 ;
"RTN","XUMFH",319,0)
 Q
"RTN","XUMFH",320,0)
 ;
"RTN","XUMFP")
0^1^B22178504
"RTN","XUMFP",1,0)
XUMFP ;CIOFO-SF/RAM,ALB/BRM - Master File C/S Parameters ; 10/11/02 2:50pm
"RTN","XUMFP",2,0)
 ;;8.0;KERNEL;**206,217,246,262**;Jul 10, 1995
"RTN","XUMFP",3,0)
 ;
"RTN","XUMFP",4,0)
 ;
"RTN","XUMFP",5,0)
 ;
"RTN","XUMFP",6,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ; -- parameters for master file server
"RTN","XUMFP",7,0)
 ;
"RTN","XUMFP",8,0)
 ;INPUT
"RTN","XUMFP",9,0)
 ;       IFN             Internal File Number (required)
"RTN","XUMFP",10,0)
 ;
"RTN","XUMFP",11,0)
 ;       IEN             Internal Entry Number (required)
"RTN","XUMFP",12,0)
 ;
"RTN","XUMFP",13,0)
 ;                       single entry (pass by value) example: IEN=1
"RTN","XUMFP",14,0)
 ;
"RTN","XUMFP",15,0)
 ;                       multiple entries (pass by reference)  IEN(1)=""
"RTN","XUMFP",16,0)
 ;                                                             IEN(2)=""
"RTN","XUMFP",17,0)
 ;
"RTN","XUMFP",18,0)
 ;                       ALL national entries (pass by value)  IEN="ALL"
"RTN","XUMFP",19,0)
 ;
"RTN","XUMFP",20,0)
 ;                       NEW entry (pass by value)             IEN="NEW"
"RTN","XUMFP",21,0)
 ;
"RTN","XUMFP",22,0)
 ;       TYPE            Message TYPE (required)
"RTN","XUMFP",23,0)
 ;
"RTN","XUMFP",24,0)
 ;                       0  = MFN - unsolicited update
"RTN","XUMFP",25,0)
 ;                       1  = MFQ - query particular record and file
"RTN","XUMFP",26,0)
 ;                       3  = MFQ - query particular record in array
"RTN","XUMFP",27,0)
 ;                       5  = MFQ - query group records file
"RTN","XUMFP",28,0)
 ;                       7  = MFQ - query group records array
"RTN","XUMFP",29,0)
 ;                       11 = MFR - query response particular rec file
"RTN","XUMFP",30,0)
 ;                       13 = MFR - query response particular rec array
"RTN","XUMFP",31,0)
 ;                       15 = MFR - query response group records file
"RTN","XUMFP",32,0)
 ;                       17 = MFR - query response group records array
"RTN","XUMFP",33,0)
 ;
"RTN","XUMFP",34,0)
 ;
"RTN","XUMFP",35,0)
 ;INPUT/OUTPUT
"RTN","XUMFP",36,0)
 ;
"RTN","XUMFP",37,0)
 ;       PARAM("PROTOCOL")       IEN Protocol (#101) file
"RTN","XUMFP",38,0)
 ;       PARAM("LLNK")           HLL("LINKS",n) 'protocol^logical link'
"RTN","XUMFP",39,0)
 ;       PARAM("PRE")            Pre-update record routine
"RTN","XUMFP",40,0)
 ;       PARAM("POST")           Post-update record routine
"RTN","XUMFP",41,0)
 ;
"RTN","XUMFP",42,0)
 ;       QRD -- Query definition segment
"RTN","XUMFP",43,0)
 ;       -------------------------------
"RTN","XUMFP",44,0)
 ;       PARAM("QDT")            Query Date/Time
"RTN","XUMFP",45,0)
 ;       PARAM("QFC")            Query Format Code
"RTN","XUMFP",46,0)
 ;       PARAM("QP")             Query Priority
"RTN","XUMFP",47,0)
 ;       PARAM("QID")            Query ID
"RTN","XUMFP",48,0)
 ;       PARAM("DRT")            Deferred Response Type
"RTN","XUMFP",49,0)
 ;       PARAM("DRDT")           Deferred Response Date/Time
"RTN","XUMFP",50,0)
 ;       PARAM("QLR")            Quantity Limited Request
"RTN","XUMFP",51,0)
 ;       PARAM("WHO")            Who Subject Filter
"RTN","XUMFP",52,0)
 ;       PARAM("WHAT")           What Subject Filter
"RTN","XUMFP",53,0)
 ;       PARAM("WDDC")           What Department Data Code
"RTN","XUMFP",54,0)
 ;       PARAM("WDCVQ")          What Data Code Value Qual
"RTN","XUMFP",55,0)
 ;       PARAM("QRL")            Query Results Level
"RTN","XUMFP",56,0)
 ;
"RTN","XUMFP",57,0)
 ;       MFI -- Master File Identification
"RTN","XUMFP",58,0)
 ;       ---------------------------------
"RTN","XUMFP",59,0)
 ;       PARAM("MFI")            Master File Identifier
"RTN","XUMFP",60,0)
 ;       PARAM("MFAI")           Master File Application Identifier
"RTN","XUMFP",61,0)
 ;       PARAM("FLEC")           File-Level Event Code
"RTN","XUMFP",62,0)
 ;       PARAM("ENDT")           Entered Data/Time
"RTN","XUMFP",63,0)
 ;       PARAM("MFIEDT")         Effective Date/Time
"RTN","XUMFP",64,0)
 ;       PARAM("RLC")            Response Level Code
"RTN","XUMFP",65,0)
 ; 
"RTN","XUMFP",66,0)
 ;       MFE -- Master File Entry
"RTN","XUMFP",67,0)
 ;       ------------------------
"RTN","XUMFP",68,0)
 ;       PARAM("RLEC")           Record-Level Event Code
"RTN","XUMFP",69,0)
 ;       PARAM("MFNCID")         MFN Control ID
"RTN","XUMFP",70,0)
 ;       PARAM("MFEEDT")         Effective Date/Time
"RTN","XUMFP",71,0)
 ;       PARAM("PKV")            Primary Key Value
"RTN","XUMFP",72,0)
 ;
"RTN","XUMFP",73,0)
 ;       [Z...] segment(s) parameters
"RTN","XUMFP",74,0)
 ;       -------------------------
"RTN","XUMFP",75,0)
 ;       PARAM("SEG",SEG)=""             HL7 segment name
"RTN","XUMFP",76,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,FLD#) seg sequence number and field
"RTN","XUMFP",77,0)
 ;  Note: Add HL7 data type + sub components (leave value/code blank) 
"RTN","XUMFP",78,0)
 ;  Example: Institution Facility Type  = "CE^~FACILILITY TYPE~VA"
"RTN","XUMFP",79,0)
 ;    If the FIELD is a pointer and you want the lookup to be other
"RTN","XUMFP",80,0)
 ;    than the pointed to .01 set the 3rd piece = to the extended ref.
"RTN","XUMFP",81,0)
 ;    I.e., Parent Facility in the Association mult of Institution
"RTN","XUMFP",82,0)
 ;    points back to Institution, if we want to get facility using
"RTN","XUMFP",83,0)
 ;    station number (#99) instead of name (.01) set the 3rd piece
"RTN","XUMFP",84,0)
 ;    equal to ":99" giving us "CE^~FACILILITY TYPE~VA^:99".
"RTN","XUMFP",85,0)
 ;
"RTN","XUMFP",86,0)
 ;       Files involving sub-records and/or extended reference
"RTN","XUMFP",87,0)
 ;       -----------------------------------------------------
"RTN","XUMFP",88,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FILE")       See FM documentation
"RTN","XUMFP",89,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"IENS")       $$GET1^DIQ() for value
"RTN","XUMFP",90,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FIELD")      of FILE, IENS, & FIELD.
"RTN","XUMFP",91,0)
 ;
"RTN","XUMFP",92,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"DTYP")      HL7 data type (above)
"RTN","XUMFP",93,0)
 ;
"RTN","XUMFP",94,0)
 ;
"RTN","XUMFP",95,0)
 ; *** NOTE: OUTPUT in ^TMP("XUMF MFS",$J,"PARAM") ***
"RTN","XUMFP",96,0)
 ;
"RTN","XUMFP",97,0)
 ;       Example: MFE PKV is ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFP",98,0)
 ;                    SEG    ^TMP("XUMF MFS",$J,"PARAM","SEG")
"RTN","XUMFP",99,0)
 ;
"RTN","XUMFP",100,0)
 ;       and another node is required for sub-file IENS for group
"RTN","XUMFP",101,0)
 ;       ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS",SEG,SEQ)=IENS
"RTN","XUMFP",102,0)
 ;
"RTN","XUMFP",103,0)
 ;       Use XUMFP4 as a template/example routine
"RTN","XUMFP",104,0)
 ;
"RTN","XUMFP",105,0)
 N QUERY,UPDATE,ALL,MFR,MFQ,HLFS,HLCS,GROUP,ARRAY,ROOT,NEW,I,J,CDSYS
"RTN","XUMFP",106,0)
 N PROTOCOL
"RTN","XUMFP",107,0)
 ;
"RTN","XUMFP",108,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFP",109,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM
"RTN","XUMFP",110,0)
 ;
"RTN","XUMFP",111,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFP",112,0)
 S TYPE=+$G(TYPE),ERROR=$G(ERROR)
"RTN","XUMFP",113,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFP",114,0)
 S QUERY='UPDATE
"RTN","XUMFP",115,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFP",116,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFP",117,0)
 S ALL=$S(IEN="ALL":1,1:0)
"RTN","XUMFP",118,0)
 S NEW=$S(IEN="NEW":1,1:0)
"RTN","XUMFP",119,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFP",120,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFP",121,0)
 ;
"RTN","XUMFP",122,0)
 S PROTOCOL=$G(PARAM("PROTOCOL"))
"RTN","XUMFP",123,0)
 ;
"RTN","XUMFP",124,0)
 I 'IFN S ERROR="1^invalid IFN" Q
"RTN","XUMFP",125,0)
 ;
"RTN","XUMFP",126,0)
 ; -- get root of file
"RTN","XUMFP",127,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFP",128,0)
 ;
"RTN","XUMFP",129,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFP",130,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFP",131,0)
 ;
"RTN","XUMFP",132,0)
 ; -- if CDSYS and ALL get entries
"RTN","XUMFP",133,0)
 S CDSYS=$G(^TMP("XUMF MFS",$J,"PARAM","CDSYS"))
"RTN","XUMFP",134,0)
 I ALL,CDSYS'="" D
"RTN","XUMFP",135,0)
 .S I=0 F  S I=$O(@ROOT@("XUMFIDX",CDSYS,I)) Q:'I  D
"RTN","XUMFP",136,0)
 ..S J=$O(@ROOT@("XUMFIDX",CDSYS,I,0))
"RTN","XUMFP",137,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",J)=I
"RTN","XUMFP",138,0)
 ;
"RTN","XUMFP",139,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFP",140,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")),CDSYS="" D
"RTN","XUMFP",141,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFP",142,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFP",143,0)
 ;
"RTN","XUMFP",144,0)
 ; -- get ALL file
"RTN","XUMFP",145,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")),CDSYS="" D
"RTN","XUMFP",146,0)
 .S I=0 F  S I=$O(@ROOT@(I)) Q:'I  D
"RTN","XUMFP",147,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFP",148,0)
 ;
"RTN","XUMFP",149,0)
 ;  *** insert code below ***
"RTN","XUMFP",150,0)
 ; insert file number in string below to add an additional file
"RTN","XUMFP",151,0)
 I "^4^4.1^5.12^5.13^730^5^45.7^4.11^49^"'[(U_IFN_U) S ERROR="1^file not supported" Q
"RTN","XUMFP",152,0)
 ;  *** end insert code ***
"RTN","XUMFP",153,0)
 ;
"RTN","XUMFP",154,0)
 ;    note: also create a subroutine for each supported file with
"RTN","XUMFP",155,0)
 ;             the file number as the line TAG (replace decimal point
"RTN","XUMFP",156,0)
 ;             of file number with the letter 'P').  This subroutine
"RTN","XUMFP",157,0)
 ;             calls an associated routine for the specific file.
"RTN","XUMFP",158,0)
 ;             This file should use the XUMFP namespace.
"RTN","XUMFP",159,0)
 ;
"RTN","XUMFP",160,0)
 I "^4^4.1^5.12^5.13^"[(U_IFN_U) D @("F"_$TR(IFN,".","P"))
"RTN","XUMFP",161,0)
 I "^730^5^4.11^49^"[(U_IFN_U) D ZL7
"RTN","XUMFP",162,0)
 ;
"RTN","XUMFP",163,0)
 K PARAM
"RTN","XUMFP",164,0)
 ;
"RTN","XUMFP",165,0)
 Q
"RTN","XUMFP",166,0)
 ;
"RTN","XUMFP",167,0)
F4 ; -- institution file
"RTN","XUMFP",168,0)
 ;
"RTN","XUMFP",169,0)
 D ^XUMFP4
"RTN","XUMFP",170,0)
 ;
"RTN","XUMFP",171,0)
 Q
"RTN","XUMFP",172,0)
 ;
"RTN","XUMFP",173,0)
F4P1 ; -- facility type file
"RTN","XUMFP",174,0)
 ;
"RTN","XUMFP",175,0)
 D ^XUMFPFT
"RTN","XUMFP",176,0)
 ;
"RTN","XUMFP",177,0)
 Q
"RTN","XUMFP",178,0)
 ;
"RTN","XUMFP",179,0)
F5P12 ; -- postal code file
"RTN","XUMFP",180,0)
 ;
"RTN","XUMFP",181,0)
 D ^XUMFP512
"RTN","XUMFP",182,0)
 ;
"RTN","XUMFP",183,0)
 Q
"RTN","XUMFP",184,0)
 ;
"RTN","XUMFP",185,0)
F5P13 ; -- county code file
"RTN","XUMFP",186,0)
 ;
"RTN","XUMFP",187,0)
 D ^XUMFP513
"RTN","XUMFP",188,0)
 ;
"RTN","XUMFP",189,0)
 Q
"RTN","XUMFP",190,0)
 ;
"RTN","XUMFP",191,0)
 ;  *** insert subroutine here for additional files ***
"RTN","XUMFP",192,0)
 ;
"RTN","XUMFP",193,0)
TAG ;D ^ROUTINE
"RTN","XUMFP",194,0)
 ;Q
"RTN","XUMFP",195,0)
 ;
"RTN","XUMFP",196,0)
 ;
"RTN","XUMFP",197,0)
ZL7 ; generic
"RTN","XUMFP",198,0)
 ;
"RTN","XUMFP",199,0)
 D ^XUMFPMFS
"RTN","XUMFP",200,0)
 ;
"RTN","XUMFP",201,0)
 Q
"RTN","XUMFP",202,0)
 ;
"RTN","XUMFP",203,0)
MFI(X) ; -- master file identifier function
"RTN","XUMFP",204,0)
 ;
"RTN","XUMFP",205,0)
 ;INPUT          X       master file indentifier (seq 1 MFI segment)
"RTN","XUMFP",206,0)
 ;OUTPUT         $$      IFN - Internal File Number or '0' for error
"RTN","XUMFP",207,0)
 ;
"RTN","XUMFP",208,0)
 Q:X="Z04" 4
"RTN","XUMFP",209,0)
 Q:X="Z4T" 4.1
"RTN","XUMFP",210,0)
 Q:$P(X,HLCS)="5P12" 5.12
"RTN","XUMFP",211,0)
 Q:$P(X,HLCS)="5P13" 5.13
"RTN","XUMFP",212,0)
 Q:X="ZNS" 730
"RTN","XUMFP",213,0)
 Q:X="ZAG" 4.11
"RTN","XUMFP",214,0)
 Q:X="Z05" 5
"RTN","XUMFP",215,0)
 Q:X="Z49" 49
"RTN","XUMFP",216,0)
 ;
"RTN","XUMFP",217,0)
 ; *** add code here for new files ***
"RTN","XUMFP",218,0)
 ;
"RTN","XUMFP",219,0)
 Q 0
"RTN","XUMFP",220,0)
 ;
"RTN","XUMFP",221,0)
DTYP(VALUE,TYP,HLCS,TOHL7) ;data type conversion
"RTN","XUMFP",222,0)
 ;INPUT
"RTN","XUMFP",223,0)
 ;   VALUE    value
"RTN","XUMFP",224,0)
 ;   TYP    HL7 data type
"RTN","XUMFP",225,0)
 ;   TOHL7   1=to HL7, 0=to FileMan
"RTN","XUMFP",226,0)
 ;OUTPUT
"RTN","XUMFP",227,0)
 ;   $$      formatted data
"RTN","XUMFP",228,0)
 ;
"RTN","XUMFP",229,0)
 N TEXT,CS
"RTN","XUMFP",230,0)
 S TYP=$G(TYP),VALUE=$G(VALUE),TOHL7=$G(TOHL7)
"RTN","XUMFP",231,0)
 Q:TYP="" VALUE Q:VALUE="" VALUE
"RTN","XUMFP",232,0)
 S TEXT=$P(TYP,U,2),TYP=$P(TYP,U)
"RTN","XUMFP",233,0)
 I TYP="ST"!(TYP="ID") Q VALUE
"RTN","XUMFP",234,0)
 I TYP="DT",TOHL7 D  Q $$HLDATE^HLFNC(VALUE)
"RTN","XUMFP",235,0)
 .N X,Y S X=VALUE D ^%DT S VALUE=+Y
"RTN","XUMFP",236,0)
 I TYP="DT" Q $$FMDATE^HLFNC(+VALUE)
"RTN","XUMFP",237,0)
 I TYP="ZST" D  Q VALUE
"RTN","XUMFP",238,0)
 .N IEN5 S IEN5=+$O(^DIC(5,"C",VALUE,""))
"RTN","XUMFP",239,0)
 .S:IEN5 VALUE=$P($G(^DIC(5,IEN5,0)),"^")
"RTN","XUMFP",240,0)
 I 'TOHL7 Q $P(VALUE,HLCS)
"RTN","XUMFP",241,0)
 Q VALUE_$TR(TEXT,"~",HLCS)
"RTN","XUMFP",242,0)
 ;
"RTN","XUMFPMFS")
0^5^B18122564
"RTN","XUMFPMFS",1,0)
XUMFPMFS ;CIOFO-SF/RAM - Master File Param GENERIC ;06/28/00
"RTN","XUMFPMFS",2,0)
 ;;8.0;KERNEL;**262**;Jul 10, 1995
"RTN","XUMFPMFS",3,0)
 ;
"RTN","XUMFPMFS",4,0)
 ; This routine sets up the parameters required by the ZL7
"RTN","XUMFPMFS",5,0)
 ; for the Master File server mechanism.
"RTN","XUMFPMFS",6,0)
 ;
"RTN","XUMFPMFS",7,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFPMFS",8,0)
 ;
"RTN","XUMFPMFS",9,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFPMFS",10,0)
 ;
"RTN","XUMFPMFS",11,0)
 N PKV,PROTOCOL,HLFS,HLCS,RT,RF,TABLE,TABNAM
"RTN","XUMFPMFS",12,0)
 ;
"RTN","XUMFPMFS",13,0)
 D FILE^DID(IFN,"","NAME","X")
"RTN","XUMFPMFS",14,0)
 S TABNAM=$S($G(X("NAME"))'="":X("NAME"),1:"NOTAB") K X
"RTN","XUMFPMFS",15,0)
 ;
"RTN","XUMFPMFS",16,0)
 S PARAM("PRE")="PRE^XUMFPMFS"
"RTN","XUMFPMFS",17,0)
 S PARAM("POST")="POST^XUMFPMFS"
"RTN","XUMFPMFS",18,0)
 ;
"RTN","XUMFPMFS",19,0)
 I $O(HL(""))="" D
"RTN","XUMFPMFS",20,0)
 .S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFPMFS",21,0)
 .S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFPMFS",22,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFPMFS",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFPMFS",24,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFPMFS",25,0)
 ;
"RTN","XUMFPMFS",26,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFPMFS",27,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFPMFS",28,0)
 ;
"RTN","XUMFPMFS",29,0)
 D
"RTN","XUMFPMFS",30,0)
 .I IFN=4.11 S TABLE="ZAG" Q
"RTN","XUMFPMFS",31,0)
 .I IFN=5 S TABLE="Z05" Q
"RTN","XUMFPMFS",32,0)
 .I IFN=49 S TABLE="Z49" Q
"RTN","XUMFPMFS",33,0)
 .S TABLE="NOTAB" Q
"RTN","XUMFPMFS",34,0)
 ;
"RTN","XUMFPMFS",35,0)
 I QUERY D QRD
"RTN","XUMFPMFS",36,0)
 ;
"RTN","XUMFPMFS",37,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFPMFS",38,0)
 ;
"RTN","XUMFPMFS",39,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")=TABLE  ;Master File Identifier
"RTN","XUMFPMFS",40,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFPMFS",41,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFPMFS",42,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFPMFS",43,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFPMFS",44,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFPMFS",45,0)
 ;
"RTN","XUMFPMFS",46,0)
 ; MFE -- Master File Entry
"RTN","XUMFPMFS",47,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFPMFS",48,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFPMFS",49,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFPMFS",50,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFPMFS",51,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPMFS",52,0)
 ;
"RTN","XUMFPMFS",53,0)
SEG ; -- ZL7 segment
"RTN","XUMFPMFS",54,0)
 ;
"RTN","XUMFPMFS",55,0)
 I IEN D
"RTN","XUMFPMFS",56,0)
 .S PKV=$P($G(@ROOT@(+IEN,0)),U)_HLCS_TABNAM_HLCS_"B"
"RTN","XUMFPMFS",57,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPMFS",58,0)
 I NEW D
"RTN","XUMFPMFS",59,0)
 .S PKV="NEW"_HLCS_TABNAM_HLCS_"B"
"RTN","XUMFPMFS",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPMFS",61,0)
 ;
"RTN","XUMFPMFS",62,0)
 D @(TABLE_"^XUMFPZL7")
"RTN","XUMFPMFS",63,0)
 ;
"RTN","XUMFPMFS",64,0)
 Q:'GROUP
"RTN","XUMFPMFS",65,0)
 Q:$G(HL("MTN"))="MFR"
"RTN","XUMFPMFS",66,0)
 ;
"RTN","XUMFPMFS",67,0)
GROUP ; -- query group
"RTN","XUMFPMFS",68,0)
 ;
"RTN","XUMFPMFS",69,0)
 S IEN=0
"RTN","XUMFPMFS",70,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFPMFS",71,0)
 .S PKV=$P(@ROOT@(IEN,0),U)_HLCS_TABNAM_HLCS_"B"
"RTN","XUMFPMFS",72,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFPMFS",73,0)
 ;
"RTN","XUMFPMFS",74,0)
 Q
"RTN","XUMFPMFS",75,0)
 ;
"RTN","XUMFPMFS",76,0)
QRD ; -- query definition segment
"RTN","XUMFPMFS",77,0)
 ;
"RTN","XUMFPMFS",78,0)
 ;Query Date/Time
"RTN","XUMFPMFS",79,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFPMFS",80,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPMFS",81,0)
 ;
"RTN","XUMFPMFS",82,0)
 ;Query Format Code
"RTN","XUMFPMFS",83,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFPMFS",84,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFPMFS",85,0)
 ;
"RTN","XUMFPMFS",86,0)
 ;Query Priority
"RTN","XUMFPMFS",87,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFPMFS",88,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFPMFS",89,0)
 ;
"RTN","XUMFPMFS",90,0)
 ;Query ID
"RTN","XUMFPMFS",91,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFPMFS",92,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")=TABLE_" "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFPMFS",93,0)
 ;
"RTN","XUMFPMFS",94,0)
 ;Deferred Response Type (optional)
"RTN","XUMFPMFS",95,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFPMFS",96,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFPMFS",97,0)
 ;
"RTN","XUMFPMFS",98,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFPMFS",99,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFPMFS",100,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFPMFS",101,0)
 ;
"RTN","XUMFPMFS",102,0)
 ;Quantity Limited Request
"RTN","XUMFPMFS",103,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFPMFS",104,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_99999
"RTN","XUMFPMFS",105,0)
 ;
"RTN","XUMFPMFS",106,0)
 ;Who Subject Filter
"RTN","XUMFPMFS",107,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFPMFS",108,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(@ROOT@(+IEN,0)),U),1:"IEN ARRAY")
"RTN","XUMFPMFS",109,0)
 .S $P(X,HLCS,9,10)="B"_HLCS_"VA"
"RTN","XUMFPMFS",110,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFPMFS",111,0)
 ;
"RTN","XUMFPMFS",112,0)
 ;What Subject Filter
"RTN","XUMFPMFS",113,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFPMFS",114,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")=IFN_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFPMFS",115,0)
 ;
"RTN","XUMFPMFS",116,0)
 ;What Department Data Code
"RTN","XUMFPMFS",117,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFPMFS",118,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFPMFS",119,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFPMFS",120,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFPMFS",121,0)
 ;
"RTN","XUMFPMFS",122,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFPMFS",123,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFPMFS",124,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFPMFS",125,0)
 ;
"RTN","XUMFPMFS",126,0)
 ;Query Results Level (optional)
"RTN","XUMFPMFS",127,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFPMFS",128,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFPMFS",129,0)
 ;
"RTN","XUMFPMFS",130,0)
 Q
"RTN","XUMFPMFS",131,0)
 ;
"RTN","XUMFPMFS",132,0)
PRE ; -- pre-update record
"RTN","XUMFPMFS",133,0)
 ;
"RTN","XUMFPMFS",134,0)
 Q
"RTN","XUMFPMFS",135,0)
 ;
"RTN","XUMFPMFS",136,0)
POST ; -- post-update record
"RTN","XUMFPMFS",137,0)
 ;
"RTN","XUMFPMFS",138,0)
 Q
"RTN","XUMFPMFS",139,0)
 ;
"RTN","XUMFPZL7")
0^2^B2126203
"RTN","XUMFPZL7",1,0)
XUMFPZL7 ;CIOFO-SF/RAM - Master File Param ZL7 ;06/28/00
"RTN","XUMFPZL7",2,0)
 ;;8.0;KERNEL;**262**;Jul 10, 1995
"RTN","XUMFPZL7",3,0)
 ;
"RTN","XUMFPZL7",4,0)
 ;
"RTN","XUMFPZL7",5,0)
Z05 ; State (#5)
"RTN","XUMFPZL7",6,0)
 ;
"RTN","XUMFPZL7",7,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.1,1)="ST"
"RTN","XUMFPZL7",8,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.2,.01)="ST"
"RTN","XUMFPZL7",9,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.4,2)="ST"
"RTN","XUMFPZL7",10,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.5,.01)="ST"
"RTN","XUMFPZL7",11,0)
 ;
"RTN","XUMFPZL7",12,0)
 Q
"RTN","XUMFPZL7",13,0)
 ;
"RTN","XUMFPZL7",14,0)
Z49 ; Service/Section (#49)
"RTN","XUMFPZL7",15,0)
 ;
"RTN","XUMFPZL7",16,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.1,.01)="ST"
"RTN","XUMFPZL7",17,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.2,1)="ST"
"RTN","XUMFPZL7",18,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",3,1.6)="ST"
"RTN","XUMFPZL7",19,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",4,6)="ST"
"RTN","XUMFPZL7",20,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",5,1.5)="ST"
"RTN","XUMFPZL7",21,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",6,1.7)="ST"
"RTN","XUMFPZL7",22,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",7,730)="ST"
"RTN","XUMFPZL7",23,0)
 ;
"RTN","XUMFPZL7",24,0)
 Q
"RTN","XUMFPZL7",25,0)
 ;
"RTN","XUMFPZL7",26,0)
ZAG ; Agency (#4.11)
"RTN","XUMFPZL7",27,0)
 ;
"RTN","XUMFPZL7",28,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.1,.02)="ST"
"RTN","XUMFPZL7",29,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZL7","SEQ",1.2,.01)="ST"
"RTN","XUMFPZL7",30,0)
 ;
"RTN","XUMFPZL7",31,0)
NOTAB ;
"RTN","XUMFPZL7",32,0)
 ;
"RTN","XUMFPZL7",33,0)
 Q
"RTN","XUMFPZL7",34,0)
 ;
"VER")
8.0^22.0
**END**
**END**
