Released PSO*7*161 SEQ #176
Extracted from mail message
**KIDS**:PSO*7.0*161^

**INSTALL NAME**
PSO*7.0*161
"BLD",4853,0)
PSO*7.0*161^OUTPATIENT PHARMACY^0^3050209^y
"BLD",4853,1,0)
^^168^168^3050114^
"BLD",4853,1,1,0)
This patch is part of the Outpatient Pharmacy V. 7.0 Laser Labels
"BLD",4853,1,2,0)
Phase II project for printing prescription labels.
"BLD",4853,1,3,0)
 
"BLD",4853,1,4,0)
***** NOTE TO SITES USING AUTOMATED FILLING EQUIPMENT *****
"BLD",4853,1,5,0)
This patch changes the format and content of the laser labels print 
"BLD",4853,1,6,0)
stream. If you are using automated dispensing equipment that relies on 
"BLD",4853,1,7,0)
the data stream sent to the laser labels port, you have 2 options:
"BLD",4853,1,8,0)
  1. Implement the Outpatient Automation Interface (OPAI) (available with
"BLD",4853,1,9,0)
     released patch PSO*7*156) or 
"BLD",4853,1,10,0)
  2. Contact your vendor to make adjustments based on the new data stream.
"BLD",4853,1,11,0)
 
"BLD",4853,1,12,0)
Although implementing OPAI is not mandated at this time, it is expected 
"BLD",4853,1,13,0)
to be in the future, so option 1 is the preferred solution. By 
"BLD",4853,1,14,0)
implementing OPAI, future changes to the label format will not affect the 
"BLD",4853,1,15,0)
dispensing equipment interface.
"BLD",4853,1,16,0)
*************************************************************************
"BLD",4853,1,17,0)
 
"BLD",4853,1,18,0)
To fully implement all portions of the new functionality, the 
"BLD",4853,1,19,0)
following are needed:
"BLD",4853,1,20,0)
  1. Patch PSS*1*87 from Pharmacy Data Management V. 1.0 (PDM),to provide 
"BLD",4853,1,21,0)
an API for retrieving warning labels from the new data source.
"BLD",4853,1,22,0)
  2. Patches PSN*4*86 and PSN*4*88 from the National Drug File V. 4.0
"BLD",4853,1,23,0)
(NDF) to create and populate a new gender field in the WARNING
"BLD",4853,1,24,0)
LABEL-ENGLISH file (#50.625) and the WARNING LABEL-SPANISH file (#50.626).
"BLD",4853,1,25,0)
  3. Patch PSX*2*54 from the Consolidated Mail Outpatient Pharmacy V. 2.0
"BLD",4853,1,26,0)
(CMOP) to modify the way warnings are sent to CMOP.
"BLD",4853,1,27,0)
 
"BLD",4853,1,28,0)
 
"BLD",4853,1,29,0)
 This patch includes:
"BLD",4853,1,30,0)
  1. Referencing a new commercial data source for printing prescription 
"BLD",4853,1,31,0)
warning labels.        
"BLD",4853,1,32,0)
  2. Printing warning labels and Patient Information Sheets (PMI) by the
"BLD",4853,1,33,0)
patient's PMI language preference setting.
"BLD",4853,1,34,0)
  3. A new MAILING COMMENTS field (#.081) is added to the OUTPATIENT SITE
"BLD",4853,1,35,0)
file (#59.7) to be used for a site to enter anything they would like to 
"BLD",4853,1,36,0)
show on the Mail Address label. (i.e. whether mailing is "Forwarding 
"BLD",4853,1,37,0)
service requested" or  "Address service requested"). The PSO SITE INPUT 
"BLD",4853,1,38,0)
TEMPLATE for the OUTPATIENT SITE file (#59.7) is changed to allow the 
"BLD",4853,1,39,0)
input of data into the new mailing comments.
"BLD",4853,1,40,0)
  4. A new Manual Print of Multi-Rx Forms [PSO LM MULTI-RX PRINT] option
"BLD",4853,1,41,0)
is added under the Rx (Prescriptions) [PSO RX] option as well as under 
"BLD",4853,1,42,0)
the OTH hidden action while in the patient's profile to reprint the 
"BLD",4853,1,43,0)
Multi-Rx Refill Request form on laser label stock without having to
"BLD",4853,1,44,0)
reprint the entire prescription's labels. The functionality is also
"BLD",4853,1,45,0)
changed to stop printing the Multi-Rx refill form on reprints.
"BLD",4853,1,46,0)
  5. Various changes to the content/format of the labels - detailed below
"BLD",4853,1,47,0)
under each label section.
"BLD",4853,1,48,0)
  6. Correction to only print one ScripTalk label when SIG is continued.
"BLD",4853,1,49,0)
(NOIS CLE-0304-40723. (The other part of this NOIS is addressed in patch
"BLD",4853,1,50,0)
PSO*7*182, so this NOIS is not included in the associated patch list 
"BLD",4853,1,51,0)
below)).
"BLD",4853,1,52,0)
  7. A new Signature Log Reprint [PSO SIGLOG REPRINT] option is added
"BLD",4853,1,53,0)
under the Rx (Prescriptions) [PSO RX] option. (Added for HIPAA/NCPDP).
"BLD",4853,1,54,0)
  8. A change was made to not keep exact duplicates of the control code 
"BLD",4853,1,55,0)
settings (e.g. when running the set-up routine as a test site and again 
"BLD",4853,1,56,0)
when the patch is installed in production). NOIS PUG-1103-52110
"BLD",4853,1,57,0)
  9. The other NOIS's listed below were for items already included in the
"BLD",4853,1,58,0)
Laser Labels Phase II specifications.
"BLD",4853,1,59,0)
 
"BLD",4853,1,60,0)
Bottle label section changes:
"BLD",4853,1,61,0)
============================
"BLD",4853,1,62,0)
  1. Currently long SIG's that do not fit on one bottle label print only 4
"BLD",4853,1,63,0)
lines of SIG on the first bottle label and up to 4 lines on each 
"BLD",4853,1,64,0)
continuation label. This patch increases the number of lines of the SIG 
"BLD",4853,1,65,0)
that print on each bottle label to reduce the total number of labels
"BLD",4853,1,66,0)
needed. This also will allow the overlapping of the multiple labels on the
"BLD",4853,1,67,0)
bottle to eliminate the need for cutting the labels to make them fit.
"BLD",4853,1,68,0)
  2. The text "Mfr_________" will print for all prescriptions on the same 
"BLD",4853,1,69,0)
line as the "Discard after" information.
"BLD",4853,1,70,0)
  3. The text "May refill nX by MMM DD,YYYY" or "NO REFILLS LEFT" or "NO 
"BLD",4853,1,71,0)
REFILL" was added between the "Discard after..." line and the Qty: line.
"BLD",4853,1,72,0)
  4. On the trailing documents, a signature log will print in the bottle 
"BLD",4853,1,73,0)
label section for the patient to sign for the medications received. 
"BLD",4853,1,74,0)
(Added for HIPAA/NCPDP).
"BLD",4853,1,75,0)
  
"BLD",4853,1,76,0)
Warning label section changes:
"BLD",4853,1,77,0)
=============================
"BLD",4853,1,78,0)
  1. A new API will be called to determine which warnings to print.
"BLD",4853,1,79,0)
  2. Warnings will print in English or Spanish depending on the patient's 
"BLD",4853,1,80,0)
PMI preference.
"BLD",4853,1,81,0)
  3. If there are fewer than five warning labels, the warning labels will 
"BLD",4853,1,82,0)
be bottom-justified.
"BLD",4853,1,83,0)
  4. If the DEA, SPECIAL HDLG field (#3) in the DRUG file (#50) begins
"BLD",4853,1,84,0)
with numbers 1,2,3,4 or 5. The NO TRANSFER warning label from the RX
"BLD",4853,1,85,0)
CONSULT file (#54) entry number 20 will print in the appropriate 
"BLD",4853,1,86,0)
language.
"BLD",4853,1,87,0)
  5. The new data source contains some lengthy warnings, especially the 
"BLD",4853,1,88,0)
Spanish translation. For the smallest font, this patch allows a 4th line
"BLD",4853,1,89,0)
of text to print, if needed.
"BLD",4853,1,90,0)
  6. The top warning label was sometimes printing on or over the 
"BLD",4853,1,91,0)
perforated line. For some fonts, this patch reduces the white space 
"BLD",4853,1,92,0)
between the lines of the first warning to make it fit.
"BLD",4853,1,93,0)
 
"BLD",4853,1,94,0)
Mail address section changes:
"BLD",4853,1,95,0)
============================
"BLD",4853,1,96,0)
  1. The current date will print in the upper right corner.
"BLD",4853,1,97,0)
  2. If there are any mailing comments defined, they will print after the 
"BLD",4853,1,98,0)
MAIL field (#.03) of the PHARMACY PATIENT file (#55).
"BLD",4853,1,99,0)
  3. Patient name will print first name first instead of 
"BLD",4853,1,100,0)
lastname,firstname.
"BLD",4853,1,101,0)
  4. When the routing is "Window", the word "Window" will be bolded.
"BLD",4853,1,102,0)
 
"BLD",4853,1,103,0)
Pharmacy fill card section changes:
"BLD",4853,1,104,0)
==================================
"BLD",4853,1,105,0)
  1. Seconds will be removed from the label date/time.
"BLD",4853,1,106,0)
  2. A new API will return the text for the DRUG WARNING list. The DRUG 
"BLD",4853,1,107,0)
WARNING entries will be separated by commas. If an entry in the list does 
"BLD",4853,1,108,0)
not have an "N" (for "New"), it is from the RX CONSULT file (#54).
"BLD",4853,1,109,0)
Otherwise it is from the WARNING LABEL-ENGLISH (#50.625) or the 
"BLD",4853,1,110,0)
WARNING LABEL-SPANISH (#50.626) file.
"BLD",4853,1,111,0)
  3. A new line containing the patient location and status is being added
"BLD",4853,1,112,0)
beneath the DRUG WARNING list, so the list is being moved up slightly on
"BLD",4853,1,113,0)
the label.
"BLD",4853,1,114,0)
  4. Patient name and last portion of the social security number are 
"BLD",4853,1,115,0)
bolded.
"BLD",4853,1,116,0)
  5. If the bottle cap is "non-safety", it will be bolded.
"BLD",4853,1,117,0)
  6. Currently long SIG's that do not fit on one pharmacy fill card label
"BLD",4853,1,118,0)
print only 4 lines of SIG on the first label and up to 4 lines on each
"BLD",4853,1,119,0)
continuation label. This patch increases the number of lines of the SIG 
"BLD",4853,1,120,0)
that print on each pharmacy fill card label to reduce the total number of
"BLD",4853,1,121,0)
labels needed.
"BLD",4853,1,122,0)
  7. The words "3rd Party Rx" and the NDC number are added when that 
"BLD",4853,1,123,0)
information is available. (Added for HIPAA/NCPDP).
"BLD",4853,1,124,0)
 
"BLD",4853,1,125,0)
Patient fill section changes:
"BLD",4853,1,126,0)
============================
"BLD",4853,1,127,0)
  1. The barcode will print every time even if there are no refills.
"BLD",4853,1,128,0)
  2. The site telephone number will print when the "PHONE IN OR MAIL THIS 
"BLD",4853,1,129,0)
REFILL REQUEST" prints.
"BLD",4853,1,130,0)
  3. The text "n refills left until MMM DD,YYYY is changed to "May refill 
"BLD",4853,1,131,0)
nX by MMM DD,YYYY".
"BLD",4853,1,132,0)
 
"BLD",4853,1,133,0)
Prescription Document PMI section changes:
"BLD",4853,1,134,0)
=========================================
"BLD",4853,1,135,0)
  1. The PMI will print in the patient's language preference.
"BLD",4853,1,136,0)
  2. The white spaces between sections of the PMI document will be 
"BLD",4853,1,137,0)
reduced to result in a few more lines fitting on the page.
"BLD",4853,1,138,0)
  3. If there are more than 5 warning labels, the additional warnings 
"BLD",4853,1,139,0)
will print at the top of the PMI section.
"BLD",4853,1,140,0)
 
"BLD",4853,1,141,0)
Trailing document changes:
"BLD",4853,1,142,0)
=========================
"BLD",4853,1,143,0)
  1. The patient's phone number followed by an underline will print on 
"BLD",4853,1,144,0)
the address change form.
"BLD",4853,1,145,0)
  2. In the Allergies/ADR section, the name and last six digits of the 
"BLD",4853,1,146,0)
social security number will be made larger and will be bolded.
"BLD",4853,1,147,0)
  3. In the Allergies/ADR section, if the HOSPITAL LOCATION file (#44), 
"BLD",4853,1,148,0)
TYPE field (#2) type equals "W" for any prescription printed for this 
"BLD",4853,1,149,0)
patient in the current print job, then the word "INPATIENT" will print 
"BLD",4853,1,150,0)
on the line following the patient name.
"BLD",4853,1,151,0)
  4. In the Allergies/ADR section, if some sections do not have data, the 
"BLD",4853,1,152,0)
header will not print. If no information exists, "No Assessment Made" 
"BLD",4853,1,153,0)
will print after the Verified Allergies heading.
"BLD",4853,1,154,0)
  5. In the refill narrative or copay narrative sections, if there are 
"BLD",4853,1,155,0)
more than seven lines from the original text, only the first seven lines 
"BLD",4853,1,156,0)
will print. (They could appear as more than seven lines if there is some 
"BLD",4853,1,157,0)
wrapping of the text).
"BLD",4853,1,158,0)
  6. If the Multi-Rx refill section is blank, the SITE NUMBER field 
"BLD",4853,1,159,0)
(#.06) from the OUTPATIENT SITE file (#59) will print bottom right
"BLD",4853,1,160,0)
justified.
"BLD",4853,1,161,0)
 
"BLD",4853,1,162,0)
A utility routine is included in this patch to change some of the control
"BLD",4853,1,163,0)
codes in the TERMINAL TYPE file (#3.2). 
"BLD",4853,1,164,0)
Once the patch is installed, running the routine PSOLLU4 in programmer
"BLD",4853,1,165,0)
mode will make slight adjustments to PATIENT FILL INITIALIZATION, 
"BLD",4853,1,166,0)
PHARMACY FILL DOCUMENT WARNING, MAILING LABEL INITIALIZATION, and RETURN 
"BLD",4853,1,167,0)
MAIL INITIALIZATION settings.
"BLD",4853,1,168,0)
Note: you must have your FileMan access set to '@' to run the routine. 
"BLD",4853,4,0)
^9.64PA^59^1
"BLD",4853,4,59,0)
59
"BLD",4853,4,59,2,0)
^9.641^59^1
"BLD",4853,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",4853,4,59,2,59,1,0)
^9.6411^.081^1
"BLD",4853,4,59,2,59,1,.081,0)
MAILING COMMENTS
"BLD",4853,4,59,222)
y^n^p^^^^n^^n
"BLD",4853,4,59,224)

"BLD",4853,4,"APDD",59,59)

"BLD",4853,4,"APDD",59,59,.081)

"BLD",4853,4,"B",59,59)

"BLD",4853,"ABPKG")
n
"BLD",4853,"INID")
^
"BLD",4853,"INIT")

"BLD",4853,"KRN",0)
^9.67PA^8989.52^19
"BLD",4853,"KRN",.4,0)
.4
"BLD",4853,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4853,"KRN",.401,0)
.401
"BLD",4853,"KRN",.402,0)
.402
"BLD",4853,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",4853,"KRN",.402,"NM",1,0)
PSO SITE    FILE #59^59^0
"BLD",4853,"KRN",.402,"NM","B","PSO SITE    FILE #59",1)

"BLD",4853,"KRN",.403,0)
.403
"BLD",4853,"KRN",.5,0)
.5
"BLD",4853,"KRN",.84,0)
.84
"BLD",4853,"KRN",3.6,0)
3.6
"BLD",4853,"KRN",3.8,0)
3.8
"BLD",4853,"KRN",9.2,0)
9.2
"BLD",4853,"KRN",9.8,0)
9.8
"BLD",4853,"KRN",9.8,"NM",0)
^9.68A^14^13
"BLD",4853,"KRN",9.8,"NM",1,0)
PSOLLL1^^0^B61663989
"BLD",4853,"KRN",9.8,"NM",2,0)
PSOLLL2^^0^B14143460
"BLD",4853,"KRN",9.8,"NM",3,0)
PSOLLL3^^0^B8577417
"BLD",4853,"KRN",9.8,"NM",4,0)
PSOLLL4^^0^B10398176
"BLD",4853,"KRN",9.8,"NM",5,0)
PSOLLL5^^0^B35859905
"BLD",4853,"KRN",9.8,"NM",6,0)
PSOLLL6^^0^B9729924
"BLD",4853,"KRN",9.8,"NM",7,0)
PSOLLL7^^0^B34188197
"BLD",4853,"KRN",9.8,"NM",8,0)
PSOLLLI^^0^B65332955
"BLD",4853,"KRN",9.8,"NM",9,0)
PSOLLU1^^0^B21617128
"BLD",4853,"KRN",9.8,"NM",11,0)
PSOLLLW^^0^B21762349
"BLD",4853,"KRN",9.8,"NM",12,0)
PSOLLU4^^0^B7683553
"BLD",4853,"KRN",9.8,"NM",13,0)
PSOLLL9^^0^B7464651
"BLD",4853,"KRN",9.8,"NM",14,0)
PSOLLLH^^0^B24388422
"BLD",4853,"KRN",9.8,"NM","B","PSOLLL1",1)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL2",2)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL3",3)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL4",4)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL5",5)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL6",6)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL7",7)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLL9",13)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLLH",14)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLLI",8)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLLW",11)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLU1",9)

"BLD",4853,"KRN",9.8,"NM","B","PSOLLU4",12)

"BLD",4853,"KRN",19,0)
19
"BLD",4853,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",4853,"KRN",19,"NM",1,0)
PSO RX^^2
"BLD",4853,"KRN",19,"NM",2,0)
PSO LM MULTI-RX PRINT^^0
"BLD",4853,"KRN",19,"NM",3,0)
PSO SIGLOG REPRINT^^0
"BLD",4853,"KRN",19,"NM","B","PSO LM MULTI-RX PRINT",2)

"BLD",4853,"KRN",19,"NM","B","PSO RX",1)

"BLD",4853,"KRN",19,"NM","B","PSO SIGLOG REPRINT",3)

"BLD",4853,"KRN",19.1,0)
19.1
"BLD",4853,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4853,"KRN",101,0)
101
"BLD",4853,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",4853,"KRN",101,"NM",1,0)
PSO LM HIDDEN OTHER^^2
"BLD",4853,"KRN",101,"NM",2,0)
PSO LM MULTI-RX PRINT^^0
"BLD",4853,"KRN",101,"NM","B","PSO LM HIDDEN OTHER",1)

"BLD",4853,"KRN",101,"NM","B","PSO LM MULTI-RX PRINT",2)

"BLD",4853,"KRN",409.61,0)
409.61
"BLD",4853,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4853,"KRN",771,0)
771
"BLD",4853,"KRN",771,"NM",0)
^9.68A^^
"BLD",4853,"KRN",870,0)
870
"BLD",4853,"KRN",870,"NM",0)
^9.68A^^
"BLD",4853,"KRN",8989.51,0)
8989.51
"BLD",4853,"KRN",8989.52,0)
8989.52
"BLD",4853,"KRN",8994,0)
8994
"BLD",4853,"KRN","B",.4,.4)

"BLD",4853,"KRN","B",.401,.401)

"BLD",4853,"KRN","B",.402,.402)

"BLD",4853,"KRN","B",.403,.403)

"BLD",4853,"KRN","B",.5,.5)

"BLD",4853,"KRN","B",.84,.84)

"BLD",4853,"KRN","B",3.6,3.6)

"BLD",4853,"KRN","B",3.8,3.8)

"BLD",4853,"KRN","B",9.2,9.2)

"BLD",4853,"KRN","B",9.8,9.8)

"BLD",4853,"KRN","B",19,19)

"BLD",4853,"KRN","B",19.1,19.1)

"BLD",4853,"KRN","B",101,101)

"BLD",4853,"KRN","B",409.61,409.61)

"BLD",4853,"KRN","B",771,771)

"BLD",4853,"KRN","B",870,870)

"BLD",4853,"KRN","B",8989.51,8989.51)

"BLD",4853,"KRN","B",8989.52,8989.52)

"BLD",4853,"KRN","B",8994,8994)

"BLD",4853,"QUES",0)
^9.62^^
"BLD",4853,"REQB",0)
^9.611^5^4
"BLD",4853,"REQB",1,0)
PSS*1.0*87^2
"BLD",4853,"REQB",3,0)
PSN*4.0*84^2
"BLD",4853,"REQB",4,0)
PSO*7.0*189^2
"BLD",4853,"REQB",5,0)
PSO*7.0*162^2
"BLD",4853,"REQB","B","PSN*4.0*84",3)

"BLD",4853,"REQB","B","PSO*7.0*162",5)

"BLD",4853,"REQB","B","PSO*7.0*189",4)

"BLD",4853,"REQB","B","PSS*1.0*87",1)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^n^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,.081)

"KRN",.402,1379,-1)
0^1
"KRN",.402,1379,0)
PSO SITE^3041123.1328^^59^^^3041208
"KRN",.402,1379,"DIAB",1,1,59.02008,0)
ALL
"KRN",.402,1379,"DR",1,59)
.01:.081;2004;.09:.091;.1:.18;.2:.52;3:5;2008;6:7;105;105.1;105.2;2006;2007;8;100;109;1000;1001;1002;2001;2002;1003;1004;1005;1006;2005;
"KRN",.402,1379,"DR",2,59.02008)
.01
"KRN",.402,1379,"DR",2,59.08)
.01;1;
"KRN",19,248,-1)
2^1
"KRN",19,248,0)
PSO RX^Rx (Prescriptions)^^M^11712^^^^^^^141^^1^
"KRN",19,248,10,0)
^19.01IP^21^10
"KRN",19,248,10,20,0)
12557
"KRN",19,248,10,20,"^")
PSO LM MULTI-RX PRINT
"KRN",19,248,10,21,0)
12670
"KRN",19,248,10,21,"^")
PSO SIGLOG REPRINT
"KRN",19,248,10,"A6359",1)
New Prescription Entry^449^^
"KRN",19,248,10,"A6359",2)
Refill Prescriptions^459^^
"KRN",19,248,10,"A6359",3)
Edit Prescriptions^469^^
"KRN",19,248,10,"A6359",4)
Reprint An Outpatient Label^470^^
"KRN",19,248,10,"A6359",5)
View Prescriptions^475^^
"KRN",19,248,10,"A6359",6)
Cancel Prescription^476^^
"KRN",19,248,10,"A6359",7)
Hold/Remove from Hold^479^^
"KRN",19,248,10,"A6359",8)
Partial Prescription^478^^
"KRN",19,248,"U")
RX (PRESCRIPTIONS)
"KRN",19,12557,-1)
0^2
"KRN",19,12557,0)
PSO LM MULTI-RX PRINT^Manual Print of Multi-Rx Forms^^A^^^^^^^^OUTPATIENT PHARMACY^^1^1
"KRN",19,12557,1,0)
^19.06^2^2^3041110^^^^
"KRN",19,12557,1,1,0)
This option is used to print a patient's Multi-Rx refill request form 
"KRN",19,12557,1,2,0)
independently from laser labels prescription printing.
"KRN",19,12557,15)
Q
"KRN",19,12557,20)
D QUEUE^PSOLLL7
"KRN",19,12557,"U")
MANUAL PRINT OF MULTI-RX FORMS
"KRN",19,12670,-1)
0^3
"KRN",19,12670,0)
PSO SIGLOG REPRINT^Signature Log Reprint^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,12670,1,0)
^^2^2^3041110^
"KRN",19,12670,1,1,0)
This option is used to reprint a laser label signature log for the 
"KRN",19,12670,1,2,0)
patient to sign for his prescription.
"KRN",19,12670,25)
QUEUE^PSOLLLH
"KRN",19,12670,"U")
SIGNATURE LOG REPRINT
"KRN",101,3842,-1)
2^1
"KRN",101,3842,0)
PSO LM HIDDEN OTHER^Other OP Actions^^M^10000000058^^^^^^^141
"KRN",101,3842,10,0)
^101.01PA^5^5
"KRN",101,3842,10,4,0)
5145^MR^^
"KRN",101,3842,10,4,"^")
PSO LM MULTI-RX PRINT
"KRN",101,5145,-1)
0^2
"KRN",101,5145,0)
PSO LM MULTI-RX PRINT^Multi-Rx Request Print^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5145,15)
Q
"KRN",101,5145,20)
D QUEUE^PSOLLL7
"KRN",101,5145,99)
59675,54494
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
161^3050209
"PKG",141,22,1,"PAH",1,1,0)
^^168^168^3050209
"PKG",141,22,1,"PAH",1,1,1,0)
This patch is part of the Outpatient Pharmacy V. 7.0 Laser Labels
"PKG",141,22,1,"PAH",1,1,2,0)
Phase II project for printing prescription labels.
"PKG",141,22,1,"PAH",1,1,3,0)
 
"PKG",141,22,1,"PAH",1,1,4,0)
***** NOTE TO SITES USING AUTOMATED FILLING EQUIPMENT *****
"PKG",141,22,1,"PAH",1,1,5,0)
This patch changes the format and content of the laser labels print 
"PKG",141,22,1,"PAH",1,1,6,0)
stream. If you are using automated dispensing equipment that relies on 
"PKG",141,22,1,"PAH",1,1,7,0)
the data stream sent to the laser labels port, you have 2 options:
"PKG",141,22,1,"PAH",1,1,8,0)
  1. Implement the Outpatient Automation Interface (OPAI) (available with
"PKG",141,22,1,"PAH",1,1,9,0)
     released patch PSO*7*156) or 
"PKG",141,22,1,"PAH",1,1,10,0)
  2. Contact your vendor to make adjustments based on the new data stream.
"PKG",141,22,1,"PAH",1,1,11,0)
 
"PKG",141,22,1,"PAH",1,1,12,0)
Although implementing OPAI is not mandated at this time, it is expected 
"PKG",141,22,1,"PAH",1,1,13,0)
to be in the future, so option 1 is the preferred solution. By 
"PKG",141,22,1,"PAH",1,1,14,0)
implementing OPAI, future changes to the label format will not affect the 
"PKG",141,22,1,"PAH",1,1,15,0)
dispensing equipment interface.
"PKG",141,22,1,"PAH",1,1,16,0)
*************************************************************************
"PKG",141,22,1,"PAH",1,1,17,0)
 
"PKG",141,22,1,"PAH",1,1,18,0)
To fully implement all portions of the new functionality, the 
"PKG",141,22,1,"PAH",1,1,19,0)
following are needed:
"PKG",141,22,1,"PAH",1,1,20,0)
  1. Patch PSS*1*87 from Pharmacy Data Management V. 1.0 (PDM),to provide 
"PKG",141,22,1,"PAH",1,1,21,0)
an API for retrieving warning labels from the new data source.
"PKG",141,22,1,"PAH",1,1,22,0)
  2. Patches PSN*4*86 and PSN*4*88 from the National Drug File V. 4.0
"PKG",141,22,1,"PAH",1,1,23,0)
(NDF) to create and populate a new gender field in the WARNING
"PKG",141,22,1,"PAH",1,1,24,0)
LABEL-ENGLISH file (#50.625) and the WARNING LABEL-SPANISH file (#50.626).
"PKG",141,22,1,"PAH",1,1,25,0)
  3. Patch PSX*2*54 from the Consolidated Mail Outpatient Pharmacy V. 2.0
"PKG",141,22,1,"PAH",1,1,26,0)
(CMOP) to modify the way warnings are sent to CMOP.
"PKG",141,22,1,"PAH",1,1,27,0)
 
"PKG",141,22,1,"PAH",1,1,28,0)
 
"PKG",141,22,1,"PAH",1,1,29,0)
 This patch includes:
"PKG",141,22,1,"PAH",1,1,30,0)
  1. Referencing a new commercial data source for printing prescription 
"PKG",141,22,1,"PAH",1,1,31,0)
warning labels.        
"PKG",141,22,1,"PAH",1,1,32,0)
  2. Printing warning labels and Patient Information Sheets (PMI) by the
"PKG",141,22,1,"PAH",1,1,33,0)
patient's PMI language preference setting.
"PKG",141,22,1,"PAH",1,1,34,0)
  3. A new MAILING COMMENTS field (#.081) is added to the OUTPATIENT SITE
"PKG",141,22,1,"PAH",1,1,35,0)
file (#59.7) to be used for a site to enter anything they would like to 
"PKG",141,22,1,"PAH",1,1,36,0)
show on the Mail Address label. (i.e. whether mailing is "Forwarding 
"PKG",141,22,1,"PAH",1,1,37,0)
service requested" or  "Address service requested"). The PSO SITE INPUT 
"PKG",141,22,1,"PAH",1,1,38,0)
TEMPLATE for the OUTPATIENT SITE file (#59.7) is changed to allow the 
"PKG",141,22,1,"PAH",1,1,39,0)
input of data into the new mailing comments.
"PKG",141,22,1,"PAH",1,1,40,0)
  4. A new Manual Print of Multi-Rx Forms [PSO LM MULTI-RX PRINT] option
"PKG",141,22,1,"PAH",1,1,41,0)
is added under the Rx (Prescriptions) [PSO RX] option as well as under 
"PKG",141,22,1,"PAH",1,1,42,0)
the OTH hidden action while in the patient's profile to reprint the 
"PKG",141,22,1,"PAH",1,1,43,0)
Multi-Rx Refill Request form on laser label stock without having to
"PKG",141,22,1,"PAH",1,1,44,0)
reprint the entire prescription's labels. The functionality is also
"PKG",141,22,1,"PAH",1,1,45,0)
changed to stop printing the Multi-Rx refill form on reprints.
"PKG",141,22,1,"PAH",1,1,46,0)
  5. Various changes to the content/format of the labels - detailed below
"PKG",141,22,1,"PAH",1,1,47,0)
under each label section.
"PKG",141,22,1,"PAH",1,1,48,0)
  6. Correction to only print one ScripTalk label when SIG is continued.
"PKG",141,22,1,"PAH",1,1,49,0)
(NOIS CLE-0304-40723. (The other part of this NOIS is addressed in patch
"PKG",141,22,1,"PAH",1,1,50,0)
PSO*7*182, so this NOIS is not included in the associated patch list 
"PKG",141,22,1,"PAH",1,1,51,0)
below)).
"PKG",141,22,1,"PAH",1,1,52,0)
  7. A new Signature Log Reprint [PSO SIGLOG REPRINT] option is added
"PKG",141,22,1,"PAH",1,1,53,0)
under the Rx (Prescriptions) [PSO RX] option. (Added for HIPAA/NCPDP).
"PKG",141,22,1,"PAH",1,1,54,0)
  8. A change was made to not keep exact duplicates of the control code 
"PKG",141,22,1,"PAH",1,1,55,0)
settings (e.g. when running the set-up routine as a test site and again 
"PKG",141,22,1,"PAH",1,1,56,0)
when the patch is installed in production). NOIS PUG-1103-52110
"PKG",141,22,1,"PAH",1,1,57,0)
  9. The other NOIS's listed below were for items already included in the
"PKG",141,22,1,"PAH",1,1,58,0)
Laser Labels Phase II specifications.
"PKG",141,22,1,"PAH",1,1,59,0)
 
"PKG",141,22,1,"PAH",1,1,60,0)
Bottle label section changes:
"PKG",141,22,1,"PAH",1,1,61,0)
============================
"PKG",141,22,1,"PAH",1,1,62,0)
  1. Currently long SIG's that do not fit on one bottle label print only 4
"PKG",141,22,1,"PAH",1,1,63,0)
lines of SIG on the first bottle label and up to 4 lines on each 
"PKG",141,22,1,"PAH",1,1,64,0)
continuation label. This patch increases the number of lines of the SIG 
"PKG",141,22,1,"PAH",1,1,65,0)
that print on each bottle label to reduce the total number of labels
"PKG",141,22,1,"PAH",1,1,66,0)
needed. This also will allow the overlapping of the multiple labels on the
"PKG",141,22,1,"PAH",1,1,67,0)
bottle to eliminate the need for cutting the labels to make them fit.
"PKG",141,22,1,"PAH",1,1,68,0)
  2. The text "Mfr_________" will print for all prescriptions on the same 
"PKG",141,22,1,"PAH",1,1,69,0)
line as the "Discard after" information.
"PKG",141,22,1,"PAH",1,1,70,0)
  3. The text "May refill nX by MMM DD,YYYY" or "NO REFILLS LEFT" or "NO 
"PKG",141,22,1,"PAH",1,1,71,0)
REFILL" was added between the "Discard after..." line and the Qty: line.
"PKG",141,22,1,"PAH",1,1,72,0)
  4. On the trailing documents, a signature log will print in the bottle 
"PKG",141,22,1,"PAH",1,1,73,0)
label section for the patient to sign for the medications received. 
"PKG",141,22,1,"PAH",1,1,74,0)
(Added for HIPAA/NCPDP).
"PKG",141,22,1,"PAH",1,1,75,0)
  
"PKG",141,22,1,"PAH",1,1,76,0)
Warning label section changes:
"PKG",141,22,1,"PAH",1,1,77,0)
=============================
"PKG",141,22,1,"PAH",1,1,78,0)
  1. A new API will be called to determine which warnings to print.
"PKG",141,22,1,"PAH",1,1,79,0)
  2. Warnings will print in English or Spanish depending on the patient's 
"PKG",141,22,1,"PAH",1,1,80,0)
PMI preference.
"PKG",141,22,1,"PAH",1,1,81,0)
  3. If there are fewer than five warning labels, the warning labels will 
"PKG",141,22,1,"PAH",1,1,82,0)
be bottom-justified.
"PKG",141,22,1,"PAH",1,1,83,0)
  4. If the DEA, SPECIAL HDLG field (#3) in the DRUG file (#50) begins
"PKG",141,22,1,"PAH",1,1,84,0)
with numbers 1,2,3,4 or 5. The NO TRANSFER warning label from the RX
"PKG",141,22,1,"PAH",1,1,85,0)
CONSULT file (#54) entry number 20 will print in the appropriate 
"PKG",141,22,1,"PAH",1,1,86,0)
language.
"PKG",141,22,1,"PAH",1,1,87,0)
  5. The new data source contains some lengthy warnings, especially the 
"PKG",141,22,1,"PAH",1,1,88,0)
Spanish translation. For the smallest font, this patch allows a 4th line
"PKG",141,22,1,"PAH",1,1,89,0)
of text to print, if needed.
"PKG",141,22,1,"PAH",1,1,90,0)
  6. The top warning label was sometimes printing on or over the 
"PKG",141,22,1,"PAH",1,1,91,0)
perforated line. For some fonts, this patch reduces the white space 
"PKG",141,22,1,"PAH",1,1,92,0)
between the lines of the first warning to make it fit.
"PKG",141,22,1,"PAH",1,1,93,0)
 
"PKG",141,22,1,"PAH",1,1,94,0)
Mail address section changes:
"PKG",141,22,1,"PAH",1,1,95,0)
============================
"PKG",141,22,1,"PAH",1,1,96,0)
  1. The current date will print in the upper right corner.
"PKG",141,22,1,"PAH",1,1,97,0)
  2. If there are any mailing comments defined, they will print after the 
"PKG",141,22,1,"PAH",1,1,98,0)
MAIL field (#.03) of the PHARMACY PATIENT file (#55).
"PKG",141,22,1,"PAH",1,1,99,0)
  3. Patient name will print first name first instead of 
"PKG",141,22,1,"PAH",1,1,100,0)
lastname,firstname.
"PKG",141,22,1,"PAH",1,1,101,0)
  4. When the routing is "Window", the word "Window" will be bolded.
"PKG",141,22,1,"PAH",1,1,102,0)
 
"PKG",141,22,1,"PAH",1,1,103,0)
Pharmacy fill card section changes:
"PKG",141,22,1,"PAH",1,1,104,0)
==================================
"PKG",141,22,1,"PAH",1,1,105,0)
  1. Seconds will be removed from the label date/time.
"PKG",141,22,1,"PAH",1,1,106,0)
  2. A new API will return the text for the DRUG WARNING list. The DRUG 
"PKG",141,22,1,"PAH",1,1,107,0)
WARNING entries will be separated by commas. If an entry in the list does 
"PKG",141,22,1,"PAH",1,1,108,0)
not have an "N" (for "New"), it is from the RX CONSULT file (#54).
"PKG",141,22,1,"PAH",1,1,109,0)
Otherwise it is from the WARNING LABEL-ENGLISH (#50.625) or the 
"PKG",141,22,1,"PAH",1,1,110,0)
WARNING LABEL-SPANISH (#50.626) file.
"PKG",141,22,1,"PAH",1,1,111,0)
  3. A new line containing the patient location and status is being added
"PKG",141,22,1,"PAH",1,1,112,0)
beneath the DRUG WARNING list, so the list is being moved up slightly on
"PKG",141,22,1,"PAH",1,1,113,0)
the label.
"PKG",141,22,1,"PAH",1,1,114,0)
  4. Patient name and last portion of the social security number are 
"PKG",141,22,1,"PAH",1,1,115,0)
bolded.
"PKG",141,22,1,"PAH",1,1,116,0)
  5. If the bottle cap is "non-safety", it will be bolded.
"PKG",141,22,1,"PAH",1,1,117,0)
  6. Currently long SIG's that do not fit on one pharmacy fill card label
"PKG",141,22,1,"PAH",1,1,118,0)
print only 4 lines of SIG on the first label and up to 4 lines on each
"PKG",141,22,1,"PAH",1,1,119,0)
continuation label. This patch increases the number of lines of the SIG 
"PKG",141,22,1,"PAH",1,1,120,0)
that print on each pharmacy fill card label to reduce the total number of
"PKG",141,22,1,"PAH",1,1,121,0)
labels needed.
"PKG",141,22,1,"PAH",1,1,122,0)
  7. The words "3rd Party Rx" and the NDC number are added when that 
"PKG",141,22,1,"PAH",1,1,123,0)
information is available. (Added for HIPAA/NCPDP).
"PKG",141,22,1,"PAH",1,1,124,0)
 
"PKG",141,22,1,"PAH",1,1,125,0)
Patient fill section changes:
"PKG",141,22,1,"PAH",1,1,126,0)
============================
"PKG",141,22,1,"PAH",1,1,127,0)
  1. The barcode will print every time even if there are no refills.
"PKG",141,22,1,"PAH",1,1,128,0)
  2. The site telephone number will print when the "PHONE IN OR MAIL THIS 
"PKG",141,22,1,"PAH",1,1,129,0)
REFILL REQUEST" prints.
"PKG",141,22,1,"PAH",1,1,130,0)
  3. The text "n refills left until MMM DD,YYYY is changed to "May refill 
"PKG",141,22,1,"PAH",1,1,131,0)
nX by MMM DD,YYYY".
"PKG",141,22,1,"PAH",1,1,132,0)
 
"PKG",141,22,1,"PAH",1,1,133,0)
Prescription Document PMI section changes:
"PKG",141,22,1,"PAH",1,1,134,0)
=========================================
"PKG",141,22,1,"PAH",1,1,135,0)
  1. The PMI will print in the patient's language preference.
"PKG",141,22,1,"PAH",1,1,136,0)
  2. The white spaces between sections of the PMI document will be 
"PKG",141,22,1,"PAH",1,1,137,0)
reduced to result in a few more lines fitting on the page.
"PKG",141,22,1,"PAH",1,1,138,0)
  3. If there are more than 5 warning labels, the additional warnings 
"PKG",141,22,1,"PAH",1,1,139,0)
will print at the top of the PMI section.
"PKG",141,22,1,"PAH",1,1,140,0)
 
"PKG",141,22,1,"PAH",1,1,141,0)
Trailing document changes:
"PKG",141,22,1,"PAH",1,1,142,0)
=========================
"PKG",141,22,1,"PAH",1,1,143,0)
  1. The patient's phone number followed by an underline will print on 
"PKG",141,22,1,"PAH",1,1,144,0)
the address change form.
"PKG",141,22,1,"PAH",1,1,145,0)
  2. In the Allergies/ADR section, the name and last six digits of the 
"PKG",141,22,1,"PAH",1,1,146,0)
social security number will be made larger and will be bolded.
"PKG",141,22,1,"PAH",1,1,147,0)
  3. In the Allergies/ADR section, if the HOSPITAL LOCATION file (#44), 
"PKG",141,22,1,"PAH",1,1,148,0)
TYPE field (#2) type equals "W" for any prescription printed for this 
"PKG",141,22,1,"PAH",1,1,149,0)
patient in the current print job, then the word "INPATIENT" will print 
"PKG",141,22,1,"PAH",1,1,150,0)
on the line following the patient name.
"PKG",141,22,1,"PAH",1,1,151,0)
  4. In the Allergies/ADR section, if some sections do not have data, the 
"PKG",141,22,1,"PAH",1,1,152,0)
header will not print. If no information exists, "No Assessment Made" 
"PKG",141,22,1,"PAH",1,1,153,0)
will print after the Verified Allergies heading.
"PKG",141,22,1,"PAH",1,1,154,0)
  5. In the refill narrative or copay narrative sections, if there are 
"PKG",141,22,1,"PAH",1,1,155,0)
more than seven lines from the original text, only the first seven lines 
"PKG",141,22,1,"PAH",1,1,156,0)
will print. (They could appear as more than seven lines if there is some 
"PKG",141,22,1,"PAH",1,1,157,0)
wrapping of the text).
"PKG",141,22,1,"PAH",1,1,158,0)
  6. If the Multi-Rx refill section is blank, the SITE NUMBER field 
"PKG",141,22,1,"PAH",1,1,159,0)
(#.06) from the OUTPATIENT SITE file (#59) will print bottom right
"PKG",141,22,1,"PAH",1,1,160,0)
justified.
"PKG",141,22,1,"PAH",1,1,161,0)
 
"PKG",141,22,1,"PAH",1,1,162,0)
A utility routine is included in this patch to change some of the control
"PKG",141,22,1,"PAH",1,1,163,0)
codes in the TERMINAL TYPE file (#3.2). 
"PKG",141,22,1,"PAH",1,1,164,0)
Once the patch is installed, running the routine PSOLLU4 in programmer
"PKG",141,22,1,"PAH",1,1,165,0)
mode will make slight adjustments to PATIENT FILL INITIALIZATION, 
"PKG",141,22,1,"PAH",1,1,166,0)
PHARMACY FILL DOCUMENT WARNING, MAILING LABEL INITIALIZATION, and RETURN 
"PKG",141,22,1,"PAH",1,1,167,0)
MAIL INITIALIZATION settings.
"PKG",141,22,1,"PAH",1,1,168,0)
Note: you must have your FileMan access set to '@' to run the routine. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","PSOLLL1")
0^1^B61663989
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161**;DEC 1997
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 . I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 I 'SIGF,'SIGM,'PMIM K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 D  S PSOSTLK=1 ; PRINT ONE SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 .D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLL1",18,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",19,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",20,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",21,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",22,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",23,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSOLLL1",24,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",25,0)
 S DR=$G(SIGF("DR"))
"RTN","PSOLLL1",26,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSOLLL1",28,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSOLLL1",29,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",30,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",31,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",32,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",33,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSOLLL1",34,0)
 S DR=SIGF("DR")
"RTN","PSOLLL1",35,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSOLLL1",36,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSOLLL1",37,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL1",38,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSOLLL1",39,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",40,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",41,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSOLLL1",42,0)
 I '$D(NSGY) G CONT
"RTN","PSOLLL1",43,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSOLLL1",44,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",45,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",46,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",47,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSOLLL1",48,0)
 S PSOY=PSOY-5
"RTN","PSOLLL1",49,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSOLLL1",50,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL1",51,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL1",52,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL1",53,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSOLLL1",74,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSOLLL1",75,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSOLLL1",76,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSOLLL1",77,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSOLLL1",78,0)
 . D WARN54^PSOLLLW
"RTN","PSOLLL1",79,0)
 ;RETURN MAIL
"RTN","PSOLLL1",80,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",81,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",82,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",83,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",84,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",85,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSOLLL1",86,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSOLLL1",87,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",88,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",89,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSOLLL1",90,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") S T=T_"-"_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSOLLL1",91,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",92,0)
 D FNAM
"RTN","PSOLLL1",93,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(PTNAME,0)
"RTN","PSOLLL1",94,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",95,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=$G(VAPA(I)) D
"RTN","PSOLLL1",96,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",97,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",98,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",99,0)
 S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6))) D PRINT(T,0)
"RTN","PSOLLL1",100,0)
W ;
"RTN","PSOLLL1",101,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSOLLL1",102,0)
 N XFONT
"RTN","PSOLLL1",103,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSOLLL1",104,0)
 I T["WINDOW" D
"RTN","PSOLLL1",105,0)
 . I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSOLLL1",106,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSOLLL1",107,0)
 . S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",108,0)
 . N FIRST
"RTN","PSOLLL1",109,0)
 . S FIRST=1
"RTN","PSOLLL1",110,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",111,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",112,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",113,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",114,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",115,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSOLLL1",116,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",117,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSOLLL1",118,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSOLLL1",119,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",120,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",121,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",122,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",123,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",124,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",125,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",126,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSOLLL1",127,0)
 S BOTTLBL=1
"RTN","PSOLLL1",128,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",129,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",130,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",131,0)
BARCE W @IOF
"RTN","PSOLLL1",132,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSOLLL1",133,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSOLLL1",134,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",135,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",136,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSOLLL1",137,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",138,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",139,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",140,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",141,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",142,0)
 S L5=1
"RTN","PSOLLL1",143,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSOLLL1",144,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSOLLL1",145,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",146,0)
 Q
"RTN","PSOLLL1",147,0)
PRINT(T,B) ;
"RTN","PSOLLL1",148,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",149,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",150,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",151,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",152,0)
 W T,!
"RTN","PSOLLL1",153,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",154,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",155,0)
 Q
"RTN","PSOLLL1",156,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",157,0)
 D ^PSOLLL5
"RTN","PSOLLL1",158,0)
 D ^PSOLLLH
"RTN","PSOLLL1",159,0)
 D ^PSOLLL6
"RTN","PSOLLL1",160,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",161,0)
 I '$G(REPRINT) D ^PSOLLL7
"RTN","PSOLLL1",162,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",163,0)
 W @IOF
"RTN","PSOLLL1",164,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",165,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",166,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",167,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",168,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",169,0)
 W T,!
"RTN","PSOLLL1",170,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",171,0)
 Q
"RTN","PSOLLL1",172,0)
 ;
"RTN","PSOLLL1",173,0)
FNAM ;
"RTN","PSOLLL1",174,0)
 N NAME
"RTN","PSOLLL1",175,0)
 S NAME=VADM(1)
"RTN","PSOLLL1",176,0)
 D STDNAME^XLFNAME(.NAME,"CP")
"RTN","PSOLLL1",177,0)
 S PTNAME=$$NAMEFMT^XLFNAME(.NAME,"G","S")
"RTN","PSOLLL1",178,0)
 Q
"RTN","PSOLLL1",179,0)
 ;
"RTN","PSOLLL2")
0^2^B14143460
"RTN","PSOLLL2",1,0)
PSOLLL2 ;BIR/JLC-LASER LABEL ;11/19/02
"RTN","PSOLLL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,138,141,161**;DEC 1997
"RTN","PSOLLL2",3,0)
 ;
"RTN","PSOLLL2",4,0)
L1 I $G(PSOIO("PFDI"))]"" X PSOIO("PFDI")
"RTN","PSOLLL2",5,0)
 I '$G(PFF) D
"RTN","PSOLLL2",6,0)
 .N PGY
"RTN","PSOLLL2",7,0)
 .M PGY=SGY I $D(OSGY) K PGY M PGY=OSGY
"RTN","PSOLLL2",8,0)
 .D COUNTSGF^PSOLLLW
"RTN","PSOLLL2",9,0)
 S PFM=0,T=$S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"")
"RTN","PSOLLL2",10,0)
 S T=T_$S($G(RXP):"(PARTIAL)",1:"")_$S($D(REPRINT):" ",$G(RXP):" ",1:"")_$P(PS2,"^",2)_"  "_TECH_"  "_$P(PSONOWT,":",1,2) D PRINT(T)
"RTN","PSOLLL2",11,0)
 S T="Rx# "_RXN_"  "_DATE_"  "_$S('PFF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(fill document continued)") D PRINT(T)
"RTN","PSOLLL2",12,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T,1)
"RTN","PSOLLL2",13,0)
 S LENGTH=0,PTEXT="",PFF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL2",14,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL2",15,0)
 S DR=PFF("DR")
"RTN","PSOLLL2",16,0)
 F I=1:1 Q:'$D(NPGY(DR,I))  S TEXT=NPGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL2",17,0)
 I I>4,$D(NPGY(DR,5)) S PFF=1,PFF("DR")=DR+1
"RTN","PSOLLL2",18,0)
 S OPSOY=PSOY
"RTN","PSOLLL2",19,0)
 I $G(PSOIO("PFDQ"))]"" X PSOIO("PFDQ")
"RTN","PSOLLL2",20,0)
 I PFF S PSOX=PSOCX,PSOY=OPSOY,T="(continued on next fill document)" S PFM=1 D PRINT(T) Q
"RTN","PSOLLL2",21,0)
 K NPGY,^TMP($J,"PSOSIGF")
"RTN","PSOLLL2",22,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL2",23,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL2",24,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL2",25,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL2",26,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL2",27,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG2",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL2",28,0)
 I LENGTH>3.7 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG2",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.7 Q
"RTN","PSOLLL2",29,0)
 S OPSOX=PSOX,PSOX=Q(1)*300+OPSOX,T=$G(QTY) D PRINT(T) S PSOX=OPSOX
"RTN","PSOLLL2",30,0)
 S PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL2",31,0)
 S PSOY=PSOY-PSOYI,PSOX=Q(1)+Q(4)*300+OPSOX,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL2",32,0)
 I $G(PSOIO("PFDT"))]"" X PSOIO("PFDT")
"RTN","PSOLLL2",33,0)
 S T=DRUG D PRINT(T)
"RTN","PSOLLL2",34,0)
L11 S T="Mfr ___________________ Lot# _______________________" D PRINT(T)
"RTN","PSOLLL2",35,0)
L12 S T="Tech__________________ RPh _______________________" D PRINT(T)
"RTN","PSOLLL2",36,0)
 S PSOFONT=PSOTFONT
"RTN","PSOLLL2",37,0)
 S T="Routing: "_$S("W"[$E(MW):MW,PS55=2:"DO NOT MAIL",1:MW_" MAIL")_"    Days supply: "_$G(DAYS)_"     Cap: "_$S('PSCAP:"SAFETY",1:"") D PRINT(T)
"RTN","PSOLLL2",38,0)
 I PSCAP D
"RTN","PSOLLL2",39,0)
 .D STRT^PSOLLU1("SIG2",T,.L) S LENGTH=L(XFONT+1)
"RTN","PSOLLL2",40,0)
 .S OPSOX=PSOX,T="NON-SAFETY",PSOX=LENGTH*300+OPSOX,PSOY=PSOY-PSOYI D PRINT(T,1) S PSOX=OPSOX
"RTN","PSOLLL2",41,0)
 S T="Isd: "_ISD_"    Exp: "_EXPDT_"    Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL2",42,0)
 S PSOYI=PSOBYI,PSOY=PSOBY
"RTN","PSOLLL2",43,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL2",44,0)
 S X2=PSOINST_"-"_RX
"RTN","PSOLLL2",45,0)
 W X2
"RTN","PSOLLL2",46,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL2",47,0)
 I $G(PSOIO("PFDW"))]"" X PSOIO("PFDW")
"RTN","PSOLLL2",48,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL2",49,0)
 I $G(WARN)'="" S PTEXT="DRUG WARNING " D STRT^PSOLLU1("SIG2",PTEXT,.L) S LENGTH=L(XFONT) D
"RTN","PSOLLL2",50,0)
 . F I=1:1:$L(WARN,",") S TEXT=$P(WARN,",",I)_"," D
"RTN","PSOLLL2",51,0)
 .. D STRT^PSOLLU1("SIG2",TEXT,.L)
"RTN","PSOLLL2",52,0)
 .. I LENGTH+L(XFONT)<1.8 S PTEXT=PTEXT_TEXT,LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL2",53,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLL2",54,0)
 .. S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T) S PTEXT=""
"RTN","PSOLLL2",55,0)
 .. I PSOY>PSOYM W "*"
"RTN","PSOLLL2",56,0)
 . I PTEXT]"" S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T)
"RTN","PSOLLL2",57,0)
 S PTEXT="Pat. Stat "_PATST_" Clinic: "_PSCLN D STRT^PSOLLU1("SIG2",PTEXT,.L) S T=PTEXT D PRINT(T)
"RTN","PSOLLL2",58,0)
 Q
"RTN","PSOLLL2",59,0)
 ;
"RTN","PSOLLL2",60,0)
PRINT(T,B) ;
"RTN","PSOLLL2",61,0)
 S BOLD=$G(B)
"RTN","PSOLLL2",62,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL2",63,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL2",64,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL2",65,0)
 W T,!
"RTN","PSOLLL2",66,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL2",67,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL2",68,0)
 Q
"RTN","PSOLLL3")
0^3^B8577417
"RTN","PSOLLL3",1,0)
PSOLLL3 ;BHAM/JLC - LASER LABELS ;11/20/02
"RTN","PSOLLL3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161**;DEC 1997
"RTN","PSOLLL3",3,0)
 ;
"RTN","PSOLLL3",4,0)
 ;Reference to STATUS^BPSOSRX supported by DBIA 4412
"RTN","PSOLLL3",5,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL3",6,0)
PF ;PATIENT FILL DOCUMENT
"RTN","PSOLLL3",7,0)
 I $G(PSOIO("PFI"))]"" X PSOIO("PFI")
"RTN","PSOLLL3",8,0)
 D  S PSOFONT=OFONT
"RTN","PSOLLL3",9,0)
 . S OFONT=PSOFONT,PSOFONT=PSOHFONT
"RTN","PSOLLL3",10,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",11,0)
 . I RXF+1=(1+$P(RXY,"^",9)) S T="NO REFILLS LEFT for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",12,0)
 . S T="PHONE IN OR MAIL THIS REFILL REQUEST" D PRINT(T,1,1)
"RTN","PSOLLL3",13,0)
 . S PSOFONT=OFONT,T="Follow the refill instructions provided with your prescription." D PRINT(T,0,1)
"RTN","PSOLLL3",14,0)
 . S PSOFONT=OFONT,OPSOX=PSOX,PSOX=PSOX+300,T="For Refill Call "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T,0) S PSOX=OPSOX
"RTN","PSOLLL3",15,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T,1)
"RTN","PSOLLL3",16,0)
 S T="Rx# "_RXN_"   " D PRINT(T,1)
"RTN","PSOLLL3",17,0)
 D STRT^PSOLLU1("SEC2",T,.L) S OPSOX=PSOX,PSOX=L($E(PSOFONT,2,99))*300+PSOX
"RTN","PSOLLL3",18,0)
 S T=DATE_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),PSOY=PSOY-PSOYI D PRINT(T) S PSOX=OPSOX
"RTN","PSOLLL3",19,0)
 N THIRDP
"RTN","PSOLLL3",20,0)
 S THIRDP=""
"RTN","PSOLLL3",21,0)
 I $T(STATUS^BPSOSRX)]"" D
"RTN","PSOLLL3",22,0)
 .S THIRDP=$$STATUS^BPSOSRX(RX,+RXF)
"RTN","PSOLLL3",23,0)
 S T=$S(THIRDP'="":"3rd Party Rx",1:"") D PRINT(T,1)
"RTN","PSOLLL3",24,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PSDU)_"    Days supply: "_$G(DAYS) D PRINT(T,0)
"RTN","PSOLLL3",25,0)
 S T=DRUG D PRINT(T,0)
"RTN","PSOLLL3",26,0)
 S T=$$GETNDC(RX,RXF) D PRINT(T,1)
"RTN","PSOLLL3",27,0)
 D  D PRINT(T,1)
"RTN","PSOLLL3",28,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL3",29,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL3",30,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL3",31,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL3",32,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL3",33,0)
 D PRINT(COPAYVAR)
"RTN","PSOLLL3",34,0)
 S T=$P(PS,"^")_"-"_$P(PS,"^",6) D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",35,0)
 S OPSOX=PSOX,PSOX=2340-(L($E(PSOFONT,2,99))*300),PSOY=PSOY-PSOYI
"RTN","PSOLLL3",36,0)
 D PRINT(T)
"RTN","PSOLLL3",37,0)
 S PSOX=OPSOX,PSOYI=PSOBYI
"RTN","PSOLLL3",38,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL3",39,0)
 S X2=PSOINST_"-"_RX
"RTN","PSOLLL3",40,0)
 W X2
"RTN","PSOLLL3",41,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL3",42,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",43,0)
 Q
"RTN","PSOLLL3",44,0)
PRINT(T,BOLD,HDR) ;
"RTN","PSOLLL3",45,0)
 S BOLD=+$G(BOLD),HDR=+$G(HDR)
"RTN","PSOLLL3",46,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",47,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL3",48,0)
 I HDR D
"RTN","PSOLLL3",49,0)
 . S OPSOX=PSOX D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",50,0)
 . S PSOX=4.2-L($E(PSOFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL3",51,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL3",52,0)
 W T,!
"RTN","PSOLLL3",53,0)
 I HDR S PSOX=OPSOX
"RTN","PSOLLL3",54,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL3",55,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL3",56,0)
 Q
"RTN","PSOLLL3",57,0)
GETNDC(RX,RFL) ; Returns the Rx NDC #
"RTN","PSOLLL3",58,0)
 ; Input:  (r) RX - Rx IEN (#52)
"RTN","PSOLLL3",59,0)
 ;         (o) RFL - Refill #
"RTN","PSOLLL3",60,0)
 ; Output:     NDC - Rx NDC #
"RTN","PSOLLL3",61,0)
 N NDC,I S NDC=""
"RTN","PSOLLL3",62,0)
 I '$D(RFL) D
"RTN","PSOLLL3",63,0)
 . S (RFL,I)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RFL=I
"RTN","PSOLLL3",64,0)
 I RFL S NDC=$$GET1^DIQ(52.1,RFL_","_RX,11)
"RTN","PSOLLL3",65,0)
 I 'RFL!(NDC="") S NDC=$$GET1^DIQ(52,RX,27)
"RTN","PSOLLL3",66,0)
 Q NDC
"RTN","PSOLLL4")
0^4^B10398176
"RTN","PSOLLL4",1,0)
PSOLLL4 ;BHAM/JLC - LASER LABELS PRINT PMI ;12/13/02
"RTN","PSOLLL4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,135,161**;DEC 1997
"RTN","PSOLLL4",3,0)
 ;
"RTN","PSOLLL4",4,0)
 ;Reference to PSNPPIO supported by DBIA 3794
"RTN","PSOLLL4",5,0)
 ;
"RTN","PSOLLL4",6,0)
 S FLAG=$$EN^PSNPPIO(+$P(RXY,"^",6),.MSG)
"RTN","PSOLLL4",7,0)
EN I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL4",8,0)
 I '$G(PMIM) D MOREWARN
"RTN","PSOLLL4",9,0)
 S T=PNM_"  Rx#: "_RXN_"   "_DRUG D PRINT(T,0) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",10,0)
 S CONT=0 I PMIM S CONT=1 D PRINT(PMIF("T"),PMIF("H")) G CONT
"RTN","PSOLLL4",11,0)
 I 'FLAG D PRINT(MSG) Q
"RTN","PSOLLL4",12,0)
 S T=^TMP($J,"PSNPMI",0)_": "_$G(^TMP($J,"PSNPMI","F",1,0)) D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",13,0)
 S T=$G(^TMP($J,"PSNPMI","C",1,0)) I T]"" D PRINT(T,1) S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",14,0)
CONT S XFONT=$E(PSOFONT,2,99),(CNT,OUT,PMIM)=0
"RTN","PSOLLL4",15,0)
 K A F A="W","U","H","S","M","P","I","O","N","D","R" S CNT=CNT+1,A(CNT)=A
"RTN","PSOLLL4",16,0)
 F J=PMIF("A"):1 Q:$G(A(J))=""  S A=A(J) I $D(^TMP($J,"PSNPMI",A,1,0)) S HDR=$S(PMIF("A")=1:1,PMIF("B")=1:1,J=PMIF("A"):0,1:1),LENGTH=0,PTEXT="" D  Q:OUT  S PSOY=PSOY+PSOYI-25
"RTN","PSOLLL4",17,0)
 . F B=PMIF("B"):1 Q:'$D(^TMP($J,"PSNPMI",A,B,0))  S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL4",18,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL4",19,0)
 .. F I=PMIF("I"):1:$L(TEXT," ") D STRT^PSOLLU1("FULL",$P(TEXT," ",I)_" ",.L) D  Q:OUT
"RTN","PSOLLL4",20,0)
 ... I LENGTH+L(XFONT)<8.1 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL4",21,0)
 ... S LENGTH=0,I=I-1
"RTN","PSOLLL4",22,0)
 ... I HDR D  Q
"RTN","PSOLLL4",23,0)
 .... I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1
"RTN","PSOLLL4",24,0)
 .... D PRINT(PTEXT,1) S PTEXT="",HDR=0
"RTN","PSOLLL4",25,0)
 ... I PSOY>(PSOYM+25) S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1 Q
"RTN","PSOLLL4",26,0)
 ... D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL4",27,0)
 .. I 'PMIM F I="I","B" S PMIF(I)=1
"RTN","PSOLLL4",28,0)
 . I 'PMIM S PMIF("B")=1
"RTN","PSOLLL4",29,0)
 . I OUT S PMIF("T")=PTEXT,PMIF("H")=HDR
"RTN","PSOLLL4",30,0)
 . Q:OUT  I HDR,PTEXT[":" D  Q
"RTN","PSOLLL4",31,0)
 .. I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",32,0)
 .. I PTEXT]"" D PRINT(PTEXT,1)
"RTN","PSOLLL4",33,0)
 . I PTEXT]"",PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",34,0)
 . I PTEXT]"" D PRINT(PTEXT,0)
"RTN","PSOLLL4",35,0)
 Q
"RTN","PSOLLL4",36,0)
PRINT(T,HDR) ;
"RTN","PSOLLL4",37,0)
 ; Input: T - text to be printed
"RTN","PSOLLL4",38,0)
 ;        HDR - 0-no / 1-yes
"RTN","PSOLLL4",39,0)
 ;
"RTN","PSOLLL4",40,0)
 S HDR=+$G(HDR)
"RTN","PSOLLL4",41,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",42,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL4",43,0)
 I HDR,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL4",44,0)
 I HDR D  G PRINT2
"RTN","PSOLLL4",45,0)
 . W $P(T,":"),":"
"RTN","PSOLLL4",46,0)
 . I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",47,0)
 . W $P(T,":",2,99)
"RTN","PSOLLL4",48,0)
 W T
"RTN","PSOLLL4",49,0)
PRINT2 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL4",50,0)
 W ! Q
"RTN","PSOLLL4",51,0)
 ;
"RTN","PSOLLL4",52,0)
MOREWARN ; SEE ID MORE THAN 5 WARNINGS AND PRINT REMAINDER, IF SO
"RTN","PSOLLL4",53,0)
 N LEN,LEN2,I,J,PSOWARN,NEWWARN,PRE
"RTN","PSOLLL4",54,0)
 S LEN=$L($G(WARN),",") I LEN<6 Q
"RTN","PSOLLL4",55,0)
 S NEWWARN=$P(WARN,",",6,99)
"RTN","PSOLLL4",56,0)
 S T="Additional Warning Labels:" D PRINT(T)
"RTN","PSOLLL4",57,0)
 F I=1:1:$L(NEWWARN,",") S PSOWARN=$P(NEWWARN,",",I) D
"RTN","PSOLLL4",58,0)
 .S PRE=PSOWARN_": ",LEN2=$L(PRE)
"RTN","PSOLLL4",59,0)
 .S TEXT=$$WTEXT^PSSWRNA(PSOWARN,PSOLAN) I TEXT'="" D
"RTN","PSOLLL4",60,0)
 ..I $L(TEXT)<100 S T=PRE_TEXT D PRINT(T) Q
"RTN","PSOLLL4",61,0)
 ..S PTEXT="" F J=1:1:$L(TEXT," ") S PTEXT=PTEXT_$P(TEXT," ",J)_" " D
"RTN","PSOLLL4",62,0)
 ...I $L(PTEXT)>90 D
"RTN","PSOLLL4",63,0)
 ....S T=PRE_PTEXT D PRINT(T) S PRE=$E("      ",1,LEN2),PTEXT=""
"RTN","PSOLLL4",64,0)
 ..I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSOLLL4",65,0)
 I PTEXT'="" S T=$G(PRE)_PTEXT D PRINT(T) S PTEXT=""
"RTN","PSOLLL4",66,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",67,0)
 Q
"RTN","PSOLLL4",68,0)
 ;
"RTN","PSOLLL5")
0^5^B35859905
"RTN","PSOLLL5",1,0)
PSOLLL5 ;BIR/RJS - LASER LABEL CONTINUED ;11/22/02
"RTN","PSOLLL5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161**;DEC 1997
"RTN","PSOLLL5",3,0)
 ;
"RTN","PSOLLL5",4,0)
START ;
"RTN","PSOLLL5",5,0)
 N TEXT,BLNKLIN
"RTN","PSOLLL5",6,0)
 S $P(BLNKLIN,"_",90)="_"
"RTN","PSOLLL5",7,0)
 D MAIL^PSOLLL7
"RTN","PSOLLL5",8,0)
 I $G(PSOIO("ACI"))]"" X PSOIO("ACI")
"RTN","PSOLLL5",9,0)
 S TEXT="HAS YOUR ADDRESS CHANGED?" D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",10,0)
 S OPSOX=PSOX,PSOX=4.2-L($E(PSOHFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL5",11,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,OFONT) D PRINT(TEXT,1) S PSOX=OPSOX,PSOY=PSOY+10,PSOFONT=OFONT
"RTN","PSOLLL5",12,0)
 S TEXT="Write address changes in the blanks, sign the form, and return to" D PRINT(TEXT,0)
"RTN","PSOLLL5",13,0)
 S TEXT="your pharmacy." D PRINT(TEXT,0)
"RTN","PSOLLL5",14,0)
 S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),PNM=$P(X,"^")
"RTN","PSOLLL5",15,0)
 D PID^VADPT6,ADD^VADPT S SSNP=$E(VA("PID"),5,12)
"RTN","PSOLLL5",16,0)
 S PSOY=PSOY+PSOYI,TEXT=PNM_"  "_SSNP D PRINT(TEXT,0)
"RTN","PSOLLL5",17,0)
 I $G(VAPA(1))="" G ALLERGY
"RTN","PSOLLL5",18,0)
 F I=1:1:3 I $G(VAPA(I))]"" S TEXT=$G(VAPA(I))_$E(BLNKLIN,1,80-$L(VAPA(I))) D PRINT(TEXT,0)
"RTN","PSOLLL5",19,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL5",20,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL5",21,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",22,0)
 S B=VAPA(8)
"RTN","PSOLLL5",23,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",24,0)
 S:$G(VAPA(3))="" PSOY=PSOY+PSOYI
"RTN","PSOLLL5",25,0)
 S TEXT="[   ] Permanent                     [   ] Temporary until ____/____/____" D PRINT(TEXT,0)
"RTN","PSOLLL5",26,0)
 S PSOY=$G(PSOFY),TEXT="Signature "_$E(BLNKLIN,1,45) D PRINT(TEXT,0)
"RTN","PSOLLL5",27,0)
 ;
"RTN","PSOLLL5",28,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSOLLL5",29,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSOLLL5",30,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSOLLL5",31,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLLL5",32,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSOLLL5",33,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSOLLL5",34,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSOLLL5",35,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSOLLL5",36,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSOLLL5",37,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSOLLL5",38,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSOLLL5",39,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSOLLL5",40,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSOLLL5",41,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSOLLL5",42,0)
 I $G(PSOIO("ALI"))]"" X PSOIO("ALI")
"RTN","PSOLLL5",43,0)
 S XFONT=$E($G(PSOFONT),2,99)
"RTN","PSOLLL5",44,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,PSOFONT) S TEXT=^TMP($J,"PSOAPT",1) D PRINT(TEXT,1) S PSOFONT=OFONT
"RTN","PSOLLL5",45,0)
 I $$GET1^DIQ(44,$P(RXY,"^",5),2,"I")="W" S TEXT="INPATIENT" D PRINT(TEXT,0)
"RTN","PSOLLL5",46,0)
 F CCC=3,4,5 I '$O(^TMP($J,"PSOAPT",CCC,0)) K ^TMP($J,"PSOAPT",CCC)
"RTN","PSOLLL5",47,0)
 S CCC=$G(^TMP($J,"PSOAPT",2,1))
"RTN","PSOLLL5",48,0)
 I CCC="" S ^TMP($J,"PSOAPT",2,1)="No Assessment Made" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",49,0)
 I CCC="NKA" S ^TMP($J,"PSOAPT",2,1)="No Known Allergies" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",50,0)
 S CCC=1,OUT=0
"RTN","PSOLLL5",51,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSOLLL5",52,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSOLLL5",53,0)
 .I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",54,0)
 .S PSOY=PSOY+PSOYI D PRINT(TEXT,0,1)
"RTN","PSOLLL5",55,0)
 .I TEXT="No Assessment Made" Q
"RTN","PSOLLL5",56,0)
 .I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",57,0)
 .S (TEXT,PTEXT,CCC2)="",LENGTH=0
"RTN","PSOLLL5",58,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D  Q:OUT
"RTN","PSOLLL5",59,0)
 ..D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",60,0)
 ..I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_TEXT_",",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL5",61,0)
 ..I PTEXT="" D  Q
"RTN","PSOLLL5",62,0)
 ... F JJ=$L(TEXT):-1 S PTEXT=$E(TEXT,1,JJ) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT,0) S PTEXT=$E(TEXT,JJ+1,512)_"," Q
"RTN","PSOLLL5",63,0)
 ... D STRT^PSOLLU1("SEC2",PTEXT,.L) S LENGTH=L(XFONT)
"RTN","PSOLLL5",64,0)
 ..S LENGTH=0,CCC2=CCC2-1
"RTN","PSOLLL5",65,0)
 ..I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",66,0)
 ..D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL5",67,0)
 .I 'OUT,PTEXT]"" D PRINT($P(PTEXT,",",1,$L(PTEXT,",")-1),0)
"RTN","PSOLLL5",68,0)
 I OUT S T="Additional Allergies or Adverse Reactions Exist." D PRINT(T,0) S T="Talk to your Physician or Pharmacist." D PRINT(T,0)
"RTN","PSOLLL5",69,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,CCC2,FNTFLG,TEXT,TEXT2
"RTN","PSOLLL5",70,0)
SUSPEN S PSODFN=DFN,(SPPL,RXX,STA)="",XXS=1
"RTN","PSOLLL5",71,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOLLL5",72,0)
 D ^PSOBUILD S (STA,RXX)=""
"RTN","PSOLLL5",73,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOLLL5",74,0)
 I SPPL="" Q
"RTN","PSOLLL5",75,0)
SUSP1 I $G(PSOIO("SPI"))]"" X PSOIO("SPI")
"RTN","PSOLLL5",76,0)
 S TOF=0,TEXT=PNM_" "_SSNP_" "_$G(PSONOW) D PRINT(TEXT,0)
"RTN","PSOLLL5",77,0)
 S TEXT="The following prescription(s) have been requested and will be" D PRINT(TEXT,0)
"RTN","PSOLLL5",78,0)
 S TEXT="mailed to you on or after the date indicated." D PRINT(TEXT,0)
"RTN","PSOLLL5",79,0)
 S PSOY=PSOY+PSOYI,TEXT="Rx#                                          Date                                        "
"RTN","PSOLLL5",80,0)
 D PRINT(TEXT,0,1)
"RTN","PSOLLL5",81,0)
 F XX=XXS:1 Q:$P(SPPL,",",XX)=""  S RX=$P(SPPL,",",XX) D  Q:TOF
"RTN","PSOLLL5",82,0)
 . S SPNUM=$O(^PS(52.5,"B",RX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S Y=SPDATE X ^DD("DD") S SPDATE=Y
"RTN","PSOLLL5",83,0)
 . S T=$P(^PSRX(RX,0),"^") D PRINT(T,0)
"RTN","PSOLLL5",84,0)
 . S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=PSOCX,T=$G(SPDATE) D PRINT(T,0)
"RTN","PSOLLL5",85,0)
 . S PSOX=OPSOX+20,T=$$ZZ^PSOSUTL(RX) D PRINT(T,0) K SPNUM,SPDATE,Y,ZDRUG
"RTN","PSOLLL5",86,0)
 . S PSOX=OPSOX,PSOY=PSOY+PSOYI
"RTN","PSOLLL5",87,0)
 . I PSOY>PSOYM S XXS=XX+1,TOF=1 W:$P(SPPL,",",XXS)]"" @IOF Q
"RTN","PSOLLL5",88,0)
 I TOF,$P(SPPL,",",XXS)]"" G SUSP1
"RTN","PSOLLL5",89,0)
 Q
"RTN","PSOLLL5",90,0)
PRINT(T,B,UL) ;
"RTN","PSOLLL5",91,0)
 S BOLD=$G(B),UL=$G(UL)
"RTN","PSOLLL5",92,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",93,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL5",94,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL5",95,0)
 I UL,$G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSOLLL5",96,0)
 W T,!
"RTN","PSOLLL5",97,0)
 I UL,$G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSOLLL5",98,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL5",99,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL5",100,0)
 Q
"RTN","PSOLLL6")
0^6^B9729924
"RTN","PSOLLL6",1,0)
PSOLLL6 ;BHAM/BHW - LABEL TRAILER ;12/02/2002
"RTN","PSOLLL6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161**;DEC 1997
"RTN","PSOLLL6",3,0)
 ;
"RTN","PSOLLL6",4,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" Q
"RTN","PSOLLL6",5,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL6",6,0)
NARR ;NARRATIVES
"RTN","PSOLLL6",7,0)
 S (PSSIXFL,PSSEVFL,LENGTH,OUT)=0,PTEXT=""
"RTN","PSOLLL6",8,0)
 I $G(PSOIO("RNI"))]"" X PSOIO("RNI")
"RTN","PSOLLL6",9,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL6",10,0)
 I $D(^PS(59,PSOSITE,6))!($D(^PS(59,PSOSITE,7))) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL6",11,0)
 F JJ=6,7 S TEXT="" D P(JJ)  S PSOY=PSOY+PSOYI Q:OUT
"RTN","PSOLLL6",12,0)
 I $G(PSOIO("CNI"))]"" X PSOIO("CNI")
"RTN","PSOLLL6",13,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S T="REMIT $"_PSOTRAMT_" TO AGENT CASHIER." D PRINT(T) G END
"RTN","PSOLLL6",14,0)
 I 'PRCOPAY G END
"RTN","PSOLLL6",15,0)
 S OUT=0,TEXT=""
"RTN","PSOLLL6",16,0)
 I $D(^PS(59,PSOSITE,4)) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI D P(4)
"RTN","PSOLLL6",17,0)
END K DIWF,DIWL,DIWR,EDT,LLL,PRCOPAY,PSNACNT,PSNOADDR,PSNOBOTH,PSNONARR,PSNOSUSP,PSNTHREE,PSOLGTH,PSOSD,PSOTRAIL,PSOTRDFN,PSSEVFL,PSSIXFL,PSSPCNT,PSSSRX,PSSUFLG,RXX,SPDATE,SPNUM,SPPL,TTT,VAADDR1,VADM,VAEL,VAPA,VASTREET,ZZ,ZZZ W @IOF
"RTN","PSOLLL6",18,0)
 Q
"RTN","PSOLLL6",19,0)
P(JJ) ;NARRATIVE PRINT CONTROL
"RTN","PSOLLL6",20,0)
 N TEXTLEN,PSOCNT
"RTN","PSOLLL6",21,0)
 S TEXTLEN=0,PSOCNT=0
"RTN","PSOLLL6",22,0)
 S ZZ=0 F  S ZZ=$O(^PS(59,PSOSITE,JJ,ZZ)) Q:'ZZ  S PSOCNT=PSOCNT+1 Q:PSOCNT>7  I $D(^(ZZ,0)) S TEXT=^(0),TEXTLEN=TEXTLEN+$L(TEXT) S:TEXTLEN>560 TEXTLEN=TEXTLEN-$L(TEXT),TEXT=$E(TEXT,1,560-TEXTLEN) Q:TEXT=""  D  Q:OUT
"RTN","PSOLLL6",23,0)
 . N IC
"RTN","PSOLLL6",24,0)
 . D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL6",25,0)
 . I L(XFONT)>4.1 D  Q
"RTN","PSOLLL6",26,0)
 .. S IC=0 F J=1:1:$L(TEXT," ") D STRT^PSOLLU1("SEC2",$P(TEXT," ",J)_" ",.L) I L(XFONT)>4.1 S IC=1
"RTN","PSOLLL6",27,0)
 .. I IC D  Q:OUT
"RTN","PSOLLL6",28,0)
 ... F J=$L(TEXT):-1:1 S PTEXT=$E(TEXT,1,J) D STRT^PSOLLU1("SEC2",PTEXT,.L) D  Q:OUT
"RTN","PSOLLL6",29,0)
 .... I L(XFONT)<4.1 D PRINT(PTEXT) S TEXT=$E(TEXT,J+1,512),J=$L(TEXT)+1,PTEXT="" I PSOY>PSOYM S OUT=1
"RTN","PSOLLL6",30,0)
 .... Q
"RTN","PSOLLL6",31,0)
 ... Q
"RTN","PSOLLL6",32,0)
 .. I IC D:PTEXT]"" PRINT(PTEXT) S:PSOY>PSOYM OUT=1 Q
"RTN","PSOLLL6",33,0)
 .. F J=$L(TEXT," "):-1 S PTEXT=$P(TEXT," ",1,J) Q:OUT  Q:'$L(PTEXT)  D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<4.1 D
"RTN","PSOLLL6",34,0)
 ... D PRINT(PTEXT) S TEXT=$P(TEXT," ",J+1,99) I PSOY>PSOYM S OUT=1
"RTN","PSOLLL6",35,0)
 ... ;Reset $L of TEXT +1 so J loop continues properly
"RTN","PSOLLL6",36,0)
 ... S J=$L(TEXT," ")+1
"RTN","PSOLLL6",37,0)
 ... Q
"RTN","PSOLLL6",38,0)
 .. Q
"RTN","PSOLLL6",39,0)
 . D PRINT(TEXT) S TEXT=""
"RTN","PSOLLL6",40,0)
 . I PSOY>PSOYM S OUT=1
"RTN","PSOLLL6",41,0)
 . Q
"RTN","PSOLLL6",42,0)
 I 'OUT I TEXT]"" D PRINT(TEXT)
"RTN","PSOLLL6",43,0)
 Q
"RTN","PSOLLL6",44,0)
PRINT(T) ;
"RTN","PSOLLL6",45,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL6",46,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL6",47,0)
 W T,!
"RTN","PSOLLL6",48,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL6",49,0)
 Q
"RTN","PSOLLL7")
0^7^B34188197
"RTN","PSOLLL7",1,0)
PSOLLL7 ;BHAM/JLC - LASER LABEL MULTI RX REFILL REQUEST FORM ;12/12/92
"RTN","PSOLLL7",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161**;DEC 1997
"RTN","PSOLLL7",3,0)
 ;
"RTN","PSOLLL7",4,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOLLL7",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL7",6,0)
 ;Read-only reference to %ZIS(2 supported by DBIA 3435
"RTN","PSOLLL7",7,0)
 ;
"RTN","PSOLLL7",8,0)
EN D MAIL
"RTN","PSOLLL7",9,0)
 I $G(PSOIO("PII"))]"" X PSOIO("PII")
"RTN","PSOLLL7",10,0)
 S T="Use the adhesive label above to mail prescription" D PRINT(T)
"RTN","PSOLLL7",11,0)
 S T="documents to your pharmacy." D PRINT(T)
"RTN","PSOLLL7",12,0)
REFILL Q:'DFN  S PS1=$G(^PS(59,PSOSITE,1)),PSOSITE7=$G(^("IB")),PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOLLL7",13,0)
 I '$D(PSSPND) F PSRX=0:0 S PSRX=$O(RX(PSRX)) Q:'PSRX  K RX(PSRX)
"RTN","PSOLLL7",14,0)
 S BLNKLIN="",$P(BLNKLIN,"_",45)="_"
"RTN","PSOLLL7",15,0)
 F PSRX=0:0 S PSRX=$O(^PS(55,DFN,"P",PSRX)) Q:'PSRX  D RZX
"RTN","PSOLLL7",16,0)
 ;NEW LABEL
"RTN","PSOLLL7",17,0)
 S PSOX=0
"RTN","PSOLLL7",18,0)
DOCNEW I $G(PSOIO("RPI"))]"" X PSOIO("RPI")
"RTN","PSOLLL7",19,0)
 S PSOYI=PSOTYI,PSOX=PSOLX,ORIGY=PSOY
"RTN","PSOLLL7",20,0)
 D HDR S PSA=0
"RTN","PSOLLL7",21,0)
 F J=1:1 S PSA=$O(RX(PSA)) Q:'PSA  D SCRPTNEW
"RTN","PSOLLL7",22,0)
 I $O(RX(0))="" G EXIT
"RTN","PSOLLL7",23,0)
 I PSOY=ORIGY G EXIT
"RTN","PSOLLL7",24,0)
 S PSOYI=PSOSYI,T=BLNKLIN D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",25,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",26,0)
 S T="Patient's Signature & Date        "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",27,0)
EXIT K PSINF,AMC,PSA,PSDFN,PSDO,PSDT2,PSRFL,PSRX,PSLN,PSRXX,PSSS,PSST,PSOCR,DIWL,DIWR,DIWF,PSO9
"RTN","PSOLLL7",28,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLL7",29,0)
 Q
"RTN","PSOLLL7",30,0)
SCRPTNEW S T="____"_$$ZZ^PSOSUTL(PSA) K ZDRUG D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",31,0)
 D DTCONNW
"RTN","PSOLLL7",32,0)
 S PSOYI=PSOTYI,OPSOX=PSOX,PSOX=PSOX+PSOXI,T="Refills "_$P(RX(PSA),"^",2)_"   Exp "_PSDT2_"    Rx# "_$P(^PSRX(PSA,0),"^") K TN D PRINT(T)
"RTN","PSOLLL7",33,0)
 S PSOYI=PSOBYI
"RTN","PSOLLL7",34,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL7",35,0)
 S X2=PSOINST_"-"_PSA,PSOX=PSOX+PSOXI
"RTN","PSOLLL7",36,0)
 W X2
"RTN","PSOLLL7",37,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL7",38,0)
 S PSOX=OPSOX
"RTN","PSOLLL7",39,0)
 I PSOY>PSOYM D  D:$O(RX(PSA)) HDR Q
"RTN","PSOLLL7",40,0)
 .S T=BLNKLIN,PSOYI=PSOSYI D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",41,0)
 .S T="Patient's Signature & Date         "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",42,0)
 .S PSOY=ORIGY,PSOYI=PSOTYI
"RTN","PSOLLL7",43,0)
 .I PSOX=PSORX S PSOX=PSOLX W @IOF Q
"RTN","PSOLLL7",44,0)
 .S PSOX=PSORX
"RTN","PSOLLL7",45,0)
 Q
"RTN","PSOLLL7",46,0)
DTCONNW S PSDT2=$P(RX(PSA),"^"),PSDT2=$E(PSDT2,4,5)_"/"_$E(PSDT2,6,7)_"/"_($E(PSDT2,1,3)+1700) Q
"RTN","PSOLLL7",47,0)
RFILL2 F AMC=0:0 S AMC=$O(^PSRX(PSRXX,1,AMC)) Q:'AMC  S PSRFL=PSRFL-1
"RTN","PSOLLL7",48,0)
 I PSRFL>0 S X1=DT,X2=$P(^PSRX(PSRXX,0),"^",8)-10 D C^%DTC I X'<$P(^(2),"^",6) S PSRFL=0
"RTN","PSOLLL7",49,0)
 Q
"RTN","PSOLLL7",50,0)
RZX S PSRXX=+^PS(55,DFN,"P",PSRX,0)
"RTN","PSOLLL7",51,0)
 I $D(^PSRX(PSRXX,0)) S PSRFL=$P(^(0),"^",9) D:$D(^(1))&PSRFL RFILL2 I PSRFL>0,$P($G(^PSRX(PSRXX,"STA")),"^")<10,134'[$E(+$P($G(^("STA")),"^")),$P(^(2),"^",6)>DT S RX(PSRXX)=$P(^(2),"^",6)_"^"_PSRFL
"RTN","PSOLLL7",52,0)
 Q
"RTN","PSOLLL7",53,0)
HDR S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL7",54,0)
 D ADD^VADPT
"RTN","PSOLLL7",55,0)
 I $G(VAPA(1))="" G HDR5
"RTN","PSOLLL7",56,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=VAPA(I) D PRINT(T)
"RTN","PSOLLL7",57,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",58,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL7",59,0)
 S T=B D PRINT(T)
"RTN","PSOLLL7",60,0)
HDR5 I $O(RX(0))="" D  S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL7",61,0)
 .S PSOY=PSOY+PSOYI,T="You have no refillable prescriptions as of "_PSONOW_"." D PRINT(T)
"RTN","PSOLLL7",62,0)
 .S T="Please contact your provider if you need new prescriptions." D PRINT(T)
"RTN","PSOLLL7",63,0)
 .I '$D(PSOINST) D SITE
"RTN","PSOLLL7",64,0)
 .S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",65,0)
 .S OPSOX=PSOX,OPSOY=PSOY,T=$P(PS,"^",6) S PSOX=2300,PSOY=3900 D PRINT(T) S PSOX=OPSOX,PSOY=OPSOY
"RTN","PSOLLL7",66,0)
ADD S PSOY=PSOY+PSOYI,T="Please check prescriptions to be refilled, sign the form, then" D PRINT(T)
"RTN","PSOLLL7",67,0)
 S T="mail or return to your pharmacy." D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL7",68,0)
 Q
"RTN","PSOLLL7",69,0)
MAIL ;PRINT MAILING ADHESIVE LABEL
"RTN","PSOLLL7",70,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",71,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL7",72,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",73,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL7",74,0)
 I $G(PSOIO("MLI"))]"" X PSOIO("MLI")
"RTN","PSOLLL7",75,0)
 I $G(PSOIO("PSOFONT"))]"" X PSOIO("PSOFONT")
"RTN","PSOLLL7",76,0)
 S TEXT="Attn: (119)" D PRINT(TEXT)
"RTN","PSOLLL7",77,0)
 S TEXT=VAADDR1 D PRINT(TEXT)
"RTN","PSOLLL7",78,0)
 S TEXT=$G(VASTREET) D PRINT(TEXT)
"RTN","PSOLLL7",79,0)
 S TEXT=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(TEXT)
"RTN","PSOLLL7",80,0)
 Q
"RTN","PSOLLL7",81,0)
PRINT(T) ;
"RTN","PSOLLL7",82,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL7",83,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL7",84,0)
 W T,!
"RTN","PSOLLL7",85,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL7",86,0)
 Q
"RTN","PSOLLL7",87,0)
QUEUE ; ENTRY POINT TO PRINT STAND-ALONE MULTI-RX FORM
"RTN","PSOLLL7",88,0)
 S SAVDFN=$D(DFN) ; DFN SET IF COMING FROM HIDDEN ACTION
"RTN","PSOLLL7",89,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLL7",90,0)
 I '$G(PSOSYS) S PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOLLL7",91,0)
 I '$D(PSOINST) D SITE
"RTN","PSOLLL7",92,0)
 W !
"RTN","PSOLLL7",93,0)
 I $D(DFN) G GETPT2
"RTN","PSOLLL7",94,0)
GETPT S DIC="^DPT(",DIC("A")="Enter patient to reprint Multi-Rx refill form for: ",DIC(0)="QEAM" D ^DIC K P,DIC("A") I Y<0!("^"[X) K DIC,DUOUT,DTOUT,DIROUT,DIRUT Q
"RTN","PSOLLL7",95,0)
 S DFN=$P(Y,"^")
"RTN","PSOLLL7",96,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLL7",97,0)
 I $P(VADM(6),"^",2)]"" D  G GETPT
"RTN","PSOLLL7",98,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLL7",99,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLL7",100,0)
 I $G(POP) Q
"RTN","PSOLLL7",101,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Multi-Rx form." G Q1
"RTN","PSOLLL7",102,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLL7",103,0)
 D 6^VADPT,PID^VADPT6 S SSNP=$E($G(VA("PID")),5,12)
"RTN","PSOLLL7",104,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLL7",105,0)
 F G="DFN","PNM","PSOPAR","PSOSITE","SSNP","PSONOW","PSOSYS","PSOINST" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLL7",106,0)
 S ZTRTN="DQ^PSOLLL7",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Multi-Rx print",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLL7",107,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Multi-Rx form queued to print",!! H 1 K G
"RTN","PSOLLL7",108,0)
 I $G(SAVDFN)=0 K DFN,SAVDFN
"RTN","PSOLLL7",109,0)
 Q
"RTN","PSOLLL7",110,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLL7",111,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLL7",112,0)
 G EN
"RTN","PSOLLL7",113,0)
SITE ;
"RTN","PSOLLL7",114,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLL7",115,0)
 I $G(DA)>0 S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLL7",116,0)
 I '$D(PSOINST) S PSOINST=""
"RTN","PSOLLL7",117,0)
 Q
"RTN","PSOLLL9")
0^13^B7464651
"RTN","PSOLLL9",1,0)
PSOLLL9 ;BIR/JLC -Prints allergy warning label ;01/24/03
"RTN","PSOLLL9",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161**;DEC 1997
"RTN","PSOLLL9",3,0)
 ;
"RTN","PSOLLL9",4,0)
 N AAA,DATE1,EXPDT,ISD,HARDCOPY,PSAA,PSAQUIT,PSBQUIT,PSCQUIT,BBBB,ICOUNT,PSOING,NOW,TB1,TB2,TB2,SSG
"RTN","PSOLLL9",5,0)
 S HARDCOPY=COPIES
"RTN","PSOLLL9",6,0)
START ;
"RTN","PSOLLL9",7,0)
 I $G(PSOIO("AWI"))]"" X PSOIO("AWI")
"RTN","PSOLLL9",8,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL9",9,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLLL9",10,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLLL9",11,0)
 I '$G(RXRP(RX)) S T=$P(PS2,"^",2)_"  ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")  "_$P(NOW,":",1,2) D PRINT(T)
"RTN","PSOLLL9",12,0)
 S T="Rx# "_RXN_" has indicated a DRUG ALLERGY:" D PRINT(T)
"RTN","PSOLLL9",13,0)
 I $O(^PSRX(RX,"DAI",0)) D
"RTN","PSOLLL9",14,0)
 . S PSOY=PSOY+PSOYI,T=" Ingredients:" D PRINT(T)
"RTN","PSOLLL9",15,0)
 . F BBBB=0:0 S BBBB=$O(^PSRX(RX,"DAI",BBBB)) Q:'BBBB  S T="  "_$G(^(BBBB,0)) D PRINT(T)
"RTN","PSOLLL9",16,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL9",17,0)
 S PSOY=PSOY+PSOYI,T="This prescription was entered by "_$G(TECH) D PRINT(T)
"RTN","PSOLLL9",18,0)
 S PSOY=PSOY+PSOYI,T="This prescription may require reviewing by a pharmacist" D PRINT(T)
"RTN","PSOLLL9",19,0)
 S PSOY=PSOY+PSOYI I $G(RXRP(RX)) S T="(REPRINT)" D PRINT(T)
"RTN","PSOLLL9",20,0)
 F ICOUNT=1:1 S T=$G(SGY(ICOUNT)) Q:T=""  D PRINT(T)
"RTN","PSOLLL9",21,0)
 S T=RXN_"  "_DATE1_" Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL9",22,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL9",23,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PHYS) D PRINT(T)
"RTN","PSOLLL9",24,0)
 S T=$G(DRUG) D PRINT(T)
"RTN","PSOLLL9",25,0)
 S T="Tech__________RPh__________" D PRINT(T)
"RTN","PSOLLL9",26,0)
 S T="Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL") D PRINT(T)
"RTN","PSOLLL9",27,0)
 S T="Days Supply: "_$G(DAYS)_" Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL9",28,0)
 S T="Isd: "_ISD_" Exp: "_EXPDT D PRINT(T)
"RTN","PSOLLL9",29,0)
 S T="Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL9",30,0)
 S T="Pat. Stat "_PATST_" Clinic: "_PSCLN D PRINT(T)
"RTN","PSOLLL9",31,0)
 W @IOF
"RTN","PSOLLL9",32,0)
 I COPIES>0 G START
"RTN","PSOLLL9",33,0)
 S COPIES=HARDCOPY K HARDCOPY
"RTN","PSOLLL9",34,0)
 ;
"RTN","PSOLLL9",35,0)
STORE ;ALLERGY LABEL PRINT NODE - SHOULD ALWAYS BE ON THE ORIGINAL
"RTN","PSOLLL9",36,0)
 D NOW^%DTC S NOW=% S PSAA=0 F AAA=0:0 S AAA=$O(^PSRX(RX,"L",AAA)) Q:'AAA  S PSAA=AAA
"RTN","PSOLLL9",37,0)
 S PSAA=PSAA+1,^PSRX(RX,"L",0)="^52.032DA^"_PSAA_"^"_PSAA,^PSRX(RX,"L",PSAA,0)=NOW_"^"_0_"^Allergy warning label"_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^2"
"RTN","PSOLLL9",38,0)
END ;
"RTN","PSOLLL9",39,0)
 Q
"RTN","PSOLLL9",40,0)
PRINT(T) ;
"RTN","PSOLLL9",41,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL9",42,0)
 W T,!
"RTN","PSOLLL9",43,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL9",44,0)
 Q
"RTN","PSOLLLH")
0^14^B24388422
"RTN","PSOLLLH",1,0)
PSOLLLH ;BIR/EJW - HIPAA/NCPDP LASER LABELS ;11/3/2004
"RTN","PSOLLLH",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161**;DEC 1997
"RTN","PSOLLLH",3,0)
 ;
"RTN","PSOLLLH",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSOLLLH",5,0)
SIGLOG N I,J,RXF,RXY,RXN,RX,FIRST,DATE,BLNKLIN,RX2,FDT,BLNKLN2,LAST
"RTN","PSOLLLH",6,0)
 D PLANNM
"RTN","PSOLLLH",7,0)
 D DEM^VADPT
"RTN","PSOLLLH",8,0)
 S FIRST=1,LAST=0
"RTN","PSOLLLH",9,0)
 S $P(BLNKLN2," ",37)=" "
"RTN","PSOLLLH",10,0)
 S $P(BLNKLIN,"_",32)="_"
"RTN","PSOLLLH",11,0)
 F I=1:1:$L(PPL,",") S RX=$P(PPL,",",I) D
"RTN","PSOLLLH",12,0)
 .I RX="" Q
"RTN","PSOLLLH",13,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",14,0)
 .S RX2=$G(^PSRX(RX,2)),FDT=$P(RX2,"^",2)
"RTN","PSOLLLH",15,0)
 .I FIRST!(I#4=1) D HDR S FIRST=0
"RTN","PSOLLLH",16,0)
 .S RXF=+$O(^PSRX(RX,1,"A"),-1)
"RTN","PSOLLLH",17,0)
 .I RXF>0 I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLH",18,0)
 .S DATE=$E(FDT,1,7),Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLLH",19,0)
 .S RXN=$P(RXY,"^")
"RTN","PSOLLLH",20,0)
 .S T="Rx# "_RXN_"  "
"RTN","PSOLLLH",21,0)
 .S T=T_DATE_"  "_"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9))_"   _____" D PRINT(T)
"RTN","PSOLLLH",22,0)
 S LAST=1 D SIGN
"RTN","PSOLLLH",23,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLLH",24,0)
 K PLANNM
"RTN","PSOLLLH",25,0)
 Q
"RTN","PSOLLLH",26,0)
 ;
"RTN","PSOLLLH",27,0)
SIGN ;
"RTN","PSOLLLH",28,0)
 N II
"RTN","PSOLLLH",29,0)
 S II=I#4
"RTN","PSOLLLH",30,0)
 I LAST,II>0 F J=1:1:(4-II) S T=" " D PRINT(T)
"RTN","PSOLLLH",31,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",32,0)
 S T="Pt. Sig."_BLNKLIN D PRINT(T)
"RTN","PSOLLLH",33,0)
 S PSOY=PSOY+5
"RTN","PSOLLLH",34,0)
 S T=""
"RTN","PSOLLLH",35,0)
 S T=PLANNM
"RTN","PSOLLLH",36,0)
 D PRINT(T)
"RTN","PSOLLLH",37,0)
 S PSOY=PSOY+15
"RTN","PSOLLLH",38,0)
 S T="Relationship_________________ Counseled? _____" D PRINT(T)
"RTN","PSOLLLH",39,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",40,0)
 S T=PNM_"  "_$G(SSNP) D PRINT(T,1)
"RTN","PSOLLLH",41,0)
 Q
"RTN","PSOLLLH",42,0)
 ;
"RTN","PSOLLLH",43,0)
HDR ;
"RTN","PSOLLLH",44,0)
 I 'FIRST D SIGN W @IOF
"RTN","PSOLLLH",45,0)
 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLLH",46,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLLH",47,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T)
"RTN","PSOLLLH",48,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLLH",49,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLH",50,0)
 N REPMSG
"RTN","PSOLLLH",51,0)
 S REPMSG=BLNKLN2_"(REPRINT)"
"RTN","PSOLLLH",52,0)
 S T="By signing below"_$S($G(REPRINT):REPMSG,1:"") D PRINT(T,1)
"RTN","PSOLLLH",53,0)
 S T="you acknowledge receipt of the following Rx's" D PRINT(T,1)
"RTN","PSOLLLH",54,0)
 S T=" " D PRINT(T)
"RTN","PSOLLLH",55,0)
 S PSOY=PSOY-20
"RTN","PSOLLLH",56,0)
 Q
"RTN","PSOLLLH",57,0)
 ;
"RTN","PSOLLLH",58,0)
PRINT(T,B) ;
"RTN","PSOLLLH",59,0)
 S BOLD=$G(B)
"RTN","PSOLLLH",60,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLLH",61,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLLH",62,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLLH",63,0)
 W T,!
"RTN","PSOLLLH",64,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLLH",65,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLLH",66,0)
 Q
"RTN","PSOLLLH",67,0)
 ;
"RTN","PSOLLLH",68,0)
QUEUE ; ENTRY POINT TO PRINT STAND-ALONE MULTI-RX FORM
"RTN","PSOLLLH",69,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLH",70,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP,TECH
"RTN","PSOLLLH",71,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLH",72,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLH",73,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLH",74,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLH",75,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLH",76,0)
 D 6^VADPT,PID^VADPT6 S SSNP=$E($G(VA("PID")),5,12)
"RTN","PSOLLLH",77,0)
 S REPRINT=1
"RTN","PSOLLLH",78,0)
LRP W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Signature Log for Prescription: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) D KILL Q
"RTN","PSOLLLH",79,0)
 W !
"RTN","PSOLLLH",80,0)
 S (PPL,RX)=+Y
"RTN","PSOLLLH",81,0)
 N RXY
"RTN","PSOLLLH",82,0)
 S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",83,0)
 S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^")
"RTN","PSOLLLH",84,0)
 S DFN=$P(RXY,"^",2)
"RTN","PSOLLLH",85,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLH",86,0)
 I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSOLLLH",87,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLH",88,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLH",89,0)
 I $G(POP) Q
"RTN","PSOLLLH",90,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLH",91,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLLH",92,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLH",93,0)
 F G="PPL","REPRINT","TECH","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","RX","SSNP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLH",94,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLH",95,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1 K G
"RTN","PSOLLLH",96,0)
 G QUEUE
"RTN","PSOLLLH",97,0)
 Q
"RTN","PSOLLLH",98,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLH",99,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLH",100,0)
 G SIGLOG
"RTN","PSOLLLH",101,0)
 ;
"RTN","PSOLLLH",102,0)
PLANNM ;
"RTN","PSOLLLH",103,0)
 S PLANNM=""
"RTN","PSOLLLH",104,0)
 N I,J
"RTN","PSOLLLH",105,0)
 F I=1:1:$L(PPL,",") S RX=$P(PPL,",",I) D  I PLANNM'="" Q
"RTN","PSOLLLH",106,0)
 .I RX="" Q
"RTN","PSOLLLH",107,0)
 .S RXF=0 F J=0:0 S J=$O(^PSRX(RX,1,J)) Q:'J  S RXF=RXF+1
"RTN","PSOLLLH",108,0)
 .I $T(DUR1^BPSNCPD3)]"" D DUR1^BPSNCPD3(RX,+RXF,.DUR,.ERROR) S PLANNM=$G(DUR(1,"PLAN NAME"))
"RTN","PSOLLLH",109,0)
 Q
"RTN","PSOLLLH",110,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLH",111,0)
 K DIC,DFN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLH",112,0)
 Q
"RTN","PSOLLLI")
0^8^B65332955
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ;11/12/02
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,157,189,161**;DEC 1997
"RTN","PSOLLLI",3,0)
 ;
"RTN","PSOLLLI",4,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSOLLLI",5,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOLLLI",6,0)
 ;
"RTN","PSOLLLI",7,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",8,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",9,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",10,0)
 K RXFLX S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",11,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D
"RTN","PSOLLLI",12,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",13,0)
 . K RXP,REPRINT D C
"RTN","PSOLLLI",14,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",15,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSOLLLI",16,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",17,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X
"RTN","PSOLLLI",18,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",19,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",20,0)
 Q
"RTN","PSOLLLI",21,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",22,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY,OSGY
"RTN","PSOLLLI",23,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSOLLLI",24,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",25,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",26,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",27,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",28,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1
"RTN","PSOLLLI",29,0)
 S A=$P(RXSTA,"^") I A>11,'$G(RXP) D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",30,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",31,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",32,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",33,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",34,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",35,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",36,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",37,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",38,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",39,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",40,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",41,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",42,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",43,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",44,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",45,0)
 S RXY=^PSRX(RX,0),RX2=^(2),RXSTA=^("STA")
"RTN","PSOLLLI",46,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",47,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",48,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",49,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",50,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",51,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",52,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",53,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",54,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",55,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",56,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",57,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",58,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",59,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",60,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",61,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",62,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",63,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",64,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",65,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",66,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",67,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",68,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",69,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",70,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",71,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",72,0)
 S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),+$P(RXY,"^",2))
"RTN","PSOLLLI",73,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",74,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",75,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",76,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",77,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",78,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",79,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",80,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",81,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",82,0)
 .S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",83,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",84,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",85,0)
 S MAILCOM=""
"RTN","PSOLLLI",86,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",87,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=1
"RTN","PSOLLLI",88,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",89,0)
 S MAILCOM=$P($G(^PS(59,PSOSITE,9)),"^")
"RTN","PSOLLLI",90,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",91,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",92,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",93,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",94,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["A"&(DEA'["B"))!(DEA["W") PRTFL=0
"RTN","PSOLLLI",95,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$G(^SC(PSCLN,0)),PSCLN=$S($P(PSCLN,"^",2)'="":$P(PSCLN,"^",2),1:$E($P(PSCLN,"^"),1,7)) I PSCLN="" S PSCLN="UNKNOWN"
"RTN","PSOLLLI",96,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",97,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",98,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",99,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",100,0)
 I DEA["I"!(DEA["S") D SNO G LBL
"RTN","PSOLLLI",101,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",102,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",103,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",104,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",105,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7)) D SNO G LBL
"RTN","PSOLLLI",106,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7)) D SNO G LBL
"RTN","PSOLLLI",107,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",108,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",109,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",110,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",111,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",112,0)
 I $P(RXSTA,"^")=4 D ^PSOLLL8 Q  ;for a critical interaction entered by a tech - don't allow a label to be printed
"RTN","PSOLLLI",113,0)
 I $D(^PSRX(RX,"DRI")),'$G(RXF),'$G(RXP) D ^PSOLLL8
"RTN","PSOLLLI",114,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",115,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",116,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",117,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",118,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",119,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",120,0)
 Q
"RTN","PSOLLLI",121,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",122,0)
 Q
"RTN","PSOLLLI",123,0)
OSET ;
"RTN","PSOLLLI",124,0)
 N A
"RTN","PSOLLLI",125,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",126,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",127,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",128,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",129,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",130,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",131,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",132,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",133,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",134,0)
 Q
"RTN","PSOLLLI",135,0)
DOUB ;
"RTN","PSOLLLI",136,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",137,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",138,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",139,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",140,0)
 Q
"RTN","PSOLLLI",141,0)
IBCP ;
"RTN","PSOLLLI",142,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",143,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",144,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",145,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",146,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",147,0)
 Q
"RTN","PSOLLLI",148,0)
SNO ;
"RTN","PSOLLLI",149,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",150,0)
 Q
"RTN","PSOLLLW")
0^11^B21762349
"RTN","PSOLLLW",1,0)
PSOLLLW ;BIR/EJW - LASER LABELS NEW WARNING LABEL SOURCE ;05/04/2004
"RTN","PSOLLLW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161**;DEC 1997
"RTN","PSOLLLW",3,0)
 ;
"RTN","PSOLLLW",4,0)
 ;External reference to WTEXT^PSSWRNA supported by DBIA 4444
"RTN","PSOLLLW",5,0)
 ;
"RTN","PSOLLLW",6,0)
PRINT(T,B) ;
"RTN","PSOLLLW",7,0)
 S BOLD=$G(B)
"RTN","PSOLLLW",8,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLLW",9,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLLW",10,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLLW",11,0)
 W T,!
"RTN","PSOLLLW",12,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLLW",13,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLLW",14,0)
 Q
"RTN","PSOLLLW",15,0)
 ;
"RTN","PSOLLLW",16,0)
WARN54 ; WARNING LABELS FROM RX CONSULT FILE
"RTN","PSOLLLW",17,0)
 I PSOWARN=" " S PSOY=WWW*115+29+(WWW-1*2) Q  ; PRINT BLANK LABEL(S) TO BOTTOM-JUSTIFY IF LESS THAN 5 WARNING LABELS
"RTN","PSOLLLW",18,0)
 S (LENGTH,OUT)=0,LINE=1,LCNT=3
"RTN","PSOLLLW",19,0)
 S TEXT=$$WTEXT^PSSWRNA(PSOWARN,PSOLAN)
"RTN","PSOLLLW",20,0)
 I TEXT'="" D FORMAT
"RTN","PSOLLLW",21,0)
 Q
"RTN","PSOLLLW",22,0)
 ;
"RTN","PSOLLLW",23,0)
NEWWARN ; NEW WARNING LABEL SOURCE
"RTN","PSOLLLW",24,0)
 S (LENGTH,OUT)=0,LINE=1,LCNT=3
"RTN","PSOLLLW",25,0)
 S TEXT=$$WTEXT^PSSWRNA(PSOWARN,PSOLAN)
"RTN","PSOLLLW",26,0)
 I TEXT'="" D FORMAT
"RTN","PSOLLLW",27,0)
 Q
"RTN","PSOLLLW",28,0)
 ;
"RTN","PSOLLLW",29,0)
FORMAT ;
"RTN","PSOLLLW",30,0)
 D STRT^PSOLLU1("WRN",TEXT,.L,.XFONT)
"RTN","PSOLLLW",31,0)
 D INCREM
"RTN","PSOLLLW",32,0)
 S PTEXT=""
"RTN","PSOLLLW",33,0)
 F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLLW",34,0)
 F I=1:1:$L(TEXT," ") D STRT^PSOLLU1("WRN",$P(TEXT," ",I)_" ",.L) D  Q:OUT
"RTN","PSOLLLW",35,0)
 . I LENGTH+L($E(XFONT,2,99))<1.99 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L($E(XFONT,2,99)) Q
"RTN","PSOLLLW",36,0)
 . S LENGTH=0,I=I-1,PSOFONT=XFONT
"RTN","PSOLLLW",37,0)
 . D PRINT(PTEXT) S PTEXT="",LINE=LINE+1 I LINE>LCNT S OUT=1 Q
"RTN","PSOLLLW",38,0)
 I 'OUT S PSOFONT=XFONT D PRINT(PTEXT)
"RTN","PSOLLLW",39,0)
 S PSOY=WWW*115+29+(WWW-1*2)
"RTN","PSOLLLW",40,0)
 Q
"RTN","PSOLLLW",41,0)
 ;
"RTN","PSOLLLW",42,0)
INCREM ;
"RTN","PSOLLLW",43,0)
 I XFONT="F6" S LCNT=4
"RTN","PSOLLLW",44,0)
 S PSOY=PSOY+$S(XFONT="F12":10,XFONT="F10":8,XFONT="F9":8,1:5),PSOYI=$S(XFONT="F12":40,XFONT="F10":35,XFONT="F9":29,1:29)
"RTN","PSOLLLW",45,0)
 I WWW=1 S PSOY=$S(PSOY>103:PSOY-20,1:PSOY),PSOYI=$S(XFONT="F10":30,XFONT="F6":20,1:PSOYI)
"RTN","PSOLLLW",46,0)
 Q
"RTN","PSOLLLW",47,0)
 ;
"RTN","PSOLLLW",48,0)
COUNTSG ; COUNT LINES NEEDED FOR BOTTLE LABEL SIG FOR CALCULATED FONT
"RTN","PSOLLLW",49,0)
 N CNT,SUBS
"RTN","PSOLLLW",50,0)
 S CNT=0
"RTN","PSOLLLW",51,0)
 K ^TMP($J,"PSOSIG",RX)
"RTN","PSOLLLW",52,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLW",53,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLLW",54,0)
 F DR=SIGF("DR"):1 Q:$G(SGY(DR))=""  S TEXT=SGY(DR) D  Q:SIGF
"RTN","PSOLLLW",55,0)
 . F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLLW",56,0)
 . S DP=$S(TEXT[" ":" ",TEXT[",":",",1:" ")
"RTN","PSOLLLW",57,0)
 . F I=SIGF("T"):1:$L(TEXT,DP) D  Q:SIGF
"RTN","PSOLLLW",58,0)
 .. S TEXTP=$P(TEXT,DP,I) Q:TEXTP=""  I $D(SIGF("J")) S TEXTP=$E(TEXTP,SIGF("J"),255) K SIGF("J")
"RTN","PSOLLLW",59,0)
 .. D STRT^PSOLLU1("SIG",TEXTP_" ",.L) I L(XFONT)>3.3 D
"RTN","PSOLLLW",60,0)
 ... S MORE=0
"RTN","PSOLLLW",61,0)
 ... F J=$L(TEXTP):-1:1 S TEXTL=PTEXT_$E(TEXTP,1,J) D STRT^PSOLLU1("SIG",TEXTL_" ",.L) D  Q:SIGF!MORE
"RTN","PSOLLLW",62,0)
 .... Q:L(XFONT)>3.3
"RTN","PSOLLLW",63,0)
 .... S CNT=CNT+1,^TMP($J,"PSOSIG",RX,CNT)=TEXTL,TEXT=$E(TEXT,J+1,999),PTEXT=""
"RTN","PSOLLLW",64,0)
 .... D STRT^PSOLLU1("SIG",TEXT_DP,.L) S TEXTP=TEXT,J=$L(TEXTP) I L(XFONT)<3.3 S MORE=1,LENGTH=0
"RTN","PSOLLLW",65,0)
 .. I LENGTH+L(XFONT)<3.3 S PTEXT=PTEXT_TEXTP_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLLW",66,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLLW",67,0)
 .. S CNT=CNT+1,^TMP($J,"PSOSIG",RX,CNT)=PTEXT S PTEXT=""
"RTN","PSOLLLW",68,0)
 . I 'SIGF S SIGF("T")=1
"RTN","PSOLLLW",69,0)
 I PTEXT]"" S CNT=CNT+1,^TMP($J,"PSOSIG",RX,CNT)=PTEXT
"RTN","PSOLLLW",70,0)
 K NSGY
"RTN","PSOLLLW",71,0)
 ; FOR LONG SIGS THE SMALLEST FONT WILL BE USED. USING THAT FONT, 9 LINES OF THE SIG WILL FIT ON EACH BOTTLE LABEL. ON THE LAST 'CONTINUED' LABEL A MAXIMUM OF 4 LINES OF THE SIG CAN PRINT (WITHIN LINES 5-8 OF THE LABEL).
"RTN","PSOLLLW",72,0)
 ; IF THERE ARE LESS THAN 4 LINES ON THE LAST 'CONTINUED' LABEL, THE REMAINDER OF THE SIG WILL PRINT BOTTOM-JUSTIFIED WITHIN LINES 5-8 OF THE CONTINUATION LABEL.
"RTN","PSOLLLW",73,0)
 N I,J,MODCNT
"RTN","PSOLLLW",74,0)
 F I=1:1:CNT S J=$S(I#9:(I\9)+1,1:I\9) D
"RTN","PSOLLLW",75,0)
 .S SUBS=$S(J=1:I,1:I-((J-1)*9))
"RTN","PSOLLLW",76,0)
 .S NSGY(J,SUBS)=^TMP($J,"PSOSIG",RX,I)
"RTN","PSOLLLW",77,0)
 S MODCNT=CNT#9 I MODCNT=0!(MODCNT>4) S NSGY($G(J)+1,0)=" " ; FORCE LAST CONTINUED LABEL
"RTN","PSOLLLW",78,0)
 Q
"RTN","PSOLLLW",79,0)
 ;
"RTN","PSOLLLW",80,0)
COUNTSGF ; COUNT LINES NEEDED FOR PHARMACY FILL CARD SIG FOR CALCULATED FONT
"RTN","PSOLLLW",81,0)
 N CNT
"RTN","PSOLLLW",82,0)
 S CNT=0
"RTN","PSOLLLW",83,0)
 K ^TMP($J,"PSOSIGF",RX)
"RTN","PSOLLLW",84,0)
 S LENGTH=0,PTEXT="",PFF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLW",85,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLLW",86,0)
 F DR=PFF("DR"):1 Q:$G(PGY(DR))=""  S TEXT=PGY(DR) D  Q:PFF
"RTN","PSOLLLW",87,0)
 . F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLLW",88,0)
 . S DP=$S(TEXT[" ":" ",TEXT[",":",",1:" ")
"RTN","PSOLLLW",89,0)
 . F I=PFF("T"):1:$L(TEXT,DP) D  Q:PFF
"RTN","PSOLLLW",90,0)
 .. S TEXTP=$P(TEXT,DP,I) Q:TEXTP=""  I $D(PFF("J")) S TEXTP=$E(TEXTP,PFF("J"),255) K PFF("J")
"RTN","PSOLLLW",91,0)
 .. D STRT^PSOLLU1("SIG",TEXTP_" ",.L) I L(XFONT)>3.3 D
"RTN","PSOLLLW",92,0)
 ... S MORE=0
"RTN","PSOLLLW",93,0)
 ... F J=$L(TEXTP):-1:1 S TEXTL=PTEXT_$E(TEXTP,1,J) D STRT^PSOLLU1("SIG",TEXTL_" ",.L) D  Q:PFF!MORE
"RTN","PSOLLLW",94,0)
 .... Q:L(XFONT)>3.3
"RTN","PSOLLLW",95,0)
 .... S CNT=CNT+1,^TMP($J,"PSOSIGF",RX,CNT)=TEXTL,TEXT=$E(TEXT,J+1,999),PTEXT=""
"RTN","PSOLLLW",96,0)
 .... D STRT^PSOLLU1("SIG",TEXT_DP,.L) S TEXTP=TEXT,J=$L(TEXTP) I L(XFONT)<3.3 S MORE=1,LENGTH=0
"RTN","PSOLLLW",97,0)
 .. I LENGTH+L(XFONT)<3.3 S PTEXT=PTEXT_TEXTP_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLLW",98,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLLW",99,0)
 .. S CNT=CNT+1,^TMP($J,"PSOSIGF",RX,CNT)=PTEXT S PTEXT=""
"RTN","PSOLLLW",100,0)
 . I 'PFF S PFF("T")=1
"RTN","PSOLLLW",101,0)
 I PTEXT]"" S CNT=CNT+1,^TMP($J,"PSOSIGF",RX,CNT)=PTEXT
"RTN","PSOLLLW",102,0)
 K NPGY
"RTN","PSOLLLW",103,0)
 ; 11 LINES OF THE SIG WILL FIT ON EACH PHARMACY FILL CARD LABEL. ON THE LAST 'CONTINUED' LABEL A MAXIMUM OF 4 LINES OF THE SIG CAN PRINT
"RTN","PSOLLLW",104,0)
 N I,J,MODCNT
"RTN","PSOLLLW",105,0)
 F I=1:1:CNT S J=$S(I#11:(I\11)+1,1:I\11) D
"RTN","PSOLLLW",106,0)
 .S SUBS=$S(J=1:I,1:I-((J-1)*11))
"RTN","PSOLLLW",107,0)
 .S NPGY(J,SUBS)=^TMP($J,"PSOSIGF",RX,I)
"RTN","PSOLLLW",108,0)
 S MODCNT=CNT#11 I MODCNT=0!(MODCNT>4) S NPGY($G(J)+1,0)=" " ; FORCE LAST CONTINUED LABEL
"RTN","PSOLLLW",109,0)
 Q
"RTN","PSOLLLW",110,0)
 ;
"RTN","PSOLLU1")
0^9^B21617128
"RTN","PSOLLU1",1,0)
PSOLLU1 ;BHAM/RJS - LASER LABEL UTILITIES ;11/22/02
"RTN","PSOLLU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,161**;DEC 1997
"RTN","PSOLLU1",3,0)
 ;
"RTN","PSOLLU1",4,0)
FONT(RLN,TEXT) ;
"RTN","PSOLLU1",5,0)
 ;--------------------------------------------------------------------
"RTN","PSOLLU1",6,0)
 ;VARIABLES:
"RTN","PSOLLU1",7,0)
 ;    INPUT:
"RTN","PSOLLU1",8,0)
 ; REQUIRED: RLN - Relates to a value used to determine the max
"RTN","PSOLLU1",9,0)
 ;                   line length.
"RTN","PSOLLU1",10,0)
 ;            TEXT - Can contain a string and the $L(TEXT) is used
"RTN","PSOLLU1",11,0)
 ;                    to calculate the font size.
"RTN","PSOLLU1",12,0)
 ;   RETURN:
"RTN","PSOLLU1",13,0)
 ;             FONT - This is the calculated optimal font size.
"RTN","PSOLLU1",14,0)
 ;                    F8, F9, F10 or F12 will be returned. 
"RTN","PSOLLU1",15,0)
 ;--------------------------------------------------------------------
"RTN","PSOLLU1",16,0)
 D STRT(RLN,TEXT,"",.FONT) Q FONT
"RTN","PSOLLU1",17,0)
 Q
"RTN","PSOLLU1",18,0)
 ;
"RTN","PSOLLU1",19,0)
STRT(RLN,TEXT,LNTH,FONT) ;
"RTN","PSOLLU1",20,0)
 ;  The LETTER array contains all the number of character per inch
"RTN","PSOLLU1",21,0)
 ;  for the different font sizes that can be used.
"RTN","PSOLLU1",22,0)
 N LN,LETTER,TXTIDX,SIZ,FNTIDX,LTTR,A
"RTN","PSOLLU1",23,0)
 S LETTER(1)="22^16^14^13^10",LETTER("!")="40^32^28^25^21"
"RTN","PSOLLU1",24,0)
 S LETTER(2)="22^16^14^13^10",LETTER("@")="11^8^7^7^5"
"RTN","PSOLLU1",25,0)
 S LETTER(3)="22^16^14^13^10",LETTER("#")="19^16^14^12^10"
"RTN","PSOLLU1",26,0)
 S LETTER(4)="22^16^14^13^10",LETTER("$")="20^18^16^14^12"
"RTN","PSOLLU1",27,0)
 S LETTER(5)="22^16^14^13^10",LETTER("%")="14^13^11^10^8"
"RTN","PSOLLU1",28,0)
 S LETTER(6)="22^16^14^13^10"
"RTN","PSOLLU1",29,0)
 S LETTER(7)="22^16^14^13^10",LETTER("&")="22^16^14^12^10"
"RTN","PSOLLU1",30,0)
 S LETTER(8)="22^16^14^13^10",LETTER("*")="30^23^20^18^15"
"RTN","PSOLLU1",31,0)
 S LETTER(9)="22^16^14^13^10",LETTER("(")="32^27^24^21^18"
"RTN","PSOLLU1",32,0)
 S LETTER(0)="22^16^14^13^10",LETTER(")")="32^27^24^21^18"
"RTN","PSOLLU1",33,0)
 S LETTER($C(34))="30^27^24^21^18",LETTER("'")="45^40^36^32^27"
"RTN","PSOLLU1",34,0)
 S LETTER("`")="30^27^24^21^18",LETTER("~")="18^15^13^12^10"
"RTN","PSOLLU1",35,0)
 S LETTER(",")="40^32^28^25^21",LETTER("<")="18^15^13^12^10"
"RTN","PSOLLU1",36,0)
 S LETTER(".")="35^27^24^21^18",LETTER(">")="18^15^13^12^10"
"RTN","PSOLLU1",37,0)
 S LETTER(";")="40^32^28^25^21",LETTER(":")="40^32^28^25^21"
"RTN","PSOLLU1",38,0)
 S LETTER("?")="22^16^14^12^10",LETTER("/")="40^32^28^25^21"
"RTN","PSOLLU1",39,0)
 S LETTER("[")="40^32^28^25^21",LETTER("{")="35^26^23^21^17"
"RTN","PSOLLU1",40,0)
 S LETTER("\")="40^32^28^25^21",LETTER("|")="42^34^30^27^23"
"RTN","PSOLLU1",41,0)
 S LETTER("]")="40^32^28^25^21",LETTER("}")="35^26^23^21^17"
"RTN","PSOLLU1",42,0)
 S LETTER("_")="20^15^14^12^10",LETTER("-")="30^27^24^21^18"
"RTN","PSOLLU1",43,0)
 S LETTER("=")="20^15^14^12^10",LETTER("+")="22^18^16^14^12"
"RTN","PSOLLU1",44,0)
 S LETTER(" ")="40^32^28^25^21"
"RTN","PSOLLU1",45,0)
 S LETTER("a")="19^16^14^12^10",LETTER("A")="16^13^11^10^8"
"RTN","PSOLLU1",46,0)
 S LETTER("b")="19^16^14^12^10",LETTER("B")="16^13^11^10^8"
"RTN","PSOLLU1",47,0)
 S LETTER("c")="22^18^16^14^12",LETTER("C")="15^13^11^10^8"
"RTN","PSOLLU1",48,0)
 S LETTER("d")="20^16^14^12^10",LETTER("D")="15^13^11^10^8"
"RTN","PSOLLU1",49,0)
 S LETTER("e")="20^16^14^12^10",LETTER("E")="16^13^11^10^8"
"RTN","PSOLLU1",50,0)
 S LETTER("f")="40^32^28^25^21",LETTER("F")="18^14^13^11^9"
"RTN","PSOLLU1",51,0)
 S LETTER("g")="20^16^14^12^10",LETTER("G")="14^11^10^9^7"
"RTN","PSOLLU1",52,0)
 S LETTER("h")="20^16^14^12^10",LETTER("H")="15^13^11^10^8"
"RTN","PSOLLU1",53,0)
 S LETTER("i")="50^40^36^32^27",LETTER("I")="40^32^28^25^21"
"RTN","PSOLLU1",54,0)
 S LETTER("j")="50^40^36^32^27",LETTER("J")="22^18^16^14^12"
"RTN","PSOLLU1",55,0)
 S LETTER("k")="24^18^16^14^12",LETTER("K")="16^13^11^10^8"
"RTN","PSOLLU1",56,0)
 S LETTER("l")="50^40^36^32^27",LETTER("L")="20^16^14^12^10"
"RTN","PSOLLU1",57,0)
 S LETTER("m")="13^10^9^8^7",LETTER("M")="13^11^10^9^7"
"RTN","PSOLLU1",58,0)
 S LETTER("n")="20^16^14^12^10",LETTER("N")="15^13^11^10^8"
"RTN","PSOLLU1",59,0)
 S LETTER("o")="20^16^14^12^10",LETTER("O")="14^11^10^9^7"
"RTN","PSOLLU1",60,0)
 S LETTER("p")="20^16^14^12^10",LETTER("P")="16^13^11^10^8"
"RTN","PSOLLU1",61,0)
 S LETTER("q")="20^16^14^12^10",LETTER("Q")="14^11^10^9^7"
"RTN","PSOLLU1",62,0)
 S LETTER("r")="35^32^28^25^21",LETTER("R")="15^13^11^10^8"
"RTN","PSOLLU1",63,0)
 S LETTER("s")="22^18^16^14^12",LETTER("S")="16^13^11^10^8"
"RTN","PSOLLU1",64,0)
 S LETTER("t")="40^32^28^25^21",LETTER("T")="18^14^13^11^9"
"RTN","PSOLLU1",65,0)
 S LETTER("u")="20^16^14^12^10",LETTER("U")="15^13^11^10^8"
"RTN","PSOLLU1",66,0)
 S LETTER("v")="23^18^16^14^12",LETTER("V")="16^13^11^10^8"
"RTN","PSOLLU1",67,0)
 S LETTER("w")="14^12^11^9^8",LETTER("W")="11^9^8^7^6"
"RTN","PSOLLU1",68,0)
 S LETTER("x")="23^18^16^14^12",LETTER("X")="16^13^11^10^8"
"RTN","PSOLLU1",69,0)
 S LETTER("y")="23^18^16^14^12",LETTER("Y")="16^13^11^10^8"
"RTN","PSOLLU1",70,0)
 S LETTER("z")="23^18^16^14^12",LETTER("Z")="18^14^13^11^9"
"RTN","PSOLLU1",71,0)
 ;
"RTN","PSOLLU1",72,0)
 ;  The LN array contains the length in inches for the different 
"RTN","PSOLLU1",73,0)
 ;  sections of the laser label.
"RTN","PSOLLU1",74,0)
 S LN("RX#")=3.126
"RTN","PSOLLU1",75,0)
 S LN("RXVAMC")=2.626
"RTN","PSOLLU1",76,0)
 S LN("DRG")=3.376
"RTN","PSOLLU1",77,0)
 S LN("SIG")=3.126
"RTN","PSOLLU1",78,0)
 S LN("WRN")=1.99
"RTN","PSOLLU1",79,0)
 S LN("ML")=2.376
"RTN","PSOLLU1",80,0)
 S LN("ML2")=1.76
"RTN","PSOLLU1",81,0)
 S LN("SEC2")=4.1876
"RTN","PSOLLU1",82,0)
 S LN("SEC2X")=LN("SEC2")
"RTN","PSOLLU1",83,0)
 S LN("SIG2")=LN("SEC2")
"RTN","PSOLLU1",84,0)
 S LN("SEC2B")=LN("WRN")
"RTN","PSOLLU1",85,0)
 S LN("FULL")=8.1876
"RTN","PSOLLU1",86,0)
 ;
"RTN","PSOLLU1",87,0)
 ; The LNTH array is used in calculating the length of the text
"RTN","PSOLLU1",88,0)
 ; for each of the different font sizes.
"RTN","PSOLLU1",89,0)
 S (LNTH(6),LNTH(8),LNTH(9),LNTH(10),LNTH(12))=""
"RTN","PSOLLU1",90,0)
 ;
"RTN","PSOLLU1",91,0)
 ; This section walks the TEXT string and extracts the each character
"RTN","PSOLLU1",92,0)
 ; then uses the LETTER array to lookup the number of characters per
"RTN","PSOLLU1",93,0)
 ; inch and calculates the length of the TEXT for each font.
"RTN","PSOLLU1",94,0)
 F TXTIDX=1:1:$L(TEXT) D
"RTN","PSOLLU1",95,0)
 .S LTTR=$E(TEXT,TXTIDX),A=$G(LETTER(LTTR),"18^16^14^12^10")
"RTN","PSOLLU1",96,0)
 .S LNTH(6)=LNTH(6)+(1/$P(A,U))
"RTN","PSOLLU1",97,0)
 .S LNTH(8)=LNTH(8)+(1/($P(A,U,2)))
"RTN","PSOLLU1",98,0)
 .S LNTH(9)=LNTH(9)+(1/($P(A,U,3)))
"RTN","PSOLLU1",99,0)
 .S LNTH(10)=LNTH(10)+(1/($P(A,U,4)))
"RTN","PSOLLU1",100,0)
 .S LNTH(12)=LNTH(12)+(1/($P(A,U,5)))
"RTN","PSOLLU1",101,0)
 ;
"RTN","PSOLLU1",102,0)
 ; This section determines what would be the optimal font for the TEXT
"RTN","PSOLLU1",103,0)
 I RLN="WRN" D  Q
"RTN","PSOLLU1",104,0)
 . I LNTH(12)<LN(RLN) S FONT="F12" Q
"RTN","PSOLLU1",105,0)
 . I LNTH(10)<(LN(RLN)*2) S FONT="F10" Q
"RTN","PSOLLU1",106,0)
 . I LNTH(9)<(LN(RLN)*2.5) S FONT="F9" Q
"RTN","PSOLLU1",107,0)
 . I LNTH(8)<(LN(RLN)*2.6) S FONT="F8" Q
"RTN","PSOLLU1",108,0)
 . S FONT="F6"
"RTN","PSOLLU1",109,0)
 S FONT="F0"
"RTN","PSOLLU1",110,0)
 I LNTH(8)<LN(RLN) S FONT="F8"
"RTN","PSOLLU1",111,0)
 I LNTH(9)<LN(RLN) S FONT="F9"
"RTN","PSOLLU1",112,0)
 I LNTH(10)<LN(RLN) S FONT="F10"
"RTN","PSOLLU1",113,0)
 I LNTH(12)<LN(RLN) S FONT="F12"
"RTN","PSOLLU1",114,0)
 Q
"RTN","PSOLLU1",115,0)
ADD ; Calculate the length and pad "_" to the end of TEXT for change of address
"RTN","PSOLLU1",116,0)
 ; then return FONT and TEXT to calling program.
"RTN","PSOLLU1",117,0)
 N NEEDED,CNT,DASH
"RTN","PSOLLU1",118,0)
 S NEEDED=LN("SEC2X")-LNTH(10)
"RTN","PSOLLU1",119,0)
 S CNT=NEEDED*12\1
"RTN","PSOLLU1",120,0)
 S DASH="________________________________________________________________________________________________________________"
"RTN","PSOLLU1",121,0)
 S TEXT2=TEXT_" "_$E(DASH,1,CNT)
"RTN","PSOLLU1",122,0)
 S FONT="F10"
"RTN","PSOLLU1",123,0)
 Q
"RTN","PSOLLU4")
0^12^B7683553
"RTN","PSOLLU4",1,0)
PSOLLU4 ;BIR/EJW - CHANGE CONTROL CODES ;05/23/2004
"RTN","PSOLLU4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161**;DEC 1997
"RTN","PSOLLU4",3,0)
 ;
"RTN","PSOLLU4",4,0)
 ;Read-only reference to %ZIS(2 supported by DBIA 3435
"RTN","PSOLLU4",5,0)
 ;Reference to %ZIS(2 supported by DBIA 3884
"RTN","PSOLLU4",6,0)
 ;
"RTN","PSOLLU4",7,0)
 N IO,IOST
"RTN","PSOLLU4",8,0)
 S %ZIS="MN"
"RTN","PSOLLU4",9,0)
IO D ^%ZIS
"RTN","PSOLLU4",10,0)
 I '$G(IOST(0)) W "No terminal type available." Q
"RTN","PSOLLU4",11,0)
 I '$D(DUZ(0)) W "No DUZ defined." Q
"RTN","PSOLLU4",12,0)
 I DUZ(0)'="@" W "FileMan access must be @." Q
"RTN","PSOLLU4",13,0)
 I '$D(^%ZIS(2,IOST(0),55,"B","LL")) W "No CONTROL CODES defined." Q
"RTN","PSOLLU4",14,0)
 W !!,"You will be copying the CONTROL CODES to device: ",IO K DIR W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Are you sure" D ^DIR K DIR I Y'=1 G IO
"RTN","PSOLLU4",15,0)
 W !,"Copying..."
"RTN","PSOLLU4",16,0)
 S AB="PFI",NAME="PATIENT FILL INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1210,PSOY=710,PSOYI=45,PSOHFONT=""F12"",PSOBYI=100" D FILE
"RTN","PSOLLU4",17,0)
 S AB="PFDW",NAME="PHARMACY FILL DOCUMENT WARNING",CODE="S PSOY=1258,PSOX=660,PSOYI=30,PSOFONT=""F8"",PSOYM=1329" D FILE
"RTN","PSOLLU4",18,0)
 S AB="MLI",NAME="MAILING LABEL INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1680,PSOY=175,PSOYI=50" D FILE
"RTN","PSOLLU4",19,0)
 S AB="RMI",NAME="RETURN MAIL INITIALIZATION",CODE="S PSOHFONT=""F8"",PSOFONT=""F10"",PSOX=1680,PSOY=35,PSORYI=40,PSOHYI=40,PSOTFONT=""F8"",PSOTY=550" D FILE
"RTN","PSOLLU4",20,0)
 D CLEAN
"RTN","PSOLLU4",21,0)
 Q
"RTN","PSOLLU4",22,0)
FILE K DIC,DIE S DIC(0)="L",DA(1)=IOST(0),X=AB,DIC="^%ZIS(2,"_DA(1)_",55," D FILE^DICN
"RTN","PSOLLU4",23,0)
 K DA,DR,DIE S DIE=DIC,DA=+Y,DA(1)=IOST(0)
"RTN","PSOLLU4",24,0)
 S DR=".01////"_AB_";1////"_NAME_";2////"_CODE D ^DIE
"RTN","PSOLLU4",25,0)
 Q
"RTN","PSOLLU4",26,0)
 ;
"RTN","PSOLLU4",27,0)
CLEAN ; REMOVE EXACT DUPLICATE CONTROL CODES RESULTING WHEN CHANGE CONTROL CODES ROUTINES ARE RUN MORE THAN ONCE
"RTN","PSOLLU4",28,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOLLU4",29,0)
 I '$D(^XTMP("PSOLLU4")) S X1=DT,X2=+90 D C^%DTC S ^XTMP("PSOLLU4",0)=$G(X)_"^"_DT
"RTN","PSOLLU4",30,0)
 I '$D(IOST(0)) Q
"RTN","PSOLLU4",31,0)
 M ^XTMP("PSOLLU4",$J,IOST(0))=^%ZIS(2,IOST(0)) ; SAVE COPY OF SETTINGS BEFORE CLEAN-UP
"RTN","PSOLLU4",32,0)
 S CODE="" F  S CODE=$O(^%ZIS(2,IOST(0),55,"B",CODE)) Q:CODE=""  S SEQ=0 F  S SEQ=$O(^%ZIS(2,IOST(0),55,"B",CODE,SEQ)) Q:'SEQ  D
"RTN","PSOLLU4",33,0)
 .I '$D(^%ZIS(2,IOST(0),55,SEQ)) K ^%ZIS(2,IOST(0),55,"B",CODE,SEQ) Q
"RTN","PSOLLU4",34,0)
 .S SEQ1=$O(^%ZIS(2,IOST(0),55,"B",CODE,SEQ)) I SEQ1="" Q
"RTN","PSOLLU4",35,0)
 .S X0=$G(^%ZIS(2,IOST(0),55,SEQ,0)),X1=$G(^(1))
"RTN","PSOLLU4",36,0)
 .S Z0=$G(^%ZIS(2,IOST(0),55,SEQ1,0)),Z1=$G(^(1))
"RTN","PSOLLU4",37,0)
 .I X0'="",X1'="" D
"RTN","PSOLLU4",38,0)
 ..I X0=Z0,X1=Z1 K ^%ZIS(2,IOST(0),55,"B",CODE,SEQ),^%ZIS(2,IOST(0),55,SEQ)
"RTN","PSOLLU4",39,0)
 Q
"RTN","PSOLLU4",40,0)
 ;
"VER")
8.0^22.0
"^DD",59,59,.081,0)
MAILING COMMENTS^F^^9;1^K:$L(X)>29!($L(X)<1) X
"^DD",59,59,.081,3)
Answer must be 1-29 characters in length
"^DD",59,59,.081,21,0)
^^3^3^3040512^
"^DD",59,59,.081,21,1,0)
This field will be printed on the laser labels mailing address label. It 
"^DD",59,59,.081,21,2,0)
can contain anything the site deems appropriate (i.e. whether mailing is 
"^DD",59,59,.081,21,3,0)
"Forwarding service requested" or "Address service requested", etc.)
"^DD",59,59,.081,"DT")
3040512
**END**
**END**
