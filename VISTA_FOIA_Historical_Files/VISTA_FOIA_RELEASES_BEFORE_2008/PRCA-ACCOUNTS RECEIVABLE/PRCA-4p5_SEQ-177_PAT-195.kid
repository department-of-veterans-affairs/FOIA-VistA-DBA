Released PRCA*4.5*195 SEQ #177
Extracted from mail message
**KIDS**:PRCA*4.5*195^

**INSTALL NAME**
PRCA*4.5*195
"BLD",4783,0)
PRCA*4.5*195^ACCOUNTS RECEIVABLE^0^3030925^y
"BLD",4783,1,0)
^^7^7^3030529^
"BLD",4783,1,1,0)
 
"BLD",4783,1,2,0)
This patch addresses 2 issues. The first issue is regarding no 
"BLD",4783,1,3,0)
transmission received for station #641, VA Maryland Health Care dated
"BLD",4783,1,4,0)
03/15/2003 after they ran the Transmit CCPC Messages [RCCPC TRANSMIT] 
"BLD",4783,1,5,0)
option. The second issue is that site receives the same transmission error
"BLD",4783,1,6,0)
message T404W almost every single month from Austin when they attempt 
"BLD",4783,1,7,0)
to transmit a build file that takes over 24 hours to complete.
"BLD",4783,4,0)
^9.64PA^^
"BLD",4783,"ABPKG")
n
"BLD",4783,"KRN",0)
^9.67PA^8989.52^19
"BLD",4783,"KRN",.4,0)
.4
"BLD",4783,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4783,"KRN",.401,0)
.401
"BLD",4783,"KRN",.402,0)
.402
"BLD",4783,"KRN",.403,0)
.403
"BLD",4783,"KRN",.5,0)
.5
"BLD",4783,"KRN",.84,0)
.84
"BLD",4783,"KRN",3.6,0)
3.6
"BLD",4783,"KRN",3.8,0)
3.8
"BLD",4783,"KRN",9.2,0)
9.2
"BLD",4783,"KRN",9.8,0)
9.8
"BLD",4783,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4783,"KRN",9.8,"NM",1,0)
RCCPCML^^0^B41427616
"BLD",4783,"KRN",9.8,"NM",2,0)
RCCPCBJ^^0^B5930342
"BLD",4783,"KRN",9.8,"NM","B","RCCPCBJ",2)

"BLD",4783,"KRN",9.8,"NM","B","RCCPCML",1)

"BLD",4783,"KRN",19,0)
19
"BLD",4783,"KRN",19,"NM",0)
^9.68A^^
"BLD",4783,"KRN",19.1,0)
19.1
"BLD",4783,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4783,"KRN",101,0)
101
"BLD",4783,"KRN",101,"NM",0)
^9.68A^^
"BLD",4783,"KRN",409.61,0)
409.61
"BLD",4783,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4783,"KRN",771,0)
771
"BLD",4783,"KRN",771,"NM",0)
^9.68A^^
"BLD",4783,"KRN",870,0)
870
"BLD",4783,"KRN",870,"NM",0)
^9.68A^^
"BLD",4783,"KRN",8989.51,0)
8989.51
"BLD",4783,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",4783,"KRN",8989.52,0)
8989.52
"BLD",4783,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",4783,"KRN",8994,0)
8994
"BLD",4783,"KRN",8994,"NM",0)
^9.68A^^
"BLD",4783,"KRN","B",.4,.4)

"BLD",4783,"KRN","B",.401,.401)

"BLD",4783,"KRN","B",.402,.402)

"BLD",4783,"KRN","B",.403,.403)

"BLD",4783,"KRN","B",.5,.5)

"BLD",4783,"KRN","B",.84,.84)

"BLD",4783,"KRN","B",3.6,3.6)

"BLD",4783,"KRN","B",3.8,3.8)

"BLD",4783,"KRN","B",9.2,9.2)

"BLD",4783,"KRN","B",9.8,9.8)

"BLD",4783,"KRN","B",19,19)

"BLD",4783,"KRN","B",19.1,19.1)

"BLD",4783,"KRN","B",101,101)

"BLD",4783,"KRN","B",409.61,409.61)

"BLD",4783,"KRN","B",771,771)

"BLD",4783,"KRN","B",870,870)

"BLD",4783,"KRN","B",8989.51,8989.51)

"BLD",4783,"KRN","B",8989.52,8989.52)

"BLD",4783,"KRN","B",8994,8994)

"BLD",4783,"QUES",0)
^9.62^^
"BLD",4783,"REQB",0)
^9.611^2^2
"BLD",4783,"REQB",1,0)
PRCA*4.5*166^2
"BLD",4783,"REQB",2,0)
PRCA*4.5*187^2
"BLD",4783,"REQB","B","PRCA*4.5*166",1)

"BLD",4783,"REQB","B","PRCA*4.5*187",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
195^3030925
"PKG",142,22,1,"PAH",1,1,0)
^^7^7^3030925
"PKG",142,22,1,"PAH",1,1,1,0)
 
"PKG",142,22,1,"PAH",1,1,2,0)
This patch addresses 2 issues. The first issue is regarding no 
"PKG",142,22,1,"PAH",1,1,3,0)
transmission received for station #641, VA Maryland Health Care dated
"PKG",142,22,1,"PAH",1,1,4,0)
03/15/2003 after they ran the Transmit CCPC Messages [RCCPC TRANSMIT] 
"PKG",142,22,1,"PAH",1,1,5,0)
option. The second issue is that site receives the same transmission error
"PKG",142,22,1,"PAH",1,1,6,0)
message T404W almost every single month from Austin when they attempt 
"PKG",142,22,1,"PAH",1,1,7,0)
to transmit a build file that takes over 24 hours to complete.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCCPCBJ")
0^2^B5930342
"RTN","RCCPCBJ",1,0)
RCCPCBJ ;WASH-ISC@ALTOONA,PA/NYB-Background Driver for CCPC ;1/7/97  9:42 AM
"RTN","RCCPCBJ",2,0)
 ;;4.5;Accounts Receivable;**34,76,130,153,166,195**;Mar 20, 1995
"RTN","RCCPCBJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCCPCBJ",4,0)
EN ;Starts the background job for CCPC 5 days before statement day
"RTN","RCCPCBJ",5,0)
 N X,X1,X2,X3,ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","RCCPCBJ",6,0)
 D ACK
"RTN","RCCPCBJ",7,0)
 S X1=$$STD^RCCPCFN,X2=-2 D C^%DTC
"RTN","RCCPCBJ",8,0)
 ;10-process end time/18-ccpc file built
"RTN","RCCPCBJ",9,0)
 I X=DT D  Q
"RTN","RCCPCBJ",10,0)
 . S X3=$O(^RCPS(349.2,0)) Q:'X3
"RTN","RCCPCBJ",11,0)
 . Q:'$P($P($G(^RCPS(349.2,X3,0)),"^",10),".")
"RTN","RCCPCBJ",12,0)
 . Q:'$P($G(^RCPS(349.2,X3,0)),"^",18)
"RTN","RCCPCBJ",13,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",14,0)
 ;quit if date created is yesterday's date
"RTN","RCCPCBJ",15,0)
 S X1=$$STD^RCCPCFN,X2=-1 D C^%DTC
"RTN","RCCPCBJ",16,0)
 I X=DT D  Q
"RTN","RCCPCBJ",17,0)
 . S X3=$O(^RCT(349,0))
"RTN","RCCPCBJ",18,0)
 . S X3=$P($P($G(^RCT(349,X3,0)),"^",11),".")
"RTN","RCCPCBJ",19,0)
 . S X1=DT,X2=-1 D C^%DTC
"RTN","RCCPCBJ",20,0)
 . I X=X3 Q
"RTN","RCCPCBJ",21,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",22,0)
 ;
"RTN","RCCPCBJ",23,0)
 S X1=$$STD^RCCPCFN,X2=-3 D C^%DTC
"RTN","RCCPCBJ",24,0)
 I X'=DT Q
"RTN","RCCPCBJ",25,0)
 S ZTIO="",ZTRTN="OPEN^RCCPCBJ",ZTDESC="CCPC PATIENT STATEMENT"
"RTN","RCCPCBJ",26,0)
 S ZTDTH=$H D ^%ZTLOAD
"RTN","RCCPCBJ",27,0)
 Q
"RTN","RCCPCBJ",28,0)
OPEN ;Update Open status bills to Active or Cancellation status
"RTN","RCCPCBJ",29,0)
 N DAY,BN,DEBTOR,DA,DIE,DR,P,AMT
"RTN","RCCPCBJ",30,0)
 N ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH
"RTN","RCCPCBJ",31,0)
 S DATE=$$STD^RCCPCFN,DAY=+$$STDY^RCCPCFN,DEBTOR=0 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",32,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",33,0)
       ..S AMT=0 F P=1:1:5 S AMT=$P($G(^PRCA(430,+BN,7)),"^",P)+AMT
"RTN","RCCPCBJ",34,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)),AMT Q
"RTN","RCCPCBJ",35,0)
       ..S DIE="^PRCA(430,",DA=+BN,DR="8////^S X="_$S(AMT:$O(^PRCA(430.3,"AC",102,0)),1:$O(^PRCA(430.3,"AC",111,0))) D ^DIE K DA,DIE,DR
"RTN","RCCPCBJ",36,0)
       ..Q
"RTN","RCCPCBJ",37,0)
    .Q
"RTN","RCCPCBJ",38,0)
 ;
"RTN","RCCPCBJ",39,0)
 ;  update patient accounts with interest and admin
"RTN","RCCPCBJ",40,0)
 N RCLASDAT
"RTN","RCCPCBJ",41,0)
 S RCLASDAT=DATE
"RTN","RCCPCBJ",42,0)
 I DT>3010101 D FIRSTPTY^RCBECHGS
"RTN","RCCPCBJ",43,0)
 D ^RCCPCPS
"RTN","RCCPCBJ",44,0)
 D REFUND
"RTN","RCCPCBJ",45,0)
 Q
"RTN","RCCPCBJ",46,0)
 ;
"RTN","RCCPCBJ",47,0)
 ;
"RTN","RCCPCBJ",48,0)
REFUND ;Update Open status PREPAYMENT bills to REFUND REVIEW
"RTN","RCCPCBJ",49,0)
 S DEBTOR=0,DAY=+$$STDY^RCCPCFN
"RTN","RCCPCBJ",50,0)
 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",51,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",52,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)) S X=$$EN^PRCARFU(+BN)
"RTN","RCCPCBJ",53,0)
       ..Q
"RTN","RCCPCBJ",54,0)
    .Q
"RTN","RCCPCBJ",55,0)
 Q
"RTN","RCCPCBJ",56,0)
 ;
"RTN","RCCPCBJ",57,0)
ACK ;CHECK FOR ACKNOWLEDGEMENTS
"RTN","RCCPCBJ",58,0)
 N DEB,MSG,NO,RCX,X,X1,X2
"RTN","RCCPCBJ",59,0)
 S X1=$$STD^RCCPCFN,X2=DT D ^%DTC I X>3 D
"RTN","RCCPCBJ",60,0)
 .D TRANCHK^RCCPCSV1
"RTN","RCCPCBJ",61,0)
 Q
"RTN","RCCPCML")
0^1^B41427616
"RTN","RCCPCML",1,0)
RCCPCML ;WASH-ISC@ALTOONA,PA/LDB-Send CCPC transmission ;12/19/96  4:16 PM
"RTN","RCCPCML",2,0)
V ;;4.5;Accounts Receivable;**34,80,93,118,133,140,160,165,187,195**;Mar 20, 1995
"RTN","RCCPCML",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCCPCML",4,0)
TRAN ;called from RCCPC TRANSMIT option to interactively allow transmission of CCPC mesages
"RTN","RCCPCML",5,0)
 N %DT,DTOUT,SDT,X,Y,ZTRTN,ZTSAVE,ZTDESC,ZTIO
"RTN","RCCPCML",6,0)
 I '$D(^XUSEC("RCCPC TRANSMIT",DUZ)) W *7,*7,!,"You do not have access to do this." Q
"RTN","RCCPCML",7,0)
 S %DT="AEXP"
"RTN","RCCPCML",8,0)
 S %DT("A")="Enter statement date as it will appear on these statements: "
"RTN","RCCPCML",9,0)
 S SDT=$O(^RCPS(349.2,0)) I 'SDT W !,"You need to build the CCPC file." Q
"RTN","RCCPCML",10,0)
 S SDT=$P($P($G(^RCPS(349.2,SDT,0)),"^",10),".") I 'SDT W !,"Your CCPC statement file (349.2) is corrupted. Please rebuild it." Q
"RTN","RCCPCML",11,0)
 S SDT=$E(SDT,1,5)_$$STDY^RCCPCFN
"RTN","RCCPCML",12,0)
 S %DT("B")=$$FMTE^XLFDT(SDT)
"RTN","RCCPCML",13,0)
 D ^%DT Q:(X="^")!($D(DTOUT))!(Y=-1)
"RTN","RCCPCML",14,0)
 S SDT=$E(Y,1,5)_$$STDY^RCCPCFN,SDT=$$STDT^RCCPCFN(SDT)
"RTN","RCCPCML",15,0)
 S ZTSAVE("SDT")="",ZTRTN="RETRAN^RCCPCML",ZTIO="",ZTDESC="Re-transmit CCPC patient statements -user activated"
"RTN","RCCPCML",16,0)
 D ^%ZTLOAD
"RTN","RCCPCML",17,0)
 Q
"RTN","RCCPCML",18,0)
 ;
"RTN","RCCPCML",19,0)
EN ;called from background job
"RTN","RCCPCML",20,0)
 N DA,DIK
"RTN","RCCPCML",21,0)
 S SDT=$$STDT^RCCPCFN("")
"RTN","RCCPCML",22,0)
RETRAN N DA,DIK,ERROR,RCT,X
"RTN","RCCPCML",23,0)
 S (ERROR,X)=0 F  S X=$O(^RCPS(349.2,X)) Q:'X  I $G(^(X,6)) S ERROR=1,NM=0 D ERROR Q
"RTN","RCCPCML",24,0)
 I $G(ERROR) D EXIT Q
"RTN","RCCPCML",25,0)
 K ^TMP($J)
"RTN","RCCPCML",26,0)
 S X=0 F  S X=$O(^RCT(349,"B",X)) Q:X=""  I $P(X,".")="PS" S DA=$O(^RCT(349,"B",X,0)),DIK="^RCT(349," D ^DIK
"RTN","RCCPCML",27,0)
 F X="PA","IS","IT" S RCT=$O(^RCT(349.1,"B",X,0)) I RCT K ^RCT(349.1,+RCT,4)
"RTN","RCCPCML",28,0)
 N %,ADD,AMT,ERROR,L,LN,M,MSG,MCT,MPT1,MTOT,NM,P,PD,PD0,PSN,PT,PT0,PHCT,RCM,RTY,TAMT,TMSG,SZ
"RTN","RCCPCML",29,0)
 D DT^DICRW
"RTN","RCCPCML",30,0)
 S (ERROR,RTY)=0
"RTN","RCCPCML",31,0)
 S X=$O(^RCT(349.1,"B","PS",0))
"RTN","RCCPCML",32,0)
 I X,$P($G(^RCT(349.1,+X,0)),"^",3) S X=$P($G(^RCT(349.1,+X,3)),"^",3)
"RTN","RCCPCML",33,0)
 I X']"" S ERROR=6,NM=0 D ERROR,EXIT Q
"RTN","RCCPCML",34,0)
 D PHCT I 'PHCT S ERROR=1,NM=0 D ERROR,EXIT Q
"RTN","RCCPCML",35,0)
 S MTOT=$O(^TMP($J,"MCT",""),-1)
"RTN","RCCPCML",36,0)
 S MCT=0 F  S MCT=$O(^TMP($J,"MCT",MCT)) Q:'MCT  D PS
"RTN","RCCPCML",37,0)
EXIT D ERRML^RCCPCML1
"RTN","RCCPCML",38,0)
 K SDT,^TMP($J)
"RTN","RCCPCML",39,0)
 Q
"RTN","RCCPCML",40,0)
 ;
"RTN","RCCPCML",41,0)
F349 ;Get PS segment entry
"RTN","RCCPCML",42,0)
 N DA,D0,DIC,DLAYGO,X
"RTN","RCCPCML",43,0)
 S ERROR=0 K DD,DO S DIC="^RCT(349,",DIC(0)="L",DLAYGO=349,X="PS."_$TR($$FMTE^XLFDT(DT,"2D"),"/",".")_"."_RCM D FILE^DICN
"RTN","RCCPCML",44,0)
 I Y<0 S RTY=RTY+1 G F349:RTY<4 S ERROR=2,NM=0 D ERROR Q
"RTN","RCCPCML",45,0)
 S PSN=+Y
"RTN","RCCPCML",46,0)
 Q
"RTN","RCCPCML",47,0)
 ;
"RTN","RCCPCML",48,0)
PS ;Build PS,PH,PD segments and messages
"RTN","RCCPCML",49,0)
 S PSN=$O(^TMP($J,"MCT",MCT,0))
"RTN","RCCPCML",50,0)
 S $P(^RCT(349,+PSN,0),"^",3,10)=MCT_"^"_MTOT_"^"_$$SITE^RCMSITE()_"^"_$$FP^RCCPCFN_"^"_+^TMP($J,"MCT",MCT)_"^"_$P(^TMP($J,"MCT",MCT),"^",2)_"^"_SDT_"^"_$$STM^RCCPCFN
"RTN","RCCPCML",51,0)
 S LN=+PSN,^TMP($J,"MSG",LN)=$P($G(^RCT(349,+PSN,0)),"^",2,10)_"^|"
"RTN","RCCPCML",52,0)
 S MPT1=$P(^TMP($J,"MCT",MCT),"^",3)
"RTN","RCCPCML",53,0)
 S PT=$S(MCT=1:0,1:$P(^TMP($J,"MCT",MCT-1),"^",3))
"RTN","RCCPCML",54,0)
 F  S PT=$O(^RCPS(349.2,PT)) Q:PT=$O(^RCPS(349.2,+($P(^TMP($J,"MCT",MCT),"^",3))))  D
"RTN","RCCPCML",55,0)
 .Q:$D(^TMP($J,"ERRPT",+PT))
"RTN","RCCPCML",56,0)
 .S PT0=^RCPS(349.2,+PT,0)
"RTN","RCCPCML",57,0)
 .S LN=LN+1 S ^TMP($J,"MSG",LN)="PH^"_$$SITE^RCMSITE_$$KEY^RCCPCFN(+PT)_"^"_$$NM^RCCPCFN(+PT)_"^"
"RTN","RCCPCML",58,0)
 .S ADD=$G(^RCPS(349.2,+PT,1))
"RTN","RCCPCML",59,0)
 .F P=1:1:7 S $P(^TMP($J,"MSG",LN),"^",P+5)=$S($P(ADD,"^",P)]"":$P(ADD,"^",P),1:"")
"RTN","RCCPCML",60,0)
 .S ^TMP($J,"MSG",LN)=^TMP($J,"MSG",LN)_"^"
"RTN","RCCPCML",61,0)
 .S LN=LN+1
"RTN","RCCPCML",62,0)
 .F X=4:1:8 S $P(AMT,"^",X-3)=$$HEX^RCCPCFN($P(PT0,"^",X))
"RTN","RCCPCML",63,0)
 .;S ^TMP($J,"MSG",LN)=AMT_"^"_$G(^RCPS(349.2,+PT,3))_"^"_$G(^RCPS(349.2,+PT,4))_"^"_$P(^RCPS(349.2,+PT,2,0),"^",4)_"^|"
"RTN","RCCPCML",64,0)
 .S ^TMP($J,"MSG",LN)=AMT_"^"_$G(^RCPS(349.2,+PT,3))_"^"_$G(^RCPS(349.2,+PT,4))_"^"_$O(^RCPS(349.2,+PT,2,""),-1)
"RTN","RCCPCML",65,0)
 .S LN=LN+1 I $P($G(^RCD(340,+PT,0)),";") S ^TMP($J,"MSG",LN)="^"_$$SITE^RCMSITE_$P(^RCD(340,+PT,0),";")
"RTN","RCCPCML",66,0)
 .S ^TMP($J,"MSG",LN)=$G(^TMP($J,"MSG",LN))_"^|"
"RTN","RCCPCML",67,0)
 .S $P(^RCPS(349.2,+PT,0),"^",11)=+PSN
"RTN","RCCPCML",68,0)
 .S PD=0 F  S PD=$O(^RCPS(349.2,+PT,2,PD)) Q:'PD  I $D(^(PD,0)) S PD0=^(0) D
"RTN","RCCPCML",69,0)
 ..S AMT(0)=$$HEX^RCCPCFN($P(PD0,"^",3))
"RTN","RCCPCML",70,0)
 ..S LN=LN+1,^TMP($J,"MSG",LN)="PD^"_$$DAT^RCCPCFN(+PD0)_"^"_$P(PD0,"^",2)_"^"_AMT(0)_"^"_$P(PD0,"^",4)_"^|"
"RTN","RCCPCML",71,0)
 S LN=LN+1,^TMP($J,"MSG",LN)="~"
"RTN","RCCPCML",72,0)
 ;
"RTN","RCCPCML",73,0)
MAIL ;set up mail message
"RTN","RCCPCML",74,0)
 N L,XMDUZ,XMSUB,XMY,XMZ,Z
"RTN","RCCPCML",75,0)
 S XMSUB=$$SITE^RCMSITE()_" CCPC TRANSMISSION "_SDT
"RTN","RCCPCML",76,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCCPCML",77,0)
 I $O(^XMB(3.8,"B","RCCPC STATEMENTS","")),$P($G(^RC(342,1,0)),"^",12) S XMY("G.RCCPC STATEMENTS")=""
"RTN","RCCPCML",78,0)
 S X=$O(^RCT(349.1,"B","PS",0))
"RTN","RCCPCML",79,0)
 I X,$P($G(^RCT(349.1,+X,0)),"^",3) S X=$P($G(^RCT(349.1,+X,3)),"^")_"@"_$P($G(^RCT(349.1,+X,3)),"^",3) S:$P(X,"@",2)]"" XMY(X)=""
"RTN","RCCPCML",80,0)
 I $P(X,"@",2)']"" D  Q
"RTN","RCCPCML",81,0)
 .S ERROR=6,NM=0 D ERROR
"RTN","RCCPCML",82,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCCPCML",83,0)
 D XMZ^XMA2
"RTN","RCCPCML",84,0)
 I XMZ<1 S RTY=RTY+1 G MAIL:RTY<4 S ERROR=5,NM=0 D ERROR Q
"RTN","RCCPCML",85,0)
 S $P(^RCT(349,+PSN,0),"^",11,12)=DT_"^"_XMZ
"RTN","RCCPCML",86,0)
 S (L,L(1))=0 F  S L(1)=$O(^TMP($J,"MSG",L(1))) Q:'L(1)  S L=L+1,^XMB(3.9,+XMZ,2,L,0)=^TMP($J,"MSG",L(1))
"RTN","RCCPCML",87,0)
 ;S L=$O(^TMP($J,"MSG",""),-1)
"RTN","RCCPCML",88,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^"_L_"^"_L_"^"_DT
"RTN","RCCPCML",89,0)
 D ENT1^XMD
"RTN","RCCPCML",90,0)
 D NOW^%DTC
"RTN","RCCPCML",91,0)
 S $P(^RCT(349,+PSN,0),"^",11,12)=%_"^"_XMZ
"RTN","RCCPCML",92,0)
 K ^TMP($J,"MSG")
"RTN","RCCPCML",93,0)
 ;D KILL^XM
"RTN","RCCPCML",94,0)
 Q
"RTN","RCCPCML",95,0)
 ;
"RTN","RCCPCML",96,0)
PHCT ;PH count
"RTN","RCCPCML",97,0)
 S (ERROR,PT,PHCT,TAMT,SZ)=0,RCM=1
"RTN","RCCPCML",98,0)
 F  S PT=$O(^RCPS(349.2,PT)) Q:'PT  S ERROR=0 D  I ERROR,(ERROR<3) Q
"RTN","RCCPCML",99,0)
 .S SZ(1)=0 D ERRCHK Q:ERROR
"RTN","RCCPCML",100,0)
 .S PT0=^RCPS(349.2,+PT,0)
"RTN","RCCPCML",101,0)
 .S PHCT=PHCT+1
"RTN","RCCPCML",102,0)
 .S SZ=550+SZ,SZ(1)=550
"RTN","RCCPCML",103,0)
 .S:$G(^RCPS(349.2,+PT,1))]"" SZ=SZ+$L(^(1)),SZ(1)=SZ(1)+$L(^(1))
"RTN","RCCPCML",104,0)
 .S:$G(^RCPS(349.2,+PT,3))]"" SZ=SZ+$L(^(3))+1,SZ(1)=SZ(1)+$L(^(3))+1
"RTN","RCCPCML",105,0)
 .S:$G(^RCPS(349.2,+PT,4))]"" SZ=SZ+$L(^(4))+1,SZ(1)=SZ(1)+$L(^(4))+1
"RTN","RCCPCML",106,0)
 .S X=0 F  S X=$O(^RCPS(349.2,+PT,2,X)) Q:'X  I $D(^(X,0)) S SZ=$L(^(0))+SZ,SZ(1)=SZ(1)+$L(^(0))
"RTN","RCCPCML",107,0)
 .S TAMT=TAMT+$P(^RCPS(349.2,+PT,0),"^",8)
"RTN","RCCPCML",108,0)
 .I SZ>27000 D
"RTN","RCCPCML",109,0)
 ..S RTY=0 D F349 Q:ERROR
"RTN","RCCPCML",110,0)
 ..S TAMT=TAMT-$P(PT0,"^",8)
"RTN","RCCPCML",111,0)
 ..S TAMT=$$HEX^RCCPCFN(TAMT)
"RTN","RCCPCML",112,0)
 ..S ^TMP($J,"MCT",RCM)=(PHCT-1)_"^"_TAMT_"^"_$O(^RCPS(349.2,PT),-1)_"^"_(SZ-SZ(1))
"RTN","RCCPCML",113,0)
 ..S ^TMP($J,"MCT",RCM,+PSN)=""
"RTN","RCCPCML",114,0)
 ..S RCM=RCM+1,PHCT=1
"RTN","RCCPCML",115,0)
 ..S SZ=SZ(1)
"RTN","RCCPCML",116,0)
 ..S TAMT=$P(PT0,"^",8)
"RTN","RCCPCML",117,0)
 I 'PT,$O(^RCPS(349.2,0)) D
"RTN","RCCPCML",118,0)
 .S RTY=0 D F349 Q:ERROR  S ^TMP($J,"MCT",RCM)=PHCT_"^"_$$HEX^RCCPCFN(TAMT)_"^"_$O(^RCPS(349.2,PT),-1)
"RTN","RCCPCML",119,0)
 .S ^TMP($J,"MCT",RCM,+PSN)=""
"RTN","RCCPCML",120,0)
 Q
"RTN","RCCPCML",121,0)
 ;
"RTN","RCCPCML",122,0)
ERROR ;ERROR FILE
"RTN","RCCPCML",123,0)
 I NM=0 S ^TMP($J,"ERROR",ERROR,NM)="" Q
"RTN","RCCPCML",124,0)
 S ^TMP($J,"ERROR",ERROR,NM,$$SSN^RCFN01(+PT))=""
"RTN","RCCPCML",125,0)
 Q
"RTN","RCCPCML",126,0)
 ;
"RTN","RCCPCML",127,0)
ERRCHK ;Error check
"RTN","RCCPCML",128,0)
 I '$D(^RCPS(349.2,+PT,0)) S ERROR=1,NM=0 D ERROR Q
"RTN","RCCPCML",129,0)
 S PT(1)=PT,PT=$O(^RCPS(349.2,0)) I '$P(^RCPS(349.2,PT,0),"^",18) S ERROR=1,NM=0 D ERROR S PT=PT(1) Q
"RTN","RCCPCML",130,0)
 S PT=PT(1)
"RTN","RCCPCML",131,0)
 I $$KEY^RCCPCFN(+PT)']"" S ERROR=4,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",132,0)
 I '$D(^RCPS(349.2,"AKEY",$$KEY^RCCPCFN(+PT))) S ERROR=4,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",133,0)
 S ADD=$G(^RCPS(349.2,+PT,1))
"RTN","RCCPCML",134,0)
 F P=1:1:7 S ADD(P)=$S($P(ADD,"^",P)]"":$P(ADD,"^",P),1:"")
"RTN","RCCPCML",135,0)
 I ADD(1)="",ADD(2)="",ADD(3)="",ADD(4)="",ADD(5)="",ADD(6)="" S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",136,0)
 I ADD(1)="",(ADD(2)=""),(ADD(3)=""),(ADD(6)="") S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)="" Q
"RTN","RCCPCML",137,0)
 I ADD(4)=""!(ADD(5)="")!(ADD(6)="") S ERROR=8,NM=$$NAM^RCFN01(+PT) D ERROR S ^TMP($J,"ERRPT",+PT)=""
"RTN","RCCPCML",138,0)
 F ADD=1:1:6 I ADD(ADD)'?.ANP S ERROR=10,NM=$$NAM^RCFN01(+PT),^TMP($J,"ERRPT",+PT)="" D ERROR Q
"RTN","RCCPCML",139,0)
 I $P($G(^RCD(340,+PT,1)),"^",9) S ^TMP($J,"ERRPT",+PT)="",ERROR=9,NM=$$NAM^RCFN01(+PT) D ERROR
"RTN","RCCPCML",140,0)
 Q
"VER")
8.0^22
**END**
**END**
