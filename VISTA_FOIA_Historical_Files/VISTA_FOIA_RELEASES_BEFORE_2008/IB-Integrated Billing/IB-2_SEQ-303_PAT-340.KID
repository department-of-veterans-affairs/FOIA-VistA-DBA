EMERGENCY Released IB*2*340 SEQ #303
Extracted from mail message
**KIDS**:IB*2.0*340^

**INSTALL NAME**
IB*2.0*340
"BLD",6625,0)
IB*2.0*340^INTEGRATED BILLING^0^3060406^y
"BLD",6625,1,0)
^^6^6^3060307^
"BLD",6625,1,1,0)
Patch IB*2*340 contains a single routine that supports the
"BLD",6625,1,2,0)
implementation of patch PRCA*4.5*241.  This AR patch is the
"BLD",6625,1,3,0)
last in a series of patches that adjusts the accounts of
"BLD",6625,1,4,0)
veterans affected by Hurricane Katrina.  Please refer to the
"BLD",6625,1,5,0)
patch description for more specific information on patch
"BLD",6625,1,6,0)
IB*2*340.
"BLD",6625,4,0)
^9.64PA^^
"BLD",6625,"ABPKG")
n
"BLD",6625,"INID")
^n
"BLD",6625,"INIT")
CANRES^IBAKAT
"BLD",6625,"KRN",0)
^9.67PA^8989.52^19
"BLD",6625,"KRN",.4,0)
.4
"BLD",6625,"KRN",.401,0)
.401
"BLD",6625,"KRN",.402,0)
.402
"BLD",6625,"KRN",.403,0)
.403
"BLD",6625,"KRN",.5,0)
.5
"BLD",6625,"KRN",.84,0)
.84
"BLD",6625,"KRN",3.6,0)
3.6
"BLD",6625,"KRN",3.8,0)
3.8
"BLD",6625,"KRN",9.2,0)
9.2
"BLD",6625,"KRN",9.8,0)
9.8
"BLD",6625,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6625,"KRN",9.8,"NM",1,0)
IBAKAT^^0^B24533552
"BLD",6625,"KRN",9.8,"NM","B","IBAKAT",1)

"BLD",6625,"KRN",19,0)
19
"BLD",6625,"KRN",19.1,0)
19.1
"BLD",6625,"KRN",101,0)
101
"BLD",6625,"KRN",409.61,0)
409.61
"BLD",6625,"KRN",771,0)
771
"BLD",6625,"KRN",870,0)
870
"BLD",6625,"KRN",8989.51,0)
8989.51
"BLD",6625,"KRN",8989.52,0)
8989.52
"BLD",6625,"KRN",8994,0)
8994
"BLD",6625,"KRN","B",.4,.4)

"BLD",6625,"KRN","B",.401,.401)

"BLD",6625,"KRN","B",.402,.402)

"BLD",6625,"KRN","B",.403,.403)

"BLD",6625,"KRN","B",.5,.5)

"BLD",6625,"KRN","B",.84,.84)

"BLD",6625,"KRN","B",3.6,3.6)

"BLD",6625,"KRN","B",3.8,3.8)

"BLD",6625,"KRN","B",9.2,9.2)

"BLD",6625,"KRN","B",9.8,9.8)

"BLD",6625,"KRN","B",19,19)

"BLD",6625,"KRN","B",19.1,19.1)

"BLD",6625,"KRN","B",101,101)

"BLD",6625,"KRN","B",409.61,409.61)

"BLD",6625,"KRN","B",771,771)

"BLD",6625,"KRN","B",870,870)

"BLD",6625,"KRN","B",8989.51,8989.51)

"BLD",6625,"KRN","B",8989.52,8989.52)

"BLD",6625,"KRN","B",8994,8994)

"BLD",6625,"QUES",0)
^9.62^^
"BLD",6625,"REQB",0)
^9.611^^
"INIT")
CANRES^IBAKAT
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
340^3060406^10865
"PKG",200,22,1,"PAH",1,1,0)
^^6^6^3060406
"PKG",200,22,1,"PAH",1,1,1,0)
Patch IB*2*340 contains a single routine that supports the
"PKG",200,22,1,"PAH",1,1,2,0)
implementation of patch PRCA*4.5*241.  This AR patch is the
"PKG",200,22,1,"PAH",1,1,3,0)
last in a series of patches that adjusts the accounts of
"PKG",200,22,1,"PAH",1,1,4,0)
veterans affected by Hurricane Katrina.  Please refer to the
"PKG",200,22,1,"PAH",1,1,5,0)
patch description for more specific information on patch
"PKG",200,22,1,"PAH",1,1,6,0)
IB*2*340.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBAKAT")
0^1^B24533552
"RTN","IBAKAT",1,0)
IBAKAT ;ALB/CPM - CANCEL COPAY CHARGES FOR KATRINA VETS ; 05-MAR-06
"RTN","IBAKAT",2,0)
 ;;2.0;INTEGRATED BILLING;**340**;21-MAR-94
"RTN","IBAKAT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAKAT",4,0)
 ;
"RTN","IBAKAT",5,0)
 ;
"RTN","IBAKAT",6,0)
CAN() ; Cancel copayments for Katrina vets
"RTN","IBAKAT",7,0)
 N IBCRES,IBBEG,IBEND,IBTOT,IBHIT,IBBUCK,IBD,IBN,IBND,IBCHG,IBIL
"RTN","IBAKAT",8,0)
 N DFN,DIE,DA,DR,IBND1,IBH,IBDEC,IBTRAN
"RTN","IBAKAT",9,0)
 S IBCRES=$O(^IBE(350.3,"B","KATRINA AFFECTED VETERAN",0)),IBTOT=""
"RTN","IBAKAT",10,0)
 I 'IBCRES G CANQ
"RTN","IBAKAT",11,0)
 ;
"RTN","IBAKAT",12,0)
 S IBBEG=3050829,IBEND=3060228,IBTOT="0^0^0"
"RTN","IBAKAT",13,0)
 ;
"RTN","IBAKAT",14,0)
 S DFN=0 F  S DFN=$O(^IB("APTDT",DFN)) Q:'DFN   D
"RTN","IBAKAT",15,0)
 .;
"RTN","IBAKAT",16,0)
 .; - quit if vet should not have charges cancelled
"RTN","IBAKAT",17,0)
 .Q:'$$CHK^RCKATP(DFN)  S (IBHIT,IBBUCK)=0 K IBH
"RTN","IBAKAT",18,0)
 .;
"RTN","IBAKAT",19,0)
 .; - examine all charges billed from 8/29/05 through 2/28/06
"RTN","IBAKAT",20,0)
 .S IBD=3050828.9 F  S IBD=$O(^IB("APTDT",DFN,IBD)) Q:'IBD  D
"RTN","IBAKAT",21,0)
 ..S IBN=0 F  S IBN=$O(^IB("APTDT",DFN,IBD,IBN)) Q:'IBN  D
"RTN","IBAKAT",22,0)
 ...;
"RTN","IBAKAT",23,0)
 ...S IBND=$G(^IB(IBN,0)),IBND1=$G(^(1))
"RTN","IBAKAT",24,0)
 ...;
"RTN","IBAKAT",25,0)
 ...; - skip event records
"RTN","IBAKAT",26,0)
 ...Q:$P(IBND,"^",8)["ADMISSION"
"RTN","IBAKAT",27,0)
 ...;
"RTN","IBAKAT",28,0)
 ...; - skip if this is not the last entry for the parent
"RTN","IBAKAT",29,0)
 ...Q:'$P(IBND,"^",9)
"RTN","IBAKAT",30,0)
 ...Q:IBN'=$$LAST^IBECEAU($P(IBND,"^",9))
"RTN","IBAKAT",31,0)
 ...;
"RTN","IBAKAT",32,0)
 ...; - skip if entry is cancelled
"RTN","IBAKAT",33,0)
 ...Q:$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^",5)=2
"RTN","IBAKAT",34,0)
 ...I IBN=$P(IBND,"^",9),($P(IBND,"^",5)=10!($P(IBND,"^",10))) Q
"RTN","IBAKAT",35,0)
 ...;
"RTN","IBAKAT",36,0)
 ...; - skip if rx copay is after 2/28/06
"RTN","IBAKAT",37,0)
 ...I '$P(IBND,"^",14),$E(IBD,1,7)>IBEND Q
"RTN","IBAKAT",38,0)
 ...;
"RTN","IBAKAT",39,0)
 ...; - skip if medical care copay is out of range
"RTN","IBAKAT",40,0)
 ...I $P(IBND,"^",14),($P(IBND,"^",15)<IBBEG!($P(IBND,"^",14)>IBEND)) Q
"RTN","IBAKAT",41,0)
 ...;
"RTN","IBAKAT",42,0)
 ...S IBCHG=+$P(IBND,"^",7),IBIL=$P(IBND,"^",11),IBTRAN=$P(IBND,"^",12)
"RTN","IBAKAT",43,0)
 ...;
"RTN","IBAKAT",44,0)
 ...; - if charge is not passed to AR, cancel it in IB
"RTN","IBAKAT",45,0)
 ...I '$P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",4) D  Q
"RTN","IBAKAT",46,0)
 ....S $P(IBTOT,"^",3)=$P(IBTOT,"^",3)+IBCHG
"RTN","IBAKAT",47,0)
 ....S $P(IBTOT,"^",2)=$P(IBTOT,"^",2)+IBCHG,IBHIT=1
"RTN","IBAKAT",48,0)
 ....S DIE="^IB(",DA=IBN,DR=".05////10;.1////"_IBCRES D ^DIE
"RTN","IBAKAT",49,0)
 ...;
"RTN","IBAKAT",50,0)
 ...; - cancel the charge in AR, to the extent possible, if it
"RTN","IBAKAT",51,0)
 ...;   were never on hold in IB
"RTN","IBAKAT",52,0)
 ...I '$P(IBND1,"^",6) D  Q
"RTN","IBAKAT",53,0)
 ....S $P(IBTOT,"^",2)=$P(IBTOT,"^",2)+IBCHG,IBHIT=1
"RTN","IBAKAT",54,0)
 ....S IBBUCK=IBBUCK+$$DEC^RCKATP(IBIL,IBCHG)
"RTN","IBAKAT",55,0)
 ...;
"RTN","IBAKAT",56,0)
 ...; - for charges once on hold, see if there is "credit" in AR
"RTN","IBAKAT",57,0)
 ...;   that would preclude our need to cancel the charge.  The
"RTN","IBAKAT",58,0)
 ...;   amount to decrease the charge is in IBDEC.
"RTN","IBAKAT",59,0)
 ...S IBDEC=IBCHG D  Q:'IBDEC
"RTN","IBAKAT",60,0)
 ....N IBAR,IBB
"RTN","IBAKAT",61,0)
 ....;
"RTN","IBAKAT",62,0)
 ....; - have AR update the credit amount
"RTN","IBAKAT",63,0)
 ....S IBAR=$$TPP^RCKATP(IBTRAN,.IBH)
"RTN","IBAKAT",64,0)
 ....;
"RTN","IBAKAT",65,0)
 ....; - if the receivable in file 430 couldn't be defined, quit
"RTN","IBAKAT",66,0)
 ....;   and decrease the entire charge amount
"RTN","IBAKAT",67,0)
 ....S IBB=$P(IBAR,"^",2) I 'IBB Q
"RTN","IBAKAT",68,0)
 ....;
"RTN","IBAKAT",69,0)
 ....; - initialize the credit amount for the bill
"RTN","IBAKAT",70,0)
 ....I '$G(IBH(IBB)) S IBH(IBB)=0
"RTN","IBAKAT",71,0)
 ....;
"RTN","IBAKAT",72,0)
 ....; - increment the credit amount by what is returned from AR
"RTN","IBAKAT",73,0)
 ....S IBH(IBB)=IBH(IBB)+IBAR
"RTN","IBAKAT",74,0)
 ....;
"RTN","IBAKAT",75,0)
 ....; - if there is no additional credit, quit and decrease the
"RTN","IBAKAT",76,0)
 ....;   entire charge amount
"RTN","IBAKAT",77,0)
 ....I 'IBH(IBB) Q
"RTN","IBAKAT",78,0)
 ....;
"RTN","IBAKAT",79,0)
 ....; - if the credit amount is greater than the charge, set the
"RTN","IBAKAT",80,0)
 ....;   decrease amount to zero; otherwise, set it to the charge
"RTN","IBAKAT",81,0)
 ....;   amount minus the available credit
"RTN","IBAKAT",82,0)
 ....S IBDEC=$S(IBH(IBB)>IBCHG:0,1:IBCHG-IBH(IBB))
"RTN","IBAKAT",83,0)
 ....;
"RTN","IBAKAT",84,0)
 ....; - if the credit amount is less than the charge, set it to
"RTN","IBAKAT",85,0)
 ....;   zero; otherwise, offset it by the charge amount
"RTN","IBAKAT",86,0)
 ....S IBH(IBB)=$S(IBH(IBB)<IBCHG:0,1:IBH(IBB)-IBCHG)
"RTN","IBAKAT",87,0)
 ...;
"RTN","IBAKAT",88,0)
 ...;
"RTN","IBAKAT",89,0)
 ...; - decrease account by the adjusted amount IBDEC
"RTN","IBAKAT",90,0)
 ...S $P(IBTOT,"^",2)=$P(IBTOT,"^",2)+IBDEC,IBHIT=1
"RTN","IBAKAT",91,0)
 ...S IBBUCK=IBBUCK+$$DEC^RCKATP(IBIL,IBDEC)
"RTN","IBAKAT",92,0)
 .;
"RTN","IBAKAT",93,0)
 .;
"RTN","IBAKAT",94,0)
 .; - flag each patient in AR, even if no charges are found
"RTN","IBAKAT",95,0)
 .D FLAG^RCKATP(DFN)
"RTN","IBAKAT",96,0)
 .;
"RTN","IBAKAT",97,0)
 .; - update patient counter
"RTN","IBAKAT",98,0)
 .I IBHIT S $P(IBTOT,"^")=$P(IBTOT,"^")+1
"RTN","IBAKAT",99,0)
 .;
"RTN","IBAKAT",100,0)
 .; - if there's anything in the bucket, further reduce account
"RTN","IBAKAT",101,0)
 .I IBBUCK D ADJ^RCKATP(DFN,IBBUCK)
"RTN","IBAKAT",102,0)
 ;
"RTN","IBAKAT",103,0)
 ;
"RTN","IBAKAT",104,0)
CANQ Q IBTOT
"RTN","IBAKAT",105,0)
 ;
"RTN","IBAKAT",106,0)
 ;
"RTN","IBAKAT",107,0)
 ;
"RTN","IBAKAT",108,0)
CANRES ; Patch *340 post-init entry point
"RTN","IBAKAT",109,0)
 D BMES^XPDUTL(">>> Adding new cancellation reason into file #350.3...")
"RTN","IBAKAT",110,0)
 S IBCR="KATRINA AFFECTED VETERAN^KAT^3"
"RTN","IBAKAT",111,0)
 I $O(^IBE(350.3,"B",$P(IBCR,"^"),0)) D  G CANRESQ
"RTN","IBAKAT",112,0)
 .D MES^XPDUTL(" >> '"_$P(IBCR,"^")_"' is already on file.")
"RTN","IBAKAT",113,0)
 S DIC="^IBE(350.3,",DIC(0)="L",DLAYGO=350.3,X=$P(IBCR,"^")
"RTN","IBAKAT",114,0)
 K DD,DO D FILE^DICN K DD,DO
"RTN","IBAKAT",115,0)
 I Y<0 D MES^XPDUTL(" >> Unable to file this entry!") G CANRESQ
"RTN","IBAKAT",116,0)
 S DIE=DIC,DA=+Y,DR=".02///"_$P(IBCR,"^",2)_";.03///"_$P(IBCR,"^",3)
"RTN","IBAKAT",117,0)
 D ^DIE,MES^XPDUTL(" >> '"_$P(IBCR,"^")_"' has been filed.")
"RTN","IBAKAT",118,0)
CANRESQ K DA,DIC,DIE,DR,DLAYGO,IBCR,X,Y
"RTN","IBAKAT",119,0)
 Q
"VER")
8.0^22.0
"BLD",6625,6)
^303
**END**
**END**
