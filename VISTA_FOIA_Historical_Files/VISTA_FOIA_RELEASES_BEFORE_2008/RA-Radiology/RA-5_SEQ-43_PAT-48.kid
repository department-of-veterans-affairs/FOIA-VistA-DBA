Released RA*5*48 SEQ #43
Extracted from mail message
**KIDS**:RA*5.0*48^

**INSTALL NAME**
RA*5.0*48
"BLD",4983,0)
RA*5.0*48^RADIOLOGY/NUCLEAR MEDICINE^0^3040716^y
"BLD",4983,1,0)
^^1^1^3040621^^^^
"BLD",4983,1,1,0)
Please see Patch Description for details.
"BLD",4983,4,0)
^9.64PA^^
"BLD",4983,"ABPKG")
n
"BLD",4983,"KRN",0)
^9.67PA^8989.52^19
"BLD",4983,"KRN",.4,0)
.4
"BLD",4983,"KRN",.401,0)
.401
"BLD",4983,"KRN",.402,0)
.402
"BLD",4983,"KRN",.403,0)
.403
"BLD",4983,"KRN",.5,0)
.5
"BLD",4983,"KRN",.84,0)
.84
"BLD",4983,"KRN",3.6,0)
3.6
"BLD",4983,"KRN",3.8,0)
3.8
"BLD",4983,"KRN",9.2,0)
9.2
"BLD",4983,"KRN",9.8,0)
9.8
"BLD",4983,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",4983,"KRN",9.8,"NM",1,0)
RAHLO1^^0^B42629740
"BLD",4983,"KRN",9.8,"NM",2,0)
RAPM^^0^B64632251
"BLD",4983,"KRN",9.8,"NM",3,0)
RAPM1^^0^B44191045
"BLD",4983,"KRN",9.8,"NM",4,0)
RAPM2^^0^B78073225
"BLD",4983,"KRN",9.8,"NM",5,0)
RAESR1^^0^B10135318
"BLD",4983,"KRN",9.8,"NM",6,0)
RASTEXT^^0^B28312092
"BLD",4983,"KRN",9.8,"NM","B","RAESR1",5)

"BLD",4983,"KRN",9.8,"NM","B","RAHLO1",1)

"BLD",4983,"KRN",9.8,"NM","B","RAPM",2)

"BLD",4983,"KRN",9.8,"NM","B","RAPM1",3)

"BLD",4983,"KRN",9.8,"NM","B","RAPM2",4)

"BLD",4983,"KRN",9.8,"NM","B","RASTEXT",6)

"BLD",4983,"KRN",19,0)
19
"BLD",4983,"KRN",19.1,0)
19.1
"BLD",4983,"KRN",101,0)
101
"BLD",4983,"KRN",409.61,0)
409.61
"BLD",4983,"KRN",771,0)
771
"BLD",4983,"KRN",870,0)
870
"BLD",4983,"KRN",8989.51,0)
8989.51
"BLD",4983,"KRN",8989.52,0)
8989.52
"BLD",4983,"KRN",8994,0)
8994
"BLD",4983,"KRN","B",.4,.4)

"BLD",4983,"KRN","B",.401,.401)

"BLD",4983,"KRN","B",.402,.402)

"BLD",4983,"KRN","B",.403,.403)

"BLD",4983,"KRN","B",.5,.5)

"BLD",4983,"KRN","B",.84,.84)

"BLD",4983,"KRN","B",3.6,3.6)

"BLD",4983,"KRN","B",3.8,3.8)

"BLD",4983,"KRN","B",9.2,9.2)

"BLD",4983,"KRN","B",9.8,9.8)

"BLD",4983,"KRN","B",19,19)

"BLD",4983,"KRN","B",19.1,19.1)

"BLD",4983,"KRN","B",101,101)

"BLD",4983,"KRN","B",409.61,409.61)

"BLD",4983,"KRN","B",771,771)

"BLD",4983,"KRN","B",870,870)

"BLD",4983,"KRN","B",8989.51,8989.51)

"BLD",4983,"KRN","B",8989.52,8989.52)

"BLD",4983,"KRN","B",8994,8994)

"BLD",4983,"QUES",0)
^9.62^^
"BLD",4983,"REQB",0)
^9.611^2^2
"BLD",4983,"REQB",1,0)
RA*5.0*27^2
"BLD",4983,"REQB",2,0)
RA*5.0*44^2
"BLD",4983,"REQB","B","RA*5.0*27",1)

"BLD",4983,"REQB","B","RA*5.0*44",2)

"MBREQ")
0
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3011017^2980407^50
"PKG",18,22,1,"PAH",1,0)
48^3040716
"PKG",18,22,1,"PAH",1,1,0)
^^1^1^3040716
"PKG",18,22,1,"PAH",1,1,1,0)
Please see Patch Description for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RAESR1")
0^5^B10135318
"RTN","RAESR1",1,0)
RAESR1 ;HISC/GJC-Exam Statistics Rpt ;1/20/95  09:36
"RTN","RAESR1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**48**;Mar 16, 1998
"RTN","RAESR1",3,0)
 S (RAPGE,RATOT,RAXIT)=0,RARUNDT=$$FMTE^XLFDT($$DT^XLFDT(),1)
"RTN","RAESR1",4,0)
 S $P(RALINE,"-",78)=""
"RTN","RAESR1",5,0)
 I '$D(^TMP($J,"RASTAT","RALOC")) D  G PURGE^RAESR2
"RTN","RAESR1",6,0)
 . W @IOF,!!?5,"No exams registered for time period "
"RTN","RAESR1",7,0)
 . W BEGDTX_" to "_ENDDTX_".",!
"RTN","RAESR1",8,0)
 . Q
"RTN","RAESR1",9,0)
 D @RARPT
"RTN","RAESR1",10,0)
 I 'RAXIT D
"RTN","RAESR1",11,0)
 . D DIVSYN^RAESR2
"RTN","RAESR1",12,0)
 . Q
"RTN","RAESR1",13,0)
 D PURGE^RAESR2
"RTN","RAESR1",14,0)
 Q
"RTN","RAESR1",15,0)
1 ; Print Location Statistics
"RTN","RAESR1",16,0)
 S RADNM=$O(^TMP($J,"RASTAT","RALOC",""))
"RTN","RAESR1",17,0)
 S RAINM=$O(^TMP($J,"RASTAT","RALOC",RADNM,""))
"RTN","RAESR1",18,0)
 S RALNM=$O(^TMP($J,"RASTAT","RALOC",RADNM,RAINM,""))
"RTN","RAESR1",19,0)
 S T1=1 D HD^RAESR3 S RADNM=""
"RTN","RAESR1",20,0)
 F  S RADNM=$O(^TMP($J,"RASTAT","RALOC",RADNM)) Q:RADNM=""  D  Q:RAXIT
"RTN","RAESR1",21,0)
 . S RAINM=""
"RTN","RAESR1",22,0)
 . F  S RAINM=$O(^TMP($J,"RASTAT","RALOC",RADNM,RAINM)) Q:RAINM=""  D  Q:RAXIT
"RTN","RAESR1",23,0)
 .. S RALNM=""
"RTN","RAESR1",24,0)
 .. F  S RALNM=$O(^TMP($J,"RASTAT","RALOC",RADNM,RAINM,RALNM)) Q:RALNM=""  D  Q:RAXIT
"RTN","RAESR1",25,0)
 ... S RADAT=0
"RTN","RAESR1",26,0)
 ... F  S RADAT=$O(^TMP($J,"RASTAT","RALOC",RADNM,RAINM,RALNM,RADAT)) Q:'RADAT  D  Q:RAXIT
"RTN","RAESR1",27,0)
 .... S RASTAT=$G(^TMP($J,"RASTAT","RALOC",RADNM,RAINM,RALNM,RADAT))
"RTN","RAESR1",28,0)
 .... S RADAT("X")=$$FMTE^XLFDT(RADAT,1) D PRT^RAESR3
"RTN","RAESR1",29,0)
 .... Q
"RTN","RAESR1",30,0)
 ... D LOCCHK^RAESR2 Q:RAXIT
"RTN","RAESR1",31,0)
 ... Q
"RTN","RAESR1",32,0)
 .. D IMGCHK^RAESR2 Q:RAXIT
"RTN","RAESR1",33,0)
 .. Q
"RTN","RAESR1",34,0)
 . D DIVCHK^RAESR2 Q:RAXIT
"RTN","RAESR1",35,0)
 . Q
"RTN","RAESR1",36,0)
 Q
"RTN","RAESR1",37,0)
2 ; Print Imaging Type Statistics
"RTN","RAESR1",38,0)
 S RADNM=$O(^TMP($J,"RASTAT","RAIMG",""))
"RTN","RAESR1",39,0)
 S RAINM=$O(^TMP($J,"RASTAT","RAIMG",RADNM,""))
"RTN","RAESR1",40,0)
 S T1=2 D HD^RAESR3 S RADNM=""
"RTN","RAESR1",41,0)
 F  S RADNM=$O(^TMP($J,"RASTAT","RAIMG",RADNM)) Q:RADNM=""  D  Q:RAXIT
"RTN","RAESR1",42,0)
 . S RAINM="" F  S RAINM=$O(^TMP($J,"RASTAT","RAIMG",RADNM,RAINM)) Q:RAINM=""  D  Q:RAXIT
"RTN","RAESR1",43,0)
 .. S RADAT=0 F  S RADAT=$O(^TMP($J,"RASTAT","RAIMG",RADNM,RAINM,RADAT)) Q:'RADAT  D  Q:RAXIT
"RTN","RAESR1",44,0)
 ... S RASTAT=$G(^TMP($J,"RASTAT","RAIMG",RADNM,RAINM,RADAT))
"RTN","RAESR1",45,0)
 ... S RADAT("X")=$$FMTE^XLFDT(RADAT,1) D PRT^RAESR3
"RTN","RAESR1",46,0)
 ... Q
"RTN","RAESR1",47,0)
 .. D IMGCHK^RAESR2 Q:RAXIT
"RTN","RAESR1",48,0)
 .. Q
"RTN","RAESR1",49,0)
 . D DIVCHK^RAESR2 Q:RAXIT
"RTN","RAESR1",50,0)
 . Q
"RTN","RAESR1",51,0)
 Q
"RTN","RAESR1",52,0)
3 ; Print Division Statistics
"RTN","RAESR1",53,0)
 S RADNM=$O(^TMP($J,"RASTAT","RADIV","")),T1=3 D HD^RAESR3 S RADNM=""
"RTN","RAESR1",54,0)
 F  S RADNM=$O(^TMP($J,"RASTAT","RADIV",RADNM)) Q:RADNM=""  D  Q:RAXIT
"RTN","RAESR1",55,0)
 . S RADAT=0
"RTN","RAESR1",56,0)
 . F  S RADAT=$O(^TMP($J,"RASTAT","RADIV",RADNM,RADAT)) Q:'RADAT  D  Q:RAXIT
"RTN","RAESR1",57,0)
 .. S RASTAT=$G(^TMP($J,"RASTAT","RADIV",RADNM,RADAT))
"RTN","RAESR1",58,0)
 .. S RADAT("X")=$$FMTE^XLFDT(RADAT,1) D PRT^RAESR3
"RTN","RAESR1",59,0)
 .. Q
"RTN","RAESR1",60,0)
 . I 'RAXIT D TOT^RAESR3 D
"RTN","RAESR1",61,0)
 .. N RA1 S RA1=$O(^TMP($J,"RASTAT","RADIV",RADNM))
"RTN","RAESR1",62,0)
 .. I RA1]"" N RADNM S RADNM=RA1,RAXIT=$$EOS^RAUTL5() D:'RAXIT HD^RAESR3
"RTN","RAESR1",63,0)
 .. Q 
"RTN","RAESR1",64,0)
 . Q
"RTN","RAESR1",65,0)
 Q
"RTN","RAESR1",66,0)
4 ; Print all Statistics
"RTN","RAESR1",67,0)
 S RADAT=0,T1=4 D HD^RAESR3
"RTN","RAESR1",68,0)
 F  S RADAT=$O(^TMP($J,"RASTAT","RATOT",RADAT)) Q:'RADAT  D  Q:RAXIT
"RTN","RAESR1",69,0)
 . S RASTAT=$G(^TMP($J,"RASTAT","RATOT",RADAT))
"RTN","RAESR1",70,0)
 . S RADAT("X")=$$FMTE^XLFDT(RADAT,1) D PRT^RAESR3
"RTN","RAESR1",71,0)
 . Q
"RTN","RAESR1",72,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HD^RAESR3
"RTN","RAESR1",73,0)
 D TOT^RAESR3 ;Print total line
"RTN","RAESR1",74,0)
 Q
"RTN","RAHLO1")
0^1^B42629740
"RTN","RAHLO1",1,0)
RAHLO1 ;HIRMFO/GJC/BNT-File rpt (data from bridge program) ;6/25/04  11:49
"RTN","RAHLO1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**4,5,12,17,21,27,48**;Mar 16, 1998
"RTN","RAHLO1",3,0)
FILE ;Create Entry in File 74 and File Data
"RTN","RAHLO1",4,0)
 I '$D(ZTQUEUED) N ZTQUEUED S ZTQUEUED="1^dummy to suppress screen displays in UP2^RAUTL1 and elsewhere"
"RTN","RAHLO1",5,0)
 I '$D(RAQUIET) N RAQUIET S RAQUIET="1^dummy to suppress screen display in PTR^RARTE2"
"RTN","RAHLO1",6,0)
 N RADATIME S RADATIME=$$NOW^XLFDT() I $L($P(RADATIME,".",2))>4 S RADATIME=$P(RADATIME,".",1)_"."_$E($P(RADATIME,".",2),1,4) S RADATIME=+RADATIME
"RTN","RAHLO1",7,0)
 S RADPIECE=$S($D(^VA(200,"ARC","S",+$G(RAVERF))):15,$D(^VA(200,"ARC","R",+$G(RAVERF))):12,1:"")
"RTN","RAHLO1",8,0)
 N:'$D(RAPRTSET) RAPRTSET N:'$D(RAMEMARR) RAMEMARR
"RTN","RAHLO1",9,0)
 D EN2^RAUTL20(.RAMEMARR) ; 04/30/99 always recalculate RAPRTSET
"RTN","RAHLO1",10,0)
 ; If rpt (either stub or real) exists, skip creating a new file 74 entry
"RTN","RAHLO1",11,0)
 I RARPT,$D(^RARPT(RARPT,0)) S RASAV=RARPT D FILETST^RAHLO4 Q:$D(RAERR)  D  S RARPT=RASAV K RASAV G LOCK1
"RTN","RAHLO1",12,0)
 . ; must save off RARPT, RAVERF and other RA* variables because
"RTN","RAHLO1",13,0)
 . ; they are being killed off somewhere in the 'Unverify A Report'
"RTN","RAHLO1",14,0)
 . ; option.
"RTN","RAHLO1",15,0)
 . N RADFN,RADTI,RACNI,RARPTSTS,RASSN,RADATE,RALONGCN,RAVERF
"RTN","RAHLO1",16,0)
 . ; if report isn't a stub report, then consider it being edited
"RTN","RAHLO1",17,0)
 . S:'$$STUB^RAEDCN1(RARPT) RAEDIT=1
"RTN","RAHLO1",18,0)
 . I $D(RADENDUM)#2,($P(^RARPT(RARPT,0),"^",5)="V") D  Q  ; edit on current record (for activity log)
"RTN","RAHLO1",19,0)
 .. D UNVER^RARTE1(RARPT)
"RTN","RAHLO1",20,0)
 .. Q
"RTN","RAHLO1",21,0)
 . K ^RARPT(RARPT,"I"),^("R"),^("H")
"RTN","RAHLO1",22,0)
 . Q
"RTN","RAHLO1",23,0)
 I RAPRTSET L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1 S RAERR="ANOTHER USER IS CURRENTLY EDITING THIS PRINTSET. TRY LATER." D KVAR Q
"RTN","RAHLO1",24,0)
NEW1 S I=$P(^RARPT(0),"^",3)
"RTN","RAHLO1",25,0)
LOCK S I=I+1 L +^RARPT(I):1 I '$T!($D(^RARPT(I)))!($D(^RARPT("B",I))) L -^RARPT(I) G LOCK
"RTN","RAHLO1",26,0)
 S ^RARPT(I,0)=RALONGCN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1)
"RTN","RAHLO1",27,0)
 ;if case is member of a print set, then create sub-recs for file #74
"RTN","RAHLO1",28,0)
 G:'RAPRTSET LOCK1
"RTN","RAHLO1",29,0)
 I '$D(RARPTN) N RARPTN S RARPTN=RALONGCN
"RTN","RAHLO1",30,0)
 N RAXIT D PTR^RARTE2 ;create corresponding subrecs in ^RARPT()
"RTN","RAHLO1",31,0)
 I $D(RAERR) L -^RADPT(RADFN,"DT",RADTI) D KVAR Q  ;unlck & clear vars
"RTN","RAHLO1",32,0)
LOCK1 I $D(RAESIG) S X=RAESIG,X1=$G(RAVERF),X2=RARPT D EN^XUSHSHP S RAESIG=X
"RTN","RAHLO1",33,0)
 K DA,DIE,DQ,DR S DA=RARPT,DIE="^RARPT("
"RTN","RAHLO1",34,0)
 S DR="5////"_RARPTSTS ; rpt status
"RTN","RAHLO1",35,0)
 ;Verifier & Verified date will be set if RAVERF exists for new
"RTN","RAHLO1",36,0)
 ;reports, edits, and addendums.  Date rpt entered and reported date
"RTN","RAHLO1",37,0)
 ;will be set for new reports, and not reset for edits and addendums
"RTN","RAHLO1",38,0)
 S DR=DR_";6////"_$S($D(RAEDIT):"",1:RADATIME) ; date/time rpt entered
"RTN","RAHLO1",39,0)
 S DR=DR_";7////"_$S($G(RAVERF)&(RARPTSTS="V"):RADATIME,1:"") ; v'fied date/time
"RTN","RAHLO1",40,0)
 S DR=DR_";8////"_$S($D(RAEDIT):"",1:RADATE) ; reported date
"RTN","RAHLO1",41,0)
 S DR=DR_";9////"_$S($G(RAVERF)&(RARPTSTS="V"):RAVERF,1:"") ; v'fying phys
"RTN","RAHLO1",42,0)
 S DR=DR_";11////"_$S($G(RATRANSC):RATRANSC,$G(RAVERF):RAVERF,1:"") ; transcriptionist
"RTN","RAHLO1",43,0)
 I $G(RAVERF),(RARPTSTS="V") S DR=DR_";17////"_$G(^TMP("RARPT-REC",$J,RASUB,"RAWHOCHANGE")) ;status changed to 'verified' by
"RTN","RAHLO1",44,0)
 ; D ^DIE K DA,DR ;BNT- Moved the DIE call down three lines due to a 
"RTN","RAHLO1",45,0)
 ; problem found at Indy while testing PowerScribe.  Site was doing a
"RTN","RAHLO1",46,0)
 ; local MUMPS cross reference on one of the nodes that are set below.
"RTN","RAHLO1",47,0)
 S $P(^RARPT(RARPT,0),"^",2)=RADFN,$P(^(0),"^",3)=(9999999.9999-RADTI),$P(^(0),"^",4)=$P(RALONGCN,"-",2) ;must set manually due uneditable
"RTN","RAHLO1",48,0)
 S $P(^RARPT(RARPT,0),"^",10)=$S($D(RAESIG)&(RARPTSTS="V"):RAESIG,1:"") ; hard set because Elec Sig Code may contain a semi-colon which causes errors in DIE
"RTN","RAHLO1",49,0)
 D ^DIE K DA,DR
"RTN","RAHLO1",50,0)
 I $D(RADX),('$D(RADENDUM)#2) D
"RTN","RAHLO1",51,0)
 . K DIE,DA,DR S DA=RACNI,DA(1)=RADTI,DA(2)=RADFN
"RTN","RAHLO1",52,0)
 . S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RAHLO1",53,0)
 . S DR="13////"_RADX D ^DIE K DIE,DA,DR
"RTN","RAHLO1",54,0)
 . S:$P(^RA(78.3,+RADX,0),"^",4)="y" RAAB=1
"RTN","RAHLO1",55,0)
 . Q
"RTN","RAHLO1",56,0)
 I '$D(RADENDUM)#2,($G(^TMP("RARPT-REC",$J,RASUB,"RASTAFF"))!$G(^("RARESIDENT"))) D
"RTN","RAHLO1",57,0)
 . K DIE,DA S DR=""
"RTN","RAHLO1",58,0)
 . S RAPRIMAR=+$G(^TMP("RARPT-REC",$J,RASUB,"RARESIDENT")) I $D(^VA(200,"ARC","R",RAPRIMAR)) S DR="12////"_RAPRIMAR
"RTN","RAHLO1",59,0)
 . S RAPRIMAR=+$G(^TMP("RARPT-REC",$J,RASUB,"RASTAFF")) I $D(^VA(200,"ARC","S",RAPRIMAR)) S DR=$S(DR]"":DR_";",1:"")_"15////"_RAPRIMAR
"RTN","RAHLO1",60,0)
 . Q:'$G(DR)
"RTN","RAHLO1",61,0)
 . S DA=RACNI,DA(1)=RADTI,DA(2)=RADFN
"RTN","RAHLO1",62,0)
 . S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"","
"RTN","RAHLO1",63,0)
 . D ^DIE K DIE,DA,DR
"RTN","RAHLO1",64,0)
 . Q
"RTN","RAHLO1",65,0)
 ;
"RTN","RAHLO1",66,0)
 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RARPT I $G(RADPIECE),$P(^(0),"^",RADPIECE)="",('$D(RADENDUM)#2) D SETPHYS^RAHLO4
"RTN","RAHLO1",67,0)
 ; file impression text if present & not an addendum
"RTN","RAHLO1",68,0)
 I '$D(RADENDUM) D
"RTN","RAHLO1",69,0)
 . S J=0 I $O(^TMP("RARPT-REC",$J,RASUB,"RAIMP",0)) S I=0 F J=0:1 S I=$O(^TMP("RARPT-REC",$J,RASUB,"RAIMP",I)) Q:I'>0  I $D(^(I)) S ^RARPT(RARPT,"I",(J+1),0)=$G(^TMP("RARPT-REC",$J,RASUB,"RAIMP",I))
"RTN","RAHLO1",70,0)
 . S:J ^RARPT(RARPT,"I",0)="^^"_J_"^"_J_"^"_RADATE
"RTN","RAHLO1",71,0)
 . Q
"RTN","RAHLO1",72,0)
 ; file report text if present & not an addendum
"RTN","RAHLO1",73,0)
 I '$D(RADENDUM) D
"RTN","RAHLO1",74,0)
 . S J=0 I $O(^TMP("RARPT-REC",$J,RASUB,"RATXT",0)) S I=0 F J=0:1 S I=$O(^TMP("RARPT-REC",$J,RASUB,"RATXT",I)) Q:I'>0  I $D(^(I)) S ^RARPT(RARPT,"R",(J+1),0)=$G(^TMP("RARPT-REC",$J,RASUB,"RATXT",I))
"RTN","RAHLO1",75,0)
 . S:J ^RARPT(RARPT,"R",0)="^^"_J_"^"_J_"^"_RADATE
"RTN","RAHLO1",76,0)
 . Q
"RTN","RAHLO1",77,0)
 ; if addendum, add addendum text to impression or report
"RTN","RAHLO1",78,0)
 I $D(RADENDUM),($O(^TMP("RARPT-REC",$J,RASUB,"RAIMP",0))!$O(^TMP("RARPT-REC",$J,RASUB,"RATXT",0))) D ADENDUM^RAHLO2 ; store new lines at the end of existing text
"RTN","RAHLO1",79,0)
 ;
"RTN","RAHLO1",80,0)
 ;
"RTN","RAHLO1",81,0)
 ; Check for History from Dictation
"RTN","RAHLO1",82,0)
 ; If history sent, check if previous history exists.  If previous
"RTN","RAHLO1",83,0)
 ; history then current history will follow adding 'Addendum:' before 
"RTN","RAHLO1",84,0)
 ; the text.
"RTN","RAHLO1",85,0)
 I $O(^TMP("RARPT-REC",$J,RASUB,"RAHIST",0)) D
"RTN","RAHLO1",86,0)
 . S RACNT=+$O(^RARPT(RARPT,"H",9999999),-1),RAHSTNDE=RACNT+1
"RTN","RAHLO1",87,0)
 . S RANEW=$S(RACNT>0:0,1:1)
"RTN","RAHLO1",88,0)
 . S I=0 F  S I=$O(^TMP("RARPT-REC",$J,RASUB,"RAHIST",I)) Q:I'>0  D
"RTN","RAHLO1",89,0)
 . . S RACNT=RACNT+1
"RTN","RAHLO1",90,0)
 . . S RALN=$G(^TMP("RARPT-REC",$J,RASUB,"RAHIST",I))
"RTN","RAHLO1",91,0)
 . . S:'RANEW&(I=$O(^TMP("RARPT-REC",$J,RASUB,"RAHIST",0))) RALN="Addendum: "_RALN ; if the first line, append 'Addendum:'
"RTN","RAHLO1",92,0)
 . . I (RAHSTNDE=RACNT),(RACNT>1) S ^RARPT(RARPT,"H",RACNT,0)=" ",RACNT=RACNT+1
"RTN","RAHLO1",93,0)
 . . S ^RARPT(RARPT,"H",RACNT,0)=RALN
"RTN","RAHLO1",94,0)
 . . Q
"RTN","RAHLO1",95,0)
 . S ^RARPT(RARPT,"H",0)="^^"_RACNT_"^"_RACNT_"^"_RADATE
"RTN","RAHLO1",96,0)
 . Q
"RTN","RAHLO1",97,0)
 ;
"RTN","RAHLO1",98,0)
 ;
"RTN","RAHLO1",99,0)
 I $P(^RARPT(RARPT,0),U,5)="V",$T(CREATE^WVRALINK)]"" D CREATE^WVRALINK(RADFN,RADTI,RACNI) ; women's health
"RTN","RAHLO1",100,0)
 D KILSECDG^RAHLO4 ;kill sec diag nodes for this case
"RTN","RAHLO1",101,0)
 G:'RAPRTSET UPACT ; the next section is for printsets only
"RTN","RAHLO1",102,0)
 N RACNISAV,RA7
"RTN","RAHLO1",103,0)
 N RA13,RA12,RA15 ;prim dx, prim resid, prim staff, rpt pointer
"RTN","RAHLO1",104,0)
 S RACNISAV=RACNI,RA7=0
"RTN","RAHLO1",105,0)
 S RA13=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13),RA12=$P(^(0),U,12),RA15=$P(^(0),U,15)
"RTN","RAHLO1",106,0)
 F  S RA7=$O(RAMEMARR(RA7)) Q:RA7=""  I RACNISAV'=RA7 S RACNI=RA7 D UPMEM^RAHLO4,KILSECDG^RAHLO4
"RTN","RAHLO1",107,0)
 S RACNI=RACNISAV
"RTN","RAHLO1",108,0)
 L -^RADPT(RADFN,"DT",RADTI) ;unlock after pce 17 is set in all cases of this printset
"RTN","RAHLO1",109,0)
 ;Update Activity Log
"RTN","RAHLO1",110,0)
UPACT S DA=RARPT,DIE="^RARPT(",DR="100///""NOW""",DR(2,74.01)="2////"_$S(RARPTSTS="V":"V",$D(RAEDIT):"E",1:"I")_";3////"_$S($G(RATRANSC):RATRANSC,$G(RAVERF):RAVERF,1:"") D ^DIE K DA,DR,DE,DQ,DIE
"RTN","RAHLO1",111,0)
 ; use ix^dik to kill before setting xrefs
"RTN","RAHLO1",112,0)
 S DA=RARPT,DIK="^RARPT(",RAQUEUED=1 D IX^DIK
"RTN","RAHLO1",113,0)
 ; if verfd, update rpt & exam statuses; else, just update exam status
"RTN","RAHLO1",114,0)
 I $D(RAMDV),RAMDV'="" D:RARPTSTS="V" UPSTAT^RAUTL0 D:RARPTSTS'="V" UP1^RAUTL1
"RTN","RAHLO1",115,0)
 L -^RARPT(RARPT) D:'$D(RAERR)&($G(^TMP("RARPT-REC",$J,RASUB,"VENDOR"))'="KURZWEIL") GENACK^RAHLTCPB ; generate 'ACK' message
"RTN","RAHLO1",116,0)
 ; line pacs is for 2 tasks: hl7 msg'g  &  voice verified rpt printout
"RTN","RAHLO1",117,0)
PACS I ($P(^RARPT(RARPT,0),U,5)="V")!($P(^(0),U,5)="R") D TASK^RAHLO4,VOICE^RAHLO4
"RTN","RAHLO1",118,0)
KVAR K RAAB,RAEDIT,RAESIG,RAQUEUED,RARPT,RAHIST
"RTN","RAHLO1",119,0)
 Q
"RTN","RAPM")
0^2^B64632251
"RTN","RAPM",1,0)
RAPM ;HOIFO/TH-Radiology Performance Monitors/Indicator; ;5/12/04  10:03
"RTN","RAPM",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,48**;Mar 16, 1998
"RTN","RAPM",3,0)
 ;
"RTN","RAPM",4,0)
 ; *** Application variables: ***
"RTN","RAPM",5,0)
 ;
"RTN","RAPM",6,0)
 ; Exam Date - RADTE (Regular Fileman format)
"RTN","RAPM",7,0)
 ;             RADTI (Inverse Fileman format)
"RTN","RAPM",8,0)
 ; Case Number - RACN               Exam Status - RAEXST
"RTN","RAPM",9,0)
 ; Category of Exam - RACAT         Primary Interpreting Staff - RAPRIM
"RTN","RAPM",10,0)
 ; Date Report Entered - RARPTDT    Verified Date - RAVERDT
"RTN","RAPM",11,0)
 ; Report Status - RARPTST          Page Number - RAPG
"RTN","RAPM",12,0)
 ; Type of Report - RARPT
"RTN","RAPM",13,0)
 ; Internal number of an entry in the Patient file (#2) - RADFN
"RTN","RAPM",14,0)
 ;
"RTN","RAPM",15,0)
INIT ; Check for the existence of RACESS. Pass in user's DUZ!
"RTN","RAPM",16,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RAPM",17,0)
 ;
"RTN","RAPM",18,0)
 N DIR,DIRUT,RABDATE,RAEDATE,RARPT,DTDIFF,RABEGDT,RAENDDT,RA1
"RTN","RAPM",19,0)
 N RAM,RARAD,RAR,RAMSG,X,Y
"RTN","RAPM",20,0)
 S (RABDATE,RAEDATE,RAANS,RAANS2,RANODIV,RASINCE,RARAD)=""
"RTN","RAPM",21,0)
 ; RANODIV=1 if one or more exams are missing DIVISION
"RTN","RAPM",22,0)
PROMPT ; 
"RTN","RAPM",23,0)
 W @IOF
"RTN","RAPM",24,0)
 W !!,"Radiology Performance Indicator Report",!!
"RTN","RAPM",25,0)
 ; Prompt for Report Type. Quit if no report type selected
"RTN","RAPM",26,0)
 D GETRPT K DIR Q:$D(DIRUT)
"RTN","RAPM",27,0)
 ; Prompt for Date Range - Quit if no dates selected
"RTN","RAPM",28,0)
 W !! D GETDATE K DIR Q:$D(DIRUT)
"RTN","RAPM",29,0)
 ; Prompt for Radiologist if Short or Both
"RTN","RAPM",30,0)
 D RADIOL^RAPM3
"RTN","RAPM",31,0)
 ; Prompt for Division and Imaging Types
"RTN","RAPM",32,0)
 S X=$$DIVLOC^RAUTL7() I X G EXIT
"RTN","RAPM",33,0)
 I $D(^TMP($J,"RA I-TYPE","VASCULAR LAB")) D
"RTN","RAPM",34,0)
 . K ^TMP($J,"RA I-TYPE","VASCULAR LAB")
"RTN","RAPM",35,0)
 . W !!?5,"*** Imaging type 'Vascular Lab' will not be included in this report ***"
"RTN","RAPM",36,0)
 ; Prompt for sort option if Detail
"RTN","RAPM",37,0)
 D:RARPT'="S" SORT K DIR Q:$D(DIRUT)
"RTN","RAPM",38,0)
 ; Prompt for mail delivery if Short or Both
"RTN","RAPM",39,0)
 I RARPT'="D" D EMAIL^RAPM2 K DIR Q:$D(DIRUT)
"RTN","RAPM",40,0)
 ; Warning for Detail or Both
"RTN","RAPM",41,0)
 I RARPT="D"!(RARPT="B") D
"RTN","RAPM",42,0)
 . S RATXT="*** The detail report requires a 132 column output device ***"
"RTN","RAPM",43,0)
 . S RALINE="",$P(RALINE,"*",$L(RATXT))=""
"RTN","RAPM",44,0)
 . W !!?(80-$L(RATXT)\2),RALINE,!?(80-$L(RATXT)\2),RATXT,!?(80-$L(RATXT)\2),RALINE,!
"RTN","RAPM",45,0)
 .Q
"RTN","RAPM",46,0)
 D DEV
"RTN","RAPM",47,0)
 I RAPOP D  G EXIT
"RTN","RAPM",48,0)
 . I RAANS!(RAANS2) W !?5,"** No mail will be sent **",$C(7)
"RTN","RAPM",49,0)
 . Q
"RTN","RAPM",50,0)
START ; Get data and print the report
"RTN","RAPM",51,0)
 S:$D(ZTQUEUED) ZTREQ="@" S RAIO=$S(IO="":0,1:1)
"RTN","RAPM",52,0)
 D GETDATA
"RTN","RAPM",53,0)
 I RARPT="S"!(RARPT="B") S RAPG=0 D ^RAPM1
"RTN","RAPM",54,0)
 I RARPT="D"!(RARPT="B") S RAPG=0 D ^RAPM2
"RTN","RAPM",55,0)
 ; see if need send email
"RTN","RAPM",56,0)
 D SEND^RAPM2
"RTN","RAPM",57,0)
 D EXIT
"RTN","RAPM",58,0)
 Q
"RTN","RAPM",59,0)
 ;
"RTN","RAPM",60,0)
GETRPT ; Prompt for Summary or Detail or Both reports; Default = Summary Report
"RTN","RAPM",61,0)
 W !,"Enter Report Type"
"RTN","RAPM",62,0)
 S DIR(0)="S^S:Summary;D:Detail;B:Both"
"RTN","RAPM",63,0)
 S DIR("A")="Select Report Type",DIR("B")="S"
"RTN","RAPM",64,0)
 S DIR("?")="Enter Summary report OR Detail report OR Both reports"
"RTN","RAPM",65,0)
 D ^DIR
"RTN","RAPM",66,0)
 Q:$D(DIRUT) 
"RTN","RAPM",67,0)
 S RARPT=Y
"RTN","RAPM",68,0)
 Q
"RTN","RAPM",69,0)
GETDATE ; Prompt for start and end dates
"RTN","RAPM",70,0)
 S DIR(0)="D^:"_DT_":AE"
"RTN","RAPM",71,0)
 I RARPT'="D" D
"RTN","RAPM",72,0)
 . W !!?4,"The begin date for Summary and Both must be at least 10 days before today.",!
"RTN","RAPM",73,0)
 . S X1=DT,X2=-10 D C^%DTC S RA1=X
"RTN","RAPM",74,0)
 . S DIR(0)="D^:"_RA1_":AE"
"RTN","RAPM",75,0)
 . Q
"RTN","RAPM",76,0)
 S DIR("A")="Enter starting date"
"RTN","RAPM",77,0)
 S DIR("?")="Enter date to begin searching from"
"RTN","RAPM",78,0)
 D ^DIR
"RTN","RAPM",79,0)
 Q:$D(DIRUT)
"RTN","RAPM",80,0)
 S RABDATE=Y
"RTN","RAPM",81,0)
 ;
"RTN","RAPM",82,0)
 S RADD=$S(RARPT="S":91,1:31),X1=RABDATE,X2=RADD D C^%DTC S RAMAXDT=X
"RTN","RAPM",83,0)
 ; put 10 day block for summary report or Both
"RTN","RAPM",84,0)
 I RARPT'="D" D
"RTN","RAPM",85,0)
 . W !!?4,"The ending date for Summary and Both must be at least 10 days before today.",!
"RTN","RAPM",86,0)
 . S X1=DT,X2=-10 D C^%DTC S:X<RAMAXDT RAMAXDT=X
"RTN","RAPM",87,0)
 S:RAMAXDT>DT RAMAXDT=DT
"RTN","RAPM",88,0)
 S DIR(0)="D^"_RABDATE_":"_RAMAXDT_":AE"
"RTN","RAPM",89,0)
 S DIR("A")="Enter ending date:  "
"RTN","RAPM",90,0)
 S DIR("?",1)="     +91 days max. for Summary, +31 days max. for Detail."
"RTN","RAPM",91,0)
 S DIR("?",2)="     And the ending date for the Summary and Both"
"RTN","RAPM",92,0)
 S DIR("?")="     must be at least 10 days before today."
"RTN","RAPM",93,0)
 D ^DIR
"RTN","RAPM",94,0)
 Q:$D(DIRUT)
"RTN","RAPM",95,0)
 ;
"RTN","RAPM",96,0)
 ; Set end date to end of day
"RTN","RAPM",97,0)
 ; RABDATE and RAEDATE are original values
"RTN","RAPM",98,0)
 ; RABEGDT and RAENDDT are used in GETDATA 
"RTN","RAPM",99,0)
 S RAEDATE=Y,RAENDDT=RAEDATE_.9999
"RTN","RAPM",100,0)
 ; Set start date back to include current day
"RTN","RAPM",101,0)
 S RABEGDT=(RABDATE-1)_.9999
"RTN","RAPM",102,0)
 Q
"RTN","RAPM",103,0)
SORT ; Prompt for Sorted by
"RTN","RAPM",104,0)
 W !!,"Sort report by"
"RTN","RAPM",105,0)
 S DIR(0)="S^C:Case Number;E:Cateory of Exam;I:Imaging Type;P:Patient Name;R:Radiologist;T:Hrs to Transcrip.;V:Hrs to Verif."
"RTN","RAPM",106,0)
 S DIR("A")="Select Sorted by",DIR("B")="C"
"RTN","RAPM",107,0)
 D ^DIR
"RTN","RAPM",108,0)
 Q:$D(DIRUT)
"RTN","RAPM",109,0)
 S RASORT=Y
"RTN","RAPM",110,0)
 S DIR(0)="N^0:240"
"RTN","RAPM",111,0)
 S DIR("A")="Print PENDING and "_$S(RASORT="V":"Verif.",1:"Transrip.")_" hours greater than or equal to"
"RTN","RAPM",112,0)
 S DIR("B")="72"
"RTN","RAPM",113,0)
 S DIR("?")="Enter minimum number of hours elapsed since registration."
"RTN","RAPM",114,0)
 D ^DIR Q:$D(DIRUT)  S RASINCE=Y
"RTN","RAPM",115,0)
 Q
"RTN","RAPM",116,0)
DEV ; Device
"RTN","RAPM",117,0)
 I $D(DIRUT) D EXIT Q
"RTN","RAPM",118,0)
 W:RARPT="B" !!,"Specify device for both summary and detail reports."
"RTN","RAPM",119,0)
 D TASK
"RTN","RAPM",120,0)
 D ZIS^RAUTL
"RTN","RAPM",121,0)
 Q
"RTN","RAPM",122,0)
TASK ; set vars for taskman
"RTN","RAPM",123,0)
 S ZTRTN="START^RAPM"
"RTN","RAPM",124,0)
 S ZTSAVE("RA*")=""
"RTN","RAPM",125,0)
 S ZTSAVE("^TMP($J,""RA D-TYPE"",")=""
"RTN","RAPM",126,0)
 S ZTSAVE("^TMP($J,""RA I-TYPE"",")=""
"RTN","RAPM",127,0)
 S ZTDESC="Radiology Performance Indicator Report"
"RTN","RAPM",128,0)
 Q
"RTN","RAPM",129,0)
 ;
"RTN","RAPM",130,0)
GETDATA ; Get all the data
"RTN","RAPM",131,0)
 ; Order thru Exam Date (RADTE)
"RTN","RAPM",132,0)
 S RADTE=RABEGDT F  S RADTE=$O(^RADPT("AR",RADTE)) Q:'RADTE  Q:(RADTE>RAENDDT)  D
"RTN","RAPM",133,0)
 . S RADFN="" F  S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:'RADFN  D
"RTN","RAPM",134,0)
 . . ; Get patient name
"RTN","RAPM",135,0)
 . . S RAPATNM=$$GET1^DIQ(2,RADFN,.01) S:RAPATNM="" RAPATNM=" "
"RTN","RAPM",136,0)
 . . ; Order thru inverse Exam Date (RADTI)
"RTN","RAPM",137,0)
 . . S RADTI="" F  S RADTI=$O(^RADPT("AR",RADTE,RADFN,RADTI)) Q:'RADTI  D CHECK
"RTN","RAPM",138,0)
 . . Q
"RTN","RAPM",139,0)
 . Q
"RTN","RAPM",140,0)
 Q
"RTN","RAPM",141,0)
CHECK ; Check type of image
"RTN","RAPM",142,0)
 Q:'$D(^RADPT(RADFN,"DT",RADTI))  ;no exam data at all
"RTN","RAPM",143,0)
 S RAITYP=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2)
"RTN","RAPM",144,0)
 S RAIMGTYP=$P($G(^RA(79.2,+RAITYP,0)),U,1)
"RTN","RAPM",145,0)
 ; quit if img typ is known AND does not match selection
"RTN","RAPM",146,0)
 I RAIMGTYP'="",'$D(^TMP($J,"RA I-TYPE",RAIMGTYP)) Q
"RTN","RAPM",147,0)
 I RAIMGTYP="" S RAIMGTYP="(unknown)"
"RTN","RAPM",148,0)
 ;
"RTN","RAPM",149,0)
 ; Check division - Quit if no division selected
"RTN","RAPM",150,0)
 S RASELDIV=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,3)
"RTN","RAPM",151,0)
 S RACHKDIV=$P($G(^DIC(4,+RASELDIV,0)),U,1)
"RTN","RAPM",152,0)
 ; quit if div is known AND does not match selection 
"RTN","RAPM",153,0)
 I RACHKDIV'="",'$D(^TMP($J,"RA D-TYPE",RACHKDIV)) Q
"RTN","RAPM",154,0)
 S:RACHKDIV="" RANODIV=1
"RTN","RAPM",155,0)
 ;
"RTN","RAPM",156,0)
 ; Get exam related data
"RTN","RAPM",157,0)
 S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D
"RTN","RAPM",158,0)
 . S (RACN0,RAEXST,RANUM,RACN,RAPRIM,RAPRIMNM,RACAT,RARPTTXT)=""
"RTN","RAPM",159,0)
 . S (RARPTDT,RAVERDT,RARPTST,RADHT,RADHV,RATDFHR,RAVDFHR)=""
"RTN","RAPM",160,0)
 . ; Get 0 node (RACN0) of ^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)
"RTN","RAPM",161,0)
 . S RACN0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPM",162,0)
 . Q:RACN0=""  ; no exam data
"RTN","RAPM",163,0)
 . ; Get Case number: Exam Date - Case Number
"RTN","RAPM",164,0)
 . S RACN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_$P(RACN0,U,1)
"RTN","RAPM",165,0)
 . ; Get exam status
"RTN","RAPM",166,0)
 . S RAEXST=$P(RACN0,U,3)
"RTN","RAPM",167,0)
 . Q:RAEXST=""  ; no exam status
"RTN","RAPM",168,0)
 . ; Quit if exam's CREDIT METHOD is 2 = no credit
"RTN","RAPM",169,0)
 . Q:$P(RACN0,U,26)=2
"RTN","RAPM",170,0)
 . ; Quit if exam status is "Cancelled"
"RTN","RAPM",171,0)
 . I $P(^RA(72,RAEXST,0),U,3)=0 Q
"RTN","RAPM",172,0)
 . ; Get number of set - '1' separate; '2' for combined report.
"RTN","RAPM",173,0)
 . S RANUM=$P(RACN0,U,25)
"RTN","RAPM",174,0)
 . ; if member of set > 1 then set RACNI to 99999 to skip remaining cases
"RTN","RAPM",175,0)
 . I RANUM>1 S RACNI=99999
"RTN","RAPM",176,0)
 . ; Get Radiologist (Primary Interpreting Staff) internal # and name. 
"RTN","RAPM",177,0)
 . S RAPRIM=$P(RACN0,U,15)
"RTN","RAPM",178,0)
 . ; if specific radiologist requested, quit if not his/her case
"RTN","RAPM",179,0)
 . I RARAD,RAPRIM'=RARAD Q
"RTN","RAPM",180,0)
 . S RAPRIMNM=$$GET1^DIQ(200,RAPRIM,.01) S:RAPRIMNM="" RAPRIMNM=" "
"RTN","RAPM",181,0)
 . ; Get Category of Exam
"RTN","RAPM",182,0)
 . S RACAT=$P(RACN0,U,4)
"RTN","RAPM",183,0)
 . ; Get Procedure Name
"RTN","RAPM",184,0)
 . S RAPRCN=$P($G(^RAMIS(71,+$P(RACN0,U,2),0)),U)
"RTN","RAPM",185,0)
 . ; Get IEN of imaging report
"RTN","RAPM",186,0)
 . S RARPTTXT=$P(RACN0,U,17)
"RTN","RAPM",187,0)
 . ; Pending if no imaging report OR report doesn't exist in the Report
"RTN","RAPM",188,0)
 . ; file (#74) OR Stub report
"RTN","RAPM",189,0)
 . S RAHASR=0 ;=1 has real report
"RTN","RAPM",190,0)
 . I $D(^RARPT(+RARPTTXT,0)),'$$STUB^RAEDCN1(+RARPTTXT) S RAHASR=1
"RTN","RAPM",191,0)
 . I 'RAHASR D
"RTN","RAPM",192,0)
 . . S ^TMP($J,"RAPM","TR",0)=$G(^TMP($J,"RAPM","TR",0))+1
"RTN","RAPM",193,0)
 . . S ^TMP($J,"RAPM","VR",0)=$G(^TMP($J,"RAPM","VR",0))+1
"RTN","RAPM",194,0)
 . ; Get report info. if real report exists.
"RTN","RAPM",195,0)
 . I RAHASR D RPTINFO^RAPM1
"RTN","RAPM",196,0)
 . D STORE^RAPM2
"RTN","RAPM",197,0)
 . ; Calculate the total number of reports
"RTN","RAPM",198,0)
 . S ^TMP($J,"RAPM","TOTAL")=$G(^TMP($J,"RAPM","TOTAL"))+1
"RTN","RAPM",199,0)
 Q
"RTN","RAPM",200,0)
EXIT ; Exit
"RTN","RAPM",201,0)
 ; Close device
"RTN","RAPM",202,0)
 D CLOSE^RAUTL
"RTN","RAPM",203,0)
 K RACN0,RAEXST,RANUM,RACN,RAPRIM,RAPRIMNM,RACAT,RARPTTXT,RAANS,RATXT
"RTN","RAPM",204,0)
 K DIR,DIRUT,RABDATE,RAEDATE,RARPT,DTDIFF,RABEGDT,RAENDDT,RAITYP,RAIMGTYP,RATYP
"RTN","RAPM",205,0)
 K ZTRTN,ZTSAVE,ZTDESC,RAPG,RASELDIV,RACHKDIV,RACNO,RAVHRS
"RTN","RAPM",206,0)
 K RADIV,RAN,RAIMG,RAREC1,RATOTCNT,RACNI,RADFN,RADTE,RADTI,RAHD,RAPATNM
"RTN","RAPM",207,0)
 K RAPOP,RAPSTX,RAQUIT,RAREC,RARPTDT,RARPTST,RASORT,RASRT,RATDFHR,RAHASR
"RTN","RAPM",208,0)
 K RATDFSEC,RATHRS,RAVDFHR,RAVDFSEC,RAVERDT,RAMES,RALINE,RAMAXDT,RADD
"RTN","RAPM",209,0)
 K RAANS2,RAIOM,RAHDR,RANODIV,RASINCE,RADHT,RADHV,RAVAL,RAPRCN
"RTN","RAPM",210,0)
 K ^TMP($J)
"RTN","RAPM",211,0)
 Q
"RTN","RAPM1")
0^3^B44191045
"RTN","RAPM1",1,0)
RAPM1 ;HOIFO/TH-Radiology Performance Monitors/Indicator; ;2/18/04  09:42
"RTN","RAPM1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,48**;Mar 16, 1998
"RTN","RAPM1",3,0)
 ; Summary Report
"RTN","RAPM1",4,0)
 D HDR^RAPM2("S")
"RTN","RAPM1",5,0)
 ; Print total reports
"RTN","RAPM1",6,0)
 W !,"Total number of reports expected for procedures performed during "
"RTN","RAPM1",7,0)
 W "specified",!,"date range: "
"RTN","RAPM1",8,0)
 S RATOTCNT=+$G(^TMP($J,"RAPM","TOTAL"))
"RTN","RAPM1",9,0)
 W $J(+RATOTCNT,$L(+RATOTCNT))
"RTN","RAPM1",10,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM1",11,0)
 S ^TMP($J,"RAPM",RAN)="Total number of reports expected for procedures performed during specified",RAN=RAN+1
"RTN","RAPM1",12,0)
 S ^TMP($J,"RAPM",RAN)="date range: "_$J(+RATOTCNT,$L(+RATOTCNT)),RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM1",13,0)
 D SHDR,SRPT,SFOOT^RAPM3
"RTN","RAPM1",14,0)
 Q
"RTN","RAPM1",15,0)
SHDR ; Print header of summary report
"RTN","RAPM1",16,0)
 G:'RAIO SHDR2 ; skip writes if original IO is null
"RTN","RAPM1",17,0)
 I ($Y+5)>IOSL,IO=IO(0) D
"RTN","RAPM1",18,0)
 . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue.",X:DTIME
"RTN","RAPM1",19,0)
 . S RAPG=RAPG+1,RAHDR="Summary Performance Indicator Report"
"RTN","RAPM1",20,0)
 . W @IOF,!?(RAIOM-$L(RAHDR)\2),RAHDR,?(RAIOM-10),"Page: ",$G(RAPG)
"RTN","RAPM1",21,0)
 W !!,"Hrs ",?8,">0",?14,">24",?21,">48",?27,">72",?33,">96"
"RTN","RAPM1",22,0)
 W ?38,">120",?44,">144",?50,">168",?56,">192",?62,">216",?68,">240"
"RTN","RAPM1",23,0)
 W ?73,"PENDING"
"RTN","RAPM1",24,0)
 W !,"From",?7,"-24",?14,"-48",?21,"-72",?27,"-96",?32,"-120",?38,"-144"
"RTN","RAPM1",25,0)
 W ?44,"-168",?50,"-192",?56,"-216",?62,"-240",?68,"Hrs"
"RTN","RAPM1",26,0)
 W !,"Ex Dt",?7,"Hrs",?14,"Hrs",?21,"Hrs",?27,"Hrs",?33,"Hrs",?39,"Hrs",?45,"Hrs",?51,"Hrs",?57,"Hrs",?63,"Hrs",!
"RTN","RAPM1",27,0)
SHDR2 ;save to tmp
"RTN","RAPM1",28,0)
 S ^TMP($J,"RAPM",RAN)="Hrs    >0    >24    >48   >72   >96  >120  >144  >168  >192  >216  >240 PENDING",RAN=RAN+1
"RTN","RAPM1",29,0)
 S ^TMP($J,"RAPM",RAN)="From  -24    -48    -72   -96  -120  -144  -168  -192  -216  -240  Hrs",RAN=RAN+1
"RTN","RAPM1",30,0)
 S ^TMP($J,"RAPM",RAN)="Ex Dt Hrs    Hrs    Hrs   Hrs   Hrs   Hrs   Hrs   Hrs   Hrs   Hrs",RAN=RAN+1
"RTN","RAPM1",31,0)
 S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM1",32,0)
 Q
"RTN","RAPM1",33,0)
SRPT ; Print summary report
"RTN","RAPM1",34,0)
 I RATOTCNT=0 W:RAIO !,?4,"No data to print..." Q
"RTN","RAPM1",35,0)
 G:'RAIO SRPT2
"RTN","RAPM1",36,0)
 I ($Y+5)>IOSL,IO=IO(0) D SHDR
"RTN","RAPM1",37,0)
 ;
"RTN","RAPM1",38,0)
 W !,"#Tr",?4,$J(+$G(^TMP($J,"RAPM","TR",1)),6),?11,$J(+$G(^(2)),6),?18,$J(+$G(^(3)),6),?25,$J(+$G(^(4)),5)
"RTN","RAPM1",39,0)
 W ?31,$J(+$G(^TMP($J,"RAPM","TR",5)),5),?37,$J(+$G(^(6)),5),?43,$J(+$G(^(7)),5),?49,$J(+$G(^(8)),5),?55,$J(+$G(^(9)),5)
"RTN","RAPM1",40,0)
 W ?61,$J(+$G(^TMP($J,"RAPM","TR",10)),5),?67,$J(+$G(^(11)),5),?73,$J(+$G(^(0)),7)
"RTN","RAPM1",41,0)
 ;
"RTN","RAPM1",42,0)
 W !,"%Tr",?4,$J((+$G(^TMP($J,"RAPM","TR",1))/RATOTCNT)*100,6,1)
"RTN","RAPM1",43,0)
 W ?11,$J((+$G(^TMP($J,"RAPM","TR",2))/RATOTCNT)*100,6,1),?18,$J((+$G(^(3))/RATOTCNT)*100,6,1),?25,$J((+$G(^(4))/RATOTCNT)*100,5,1)
"RTN","RAPM1",44,0)
 W ?31,$J((+$G(^TMP($J,"RAPM","TR",5))/RATOTCNT)*100,5,1),?37,$J((+$G(^(6))/RATOTCNT)*100,5,1),?43,$J((+$G(^(7))/RATOTCNT)*100,5,1),?49,$J((+$G(^(8))/RATOTCNT)*100,5,1)
"RTN","RAPM1",45,0)
 W ?55,$J((+$G(^TMP($J,"RAPM","TR",9))/RATOTCNT)*100,5,1),?61,$J((+$G(^(10))/RATOTCNT)*100,5,1),?67,$J((+$G(^(11))/RATOTCNT)*100,5,1),?73,$J((+$G(^(0))/RATOTCNT)*100,7,1),!
"RTN","RAPM1",46,0)
 ;
"RTN","RAPM1",47,0)
 W !,"#Vr",?4,$J(+$G(^TMP($J,"RAPM","VR",1)),6),?11,$J(+$G(^(2)),6),?18,$J(+$G(^(3)),6),?25,$J(+$G(^(4)),5),?31,$J(+$G(^(5)),5)
"RTN","RAPM1",48,0)
 W ?37,$J(+$G(^TMP($J,"RAPM","VR",6)),5),?43,$J(+$G(^(7)),5),?49,$J(+$G(^(8)),5),?55,$J(+$G(^(9)),5),?61,$J(+$G(^(10)),5)
"RTN","RAPM1",49,0)
 W ?67,$J(+$G(^TMP($J,"RAPM","VR",11)),5),?73,$J(+$G(^(0)),7)
"RTN","RAPM1",50,0)
 ;
"RTN","RAPM1",51,0)
 W !,"%Vr",?4,$J((+$G(^TMP($J,"RAPM","VR",1))/RATOTCNT)*100,6,1),?11,$J((+$G(^(2))/RATOTCNT)*100,6,1),?18,$J((+$G(^(3))/RATOTCNT)*100,6,1)
"RTN","RAPM1",52,0)
 W ?25,$J((+$G(^TMP($J,"RAPM","VR",4))/RATOTCNT)*100,5,1),?31,$J((+$G(^(5))/RATOTCNT)*100,5,1),?37,$J((+$G(^(6))/RATOTCNT)*100,5,1),?43,$J((+$G(^(7))/RATOTCNT)*100,5,1)
"RTN","RAPM1",53,0)
 W ?49,$J((+$G(^TMP($J,"RAPM","VR",8))/RATOTCNT)*100,5,1),?55,$J((+$G(^(9))/RATOTCNT)*100,5,1),?61,$J((+$G(^(10))/RATOTCNT)*100,5,1),?67,$J((+$G(^(11))/RATOTCNT)*100,5,1)
"RTN","RAPM1",54,0)
 W ?73,$J((+$G(^TMP($J,"RAPM","VR",0))/RATOTCNT)*100,7,1),!
"RTN","RAPM1",55,0)
 ;
"RTN","RAPM1",56,0)
SRPT2 ; store in tmp
"RTN","RAPM1",57,0)
 S ^TMP($J,"RAPM",RAN)="#Tr"_$J(+$G(^TMP($J,"RAPM","TR",1)),6)_" "_$J(+$G(^(2)),6)_" "_$J(+$G(^(3)),6)_" "_$J(+$G(^(4)),5)_" "_$J(+$G(^(5)),5)
"RTN","RAPM1",58,0)
 S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_" "_$J(+$G(^TMP($J,"RAPM","TR",6)),5)_" "_$J(+$G(^(7)),5)_" "_$J(+$G(^(8)),5)_" "_$J(+$G(^(9)),5)_" "_$J(+$G(^(10)),5)
"RTN","RAPM1",59,0)
 S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_" "_$J(+$G(^TMP($J,"RAPM","TR",11)),5)_" "_$J(+$G(^(0)),7) S RAN=RAN+1
"RTN","RAPM1",60,0)
 ;
"RTN","RAPM1",61,0)
 S ^TMP($J,"RAPM",RAN)="%Tr"_$J((+$G(^TMP($J,"RAPM","TR",1))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(2))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(3))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(4))/RATOTCNT)*100,5,1)
"RTN","RAPM1",62,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","TR",5))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(6))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(7))/RATOTCNT)*100,5,1)
"RTN","RAPM1",63,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","TR",8))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(9))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(10))/RATOTCNT)*100,5,1)
"RTN","RAPM1",64,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","TR",11))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(0))/RATOTCNT)*100,7,1)
"RTN","RAPM1",65,0)
 S RAN=RAN+1,^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM1",66,0)
 ;
"RTN","RAPM1",67,0)
 S ^TMP($J,"RAPM",RAN)="#Vr"_$J(+$G(^TMP($J,"RAPM","VR",1)),6)_" "_$J(+$G(^(2)),6)_" "_$J(+$G(^(3)),6)_" "_$J(+$G(^(4)),5)_" "_$J(+$G(^(5)),5)
"RTN","RAPM1",68,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J(+$G(^TMP($J,"RAPM","VR",6)),5)_" "_$J(+$G(^(7)),5)_" "_$J(+$G(^(8)),5)_" "_$J(+$G(^(9)),5)_" "_$J(+$G(^(10)),5)
"RTN","RAPM1",69,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J(+$G(^TMP($J,"RAPM","VR",11)),5)_" "_$J(+$G(^(0)),7) S RAN=RAN+1
"RTN","RAPM1",70,0)
 ;
"RTN","RAPM1",71,0)
 S ^TMP($J,"RAPM",RAN)="%Vr"_$J((+$G(^TMP($J,"RAPM","VR",1))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(2))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(3))/RATOTCNT)*100,6,1)_" "_$J((+$G(^(4))/RATOTCNT)*100,5,1)
"RTN","RAPM1",72,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","VR",5))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(6))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(7))/RATOTCNT)*100,5,1)
"RTN","RAPM1",73,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","VR",8))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(9))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(10))/RATOTCNT)*100,5,1)
"RTN","RAPM1",74,0)
 S ^TMP($J,"RAPM",RAN)=$G(^TMP($J,"RAPM",RAN))_" "_$J((+$G(^TMP($J,"RAPM","VR",11))/RATOTCNT)*100,5,1)_" "_$J((+$G(^(0))/RATOTCNT)*100,7,1) S RAN=RAN+1
"RTN","RAPM1",75,0)
 Q
"RTN","RAPM1",76,0)
RPTINFO ; Other report info.
"RTN","RAPM1",77,0)
 ; Get Date/Time Report Entered, replace prev RACN with data from Report
"RTN","RAPM1",78,0)
 S RARPTDT=$P(^RARPT(RARPTTXT,0),U,6),RACN=$P(^(0),U)
"RTN","RAPM1",79,0)
 ; Get Verified Date/Time
"RTN","RAPM1",80,0)
 S RAVERDT=$P(^RARPT(RARPTTXT,0),U,7)
"RTN","RAPM1",81,0)
 ; Use 1st Verified Date/Time for amended reports
"RTN","RAPM1",82,0)
 I RAVERDT,$O(^RARPT(RARPTTXT,"ERR",0)) D
"RTN","RAPM1",83,0)
 . S RA1=0
"RTN","RAPM1",84,0)
 . F  S RA1=$O(^RARPT(RARPTTXT,"L",RA1)) Q:'RA1  I $D(^(RA1,0)),$P(^(0),U,2)="V" S RAVERDT=$P(^(0),U)
"RTN","RAPM1",85,0)
 . Q
"RTN","RAPM1",86,0)
 I RARPTDT="" S ^TMP($J,"RAPM","TR",0)=$G(^TMP($J,"RAPM","TR",0))+1
"RTN","RAPM1",87,0)
 I RAVERDT="" S ^TMP($J,"RAPM","VR",0)=$G(^TMP($J,"RAPM","VR",0))+1
"RTN","RAPM1",88,0)
 ; Get Report Status
"RTN","RAPM1",89,0)
 S RARPTST=$P(^RARPT(RARPTTXT,0),U,5)
"RTN","RAPM1",90,0)
 ;
"RTN","RAPM1",91,0)
CAL ; Calculation: Null report pointer, no report, no report date, no 
"RTN","RAPM1",92,0)
 ; verfied date are counted as diff=0
"RTN","RAPM1",93,0)
 ; # of Transcribed = Total # of transcribed exams not cancelled.
"RTN","RAPM1",94,0)
 ; # of hrs from exam registration = Date/Time transcribed 
"RTN","RAPM1",95,0)
 ;      (Date Report Entered) - Exam Date/time
"RTN","RAPM1",96,0)
 I RARPTDT D
"RTN","RAPM1",97,0)
 . S RATDFSEC=$$FMDIFF^XLFDT(RARPTDT,RADTE,2)
"RTN","RAPM1",98,0)
 . S RATDFHR=RATDFSEC/3600
"RTN","RAPM1",99,0)
 . S RATHRS=$S(RATDFHR=0:0,RATDFHR'>24:1,RATDFHR'>48:2,RATDFHR'>72:3,RATDFHR'>96:4,RATDFHR'>120:5,RATDFHR'>144:6,RATDFHR'>168:7,RATDFHR'>192:8,RATDFHR'>216:9,RATDFHR'>240:10,1:11)
"RTN","RAPM1",100,0)
 . S ^(RATHRS)=$G(^TMP($J,"RAPM","TR",RATHRS))+1
"RTN","RAPM1",101,0)
 ;
"RTN","RAPM1",102,0)
 I RAVERDT D
"RTN","RAPM1",103,0)
 . S RAVDFSEC=$$FMDIFF^XLFDT(RAVERDT,RADTE,2)
"RTN","RAPM1",104,0)
 . S RAVDFHR=RAVDFSEC/3600
"RTN","RAPM1",105,0)
 . S RAVHRS=$S(RAVDFHR=0:0,RAVDFHR'>24:1,RAVDFHR'>48:2,RAVDFHR'>72:3,RAVDFHR'>96:4,RAVDFHR'>120:5,RAVDFHR'>144:6,RAVDFHR'>168:7,RAVDFHR'>192:8,RAVDFHR'>216:9,RAVDFHR'>240:10,1:11)
"RTN","RAPM1",106,0)
 . S ^(RAVHRS)=$G(^TMP($J,"RAPM","VR",RAVHRS))+1
"RTN","RAPM1",107,0)
 Q
"RTN","RAPM2")
0^4^B78073225
"RTN","RAPM2",1,0)
RAPM2 ;HOIFO/TH-Radiology Performance Monitors/Indicator; ;2/26/04  12:41
"RTN","RAPM2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**37,44,48**;Mar 16, 1998
"RTN","RAPM2",3,0)
 ; IA 10090 allows Read w/Fileman for entire file 4
"RTN","RAPM2",4,0)
 ; Print Detail report
"RTN","RAPM2",5,0)
DETAIL ; Print Detail report
"RTN","RAPM2",6,0)
 I ($Y+5)>IOSL!(RARPT="B") D
"RTN","RAPM2",7,0)
 . I IO=IO(0),($E(IOST,1,2)="C-") D
"RTN","RAPM2",8,0)
 . . R !,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM2",9,0)
 D HDR("D")
"RTN","RAPM2",10,0)
 D PRTTOT
"RTN","RAPM2",11,0)
 D DHDR
"RTN","RAPM2",12,0)
 D DRPT
"RTN","RAPM2",13,0)
 D DFOOT
"RTN","RAPM2",14,0)
 Q
"RTN","RAPM2",15,0)
 ;
"RTN","RAPM2",16,0)
PRTTOT ; Print total number of reports
"RTN","RAPM2",17,0)
 S RATOTCNT=+$G(^TMP($J,"RAPM","TOTAL"))
"RTN","RAPM2",18,0)
 W !,"Total number of reports expected for procedures performed during specified date range: ",$J(RATOTCNT,$L(RATOTCNT))
"RTN","RAPM2",19,0)
 Q
"RTN","RAPM2",20,0)
 ;
"RTN","RAPM2",21,0)
DHDR ; Header
"RTN","RAPM2",22,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",23,0)
 . S RAPG=RAPG+1,RAHD(0)="Detail Performance Indicator Report"
"RTN","RAPM2",24,0)
 . W @IOF,!?(RAIOM-$L(RAHD(0))\2),RAHD(0),?(RAIOM-10),"Page: ",$G(RAPG)
"RTN","RAPM2",25,0)
 W !!,?32,"Date/Time",?48,"Date/Time",?68,"Date/Time",?102,"Cat"
"RTN","RAPM2",26,0)
 W ?106,"Rpt",?110,"Img",?116,"Procedure"
"RTN","RAPM2",27,0)
 W !,"Patient Name",?18,"Case #",?32,"Registered",?48,"Transcribed",?62,"Hrs"
"RTN","RAPM2",28,0)
 W ?68,"Verified",?82,"Hrs",?87,"Radiologist",?102,"Exm",?106,"Sts"
"RTN","RAPM2",29,0)
 W ?110,"Typ",?119,"Name",!
"RTN","RAPM2",30,0)
 Q
"RTN","RAPM2",31,0)
 ;
"RTN","RAPM2",32,0)
DRPT ; Read records
"RTN","RAPM2",33,0)
 I '$D(^TMP($J,"RAPM2")) W !!?30,"No data to print...",!!!!! Q
"RTN","RAPM2",34,0)
 S D1="" F  S D1=$O(^TMP($J,"RAPM2",D1)) Q:D1=""  D
"RTN","RAPM2",35,0)
 . S D2="" F  S D2=$O(^TMP($J,"RAPM2",D1,D2)) Q:D2=""  D
"RTN","RAPM2",36,0)
 . . S D3="" F  S D3=$O(^TMP($J,"RAPM2",D1,D2,D3)) Q:D3=""  D
"RTN","RAPM2",37,0)
 . . . D SRT
"RTN","RAPM2",38,0)
 Q
"RTN","RAPM2",39,0)
 ;
"RTN","RAPM2",40,0)
SRT ; Read records
"RTN","RAPM2",41,0)
 I RASORT="C"!(RASORT="P") S RAREC=$G(^TMP($J,"RAPM2",D1,D2,D3)) D DET Q
"RTN","RAPM2",42,0)
 S D4="" F  S D4=$O(^TMP($J,"RAPM2",D1,D2,D3,D4)) Q:D4=""  D
"RTN","RAPM2",43,0)
 . S RAREC=$G(^TMP($J,"RAPM2",D1,D2,D3,D4)) D DET
"RTN","RAPM2",44,0)
 Q
"RTN","RAPM2",45,0)
 ;
"RTN","RAPM2",46,0)
DET ; Print detail records
"RTN","RAPM2",47,0)
 ; use Transcription elasped hr for all sorts, except if sort by Verif.
"RTN","RAPM2",48,0)
 S RAVAL=$S(RASORT="V":$P(RAREC,U,13),1:$P(RAREC,U,12))
"RTN","RAPM2",49,0)
 ; remove symbols before comparison
"RTN","RAPM2",50,0)
 S:$E(RAVAL)="<" RAVAL=.5 S:$E(RAVAL)=">" RAVAL=999
"RTN","RAPM2",51,0)
 ; include PENDING and those with hours > RASINCE
"RTN","RAPM2",52,0)
 I RAVAL'="",RAVAL<RASINCE Q
"RTN","RAPM2",53,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",54,0)
 . I IO=IO(0) D
"RTN","RAPM2",55,0)
 . . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM2",56,0)
 . D DHDR
"RTN","RAPM2",57,0)
 W !,$E($P(RAREC,U,2),1,15)
"RTN","RAPM2",58,0)
 W ?17,$P(RAREC,U,1)
"RTN","RAPM2",59,0)
 W ?31,$P($$FMTE^XLFDT($P(RAREC,U,3),"2FS"),":",1,2)
"RTN","RAPM2",60,0)
 W ?46,$P($$FMTE^XLFDT($P(RAREC,U,4),"2FS"),":",1,2),?61,$J($P(RAREC,U,12),4)
"RTN","RAPM2",61,0)
 W ?66,$P($$FMTE^XLFDT($P(RAREC,U,5),"2FS"),":",1,2),?81,$J($P(RAREC,U,13),4)
"RTN","RAPM2",62,0)
 I $P(RAREC,U,6)'="" W ?86,$E($P(RAREC,U,6),1,16)
"RTN","RAPM2",63,0)
 W ?104,$P(RAREC,U,7),?107,$P(RAREC,U,8)
"RTN","RAPM2",64,0)
 W ?110,$E($P(RAREC,U,9),1,3),?114,$E($P(RAREC,U,14),1,15)
"RTN","RAPM2",65,0)
 W:$P(RAREC,U,11)="" ?130,"*D"
"RTN","RAPM2",66,0)
 Q
"RTN","RAPM2",67,0)
 ;
"RTN","RAPM2",68,0)
DFOOT ; Footer for Detail report
"RTN","RAPM2",69,0)
 I ($Y+5)>IOSL D
"RTN","RAPM2",70,0)
 . I IO=IO(0) D
"RTN","RAPM2",71,0)
 . . I $E(IOST,1,2)="C-" R !,"Press RETURN to continue. ",X:DTIME
"RTN","RAPM2",72,0)
 . D DHDR
"RTN","RAPM2",73,0)
 W !!,"Note: Category of Exam: 'I' for Inpatient; 'O' for Outpatient; "
"RTN","RAPM2",74,0)
 W "'C' for Contract; 'S' for Sharing; 'E' for Employee; 'R' for Research"
"RTN","RAPM2",75,0)
 W !,"      Report Status:    'V' for Verififed; 'R' for Released/Not "
"RTN","RAPM2",76,0)
 W "Verified; 'PD' for Problem Draft; 'D' for Draft"
"RTN","RAPM2",77,0)
 W:RANODIV !," *D = Division is missing"
"RTN","RAPM2",78,0)
 W !!?5,"* A printset, i.e., a set of multiple exams that share the same report, will be expected to have 1 report."
"RTN","RAPM2",79,0)
 Q
"RTN","RAPM2",80,0)
 ;
"RTN","RAPM2",81,0)
STORE ; Store detail information
"RTN","RAPM2",82,0)
 Q:RARPT="S"
"RTN","RAPM2",83,0)
 ; for storage subscript: if no rpt dt, set to neg
"RTN","RAPM2",84,0)
 S RADHT=$S(RARPTDT="":-1,1:RATDFHR)
"RTN","RAPM2",85,0)
 S RADHV=$S(RAVERDT="":-1,1:RAVDFHR)
"RTN","RAPM2",86,0)
 ; for display: round off and remove decimal portion of hours
"RTN","RAPM2",87,0)
 S:RATDFHR'="" RATDFHR=(RATDFHR+.5)\1
"RTN","RAPM2",88,0)
 S:RAVDFHR'="" RAVDFHR=(RAVDFHR+.5)\1
"RTN","RAPM2",89,0)
 S RATDFHR=$S(RATDFHR="":"",RATDFHR<1:"<1",RATDFHR>999:">999",1:RATDFHR)
"RTN","RAPM2",90,0)
 S RAVDFHR=$S(RAVDFHR="":"",RAVDFHR<1:"<1",RAVDFHR>999:">999",1:RAVDFHR)
"RTN","RAPM2",91,0)
 ;
"RTN","RAPM2",92,0)
 S RAREC1=RACN_U_RAPATNM_U_RADTE_U_RARPTDT_U
"RTN","RAPM2",93,0)
 S RAREC1=RAREC1_RAVERDT_U_RAPRIMNM_U_RACAT_U_RARPTST_U_RAIMGTYP_U
"RTN","RAPM2",94,0)
 S RAREC1=RAREC1_RADFN_U_RACHKDIV_U_RATDFHR_U_RAVDFHR_U_RAPRCN
"RTN","RAPM2",95,0)
 ;
"RTN","RAPM2",96,0)
 I RASORT="C" S ^TMP($J,"RAPM2",$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",97,0)
 I RASORT="P" S ^TMP($J,"RAPM2",RAPATNM,$P(RADTE,"."),RACN)=RAREC1
"RTN","RAPM2",98,0)
 I RASORT="I" S ^TMP($J,"RAPM2",RAIMGTYP,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",99,0)
 I RASORT="E" S ^TMP($J,"RAPM2",RACAT,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",100,0)
 I RASORT="R" S ^TMP($J,"RAPM2",RAPRIMNM,$P(RADTE,"."),RACN,RAPATNM)=RAREC1
"RTN","RAPM2",101,0)
 I RASORT="T" S ^TMP($J,"RAPM2",RADHT,RADTE,RACN,RAPATNM)=RAREC1
"RTN","RAPM2",102,0)
 I RASORT="V" S ^TMP($J,"RAPM2",RADHV,RADTE,RACN,RAPATNM)=RAREC1
"RTN","RAPM2",103,0)
 Q
"RTN","RAPM2",104,0)
EMAIL ; Ask if ready to email the summary report
"RTN","RAPM2",105,0)
 N RA1
"RTN","RAPM2",106,0)
 W ! S DIR(0)="Y"
"RTN","RAPM2",107,0)
 S DIR("A")="Send summary report to local mail group ""G.RAD PERFORMANCE INDICATOR"""
"RTN","RAPM2",108,0)
 S DIR("B")="Yes"
"RTN","RAPM2",109,0)
 D ^DIR
"RTN","RAPM2",110,0)
 Q:$D(DIRUT)
"RTN","RAPM2",111,0)
 S RAANS=Y
"RTN","RAPM2",112,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPM2",113,0)
 I '$O(^RA(79,RA1,1,0)) D  Q
"RTN","RAPM2",114,0)
 . W !!,?5,"No OUTLOOK mail group(s) have been entered yet."
"RTN","RAPM2",115,0)
 . Q
"RTN","RAPM2",116,0)
 W ! S DIR(0)="Y"
"RTN","RAPM2",117,0)
 S DIR("A")="Send summary report to OUTLOOK mail group(s)"
"RTN","RAPM2",118,0)
 S DIR("B")="Yes"
"RTN","RAPM2",119,0)
 D ^DIR
"RTN","RAPM2",120,0)
 S RAANS2=Y
"RTN","RAPM2",121,0)
 Q
"RTN","RAPM2",122,0)
SEND ; Send summary report to mail group
"RTN","RAPM2",123,0)
 I RAANS=0,RAANS2=0 Q
"RTN","RAPM2",124,0)
 N RA1,RA2,RASVSUB,RASVTEXT
"RTN","RAPM2",125,0)
 S XMSUB="Radiology Summary Performance Indicator"
"RTN","RAPM2",126,0)
 S XMDUZ=DUZ
"RTN","RAPM2",127,0)
 S XMTEXT="^TMP($J,""RAPM"","
"RTN","RAPM2",128,0)
 S RASVSUB=XMSUB,RASVTEXT=XMTEXT
"RTN","RAPM2",129,0)
 I RAANS=1 D
"RTN","RAPM2",130,0)
 . S XMY("G.RAD PERFORMANCE INDICATOR")=""
"RTN","RAPM2",131,0)
 . D ^XMD
"RTN","RAPM2",132,0)
 . K XMY
"RTN","RAPM2",133,0)
 . Q
"RTN","RAPM2",134,0)
 I RAANS2=1 D
"RTN","RAPM2",135,0)
 . S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPM2",136,0)
 . S XMSUB=RASVSUB,XMTEXT=RASVTEXT
"RTN","RAPM2",137,0)
 . S RA2=0
"RTN","RAPM2",138,0)
 . F  S RA2=$O(^RA(79,RA1,1,RA2)) Q:'RA2  S XMY($P(^(RA2,0),U))=""
"RTN","RAPM2",139,0)
 . Q:'$D(XMY)
"RTN","RAPM2",140,0)
 . D ^XMD
"RTN","RAPM2",141,0)
 . K XMY
"RTN","RAPM2",142,0)
 . Q
"RTN","RAPM2",143,0)
 K XMDUZ
"RTN","RAPM2",144,0)
 Q
"RTN","RAPM2",145,0)
HDR(RATYP) ; Print appropriate header
"RTN","RAPM2",146,0)
 U:RAIO IO S RAPG=$G(RAPG)+1
"RTN","RAPM2",147,0)
 I $G(RAPG)!($E(IOST,1,2)="C-") W:RAIO @IOF
"RTN","RAPM2",148,0)
 I $E(IOST,1,2)="P-",(RAPG>1) W:RAIO @IOF
"RTN","RAPM2",149,0)
 S RAHD(0)=$S(RATYP="S":"Summary",RATYP="D":"Detail",1:"")
"RTN","RAPM2",150,0)
 S RAHD(0)=RAHD(0)_" Performance Indicator Report"
"RTN","RAPM2",151,0)
 S RAIOM=$S(RATYP="S":80,1:IOM)
"RTN","RAPM2",152,0)
 W:RAIO !?(RAIOM-$L(RAHD(0))\2),RAHD(0),?(RAIOM-10),"Page: ",$G(RAPG),!
"RTN","RAPM2",153,0)
 I RATYP="S" S RAN=1 D
"RTN","RAPM2",154,0)
 . S ^TMP($J,"RAPM",RAN)="                     Summary Performance Indicator Report          Page: "_$G(RAPG) S RAN=RAN+1
"RTN","RAPM2",155,0)
 . S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM2",156,0)
 ;
"RTN","RAPM2",157,0)
 D GETS^DIQ(4,DUZ(2),".01;14*;99","E","RAR","RAMSG")
"RTN","RAPM2",158,0)
 K X
"RTN","RAPM2",159,0)
 S X(1)=RAR(4,DUZ(2)_",",.01,"E") ; Name of facility
"RTN","RAPM2",160,0)
 S X(2)=RAR(4,DUZ(2)_",",99,"E") ;  Station Number
"RTN","RAPM2",161,0)
 I $D(RAR(4.014)) D
"RTN","RAPM2",162,0)
 . S X(3)=RAR(4.014,"1,"_DUZ(2)_",",.01,"E") ; Association
"RTN","RAPM2",163,0)
 . S X(4)=RAR(4.014,"1,"_DUZ(2)_",",1,"E") ; Parent of Association
"RTN","RAPM2",164,0)
 . S X(5)=$S(X(3)="VISN":X(4),1:"") ; should be VISN number
"RTN","RAPM2",165,0)
 E  S X(5)=""
"RTN","RAPM2",166,0)
 ;
"RTN","RAPM2",167,0)
 W:RAIO !,"Facility: ",X(1),?41,"Station: ",X(2),?60,"VISN: ",X(5)
"RTN","RAPM2",168,0)
 I RATYP="S" D
"RTN","RAPM2",169,0)
 . S $P(X(6)," ",79)=""
"RTN","RAPM2",170,0)
 . S $E(X(6),1,(10+$L(X(1))))="Facility: "_X(1)
"RTN","RAPM2",171,0)
 . S $E(X(6),41,(50+$L(X(2))))="Station: "_X(2)
"RTN","RAPM2",172,0)
 . S $E(X(6),60,(66+$L(X(5))))="VISN: "_X(5)
"RTN","RAPM2",173,0)
 . S ^TMP($J,"RAPM",RAN)=X(6)
"RTN","RAPM2",174,0)
 . S RAN=RAN+1
"RTN","RAPM2",175,0)
 . Q
"RTN","RAPM2",176,0)
 W !,"Division: "
"RTN","RAPM2",177,0)
 I RATYP="S" S ^TMP($J,"RAPM",RAN)="Division: "
"RTN","RAPM2",178,0)
 D DIV
"RTN","RAPM2",179,0)
 S:(RATYP="S") RAN=RAN+1
"RTN","RAPM2",180,0)
 ;
"RTN","RAPM2",181,0)
 W:RAIO !,"Exam Date Range: "
"RTN","RAPM2",182,0)
 W:RAIO $$FMTE^XLFDT(RABDATE,"2D")," - ",$$FMTE^XLFDT(RAEDATE,"2D")
"RTN","RAPM2",183,0)
 I RATYP="S" S ^TMP($J,"RAPM",RAN)="Exam Date Range: "_$$FMTE^XLFDT(RABDATE,"2D")_" - "_$$FMTE^XLFDT(RAEDATE,"2D") S RAN=RAN+1
"RTN","RAPM2",184,0)
 ;
"RTN","RAPM2",185,0)
 W:RAIO !,"Imaging Type(s): "
"RTN","RAPM2",186,0)
 I RATYP="S" S ^TMP($J,"RAPM",RAN)="Imaging Type(s): "
"RTN","RAPM2",187,0)
 D IMG
"RTN","RAPM2",188,0)
 S:RATYP="S" RAN=RAN+1
"RTN","RAPM2",189,0)
 ;
"RTN","RAPM2",190,0)
 ; Run date and time
"RTN","RAPM2",191,0)
 S NOW=$$NOW^XLFDT,NOW=$P(NOW,".",1)_"."_$E($P(NOW,".",2),1,4)
"RTN","RAPM2",192,0)
 W:RAIO !,"Run Date/Time: ",$$FMTE^XLFDT(NOW,"2P"),!
"RTN","RAPM2",193,0)
 I RATYP="S" S ^TMP($J,"RAPM",RAN)="Run Date/Time: "_$$FMTE^XLFDT(NOW,"2P"),RAN=RAN+1
"RTN","RAPM2",194,0)
 I RARAD D
"RTN","RAPM2",195,0)
 . W:RAIO !,"Primary Interpreting Staff Physician: ",$$GET1^DIQ(200,RARAD,.01),!
"RTN","RAPM2",196,0)
 . I RATYP="S" D
"RTN","RAPM2",197,0)
 .. S ^TMP($J,"RAPM",RAN)="",RAN=RAN+1
"RTN","RAPM2",198,0)
 .. S ^TMP($J,"RAPM",RAN)="Primary Interpreting Staff Physician: "_$$GET1^DIQ(200,RARAD,.01),RAN=RAN+1
"RTN","RAPM2",199,0)
 .. Q
"RTN","RAPM2",200,0)
 . Q
"RTN","RAPM2",201,0)
 I (RARPT="D"!(RARPT="B")),(RATYP'="S") D
"RTN","RAPM2",202,0)
 . S RASRT=$S(RASORT="C":"Case Number",RASORT="E":"Cateory of Exam",RASORT="I":"Imaging Type",RASORT="P":"Patient Name",RASORT="R":"Radiologist",RASORT="T":"Hrs to Transcription",RASORT="V":"Hrs to Verification",1:"")
"RTN","RAPM2",203,0)
 . W:RAIO !,"Sorted by: ",RASRT,?45,"Min. hours elasped to "_$S(RASORT="V":"Verification",1:"Transcription")_": "_RASINCE
"RTN","RAPM2",204,0)
 Q
"RTN","RAPM2",205,0)
DIV ; List selected Division
"RTN","RAPM2",206,0)
 Q:'$D(^TMP($J,"RA D-TYPE"))
"RTN","RAPM2",207,0)
 S RADIV="" F I=1:1 S RADIV=$O(^TMP($J,"RA D-TYPE",RADIV)) Q:RADIV=""  D
"RTN","RAPM2",208,0)
 . I $X'>(RAIOM-$L("Division(s): ")) D
"RTN","RAPM2",209,0)
 . . W:RAIO RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPM2",210,0)
 . . I RATYP="S" S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPM2",211,0)
 . I $X>(RAIOM-$L("Division(s): ")) D
"RTN","RAPM2",212,0)
 . . W:RAIO !?($X+$L("Division(s): "))
"RTN","RAPM2",213,0)
 . . I RATYP="S" S RAN=RAN+1,^TMP($J,"RAPM",RAN)="         "
"RTN","RAPM2",214,0)
 Q
"RTN","RAPM2",215,0)
IMG ; List selected Imaging Type(s)
"RTN","RAPM2",216,0)
 Q:'$D(^TMP($J,"RA I-TYPE"))
"RTN","RAPM2",217,0)
 ;N RALMAX,RALUSED,RATAIL,RALDENT
"RTN","RAPM2",218,0)
 S RALDENT=$L("Imaging Type(s): ")
"RTN","RAPM2",219,0)
 S RALMAX=RAIOM-RALDENT
"RTN","RAPM2",220,0)
 S RALUSED=0
"RTN","RAPM2",221,0)
 S RAIMG="" F J=1:1 S RAIMG=$O(^TMP($J,"RA I-TYPE",RAIMG)) Q:RAIMG=""  D
"RTN","RAPM2",222,0)
 . S RATAIL=$S($O(^TMP($J,"RA I-TYPE",RAIMG))]"":", ",1:"")
"RTN","RAPM2",223,0)
 . I (RALUSED+$L(RAIMG)+$L(RATAIL))>RALMAX D
"RTN","RAPM2",224,0)
 .. W:RAIO !?RALDENT
"RTN","RAPM2",225,0)
 .. I RATYP="S" S RAN=RAN+1,^TMP($J,"RAPM",RAN)="                 "
"RTN","RAPM2",226,0)
 .. S RALUSED=0
"RTN","RAPM2",227,0)
 .. Q
"RTN","RAPM2",228,0)
 . W:RAIO RAIMG_RATAIL
"RTN","RAPM2",229,0)
 . I RATYP="S" S ^TMP($J,"RAPM",RAN)=^TMP($J,"RAPM",RAN)_RAIMG_RATAIL
"RTN","RAPM2",230,0)
 . S RALUSED=RALUSED+$L(RAIMG)+$L(RATAIL)
"RTN","RAPM2",231,0)
 Q
"RTN","RASTEXT")
0^6^B28312092
"RTN","RASTEXT",1,0)
RASTEXT ;HISC/CAH,FPT,GJC AISC/TMP,TAC,RMO-Called by Status Tracking display,edit. Allow selection/edit of case if called from edit option ;7/16/04  07:50
"RTN","RASTEXT",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**48**;Mar 16, 1998
"RTN","RASTEXT",3,0)
 S RAED=1 ;If called from beginning of routine, allow case edit
"RTN","RASTEXT",4,0)
 ;If called at EN1, display exams by status but don't allow editing
"RTN","RASTEXT",5,0)
EN1 D SET^RAPSET1 I $D(XQUIT) K RAED,XQUIT Q
"RTN","RASTEXT",6,0)
 D HOME^%ZIS S:'$D(RAED) RAED=0 S (RACTR,RAORD,RAXIT)=0 K RASTAT,RADTI
"RTN","RASTEXT",7,0)
 N RADLOCS,RAQUIT,RATEMP,RATOTAL S (RATOTAL,X)=0
"RTN","RASTEXT",8,0)
 F  S X=$O(^RA(79.1,X)) Q:X'>0  D
"RTN","RASTEXT",9,0)
 . S Y=$G(^RA(79.1,X,0)),Y(6)=+$P(Y,U,6) Q:'Y(6)
"RTN","RASTEXT",10,0)
 . I $D(RACCESS(DUZ,"LOC",+X)),(Y(6)=+$O(^RA(79.2,"B",RAIMGTY,0))),($D(RACCESS(DUZ,"DIV",+RAMDIV,X))) D
"RTN","RASTEXT",11,0)
 .. S RATOTAL=RATOTAL+1,RATEMP=$P($G(^SC(+$P(Y,"^"),0)),"^")_"^"_X
"RTN","RASTEXT",12,0)
 .. Q
"RTN","RASTEXT",13,0)
 . Q
"RTN","RASTEXT",14,0)
 I 'RATOTAL D  D Q QUIT
"RTN","RASTEXT",15,0)
 . W !?5,"Your access to Imaging Locations is nonexistent."
"RTN","RASTEXT",16,0)
 . W !?5,"Contact your ADPAC for further assistance."
"RTN","RASTEXT",17,0)
 . Q
"RTN","RASTEXT",18,0)
 W !!?5,"Current Division: ",$P(^DIC(4,+RAMDIV,0),U,1)
"RTN","RASTEXT",19,0)
 W !?5,"Current Imaging Type: ",RAIMGTY,!
"RTN","RASTEXT",20,0)
 I RATOTAL=1 D
"RTN","RASTEXT",21,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="E" D ^DIR
"RTN","RASTEXT",22,0)
 . S:'+Y RAXIT=1 Q:RAXIT
"RTN","RASTEXT",23,0)
 . S ^TMP($J,"RADLOCS",$P(RATEMP,"^"),$P(RATEMP,"^",2))=""
"RTN","RASTEXT",24,0)
 . S RADLOCS($P(RATEMP,"^"),$P(RATEMP,"^",2))="",RAQUIT=0
"RTN","RASTEXT",25,0)
 . Q
"RTN","RASTEXT",26,0)
 I RAXIT D Q QUIT
"RTN","RASTEXT",27,0)
 K X,Y I RATOTAL>1 D
"RTN","RASTEXT",28,0)
 . N RAARRY,RADIC,RAUTIL
"RTN","RASTEXT",29,0)
 . S RADIC="^RA(79.1,",(RAARRY,RAUTIL)="RADLOCS",RADIC(0)="QEAFMZ"
"RTN","RASTEXT",30,0)
 . S RADIC("A")="Select the Location(s) you wish to track: "
"RTN","RASTEXT",31,0)
 . S RADIC("B")="All"
"RTN","RASTEXT",32,0)
 . S RADIC("S")="I $D(RACCESS(DUZ,""DIV"",+RAMDIV,+Y)),(+$P(^(0),""^"",6)=+$O(^RA(79.2,""B"",RAIMGTY,0)))"
"RTN","RASTEXT",33,0)
 . D EN1^RASELCT(.RADIC,RAUTIL,RAARRY)
"RTN","RASTEXT",34,0)
 . Q
"RTN","RASTEXT",35,0)
 I +$G(RAQUIT) D Q Q
"RTN","RASTEXT",36,0)
 K ^TMP($J,"RADLOCS")
"RTN","RASTEXT",37,0)
 S RAIMGTYI=$O(^RA(79.2,"B",RAIMGTY,0)) G Q:'RAIMGTYI
"RTN","RASTEXT",38,0)
 ; set up RASEQARR(order seq)=ien of file 72
"RTN","RASTEXT",39,0)
 ; if order seq is null, set it to -1, -2, etc., so each img typ gets
"RTN","RASTEXT",40,0)
 ; gets a different negative subscript to represent a null order seq
"RTN","RASTEXT",41,0)
 S X=0 F  S X=$O(^RADPT("AS",X)) Q:X'=+X  I $P($G(^RA(72,X,0)),U,7)=RAIMGTYI,$P(^(0),U,5)="Y" S RAX=$P(^(0),U,3) D:RAX=""  S RASEQARR(RAX)=X
"RTN","RASTEXT",42,0)
 . S RAX=$O(RASEQARR(""))
"RTN","RASTEXT",43,0)
 . I RAX>0 S RAX=-1 Q
"RTN","RASTEXT",44,0)
 . S:RAX<0 RAX=RAX-1
"RTN","RASTEXT",45,0)
 S RAORD=""
"RTN","RASTEXT",46,0)
 F  K ^TMP($J,"RASTEXT") S RAORD=$O(RASEQARR(RAORD)) Q:RAORD=""!(RAORD>8)  S RASTAT=RASEQARR(RAORD) I $D(^RA(72,+RASTAT,0)),$P(^(0),"^",5)="Y" D START I RACTR S RACTR=0 D SCRN Q:RAQ
"RTN","RASTEXT",47,0)
 I 'RACTR&('$D(RADTI)) W *7,!,"No incomplete statuses on file"
"RTN","RASTEXT",48,0)
 G Q
"RTN","RASTEXT",49,0)
START S (RACTR,RAQ)=0 F RADFN=0:0 S RADFN=$O(^RADPT("AS",RASTAT,RADFN)) Q:RADFN'>0  F RADTI=0:0 S RADTI=$O(^RADPT("AS",RASTAT,RADFN,RADTI)) Q:RADTI'>0  I $D(^RADPT(RADFN,"DT",RADTI,0)) S Y=^(0) D GETCN
"RTN","RASTEXT",50,0)
 Q
"RTN","RASTEXT",51,0)
GETCN Q:'$D(^RA(79.1,+$P(Y,"^",4),0))  ;If imaging loc is broken pointer
"RTN","RASTEXT",52,0)
 Q:'$D(RADLOCS($P($G(^SC(+$P($G(^RA(79.1,+$P(Y,"^",4),0)),"^"),0)),"^")))
"RTN","RASTEXT",53,0)
 F RACNI=0:0 S RACNI=$O(^RADPT("AS",RASTAT,RADFN,RADTI,RACNI)) Q:RACNI'>0  I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y(0)=^(0) D EXT
"RTN","RASTEXT",54,0)
 Q
"RTN","RASTEXT",55,0)
EXT F RAI=1:1 Q:'$D(^TMP($J,"RASTEXT",+Y,RAI))
"RTN","RASTEXT",56,0)
 S:$D(^XUSEC("RA MGR",DUZ))!(RAMDIV=+$P(Y,"^",3)) ^TMP($J,"RASTEXT",+Y,RAI)=RADFN_"^"_+Y(0)_"^"_$P(Y(0),"^",2)_"^"_$P(Y(0),"^",18),RACTR=1
"RTN","RASTEXT",57,0)
 Q
"RTN","RASTEXT",58,0)
 ;
"RTN","RASTEXT",59,0)
SCRN D HD F RADTI=0:0 Q:RAQ!(RADTI="")!(RAXIT)  S RADTI=$O(^TMP($J,"RASTEXT",RADTI)) Q:RADTI'>0  F I1=0:0 S I1=$O(^TMP($J,"RASTEXT",RADTI,I1)) Q:I1'>0!(RAXIT)  D:$$LMAX HD D WRT D:$$LMAX SELECT^RASTEXT1 Q:RAQ!(RADTI'>0)!(RAXIT)
"RTN","RASTEXT",60,0)
 Q:RAQ!(RAXIT)  D:$$LMAX HD
"RTN","RASTEXT",61,0)
 D SELECT^RASTEXT1 Q:RAQ!(RAXIT)
"RTN","RASTEXT",62,0)
 G SCRN:RADTI=0
"RTN","RASTEXT",63,0)
 Q
"RTN","RASTEXT",64,0)
 ;
"RTN","RASTEXT",65,0)
WRT I $P(RADTI,".")=DT S X=RADTI D TIME^RAUTL1 S RATI=X
"RTN","RASTEXT",66,0)
 I $P(RADTI,".")'=DT S RATI=$E(RADTI,4,5)_"/"_$E(RADTI,6,7)_"/"_$E(RADTI,2,3)
"RTN","RASTEXT",67,0)
 S RACTR=RACTR+1
"RTN","RASTEXT",68,0)
 W !,?1,$P(^TMP($J,"RASTEXT",RADTI,I1),"^",2),?10,$J(RATI,8),?20,$E($S($D(^DPT(+^TMP($J,"RASTEXT",RADTI,I1),0)):$P(^(0),"^"),1:"Unknown"),1,20),?42,$S($D(^RAMIS(71,+$P(^TMP($J,"RASTEXT",RADTI,I1),"^",3),0)):$E($P(^(0),"^"),1,25),1:"Unknown")
"RTN","RASTEXT",69,0)
 W:$D(^RA(78.6,+$P(^TMP($J,"RASTEXT",RADTI,I1),"^",4),0)) ?72,$E($P(^(0),"^"),1,8)
"RTN","RASTEXT",70,0)
 Q
"RTN","RASTEXT",71,0)
 ;
"RTN","RASTEXT",72,0)
HD N RADIVHD,RAGENTXT
"RTN","RASTEXT",73,0)
 S X=$H D NOW^RAUTL1 S RATIME=X,RASTOUT=$S($D(^RA(72,RASTAT,0)):$P(^(0),"^"),1:"")
"RTN","RASTEXT",74,0)
 S RALOC(0)=$P(RAMLC,"^"),RALOC(1)=$P($G(^RA(79.1,RALOC(0),0)),"^")
"RTN","RASTEXT",75,0)
 S RALOC=$P($G(^SC(RALOC(1),0)),"^"),RADIV=$P($G(^DIC(4,+RAMDIV,0)),"^")
"RTN","RASTEXT",76,0)
 S RADIVHD="Division: "_RADIV
"RTN","RASTEXT",77,0)
 S RAGENTXT="Exam Status Tracking Module"
"RTN","RASTEXT",78,0)
 W @IOF,!?1,RAGENTXT,?39,RADIVHD
"RTN","RASTEXT",79,0)
 W !?1,"Date    : ",$E(DT,4,5),"/",$E(DT,6,7),"/",$E(DT,2,3),"  ",RATIME,?39,"Status  : ",RASTOUT
"RTN","RASTEXT",80,0)
 W !?1,"Locations: " S X="" F  S X=$O(RADLOCS(X)) Q:X']""  W:($X+$L(X))>IOM !?($X+5) W X W:$O(RADLOCS(X))'="" ?($X+5)
"RTN","RASTEXT",81,0)
 W !!?1,"Case #",?10,"Date",?20,"Patient",?42,"Procedure",?72,"Equip/Rm",!
"RTN","RASTEXT",82,0)
 W ?1,"------",?10,"----",?20,"-------",?42,"---------",?72,"--------"
"RTN","RASTEXT",83,0)
 Q
"RTN","RASTEXT",84,0)
Q ; Kill and quit
"RTN","RASTEXT",85,0)
 K %,%H,%W,%Y,%Y1,A,C,DIC,I,I1,ORX,POP,RACNI,RACNT,RACONTIN,RACS,RACTR,RADA,RADATE,RADFN,RADIV,RADTI,RAED,RAJ1,RAI,RAIMAGE,RALOC,RAMIS,RANODE,RAORD,RAPRIT,RAQ,RASTAT,RASTOUT,RATI,RATICTR,RATIME,RATXTLP,RAX,RAXIT,SDCLST,X,XQUIT,Y
"RTN","RASTEXT",86,0)
 K RASEQARR
"RTN","RASTEXT",87,0)
 K ^TMP($J,"RASTEXT"),^TMP($J,"RAEX")
"RTN","RASTEXT",88,0)
 D KILLVAR^RAUTL2,KMV^RAUTL15
"RTN","RASTEXT",89,0)
 K DIOV,RAOR,X1
"RTN","RASTEXT",90,0)
 Q
"RTN","RASTEXT",91,0)
LMAX() ;
"RTN","RASTEXT",92,0)
 Q:($Y+4)>IOSL 1
"RTN","RASTEXT",93,0)
 Q 0
"VER")
8.0^22
**END**
**END**
