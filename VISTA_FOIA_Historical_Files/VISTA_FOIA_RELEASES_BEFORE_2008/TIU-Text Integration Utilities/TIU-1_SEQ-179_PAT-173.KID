Released TIU*1*173 SEQ #179
Extracted from mail message
**KIDS**:TIU*1.0*173^

**INSTALL NAME**
TIU*1.0*173
"BLD",16862,0)
TIU*1.0*173^TEXT INTEGRATION UTILITIES^0^3050125^y
"BLD",16862,1,0)
^^2^2^3041018^^^
"BLD",16862,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",16862,1,2,0)
under patch TIU*1.0*173.
"BLD",16862,4,0)
^9.64PA^^
"BLD",16862,"INI")
PREP^TIUADCL1
"BLD",16862,"KRN",0)
^9.67PA^8989.52^19
"BLD",16862,"KRN",.4,0)
.4
"BLD",16862,"KRN",.401,0)
.401
"BLD",16862,"KRN",.402,0)
.402
"BLD",16862,"KRN",.403,0)
.403
"BLD",16862,"KRN",.5,0)
.5
"BLD",16862,"KRN",.84,0)
.84
"BLD",16862,"KRN",3.6,0)
3.6
"BLD",16862,"KRN",3.8,0)
3.8
"BLD",16862,"KRN",9.2,0)
9.2
"BLD",16862,"KRN",9.8,0)
9.8
"BLD",16862,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",16862,"KRN",9.8,"NM",1,0)
TIUADCL^^0^B69967595
"BLD",16862,"KRN",9.8,"NM",2,0)
TIUADCL1^^0^B36340142
"BLD",16862,"KRN",9.8,"NM",3,0)
TIUSRVR1^^0^B35264342
"BLD",16862,"KRN",9.8,"NM",4,0)
TIUSROI^^0^B71551766
"BLD",16862,"KRN",9.8,"NM",5,0)
TIUPUTS^^0^B32898133
"BLD",16862,"KRN",9.8,"NM",6,0)
TIURD^^0^B39906196
"BLD",16862,"KRN",9.8,"NM",7,0)
TIUPUTC^^0^B30507838
"BLD",16862,"KRN",9.8,"NM",8,0)
TIUBR^^0^B45272130
"BLD",16862,"KRN",9.8,"NM",9,0)
TIUSROI1^^0^B43726026
"BLD",16862,"KRN",9.8,"NM",10,0)
TIUSRVG^^0^B26888828
"BLD",16862,"KRN",9.8,"NM","B","TIUADCL",1)

"BLD",16862,"KRN",9.8,"NM","B","TIUADCL1",2)

"BLD",16862,"KRN",9.8,"NM","B","TIUBR",8)

"BLD",16862,"KRN",9.8,"NM","B","TIUPUTC",7)

"BLD",16862,"KRN",9.8,"NM","B","TIUPUTS",5)

"BLD",16862,"KRN",9.8,"NM","B","TIURD",6)

"BLD",16862,"KRN",9.8,"NM","B","TIUSROI",4)

"BLD",16862,"KRN",9.8,"NM","B","TIUSROI1",9)

"BLD",16862,"KRN",9.8,"NM","B","TIUSRVG",10)

"BLD",16862,"KRN",9.8,"NM","B","TIUSRVR1",3)

"BLD",16862,"KRN",19,0)
19
"BLD",16862,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",16862,"KRN",19,"NM",1,0)
TIU MAIN MENU MGR^^2
"BLD",16862,"KRN",19,"NM",2,0)
TIU UNK ADDENDA MENU^^0
"BLD",16862,"KRN",19,"NM","B","TIU MAIN MENU MGR",1)

"BLD",16862,"KRN",19,"NM","B","TIU UNK ADDENDA MENU",2)

"BLD",16862,"KRN",19.1,0)
19.1
"BLD",16862,"KRN",101,0)
101
"BLD",16862,"KRN",101,"NM",0)
^9.68A^8^8
"BLD",16862,"KRN",101,"NM",1,0)
TIU UNK ADDENDA ATTACH MENU^^0
"BLD",16862,"KRN",101,"NM",2,0)
TIU UNK ADDENDA ATTACH PARENT^^0
"BLD",16862,"KRN",101,"NM",3,0)
TIU UNK ADDENDA BROWSE^^0
"BLD",16862,"KRN",101,"NM",4,0)
TIU UNK ADDENDA CHANGE VIEW^^0
"BLD",16862,"KRN",101,"NM",5,0)
TIU UNK ADDENDA DETAILED DISPLAY^^0
"BLD",16862,"KRN",101,"NM",6,0)
TIU UNK ADDENDA FIND PARENT^^0
"BLD",16862,"KRN",101,"NM",7,0)
TIU UNK ADDENDA MENU^^0
"BLD",16862,"KRN",101,"NM",8,0)
TIU UNK ADDENDA SELECT^^0
"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA ATTACH MENU",1)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA ATTACH PARENT",2)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA BROWSE",3)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA CHANGE VIEW",4)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA DETAILED DISPLAY",5)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA FIND PARENT",6)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA MENU",7)

"BLD",16862,"KRN",101,"NM","B","TIU UNK ADDENDA SELECT",8)

"BLD",16862,"KRN",409.61,0)
409.61
"BLD",16862,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",16862,"KRN",409.61,"NM",1,0)
TIU UNK ADDENDA CLEANUP^^0
"BLD",16862,"KRN",409.61,"NM",2,0)
TIU UNK ADDENDA ATTACH^^0
"BLD",16862,"KRN",409.61,"NM","B","TIU UNK ADDENDA ATTACH",2)

"BLD",16862,"KRN",409.61,"NM","B","TIU UNK ADDENDA CLEANUP",1)

"BLD",16862,"KRN",771,0)
771
"BLD",16862,"KRN",870,0)
870
"BLD",16862,"KRN",8989.51,0)
8989.51
"BLD",16862,"KRN",8989.52,0)
8989.52
"BLD",16862,"KRN",8994,0)
8994
"BLD",16862,"KRN","B",.4,.4)

"BLD",16862,"KRN","B",.401,.401)

"BLD",16862,"KRN","B",.402,.402)

"BLD",16862,"KRN","B",.403,.403)

"BLD",16862,"KRN","B",.5,.5)

"BLD",16862,"KRN","B",.84,.84)

"BLD",16862,"KRN","B",3.6,3.6)

"BLD",16862,"KRN","B",3.8,3.8)

"BLD",16862,"KRN","B",9.2,9.2)

"BLD",16862,"KRN","B",9.8,9.8)

"BLD",16862,"KRN","B",19,19)

"BLD",16862,"KRN","B",19.1,19.1)

"BLD",16862,"KRN","B",101,101)

"BLD",16862,"KRN","B",409.61,409.61)

"BLD",16862,"KRN","B",771,771)

"BLD",16862,"KRN","B",870,870)

"BLD",16862,"KRN","B",8989.51,8989.51)

"BLD",16862,"KRN","B",8989.52,8989.52)

"BLD",16862,"KRN","B",8994,8994)

"BLD",16862,"QUES",0)
^9.62^^
"BLD",16862,"REQB",0)
^9.611^2^2
"BLD",16862,"REQB",1,0)
TIU*1.0*109^2
"BLD",16862,"REQB",2,0)
TIU*1.0*187^2
"BLD",16862,"REQB","B","TIU*1.0*109",1)

"BLD",16862,"REQB","B","TIU*1.0*187",2)

"INI")
PREP^TIUADCL1
"KRN",19,9686,-1)
2^1
"KRN",19,9686,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^1380^^^^^^y^362^^1^^^1
"KRN",19,9686,10,0)
^19.01IP^24^24
"KRN",19,9686,10,24,0)
12065^9
"KRN",19,9686,10,24,"^")
TIU UNK ADDENDA MENU
"KRN",19,9686,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,12065,-1)
0^2
"KRN",19,12065,0)
TIU UNK ADDENDA MENU^UNKNOWN Addenda Cleanup^^R^^^^^^^^TEXT INTEGRATION UTILITIES^^^
"KRN",19,12065,15)

"KRN",19,12065,25)
EN^TIUADCL
"KRN",19,12065,"U")
UNKNOWN ADDENDA CLEANUP
"KRN",101,5514,-1)
0^7
"KRN",101,5514,0)
TIU UNK ADDENDA MENU^Unknown Addenda Menu^^M^^^^^^^^
"KRN",101,5514,4)
40
"KRN",101,5514,10,0)
^101.01PA^4^4
"KRN",101,5514,10,1,0)
5515^^1^
"KRN",101,5514,10,1,"^")
TIU UNK ADDENDA BROWSE
"KRN",101,5514,10,2,0)
5517^^2^
"KRN",101,5514,10,2,"^")
TIU UNK ADDENDA DETAILED DISPLAY
"KRN",101,5514,10,3,0)
5518^^3^
"KRN",101,5514,10,3,"^")
TIU UNK ADDENDA CHANGE VIEW
"KRN",101,5514,10,4,0)
5519^^4^
"KRN",101,5514,10,4,"^")
TIU UNK ADDENDA FIND PARENT
"KRN",101,5514,15)
D EXIT^TIUADCL
"KRN",101,5514,26)
D SHOW^VALM
"KRN",101,5514,28)
Select Action: 
"KRN",101,5514,99)
59906,41123
"KRN",101,5515,-1)
0^3
"KRN",101,5515,0)
TIU UNK ADDENDA BROWSE^Browse^^A^^^^^^^^
"KRN",101,5515,15)
S VALMBCK="R"
"KRN",101,5515,20)
D SELECT^TIUADCL("BROWSE")
"KRN",101,5515,99)
59906,41123
"KRN",101,5516,-1)
0^8
"KRN",101,5516,0)
TIU UNK ADDENDA SELECT^^^A^^^^^^^^
"KRN",101,5516,15)

"KRN",101,5516,20)
D SELECT^TIUADCL("ACTIONS")
"KRN",101,5517,-1)
0^5
"KRN",101,5517,0)
TIU UNK ADDENDA DETAILED DISPLAY^Detailed Display^^A^^^^^^^^
"KRN",101,5517,15)
S VALMBCK="R"
"KRN",101,5517,20)
D SELECT^TIUADCL("DETDISP")
"KRN",101,5517,99)
59906,41123
"KRN",101,5518,-1)
0^4
"KRN",101,5518,0)
TIU UNK ADDENDA CHANGE VIEW^Change View^^A^^^^^^^^
"KRN",101,5518,15)
S VALMBCK="R"
"KRN",101,5518,20)
D CHNGVIEW^TIUADCL
"KRN",101,5518,99)
59906,41123
"KRN",101,5519,-1)
0^6
"KRN",101,5519,0)
TIU UNK ADDENDA FIND PARENT^Find Parent^^A^^^^^^^^
"KRN",101,5519,15)

"KRN",101,5519,20)
D SELECT^TIUADCL("FNDPRNT")
"KRN",101,5519,99)
59906,41123
"KRN",101,5520,-1)
0^1
"KRN",101,5520,0)
TIU UNK ADDENDA ATTACH MENU^Operation Report Menu^^M^^^^^^^^
"KRN",101,5520,4)
40
"KRN",101,5520,10,0)
^101.01PA^4^4
"KRN",101,5520,10,1,0)
5515^^1^
"KRN",101,5520,10,1,"^")
TIU UNK ADDENDA BROWSE
"KRN",101,5520,10,2,0)
5517^^2^
"KRN",101,5520,10,2,"^")
TIU UNK ADDENDA DETAILED DISPLAY
"KRN",101,5520,10,3,0)
5518^^3^
"KRN",101,5520,10,3,"^")
TIU UNK ADDENDA CHANGE VIEW
"KRN",101,5520,10,4,0)
5521^^4^
"KRN",101,5520,10,4,"^")
TIU UNK ADDENDA ATTACH PARENT
"KRN",101,5520,15)
D EXIT^TIUADCL1
"KRN",101,5520,26)
D SHOW^VALM
"KRN",101,5520,99)
59906,41123
"KRN",101,5521,-1)
0^2
"KRN",101,5521,0)
TIU UNK ADDENDA ATTACH PARENT^Attach to Parent^^A^^^^^^^^
"KRN",101,5521,15)

"KRN",101,5521,20)
D SELECT^TIUADCL("ATTACH^TIUADCL1")
"KRN",101,5521,99)
59906,41123
"KRN",409.61,634,-1)
0^1
"KRN",409.61,634,0)
TIU UNK ADDENDA CLEANUP^1^^80^4^20^1^1^^TIU UNK ADDENDA MENU^TIU/Surgery Cleanup^1^^1
"KRN",409.61,634,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,634,"COL",0)
^409.621^6^5
"KRN",409.61,634,"COL",1,0)
Patient^6^7^Patient
"KRN",409.61,634,"COL",3,0)
Status^62^6^Status
"KRN",409.61,634,"COL",4,0)
Has Parent?^74^6^Parent
"KRN",409.61,634,"COL",5,0)
Entry DT^52^8^Entry DT
"KRN",409.61,634,"COL",6,0)
Doc IEN^40^7^Doc IEN
"KRN",409.61,634,"COL","B","Doc IEN",6)

"KRN",409.61,634,"COL","B","Entry DT",5)

"KRN",409.61,634,"COL","B","Has Parent?",4)

"KRN",409.61,634,"COL","B","Patient",1)

"KRN",409.61,634,"COL","B","Status",3)

"KRN",409.61,634,"FNL")
D EXIT^TIUADCL
"KRN",409.61,634,"HDR")
D HDR^TIUADCL
"KRN",409.61,634,"HLP")
D HELP^TIUADCL
"KRN",409.61,634,"INIT")
D INIT^TIUADCL
"KRN",409.61,635,-1)
0^2
"KRN",409.61,635,0)
TIU UNK ADDENDA ATTACH^1^^80^4^20^0^1^^TIU UNK ADDENDA ATTACH MENU^Operation Reports^1^^1
"KRN",409.61,635,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,635,"COL",0)
^409.621^6^5
"KRN",409.61,635,"COL",1,0)
Patient^6^7^Patient
"KRN",409.61,635,"COL",3,0)
Status^62^6^Status
"KRN",409.61,635,"COL",4,0)
Case #^75^6^Case #
"KRN",409.61,635,"COL",5,0)
Entry DT^52^8^Entry DT
"KRN",409.61,635,"COL",6,0)
Doc IEN^40^7^Doc IEN
"KRN",409.61,635,"COL","B","Case #",4)

"KRN",409.61,635,"COL","B","Doc IEN",6)

"KRN",409.61,635,"COL","B","Entry DT",5)

"KRN",409.61,635,"COL","B","Patient",1)

"KRN",409.61,635,"COL","B","Status",3)

"KRN",409.61,635,"FNL")
D EXIT^TIUADCL1
"KRN",409.61,635,"HDR")
D HDR^TIUADCL1
"KRN",409.61,635,"HLP")
D HELP^TIUADCL1
"KRN",409.61,635,"INIT")
D INIT^TIUADCL1
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",362,-1)
1^1
"PKG",362,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",362,20,0)
^9.402P^^
"PKG",362,22,0)
^9.49I^1^1
"PKG",362,22,1,0)
1.0^2970620^2970819^64
"PKG",362,22,1,"PAH",1,0)
173^3050125^1380
"PKG",362,22,1,"PAH",1,1,0)
^^2^2^3050125
"PKG",362,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",362,22,1,"PAH",1,1,2,0)
under patch TIU*1.0*173.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","TIUADCL")
0^1^B69967595
"RTN","TIUADCL",1,0)
TIUADCL ; SLC/AJB - UNK Addenda Cleanup ; 10/01/04
"RTN","TIUADCL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**173**;Jun 20, 1997
"RTN","TIUADCL",3,0)
 ;
"RTN","TIUADCL",4,0)
 ; Cleanup Utility for OPERATION REPORT addenda.
"RTN","TIUADCL",5,0)
 ; Finds parentless/unknown addenda and attaches to user
"RTN","TIUADCL",6,0)
 ; selected parent.
"RTN","TIUADCL",7,0)
 ;
"RTN","TIUADCL",8,0)
 Q
"RTN","TIUADCL",9,0)
EN ; main entry point for TIU UNK ADDENDA CLEANUP
"RTN","TIUADCL",10,0)
 N DTR1,TIUQUIT
"RTN","TIUADCL",11,0)
 D DTRANGE(.DTR1) Q:$D(TIUQUIT)
"RTN","TIUADCL",12,0)
 D EN^VALM("TIU UNK ADDENDA CLEANUP")
"RTN","TIUADCL",13,0)
 Q
"RTN","TIUADCL",14,0)
EXIT ;
"RTN","TIUADCL",15,0)
 D XQORM
"RTN","TIUADCL",16,0)
 Q
"RTN","TIUADCL",17,0)
HDR ; sets header
"RTN","TIUADCL",18,0)
 N HDR
"RTN","TIUADCL",19,0)
 S HDR="UNKNOWN ADDENDA from "_$$FMTE^XLFDT(DTR1("BEGDT"),"D")_" to "_$$FMTE^XLFDT(DTR1("ENDDT"),"D")
"RTN","TIUADCL",20,0)
 S VALMHDR(1)=$$SETSTR^VALM1(HDR,"",(IOM-$L(HDR))/2,$L(HDR))
"RTN","TIUADCL",21,0)
 D XQORM
"RTN","TIUADCL",22,0)
 Q
"RTN","TIUADCL",23,0)
HELP ; help code
"RTN","TIUADCL",24,0)
 N DIR
"RTN","TIUADCL",25,0)
 I X="?" S DIR("A")="Enter RETURN to continue or '^' to exit",DIR(0)="E"
"RTN","TIUADCL",26,0)
 D FULL^VALM1
"RTN","TIUADCL",27,0)
 W !!,"The following actions are available:"
"RTN","TIUADCL",28,0)
 W !,"Browse a Document  - View a selected document (if authorized)"
"RTN","TIUADCL",29,0)
 W !,"Change View        - Modify search criteria"
"RTN","TIUADCL",30,0)
 W !,"Detailed Display   - View detailed display of a document (if authorized)"
"RTN","TIUADCL",31,0)
 W !,"Find Parent        - Find available OPERATION REPORTS to assign as parent",!
"RTN","TIUADCL",32,0)
 I $D(DIR("A")) D ^DIR
"RTN","TIUADCL",33,0)
 S VALMBCK="R"
"RTN","TIUADCL",34,0)
 Q
"RTN","TIUADCL",35,0)
INIT ; finds unknown addenda & creates list
"RTN","TIUADCL",36,0)
 N ADDENDUM,STRTDT,TIUDA,TIU
"RTN","TIUADCL",37,0)
 S TIU("IOCUOFF")=$C(27)_"[?25l",TIU("IOCUON")=$C(27)_"[?25h"
"RTN","TIUADCL",38,0)
 W TIU("IOCUOFF")
"RTN","TIUADCL",39,0)
 W !!,"Searching for the documents."
"RTN","TIUADCL",40,0)
 S ADDENDUM=$$CHKFILE(8925.1,"ADDENDUM","I $P(^(0),U,4)=""DOC"""),TIUDA="",STRTDT=DTR1("BEGDT"),VALMCNT=0
"RTN","TIUADCL",41,0)
 F  S STRTDT=$O(^TIU(8925,"F",STRTDT)) Q:STRTDT=""!(STRTDT>DTR1("ENDDT"))  F  S TIUDA=$O(^TIU(8925,"F",STRTDT,TIUDA)) Q:TIUDA=""  I +$G(^TIU(8925,TIUDA,0))=ADDENDUM,'+$P($G(^TIU(8925,TIUDA,0)),U,6) D
"RTN","TIUADCL",42,0)
 . N DISPLAY
"RTN","TIUADCL",43,0)
 . S VALMCNT=VALMCNT+1 W:VALMCNT#3=0 "."
"RTN","TIUADCL",44,0)
 . S DISPLAY=$$SETSTR^VALM1(VALMCNT,"",1,4)
"RTN","TIUADCL",45,0)
 . S DISPLAY=$$SETSTR^VALM1($$PATIENT^TIU144($P($G(^TIU(8925,TIUDA,0)),U,2)),DISPLAY,6,38)
"RTN","TIUADCL",46,0)
 . S DISPLAY=$$SETSTR^VALM1(TIUDA,DISPLAY,40,50)
"RTN","TIUADCL",47,0)
 . S DISPLAY=$$SETSTR^VALM1($$FDATE^VALM1($$GET1^DIQ(8925,TIUDA,1201,"I")),DISPLAY,52,62)
"RTN","TIUADCL",48,0)
 . S DISPLAY=$$SETSTR^VALM1($$GET1^DIQ(8925,TIUDA,.05),DISPLAY,62,73)
"RTN","TIUADCL",49,0)
 . S DISPLAY=$$SETSTR^VALM1("NO",DISPLAY,74,76)
"RTN","TIUADCL",50,0)
 . D SET^VALM10(VALMCNT,DISPLAY,TIUDA)
"RTN","TIUADCL",51,0)
 I VALMCNT=0 D
"RTN","TIUADCL",52,0)
 . D SET^VALM10(2,$$SETSTR^VALM1("No records found to satisfy search criteria.","",(IOM-$L("No records found to satisfy search criteria."))/2,$L("No records found to satisfy search criteria.")),0)
"RTN","TIUADCL",53,0)
 Q
"RTN","TIUADCL",54,0)
XQORM ; default action for list manager
"RTN","TIUADCL",55,0)
 S XQORM("#")=$O(^ORD(101,"B","TIU UNK ADDENDA SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUADCL",56,0)
 Q
"RTN","TIUADCL",57,0)
ACTIONS ; user selectable actions
"RTN","TIUADCL",58,0)
 N ACTION,TIUCONT
"RTN","TIUADCL",59,0)
 D   I ACTION=-1 S VALMBCK="R" Q
"RTN","TIUADCL",60,0)
 . N DIR,DIRUT,POP,X,Y
"RTN","TIUADCL",61,0)
 . S DIR(0)=$S(VALM("TITLE")="TIU/Surgery Cleanup":"SA^1:Browse Document;2:Detailed Display;3:Find Parent",1:"SA^1:Browse Document;2:Detailed Display;3:Attach to Parent")
"RTN","TIUADCL",62,0)
 . S DIR("A")="Select Action: "
"RTN","TIUADCL",63,0)
 . S DIR("B")=$S(VALM("TITLE")="TIU/Surgery Cleanup":"Find Parent",1:"Attach to Parent")
"RTN","TIUADCL",64,0)
 . S DIR("L",1)="1.   Browse a Document"
"RTN","TIUADCL",65,0)
 . S DIR("L",2)=$S(VALM("TITLE")="TIU/Surgery Cleanup":"2.   Detailed Display                   3.   Find Parent",1:"2.   Detailed Display                   3.   Attach to Parent")
"RTN","TIUADCL",66,0)
 . S DIR("L",4)=""
"RTN","TIUADCL",67,0)
 . S DIR("L")="Enter selection by typing the name, number, or abbreviation"
"RTN","TIUADCL",68,0)
 . S DIR("?",1)="The following actions are available:"
"RTN","TIUADCL",69,0)
 . S DIR("?",2)=""
"RTN","TIUADCL",70,0)
 . S DIR("?",3)="Browse a Document  - View a selected document (if authorized)"
"RTN","TIUADCL",71,0)
 . S DIR("?",4)="Detailed Display   - Detailed View of a selected document (if authorized)"
"RTN","TIUADCL",72,0)
 . S DIR("?")=$S(VALM("TITLE")="TIU/Surgery Cleanup":"Find Parent        - Find OPERATION REPORT to attach as parent",1:"Attach to Parent   - Attach selected addenda to parent")
"RTN","TIUADCL",73,0)
 . F  D ^DIR D  Q:$G(TIUCONT)!$D(DIRUT)
"RTN","TIUADCL",74,0)
 . . I VALM("TITLE")="Operation Reports",$$MULTI("TIUDOCS")>1,+Y=3 D  Q
"RTN","TIUADCL",75,0)
 . . . W !!,"You may only attach addenda to one parent at a time."
"RTN","TIUADCL",76,0)
 . . . W !,"Select only one parent for this action.",!
"RTN","TIUADCL",77,0)
 . . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",78,0)
 . . I $$MULTI("TIUDOCS")>1,(+Y=1!(+Y=2)) D  Q
"RTN","TIUADCL",79,0)
 . . . W !!,"You may only view one document at a time."
"RTN","TIUADCL",80,0)
 . . . W !,"Select only one document for this action.",!
"RTN","TIUADCL",81,0)
 . . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",82,0)
 . . S TIUCONT=1
"RTN","TIUADCL",83,0)
 . I VALM("TITLE")="TIU/Surgery Cleanup" S ACTION=$S(+Y=1:"BROWSE",+Y=2:"DETDISP",+Y=3:"FNDPRNT",Y=U:-1,1:-1)
"RTN","TIUADCL",84,0)
 . E  S ACTION=$S(+Y=1:"BROWSE",+Y=2:"DETDISP",+Y=3:"ATTACH^TIUADCL1",Y=U:-1,1:-1)
"RTN","TIUADCL",85,0)
 I $G(TIUCONT)=1 D @ACTION
"RTN","TIUADCL",86,0)
 S VALMBCK=$S(ACTION="ATTACH^TIUADCL1":"Q",1:"R")
"RTN","TIUADCL",87,0)
 Q
"RTN","TIUADCL",88,0)
BROWSE ; browse document
"RTN","TIUADCL",89,0)
 N TIUDA S TIUDA=+$$ONEDOC()
"RTN","TIUADCL",90,0)
 D EN^VALM("TIU BROWSE FOR READ ONLY")
"RTN","TIUADCL",91,0)
 Q
"RTN","TIUADCL",92,0)
CHKFILE(FILE,NAME,SCREEN) ; checks entry in file and returns IEN
"RTN","TIUADCL",93,0)
 N DIC,X,Y S DIC=FILE,DIC(0)="X",DIC("S")=$G(SCREEN),X=NAME D ^DIC
"RTN","TIUADCL",94,0)
 Q +Y
"RTN","TIUADCL",95,0)
CHNGVIEW ; allows user to change search parameters
"RTN","TIUADCL",96,0)
 D FULL^VALM1
"RTN","TIUADCL",97,0)
 W @IOF
"RTN","TIUADCL",98,0)
 I VALM("TITLE")="TIU/Surgery Cleanup" D  I $D(TIUQUIT) S VALMBCK="R" Q
"RTN","TIUADCL",99,0)
 . D DTRANGE(.DTR1) Q:$D(TIUQUIT)
"RTN","TIUADCL",100,0)
 . D CLEAN^VALM10,INIT,HDR S VALMBG=1
"RTN","TIUADCL",101,0)
 I VALM("TITLE")="Operation Reports" D  I $D(TIUQUIT) S VALMBCK="R" Q
"RTN","TIUADCL",102,0)
 . D DTRANGE(.DTR2) Q:$D(TIUQUIT)
"RTN","TIUADCL",103,0)
 . D CLEAN^VALM10,INIT^TIUADCL1,HDR^TIUADCL1 S VALMBG=1
"RTN","TIUADCL",104,0)
 Q
"RTN","TIUADCL",105,0)
DATE(TIUDT,TIUSEQ) ; if date is year entry only, appends Jan 01/Dec 31@2400 respectively
"RTN","TIUADCL",106,0)
 I TIUDT["0000" S TIUDT=TIUDT/10000,TIUDT=TIUDT_$S(TIUSEQ=1:"0101",TIUSEQ=2:"1231")
"RTN","TIUADCL",107,0)
 I TIUSEQ=2 S TIUDT=TIUDT_".24"
"RTN","TIUADCL",108,0)
 Q TIUDT
"RTN","TIUADCL",109,0)
DTRANGE(DTRANGE) ; prompts user for date range input
"RTN","TIUADCL",110,0)
 N %DT,CNT,POP,X,Y
"RTN","TIUADCL",111,0)
 S %DT="AE",%DT(0)=$$NOW^XLFDT*-1
"RTN","TIUADCL",112,0)
 W @IOF
"RTN","TIUADCL",113,0)
 F CNT=1:1:2 D
"RTN","TIUADCL",114,0)
 . S %DT("A")=$S(CNT=1:"START WITH REFERENCE DATE:  ",CNT=2:"     GO TO REFERENCE DATE:  ")
"RTN","TIUADCL",115,0)
 . S %DT("B")=$S(CNT=1:"Jan 01, 2003",CNT=2:$P($$HTE^XLFDT($H),"@"))
"RTN","TIUADCL",116,0)
 . D ^%DT
"RTN","TIUADCL",117,0)
 . I Y=-1 S CNT=2,TIUQUIT=1 Q
"RTN","TIUADCL",118,0)
 . I CNT=1 S DTRANGE("BEGDT")=$$DATE(Y,CNT),%DT(0)=DTRANGE("BEGDT") Q
"RTN","TIUADCL",119,0)
 . S DTRANGE("ENDDT")=$$DATE(Y,CNT),X=$P($$NOW^XLFDT,".")_".24" I DTRANGE("ENDDT")>X S CNT=1 W !!,?42,"Future dates are not allowed.",!
"RTN","TIUADCL",120,0)
 Q
"RTN","TIUADCL",121,0)
DETDISP ; detailed display
"RTN","TIUADCL",122,0)
 N D0,DIROUT,RSTRCTD,TIUDA,TIUD,TIUDATA,TIUGDATA,TIUSEL,TIUI,TIUQUIT,Y
"RTN","TIUADCL",123,0)
 S TIUDA=+$$ONEDOC()
"RTN","TIUADCL",124,0)
 D
"RTN","TIUADCL",125,0)
 . N TIUVIEW
"RTN","TIUADCL",126,0)
 . D CLEAR^VALM1
"RTN","TIUADCL",127,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUADCL",128,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIUADCL",129,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIUADCL",130,0)
 . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",131,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIUADCL",132,0)
 . I RSTRCTD D  Q
"RTN","TIUADCL",133,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIUADCL",134,0)
 . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",135,0)
 . D EN^TIUAUDIT
"RTN","TIUADCL",136,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIUADCL",137,0)
 K VALMY S VALMBCK="R"
"RTN","TIUADCL",138,0)
 Q
"RTN","TIUADCL",139,0)
FNDPRNT ; executes LM for TIU UNK ADDENDA ATTACH
"RTN","TIUADCL",140,0)
 N PARENT,TIUDISP,TIUTMP
"RTN","TIUADCL",141,0)
 D EN^TIUADCL1
"RTN","TIUADCL",142,0)
 S TIUTMP=""
"RTN","TIUADCL",143,0)
 F  S TIUTMP=$O(TIUDOCS(TIUTMP)) Q:TIUTMP=""  D
"RTN","TIUADCL",144,0)
 . S TIUDISP=@VALMAR@(TIUTMP,0)
"RTN","TIUADCL",145,0)
 . S PARENT=+$P($G(^TIU(8925,TIUDOCS(TIUTMP),0)),U,6)
"RTN","TIUADCL",146,0)
 . S TIUDISP=$$SETSTR^VALM1($S(PARENT=0:"NO",PARENT>0:"#"_PARENT),TIUDISP,74,80)
"RTN","TIUADCL",147,0)
 . D SET^VALM10(TIUTMP,TIUDISP,TIUDOCS(TIUTMP))
"RTN","TIUADCL",148,0)
 D RE^VALM4
"RTN","TIUADCL",149,0)
 Q
"RTN","TIUADCL",150,0)
MULTI(TIUCHK) ;
"RTN","TIUADCL",151,0)
 N TIUCNT,TIUTMP
"RTN","TIUADCL",152,0)
 S TIUCNT=0,TIUTMP=""
"RTN","TIUADCL",153,0)
 F  S TIUTMP=$O(@TIUCHK@(TIUTMP)) Q:TIUTMP=""  S TIUCNT=TIUCNT+1
"RTN","TIUADCL",154,0)
 Q TIUCNT
"RTN","TIUADCL",155,0)
ONEDOC() ;
"RTN","TIUADCL",156,0)
 N TIUTMP
"RTN","TIUADCL",157,0)
 S TIUTMP=""
"RTN","TIUADCL",158,0)
 F  S TIUTMP=$O(TIUDOCS(TIUTMP)) Q:+TIUTMP
"RTN","TIUADCL",159,0)
 Q TIUDOCS(TIUTMP)
"RTN","TIUADCL",160,0)
SELECT(ACTION) ; selects document(s) and calls ACTION
"RTN","TIUADCL",161,0)
 N TIUDOCS,TIUSEL,TIUQUIT
"RTN","TIUADCL",162,0)
 D FULL^VALM1
"RTN","TIUADCL",163,0)
 I VALMCNT=0 W !,"No documents to select." H 3 Q
"RTN","TIUADCL",164,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUADCL",165,0)
 I TIUSEL="" D  Q:$D(TIUQUIT)
"RTN","TIUADCL",166,0)
 . I VALMLST=1 S TIUDOCS(1)=$O(@VALMAR@("IDX",1,"")) Q
"RTN","TIUADCL",167,0)
 . N DIR,X,Y
"RTN","TIUADCL",168,0)
 . S DIR("A")="Select Document(s): (1-"_VALMLST_") "
"RTN","TIUADCL",169,0)
 . S DIR(0)="LAC^1:"_VALMLST
"RTN","TIUADCL",170,0)
 . D ^DIR I $D(DIRUT)!(Y=U) S TIUQUIT=1 Q
"RTN","TIUADCL",171,0)
 . S TIUSEL=Y(0)
"RTN","TIUADCL",172,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUADCL",173,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  D
"RTN","TIUADCL",174,0)
 . N TIUCNT
"RTN","TIUADCL",175,0)
 . I $P(TIUSEL,",",X)["-" F TIUCNT=+$P(TIUSEL,",",X):1:$P($P(TIUSEL,",",X),"-",2) S:TIUCNT<VALMLST TIUDOCS(TIUCNT)=$O(@VALMAR@("IDX",TIUCNT,""))
"RTN","TIUADCL",176,0)
 . E  S:$P(TIUSEL,",",X)'>VALMLST TIUDOCS($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUADCL",177,0)
 I $$MULTI("TIUDOCS")>1,VALM("TITLE")="Operation Reports" D  Q
"RTN","TIUADCL",178,0)
 . W !!,"You may not select multiple OPERATION Reports to view or attach addenda to."
"RTN","TIUADCL",179,0)
 . W !,"Select only one document to view or attach addenda.",!
"RTN","TIUADCL",180,0)
 . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",181,0)
 . S VALMBCK="R"
"RTN","TIUADCL",182,0)
 I $$MULTI("TIUDOCS")>1,(ACTION="BROWSE"!(ACTION="DETDISP")) D  Q
"RTN","TIUADCL",183,0)
 . W !!,"You may only view one document at a time."
"RTN","TIUADCL",184,0)
 . W !,"Select only one document for this action.",!
"RTN","TIUADCL",185,0)
 . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",186,0)
 I VALM("TITLE")'="Operation Reports" S VALMBCK="R"
"RTN","TIUADCL",187,0)
 S TIUDOCS="" F  S TIUDOCS=$O(TIUDOCS(TIUDOCS)) Q:TIUDOCS=""  I $$GET1^DIQ(8925,TIUDOCS(TIUDOCS),.06)'="" K TIUDOCS(TIUDOCS)
"RTN","TIUADCL",188,0)
 I $D(TIUDOCS)'>1 S VALMBCK="R" Q
"RTN","TIUADCL",189,0)
 D @ACTION
"RTN","TIUADCL",190,0)
 Q
"RTN","TIUADCL1")
0^2^B36340142
"RTN","TIUADCL1",1,0)
TIUADCL1 ; SLC/AJB - UNK Addenda Cleanup ; 10/01/04
"RTN","TIUADCL1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**173**;Jun 20, 1997
"RTN","TIUADCL1",3,0)
 ;
"RTN","TIUADCL1",4,0)
 ; Cleanup Utility for OPERATION REPORT addenda.
"RTN","TIUADCL1",5,0)
 ; Finds parentless/unknown addenda and attaches to user
"RTN","TIUADCL1",6,0)
 ; selected parent.
"RTN","TIUADCL1",7,0)
 ;
"RTN","TIUADCL1",8,0)
 Q
"RTN","TIUADCL1",9,0)
EN ; main entry point for TIU UNK ADDENDA CLEANUP
"RTN","TIUADCL1",10,0)
 N DTR2,TIUADD,TIULVL,TIUQUIT
"RTN","TIUADCL1",11,0)
 D SAVEADD
"RTN","TIUADCL1",12,0)
 D DTRANGE^TIUADCL(.DTR2) Q:$D(TIUQUIT)
"RTN","TIUADCL1",13,0)
 D EN^VALM("TIU UNK ADDENDA ATTACH")
"RTN","TIUADCL1",14,0)
 K ^TMP("VALMAR",$J,TIULVL)
"RTN","TIUADCL1",15,0)
 Q
"RTN","TIUADCL1",16,0)
EXIT ;
"RTN","TIUADCL1",17,0)
 D XQORM
"RTN","TIUADCL1",18,0)
 Q
"RTN","TIUADCL1",19,0)
HDR ; sets header
"RTN","TIUADCL1",20,0)
 N HDR
"RTN","TIUADCL1",21,0)
 S HDR="OPERATION REPORTS from "_$$FMTE^XLFDT(DTR2("BEGDT"),"D")_" to "_$$FMTE^XLFDT(DTR2("ENDDT"),"D")
"RTN","TIUADCL1",22,0)
 S VALMHDR(1)=$$SETSTR^VALM1(HDR,"",(IOM-$L(HDR))/2,$L(HDR))
"RTN","TIUADCL1",23,0)
 D XQORM
"RTN","TIUADCL1",24,0)
 Q
"RTN","TIUADCL1",25,0)
HELP ; help code
"RTN","TIUADCL1",26,0)
 N DIR
"RTN","TIUADCL1",27,0)
 I X="?" S DIR("A")="Enter RETURN to continue or '^' to exit",DIR(0)="E"
"RTN","TIUADCL1",28,0)
 D FULL^VALM1
"RTN","TIUADCL1",29,0)
 W !!,"The following actions are available:"
"RTN","TIUADCL1",30,0)
 W !,"Browse a Document  - View a selected document (if authorized)"
"RTN","TIUADCL1",31,0)
 W !,"Change View        - Modify search criteria"
"RTN","TIUADCL1",32,0)
 W !,"Detailed Display   - View detailed display of a document (if authorized)"
"RTN","TIUADCL1",33,0)
 W !,"Attach to Parent   - Attach the currently selected "
"RTN","TIUADCL1",34,0)
 W $S($$MULTI^TIUADCL("TIUADD")>1:"addenda",1:"addendum")," to one OPERATION"
"RTN","TIUADCL1",35,0)
 W !,"                     REPORT",!
"RTN","TIUADCL1",36,0)
 I $D(DIR("A")) D ^DIR
"RTN","TIUADCL1",37,0)
 S VALMBCK="R"
"RTN","TIUADCL1",38,0)
 Q
"RTN","TIUADCL1",39,0)
INIT ; finds unknown addenda & creates list
"RTN","TIUADCL1",40,0)
 N OPREPORT,STRTDT,TIUDA,TIU
"RTN","TIUADCL1",41,0)
 S TIULVL=VALMEVL,TIU("IOCUOFF")=$C(27)_"[?25l",TIU("IOCUON")=$C(27)_"[?25h"
"RTN","TIUADCL1",42,0)
 W TIU("IOCUOFF")
"RTN","TIUADCL1",43,0)
 W !!,"Searching for the documents."
"RTN","TIUADCL1",44,0)
 S OPREPORT=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC"""),TIUDA="",STRTDT=DTR2("BEGDT"),VALMCNT=0
"RTN","TIUADCL1",45,0)
 F  S STRTDT=$O(^TIU(8925,"F",STRTDT)) Q:STRTDT=""!(STRTDT>DTR2("ENDDT"))  F  S TIUDA=$O(^TIU(8925,"F",STRTDT,TIUDA)) Q:TIUDA=""  I +$G(^TIU(8925,TIUDA,0))=OPREPORT D
"RTN","TIUADCL1",46,0)
 . N DATA,DISPLAY,MSG
"RTN","TIUADCL1",47,0)
 . I '$D(TIUADD($$GET1^DIQ(8925,TIUDA,.02))) Q
"RTN","TIUADCL1",48,0)
 . ; D CANDO^TIUSRVA(.MSG,TIUDA,"MAKE ADDENDUM") I '+MSG Q
"RTN","TIUADCL1",49,0)
 . S VALMCNT=VALMCNT+1 W:VALMCNT#3=0 "."
"RTN","TIUADCL1",50,0)
 . S DISPLAY=$$SETSTR^VALM1(VALMCNT,"",1,4)
"RTN","TIUADCL1",51,0)
 . S DISPLAY=$$SETSTR^VALM1($$PATIENT^TIU144($P($G(^TIU(8925,TIUDA,0)),U,2)),DISPLAY,6,38)
"RTN","TIUADCL1",52,0)
 . S DISPLAY=$$SETSTR^VALM1(TIUDA,DISPLAY,40,50)
"RTN","TIUADCL1",53,0)
 . S DISPLAY=$$SETSTR^VALM1($$FDATE^VALM1($$GET1^DIQ(8925,TIUDA,1201,"I")),DISPLAY,52,62)
"RTN","TIUADCL1",54,0)
 . S DISPLAY=$$SETSTR^VALM1($$GET1^DIQ(8925,TIUDA,.05),DISPLAY,62,71)
"RTN","TIUADCL1",55,0)
 . S DISPLAY=$$SETSTR^VALM1("#"_+$P($G(^TIU(8925,TIUDA,14)),U,5),DISPLAY,75,80)
"RTN","TIUADCL1",56,0)
 . D SET^VALM10(VALMCNT,DISPLAY,TIUDA)
"RTN","TIUADCL1",57,0)
 I VALMCNT=0 D
"RTN","TIUADCL1",58,0)
 . D SET^VALM10(2,$$SETSTR^VALM1("No records found to satisfy search criteria.","",(IOM-$L("No records found to satisfy search criteria."))/2,$L("No records found to satisfy search criteria.")),0)
"RTN","TIUADCL1",59,0)
 Q
"RTN","TIUADCL1",60,0)
XQORM ; default action for list manager
"RTN","TIUADCL1",61,0)
 S XQORM("#")=$O(^ORD(101,"B","TIU UNK ADDENDA SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUADCL1",62,0)
 Q
"RTN","TIUADCL1",63,0)
ATTACH ;
"RTN","TIUADCL1",64,0)
 N DISPLAY,LINE,PARENT
"RTN","TIUADCL1",65,0)
 D FULL^VALM1 W @IOF
"RTN","TIUADCL1",66,0)
 W "Attach the following UNKNOWN "_$S($$MULTI^TIUADCL("TIUADD")>1:"Addenda",1:"Addendum")_":",!!
"RTN","TIUADCL1",67,0)
 W "TIU",!,"Doc No.",?9,"Patient",?40,"Entry DT/Time",?59,"Status",?71,"Parent",!
"RTN","TIUADCL1",68,0)
 S LINE="",PARENT=$$ONEDOC^TIUADCL()
"RTN","TIUADCL1",69,0)
 S $P(LINE,"-",80)="-" W LINE
"RTN","TIUADCL1",70,0)
 S TIUADD="" F  S TIUADD=$O(TIUADD(TIUADD)) Q:TIUADD=""!(+TIUADD'>0)  D
"RTN","TIUADCL1",71,0)
 . N TIUDA
"RTN","TIUADCL1",72,0)
 . S TIUDA=TIUADD(TIUADD)
"RTN","TIUADCL1",73,0)
 . S DISPLAY=$$SETSTR^VALM1(TIUDA,"",1,8)
"RTN","TIUADCL1",74,0)
 . S DISPLAY=$$SETSTR^VALM1($$PATIENT^TIU144($P($G(^TIU(8925,TIUDA,0)),U,2)),DISPLAY,10,40)
"RTN","TIUADCL1",75,0)
 . S DISPLAY=$$SETSTR^VALM1($$FDTTM^VALM1($$GET1^DIQ(8925,TIUDA,1201,"I")),DISPLAY,41,51)
"RTN","TIUADCL1",76,0)
 . S DISPLAY=$$SETSTR^VALM1($$GET1^DIQ(8925,TIUDA,.05),DISPLAY,60,67)
"RTN","TIUADCL1",77,0)
 . S DISPLAY=$$SETSTR^VALM1($S($$GET1^DIQ(8925,TIUDA,.06)="":"None",1:$$GET1^DIQ(8925,TIUDA,.06)),DISPLAY,72,80)
"RTN","TIUADCL1",78,0)
 . W $E(DISPLAY,1,80)
"RTN","TIUADCL1",79,0)
 W !!,"to the following "_$$GET1^DIQ(8925,PARENT,.01)_"?",!
"RTN","TIUADCL1",80,0)
 S DISPLAY=$$SETSTR^VALM1(PARENT,"",1,8)
"RTN","TIUADCL1",81,0)
 S DISPLAY=$$SETSTR^VALM1($$PATIENT^TIU144($P($G(^TIU(8925,PARENT,0)),U,2)),DISPLAY,10,40)
"RTN","TIUADCL1",82,0)
 S DISPLAY=$$SETSTR^VALM1($$FDTTM^VALM1($$GET1^DIQ(8925,PARENT,1201,"I")),DISPLAY,41,51)
"RTN","TIUADCL1",83,0)
 S DISPLAY=$$SETSTR^VALM1($$GET1^DIQ(8925,PARENT,.05),DISPLAY,60,67)
"RTN","TIUADCL1",84,0)
 S DISPLAY=$$SETSTR^VALM1("#"_+$P($G(^TIU(8925,PARENT,14)),U,5),DISPLAY,72,80)
"RTN","TIUADCL1",85,0)
 W !,"TIU",?71,"Surgical",!,"Doc No.",?9,"Patient",?40,"Entry DT/Time",?59,"Status",?71,"Case No.",!
"RTN","TIUADCL1",86,0)
 W LINE,$E(DISPLAY,1,80),!
"RTN","TIUADCL1",87,0)
 S VALMBCK="R"
"RTN","TIUADCL1",88,0)
 I '$$READ^TIUU("Y","Do you wish to begin attaching","NO","Enter 'Y' or 'N'") W ! I $$READ^TIUU("EA","Press <RETURN> to continue") Q
"RTN","TIUADCL1",89,0)
 S VALMBCK="Q"
"RTN","TIUADCL1",90,0)
 S TIUADD="" F  S TIUADD=$O(TIUADD(TIUADD)) Q:TIUADD=""!(+TIUADD'>0)  D
"RTN","TIUADCL1",91,0)
 . N TIUDA
"RTN","TIUADCL1",92,0)
 . S TIUDA=TIUADD(TIUADD)
"RTN","TIUADCL1",93,0)
 . W !!,"Attaching #",TIUDA," to #",PARENT,"  ... "
"RTN","TIUADCL1",94,0)
 . D ATNOW(PARENT,TIUDA)
"RTN","TIUADCL1",95,0)
 W ! I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL1",96,0)
 Q
"RTN","TIUADCL1",97,0)
ATNOW(PARENT,ADDENDUM) ;
"RTN","TIUADCL1",98,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUA0,TIUA12,TIUP0,TIUP12,TIUWARN
"RTN","TIUADCL1",99,0)
 S TIUP0=$G(^TIU(8925,PARENT,0)),TIUA0=$G(^TIU(8925,ADDENDUM,0))
"RTN","TIUADCL1",100,0)
 S TIUP12=$G(^TIU(8925,PARENT,12)),TIUA12=$G(^TIU(8925,ADDENDUM,12))
"RTN","TIUADCL1",101,0)
 I $P(TIUP0,U,2)'=$P(TIUA0,U,2) W !,"ERROR:  Parent and Addendum have different patients!" S TIUWARN=1
"RTN","TIUADCL1",102,0)
 I $P(TIUA12,U)'>$P(TIUP12,U) W !,"ERROR:  The addendum's ENTRY DATE/TIME precedes the parent's ENTRY DATE/TIME!" S TIUWARN=1
"RTN","TIUADCL1",103,0)
 I +$G(TIUWARN) Q
"RTN","TIUADCL1",104,0)
 S IENS=""""_ADDENDUM_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUADCL1",105,0)
 S @FDARR@(.06)=PARENT
"RTN","TIUADCL1",106,0)
 S @FDARR@(1405)=$$GET1^DIQ(8925,PARENT,1405,"I")
"RTN","TIUADCL1",107,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUADCL1",108,0)
 I $D(TIUMSG) D  Q
"RTN","TIUADCL1",109,0)
 . N LINE S LINE=""
"RTN","TIUADCL1",110,0)
 . F  S LINE=$O(TIUMSG("DIERR",1,"TEXT",LINE)) Q:LINE=""  W !,TIUMSG("DIERR",1,"TEXT",LINE)
"RTN","TIUADCL1",111,0)
 W ?29," success!"
"RTN","TIUADCL1",112,0)
 Q
"RTN","TIUADCL1",113,0)
SAVEADD ;
"RTN","TIUADCL1",114,0)
 S TIUADD=0
"RTN","TIUADCL1",115,0)
 F  S TIUADD=$O(TIUDOCS(TIUADD)) Q:TIUADD=""  S TIUADD(TIUADD)=TIUDOCS(TIUADD),TIUADD($$GET1^DIQ(8925,TIUADD(TIUADD),.02))=""
"RTN","TIUADCL1",116,0)
 Q
"RTN","TIUADCL1",117,0)
PREP ;
"RTN","TIUADCL1",118,0)
 N DA,DIC,DIK,X,Y
"RTN","TIUADCL1",119,0)
 S DIC="^SD(409.61,",DIC(0)="X"
"RTN","TIUADCL1",120,0)
 F X="TIU UNK ADDENDA ATTACH","TIU UNK ADDENDA CLEANUP" D
"RTN","TIUADCL1",121,0)
 . D ^DIC I +Y D
"RTN","TIUADCL1",122,0)
 .. S DA=+Y,DIK=DIC D ^DIK
"RTN","TIUADCL1",123,0)
 Q
"RTN","TIUBR")
0^8^B45272130
"RTN","TIUBR",1,0)
TIUBR ; SLC/JER - Browse Action Subroutines ;4/18/2001 16:36
"RTN","TIUBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**32,87,93,58,100,162,112,173**;Jun 20, 1997
"RTN","TIUBR",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC to TIUBR1.
"RTN","TIUBR",4,0)
EN ; Entry code for LM templates TIU BROWSE
"RTN","TIUBR",5,0)
 N TIUY
"RTN","TIUBR",6,0)
 ;Kill TIUGDATA in CLEAN; don't new it here
"RTN","TIUBR",7,0)
 ; -- Set TIUGDATA, which describes the note originally
"RTN","TIUBR",8,0)
 ;    selected to be browsed. --
"RTN","TIUBR",9,0)
 ; TIUGDATA = 0 or
"RTN","TIUBR",10,0)
 ;          = TIUDA^HASIDKID^TIUD21^PRMSORT, where
"RTN","TIUBR",11,0)
 ;            PRMSORT = "TITLE" or "REFDT".  See 8925.95, fld .18
"RTN","TIUBR",12,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBR",13,0)
 D BLDTMP(TIUDA)
"RTN","TIUBR",14,0)
 Q
"RTN","TIUBR",15,0)
HDR ; Build Header
"RTN","TIUBR",16,0)
 N TIUDTYP,DFN
"RTN","TIUBR",17,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUBR",18,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR",19,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUBR",20,0)
 ;  Docmt header line Patname, SSN, [Location, Visit]:
"RTN","TIUBR",21,0)
 S VALMHDR(2)=$$SETREC(TIUGDATA)
"RTN","TIUBR",22,0)
 Q
"RTN","TIUBR",23,0)
BLDTMP(TIUDA) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUBR",24,0)
 ; Requires TIUDA = IFN of note selected to be browsed.
"RTN","TIUBR",25,0)
 ; Needs TIUGDATA, set in EN
"RTN","TIUBR",26,0)
 N TIUI,TIUL,TIUREC,TIUDADD,ONBROWSE S (TIUDADD,TIUI)=0
"RTN","TIUBR",27,0)
 N TIUNAME K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUBR",28,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUBR",29,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUBR",30,0)
 D INQUIRE^TIUGBR(TIUDA,.TIUREC)
"RTN","TIUBR",31,0)
 I $D(TIUREC)>9 W !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUBR",32,0)
 ; --- if the document has a browse action, execute it ---
"RTN","TIUBR",33,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUBR",34,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUBR",35,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUBR",36,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",37,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUBR",38,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",39,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUBR",40,0)
 S ^TMP("TIUVIEW",$J,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUBR",41,0)
 S $P(^TMP("TIUVIEW",$J,0),U,3,4)=$G(TIUL)_U_$G(TIUL),VALMCNT=+$G(TIUL)
"RTN","TIUBR",42,0)
 Q
"RTN","TIUBR",43,0)
LOADSUPP(METHOD,TIUDA,TIUL) ; Execute OnBrowse/Load Supplementary data
"RTN","TIUBR",44,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUBR",45,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUBR",46,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR",47,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUBR",48,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",49,0)
 K @TIUY
"RTN","TIUBR",50,0)
 Q
"RTN","TIUBR",51,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load dictation, transcription data, etc.
"RTN","TIUBR",52,0)
 ; Requires array TIUREC, TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",53,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUBR",54,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUBR",55,0)
 ;      entry, since they vary by entry.
"RTN","TIUBR",56,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUBR",57,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUBR",58,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUBR",59,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUBR",60,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUBR",61,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUBR",62,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUBR",63,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUBR",64,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUBR",65,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUBR",66,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUBR",67,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUBR",68,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUBR",69,0)
 I SELCHLD!SELPRNT D
"RTN","TIUBR",70,0)
 . D IDTOP^TIUGBR(TIUDA,.TIUL,SHORT,CURPRNT)
"RTN","TIUBR",71,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUBR",72,0)
 I SHORT D
"RTN","TIUBR",73,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",74,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",75,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",76,0)
 I 'SHORT D
"RTN","TIUBR",77,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",78,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),$G(TIUY),4,39)
"RTN","TIUBR",79,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",80,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUBR",81,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",82,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",83,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",84,0)
 . . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("SURGEON: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),6,32) Q
"RTN","TIUBR",85,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),2,32)
"RTN","TIUBR",86,0)
 . E  D
"RTN","TIUBR",87,0)
 . . S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),7,32)
"RTN","TIUBR",88,0)
 . . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("SURGEON: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),6,32)
"RTN","TIUBR",89,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUBR",90,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),$G(TIUY),39,40)
"RTN","TIUBR",91,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),$G(TIUY),36,40)
"RTN","TIUBR",92,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",93,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",94,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),$G(TIUY),6,36)
"RTN","TIUBR",95,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",96,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",97,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",98,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",99,0)
 E  D
"RTN","TIUBR",100,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),$G(TIUY),6,74)
"RTN","TIUBR",101,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",102,0)
 . S TIUL=TIUL+1,TIUY="",@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",103,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUBR",104,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))_" Has ADDENDA ***"
"RTN","TIUBR",105,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",106,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR",107,0)
 Q
"RTN","TIUBR",108,0)
 ;
"RTN","TIUBR",109,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUBR",110,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",111,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUBR",112,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUBR",113,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUBR",114,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUBR",115,0)
 S TIUK=0
"RTN","TIUBR",116,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUBR",117,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUBR",118,0)
 . D LOADID^TIUGBR(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUBR",119,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUBR",120,0)
 Q
"RTN","TIUBR",121,0)
 ;
"RTN","TIUBR",122,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUBR",123,0)
 N TIUY,TIUTYP
"RTN","TIUBR",124,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUBR",125,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUBR",126,0)
 Q TIUY
"RTN","TIUBR",127,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUBR",128,0)
 N TIUDADT,TIUJ,CANSEE
"RTN","TIUBR",129,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUBR",130,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",131,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUBR",132,0)
 S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUBR",133,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR",134,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",135,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR",136,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUBR",137,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",138,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUBR",139,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUBR",140,0)
 Q
"RTN","TIUBR",141,0)
 ;
"RTN","TIUBR",142,0)
SETREC(TIUGDATA) ; Sets docmt header line Patname, SSN, [Location, Visit]
"RTN","TIUBR",143,0)
 ; Requires TIUGDATA
"RTN","TIUBR",144,0)
 N Y
"RTN","TIUBR",145,0)
 S Y=$$SETSTR^VALM1($$NAME^TIULS($G(TIU("PNM")),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUBR",146,0)
 S Y=$$SETSTR^VALM1($G(TIU("SSN")),$G(Y),16,12)
"RTN","TIUBR",147,0)
 ; ---- If TIUDA is an ID entry, write ID, ADDENDED? in header
"RTN","TIUBR",148,0)
 ;      and leave out entry-specific info (Location, Visit)
"RTN","TIUBR",149,0)
 ;      since that goes with each individual entry: ----
"RTN","TIUBR",150,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D  G SETRX
"RTN","TIUBR",151,0)
 . S Y=$$SETSTR^VALM1("Interdisciplinary "_$S($P(TIUGDATA,U,2):"Note",1:"Entry"),$G(Y),29,23)
"RTN","TIUBR",152,0)
 . I $P(TIUGDATA,U,2) S Y=$$SETSTR^VALM1("ADDENDED?"_$S($$HASADDEN^TIULC1(+TIUDA,1):" Yes",1:" No"),$G(Y),66,13)
"RTN","TIUBR",153,0)
 S Y=$$SETSTR^VALM1($P($G(TIU("LOC")),U,2),$G(Y),30,17)
"RTN","TIUBR",154,0)
 I $L($G(TIU("WARD"))) D
"RTN","TIUBR",155,0)
 . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/CCYY"),$G(Y),48,15)
"RTN","TIUBR",156,0)
 . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/CCYY"),$G(Y),65,15)
"RTN","TIUBR",157,0)
 I '$L($G(TIU("WARD"))) D
"RTN","TIUBR",158,0)
 . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+$G(TIU("EDT")),"MM/DD/CCYY HR:MIN"),$G(Y),51,28)
"RTN","TIUBR",159,0)
SETRX Q Y
"RTN","TIUBR",160,0)
 ;
"RTN","TIUBR",161,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUBR",162,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1,TIUGDATA
"RTN","TIUBR",163,0)
 Q
"RTN","TIUPUTC")
0^7^B30507838
"RTN","TIUPUTC",1,0)
TIUPUTC ; SLC/JER - Document filer - captioned header ;11/01/03
"RTN","TIUPUTC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,100,113,112,173**;Jun 20, 1997
"RTN","TIUPUTC",3,0)
 ;
"RTN","TIUPUTC",4,0)
MAIN ; ---- Controls branching.
"RTN","TIUPUTC",5,0)
 ;      Attempts to file upload documents in the target file.
"RTN","TIUPUTC",6,0)
 ;      Requires DA = IEN of 8925.2 upload buffer entry.
"RTN","TIUPUTC",7,0)
 N TIUDA,TIUBGN,TIUI,TIUHSIG,TIULIM,TIULCNT,TIULINE,TIUREC,TIUPOST
"RTN","TIUPUTC",8,0)
 N TIUTYPE,TIUINST K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",9,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUPUTC",10,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPUTC",11,0)
 I TIUHSIG']"" D MAIN^TIUPEVNT(DA,1,1) Q
"RTN","TIUPUTC",12,0)
 I TIUBGN']"" D MAIN^TIUPEVNT(DA,1,7) Q
"RTN","TIUPUTC",13,0)
 ; ---- Strip controls when kermit:
"RTN","TIUPUTC",14,0)
 I $P(TIUPRM0,U,17)="k" D PREPROC(DA)
"RTN","TIUPUTC",15,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",16,0)
 . S TIULINE=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",17,0)
 . I TIULINE[TIUHSIG D  Q
"RTN","TIUPUTC",18,0)
 . . ; ---- Hdr signal line.  GETREC^TIUPUTC1 resets TIUI to $TXT line:
"RTN","TIUPUTC",19,0)
 . . N TIUHDR,TIUFRST,TIUJ S TIUFRST=TIUI
"RTN","TIUPUTC",20,0)
 . . ; ---- If after first hdr signal, finish previous docmt
"RTN","TIUPUTC",21,0)
 . . ;      before going on w/ current docmt:
"RTN","TIUPUTC",22,0)
 . . I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",23,0)
 . . K TIUREC D GETREC^TIUPUTC1(TIULINE,.TIUREC,.TIUHDR)
"RTN","TIUPUTC",24,0)
 . . I +$G(TIUREC("#"))'>0!($G(TIUREC("ROOT"))']"") Q
"RTN","TIUPUTC",25,0)
 . . D STUFREC(.TIUHDR,.TIUREC)
"RTN","TIUPUTC",26,0)
 . . S TIUREC("TROOT")=TIUREC("ROOT")_TIUREC("#")_","_TIUREC("TEXT")_","
"RTN","TIUPUTC",27,0)
 . . S:'$D(@(TIUREC("TROOT")_"0)")) @(TIUREC("TROOT")_"0)")="^^^^^"
"RTN","TIUPUTC",28,0)
 . . S TIULCNT=+$P(@(TIUREC("TROOT")_"0)"),U,4)
"RTN","TIUPUTC",29,0)
 . . F TIUJ=TIUFRST:1:TIUI D
"RTN","TIUPUTC",30,0)
 . . . ; ---- Delete header lines from buffer once filed;
"RTN","TIUPUTC",31,0)
 . . . ;      (TIUI was reset in GETREC^TIUPUTC1 to $TXT line):
"RTN","TIUPUTC",32,0)
 . . . K ^TIU(8925.2,+DA,"TEXT",TIUJ,0)
"RTN","TIUPUTC",33,0)
 . . I TIUREC("FILE")=8925,+$G(TIUREC("#")),+$G(TIUREC("BOILON")) D BOILRPLT(.TIUREC)
"RTN","TIUPUTC",34,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),(+$G(TIUREC("FILE"))=8925),+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",35,0)
 . . I TIULINE]"",$D(^TIU(8925.1,"B",$P(TIULINE,":"))) D  I 1
"RTN","TIUPUTC",36,0)
 . . . S TIULCNT=$$LOCATE(TIULINE,TIUREC("#"))
"RTN","TIUPUTC",37,0)
 . . E  S TIULCNT=+$G(TIULCNT)+.01
"RTN","TIUPUTC",38,0)
 . . S ^TIU(8925,+TIUREC("#"),"TEMP",TIULCNT,0)=TIULINE
"RTN","TIUPUTC",39,0)
 . . ; ---- Delete text line from buffer once xferred:
"RTN","TIUPUTC",40,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",41,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")),(+$G(TIUREC("BOILON"))'>0) D
"RTN","TIUPUTC",42,0)
 . . S TIULCNT=+$G(TIULCNT)+1,@(TIUREC("TROOT")_TIULCNT_",0)")=TIULINE
"RTN","TIUPUTC",43,0)
 . . ; ---- Delete text line once xferred:
"RTN","TIUPUTC",44,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",45,0)
 . . ; ---- Remove leading buffer garbage
"RTN","TIUPUTC",46,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),'$D(TIUREC("TROOT")),($G(TIUREC("#"))'=-1) K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",47,0)
 . I TIULINE[TIUBGN K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",48,0)
 ; ---- Finish last docmt in buffer file:
"RTN","TIUPUTC",49,0)
 I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",50,0)
 I '+$O(^TIU(8925.2,+DA,"TEXT",0)) D BUFPURGE(DA)
"RTN","TIUPUTC",51,0)
 ; ---- Write upload results:
"RTN","TIUPUTC",52,0)
 I '$D(ZTQUEUED),$D(^TMP("TIUPUTC",$J)) D
"RTN","TIUPUTC",53,0)
 . W !!,"TOTALS FOR CURRENT BATCH:",!
"RTN","TIUPUTC",54,0)
 . W !?14,"TOTAL Document(s) RECEIVED: ",$J((+$G(^TMP("TIUPUTC",$J,"SUCC"))+$G(^("MISS"))+$G(^("FAIL"))),5),!
"RTN","TIUPUTC",55,0)
 . W !?18," Document(s) NOT FILED: ",$J(+$G(^TMP("TIUPUTC",$J,"FAIL")),5)
"RTN","TIUPUTC",56,0)
 . W !?3,"Document(s) FILED with MISSING FIELDS: ",$J(+$G(^TMP("TIUPUTC",$J,"MISS")),5),!
"RTN","TIUPUTC",57,0)
 K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",58,0)
 Q
"RTN","TIUPUTC",59,0)
LOCATE(LINE,REC) ; ---- Locate line in boilerplate text
"RTN","TIUPUTC",60,0)
 N TIUJ,HIT,BTXT S (TIUJ,HIT)=0
"RTN","TIUPUTC",61,0)
 F  Q:+HIT  S TIUJ=$O(^TIU(8925,+REC,"TEMP",TIUJ)) Q:+TIUJ'>0!HIT  D
"RTN","TIUPUTC",62,0)
 . S BTXT=$G(^TIU(8925,+REC,"TEMP",TIUJ,0))
"RTN","TIUPUTC",63,0)
 . I BTXT[$P(LINE,":")_":" S HIT=1
"RTN","TIUPUTC",64,0)
 Q +$G(TIUJ)
"RTN","TIUPUTC",65,0)
 ;
"RTN","TIUPUTC",66,0)
STUFREC(HEADER,RECORD) ; ---- Stuffs record with known fixed fields;
"RTN","TIUPUTC",67,0)
 ;                      Checks for missing fields.
"RTN","TIUPUTC",68,0)
 N FDA,FDARR,IENS,FLAGS,TIUI,TIUMSG,TIUPC
"RTN","TIUPUTC",69,0)
 S IENS=""""_+RECORD("#")_","""
"RTN","TIUPUTC",70,0)
 S FDARR="FDA("_+RECORD("FILE")_","_IENS_")",FLAGS="KE"
"RTN","TIUPUTC",71,0)
 ; ---- Set up FDA Array:
"RTN","TIUPUTC",72,0)
 S TIUI=0
"RTN","TIUPUTC",73,0)
 F  S TIUI=$O(HEADER(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",74,0)
 . ; if field is Author/Dictator and title is OPERATION REPORT, ignore uploaded data *173
"RTN","TIUPUTC",75,0)
 . I (TIUI=1202!(TIUI=1209)),TIUREC("TYPE")=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S @FDARR@(1303)="U" Q
"RTN","TIUPUTC",76,0)
 . S:TIUI'=.001 @FDARR@(TIUI)=$$TRNSFRM^TIULX(.RECORD,TIUI,HEADER(TIUI))
"RTN","TIUPUTC",77,0)
 I $D(FDA) D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTC",78,0)
 I $D(TIUMSG) D
"RTN","TIUPUTC",79,0)
 . ; ---- If FILE^DIC fails, log 8925.4 error w/ hdr info.  Create new
"RTN","TIUPUTC",80,0)
 . ;      8925.2 buffer entry with hdr, text, & 8925.4 log #.
"RTN","TIUPUTC",81,0)
 . ;      Kill most of old buffer. Send missing field alerts:
"RTN","TIUPUTC",82,0)
 . D MAIN^TIUPEVNT(DA,2,"",$P($G(^TIU(8925.1,+RECORD("TYPE"),0)),U),.FDA,.TIUMSG)
"RTN","TIUPUTC",83,0)
 . S ^TMP("TIUPUTC",$J,"MISS")=+$G(^TMP("TIUPUTC",$J,"MISS"))+1
"RTN","TIUPUTC",84,0)
 I '$D(TIUMSG) D
"RTN","TIUPUTC",85,0)
 . S ^TMP("TIUPUTC",$J,"SUCC")=+$G(^TMP("TIUPUTC",$J,"SUCC"))+1
"RTN","TIUPUTC",86,0)
 Q
"RTN","TIUPUTC",87,0)
BOILRPLT(TIUREC) ; ---- Execute/Interleave Boilerplates w/uploaded text
"RTN","TIUPUTC",88,0)
 N TIU
"RTN","TIUPUTC",89,0)
 D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",90,0)
 D LOADDFLT^TIUEDI4(TIUREC("#"),TIUREC("TYPE")) ;100
"RTN","TIUPUTC",91,0)
 Q
"RTN","TIUPUTC",92,0)
SETROOT(LINECNT,RECORD) ; ---- Sets root of WP field
"RTN","TIUPUTC",93,0)
 S @(RECORD("TROOT")_"0)")="^^"_LINECNT_"^"_LINECNT_"^"_DT_"^^"
"RTN","TIUPUTC",94,0)
 Q
"RTN","TIUPUTC",95,0)
BUFPURGE(DA) ; ---- Call ^DIK to purge buffer record when all's well
"RTN","TIUPUTC",96,0)
 N DIK S DIK="^TIU(8925.2," D ^DIK
"RTN","TIUPUTC",97,0)
 Q
"RTN","TIUPUTC",98,0)
PREPROC(DA) ; ---- Strip controls & white space from headers
"RTN","TIUPUTC",99,0)
 N TIUI,TIUHLIN,X S (TIUI,TIUHLIN)=0
"RTN","TIUPUTC",100,0)
 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",101,0)
 . S X=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",102,0)
 . S:X[TIUHSIG TIUHLIN=1 S:X[TIUBGN TIUHLIN=0
"RTN","TIUPUTC",103,0)
 . S:TIUHLIN ^TIU(8925.2,+DA,"TEXT",TIUI,0)=$$STRIP^TIUUPLD(X)
"RTN","TIUPUTC",104,0)
 Q
"RTN","TIUPUTC",105,0)
DADTYPE(DA) ; ---- Get type of original document for addenda
"RTN","TIUPUTC",106,0)
 N TIUDAD,Y
"RTN","TIUPUTC",107,0)
 S TIUDAD=$P($G(^TIU(8925,DA,0)),U,6)
"RTN","TIUPUTC",108,0)
 S Y=+$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUPUTC",109,0)
 Q Y
"RTN","TIUPUTC",110,0)
 ;
"RTN","TIUPUTC",111,0)
FINISH ; ---- Finish document: feedback, postfile code, merge boil,
"RTN","TIUPUTC",112,0)
 ;      log file event
"RTN","TIUPUTC",113,0)
 N ISADDNDM S ISADDNDM=0
"RTN","TIUPUTC",114,0)
 D SETROOT(TIULCNT,.TIUREC)
"RTN","TIUPUTC",115,0)
 S ISADDNDM=+$$ISADDNDM^TIULC1(TIUREC("#"))
"RTN","TIUPUTC",116,0)
 S TIUTYPE=$S(ISADDNDM:+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",117,0)
 I '$D(ZTQUEUED) W !,">>> ",$S(ISADDNDM:"Addendum",1:"Document")," Filed Successfully.",! ;TIU*1*81
"RTN","TIUPUTC",118,0)
 ; ---- TIU*1*81 Tell error handler that retrying filer was successful:
"RTN","TIUPUTC",119,0)
 S TIUDONE=1
"RTN","TIUPUTC",120,0)
 S TIUTYPE=$S(+$$ISADDNDM^TIULC1(TIUREC("#")):+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",121,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYPE)
"RTN","TIUPUTC",122,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTC",123,0)
 I TIUREC("FILE")=8925,+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",124,0)
 . N TIU D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",125,0)
 . D MERGTEXT^TIUEDI1(TIUREC("#"),.TIU)
"RTN","TIUPUTC",126,0)
 . K ^TIU(8925,+TIUREC("#"),"TEMP")
"RTN","TIUPUTC",127,0)
 D MAIN^TIUPEVNT(DA,0,"",$P($G(^TIU(8925.1,+TIUREC("TYPE"),0)),U))
"RTN","TIUPUTC",128,0)
 Q
"RTN","TIUPUTC",129,0)
 ;
"RTN","TIUPUTS")
0^5^B32898133
"RTN","TIUPUTS",1,0)
TIUPUTS ; SLC/JER - Surgery Look-up, etc. ; 04/19/2004
"RTN","TIUPUTS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187,173**;Jun 20, 1997
"RTN","TIUPUTS",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTS",4,0)
 ; Required: TIUSRCN, TIUSDA, TIUSSN, TIUODT
"RTN","TIUPUTS",5,0)
 N SRODT,DFN,TIUSR0,TIUD0,TIUDAD
"RTN","TIUPUTS",6,0)
 I $S('$D(TIUSSN):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,+$G(TIUODT)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTS",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTS",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTS",9,0)
 S DFN=+$$PATIENT^TIULA(TIUSSN)
"RTN","TIUPUTS",10,0)
 I DFN'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",11,0)
 I +$G(TIUSRCN)=0 S TIUSRCN=$$FINDCASE(DFN,+$$IDATE^TIULC(TIUODT))
"RTN","TIUPUTS",12,0)
 I +$G(TIUSRCN)'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",13,0)
 I +$G(TIUSDA)'>0,$D(^SRF(TIUSRCN,"TIU")) S TIUSDA=$$GETSDA(TIUSRCN)
"RTN","TIUPUTS",14,0)
 I +$G(TIUSDA)'>0 D  G LOOKUPX
"RTN","TIUPUTS",15,0)
 . S Y=-1
"RTN","TIUPUTS",16,0)
 . I '$D(^SRF(TIUSRCN,"TIU")),'$D(ZTQUEUED) D
"RTN","TIUPUTS",17,0)
 . . W !!,"Time Out of O.R. has not yet been entered for Surgical Case #",TIUSRCN
"RTN","TIUPUTS",18,0)
 . . W !,"the Surgical Service must complete this step before the Operation"
"RTN","TIUPUTS",19,0)
 . . W !,"Report can be uploaded..."
"RTN","TIUPUTS",20,0)
 K TIUHDR(.001),TIUHDR(.02),TIUHDR(.07),TIUHDR(1405)
"RTN","TIUPUTS",21,0)
 S TIUD0=$G(^TIU(8925,TIUSDA,0)),TIUSR0=$G(^SRF(TIUSRCN,0))
"RTN","TIUPUTS",22,0)
 ;Confirm that SURGICAL CASE is for correct patient
"RTN","TIUPUTS",23,0)
 I +TIUSR0'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",24,0)
 ;Confirm that TIU DOCUMENT is for correct patient
"RTN","TIUPUTS",25,0)
 I +$P(TIUD0,U,2)'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",26,0)
 ;Confirm that OPERATION DATE is correct
"RTN","TIUPUTS",27,0)
 I +$$IDATE^TIULC(TIUODT)'=$P($P(TIUSR0,U,9),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTS",28,0)
 S Y=$$CALLDIC(TIUSDA)
"RTN","TIUPUTS",29,0)
 I '+$$CANEDIT(+Y) D
"RTN","TIUPUTS",30,0)
 . W !,"Existing document may not be edited...Creating Addendum."
"RTN","TIUPUTS",31,0)
 . S TIUDAD=+Y,Y=$$MAKEADD^TIUPUTU()
"RTN","TIUPUTS",32,0)
 . D COPYDAD(Y,TIUDAD)
"RTN","TIUPUTS",33,0)
LOOKUPX K TIUSRCN,TIUSDA
"RTN","TIUPUTS",34,0)
 Q
"RTN","TIUPUTS",35,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTS",36,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTS",37,0)
COPYDAD(DA,PARENT) ; copy fixed field data for addenda
"RTN","TIUPUTS",38,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUOPDT,TIURDT,TIUD0,TIUD12,TIUD14
"RTN","TIUPUTS",39,0)
 S TIUD0=$G(^TIU(8925,+PARENT,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIUPUTS",40,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",41,0)
 S @FDARR@(.02)=$P(TIUD0,U,2)
"RTN","TIUPUTS",42,0)
 S @FDARR@(.03)=$P(TIUD0,U,3),@FDARR@(.05)=3
"RTN","TIUPUTS",43,0)
 S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIUD0,U,8)
"RTN","TIUPUTS",44,0)
 S @FDARR@(1401)=$P(TIUD14,U)
"RTN","TIUPUTS",45,0)
 S @FDARR@(1402)=$P(TIUD14,U,2)
"RTN","TIUPUTS",46,0)
 S @FDARR@(1405)=TIUSRCN_";SRF("
"RTN","TIUPUTS",47,0)
 S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTS",48,0)
 S @FDARR@(1205)=$P(TIUD12,U,5)
"RTN","TIUPUTS",49,0)
 S TIUOPDT=+$$IDATE^TIULC($G(TIUODT))
"RTN","TIUPUTS",50,0)
 S TIURDT=$S(+$G(TIUOPDT)>0:+$G(TIUOPDT),1:+$$NOW^XLFDT)
"RTN","TIUPUTS",51,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTS",52,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTS",53,0)
 Q
"RTN","TIUPUTS",54,0)
FINDCASE(DFN,TIUODT) ; Find Surgical Case for Pt & Dt, if unique
"RTN","TIUPUTS",55,0)
 N TIUY,TIUCN,TIUHIT,TIUPOP S TIUCN="",(TIUY,TIUHIT,TIUPOP)=0
"RTN","TIUPUTS",56,0)
 F  S TIUCN=$O(^SRF("B",DFN,TIUCN),-1) Q:TIUCN'>0!+TIUPOP  D
"RTN","TIUPUTS",57,0)
 . N TIUSR0 S TIUSR0=$G(^SRF(TIUCN,0))
"RTN","TIUPUTS",58,0)
 . I +$G(TIUODT)=$P($P(TIUSR0,U,9),".") D
"RTN","TIUPUTS",59,0)
 . . I +TIUHIT S TIUPOP=1 Q
"RTN","TIUPUTS",60,0)
 . . S TIUHIT=TIUCN
"RTN","TIUPUTS",61,0)
 I 'TIUPOP,TIUHIT S TIUY=TIUHIT
"RTN","TIUPUTS",62,0)
 Q TIUY
"RTN","TIUPUTS",63,0)
GETSDA(TIUSRCN) ; Get Op Report for Case
"RTN","TIUPUTS",64,0)
 N TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U)
"RTN","TIUPUTS",65,0)
 I 'TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U,3)
"RTN","TIUPUTS",66,0)
 Q TIUY
"RTN","TIUPUTS",67,0)
CALLDIC(TIUX) ; Call ^DIC to get the IEN for the TIU DOCUMENT
"RTN","TIUPUTS",68,0)
 N DA,DIC,X,Y
"RTN","TIUPUTS",69,0)
 S DIC=8925,DIC(0)="NX",X="`"_TIUX D ^DIC
"RTN","TIUPUTS",70,0)
 Q Y
"RTN","TIUPUTS",71,0)
FOLLOWUP(TIUDA) ; Post-filing code for Operation Reports
"RTN","TIUPUTS",72,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTS",73,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",74,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",75,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTS",76,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTS",77,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTS",78,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",79,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTS",80,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",81,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTS",82,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTS",83,0)
 Q
"RTN","TIUPUTS",84,0)
FIX ; Filing error resolution code for Operation Reports
"RTN","TIUPUTS",85,0)
 N TIUOUT,TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUHIT
"RTN","TIUPUTS",86,0)
 N TIUADD,TIUTYP,TIU,DUOUT,DTOUT
"RTN","TIUPUTS",87,0)
 S TIUHIT=0
"RTN","TIUPUTS",88,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUPUTS",89,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUPUTS",90,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUPUTS",91,0)
 . S X=+$$PATIENT^TIULA
"RTN","TIUPUTS",92,0)
 . I X'>0 D  Q
"RTN","TIUPUTS",93,0)
 . . W !!,"Okay, no harm done...",!
"RTN","TIUPUTS",94,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",95,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",96,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUPUTS",97,0)
 . W !
"RTN","TIUPUTS",98,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUPUTS",99,0)
 . S DIC("S")="I +$$DICS^TIUPUTS(+Y)"
"RTN","TIUPUTS",100,0)
 . D IX^DIC
"RTN","TIUPUTS",101,0)
 . I +Y'>0 D  Q
"RTN","TIUPUTS",102,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No OPERATION REPORTS Available to Update.",1:"No OPERATION REPORT Selected..."),!
"RTN","TIUPUTS",103,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",104,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",105,0)
 . W ! S (DA,TIUHIT)=+Y D EN^DIQ
"RTN","TIUPUTS",106,0)
 . S TIUOUT=$$READ^TIUU("Y","... OK","YES") W !
"RTN","TIUPUTS",107,0)
 . I +TIUOUT S TIUDA=DA
"RTN","TIUPUTS",108,0)
 Q:$D(DUOUT)!$D(DIROUT)!+$G(DTOUT)!'+$G(TIUDA)
"RTN","TIUPUTS",109,0)
 ; -- next, load fields from upload buffer entry --
"RTN","TIUPUTS",110,0)
 S TIUBUF=$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:"")
"RTN","TIUPUTS",111,0)
 ; -- if TIUDA may be edited, file data, else make addendum --
"RTN","TIUPUTS",112,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUTYP=+TIUD0
"RTN","TIUPUTS",113,0)
 I +$$CANEDIT(TIUDA)'>0 D  G FIXX
"RTN","TIUPUTS",114,0)
 . W !!,"Existing document may not be edited...Creating Addendum.",!
"RTN","TIUPUTS",115,0)
 . D MAKEADD^TIUPEFIX(.TIUADD,TIUDA,TIUBUF)
"RTN","TIUPUTS",116,0)
 . S SUCCESS=TIUADD
"RTN","TIUPUTS",117,0)
 ; -- Load the array TIUX from the buffer
"RTN","TIUPUTS",118,0)
 D LOADTIUX^TIUPEFIX(.TIUX,TIUBUF)
"RTN","TIUPUTS",119,0)
 ; -- finally, file data in TIU DOCUMENT file --
"RTN","TIUPUTS",120,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.001),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPUTS",121,0)
 K TIUX(.13),TIUX(1205),TIUX(1211),TIUX(1405)
"RTN","TIUPUTS",122,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPUTS",123,0)
 D FILE^TIUPEFIX(.SUCCESS,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPUTS",124,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",125,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU) K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUPUTS",126,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYP)
"RTN","TIUPUTS",127,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPUTS",128,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTS",129,0)
FIXX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPUTS",130,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPUTS",131,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPUTS",132,0)
 W "Done."
"RTN","TIUPUTS",133,0)
 S TIUDONE=1
"RTN","TIUPUTS",134,0)
 Q
"RTN","TIUPUTS",135,0)
DICW(TIUDA) ; Write identifiers
"RTN","TIUPUTS",136,0)
 N X,Y,VADM,VA,VAERR,TIUD0,TIUD12,TIUD13
"RTN","TIUPUTS",137,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUPUTS",138,0)
 W ?35,"Dated: ",$$DATE^TIULS(+TIUD13,"MM/DD/CCYY@HR:MIN"),?62,"By: ",$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI MI"),1,13)
"RTN","TIUPUTS",139,0)
 Q
"RTN","TIUPUTS",140,0)
DICS(TIUDA) ; Filter IX^DIC list
"RTN","TIUPUTS",141,0)
 N TIUD0,TIUY S TIUY=0
"RTN","TIUPUTS",142,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUPUTS",143,0)
 I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("OPERATION REPORTS")) S TIUY=1 I 1
"RTN","TIUPUTS",144,0)
 E  I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")) S TIUY=1
"RTN","TIUPUTS",145,0)
 Q TIUY
"RTN","TIURD")
0^6^B39906196
"RTN","TIURD",1,0)
TIURD ; SLC/JER - Reassign actions ;13-MAY-2002 11:41:59
"RTN","TIURD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,58,61,100,109,173**;Jun 20, 1997
"RTN","TIURD",3,0)
 ;
"RTN","TIURD",4,0)
REASSIGN ; Reassign selected Documents
"RTN","TIURD",5,0)
 N TIUCHNG,TIULST,TIUI,TIUY,RSTRCTD,TIUDAARY
"RTN","TIURD",6,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",7,0)
 S TIUI=0
"RTN","TIURD",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",9,0)
 . N TIUDA,DFN,TIU,TIUDATA,TIUVIEW
"RTN","TIURD",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",11,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURD",12,0)
 . W !!,"Processing Item #",TIUI,"..."
"RTN","TIURD",13,0)
 . D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,TIUDA,0))) I +TIUY W !,"This action is no longer permitted for SURGICAL REPORTS" H 1 Q
"RTN","TIURD",14,0)
 . I RSTRCTD D  Q
"RTN","TIURD",15,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURD",16,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURD",17,0)
 . I +$$HASIMG^TIURB2(TIUDA) D IMGNOTE^TIURB2 Q
"RTN","TIURD",18,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURD",19,0)
 . I '+TIUVIEW D  Q
"RTN","TIURD",20,0)
 . . W !!,$C(7),$C(7),$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURD",21,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",22,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",23,0)
 . S TIUCHNG=0
"RTN","TIURD",24,0)
 . D EN^VALM("TIU REASSIGN")
"RTN","TIURD",25,0)
 . I +$G(TIUCHNG) D
"RTN","TIURD",26,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURD",27,0)
 ; -- Rebuild list: --
"RTN","TIURD",28,0)
 S TIUCHNG("RBLD")=1
"RTN","TIURD",29,0)
 D UPRBLD^TIURL(.TIUCHNG) K VALMY
"RTN","TIURD",30,0)
 S VALMBCK="R"
"RTN","TIURD",31,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"reassigned")
"RTN","TIURD",32,0)
 Q
"RTN","TIURD",33,0)
 ;
"RTN","TIURD",34,0)
REASSIG1 ; Single record reassign
"RTN","TIURD",35,0)
 N TIUAUTH,TIURSSG,TIUNAME,DA,DR,DIE,TIUTYPE,TIUEDIT,TIUADD,TIUPROMO,TIUY
"RTN","TIURD",36,0)
 N TIUD0,TIUD12,TIUD13,TIUD14,TIUODA,TIUOUT K ^TMP("TIURTRCT",$J)
"RTN","TIURD",37,0)
 D FULL^VALM1
"RTN","TIURD",38,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,TIUDA,0))) I +TIUY W !,"This action is no longer permitted for SURGICAL REPORTS" H 3 Q
"RTN","TIURD",39,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURD",40,0)
 E  W !?5,$C(7),$C(7),$C(7),"Another user is editing this entry." S TIUY=$$READ^TIUU("EA","Press RETURN to continue...") Q
"RTN","TIURD",41,0)
 ; Authorized? NO: echo why not & quit
"RTN","TIURD",42,0)
 I +$$HASIMG^TIURB2(TIUDA) D IMGNOTE^TIURB2 Q
"RTN","TIURD",43,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  I 1
"RTN","TIURD",44,0)
 . N TIUDAD
"RTN","TIURD",45,0)
 . S TIUDAD=+$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIURD",46,0)
 . I +$$DADORKID^TIUGBR(TIUDAD) D
"RTN","TIURD",47,0)
 . . S TIURSSG="0^You must first detach the ORIGINAL interdisciplinary entry."
"RTN","TIURD",48,0)
 E  I $$DADORKID^TIUGBR(TIUDA) D  I 1
"RTN","TIURD",49,0)
 . S TIURSSG="0^You must first detach interdisciplinary entries."
"RTN","TIURD",50,0)
 I '$D(TIURSSG) S TIURSSG=$$CANDO^TIULP(+TIUDA,"REASSIGN")
"RTN","TIURD",51,0)
 I +$G(TIURSSG)'>0 D  G REASS1X
"RTN","TIURD",52,0)
 . W !!,$C(7),$C(7),$C(7),$P(TIURSSG,U,2),!
"RTN","TIURD",53,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",54,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUDA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD",55,0)
 S TIUD13(0)=$G(^TIU(8925,+TIUDA,13)),TIUD14(0)=$G(^(14))
"RTN","TIURD",56,0)
 S TIUTYPE=$P(TIUD0(0),U)
"RTN","TIURD",57,0)
 S TIUNAME=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIURD",58,0)
 S TIUAUTH=$P(TIUD12(0),U,2)
"RTN","TIURD",59,0)
 W !,$C(7)
"RTN","TIURD",60,0)
 S TIUY=$$READ^TIUU("YO","Are you sure you want to REASSIGN this "_TIUNAME,"NO","^D REAS1^TIUDIRH")
"RTN","TIURD",61,0)
 I +TIUY'>0 S TIUOUT=1 G REASS1X
"RTN","TIURD",62,0)
 I +$P(TIUD0(0),U,5)>5 D  G:+$G(TIUOUT) REASS1X
"RTN","TIURD",63,0)
 . W !!,$C(7),$C(7),"The status of this document is: ",$$UP^XLFSTR($$STATUS^TIULC(TIUDA))
"RTN","TIURD",64,0)
 . I +$$GETSIG^TIURD2'>0 S TIUOUT=1
"RTN","TIURD",65,0)
 . W !
"RTN","TIURD",66,0)
 ; Addendum? YES: Ask intended action is move, swap with original, or
"RTN","TIURD",67,0)
 ; replace original
"RTN","TIURD",68,0)
 S TIUADD=$$ISADDNDM^TIULC1(+TIUDA)
"RTN","TIURD",69,0)
 I +TIUADD D  G REASS1X
"RTN","TIURD",70,0)
 . D REASSIGA
"RTN","TIURD",71,0)
 D REASSIGO^TIURD3
"RTN","TIURD",72,0)
REASS1X L -^TIU(8925,+TIUDA):1
"RTN","TIURD",73,0)
 I +$G(TIUOUT),+$G(TIUODA),+$G(TIUDA),$D(TIUD0(0)) D RECOVER^TIURD4(TIUODA,TIUDA,.TIUD0) S TIUDA=TIUODA
"RTN","TIURD",74,0)
 ; Remove additional signers who haven't signed from retracted original
"RTN","TIURD",75,0)
 I '+$G(TIUOUT),+$G(TIUODA) D
"RTN","TIURD",76,0)
 . I +$O(^TIU(8925.7,"B",+$G(TIUODA),0)) D DELSGNRS^TIURD4(TIUODA,1)
"RTN","TIURD",77,0)
 . D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIURD",78,0)
 I '+$G(TIUOUT),+$G(TIUODA),+$$ISA^TIULX(+$G(TIUD0(0)),+$$CLASS^TIUCP) D
"RTN","TIURD",79,0)
 . N TIUCPY,TIUNVSTR
"RTN","TIURD",80,0)
 . Q:'$L($T(TIUREAS^MDAPI))
"RTN","TIURD",81,0)
 . S TIUNVSTR=$P(TIUD12(1),U,11)_";"_$P(TIUD0(1),U,7)
"RTN","TIURD",82,0)
 . S TIUNVSTR=TIUNVSTR_";"_$P(TIUD0(1),U,13)
"RTN","TIURD",83,0)
 . S TIUCPY=$$TIUREAS^MDAPI(+$P(TIUD0(0),U,2),+$P(TIUD14(0),U,5),+TIUODA,+$P(TIUD0(1),U,2),+$P($G(^TIU(8925,TIUDA,14)),U,5),TIUNVSTR,TIUDA)
"RTN","TIURD",84,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURD",85,0)
 S VALMBCK=$S(+$G(TIUCHNG):"Q",1:"R") K ^TMP("TIURTRCT",$J)
"RTN","TIURD",86,0)
 Q
"RTN","TIURD",87,0)
 ;
"RTN","TIURD",88,0)
REASSIGO ; Reassign an original Document
"RTN","TIURD",89,0)
 G REASSIGO^TIURD3
"RTN","TIURD",90,0)
 ;
"RTN","TIURD",91,0)
REASSIGA ;Reassign an Addendum to an original DS
"RTN","TIURD",92,0)
 N TIUACT,TIUSET S TIUCHNG=0
"RTN","TIURD",93,0)
 W !,"Please choose the appropriate action for this Addendum:"
"RTN","TIURD",94,0)
 S TIUSET="M:move addendum to a different document"
"RTN","TIURD",95,0)
 S TIUSET=TIUSET_";P:promote addendum as document for another visit"
"RTN","TIURD",96,0)
 S TIUSET=TIUSET_";R:replace parent document with this addendum"
"RTN","TIURD",97,0)
 S TIUSET=TIUSET_";S:swap this addendum with its parent document"
"RTN","TIURD",98,0)
 S TIUACT=$$READ^TIUU("S^"_TIUSET,"Select Reassign Action","move")
"RTN","TIURD",99,0)
 I $P(TIUACT,U)="M" D MOVEADD^TIURD1(TIUDA) Q
"RTN","TIURD",100,0)
 I $P(TIUACT,U)="P" D PROMOTE^TIURD1(TIUDA) Q
"RTN","TIURD",101,0)
 I $P(TIUACT,U)="R" D REPLACE^TIURD1(TIUDA) Q
"RTN","TIURD",102,0)
 I $P(TIUACT,U)="S" D SWAPADD^TIURD1(TIUDA)
"RTN","TIURD",103,0)
 Q
"RTN","TIURD",104,0)
 ;
"RTN","TIURD",105,0)
CLAPPLNK ; Re-link selected Documents to different Client Records
"RTN","TIURD",106,0)
 N TIUCHNG,TIULST,TIUDA,DFN,TIU,TIUDATA,TIUEDIT,TIUI,TIUY,Y,DIROUT,TIUPOP
"RTN","TIURD",107,0)
 N TIUDAARY
"RTN","TIURD",108,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",109,0)
 S TIUI=0 D FULL^VALM1
"RTN","TIURD",110,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",111,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",112,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",113,0)
 . S TIUCHNG=0
"RTN","TIURD",114,0)
 . D CLAPPLN1(TIUDA)
"RTN","TIURD",115,0)
 . I +$G(TIUCHNG)=1 D
"RTN","TIURD",116,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":", ",1:"")_TIUI
"RTN","TIURD",117,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURD",118,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURD",119,0)
 S VALMBCK="R"
"RTN","TIURD",120,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"reassigned")
"RTN","TIURD",121,0)
 Q
"RTN","TIURD",122,0)
 ;
"RTN","TIURD",123,0)
CLAPPLN1(TIUDA) ; Re-link a single record to the client application
"RTN","TIURD",124,0)
 N TIUREASX,TIUCVP,CANLNK,TIUY
"RTN","TIURD",125,0)
 I '$D(^TIU(8925,TIUDA,0)) D  Q
"RTN","TIURD",126,0)
 . W !!,$C(7),"Document no longer exists.",!
"RTN","TIURD",127,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",128,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,TIUDA,0))) I +TIUY W !,"This action is no longer permitted for SURGICAL REPORTS" H 3 Q
"RTN","TIURD",129,0)
 S TIUCVP=$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIURD",130,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","TIURD",131,0)
 . W !!,$C(7),"Links for ADDENDA can't be independently changed.",!
"RTN","TIURD",132,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",133,0)
 S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIURD",134,0)
 I TIUREASX']"" D  I 1
"RTN","TIURD",135,0)
 . W !!,$C(7),"No PACKAGE REASSIGNMENT ACTION Defined.",!
"RTN","TIURD",136,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",137,0)
 E  D
"RTN","TIURD",138,0)
 . N CANLNK
"RTN","TIURD",139,0)
 . I $$DADORKID^TIUGBR(TIUDA) D  ;**100**
"RTN","TIURD",140,0)
 . . S CANLNK="0^You must first detach interdisciplinary entries"
"RTN","TIURD",141,0)
 . E  S CANLNK=$$CANDO^TIULP(+TIUDA,"LINK WITH REQUEST")
"RTN","TIURD",142,0)
 . I +CANLNK'>0 D  Q
"RTN","TIURD",143,0)
 . . W !!,$C(7),$C(7),$P(CANLNK,U,2),!
"RTN","TIURD",144,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",145,0)
 . X TIUREASX S:$P($G(^TIU(8925,TIUDA,14)),U,5)'=TIUCVP TIUCHNG=1
"RTN","TIURD",146,0)
 Q
"RTN","TIUSROI")
0^4^B71551766
"RTN","TIUSROI",1,0)
TIUSROI ; SLC/JER - TIU/Surgery Interface Routine ; 04/19/2004
"RTN","TIUSROI",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187,173**;Jun 20, 1997
"RTN","TIUSROI",3,0)
 Q
"RTN","TIUSROI",4,0)
GETOP(TIUY,TIUDA,SROTYP) ; Get Op-Top
"RTN","TIUSROI",5,0)
 N SROVP
"RTN","TIUSROI",6,0)
 S SROVP=$P($G(^TIU(8925,TIUDA,14)),U,5),SROTYP=$G(SROTYP,"OP")
"RTN","TIUSROI",7,0)
 S TIUY=$S(SROTYP="OP":$NA(^TMP("SROP",$J,+SROVP)),1:$NA(^TMP("SRNOR",$J,+SROVP)))
"RTN","TIUSROI",8,0)
 I $P(SROVP,";",2)'="SRF(" Q
"RTN","TIUSROI",9,0)
 D @$S(SROTYP="OP":"OPTOP^SROSRPT(+SROVP)",1:"OPTOP^SRONP(+SROVP)")
"RTN","TIUSROI",10,0)
 I +$G(@TIUY@(0))=0 K @TIUY Q
"RTN","TIUSROI",11,0)
 I '$D(XWBOS),'$D(ZTQUEUED),($E($G(IOST))="C"),(@TIUY@(0)=2) D
"RTN","TIUSROI",12,0)
 . N SEEOP S SEEOP=0
"RTN","TIUSROI",13,0)
 . I $S(+$D(XQADATA):1,$G(TIUEVNT)["SIGN":1,1:0) D  Q:+SEEOP
"RTN","TIUSROI",14,0)
 . . W ! S SEEOP=+$$READ^TIUU("YA","Do you want to see the Op Top? ","YES")
"RTN","TIUSROI",15,0)
 . K @TIUY
"RTN","TIUSROI",16,0)
 I $D(XWBOS),($G(@TIUY@(0))'=1) K @TIUY
"RTN","TIUSROI",17,0)
 Q
"RTN","TIUSROI",18,0)
GETCASE(DFN,DA) ; Match Operation Report to an open Surgical Case
"RTN","TIUSROI",19,0)
 ; Call with:     [DFN] - patient file entry number
"RTN","TIUSROI",20,0)
 ;   Returns:     TIUY  - Variable pointer to Surgical Case
"RTN","TIUSROI",21,0)
AGN ; Loop for handling repeated attempts
"RTN","TIUSROI",22,0)
 N TIUI,TIUII,TIUER,TIUOK,TIUOUT,TIUX,TIUY,TIUMTSTR,TIUMLST,TIUCNT,X,TIULIST
"RTN","TIUSROI",23,0)
 I +DFN'>0 S TIUOUT=1 Q 0
"RTN","TIUSROI",24,0)
 I +$G(DA) D  G:+TIUX>0 GETX
"RTN","TIUSROI",25,0)
 . I +$P($G(^TIU(8925,+DA,14)),U,5) S TIUX=+$P($G(^(14)),U,5) Q
"RTN","TIUSROI",26,0)
 . I +$$ISADDNDM^TIULC1(+DA) S TIUX=+$$DADSC(DA)
"RTN","TIUSROI",27,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,+TIUDA,0))) I +TIUY W !,"This action is no longer permitted for SURGICAL REPORTS" H 3 Q 0
"RTN","TIUSROI",28,0)
 D LIST^SROESTV(.TIULIST,DFN,"","","",0) ; Call Surgery to get list of cases
"RTN","TIUSROI",29,0)
 ; If no Surgeries for patient, then quit
"RTN","TIUSROI",30,0)
 I '$D(@TIULIST) D  Q -1
"RTN","TIUSROI",31,0)
 . W !!,$C(7),"No SURGICAL CASES to Result for ",$$PTNAME^TIULC1(DFN),".",!
"RTN","TIUSROI",32,0)
 S (TIUCNT,TIUI)=0 F  S TIUI=+$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",33,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSROI",34,0)
 W !,"You must link your Result to a SURGICAL CASE...",!
"RTN","TIUSROI",35,0)
 D INDEX(TIULIST)
"RTN","TIUSROI",36,0)
 D  I +TIUER Q:+$G(TIUOUT) 0  G AGN
"RTN","TIUSROI",37,0)
 . W !,"The following SURGICAL CASE",$S(+TIUCNT>1:"(S) are",1:" is")," available:"
"RTN","TIUSROI",38,0)
 . S (TIUER,TIUOK,TIUI)=0
"RTN","TIUSROI",39,0)
 . F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0!+TIUER!+TIUOK  D
"RTN","TIUSROI",40,0)
 . . S TIUII=TIUI,TIUX=$G(@TIULIST@(TIUI))
"RTN","TIUSROI",41,0)
 . . D WRITE I '(TIUI#5) D BREAK
"RTN","TIUSROI",42,0)
 . Q:$D(TIUOUT)
"RTN","TIUSROI",43,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",44,0)
 . I TIUII#5 D BREAK Q:$D(TIUOUT)
"RTN","TIUSROI",45,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",46,0)
 . S TIUX=+@TIULIST@(TIUOK),^DISV(DUZ,"^SRF(",DFN)=+TIUX
"RTN","TIUSROI",47,0)
 . W "  ",+TIUX
"RTN","TIUSROI",48,0)
GETX S TIUY=+TIUX_";SRF(" K @TIULIST
"RTN","TIUSROI",49,0)
 Q $G(TIUY)
"RTN","TIUSROI",50,0)
BREAK ; Handle prompting
"RTN","TIUSROI",51,0)
 W !,"CHOOSE 1-",TIUII W:$D(@TIULIST@(TIUII+1)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT" W ": " R X:DTIME
"RTN","TIUSROI",52,0)
 I $S('$T!(X["^"):1,X=""&'$D(@TIULIST@(TIUII+1)):1,1:0) S TIUER=1 Q
"RTN","TIUSROI",53,0)
 I X="" Q
"RTN","TIUSROI",54,0)
 I X=" ",$D(^DISV(DUZ,"^SRF(",DFN)) S TIUX=^(DFN) S TIUOK=+$O(@TIULIST@("C",+TIUX,0)) Q
"RTN","TIUSROI",55,0)
 I X'=+X!'$D(@TIULIST@(+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUSROI",56,0)
 S TIUOK=X
"RTN","TIUSROI",57,0)
 Q
"RTN","TIUSROI",58,0)
DADSC(DA) ; Get the Surgical Case associated with the parent record
"RTN","TIUSROI",59,0)
 N TIUDADA,TIUY S TIUDADA=$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUSROI",60,0)
 S TIUY=$P($G(^TIU(8925,TIUDADA,14)),U,5)
"RTN","TIUSROI",61,0)
 Q TIUY
"RTN","TIUSROI",62,0)
WRITE ; Writes each case
"RTN","TIUSROI",63,0)
 W !,$J(TIUI,4),">  ",$$DATE^TIULS($P(TIUX,U,3),"AMTH DD, CCYY")
"RTN","TIUSROI",64,0)
 W " Case #",$P(TIUX,U),?34,$E($P(TIUX,U,2),1,25),?60,$E($P($P(TIUX,U,4),";",2),1,20)
"RTN","TIUSROI",65,0)
 Q
"RTN","TIUSROI",66,0)
INDEX(TIULIST) ; Build index of list
"RTN","TIUSROI",67,0)
 N TIUI S TIUI=0
"RTN","TIUSROI",68,0)
 F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",69,0)
 . S @TIULIST@("C",+@TIULIST@(TIUI),TIUI)=""
"RTN","TIUSROI",70,0)
 Q
"RTN","TIUSROI",71,0)
ISSURG(TIUY,TITLE) ; Boolean RPC to evaluate whether TITLE is a SURGERY REPORT
"RTN","TIUSROI",72,0)
 N TIUCLASS,TIUI S TIUY=0
"RTN","TIUSROI",73,0)
 F TIUI="SURGICAL REPORTS","PROCEDURE REPORTS (NON-O.R.)" D  Q:TIUY>0
"RTN","TIUSROI",74,0)
 . S TIUCLASS=+$$CLASS(TIUI)
"RTN","TIUSROI",75,0)
 . I +TIUCLASS'>0 Q
"RTN","TIUSROI",76,0)
 . S TIUY=+$$ISA^TIULX(TITLE,TIUCLASS)
"RTN","TIUSROI",77,0)
 Q
"RTN","TIUSROI",78,0)
RBOR(TIUDA) ; Roll back OPERATION REPORT when TIU changes require it
"RTN","TIUSROI",79,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5) Q:+SRODA'>0
"RTN","TIUSROI",80,0)
 D OS^SROTIUD(SRODA)
"RTN","TIUSROI",81,0)
 Q
"RTN","TIUSROI",82,0)
RBPR(TIUDA) ; Roll back NON-O.R. PROC REPORT when TIU changes require it
"RTN","TIUSROI",83,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI",84,0)
 Q:+SRODA'>0
"RTN","TIUSROI",85,0)
 D NON^SROTIUD(SRODA)
"RTN","TIUSROI",86,0)
 Q
"RTN","TIUSROI",87,0)
CLASS(CLNAME) ; What is the TIU Class (or Document Class) for SURGERY REPORTS
"RTN","TIUSROI",88,0)
 N TIUY S TIUY=+$O(^TIU(8925.1,"B",CLNAME,0))
"RTN","TIUSROI",89,0)
 I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S TIUY=0
"RTN","TIUSROI",90,0)
 Q TIUY
"RTN","TIUSROI",91,0)
ES(TIUDA,TIUDUZ) ; Apply user's e-Sig to Document
"RTN","TIUSROI",92,0)
 N TIUES S TIUDUZ=$G(TIUDUZ,DUZ)
"RTN","TIUSROI",93,0)
 I '+$G(^TIU(8925,TIUDA,0)) Q
"RTN","TIUSROI",94,0)
 S TIUES="1^"_$$SIGNAME^TIULS(TIUDUZ)_U_$$SIGTITL^TIULS(TIUDUZ)
"RTN","TIUSROI",95,0)
 D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSROI",96,0)
 Q
"RTN","TIUSROI",97,0)
ENTEROP(DFN,TIUTYP) ; Re-direct entry of Op and Proc Reports
"RTN","TIUSROI",98,0)
 N TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUTNM
"RTN","TIUSROI",99,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",100,0)
 ; -- Exclude NIR and AR from Entry
"RTN","TIUSROI",101,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  Q
"RTN","TIUSROI",102,0)
 . W !!,TIUTNM,"s may only be entered through the Surgery Options.",!
"RTN","TIUSROI",103,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",104,0)
 . W !
"RTN","TIUSROI",105,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUSROI",106,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUSROI",107,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUSROI",108,0)
 . S X=+$G(DFN)
"RTN","TIUSROI",109,0)
 . I X'>0 D  Q
"RTN","TIUSROI",110,0)
 . . W !!,"No Patient Specified...",!
"RTN","TIUSROI",111,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",112,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",113,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",114,0)
 . W ! S DIC("W")="D DICW^TIUPUTS(+Y)",DIC("S")="I +$G(^TIU(8925,+Y,0))=TIUTYP"
"RTN","TIUSROI",115,0)
 . D IX^DIC
"RTN","TIUSROI",116,0)
 . I +Y'>0 D  Q
"RTN","TIUSROI",117,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No "_TIUTNM_"s Available.",1:"No "_TIUTNM_" Selected..."),!
"RTN","TIUSROI",118,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",119,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",120,0)
 . D BROWS1^TIURA2("TIU BROWSE FOR TRANSCRIPTION",+Y)
"RTN","TIUSROI",121,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",122,0)
 Q
"RTN","TIUSROI",123,0)
REASSOP(DFN,TIUODA) ; Re-direct REASSIGNMENT of Op and Proc Reports
"RTN","TIUSROI",124,0)
 N TIUDA,TIUD0,TIUD12,TIUTYP,TIUTNM,TIUSCRN
"RTN","TIUSROI",125,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUODA,0)),TIUD12(0)=$G(^(12))
"RTN","TIUSROI",126,0)
 I DFN=$P(TIUD0(0),U,2) D CHANGE^TIUSROI1(TIUODA) Q
"RTN","TIUSROI",127,0)
 S TIUTYP=+TIUD0(0)
"RTN","TIUSROI",128,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",129,0)
 I +$$ISADDNDM^TIULC1(TIUODA),$S($$GET1^DIQ(8925,TIUODA,.06)["ANESTH":1,$$GET1^DIQ(8925,TIUODA,.06)["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",130,0)
 . W !!,"ADDENDUMs to ",$$GET1^DIQ(8925,TIUODA,.06),"s may not be reassigned.",!
"RTN","TIUSROI",131,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUSROI",132,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",133,0)
 S TIUDA=0
"RTN","TIUSROI",134,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",135,0)
 . W !!,TIUTNM,"s may only be created through the Surgery Options..."
"RTN","TIUSROI",136,0)
 . W !,"Reassignment is not allowed.",!
"RTN","TIUSROI",137,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",138,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",139,0)
 W ! S SROVP=$$GETCASE^TIUSROI(DFN)
"RTN","TIUSROI",140,0)
 I +SROVP'>0 D  Q
"RTN","TIUSROI",141,0)
 . W !!,$C(7),"Okay, no harm done...",!
"RTN","TIUSROI",142,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",143,0)
 ; if target case is same as current, quit
"RTN","TIUSROI",144,0)
 I +SROVP=+$P(^TIU(8925,TIUODA,14),U,5) D  Q
"RTN","TIUSROI",145,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI",146,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",147,0)
 ; Get the document for the target surgical case
"RTN","TIUSROI",148,0)
 S TIUDA=$$TARGET^TIUSROI1(SROVP)
"RTN","TIUSROI",149,0)
 ; if target document is of a different type than source, quit
"RTN","TIUSROI",150,0)
 I $$TYPE^TIUSROI1(TIUDA)'=$$TYPE^TIUSROI1(TIUODA) D  Q
"RTN","TIUSROI",151,0)
 . W !!,$C(7),"Incompatible document type. No changes made.",!
"RTN","TIUSROI",152,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",153,0)
 I +TIUDA'>0 D  G REASSOPX
"RTN","TIUSROI",154,0)
 . W !!,"No Destination Document Selected: Aborting Transaction,",!,"   No Harm Done...",!
"RTN","TIUSROI",155,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",156,0)
 ; -- If original and target are the same --
"RTN","TIUSROI",157,0)
 I +TIUDA=+TIUODA D  G REASSOPX
"RTN","TIUSROI",158,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI",159,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",160,0)
 ; -- Confirm selection --
"RTN","TIUSROI",161,0)
 I '$$FROMTO^TIUSROI1(TIUODA,TIUDA,TIUTNM) D  G REASSOPX
"RTN","TIUSROI",162,0)
 . W !!,"Aborting Transaction, No Harm Done...",!
"RTN","TIUSROI",163,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",164,0)
 ; -- Conditionally Retract Original --
"RTN","TIUSROI",165,0)
 I (+$P(TIUD0(0),U,5)>5) D
"RTN","TIUSROI",166,0)
 . N TIUMSG,TIURTCT S TIUMSG=$S(DFN=+$P(TIUD0(0),U,2):"Reassigning document...",DFN'=+$P(TIUD0(0),U,2):"Moving signed document to another Patient...")
"RTN","TIUSROI",167,0)
 . W !!,TIUMSG,!,"A RETRACTED copy will be retained.",!
"RTN","TIUSROI",168,0)
 . S TIURTCT=$$RETRACT^TIURD2(TIUODA,"",15)
"RTN","TIUSROI",169,0)
 ; -- Copy AUTHOR from original to target/Update target status --
"RTN","TIUSROI",170,0)
 D AUTHSTAT(TIUDA,TIUODA,.TIUD12)
"RTN","TIUSROI",171,0)
 ; -- Copy contents of original into target --
"RTN","TIUSROI",172,0)
 D COPYTEXT^TIURC1(TIUODA,TIUDA) K ^TIU(8925,TIUDA,15)
"RTN","TIUSROI",173,0)
 I $D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSROI",174,0)
 . N TIU
"RTN","TIUSROI",175,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSROI",176,0)
 . D MERGTEXT^TIUEDI1(TIUDA,.TIU)
"RTN","TIUSROI",177,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSROI",178,0)
 ; -- Conditionally roll back original --
"RTN","TIUSROI",179,0)
 I +$P(TIUD0(0),U,5)>5 D
"RTN","TIUSROI",180,0)
 . N TIUDA,TIUDELX
"RTN","TIUSROI",181,0)
 . S TIUDA=TIUODA
"RTN","TIUSROI",182,0)
 . S TIUDELX=$$DELETE^TIULC1(+$G(TIUD0(0)))
"RTN","TIUSROI",183,0)
 . I TIUDELX]"" X TIUDELX
"RTN","TIUSROI",184,0)
 I +$P(TIUD0(0),U,5)'>5 D
"RTN","TIUSROI",185,0)
 . N TIUX,SUCCESS
"RTN","TIUSROI",186,0)
 . K ^TIU(8925,TIUODA,"TEXT")
"RTN","TIUSROI",187,0)
 . S TIUX(.05)=1
"RTN","TIUSROI",188,0)
 . D FILE^TIUSRVP(.SUCCESS,TIUODA,.TIUX,1)
"RTN","TIUSROI",189,0)
 ; -- Send Signature Alerts for target --
"RTN","TIUSROI",190,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIUSROI",191,0)
 ; -- Delete Signature Alerts for Original --
"RTN","TIUSROI",192,0)
 D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIUSROI",193,0)
 ; -- Audit Reassignment of target --
"RTN","TIUSROI",194,0)
 S TIUD0(1)=$G(^TIU(8925,+TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIUSROI",195,0)
 D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIUSROI",196,0)
 ; -- Register audit trail for original
"RTN","TIUSROI",197,0)
 I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIUSROI",198,0)
 S TIUCHNG=1
"RTN","TIUSROI",199,0)
REASSOPX Q
"RTN","TIUSROI",200,0)
AUTHSTAT(TIUDA,TIUODA,TIUD12) ; Copy Author, update status
"RTN","TIUSROI",201,0)
 N TIUX,SUCCESS
"RTN","TIUSROI",202,0)
 S TIUX(.05)=5
"RTN","TIUSROI",203,0)
 S TIUX(1406)=TIUODA
"RTN","TIUSROI",204,0)
 I +$P(TIUD12(0),U,2) S TIUX(1202)=$P(TIUD12(0),U,2)
"RTN","TIUSROI",205,0)
 D FILE^TIUSRVP(.SUCCESS,TIUDA,.TIUX,1)
"RTN","TIUSROI",206,0)
 Q
"RTN","TIUSROI",207,0)
SELOP(DFN,TIUTYP,TIUSCRN) ; Select an Op or Proc Report
"RTN","TIUSROI",208,0)
 N DUOUT,DTOUT,D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV,TIUY,TIUTNM
"RTN","TIUSROI",209,0)
 S TIUY=0
"RTN","TIUSROI",210,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",211,0)
 S TIUSCRN=$G(TIUSCRN,"I +$G(^TIU(8925,+Y,0))=TIUTYP")
"RTN","TIUSROI",212,0)
 S X=+$G(DFN)
"RTN","TIUSROI",213,0)
 I X'>0 D  G SELOPX
"RTN","TIUSROI",214,0)
 . W !!,"No Patient Specified...",!
"RTN","TIUSROI",215,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",216,0)
 . W !
"RTN","TIUSROI",217,0)
 S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",218,0)
 W !
"RTN","TIUSROI",219,0)
 S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUSROI",220,0)
 S DIC("S")=TIUSCRN
"RTN","TIUSROI",221,0)
 D IX^DIC
"RTN","TIUSROI",222,0)
 I +Y'>0 D
"RTN","TIUSROI",223,0)
 . W !!,"No "_TIUTNM
"RTN","TIUSROI",224,0)
 . W $S(+$O(^TIU(8925,"APT",DFN,TIUTYP,0))'>0:"s On File.",+$O(^(0))>2:"s Available.",1:" Selected..."),!
"RTN","TIUSROI",225,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",226,0)
 . W !
"RTN","TIUSROI",227,0)
 S TIUY=+Y
"RTN","TIUSROI",228,0)
SELOPX Q TIUY
"RTN","TIUSROI1")
0^9^B43726026
"RTN","TIUSROI1",1,0)
TIUSROI1 ; SLC/JER - Reassign actions ; 04/19/2004
"RTN","TIUSROI1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187,173**;Jun 20, 1997
"RTN","TIUSROI1",3,0)
 Q
"RTN","TIUSROI1",4,0)
FROMTO(TIUODA,TIUDA,TIUTNM) ; Display the from/to information
"RTN","TIUSROI1",5,0)
 N TIUF,TIUF12,TIUT,TIUT12,TIUFEDT,TIUFLDT,TIUTEDT,TIUTLDT
"RTN","TIUSROI1",6,0)
 D GETTIU^TIULD(.TIUF,+TIUODA)
"RTN","TIUSROI1",7,0)
 D GETTIU^TIULD(.TIUT,+TIUDA)
"RTN","TIUSROI1",8,0)
 S TIUFEDT=$$DATE^TIULS($P(TIUF("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",9,0)
 S TIUFLDT=$$DATE^TIULS($P(TIUF("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",10,0)
 S TIUTEDT=$$DATE^TIULS($P(TIUT("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",11,0)
 S TIUTLDT=$$DATE^TIULS($P(TIUT("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",12,0)
 S TIUF12=$G(^TIU(8925,TIUODA,12)),TIUT12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUSROI1",13,0)
 W !!,"You are about to move the ",TIUTNM," as follows:",!
"RTN","TIUSROI1",14,0)
 W !,?5,"From",?45,"To",!
"RTN","TIUSROI1",15,0)
 W !,$P(TIUF("DOCTYP"),U,2),?35," --> ",?40,$P(TIUT("DOCTYP"),U,2)
"RTN","TIUSROI1",16,0)
 W !,TIUF("PNM")," ",TIUF("PID"),?35," --> ",?40,TIUT("PNM")," ",TIUT("PID")
"RTN","TIUSROI1",17,0)
 W !,TIUFEDT,$S(+TIUFLDT:" - "_TIUFLDT,1:""),?35," --> "
"RTN","TIUSROI1",18,0)
 W ?40,TIUTEDT,$S(+TIUTLDT:" - "_TIUTLDT,1:""),!
"RTN","TIUSROI1",19,0)
 W !,"     Surgeon: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,2)),?35," --> "
"RTN","TIUSROI1",20,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUF12,U,2))
"RTN","TIUSROI1",21,0)
 W !,"   Attending: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,9)),?35," --> "
"RTN","TIUSROI1",22,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUT12,U,9))
"RTN","TIUSROI1",23,0)
 W !,"Surg. Case #: ",+$P($G(^TIU(8925,TIUODA,14)),U,5),?35," --> "
"RTN","TIUSROI1",24,0)
 W ?40,+$P($G(^TIU(8925,TIUDA,14)),U,5),!
"RTN","TIUSROI1",25,0)
 Q +$$READ^TIUU("YA"," ... Ok? ","NO")
"RTN","TIUSROI1",26,0)
ANES(TIUDA) ; Roll back ANESTHESIA REPORT when TIU changes require it
"RTN","TIUSROI1",27,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",28,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",29,0)
 D ANES^SROTIUD(SRODA)
"RTN","TIUSROI1",30,0)
 Q
"RTN","TIUSROI1",31,0)
NURS(TIUDA) ; Roll back NURSE INTRAOPERATIVE REPORT when TIU changes require it
"RTN","TIUSROI1",32,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",33,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",34,0)
 D NURS^SROTIUD(SRODA)
"RTN","TIUSROI1",35,0)
 Q
"RTN","TIUSROI1",36,0)
RETRACT(TIUDA) ;
"RTN","TIUSROI1",37,0)
 N CNT,TITLE,TIUACT,TIUDATA
"RTN","TIUSROI1",38,0)
 S TIUDATA="ANESTHESIA REPORTS^NURSE INTRAOPERATIVE REPORTS^OPERATION REPORTS^PROCEDURE REPORT (NON-O.R.)"
"RTN","TIUSROI1",39,0)
 F CNT=1:1:$L(TIUDATA,U) S TITLE=$P(TIUDATA,U,CNT) I $$BELONGS^TIULX(TIUDA,$$FIND1^DIC(8925.1,"","BX",TITLE)) D
"RTN","TIUSROI1",40,0)
 . S TIUACT=$S(CNT=1:"ANES^TIUSROI1(TIUDA)",CNT=2:"NURS^TIUSROI1(TIUDA)",CNT=3:"RBOR^TIUSROI(TIUDA)",CNT=4:"RBPR^TIUSROI(TIUDA)",1:"QUIT")
"RTN","TIUSROI1",41,0)
 . I TIUACT="QUIT" Q
"RTN","TIUSROI1",42,0)
 . D @TIUACT
"RTN","TIUSROI1",43,0)
 Q
"RTN","TIUSROI1",44,0)
CHANGE(TIUDA) ; Redirect the TIU Document to a different Surgical Case
"RTN","TIUSROI1",45,0)
 N DFN,SROVP,TIUD0,TIUD14,TIUNDA,TIUACT
"RTN","TIUSROI1",46,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD14=$G(^(14)),SROVP=$P(TIUD14,U,5)
"RTN","TIUSROI1",47,0)
 S DFN=$P(TIUD0,U,2) Q:+DFN'>0
"RTN","TIUSROI1",48,0)
 ; choose destination case
"RTN","TIUSROI1",49,0)
 W ! S SROVP=$$GETCASE^TIUSROI(DFN)
"RTN","TIUSROI1",50,0)
 ; if no case is selected, quit
"RTN","TIUSROI1",51,0)
 I +SROVP'>0 D  Q
"RTN","TIUSROI1",52,0)
 . W !!,$C(7),"Okay, no harm done...",!
"RTN","TIUSROI1",53,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",54,0)
 ; if target case is same as current, quit
"RTN","TIUSROI1",55,0)
 I +SROVP=+$P(TIUD14,U,5) D  Q
"RTN","TIUSROI1",56,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI1",57,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",58,0)
 ; Get the document for the target surgical case
"RTN","TIUSROI1",59,0)
 S TIUNDA=$$TARGET(SROVP)
"RTN","TIUSROI1",60,0)
 ; if target document is of a different type than source, quit
"RTN","TIUSROI1",61,0)
 I $$TYPE(TIUNDA)'=$$TYPE(TIUDA) D  Q
"RTN","TIUSROI1",62,0)
 . W !!,$C(7),"Incompatible document type. No changes made.",!
"RTN","TIUSROI1",63,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",64,0)
 ; if target case has empty report, replace
"RTN","TIUSROI1",65,0)
 S TIUTYP=+TIUD0
"RTN","TIUSROI1",66,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI1",67,0)
 I '$$FROMTO^TIUSROI1(TIUDA,TIUNDA,TIUTNM) D  Q
"RTN","TIUSROI1",68,0)
 . W !!,"Aborting Transaction, No Harm Done...",!
"RTN","TIUSROI1",69,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI1",70,0)
 I +$$EMPTYDOC^TIULF(TIUNDA) D  Q
"RTN","TIUSROI1",71,0)
 . W !!,"Moving document ",TIUDA," to Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",72,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",73,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",74,0)
 ; else, ask whether to swap or replace
"RTN","TIUSROI1",75,0)
 S TIUACT=$$ASKACT($$TITLE(TIUNDA))
"RTN","TIUSROI1",76,0)
 I $P(TIUACT,U)="E"!($P(TIUACT,U)="") D  Q
"RTN","TIUSROI1",77,0)
 . W !!,"Great. No harm done.",!
"RTN","TIUSROI1",78,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",79,0)
 I $P(TIUACT,U)="R" D  Q
"RTN","TIUSROI1",80,0)
 . W !!,"Replacing ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",81,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",82,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",83,0)
 I $P(TIUACT,U)="S" D
"RTN","TIUSROI1",84,0)
 . W !!,"Swapping with ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",85,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",86,0)
 . D SWAP(TIUDA,TIUNDA)
"RTN","TIUSROI1",87,0)
 Q
"RTN","TIUSROI1",88,0)
ASKACT(TITLE) ; ask user to choose replace or swap
"RTN","TIUSROI1",89,0)
 N TIUY,TIUSET S TIUY=""
"RTN","TIUSROI1",90,0)
 W !!,"Please choose the appropriate action for this "_TITLE_":"
"RTN","TIUSROI1",91,0)
 S TIUSET="R:replace target document with this document"
"RTN","TIUSROI1",92,0)
 S TIUSET=TIUSET_";S:swap target document with this document"
"RTN","TIUSROI1",93,0)
 S TIUSET=TIUSET_";E:exit and do nothing"
"RTN","TIUSROI1",94,0)
 S TIUY=$$READ^TIUU("S^"_TIUSET,"Select Action","exit")
"RTN","TIUSROI1",95,0)
 Q TIUY
"RTN","TIUSROI1",96,0)
TITLE(TIUDA) ; resolve title of document
"RTN","TIUSROI1",97,0)
 Q $P($G(^TIU(8925.1,+$G(^TIU(8925,TIUDA,0)),0)),U)
"RTN","TIUSROI1",98,0)
TYPE(TIUDA) ; identifies type of document (i.e., Op Report or Proc Report)
"RTN","TIUSROI1",99,0)
 N TIUY,TIUCOR,TIUCPR S TIUY=""
"RTN","TIUSROI1",100,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",101,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",102,0)
 I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCOR) S TIUY="OS" I 1
"RTN","TIUSROI1",103,0)
 E  I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCPR) S TIUY="PR"
"RTN","TIUSROI1",104,0)
 Q TIUY
"RTN","TIUSROI1",105,0)
TARGET(TIUCASE) ; Get report ien for case
"RTN","TIUSROI1",106,0)
 N TIUI,TIUNDA,TIUCOR,TIUCPR S (TIUI,TIUNDA)=0
"RTN","TIUSROI1",107,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",108,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",109,0)
 F  S TIUI=$O(^TIU(8925,"G",TIUCASE,TIUI)) Q:+TIUI'>0  D  Q:+TIUNDA
"RTN","TIUSROI1",110,0)
 . I $P($G(^TIU(8925,TIUI,0)),U,5)=15 Q
"RTN","TIUSROI1",111,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCOR) S TIUNDA=TIUI Q
"RTN","TIUSROI1",112,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCPR) S TIUNDA=TIUI
"RTN","TIUSROI1",113,0)
 Q TIUNDA
"RTN","TIUSROI1",114,0)
REPLACE(TIUDA1,TIUDA2) ; Replace TIUDA2 with TIUDA1
"RTN","TIUSROI1",115,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142,TIUTYPE,TIUNODEL
"RTN","TIUSROI1",116,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",117,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",118,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",119,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",120,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",121,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",122,0)
 ; 1. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",123,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",124,0)
 ; 2. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",125,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",126,0)
 ; 3. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",127,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",128,0)
 ; 4. Delete or Retract TIUDA2
"RTN","TIUSROI1",129,0)
 I +$P(TIUD02,U,5)<6 D DIK^TIURB2(TIUDA2,1) I 1
"RTN","TIUSROI1",130,0)
 E  S TIUNODEL=1,TIUDA2=$$RETRACT^TIURD2(TIUDA2,"",14)
"RTN","TIUSROI1",131,0)
 ; 5. Rollback SRODA1 (create new stub)
"RTN","TIUSROI1",132,0)
 S TIUTYPE=$$TYPE(TIUDA1)
"RTN","TIUSROI1",133,0)
 I TIUTYPE="OS" D OS^SROTIUD(SRODA1) I 1
"RTN","TIUSROI1",134,0)
 E  I TIUTYPE="PR" D NON^SROTIUD(SRODA1)
"RTN","TIUSROI1",135,0)
 Q
"RTN","TIUSROI1",136,0)
SWAP(TIUDA1,TIUDA2) ; Swap TIUDA1 with TIUDA2
"RTN","TIUSROI1",137,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142
"RTN","TIUSROI1",138,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",139,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",140,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",141,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",142,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",143,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",144,0)
 ; 1. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",145,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",146,0)
 ; 2. Redirect TIUDA2 to TIUDA1's surgical case
"RTN","TIUSROI1",147,0)
 D RDTIU(TIUDA2,SRODA1)
"RTN","TIUSROI1",148,0)
 ; 3. Redirect TIUDA1's surgical case to TIUDA2
"RTN","TIUSROI1",149,0)
 D RDSURG(SRODA1,TIUDA2)
"RTN","TIUSROI1",150,0)
 ; 4. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",151,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",152,0)
 ; 5. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",153,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",154,0)
 Q
"RTN","TIUSROI1",155,0)
RDSURG(SRODA,TIUDA) ; Redirect surgical case to new document
"RTN","TIUSROI1",156,0)
 N DA,DIE,DR,TIUTYP S TIUTYP=$$TYPE(TIUDA) Q:TIUTYP']""
"RTN","TIUSROI1",157,0)
 S DIE=130,DA=SRODA,DR=$S(TIUTYP="OS":1000,TIUTYP="PR":1002,1:"")
"RTN","TIUSROI1",158,0)
 S DR=DR_"////^S X=TIUDA" D ^DIE
"RTN","TIUSROI1",159,0)
 Q
"RTN","TIUSROI1",160,0)
RDTIU(TIUDA,SRODA) ; Redirect document to new surgical case
"RTN","TIUSROI1",161,0)
 N DA,DIE,DR,SROVP S SROVP=SRODA_";SRF("
"RTN","TIUSROI1",162,0)
 S DIE=8925,DA=TIUDA,DR="1405////^S X=SROVP" D ^DIE
"RTN","TIUSROI1",163,0)
 Q
"RTN","TIUSROI1",164,0)
SWAPCOMM(TIUDA1,TIUDA2) ; Swap the comments field for two TIU Documents
"RTN","TIUSROI1",165,0)
 N DA,DIE,DR,COMM1,COMM2
"RTN","TIUSROI1",166,0)
 S COMM1=$G(^TIU(8925,TIUDA1,17)),COMM2=$G(^TIU(8925,TIUDA2,17))
"RTN","TIUSROI1",167,0)
 S DA=TIUDA1,DIE=8925,DR="1701////^S X=COMM2" D ^DIE
"RTN","TIUSROI1",168,0)
 S DA=TIUDA2,DIE=8925,DR="1701////^S X=COMM1" D ^DIE
"RTN","TIUSROI1",169,0)
 Q
"RTN","TIUSRVG")
0^10^B26888828
"RTN","TIUSRVG",1,0)
TIUSRVG ; SLC/JER - Silent Server Calls ;12/21/94  17:50
"RTN","TIUSRVG",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**173**;Jun 20, 1997
"RTN","TIUSRVG",3,0)
MULTIPLE(TIUY,TIUDA,TIUECHO) ; Get multiple records
"RTN","TIUSRVG",4,0)
 N TIUI,TIUX,TIULAST S TIUI=0
"RTN","TIUSRVG",5,0)
 K ^TMP("TIUVIEW",$J)
"RTN","TIUSRVG",6,0)
 F  S TIUI=$O(TIUDA(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVG",7,0)
 . S TIUX=$G(TIUDA(TIUI)) D GET(.TIUY,TIUX,TIUI,+$G(TIUECHO),1)
"RTN","TIUSRVG",8,0)
 Q
"RTN","TIUSRVG",9,0)
GET(TIUY,TIUDA,TIUITEM,TIUECHO,TIUACCUM) ; Get a record
"RTN","TIUSRVG",10,0)
 N DIC,DIQ,X,Y
"RTN","TIUSRVG",11,0)
 N TIUI,TIUJ,TIUL,TIUREC S (TIUDADD,TIUI)=0
"RTN","TIUSRVG",12,0)
 N DA,DIC,DIQ,DR,TIUFILE,TIUNAM
"RTN","TIUSRVG",13,0)
 K:'+$G(TIUACCUM) ^TMP("TIUVIEW",$J)
"RTN","TIUSRVG",14,0)
 S DA=TIUDA
"RTN","TIUSRVG",15,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1,TIUY="-1^NONEXISTENT RECORD" Q
"RTN","TIUSRVG",16,0)
 S (TIUFILE,DIC)=8925,DIQ="TIUREC("
"RTN","TIUSRVG",17,0)
 S DR=".01;.02;.05;.07:.1;1202;1204;1301;1302;1305;1306;1501;1502;1505;1506;1601:1604"
"RTN","TIUSRVG",18,0)
 D EN^DIQ1
"RTN","TIUSRVG",19,0)
 I $D(TIUREC)>9 D
"RTN","TIUSRVG",20,0)
 . W:+$G(TIUECHO) !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUSRVG",21,0)
 . F TIUJ=1:1:3 S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=$$SETREC(TIUJ)
"RTN","TIUSRVG",22,0)
 . S (TIUJ,TIUL)=4,^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=" "
"RTN","TIUSRVG",23,0)
 D LOADREC(TIUDA,TIUITEM,.TIUJ,.TIUL)
"RTN","TIUSRVG",24,0)
 I $L($G(TIUREC(8925,+TIUDA,1601))) D
"RTN","TIUSRVG",25,0)
 . N TIUMODE
"RTN","TIUSRVG",26,0)
 . S TIUJ=+$G(TIUJ)+1,^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)="",TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",27,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",28,0)
 . S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=$G(TIUREC(8925,TIUDA,1601))_"  AMENDMENT FILED:"
"RTN","TIUSRVG",29,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",30,0)
 . S TIUJ=+$G(TIUJ)+1,^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)="",TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",31,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",32,0)
 . S TIUMODE=$S($G(TIUREC(8925,TIUDA,1603))]"":"/es/ ",1:"/chart/ ")
"RTN","TIUSRVG",33,0)
 . S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=TIUMODE_$G(TIUREC(8925,TIUDA,1602))
"RTN","TIUSRVG",34,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",35,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",36,0)
 . ;S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=$P(TIUPRM1,U,5)
"RTN","TIUSRVG",37,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",38,0)
 I +$G(TIUACCUM) D
"RTN","TIUSRVG",39,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",40,0)
 . S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=" "
"RTN","TIUSRVG",41,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",42,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",43,0)
 . S $P(^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0),"=",79)=""
"RTN","TIUSRVG",44,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",45,0)
 ; S ^TMP("TIUVIEW",$J,TIUITEM,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUSRVG",46,0)
 S TIUY="^TMP(""TIUVIEW"","_$J_")",TIUL=+$P($G(^TMP("TIUVIEW",$J,0)),U,3)+TIUL
"RTN","TIUSRVG",47,0)
 S ^TMP("TIUVIEW",$J,0)="^^"_TIUL_U_TIUL_U_DT,VALMCNT=TIUL
"RTN","TIUSRVG",48,0)
 Q
"RTN","TIUSRVG",49,0)
LOADREC(TIUDA,TIUITEM,TIUJ,TIUL,TIUDAD) ; Load ^TMP
"RTN","TIUSRVG",50,0)
 N TIUKID,TIUDADT,TIUI S TIUI=0
"RTN","TIUSRVG",51,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVG",52,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVG",53,0)
 . S ^TMP("TIUVIEW",$J,TIUITEM,TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRVG",54,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVG",55,0)
 S TIUKID=0
"RTN","TIUSRVG",56,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVG",57,0)
 . N TIUTYP S TIUTYP=$P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUKID,0)),0)),U)
"RTN","TIUSRVG",58,0)
 . I TIUTYP="ADDENDUM" D LOADADD(TIUKID,.TIUL) I 1
"RTN","TIUSRVG",59,0)
 . E  D LOADREC(TIUKID,TIUITEM,.TIUJ,.TIUL,TIUDA)
"RTN","TIUSRVG",60,0)
 Q
"RTN","TIUSRVG",61,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRVG",62,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG
"RTN","TIUSRVG",63,0)
 ;I +$$CANSEE^TIULP(+TIUDADD)'>0 Q
"RTN","TIUSRVG",64,0)
 S TIUJ=0,TIUI=+$G(TIUL)+1,^TMP("TIUVIEW",$J,TIUDADD,TIUI,0)=" "
"RTN","TIUSRVG",65,0)
 S TIUDADT=$$DATE^TIULS($P(^TIU(8925,+TIUDADD,13),U),"MM/DD/YY")
"RTN","TIUSRVG",66,0)
 S TIUI=TIUI+1,^TMP("TIUVIEW",$J,TIUDADD,TIUI,0)=TIUDADT_" ADDENDUM:"
"RTN","TIUSRVG",67,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRVG",68,0)
 . S (TIUI,TIUL)=+$G(TIUI)+1
"RTN","TIUSRVG",69,0)
 . S ^TMP("TIUVIEW",$J,TIUDADD,TIUI,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRVG",70,0)
 S (TIUI,TIUL)=TIUL+1
"RTN","TIUSRVG",71,0)
 S TIUSIG=$S(+$P(^TIU(8925,+TIUDADD,15),U)&($P(^(15),U,3)="E"):"/es/ ",1:"     ")_$$SIGNAME^TIULS($P(^TIU(8925,+TIUDADD,15),U,2))
"RTN","TIUSRVG",72,0)
 S TIUCSIG=$S(+$P(^TIU(8925,+TIUDADD,15),U,5)&($P(^(15),U,7)="E"):"/es/ ",1:"     ")_$$SIGNAME^TIULS($P(^TIU(8925,+TIUDADD,15),U,6))
"RTN","TIUSRVG",73,0)
 S TIUSIG=$$SETSTR^VALM1(TIUSIG,$G(TIUSIG),1,35)
"RTN","TIUSRVG",74,0)
 S TIUSIG=$$SETSTR^VALM1(TIUCSIG,$G(TIUSIG),40,35)
"RTN","TIUSRVG",75,0)
 S ^TMP("TIUVIEW",$J,TIUDADD,TIUI,0)=TIUSIG
"RTN","TIUSRVG",76,0)
 S (TIUI,TIUL)=TIUL+1
"RTN","TIUSRVG",77,0)
 S TIUDAUTH=$$SIGNAME^TIULS($P(^TIU(8925,+TIUDADD,12),U,2))
"RTN","TIUSRVG",78,0)
 S TIUDATT=$$SIGNAME^TIULS($P(^TIU(8925,+TIUDADD,12),U,4))
"RTN","TIUSRVG",79,0)
 S TIUDAUTH=$$SETSTR^VALM1($S(TIUSIG]"     "&(TIUSIG'[TIUDAUTH):"for  ",1:"     ")_TIUDAUTH,$G(TIUDAUTH),1,35)
"RTN","TIUSRVG",80,0)
 S TIUDAUTH=$$SETSTR^VALM1($S(TIUCSIG]"     "&(TIUCSIG'[TIUDATT):"for  ",1:"     ")_TIUDATT,$G(TIUDAUTH),40,35)
"RTN","TIUSRVG",81,0)
 S ^TMP("TIUVIEW",$J,TIUDADD,TIUI,0)=TIUDAUTH
"RTN","TIUSRVG",82,0)
 Q
"RTN","TIUSRVG",83,0)
SETREC(LINE) ; Calls $$SETSTR^VALM1 for each line of ^TMP("TIUVIEW",$J,
"RTN","TIUSRVG",84,0)
 N Y
"RTN","TIUSRVG",85,0)
 I LINE="HDR" D
"RTN","TIUSRVG",86,0)
 . S Y=$$SETSTR^VALM1($$NAME^TIULS(TIU("PNM"),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUSRVG",87,0)
 . S Y=$$SETSTR^VALM1(TIU("SSN"),$G(Y),16,12)
"RTN","TIUSRVG",88,0)
 . S Y=$$SETSTR^VALM1($P(TIU("WARD"),U,2),$G(Y),30,20)
"RTN","TIUSRVG",89,0)
 . I +TIU("DOCTYP")=1 D
"RTN","TIUSRVG",90,0)
 . . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY"),$G(Y),51,13)
"RTN","TIUSRVG",91,0)
 . . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/YY"),$G(Y),66,13)
"RTN","TIUSRVG",92,0)
 . I +TIU("DOCTYP")'=1 D
"RTN","TIUSRVG",93,0)
 . . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY@HR:MIN"),$G(Y),53,26)
"RTN","TIUSRVG",94,0)
 I LINE=1 D
"RTN","TIUSRVG",95,0)
 . S Y=$$SETSTR^VALM1("DICT DATE: "_$G(TIUREC(8925,+TIUDA,1301)),$G(Y),3,39)
"RTN","TIUSRVG",96,0)
 . S Y=$$SETSTR^VALM1("TRANSC DATE: "_$G(TIUREC(8925,+TIUDA,1201)),$G(Y),37,39)
"RTN","TIUSRVG",97,0)
 I LINE=2 D
"RTN","TIUSRVG",98,0)
 . S Y=$$SETSTR^VALM1("ATTENDING: "_$G(TIUREC(8925,+TIUDA,1204)),$G(Y),39,40)
"RTN","TIUSRVG",99,0)
 . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S Y=$$SETSTR^VALM1("SURGEON: "_$G(TIUREC(8925,+TIUDA,1202)),$G(Y),1,32) Q
"RTN","TIUSRVG",100,0)
 . S Y=$$SETSTR^VALM1("DICTATED BY: "_$G(TIUREC(8925,+TIUDA,1202)),$G(Y),1,32)
"RTN","TIUSRVG",101,0)
 I LINE=3 D
"RTN","TIUSRVG",102,0)
 . S Y=$$SETSTR^VALM1("URGENCY: "_$G(TIUREC(8925,+TIUDA,.09)),$G(Y),5,36)
"RTN","TIUSRVG",103,0)
 . S Y=$$SETSTR^VALM1("DOC STATUS: "_$G(TIUREC(8925,+TIUDA,.05)),$G(Y),38,41)
"RTN","TIUSRVG",104,0)
 Q Y
"RTN","TIUSRVR1")
0^3^B35264342
"RTN","TIUSRVR1",1,0)
TIUSRVR1 ; SLC/JER - RPC for record-wise GET ; 01/22/2002 16:48
"RTN","TIUSRVR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,32,87,89,100,109,112,173**;Jun 20, 1997
"RTN","TIUSRVR1",3,0)
TGET(TIUY,TIUDA,ACTION) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUSRVR1",4,0)
 N TIUL,TIUREC,TIUARR,TIUGDATA,TIUNAME,TIUPRM0,TIUPRM1,X,Y,TIUCPF,ONBROWSE
"RTN","TIUSRVR1",5,0)
 K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",6,0)
 S ACTION=$G(ACTION,"VIEW"),TIUL=0
"RTN","TIUSRVR1",7,0)
 D SETPARM^TIULE
"RTN","TIUSRVR1",8,0)
 S TIUGDATA=$$SETGDATA(TIUDA)
"RTN","TIUSRVR1",9,0)
 ; I +$D(^TIU(8925,TIUDA,"TEMP")) D MERGTEXT^TIUSRVR(TIUDA)
"RTN","TIUSRVR1",10,0)
 S TIUY=$NA(^TMP("TIUVIEW",$J))
"RTN","TIUSRVR1",11,0)
 S TIUARR="^TMP(""TIUVIEW"",$J)"
"RTN","TIUSRVR1",12,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRVR1",13,0)
 ; Initialize ^TMP("TIU FOCUS",$J) to the entry that has focus
"RTN","TIUSRVR1",14,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUSRVR1",15,0)
 ; if the document has a browse action, execute it
"RTN","TIUSRVR1",16,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVR1",17,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUSRVR1",18,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",19,0)
 ;Set a flag to indicate whether or not a Title is a memer of the
"RTN","TIUSRVR1",20,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVR1",21,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRVR1",22,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",23,0)
 D INQUIRE^TIUSRVR2(TIUDA,.TIUREC,TIUCPF)
"RTN","TIUSRVR1",24,0)
 ; First, load dictation, transcription data, etc.
"RTN","TIUSRVR1",25,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA,TIUCPF)
"RTN","TIUSRVR1",26,0)
 ; Next, load the remainder of the record
"RTN","TIUSRVR1",27,0)
 D LOADREC^TIUSRVR2(TIUDA,.TIUL,TIUGDATA,0,ACTION)
"RTN","TIUSRVR1",28,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",29,0)
 S VALMCNT=+$G(TIUL)
"RTN","TIUSRVR1",30,0)
 Q
"RTN","TIUSRVR1",31,0)
SETGDATA(TIUDA) ; Set TIUGDATA
"RTN","TIUSRVR1",32,0)
 N TIUDPRM,TIUY,SORT S TIUY=""
"RTN","TIUSRVR1",33,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,TIUDA,0)),.TIUDPRM,TIUDA)
"RTN","TIUSRVR1",34,0)
 S SORT=$S(+$P(TIUDPRM(0),U,18):"TITLE",1:"REFDT")
"RTN","TIUSRVR1",35,0)
 I +$G(^TIU(8925,TIUDA,21)) S TIUY=TIUDA_U_0_U_+$G(^(21))_U_SORT G SETGX
"RTN","TIUSRVR1",36,0)
 I +$O(^TIU(8925,"GDAD",TIUDA,0)) S TIUY=TIUDA_U_1_U_0_U_SORT
"RTN","TIUSRVR1",37,0)
SETGX Q TIUY
"RTN","TIUSRVR1",38,0)
LOADSUPP(METHOD,TIUDA,TIUL) ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRVR1",39,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRVR1",40,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRVR1",41,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR1",42,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUSRVR1",43,0)
 S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=" "
"RTN","TIUSRVR1",44,0)
 K @TIUY
"RTN","TIUSRVR1",45,0)
 Q
"RTN","TIUSRVR1",46,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA,TIUCPF) ; Load top information
"RTN","TIUSRVR1",47,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUSRVR1",48,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUSRVR1",49,0)
 ;      entry, since they vary by entry.
"RTN","TIUSRVR1",50,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUSRVR1",51,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUSRVR1",52,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUSRVR1",53,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUSRVR1",54,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUSRVR1",55,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUSRVR1",56,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUSRVR1",57,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUSRVR1",58,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUSRVR1",59,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUSRVR1",60,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUSRVR1",61,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUSRVR1",62,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUSRVR1",63,0)
 I SELCHLD!SELPRNT D IDTOP(TIUDA,.TIUL,SHORT,CURPRNT) I 1
"RTN","TIUSRVR1",64,0)
 S TIUY=""
"RTN","TIUSRVR1",65,0)
 E  I $L(TIUREC(8925,+TIUDA,.01)) D
"RTN","TIUSRVR1",66,0)
 . S TIUY=$$SETSTR^VALM1("TITLE: "_TIUREC(8925,+TIUDA,.01),TIUY,8,64)
"RTN","TIUSRVR1",67,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",68,0)
 S TIUY=""
"RTN","TIUSRVR1",69,0)
 I SHORT D
"RTN","TIUSRVR1",70,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",71,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",72,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",73,0)
 S TIUY=""
"RTN","TIUSRVR1",74,0)
 I 'SHORT D
"RTN","TIUSRVR1",75,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",76,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),TIUY,4,39)
"RTN","TIUSRVR1",77,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",78,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUSRVR1",79,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",80,0)
 . S TIUY=""
"RTN","TIUSRVR1",81,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",82,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",83,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),TIUY,7,32)
"RTN","TIUSRVR1",84,0)
 . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("    SURGEON: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",85,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUSRVR1",86,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),TIUY,39,40)
"RTN","TIUSRVR1",87,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),TIUY,36,40)
"RTN","TIUSRVR1",88,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",89,0)
 . S TIUY=""
"RTN","TIUSRVR1",90,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),TIUY,6,36)
"RTN","TIUSRVR1",91,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",92,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",93,0)
 ; * 173 
"RTN","TIUSRVR1",94,0)
 I TIUREC(8925,+TIUDA,.05)="UNCOSIGNED" D
"RTN","TIUSRVR1",95,0)
 . S TIUY="",TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",96,0)
 . S TIUY="",TIUL=TIUL+1,TIUY=$$SETSTR^VALM1("*** NOT YET COSIGNED ***",TIUY,20,51),@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",97,0)
 S TIUY=""
"RTN","TIUSRVR1",98,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) D  I 1
"RTN","TIUSRVR1",99,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",100,0)
 E  D
"RTN","TIUSRVR1",101,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),TIUY,6,74)
"RTN","TIUSRVR1",102,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",103,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",104,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR1",105,0)
 ; Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR1",106,0)
 I $G(TIUCPF) D
"RTN","TIUSRVR1",107,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",108,0)
 . S TIUY=$$SETSTR^VALM1("PROCEDURE SUMMARY CODE: "_TIUREC(8925,+TIUDA,70201),$G(TIUY),1,54)
"RTN","TIUSRVR1",109,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",110,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",111,0)
 . S TIUY=$$SETSTR^VALM1("DATE/TIME PERFORMED: "_TIUREC(8925,+TIUDA,70202),$G(TIUY),1,41)
"RTN","TIUSRVR1",112,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",113,0)
 . S TIUL=TIUL+1,TIUY="",@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",114,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUSRVR1",115,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVR1",116,0)
 . S TIUY=TIUY_" Has ADDENDA ***"
"RTN","TIUSRVR1",117,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",118,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",119,0)
 Q
"RTN","TIUSRVR1",120,0)
 ;
"RTN","TIUSRVR1",121,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRVR1",122,0)
 N TIUY,TIUTYP
"RTN","TIUSRVR1",123,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRVR1",124,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRVR1",125,0)
 Q TIUY
"RTN","TIUSRVR1",126,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUSRVR1",127,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUSRVR1",128,0)
 ; Called by LOADTOP
"RTN","TIUSRVR1",129,0)
 N TIUY,TIUX,TIU
"RTN","TIUSRVR1",130,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR1",131,0)
 I SHORT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUSRVR1",132,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR1",133,0)
 S TIUY="",TIUX="TITLE: "_$P($G(TIU("DOCTYP")),U,2)
"RTN","TIUSRVR1",134,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,1,67)
"RTN","TIUSRVR1",135,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",136,0)
 Q:SHORT
"RTN","TIUSRVR1",137,0)
 S TIUY="",TIUX="LOCATION: "_$P($G(TIU("LOC")),U,2)
"RTN","TIUSRVR1",138,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,5,31)
"RTN","TIUSRVR1",139,0)
 I $L($G(TIU("WARD"))) D  I 1
"RTN","TIUSRVR1",140,0)
 . S TIUX="ADMISSION DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",141,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,34,37)
"RTN","TIUSRVR1",142,0)
 E  D
"RTN","TIUSRVR1",143,0)
 . S TIUX="VISIT DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",144,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,38,33)
"RTN","TIUSRVR1",145,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",146,0)
 Q
"VER")
8.0^22.0
**END**
**END**
