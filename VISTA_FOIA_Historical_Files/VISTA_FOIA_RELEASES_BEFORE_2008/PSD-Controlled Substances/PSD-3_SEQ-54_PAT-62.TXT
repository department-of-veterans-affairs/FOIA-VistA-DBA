$TXT Created by SMITH,ROBERT at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 10/26/06 at 11:16
=============================================================================
Run Date: OCT 22, 2007                     Designation: PSD*3*62
Package : PSD - CONTROLLED SUBSTANCES         Priority: Mandatory
Version : 3        SEQ #54                      Status: Released
                  Compliance Date: NOV 22, 2007
=============================================================================

Associated patches: (v)PSD*3*7     <<= must be installed BEFORE `PSD*3*62'
                    (v)PSD*3*8     <<= must be installed BEFORE `PSD*3*62'
                    (v)PSD*3*48    <<= must be installed BEFORE `PSD*3*62'
                    (v)PSD*3*56    <<= must be installed BEFORE `PSD*3*62'
                    (v)PSD*3*58    <<= must be installed BEFORE `PSD*3*62'

Subject: MULTIPLE FIXES TO CORRECT ERRORS AND REPORTS

Category: 
  - Routine

Description:
============

 This patch addresses the following problems:
  
 1.   HD129499           PSDGSRV1        undefined error
 When completing a greensheet and the user includes a ";" semicolon at the
 "REASON TURN IN FOR DESTROY:" or "REASON RETURNED TO STOCK:" prompts, a
 $ZE= <SYNTAX> BR+1^DIE0 error is generated.
  
 2.   HD68785            PSDPAT1   Transferring of Controlled Substances
 When a controlled substance is transferred from one NAOU to another NAOU,
 the Activity Report [PSD NURSE DISP REPORT] does not include the transfer
 if the receipt date is different then the transfer date.
  
 3.   HD136028           Pharmacist able to fill expired order.
 This patch will prevent the pharmacist from filling expired orders.
   
 4.   HD161718           Pharmacist can't order an inactive drug on NAOU
 This patch also allows a pharmacist to see inactive drugs on the lookup.
  
 5.   HD158898           PSD DEST Drugs Report does not work properly.
  
 If the first date in the "AD" cross reference of the CS Destruction file
 (#58.86) (call it Y) is after the last date in the "AC" cross reference
 (call it X) and the starting date for the report falls between the two
 dates (X < starting date <Y) then an <UNDEFINED> error occurs.
  
 ASSOCIATED REMEDY TICKETS:
 ==========================
 HD129499      Greensheet reviewed/returned still showing ready for P/U
   Duplicate
    HD146835     $ZE= <SYNTAX> BR+1^DIE0
  
 HD68785          Transferring of Controlled Substances
 HD136028         Pharmacist able to fill expired order.
 HD161718         Pharmacist can't order an inactive drug on NAOU
 HD158898         PSD DEST Drugs Report does not work properly
  
 ASSOCIATED NSR(s): 
 ================== 
 N/A
  
 PARTICIPATING TEST SITES:
 ========================= 
 OKLAHOMA CITY
 PALO ALTO
 ANN ARBOR 
  
 REMEDY OVERVIEW:
 ================ 
  
 PROBLEM
 ======= 
 1.    HD129499           PSDGSRV1    undefined error
  
 When completing a greensheet and the user includes a ";" semicolon at the
 "REASON TURN IN FOR DESTROY:" or "REASON RETURNED TO STOCK:" prompts, a
 $ZE= <SYNTAX> BR+1^DIE0 error is generated.
  
 RESOLUTION
 ==========
 The prompts "REASON TURN IN FOR DESTROY:" and "REASON RETURNED TO STOCK:"
 within the "Complete Green Sheet" [PSD COMPLETE GS] option will be modified
 to change ";" semicolons to "," commas when entered.
  
 TECHNICAL
 =========
 The PSDGSRV1 routine uses the ^DIR FileMan API to input the "REASON TURN
 IN FOR DESTROY:" and "REASON RETURNED TO STOCK:" information.  The ^DIR
 stores that data in the Y variable, then sets it in the REAS variable.  
 PSDGSRV1 will be modified to use the ///^S X=REAS logic for stuffing the
 data.
  
 PROBLEM
 ======= 
 2.    HD68785        PSDPAT1     Transferring of Controlled Substances
  
 When a controlled substance is transferred from one NAOU to another NAOU,
 the Activity Report [PSD NURSE DISP REPORT] does not include the transfer
 if the receipt date is different then the transfer date.
  
 RESOLUTION
 ==========
 The Activity Report [PSD NURSE DISP REPORT] will be modified to check for
 controlled substances that have been transferred from the selected NAOU
 within the selected date/time range.
  
 TECHNICAL
 =========
 The PSDPAT1 routine will be modified to check the ^PSD(58.81,"ATRN" index
 for the selected date/time range.  If transfers are found and the
 transaction NAOU is equal to the report NAOU, the ^TMP("PSDPAT" global is
 checked to see if it exists.  If it does not exist, the transaction is
 included.
  
 PROBLEM
 =======
 3.   HD136028           Pharmacist able to fill expired order.
  
 In the "Outpatient Rx's" module (PSD OUTPATIENT), the pharmacist is allowed to
 fill expired orders.
  
 RESOLUTION
 ==========
 Modified the PSDOPT routine to disallow filling of expired orders.
  
 TECHNICAL
 =========
 The PSDOPT routine will be modified to check the status of the order
 contained in the variable PSDSTA to see if the order is expired.
  
 PROBLEM
 =======
 4.   HD161718           Pharmacist can't order an inactive drug on NAOU
  
 In the "CS Order Entry For Ward" module (PSD ORDER ENTRY) a pharmacist is 
 unable to see the inactive items for a NAOU whereas a nurse is.
   
 RESOLUTION
 ==========
 Modified the PSDORP routine to allow a pharmacist to see the inactive items
 for the NAOU.
  
 TECHNICAL
 =========
 Modified the PSDORP routine to allow a pharmacist to see the inactive items
 for the NAOU.
  
 PROBLEM
 =======
 5.   HD158898           PSD DEST Drugs Report does not work properly.
  
 If the first date in the "AD" cross reference of the CS DESTRUCTION file
 (#58.86) (call it Y) is after the last date in the "AC" cross reference
 (call it X) and the starting date for the report falls between the two
 dates (X < starting date <Y) then an <UNDEFINED> error occurs.
  
 RESOLUTION
 ==========
 Modified the PSDESTP routine to set the variable PSDR to null if
 undefined.
  
 TECHNICAL
 =========
 The PSDESTP routine will be modified to test for the existence of the PSDR
 variable and if it does not exist, the PSDR variable will be set to a null
 value.
  
  
 INSTALLATION INSTRUCTIONS
 =========================
 If installed during the normal workday, it is recommended that the 
 Controlled Substance users be off the system.  Other VISTA users
 will not be affected.
   
 Install Time - less than 2 minutes
  
  1.  This patch can be queued to run in the background during 
      non-peak hours when pharmacy users are not on the system.
  
  2.  Start up the Kernel Installation and Distribution System Menu
      [XPD MAIN]: 
  
           Edits and Distribution ...  
           Utilities ...  
           Installation ...  
  
      Select Kernel Installation & Distribution System Option: Installation
                                                               ---
           1      Load a Distribution
           2      Verify Checksums in Transport Global
           3      Print Transport Global
           4      Compare Transport Global to Current System
           5      Backup a Transport Global
           6      Install Package(s)
                  Restart Install of Package(s)
                  Unload a Distribution
  
  3.  From this menu, you may elect to use the following options
      (When prompted for the INSTALL NAME, enter PSD*3.0*62):
  
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will
          not backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option
          will allow you to view all changes that will be made when
          this patch is installed.  It compares all components of this
          patch (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will
          allow you to ensure the integrity of the routines that are
          in the transport global.
  
  4.  Use the Install Package(s) option and select the package
      PSD*3.0*62.
  
      a.  When prompted 'Want KIDS to INHIBIT LOGONs during the
          install? YES//', answer NO.
      b.  When prompted 'Want to DISABLE Scheduled Options and Menu 
          Options and Protocols? YES//', answer NO.
  
 ROUTINE SUMMARY
 =============== 
 The following is a list of the routines included in this patch.  
 The second line of each of these routines now looks like: 
  
       ;;3.0; CONTROLLED SUBSTANCES ;**[Patch List]**;13 Feb 97
  
                        CHECK^XTSUMBLD results
 Routine name      Before Patch         After Patch       Patch List
 ============      ============         ===========       ===========
 PSDESTP               25326780            25358406       8,62
 PSDGSRV1              17680089            17986461       4,8,9,56,62
 PSDOPT                30300296            30753826       10,11,15,21,
                                                          30,39,48,62
 PSDORP                14239224            14659174       58,62
 PSDPAT1               27043682            29721218       7,62

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSDESTP
    Before: B47647337   After: B47919074  **8,62**
Routine Name: PSDGSRV1
    Before: B33639338   After: B33992603  **4,8,9,56,62**
Routine Name: PSDOPT
    Before: B82663142   After: B83861199  **10,11,15,21,30,39,48,62**
Routine Name: PSDORP
    Before: B23997011   After: B26130595  **58,62**
Routine Name: PSDPAT1
    Before: B52759406   After: B63600329  **7,62**
 
Routine list of preceding patches: 7, 48, 56, 58

=============================================================================
User Information:
Entered By  : SMITH,ROBERT J                Date Entered  : JUN 22, 2006
Completed By: HEFFERNAN,COREY               Date Completed: OCT 18, 2007
Released By : LYTTLE,KIM M                  Date Released : OCT 22, 2007
=============================================================================


Packman Mail Message:
=====================

$END TXT
