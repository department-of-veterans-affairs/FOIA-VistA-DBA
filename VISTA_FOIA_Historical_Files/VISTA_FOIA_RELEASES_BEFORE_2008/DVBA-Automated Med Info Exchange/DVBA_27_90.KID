KIDS Distribution saved on Apr 20, 2005@14:47:13
Support for GUI 91 - 0420@1346c
**KIDS**:DVBA*2.7*90^

**INSTALL NAME**
DVBA*2.7*90
"BLD",5412,0)
DVBA*2.7*90^AUTOMATED MED INFO EXCHANGE^0^3050420^y
"BLD",5412,1,0)
^^2^2^3050208^
"BLD",5412,1,1,0)
Please see the National Patch Module for details
"BLD",5412,1,2,0)
of the enhancements included in this patch.
"BLD",5412,4,0)
^9.64PA^396.17^1
"BLD",5412,4,396.17,0)
396.17
"BLD",5412,4,396.17,2,0)
^9.641^396.17^2
"BLD",5412,4,396.17,2,396.17,0)
CAPRI TEMPLATES  (File-top level)
"BLD",5412,4,396.17,2,396.17,1,0)
^9.6411^17^1
"BLD",5412,4,396.17,2,396.17,1,17,0)
IN USE
"BLD",5412,4,396.17,2,396.19,0)
FORM SAVE BUFFER  (sub-file)
"BLD",5412,4,396.17,2,396.19,1,0)
^9.6411^^
"BLD",5412,4,396.17,222)
y^y^p^^^^n^^n
"BLD",5412,4,396.17,224)

"BLD",5412,4,"APDD",396.17,396.17)

"BLD",5412,4,"APDD",396.17,396.17,17)

"BLD",5412,4,"APDD",396.17,396.19)

"BLD",5412,4,"B",396.17,396.17)

"BLD",5412,"KRN",0)
^9.67PA^8989.52^19
"BLD",5412,"KRN",.4,0)
.4
"BLD",5412,"KRN",.401,0)
.401
"BLD",5412,"KRN",.402,0)
.402
"BLD",5412,"KRN",.403,0)
.403
"BLD",5412,"KRN",.5,0)
.5
"BLD",5412,"KRN",.84,0)
.84
"BLD",5412,"KRN",3.6,0)
3.6
"BLD",5412,"KRN",3.8,0)
3.8
"BLD",5412,"KRN",9.2,0)
9.2
"BLD",5412,"KRN",9.8,0)
9.8
"BLD",5412,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",5412,"KRN",9.8,"NM",1,0)
DVBAB84^^0^B28830871
"BLD",5412,"KRN",9.8,"NM",2,0)
DVBABFRM^^0^B22703369
"BLD",5412,"KRN",9.8,"NM",3,0)
DVBAB85^^0^B3730560
"BLD",5412,"KRN",9.8,"NM",4,0)
DVBAB6^^0^B29475564
"BLD",5412,"KRN",9.8,"NM",5,0)
DVBAB67^^0^B14925656
"BLD",5412,"KRN",9.8,"NM",6,0)
DVBAB82^^0^B72472785
"BLD",5412,"KRN",9.8,"NM","B","DVBAB6",4)

"BLD",5412,"KRN",9.8,"NM","B","DVBAB67",5)

"BLD",5412,"KRN",9.8,"NM","B","DVBAB82",6)

"BLD",5412,"KRN",9.8,"NM","B","DVBAB84",1)

"BLD",5412,"KRN",9.8,"NM","B","DVBAB85",3)

"BLD",5412,"KRN",9.8,"NM","B","DVBABFRM",2)

"BLD",5412,"KRN",19,0)
19
"BLD",5412,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5412,"KRN",19,"NM",1,0)
DVBA CAPRI GUI^^0
"BLD",5412,"KRN",19,"NM","B","DVBA CAPRI GUI",1)

"BLD",5412,"KRN",19.1,0)
19.1
"BLD",5412,"KRN",101,0)
101
"BLD",5412,"KRN",409.61,0)
409.61
"BLD",5412,"KRN",771,0)
771
"BLD",5412,"KRN",870,0)
870
"BLD",5412,"KRN",8989.51,0)
8989.51
"BLD",5412,"KRN",8989.52,0)
8989.52
"BLD",5412,"KRN",8994,0)
8994
"BLD",5412,"KRN",8994,"NM",0)
^9.68A^12^9
"BLD",5412,"KRN",8994,"NM",2,0)
DVBAB FETCH 1U4N^^0
"BLD",5412,"KRN",8994,"NM",3,0)
DVBAB FORM COPY^^0
"BLD",5412,"KRN",8994,"NM",4,0)
DVBAB FORM DATA BACKUP^^0
"BLD",5412,"KRN",8994,"NM",5,0)
DVBAB FORM DATA BACKUP DELETE^^0
"BLD",5412,"KRN",8994,"NM",6,0)
DVBAB FORM DATA BACKUP RESTORE^^0
"BLD",5412,"KRN",8994,"NM",7,0)
DVBAB FIND DUPS^^0
"BLD",5412,"KRN",8994,"NM",9,0)
DVBAB NEW PERSON FILE^^0
"BLD",5412,"KRN",8994,"NM",11,0)
DVBAB TEMPLATE REPORT FULL^^0
"BLD",5412,"KRN",8994,"NM",12,0)
DVBAB SET DIVISION^^0
"BLD",5412,"KRN",8994,"NM","B","DVBAB FETCH 1U4N",2)

"BLD",5412,"KRN",8994,"NM","B","DVBAB FIND DUPS",7)

"BLD",5412,"KRN",8994,"NM","B","DVBAB FORM COPY",3)

"BLD",5412,"KRN",8994,"NM","B","DVBAB FORM DATA BACKUP",4)

"BLD",5412,"KRN",8994,"NM","B","DVBAB FORM DATA BACKUP DELETE",5)

"BLD",5412,"KRN",8994,"NM","B","DVBAB FORM DATA BACKUP RESTORE",6)

"BLD",5412,"KRN",8994,"NM","B","DVBAB NEW PERSON FILE",9)

"BLD",5412,"KRN",8994,"NM","B","DVBAB SET DIVISION",12)

"BLD",5412,"KRN",8994,"NM","B","DVBAB TEMPLATE REPORT FULL",11)

"BLD",5412,"KRN","B",.4,.4)

"BLD",5412,"KRN","B",.401,.401)

"BLD",5412,"KRN","B",.402,.402)

"BLD",5412,"KRN","B",.403,.403)

"BLD",5412,"KRN","B",.5,.5)

"BLD",5412,"KRN","B",.84,.84)

"BLD",5412,"KRN","B",3.6,3.6)

"BLD",5412,"KRN","B",3.8,3.8)

"BLD",5412,"KRN","B",9.2,9.2)

"BLD",5412,"KRN","B",9.8,9.8)

"BLD",5412,"KRN","B",19,19)

"BLD",5412,"KRN","B",19.1,19.1)

"BLD",5412,"KRN","B",101,101)

"BLD",5412,"KRN","B",409.61,409.61)

"BLD",5412,"KRN","B",771,771)

"BLD",5412,"KRN","B",870,870)

"BLD",5412,"KRN","B",8989.51,8989.51)

"BLD",5412,"KRN","B",8989.52,8989.52)

"BLD",5412,"KRN","B",8994,8994)

"BLD",5412,"QUES",0)
^9.62^^
"BLD",5412,"REQB",0)
^9.611^2^2
"BLD",5412,"REQB",1,0)
DVBA*2.7*57^2
"BLD",5412,"REQB",2,0)
DVBA*2.7*53^2
"BLD",5412,"REQB","B","DVBA*2.7*53",2)

"BLD",5412,"REQB","B","DVBA*2.7*57",1)

"FIA",396.17)
CAPRI TEMPLATES
"FIA",396.17,0)
^DVB(396.17,
"FIA",396.17,0,0)
396.17PI
"FIA",396.17,0,1)
y^y^p^^^^n^^n
"FIA",396.17,0,10)

"FIA",396.17,0,11)

"FIA",396.17,0,"RLRO")

"FIA",396.17,0,"VR")
2.7^DVBA
"FIA",396.17,396.17)
1
"FIA",396.17,396.17,8.5)

"FIA",396.17,396.17,17)

"FIA",396.17,396.19)
0
"FIA",396.17,396.191)
0
"FIA",396.17,396.193)
0
"KRN",19,9510,-1)
0^1
"KRN",19,9510,0)
DVBA CAPRI GUI^Capri GUI (Broker)^^B^^^^^^^^AUTOMATED MED INFO EXCHANGE^^
"KRN",19,9510,1,0)
^19.06^2^2^3040326^^^^
"KRN",19,9510,1,1,0)
This is the 'B' type option used by CAPRI GUI client application. It
"KRN",19,9510,1,2,0)
contains all the RPCs used by the CAPRI GUI application.
"KRN",19,9510,20)

"KRN",19,9510,25)

"KRN",19,9510,99.1)
59969,56535
"KRN",19,9510,"RPC",0)
^19.05P^116^115
"KRN",19,9510,"RPC",1,0)
DVBAB REPORT LISTS
"KRN",19,9510,"RPC",2,0)
DVBAB APPOINTMENT LIST
"KRN",19,9510,"RPC",3,0)
DVBAB CHECK CREDENTIALS
"KRN",19,9510,"RPC",4,0)
DVBAB FIND EXAMS
"KRN",19,9510,"RPC",5,0)
DVBAB PTINQ
"KRN",19,9510,"RPC",6,0)
DVBAB INCREASE EXAM COUNT
"KRN",19,9510,"RPC",7,0)
DVBAB SEND MSG
"KRN",19,9510,"RPC",8,0)
DVBAB REPORT CHECKLIST
"KRN",19,9510,"RPC",9,0)
DDR FILER
"KRN",19,9510,"RPC",10,0)
DDR LISTER
"KRN",19,9510,"RPC",11,0)
DDR VALIDATOR
"KRN",19,9510,"RPC",12,0)
DDR GETS ENTRY DATA
"KRN",19,9510,"RPC",14,0)
XWB GET VARIABLE VALUE
"KRN",19,9510,"RPC",15,0)
DVBAB HEALTH SUMMARY TEXT
"KRN",19,9510,"RPC",16,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,9510,"RPC",17,0)
TIU GET RECORD TEXT
"KRN",19,9510,"RPC",18,0)
ORQQCN LIST
"KRN",19,9510,"RPC",19,0)
ORQQCN DETAIL
"KRN",19,9510,"RPC",20,0)
DVBAB INST LIST
"KRN",19,9510,"RPC",22,0)
ORWRP REPORT TEXT
"KRN",19,9510,"RPC",23,0)
ORWORR AGET
"KRN",19,9510,"RPC",24,0)
ORWRA IMAGING EXAMS
"KRN",19,9510,"RPC",25,0)
ORWRP1 LISTNUTR
"KRN",19,9510,"RPC",26,0)
ORWMC PATIENT PROCEDURES
"KRN",19,9510,"RPC",27,0)
ORQQPL PROBLEM LIST
"KRN",19,9510,"RPC",28,0)
ORWORR GET4LST
"KRN",19,9510,"RPC",29,0)
ORWLR CUMULATIVE REPORT
"KRN",19,9510,"RPC",32,0)
DVBAB DATETIME
"KRN",19,9510,"RPC",34,0)
ORWPT ADMITLST
"KRN",19,9510,"RPC",35,0)
DVBAB SC VETERAN REPORT
"KRN",19,9510,"RPC",36,0)
ORQQVS VISITS/APPTS
"KRN",19,9510,"RPC",37,0)
ORWU DT
"KRN",19,9510,"RPC",38,0)
ORWLRR CHART
"KRN",19,9510,"RPC",39,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,9510,"RPC",40,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,9510,"RPC",41,0)
DVBAB REPORT EXAM CHKLIST
"KRN",19,9510,"RPC",42,0)
DVBAB REPORT ADMINQ
"KRN",19,9510,"RPC",43,0)
DVBAB REPORT INCOMPVET
"KRN",19,9510,"RPC",44,0)
DVBAB REPORT DISCHARGE
"KRN",19,9510,"RPC",45,0)
DVBAB REPORT READMIT
"KRN",19,9510,"RPC",46,0)
DVBAB REPORT ADMISSIONS
"KRN",19,9510,"RPC",47,0)
DVBAB REPORT 7131INQ
"KRN",19,9510,"RPC",48,0)
DVBAB PENDING C&P REPORT
"KRN",19,9510,"RPC",49,0)
DVBAB REPORT CPDETAILS
"KRN",19,9510,"RPC",50,0)
DVBAB AMIS REPORT
"KRN",19,9510,"RPC",51,0)
DVBAB REPORT PENDING7131
"KRN",19,9510,"RPC",52,0)
DVBAB LABLIST
"KRN",19,9510,"RPC",53,0)
DVBAB VERSION
"KRN",19,9510,"RPC",54,0)
DDR DELETE ENTRY
"KRN",19,9510,"RPC",55,0)
ORWRP REPORT LISTS
"KRN",19,9510,"RPC",57,0)
DVBAB DIVISION
"KRN",19,9510,"RPC",58,0)
DVBAB TEAM PATIENTS
"KRN",19,9510,"RPC",59,0)
ORWCIRN FACLIST
"KRN",19,9510,"RPC",60,0)
XWB REMOTE STATUS CHECK
"KRN",19,9510,"RPC",61,0)
XWB REMOTE GETDATA
"KRN",19,9510,"RPC",63,0)
ORWPT DIEDON
"KRN",19,9510,"RPC",66,0)
XWB REMOTE RPC
"KRN",19,9510,"RPC",68,0)
DDR FIND1
"KRN",19,9510,"RPC",69,0)
DVBAB REPORTS
"KRN",19,9510,"RPC",70,0)
ORWRP2 COMPABV
"KRN",19,9510,"RPC",71,0)
DVBAB SURGERY CASE
"KRN",19,9510,"RPC",72,0)
ORWRP2 COMPDISP
"KRN",19,9510,"RPC",73,0)
ORWRP2 HS COMPONENTS
"KRN",19,9510,"RPC",74,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,9510,"RPC",75,0)
ORWRP2 HS COMP FILES
"KRN",19,9510,"RPC",76,0)
ORWRP2 SAVLKUP
"KRN",19,9510,"RPC",77,0)
ORWRP2 HS REPORT TEXT
"KRN",19,9510,"RPC",78,0)
ORWRP2 GETLKUP
"KRN",19,9510,"RPC",79,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,9510,"RPC",80,0)
ORWRP2 HS SUBITEMS
"KRN",19,9510,"RPC",81,0)
DVBAB MAIL INIT
"KRN",19,9510,"RPC",82,0)
ORWLRR MICRO
"KRN",19,9510,"RPC",83,0)
TIU CREATE RECORD
"KRN",19,9510,"RPC",84,0)
DVBAB MPI ASSIGN ICN
"KRN",19,9510,"RPC",85,0)
TIU SIGN RECORD
"KRN",19,9510,"RPC",86,0)
TIU DELETE RECORD
"KRN",19,9510,"RPC",87,0)
TIU REQUIRES COSIGNATURE
"KRN",19,9510,"RPC",88,0)
DVBAB REPORT ADMISSION INQUIRY
"KRN",19,9510,"RPC",89,0)
DVBAB REPORT NEW NOTICES DC
"KRN",19,9510,"RPC",90,0)
DVBAB NOTE TITLES
"KRN",19,9510,"RPC",91,0)
DVBAB TEMPLATE DEFINITION
"KRN",19,9510,"RPC",92,0)
DDR FINDER
"KRN",19,9510,"RPC",93,0)
ORWCV VST
"KRN",19,9510,"RPC",94,0)
TIU LOAD BOILERPLATE TEXT
"KRN",19,9510,"RPC",95,0)
DVBAB GET VISIT INFO
"KRN",19,9510,"RPC",96,0)
DVBAB REPORT SPECIAL
"KRN",19,9510,"RPC",97,0)
DVBAB SAVE FORM
"KRN",19,9510,"RPC",98,0)
DVBAB EXAMS BY DATE
"KRN",19,9510,"RPC",99,0)
TIU GET SITE PARAMETERS
"KRN",19,9510,"RPC",100,0)
TIU GET ALERT INFO
"KRN",19,9510,"RPC",101,0)
ORWU VALIDSIG
"KRN",19,9510,"RPC",103,0)
ORWORB FASTUSER
"KRN",19,9510,"RPC",104,0)
DVBAB TEMPLATE LIST
"KRN",19,9510,"RPC",105,0)
DVBAB LOAD FORM
"KRN",19,9510,"RPC",106,0)
DVBAB TEMPLATE REPORT FULL
"KRN",19,9510,"RPC",107,0)
DVBAB FETCH 1U4N
"KRN",19,9510,"RPC",108,0)
DVBAB FORM DATA BACKUP DELETE
"KRN",19,9510,"RPC",109,0)
DVBAB FORM DATA BACKUP RESTORE
"KRN",19,9510,"RPC",110,0)
DDR LOCK/UNLOCK NODE
"KRN",19,9510,"RPC",111,0)
DVBAB FORM COPY
"KRN",19,9510,"RPC",112,0)
DVBAB FIND DUPS
"KRN",19,9510,"RPC",113,0)
DVBAB NEW PERSON FILE
"KRN",19,9510,"RPC",114,0)
DVBAB FORM DATA BACKUP
"KRN",19,9510,"RPC",116,0)
DVBAB SET DIVISION
"KRN",19,9510,"U")
CAPRI GUI (BROKER)
"KRN",8994,1821,-1)
0^9
"KRN",8994,1821,0)
DVBAB NEW PERSON FILE^START^DVBAB84^4^P^0
"KRN",8994,2293,-1)
0^2
"KRN",8994,2293,0)
DVBAB FETCH 1U4N^U1N4^DVBABFRM^4^S^0^^1^2
"KRN",8994,2293,1,0)
^8994.01^3^3^3050128^^^^
"KRN",8994,2293,1,1,0)
Retrieve the 1u4n field for the list of patient IENS
"KRN",8994,2293,1,2,0)
provided as the only argument.  Each IEN will be
"KRN",8994,2293,1,3,0)
sent back with field .0905 appended after a caret.
"KRN",8994,2293,2,0)
^8994.02A^1^1
"KRN",8994,2293,2,1,0)
ARR^2^^1^1
"KRN",8994,2293,2,1,1,0)
^8994.021^1^1^3050128^^^^
"KRN",8994,2293,2,1,1,1,0)
List of patient IENs
"KRN",8994,2293,2,"B","ARR",1)

"KRN",8994,2293,2,"PARAMSEQ",1,1)

"KRN",8994,2293,3,0)
^8994.03^2^2^3050128^^
"KRN",8994,2293,3,1,0)
List of Patient IENs in piece 1,
"KRN",8994,2293,3,2,0)
followed by 1U4N in piece 2
"KRN",8994,2328,-1)
0^11
"KRN",8994,2328,0)
DVBAB TEMPLATE REPORT FULL^RPTSTAT^DVBAB85^4^S^^^0
"KRN",8994,2328,1,0)
^8994.01^1^1^3050301^^^
"KRN",8994,2328,1,1,0)
Returns report of exam templates, including current status
"KRN",8994,2328,2,0)
^8994.02A^2^2
"KRN",8994,2328,2,1,0)
STRTDT^1
"KRN",8994,2328,2,2,0)
ENDDT^1
"KRN",8994,2328,2,"B","ENDDT",2)

"KRN",8994,2328,2,"B","STRTDT",1)

"KRN",8994,2345,-1)
0^4
"KRN",8994,2345,0)
DVBAB FORM DATA BACKUP^BACKUP^DVBABFRM^1^R
"KRN",8994,2345,1,0)
^8994.01^2^2^3050308^^^^
"KRN",8994,2345,1,1,0)
Makes a backup copy of a CAPRI template in case of data loss.  The backup 
"KRN",8994,2345,1,2,0)
is restored through the CAPRI GUI.
"KRN",8994,2345,2,0)
^8994.02A^2^2
"KRN",8994,2345,2,1,0)
DVBIEN^1
"KRN",8994,2345,2,1,1,0)
^8994.021^1^1^3050308^^^^
"KRN",8994,2345,2,1,1,1,0)
The IEN of the template for which a backup is being created
"KRN",8994,2345,2,2,0)
LISTBOX TEXT^1^50^0
"KRN",8994,2345,2,2,1,0)
^^2^2^3050308^
"KRN",8994,2345,2,2,1,1,0)
Option field to allow the user to enter custom text to be attached to the 
"KRN",8994,2345,2,2,1,2,0)
saved data.  Displayed in the listbox on the GUI side.
"KRN",8994,2345,2,"B","DVBIEN",1)

"KRN",8994,2345,2,"B","LISTBOX TEXT",2)

"KRN",8994,2346,-1)
0^5
"KRN",8994,2346,0)
DVBAB FORM DATA BACKUP DELETE^DELETE^DVBABFRM^1^S
"KRN",8994,2346,2,0)
^8994.02A^1^1
"KRN",8994,2346,2,1,0)
IEN^1^^1^1
"KRN",8994,2346,2,1,1,0)
^8994.021^1^1^3050329^^^^
"KRN",8994,2346,2,1,1,1,0)
IEN in file 396.17
"KRN",8994,2346,2,"B","IEN",1)

"KRN",8994,2346,2,"PARAMSEQ",1,1)

"KRN",8994,2346,3,0)
^8994.03^3^3^3050329^^^^
"KRN",8994,2346,3,1,0)
String returned is "^" piece separated, as follows:
"KRN",8994,2346,3,2,0)
 Piece  Item
"KRN",8994,2346,3,3,0)
   1
"KRN",8994,2347,-1)
0^6
"KRN",8994,2347,0)
DVBAB FORM DATA BACKUP RESTORE^RESTORE^DVBABFRM^1^S
"KRN",8994,2347,2,0)
^8994.02A^2^2
"KRN",8994,2347,2,1,0)
IEN^1^^1^1
"KRN",8994,2347,2,2,0)
SIEN^1^^1^2
"KRN",8994,2347,2,2,1,0)
^^1^1^3050308^
"KRN",8994,2347,2,2,1,1,0)
Sub-IEN in file 397.17
"KRN",8994,2347,2,"B","IEN",1)

"KRN",8994,2347,2,"B","SIEN",2)

"KRN",8994,2347,2,"PARAMSEQ",1,1)

"KRN",8994,2347,2,"PARAMSEQ",2,2)

"KRN",8994,2348,-1)
0^3
"KRN",8994,2348,0)
DVBAB FORM COPY^COPY^DVBABFRM^1^R
"KRN",8994,2348,1,0)
^8994.01^11^11^3050314^^
"KRN",8994,2348,1,1,0)
 
"KRN",8994,2348,1,2,0)
Copies a CAPRI form in file 396.17 to a new entry.  Clears key field so 
"KRN",8994,2348,1,3,0)
the form becomes editable as a new draft document.
"KRN",8994,2348,1,4,0)
 
"KRN",8994,2348,1,5,0)
DVBAB1 = IEN in 396.17 to copy
"KRN",8994,2348,1,6,0)
DVBAB2 = IEN in patient file
"KRN",8994,2348,1,7,0)
 
"KRN",8994,2348,1,8,0)
If DVBAB2 is null, the copied form will be filed under the same patient 
"KRN",8994,2348,1,9,0)
it previously belonged to.
"KRN",8994,2348,1,10,0)
 
"KRN",8994,2348,1,11,0)
If DVBAB2 has a value, it'll be copied to the new patient.
"KRN",8994,2348,2,0)
^8994.02A^2^2
"KRN",8994,2348,2,1,0)
DVBAB1^1^^1
"KRN",8994,2348,2,2,0)
DVBAB2^1^^0
"KRN",8994,2348,2,"B","DVBAB1",1)

"KRN",8994,2348,2,"B","DVBAB2",2)

"KRN",8994,2348,3,0)
^^1^1^3050314^
"KRN",8994,2348,3,1,0)
Returns the IEN of the newly copied form.
"KRN",8994,2349,-1)
0^7
"KRN",8994,2349,0)
DVBAB FIND DUPS^DUP^DVBAB84^4^S^^^1
"KRN",8994,2349,1,0)
^8994.01^4^4^3050315^^
"KRN",8994,2349,1,1,0)
Find potential duplicates within the PATIENT File (#2)
"KRN",8994,2349,1,2,0)
 
"KRN",8994,2349,1,3,0)
At least one of NAM, DOB, or SSN must be passed
"KRN",8994,2349,1,4,0)
Possible matches are "better" when more than one of these is passed
"KRN",8994,2349,2,0)
^8994.02A^3^3
"KRN",8994,2349,2,1,0)
NAM^1^^^1
"KRN",8994,2349,2,1,1,0)
^^1^1^3050315^
"KRN",8994,2349,2,1,1,1,0)
Name of possible patient
"KRN",8994,2349,2,2,0)
DOB^1^7^^2
"KRN",8994,2349,2,2,1,0)
^^1^1^3050315^
"KRN",8994,2349,2,2,1,1,0)
Date of Birth of possible patient
"KRN",8994,2349,2,3,0)
SSN^1^10^^3
"KRN",8994,2349,2,3,1,0)
^^1^1^3050315^
"KRN",8994,2349,2,3,1,1,0)
Social Security Number of possible patient
"KRN",8994,2349,2,"B","DOB",2)

"KRN",8994,2349,2,"B","NAM",1)

"KRN",8994,2349,2,"B","SSN",3)

"KRN",8994,2349,2,"PARAMSEQ",1,1)

"KRN",8994,2349,2,"PARAMSEQ",2,2)

"KRN",8994,2349,2,"PARAMSEQ",3,3)

"KRN",8994,2349,3,0)
^^16^16^3050315^
"KRN",8994,2349,3,1,0)
BYREF - Passed by reference, will contain name of a TMP Global housing the results
"KRN",8994,2349,3,2,0)
 
"KRN",8994,2349,3,3,0)
Subscript 0:  -1^ERROR_MESSAGE (in the event of an error)
"KRN",8994,2349,3,4,0)
 
"KRN",8994,2349,3,5,0)
   OR
"KRN",8994,2349,3,6,0)
 
"KRN",8994,2349,3,7,0)
Subscript    0:  Number of potential matches found (if no errors)
"KRN",8994,2349,3,8,0)
Subscript  1-K:  Patient's matching ALL 3 of NAM, DOB, SSN have a weighting of 3 (see Note)
"KRN",8994,2349,3,9,0)
Subscript K+1-L: Patient's matching ANY 2 of NAM, DOB, SSN have a weighting of 2 (see Note)
"KRN",8994,2349,3,10,0)
Subscript L+1-M: Patient's matching ONLY 1 of NAM, DOB, SSN have a weighting of 1 (see Note)
"KRN",8994,2349,3,11,0)
 
"KRN",8994,2349,3,12,0)
^TMP(1-M) = DFN^ZERO_NODE
"KRN",8994,2349,3,13,0)
    where   DFN is the Patient IEN
"KRN",8994,2349,3,14,0)
            ZERO_NODE is the data from ^DPT(DFN,0)
"KRN",8994,2349,3,15,0)
 
"KRN",8994,2349,3,16,0)
NOTE: Potential matches within a weighting (if any) will be sorted by Patient Name
"KRN",8994,2350,-1)
0^12
"KRN",8994,2350,0)
DVBAB SET DIVISION^DUZ2^DVBAB84^1^S^^^0
"KRN",8994,2350,1,0)
^^1^1^3050413^
"KRN",8994,2350,1,1,0)
Set the Division
"KRN",8994,2350,2,0)
^8994.02A^1^1
"KRN",8994,2350,2,1,0)
NUM^1^^1^1
"KRN",8994,2350,2,1,1,0)
^^1^1^3050413^
"KRN",8994,2350,2,1,1,1,0)
The Station Number
"KRN",8994,2350,2,"B","NUM",1)

"KRN",8994,2350,2,"PARAMSEQ",1,1)

"KRN",8994,2350,3,0)
^^5^5^3050413^
"KRN",8994,2350,3,1,0)
Return
"KRN",8994,2350,3,2,0)
 
"KRN",8994,2350,3,3,0)
 O^ERR_MESSAGE (upon failure)
"KRN",8994,2350,3,4,0)
 
"KRN",8994,2350,3,5,0)
 IEN^INSTITUTION_NAME (upon success)
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
90^3050420
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^3050420
"PKG",223,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details
"PKG",223,22,1,"PAH",1,1,2,0)
of the enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DVBAB6")
0^4^B29475564
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/KLB - CAPRI PENDING 2507 REQUEST ;08/01/00
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35,90**;Apr 10, 1995
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP) ;
"RTN","DVBAB6",5,0)
 I ADIVNUM'="" S X=$O(^DG(40.8,"C",ADIVNUM,"")) S:X]"" ADIVNUM=X
"RTN","DVBAB6",6,0)
SETUP K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",7,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1,DVBCCNT=0,DONE="NO",MSGCNT=1
"RTN","DVBAB6",8,0)
 S DVBCHDR="Sorted by "_$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown")
"RTN","DVBAB6",9,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",10,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",11,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD2_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",12,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",13,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",14,0)
 S $P(^TMP("CAPRI",MSGCNT),"=",75)="=^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",15,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",16,0)
 S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",17,0)
DATA S DFN="" F  S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",18,0)
 I DVBCSORT="V" S PNAM="" F  S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",19,0)
 I DVBCSORT="R"!(DVBCSORT="A")!(DVBCSORT="S") S (PNAM,JX)="" F  S JX=$O(^TMP($J,JX)) Q:'JX  F  S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",20,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",21,0)
 ;
"RTN","DVBAB6",22,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",23,0)
 I DONE="YES" S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",24,0)
 K ^TMP($J),ADIV,CNUM,NODATA,STATUS,TST,TSTA1,STSAT,KKMSGCNT,PG,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,JX
"RTN","DVBAB6",25,0)
 K PROCDT,REQSTR,TSTAT,DA,DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,X,XX,ZS,ZZZ,HEAD,HEAD2,OUT,OWNDOM,EDAYS,PNAM
"RTN","DVBAB6",26,0)
 Q
"RTN","DVBAB6",27,0)
 ;
"RTN","DVBAB6",28,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",29,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5)
"RTN","DVBAB6",30,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9) S:SSN="" SSN="Unknown"
"RTN","DVBAB6",31,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="Unknown"
"RTN","DVBAB6",32,0)
 D ELAPSED^DVBAB5
"RTN","DVBAB6",33,0)
 S STATUS="Unknown",^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1,XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",34,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",35,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",36,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",37,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",38,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",39,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",40,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",41,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S ^TMP("CAPRI",MSGCNT)="Transferred in from "_$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",42,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",43,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",44,0)
 ;
"RTN","DVBAB6",45,0)
ITEMS D TST S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",46,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",47,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",48,0)
 S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",49,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",50,0)
 S $P(^TMP("CAPRI",MSGCNT),"-",75)="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",51,0)
 S DVBCCNT=DVBCCNT+1,MSGCNT=MSGCNT+1
"RTN","DVBAB6",52,0)
 Q
"RTN","DVBAB6",53,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",54,0)
 Q
"RTN","DVBAB6",55,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",56,0)
 Q
"RTN","DVBAB6",57,0)
TST1 S TSTA1=""
"RTN","DVBAB6",58,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",59,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",60,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",61,0)
 S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")_$S(TSTA1]"":" -cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT="":" (Unknown status)",1:"")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",62,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",63,0)
 ;S ^TMP("CAPRI",MSGCNT)=";",MSGCNT=MSGCNT+1
"RTN","DVBAB6",64,0)
 Q
"RTN","DVBAB67")
0^5^B14925656
"RTN","DVBAB67",1,0)
DVBAB67 ;ALB/KLB - CAPRI PENDING REPORT - PART 2 (called by DVBAB57) ;09/09/00
"RTN","DVBAB67",2,0)
 ;;2.7;AMIE;**35,90**;Apr 10, 1995
"RTN","DVBAB67",3,0)
 ;
"RTN","DVBAB67",4,0)
DCHGDT S DCHGDT="",DCHPTR=$P(^DGPM(XJ,0),U,17),XADMDT=$P(^(0),U,1) I DCHPTR]"",$D(^DGPM(+DCHPTR,0)) S DCHGDT=$P(^DGPM(+DCHPTR,0),U,1)
"RTN","DVBAB67",5,0)
 K DCHPTR
"RTN","DVBAB67",6,0)
 Q
"RTN","DVBAB67",7,0)
 ;
"RTN","DVBAB67",8,0)
PRINT S DOCTYPE=$S($D(^DVB(396,DA,2)):$P(^(2),U,10),1:""),DFN=$P(^DVB(396,DA,0),U,1),ADMDT=$P(^(0),U,4),RDATE=$P(^(1),U,1)
"RTN","DVBAB67",9,0)
 S XI=$G(^DPT(DFN,0)),PNAM=$P(XI,U,1),SSN=$P(XI,U,9) Q:PNAM=""!'SSN
"RTN","DVBAB67",10,0)
 S CNUM=$P($G(^DPT(DFN,.31)),U,3) S:CNUM="" CNUM="UNKNOWN"
"RTN","DVBAB67",11,0)
 I RO="Y" S CFLOC=$$STATION^DVBAUTL1(DFN),CFLOC=$S(CFLOC>0:CFLOC,1:9999) Q:CFLOC'=RONUM&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAB67",12,0)
 K ^TMP("DVBA","ADMIT",$J)
"RTN","DVBAB67",13,0)
 F XI=0:0 S XI=$O(^DGPM("APTT1",DFN,XI)) Q:XI=""  F XJ=0:0 S XJ=$O(^DGPM("APTT1",DFN,XI,XJ)) Q:XJ=""  D DCHGDT S ^TMP("DVBA","ADMIT",$J,XADMDT,DFN)=XI_U_DCHGDT
"RTN","DVBAB67",14,0)
 S:SELDIV="Y" ^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",15,0)
 S:SELDIV="N" ^TMP("CAPRI",MSGCNT)="Original Division: "_ADIV_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",16,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",17,0)
 S ^TMP("CAPRI",MSGCNT)=$S(DOCTYPE="L":" Activity date: ",1:"Admission date: ")_$$FMTE^XLFDT(ADMDT,"5DZ")_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Request date: "_$$FMTE^XLFDT(RDATE,"5DZ")_"^"
"RTN","DVBAB67",18,0)
 S DCHGDT=""
"RTN","DVBAB67",19,0)
 I $D(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN)) S:DOCTYPE="A" DCHGDT=$P(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN),U,2)
"RTN","DVBAB67",20,0)
 D ELAPSED
"RTN","DVBAB67",21,0)
 I DCHGDT]""_"^" S Y=DCHGDT X ^DD("DD") S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="** Discharged: "_Y_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",22,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Items Pending:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",23,0)
ITEMS F Q=9,11,13,15,17,19,21,23,26,28 I $P(^DVB(396,DA,0),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAB67",24,0)
 S Q=7 I $P(^DVB(396,DA,1),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAB67",25,0)
 S:$D(^DVB(396,DA,2)) ^TMP("CAPRI",MSGCNT)="Requested by: "_$S($P(^DVB(396,DA,2),U,8)]"":$P(^(2),U,8),1:" (Not specified) ")_" AT "_$S($P(^(2),U,7)]"":$P(^(2),U,7),1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",26,0)
 S $P(^TMP("CAPRI",MSGCNT),"-")="-^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",27,0)
 S ^TMP("CAPRI",MSGCNT)="^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",28,0)
 Q
"RTN","DVBAB67",29,0)
 ;
"RTN","DVBAB67",30,0)
PRINT1 S:$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,6),"^",Q)
"RTN","DVBAB67",31,0)
 S:'$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,2),"^",9)
"RTN","DVBAB67",32,0)
 S:+GDIVPTR>0 GDIVNAM=$P(^DG(40.8,GDIVPTR,0),"^",1)
"RTN","DVBAB67",33,0)
 S:+GDIVPTR'>0 GDIVNAM=""
"RTN","DVBAB67",34,0)
 S NODTA=1 I QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" S ^TMP("CAPRI",MSGCNT)="        "_MD_GDIV_"^",MSGCNT=MSGCNT+1 S QQ='QQ Q
"RTN","DVBAB67",35,0)
 I 'QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" S ^TMP("CAPRI",MSGCNT)="                                    "_MD_GDIV_"^",MSGCNT=MSGCNT+1 S QQ='QQ I $Y>22 Q:DVBAQUIT=1
"RTN","DVBAB67",36,0)
 Q
"RTN","DVBAB67",37,0)
 ;
"RTN","DVBAB67",38,0)
ELAPSED K EDAYS S X1=DT,X=RDATE D ^XUWORKDY
"RTN","DVBAB67",39,0)
 S EDAYS=X
"RTN","DVBAB67",40,0)
 Q
"RTN","DVBAB67",41,0)
 ;
"RTN","DVBAB82")
0^6^B72472785
"RTN","DVBAB82",1,0)
DVBAB82 ;ALB - CAPRI DVBA REPORTS;03/08/02
"RTN","DVBAB82",2,0)
 ;;2.7;AMIE;**42,90**;Apr 10, 1995
"RTN","DVBAB82",3,0)
 Q
"RTN","DVBAB82",4,0)
 ;
"RTN","DVBAB82",5,0)
START(MSG,RPID,PARM) ; CALLED BY REMOTE PROCEDURE DVBAB REPORTS
"RTN","DVBAB82",6,0)
 ;Parameters
"RTN","DVBAB82",7,0)
 ;=============
"RTN","DVBAB82",8,0)
 ; MSG  : Output - ^TMP("DVBA",$J)
"RTN","DVBAB82",9,0)
 ; RPID : Report Identification Number
"RTN","DVBAB82",10,0)
 ; PARM : Input parameters separated by "^"
"RTN","DVBAB82",11,0)
 ;
"RTN","DVBAB82",12,0)
 N DVBHFS,DVBERR,DVBGUI,I
"RTN","DVBAB82",13,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAB82",14,0)
 S DVBGUI=1,DVBERR=0,DVBHFS=$$HFS(),RPID=$G(RPID)
"RTN","DVBAB82",15,0)
 I RPID<1!(RPID>9) S ^TMP("DVBA",$J,1)="0^Undefined Report ID" G END
"RTN","DVBAB82",16,0)
 D HFSOPEN("DVBRP",DVBHFS,"W") I DVBERR G END
"RTN","DVBAB82",17,0)
 I RPID=1 D CRMS G END
"RTN","DVBAB82",18,0)
 I RPID=3 D CPRNT G END
"RTN","DVBAB82",19,0)
 D CHECK I DVBERR G END
"RTN","DVBAB82",20,0)
 I RPID=2 D CRRR G END
"RTN","DVBAB82",21,0)
 I RPID=4 D CRPON G END
"RTN","DVBAB82",22,0)
 I RPID=5 D CIRPT G END
"RTN","DVBAB82",23,0)
 I RPID=6 D DSRP G END
"RTN","DVBAB82",24,0)
 I RPID=7 D SDPP G END
"RTN","DVBAB82",25,0)
 I RPID=8 D SPRPT G END
"RTN","DVBAB82",26,0)
 I RPID=9 D VIEW
"RTN","DVBAB82",27,0)
 ;
"RTN","DVBAB82",28,0)
END D HFSCLOSE("DVBRP",DVBHFS)
"RTN","DVBAB82",29,0)
 S I=0 F  S I=$O(^TMP("DVBA",$J,1,I)) Q:'I  S ^TMP("DVBA",$J,1,I)=^TMP("DVBA",$J,1,I)_$C(13)
"RTN","DVBAB82",30,0)
 S MSG=$NA(^TMP("DVBA",$J))
"RTN","DVBAB82",31,0)
 Q
"RTN","DVBAB82",32,0)
CHECK ; VALIDATE INPUT PARAMETERS
"RTN","DVBAB82",33,0)
 I $G(PARM)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Input Parameters"
"RTN","DVBAB82",34,0)
 Q
"RTN","DVBAB82",35,0)
 ;
"RTN","DVBAB82",36,0)
SDPP ; Report # 7 - Full (Patient Profile MAS) Report
"RTN","DVBAB82",37,0)
 ;Parameters
"RTN","DVBAB82",38,0)
 ;=============
"RTN","DVBAB82",39,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",40,0)
 ; SDR : R/Range or A/All
"RTN","DVBAB82",41,0)
 ; SDBD : Begining date
"RTN","DVBAB82",42,0)
 ; SDED : Ending date
"RTN","DVBAB82",43,0)
 ; SDP : Print the profile? 1 OR 0
"RTN","DVBAB82",44,0)
 ; SDTYP(2) : Print appointments? 1 OR 0
"RTN","DVBAB82",45,0)
 ; SDTYP(1) : Print add/edits? 1 or 0
"RTN","DVBAB82",46,0)
 ; SDTYP(4) : Print enrollments? 1 or 0
"RTN","DVBAB82",47,0)
 ; SDTYP(3) : Print dispositions? 1 OR 0
"RTN","DVBAB82",48,0)
 ; SDTYP(7) : Print team information? 1 OR 0
"RTN","DVBAB82",49,0)
 ; SDTYP(5) : Print means test? 1 OR 0
"RTN","DVBAB82",50,0)
 ;
"RTN","DVBAB82",51,0)
 N SDTYP,SDBD,SDED,SDACT,SDPRINT,SDYES,SDRANGE,SDBEG,SDEN
"RTN","DVBAB82",52,0)
 S DFN=$P(PARM,"^",1),SDR=$P(PARM,"^",2),SDBD=$P(PARM,"^",3),SDED=$P(PARM,"^",4)
"RTN","DVBAB82",53,0)
 S SDP=$P(PARM,"^",5),SDTYP(2)=$P(PARM,"^",6),SDTYP(1)=$P(PARM,"^",7)
"RTN","DVBAB82",54,0)
 S SDTYP(4)=$P(PARM,"^",8),SDTYP(3)=$P(PARM,"^",9),SDTYP(7)=$P(PARM,"^",10),SDTYP(5)=$P(PARM,"^",11)
"RTN","DVBAB82",55,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",56,0)
 S SDACT="",(SDYES,SDRANGE,SDPRINT)=0
"RTN","DVBAB82",57,0)
 I SDR="R" S SDRANGE=1
"RTN","DVBAB82",58,0)
 I SDP=1 S SDYES=1,SDPRINT=1
"RTN","DVBAB82",59,0)
 I 'SDRANGE S (SDBD,SDBEG)=2800101,(SDED,SDEND)=$$ENDDT(),SDHDR=1
"RTN","DVBAB82",60,0)
 D ENS^%ZISS
"RTN","DVBAB82",61,0)
 N SDYN,DVB S SDPRINT=1,DVB(1)=SDBD_";"_SDED,DVB(4)=DFN,DVB("FLDS")=1
"RTN","DVBAB82",62,0)
 ;I $$SDAPI^SDAMA301(.DVB)>0 D
"RTN","DVBAB82",63,0)
 I $O(^DPT(DFN,"S",SDBD)) D
"RTN","DVBAB82",64,0)
 . I SDTYP(2)=1 S SDTYP(2)="" Q
"RTN","DVBAB82",65,0)
 . K SDTYP(2)
"RTN","DVBAB82",66,0)
 IF $$EXOE^SDOE(DFN,SDBD,SDED) D
"RTN","DVBAB82",67,0)
 . I SDTYP(1)=1 S SDTYP(1)="" Q
"RTN","DVBAB82",68,0)
 . K SDTYP(1)
"RTN","DVBAB82",69,0)
 I $D(^DPT(DFN,"DE")) D
"RTN","DVBAB82",70,0)
 . I SDTYP(4)=1 S SDTYP(4)="",SDACT=0 Q
"RTN","DVBAB82",71,0)
 . K SDTYP(4)
"RTN","DVBAB82",72,0)
 I $D(^DPT(DFN,"DIS")),$S('SDRANGE:1,+$O(^("DIS",9999999-(SDED+.9)))&($O(^(9999999-(SDED+.9)))<(9999999-(SDBD-.1))):1,1:0) D
"RTN","DVBAB82",73,0)
 . I SDTYP(3)=1 S SDTYP(3)="" Q
"RTN","DVBAB82",74,0)
 . K SDTYP(3)
"RTN","DVBAB82",75,0)
 S SDYN=$$LST^DGMTU(DFN) I SDYN D
"RTN","DVBAB82",76,0)
 . I SDTYP(5)=1 S SDTYP(5)="" Q
"RTN","DVBAB82",77,0)
 . K SDTYP(5)
"RTN","DVBAB82",78,0)
 I SDTYP(7)=1 D
"RTN","DVBAB82",79,0)
 . S SDTYP(7)="",GBL="^TMP(""SDPP"","_$J_")" Q
"RTN","DVBAB82",80,0)
 . K SDTYP(7)
"RTN","DVBAB82",81,0)
 D PRINT^SDPPRT
"RTN","DVBAB82",82,0)
 K ^TMP($J,"SDAMA301") S VALMBCK="R"
"RTN","DVBAB82",83,0)
 Q
"RTN","DVBAB82",84,0)
ENDDT() ;Calculate end date for "all" date
"RTN","DVBAB82",85,0)
 N X S X=$O(^DPT(DFN,"S",""),-1) S:X<DT X=DT_.24 Q X
"RTN","DVBAB82",86,0)
 ;N X,X1,X2,%H S X1=DT,X2=36600
"RTN","DVBAB82",87,0)
 ;D C^%DTC
"RTN","DVBAB82",88,0)
 ;Q X_.24
"RTN","DVBAB82",89,0)
 ;
"RTN","DVBAB82",90,0)
VIEW ; Report # 9 - View Registration Data Report
"RTN","DVBAB82",91,0)
 ; Parameters
"RTN","DVBAB82",92,0)
 ; ==========
"RTN","DVBAB82",93,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",94,0)
 ;
"RTN","DVBAB82",95,0)
 U IO
"RTN","DVBAB82",96,0)
 S DFN=$P(PARM,"^",1)
"RTN","DVBAB82",97,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",98,0)
 D EN1^DGRP
"RTN","DVBAB82",99,0)
 Q
"RTN","DVBAB82",100,0)
DSRP ; Report # 6 - Reprint a Notice of Discharge Report
"RTN","DVBAB82",101,0)
 ; Parameters
"RTN","DVBAB82",102,0)
 ; % : 1=Report on all veterans for a given day (BDATE required)
"RTN","DVBAB82",103,0)
 ;   : 0=Report on a single Veteran (DFN required)
"RTN","DVBAB82",104,0)
 ; BDATE : Original Processing Date - $H/FileMan
"RTN","DVBAB82",105,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",106,0)
 ;
"RTN","DVBAB82",107,0)
 N %,BDATE,DFN,DFNIEN
"RTN","DVBAB82",108,0)
 S %=$P(PARM,"^",1),BDATE=$P(PARM,"^",2),DFN=$P(PARM,"^",3),DFNIEN=""
"RTN","DVBAB82",109,0)
 I BDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date"  Q
"RTN","DVBAB82",110,0)
 D DUZ2^DVBAUTIL
"RTN","DVBAB82",111,0)
 U IO
"RTN","DVBAB82",112,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",113,0)
 I %=1 D  Q
"RTN","DVBAB82",114,0)
 . S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBAB82",115,0)
 . D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB82",116,0)
 . S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB82",117,0)
 . I $D(^DVB(396.2,"B",DFN)) D
"RTN","DVBAB82",118,0)
 . . S DFNIEN=$O(^DVB(396.2,"B",DFN,DFNIEN)),ADM=$P(^DVB(396.2,DFNIEN,0),U,3)
"RTN","DVBAB82",119,0)
 . . I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"" S DCHPTR=$P(^DGPM(+ADM,0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"":$P(^(0),U,1),1:"") W ?($X+5),"Discharge date: ",$$FMTE^XLFDT(DISCH,"5DZ")
"RTN","DVBAB82",120,0)
 . . I $P(^DVB(396.2,DFNIEN,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 Q
"RTN","DVBAB82",121,0)
 . . I DFNIEN>0 S XDA=DFNIEN,DA=$P(^DVB(396.2,DFNIEN,0),U,1),ADMDT=$P(^DVB(396.2,DFNIEN,0),U,2),MB=$P(^(0),U,3)
"RTN","DVBAB82",122,0)
 . . D REPRINT^DVBADSNT
"RTN","DVBAB82",123,0)
 D DEQUE^DVBADSRP
"RTN","DVBAB82",124,0)
 Q
"RTN","DVBAB82",125,0)
 ;
"RTN","DVBAB82",126,0)
SPRPT ; Report # 8 - OP(Operation Report)
"RTN","DVBAB82",127,0)
 ;Parameters
"RTN","DVBAB82",128,0)
 ;=============
"RTN","DVBAB82",129,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",130,0)
 ; SRTN : Select Operation
"RTN","DVBAB82",131,0)
 ;
"RTN","DVBAB82",132,0)
 N DFN,SRTN,MAGTMPR2,SRSITE
"RTN","DVBAB82",133,0)
 I $O(^SRO(133,1))'="B" S SRSITE=1
"RTN","DVBAB82",134,0)
 S DFN=$P(PARM,"^",1),SRTN=$P(PARM,"^",2),MAGTMPR2=1
"RTN","DVBAB82",135,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",136,0)
 D ^SROPRPT
"RTN","DVBAB82",137,0)
 Q
"RTN","DVBAB82",138,0)
 ;
"RTN","DVBAB82",139,0)
CRPON ; Report # - 4 Reprint C&P Final Report
"RTN","DVBAB82",140,0)
 ;Parameters
"RTN","DVBAB82",141,0)
 ;=============
"RTN","DVBAB82",142,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",143,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",144,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",145,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",146,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",147,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",148,0)
 ;
"RTN","DVBAB82",149,0)
 U IO
"RTN","DVBAB82",150,0)
 N ONE
"RTN","DVBAB82",151,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",152,0)
 D VAL Q:DVBERR
"RTN","DVBAB82",153,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",ONE="N",Y=DT
"RTN","DVBAB82",154,0)
 X XDD S HD="Reprint C & P Exams",SUPER=0
"RTN","DVBAB82",155,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBAB82",156,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",157,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",158,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",159,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",160,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",161,0)
 I RTYPE="D" D GO^DVBCRPRT Q
"RTN","DVBAB82",162,0)
 I RTYPE="V" D
"RTN","DVBAB82",163,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",164,0)
 . I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! Q
"RTN","DVBAB82",165,0)
 . I RO=DUZ(2)&('$D(AUTO))&("RC"'[($P(^DVB(396.3,DA,0),U,18))) W *7,!!,"This request has not been released to the Regional Office yet.",!! Q
"RTN","DVBAB82",166,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 Q
"RTN","DVBAB82",167,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",168,0)
 . ;D OV^DVBCRPON
"RTN","DVBAB82",169,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,STEP2^DVBCRPRT
"RTN","DVBAB82",170,0)
 Q
"RTN","DVBAB82",171,0)
 ;
"RTN","DVBAB82",172,0)
CIRPT ; Report # 5 - Insufficient Exam Report
"RTN","DVBAB82",173,0)
 ;Parameters
"RTN","DVBAB82",174,0)
 ;=============
"RTN","DVBAB82",175,0)
 ; RPTTYPE : D/Detailed or S/Summary
"RTN","DVBAB82",176,0)
 ; BEGDT : Beginning date $H/FileMan
"RTN","DVBAB82",177,0)
 ; ENDDT : Ending date $H/FileMan
"RTN","DVBAB82",178,0)
 ; RESANS : Insufficient Reason
"RTN","DVBAB82",179,0)
 ;
"RTN","DVBAB82",180,0)
 U IO
"RTN","DVBAB82",181,0)
 S RPTTYPE=$P(PARM,"^",1),BEGDT=$P(PARM,"^",2),ENDDT=$P(PARM,"^",3),RESANS=$P(PARM,"^",4)
"RTN","DVBAB82",182,0)
 I RPTTYPE="S" D SUM^DVBCIRPT Q
"RTN","DVBAB82",183,0)
 I RPTTYPE="D" D
"RTN","DVBAB82",184,0)
 . I RESANS="" S Y=-1 D INREAS
"RTN","DVBAB82",185,0)
 . I '$D(DVBAARY("REASON")) S DVBAQTSL=""
"RTN","DVBAB82",186,0)
 . S DVBCYQ=""
"RTN","DVBAB82",187,0)
 . I RESANS'="" S Y=RESANS D INREAS
"RTN","DVBAB82",188,0)
 . K DTOUT,DUOUT
"RTN","DVBAB82",189,0)
 . S Y=-1 D EXMTPE,DETAIL^DVBCIRP1
"RTN","DVBAB82",190,0)
 Q
"RTN","DVBAB82",191,0)
 ;
"RTN","DVBAB82",192,0)
EXMTPE ;
"RTN","DVBAB82",193,0)
 N YSAVE,DVBAXIFN
"RTN","DVBAB82",194,0)
 S YSAVE=Y
"RTN","DVBAB82",195,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.6,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",196,0)
 . S ^TMP($J,"XMTYPE",DVBAXIFN)=""
"RTN","DVBAB82",197,0)
 S Y=-1
"RTN","DVBAB82",198,0)
 I +YSAVE>0 S ^TMP($J,"XMTYPE",+YSAVE)=""
"RTN","DVBAB82",199,0)
 S Y=YSAVE
"RTN","DVBAB82",200,0)
 Q
"RTN","DVBAB82",201,0)
INREAS ;
"RTN","DVBAB82",202,0)
 N YSAVE,DVBXIFN
"RTN","DVBAB82",203,0)
 S YSAVE=Y
"RTN","DVBAB82",204,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.94,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",205,0)
 . S DVBAARY("REASON",DVBAXIFN)=""
"RTN","DVBAB82",206,0)
 S Y=-1
"RTN","DVBAB82",207,0)
 I +YSAVE>0 S DVBAARY("REASON",+YSAVE)=""
"RTN","DVBAB82",208,0)
 S Y=YSAVE
"RTN","DVBAB82",209,0)
 Q
"RTN","DVBAB82",210,0)
 ;
"RTN","DVBAB82",211,0)
CRMS ; Report # 1 - Regional Office 21- day Certificate Printing Report.
"RTN","DVBAB82",212,0)
 ; No Parameters
"RTN","DVBAB82",213,0)
 ;
"RTN","DVBAB82",214,0)
 U IO
"RTN","DVBAB82",215,0)
 D ^DVBACRMS
"RTN","DVBAB82",216,0)
 Q
"RTN","DVBAB82",217,0)
 ;
"RTN","DVBAB82",218,0)
CRRR ; Report # 2 - Reprint a 21 - day Certificate for the RO
"RTN","DVBAB82",219,0)
 ;Parameters
"RTN","DVBAB82",220,0)
 ;=============
"RTN","DVBAB82",221,0)
 ; DVBSEL : Select one of the following:
"RTN","DVBAB82",222,0)
 ;       N         Patient Name
"RTN","DVBAB82",223,0)
 ;       D         ORIGINAL PROCESSING DATE
"RTN","DVBAB82",224,0)
 ; SDATE : ORIGINAL PROCESSING date - $H/FileMan
"RTN","DVBAB82",225,0)
 ; XDA : Patient IEN
"RTN","DVBAB82",226,0)
 ;
"RTN","DVBAB82",227,0)
 U IO
"RTN","DVBAB82",228,0)
 S DVBSEL=$P(PARM,"^",1),SDATE=$P(PARM,"^",2),XDA=$P(PARM,"^",3)
"RTN","DVBAB82",229,0)
 I "^D^N^"'[DVBSEL S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",230,0)
 I DVBSEL="D" D  I DVBERR Q
"RTN","DVBAB82",231,0)
 . I SDATE="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Date" Q
"RTN","DVBAB82",232,0)
 . S %DT="X" S X=SDATE D ^%DT I Y<0 D  Q
"RTN","DVBAB82",233,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date Format"
"RTN","DVBAB82",234,0)
 I DVBSEL="N" D  I DVBERR Q
"RTN","DVBAB82",235,0)
 . I XDA="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",236,0)
 . S DIC=2,DIC(0)="NZX",X=XDA D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",237,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",238,0)
 . S DFN=XDA
"RTN","DVBAB82",239,0)
 D INIT^DVBACRRR I 'CONT Q
"RTN","DVBAB82",240,0)
 D HDR^DVBACRRR,DATA^DVBACRRR
"RTN","DVBAB82",241,0)
 Q
"RTN","DVBAB82",242,0)
 ;
"RTN","DVBAB82",243,0)
CPRNT ; Report # 3 - Print C&P Final Report (manual) Report
"RTN","DVBAB82",244,0)
 ; No Parameters
"RTN","DVBAB82",245,0)
 ;
"RTN","DVBAB82",246,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_",Y=DT
"RTN","DVBAB82",247,0)
 X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not Specified")
"RTN","DVBAB82",248,0)
 D GO^DVBCPRNT
"RTN","DVBAB82",249,0)
 Q
"RTN","DVBAB82",250,0)
VAL ; VALIDATE PATIENT
"RTN","DVBAB82",251,0)
 I $G(DFN)="" S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" G END
"RTN","DVBAB82",252,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC
"RTN","DVBAB82",253,0)
 I Y<0 S DVBERR=1,^TMP("DVBA",$J,1)="0^Invalid Patient Name." G END
"RTN","DVBAB82",254,0)
 Q
"RTN","DVBAB82",255,0)
 ;
"RTN","DVBAB82",256,0)
HFS() ; -- get hfs file name
"RTN","DVBAB82",257,0)
 N H
"RTN","DVBAB82",258,0)
 S H=$H
"RTN","DVBAB82",259,0)
 Q "DVBA_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","DVBAB82",260,0)
 ;
"RTN","DVBAB82",261,0)
HFSOPEN(HANDLE,DVBHFS,DVBMODE) ; Open File
"RTN","DVBAB82",262,0)
 S DVBDIRY=$$GET^XPAR("DIV","DVB HFS SCRATCH")
"RTN","DVBAB82",263,0)
 ;I DVBDIRY="" S ECERR=1 D  Q
"RTN","DVBAB82",264,0)
 ;. S ^TMP("DVBA",$J,1)="0^A scratch directory for reports doesn't exist"
"RTN","DVBAB82",265,0)
 D OPEN^%ZISH(HANDLE,,DVBHFS,$G(DVBMODE,"W")) D:POP  Q:POP
"RTN","DVBAB82",266,0)
 .S DVBERR=1,^TMP("DVBA",$J,1)="0^Unable to open file "
"RTN","DVBAB82",267,0)
 Q
"RTN","DVBAB82",268,0)
 ;
"RTN","DVBAB82",269,0)
HFSCLOSE(HANDLE,DVBHFS) ;Close HFS and unload data
"RTN","DVBAB82",270,0)
 N DVBDEL,X,%ZIS
"RTN","DVBAB82",271,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","DVBAB82",272,0)
 S ROOT=$NA(^TMP("DVBA",$J,1)),DVBDEL(DVBHFS)=""
"RTN","DVBAB82",273,0)
 K @ROOT
"RTN","DVBAB82",274,0)
 S X=$$FTG^%ZISH(,DVBHFS,$NA(@ROOT@(1)),4)
"RTN","DVBAB82",275,0)
 S X=$$DEL^%ZISH(,$NA(DVBDEL))
"RTN","DVBAB82",276,0)
 Q
"RTN","DVBAB84")
0^1^B28830871
"RTN","DVBAB84",1,0)
DVBAB84 ;ALB - CAPRI REMOTE NEW PERSON FILE ;03/15/05
"RTN","DVBAB84",2,0)
 ;;2.7;AMIE;**90**;Apr 10, 1995
"RTN","DVBAB84",3,0)
 ;
"RTN","DVBAB84",4,0)
START(MSG) ;RPC DVBAB NEW PERSON FILE
"RTN","DVBAB84",5,0)
 K ^TMP("DVBAB200",$J)
"RTN","DVBAB84",6,0)
 N DATA,VAR,VAR1,DVBDIV,DVBDIVN,DVBRPT,CNT
"RTN","DVBAB84",7,0)
 S DATA="",CNT=0,MSG=$NA(^TMP("DVBAB200",$J))
"RTN","DVBAB84",8,0)
 F  S DATA=$O(^VA(200,"B",DATA)) Q:DATA=""  D
"RTN","DVBAB84",9,0)
 . S VAR=""
"RTN","DVBAB84",10,0)
 . F  S VAR=$O(^VA(200,"B",DATA,VAR)) Q:VAR=""  D
"RTN","DVBAB84",11,0)
 . . D GETS^DIQ(200,VAR_",",".01","E","DVBRPT")
"RTN","DVBAB84",12,0)
 . . I $P($G(^VA(200,VAR,2,0)),"^",3)'="" D  Q
"RTN","DVBAB84",13,0)
 . . . S VAR1=""
"RTN","DVBAB84",14,0)
 . . . F  S VAR1=$O(^VA(200,VAR,2,"B",VAR1)) Q:VAR1=""  D
"RTN","DVBAB84",15,0)
 . . . . S DVBDIV=$$GET1^DIQ(200.02,VAR1_","_VAR_",",.01,"I")
"RTN","DVBAB84",16,0)
 . . . . S DVBDIVN=$$GET1^DIQ(200.02,VAR1_","_VAR_",",.01,"E")
"RTN","DVBAB84",17,0)
 . . . . S ^TMP("DVBAB200",$J,CNT)=VAR_"^"_DVBRPT(200,VAR_",",.01,"E")_"^"_DVBDIV_"^"_DVBDIVN_$C(13)
"RTN","DVBAB84",18,0)
 . . . . S CNT=CNT+1
"RTN","DVBAB84",19,0)
 . . S ^TMP("DVBAB200",$J,CNT)=VAR_"^"_DVBRPT(200,VAR_",",.01,"E")_"^"_"^"_$C(13)
"RTN","DVBAB84",20,0)
 . . S CNT=CNT+1
"RTN","DVBAB84",21,0)
 Q
"RTN","DVBAB84",22,0)
DUZ2(Y,NUM) ;RPC DVBAB SET DUZ2
"RTN","DVBAB84",23,0)
 N X,Z S NUM=$G(NUM),Y=1,X="0^STATION NUMBER "
"RTN","DVBAB84",24,0)
 I NUM="" S Y=X_"IS REQUIRED"
"RTN","DVBAB84",25,0)
 I '$D(^DIC(4,"D",NUM))&Y S Y=X_"DOES NOT EXIST"
"RTN","DVBAB84",26,0)
 Q:'Y  S Y=$O(^DIC(4,"D",NUM,"")),Z=""
"RTN","DVBAB84",27,0)
 S:Y]"" Z=$G(^DIC(4,Y,0))
"RTN","DVBAB84",28,0)
 I Y=""!(Z="") S Y=X_"HAS A BAD X-REF" Q
"RTN","DVBAB84",29,0)
 S DUZ(2)=Y,Y=Y_U_$P(Z,U)
"RTN","DVBAB84",30,0)
 Q
"RTN","DVBAB84",31,0)
DUP(Y,NAM,DOB,SSN) ;RPC DVBAB FIND DUPS
"RTN","DVBAB84",32,0)
 N E,C,N,D,S,A,B,M S B=" - Must be ",M=B_"at least 1 argument"
"RTN","DVBAB84",33,0)
 S NAM=$$N0($G(NAM)),DOB=$P($G(DOB),"."),SSN=$$U($G(SSN))
"RTN","DVBAB84",34,0)
 S (C,N,D,S)=0,E="-1^Invalid Argument: ",Y=$NA(^TMP("DVBDUP",$J,DUZ)) K @Y
"RTN","DVBAB84",35,0)
 I '$L(NAM_DOB_SSN) S C=E_"None Passed"_M
"RTN","DVBAB84",36,0)
 S:'C&DOB&'$L(NAM_SSN) C=E_$P(M," ",3,8)_" passed with DOB"
"RTN","DVBAB84",37,0)
 S:'C N=$$VN(NAM) I N S C=E_"NAM"_B_"LAST,FIRST or IEN"
"RTN","DVBAB84",38,0)
 S:'C D=$$VD(DOB) I D S C=E_"DOB"_B_"FileMan format"
"RTN","DVBAB84",39,0)
 S:'C S=$$VS(SSN) I S>0 S C=E_"SSN"_B_"9 digits, 1U4N format, or P (for pseudo-SSN)"
"RTN","DVBAB84",40,0)
 I C S @Y@(0)=C Q
"RTN","DVBAB84",41,0)
 S:S<0 SSN=$$S(NAM,DOB)
"RTN","DVBAB84",42,0)
 D DN(.N,NAM),DD(.D,DOB,NAM,SSN),DS(.S,SSN,NAM,DOB),WT(Y,.A,.N,.D,.S)
"RTN","DVBAB84",43,0)
 Q
"RTN","DVBAB84",44,0)
DN(A,N) I N=""!A S A=0 Q  ;Dup Name checks
"RTN","DVBAB84",45,0)
 N K,M S A=0,M=$$N2(N),K=$$N1(M)_"zzzzzzzzzz"
"RTN","DVBAB84",46,0)
 F  S K=$O(^DPT("B",K)) Q:$$N2(K)'=M  D:$$M("N",K,N,,,5) D0(.A,"B",K)
"RTN","DVBAB84",47,0)
 Q
"RTN","DVBAB84",48,0)
DD(A,D,N,S) I A!'D S A=0 Q  ;Dup DOB checks
"RTN","DVBAB84",49,0)
 N K,M,F S A=0,M=$E(D,1,5),K=M-1_99
"RTN","DVBAB84",50,0)
 F  S K=$O(^DPT("ADOB",K)) Q:$E(K,1,5)'=M  D
"RTN","DVBAB84",51,0)
 .S F=0 I N]"",$$M("DN",K,N,D,,7) S F=1
"RTN","DVBAB84",52,0)
 .I 'F,S]"",$$M("DS",K,,D,S,7) S F=1
"RTN","DVBAB84",53,0)
 .D:F D0(.A,"ADOB",K)
"RTN","DVBAB84",54,0)
 Q
"RTN","DVBAB84",55,0)
DS(A,S,N,D) N F,K,M,X,R,P I A!'S S A=0 Q  ;Dup SSN checks
"RTN","DVBAB84",56,0)
 S A=0,P=$L(S),R=P-4,M=$E(S,1,R),K=M-1_9999,X=$S(P=5:"BS5",1:"SSN")
"RTN","DVBAB84",57,0)
 F  S K=$O(^DPT(X,K)) Q:$E(K,1,R)'=M  D
"RTN","DVBAB84",58,0)
 .S F=$$M("S",K,,,S,P) I F D D0(.A,X,K) Q
"RTN","DVBAB84",59,0)
 .Q:N=""&'D  Q:'$$FF(S,K)
"RTN","DVBAB84",60,0)
 .I D,$$MD(K,D,1) D D0(.A,X,K,3,D) Q
"RTN","DVBAB84",61,0)
 .I N]"",$$MN(K,N,1) D D0(.A,X,K,1,N)
"RTN","DVBAB84",62,0)
 Q
"RTN","DVBAB84",63,0)
D0(A,X,Y,P,V) N I,C,Z S I="",C="N D     S",P=$G(P),V=$G(V)
"RTN","DVBAB84",64,0)
 F  S I=$O(^DPT(X,Y,I)) Q:'I  D
"RTN","DVBAB84",65,0)
 .S Z=$G(^DPT(I,0)) Q:Z=""
"RTN","DVBAB84",66,0)
 .I P,'$$M($E(C,P),$P(Z,U,P),V,V,V,5) Q
"RTN","DVBAB84",67,0)
 .S A=A+1,A(I)=Z
"RTN","DVBAB84",68,0)
 Q
"RTN","DVBAB84",69,0)
VN(X) Q:X="" 0  Q X'?2.U1","2.U  ;Validate Name
"RTN","DVBAB84",70,0)
VD(X) Q:X="" 0  Q:X'?7N 1  N M,D S M=$E(X,4,5),D=$E(X,6,7)  ;Validate DOB
"RTN","DVBAB84",71,0)
 Q:M<1!(M>12)!(D<0) 1  Q (D>$$D(M,$E(X,1,3)))
"RTN","DVBAB84",72,0)
VS(X) Q:X="" 0  Q:$E(X,$L(X))="P" -1  N L S L=$L(X)  ;Validate SSN
"RTN","DVBAB84",73,0)
 Q:L=5&(X'?1A4N)!(L=9&(X'?9N))!(L<5)!(L>9) 1
"RTN","DVBAB84",74,0)
 Q:$E(X,1,5)="00000" 0  ;Test Patient
"RTN","DVBAB84",75,0)
 Q $E(X,1)=9!($E(X,1,3)="000")  ;Can't begin with 9 or 000
"RTN","DVBAB84",76,0)
MN(X,N,F) S F=$G(F)_U_($$N2(X,2)=$$N2(N,2)) Q:'F $P(F,U,2)  Q $$N2(X)=$$N2(N)  ;Match Name
"RTN","DVBAB84",77,0)
MD(X,D,F) S F=$G(F)_U_($E(X,4,5)=$E(D,4,5)) Q:'F $P(F,U,2)  Q $E(X,1,3)=$E(D,1,3)  ;Match DOB
"RTN","DVBAB84",78,0)
MS(X,S) N I,K S K=0,X=$$L4(X),S=$$L4(S)  ;Match SSN
"RTN","DVBAB84",79,0)
 F I=1:1:4 S K=$E(X,I)=$E(S,I)+K
"RTN","DVBAB84",80,0)
 Q:K>1 1  ;2 nums, same spot
"RTN","DVBAB84",81,0)
 Q $$S4(X)=$$S4(S)  ;ALL 4 nums, any spot
"RTN","DVBAB84",82,0)
M(Y,X,N,D,S,L) N A,B,C,Z S (A,B,C)=0,Z=$L(X),L=+$G(L) Q:Z<L 0
"RTN","DVBAB84",83,0)
 S:Y["N" A=$$MN(X,N) S:Y["D" B=$$MD(X,D) S:Y["S" C=$$MS(X,S)
"RTN","DVBAB84",84,0)
 Q:Y="N" A  Q:Y="D" B  Q:Y="S" C  Q:Y'["N" B&C
"RTN","DVBAB84",85,0)
 Q:Y'["D" A&C  Q:Y'["S" A&B  Q A&B&C
"RTN","DVBAB84",86,0)
WT(Y,A,N,D,S) N C S C=$$W0(.A,.N,.D,.S),@Y@(0)=C Q:'C  ;Weights
"RTN","DVBAB84",87,0)
 N I,J,K,L S (C,I,J,K,L)=""
"RTN","DVBAB84",88,0)
 F  S I=$O(A(I)) Q:'I  F  S J=$O(A(I,J)) Q:'J  D
"RTN","DVBAB84",89,0)
 .S K=K+1,K(-J,$P(A(I,J),U),K)=I_U_A(I,J)
"RTN","DVBAB84",90,0)
 F  S I=$O(K(I)) Q:'I  F  S J=$O(K(I,J)) Q:J=""  D
"RTN","DVBAB84",91,0)
 .F  S L=$O(K(I,J,L)) Q:'L  S C=C+1,@Y@(C)=K(I,J,L)
"RTN","DVBAB84",92,0)
 Q
"RTN","DVBAB84",93,0)
W0(A,N,D,S) Q:N&D&S $$W3(.A,.N,.D,.S)  Q:N&S&'D $$W2(.A,.N,.S)
"RTN","DVBAB84",94,0)
 Q:D&S&'N $$W2(.A,.D,.S)  Q:N&D&'S $$W2(.A,.N,.D)
"RTN","DVBAB84",95,0)
 Q:S&'N&'D $$W1(.A,.S)  Q:N&'D&'S $$W1(.A,.N)  ;Q:D&'N&'S $$W1(.A,.D)
"RTN","DVBAB84",96,0)
 Q 0
"RTN","DVBAB84",97,0)
W1(A,X) N I,C S (I,C)=0 ;Weighting 1
"RTN","DVBAB84",98,0)
 F  S I=$O(X(I)) Q:'I  S C=C+1,A(I,1)=X(I)
"RTN","DVBAB84",99,0)
 Q C
"RTN","DVBAB84",100,0)
W2(A,X,Y) N I,C S (I,C)=0 ;Weighting 2
"RTN","DVBAB84",101,0)
 F  S I=$O(X(I)) Q:'I  S C=C+1 D
"RTN","DVBAB84",102,0)
 .I $D(Y(I)) S A(I,2)=Y(I)
"RTN","DVBAB84",103,0)
 .E  S A(I,1)=X(I)
"RTN","DVBAB84",104,0)
 F  S I=$O(Y(I)) Q:'I  S:'$D(X(I)) C=C+1,A(I,1)=Y(I)
"RTN","DVBAB84",105,0)
 Q C
"RTN","DVBAB84",106,0)
W3(A,X,Y,Z) N I,C S (I,C)=0 ;Weighting 3
"RTN","DVBAB84",107,0)
 F  S I=$O(X(I)) Q:'I  S C=C+1 D
"RTN","DVBAB84",108,0)
 .I $D(Y(I)) D  Q
"RTN","DVBAB84",109,0)
 ..I $D(Z(I)) S A(I,3)=Z(I)
"RTN","DVBAB84",110,0)
 ..E  S A(I,2)=Y(I)
"RTN","DVBAB84",111,0)
 .I $D(Z(I)) S A(I,2)=Z(I)
"RTN","DVBAB84",112,0)
 .E  S A(I,1)=X(I)
"RTN","DVBAB84",113,0)
 Q C+$$W2(.A,.Y,.Z)
"RTN","DVBAB84",114,0)
N0(X) Q:X="" ""  I X?.1"`"1.N S:X["`" X=$P(X,"`",2) S X=$P($G(^DPT(X,0)),U)
"RTN","DVBAB84",115,0)
 Q $$U($$P(X,", "))
"RTN","DVBAB84",116,0)
N1(X) Q $E(X,1,$L(X)-1)_$C($A($E(X,$L(X)))-1)
"RTN","DVBAB84",117,0)
N2(X,Y) Q $E($$P($P(X,",",$G(Y,1)),2),1,2)
"RTN","DVBAB84",118,0)
U(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","DVBAB84",119,0)
L4(X) N L S L=$L(X) S:$E(X,L)="P" L=L-1,X=$E(X,1,L) Q $E(X,L-3,L)
"RTN","DVBAB84",120,0)
D(M,Y) Q:M=2 28+$$L(Y+1700)  Q 31-((M<7&'(M#2))!(M>7&(M#2)))
"RTN","DVBAB84",121,0)
L(Y) Q Y#100!('(Y#400)&'(Y#4))
"RTN","DVBAB84",122,0)
C(X) S X=$A($E(X,1))-65\3+1 Q:X<0 0  Q X
"RTN","DVBAB84",123,0)
P(X,C,L) N I,Y,Z S Z="",Y=X,C=$G(C,U),L=$G(L,$L(Y))
"RTN","DVBAB84",124,0)
 F I=1:1:$L(Y) Q:$L(Z)=L  S X=$E(Y,I) S:X?1U!(C[X) Z=Z_X
"RTN","DVBAB84",125,0)
 Q Z
"RTN","DVBAB84",126,0)
S(N,D) N L1,L2,L3 S:$G(D)="" D=2000000 ;PSEU^DGRPDD1
"RTN","DVBAB84",127,0)
 S L3=$$C(N),L1=$$C($P(N," ",2)),L2=$$C($P(N,",",2))
"RTN","DVBAB84",128,0)
 Q L2_L1_L3_$E(D,4,7)_$E(D,2,3)_"P"
"RTN","DVBAB84",129,0)
A(X) Q $S(X<0:X*-1,1:X)
"RTN","DVBAB84",130,0)
FF(X,Y) N I,K S X=$$L4(X),Y=$$L4(Y),K=0
"RTN","DVBAB84",131,0)
 F I=1:1:4 S:$$A($E(X,I)-$E(Y,I))<2 K=K+1
"RTN","DVBAB84",132,0)
 Q K>2
"RTN","DVBAB84",133,0)
S4(X) N I,J,K,L,M S L=$L(X)
"RTN","DVBAB84",134,0)
 F I=2:1:L S J=I,K=$E(X,I) D
"RTN","DVBAB84",135,0)
 .F  Q:J=1  S M=$E(X,J-1)  Q:M'>K  S $E(X,J)=M,J=J-1
"RTN","DVBAB84",136,0)
 .S $E(X,J)=K
"RTN","DVBAB84",137,0)
 Q X
"RTN","DVBAB85")
0^3^B3730560
"RTN","DVBAB85",1,0)
DVBAB85 ;SPH - CAPRI REPORTS ;03/01/05
"RTN","DVBAB85",2,0)
 ;;2.7;AMIE;**90**;Apr 10, 1995
"RTN","DVBAB85",3,0)
 ;
"RTN","DVBAB85",4,0)
RPTSTAT(Y,DVBDSTRT,DVBDBEND) ;
"RTN","DVBAB85",5,0)
 ; REPORT FORMAT:
"RTN","DVBAB85",6,0)
 ; PT NAME + AUTHOR + DATE/TIME ENTERED + DATE/TIME LOCKED + STATUS
"RTN","DVBAB85",7,0)
 ; FORM 1, FORM 2, ETC.
"RTN","DVBAB85",8,0)
 N DVBABIEN,DVBABCNT,DVBABIE2,DVBTEMP,DVBNM,DVBAUT,DVBDTE,DVBDTL,DVBST,DVBEXAMS,ST
"RTN","DVBAB85",9,0)
 K ^TMP("DVBARPT",DUZ)
"RTN","DVBAB85",10,0)
 S DVBABIEN=0,DVBABCNT=0,ST("P")="REVIEW PENDING",ST("N")="NOT REQUIRED",ST("S")="SENT BACK"
"RTN","DVBAB85",11,0)
 S ST("C")="COMPLETE",ST("D")="DRAFT",ST("A")="AWAITING SIGNATURE",ST("U")="UNCOSIGNED"
"RTN","DVBAB85",12,0)
 F  S DVBABIEN=$O(^DVB(396.17,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB85",13,0)
 . S DVBTEMP=$G(^DVB(396.17,DVBABIEN,0)),DVBDTE=$P(DVBTEMP,"^",3)
"RTN","DVBAB85",14,0)
 . I DVBTEMP]"",DVBDTE>DVBDSTRT,DVBDTE-1<DVBDBEND D
"RTN","DVBAB85",15,0)
 .. S DVBNM=$P(^DPT(+DVBTEMP,0),"^",1),DVBAUT=$P(^VA(200,$P(DVBTEMP,"^",2),0),"^",1),Y=$P(DVBTEMP,"^",3)
"RTN","DVBAB85",16,0)
 .. X ^DD("DD") S DVBDTE=Y,Y=$P(DVBTEMP,"^",5) X ^DD("DD")
"RTN","DVBAB85",17,0)
 .. S DVBDTL=Y,DVBEXAMS="",DVBABIE2=0,DVBST=$P(^DVB(396.17,DVBABIEN,5),"^",2)
"RTN","DVBAB85",18,0)
 .. S:$D(ST(DVBST)) DVBST=ST(DVBST)
"RTN","DVBAB85",19,0)
 .. F  S DVBABIE2=$O(^DVB(396.17,DVBABIEN,1,DVBABIE2)) Q:'DVBABIE2  S DVBEXAMS=DVBEXAMS_"|"_$P(^DVB(396.17,DVBABIEN,1,DVBABIE2,0),"^",2)
"RTN","DVBAB85",20,0)
 .. S ^TMP("DVBARPT",DUZ,DVBABCNT)=DVBNM_"^"_DVBAUT_"^"_DVBDTE_"^"_DVBDTL_"^"_DVBST_"^"_DVBEXAMS_$C(13)
"RTN","DVBAB85",21,0)
 .. S DVBABCNT=DVBABCNT+1
"RTN","DVBAB85",22,0)
 S Y=$NA(^TMP("DVBARPT",DUZ))
"RTN","DVBAB85",23,0)
 Q
"RTN","DVBABFRM")
0^2^B22703369
"RTN","DVBABFRM",1,0)
DVBABFRM ;ALB/SPH - CAPRI TEMPLATE/WORKSHEETS UTILITIES ;11/17/02
"RTN","DVBABFRM",2,0)
 ;;2.7;AMIE;**53,57,90**;Apr 10, 1995
"RTN","DVBABFRM",3,0)
 ;
"RTN","DVBABFRM",4,0)
DEFINE(Y,DVBIEN,DVBTYPE) ;
"RTN","DVBABFRM",5,0)
 ; DVBTYPE:  1= Form Definition, 2=Script, 3=Report
"RTN","DVBABFRM",6,0)
 N DVBJ K ^TMP($J,"AMIE")
"RTN","DVBABFRM",7,0)
 S DVBJ=0,DVBTYPE=DVBTYPE+2,Y=$NA(^TMP($J,"AMIE"))
"RTN","DVBABFRM",8,0)
 F  S DVBJ=$O(^DVB(396.18,DVBIEN,DVBTYPE,DVBJ)) Q:'DVBJ  D
"RTN","DVBABFRM",9,0)
 .S ^TMP($J,"AMIE",DVBJ)=$G(^DVB(396.18,DVBIEN,DVBTYPE,DVBJ,0))_$C(13)
"RTN","DVBABFRM",10,0)
 Q
"RTN","DVBABFRM",11,0)
UPDATE(Y,DVBIEN,DVBTYPE,DVBLINES,DVBLINEC,DVBLINEB) ;
"RTN","DVBABFRM",12,0)
 ; DVBTYPE:  1= Form Definition, 2=Script, 3=Report
"RTN","DVBABFRM",13,0)
 N DVBNUM,DVBCOUNT
"RTN","DVBABFRM",14,0)
 I DVBTYPE=1,DVBLINEB=0 D
"RTN","DVBABFRM",15,0)
 .K ^DVB(396.18,DVBIEN,3)
"RTN","DVBABFRM",16,0)
 .S ^DVB(396.18,DVBIEN,3,0)=DVBLINES(1)
"RTN","DVBABFRM",17,0)
 S DVBNUM=DVBLINEB,DVBCOUNT=1,DVBTYPE=DVBTYPE+2
"RTN","DVBABFRM",18,0)
 I DVBLINEB=0 S DVBCOUNT=2
"RTN","DVBABFRM",19,0)
 I DVBNUM>0 S DVBNUM=DVBNUM-1
"RTN","DVBABFRM",20,0)
 F  S DVBNUM=DVBNUM+1 Q:DVBNUM=(DVBLINEC+DVBLINEB)  D
"RTN","DVBABFRM",21,0)
 .S ^DVB(396.18,DVBIEN,DVBTYPE,DVBNUM,0)=DVBLINES(DVBCOUNT),DVBCOUNT=DVBCOUNT+1
"RTN","DVBABFRM",22,0)
 Q
"RTN","DVBABFRM",23,0)
SAVE(Y,DVBIEN,DVBLINES,DVBLINEC,DVBLINEB,DVBTPSV) ;
"RTN","DVBABFRM",24,0)
 ; DVBTPSV:  3/NULL=NORMAL GLOBAL
"RTN","DVBABFRM",25,0)
 N DVBNUM,DVBCOUNT
"RTN","DVBABFRM",26,0)
 S DVBTPSV=$G(DVBTPSV,3),DVBNUM=DVBLINEB,DVBCOUNT=1
"RTN","DVBABFRM",27,0)
 I DVBLINEB=0 D
"RTN","DVBABFRM",28,0)
 .K ^DVB(396.17,DVBIEN,DVBTPSV)
"RTN","DVBABFRM",29,0)
 .S ^DVB(396.17,DVBIEN,DVBTPSV,0)=DVBLINES(1),DVBCOUNT=2
"RTN","DVBABFRM",30,0)
 I DVBNUM>0 S DVBNUM=DVBNUM-1
"RTN","DVBABFRM",31,0)
 F  S DVBNUM=DVBNUM+1 Q:DVBNUM=(DVBLINEC+DVBLINEB)  D
"RTN","DVBABFRM",32,0)
 .S ^DVB(396.17,DVBIEN,DVBTPSV,DVBNUM,0)=DVBLINES(DVBCOUNT),DVBCOUNT=DVBCOUNT+1
"RTN","DVBABFRM",33,0)
 ; SET Y TO NUMBER OF LINES IN THE GLOBAL FOR GUI VERIFICATION
"RTN","DVBABFRM",34,0)
 S Y=+$P($G(^DVB(396.17,DVBIEN,DVBTPSV,0)),U,3)
"RTN","DVBABFRM",35,0)
 Q
"RTN","DVBABFRM",36,0)
LOAD(Y,DVBIEN,DVBTPSV) ;
"RTN","DVBABFRM",37,0)
 ; DVBTPSV:  3/NULL=NORMAL GLOBAL
"RTN","DVBABFRM",38,0)
 N DVBABCNT,DVBABIEN K ^TMP("DVBAFRML",DUZ)
"RTN","DVBABFRM",39,0)
 S DVBTPSV=$G(DVBTPSV,3),DVBABCNT=1,DVBABIEN=0,Y=$NA(^TMP("DVBAFRML",DUZ))
"RTN","DVBABFRM",40,0)
 F  S DVBABIEN=$O(^DVB(396.17,DVBIEN,DVBTPSV,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBABFRM",41,0)
 .S ^TMP("DVBAFRML",DUZ,DVBABCNT-1)=$G(^DVB(396.17,DVBIEN,DVBTPSV,DVBABCNT,0))_$C(13),DVBABCNT=DVBABCNT+1
"RTN","DVBABFRM",42,0)
 Q
"RTN","DVBABFRM",43,0)
CCOW(Y,F) ;RPC DVBAB CCOW
"RTN","DVBABFRM",44,0)
 S Y=-1
"RTN","DVBABFRM",45,0)
 S:F=1 Y=$$SITE^VASITE
"RTN","DVBABFRM",46,0)
 S:F=2 Y=$$PROD^XUPROD
"RTN","DVBABFRM",47,0)
 Q
"RTN","DVBABFRM",48,0)
U1N4(Y,ARR) ;RPC DVBAB FETCH 1U4N
"RTN","DVBABFRM",49,0)
 N I,X S I="",Y=$NA(^TMP("DVBU1N4",$J)) K @Y
"RTN","DVBABFRM",50,0)
 F  S I=$O(ARR(I)) Q:I=""  D
"RTN","DVBABFRM",51,0)
 .S X=$P($G(^DVB(396.17,ARR(I),0)),U)
"RTN","DVBABFRM",52,0)
 .S:X X=$$GET1^DIQ(2,X_",",.0905)
"RTN","DVBABFRM",53,0)
 .S ^TMP("DVBU1N4",$J,I)=ARR(I)_U_$S(X]"":X,1:"?????")
"RTN","DVBABFRM",54,0)
 Q
"RTN","DVBABFRM",55,0)
DELETE(Y,IEN) ;RPC DVBAB FORM DATA BACKUP DELETE
"RTN","DVBABFRM",56,0)
 S IEN=$G(IEN),Y=$S(IEN?1.N:0,1:"1^INVALID ARGUMENT")
"RTN","DVBABFRM",57,0)
 I 'Y,'$D(^DVB(396.17,IEN,0)) S Y="1^RECORD NOT FOUND"
"RTN","DVBABFRM",58,0)
 K:'Y&$D(^DVB(396.17,IEN,9)) ^DVB(396.17,IEN,9)
"RTN","DVBABFRM",59,0)
 Q
"RTN","DVBABFRM",60,0)
BACKUP(Y,IEN,TXT) ;RPC DVBAB FORM DATA BACKUP
"RTN","DVBABFRM",61,0)
 N F,S,A,N,M,R S F=396.17,M="-1^RECORD NOT FOUND",IEN=$G(IEN)_","
"RTN","DVBABFRM",62,0)
 S R="^DVB("_F_","_IEN,Y=$S(IEN?1.N1",":0,1:"-1^INVALID ARGUMENT")
"RTN","DVBABFRM",63,0)
 I 'Y,'$D(@(R_"0)")) S Y=M
"RTN","DVBABFRM",64,0)
 Q:Y  S M=$P($G(@(R_"3,0)")),U,3) Q:'M
"RTN","DVBABFRM",65,0)
 S S=396.19,N="+1,"_IEN,TXT=$G(TXT)
"RTN","DVBABFRM",66,0)
 S A(S,N,.01)=$$NOW^XLFDT
"RTN","DVBABFRM",67,0)
 S A(S,N,2)=$S(TXT]"":TXT,1:"Automatic Save by "_$P($G(^VA(200,DUZ,0)),U))
"RTN","DVBABFRM",68,0)
 D UPDATE^DIE(,"A"),ERR(.Y)
"RTN","DVBABFRM",69,0)
 I 'Y D
"RTN","DVBABFRM",70,0)
 .S N=$P($G(@(R_"9,0)")),U,3)_","_IEN
"RTN","DVBABFRM",71,0)
 .D WP^DIE(S,N,1,"A",R_"3)"),ERR(.Y)
"RTN","DVBABFRM",72,0)
 .D:'Y WP^DIE(S,N,3,"A",R_"1)"),ERR(.Y)
"RTN","DVBABFRM",73,0)
 S:'Y Y=M
"RTN","DVBABFRM",74,0)
 Q
"RTN","DVBABFRM",75,0)
RESTORE(Y,IEN,SN) ;RPC DVBAB FORM DATA BACKUP RESTORE
"RTN","DVBABFRM",76,0)
 N Z,F,T,M,N,R S IEN=$G(IEN)_",",SN=$G(SN),N=396.17,R="^DVB("_N_","_IEN
"RTN","DVBABFRM",77,0)
 S Y=$S(IEN?1.N1","&(SN?1.N):0,1:"-1^INVALID ARGUMENT")
"RTN","DVBABFRM",78,0)
 S M="-1^RECORD NOT FOUND",SN=R_"9,"_SN_",",F="RESTORE "
"RTN","DVBABFRM",79,0)
 I 'Y,'$D(@(R_"0)")) S Y=M
"RTN","DVBABFRM",80,0)
 I 'Y,'$D(@(R_"9,0)")) S $P(M,U,2)="SUB-"_$P(M,U,2),Y=M
"RTN","DVBABFRM",81,0)
 I 'Y,'$D(@(SN_"0)")) S $P(M,U,2)=F_$P(M,U,2),Y=M
"RTN","DVBABFRM",82,0)
 Q:Y  S M=$P($G(@(SN_"1,0)")),U,3),F=F_"FAILED: " Q:'M
"RTN","DVBABFRM",83,0)
 M Z=@(R_"3)") K @(R_"3)")
"RTN","DVBABFRM",84,0)
 D WP^DIE(N,IEN,8,"A",SN_"1)"),ERR(.Y)
"RTN","DVBABFRM",85,0)
 I Y  K @(R_"3)") M @(R_"3)")=Z S $P(Y,U,2)=F_$P(Y,U,2) Q
"RTN","DVBABFRM",86,0)
 M T=@(R_"1)") K @(R_"1)")
"RTN","DVBABFRM",87,0)
 D WP^DIE(N,IEN,6,"A",SN_"3)"),ERR(.Y) I 'Y S Y=M Q
"RTN","DVBABFRM",88,0)
 K @(R_"3)"),@(R_"1)") M @(R_"3)")=Z,@(R_"1)")=T S $P(Y,U,2)=F_$P(Y,U,2)
"RTN","DVBABFRM",89,0)
 Q
"RTN","DVBABFRM",90,0)
COPY(Y,DA,DFN) ;RPC DVBAB FORM COPY
"RTN","DVBABFRM",91,0)
 N F,A,P,N,M,R S DA=$G(DA)_",",F=396.17,R="^DVB("_F_","_DA
"RTN","DVBABFRM",92,0)
 S N=" NOT FOUND",M="-1^RECORD"_N,DFN=$G(DFN,$P($G(@(R_"0)")),U))
"RTN","DVBABFRM",93,0)
 S Y=$S(DA?1.N1",":0,1:"-1^INVALID ARGUMENT")
"RTN","DVBABFRM",94,0)
 I 'Y,'$D(@(R_"0)")) S Y=M
"RTN","DVBABFRM",95,0)
 I 'Y,'$D(^DPT(DFN,0)) S Y="-1^PATIENT"_N
"RTN","DVBABFRM",96,0)
 S:'Y Y=$$AF(R) Q:Y
"RTN","DVBABFRM",97,0)
 S P="+1,",A(F,P,.01)=DFN,A(F,P,2)=DUZ,A(F,P,11)="D"
"RTN","DVBABFRM",98,0)
 S N=$$NOW^XLFDT,A(F,P,3)=N,A(F,P,4)=N
"RTN","DVBABFRM",99,0)
 S A(F,P,9)=$P($G(@(R_"4)")),U),A(F,P,5)=2800101
"RTN","DVBABFRM",100,0)
 D UPDATE^DIE(,"A"),ERR(.Y)
"RTN","DVBABFRM",101,0)
 S DA=$P(@($P(R,",")_",0)"),U,3)
"RTN","DVBABFRM",102,0)
 D:'Y WP^DIE(F,DA_",",6,"A",R_"1)"),ERR(.Y),DEL(Y,DA,F)
"RTN","DVBABFRM",103,0)
 D:'Y WP^DIE(F,DA_",",8,"A",R_"3)"),ERR(.Y),DEL(Y,DA,F)
"RTN","DVBABFRM",104,0)
 S:'Y Y=DA
"RTN","DVBABFRM",105,0)
 Q
"RTN","DVBABFRM",106,0)
DEL(Y,DA,F,DIK) Q:'Y  S DIK=$G(DIK,^DIC(F,0,"GL")) D ^DIK Q
"RTN","DVBABFRM",107,0)
AF(R) N C,I,J,K,L,N,X,Z S (I,C)=0,R=R_"1,",L=""
"RTN","DVBABFRM",108,0)
 F  S I=$O(@(R_I_")")) Q:'I  D
"RTN","DVBABFRM",109,0)
 .S K=$G(@(R_I_",0)")),N=$P(K,U,2),(Z,J)=0,K=+K
"RTN","DVBABFRM",110,0)
 .S:K J=$G(^DVB(396.18,K,2)),X=$P(J,U,2),Z=DT<+J!(X'>DT&X)
"RTN","DVBABFRM",111,0)
 .I Z!'K!'J S C=C+1  S:C>1 L=L_"; " S L=L_$S(N]"":N,1:$G(^DVB(396.18,K,0)))
"RTN","DVBABFRM",112,0)
 Q:'C 0
"RTN","DVBABFRM",113,0)
 Q "-1^Can't copy because th"_$S(C=1:"is form is",1:"ese forms are")_"n't active: "_L
"RTN","DVBABFRM",114,0)
ERR(M) N D,I,K,X  S M=0,D="DIERR" Q:'$D(^TMP(D,$J))
"RTN","DVBABFRM",115,0)
 S M=$O(^TMP(D,$J,"E","")),I=$O(^(M,"")),X=","
"RTN","DVBABFRM",116,0)
 F K=0:1 S K=$O(^TMP(D,$J,I,"TEXT",K)) Q:'K  S X=X_" "_^(K)
"RTN","DVBABFRM",117,0)
 S M="-1^Error "_M_X K ^TMP(D,$J)
"RTN","DVBABFRM",118,0)
 Q
"UP",396.17,396.19,-1)
396.17^9
"UP",396.17,396.19,0)
396.19
"UP",396.17,396.191,-2)
396.17^9
"UP",396.17,396.191,-1)
396.19^1
"UP",396.17,396.191,0)
396.191
"UP",396.17,396.193,-2)
396.17^9
"UP",396.17,396.193,-1)
396.19^3
"UP",396.17,396.193,0)
396.193
"VER")
8.0^22.0
"^DD",396.17,396.17,8.5,0)
FORM SAVE BUFFER^396.19D^^9;0
"^DD",396.17,396.17,8.5,21,0)
^.001^5^5^3050314^^^^
"^DD",396.17,396.17,8.5,21,1,0)
Snapshots of the user's template data each time they exit the template in 
"^DD",396.17,396.17,8.5,21,2,0)
the GUI will be stored here.  They'll be used in case of template 
"^DD",396.17,396.17,8.5,21,3,0)
corruption or if the user wishes to revert to an earlier version of their 
"^DD",396.17,396.17,8.5,21,4,0)
work.  Once a form is signed and successfully in TIU, then the data in 
"^DD",396.17,396.17,8.5,21,5,0)
this field will be removed.
"^DD",396.17,396.17,17,0)
IN USE^F^^8;2^K:$L(X)>200!($L(X)<3) X
"^DD",396.17,396.17,17,3)
Answer must be 3-200 characters in length.
"^DD",396.17,396.17,17,21,0)
^^11^11^3050128^
"^DD",396.17,396.17,17,21,1,0)
Once a form has been opened in the GUI, this field will be populated with 
"^DD",396.17,396.17,17,21,2,0)
identifying information - user DUZ^date/time file was opened.  It 
"^DD",396.17,396.17,17,21,3,0)
will be left in edit mode in the GUI fileman components until the user 
"^DD",396.17,396.17,17,21,4,0)
exits.  The data will then be cleared and the field exited on the GUI 
"^DD",396.17,396.17,17,21,5,0)
side. If the application is terminated prematurely, the lock is
"^DD",396.17,396.17,17,21,6,0)
automatically dropped.
"^DD",396.17,396.17,17,21,7,0)
 
"^DD",396.17,396.17,17,21,8,0)
By leaving the field in edit mode throughout the session, until the user 
"^DD",396.17,396.17,17,21,9,0)
closes their template, other CAPRI instances will be able to tell that 
"^DD",396.17,396.17,17,21,10,0)
someone is using the record and prevent other users from changing the 
"^DD",396.17,396.17,17,21,11,0)
data until the first user exits.
"^DD",396.17,396.17,17,"DT")
3050128
"^DD",396.17,396.19,0)
FORM SAVE BUFFER SUB-FIELD^^3^4
"^DD",396.17,396.19,0,"DT")
3050314
"^DD",396.17,396.19,0,"IX","B",396.19,.01)

"^DD",396.17,396.19,0,"NM","FORM SAVE BUFFER")

"^DD",396.17,396.19,0,"UP")
396.17
"^DD",396.17,396.19,.01,0)
DATE/TIME^MRD^^0;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",396.17,396.19,.01,1,0)
^.1
"^DD",396.17,396.19,.01,1,1,0)
396.19^B
"^DD",396.17,396.19,.01,1,1,1)
S ^DVB(396.17,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",396.17,396.19,.01,1,1,2)
K ^DVB(396.17,DA(1),9,"B",$E(X,1,30),DA)
"^DD",396.17,396.19,.01,3)

"^DD",396.17,396.19,.01,"DT")
3050308
"^DD",396.17,396.19,1,0)
SAVE DATA^396.191^^1;0
"^DD",396.17,396.19,2,0)
COMMENTS^F^^2;1^K:$L(X)>80!($L(X)<1) X
"^DD",396.17,396.19,2,3)
Answer must be 1-80 characters in length.
"^DD",396.17,396.19,2,"DT")
3050310
"^DD",396.17,396.19,3,0)
TEMPLATES UTILIZED^396.193^^3;0
"^DD",396.17,396.191,0)
SAVE DATA SUB-FIELD^^.01^1
"^DD",396.17,396.191,0,"DT")
3050308
"^DD",396.17,396.191,0,"NM","SAVE DATA")

"^DD",396.17,396.191,0,"UP")
396.19
"^DD",396.17,396.191,.01,0)
SAVE DATA^W^^0;1^Q
"^DD",396.17,396.191,.01,"DT")
3050308
"^DD",396.17,396.193,0)
TEMPLATES UTILIZED SUB-FIELD^^.01^1
"^DD",396.17,396.193,0,"DT")
3050314
"^DD",396.17,396.193,0,"NM","TEMPLATES UTILIZED")

"^DD",396.17,396.193,0,"UP")
396.19
"^DD",396.17,396.193,.01,0)
TEMPLATES UTILIZED^WL^^0;1^Q
"^DD",396.17,396.193,.01,"DT")
3050314
**END**
**END**
