Released DG*5.3*584 SEQ #558
Extracted from mail message
**KIDS**:DG*5.3*584^

**INSTALL NAME**
DG*5.3*584
"BLD",4895,0)
DG*5.3*584^REGISTRATION^0^3050124^y
"BLD",4895,4,0)
^9.64PA^^
"BLD",4895,"KRN",0)
^9.67PA^8989.52^19
"BLD",4895,"KRN",.4,0)
.4
"BLD",4895,"KRN",.401,0)
.401
"BLD",4895,"KRN",.402,0)
.402
"BLD",4895,"KRN",.403,0)
.403
"BLD",4895,"KRN",.5,0)
.5
"BLD",4895,"KRN",.84,0)
.84
"BLD",4895,"KRN",3.6,0)
3.6
"BLD",4895,"KRN",3.8,0)
3.8
"BLD",4895,"KRN",9.2,0)
9.2
"BLD",4895,"KRN",9.8,0)
9.8
"BLD",4895,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4895,"KRN",9.8,"NM",1,0)
VADPT5^^0^B22917941
"BLD",4895,"KRN",9.8,"NM","B","VADPT5",1)

"BLD",4895,"KRN",19,0)
19
"BLD",4895,"KRN",19.1,0)
19.1
"BLD",4895,"KRN",101,0)
101
"BLD",4895,"KRN",409.61,0)
409.61
"BLD",4895,"KRN",771,0)
771
"BLD",4895,"KRN",870,0)
870
"BLD",4895,"KRN",8989.51,0)
8989.51
"BLD",4895,"KRN",8989.52,0)
8989.52
"BLD",4895,"KRN",8994,0)
8994
"BLD",4895,"KRN","B",.4,.4)

"BLD",4895,"KRN","B",.401,.401)

"BLD",4895,"KRN","B",.402,.402)

"BLD",4895,"KRN","B",.403,.403)

"BLD",4895,"KRN","B",.5,.5)

"BLD",4895,"KRN","B",.84,.84)

"BLD",4895,"KRN","B",3.6,3.6)

"BLD",4895,"KRN","B",3.8,3.8)

"BLD",4895,"KRN","B",9.2,9.2)

"BLD",4895,"KRN","B",9.8,9.8)

"BLD",4895,"KRN","B",19,19)

"BLD",4895,"KRN","B",19.1,19.1)

"BLD",4895,"KRN","B",101,101)

"BLD",4895,"KRN","B",409.61,409.61)

"BLD",4895,"KRN","B",771,771)

"BLD",4895,"KRN","B",870,870)

"BLD",4895,"KRN","B",8989.51,8989.51)

"BLD",4895,"KRN","B",8989.52,8989.52)

"BLD",4895,"KRN","B",8994,8994)

"BLD",4895,"QUES",0)
^9.62^^
"BLD",4895,"REQB",0)
^9.611^2^2
"BLD",4895,"REQB",1,0)
SD*5.3*301^2
"BLD",4895,"REQB",2,0)
DG*5.3*242^2
"BLD",4895,"REQB","B","DG*5.3*242",2)

"BLD",4895,"REQB","B","SD*5.3*301",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2930930
"PKG",5,22,1,"PAH",1,0)
584^3050124
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VADPT5")
0^1^B22917941
"RTN","VADPT5",1,0)
VADPT5 ;ALB/MRL/MJK - PATIENT VARIABLES [REG]; 14 DEC 1988 ; 8/6/04 7:42am
"RTN","VADPT5",2,0)
 ;;5.3;Registration;**54,63,242,584**;Aug 13, 1993
"RTN","VADPT5",3,0)
10 ;Registration/Disposition [REG]
"RTN","VADPT5",4,0)
 N VARPSV
"RTN","VADPT5",5,0)
 S VARPSV("C")=$S('$G(VARP("C")):999999999,1:+VARP("C"))
"RTN","VADPT5",6,0)
 S VARPSV("F")=9999999-$S($G(VARP("F"))?7N.E:VARP("F"),1:0)
"RTN","VADPT5",7,0)
 S VARPSV("T")=$S($G(VARP("T"))?7N.E:VARP("T"),1:7777777) I '$P(VARPSV("T"),".",2) S $P(VARPSV("T"),".",2)=999999
"RTN","VADPT5",8,0)
 S VARPSV("T")=9999999-VARPSV("T")
"RTN","VADPT5",9,0)
 S VAX=VARPSV("T"),VAX(1)=0
"RTN","VADPT5",10,0)
 I '$D(^DPT(DFN,"DIS")) Q
"RTN","VADPT5",11,0)
 F I=0:0 S VAX=$O(^DPT(DFN,"DIS",VAX)) Q:VAX=""!(VAX>VARPSV("F"))!(VAX(1)+1>VARPSV("C"))  S VAX(2)=$G(^DPT(DFN,"DIS",VAX,0)),VAX(1)=VAX(1)+1 D 101:+VAX(2)>0
"RTN","VADPT5",12,0)
 Q
"RTN","VADPT5",13,0)
101 S (VAX("I"),VAX("E"))="",VAX(3)=0 F I=1,2,3,4,5,6,7,9 S VAX(3)=VAX(3)+1,$P(VAX("I"),"^",VAX(3))=$P(VAX(2),"^",I) D 102
"RTN","VADPT5",14,0)
 S @VAV@(VAX(1),"I")=VAX("I"),@VAV@(VAX(1),"E")=VAX("E") Q
"RTN","VADPT5",15,0)
102 I "^1^6^"[("^"_VAX(3)_"^") S Y=$P(VAX("I"),"^",VAX(3)) I Y]"" X ^DD("DD") S $P(VAX("E"),"^",VAX(3))=Y Q
"RTN","VADPT5",16,0)
 S X(1)=$S($D(^DD(2.101,$S(I<9:(I-1),1:I),0)):$P(^(0),"^",3),1:"") I "^2^3^"[("^"_VAX(3)_"^"),$P(VAX("I"),"^",VAX(3))]"",X(1)]"" S $P(VAX("E"),"^",VAX(3))=$P($P(X(1),$P(VAX("I"),"^",VAX(3))_":",2),";",1) Q
"RTN","VADPT5",17,0)
 I "^4^5^7^8^"[("^"_VAX(3)_"^"),$P(VAX("I"),"^",VAX(3))]"",X(1)]"" S X(1)="^"_X(1)_$P(VAX("I"),"^",VAX(3))_",0)" I $D(@(X(1))) S $P(VAX("E"),"^",VAX(3))=$P(^(0),"^",1)
"RTN","VADPT5",18,0)
 Q
"RTN","VADPT5",19,0)
 ;
"RTN","VADPT5",20,0)
11 ;Clinic Enrollments [SDE]
"RTN","VADPT5",21,0)
 S (VAX,VAX(1))=0 F I=0:0 S VAX=$O(^DPT(DFN,"DE",VAX)) Q:VAX'>0  S VAZ=$S($D(^DPT(DFN,"DE",VAX,0)):^(0),1:"") I +VAZ,$P(VAZ,"^",2)'="I" S VAX(3)=0 D 111
"RTN","VADPT5",22,0)
 Q
"RTN","VADPT5",23,0)
111 S VAX(4)=0 F I1=0:0 S VAX(4)=$O(^DPT(DFN,"DE",VAX,1,VAX(4))) Q:VAX(4)'>0!(VAX(3))  S VAZ(1)=$S($D(^DPT(DFN,"DE",VAX,1,VAX(4),0)):^(0),1:"") I +VAZ(1),$P(VAZ(1),"^",3)']"" S VAX(3)=VAZ(1)
"RTN","VADPT5",24,0)
 Q:'VAX(3)  S (VAX("I"),VAX("E"))="",Y=+VAX(3),$P(VAX("I"),"^",2)=Y X ^DD("DD") S $P(VAX("E"),"^",2)=Y
"RTN","VADPT5",25,0)
 S $P(VAX("I"),"^",3)=$P(VAX(3),"^",2) I $P(VAX("I"),"^",3)]"" S $P(VAX("E"),"^",3)=$S($P(VAX("I"),"^",3)="O":"OPT",$P(VAX("I"),"^",3)="A":"AC",1:"")
"RTN","VADPT5",26,0)
 S $P(VAX("I"),"^",1)=+VAZ,$P(VAX("E"),"^",1)=$S($D(^SC(+VAZ,0)):$P(^(0),"^",1),1:""),VAX(1)=VAX(1)+1,@VAV@(VAX(1),"I")=VAX("I"),@VAV@(VAX(1),"E")=VAX("E") Q
"RTN","VADPT5",27,0)
 ;
"RTN","VADPT5",28,0)
12 ;Appointments [SDA]
"RTN","VADPT5",29,0)
 N VASDSV,SDCNT,SDARRAY
"RTN","VADPT5",30,0)
 D NOW^%DTC
"RTN","VADPT5",31,0)
 S VASDSV("F")=$S($G(VASD("F"))?7N.E:VASD("F"),1:%)
"RTN","VADPT5",32,0)
 S VASDSV("T")=$S(+$G(VASD("T")):+VASD("T"),1:9999999) I '$P(VASDSV("T"),".",2) S $P(VASDSV("T"),".",2)=999999
"RTN","VADPT5",33,0)
 S VASDSV("W")=$S('$G(VASD("W")):12,1:VASD("W"))
"RTN","VADPT5",34,0)
 S VAZ(2)=$S($D(VASD("N")):VASD("N"),1:9999)
"RTN","VADPT5",35,0)
 ;Set STATUS Codes (VistA;RSA)
"RTN","VADPT5",36,0)
 S VAZ=";R^I;I^N;NS^NA;NSR^C;CC^CA;CCR^PC;CP^PCA;CPR^NT;NT^",VAZ(1)=""
"RTN","VADPT5",37,0)
 ;Extract User Required STATUS Codes in RSA format
"RTN","VADPT5",38,0)
 F I=1:1 S I1=+$E(VASDSV("W"),I) Q:'I1  D
"RTN","VADPT5",39,0)
 .S VAZ(1)=VAZ(1)_$P($P(VAZ,"^",I1),";",2)_";"
"RTN","VADPT5",40,0)
 ;Create parameter list for the extrinsic call to the Appointment API
"RTN","VADPT5",41,0)
 ;Note: Appointment API can only accept a maximum of 3 fields 
"RTN","VADPT5",42,0)
 ;               to filter on.
"RTN","VADPT5",43,0)
 ; 1 : "FROM;TO" Appointment Date Range to Search
"RTN","VADPT5",44,0)
 ; 2 : Clinic IEN or Array of Clinic IENs if defined (Pass the Root)
"RTN","VADPT5",45,0)
 ; 3 : Requested STATUS Codes (Passed if VASD("C") is not defined.)
"RTN","VADPT5",46,0)
 ; 4 : Patient IEN
"RTN","VADPT5",47,0)
 S SDARRAY="",SDARRAY(1)=VASDSV("F")_";"_VASDSV("T")
"RTN","VADPT5",48,0)
 I $O(VASD("C",0))>0 S SDARRAY(2)="VASD(""C"","
"RTN","VADPT5",49,0)
 E  S SDARRAY(3)=VAZ(1)
"RTN","VADPT5",50,0)
 S SDARRAY(4)=DFN
"RTN","VADPT5",51,0)
 ;Set Fields for API to Return
"RTN","VADPT5",52,0)
 ;  1 : Appointment Date/Time
"RTN","VADPT5",53,0)
 ;  2 : Clinic
"RTN","VADPT5",54,0)
 ;  3 : Appointment Status
"RTN","VADPT5",55,0)
 ; 10 : Appointment Type
"RTN","VADPT5",56,0)
 S SDARRAY("FLDS")="1;2;3;10"
"RTN","VADPT5",57,0)
 ;Remove Clinic IEN from Global Reference
"RTN","VADPT5",58,0)
 S SDARRAY("SORT")="P"
"RTN","VADPT5",59,0)
 ;Call Appointment API (Pass Array by reference)
"RTN","VADPT5",60,0)
 S SDCNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","VADPT5",61,0)
 S VAX="",VAX(1)=0
"RTN","VADPT5",62,0)
 ;If error returned, determine error and set VAERR appropriately
"RTN","VADPT5",63,0)
 ; 1 : For any error other than 101
"RTN","VADPT5",64,0)
 ; 2 : If error is 101 : Database is unavailable  
"RTN","VADPT5",65,0)
 I SDCNT<0 S VAX=$O(^TMP($J,"SDAMA301",VAX)) S VAERR=$S(VAX=101:2,1:1) K ^TMP($J,"SDAMA301") Q
"RTN","VADPT5",66,0)
 D 122:SDCNT>0
"RTN","VADPT5",67,0)
 Q
"RTN","VADPT5",68,0)
121 S VAX(5)=1 I VASDSV("W")'[1,$P(VAZ,"^",2)']"" S VAX(5)=0 Q
"RTN","VADPT5",69,0)
 I VASDSV("C"),'$D(VASD("C",+VAZ)) S VAX(5)=0 Q
"RTN","VADPT5",70,0)
 S (VAX("I"),VAX("E"))="",VAX(2)=1,$P(VAX("I"),"^",1)=+VAX F I1=1,2,16 S VAX(2)=VAX(2)+1,$P(VAX("I"),"^",VAX(2))=$P(VAZ,"^",I1)
"RTN","VADPT5",71,0)
 Q
"RTN","VADPT5",72,0)
122 ;Build Internal/External Output Globals
"RTN","VADPT5",73,0)
 ;
"RTN","VADPT5",74,0)
 N SDCIEN,SDDTM,SDNODE
"RTN","VADPT5",75,0)
 S (SDCIEN,SDDTM)=""
"RTN","VADPT5",76,0)
 ;Redefine VAZ (STATUS Codes(RSA;VistA))
"RTN","VADPT5",77,0)
 S VAZ="R;^I;I^NS;N^NSR;NA^CC;C^CCR;CA^CP;PC^CPR;PCA^NT;NT^"
"RTN","VADPT5",78,0)
 S SDDTM=""
"RTN","VADPT5",79,0)
 ;Loop through appointments and convert for output
"RTN","VADPT5",80,0)
 F  S SDDTM=$O(^TMP($J,"SDAMA301",DFN,SDDTM)) Q:'SDDTM  D 
"RTN","VADPT5",81,0)
 .;Get Appointment Information and clear VAX("I") & VAX("E")
"RTN","VADPT5",82,0)
 .S SDNODE=^(SDDTM),(VAX("I"),VAX("E"))=""
"RTN","VADPT5",83,0)
 .;If Clinics were passed to appointment API,
"RTN","VADPT5",84,0)
 .;     Filter on Appointment Status Codes
"RTN","VADPT5",85,0)
 .I $O(VASD("C",0))>0,(VAZ(1)'[($P($P(SDNODE,"^",3),";")_";")) Q
"RTN","VADPT5",86,0)
 .;Extract and format Appointment Date/Time
"RTN","VADPT5",87,0)
 .S Y=$P(SDNODE,"^",1)
"RTN","VADPT5",88,0)
 .S $P(VAX("I"),"^",1)=Y
"RTN","VADPT5",89,0)
 .X ^DD("DD") S $P(VAX("E"),"^",1)=Y
"RTN","VADPT5",90,0)
 .;Extract and format Clinic Information
"RTN","VADPT5",91,0)
 .S $P(VAX("I"),"^",2)=$P($P(SDNODE,"^",2),";",1)
"RTN","VADPT5",92,0)
 .S $P(VAX("E"),"^",2)=$P($P(SDNODE,"^",2),";",2)
"RTN","VADPT5",93,0)
 .;Extract and format Appointment Type
"RTN","VADPT5",94,0)
 .S $P(VAX("I"),"^",4)=$P($P(SDNODE,"^",10),";",1)
"RTN","VADPT5",95,0)
 .S $P(VAX("E"),"^",4)=$P($P(SDNODE,"^",10),";",2)
"RTN","VADPT5",96,0)
 .;Extract and format Appointment Status
"RTN","VADPT5",97,0)
 .S Y=$P($P(VAZ,$P($P(SDNODE,"^",3),";")_";",2),"^"),$P(VAX("I"),"^",3)=Y
"RTN","VADPT5",98,0)
 .I Y]"" S X=$S($D(^DD(2.98,3,0)):$P(^(0),"^",3),1:""),$P(VAX("E"),"^",3)=$P($P(X,Y_":",2),";",1)
"RTN","VADPT5",99,0)
 .S VAX(1)=VAX(1)+1
"RTN","VADPT5",100,0)
 .;Store information in global
"RTN","VADPT5",101,0)
 .S @VAV@(VAX(1),"I")=VAX("I"),@VAV@(VAX(1),"E")=VAX("E")
"RTN","VADPT5",102,0)
 K ^TMP($J,"SDAMA301")
"RTN","VADPT5",103,0)
 Q
"VER")
8.0^22.0
**END**
**END**
