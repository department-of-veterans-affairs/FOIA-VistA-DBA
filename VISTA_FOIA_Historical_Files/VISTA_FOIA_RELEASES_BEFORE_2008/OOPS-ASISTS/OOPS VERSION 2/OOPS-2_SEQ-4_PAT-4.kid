Released OOPS*2*4 SEQ #4
Extracted from mail message
**KIDS**:OOPS*2.0*4^

**INSTALL NAME**
OOPS*2.0*4
"BLD",5397,0)
OOPS*2.0*4^ASISTS^0^3040518^y
"BLD",5397,1,0)
^^1^1^3040224^^^
"BLD",5397,1,1,0)
ASISTS Enhancements and NOIS fixes
"BLD",5397,4,0)
^9.64PA^2261.2^1
"BLD",5397,4,2261.2,0)
2261.2
"BLD",5397,4,2261.2,222)
n^n^f^^n^^y^o^n
"BLD",5397,4,"B",2261.2,2261.2)

"BLD",5397,"INI")

"BLD",5397,"INID")
^n^
"BLD",5397,"INIT")

"BLD",5397,"KRN",0)
^9.67PA^8989.52^19
"BLD",5397,"KRN",.4,0)
.4
"BLD",5397,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5397,"KRN",.401,0)
.401
"BLD",5397,"KRN",.402,0)
.402
"BLD",5397,"KRN",.403,0)
.403
"BLD",5397,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5397,"KRN",.5,0)
.5
"BLD",5397,"KRN",.84,0)
.84
"BLD",5397,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5397,"KRN",3.6,0)
3.6
"BLD",5397,"KRN",3.6,"NM",0)
^9.68A^3^3
"BLD",5397,"KRN",3.6,"NM",1,0)
OOPS WORKERS COMP^^0
"BLD",5397,"KRN",3.6,"NM",2,0)
OOPS CASE CLOSE NOTIFICATION^^0
"BLD",5397,"KRN",3.6,"NM",3,0)
OOPS CASE^^0
"BLD",5397,"KRN",3.6,"NM","B","OOPS CASE",3)

"BLD",5397,"KRN",3.6,"NM","B","OOPS CASE CLOSE NOTIFICATION",2)

"BLD",5397,"KRN",3.6,"NM","B","OOPS WORKERS COMP",1)

"BLD",5397,"KRN",3.8,0)
3.8
"BLD",5397,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",5397,"KRN",9.2,0)
9.2
"BLD",5397,"KRN",9.8,0)
9.8
"BLD",5397,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",5397,"KRN",9.8,"NM",1,0)
OOPSGUI1^^0^B29922240
"BLD",5397,"KRN",9.8,"NM",2,0)
OOPSGUIT^^0^B77268945
"BLD",5397,"KRN",9.8,"NM",3,0)
OOPSGUI0^^0^B41444101
"BLD",5397,"KRN",9.8,"NM",4,0)
OOPSGUI2^^0^B49363608
"BLD",5397,"KRN",9.8,"NM",5,0)
OOPSGUI4^^0^B50207365
"BLD",5397,"KRN",9.8,"NM",6,0)
OOPSGUI6^^0^B53681368
"BLD",5397,"KRN",9.8,"NM",7,0)
OOPSGUI7^^0^B26074659
"BLD",5397,"KRN",9.8,"NM",8,0)
OOPSDOL1^^0^B65606378
"BLD",5397,"KRN",9.8,"NM",9,0)
OOPSMBUL^^0^B21801077
"BLD",5397,"KRN",9.8,"NM","B","OOPSDOL1",8)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI0",3)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI1",1)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI2",4)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI4",5)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI6",6)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUI7",7)

"BLD",5397,"KRN",9.8,"NM","B","OOPSGUIT",2)

"BLD",5397,"KRN",9.8,"NM","B","OOPSMBUL",9)

"BLD",5397,"KRN",19,0)
19
"BLD",5397,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5397,"KRN",19.1,0)
19.1
"BLD",5397,"KRN",101,0)
101
"BLD",5397,"KRN",409.61,0)
409.61
"BLD",5397,"KRN",771,0)
771
"BLD",5397,"KRN",870,0)
870
"BLD",5397,"KRN",8989.51,0)
8989.51
"BLD",5397,"KRN",8989.52,0)
8989.52
"BLD",5397,"KRN",8994,0)
8994
"BLD",5397,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",5397,"KRN","B",.4,.4)

"BLD",5397,"KRN","B",.401,.401)

"BLD",5397,"KRN","B",.402,.402)

"BLD",5397,"KRN","B",.403,.403)

"BLD",5397,"KRN","B",.5,.5)

"BLD",5397,"KRN","B",.84,.84)

"BLD",5397,"KRN","B",3.6,3.6)

"BLD",5397,"KRN","B",3.8,3.8)

"BLD",5397,"KRN","B",9.2,9.2)

"BLD",5397,"KRN","B",9.8,9.8)

"BLD",5397,"KRN","B",19,19)

"BLD",5397,"KRN","B",19.1,19.1)

"BLD",5397,"KRN","B",101,101)

"BLD",5397,"KRN","B",409.61,409.61)

"BLD",5397,"KRN","B",771,771)

"BLD",5397,"KRN","B",870,870)

"BLD",5397,"KRN","B",8989.51,8989.51)

"BLD",5397,"KRN","B",8989.52,8989.52)

"BLD",5397,"KRN","B",8994,8994)

"BLD",5397,"PRE")

"BLD",5397,"PRET")

"BLD",5397,"QUES",0)
^9.62^^
"BLD",5397,"REQB",0)
^9.611^1^1
"BLD",5397,"REQB",1,0)
OOPS*2.0*2^1
"BLD",5397,"REQB","B","OOPS*2.0*2",1)

"DATA",2261.2,1,0)
Assault^1
"DATA",2261.2,2,0)
Cumulative Trauma^2
"DATA",2261.2,3,0)
Material Handling^3
"DATA",2261.2,4,0)
Lifting/Repositioning Patients^4
"DATA",2261.2,5,0)
Slip/Trip/Fall^5
"DATA",2261.2,6,0)
Struck by/against^6
"DATA",2261.2,7,0)
Other^7
"DATA",2261.2,8,0)
TB/PPD Conversion^8
"DATA",2261.2,9,0)
Latex Reaction/Allergy^9
"DATA",2261.2,10,0)
Environmental/Toxic Exposure^10
"DATA",2261.2,11,0)
Hollow Bore Needlestick^11
"DATA",2261.2,12,0)
Sharps Exposure^12
"DATA",2261.2,13,0)
Exposure to Body Fluids/Splash^13
"DATA",2261.2,14,0)
Suture Needlestick^14
"DATA",2261.2,15,0)
Non Patient Care^15
"DATA",2261.2,16,0)
Not Elsewhere Classified^16
"FIA",2261.2)
ASISTS CRITICAL TRACKING ISSUES
"FIA",2261.2,0)
^OOPS(2261.2,
"FIA",2261.2,0,0)
2261.2
"FIA",2261.2,0,1)
n^n^f^^n^^y^o^n
"FIA",2261.2,0,10)

"FIA",2261.2,0,11)

"FIA",2261.2,0,"RLRO")

"FIA",2261.2,0,"VR")
2.0^OOPS
"FIA",2261.2,2261.2)
0
"KRN",3.6,183,-1)
0^3
"KRN",3.6,183,0)
OOPS CASE^ASISTS Case Notification
"KRN",3.6,183,1,0)
^3.61A^19^19^3040220^^^^
"KRN",3.6,183,1,1,0)
              ****INFORMATION ONLY***
"KRN",3.6,183,1,2,0)
An incident (injury, illness or accident) has occurred.
"KRN",3.6,183,1,3,0)
 
"KRN",3.6,183,1,4,0)
Date of incident:        |2|
"KRN",3.6,183,1,5,0)
Case #:                  |3|
"KRN",3.6,183,1,6,0)
Injury/Illness:          |6|
"KRN",3.6,183,1,7,0)
  
"KRN",3.6,183,1,8,0)
The 1st line supervisor is required to:
"KRN",3.6,183,1,9,0)
 
"KRN",3.6,183,1,10,0)
a. Complete a Report of Accident through the option:
"KRN",3.6,183,1,11,0)
     Complete/Validate/Sign Accident Report 2162.
"KRN",3.6,183,1,12,0)
 
"KRN",3.6,183,1,13,0)
b. Inform the injured employee on rights and benefits for completing
"KRN",3.6,183,1,14,0)
   the CA-1 (Injury) or CA-2 (Illness) Compensation Claims.
"KRN",3.6,183,1,15,0)

"KRN",3.6,183,1,16,0)
The supervisors on this case are:
"KRN",3.6,183,1,17,0)
 
"KRN",3.6,183,1,18,0)
Supervisor:           |4|
"KRN",3.6,183,1,19,0)
Secondary Supervisor: |5| 
"KRN",3.6,183,3,0)
^3.63^2^2^3040220^^^^
"KRN",3.6,183,3,1,0)
This bulletin will notify interested parties of the creation
"KRN",3.6,183,3,2,0)
of a Case.
"KRN",3.6,183,4,0)
^3.64A^6^5
"KRN",3.6,183,4,2,0)
2
"KRN",3.6,183,4,2,1,0)
^3.65^1^1^3030602^^^^
"KRN",3.6,183,4,2,1,1,0)
Date of Injury
"KRN",3.6,183,4,3,0)
3
"KRN",3.6,183,4,3,1,0)
^3.65^1^1^3000420^^^^
"KRN",3.6,183,4,3,1,1,0)
Case#
"KRN",3.6,183,4,4,0)
4
"KRN",3.6,183,4,4,1,0)
^^1^1^3000420^
"KRN",3.6,183,4,4,1,1,0)
Supervisor for employee
"KRN",3.6,183,4,5,0)
5
"KRN",3.6,183,4,5,1,0)
^3.65^1^1^3030602^^^
"KRN",3.6,183,4,5,1,1,0)
Secondary Supervisor
"KRN",3.6,183,4,6,0)
6
"KRN",3.6,183,4,6,1,0)
^3.65^2^2^3040220^^^^
"KRN",3.6,183,4,6,1,1,0)
This parameter indicates whether the claim was a CA1 or CA2 so the Supervisor 
"KRN",3.6,183,4,6,1,2,0)
knows when they recieve the case notification.
"KRN",3.6,220,-1)
0^1
"KRN",3.6,220,0)
OOPS WORKERS COMP^Worker's Comp Notification
"KRN",3.6,220,1,0)
^3.61A^9^9^3040517^^^^
"KRN",3.6,220,1,1,0)
The Supervisor signed the CA1/CA2 for the following incident on |4|:
"KRN",3.6,220,1,2,0)

"KRN",3.6,220,1,3,0)
Date of Incident: |3|
"KRN",3.6,220,1,4,0)
          Case #: |2|
"KRN",3.6,220,1,5,0)

"KRN",3.6,220,1,6,0)
Note to Supervisor:  The CA1/CA2 must be electronically signed by the
"KRN",3.6,220,1,7,0)
                     employee and supervisor. Then a copy of the CA1/CA2 must 
"KRN",3.6,220,1,8,0)
                     be printed out, hand-signed and dated in blue ink, and 
"KRN",3.6,220,1,9,0)
                     sent to the Worker's Compensation Manager's Office.
"KRN",3.6,220,3,0)
^3.63^2^2^3040517^^^^
"KRN",3.6,220,3,1,0)
This bulletin will be sent to the Workers Comp personnel when the Supervisor
"KRN",3.6,220,3,2,0)
has signed the CA1/CA2 claim.
"KRN",3.6,220,4,0)
^3.64A^4^3
"KRN",3.6,220,4,2,0)
2
"KRN",3.6,220,4,2,1,0)
^^1^1^3000406^
"KRN",3.6,220,4,2,1,1,0)
Case number
"KRN",3.6,220,4,3,0)
3
"KRN",3.6,220,4,3,1,0)
^^1^1^3000406^
"KRN",3.6,220,4,3,1,1,0)
Date of Incident
"KRN",3.6,220,4,4,0)
4
"KRN",3.6,220,4,4,1,0)
^3.65^1^1^3040517^^^^
"KRN",3.6,220,4,4,1,1,0)
Date signed by Supervisor
"KRN",3.6,260,-1)
0^2
"KRN",3.6,260,0)
OOPS CASE CLOSE NOTIFICATION^ASISTS CASE CLOSED NOTIFICATION
"KRN",3.6,260,1,0)
^^6^6^3040102^
"KRN",3.6,260,1,1,0)
An ASISTS Case has been closed:
"KRN",3.6,260,1,2,0)

"KRN",3.6,260,1,3,0)
      ASISTS Case Number:  |1|
"KRN",3.6,260,1,4,0)
          Case Closed By:  |2|
"KRN",3.6,260,1,5,0)
        Date Case Closed:  |3|
"KRN",3.6,260,1,6,0)

"KRN",3.6,260,3,0)
^3.63^7^7^3040102^^
"KRN",3.6,260,3,1,0)
This bulletin will be sent to the OOPS SAFETY and OOPS WCP mail groups
"KRN",3.6,260,3,2,0)
whenever an ASISTS case status is set to 'Closed'.  If the case is opened and
"KRN",3.6,260,3,3,0)
closed multiple times, a bulletin will be sent every time.  The Name of the 
"KRN",3.6,260,3,4,0)
person closing the case is obtained from the DUZ for the user and the Date 
"KRN",3.6,260,3,5,0)
Closed is the system date when the user actually closed the case. New data
"KRN",3.6,260,3,6,0)
fields HAVE NOT been created for this.  The person who closed the case nor the
"KRN",3.6,260,3,7,0)
Date Closed is stored.
"KRN",3.6,260,4,0)
^3.64A^3^3
"KRN",3.6,260,4,1,0)
1
"KRN",3.6,260,4,1,1,0)
^^1^1^3040102^
"KRN",3.6,260,4,1,1,1,0)
Case Number of the case being closed
"KRN",3.6,260,4,2,0)
2
"KRN",3.6,260,4,2,1,0)
^^1^1^3040102^
"KRN",3.6,260,4,2,1,1,0)
This is the name of the user (DUZ) of the user who closed the case
"KRN",3.6,260,4,3,0)
3
"KRN",3.6,260,4,3,1,0)
^3.65^2^2^3040102^^
"KRN",3.6,260,4,3,1,1,0)
This is the date that the case was closed.  It will always be the system date
"KRN",3.6,260,4,3,1,2,0)
that the case was closed.
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"PKG",472,-1)
1^1
"PKG",472,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",472,20,0)
^9.402P^^
"PKG",472,22,0)
^9.49I^1^1
"PKG",472,22,1,0)
2.0^3020709^3030401^66481
"PKG",472,22,1,"PAH",1,0)
4^3040518
"PKG",472,22,1,"PAH",1,1,0)
^^1^1^3040518
"PKG",472,22,1,"PAH",1,1,1,0)
ASISTS Enhancements and NOIS fixes
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","OOPSDOL1")
0^8^B65606378
"RTN","OOPSDOL1",1,0)
OOPSDOL1 ;WIOFO/CAH-CA1 EXTRACT FOR DOL ;3/15/00
"RTN","OOPSDOL1",2,0)
 ;;2.0;ASISTS;**4**;Jun 03, 2002
"RTN","OOPSDOL1",3,0)
EN ; Entry
"RTN","OOPSDOL1",4,0)
 N OCC,NAME,FN,KK,D62,D123,D124,D126,WITN
"RTN","OOPSDOL1",5,0)
 S OOPSAR("CA")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA")))
"RTN","OOPSDOL1",6,0)
 S OOPSAR(0)=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,0)))
"RTN","OOPSDOL1",7,0)
 S OOPSAR("CA1A")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1A")))
"RTN","OOPSDOL1",8,0)
 S OOPSAR("CA1B")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1B")))
"RTN","OOPSDOL1",9,0)
 S OOPSAR("CA1C")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1C")))
"RTN","OOPSDOL1",10,0)
 S OOPSAR("CA1D")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1D")))
"RTN","OOPSDOL1",11,0)
 S OOPSAR("CA1ES")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1ES")))
"RTN","OOPSDOL1",12,0)
 S OOPSAR("CA1F")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1F")))
"RTN","OOPSDOL1",13,0)
 S OOPSAR("CA1G")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1G")))
"RTN","OOPSDOL1",14,0)
 S OOPSAR("CA1H")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1H")))
"RTN","OOPSDOL1",15,0)
 S OOPSAR("CA1I")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1I")))
"RTN","OOPSDOL1",16,0)
 S OOPSAR("CA1J")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1J",0)))
"RTN","OOPSDOL1",17,0)
 S OOPSAR("CA1K")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1K",0)))
"RTN","OOPSDOL1",18,0)
 S OOPSAR("CA1L")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1L")))
"RTN","OOPSDOL1",19,0)
 S OOPSAR("CA1M")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1M")))
"RTN","OOPSDOL1",20,0)
 S OOPSAR("CA1N")=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1N")))
"RTN","OOPSDOL1",21,0)
 ; get witness data once
"RTN","OOPSDOL1",22,0)
 S WITN=$O(^OOPS(2260,OOPDA,"CA1W",0))
"RTN","OOPSDOL1",23,0)
 I $G(WITN)'="" D
"RTN","OOPSDOL1",24,0)
 . S OOPSAR("CA1W",0)=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1W",WITN,0)))
"RTN","OOPSDOL1",25,0)
 . S OOPSAR("CA1W",1)=$$UP^OOPSUTL4($G(^OOPS(2260,OOPDA,"CA1W",WITN,1)))
"RTN","OOPSDOL1",26,0)
OP02 ; Seg OP02
"RTN","OOPSDOL1",27,0)
 K OPX
"RTN","OOPSDOL1",28,0)
 N OFF
"RTN","OOPSDOL1",29,0)
 S OFF=$$GET1^DIQ(2260,OOPDA,"73:1")
"RTN","OOPSDOL1",30,0)
 S OPX="OP02^"_$E("00",$L(OFF)+1,2)_OFF
"RTN","OOPSDOL1",31,0)
 S OPX=OPX_U_$P(OOPSAR("CA1M"),U,1)_U_$P(OOPSAR("CA1M"),U,2)
"RTN","OOPSDOL1",32,0)
 S OPX=OPX_U_$P(OOPSAR("CA1M"),U,3)_U_$$GET1^DIQ(2260,OOPDA,"179:1")
"RTN","OOPSDOL1",33,0)
 S OPX=OPX_U_$E($P(OOPSAR("CA1M"),U,5),1,5)_U_$P(OOPSAR("CA1F"),U,1)
"RTN","OOPSDOL1",34,0)
 S OPX=OPX_U_$P(OOPSAR("CA1F"),U,2)_U_$P(OOPSAR("CA1F"),U,3)
"RTN","OOPSDOL1",35,0)
 S OPX=OPX_U_$$GET1^DIQ(2260,OOPDA,"133:1")_U_$E($P(OOPSAR("CA1F"),U,5),1,5)
"RTN","OOPSDOL1",36,0)
 S OPX=OPX_U_U_U_"^|"
"RTN","OOPSDOL1",37,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",38,0)
OP03 ; Seg OP03
"RTN","OOPSDOL1",39,0)
 K OPX
"RTN","OOPSDOL1",40,0)
 S OPX="OP03^"_$$GET1^DIQ(2260,OOPDA,60,"E")
"RTN","OOPSDOL1",41,0)
 S OPX=OPX_U_$P(OOPSAR("CA"),U,5)
"RTN","OOPSDOL1",42,0)
 S D62=$$GET1^DIQ(2260,OOPDA,"62:1"),D123=$$GET1^DIQ(2260,OOPDA,"123:1")
"RTN","OOPSDOL1",43,0)
 S D124=$$GET1^DIQ(2260,OOPDA,"124:1"),D126=$$GET1^DIQ(2260,OOPDA,"126:1")
"RTN","OOPSDOL1",44,0)
 S OPX=OPX_U_$E("000",$L(D123)+1,3)_D123
"RTN","OOPSDOL1",45,0)
 S OPX=OPX_U_$E("0000",$L(D124)+1,4)_D124
"RTN","OOPSDOL1",46,0)
 S OPX=OPX_U_$E("00",$L(D62)+1,2)_D62
"RTN","OOPSDOL1",47,0)
 S OPX=OPX_U_$E("00",$L(D126)+1,2)_D126
"RTN","OOPSDOL1",48,0)
 S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1L"),U,7))
"RTN","OOPSDOL1",49,0)
 S NAME=$$GET1^DIQ(2260,OOPDA,"169:.01"),FN=$P(NAME,",",2)
"RTN","OOPSDOL1",50,0)
 S OPX=OPX_U_$E($P(NAME,","),1,20)
"RTN","OOPSDOL1",51,0)
 F KK=1:0:1 Q:$E(FN,KK)'=" "  S FN=$E(FN,KK+1,$L(FN))
"RTN","OOPSDOL1",52,0)
 S OPX=OPX_U_$E($P(FN," "),1,10)_U_$E($P(FN," ",2),1,10)
"RTN","OOPSDOL1",53,0)
 S OPX=OPX_U_$P(OOPSAR("CA1L"),U,4)_U_$$MKNUM^OOPSUTL2($P(OOPSAR("CA1L"),U,5))
"RTN","OOPSDOL1",54,0)
 S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1ES"),U,6))
"RTN","OOPSDOL1",55,0)
 S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1I"),U,6))
"RTN","OOPSDOL1",56,0)
 S OPX=OPX_U_$$DC^OOPSUTL3($P($P(OOPSAR(0),U,5),"."))_"^|"
"RTN","OOPSDOL1",57,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",58,0)
OP04 ; Seg OP04
"RTN","OOPSDOL1",59,0)
 K OPX
"RTN","OOPSDOL1",60,0)
 N CAT,GRD,STP,PAYP
"RTN","OOPSDOL1",61,0)
 S CAT=$$GET1^DIQ(2260,OOPDA,2,"I"),PAYP=$P(OOPSAR(0),U,13)
"RTN","OOPSDOL1",62,0)
 S GRD=$P(OOPSAR("2162A"),U,12),STP=$P(OOPSAR("2162A"),U,13)
"RTN","OOPSDOL1",63,0)
 I STP="N" S STP=" N"  ; special case on step
"RTN","OOPSDOL1",64,0)
 S OPX="OP04^"_$$DC^OOPSUTL3($P(OOPSAR("CA1ES"),U,3))
"RTN","OOPSDOL1",65,0)
 I $P(OOPSAR("CA1F"),U,13) D
"RTN","OOPSDOL1",66,0)
 .S Y=$P(OOPSAR("CA1F"),U,13) D DD^%DT S Y=$P($TR(Y,":",""),"@",2)
"RTN","OOPSDOL1",67,0)
 .S OPX=OPX_U_$$DC^OOPSUTL3($P($P(OOPSAR("CA1F"),U,13),"."))_Y
"RTN","OOPSDOL1",68,0)
 I '$P(OOPSAR("CA1F"),U,13) S OPX=OPX_U
"RTN","OOPSDOL1",69,0)
 I $P(OOPSAR("CA1G"),U,3) D
"RTN","OOPSDOL1",70,0)
 .S Y=$P(OOPSAR("CA1G"),U,3) D DD^%DT S Y=$P($TR(Y,":",""),"@",2)
"RTN","OOPSDOL1",71,0)
 .S OPX=OPX_U_$$DC^OOPSUTL3($P($P(OOPSAR("CA1G"),U,3),"."))_Y
"RTN","OOPSDOL1",72,0)
 I '$P(OOPSAR("CA1G"),U,3) S OPX=OPX_U
"RTN","OOPSDOL1",73,0)
 I $P(OOPSAR("CA1G"),U,2) D
"RTN","OOPSDOL1",74,0)
 .S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1G"),U,2))
"RTN","OOPSDOL1",75,0)
 I '$P(OOPSAR("CA1G"),U,2) S OPX=OPX_U
"RTN","OOPSDOL1",76,0)
 S RPOL=$P(OOPSAR("CA1A"),U,13)
"RTN","OOPSDOL1",77,0)
 S VAL=$S(RPOL="COP":"RS",RPOL="L":"ZZ",1:"NU")
"RTN","OOPSDOL1",78,0)
 S OPX=OPX_U_VAL_U_$P(OOPSAR("CA1I"),U,7)
"RTN","OOPSDOL1",79,0)
 S OPX=OPX_U_$E($P(OOPSAR(0),U,13),1,2)
"RTN","OOPSDOL1",80,0)
 ; V2.0 - fix Grade/Step, send nill if Volunteer or Fee Basis
"RTN","OOPSDOL1",81,0)
 I CAT=2!(PAYP="OT") S OPX=OPX_U_""
"RTN","OOPSDOL1",82,0)
 E  S OPX=OPX_U_$E("00",$L(GRD)+1,2)_GRD
"RTN","OOPSDOL1",83,0)
 I (CAT=2)!(PAYP="OT") S OPX=OPX_U_""
"RTN","OOPSDOL1",84,0)
 E  S OPX=OPX_U_$E("00",$L(STP)+1,2)_STP
"RTN","OOPSDOL1",85,0)
 I $P(OOPSAR("CA1A"),U,8)=1!($P(OOPSAR("CA1A"),U,8)=4)!($P(OOPSAR("CA1A"),U,8)=5)!($P(OOPSAR("CA1A"),U,8)=7) S OPX=OPX_U_"Y"
"RTN","OOPSDOL1",86,0)
 E  S OPX=OPX_U_"N"
"RTN","OOPSDOL1",87,0)
 I $P(OOPSAR("CA1A"),U,8)=2!($P(OOPSAR("CA1A"),U,8)=4)!($P(OOPSAR("CA1A"),U,8)=6)!($P(OOPSAR("CA1A"),U,8)=7) S OPX=OPX_U_"Y"
"RTN","OOPSDOL1",88,0)
 E  S OPX=OPX_U_"N"
"RTN","OOPSDOL1",89,0)
 I $P(OOPSAR("CA1A"),U,8)=3!($P(OOPSAR("CA1A"),U,8)=5)!($P(OOPSAR("CA1A"),U,8)=6)!($P(OOPSAR("CA1A"),U,8)=7) S OPX=OPX_U_"Y"
"RTN","OOPSDOL1",90,0)
 E  S OPX=OPX_U_"N"
"RTN","OOPSDOL1",91,0)
 S OPX=OPX_U_"Y^Y^Y^Y"
"RTN","OOPSDOL1",92,0)
 I $G(WITN) D
"RTN","OOPSDOL1",93,0)
 . S NM=$P($G(OOPSAR("CA1W",0)),U)
"RTN","OOPSDOL1",94,0)
 . S:$G(NM)'="" OPX=OPX_U_"Y" S:$G(NM)="" OPX=OPX_U_"N"
"RTN","OOPSDOL1",95,0)
 . S WS=$P($G(OOPSAR("CA1W",0)),U,6)
"RTN","OOPSDOL1",96,0)
 . S:$G(WS) OPX=OPX_U_"Y" S:'$G(WS) OPX=OPX_U
"RTN","OOPSDOL1",97,0)
 . K NM,WS
"RTN","OOPSDOL1",98,0)
 I '$G(WITN) S OPX=OPX_"^N^N"
"RTN","OOPSDOL1",99,0)
 S OPX=OPX_U_"ASISTS^C2^Y^"
"RTN","OOPSDOL1",100,0)
 S OPX=OPX_$$DC^OOPSUTL3($P(OOPSAR("CA1A"),U,11))
"RTN","OOPSDOL1",101,0)
 S OPX=OPX_U_$P(OOPSAR("CA1A"),U,9)
"RTN","OOPSDOL1",102,0)
 S OPX=OPX_U_$P(OOPSAR("CA1N"),U)
"RTN","OOPSDOL1",103,0)
 S OPX=OPX_U_$P(OOPSAR("CA1N"),U,2)
"RTN","OOPSDOL1",104,0)
 S OPX=OPX_U_$$GET1^DIQ(2260,OOPDA,"185:1")
"RTN","OOPSDOL1",105,0)
 S OPX=OPX_U_$E($P(OOPSAR("CA1A"),U,14),1,5)_"^|"
"RTN","OOPSDOL1",106,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",107,0)
OP05 ; Seg OP05
"RTN","OOPSDOL1",108,0)
 ;V2.0 if Pay Plan="OT" emp is Fee Basis send "C" in PPER
"RTN","OOPSDOL1",109,0)
 N PPER
"RTN","OOPSDOL1",110,0)
 S PPER=$P(OOPSAR("CA1L"),U,2) I (PAYP="OT") S PPER="C"
"RTN","OOPSDOL1",111,0)
 K OPX
"RTN","OOPSDOL1",112,0)
 S OPX="OP05^"_$P(OOPSAR("CA1G"),U,8)_U_$P(OOPSAR("CA1H"),U)
"RTN","OOPSDOL1",113,0)
 S OPX=OPX_U_$P(OOPSAR("CA1H"),U,2)_U_$P(OOPSAR("CA1H"),U,3)
"RTN","OOPSDOL1",114,0)
 S OPX=OPX_U_$$GET1^DIQ(2260,OOPDA,"154:1")_U_$E($P(OOPSAR("CA1H"),U,5),1,5)
"RTN","OOPSDOL1",115,0)
 I $P(OOPSAR("CA1I"),U)'="" D
"RTN","OOPSDOL1",116,0)
 .S OPX=OPX_U_1
"RTN","OOPSDOL1",117,0)
 .S NAME=$P(OOPSAR("CA1I"),U),FN=$P(NAME,",",2)
"RTN","OOPSDOL1",118,0)
 .F KK=1:0:1 Q:$E(FN,KK)'=" "  S FN=$E(FN,KK+1,$L(FN))
"RTN","OOPSDOL1",119,0)
 .S OPX=OPX_U_$E($P(NAME,","),1,20)
"RTN","OOPSDOL1",120,0)
 .S OPX=OPX_U_$E($P(FN," "),1,10)_U_$E($P(FN," ",2),1,10)
"RTN","OOPSDOL1",121,0)
 .S OPX=OPX_U_$$GET1^DIQ(2260,OOPDA,"182:1")
"RTN","OOPSDOL1",122,0)
 I $P(OOPSAR("CA1I"),U)="" S OPX=OPX_U_"3^^^^"
"RTN","OOPSDOL1",123,0)
 S OPX=OPX_U_$P(OOPSAR("CA1I"),U,2)_U_$P(OOPSAR("CA1I"),U,3)
"RTN","OOPSDOL1",124,0)
 S OPX=OPX_U_$$GET1^DIQ(2260,OOPDA,"159:1")_U_$E($P(OOPSAR("CA1I"),U,5),1,5)
"RTN","OOPSDOL1",125,0)
 ; if the claim is for a volunteer both the pay rate and the pay period
"RTN","OOPSDOL1",126,0)
 ; should be blank - llh 12/29/03
"RTN","OOPSDOL1",127,0)
 I CAT=2 S OPX=OPX_U_U_"^|"
"RTN","OOPSDOL1",128,0)
 E  S OPX=OPX_U_$P(OOPSAR("CA1L"),U)_U_PPER_"^|"
"RTN","OOPSDOL1",129,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",130,0)
OP06 ; Seg OP06
"RTN","OOPSDOL1",131,0)
 S DATA=$$CONV^OOPSUTL5($P(OOPSAR("CA1F"),U,11))
"RTN","OOPSDOL1",132,0)
 K OPX
"RTN","OOPSDOL1",133,0)
 S OPX="OP06"
"RTN","OOPSDOL1",134,0)
 F X=1:1:7 D
"RTN","OOPSDOL1",135,0)
 .I DATA[X D
"RTN","OOPSDOL1",136,0)
 ..S OPX=OPX_U_"Y"
"RTN","OOPSDOL1",137,0)
 ..S OPX=OPX_U_$$HM^OOPSUTL3($P(OOPSAR("CA1F"),U,9))
"RTN","OOPSDOL1",138,0)
 ..S OPX=OPX_U_$$HM^OOPSUTL3($P(OOPSAR("CA1F"),U,10))
"RTN","OOPSDOL1",139,0)
 .I DATA'[X S OPX=OPX_"^N^^"
"RTN","OOPSDOL1",140,0)
 ; Generate Occ Code for DOL transfer
"RTN","OOPSDOL1",141,0)
 S OCC=$$GET1^DIQ(2260,OOPDA,15)      ; Occupation code from PAID
"RTN","OOPSDOL1",142,0)
 S OCC=$S(OCC<2300:"G"_OCC,(OCC>2499&(OCC<9001)):"W"_OCC,(OCC=9999):"Z"_OCC,1:"")
"RTN","OOPSDOL1",143,0)
 S OPX=OPX_U_OCC_U_$P(OOPSAR("CA1A"),U,12)_"^|"
"RTN","OOPSDOL1",144,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",145,0)
 K DATA
"RTN","OOPSDOL1",146,0)
OP07 ; Seg OP07
"RTN","OOPSDOL1",147,0)
 K OPX
"RTN","OOPSDOL1",148,0)
 I $L($P(OOPSAR("CA1B"),U))<133 D
"RTN","OOPSDOL1",149,0)
 .S OPX="OP07^1^1^"_$P(OOPSAR("CA1B"),U)_"^|"
"RTN","OOPSDOL1",150,0)
 .D STORE^OOPSDOLX
"RTN","OOPSDOL1",151,0)
 I $L($P(OOPSAR("CA1B"),U))>132 D
"RTN","OOPSDOL1",152,0)
 .S OPX="OP07^1^2^"_$E($P(OOPSAR("CA1B"),U),1,132)_"^|"
"RTN","OOPSDOL1",153,0)
 .D STORE^OOPSDOLX
"RTN","OOPSDOL1",154,0)
 .K OPX
"RTN","OOPSDOL1",155,0)
 .S OPX="OP07^2^2^"_$E($P(OOPSAR("CA1B"),U),133,200)_"^|"
"RTN","OOPSDOL1",156,0)
 .D STORE^OOPSDOLX
"RTN","OOPSDOL1",157,0)
OP08 ; Seg OP08
"RTN","OOPSDOL1",158,0)
 K OPX
"RTN","OOPSDOL1",159,0)
 S OPX="OP08^"_$S($P(OOPSAR("CA1G"),U,4)="N":"NW",1:"")
"RTN","OOPSDOL1",160,0)
 S OPX=OPX_U_$S($P(OOPSAR("CA1G"),U,6)="Y":"WM",1:"")
"RTN","OOPSDOL1",161,0)
 S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1G"),U))
"RTN","OOPSDOL1",162,0)
 I $G(OOPSAR("CA1K"))'="",($P(OOPSAR("CA1K"),U,4)'=0) S OPX=OPX_U_"E5"
"RTN","OOPSDOL1",163,0)
 E  S OPX=OPX_U
"RTN","OOPSDOL1",164,0)
 S OPX=OPX_U
"RTN","OOPSDOL1",165,0)
 I $P(OOPSAR("CA1I"),U,8)="N" S OPX=OPX_U_"CN"
"RTN","OOPSDOL1",166,0)
 E  S OPX=OPX_U
"RTN","OOPSDOL1",167,0)
 I $P(OOPSAR("CA1L"),U,3)'="" S OPX=OPX_U_97
"RTN","OOPSDOL1",168,0)
 E  S OPX=OPX_U
"RTN","OOPSDOL1",169,0)
 I $G(OOPSAR("CA1W",0))'="" D
"RTN","OOPSDOL1",170,0)
 . S OPX=OPX_U_"Y"
"RTN","OOPSDOL1",171,0)
 . S NAME=$P(OOPSAR("CA1W",0),U),FN=$P(NAME,",",2)
"RTN","OOPSDOL1",172,0)
 . F KK=1:0:1 Q:$E(FN,KK)'=" "  S FN=$E(FN,KK+1,$L(FN))
"RTN","OOPSDOL1",173,0)
 . S OPX=OPX_U_$E($P(NAME,","),1,20)
"RTN","OOPSDOL1",174,0)
 . S OPX=OPX_U_$E($P(FN," "),1,10)_U
"RTN","OOPSDOL1",175,0)
 . S OPX=OPX_U_$P(OOPSAR("CA1W",0),U,2)
"RTN","OOPSDOL1",176,0)
 . S OPX=OPX_U_$P(OOPSAR("CA1W",0),U,3)
"RTN","OOPSDOL1",177,0)
 . S OPX=OPX_U_$$GET1^DIQ(5,$P(OOPSAR("CA1W",0),U,4),1)  ; State Code
"RTN","OOPSDOL1",178,0)
 . S OPX=OPX_U_$E($P(OOPSAR("CA1W",0),U,5),1,5)
"RTN","OOPSDOL1",179,0)
 . S OPX=OPX_U_$$DC^OOPSUTL3($P(OOPSAR("CA1W",0),U,6))
"RTN","OOPSDOL1",180,0)
 I $G(OOPSAR("CA1W",0))="" S OPX=OPX_U_"^^^^^^^^"
"RTN","OOPSDOL1",181,0)
 S FL174=$P(OOPSAR("CA1L"),U,6)  ;FILING INSTRUCTION
"RTN","OOPSDOL1",182,0)
 S CATY=$S(FL174=1:"2^0",FL174=2:"2^1",FL174=3:"1^",FL174=4:"6^",1:"")
"RTN","OOPSDOL1",183,0)
 S OPX=OPX_U_CATY_"^|"
"RTN","OOPSDOL1",184,0)
 D STORE^OOPSDOLX
"RTN","OOPSDOL1",185,0)
OP09 ; Seg OP09
"RTN","OOPSDOL1",186,0)
 I $P(OOPSAR("CA1G"),U,4)="N" D
"RTN","OOPSDOL1",187,0)
 .K OPX
"RTN","OOPSDOL1",188,0)
 .S OPX="OP09^1^1^"_$P(OOPSAR("CA1G"),U,5)_"^|" D STORE^OOPSDOLX
"RTN","OOPSDOL1",189,0)
OP10 ; Seg OP10
"RTN","OOPSDOL1",190,0)
 I $P(OOPSAR("CA1G"),U,7)'="" D
"RTN","OOPSDOL1",191,0)
 .K OPX
"RTN","OOPSDOL1",192,0)
 .S OPX="OP10^1^1^"_$P(OOPSAR("CA1G"),U,7)_"^|" D STORE^OOPSDOLX
"RTN","OOPSDOL1",193,0)
OP11 ; Seg OP11 - Reason for Convert (Word Processing)
"RTN","OOPSDOL1",194,0)
 I $G(OOPSAR("CA1K"))'="" D
"RTN","OOPSDOL1",195,0)
 .S OPFLD=165,SEG="OP11" D WP^OOPSDOLX
"RTN","OOPSDOL1",196,0)
OP12 ; Seg OP12 - Supervisor not agree explain (Word Processing)
"RTN","OOPSDOL1",197,0)
 I $G(OOPSAR("CA1J"))'="" D
"RTN","OOPSDOL1",198,0)
 .S OPFLD=164,SEG="OP12" D WP^OOPSDOLX
"RTN","OOPSDOL1",199,0)
OP13 ; Seg OP13 - Nature of Injury
"RTN","OOPSDOL1",200,0)
 I $P(OOPSAR("CA1C"),U)'="" D
"RTN","OOPSDOL1",201,0)
 .K OPX
"RTN","OOPSDOL1",202,0)
 .S OPX="OP13^1^1^"_$P(OOPSAR("CA1C"),U)_"^|" D STORE^OOPSDOLX
"RTN","OOPSDOL1",203,0)
OP14 ; Seg OP14 - Supervisor Exception
"RTN","OOPSDOL1",204,0)
 I $P(OOPSAR("CA1L"),U,3)'="" D
"RTN","OOPSDOL1",205,0)
 .K OPX
"RTN","OOPSDOL1",206,0)
 .S OPX="OP14^1^1"
"RTN","OOPSDOL1",207,0)
 .S OPX=OPX_U_$P(OOPSAR("CA1L"),U,3)_"^|" D STORE^OOPSDOLX
"RTN","OOPSDOL1",208,0)
OP20 ; Seg OP20
"RTN","OOPSDOL1",209,0)
 K OPX
"RTN","OOPSDOL1",210,0)
 I $P(OOPSAR("2162B"),U,4)'="" D
"RTN","OOPSDOL1",211,0)
 .S OPX="OP20^"_"P"_U_$$GET1^DIQ(2260,OOPDA,"30:1")_"^|" D STORE^OOPSDOLX
"RTN","OOPSDOL1",212,0)
 .Q
"RTN","OOPSDOL1",213,0)
OP21 ; Seg OP21 Defined for future use
"RTN","OOPSDOL1",214,0)
OP22 ; Seg OP22 Defined for future use
"RTN","OOPSDOL1",215,0)
OP23 ; Seg OP23 - Statement of Witness (Not yet used)
"RTN","OOPSDOL1",216,0)
 I $G(OOPSAR("CA1W",1))'="" D
"RTN","OOPSDOL1",217,0)
 . I $L(OOPSAR("CA1W",1))<133 D
"RTN","OOPSDOL1",218,0)
 .. K OPX
"RTN","OOPSDOL1",219,0)
 .. S OPX="OP23^1^1^"_OOPSAR("CA1W",1)_"^|"
"RTN","OOPSDOL1",220,0)
 .. D STORE^OOPSDOLX
"RTN","OOPSDOL1",221,0)
 . I $L(OOPSAR("CA1W",1))>132 D
"RTN","OOPSDOL1",222,0)
 .. K OPX
"RTN","OOPSDOL1",223,0)
 .. S OPX="OP23^1^2^"_$E(OOPSAR("CA1W",1),1,132)_"^|"
"RTN","OOPSDOL1",224,0)
 .. D STORE^OOPSDOLX
"RTN","OOPSDOL1",225,0)
 .. K OPX
"RTN","OOPSDOL1",226,0)
 .. S OPX="OP23^2^2^"_$E(DATA,133,264)_"^|"
"RTN","OOPSDOL1",227,0)
 .. D STORE^OOPSDOLX
"RTN","OOPSDOL1",228,0)
 ;
"RTN","OOPSDOL1",229,0)
EXIT ; End of routine
"RTN","OOPSDOL1",230,0)
 K WITN
"RTN","OOPSDOL1",231,0)
 Q
"RTN","OOPSGUI0")
0^3^B41444101
"RTN","OOPSGUI0",1,0)
OOPSGUI0 ;WIOFO/LLH-RPC routines ;01/02/02
"RTN","OOPSGUI0",2,0)
 ;;2.0;ASISTS;**2,4**;Jun 03, 2002
"RTN","OOPSGUI0",3,0)
 ;
"RTN","OOPSGUI0",4,0)
GETCASE(RESULTS,PERSON,CSTAT,PSTAT,CALL,OPT) ; Subroutine for Case Selection
"RTN","OOPSGUI0",5,0)
 ; Returns a list of cases that can be displayed for selection
"RTN","OOPSGUI0",6,0)
 ; RESULTS = return array containing, CASE#^IEN^NAME^DATE TIME OCCUR
"RTN","OOPSGUI0",7,0)
 ; PERSON  = 0^ if no person selected
"RTN","OOPSGUI0",8,0)
 ;           1^PERSON INVOLVED NAME
"RTN","OOPSGUI0",9,0)
 ;           2^SUPERVISOR DUZ
"RTN","OOPSGUI0",10,0)
 ;           3^USER SSN
"RTN","OOPSGUI0",11,0)
 ;           4^CASE NUMBER
"RTN","OOPSGUI0",12,0)
 ; CSTAT   = #^#^#^#  0^1^2^3 0=open, 1=closed, 2=deleted, 3=replaced
"RTN","OOPSGUI0",13,0)
 ;           99^ if all Case Status should be included
"RTN","OOPSGUI0",14,0)
 ;           CSTAT is only set programatically
"RTN","OOPSGUI0",15,0)
 ; PSTAT   = 0^  if all personnel status types should be included
"RTN","OOPSGUI0",16,0)
 ;           #^#^#^ for each personnel status selected
"RTN","OOPSGUI0",17,0)
 ; CALL    = Calling menu, used to assure proper access
"RTN","OOPSGUI0",18,0)
 ; OPT     = Option called from, used to assure proper access
"RTN","OOPSGUI0",19,0)
 ; 
"RTN","OOPSGUI0",20,0)
 K ^TMP("OOPSCASE",DUZ)
"RTN","OOPSGUI0",21,0)
 N ARR,CNUM,OOPSDA,PER,STA,SUP,VIEWSUP,VIEWEMP,VALSSN
"RTN","OOPSGUI0",22,0)
 I $G(PERSON)="" Q
"RTN","OOPSGUI0",23,0)
 I +PERSON=1 D GETPER,SORT G EXIT
"RTN","OOPSGUI0",24,0)
 I +PERSON=4 D  G EXIT
"RTN","OOPSGUI0",25,0)
 . S CNUM=$P($G(PERSON),U,2) I '$G(CNUM) Q
"RTN","OOPSGUI0",26,0)
 . S OOPSDA=$O(^OOPS(2260,"B",CNUM,"")) I '$G(OOPSDA) D  Q
"RTN","OOPSGUI0",27,0)
 .. S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable"
"RTN","OOPSGUI0",28,0)
 .. S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",29,0)
 ..; S RESULTS(0)="No Cases Selectable"
"RTN","OOPSGUI0",30,0)
 . S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",31,0)
 . I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",32,0)
 . I $$CALLER() S ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",33,0)
 . D SORT
"RTN","OOPSGUI0",34,0)
 S CNUM=0
"RTN","OOPSGUI0",35,0)
 F  S CNUM=$O(^OOPS(2260,"B",CNUM)) Q:CNUM=""  D
"RTN","OOPSGUI0",36,0)
 . S OOPSDA=""
"RTN","OOPSGUI0",37,0)
 . F  S OOPSDA=$O(^OOPS(2260,"B",CNUM,OOPSDA)) Q:OOPSDA=""  D
"RTN","OOPSGUI0",38,0)
 .. I +PERSON=3 D  Q:'VIEWEMP
"RTN","OOPSGUI0",39,0)
 ... S VIEWEMP=1,VALSSN=$P($G(PERSON),U,2)
"RTN","OOPSGUI0",40,0)
 ... I $$GET1^DIQ(2260,OOPSDA,5,"I")'=VALSSN  D
"RTN","OOPSGUI0",41,0)
 .... S VIEWEMP=0
"RTN","OOPSGUI0",42,0)
 .... S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable"
"RTN","OOPSGUI0",43,0)
 .... S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",44,0)
 .. S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",45,0)
 .. I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",46,0)
 .. S PER=$$GET1^DIQ(2260,OOPSDA,2,"I")
"RTN","OOPSGUI0",47,0)
 .. I (+PSTAT)&(PSTAT'[(PER_"^")) Q      ;allow only selected per status
"RTN","OOPSGUI0",48,0)
 .. I +PERSON=2 D  Q:'VIEWSUP
"RTN","OOPSGUI0",49,0)
 ... S VIEWSUP=1,SUP=$P(PERSON,U,2)
"RTN","OOPSGUI0",50,0)
 ... I $$GET1^DIQ(2260,OOPSDA,53,"I")'=SUP,($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=SUP) D  Q
"RTN","OOPSGUI0",51,0)
 ....; S RESULTS(0)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",52,0)
 .... S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",53,0)
 .... S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",54,0)
 .. I $$CALLER() S CNUM=$$GET1^DIQ(2260,OOPSDA,.01),ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",55,0)
 D SORT
"RTN","OOPSGUI0",56,0)
EXIT ; quit the routine
"RTN","OOPSGUI0",57,0)
 Q
"RTN","OOPSGUI0",58,0)
GETPER ; Person Name passed in, match
"RTN","OOPSGUI0",59,0)
 ; See above for documentation
"RTN","OOPSGUI0",60,0)
 N NM
"RTN","OOPSGUI0",61,0)
 S OOPSDA="",NM=$P(PERSON,U,2)
"RTN","OOPSGUI0",62,0)
 F  S OOPSDA=$O(^OOPS(2260,"C",NM,OOPSDA)) Q:OOPSDA=""  D
"RTN","OOPSGUI0",63,0)
 . S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",64,0)
 . I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",65,0)
 . S PER=$$GET1^DIQ(2260,OOPSDA,2,"I")
"RTN","OOPSGUI0",66,0)
 . I (+PSTAT)&(PSTAT'[(PER_"^")) Q      ;allow only selected per status
"RTN","OOPSGUI0",67,0)
 . I $$CALLER() S CNUM=$$GET1^DIQ(2260,OOPSDA,.01),ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",68,0)
 Q
"RTN","OOPSGUI0",69,0)
CALLER() ; Check to make sure case should be included
"RTN","OOPSGUI0",70,0)
 N EES,ESTAT,FLD,INC,SIG,SSN,VIEWC
"RTN","OOPSGUI0",71,0)
 S VIEWC=1
"RTN","OOPSGUI0",72,0)
 S INC=$$GET1^DIQ(2260,OOPSDA,52,"I")
"RTN","OOPSGUI0",73,0)
 ; get users SSN 
"RTN","OOPSGUI0",74,0)
 S SSN=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUI0",75,0)
 ; make sure user cannot access claim from any menu but Employee
"RTN","OOPSGUI0",76,0)
 I CALL'="E",($$GET1^DIQ(2260,OOPSDA,5,"I")=SSN) S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",77,0)
 ; Claim already sent to DOL, can't edit, Caller / Option doesnt matter
"RTN","OOPSGUI0",78,0)
 ; unless the Option = "CHGCASE"
"RTN","OOPSGUI0",79,0)
 ; Patch 4 llh - should also be able to create amendment.  NOTE: Case
"RTN","OOPSGUI0",80,0)
 ;               status should always = open
"RTN","OOPSGUI0",81,0)
 I ($$GET1^DIQ(2260,OOPSDA,66)'=""),(OPT'="CHGCASE"),(OPT'="PRINTCA"),(OPT'=2162),(OPT'="CRAMEND") S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",82,0)
 ; for any option from the supervisor menu
"RTN","OOPSGUI0",83,0)
 I CALL="S" D  I 'VIEWC Q VIEWC
"RTN","OOPSGUI0",84,0)
 . I $$GET1^DIQ(2260,OOPSDA,53,"I")'=DUZ,($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=DUZ) S VIEWC=0 Q
"RTN","OOPSGUI0",85,0)
 ; if opt = 2162
"RTN","OOPSGUI0",86,0)
 I OPT=2162 D  Q VIEWC
"RTN","OOPSGUI0",87,0)
 . I $$GET1^DIQ(2260,OOPSDA,51,"I")=1 S VIEWC=0  ; closed, can't edit
"RTN","OOPSGUI0",88,0)
 . ; signed SO, coming from Supervisor menu, cant access
"RTN","OOPSGUI0",89,0)
 . I (CALL="S"),+$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0
"RTN","OOPSGUI0",90,0)
 . I CALL="H" D
"RTN","OOPSGUI0",91,0)
 .. I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,3)!(+$$EDSTA^OOPSUTL1(OOPSDA,"O")) S VIEWC=0
"RTN","OOPSGUI0",92,0)
 . I CALL="W" D
"RTN","OOPSGUI0",93,0)
 .. I +$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0   ;safety signed cant see
"RTN","OOPSGUI0",94,0)
 ; if opt = CA1 only return/allow CA1's, caller doesnt matter
"RTN","OOPSGUI0",95,0)
 I OPT="CA1",INC'=1 S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",96,0)
 ; if opt = CA2 only return/allow CA2's, caller doesnt matter
"RTN","OOPSGUI0",97,0)
 I OPT="CA2",INC'=2 S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",98,0)
 I CALL="E" D  Q VIEWC
"RTN","OOPSGUI0",99,0)
 . I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",100,0)
 . I '$G(SSN) S VIEWC=0 Q
"RTN","OOPSGUI0",101,0)
 . I $D(^OOPS(2260,"SSN",SSN))<1 S VIEWC=0 Q
"RTN","OOPSGUI0",102,0)
 . ; user SSN must = case IEN from Employee menu
"RTN","OOPSGUI0",103,0)
 . I $$GET1^DIQ(2260,OOPSDA,5,"I")'=SSN S VIEWC=0 Q
"RTN","OOPSGUI0",104,0)
 . S SIG=$$EDSTA^OOPSUTL1(OOPSDA,"S")
"RTN","OOPSGUI0",105,0)
 . I (OPT'="PRINTCA"),$P(SIG,U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",106,0)
 I CALL="S" D  Q VIEWC
"RTN","OOPSGUI0",107,0)
 . ; not Super or Sec Super, can't access form, regardless of form type
"RTN","OOPSGUI0",108,0)
 . I $$GET1^DIQ(2260,OOPSDA,53,"I")'=DUZ&($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=DUZ) S VIEWC=0 Q
"RTN","OOPSGUI0",109,0)
 . ; Supervisor cannot complete their own form.
"RTN","OOPSGUI0",110,0)
 . I $$GET1^DIQ(2260,OOPSDA,5,"I")=SSN S VIEWC=0 Q
"RTN","OOPSGUI0",111,0)
 . I OPT="CA1"!(OPT="CA2") D  Q
"RTN","OOPSGUI0",112,0)
 .. ; if form CA, must be employee to complete
"RTN","OOPSGUI0",113,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",114,0)
 .. ; commented out next 2 lines, ? whether wanted by TAG 11/1/01 llh
"RTN","OOPSGUI0",115,0)
 .. ; Employee hasn't signed, super can't get to
"RTN","OOPSGUI0",116,0)
 .. ; I '$P($$EDSTA^OOPSUTL1(OOPSDA,"E"),U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",117,0)
 .. ; Supervisor has signed, can't re-edit
"RTN","OOPSGUI0",118,0)
 .. I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",119,0)
 I CALL="O"!(CALL="W")!(CALL="H") D  Q VIEWC
"RTN","OOPSGUI0",120,0)
 . I OPT="CA1"!(OPT="CA2") D  Q
"RTN","OOPSGUI0",121,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",122,0)
 . I OPT="WCSIGN" D  Q
"RTN","OOPSGUI0",123,0)
 .. S ESTAT=$$EDSTA^OOPSUTL1(OOPSDA,"E")
"RTN","OOPSGUI0",124,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",125,0)
 .. I CALL'="W",$P(ESTAT,U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",126,0)
 .. I CALL="W" D
"RTN","OOPSGUI0",127,0)
 ... S FLD=$S(INC=1:119,INC=2:221,1:"") I 'FLD S VIEWC=0 Q
"RTN","OOPSGUI0",128,0)
 ... S EES=$$GET1^DIQ(2260,OOPSDA,FLD,"I")
"RTN","OOPSGUI0",129,0)
 ... ; employee hasn't signed, ok for WC to sign
"RTN","OOPSGUI0",130,0)
 ... I 'EES Q
"RTN","OOPSGUI0",131,0)
 ... ; employee signed, not signed by person accessing claim, no access
"RTN","OOPSGUI0",132,0)
 ... I EES'=DUZ S VIEWC=0 Q
"RTN","OOPSGUI0",133,0)
 ... I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,INC) S VIEWC=0 ;Sup Sign, no acc
"RTN","OOPSGUI0",134,0)
 . I OPT="WCEMPSIGN" D  Q
"RTN","OOPSGUI0",135,0)
 .. N CALLER,SVIEW
"RTN","OOPSGUI0",136,0)
 .. S CALLER=CALL
"RTN","OOPSGUI0",137,0)
 .. I $$GET1^DIQ(2260,OOPSDA,51,"I") S VIEWC=0 Q    ; claim must be open
"RTN","OOPSGUI0",138,0)
 .. I $$GET1^DIQ(2260,OOPSDA,77)="" S VIEWC=0 Q
"RTN","OOPSGUI0",139,0)
 .. I $$GET1^DIQ(2260,OOPSDA,80)="" S VIEWC=0 Q
"RTN","OOPSGUI0",140,0)
 .. S SVIEW=$$SCR^OOPSWCSE(OOPSDA) I 'SVIEW S VIEWC=0 Q
"RTN","OOPSGUI0",141,0)
 I CALL="U" D  Q VIEWC
"RTN","OOPSGUI0",142,0)
 . I '+$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0 Q
"RTN","OOPSGUI0",143,0)
 . I '$P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,3) S VIEWC=0 Q
"RTN","OOPSGUI0",144,0)
 Q VIEWC
"RTN","OOPSGUI0",145,0)
SORT ; put cases in reverse number order
"RTN","OOPSGUI0",146,0)
 N CN,CNUM,OOPSDA,SSN,DOI
"RTN","OOPSGUI0",147,0)
 S ^TMP("OOPSCASE",DUZ,0)="",CNUM="",CN=1
"RTN","OOPSGUI0",148,0)
 I '$D(ARR) S RESULTS(0)="No Cases Selectable"  D
"RTN","OOPSGUI0",149,0)
 . S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",150,0)
 . S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",151,0)
 F  S CNUM=$O(ARR(CNUM),-1) Q:CNUM=""  D
"RTN","OOPSGUI0",152,0)
 . S OOPSDA=ARR(CNUM)
"RTN","OOPSGUI0",153,0)
 . S NM=$$GET1^DIQ(2260,OOPSDA,1)
"RTN","OOPSGUI0",154,0)
 . S DOI=$$GET1^DIQ(2260,OOPSDA,4)
"RTN","OOPSGUI0",155,0)
 . S SSN=$$GET1^DIQ(2260,OOPSDA,5)
"RTN","OOPSGUI0",156,0)
 . I CALL="U" S (NM,DOI,SSN)=""
"RTN","OOPSGUI0",157,0)
 . S ^TMP("OOPSCASE",DUZ,CN)=CNUM_U_DOI_U_NM_U_OOPSDA_U_SSN_$C(10),CN=CN+1
"RTN","OOPSGUI0",158,0)
 S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",159,0)
 Q
"RTN","OOPSGUI1")
0^1^B29922240
"RTN","OOPSGUI1",1,0)
OOPSGUI1 ;WIOFO/LLH-RPC routines ;9/3/01
"RTN","OOPSGUI1",2,0)
 ;;2.0;ASISTS;**4**;Jun 03, 2002
"RTN","OOPSGUI1",3,0)
 ;
"RTN","OOPSGUI1",4,0)
OPT(RESULTS,INP) ; Returns the ASISTS GUI Menus user has access to
"RTN","OOPSGUI1",5,0)
 ;      INP      - Input String containing the version of GUI making call
"RTN","OOPSGUI1",6,0)
 ;  RESUTLS      - return value for broker call
"RTN","OOPSGUI1",7,0)
 ;                 P1 = 1 DUZ defined
"RTN","OOPSGUI1",8,0)
 ;                 P2 = 1 Emp Health menu accessible
"RTN","OOPSGUI1",9,0)
 ;                 P3 = 1 Employee menu accessible
"RTN","OOPSGUI1",10,0)
 ;                 P4 = 1 Supervisor menu accessible
"RTN","OOPSGUI1",11,0)
 ;                 P5 = 1 Safety Officer menu accessible
"RTN","OOPSGUI1",12,0)
 ;                 P6 = 1 Union menu accessible
"RTN","OOPSGUI1",13,0)
 ;                 P7 = 1 Workers' Comp menu accessible
"RTN","OOPSGUI1",14,0)
 ;                 P8 = SSN from New Person file for user
"RTN","OOPSGUI1",15,0)
 ;                 P9 = server version #
"RTN","OOPSGUI1",16,0)
 ;
"RTN","OOPSGUI1",17,0)
 N CNT,MENU,OPT,PRIM,SM,VER
"RTN","OOPSGUI1",18,0)
 S CNT=1
"RTN","OOPSGUI1",19,0)
 I 'DUZ S RESULTS="0^^^^^^^" Q
"RTN","OOPSGUI1",20,0)
 S RESULTS=DUZ_"^0^0^0^0^0^0^"
"RTN","OOPSGUI1",21,0)
 S VER="2.4.1.0"        ;Define version check patch #4
"RTN","OOPSGUI1",22,0)
 I $G(INP)=""!($G(INP)'=VER) Q
"RTN","OOPSGUI1",23,0)
 S PRIM=$$GET1^DIQ(200,DUZ,201)     ; get primary menu
"RTN","OOPSGUI1",24,0)
 I $G(PRIM)'="" S MENU(PRIM)=""
"RTN","OOPSGUI1",25,0)
 S SM=0
"RTN","OOPSGUI1",26,0)
 F  S SM=$O(^VA(200,DUZ,203,SM))  Q:SM'>0  D
"RTN","OOPSGUI1",27,0)
 . S OPT=$$GET1^DIQ(19,$P($G(^VA(200,DUZ,203,SM,0)),U),.01)
"RTN","OOPSGUI1",28,0)
 . I $G(OPT)'="" S MENU(OPT)=""
"RTN","OOPSGUI1",29,0)
 I $D(MENU("OOPS GUI EMPLOYEE HEALTH MENU")) S $P(RESULTS,U,2)=1
"RTN","OOPSGUI1",30,0)
 I $D(MENU("OOPS GUI EMPLOYEE")) S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",31,0)
 I $D(MENU("OOPS GUI SUPERVISOR MENU")) S $P(RESULTS,U,4)=1
"RTN","OOPSGUI1",32,0)
 I $D(MENU("OOPS GUI SAFETY OFFICER MENU")) S $P(RESULTS,U,5)=1
"RTN","OOPSGUI1",33,0)
 I $D(MENU("OOPS GUI UNION MENU")) S $P(RESULTS,U,6)=1
"RTN","OOPSGUI1",34,0)
 I $D(MENU("OOPS GUI WORKERS' COMP MENU")) S $P(RESULTS,U,7)=1
"RTN","OOPSGUI1",35,0)
 I +$$ACCESS^XQCHK(DUZ,"OOPS GUI EMPLOYEE") S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",36,0)
 S $P(RESULTS,U,8)=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUI1",37,0)
 S $P(RESULTS,U,9)=VER              ;return the version defined above.
"RTN","OOPSGUI1",38,0)
 Q
"RTN","OOPSGUI1",39,0)
SETSIGN(RESULTS,INPUT,SIGN) ; This subroutine validates that the signature
"RTN","OOPSGUI1",40,0)
 ;                         can be entered and is valid
"RTN","OOPSGUI1",41,0)
 ;  Input:   INPUT - Contains the IEN of the ASISTS case, the form type,
"RTN","OOPSGUI1",42,0)
 ;                   and the field number.  The field number is used
"RTN","OOPSGUI1",43,0)
 ;                   to trigger what validation should be preformed on
"RTN","OOPSGUI1",44,0)
 ;                   the fields in the form so that the signature can
"RTN","OOPSGUI1",45,0)
 ;                   be applied. The fourth parameter is a special flag
"RTN","OOPSGUI1",46,0)
 ;                   indicating the Workers Comp is signing for employee
"RTN","OOPSGUI1",47,0)
 ;                   Format is IEN^FORM^FIELD^WCFLAG
"RTN","OOPSGUI1",48,0)
 ;            SIGN - contains the signature test to be encrypted.
"RTN","OOPSGUI1",49,0)
 ; Output: RESULTS - is an array containing a list of fields that did
"RTN","OOPSGUI1",50,0)
 ;                   not pass the data validation and must be corrected
"RTN","OOPSGUI1",51,0)
 ;                   prior to applying a signature.
"RTN","OOPSGUI1",52,0)
 N CALL,DTIME,FDUZ,FDT,FLD,IEN,INC,FORM,ESIG,VALID,CALLER,WOK
"RTN","OOPSGUI1",53,0)
 N DR,DA,DIE,WCFLG
"RTN","OOPSGUI1",54,0)
 S IEN=$P($G(INPUT),U),FORM=$P($G(INPUT),U,2),FLD=$P($G(INPUT),U,3)
"RTN","OOPSGUI1",55,0)
 I '$G(IEN)!('$G(FLD)) S RESULTS(1)="User not Authorized to sign form" Q
"RTN","OOPSGUI1",56,0)
 I FLD=45!(FLD=170)!(FLD=266) S CALL="S"
"RTN","OOPSGUI1",57,0)
 I FLD=49!(FLD=77) S CALL="O"
"RTN","OOPSGUI1",58,0)
 I FLD=68 S CALL="W"
"RTN","OOPSGUI1",59,0)
 I FLD=80 S CALL="H"
"RTN","OOPSGUI1",60,0)
 I FLD=120!(FLD=222) S CALL="E"
"RTN","OOPSGUI1",61,0)
 S WCFLG=$P($G(INPUT),U,4)
"RTN","OOPSGUI1",62,0)
 I WCFLG'="W" D
"RTN","OOPSGUI1",63,0)
 .I (FLD=120!(FLD=222))&($$GET1^DIQ(2260,IEN,71,"I")'="Y") D  Q
"RTN","OOPSGUI1",64,0)
 .. S RESULTS(1)="Claim cannot be signed until the Bill of Rights Statement is understood."
"RTN","OOPSGUI1",65,0)
 .. D WCPBOR^OOPSMBUL(IEN)
"RTN","OOPSGUI1",66,0)
 ; check to make sure PAID fields (also Service) not "", if "" get data
"RTN","OOPSGUI1",67,0)
 D CHKPAID
"RTN","OOPSGUI1",68,0)
 S VALID=0
"RTN","OOPSGUI1",69,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUI1",70,0)
 I (FLD'=77),(FLD'=80) D  I 'VALID Q
"RTN","OOPSGUI1",71,0)
 . D VALIDATE^OOPSGUI9(IEN,FORM,CALL,.VALID)
"RTN","OOPSGUI1",72,0)
 I $G(SIGN)="" S RESULTS(1)="No Signature Entered" Q
"RTN","OOPSGUI1",73,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(SIGN))
"RTN","OOPSGUI1",74,0)
 I 'VALID D  Q
"RTN","OOPSGUI1",75,0)
 . I $P($G(^VA(200,DUZ,20)),"^",4)="" S RESULTS(1)="No Electronic Signature on File" Q
"RTN","OOPSGUI1",76,0)
 . S RESULTS(1)="Invalid Signature Entered."
"RTN","OOPSGUI1",77,0)
SIGN ; All field validated, file signature
"RTN","OOPSGUI1",78,0)
 I FLD=77 S FDUZ=76,FDT=78             ; Safety approve WC sign
"RTN","OOPSGUI1",79,0)
 I FLD=80 S FDUZ=79,FDT=81             ; EH approve WC sign
"RTN","OOPSGUI1",80,0)
 I FLD=120 S FDUZ=119,FDT=121          ; Employee sign CA1
"RTN","OOPSGUI1",81,0)
 I FLD=222 S FDUZ=221,FDT=223          ; Employee sign CA2
"RTN","OOPSGUI1",82,0)
 I FLD=170 S FDUZ=169,FDT=171          ; Super sign CA1
"RTN","OOPSGUI1",83,0)
 I FLD=266 S FDUZ=265,FDT=267          ; Super sign CA2
"RTN","OOPSGUI1",84,0)
 I FLD=45 S FDUZ=44,FDT=46             ; Super sign 2162
"RTN","OOPSGUI1",85,0)
 I FLD=49 S FDUZ=48,FDT=50             ; Safety sign 2162
"RTN","OOPSGUI1",86,0)
 I FLD=68 S FDUZ=67,FDT=69,WOK=1       ; WC approve to DOL
"RTN","OOPSGUI1",87,0)
 D NOW^%DTC S DTIME=%
"RTN","OOPSGUI1",88,0)
 K DR S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI1",89,0)
 S DR=FDUZ_"////^S X=+DUZ;"_FLD_"////^S X=ESIG;"_FDT_"////^S X=DTIME"
"RTN","OOPSGUI1",90,0)
 D ^DIE
"RTN","OOPSGUI1",91,0)
 I $G(Y)'="" Q
"RTN","OOPSGUI1",92,0)
 I FLD=68 D WCP^OOPSMBUL(IEN,"S")
"RTN","OOPSGUI1",93,0)
 I FLD=120!(FLD=222) S CALLER=CALL D EMP^OOPSVAL1
"RTN","OOPSGUI1",94,0)
 I FLD=45 D SAFETY^OOPSMBUL(IEN)
"RTN","OOPSGUI1",95,0)
 I (FLD=170)!(FLD=266) D SUPS^OOPSMBUL(IEN),UNION^OOPSMBUL(IEN)
"RTN","OOPSGUI1",96,0)
 Q
"RTN","OOPSGUI1",97,0)
VALIDATE(X) ; Validate Electronic Sign code
"RTN","OOPSGUI1",98,0)
 ;  Input:  X - contains the signature to be validated
"RTN","OOPSGUI1",99,0)
 ; Output: VSIGN - contains a 1 if a valid e-signature, a 0 if not valid
"RTN","OOPSGUI1",100,0)
 N VSIGN
"RTN","OOPSGUI1",101,0)
 S VSIGN=0
"RTN","OOPSGUI1",102,0)
 D HASH^XUSHSHP
"RTN","OOPSGUI1",103,0)
 I X'="",(X=$P($G(^VA(200,DUZ,20)),"^",4)) S VSIGN=1,ESIG=X
"RTN","OOPSGUI1",104,0)
 Q VSIGN
"RTN","OOPSGUI1",105,0)
CHKPAID ; check to make sure PAID fields have data, if not populate
"RTN","OOPSGUI1",106,0)
 ; this subroutine can be removed when go completely to GUI
"RTN","OOPSGUI1",107,0)
 N DA,DIE,DR,CAT,FLD,IEN200,OCCD,PAY,PAYP,RET,SAL,SERV,SSN
"RTN","OOPSGUI1",108,0)
 I $$GET1^DIQ(2260,IEN,60)="" D
"RTN","OOPSGUI1",109,0)
 .S FLD=26,RET="",RET=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",110,0)
 .S RET=$S(RET="FULL CSRS":"CSRS",RET="FERS":"FERS",1:"OTHER")
"RTN","OOPSGUI1",111,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="60///^S X=RET" D ^DIE
"RTN","OOPSGUI1",112,0)
 I $$GET1^DIQ(2260,IEN,86)="" D
"RTN","OOPSGUI1",113,0)
 .S SERV="",SSN=$$GET1^DIQ(2260,IEN,5,"I")
"RTN","OOPSGUI1",114,0)
 .I $G(SSN) S IEN200=$O(^VA(200,"SSN",SSN,""))
"RTN","OOPSGUI1",115,0)
 .I $G(IEN200) S SERV=$$GET1^DIQ(200,IEN200,29)
"RTN","OOPSGUI1",116,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="86///^S X=SERV" D ^DIE
"RTN","OOPSGUI1",117,0)
 I $$GET1^DIQ(2260,IEN,166)="" D
"RTN","OOPSGUI1",118,0)
 .S FLD=28,SAL="",SAL=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",119,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="166///^S X=SAL" D ^DIE
"RTN","OOPSGUI1",120,0)
 I $$GET1^DIQ(2260,IEN,167)="" D
"RTN","OOPSGUI1",121,0)
 .S FLD=19,PAY="",PAY=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",122,0)
 .S PAY=$S(PAY="PER ANNUM":"ANNUAL",PAY="PER HOUR":"HOURLY","PER DIEM":"DAILY","BIWEEKLY":"BI-WEEKLY",1:"")
"RTN","OOPSGUI1",123,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="167///^S X=PAY" D ^DIE
"RTN","OOPSGUI1",124,0)
 I $$GET1^DIQ(2260,IEN,63)="",($$GET1^DIQ(2260,IEN,2,"I")<3) D
"RTN","OOPSGUI1",125,0)
 .S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSGUI1",126,0)
 .I CAT=1 S PAYP=$$PAID^OOPSUTL1(IEN,20) I $G(PAYP)'="" S PAYP=$$PAYP^OOPSUTL1(PAYP)
"RTN","OOPSGUI1",127,0)
 .I CAT=2 S PAYP="VO"
"RTN","OOPSGUI1",128,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="63///^S X=PAYP" D ^DIE
"RTN","OOPSGUI1",129,0)
 I $$GET1^DIQ(2260,IEN,111)="" D
"RTN","OOPSGUI1",130,0)
 .S FLD=16,OCCD="",OCCD=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",131,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="111///^S X=OCCD" D ^DIE
"RTN","OOPSGUI1",132,0)
 Q
"RTN","OOPSGUI1",133,0)
VALEMP(RESULTS,INPUT) ; This broker call should be used if the Pay
"RTN","OOPSGUI1",134,0)
 ;                 Plan = "OT" (other) to determine if the claim
"RTN","OOPSGUI1",135,0)
 ;                 can be successfully submitted to DOL.  The PERSONNEL
"RTN","OOPSGUI1",136,0)
 ;                 STATUS is assumed to equal 1 (employee)
"RTN","OOPSGUI1",137,0)
 S IEN=$P($G(INPUT),U,2),FORM=$P($G(INPUT),U)
"RTN","OOPSGUI1",138,0)
 I '$G(IEN)!($G(FORM)="") S RESULTS="Invalid Input, cannot continue." Q
"RTN","OOPSGUI1",139,0)
 I $$VALEMP^OOPSUTL6 S RESULTS="Valid" Q
"RTN","OOPSGUI1",140,0)
 S RESULTS="Invalid data on claim"
"RTN","OOPSGUI1",141,0)
 Q
"RTN","OOPSGUI2")
0^4^B49363608
"RTN","OOPSGUI2",1,0)
OOPSGUI2 ;WIOFO/CVW-RPC routines ;9/19/01
"RTN","OOPSGUI2",2,0)
 ;;2.0;ASISTS;**2,4**;Jun 03, 2002
"RTN","OOPSGUI2",3,0)
 ;
"RTN","OOPSGUI2",4,0)
GET(RESULTS,INPUT) ; Get Case data from 2260
"RTN","OOPSGUI2",5,0)
 ;  Input:    INPUT - IEN^FORM where IEN = ASISTS IEN and 
"RTN","OOPSGUI2",6,0)
 ;                    FORM = Either "CA1","CA2" or "2162"
"RTN","OOPSGUI2",7,0)
 ; Output:  RESULTS - Array of data from 2260, each element in the
"RTN","OOPSGUI2",8,0)
 ;                    is based on the field number in 2260.
"RTN","OOPSGUI2",9,0)
 N NODE,PIECE,FNUM,IEN,VAR,FORM,FLDCNT,INVFLDS
"RTN","OOPSGUI2",10,0)
 ;Define fields that should never be returned
"RTN","OOPSGUI2",11,0)
 S INVFLDS="^19^20^21^22^23^24^25^122^224^"
"RTN","OOPSGUI2",12,0)
 S IEN=+$G(INPUT),FORM=$P($G(INPUT),U,2),FLDCNT=0
"RTN","OOPSGUI2",13,0)
 I '$G(IEN) Q
"RTN","OOPSGUI2",14,0)
 I '$D(^OOPS(2260,$G(IEN),0)) D  Q
"RTN","OOPSGUI2",15,0)
 . S (RESULTS,RESULTS(1))="-1^IEN:"_IEN_" not found in file 2260"
"RTN","OOPSGUI2",16,0)
 I "CA1^CA2^2162"'[FORM!(FORM="") D  Q
"RTN","OOPSGUI2",17,0)
 . S (RESULTS,RESULTS(1))="-2^FORM:"_FORM_" not valid, must be CA1,CA2, or 2162"
"RTN","OOPSGUI2",18,0)
 S NODE="" F  S NODE=$O(^DD(2260,"GL",NODE)) Q:NODE=""  D
"RTN","OOPSGUI2",19,0)
 .S PIECE=0 F  S PIECE=$O(^DD(2260,"GL",NODE,PIECE)) Q:PIECE=""  D
"RTN","OOPSGUI2",20,0)
 ..S FNUM=0 F  S FNUM=$O(^DD(2260,"GL",NODE,PIECE,FNUM)) Q:FNUM=""  D
"RTN","OOPSGUI2",21,0)
 ...I INVFLDS[("^"_FNUM_"^") Q
"RTN","OOPSGUI2",22,0)
 ...I ($E(NODE,1,$L(FORM))'=FORM),(NODE'=0),(NODE'="CA"),(NODE'["WC") Q
"RTN","OOPSGUI2",23,0)
 ...S RESULTS(FNUM)=$$GET1^DIQ(2260,IEN,FNUM)
"RTN","OOPSGUI2",24,0)
 ...I FNUM=13 S RESULTS(FNUM)=RESULTS(FNUM)_" = "_$$GET1^DIQ(2260,IEN,FNUM_":99")
"RTN","OOPSGUI2",25,0)
 ...I FNUM=53!(FNUM=53.1) S RESULTS(FNUM)=RESULTS(FNUM)_"^"_$$GET1^DIQ(2260,IEN,FNUM,"I")
"RTN","OOPSGUI2",26,0)
 ...I FNUM=76!(FNUM=79) S RESULTS(FNUM)=$$GET1^DIQ(2260,IEN,FNUM,"I")
"RTN","OOPSGUI2",27,0)
 ...S FLDCNT=FLDCNT+1
"RTN","OOPSGUI2",28,0)
 Q
"RTN","OOPSGUI2",29,0)
WITR(RESULTS,IEN)     ;Return entries from the witness multiple
"RTN","OOPSGUI2",30,0)
 ;  Input:     IEN - The ASISTS IEN used to pull info from file 2260.
"RTN","OOPSGUI2",31,0)
 ; Output: RESULTS - array with Witness data and associated comment
"RTN","OOPSGUI2",32,0)
 ;
"RTN","OOPSGUI2",33,0)
 N SUBN,COUNT,STATE,WDT
"RTN","OOPSGUI2",34,0)
 S (SUBN,COUNT)=0,(STATE,WDT)=""
"RTN","OOPSGUI2",35,0)
 F  S SUBN=$O(^OOPS(2260,IEN,"CA1W",SUBN)) Q:'SUBN  D
"RTN","OOPSGUI2",36,0)
 . S RESULTS(COUNT)=$G(^OOPS(2260,IEN,"CA1W",SUBN,0))
"RTN","OOPSGUI2",37,0)
 . S STATE=$$EXTERNAL^DILFD(2260.0125,3,"",$P(RESULTS(COUNT),U,4))
"RTN","OOPSGUI2",38,0)
 . S WDT=$$EXTERNAL^DILFD(2260.0125,5,"",$P(RESULTS(COUNT),U,6))
"RTN","OOPSGUI2",39,0)
 . S $P(RESULTS(COUNT),U,4)=STATE,$P(RESULTS(COUNT),U,6)=WDT
"RTN","OOPSGUI2",40,0)
 . S $P(RESULTS(COUNT),U,7)=SUBN
"RTN","OOPSGUI2",41,0)
 . S COUNT=COUNT+1
"RTN","OOPSGUI2",42,0)
 . S RESULTS(COUNT)=$G(^OOPS(2260,IEN,"CA1W",SUBN,1))
"RTN","OOPSGUI2",43,0)
 . S COUNT=COUNT+1
"RTN","OOPSGUI2",44,0)
 Q
"RTN","OOPSGUI2",45,0)
DEFMD(RESULTS,IEN)      ;
"RTN","OOPSGUI2",46,0)
 ;Send in the Case IEN, return an array of 
"RTN","OOPSGUI2",47,0)
 ;(0)="1^Valid Results" or "0^No Valid Results"
"RTN","OOPSGUI2",48,0)
 ;(1)=PROVIDER NAME
"RTN","OOPSGUI2",49,0)
 ;(2)=PROVIDER ADDRESS
"RTN","OOPSGUI2",50,0)
 ;(3)=PROVIDER CITY
"RTN","OOPSGUI2",51,0)
 ;(4)=PROVIDER STATE
"RTN","OOPSGUI2",52,0)
 ;(5)=PROVIDER ZIP CODE
"RTN","OOPSGUI2",53,0)
 ;(6)=PROVIDER TITLE
"RTN","OOPSGUI2",54,0)
 N STA,PSTA,PIEN
"RTN","OOPSGUI2",55,0)
 S (STA,PSTA,PIEN)=""
"RTN","OOPSGUI2",56,0)
 S RESULTS(0)="0^No Valid Results"
"RTN","OOPSGUI2",57,0)
 Q:+IEN'>0
"RTN","OOPSGUI2",58,0)
 S STA=$P($G(^OOPS(2260,IEN,"2162A")),U,9)
"RTN","OOPSGUI2",59,0)
 Q:+STA'>0
"RTN","OOPSGUI2",60,0)
 S PIEN=$O(^OOPS(2262,1,1,"B",STA,PIEN))
"RTN","OOPSGUI2",61,0)
 Q:+PIEN'>0
"RTN","OOPSGUI2",62,0)
 I $P($G(^OOPS(2262,1,1,PIEN,0)),U,2)'="" D
"RTN","OOPSGUI2",63,0)
 .S RESULTS(0)="1^Valid Results"
"RTN","OOPSGUI2",64,0)
 .S RESULTS(1)=$P($G(^OOPS(2262,1,1,PIEN,0)),U,2)
"RTN","OOPSGUI2",65,0)
 .S RESULTS(2)=$P($G(^OOPS(2262,1,1,PIEN,0)),U,3)
"RTN","OOPSGUI2",66,0)
 .S RESULTS(3)=$P($G(^OOPS(2262,1,1,PIEN,0)),U,4)
"RTN","OOPSGUI2",67,0)
 .S PSTA=$$FIND1^DIC(2262.03,",1,","Q",STA)
"RTN","OOPSGUI2",68,0)
 .I PSTA S PSTA=PSTA_",1," S RESULTS(4)=$$GET1^DIQ(2262.03,PSTA,"4:.01")
"RTN","OOPSGUI2",69,0)
 .S RESULTS(5)=$P($G(^OOPS(2262,1,1,PIEN,0)),U,6)
"RTN","OOPSGUI2",70,0)
 .S RESULTS(6)=$P($G(^OOPS(2262,1,1,PIEN,0)),U,7)
"RTN","OOPSGUI2",71,0)
 .S RESULTS(6)=$$EXTERNAL^DILFD(2262.03,6,"",RESULTS(6))
"RTN","OOPSGUI2",72,0)
 Q
"RTN","OOPSGUI2",73,0)
REPLWP(RESULTS,INPUT,DATA) ;
"RTN","OOPSGUI2",74,0)
 ;Replace Word Processing Fields
"RTN","OOPSGUI2",75,0)
 ;  Input:   INPUT - The file, field and IEN of record to WP field to
"RTN","OOPSGUI2",76,0)
 ;                   be changed in the format FILE^FIELD^IEN
"RTN","OOPSGUI2",77,0)
 ;  Input     DATA - List or pointer for data that is to replace the
"RTN","OOPSGUI2",78,0)
 ;                   existing WP data. 
"RTN","OOPSGUI2",79,0)
 ; Output: RESULTS - array with results or messages.
"RTN","OOPSGUI2",80,0)
 ; Retrieve file and field information.
"RTN","OOPSGUI2",81,0)
 N FILE,FIELD,IEN,ROOT,NODE,LINE,CNT,NEWTXT
"RTN","OOPSGUI2",82,0)
 S FILE=$P($G(INPUT),U),FIELD=$P($G(INPUT),U,2),IEN=$P($G(INPUT),U,3)
"RTN","OOPSGUI2",83,0)
 S ROOT=$$ROOT^DILFD(FILE,0,"GL")
"RTN","OOPSGUI2",84,0)
 S NODE=$$GET1^DID(FILE,FIELD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","OOPSGUI2",85,0)
 S NODE=$P(NODE,";",1)
"RTN","OOPSGUI2",86,0)
 ; Kill the existing WP data/node
"RTN","OOPSGUI2",87,0)
 K @(ROOT_"IEN,NODE)")
"RTN","OOPSGUI2",88,0)
 ; Insert the new data
"RTN","OOPSGUI2",89,0)
 S (LINE,CNT)=0
"RTN","OOPSGUI2",90,0)
 K NEWTXT
"RTN","OOPSGUI2",91,0)
 F  D  Q:+LINE'>0
"RTN","OOPSGUI2",92,0)
 .S LINE=$O(DATA(LINE)) Q:+LINE'>0  S CNT=LINE
"RTN","OOPSGUI2",93,0)
 .S NEWTXT=$G(DATA(LINE))
"RTN","OOPSGUI2",94,0)
 .S @(ROOT_"IEN,NODE,LINE,0)")=NEWTXT
"RTN","OOPSGUI2",95,0)
 S @(ROOT_"IEN,NODE,0)")="^^"_CNT_"^"_CNT_"^"_DT_"^^"
"RTN","OOPSGUI2",96,0)
 Q
"RTN","OOPSGUI2",97,0)
DTVALID(RESULTS,IDT,PDT,FLAG) ;Compare Date(s)/Time(s)
"RTN","OOPSGUI2",98,0)
 ;  Input IDT - This is the base date/time in external form
"RTN","OOPSGUI2",99,0)
 ;        PDT - This is the compare date/time in external form
"RTN","OOPSGUI2",100,0)
 ;       FLAG - -2 means PDT must be <  IDT (The DAY only)
"RTN","OOPSGUI2",101,0)
 ;       FLAG - -1 means PDT must be <  IDT (The DAY&TIME)
"RTN","OOPSGUI2",102,0)
 ;       FLAG -  1 means PDT must be >  IDT (The DAY&TIME)
"RTN","OOPSGUI2",103,0)
 ;       FLAG -  2 means PDT must be > IDT (The DAY only)
"RTN","OOPSGUI2",104,0)
 ;Output RESULTS - "VALID DATE" for valid, "DATE ERROR" for invalid
"RTN","OOPSGUI2",105,0)
 S FLAG=+$G(FLAG)
"RTN","OOPSGUI2",106,0)
 I FLAG="" S RESULTS(0)="FLAG ERROR" Q
"RTN","OOPSGUI2",107,0)
 I IDT="" S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",108,0)
 I PDT="" S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",109,0)
 S IDT=$$DTI^OOPSGUI2(IDT)
"RTN","OOPSGUI2",110,0)
 S PDT=$$DTI^OOPSGUI2(PDT)
"RTN","OOPSGUI2",111,0)
 I FLAG=-2 D
"RTN","OOPSGUI2",112,0)
 .S IDT=$P(IDT,"."),PDT=$P(PDT,".")
"RTN","OOPSGUI2",113,0)
 .I (PDT<IDT)!(PDT=IDT) S RESULTS(0)="VALID DATE" Q
"RTN","OOPSGUI2",114,0)
 .I PDT>IDT S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",115,0)
 I FLAG=-1 D
"RTN","OOPSGUI2",116,0)
 .I PDT<IDT S RESULTS(0)="VALID DATE" Q
"RTN","OOPSGUI2",117,0)
 .I (PDT>IDT)!(PDT=IDT) S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",118,0)
 I FLAG=0 D
"RTN","OOPSGUI2",119,0)
 .I PDT=IDT S RESULTS(0)="VALID DATE" Q
"RTN","OOPSGUI2",120,0)
 .I (PDT<IDT)!(PDT>IDT) S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",121,0)
 I FLAG=1 D
"RTN","OOPSGUI2",122,0)
 .I PDT>IDT S RESULTS(0)="VALID DATE" Q
"RTN","OOPSGUI2",123,0)
 .I (PDT<IDT)!(PDT=IDT) S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",124,0)
 I FLAG=2 D
"RTN","OOPSGUI2",125,0)
 .S IDT=$P(IDT,"."),PDT=$P(PDT,".")
"RTN","OOPSGUI2",126,0)
 .I (PDT>IDT)!(PDT=IDT) S RESULTS(0)="VALID DATE" Q
"RTN","OOPSGUI2",127,0)
 .I PDT<IDT S RESULTS(0)="DATE ERROR" Q
"RTN","OOPSGUI2",128,0)
 Q
"RTN","OOPSGUI2",129,0)
DTI(X) ;Convert and External date to an internal one
"RTN","OOPSGUI2",130,0)
 N Y,%DT
"RTN","OOPSGUI2",131,0)
 S %DT="T" D ^%DT
"RTN","OOPSGUI2",132,0)
 Q Y
"RTN","OOPSGUI2",133,0)
SETFIELD(RESULTS,INPUT,VALUE) ;Set a single field in file 2260
"RTN","OOPSGUI2",134,0)
 ;Input  - INPUT Contains the IEN of the record and the field number to
"RTN","OOPSGUI2",135,0)
 ;               be modified in the format IEN^FIELD
"RTN","OOPSGUI2",136,0)
 ;         VALUE This required parm is the external value to be used.
"RTN","OOPSGUI2",137,0)
 ;Output - RESULTS - status message of the file/set. 
"RTN","OOPSGUI2",138,0)
 N DA,DIE,DR,IEN,FLDNUM
"RTN","OOPSGUI2",139,0)
 S DR=""
"RTN","OOPSGUI2",140,0)
 S RESULTS(0)="UPDATE FAILED"
"RTN","OOPSGUI2",141,0)
 S IEN=$P($G(INPUT),U)
"RTN","OOPSGUI2",142,0)
 I '$G(IEN) Q
"RTN","OOPSGUI2",143,0)
 S FLDNUM=$P($G(INPUT),U,2)
"RTN","OOPSGUI2",144,0)
 I '$D(^OOPS(2260,IEN,0))!(FLDNUM="") Q
"RTN","OOPSGUI2",145,0)
 S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI2",146,0)
 S DR(1,2260,1)=FLDNUM_"///^S X=VALUE"
"RTN","OOPSGUI2",147,0)
 D ^DIE
"RTN","OOPSGUI2",148,0)
 I $G(Y)="" D
"RTN","OOPSGUI2",149,0)
 . S RESULTS(0)="UPDATE COMPLETE"
"RTN","OOPSGUI2",150,0)
 . ; if setting field 71, need to send bulletin
"RTN","OOPSGUI2",151,0)
 . I FLDNUM=71,($$GET1^DIQ(2260,IEN,71,"I")'="Y") D WCPBOR^OOPSMBUL(IEN)
"RTN","OOPSGUI2",152,0)
 . ; 01/02/04 Patch 4 llh - if case closed, sent bulletin
"RTN","OOPSGUI2",153,0)
 . I FLDNUM=51,(VALUE="Closed") D CLSCASE^OOPSMBUL(IEN)
"RTN","OOPSGUI2",154,0)
 Q 
"RTN","OOPSGUI2",155,0)
ADDWITN(RESULTS,IEN,INFO,COMMENT) ;Add Witness info for IEN in 2260
"RTN","OOPSGUI2",156,0)
 ;  Input - IEN - IEN of case that needs witness info created. 
"RTN","OOPSGUI2",157,0)
 ;         INFO - Name, Street, City, State, Zip, Date of Witness in
"RTN","OOPSGUI2",158,0)
 ;                format, NAME^STREET^CITY^STATE^ZIP
"RTN","OOPSGUI2",159,0)
 ;      COMMENT - Witness Comment Text
"RTN","OOPSGUI2",160,0)
 ; Output - RESULTS Text indicating status of insert
"RTN","OOPSGUI2",161,0)
 N DR,DIE,DA,DIC,DD,DO,DLAYGO,INPUT,NAME,STREET,CITY,STATE,ZIP,WITDATE
"RTN","OOPSGUI2",162,0)
 S RESULTS(0)="WITNESS CREATION FAILED"
"RTN","OOPSGUI2",163,0)
 I '$G(IEN) Q
"RTN","OOPSGUI2",164,0)
 I '$D(^OOPS(2260,IEN,0)) Q
"RTN","OOPSGUI2",165,0)
 S DA(1)=IEN
"RTN","OOPSGUI2",166,0)
 S DLAYGO=2260,DIC="^OOPS(2260,"_DA(1)_",""CA1W"","
"RTN","OOPSGUI2",167,0)
 S DIC(0)="L"
"RTN","OOPSGUI2",168,0)
 S X=$P(INFO,U)
"RTN","OOPSGUI2",169,0)
 D FILE^DICN
"RTN","OOPSGUI2",170,0)
 S DA=+Y
"RTN","OOPSGUI2",171,0)
 S DIE="^OOPS(2260,"_DA(1)_",""CA1W"",",DR=""
"RTN","OOPSGUI2",172,0)
 I DA=-1 Q
"RTN","OOPSGUI2",173,0)
 S NAME=$P($G(INFO),U)
"RTN","OOPSGUI2",174,0)
 S STREET=$P($G(INFO),U,2)
"RTN","OOPSGUI2",175,0)
 S CITY=$P($G(INFO),U,3)
"RTN","OOPSGUI2",176,0)
 S STATE=$P($G(INFO),U,4)
"RTN","OOPSGUI2",177,0)
 S ZIP=$P($G(INFO),U,5)
"RTN","OOPSGUI2",178,0)
 S WITDATE=$P($G(INFO),U,6)
"RTN","OOPSGUI2",179,0)
 S DR(1,2260.0125,1)=".01///^S X=NAME"
"RTN","OOPSGUI2",180,0)
 S DR(1,2260.0125,2)="1///^S X=STREET"
"RTN","OOPSGUI2",181,0)
 S DR(1,2260.0125,3)="2///^S X=CITY"
"RTN","OOPSGUI2",182,0)
 S DR(1,2260.0125,4)="3///^S X=STATE"
"RTN","OOPSGUI2",183,0)
 S DR(1,2260.0125,5)="4///^S X=ZIP"
"RTN","OOPSGUI2",184,0)
 S DR(1,2260.0125,6)="5///^S X=WITDATE"
"RTN","OOPSGUI2",185,0)
 D ^DIE
"RTN","OOPSGUI2",186,0)
 S DR="6///^S X=COMMENT"
"RTN","OOPSGUI2",187,0)
 D ^DIE
"RTN","OOPSGUI2",188,0)
 S RESULTS(0)="WITNESS CREATION SUCCESSFUL"
"RTN","OOPSGUI2",189,0)
 Q
"RTN","OOPSGUI2",190,0)
DELWITN(RESULTS,INPUT) ;Deletes the Witness information for a claim
"RTN","OOPSGUI2",191,0)
 ;  Input - INPUT, this is the IEN for the case and the witness number 
"RTN","OOPSGUI2",192,0)
 ;          format IEN^witness number for the selected witness
"RTN","OOPSGUI2",193,0)
 ; Output - RESULTS - String indicating the status of the delete
"RTN","OOPSGUI2",194,0)
 N DA,DIK,IEN,WITNO
"RTN","OOPSGUI2",195,0)
 S RESULTS(0)="DELETION FAILED"
"RTN","OOPSGUI2",196,0)
 I INPUT="" Q
"RTN","OOPSGUI2",197,0)
 S IEN=$P($G(INPUT),U)
"RTN","OOPSGUI2",198,0)
 I '$G(IEN) Q
"RTN","OOPSGUI2",199,0)
 S WITNO=$P($G(INPUT),U,2)
"RTN","OOPSGUI2",200,0)
 I '$G(WITNO) Q
"RTN","OOPSGUI2",201,0)
 I '$D(^OOPS(2260,IEN,"CA1W",WITNO,0)) Q
"RTN","OOPSGUI2",202,0)
 S DA(1)=IEN
"RTN","OOPSGUI2",203,0)
 S DA=WITNO
"RTN","OOPSGUI2",204,0)
 S DIK="^OOPS(2260,"_DA(1)_",""CA1W"","
"RTN","OOPSGUI2",205,0)
 D ^DIK
"RTN","OOPSGUI2",206,0)
 I $G(Y)'="" D  Q 
"RTN","OOPSGUI2",207,0)
 .S RESULTS(0)="SUCCESSFULLY DELETED"
"RTN","OOPSGUI2",208,0)
 Q
"RTN","OOPSGUI2",209,0)
EDTWITN(RESULTS,INPUT,INFO,COMMENT) ;Update Witness Info for 2260 rec
"RTN","OOPSGUI2",210,0)
 ;  Input:INPUT - IEN and Witness Number in format IEN^WIT
"RTN","OOPSGUI2",211,0)
 ;        INFO  - Name, Street, City, State, Zip, Date of Witness in 
"RTN","OOPSGUI2",212,0)
 ;                format, NAME^STREET^CITY^STATE^ZIP
"RTN","OOPSGUI2",213,0)
 ;        COMMENT - Text of Witness comment
"RTN","OOPSGUI2",214,0)
 ; Output:RESULTS - String listing result of update. 
"RTN","OOPSGUI2",215,0)
 N DA,DIE,DR,NAME,STREET,CITY,STATE,ZIP,WITDATE,IEN,WITNO
"RTN","OOPSGUI2",216,0)
 S RESULTS(0)="EDIT FAILED"
"RTN","OOPSGUI2",217,0)
 S IEN=$P($G(INPUT),U)
"RTN","OOPSGUI2",218,0)
 S WITNO=$P($G(INPUT),U,2)
"RTN","OOPSGUI2",219,0)
 I '$D(^OOPS(2260,IEN,"CA1W",WITNO,0)) Q
"RTN","OOPSGUI2",220,0)
 S DA(1)=IEN,DR=""
"RTN","OOPSGUI2",221,0)
 S DA=WITNO
"RTN","OOPSGUI2",222,0)
 S DIE="^OOPS(2260,"_DA(1)_",""CA1W"","
"RTN","OOPSGUI2",223,0)
 S NAME=$P($G(INFO),U)
"RTN","OOPSGUI2",224,0)
 S STREET=$P($G(INFO),U,2)
"RTN","OOPSGUI2",225,0)
 S CITY=$P($G(INFO),U,3)
"RTN","OOPSGUI2",226,0)
 S STATE=$P($G(INFO),U,4)
"RTN","OOPSGUI2",227,0)
 S ZIP=$P($G(INFO),U,5)
"RTN","OOPSGUI2",228,0)
 S WITDATE=$P($G(INFO),U,6)
"RTN","OOPSGUI2",229,0)
 S DR(1,2260.0125,1)=".01///^S X=NAME"
"RTN","OOPSGUI2",230,0)
 S DR(1,2260.0125,2)="1///^S X=STREET"
"RTN","OOPSGUI2",231,0)
 S DR(1,2260.0125,3)="2///^S X=CITY"
"RTN","OOPSGUI2",232,0)
 S DR(1,2260.0125,4)="3///^S X=STATE"
"RTN","OOPSGUI2",233,0)
 S DR(1,2260.0125,5)="4///^S X=ZIP"
"RTN","OOPSGUI2",234,0)
 S DR(1,2260.0125,6)="5///^S X=WITDATE"
"RTN","OOPSGUI2",235,0)
 D ^DIE
"RTN","OOPSGUI2",236,0)
 S DR="6///^S X=COMMENT"
"RTN","OOPSGUI2",237,0)
 D ^DIE
"RTN","OOPSGUI2",238,0)
 S RESULTS(0)="EDIT SUCCESSFULL"
"RTN","OOPSGUI2",239,0)
 Q
"RTN","OOPSGUI4")
0^5^B50207365
"RTN","OOPSGUI4",1,0)
OOPSGUI4 ;WIOFO/LLH-RPC BROKER CALLS ;10/02/01
"RTN","OOPSGUI4",2,0)
 ;;2.0;ASISTS;**4**;Jun 03, 2002
"RTN","OOPSGUI4",3,0)
 ;
"RTN","OOPSGUI4",4,0)
PAID(RESULTS,NAME) ; retrieves PAID employee and data from file 450
"RTN","OOPSGUI4",5,0)
 ;  Input:    NAME - the Employee Name or partial name Passed in
"RTN","OOPSGUI4",6,0)
 ; Output: RESULTS - array containing PAID fields in the order returned
"RTN","OOPSGUI4",7,0)
 ;                   from FIND^DIC
"RTN","OOPSGUI4",8,0)
 ;
"RTN","OOPSGUI4",9,0)
 N IEN200,LP,PAY,PAYP,PHONE,OCCDESC,RET,SAL,SSN,X,STATE,SERV,SAMEFLG
"RTN","OOPSGUI4",10,0)
 N IEN450
"RTN","OOPSGUI4",11,0)
 I NAME="" S RESULTS(1)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",12,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",13,0)
 D FIND^DIC(450,,"@;.01;6;8;10;13;16EI;31;32;38;186.1;186.2;186;186.4;458I","MPS",X,500)
"RTN","OOPSGUI4",14,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",15,0)
 I $P(^TMP("DILIST",$J,0),U)=0 S RESULTS(0)="^NO PAID EMPLOYEE FOUND" Q
"RTN","OOPSGUI4",16,0)
 F LP=0:0 S LP=$O(^TMP("DILIST",$J,LP)) Q:LP=""  D
"RTN","OOPSGUI4",17,0)
 .; cannot pick yourself if selecting case,use SSN to see if DUZ matches
"RTN","OOPSGUI4",18,0)
 .S SSN=$TR($P($G(^TMP("DILIST",$J,LP,0)),U,4),"-","")
"RTN","OOPSGUI4",19,0)
 .I $G(SSN) S IEN200=$O(^VA(200,"SSN",SSN,""))
"RTN","OOPSGUI4",20,0)
 .; 12/29/03 llh - also cannot pick a person from the PAID file with
"RTN","OOPSGUI4",21,0)
 .;                a pseudo SSN (one that begins with 000)
"RTN","OOPSGUI4",22,0)
 .I $E(SSN,1,3)="000" Q
"RTN","OOPSGUI4",23,0)
 .I DUZ=IEN200 S SAMEFLG=1 Q
"RTN","OOPSGUI4",24,0)
 .S RESULTS(LP)=^TMP("DILIST",$J,LP,0)
"RTN","OOPSGUI4",25,0)
 .S $P(RESULTS(LP),U,5)=$E($P(RESULTS(LP),U,5),1,45)
"RTN","OOPSGUI4",26,0)
 .S $P(RESULTS(LP),U,8)=$E($P($G(RESULTS(LP)),U,8),1,4)
"RTN","OOPSGUI4",27,0)
 .S PHONE=""  ; ,SSN=$TR($P($G(RESULTS(LP)),U,4),"-","")
"RTN","OOPSGUI4",28,0)
 .I $G(IEN200) S PHONE=$P($G(^VA(200,IEN200,.13)),U)
"RTN","OOPSGUI4",29,0)
 .I $TR(PHONE,"(,)-^*/# &%@!","")'?10N S PHONE=""  ;Must be 10 char
"RTN","OOPSGUI4",30,0)
 .S RESULTS(LP)=RESULTS(LP)_U_PHONE
"RTN","OOPSGUI4",31,0)
 .S IEN450=$P(RESULTS(LP),U)
"RTN","OOPSGUI4",32,0)
 .I $G(IEN450) D
"RTN","OOPSGUI4",33,0)
 ..S PAYP=$$GET1^DIQ(450,IEN450,20) I $G(PAYP)'="" S PAYP=$$PAYP^OOPSUTL1(PAYP)
"RTN","OOPSGUI4",34,0)
 ..S SAL=$$GET1^DIQ(450,IEN450,28)
"RTN","OOPSGUI4",35,0)
 ..S RET=$$GET1^DIQ(450,IEN450,26) I $G(RET)'="" S RET=$S(RET="FULL CSRS":"CSRS",RET="FERS":"FERS",1:"OTHER")
"RTN","OOPSGUI4",36,0)
 ..S PAY=$$GET1^DIQ(450,IEN450,19) I $G(PAY)'="" S PAY=$S(PAY="PER ANNUM":"ANNUAL",PAY="PER HOUR":"HOURLY","PER DIEM":"DAILY","BIWEEKLY":"BI-WEEKLY",1:"")
"RTN","OOPSGUI4",37,0)
 ..S OCCDESC=$E($$GET1^DIQ(450,IEN450,16),1,30)
"RTN","OOPSGUI4",38,0)
 .S SERV="" I $G(IEN200) S SERV=$$GET1^DIQ(200,IEN200,29)
"RTN","OOPSGUI4",39,0)
 .S RESULTS(LP)=RESULTS(LP)_U_PAY_U_SAL_U_RET_U_PAYP_U_OCCDESC_U_SERV
"RTN","OOPSGUI4",40,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",41,0)
 KILL DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",42,0)
 Q
"RTN","OOPSGUI4",43,0)
 ;
"RTN","OOPSGUI4",44,0)
ASISTS(RESULTS,NAME) ; Lookup on ASISTS Accident Reporting file_2260
"RTN","OOPSGUI4",45,0)
 ;  Input:  - Name or partial name of person to lookup on
"RTN","OOPSGUI4",46,0)
 ; Output:  - array with name of person, sex, DOB, and SSN
"RTN","OOPSGUI4",47,0)
 ;
"RTN","OOPSGUI4",48,0)
 N ARR,I,X,SAMEFLG
"RTN","OOPSGUI4",49,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",50,0)
 I NAME="" S RESULTS(0)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",51,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",52,0)
 D FIND^DIC(2260,,"@;1;7;6;5","PSMC",X,500)
"RTN","OOPSGUI4",53,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",54,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO ASISTS CASE FOUND" Q
"RTN","OOPSGUI4",55,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",56,0)
 . I DUZ=$P(^TMP("DILIST",$J,I,0),U) S SAMEFLG=1 Q
"RTN","OOPSGUI4",57,0)
 . I $D(ARR($P(^TMP("DILIST",$J,I,0),U,2))) Q
"RTN","OOPSGUI4",58,0)
 . S ARR($P(^TMP("DILIST",$J,I,0),U,2))=""
"RTN","OOPSGUI4",59,0)
 . S RESULTS(I)=^TMP("DILIST",$J,I,0)
"RTN","OOPSGUI4",60,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",61,0)
 I '$D(RESULTS) S RESULTS(0)="^NO SELECTABLE CASES FOUND"
"RTN","OOPSGUI4",62,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",63,0)
 Q
"RTN","OOPSGUI4",64,0)
PER(RESULTS,NAME) ; Lookup for Non-Paid Employee (New Person file_
"RTN","OOPSGUI4",65,0)
 ;  Input:  - Name or partial name of person to lookup on
"RTN","OOPSGUI4",66,0)
 ; Output:  - array with name of new person, sex, DOB, and SSN
"RTN","OOPSGUI4",67,0)
 ;
"RTN","OOPSGUI4",68,0)
 N I,SSN,X,SAMEFLG
"RTN","OOPSGUI4",69,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",70,0)
 I NAME="" S RESULTS(0)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",71,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",72,0)
 D FIND^DIC(200,,"@;.01;4;5;9;29","PSMC",X,500)
"RTN","OOPSGUI4",73,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",74,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO NEW PERSON FOUND" Q
"RTN","OOPSGUI4",75,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",76,0)
 . ; make sure not a PAID Employee
"RTN","OOPSGUI4",77,0)
 . S SSN=$P(^TMP("DILIST",$J,I,0),U,5)
"RTN","OOPSGUI4",78,0)
 . I $G(SSN),$$FIND1^DIC(450,"","MX",SSN) Q
"RTN","OOPSGUI4",79,0)
 . I DUZ=$P(^TMP("DILIST",$J,I,0),U) S SAMEFLG=1 Q
"RTN","OOPSGUI4",80,0)
 . S RESULTS(I)=^TMP("DILIST",$J,I,0)
"RTN","OOPSGUI4",81,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",82,0)
 I '$D(RESULTS) S RESULTS(0)="^NO SELECTABLE CASES FOUND"
"RTN","OOPSGUI4",83,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",84,0)
 Q
"RTN","OOPSGUI4",85,0)
SUPER(RESULTS,NAME,EMPSSN) ; Lookup for Supervisors or anyone from the New 
"RTN","OOPSGUI4",86,0)
 ;                 Person file.  This broker call will also be used to
"RTN","OOPSGUI4",87,0)
 ;                 lookup Union representatives for the Enter/Edit
"RTN","OOPSGUI4",88,0)
 ;                 Union Information.
"RTN","OOPSGUI4",89,0)
 ;  Input:    NAME - Name or partial name of person to lookup on
"RTN","OOPSGUI4",90,0)
 ;             SSN - SSN of the Person Involved if called from 2162
"RTN","OOPSGUI4",91,0)
 ; Output: RESULTS - array with name of new person, sex, DOB, and SSN
"RTN","OOPSGUI4",92,0)
 ;
"RTN","OOPSGUI4",93,0)
 N I,SSN,SAME,X
"RTN","OOPSGUI4",94,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",95,0)
 I NAME="" S RESULTS(1)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",96,0)
 S X=NAME,SAME=0
"RTN","OOPSGUI4",97,0)
 D FIND^DIC(200,,".01;9","PSCM",X,500)
"RTN","OOPSGUI4",98,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",99,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO NEW PERSON FOUND" Q
"RTN","OOPSGUI4",100,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",101,0)
 . I $G(EMPSSN)'="",($P(^TMP("DILIST",$J,I,0),U,3)=$G(EMPSSN)) S SAME=1 Q
"RTN","OOPSGUI4",102,0)
 . S RESULTS(I)=^TMP("DILIST",$J,I,0)
"RTN","OOPSGUI4",103,0)
 I SAME,'$D(RESULTS) S RESULTS(1)="^CANNOT BE SUPERVISOR FOR YOUR CLAIM"
"RTN","OOPSGUI4",104,0)
 I '$D(RESULTS) S RESULTS(1)="^NO VALID SELECTION"
"RTN","OOPSGUI4",105,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",106,0)
 Q
"RTN","OOPSGUI4",107,0)
 ;
"RTN","OOPSGUI4",108,0)
LOAD(RESULTS,ARR) ; Create new OOPS record
"RTN","OOPSGUI4",109,0)
 ;  Input:     ARR  - contains data entered from the Create Acccident/
"RTN","OOPSGUI4",110,0)
 ;                    Illness Report Option
"RTN","OOPSGUI4",111,0)
 ; Output:  RESULTS - status message
"RTN","OOPSGUI4",112,0)
 ;
"RTN","OOPSGUI4",113,0)
 N ASUB,CAT,DA,DATE,DIC,DR,ERROR,FLDS,FNUM,FYEAR,IEN2260,LP,NUM,PCE,SSN,X
"RTN","OOPSGUI4",114,0)
 N LIST,CNT,DLAYGO
"RTN","OOPSGUI4",115,0)
 S CAT=""
"RTN","OOPSGUI4",116,0)
 I $G(ARR(2)) S CAT=ARR(2)
"RTN","OOPSGUI4",117,0)
 I $G(ARR(5)) S SSN=ARR(5)
"RTN","OOPSGUI4",118,0)
 D NOW^%DTC
"RTN","OOPSGUI4",119,0)
 S DATE=X
"RTN","OOPSGUI4",120,0)
 S FYEAR=""
"RTN","OOPSGUI4",121,0)
 S FYEAR=$$FYEAR^OOPSCSN(X)
"RTN","OOPSGUI4",122,0)
 S NUM=$$NEWR^OOPSCSN(FYEAR)
"RTN","OOPSGUI4",123,0)
 K DD,DO
"RTN","OOPSGUI4",124,0)
 S DLAYGO=2260,DIC="^OOPS(2260,"
"RTN","OOPSGUI4",125,0)
 S DIC(0)="QLZ"
"RTN","OOPSGUI4",126,0)
 S X=NUM
"RTN","OOPSGUI4",127,0)
 D FILE^DICN
"RTN","OOPSGUI4",128,0)
 I Y<0 S (RESULTS,RESULTS(0))="UNABLE TO CREATE RECORD" Q
"RTN","OOPSGUI4",129,0)
 S IEN2260=+Y
"RTN","OOPSGUI4",130,0)
 S DIE="^OOPS(2260,"
"RTN","OOPSGUI4",131,0)
 S DA=IEN2260
"RTN","OOPSGUI4",132,0)
 ;
"RTN","OOPSGUI4",133,0)
 S LIST="1,2,3,4,5,6,7,8,9,10,11,12,14,15,16,17,18,52,60,63,86,90"
"RTN","OOPSGUI4",134,0)
 I ARR(52)="Injury" S LIST=LIST_",111,166,167"
"RTN","OOPSGUI4",135,0)
 I ARR(52)="Illness/Disease" S LIST=LIST_",208"
"RTN","OOPSGUI4",136,0)
 F CNT=1:1 S FNUM=$P(LIST,",",CNT) Q:FNUM=""  I $G(ARR(FNUM))'="" D VAL(DA,FNUM,ARR(FNUM))
"RTN","OOPSGUI4",137,0)
 K DR S DIE="^OOPS(2260,",DA=IEN2260,DR=""
"RTN","OOPSGUI4",138,0)
 S DR(1,2260,1)="1///^S X=ARR(1)"
"RTN","OOPSGUI4",139,0)
 S DR(1,2260,2)="2///^S X=ARR(2)"
"RTN","OOPSGUI4",140,0)
 S DR(1,2260,3)="3///^S X=ARR(3)"
"RTN","OOPSGUI4",141,0)
 S DR(1,2260,4)="4///^S X=ARR(4)"
"RTN","OOPSGUI4",142,0)
 S DR(1,2260,5)="5///^S X=ARR(5)"
"RTN","OOPSGUI4",143,0)
 S DR(1,2260,6)="6///^S X=ARR(6)"
"RTN","OOPSGUI4",144,0)
 S DR(1,2260,7)="7///^S X=ARR(7)"
"RTN","OOPSGUI4",145,0)
 S DR(1,2260,8)="8///^S X=ARR(8)"
"RTN","OOPSGUI4",146,0)
 S DR(1,2260,9)="9///^S X=ARR(9)"
"RTN","OOPSGUI4",147,0)
 S DR(1,2260,10)="10///^S X=ARR(10)"
"RTN","OOPSGUI4",148,0)
 S DR(1,2260,12)="11///^S X=ARR(11)"
"RTN","OOPSGUI4",149,0)
 S DR(1,2260,15)="12///^S X=ARR(12)"
"RTN","OOPSGUI4",150,0)
 S DR(1,2260,18)="13////^S X=ARR(13)"     ; sending pointer
"RTN","OOPSGUI4",151,0)
 S DR(1,2260,21)="14///^S X=ARR(14)"
"RTN","OOPSGUI4",152,0)
 S DR(1,2260,24)="15///^S X=ARR(15)"
"RTN","OOPSGUI4",153,0)
 S DR(1,2260,27)="16///^S X=ARR(16)"
"RTN","OOPSGUI4",154,0)
 S DR(1,2260,30)="17///^S X=ARR(17)"
"RTN","OOPSGUI4",155,0)
 S DR(1,2260,33)="18///^S X=ARR(18)"
"RTN","OOPSGUI4",156,0)
 S DR(1,2260,36)="52///^S X=ARR(52)"
"RTN","OOPSGUI4",157,0)
 S DR(1,2260,39)="53////^S X=ARR(53)"     ; send pointer
"RTN","OOPSGUI4",158,0)
 S DR(1,2260,42)="53.1////^S X=ARR(22)"   ; send pointer
"RTN","OOPSGUI4",159,0)
 S DR(1,2260,45)="56////^S X=ARR(48)"     ; send pointer
"RTN","OOPSGUI4",160,0)
 S DR(1,2260,48)="60///^S X=ARR(60)"
"RTN","OOPSGUI4",161,0)
 S DR(1,2260,51)="63///^S X=ARR(63)"
"RTN","OOPSGUI4",162,0)
 S DR(1,2260,54)="86///^S X=ARR(86)"
"RTN","OOPSGUI4",163,0)
 S DR(1,2260,57)="90///^S X=ARR(90)"
"RTN","OOPSGUI4",164,0)
 I ARR(52)="Injury" D
"RTN","OOPSGUI4",165,0)
 . S DR(1,2260,60)="111///^S X=ARR(19)"
"RTN","OOPSGUI4",166,0)
 . S DR(1,2260,63)="166///^S X=ARR(166)"
"RTN","OOPSGUI4",167,0)
 . S DR(1,2260,67)="167///^S X=ARR(167)"
"RTN","OOPSGUI4",168,0)
 I ARR(52)="Illness/Disease" D
"RTN","OOPSGUI4",169,0)
 . S DR(1,2260,60)="208///^S X=ARR(19)"
"RTN","OOPSGUI4",170,0)
 D ^DIE
"RTN","OOPSGUI4",171,0)
 D CASE^OOPSMBUL(IEN2260) D:(CAT=1)!(CAT=6) BOR^OOPSMBUL(IEN2260):$D(^VA(200,"SSN",SSN))
"RTN","OOPSGUI4",172,0)
 K DR S DIE="^OOPS(2260,",DA=IEN2260,DR="51///0" D ^DIE
"RTN","OOPSGUI4",173,0)
 K DIE,DR,DA
"RTN","OOPSGUI4",174,0)
 S (RESULTS,RESULTS(1))="OK" S:$G(ERROR)]"" (RESULTS,RESULTS(1))=ERROR
"RTN","OOPSGUI4",175,0)
 S RESULTS(2)=$P(^OOPS(2260,IEN2260,0),"^")
"RTN","OOPSGUI4",176,0)
 Q
"RTN","OOPSGUI4",177,0)
 ;
"RTN","OOPSGUI4",178,0)
DELETE ;Delete incomplete case
"RTN","OOPSGUI4",179,0)
 N DIK,DA
"RTN","OOPSGUI4",180,0)
 S DIK="^OOPS(2260,",DA=IEN2260
"RTN","OOPSGUI4",181,0)
 D ^DIK
"RTN","OOPSGUI4",182,0)
 Q
"RTN","OOPSGUI4",183,0)
 ;
"RTN","OOPSGUI4",184,0)
VAL(DA,FIELD,VALUE) ;Validate Input
"RTN","OOPSGUI4",185,0)
 ;  Input:   DA  - IEN of the ASISTS record
"RTN","OOPSGUI4",186,0)
 ;        FIELD  - field number for data to be validated
"RTN","OOPSGUI4",187,0)
 ;        VALUE  - data to be validated
"RTN","OOPSGUI4",188,0)
 ; Output:
"RTN","OOPSGUI4",189,0)
 ;        none
"RTN","OOPSGUI4",190,0)
 N X
"RTN","OOPSGUI4",191,0)
 D VAL^DIE(2260,DA,FIELD,"",VALUE,.X)
"RTN","OOPSGUI4",192,0)
 I X=U D
"RTN","OOPSGUI4",193,0)
 .S:$G(ERROR)]"" ERROR=ERROR_","
"RTN","OOPSGUI4",194,0)
 .S ERROR=$G(ERROR)_$$GET1^DID(2260,FIELD,"","LABEL")_U_VALUE
"RTN","OOPSGUI4",195,0)
 .; set the data to nil so filing will not bomb
"RTN","OOPSGUI4",196,0)
 .S ARR(FIELD)=""
"RTN","OOPSGUI4",197,0)
 Q
"RTN","OOPSGUI4",198,0)
DUP(RESULTS,SSN) ; Duplicate Case error checking broker call
"RTN","OOPSGUI4",199,0)
 ;  Input:    INPUT - SSN of current ASISTS case number
"RTN","OOPSGUI4",200,0)
 ; Output:  RESULTS - return array with case information
"RTN","OOPSGUI4",201,0)
 ;
"RTN","OOPSGUI4",202,0)
 N CN,DT,IEN,NM,TYPE
"RTN","OOPSGUI4",203,0)
 S IEN="",CN=0
"RTN","OOPSGUI4",204,0)
 S RESULTS(CN)="NO MATCHES FOUND"
"RTN","OOPSGUI4",205,0)
 F  S IEN=$O(^OOPS(2260,"SSN",SSN,IEN)) Q:IEN=""  D
"RTN","OOPSGUI4",206,0)
 . I $$GET1^DIQ(2260,IEN,51,"I") Q        ;case not open, don't include
"RTN","OOPSGUI4",207,0)
 . S NM=$$GET1^DIQ(2260,IEN,1)
"RTN","OOPSGUI4",208,0)
 . S TYPE=$$GET1^DIQ(2260,IEN,"3:.01")
"RTN","OOPSGUI4",209,0)
 . S DT=$$GET1^DIQ(2260,IEN,4)
"RTN","OOPSGUI4",210,0)
 . S RESULTS(CN)=NM_"  "_DT_"  "_TYPE
"RTN","OOPSGUI4",211,0)
 . S CN=CN+1,(NM,TYPE,DT)=""
"RTN","OOPSGUI4",212,0)
 Q
"RTN","OOPSGUI6")
0^6^B53681368
"RTN","OOPSGUI6",1,0)
OOPSGUI6 ;WIOFO/LLH-RPC routines for ASISTS Gui ;9/18/01
"RTN","OOPSGUI6",2,0)
 ;;2.0;ASISTS;**4**;Jun 03, 2002
"RTN","OOPSGUI6",3,0)
 ;
"RTN","OOPSGUI6",4,0)
UNIGET(RESULTS) ; Returns entries in the Union table
"RTN","OOPSGUI6",5,0)
 N DATA,CNT,SUP,UIEN,UNI
"RTN","OOPSGUI6",6,0)
 S CNT=0,UNI=""
"RTN","OOPSGUI6",7,0)
 F  S UNI=$O(^OOPS(2263.7,"B",UNI)) Q:UNI=""  D
"RTN","OOPSGUI6",8,0)
 . S UIEN=0
"RTN","OOPSGUI6",9,0)
 . F  S UIEN=$O(^OOPS(2263.7,"B",UNI,UIEN)) Q:UIEN=""  D
"RTN","OOPSGUI6",10,0)
 .. S DATA=$G(^OOPS(2263.7,UIEN,0))
"RTN","OOPSGUI6",11,0)
 .. S SUP=$$GET1^DIQ(200,$P($G(DATA),U,3),.01)
"RTN","OOPSGUI6",12,0)
 .. S RESULTS(CNT)=DATA_U_SUP_U_UIEN
"RTN","OOPSGUI6",13,0)
 .. S CNT=CNT+1
"RTN","OOPSGUI6",14,0)
 Q
"RTN","OOPSGUI6",15,0)
UNIKILL(RESULTS,INPUT) ; Kills the entry in ^OOPS(2263.7 passed in Input
"RTN","OOPSGUI6",16,0)
 ;  Input - INPUT contains the IEN for Union to be deleted
"RTN","OOPSGUI6",17,0)
 ; Output - RESULTS will contain a message indicating the record
"RTN","OOPSGUI6",18,0)
 ;          was successfully deleted.
"RTN","OOPSGUI6",19,0)
 N DA,DIK
"RTN","OOPSGUI6",20,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUI6",21,0)
 S DIK="^OOPS(2263.7,",DA=INPUT
"RTN","OOPSGUI6",22,0)
 D ^DIK
"RTN","OOPSGUI6",23,0)
 S RESULTS="Record Successfully Deleted"
"RTN","OOPSGUI6",24,0)
 Q
"RTN","OOPSGUI6",25,0)
UNIADD ; Files a new record in ^OOPS(2263.7 
"RTN","OOPSGUI6",26,0)
 N X,DIC,DLAYGO
"RTN","OOPSGUI6",27,0)
 K DO
"RTN","OOPSGUI6",28,0)
 S DLAYGO=2263.7,DIC="^OOPS(2263.7,",DIC(0)="L"
"RTN","OOPSGUI6",29,0)
 S X=NM
"RTN","OOPSGUI6",30,0)
 D FILE^DICN
"RTN","OOPSGUI6",31,0)
 I Y=-1 S RESULTS="Failed" Q
"RTN","OOPSGUI6",32,0)
 S DA=+Y
"RTN","OOPSGUI6",33,0)
 S RESULTS=X_" union added"
"RTN","OOPSGUI6",34,0)
 Q
"RTN","OOPSGUI6",35,0)
UNIEDT(RESULTS,INPUT) ; Edits the input in ^OOPS(2263.7
"RTN","OOPSGUI6",36,0)
 ;  Input - INPUT contains the IEN of Union to be edited or NULL if a
"RTN","OOPSGUI6",37,0)
 ;          new union is being added.  It also contains the Union Name,
"RTN","OOPSGUI6",38,0)
 ;          Union Acronym, and the Union Representative in the format:
"RTN","OOPSGUI6",39,0)
 ;          IEN^UNION NAME^UNION ACRONYM^UNION REP
"RTN","OOPSGUI6",40,0)
 ; Output - RESULTS contains a status message regarding the filing of
"RTN","OOPSGUI6",41,0)
 ;          the data
"RTN","OOPSGUI6",42,0)
 N DA,DIE,DR,IEN,NM,ACR,REP
"RTN","OOPSGUI6",43,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUI6",44,0)
 S DIE="^OOPS(2263.7,"
"RTN","OOPSGUI6",45,0)
 S IEN=$P($G(INPUT),U),NM=$P($G(INPUT),U,2)
"RTN","OOPSGUI6",46,0)
 I $G(NM)="" Q
"RTN","OOPSGUI6",47,0)
 I $G(IEN)="" D UNIADD S IEN=DA
"RTN","OOPSGUI6",48,0)
 I RESULTS="Failed" Q
"RTN","OOPSGUI6",49,0)
 S ACR=$P($G(INPUT),U,3),REP=$P($G(INPUT),U,4)
"RTN","OOPSGUI6",50,0)
 S DA=IEN,DR=".01///^S X=NM;1///^S X=ACR;2///^S X=REP"
"RTN","OOPSGUI6",51,0)
 D ^DIE
"RTN","OOPSGUI6",52,0)
 I $G(Y)="" D  Q
"RTN","OOPSGUI6",53,0)
 . ; if next line executed, then straight edit, not an add
"RTN","OOPSGUI6",54,0)
 . I RESULTS="No Changes Filed" S RESULTS="Union Update Successful."
"RTN","OOPSGUI6",55,0)
 S RESULTS="Union Update NOT Successful."
"RTN","OOPSGUI6",56,0)
 Q
"RTN","OOPSGUI6",57,0)
 ;
"RTN","OOPSGUI6",58,0)
SITEPGET(RESULTS) ; Returns the Site Parameter name and IEN and the
"RTN","OOPSGUI6",59,0)
 ;                 DOL district office.
"RTN","OOPSGUI6",60,0)
 ;  Input - none
"RTN","OOPSGUI6",61,0)
 ; Output - RESULTS is an array whose 0 node contains the Site 
"RTN","OOPSGUI6",62,0)
 ;          parameter name, IEN, and District Office in the format:
"RTN","OOPSGUI6",63,0)
 ;          SITE NAME^DISTRICT OFFICE^SITE IEN
"RTN","OOPSGUI6",64,0)
 ;          Subsequent nodes starting from 1 contain Station information
"RTN","OOPSGUI6",65,0)
 ;          in the following format:
"RTN","OOPSGUI6",66,0)
 ;          STANM_U_PNM_U_PADD_U_PCTY_U_PST_U_PZIP_U_PTITLE_
"RTN","OOPSGUI6",67,0)
 ;          U_CHGBKCODE_U_SUB_U_STA
"RTN","OOPSGUI6",68,0)
 N CNT,DOFF,IENS,SIEN,STA,SUB,SNAME,STR
"RTN","OOPSGUI6",69,0)
 S SIEN=$P($G(^OOPS(2262,0)),U,3)
"RTN","OOPSGUI6",70,0)
 I '$G(SIEN) S RESULTS(0)="No Site Parameter File was Found" Q
"RTN","OOPSGUI6",71,0)
 L +^OOPS(2262,SIEN):2
"RTN","OOPSGUI6",72,0)
 E  S RESULTS(0)="This option in use by another user, try again later." Q
"RTN","OOPSGUI6",73,0)
 S SNAME=$$GET1^DIQ(2262,SIEN,.01)
"RTN","OOPSGUI6",74,0)
 S DOFF=$$GET1^DIQ(2262,SIEN,2,"E")
"RTN","OOPSGUI6",75,0)
 S RESULTS(0)=SNAME_U_DOFF_U_SIEN
"RTN","OOPSGUI6",76,0)
 S CNT=1,SUB=""
"RTN","OOPSGUI6",77,0)
 F  S SUB=$O(^OOPS(2262,SIEN,SUB)) Q:SUB=""  S STA=0 D
"RTN","OOPSGUI6",78,0)
 . N CBC,STANM,STATION,PNM,PADD,PCTY,PST,PZIP,PTITLE
"RTN","OOPSGUI6",79,0)
 . S (CBC,STATION,PNM,PADD,PCTY,PST,PZIP,PTITLE)=""
"RTN","OOPSGUI6",80,0)
 . F  S STA=$O(^OOPS(2262,SIEN,SUB,STA)) Q:STA'>0  D
"RTN","OOPSGUI6",81,0)
 .. S STR=$G(^OOPS(2262,SIEN,SUB,STA,0)),IENS=STA_","_SUB_","
"RTN","OOPSGUI6",82,0)
 .. S STATION=$$GET1^DIQ(2262.03,IENS,".01:99")
"RTN","OOPSGUI6",83,0)
 .. S STANM=$$GET1^DIQ(2262.03,IENS,.01)_" = "_STATION
"RTN","OOPSGUI6",84,0)
 .. S PNM=$P(STR,U,2),PADD=$P(STR,U,3),PCTY=$P(STR,U,4),PZIP=$P(STR,U,6)
"RTN","OOPSGUI6",85,0)
 .. I $P(STR,U,5)'="" S PST=$$GET1^DIQ(2262.03,IENS,4)
"RTN","OOPSGUI6",86,0)
 .. I $P(STR,U,7)'="" S PTITLE=$$GET1^DIQ(2262.03,IENS,6)
"RTN","OOPSGUI6",87,0)
 .. S CBC=$P(STR,U,8) I $G(CBC)'="" S CBC=$$GET1^DIQ(2263.6,CBC,.01)
"RTN","OOPSGUI6",88,0)
 .. S RESULTS(CNT)=STANM_U_PNM_U_PADD_U_PCTY_U_PST_U_PZIP_U_PTITLE_U_CBC_U_SUB_U_STA
"RTN","OOPSGUI6",89,0)
 .. S (STANM,PNM,PADD,PCTY,PST,PZIP,PTITLE,CBC)=""
"RTN","OOPSGUI6",90,0)
 .. S CNT=CNT+1
"RTN","OOPSGUI6",91,0)
 L -^OOPS(2262,SIEN)
"RTN","OOPSGUI6",92,0)
 Q
"RTN","OOPSGUI6",93,0)
SITEPADD ; Creates a new Station Subfile in the Site Parameter
"RTN","OOPSGUI6",94,0)
 ;                 File (#2262
"RTN","OOPSGUI6",95,0)
 N X,DIC,DLAYGO
"RTN","OOPSGUI6",96,0)
 S DLAYGO=2262,DIC="^OOPS(2262,"_SIEN_","_SUBF_",",DIC(0)="L"
"RTN","OOPSGUI6",97,0)
 S DA(1)=SIEN,X=STANM
"RTN","OOPSGUI6",98,0)
 D FILE^DICN
"RTN","OOPSGUI6",99,0)
 I Y=-1 S RESULTS="Failed" Q
"RTN","OOPSGUI6",100,0)
 S DA=+Y
"RTN","OOPSGUI6",101,0)
 S RESULTS="Successfully Added"
"RTN","OOPSGUI6",102,0)
 Q
"RTN","OOPSGUI6",103,0)
SITEPKIL(RESULTS,INPUT) ; Deletes the Station Subfile whose IEN was passed in
"RTN","OOPSGUI6",104,0)
 ;  Input - INPUT contains the Site Parameter file IEN, the subfile IEN,
"RTN","OOPSGUI6",105,0)
 ;          and the Station IEN in the format:
"RTN","OOPSGUI6",106,0)
 ;          SIEN^SUBF^STAIEN
"RTN","OOPSGUI6",107,0)
 ; Output - RESULTS contains a message with the filing status
"RTN","OOPSGUI6",108,0)
 N DA,DIK,SIEN,SUBF,STAIEN
"RTN","OOPSGUI6",109,0)
 S SIEN=$P($G(INPUT),U),SUBF=$P($G(INPUT),U,2),STAIEN=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",110,0)
 I $G(SIEN)=""!($G(SUBF)="")!($G(STAIEN)="") D  Q
"RTN","OOPSGUI6",111,0)
 . S RESULTS="Missing Record Identifiers, Cannot file."
"RTN","OOPSGUI6",112,0)
 S DIK="^OOPS(2262,"_SIEN_","_SUBF_","
"RTN","OOPSGUI6",113,0)
 S DA=STAIEN,DA(1)=SIEN
"RTN","OOPSGUI6",114,0)
 D ^DIK
"RTN","OOPSGUI6",115,0)
 I $G(Y)="" S RESULTS="Deletion did not occur." Q
"RTN","OOPSGUI6",116,0)
 S RESULTS="Record successfully deleted"
"RTN","OOPSGUI6",117,0)
 Q
"RTN","OOPSGUI6",118,0)
SITEPEDT(RESULTS,INPUT,DATA) ; Edits the Station Subfile whose data and 
"RTN","OOPSGUI6",119,0)
 ;                         IEN have been passed in
"RTN","OOPSGUI6",120,0)
 ;  Input - INPUT contains the IEN of the Site Parameter file and 
"RTN","OOPSGUI6",121,0)
 ;                subfile IEN and the Station IEN.  If adding a new
"RTN","OOPSGUI6",122,0)
 ;                station, the Station IEN will not be passed.  The
"RTN","OOPSGUI6",123,0)
 ;                format of INPUT = SITE IEN^SUBFILE IEN^STATION IEN
"RTN","OOPSGUI6",124,0)
 ;          DATA  contains the data to be filed
"RTN","OOPSGUI6",125,0)
 ; Output - RESULTS is a single value with a message regarding the 
"RTN","OOPSGUI6",126,0)
 ;          filing status
"RTN","OOPSGUI6",127,0)
 N CBC,DA,DIE,DR,PNM,PADD,PCTY,PST,PZIP,PTITLE,SIEN,SUBF
"RTN","OOPSGUI6",128,0)
 N STANM,STAIEN
"RTN","OOPSGUI6",129,0)
 S RESULTS="Filing"
"RTN","OOPSGUI6",130,0)
 S SIEN=$P($G(INPUT),U),SUBF=$P($G(INPUT),U,2),STAIEN=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",131,0)
 I $G(SIEN)="" S RESULTS="Missing Record Identifiers, Cannot file." Q
"RTN","OOPSGUI6",132,0)
 I '$G(SUBF) S SUBF=$O(^OOPS(2262,SIEN,0)) I '$G(SUBF) S SUBF=1
"RTN","OOPSGUI6",133,0)
 S STANM=$P($G(DATA),U)
"RTN","OOPSGUI6",134,0)
 I $G(STANM)="" S RESULTS="Missing Station, Cannot continue." Q
"RTN","OOPSGUI6",135,0)
 I $G(STAIEN)="" D SITEPADD S STAIEN=DA
"RTN","OOPSGUI6",136,0)
 I $G(STAIEN)="" S RESULTS="Missing Station, cannot file." Q
"RTN","OOPSGUI6",137,0)
 S DIE="^OOPS(2262,"_SIEN_","_SUBF_","
"RTN","OOPSGUI6",138,0)
 S DA=STAIEN,DA(1)=SIEN
"RTN","OOPSGUI6",139,0)
 S PNM=$P($G(DATA),U,2),PADD=$P($G(DATA),U,3)
"RTN","OOPSGUI6",140,0)
 S PCTY=$P($G(DATA),U,4),PST=$P($G(DATA),U,5),PZIP=$P($G(DATA),U,6)
"RTN","OOPSGUI6",141,0)
 S PTITLE=$P($G(DATA),U,7),CBC=$P($G(DATA),U,8)
"RTN","OOPSGUI6",142,0)
 S DR=".7///^S X=CBC;1///^S X=PNM;2///^S X=PADD;3///^S X=PCTY;4///^S X=PST;5///^S X=PZIP;6///^S X=PTITLE"
"RTN","OOPSGUI6",143,0)
 D ^DIE
"RTN","OOPSGUI6",144,0)
 I $G(Y)="" D  Q
"RTN","OOPSGUI6",145,0)
 . ; if line below executed, then no Add, only edit
"RTN","OOPSGUI6",146,0)
 . I RESULTS="Filing" S RESULTS="Update Successful"
"RTN","OOPSGUI6",147,0)
 S RESULTS="Update was not Successful"
"RTN","OOPSGUI6",148,0)
 Q
"RTN","OOPSGUI6",149,0)
PARMEDT(RESULTS,INPUT) ; Files changes to top level file (#2262)
"RTN","OOPSGUI6",150,0)
 ;  Input:   INPUT - This variable contains the IEN, Site Name, and 
"RTN","OOPSGUI6",151,0)
 ;                   District Office Name to be filed in the format:
"RTN","OOPSGUI6",152,0)
 ;                   IEN^SITE NAME^DISTRICT OFFICE
"RTN","OOPSGUI6",153,0)
 ; Output: RESULTS - Results will contain a filing status message
"RTN","OOPSGUI6",154,0)
 N DA,DIE,DR,IEN,SITENM,DISOFF
"RTN","OOPSGUI6",155,0)
 S IEN=$P($G(INPUT),U),SITENM=$P($G(INPUT),U,2),DISOFF=$P($G(INPUT),U,3)
"RTN","OOPSGUI6",156,0)
 I '$G(IEN) S RESULTS="Cannot File Changes, no Record Number" Q
"RTN","OOPSGUI6",157,0)
 S DIE="^OOPS(2262,",DA=IEN
"RTN","OOPSGUI6",158,0)
 S DR=".01///^S X=SITENM;2///^S X=DISOFF"
"RTN","OOPSGUI6",159,0)
 D ^DIE
"RTN","OOPSGUI6",160,0)
 I $G(Y)="" S RESULTS="Update Site data Successful" Q
"RTN","OOPSGUI6",161,0)
 S RESULTS="Update Site data was NOT Successful"
"RTN","OOPSGUI6",162,0)
 Q
"RTN","OOPSGUI6",163,0)
AMEND(RESULTS,OLDIEN) ; File new Amended Case
"RTN","OOPSGUI6",164,0)
 ;  Input:  OLDIEN - The ASISTS IEN for the case to have an
"RTN","OOPSGUI6",165,0)
 ;                   amendment created for.
"RTN","OOPSGUI6",166,0)
 ; Output: RESULTS - Single value with the new case number
"RTN","OOPSGUI6",167,0)
 ;
"RTN","OOPSGUI6",168,0)
 N DLAYGO
"RTN","OOPSGUI6",169,0)
 Q:$P(^OOPS(2260,OLDIEN,0),"^",6)'=0   ;defensive code, should not occur
"RTN","OOPSGUI6",170,0)
 S NUM=$P(^OOPS(2260,OLDIEN,0),U,1),SUF=$E(NUM,11)
"RTN","OOPSGUI6",171,0)
 S $P(^OOPS(2260,OLDIEN,0),U,6)=3
"RTN","OOPSGUI6",172,0)
 S NUM=$E(NUM,1,10)_$S(SUF="":"A",1:$CHAR($ASCII(SUF)+1))
"RTN","OOPSGUI6",173,0)
 K DD,DO
"RTN","OOPSGUI6",174,0)
 S DLAYGO=2260,DIC="^OOPS(2260,",DIC(0)="QLZ",X=NUM D FILE^DICN G:Y=-1 EXIT
"RTN","OOPSGUI6",175,0)
 S NEWIEN=+Y
"RTN","OOPSGUI6",176,0)
 MERGE ^OOPS(2260,NEWIEN)=^OOPS(2260,OLDIEN)
"RTN","OOPSGUI6",177,0)
 S OOP=^OOPS(2260,NEWIEN,0)
"RTN","OOPSGUI6",178,0)
 S $P(OOP,U,1)=NUM,$P(OOP,U,6)=0,$P(OOP,U,11)="",$P(OOP,U,19)=""
"RTN","OOPSGUI6",179,0)
 S ^OOPS(2260,NEWIEN,0)=OOP
"RTN","OOPSGUI6",180,0)
 S $P(^OOPS(2260,NEWIEN,"CA"),U,6)=""
"RTN","OOPSGUI6",181,0)
 S DIK="^OOPS(2260,",DA=NEWIEN D IX^DIK
"RTN","OOPSGUI6",182,0)
 K ^OOPS(2260,NEWIEN,"2162ES")
"RTN","OOPSGUI6",183,0)
 K ^OOPS(2260,NEWIEN,"CA1ES")
"RTN","OOPSGUI6",184,0)
 K ^OOPS(2260,NEWIEN,"CA2ES")
"RTN","OOPSGUI6",185,0)
 N IEN,X,WCPDUZ,WOK
"RTN","OOPSGUI6",186,0)
 S WCPDUZ=$P($G(^OOPS(2260,NEWIEN,"WCES")),U)
"RTN","OOPSGUI6",187,0)
 I $G(WCPDUZ) S WOK=1,X=WCPDUZ,IEN=OLDIEN D WK^OOPSUTL1
"RTN","OOPSGUI6",188,0)
 K ^OOPS(2260,NEWIEN,"WCES")
"RTN","OOPSGUI6",189,0)
 S RESULTS=NUM
"RTN","OOPSGUI6",190,0)
EXIT K DA,DIC,OLDIEN,NEWIEN,NUM,SUF,X,Y,DIK,OOP
"RTN","OOPSGUI6",191,0)
 Q
"RTN","OOPSGUI6",192,0)
CHGCASE(RESULTS,INPUT,FLD58) ;  File Change Case Status
"RTN","OOPSGUI6",193,0)
 ;  Input:    INPUT  - IEN^STAT where IEN = the ASISTS case IEN and
"RTN","OOPSGUI6",194,0)
 ;                     STAT = the new case status
"RTN","OOPSGUI6",195,0)
 ;          DELETE   - Reason for Deletion, field #58, file #2260
"RTN","OOPSGUI6",196,0)
 ; Output: RESULTS   - Message back to client with new Case Status
"RTN","OOPSGUI6",197,0)
 ;
"RTN","OOPSGUI6",198,0)
 N CURRENT,DR,DIE,IEN,Y,STATUS
"RTN","OOPSGUI6",199,0)
 S IEN=$P(INPUT,U),(STATUS,Y)=$P(INPUT,U,2)
"RTN","OOPSGUI6",200,0)
 I '$G(IEN) S RESULTS="Missing Record Identifier, cannot file." Q
"RTN","OOPSGUI6",201,0)
 I $$GET1^DIQ(2260,IEN,66)'="",(Y=2) D  Q
"RTN","OOPSGUI6",202,0)
 . S RESULTS="Case transmitted to DOL, cannot change status to Deleted."
"RTN","OOPSGUI6",203,0)
 S CURRENT=$$GET1^DIQ(2260,IEN,51,"I")
"RTN","OOPSGUI6",204,0)
CLOSE ; Close
"RTN","OOPSGUI6",205,0)
 S DR=""
"RTN","OOPSGUI6",206,0)
 S DR="51////"_Y
"RTN","OOPSGUI6",207,0)
 ; If current status goes from closed/deleted to Open, reset field 57
"RTN","OOPSGUI6",208,0)
 I (CURRENT=1!(CURRENT=2)),(Y=0) S DR=DR_";57////@"
"RTN","OOPSGUI6",209,0)
 I FLD58]"" S DR=DR_";58////"_FLD58
"RTN","OOPSGUI6",210,0)
 S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI6",211,0)
 D ^DIE K DIE,DA
"RTN","OOPSGUI6",212,0)
 I $D(Y)'=0 Q
"RTN","OOPSGUI6",213,0)
 S RESULTS="Case Status has been changed to: "_$$GET1^DIQ(2260,IEN,51)
"RTN","OOPSGUI6",214,0)
 ; 01/02/04 Patch 4 llh- if case = closed, send bulletin
"RTN","OOPSGUI6",215,0)
 I STATUS=1 D CLSCASE^OOPSMBUL(IEN)
"RTN","OOPSGUI6",216,0)
 Q
"RTN","OOPSGUI7")
0^7^B26074659
"RTN","OOPSGUI7",1,0)
OOPSGUI7 ;WIOFO/LLH-RPC routines ;10/30/01
"RTN","OOPSGUI7",2,0)
 ;;2.0;ASISTS;**2,4**;Jun 03, 2002
"RTN","OOPSGUI7",3,0)
 ;
"RTN","OOPSGUI7",4,0)
ENT(RESULTS,INPUT) ; Non-interactive GUI Entry Point for transmitting data
"RTN","OOPSGUI7",5,0)
 ;                 to DOL or NDB
"RTN","OOPSGUI7",6,0)
 ;  Input:   INPUT  - Contains the date for the claims to be
"RTN","OOPSGUI7",7,0)
 ;                    retransmited, the queue date and time for the
"RTN","OOPSGUI7",8,0)
 ;                    retransmission date to run and either DOL or NDB
"RTN","OOPSGUI7",9,0)
 ;                    to indicate which manual transmisssion should run.
"RTN","OOPSGUI7",10,0)
 ;                    The format is TRANSDT^QUEUEDT@TIME^DOL (or NDB)
"RTN","OOPSGUI7",11,0)
 ; Output: RESULTS -  is the return array to the client with status
"RTN","OOPSGUI7",12,0)
 ;                    message
"RTN","OOPSGUI7",13,0)
 N ARR,COMMA,ERR1,ERR2,FIELD,FL,MAILG,CURR,QDATE,QUE,RDATE,RTN,X,Y
"RTN","OOPSGUI7",14,0)
 N MAN,WOK,ZTDESC,ZTREQ,ZTRTN
"RTN","OOPSGUI7",15,0)
 S RTN=$P($G(INPUT),U,3)
"RTN","OOPSGUI7",16,0)
 S MAN=1                       ; force manual xmit flag
"RTN","OOPSGUI7",17,0)
 I RTN="DOL" D
"RTN","OOPSGUI7",18,0)
 . S MAILG="OOPS DOL XMIT DATA"
"RTN","OOPSGUI7",19,0)
 . S QUE="Q-AST.MED.VA.GOV"
"RTN","OOPSGUI7",20,0)
 I RTN="NDB" D
"RTN","OOPSGUI7",21,0)
 . S MAILG="OOPS XMIT 2162 DATA"
"RTN","OOPSGUI7",22,0)
 . S QUE="Q-ASI.MED.VA.GOV"
"RTN","OOPSGUI7",23,0)
 ;Check for security keys
"RTN","OOPSGUI7",24,0)
 I '$D(^XUSEC(MAILG,DUZ)) D  Q
"RTN","OOPSGUI7",25,0)
 .S RESULTS(0)="ERROR"
"RTN","OOPSGUI7",26,0)
 .S RESULTS(1)="You do not have the required Security Key."
"RTN","OOPSGUI7",27,0)
 ;Assure the Queue has been defined
"RTN","OOPSGUI7",28,0)
 S FIELD=.01,FL="X"
"RTN","OOPSGUI7",29,0)
 D FIND^DIC(4.2,"",FIELD,FL,QUE,"","","","","ARR")
"RTN","OOPSGUI7",30,0)
 I '$D(ARR("DILIST",1)) D  Q
"RTN","OOPSGUI7",31,0)
 .S RESULTS(0)="ERROR"
"RTN","OOPSGUI7",32,0)
 .S RESULTS(1)="Domain not found in the DOMAIN File,"
"RTN","OOPSGUI7",33,0)
 ; Get Retransmit Date from First Piece of Input & Translate into FM
"RTN","OOPSGUI7",34,0)
 S X=$P($G(INPUT),U) D ^%DT
"RTN","OOPSGUI7",35,0)
 S RDATE=Y
"RTN","OOPSGUI7",36,0)
 I RDATE=-1 S ERR1=1
"RTN","OOPSGUI7",37,0)
 S %DT="R",X=$P($G(INPUT),U,2) D ^%DT K %DT
"RTN","OOPSGUI7",38,0)
 S QDATE=Y
"RTN","OOPSGUI7",39,0)
 I QDATE=-1 S ERR2=2
"RTN","OOPSGUI7",40,0)
 I $G(ERR1)!($G(ERR2)) D  Q
"RTN","OOPSGUI7",41,0)
 . S RESULTS(0)="ERROR",RESULTS(1)="",COMMA=""
"RTN","OOPSGUI7",42,0)
 . S:$G(ERR1) RESULTS(1)="Invalid Transmission Date",COMMA=", "
"RTN","OOPSGUI7",43,0)
 . S:$G(ERR2) RESULTS(1)=RESULTS(1)_COMMA_"Invalid Queue Date."
"RTN","OOPSGUI7",44,0)
 ;
"RTN","OOPSGUI7",45,0)
 I RTN="DOL" D
"RTN","OOPSGUI7",46,0)
 . S ZTRTN="EN^OOPSDOL",WOK=1,ZTDESC="TRANSMIT DOL CA1/CA2 DATA"
"RTN","OOPSGUI7",47,0)
 I RTN="NDB" D
"RTN","OOPSGUI7",48,0)
 . S ZTRTN="EN^OOPSNDB",ZTDESC="TRANSMIT NATIONAL DATABASE 2162 DATA"
"RTN","OOPSGUI7",49,0)
 ; Make sure Queue date/time is not after current time
"RTN","OOPSGUI7",50,0)
 S CURR=$$HTFM^XLFDT(""_$H_"")
"RTN","OOPSGUI7",51,0)
 I $$FMDIFF^XLFDT(QDATE,CURR,2)<0 S QDATE=$H
"RTN","OOPSGUI7",52,0)
 ; Report will always be Queued from the GUI
"RTN","OOPSGUI7",53,0)
 K IO("Q"),ZTUCI,ZTDTH,ZTIO,ZTSAVE
"RTN","OOPSGUI7",54,0)
 S ZTDTH=QDATE,ZTIO="",ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","OOPSGUI7",55,0)
 S ZTSAVE("RDATE")="",ZTSAVE("MAN")=""
"RTN","OOPSGUI7",56,0)
 D ^%ZTLOAD
"RTN","OOPSGUI7",57,0)
 K ZTSK
"RTN","OOPSGUI7",58,0)
 S RESULTS(0)="SUCCESSFULLY QUEUED"
"RTN","OOPSGUI7",59,0)
 Q
"RTN","OOPSGUI7",60,0)
OWCPCLR(RESULTS,IEN,CALLER,FORM) ; Entry point for clearing supervisor
"RTN","OOPSGUI7",61,0)
 ;   fields if OWPC worker has edited them
"RTN","OOPSGUI7",62,0)
 ;  Input:     IEN - ien of case to have the fields cleared
"RTN","OOPSGUI7",63,0)
 ;          CALLER - menu being called from
"RTN","OOPSGUI7",64,0)
 ;            FORM - whether a CA1 or CA2
"RTN","OOPSGUI7",65,0)
 ; Output: RESULTS - required results parameter, no data returned
"RTN","OOPSGUI7",66,0)
 ;                   from this call
"RTN","OOPSGUI7",67,0)
 I $G(IEN)=""!($G(CALLER)="")!($G(FORM)="") Q
"RTN","OOPSGUI7",68,0)
 D CLRFLDS^OOPSWCE
"RTN","OOPSGUI7",69,0)
SUPFLDS ; Clear Supervisor fields for the CA1, since fields have been changed
"RTN","OOPSGUI7",70,0)
 I FORM'="CA1" Q
"RTN","OOPSGUI7",71,0)
 N SUP
"RTN","OOPSGUI7",72,0)
 S SUP=$$GET1^DIQ(200,DUZ,.01)
"RTN","OOPSGUI7",73,0)
 S RESULTS=SUP
"RTN","OOPSGUI7",74,0)
 S $P(^OOPS(2260,IEN,"CA1L"),U,3)=""     ;Clear EXCEPTION 
"RTN","OOPSGUI7",75,0)
 S $P(^OOPS(2260,IEN,"CA1L"),U,4)=""     ;Clear SUP TITLE
"RTN","OOPSGUI7",76,0)
 S $P(^OOPS(2260,IEN,"CA1L"),U,5)=""     ;Clear SUP PHONE
"RTN","OOPSGUI7",77,0)
 Q
"RTN","OOPSGUI7",78,0)
CONSENT(RESULTS,IEN,UNIREP)     ; Employee consented to union notification,
"RTN","OOPSGUI7",79,0)
 ;                 send msg to union
"RTN","OOPSGUI7",80,0)
 ; Input
"RTN","OOPSGUI7",81,0)
 ;    IEN - Internal record number
"RTN","OOPSGUI7",82,0)
 ; UNIREP - IEN from file 200 of the Union Rep - used to send bulletin
"RTN","OOPSGUI7",83,0)
 ; Output - RESULTS - String indicating bulletin status.
"RTN","OOPSGUI7",84,0)
 D CONSENT^OOPSMBUL(IEN,UNIREP)
"RTN","OOPSGUI7",85,0)
 Q
"RTN","OOPSGUI7",86,0)
GETFLD(RESULTS,IEN,FLD) ; Send in IEN and Field number to retrieve a single 
"RTN","OOPSGUI7",87,0)
 ; data field from the ASISTS Accident Reporting File (#2260)
"RTN","OOPSGUI7",88,0)
 ;
"RTN","OOPSGUI7",89,0)
 ;  Input:   IEN - Internal record number
"RTN","OOPSGUI7",90,0)
 ; Output:   FLD - the file and field number of the data element to be
"RTN","OOPSGUI7",91,0)
 ;                 retrieved.  EX. 2260^120
"RTN","OOPSGUI7",92,0)
 N FILE,FIELD,DATA
"RTN","OOPSGUI7",93,0)
 S RESULTS="No data."
"RTN","OOPSGUI7",94,0)
 I '$G(IEN) S RESULTS="No data.  Missing Record Identifier." Q
"RTN","OOPSGUI7",95,0)
 S FILE=$P(FLD,U),FIELD=$P(FLD,U,2)
"RTN","OOPSGUI7",96,0)
 I $G(FILE)=""!($G(FIELD)="") D  Q
"RTN","OOPSGUI7",97,0)
 . S RESULTS="No data.  Missing File or Field information."
"RTN","OOPSGUI7",98,0)
 S DATA=$$GET1^DIQ(FILE,IEN,FIELD)
"RTN","OOPSGUI7",99,0)
 I $G(DATA)'="" S RESULTS=DATA
"RTN","OOPSGUI7",100,0)
 Q
"RTN","OOPSGUI7",101,0)
GETINST(RESULTS)        ; 
"RTN","OOPSGUI7",102,0)
 ; RPC Call - Get Institutions from File 4
"RTN","OOPSGUI7",103,0)
 ; Output:  RESULTS - global array
"RTN","OOPSGUI7",104,0)
 ;
"RTN","OOPSGUI7",105,0)
 ; 12/30/03 llh (OOPS*2*4) - this subroutine can only be used
"RTN","OOPSGUI7",106,0)
 ; to retrieve data from ^DIC(4).  There is generic code in OOPSGUI3
"RTN","OOPSGUI7",107,0)
 ; to obtain data from other 'table files'.
"RTN","OOPSGUI7",108,0)
 ;
"RTN","OOPSGUI7",109,0)
 N ITEM,ROOT,X,XREF,SFLD,VAL,PTR,PCE,VALID,FIELD
"RTN","OOPSGUI7",110,0)
 K ^TMP("OOPSINST",$J)
"RTN","OOPSGUI7",111,0)
 S XREF="B",X=0,FIELD=13
"RTN","OOPSGUI7",112,0)
 S ROOT="^"_$$GET1^DID(2260,FIELD,"","POINTER")
"RTN","OOPSGUI7",113,0)
 S ITEM="" F  S ITEM=$O(@(ROOT_"XREF,ITEM)")) Q:$G(ITEM)']""  D
"RTN","OOPSGUI7",114,0)
 .S PTR=0 F  S PTR=$O(@(ROOT_"XREF,ITEM,PTR)")) Q:PTR=""  D
"RTN","OOPSGUI7",115,0)
 ..I PTR'>0 Q
"RTN","OOPSGUI7",116,0)
 ..S VAL=$P(@(ROOT_PTR_",0)"),U)
"RTN","OOPSGUI7",117,0)
 ..S VALID=1,SFLD=ROOT_PTR_",99)"
"RTN","OOPSGUI7",118,0)
 ..I $P($G(@SFLD),U,4)=1 S VALID=0
"RTN","OOPSGUI7",119,0)
 ..I $P($G(@SFLD),U)'="" S VAL=VAL_" = "_$P($G(@SFLD),U)
"RTN","OOPSGUI7",120,0)
 ..I $P(VAL," = ")="" S VALID=0
"RTN","OOPSGUI7",121,0)
 ..I VALID S X=X+1,^TMP("OOPSINST",$J,X)=PTR_":"_VAL_$C(10)
"RTN","OOPSGUI7",122,0)
 S RESULTS=$NA(^TMP("OOPSINST",$J))
"RTN","OOPSGUI7",123,0)
 Q
"RTN","OOPSGUI7",124,0)
SENSDATA(RES,SDUZ,EMP) ;Supervisor accessed sensitive data, case not created
"RTN","OOPSGUI7",125,0)
 ; Input  EMP String which is the name of the employee accessed.
"RTN","OOPSGUI7",126,0)
 ;        DUZ DUZ of the Supervisor accessing the data. 
"RTN","OOPSGUI7",127,0)
 N MGRP,MEMS,MSG
"RTN","OOPSGUI7",128,0)
 ;Make sure mail group exists
"RTN","OOPSGUI7",129,0)
 S MGRP=$$FIND1^DIC(3.8,"","X","OOPS ISO NOTIFICATION")
"RTN","OOPSGUI7",130,0)
 I 'MGRP D  G BULL
"RTN","OOPSGUI7",131,0)
 .S XMY("G.OOPS WC MESSAGE")=""
"RTN","OOPSGUI7",132,0)
 .S XMDUZ="ASISTS Package"
"RTN","OOPSGUI7",133,0)
 .S GRP="OOPS WC MESSAGE"
"RTN","OOPSGUI7",134,0)
 .S XMSUB="ASISTS ISO NOTIFICATION Mail Group Error"
"RTN","OOPSGUI7",135,0)
 .S MSG(1)="The OOPS ISO NOTIFICATION Mail Group does not exist."
"RTN","OOPSGUI7",136,0)
 .S XMTEXT="MSG("
"RTN","OOPSGUI7",137,0)
 .D ^XMD
"RTN","OOPSGUI7",138,0)
 ;Make sure there is someone defined in the mail group
"RTN","OOPSGUI7",139,0)
 D LIST^DIC(3.81,","_MGRP_",","","",1,"","","","","","MEMS")
"RTN","OOPSGUI7",140,0)
 I '$P(MEMS("DILIST",0),U) D  G BULL
"RTN","OOPSGUI7",141,0)
 .S XMY("G.OOPS WC MESSAGE")=""
"RTN","OOPSGUI7",142,0)
 .S XMDUZ="ASISTS Package"
"RTN","OOPSGUI7",143,0)
 .S GRP="OOPS WC MESSAGE"
"RTN","OOPSGUI7",144,0)
 .S XMSUB="ASISTS ISO NOTIFICATION Mail Group Error"
"RTN","OOPSGUI7",145,0)
 .S MSG(1)="There are no members in mail group OOPS ISO NOTIFICATION."
"RTN","OOPSGUI7",146,0)
 .S XMTEXT="MSG("
"RTN","OOPSGUI7",147,0)
 .D ^XMD
"RTN","OOPSGUI7",148,0)
 S XMY("G.OOPS ISO NOTIFICATION")=""
"RTN","OOPSGUI7",149,0)
BULL S (NAME,XMB)="OOPS SENSITIVE DATA"
"RTN","OOPSGUI7",150,0)
 S XMB(1)=$$GET1^DIQ(200,SDUZ,.01)
"RTN","OOPSGUI7",151,0)
 S XMB(2)=EMP
"RTN","OOPSGUI7",152,0)
 S XMB(3)=$$FMTE^XLFDT($$NOW^XLFDT,1)
"RTN","OOPSGUI7",153,0)
 S XMBODY="",XMINSTR("FLAGS")="X"
"RTN","OOPSGUI7",154,0)
 D TASKBULL^XMXAPI(DUZ,NAME,.XMB,XMBODY,.XMY,.XMINSTR)
"RTN","OOPSGUI7",155,0)
 K NAME,XMB,XMBODY,XMY,XMINSTR
"RTN","OOPSGUI7",156,0)
 S RES="BULLETIN SENT"
"RTN","OOPSGUI7",157,0)
 Q
"RTN","OOPSGUIT")
0^2^B77268945
"RTN","OOPSGUIT",1,0)
OOPSGUIT ;WIOFO/LLH-RPC Rtn for Type of Incident rpt ;11/5/01 
"RTN","OOPSGUIT",2,0)
 ;;2.0;ASISTS;**4**;Jun 03, 2002
"RTN","OOPSGUIT",3,0)
 ;
"RTN","OOPSGUIT",4,0)
ENT(RESULTS,TRPT,CSTAT,STDT,ENDDT,LTNTT,STAT,PSTAT) ;
"RTN","OOPSGUIT",5,0)
 N DATA,CNT,CS,CS1,EDATE,OOPS,LOST,LP,SDATE,TOT,RPTTY
"RTN","OOPSGUIT",6,0)
 N STATION,LOSTTIME,NODE,OOPDA,PER,X,Y
"RTN","OOPSGUIT",7,0)
 S RPTTY=$$REPORT(),CS=$S(CSTAT="O":0,CSTAT="C":1,1:"")
"RTN","OOPSGUIT",8,0)
 S LOST=$S(LTNTT="L":"Y",1:"")
"RTN","OOPSGUIT",9,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIT",10,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIT",11,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIT",12,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIT",13,0)
 S LP="",OOPDA=""
"RTN","OOPSGUIT",14,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIT",15,0)
 . F  S OOPDA=$O(^OOPS(2260,"AD",LP,OOPDA)) Q:OOPDA'>0  D
"RTN","OOPSGUIT",16,0)
 .. S OOPS(0)=$G(^OOPS(2260,OOPDA,0))
"RTN","OOPSGUIT",17,0)
 .. S CS1=$P(OOPS(0),U,6)
"RTN","OOPSGUIT",18,0)
 .. I $G(CS1)>1 Q               ; only open & closed cases
"RTN","OOPSGUIT",19,0)
 .. I (CS'=""),(CS'=CS1) Q      ; if 'All cases, case status must match
"RTN","OOPSGUIT",20,0)
 .. S PER=$$GET1^DIQ(2260,OOPDA,2,"I")
"RTN","OOPSGUIT",21,0)
 .. I (+PSTAT)&(PSTAT'[(PER_"^")) Q
"RTN","OOPSGUIT",22,0)
 .. S STATION=$$GET1^DIQ(2260,OOPDA,13,"I")
"RTN","OOPSGUIT",23,0)
 .. I STAT'="A",(STATION'=STAT) Q
"RTN","OOPSGUIT",24,0)
 .. S LOSTTIME=$$GET1^DIQ(2260,OOPDA,33,"I")
"RTN","OOPSGUIT",25,0)
 .. I LOST="Y",(LOSTTIME'="Y") Q
"RTN","OOPSGUIT",26,0)
 .. I RPTTY=3 D
"RTN","OOPSGUIT",27,0)
 ... N INC
"RTN","OOPSGUIT",28,0)
 ... S INC=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",29,0)
 ... I $G(INC)="" S INC="Unknown"
"RTN","OOPSGUIT",30,0)
 ... S:$D(DATA(INC))=0 DATA(INC)=0 S DATA(INC)=DATA(INC)+1
"RTN","OOPSGUIT",31,0)
 .. I RPTTY=15 D
"RTN","OOPSGUIT",32,0)
 ... N DIC,DR,DA,DIQ,FLD,NAME,OCC,IEN450,X,Y
"RTN","OOPSGUIT",33,0)
 ... S NAME=$$GET1^DIQ(2260,OOPDA,1),FLD=16
"RTN","OOPSGUIT",34,0)
 ... S DIC="^PRSPC(",DIC(0)="Z",X=NAME D ^DIC
"RTN","OOPSGUIT",35,0)
 ... I Y>0 D
"RTN","OOPSGUIT",36,0)
 .... K DIQ S DR=FLD,DA=+Y,IEN450=+Y,DIQ="OOPS",DIQ(0)="IE"
"RTN","OOPSGUIT",37,0)
 .... D EN^DIQ1 K DIQ
"RTN","OOPSGUIT",38,0)
 ... S OCC=$$GET1^DIQ(2260,OOPDA,15,"I")
"RTN","OOPSGUIT",39,0)
 ... I $G(IEN450),$G(OCC)'="",(OCC=$E($G(OOPS(450,IEN450,FLD,"I")),1,4)) D
"RTN","OOPSGUIT",40,0)
 .... S OCC=OCC_" - "_OOPS(450,IEN450,FLD,"E")
"RTN","OOPSGUIT",41,0)
 ... I $G(OCC)="" S OCC="Unknown"
"RTN","OOPSGUIT",42,0)
 ... S:$D(DATA(OCC))=0 DATA(OCC)=0 S DATA(OCC)=DATA(OCC)+1
"RTN","OOPSGUIT",43,0)
 .. I RPTTY=29 D
"RTN","OOPSGUIT",44,0)
 ... N CHAR
"RTN","OOPSGUIT",45,0)
 ... S CHAR=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",46,0)
 ... I $G(CHAR)="" S CHAR="Unknown"
"RTN","OOPSGUIT",47,0)
 ... S:$D(DATA(CHAR))=0 DATA(CHAR)=0 S DATA(CHAR)=DATA(CHAR)+1
"RTN","OOPSGUIT",48,0)
 .. I RPTTY=86 D
"RTN","OOPSGUIT",49,0)
 ... N SERV
"RTN","OOPSGUIT",50,0)
 ... S SERV=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",51,0)
 ... I $G(SERV)="" S SERV="Unknown"
"RTN","OOPSGUIT",52,0)
 ... S:$D(DATA(SERV))=0 DATA(SERV)=0 S DATA(SERV)=DATA(SERV)+1
"RTN","OOPSGUIT",53,0)
 .. I RPTTY=30 D
"RTN","OOPSGUIT",54,0)
 ... N BODY
"RTN","OOPSGUIT",55,0)
 ... S BODY=$$GET1^DIQ(2260,OOPDA,RPTTY_":1")
"RTN","OOPSGUIT",56,0)
 ... F I=1:1 Q:$P($T(BODY+I),";",3)="Q"  I $P($T(BODY+I),";",4)[(U_BODY_U) S BODY=$P($T(BODY+I),";",3) Q
"RTN","OOPSGUIT",57,0)
 ... I $G(BODY)="" S BODY="Unknown"
"RTN","OOPSGUIT",58,0)
 ... S:$D(DATA(BODY))=0 DATA(BODY)=0 S DATA(BODY)=DATA(BODY)+1
"RTN","OOPSGUIT",59,0)
 .. I RPTTY=999 D
"RTN","OOPSGUIT",60,0)
 ... N DOI,DOW
"RTN","OOPSGUIT",61,0)
 ... S DOI=$$GET1^DIQ(2260,OOPDA,4,"I"),DOW=$$DOW^XLFDT(DOI)
"RTN","OOPSGUIT",62,0)
 ... S DOW=$S(DOW="Friday":"6Friday",DOW="Monday":"2Monday",DOW="Saturday":"7Saturday",DOW="Sunday":"1Sunday",DOW="Thursday":"5Thursday",DOW="Tuesday":"3Tuesday",DOW="Wednesday":"4Wednesday",1:"Unk")
"RTN","OOPSGUIT",63,0)
 ... I $G(DOI)="" S DOI="Unknown"
"RTN","OOPSGUIT",64,0)
 ... S:$D(DATA(DOW))=0 DATA(DOW)=0 S DATA(DOW)=DATA(DOW)+1
"RTN","OOPSGUIT",65,0)
 .. I RPTTY=9999 D
"RTN","OOPSGUIT",66,0)
 ... N LABEL,TDOI,TIME
"RTN","OOPSGUIT",67,0)
 ... S TDOI=$P($$GET1^DIQ(2260,OOPDA,4),"@",2)
"RTN","OOPSGUIT",68,0)
 ... I $G(TDOI)="" S TDOI="Unknown"
"RTN","OOPSGUIT",69,0)
 ... I TDOI'="Unknown" D
"RTN","OOPSGUIT",70,0)
 .... I +$P(TDOI,":")&($P(TDOI,":")'=24) S TIME=$P(TDOI,":")
"RTN","OOPSGUIT",71,0)
 .... E  S TIME=24
"RTN","OOPSGUIT",72,0)
 .... S LABEL=TIME_":"_"00 - "_TIME_":59"
"RTN","OOPSGUIT",73,0)
 ... I TDOI="Unknown" S LABEL="Unknown"
"RTN","OOPSGUIT",74,0)
 ... S:$D(DATA(LABEL))=0 DATA(LABEL)=0 S DATA(LABEL)=DATA(LABEL)+1
"RTN","OOPSGUIT",75,0)
 S TOT=1,NODE="",CNT=0
"RTN","OOPSGUIT",76,0)
 F  S NODE=$O(DATA(NODE)) Q:NODE=""  S RESULTS(TOT)=NODE_"^"_DATA(NODE),CNT=CNT+$P(RESULTS(TOT),U,2),TOT=TOT+1
"RTN","OOPSGUIT",77,0)
 I CNT S RESULTS(0)=CNT
"RTN","OOPSGUIT",78,0)
 Q
"RTN","OOPSGUIT",79,0)
REPORT() ; Get Fld # to sort on
"RTN","OOPSGUIT",80,0)
 I TRPT="Type of Incidents" S RPTTY=3
"RTN","OOPSGUIT",81,0)
 I TRPT="Occupation Code" S RPTTY=15
"RTN","OOPSGUIT",82,0)
 I TRPT="Characterization of Injury" S RPTTY=29
"RTN","OOPSGUIT",83,0)
 I TRPT="Service" S RPTTY=86
"RTN","OOPSGUIT",84,0)
 I TRPT="Body Parts" S RPTTY=30
"RTN","OOPSGUIT",85,0)
 I TRPT="Day of Week" S RPTTY=999
"RTN","OOPSGUIT",86,0)
 I TRPT="Time of Day" S RPTTY=9999
"RTN","OOPSGUIT",87,0)
 Q RPTTY
"RTN","OOPSGUIT",88,0)
BODY ; group the body parts to min # of columns
"RTN","OOPSGUIT",89,0)
 ;;Abdomen;^BA^V5^VI^V4^V3^VL^VM^VS^
"RTN","OOPSGUIT",90,0)
 ;;Arm(s) Lower;^AS^AB^A4^A6^A3^A5^
"RTN","OOPSGUIT",91,0)
 ;;Arm(s) Upper;^AX^AZ^A2^A1^
"RTN","OOPSGUIT",92,0)
 ;;Back (Lumbar Region);^BL^
"RTN","OOPSGUIT",93,0)
 ;;Back (Upper);^BU^
"RTN","OOPSGUIT",94,0)
 ;;Chest;^BC^RS^
"RTN","OOPSGUIT",95,0)
 ;;Ear(s);^H4^C2^H3^C1^
"RTN","OOPSGUIT",96,0)
 ;;Elbow;^EB^ES^
"RTN","OOPSGUIT",97,0)
 ;;Eye(s);^H2^C4^H1^C3^
"RTN","OOPSGUIT",98,0)
 ;;Face;^CK^HC^HF^CJ^HM^CM^HN^CN^CD^CT^
"RTN","OOPSGUIT",99,0)
 ;;Foot,Includes Toes;^PB^G2^G3^G4^PS^G1^
"RTN","OOPSGUIT",100,0)
 ;;Hand(s),Includes fingers;^F2^F8^MB^F4^F6^TB^FB^FS^F1^F7^MS^F3^F5^TS^
"RTN","OOPSGUIT",101,0)
 ;;Knees;^KB^KS^
"RTN","OOPSGUIT",102,0)
 ;;Leg(s), lower;^L4^L3^
"RTN","OOPSGUIT",103,0)
 ;;Leg(s), upper;^LX^LZ^
"RTN","OOPSGUIT",104,0)
 ;;Neck;^HK^CL^CR^
"RTN","OOPSGUIT",105,0)
 ;;Not Elsewhere Classified;^XZ^L2^LB^BZ^XX^VN^RP^LS^L1^
"RTN","OOPSGUIT",106,0)
 ;;Reproductive Organs;^B2^B4^BP^VR^B1^B3^B5^
"RTN","OOPSGUIT",107,0)
 ;;Ribs;^RB^RC^
"RTN","OOPSGUIT",108,0)
 ;;Shoulder;^R2^R4^SB^R1^R3^SS^
"RTN","OOPSGUIT",109,0)
 ;;Skull/Head;^CB^HX^HZ^CX^CZ^HS^CC^CS^
"RTN","OOPSGUIT",110,0)
 ;;Spinal Cord;^VC^RV^
"RTN","OOPSGUIT",111,0)
 ;;Thorax;^VH^V2^V1^
"RTN","OOPSGUIT",112,0)
 ;;Trunk;^BS^RZ^BX^VX^VZ^RX^BW^
"RTN","OOPSGUIT",113,0)
 ;;Q
"RTN","OOPSGUIT",114,0)
 Q
"RTN","OOPSGUIT",115,0)
ACCID(RESULTS,INPUT,CALL) ; Print Accident Report Status report - get data
"RTN","OOPSGUIT",116,0)
 ;  Input: INPUT - START & END DATE, & 1 Station or all. Format is 
"RTN","OOPSGUIT",117,0)
 ;                 STARTDATE^ENDDATE^STA^CASESTATUS.  STA is A or IEN
"RTN","OOPSGUIT",118,0)
 ;                 of the station to run report for; casestatus = 
"RTN","OOPSGUIT",119,0)
 ;                 case status: open 'O', closed 'C', or both 'A'.
"RTN","OOPSGUIT",120,0)
 ;          CALL - contains the value for calling menu. This excludes
"RTN","OOPSGUIT",121,0)
 ;                 the Persons name if called from Union menu
"RTN","OOPSGUIT",122,0)
 ; Output:  - RESULTS contains the data to be displayed in the report
"RTN","OOPSGUIT",123,0)
 N ARR,CN,IEN,SDATE,SIGN,SIGSTR,STDT,STA,ENDDT,EDATE,X,Y,SUPSTR,EMPSTR
"RTN","OOPSGUIT",124,0)
 N CASE,CAT,DOI,EMP,INC,ISEMP,PERSON,SAF,SSN,SSN1,SP,SUP,WCP,PCE
"RTN","OOPSGUIT",125,0)
 ; patch 4 llh - select by case status
"RTN","OOPSGUIT",126,0)
 N CS,STATUS
"RTN","OOPSGUIT",127,0)
 N S48,S6,S20,S12
"RTN","OOPSGUIT",128,0)
 S S48="                                                "
"RTN","OOPSGUIT",129,0)
 S S6="      ",S12="            ",S20="                    "
"RTN","OOPSGUIT",130,0)
 K ^TMP($J,"ACCID")
"RTN","OOPSGUIT",131,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIT",132,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIT",133,0)
 S STA=$P($G(INPUT),U,3)
"RTN","OOPSGUIT",134,0)
 ; patch 4 llh - case status
"RTN","OOPSGUIT",135,0)
 S STATUS=$P($G(INPUT),U,4)
"RTN","OOPSGUIT",136,0)
 I (STDT="")!(ENDDT="")!(STA="")!(STATUS="") D  Q
"RTN","OOPSGUIT",137,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIT",138,0)
 S STATUS=$S(STATUS="O":0,STATUS="C":1,1:"")
"RTN","OOPSGUIT",139,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIT",140,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIT",141,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIT",142,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIT",143,0)
 S SSN="" I CALL="Employee" S SSN=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUIT",144,0)
 S LP="",IEN=""
"RTN","OOPSGUIT",145,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIT",146,0)
 . F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIT",147,0)
 .. ; patch 4 llh - allow selection on case status
"RTN","OOPSGUIT",148,0)
 .. S CS=$$GET1^DIQ(2260,IEN,51,"I")
"RTN","OOPSGUIT",149,0)
 .. I $G(CS)>1 Q               ; exclude deleted, amended cases
"RTN","OOPSGUIT",150,0)
 .. I (STATUS'=""),(CS'=STATUS) Q  ; if 'All cases, status must match
"RTN","OOPSGUIT",151,0)
 .. S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIT",152,0)
 .. I $G(STA)'="A",STATION'=STA Q
"RTN","OOPSGUIT",153,0)
 .. I (CALL="Supervisor"),($$GET1^DIQ(2260,IEN,53,"I")'=DUZ&($$GET1^DIQ(2260,IEN,53.1,"I")'=DUZ)) Q
"RTN","OOPSGUIT",154,0)
 .. S (ARR,CASE,PERSON,SSN1,DOI,INC,CAT,WCP,EMP,SUP,SAF,SP)=""
"RTN","OOPSGUIT",155,0)
 .. S CASE=$$GET1^DIQ(2260,IEN,.01)
"RTN","OOPSGUIT",156,0)
 .. S (PERSON,SSN1)=""
"RTN","OOPSGUIT",157,0)
 .. I CALL'="Union" S PERSON=$E($$GET1^DIQ(2260,IEN,1),1,30)
"RTN","OOPSGUIT",158,0)
 .. I CALL'="Union" S SSN1=$$GET1^DIQ(2260,IEN,5)
"RTN","OOPSGUIT",159,0)
 .. S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUIT",160,0)
 .. S DOI=$$GET1^DIQ(2260,IEN,4)
"RTN","OOPSGUIT",161,0)
 .. S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSGUIT",162,0)
 .. ; patch 4 llh - get case status title
"RTN","OOPSGUIT",163,0)
 .. S CS=$S(CS=0:"Open",CS=1:"Closed",1:"")
"RTN","OOPSGUIT",164,0)
 .. I SSN1="" S SSN1="           "
"RTN","OOPSGUIT",165,0)
 .. S ARR=" ",^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",166,0)
 .. ;S ARR="Case Number   Name                                 SSN              Date/Time of Incident     Case Status"
"RTN","OOPSGUIT",167,0)
 .. S ARR="Case Number   Name                                 SSN              Case Status    Date/Time of Incident"
"RTN","OOPSGUIT",168,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",169,0)
 .. S PERSON=PERSON_"                            ",PERSON=$E(PERSON,1,37)
"RTN","OOPSGUIT",170,0)
 .. I $L(CASE)=10 S CASE=CASE_" "
"RTN","OOPSGUIT",171,0)
 .. ;patch 4 llh - pad case status title if needed for alignment
"RTN","OOPSGUIT",172,0)
 .. I $L(CS)=4 S CS=CS_"  "
"RTN","OOPSGUIT",173,0)
 .. S ARR=CASE_"   "_PERSON_SSN1_"      "_CS_"         "_DOI
"RTN","OOPSGUIT",174,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",175,0)
 .. I CALL="Employee" Q:SSN'=SSN1
"RTN","OOPSGUIT",176,0)
 .. S ISEMP=$$ISEMP^OOPSUTL4(IEN)
"RTN","OOPSGUIT",177,0)
 .. I 'ISEMP S ISEMP="N/A("_$E($$GET1^DIQ(2260,IEN,2,"E"),1,10)_")"
"RTN","OOPSGUIT",178,0)
 .. S SIGN="",SIGSTR="^^^^^^"
"RTN","OOPSGUIT",179,0)
 .. S SIGN=$P($$EDSTA^OOPSUTL1(IEN,"E"),U,INC)
"RTN","OOPSGUIT",180,0)
 .. S $P(SIGSTR,U,INC)=$S('SIGN:"Un-Signed",SIGN:"Signed",1:"")
"RTN","OOPSGUIT",181,0)
 .. ; if not employee (ISEMP=1) then put value ISEMP in piece
"RTN","OOPSGUIT",182,0)
 .. I 'ISEMP S $P(SIGSTR,U,INC)=ISEMP
"RTN","OOPSGUIT",183,0)
 .. S (SIGN,PCE,SUPSTR)=""
"RTN","OOPSGUIT",184,0)
 .. S SIGN=$$EDSTA^OOPSUTL1(IEN,"S")
"RTN","OOPSGUIT",185,0)
 .. S PCE=INC+2
"RTN","OOPSGUIT",186,0)
 .. I ISEMP S $P(SIGSTR,U,PCE)=$S('$P(SIGN,U,INC):"Un-Signed",$P(SIGN,U,INC):"Signed",1:"")
"RTN","OOPSGUIT",187,0)
 .. S $P(SIGSTR,U,5)=$S($P(SIGN,U,3):"Signed",1:"Un-Signed")
"RTN","OOPSGUIT",188,0)
 .. S SIGN="",SIGN=$$EDSTA^OOPSUTL1(IEN,"O")
"RTN","OOPSGUIT",189,0)
 .. S $P(SIGSTR,U,6)=$S($P(SIGN,U):"Signed",1:"Un-Signed")
"RTN","OOPSGUIT",190,0)
 .. S SIGN="",SIGN=$$GET1^DIQ(2260,IEN,68)
"RTN","OOPSGUIT",191,0)
 .. S $P(SIGSTR,U,7)=$S((($P(SIGN,U)="")&ISEMP):"Un-Signed",($P(SIGN,U)'=""):"Signed",1:"")
"RTN","OOPSGUIT",192,0)
 .. S ARR=S48_"          "_"CA1"_S12_"CA2"_S12_"2162"_S12_"WCP"
"RTN","OOPSGUIT",193,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",194,0)
 .. S ARR=S48_"          "_"---"_S12_"---"_S12_"----"_S12_"---"
"RTN","OOPSGUIT",195,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",196,0)
 .. S EMPSTR=S20_S20_"     Employee:    "
"RTN","OOPSGUIT",197,0)
 .. I INC=1 S ARR=EMPSTR_$P(SIGSTR,U,1)
"RTN","OOPSGUIT",198,0)
 .. I INC=2 S ARR=EMPSTR_S12_"   "_$P(SIGSTR,U,2)
"RTN","OOPSGUIT",199,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",200,0)
 .. S SUPSTR=S20_S20_"   Supervisor:    "
"RTN","OOPSGUIT",201,0)
 .. I 'ISEMP S SUPSTR=SUPSTR_"         "
"RTN","OOPSGUIT",202,0)
 .. I INC=1 D
"RTN","OOPSGUIT",203,0)
 ... I $P(SIGSTR,U,3)="Signed" S ARR=SUPSTR_$P(SIGSTR,U,3)_S20_"    "_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",204,0)
 ... E  S ARR=SUPSTR_$P(SIGSTR,U,3)_S20_" "_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",205,0)
 .. I INC=2 D
"RTN","OOPSGUIT",206,0)
 ... I $P(SIGSTR,U,4)="Signed" S ARR=SUPSTR_S12_"   "_$P(SIGSTR,U,4)_S6_"   "_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",207,0)
 ... E  S ARR=SUPSTR_S12_"   "_$P(SIGSTR,U,4)_S6_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",208,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",209,0)
 .. S ARR=S20_S12_"       Safety Officer:"_S20_S12_"  "_$P(SIGSTR,U,6)
"RTN","OOPSGUIT",210,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",211,0)
 .. S ARR=S20_S12_"        Workers' Comp:"_S48_"  "_$P(SIGSTR,U,7)
"RTN","OOPSGUIT",212,0)
 .. S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",213,0)
 S RESULTS=$NA(^TMP($J,"ACCID"))
"RTN","OOPSGUIT",214,0)
 Q
"RTN","OOPSMBUL")
0^9^B21801077
"RTN","OOPSMBUL",1,0)
OOPSMBUL ;HIRMFO/REL-Bulletin ;3/30/98
"RTN","OOPSMBUL",2,0)
 ;;2.0;ASISTS;**2,4**;Jun 03, 2002
"RTN","OOPSMBUL",3,0)
 Q
"RTN","OOPSMBUL",4,0)
MFAC ;
"RTN","OOPSMBUL",5,0)
 N NIEN,NGRP,TEST
"RTN","OOPSMBUL",6,0)
 S NIEN=$$GET1^DIQ(2260,IEN,13,"I")
"RTN","OOPSMBUL",7,0)
 S NGRP=GRP_" - "_$$GET1^DIQ(4,NIEN,99,"E")
"RTN","OOPSMBUL",8,0)
 S TEST=$$FIND1^DIC(3.8,"","AMX",NGRP)
"RTN","OOPSMBUL",9,0)
 I TEST S GRP=NGRP
"RTN","OOPSMBUL",10,0)
 D GRP
"RTN","OOPSMBUL",11,0)
 Q
"RTN","OOPSMBUL",12,0)
CASE(IEN) ;
"RTN","OOPSMBUL",13,0)
 N CN,SUP,SUP2,Y,GRP
"RTN","OOPSMBUL",14,0)
 S XMB="OOPS CASE",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",15,0)
 S CN=$P(X0,U,1),SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",16,0)
 S SUP2=$P(X0,U,9) I SUP2>0 S XMY(SUP2)=""
"RTN","OOPSMBUL",17,0)
 S XMB(3)=CN
"RTN","OOPSMBUL",18,0)
 ; V2 - 05/09/02 LLH - add whether inj or illness
"RTN","OOPSMBUL",19,0)
 S XMB(6)=$$GET1^DIQ(2260,IEN,52)
"RTN","OOPSMBUL",20,0)
 ; Patch 8 - added display of supervisors name to bulletin
"RTN","OOPSMBUL",21,0)
 S XMB(4)=$$GET1^DIQ(200,SUP,.01,"E")
"RTN","OOPSMBUL",22,0)
 I SUP2>0 S XMB(5)=$$GET1^DIQ(200,SUP2,.01,"E")
"RTN","OOPSMBUL",23,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",24,0)
 S Y=$P(X0,U,3)
"RTN","OOPSMBUL",25,0)
 S GRP="OOPS INJURY"
"RTN","OOPSMBUL",26,0)
 D MFAC
"RTN","OOPSMBUL",27,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",28,0)
 D MFAC
"RTN","OOPSMBUL",29,0)
 I $P(X0,U,4)>10 S GRP="OOPS EH" D MFAC
"RTN","OOPSMBUL",30,0)
 ; next 2 lines restrict access to delivered message - 060303 LLH
"RTN","OOPSMBUL",31,0)
 S XMBODY="",XMINSTR("FLAGS")="IX"
"RTN","OOPSMBUL",32,0)
 D TASKBULL^XMXAPI(DUZ,"OOPS CASE",.XMB,XMBODY,.XMY,.XMINSTR)
"RTN","OOPSMBUL",33,0)
 Q
"RTN","OOPSMBUL",34,0)
SAFETY(IEN) ; Safety Officer Bulletin
"RTN","OOPSMBUL",35,0)
 N GRP
"RTN","OOPSMBUL",36,0)
 S XMB="OOPS SAFETY",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",37,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",38,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",39,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",40,0)
 S GRP="OOPS SAFETY"
"RTN","OOPSMBUL",41,0)
 D MFAC
"RTN","OOPSMBUL",42,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",43,0)
 Q
"RTN","OOPSMBUL",44,0)
CLSCASE(IEN) ; Bulletin to Safety & WC whenever a case is closed
"RTN","OOPSMBUL",45,0)
 ;  01/02/04 Patch 4, llh
"RTN","OOPSMBUL",46,0)
 ;  Input
"RTN","OOPSMBUL",47,0)
 ;    IEN - Internal record number
"RTN","OOPSMBUL",48,0)
 ;
"RTN","OOPSMBUL",49,0)
 N GRP
"RTN","OOPSMBUL",50,0)
 K XMB,XMY,X0
"RTN","OOPSMBUL",51,0)
 S XMB="OOPS CASE CLOSE NOTIFICATION"
"RTN","OOPSMBUL",52,0)
 S X0=$P($G(^OOPS(2260,IEN,0),"CASE UNDEFINED"),U)
"RTN","OOPSMBUL",53,0)
 S XMB(1)=X0                             ; case number
"RTN","OOPSMBUL",54,0)
 S XMB(2)=$$GET1^DIQ(200,DUZ,.01,"E")    ; name of user closing case
"RTN","OOPSMBUL",55,0)
 S XMB(3)=$$FMTE^XLFDT($$DT^XLFDT())     ; today's date
"RTN","OOPSMBUL",56,0)
 S GRP="OOPS WCP" D MFAC
"RTN","OOPSMBUL",57,0)
 D ^XMB
"RTN","OOPSMBUL",58,0)
 S GRP="OOPS SAFETY" D MFAC
"RTN","OOPSMBUL",59,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0
"RTN","OOPSMBUL",60,0)
 Q
"RTN","OOPSMBUL",61,0)
WCPBOR(IEN) ; Employee does not understand bill of rights, sent msg to wcp
"RTN","OOPSMBUL",62,0)
 ; Input
"RTN","OOPSMBUL",63,0)
 ;   IEN - Internal record number
"RTN","OOPSMBUL",64,0)
 ;
"RTN","OOPSMBUL",65,0)
 N GRP,X0
"RTN","OOPSMBUL",66,0)
 S X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",67,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",68,0)
 S XMB="OOPS WCPBOR"
"RTN","OOPSMBUL",69,0)
 S GRP="OOPS WCP"
"RTN","OOPSMBUL",70,0)
 D MFAC
"RTN","OOPSMBUL",71,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",72,0)
 Q
"RTN","OOPSMBUL",73,0)
CONSENT(IEN,UNIREP) ; Employee consented to union notification, 
"RTN","OOPSMBUL",74,0)
 ;                 send msg to union
"RTN","OOPSMBUL",75,0)
 ; Input
"RTN","OOPSMBUL",76,0)
 ;    IEN - Internal record number
"RTN","OOPSMBUL",77,0)
 ; UNIREP - IEN from file 200 of the Union Rep - used to send bulletin
"RTN","OOPSMBUL",78,0)
 ;
"RTN","OOPSMBUL",79,0)
 N GRP,X0,XA
"RTN","OOPSMBUL",80,0)
 S X0=$G(^OOPS(2260,IEN,0))
"RTN","OOPSMBUL",81,0)
 S XA=$G(^OOPS(2260,IEN,"2162A")) K XMY
"RTN","OOPSMBUL",82,0)
 S XMY(UNIREP)=""
"RTN","OOPSMBUL",83,0)
 S XMB(1)=$P(X0,U),Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",84,0)
 S XMB(3)=$$GET1^DIQ(2260,IEN,52)
"RTN","OOPSMBUL",85,0)
 S XMB(4)=$$GET1^DIQ(2260,IEN,2)
"RTN","OOPSMBUL",86,0)
 S XMB(5)=$$GET1^DIQ(2260,IEN,7)
"RTN","OOPSMBUL",87,0)
 S XMB(6)=$$GET1^DIQ(2260,IEN,13,"I")
"RTN","OOPSMBUL",88,0)
 S XMB(7)=$E($$GET1^DIQ(2260,IEN,18),1,28)
"RTN","OOPSMBUL",89,0)
 S XMB(8)=$$GET1^DIQ(2260,IEN,14)
"RTN","OOPSMBUL",90,0)
 S XMB(9)=$P(XA,U,12)_"/"_$P(XA,U,13)
"RTN","OOPSMBUL",91,0)
 S XMB(10)=$E($$GET1^DIQ(2260,IEN,53),1,23)
"RTN","OOPSMBUL",92,0)
 S XMB(11)=$E($$GET1^DIQ(2260,IEN,53.1),1,28)
"RTN","OOPSMBUL",93,0)
 S XMB(12)=$E($$GET1^DIQ(2260,IEN,3),1,23)
"RTN","OOPSMBUL",94,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",95,0)
 S XMB="OOPS CONSENT"
"RTN","OOPSMBUL",96,0)
 D ^XMB K XMB,XMY,XMM,XMDT,XMDUZ
"RTN","OOPSMBUL",97,0)
 Q
"RTN","OOPSMBUL",98,0)
WCP(IEN,ACT) ; Bulletin to Super when WC edits or WX signs CA1/CA2
"RTN","OOPSMBUL",99,0)
 ; Input
"RTN","OOPSMBUL",100,0)
 ;   IEN - Internal record number
"RTN","OOPSMBUL",101,0)
 ;   ACT -
"RTN","OOPSMBUL",102,0)
 ;    "E" = Edited by the WC personnel
"RTN","OOPSMBUL",103,0)
 ;    "S" = Signed by the WC personnel
"RTN","OOPSMBUL",104,0)
 ;
"RTN","OOPSMBUL",105,0)
 N SUP,SUP2,Y
"RTN","OOPSMBUL",106,0)
 S XMB=$S(ACT="E":"OOPS WC EDITED",ACT="S":"OOPS WC SIGNED",1:"")
"RTN","OOPSMBUL",107,0)
 I $G(XMB)="" Q
"RTN","OOPSMBUL",108,0)
 S X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",109,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",110,0)
 S SUP2=$P(X0,U,9) I $G(SUP2) S XMY(SUP2)=""
"RTN","OOPSMBUL",111,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",112,0)
 S XMB(2)=$P(X0,U,1)
"RTN","OOPSMBUL",113,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(3)=Y
"RTN","OOPSMBUL",114,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",115,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0,XMDUZ
"RTN","OOPSMBUL",116,0)
 Q
"RTN","OOPSMBUL",117,0)
SUPS(IEN) ; Bulletin to WC when Supervisor signs CA1/CA2
"RTN","OOPSMBUL",118,0)
 ; Patch 8
"RTN","OOPSMBUL",119,0)
 N SUP,SUP2,FORM,GRP,Y
"RTN","OOPSMBUL",120,0)
 S XMB="OOPS WORKERS COMP",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",121,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",122,0)
 S SUP2=$P(X0,U,9) I $G(SUP2) S XMY(SUP2)=""
"RTN","OOPSMBUL",123,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",124,0)
 S XMB(2)=$P(X0,U,1)
"RTN","OOPSMBUL",125,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(3)=Y
"RTN","OOPSMBUL",126,0)
 S FORM=$P(X0,U,7)
"RTN","OOPSMBUL",127,0)
 S FORM=$S(FORM=1:"CA1ES",FORM=2:"CA2ES",1:"")
"RTN","OOPSMBUL",128,0)
 I FORM="" Q
"RTN","OOPSMBUL",129,0)
 S Y=$P(^OOPS(2260,IEN,FORM),U,6) D DD^%DT S XMB(4)=Y
"RTN","OOPSMBUL",130,0)
 S GRP="OOPS WCP"
"RTN","OOPSMBUL",131,0)
 D MFAC
"RTN","OOPSMBUL",132,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0
"RTN","OOPSMBUL",133,0)
 Q
"RTN","OOPSMBUL",134,0)
UNION(IEN) ; Union  Bulletin
"RTN","OOPSMBUL",135,0)
 N GRP,Y
"RTN","OOPSMBUL",136,0)
 S XMB="OOPS SUPERVISOR",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",137,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",138,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",139,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",140,0)
 D MFAC
"RTN","OOPSMBUL",141,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",142,0)
 Q
"RTN","OOPSMBUL",143,0)
EMP(IEN) ; Employee notification to supervisor
"RTN","OOPSMBUL",144,0)
 N GRP,SUP,SUP2
"RTN","OOPSMBUL",145,0)
 S XMB="OOPS EMPLOYEE",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",146,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",147,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",148,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",149,0)
 S SUP2=$P(X0,U,9) I SUP2>0 S XMY(SUP2)=""
"RTN","OOPSMBUL",150,0)
 S GRP="OOPS INJURY"
"RTN","OOPSMBUL",151,0)
 D MFAC
"RTN","OOPSMBUL",152,0)
 D ^XMB K XMY,XMM,XMDT
"RTN","OOPSMBUL",153,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",154,0)
 D MFAC
"RTN","OOPSMBUL",155,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",156,0)
 D ^XMB K XMB,XMY,XMM,XMDT,XMDUZ
"RTN","OOPSMBUL",157,0)
 Q
"RTN","OOPSMBUL",158,0)
BOR(IEN) ; Employee Bill of Rights
"RTN","OOPSMBUL",159,0)
 N EMP
"RTN","OOPSMBUL",160,0)
 S XMB="OOPS BILL OF RIGHTS" K XMY
"RTN","OOPSMBUL",161,0)
 S EMP=$O(^VA(200,"SSN",SSN,0)),XMY(EMP)=""
"RTN","OOPSMBUL",162,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",163,0)
 Q
"RTN","OOPSMBUL",164,0)
GRP ; Get Mail group Members for GRP
"RTN","OOPSMBUL",165,0)
 I GRP="" Q
"RTN","OOPSMBUL",166,0)
 S XMY("I:G."_GRP)=""
"RTN","OOPSMBUL",167,0)
 Q
"VER")
8.0^22
"^DD",2261.2,2261.2,0)
FIELD^^1^2
"^DD",2261.2,2261.2,0,"DDA")
N
"^DD",2261.2,2261.2,0,"DT")
2980311
"^DD",2261.2,2261.2,0,"IX","B",2261.2,.01)

"^DD",2261.2,2261.2,0,"IX","C",2261.2,1)

"^DD",2261.2,2261.2,0,"IX","D",2261.2,.01)

"^DD",2261.2,2261.2,0,"NM","ASISTS CRITICAL TRACKING ISSUES")

"^DD",2261.2,2261.2,0,"PT",2260,3)

"^DD",2261.2,2261.2,0,"VRPK")
OOPS
"^DD",2261.2,2261.2,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",2261.2,2261.2,.01,1,0)
^.1
"^DD",2261.2,2261.2,.01,1,1,0)
2261.2^B
"^DD",2261.2,2261.2,.01,1,1,1)
S ^OOPS(2261.2,"B",$E(X,1,30),DA)=""
"^DD",2261.2,2261.2,.01,1,1,2)
K ^OOPS(2261.2,"B",$E(X,1,30),DA)
"^DD",2261.2,2261.2,.01,1,2,0)
2261.2^D^MUMPS
"^DD",2261.2,2261.2,.01,1,2,1)
S ^OOPS(2261.2,"D",$$UP^OOPSUTL4($E(X,1,30)),DA)=""
"^DD",2261.2,2261.2,.01,1,2,2)
K ^OOPS(2261.2,"D",$$UP^OOPSUTL4($E(X,1,30)),DA)
"^DD",2261.2,2261.2,.01,1,2,"%D",0)
^^2^2^2980505^^
"^DD",2261.2,2261.2,.01,1,2,"%D",1,0)
This cross-reference allows selection of entries by upper-case
"^DD",2261.2,2261.2,.01,1,2,"%D",2,0)
values.
"^DD",2261.2,2261.2,.01,1,2,"DT")
2980505
"^DD",2261.2,2261.2,.01,3)
Answer must be 3-30 characters in length.
"^DD",2261.2,2261.2,.01,21,0)
^^1^1^2980311^
"^DD",2261.2,2261.2,.01,21,1,0)
Enter a injury category name.
"^DD",2261.2,2261.2,.01,"DT")
2980505
"^DD",2261.2,2261.2,1,0)
CASE^NJ3,0^^0;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",2261.2,2261.2,1,1,0)
^.1
"^DD",2261.2,2261.2,1,1,1,0)
2261.2^C
"^DD",2261.2,2261.2,1,1,1,1)
S ^OOPS(2261.2,"C",$E(X,1,30),DA)=""
"^DD",2261.2,2261.2,1,1,1,2)
K ^OOPS(2261.2,"C",$E(X,1,30),DA)
"^DD",2261.2,2261.2,1,1,1,"DT")
2980311
"^DD",2261.2,2261.2,1,3)
Type a Number between 0 and 999, 0 Decimal Digits
"^DD",2261.2,2261.2,1,21,0)
^^1^1^2980311^
"^DD",2261.2,2261.2,1,21,1,0)
Enter a code that identifies a injury category.
"^DD",2261.2,2261.2,1,"DT")
2980311
"^DIC",2261.2,2261.2,0)
ASISTS CRITICAL TRACKING ISSUES^2261.2
"^DIC",2261.2,2261.2,0,"GL")
^OOPS(2261.2,
"^DIC",2261.2,2261.2,"%D",0)
^^3^3^2980414^^^
"^DIC",2261.2,2261.2,"%D",1,0)
This file contains a list of terms used to categorize the type of injury
"^DIC",2261.2,2261.2,"%D",2,0)
sustained by the employee.  Each term is associated with a code.  File
"^DIC",2261.2,2261.2,"%D",3,0)
data is exported with the package and should not be edited by the site.
"^DIC",2261.2,"B","ASISTS CRITICAL TRACKING ISSUES",2261.2)

**END**
**END**
