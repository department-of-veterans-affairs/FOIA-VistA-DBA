Released ROR*1*7 SEQ #6
Extracted from mail message
**KIDS**:ROR*1.0*7^

**INSTALL NAME**
ROR*1.0*7
"BLD",4961,0)
ROR*1.0*7^CLINICAL CASE REGISTRIES^0^3040628^y
"BLD",4961,1,0)
^^1^1^3040319^
"BLD",4961,1,1,0)
Updates for the Code Text Descriptors project.
"BLD",4961,4,0)
^9.64PA^^
"BLD",4961,"ABPKG")
n
"BLD",4961,"KRN",0)
^9.67PA^8989.52^19
"BLD",4961,"KRN",.4,0)
.4
"BLD",4961,"KRN",.401,0)
.401
"BLD",4961,"KRN",.402,0)
.402
"BLD",4961,"KRN",.403,0)
.403
"BLD",4961,"KRN",.5,0)
.5
"BLD",4961,"KRN",.84,0)
.84
"BLD",4961,"KRN",3.6,0)
3.6
"BLD",4961,"KRN",3.8,0)
3.8
"BLD",4961,"KRN",9.2,0)
9.2
"BLD",4961,"KRN",9.8,0)
9.8
"BLD",4961,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4961,"KRN",9.8,"NM",1,0)
RORX013A^^0^B51263352
"BLD",4961,"KRN",9.8,"NM",2,0)
RORRP016^^0^B10918899
"BLD",4961,"KRN",9.8,"NM","B","RORRP016",2)

"BLD",4961,"KRN",9.8,"NM","B","RORX013A",1)

"BLD",4961,"KRN",19,0)
19
"BLD",4961,"KRN",19.1,0)
19.1
"BLD",4961,"KRN",101,0)
101
"BLD",4961,"KRN",409.61,0)
409.61
"BLD",4961,"KRN",771,0)
771
"BLD",4961,"KRN",870,0)
870
"BLD",4961,"KRN",8989.51,0)
8989.51
"BLD",4961,"KRN",8989.52,0)
8989.52
"BLD",4961,"KRN",8994,0)
8994
"BLD",4961,"KRN","B",.4,.4)

"BLD",4961,"KRN","B",.401,.401)

"BLD",4961,"KRN","B",.402,.402)

"BLD",4961,"KRN","B",.403,.403)

"BLD",4961,"KRN","B",.5,.5)

"BLD",4961,"KRN","B",.84,.84)

"BLD",4961,"KRN","B",3.6,3.6)

"BLD",4961,"KRN","B",3.8,3.8)

"BLD",4961,"KRN","B",9.2,9.2)

"BLD",4961,"KRN","B",9.8,9.8)

"BLD",4961,"KRN","B",19,19)

"BLD",4961,"KRN","B",19.1,19.1)

"BLD",4961,"KRN","B",101,101)

"BLD",4961,"KRN","B",409.61,409.61)

"BLD",4961,"KRN","B",771,771)

"BLD",4961,"KRN","B",870,870)

"BLD",4961,"KRN","B",8989.51,8989.51)

"BLD",4961,"KRN","B",8989.52,8989.52)

"BLD",4961,"KRN","B",8994,8994)

"BLD",4961,"QUES",0)
^9.62^^
"BLD",4961,"REQB",0)
^9.611^1^1
"BLD",4961,"REQB",1,0)
ROR*1.0*5^2
"BLD",4961,"REQB","B","ROR*1.0*5",1)

"MBREQ")
0
"PKG",389,-1)
1^1
"PKG",389,0)
CLINICAL CASE REGISTRIES^ROR^CLINICAL CASE REGISTRIES
"PKG",389,20,0)
^9.402P^^
"PKG",389,22,0)
^9.49I^1^1
"PKG",389,22,1,0)
1.0^3020515^3020726^222222227
"PKG",389,22,1,"PAH",1,0)
7^3040628
"PKG",389,22,1,"PAH",1,1,0)
^^1^1^3040628
"PKG",389,22,1,"PAH",1,1,1,0)
Updates for the Code Text Descriptors project.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RORRP016")
0^2^B10918899
"RTN","RORRP016",1,0)
RORRP016 ;HCIOFO/SG - RPC: ICD-9 CODES ; 9/19/03 2:03pm
"RTN","RORRP016",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,7**;May 14, 2002
"RTN","RORRP016",3,0)
 ;
"RTN","RORRP016",4,0)
 ; This routine uses the following IAs:
"RTN","RORRP016",5,0)
 ;
"RTN","RORRP016",6,0)
 ; #10082        Access to the file #80 (supported)
"RTN","RORRP016",7,0)
 ;
"RTN","RORRP016",8,0)
 Q
"RTN","RORRP016",9,0)
 ;
"RTN","RORRP016",10,0)
 ;***** RETURNS THE LIST OF ICD-9 CODES
"RTN","RORRP016",11,0)
 ; RPC: [ROR LIST ICD-9]
"RTN","RORRP016",12,0)
 ;
"RTN","RORRP016",13,0)
 ; .RESULTS      Reference to a local variable where the results
"RTN","RORRP016",14,0)
 ;               are returned to.
"RTN","RORRP016",15,0)
 ;
"RTN","RORRP016",16,0)
 ; [PART]        The partial match restriction.
"RTN","RORRP016",17,0)
 ;
"RTN","RORRP016",18,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORRP016",19,0)
 ;                 A  Select active codes (default)
"RTN","RORRP016",20,0)
 ;                 B  Backwards. Traverses the index in the opposite
"RTN","RORRP016",21,0)
 ;                    direction of normal traversal
"RTN","RORRP016",22,0)
 ;                 F  Exclude codes not applicable to females
"RTN","RORRP016",23,0)
 ;                 I  Select inactive codes
"RTN","RORRP016",24,0)
 ;                 M  Exclude codes not applicable to males
"RTN","RORRP016",25,0)
 ;                 P  Select only those codes that are acceptable
"RTN","RORRP016",26,0)
 ;                    as primary diagnoses
"RTN","RORRP016",27,0)
 ;
"RTN","RORRP016",28,0)
 ; [NUMBER]      Maximum number of entries to return. A value of "*"
"RTN","RORRP016",29,0)
 ;               or no value in this parameter designates all entries.
"RTN","RORRP016",30,0)
 ;
"RTN","RORRP016",31,0)
 ; [FROM]        The index entry(s) from which to begin the list
"RTN","RORRP016",32,0)
 ;                 ^01: FromName
"RTN","RORRP016",33,0)
 ;                 ^02: FromIEN
"RTN","RORRP016",34,0)
 ;
"RTN","RORRP016",35,0)
 ;               For example, a FROM value of "51" would list entries
"RTN","RORRP016",36,0)
 ;               following 51. You can use the 2-nd and 3-rd "^"-
"RTN","RORRP016",37,0)
 ;               pieces of the @RESULTS@(0) node to continue the
"RTN","RORRP016",38,0)
 ;               listing in the subsequent procedure calls.
"RTN","RORRP016",39,0)
 ;
"RTN","RORRP016",40,0)
 ;               NOTE: The FROM value itself is not included in
"RTN","RORRP016",41,0)
 ;                     the resulting list.
"RTN","RORRP016",42,0)
 ;
"RTN","RORRP016",43,0)
 ; The ^TMP("DILIST",$J) global node is used by the procedure.
"RTN","RORRP016",44,0)
 ;
"RTN","RORRP016",45,0)
 ; See description of the LIST^DIC for more details about the
"RTN","RORRP016",46,0)
 ; PART, NUMBER and FROM parameters.
"RTN","RORRP016",47,0)
 ;
"RTN","RORRP016",48,0)
 ; Return Values:
"RTN","RORRP016",49,0)
 ;
"RTN","RORRP016",50,0)
 ; A negative value of the first "^"-piece of the @RESULTS@(0)
"RTN","RORRP016",51,0)
 ; indicates an error (see the RPCSTK^RORERR procedure for more
"RTN","RORRP016",52,0)
 ; details).
"RTN","RORRP016",53,0)
 ;
"RTN","RORRP016",54,0)
 ; Otherwise, number of ICD-9 codes and the value of the FROM
"RTN","RORRP016",55,0)
 ; parameter for the next procedure call are returned in the
"RTN","RORRP016",56,0)
 ; @RESULTS@(0) and the subsequent nodes of the global array
"RTN","RORRP016",57,0)
 ; contain the codes.
"RTN","RORRP016",58,0)
 ; 
"RTN","RORRP016",59,0)
 ; @RESULTS@(0)          Result Descriptor
"RTN","RORRP016",60,0)
 ;                         ^01: Number of codes
"RTN","RORRP016",61,0)
 ;                         ^02: FromName
"RTN","RORRP016",62,0)
 ;                         ^03: FromIEN
"RTN","RORRP016",63,0)
 ;
"RTN","RORRP016",64,0)
 ; @RESULTS@(i)          ICD-9
"RTN","RORRP016",65,0)
 ;                         ^01: IEN
"RTN","RORRP016",66,0)
 ;                         ^02: Diagnosis
"RTN","RORRP016",67,0)
 ;                         ^03: Code
"RTN","RORRP016",68,0)
 ;                         ^04: Use only with Sex
"RTN","RORRP016",69,0)
 ;                         ^05: Inactive (""/1)
"RTN","RORRP016",70,0)
 ;                         ^06: Inactivation Date (internal)
"RTN","RORRP016",71,0)
 ;
"RTN","RORRP016",72,0)
ICD9LIST(RESULTS,PART,FLAGS,NUMBER,FROM) ;
"RTN","RORRP016",73,0)
 N BUF,RC,RORERRDL,RORMSG,SCR,TMP
"RTN","RORRP016",74,0)
 D CLEAR^RORERR("ICD9LIST^RORRP016",1)
"RTN","RORRP016",75,0)
 K RESULTS  S RESULTS=$NA(^TMP("DILIST",$J))  K @RESULTS
"RTN","RORRP016",76,0)
 ;--- Check the parameters
"RTN","RORRP016",77,0)
 S PART=$G(PART),FLAGS=$G(FLAGS)
"RTN","RORRP016",78,0)
 S NUMBER=$S($G(NUMBER)>0:+NUMBER,1:"*")
"RTN","RORRP016",79,0)
 ;--- If neither "A" nor "I" flag is provided, add the "A" (default)
"RTN","RORRP016",80,0)
 S:$TR(FLAGS,"AI")=FLAGS FLAGS=FLAGS_"A"
"RTN","RORRP016",81,0)
 ;--- Setup the start point
"RTN","RORRP016",82,0)
 I $G(FROM)'=""  D  S FROM=$P(FROM,U)
"RTN","RORRP016",83,0)
 . S:$P(FROM,U,2)>0 FROM("IEN")=+$P(FROM,U,2)
"RTN","RORRP016",84,0)
 E  S FROM=$S(FLAGS["B":"",1:PART_" ")
"RTN","RORRP016",85,0)
 ;--- Compile the screen logic (be careful with naked references)
"RTN","RORRP016",86,0)
 S SCR=""
"RTN","RORRP016",87,0)
 S:FLAGS'["A" SCR=SCR_"I $P(D,U,9) "
"RTN","RORRP016",88,0)
 S:FLAGS'["I" SCR=SCR_"I '$P(D,U,9) "
"RTN","RORRP016",89,0)
 S:FLAGS["F" SCR=SCR_"I $P(D,U,10)'=""M"" "
"RTN","RORRP016",90,0)
 S:FLAGS["M" SCR=SCR_"I $P(D,U,10)'=""F"" "
"RTN","RORRP016",91,0)
 S:FLAGS["P" SCR=SCR_"I '$P(D,U,4) "
"RTN","RORRP016",92,0)
 S:SCR'="" SCR="S D=$G(^(0)) "_SCR
"RTN","RORRP016",93,0)
 ;--- Get the list of codes
"RTN","RORRP016",94,0)
 S BUF="@;3;.01;9.5I;100I;102I",TMP="P"_$S(FLAGS["B":"B",1:"")
"RTN","RORRP016",95,0)
 D LIST^DIC(80,,BUF,TMP,NUMBER,.FROM,PART,"BA",SCR,,,"RORMSG")
"RTN","RORRP016",96,0)
 I $G(DIERR)  D  D RPCSTK^RORERR(.RESULTS,RC)  Q
"RTN","RORRP016",97,0)
 . S RC=$$DBS^RORERR("RORMSG",-9,,,80)
"RTN","RORRP016",98,0)
 . K ^TMP("DILIST",$J)
"RTN","RORRP016",99,0)
 ;--- Success
"RTN","RORRP016",100,0)
 S TMP=$G(^TMP("DILIST",$J,0)),BUF=+$P(TMP,U)
"RTN","RORRP016",101,0)
 K ^TMP("DILIST",$J,0)
"RTN","RORRP016",102,0)
 S:$P(TMP,U,3) $P(BUF,U,2,3)=$G(FROM)_U_$G(FROM("IEN"))
"RTN","RORRP016",103,0)
 S @RESULTS@(0)=BUF
"RTN","RORRP016",104,0)
 D CODEVER
"RTN","RORRP016",105,0)
 Q
"RTN","RORRP016",106,0)
 ;
"RTN","RORRP016",107,0)
 ;----------------------------------------------------------------
"RTN","RORRP016",108,0)
 ;
"RTN","RORRP016",109,0)
 ; Sets the correct version of the diagnosis code short description
"RTN","RORRP016",110,0)
 ;
"RTN","RORRP016",111,0)
CODEVER ;
"RTN","RORRP016",112,0)
 N RORCD,RORDIAG,RORDTE,RORSTR,RORSUB
"RTN","RORRP016",113,0)
 S RORDTE=$$DATE(),RORSUB=0
"RTN","RORRP016",114,0)
 F  S RORSUB=$O(@RESULTS@(RORSUB)) Q:'RORSUB  D
"RTN","RORRP016",115,0)
 . S RORSTR=@RESULTS@(RORSUB,0)
"RTN","RORRP016",116,0)
 . S RORCD=$P(RORSTR,U)
"RTN","RORRP016",117,0)
 . S RORDIAG="* "_$$DIAGTXT(RORCD,RORDTE)
"RTN","RORRP016",118,0)
 . S $P(RORSTR,U,2)=RORDIAG
"RTN","RORRP016",119,0)
 . S @RESULTS@(RORSUB,0)=RORSTR
"RTN","RORRP016",120,0)
 Q
"RTN","RORRP016",121,0)
 ;
"RTN","RORRP016",122,0)
 ;
"RTN","RORRP016",123,0)
DIAGTXT(RORQDCDS,RORDATE) ;  Get Short ICD9 Description
"RTN","RORRP016",124,0)
 N DIAGTXT
"RTN","RORRP016",125,0)
 I RORDATE="" S RORDATE=$$DATE()
"RTN","RORRP016",126,0)
 S DIAGTXT=$$ICDDX^ICDCODE(RORQDCDS,RORDATE)
"RTN","RORRP016",127,0)
 S DIAGTXT=$P(DIAGTXT,"^",4)
"RTN","RORRP016",128,0)
 Q DIAGTXT
"RTN","RORRP016",129,0)
 ;
"RTN","RORRP016",130,0)
DATE() ;
"RTN","RORRP016",131,0)
 D NOW^%DTC
"RTN","RORRP016",132,0)
 Q $P(%,".",1)
"RTN","RORRP016",133,0)
 ;
"RTN","RORX013A")
0^1^B51263352
"RTN","RORX013A",1,0)
RORX013A ;HCIOFO/SG - DIAGNOSIS CODES (QUERY & SORT) ; 4/19/04 11:38am
"RTN","RORX013A",2,0)
 ;;1.0;CLINICAL CASE REGISTRIES;**5,7**;Feb 09, 1998
"RTN","RORX013A",3,0)
 ;
"RTN","RORX013A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX013A",5,0)
 ;
"RTN","RORX013A",6,0)
 ; #928          ACTIVE^GMPLUTL
"RTN","RORX013A",7,0)
 ; #1554         POV^PXAPIIB (controlled)
"RTN","RORX013A",8,0)
 ; #1900-F       SELECTED^VSIT (controlled)
"RTN","RORX013A",9,0)
 ; #2977         GETFLDS^GMPLEDT3
"RTN","RORX013A",10,0)
 ; #3157         RPC^DGPTFAPI (supported)
"RTN","RORX013A",11,0)
 ; #3545         Access to the "AAD" cross-reference and the field 80
"RTN","RORX013A",12,0)
 ; #3990         ^ICDCODE
"RTN","RORX013A",13,0)
 ; #10082        Read access to the file #80 (supported)
"RTN","RORX013A",14,0)
 ;
"RTN","RORX013A",15,0)
 Q
"RTN","RORX013A",16,0)
 ;
"RTN","RORX013A",17,0)
 ;**** STORES THE ICD-9 CODE
"RTN","RORX013A",18,0)
 ;
"RTN","RORX013A",19,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",20,0)
 ; [ICD9IEN]     IEN of the ICD-9 descriptor in file #80
"RTN","RORX013A",21,0)
 ; DATE          Date when the code was entered
"RTN","RORX013A",22,0)
 ; [ICD9]        ICD-9 code
"RTN","RORX013A",23,0)
 ;
"RTN","RORX013A",24,0)
 ; Either the ICD9IEN or the ICD9 parameter must be provided.
"RTN","RORX013A",25,0)
 ;
"RTN","RORX013A",26,0)
 ; Return Values:
"RTN","RORX013A",27,0)
 ;       <0  Error code
"RTN","RORX013A",28,0)
 ;        0  Ok
"RTN","RORX013A",29,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",30,0)
 ;
"RTN","RORX013A",31,0)
ICD9SET(PATIEN,ICD9IEN,DATE,ICD9) ;
"RTN","RORX013A",32,0)
 Q:DATE'>0
"RTN","RORX013A",33,0)
 N TMP
"RTN","RORX013A",34,0)
 S ICD9IEN=+$G(ICD9IEN)
"RTN","RORX013A",35,0)
 I ICD9IEN'>0  Q:$G(ICD9)=""  D  Q:ICD9IEN'>0
"RTN","RORX013A",36,0)
 . S ICD9IEN=+$$CODEN^ICDCODE(ICD9,80)
"RTN","RORX013A",37,0)
 I '$D(RORICD9("ALL"))  Q:'$D(RORICD9(ICD9IEN))
"RTN","RORX013A",38,0)
 ;---
"RTN","RORX013A",39,0)
 S TMP=+$G(^TMP("RORX013",$J,"PAT",PATIEN,ICD9IEN))
"RTN","RORX013A",40,0)
 S:'TMP!(DATE<TMP) ^TMP("RORX013",$J,"PAT",PATIEN,ICD9IEN)=DATE
"RTN","RORX013A",41,0)
 S ^("C")=$G(^TMP("RORX013",$J,"PAT",PATIEN,ICD9IEN,"C"))+1
"RTN","RORX013A",42,0)
 Q
"RTN","RORX013A",43,0)
 ;
"RTN","RORX013A",44,0)
 ;***** SEARCHES FOR INPATIENT DIAGNOSES
"RTN","RORX013A",45,0)
 ;
"RTN","RORX013A",46,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",47,0)
 ;
"RTN","RORX013A",48,0)
 ; Return Values:
"RTN","RORX013A",49,0)
 ;       <0  Error code
"RTN","RORX013A",50,0)
 ;        0  Ok
"RTN","RORX013A",51,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",52,0)
 ;
"RTN","RORX013A",53,0)
INPAT(PATIEN) ;
"RTN","RORX013A",54,0)
 N ADMDT,DISDT,I,IEN,NODE,RC,RORBUF,RORMSG,TMP
"RTN","RORX013A",55,0)
 S NODE=$NA(^DGPT("AAD",+PATIEN))
"RTN","RORX013A",56,0)
 S RC=0
"RTN","RORX013A",57,0)
 ;--- Browse through the admissions
"RTN","RORX013A",58,0)
 S ADMDT=ROREDT1
"RTN","RORX013A",59,0)
 F  S ADMDT=$O(@NODE@(ADMDT),-1)  Q:ADMDT'>0  D  Q:RC
"RTN","RORX013A",60,0)
 . S IEN=""
"RTN","RORX013A",61,0)
 . F  S IEN=$O(@NODE@(ADMDT,IEN),-1)  Q:IEN'>0  D  Q:RC
"RTN","RORX013A",62,0)
 . . Q:+$G(^DGPT(IEN,0))'=PATIEN
"RTN","RORX013A",63,0)
 . . Q:$$PTF^RORXU001(IEN,"P",,.DISDT)
"RTN","RORX013A",64,0)
 . . ;--- Skip invalid and/or incomplete admissions
"RTN","RORX013A",65,0)
 . . I DISDT'>0  D  Q:TMP!(DISDT'>0)
"RTN","RORX013A",66,0)
 . . . S TMP=$$CHKADM^RORXU001(PATIEN,ADMDT,.DISDT)
"RTN","RORX013A",67,0)
 . . ;--- Check if any appropriate admissions are left
"RTN","RORX013A",68,0)
 . . I DISDT<RORSDT  S RC=1  Q
"RTN","RORX013A",69,0)
 . . Q:DISDT'<ROREDT1
"RTN","RORX013A",70,0)
 . . ;--- Load and process the admission data
"RTN","RORX013A",71,0)
 . . K RORBUF  D RPC^DGPTFAPI(.RORBUF,IEN)
"RTN","RORX013A",72,0)
 . . I $G(RORBUF(0))<0  D  Q
"RTN","RORX013A",73,0)
 . . . D ERROR^RORERR(-57,,,,RORBUF(0),"RPC^DGPTFAPI")
"RTN","RORX013A",74,0)
 . . S TMP=$P($G(RORBUF(1)),U,3)
"RTN","RORX013A",75,0)
 . . D:TMP'="" ICD9SET(PATIEN,,DISDT,TMP)  ; ICD1
"RTN","RORX013A",76,0)
 . . D:$G(RORBUF(2))'=""                   ; ICD2 - ICD10
"RTN","RORX013A",77,0)
 . . . F I=1:1:9  S TMP=$P(RORBUF(2),U,I)  D:TMP'=""
"RTN","RORX013A",78,0)
 . . . . D ICD9SET(PATIEN,,DISDT,TMP)
"RTN","RORX013A",79,0)
 . . S TMP=+$$GET1^DIQ(45,IEN,80,"I",,"RORMSG")
"RTN","RORX013A",80,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,45,IEN)
"RTN","RORX013A",81,0)
 . . D:TMP>0 ICD9SET(PATIEN,TMP,DISDT)     ; PRINCIPAL DIAGNOSIS
"RTN","RORX013A",82,0)
 ;---
"RTN","RORX013A",83,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",84,0)
 ;
"RTN","RORX013A",85,0)
 ;***** SEARCHES FOR OUTPATIENT DIAGNOSES
"RTN","RORX013A",86,0)
 ;
"RTN","RORX013A",87,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",88,0)
 ;
"RTN","RORX013A",89,0)
 ; Return Values:
"RTN","RORX013A",90,0)
 ;       <0  Error code
"RTN","RORX013A",91,0)
 ;        0  Ok
"RTN","RORX013A",92,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",93,0)
 ;
"RTN","RORX013A",94,0)
OUTPAT(PATIEN) ;
"RTN","RORX013A",95,0)
 N DATE,ICDIEN,RC,RORMSG,RORVPLST,TMP,VPIEN,VSIEN,VSIT
"RTN","RORX013A",96,0)
 D SELECTED^VSIT(PATIEN,RORSDT,ROREDT)
"RTN","RORX013A",97,0)
 ;--- Browse through the visits
"RTN","RORX013A",98,0)
 S (VSIEN,RC)=0
"RTN","RORX013A",99,0)
 F  S VSIEN=$O(^TMP("VSIT",$J,VSIEN))  Q:VSIEN=""  D  Q:RC<0
"RTN","RORX013A",100,0)
 . S TMP=+$O(^TMP("VSIT",$J,VSIEN,""))  Q:TMP'>0
"RTN","RORX013A",101,0)
 . S DATE=$P($G(^TMP("VSIT",$J,VSIEN,TMP)),U)  Q:DATE'>0
"RTN","RORX013A",102,0)
 . ;--- Get a list of V POV records
"RTN","RORX013A",103,0)
 . D POV^PXAPIIB(VSIEN,.RORVPLST)
"RTN","RORX013A",104,0)
 . ;--- Process the records
"RTN","RORX013A",105,0)
 . S (VPIEN,RC)=0
"RTN","RORX013A",106,0)
 . F  S VPIEN=$O(RORVPLST(VPIEN))  Q:VPIEN'>0  D  Q:RC
"RTN","RORX013A",107,0)
 . . S ICDIEN=+$P(RORVPLST(VPIEN),U)
"RTN","RORX013A",108,0)
 . . D:ICDIEN>0 ICD9SET(PATIEN,ICDIEN,DATE)
"RTN","RORX013A",109,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",110,0)
 ;
"RTN","RORX013A",111,0)
 ;***** SEARCHES FOR PROBLEMS
"RTN","RORX013A",112,0)
 ;
"RTN","RORX013A",113,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",114,0)
 ;
"RTN","RORX013A",115,0)
 ; Return Values:
"RTN","RORX013A",116,0)
 ;       <0  Error code
"RTN","RORX013A",117,0)
 ;        0  Ok
"RTN","RORX013A",118,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",119,0)
 ;
"RTN","RORX013A",120,0)
PROBLEM(PATIEN) ;
"RTN","RORX013A",121,0)
 N DATE,GMPFLD,GMPORIG,GMPROV,GMVAMC,ICDIEN,IEN,RC,RORPLST,TMP
"RTN","RORX013A",122,0)
 ;--- Load a list of active problems
"RTN","RORX013A",123,0)
 D ACTIVE^GMPLUTL(PATIEN,.RORPLST)
"RTN","RORX013A",124,0)
 ;--- Browse through the problems
"RTN","RORX013A",125,0)
 S (GMPVAMC,GMPROV)=0
"RTN","RORX013A",126,0)
 S (IS,RC)=0
"RTN","RORX013A",127,0)
 F  S IS=$O(RORPLST(IS))  Q:IS=""  D  Q:RC
"RTN","RORX013A",128,0)
 . S IEN=+$G(RORPLST(IS,0))  Q:IEN'>0
"RTN","RORX013A",129,0)
 . K GMPFLD,GMPORIG  D GETFLDS^GMPLEDT3(IEN)
"RTN","RORX013A",130,0)
 . S ICDIEN=+$G(GMPFLD(.01))  Q:ICDIEN'>0
"RTN","RORX013A",131,0)
 . S DATE=$P($G(GMPFLD(.08)),U)
"RTN","RORX013A",132,0)
 . D:(DATE'<RORSDT)&(DATE<ROREDT1) ICD9SET(PATIEN,ICDIEN,DATE)
"RTN","RORX013A",133,0)
 Q 0
"RTN","RORX013A",134,0)
 ;
"RTN","RORX013A",135,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX013A",136,0)
 ;
"RTN","RORX013A",137,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX013A",138,0)
 ;
"RTN","RORX013A",139,0)
 ; Return Values:
"RTN","RORX013A",140,0)
 ;       <0  Error code
"RTN","RORX013A",141,0)
 ;        0  Ok
"RTN","RORX013A",142,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",143,0)
 ;
"RTN","RORX013A",144,0)
QUERY(FLAGS) ;
"RTN","RORX013A",145,0)
 N RORCAT        ; Clinical AIDS status (0/1)
"RTN","RORX013A",146,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX013A",147,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX013A",148,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX013A",149,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX013A",150,0)
 ;
"RTN","RORX013A",151,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX013A",152,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX013A",153,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX013A",154,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX013A",155,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX013A",156,0)
 ;
"RTN","RORX013A",157,0)
 ;--- Browse through the registry records
"RTN","RORX013A",158,0)
 S IEN=0
"RTN","RORX013A",159,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX013A",160,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX013A",161,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX013A",162,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX013A",163,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX013A",164,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX013A",165,0)
 . ;
"RTN","RORX013A",166,0)
 . ;--- Get the patient IEN (DFN)
"RTN","RORX013A",167,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX013A",168,0)
 . ;
"RTN","RORX013A",169,0)
 . ;--- Get the category
"RTN","RORX013A",170,0)
 . S RORCAT=$$CLINAIDS^RORICRUT(IEN,ROREDT)
"RTN","RORX013A",171,0)
 . S TMP=$S(RORCAT:"AIDS",1:"HIV")
"RTN","RORX013A",172,0)
 . Q:'$D(RORMODE(TMP))
"RTN","RORX013A",173,0)
 . ;
"RTN","RORX013A",174,0)
 . ;--- Inpatient codes
"RTN","RORX013A",175,0)
 . S RC=$$INPAT(PATIEN)
"RTN","RORX013A",176,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",177,0)
 . ;
"RTN","RORX013A",178,0)
 . ;--- Outpatient codes
"RTN","RORX013A",179,0)
 . S RC=$$OUTPAT(PATIEN)
"RTN","RORX013A",180,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",181,0)
 . ;
"RTN","RORX013A",182,0)
 . ;--- Problem list
"RTN","RORX013A",183,0)
 . S RC=$$PROBLEM(PATIEN)
"RTN","RORX013A",184,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",185,0)
 . ;
"RTN","RORX013A",186,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX013A",187,0)
 . Q:$D(^TMP("RORX013",$J,"PAT",PATIEN))<10
"RTN","RORX013A",188,0)
 . ;--- Get the patient's data
"RTN","RORX013A",189,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX013A",190,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX013A",191,0)
 . ;
"RTN","RORX013A",192,0)
 . ;--- Calculate the patient's totals
"RTN","RORX013A",193,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX013A",194,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",195,0)
 ;---
"RTN","RORX013A",196,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX013A",197,0)
 ;
"RTN","RORX013A",198,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX013A",199,0)
 ;
"RTN","RORX013A",200,0)
 ; Return Values:
"RTN","RORX013A",201,0)
 ;       <0  Error code
"RTN","RORX013A",202,0)
 ;        0  Ok
"RTN","RORX013A",203,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",204,0)
 ;
"RTN","RORX013A",205,0)
SORT() ;
"RTN","RORX013A",206,0)
 N ICDIEN,TMP,TNC,TNDC
"RTN","RORX013A",207,0)
 ;---
"RTN","RORX013A",208,0)
 S ICDIEN=0,(TNC,TNDC)=0
"RTN","RORX013A",209,0)
 F  S ICDIEN=$O(^TMP("RORX013",$J,"ICD",ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",210,0)
 . S TNC=TNC+$G(^TMP("RORX013",$J,"ICD",ICDIEN,"C"))
"RTN","RORX013A",211,0)
 . S TNDC=TNDC+1
"RTN","RORX013A",212,0)
 S ^TMP("RORX013",$J,"ICD")=TNC_U_TNDC
"RTN","RORX013A",213,0)
 ;---
"RTN","RORX013A",214,0)
 Q 0
"RTN","RORX013A",215,0)
 ;
"RTN","RORX013A",216,0)
 ;***** CALCULATES INTERMEDIATE TOTALS
"RTN","RORX013A",217,0)
 ;
"RTN","RORX013A",218,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",219,0)
 ;
"RTN","RORX013A",220,0)
 ; Return Values:
"RTN","RORX013A",221,0)
 ;       <0  Error code
"RTN","RORX013A",222,0)
 ;        0  Ok
"RTN","RORX013A",223,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",224,0)
 ;
"RTN","RORX013A",225,0)
TOTALS(PATIEN) ;
"RTN","RORX013A",226,0)
 N ICD9,ICDIEN,IENS,PNODE,RC,RORBUF,RORMSG,TMP
"RTN","RORX013A",227,0)
 S PNODE=$NA(^TMP("RORX013",$J,"PAT",PATIEN))
"RTN","RORX013A",228,0)
 S @PNODE=RORLAST4_U_RORPNAME_U_RORCAT
"RTN","RORX013A",229,0)
 S ^("PAT")=$G(^TMP("RORX013",$J,"PAT"))+1
"RTN","RORX013A",230,0)
 ;
"RTN","RORX013A",231,0)
 S ICDIEN=0
"RTN","RORX013A",232,0)
 F  S ICDIEN=$O(@PNODE@(ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",233,0)
 . S ICD9=$P($G(^TMP("RORX013",$J,"ICD",ICDIEN)),U)
"RTN","RORX013A",234,0)
 . I ICD9=""  D  K RORBUF
"RTN","RORX013A",235,0)
 . . S IENS=ICDIEN_","
"RTN","RORX013A",236,0)
 . . D GETS^DIQ(80,IENS,".01",,"RORBUF","RORMSG")
"RTN","RORX013A",237,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,80,IENS)
"RTN","RORX013A",238,0)
 . . ;
"RTN","RORX013A",239,0)
 . . S ICD9=$G(RORBUF(80,IENS,.01))
"RTN","RORX013A",240,0)
 . . S:ICD9="" ICD9="UNKN"
"RTN","RORX013A",241,0)
 . . S TMP=""
"RTN","RORX013A",242,0)
 . . S:ICD9'="UNKN" TMP=$$DIAGTXT^RORRP016(ICD9,"")
"RTN","RORX013A",243,0)
 . . S:TMP="" TMP="Unknown ("_ICDIEN_")"
"RTN","RORX013A",244,0)
 . . S ^TMP("RORX013",$J,"ICD",ICDIEN)=ICD9_U_TMP
"RTN","RORX013A",245,0)
 . ;---
"RTN","RORX013A",246,0)
 . S TMP=$G(@PNODE@(ICDIEN,"C"))
"RTN","RORX013A",247,0)
 . S ^("C")=$G(^TMP("RORX013",$J,"ICD",ICDIEN,"C"))+TMP
"RTN","RORX013A",248,0)
 . S ^("P")=$G(^TMP("RORX013",$J,"ICD",ICDIEN,"P"))+1
"RTN","RORX013A",249,0)
 Q 0
"VER")
8.0^22
**END**
**END**
