Released PSJ*5*180 SEQ #167
Extracted from mail message
**KIDS**:PSJ*5.0*180^

**INSTALL NAME**
PSJ*5.0*180
"BLD",7234,0)
PSJ*5.0*180^INPATIENT MEDICATIONS^0^3070316^y
"BLD",7234,1,0)
^^25^25^3070316^
"BLD",7234,1,1,0)
This patch addresses one Patient Safety Issue contained in one Remedy 
"BLD",7234,1,2,0)
ticket.
"BLD",7234,1,3,0)
 
"BLD",7234,1,4,0)
PSI 06 066
"BLD",7234,1,5,0)
This addresses Remedy ticket HD146661.
"BLD",7234,1,6,0)
 
"BLD",7234,1,7,0)
The site reported an issue that if they used a leading zero for the 
"BLD",7234,1,8,0)
limit/duration of an IV, in this case 0.5L, the stop date calculated for 
"BLD",7234,1,9,0)
the order was 6 minutes after the start date/time.  CPRS has addressed 
"BLD",7234,1,10,0)
this on their end with patch OR*3*254.  Because of the CPRS fix, 
"BLD",7234,1,11,0)
Inpatient Meds should never receive an invalid duration/limit from CPRS.  
"BLD",7234,1,12,0)
However, it was discussed with the Inpatient Meds workgroup, and they 
"BLD",7234,1,13,0)
agreed that Inpatient Meds should make a contingency plan fix just in 
"BLD",7234,1,14,0)
case some future CPRS project removes the fixes in place from OR*3*254.  
"BLD",7234,1,15,0)
As a result, Inpatient Meds will now be able to handle an invalid 
"BLD",7234,1,16,0)
duration/limit should one ever be received from CPRS.
"BLD",7234,1,17,0)
 
"BLD",7234,1,18,0)
The fix agreed upon by the Inpatient Meds workgroup will do three 
"BLD",7234,1,19,0)
things.  First, it will NOT allow the pharmacist to FINISH the order.  
"BLD",7234,1,20,0)
Second, the duration/limit field displayed to the pharmacist will read 
"BLD",7234,1,21,0)
*INVALID DURATION/LIMIT*.  Third, the Stop Date for the order will read 
"BLD",7234,1,22,0)
"CANNOT CALCULATE".
"BLD",7234,1,23,0)
 
"BLD",7234,1,24,0)
OR*3*254 is an independent CPRS patch, and is not required for this 
"BLD",7234,1,25,0)
Inpatient Meds patch.
"BLD",7234,4,0)
^9.64PA^^
"BLD",7234,6)
1^
"BLD",7234,6.3)
5
"BLD",7234,"KRN",0)
^9.67PA^8989.52^19
"BLD",7234,"KRN",.4,0)
.4
"BLD",7234,"KRN",.401,0)
.401
"BLD",7234,"KRN",.402,0)
.402
"BLD",7234,"KRN",.403,0)
.403
"BLD",7234,"KRN",.5,0)
.5
"BLD",7234,"KRN",.84,0)
.84
"BLD",7234,"KRN",3.6,0)
3.6
"BLD",7234,"KRN",3.8,0)
3.8
"BLD",7234,"KRN",9.2,0)
9.2
"BLD",7234,"KRN",9.8,0)
9.8
"BLD",7234,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",7234,"KRN",9.8,"NM",2,0)
PSJLIVMD^^0^B69996973
"BLD",7234,"KRN",9.8,"NM",3,0)
PSJLIUTL^^0^B51802823
"BLD",7234,"KRN",9.8,"NM",4,0)
PSJLIVFD^^0^B38290279
"BLD",7234,"KRN",9.8,"NM","B","PSJLIUTL",3)

"BLD",7234,"KRN",9.8,"NM","B","PSJLIVFD",4)

"BLD",7234,"KRN",9.8,"NM","B","PSJLIVMD",2)

"BLD",7234,"KRN",19,0)
19
"BLD",7234,"KRN",19.1,0)
19.1
"BLD",7234,"KRN",101,0)
101
"BLD",7234,"KRN",409.61,0)
409.61
"BLD",7234,"KRN",771,0)
771
"BLD",7234,"KRN",870,0)
870
"BLD",7234,"KRN",8989.51,0)
8989.51
"BLD",7234,"KRN",8989.52,0)
8989.52
"BLD",7234,"KRN",8994,0)
8994
"BLD",7234,"KRN","B",.4,.4)

"BLD",7234,"KRN","B",.401,.401)

"BLD",7234,"KRN","B",.402,.402)

"BLD",7234,"KRN","B",.403,.403)

"BLD",7234,"KRN","B",.5,.5)

"BLD",7234,"KRN","B",.84,.84)

"BLD",7234,"KRN","B",3.6,3.6)

"BLD",7234,"KRN","B",3.8,3.8)

"BLD",7234,"KRN","B",9.2,9.2)

"BLD",7234,"KRN","B",9.8,9.8)

"BLD",7234,"KRN","B",19,19)

"BLD",7234,"KRN","B",19.1,19.1)

"BLD",7234,"KRN","B",101,101)

"BLD",7234,"KRN","B",409.61,409.61)

"BLD",7234,"KRN","B",771,771)

"BLD",7234,"KRN","B",870,870)

"BLD",7234,"KRN","B",8989.51,8989.51)

"BLD",7234,"KRN","B",8989.52,8989.52)

"BLD",7234,"KRN","B",8994,8994)

"BLD",7234,"QUES",0)
^9.62^^
"BLD",7234,"REQB",0)
^9.611^1^1
"BLD",7234,"REQB",1,0)
PSJ*5.0*111^1
"BLD",7234,"REQB","B","PSJ*5.0*111",1)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
180^3070316^33234
"PKG",203,22,1,"PAH",1,1,0)
^^25^25^3070316
"PKG",203,22,1,"PAH",1,1,1,0)
This patch addresses one Patient Safety Issue contained in one Remedy 
"PKG",203,22,1,"PAH",1,1,2,0)
ticket.
"PKG",203,22,1,"PAH",1,1,3,0)
 
"PKG",203,22,1,"PAH",1,1,4,0)
PSI 06 066
"PKG",203,22,1,"PAH",1,1,5,0)
This addresses Remedy ticket HD146661.
"PKG",203,22,1,"PAH",1,1,6,0)
 
"PKG",203,22,1,"PAH",1,1,7,0)
The site reported an issue that if they used a leading zero for the 
"PKG",203,22,1,"PAH",1,1,8,0)
limit/duration of an IV, in this case 0.5L, the stop date calculated for 
"PKG",203,22,1,"PAH",1,1,9,0)
the order was 6 minutes after the start date/time.  CPRS has addressed 
"PKG",203,22,1,"PAH",1,1,10,0)
this on their end with patch OR*3*254.  Because of the CPRS fix, 
"PKG",203,22,1,"PAH",1,1,11,0)
Inpatient Meds should never receive an invalid duration/limit from CPRS.  
"PKG",203,22,1,"PAH",1,1,12,0)
However, it was discussed with the Inpatient Meds workgroup, and they 
"PKG",203,22,1,"PAH",1,1,13,0)
agreed that Inpatient Meds should make a contingency plan fix just in 
"PKG",203,22,1,"PAH",1,1,14,0)
case some future CPRS project removes the fixes in place from OR*3*254.  
"PKG",203,22,1,"PAH",1,1,15,0)
As a result, Inpatient Meds will now be able to handle an invalid 
"PKG",203,22,1,"PAH",1,1,16,0)
duration/limit should one ever be received from CPRS.
"PKG",203,22,1,"PAH",1,1,17,0)
 
"PKG",203,22,1,"PAH",1,1,18,0)
The fix agreed upon by the Inpatient Meds workgroup will do three 
"PKG",203,22,1,"PAH",1,1,19,0)
things.  First, it will NOT allow the pharmacist to FINISH the order.  
"PKG",203,22,1,"PAH",1,1,20,0)
Second, the duration/limit field displayed to the pharmacist will read 
"PKG",203,22,1,"PAH",1,1,21,0)
*INVALID DURATION/LIMIT*.  Third, the Stop Date for the order will read 
"PKG",203,22,1,"PAH",1,1,22,0)
"CANNOT CALCULATE".
"PKG",203,22,1,"PAH",1,1,23,0)
 
"PKG",203,22,1,"PAH",1,1,24,0)
OR*3*254 is an independent CPRS patch, and is not required for this 
"PKG",203,22,1,"PAH",1,1,25,0)
Inpatient Meds patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSJLIUTL")
0^3^B51802823^B50013699
"RTN","PSJLIUTL",1,0)
PSJLIUTL ;BIR/MV-IV LM utilities modules ;25 APR 00 / 4:28 PM
"RTN","PSJLIUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**39,50,58,81,85,110,180**;16 DEC 97;Build 5
"RTN","PSJLIUTL",3,0)
 ;
"RTN","PSJLIUTL",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872.
"RTN","PSJLIUTL",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIUTL",6,0)
 ; Reference to ES^ORX8 is supported by DBIA #3632.
"RTN","PSJLIUTL",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJLIUTL",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJLIUTL",9,0)
 ;
"RTN","PSJLIUTL",10,0)
 ; NFI changes for FR#2@wrtdrg(drgt)
"RTN","PSJLIUTL",11,0)
FLDNO(X,COL)    ; Display the number next to the field name.
"RTN","PSJLIUTL",12,0)
 ;
"RTN","PSJLIUTL",13,0)
 ; X=Text; COL=Column to start from
"RTN","PSJLIUTL",14,0)
 ;
"RTN","PSJLIUTL",15,0)
 S:'$D(PSJSTAR) PSJSTAR=""
"RTN","PSJLIUTL",16,0)
 NEW PSJOLDOT S PSJOLDOT=P("OT") D GTOT^PSIVUTL(P(4))
"RTN","PSJLIUTL",17,0)
 S X=$S((X="(3)"&(P("OT")="I")):" ",PSJSTAR[X:"*",1:" ")_X
"RTN","PSJLIUTL",18,0)
 S PSJL=$$SETSTR^VALM1($S(($G(PSJHIS)&(ON'=PSJORD)):"",1:X),PSJL,COL,5)
"RTN","PSJLIUTL",19,0)
 Q
"RTN","PSJLIUTL",20,0)
 ;
"RTN","PSJLIUTL",21,0)
LONG(Y,COL,LEN) ; Display long fields.
"RTN","PSJLIUTL",22,0)
 ;
"RTN","PSJLIUTL",23,0)
 ; Y=Text string; COL=Start prt at this col; LEN=Total lenght per line.
"RTN","PSJLIUTL",24,0)
 ;
"RTN","PSJLIUTL",25,0)
 N STRLEN,STR S STR="",STRLEN=1
"RTN","PSJLIUTL",26,0)
 ; If string has no blank space.
"RTN","PSJLIUTL",27,0)
 I $L(Y," ")=1,$L(Y)>LEN D  Q
"RTN","PSJLIUTL",28,0)
 . S LINE=$L(Y)\LEN+$S($L(Y)#LEN:1,1:0)
"RTN","PSJLIUTL",29,0)
 . F X=1:1:LINE-1 D
"RTN","PSJLIUTL",30,0)
 . . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*X),PSJL,COL,LEN)
"RTN","PSJLIUTL",31,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL="",STRLEN=LEN*X+1
"RTN","PSJLIUTL",32,0)
 . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*LINE),PSJL,COL,LEN)
"RTN","PSJLIUTL",33,0)
 ;
"RTN","PSJLIUTL",34,0)
 F X=1:1:$L(Y," ") D
"RTN","PSJLIUTL",35,0)
 . I $L(STR)+$L($P(Y," ",X))>LEN D
"RTN","PSJLIUTL",36,0)
 . . S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",37,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S (STR,PSJL)=""
"RTN","PSJLIUTL",38,0)
 . S STR=STR_$P(Y," ",X)_" "
"RTN","PSJLIUTL",39,0)
 S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",40,0)
 Q
"RTN","PSJLIUTL",41,0)
 ;
"RTN","PSJLIUTL",42,0)
WRTDRG(DRGT) ; Print AD/SOL drugs for "backdoor" view.
"RTN","PSJLIUTL",43,0)
 NEW DRGX,PSJIVIEN,PSJX
"RTN","PSJLIUTL",44,0)
 F DRGX=0:0 S DRGX=$O(DRG(DRGT,DRGX)) Q:'DRGX  D
"RTN","PSJLIUTL",45,0)
 . S (PSJIVIEN,X)=$G(DRG(DRGT,DRGX)) I DRGT="SOL",$P($G(^PS(52.7,+X,0)),U,4)]"" S $P(X,U,2)=$P(X,U,2)_" "_$P(^(0),U,4)
"RTN","PSJLIUTL",46,0)
 . S PSJL="",PSJX=$S($P(X,U,2)]"":$P(X,U,2)_" "_$P(X,U,3)_" "_$P(X,U,4),1:"*** Undefined ***")
"RTN","PSJLIUTL",47,0)
 . NEW PSJNF D NFIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+PSJIVIEN,.PSJNF)
"RTN","PSJLIUTL",48,0)
 . S PSJX=PSJX_PSJNF("NF")
"RTN","PSJLIUTL",49,0)
 . S PSJL=$$SETSTR^VALM1(PSJX,PSJL,8,72)
"RTN","PSJLIUTL",50,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIUTL",51,0)
 . ;PSJLMX is newed in AD^PSJLIVMD & AD^PSJLIVFD.  This var count # of ad/sol so we knows
"RTN","PSJLIUTL",52,0)
 . ;which line to blink the Requested start/stop dates.
"RTN","PSJLIUTL",53,0)
 . S PSJLMX=$G(PSJLMX)+1
"RTN","PSJLIUTL",54,0)
 Q
"RTN","PSJLIUTL",55,0)
 ;
"RTN","PSJLIUTL",56,0)
WTPC ; Write provider comments.
"RTN","PSJLIUTL",57,0)
 ;F PSIVX=0:0 S PSIVX=$O(^PS(53.45,PSIVUP,4,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(53.45,PSIVUP,4,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",58,0)
 Q:$G(PSIVCHG)=1
"RTN","PSJLIUTL",59,0)
 I $G(PSJORD),PSJORD["P" F PSIVX=0:0 S PSIVX=$O(^PS(53.1,+PSJORD,12,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(53.1,+PSJORD,12,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",60,0)
 I $G(PSJORD),PSJORD'["P" F PSIVX=0:0 S PSIVX=$O(^PS(55,DFN,"IV",+PSJORD,5,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(55,DFN,"IV",+PSJORD,5,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",61,0)
 Q
"RTN","PSJLIUTL",62,0)
 ;
"RTN","PSJLIUTL",63,0)
TYPE() ; IV Type
"RTN","PSJLIUTL",64,0)
 S X=$$CODES^PSIVUTL(P(4),53.1,53) S X=$S($E(X)="C":"CHEMO",1:X)_$S(P(23)'="":" ("_P(23)_")",1:"")_$S(P(5)=1:" (I)",P(5)=0:"(C)",1:"")
"RTN","PSJLIUTL",65,0)
 Q X
"RTN","PSJLIUTL",66,0)
 ;
"RTN","PSJLIUTL",67,0)
STARTDT() ; Start Date
"RTN","PSJLIUTL",68,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(12)",$E(P("OT"))="I":"(10)",1:"(8)")
"RTN","PSJLIUTL",69,0)
 Q $$ENDTC^PSGMI(P(2))
"RTN","PSJLIUTL",70,0)
 ;
"RTN","PSJLIUTL",71,0)
STOPDT() ; Stop Date
"RTN","PSJLIUTL",72,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(13)",$E(P("OT"))="I":"(11)",1:"(9)")
"RTN","PSJLIUTL",73,0)
 Q $$ENDTC^PSGMI(P(3))
"RTN","PSJLIUTL",74,0)
 ;
"RTN","PSJLIUTL",75,0)
PROVIDER() ; Provider
"RTN","PSJLIUTL",76,0)
 S X="" I $D(PSIVNUM),P("DTYP") S X=$S(PSIVAC="PN":" ",1:"*")_$S(P("DTYP")=1:"(14)",$E(P("OT"))="I":"(12)",1:"(10)") ;I P(17)="P",(+P("CLRK")=+P(6)) S X=""
"RTN","PSJLIUTL",77,0)
 I $G(P(21))]"",$L($T(ES^ORX8)) N ESIG,ESIG1 S ESIG=P("NAT"),ESIG1=$$ES^ORX8(+P(21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLIUTL",78,0)
 S X=$S($P(P(6),U,2)]"":$E($P(P(6),U,2),1,23),1:"*** Undefined") S:$G(ESIG)]"" X=X_" ["_$$LOW^XLFSTR(ESIG)_"]"
"RTN","PSJLIUTL",79,0)
 Q X
"RTN","PSJLIUTL",80,0)
WDTE(Y) ; Format and print date.
"RTN","PSJLIUTL",81,0)
 I 'Y S Y=""
"RTN","PSJLIUTL",82,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSJLIUTL",83,0)
 Q Y
"RTN","PSJLIUTL",84,0)
 ;
"RTN","PSJLIUTL",85,0)
ACTIONS()          ;
"RTN","PSJLIUTL",86,0)
 N DIC,X,Y
"RTN","PSJLIUTL",87,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",88,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLIUTL",89,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLIUTL",90,0)
 I Y="PSJI PC RENEWAL" Q $S(PSGACT["R":1,1:0)
"RTN","PSJLIUTL",91,0)
 I Y="PSJI PC HOLD" Q $S(PSGACT["H":1,1:0)
"RTN","PSJLIUTL",92,0)
 I Y="PSJI PC ONCALL" Q $S(PSGACT["O":1,1:0)
"RTN","PSJLIUTL",93,0)
 I Y="PSJI LM VERIFY" Q $S(PSGACT["V":1,1:0)
"RTN","PSJLIUTL",94,0)
 I Y="PSJ LM FLAG" Q $S(PSGACT["G":1,1:0)
"RTN","PSJLIUTL",95,0)
 ;PSJ*5*180
"RTN","PSJLIUTL",96,0)
 I $G(PSJBADD)=1,PSGACT["F" S PSGACT=$TR(PSGACT,"F")
"RTN","PSJLIUTL",97,0)
 I Y="PSJI LM FINISH" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLIUTL",98,0)
 I Y="PSJ LM IV PENDING" Q $S(PSGACT["F":1,1:0)
"RTN","PSJLIUTL",99,0)
 Q 1
"RTN","PSJLIUTL",100,0)
 ;
"RTN","PSJLIUTL",101,0)
ACT() ;
"RTN","PSJLIUTL",102,0)
 NEW Y
"RTN","PSJLIUTL",103,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",104,0)
 I $G(PSJHIDFG),(Y="PSJ LM NEW ORDER") Q 0
"RTN","PSJLIUTL",105,0)
 I Y="PSJ LM NEW ORDER FROM PROFILE" Q $S($G(PSIVBR)="D ^PSIVOPT":1,1:0)
"RTN","PSJLIUTL",106,0)
 Q 1
"RTN","PSJLIUTL",107,0)
 ;
"RTN","PSJLIUTL",108,0)
REQDT(ORDER) ;
"RTN","PSJLIUTL",109,0)
 Q:$G(ORDER)'["P"  N ND0,PARENT I '$D(PSGRDTX(+ORDER)) K PSGRDTX
"RTN","PSJLIUTL",110,0)
 S PSGRDTX=$G(^PS(53.1,+ORDER,2.5)),ND0=$G(^PS(53.1,+ORDER,0)),PARENT=$P($G(^PS(53.1,+ORDER,.2)),"^",8),(PSGRSD,PSGRSDN,PSGRFD,PSGRFDN)=""
"RTN","PSJLIUTL",111,0)
 Q:'$G(PSGRDTX)  I '$P(PSGRDTX,"^",3)&'PARENT Q  ; Complex orders (duration OR parent) only?
"RTN","PSJLIUTL",112,0)
 I $P(ND0,U,9)'["P"!($P(ND0,U,24)="R") K PSGRDTX,PSGRFD,PSGRFDN Q
"RTN","PSJLIUTL",113,0)
 S $P(PSGRDTX,U,4)=ORDER
"RTN","PSJLIUTL",114,0)
 S PSGSD=$S($G(P(2)):P(2),1:$G(PSGSD)) I $L(PSGSD)>6 S PSGSD=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",115,0)
 S PSGFD=$S($G(P(3)):P(3),1:$G(PSGFD)) I $L(PSGFD)>6 S PSGFD=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",116,0)
 I $G(PSGSD),$G(PSGRDTX(+ORDER,"PSGSD")) I (","_PSGRDTX(+ORDER,"PSGSD")_","_PSGRDTX(+ORDER,"PSGRSD")_",")'[(","_PSGSD_",") D
"RTN","PSJLIUTL",117,0)
 . S PSGRDTX(+ORDER,"PSGSD")=PSGSD
"RTN","PSJLIUTL",118,0)
 I $G(PSGFD),$G(PSGRDTX(+ORDER,"PSGFD")) I (","_PSGRDTX(+ORDER,"PSGFD")_","_PSGRDTX(+ORDER,"PSGRFD")_",")'[(","_PSGFD_",") D
"RTN","PSJLIUTL",119,0)
 . S PSGRDTX(+ORDER,"PSGFD")=PSGFD
"RTN","PSJLIUTL",120,0)
 I $G(PSGSD),'$G(PSGRDTX(+ORDER,"PSGSD")) D
"RTN","PSJLIUTL",121,0)
 . S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$P(PSGRDTX,U)) Q:'PSGRSD
"RTN","PSJLIUTL",122,0)
 . S A=PSGRSD,PSGRSD=PSGSD,PSGSD=A
"RTN","PSJLIUTL",123,0)
 . S PSGRDTX(+ORDER,"PSGRSD")=PSGRSD,PSGRDTX(+ORDER,"PSGSD")=PSGSD I $G(P(4))]"",PSGSD]"" S P(2)=PSGSD
"RTN","PSJLIUTL",124,0)
 . I PARENT,($P($G(PSGSRDTX),"^",3)="") S PSGNESD=PSGSD
"RTN","PSJLIUTL",125,0)
 I $G(PSGFD),'$G(PSGRDTX(+ORDER,"PSGFD")) D
"RTN","PSJLIUTL",126,0)
 . S PSGRFD=$S($D(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$P(PSGRDTX,U,3)) Q:'PSGRFD
"RTN","PSJLIUTL",127,0)
 . S A=PSGRFD,PSGRFD=$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)),PSGFD=A
"RTN","PSJLIUTL",128,0)
 . S PSGRDTX(+ORDER,"PSGRFD")=PSGRFD,(PSGNEFD,PSGRDTX(+ORDER,"PSGFD"))=PSGFD I $G(P(4))]"",PSGFD]"" S P(3)=PSGFD
"RTN","PSJLIUTL",129,0)
 S PSGSD=$S($G(PSGRDTX(+ORDER,"PSGSD")):PSGRDTX(+ORDER,"PSGSD"),1:$G(PSGSD)) I $G(P(4))]"",$L(PSGSD)>6 S P(2)=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",130,0)
 I $G(PSGSD) S PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD)
"RTN","PSJLIUTL",131,0)
 S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$G(PSGRSD))
"RTN","PSJLIUTL",132,0)
 I $G(PSGRSD) S PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIUTL",133,0)
 I $G(PSGRDTX(+ORDER,"PSGFD")),$G(PSGSD) I PSGSD>PSGRDTX(+ORDER,"PSGFD") N DUR S DUR=$P($G(PSGRDTX),U,2) D
"RTN","PSJLIUTL",134,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) S (PSGFD,PSGRDTX(+ORDER,"PSGFD"))=$$FMADD^XLFDT(PSGSD,,,$S(DURMIN:DURMIN,1:1440))
"RTN","PSJLIUTL",135,0)
 S PSGFD=$S($G(PSGRDTX(+ORDER,"PSGFD")):PSGRDTX(+ORDER,"PSGFD"),1:$G(PSGFD)) D
"RTN","PSJLIUTL",136,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER'["V" N PSGST I $G(DFN) S PSGST=$S(PSGORD["P":$P(^PS(53.1,+PSGORD,0),"^",7),1:$P(^PS(55,DFN,5,+PSGORD,0),"^",7)) D
"RTN","PSJLIUTL",137,0)
 .. D ENFD^PSGNE3(PSGSD) I PSGNEFD>PSGSD S PSGFD=PSGNEFD
"RTN","PSJLIUTL",138,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER["V" D ENSTOP^PSIVCAL I P(3)>P(2) S PSGFD=P(3)
"RTN","PSJLIUTL",139,0)
 . I $G(P(4))]"",$L(PSGFD)>6 S P(3)=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",140,0)
 I $G(PSGFD) S PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJLIUTL",141,0)
 S PSGRFD=$S($G(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$G(PSGRFD))
"RTN","PSJLIUTL",142,0)
 I $G(PSGRFD) S PSGRFDN=$$ENDTC^PSGMI(PSGRFD)
"RTN","PSJLIUTL",143,0)
 Q
"RTN","PSJLIVFD")
0^4^B38290279^B37728211
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,50,63,64,58,81,91,80,116,110,111,180**;16 DEC 97;Build 5
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVFD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVFD",20,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",23,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",24,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",25,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",26,0)
SOL ;
"RTN","PSJLIVFD",27,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",28,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",29,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",30,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",31,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",32,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",33,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",34,0)
DUR ;
"RTN","PSJLIVFD",35,0)
 S PSJL=""
"RTN","PSJLIVFD",36,0)
 N DUROUT,IVLIMIT S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",37,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVFD",38,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVFD",39,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVFD",40,0)
START ;
"RTN","PSJLIVFD",41,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",42,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",43,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",44,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",45,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",46,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",47,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",48,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",49,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",50,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",51,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",52,0)
INFRATE ;
"RTN","PSJLIVFD",53,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",54,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",55,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",56,0)
LASTREN ;
"RTN","PSJLIVFD",57,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",58,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",59,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",60,0)
MR ;
"RTN","PSJLIVFD",61,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",62,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",63,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",64,0)
STOP ;
"RTN","PSJLIVFD",65,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",66,0)
 ;PSJ*5*180 - If Invalid Duration/Limit - Cannot Calculate Stop Date
"RTN","PSJLIVFD",67,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVFD",68,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",69,0)
 S PSJL=""
"RTN","PSJLIVFD",70,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",71,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",72,0)
 ;D:$G(PSGRFD) DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," REQUESTED STOP: ",P(3)'=PSGRFD)
"RTN","PSJLIVFD",73,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",74,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",75,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",76,0)
SCH ;
"RTN","PSJLIVFD",77,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",78,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",79,0)
 D LONG^PSJLIUTL(P(9),22,32) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")
"RTN","PSJLIVFD",80,0)
LASTFL ;
"RTN","PSJLIVFD",81,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",82,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",83,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",84,0)
ADM ;
"RTN","PSJLIVFD",85,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",86,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",87,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",88,0)
QTY ;
"RTN","PSJLIVFD",89,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",90,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",91,0)
PROVIDER ;
"RTN","PSJLIVFD",92,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",93,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",94,0)
CUMDOSES ;
"RTN","PSJLIVFD",95,0)
 ;S PSJL=$$SETSTR^VALM1("Cumulative Doses:",PSJL,45,17)_P("CUM")
"RTN","PSJLIVFD",96,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",97,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",98,0)
OPI ;
"RTN","PSJLIVFD",99,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",100,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVFD",101,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",102,0)
PC ;
"RTN","PSJLIVFD",103,0)
 S PSJL=""
"RTN","PSJLIVFD",104,0)
 ;S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D SETTMP^PSJLMPRU("PSJI",PSJL) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",105,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",106,0)
REMARK ;
"RTN","PSJLIVFD",107,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",108,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",109,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",110,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",111,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",112,0)
IVROOM ;
"RTN","PSJLIVFD",113,0)
 S PSJL=""
"RTN","PSJLIVFD",114,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",115,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",116,0)
ENTRY ;
"RTN","PSJLIVFD",117,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",118,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",119,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",120,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",121,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",122,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",123,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",124,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",125,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",126,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",127,0)
 Q
"RTN","PSJLIVFD",128,0)
 ;
"RTN","PSJLIVFD",129,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",130,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",131,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",132,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",133,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",134,0)
 . S PSJL="Order Checks       :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",135,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",136,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",137,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",138,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",139,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",140,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",141,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",142,0)
 Q
"RTN","PSJLIVFD",143,0)
 ;
"RTN","PSJLIVFD",144,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",145,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",146,0)
 Q 0
"RTN","PSJLIVMD")
0^2^B69996973^B66254747
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ;4 Aug 00 / 4:29 PM
"RTN","PSJLIVMD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**37,50,63,58,81,91,80,116,110,111,180**;16 DEC 97;Build 5
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIVMD",5,0)
 ;
"RTN","PSJLIVMD",6,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",7,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",8,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",9,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",10,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",11,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",12,0)
 S PSJLN=1
"RTN","PSJLIVMD",13,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",14,0)
AD ;
"RTN","PSJLIVMD",15,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",16,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",17,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",18,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",19,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",20,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVMD",21,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVMD",22,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",23,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",24,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",25,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",26,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",27,0)
SOL ;
"RTN","PSJLIVMD",28,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",29,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",30,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",31,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",32,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",33,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",34,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",35,0)
 D DUR
"RTN","PSJLIVMD",36,0)
START ;
"RTN","PSJLIVMD",37,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",38,0)
 D REQDT(ON)
"RTN","PSJLIVMD",39,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",40,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",41,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",42,0)
INFRATE ;
"RTN","PSJLIVMD",43,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",44,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",45,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",46,0)
RSTART ;
"RTN","PSJLIVMD",47,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",48,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",49,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",50,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",51,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",52,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",53,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",54,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",55,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",56,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",57,0)
 ;
"RTN","PSJLIVMD",58,0)
MR ;
"RTN","PSJLIVMD",59,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",60,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",61,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",62,0)
STOP ;
"RTN","PSJLIVMD",63,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",64,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",65,0)
 ;PSJ*5*180 - If CPRS sends invalid duration/limit - Cannot Calculate Stop Date.
"RTN","PSJLIVMD",66,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$S($G(PSJBADD)=1:"CANNOT CALCULATE",1:$$STOPDT^PSJLIUTL)
"RTN","PSJLIVMD",67,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",68,0)
 S PSJL=""
"RTN","PSJLIVMD",69,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",70,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",71,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",72,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",73,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",74,0)
SCH ;
"RTN","PSJLIVMD",75,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",76,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",77,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",78,0)
LASTFL ;
"RTN","PSJLIVMD",79,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",80,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",81,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",82,0)
ADM ;
"RTN","PSJLIVMD",83,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",84,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",85,0)
 NEW NOECH
"RTN","PSJLIVMD",86,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",87,0)
QTY ;
"RTN","PSJLIVMD",88,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",89,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",90,0)
PROVIDER ;
"RTN","PSJLIVMD",91,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",92,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",93,0)
CUMDOSES ;
"RTN","PSJLIVMD",94,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",95,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",96,0)
OI ;
"RTN","PSJLIVMD",97,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",98,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",99,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",100,0)
INS ;
"RTN","PSJLIVMD",101,0)
 S PSJL=""
"RTN","PSJLIVMD",102,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",103,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",104,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",105,0)
OPI ;
"RTN","PSJLIVMD",106,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",107,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVMD",108,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",109,0)
PC ;
"RTN","PSJLIVMD",110,0)
 S PSJL=""
"RTN","PSJLIVMD",111,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",112,0)
REMARK ;
"RTN","PSJLIVMD",113,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",114,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",115,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",116,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",117,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",118,0)
IVROOM ;
"RTN","PSJLIVMD",119,0)
 S PSJL=""
"RTN","PSJLIVMD",120,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",121,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",122,0)
ENTRY ;
"RTN","PSJLIVMD",123,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",124,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",125,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",126,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",127,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",128,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",129,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",130,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",131,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",132,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",133,0)
 Q
"RTN","PSJLIVMD",134,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",135,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",136,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",137,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",138,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",139,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",140,0)
 ;
"RTN","PSJLIVMD",141,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",142,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",143,0)
 Q
"RTN","PSJLIVMD",144,0)
CLRDSPL ;
"RTN","PSJLIVMD",145,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",146,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",147,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",148,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",149,0)
 NEW PSJX
"RTN","PSJLIVMD",150,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",151,0)
 Q
"RTN","PSJLIVMD",152,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",153,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",154,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",155,0)
 Q
"RTN","PSJLIVMD",156,0)
 ;
"RTN","PSJLIVMD",157,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",158,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",159,0)
 ; ORD= Order #
"RTN","PSJLIVMD",160,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",161,0)
 N ACT,DUR,ND,ND25,F25,ND0,ND2,OLDORD S DUR="",ORD=+ORD K IVLIMIT
"RTN","PSJLIVMD",162,0)
 S:PKG="V" PKG="IV"
"RTN","PSJLIVMD",163,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  I '$G(OLDORD) Q DUR
"RTN","PSJLIVMD",164,0)
 . D PENDING(ORD) Q:DUR]""
"RTN","PSJLIVMD",165,0)
 . S ND0=$G(^PS(53.1,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) I OLDORD S PKG=$S(OLDORD["V":"IV",OLDORD["U":5,OLDORD["P":"P",1:"")
"RTN","PSJLIVMD",166,0)
 . Q:($G(OLDORD)'["P")
"RTN","PSJLIVMD",167,0)
 . D PENDING(OLDORD) S OLDORD=""
"RTN","PSJLIVMD",168,0)
 I PKG="IV" S ND2=$G(^PS(55,PAT,PKG,ORD,2)) I $P(ND2,U,8)="E" S OLDORD=$P(ND2,U,5) S:OLDORD'["V" OLDORD=""
"RTN","PSJLIVMD",169,0)
 I PKG=5 S ND0=$G(^PS(55,PAT,PKG,ORD,0)) I $P(ND0,U,24)="E" S OLDORD=$P(ND0,U,25) S:OLDORD'["U" OLDORD=""
"RTN","PSJLIVMD",170,0)
 S F25="^PS(55,PAT,PKG,ORD,2.5)" I '$G(OLDORD) Q:'$D(@(F25)) DUR
"RTN","PSJLIVMD",171,0)
 S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",172,0)
 I DUR="",$G(OLDORD) S ORD=+OLDORD Q:'$D(@(F25)) DUR  D
"RTN","PSJLIVMD",173,0)
 . S ND25=$G(@(F25)) S DUR=$P(ND25,U,2) I DUR="" S DUR=$P(ND25,U,4) I DUR]"" S IVLIMIT=1
"RTN","PSJLIVMD",174,0)
 I '$G(RAW),DUR]"" S DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",175,0)
 Q DUR
"RTN","PSJLIVMD",176,0)
 ;
"RTN","PSJLIVMD",177,0)
PENDING(PNDON) ;
"RTN","PSJLIVMD",178,0)
 S ND=$G(^PS(53.1,+ORD,0))
"RTN","PSJLIVMD",179,0)
 I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"")
"RTN","PSJLIVMD",180,0)
 S DUR=$P(ND25,U,4) I DUR]"" S:$E(DUR)="m"!($E(DUR)="l")!($E(DUR)="d")!($E(DUR)="h") IVLIMIT=1 S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR)) Q
"RTN","PSJLIVMD",181,0)
 S DUR=$P(ND25,U,2) I DUR]"" S DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",182,0)
 Q
"RTN","PSJLIVMD",183,0)
 ;
"RTN","PSJLIVMD",184,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",185,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",186,0)
 ;PSJ*5*180 - Add PSJBADD variable
"RTN","PSJLIVMD",187,0)
 K PSJBADD S PSJBADD=0
"RTN","PSJLIVMD",188,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",189,0)
 I DUNIT'="",DUNIT'?1(1U,1L) S PSJBADD=1
"RTN","PSJLIVMD",190,0)
 S DUNIT=$S(DUNIT="D"!(DUNIT="d"):" day",DUNIT="H"!(DUNIT="h"):" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",DUNIT="m":" ml",DUNIT="l":" liter",1:"")
"RTN","PSJLIVMD",191,0)
 S:DUNIT="" BAD=1 I (DNUM'=1),(DUNIT'["ml") S DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",192,0)
 I PSJBADD=1 S PSGACT=$TR($G(PSGACT),"F")
"RTN","PSJLIVMD",193,0)
 Q $S(PSJBADD=1:"*INVALID DURATION/LIMIT*",BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",194,0)
 ;
"RTN","PSJLIVMD",195,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",196,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",197,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",198,0)
 Q DMIN
"RTN","PSJLIVMD",199,0)
 ;
"RTN","PSJLIVMD",200,0)
DUR ;
"RTN","PSJLIVMD",201,0)
 N DUROUT,LABEL,IVLIMIT
"RTN","PSJLIVMD",202,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",203,0)
 S DUROUT=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",204,0)
 S LABEL=$S($G(IVLIMIT):"IV Limit: ",1:"Duration: ") K IVLIMIT
"RTN","PSJLIVMD",205,0)
 S PSJL=$$SETSTR^VALM1(LABEL,PSJL,12,10)
"RTN","PSJLIVMD",206,0)
 S PSJL=PSJL_DUROUT
"RTN","PSJLIVMD",207,0)
 Q
"VER")
8.0^22.0
"BLD",7234,6)
^167
**END**
**END**
