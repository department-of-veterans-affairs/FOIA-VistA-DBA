Released DVBA*2.7*18 SEQ #21
Extracted from mail message
**KIDS**:DVBA*2.7*18^

**INSTALL NAME**
DVBA*2.7*18
"BLD",809,0)
DVBA*2.7*18^AUTOMATED MED INFO EXCHANGE^0^2980309^y
"BLD",809,1,0)
^^1^1^2980309^
"BLD",809,1,1,0)
DVBA*2.7*18
"BLD",809,4,0)
^9.64PA^^
"BLD",809,"KRN",0)
^9.67PA^19^18
"BLD",809,"KRN",.4,0)
.4
"BLD",809,"KRN",.401,0)
.401
"BLD",809,"KRN",.402,0)
.402
"BLD",809,"KRN",.403,0)
.403
"BLD",809,"KRN",.5,0)
.5
"BLD",809,"KRN",.84,0)
.84
"BLD",809,"KRN",3.6,0)
3.6
"BLD",809,"KRN",3.8,0)
3.8
"BLD",809,"KRN",9.2,0)
9.2
"BLD",809,"KRN",9.8,0)
9.8
"BLD",809,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",809,"KRN",9.8,"NM",1,0)
DVBCXFRC^^0^B40453742
"BLD",809,"KRN",9.8,"NM",2,0)
DVBCXFRD^^0^B17456538
"BLD",809,"KRN",9.8,"NM","B","DVBCXFRC",1)

"BLD",809,"KRN",9.8,"NM","B","DVBCXFRD",2)

"BLD",809,"KRN",19,0)
19
"BLD",809,"KRN",19.1,0)
19.1
"BLD",809,"KRN",101,0)
101
"BLD",809,"KRN",409.61,0)
409.61
"BLD",809,"KRN",771,0)
771
"BLD",809,"KRN",869.2,0)
869.2
"BLD",809,"KRN",870,0)
870
"BLD",809,"KRN",8994,0)
8994
"BLD",809,"KRN","B",.4,.4)

"BLD",809,"KRN","B",.401,.401)

"BLD",809,"KRN","B",.402,.402)

"BLD",809,"KRN","B",.403,.403)

"BLD",809,"KRN","B",.5,.5)

"BLD",809,"KRN","B",.84,.84)

"BLD",809,"KRN","B",3.6,3.6)

"BLD",809,"KRN","B",3.8,3.8)

"BLD",809,"KRN","B",9.2,9.2)

"BLD",809,"KRN","B",9.8,9.8)

"BLD",809,"KRN","B",19,19)

"BLD",809,"KRN","B",19.1,19.1)

"BLD",809,"KRN","B",101,101)

"BLD",809,"KRN","B",409.61,409.61)

"BLD",809,"KRN","B",771,771)

"BLD",809,"KRN","B",869.2,869.2)

"BLD",809,"KRN","B",870,870)

"BLD",809,"KRN","B",8994,8994)

"BLD",809,"QUES",0)
^9.62^^
"BLD",809,"REQB",0)
^9.611^1^1
"BLD",809,"REQB",1,0)
DVBA*2.7*6^2
"BLD",809,"REQB","B","DVBA*2.7*6",1)

"OER",223,0)
223^DVBA
"OER",223,1,0)
^100.9951PA^5^5
"OER",223,1,1,0)
634
"OER",223,1,1,1,0)
^100.99511PA^1^1
"OER",223,1,1,1,1,0)
1106
"OER",223,1,2,0)
635
"OER",223,1,2,1,0)
^100.99511PA^1^1
"OER",223,1,2,1,1,0)
1106
"OER",223,1,3,0)
644
"OER",223,1,3,1,0)
^100.99511PA^1^1
"OER",223,1,3,1,1,0)
1106
"OER",223,1,4,0)
642
"OER",223,1,4,1,0)
^100.99511PA^2^2
"OER",223,1,4,1,1,0)
1106
"OER",223,1,4,1,2,0)
1303
"OER",223,1,5,0)
1305
"OER",223,1,5,1,0)
^100.99511PA^1^1
"OER",223,1,5,1,1,0)
414
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
18^2980309
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^2980427
"PKG",223,22,1,"PAH",1,1,1,0)
DVBA*2.7*18
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBCXFRC")
0^1^B40453742
"RTN","DVBCXFRC",1,0)
DVBCXFRC ;ALB/GTS-557/THM-PROCESS TRANSFER-IN MAIL MESSAGE ; 10/4/91  9:26 AM
"RTN","DVBCXFRC",2,0)
 ;;2.7;AMIE;**1,6,18**;Apr 10, 1995
"RTN","DVBCXFRC",3,0)
 ;
"RTN","DVBCXFRC",4,0)
EN1 N XMB K OUT,CNT S (CNTA,OUT)=0 X XMREC I XMRG["TRANSFER OUT" G EN1^DVBCXFRS
"RTN","DVBCXFRC",5,0)
 F DVBCI=0:0 X XMREC Q:XMER<0!(XMRG["$END")  S XLN=XMRG,SUB=$E(XLN,2,5),XLN=$E(XLN,7,245) D @SUB
"RTN","DVBCXFRC",6,0)
 ;check for existence of primary division
"RTN","DVBCXFRC",7,0)
 S DVBCDIV=$$PRIM^VASITE I DVBCDIV=""!(DVBCDIV=-1) D BULL8^DVBCXFRD G EXIT
"RTN","DVBCXFRC",8,0)
 ;check for unique regional office station# using variable ronam
"RTN","DVBCXFRC",9,0)
 S RO=$$FIND1^DIC(4,,"X",RONAM,"D",,"DVBCERR") I RO=""!(RO=0) S OUT=1 D BULL11^DVBCXFRD G EXIT
"RTN","DVBCXFRC",10,0)
 ;if primary division and regional office station# ok, then proceed
"RTN","DVBCXFRC",11,0)
 K XLN,CNTA I XMRG["$END" S OUT=0 D PATEDIT G:OUT EXIT D REQEDIT
"RTN","DVBCXFRC",12,0)
 I $D(DVBCNEW) S XMB="DVBA C NEW C&P VETERAN",XMB(1)=PNAM,XMB(2)=SSN,XMB(3)=$S($D(^VA(200,+DUZ,0)):$P(^(0),U),1:"Unknown user"),Y=DT X ^DD("DD") S XMB(4)=Y D ^XMB
"RTN","DVBCXFRC",13,0)
 ;
"RTN","DVBCXFRC",14,0)
EXIT D DELSER^DVBCUTL4 ;deletes the server message
"RTN","DVBCXFRC",15,0)
 K DGMSGF,TYPE,REASONS,DVBADMNM,EXMRS,XMORPV
"RTN","DVBCXFRC",16,0)
 G KILL^DVBCUTIL
"RTN","DVBCXFRC",17,0)
 ;
"RTN","DVBCXFRC",18,0)
DEM0 S PNAM=$E($P(XLN,U,1),1,28),DOB=$P(XLN,U,2),SEX=$P(XLN,U,3),SSN=$P(XLN,U,4)
"RTN","DVBCXFRC",19,0)
 Q
"RTN","DVBCXFRC",20,0)
 ;
"RTN","DVBCXFRC",21,0)
USER S USER=$P(XLN,U,1),SITE=$P(XLN,U,2),SITE1=$P(XLN,U,3)
"RTN","DVBCXFRC",22,0)
 Q
"RTN","DVBCXFRC",23,0)
 ;
"RTN","DVBCXFRC",24,0)
DEM1 S ADR1=$P(XLN,U,1),ADR2=$P(XLN,U,2),ADR3=$P(XLN,U,3),CITY=$P(XLN,U,4),STATE=$P(XLN,U,5),CNTY=$P(XLN,U,6),ZIP=$P(XLN,U,7),HOMPHON=$P(XLN,U,8),BUSPHON=$P(XLN,U,9),ZIP4=$P(XLN,U,10)
"RTN","DVBCXFRC",25,0)
 I STATE?.E1A.E S STATE=$O(^DIC(5,"B",STATE,0)) DO
"RTN","DVBCXFRC",26,0)
 .I CNTY?.E1A.E S CNTY=$O(^DIC(5,+STATE,1,"B",CNTY,0)) Q
"RTN","DVBCXFRC",27,0)
 I 'STATE S STATE=""
"RTN","DVBCXFRC",28,0)
 I 'CNTY S CNTY=""
"RTN","DVBCXFRC",29,0)
 Q
"RTN","DVBCXFRC",30,0)
 ;
"RTN","DVBCXFRC",31,0)
ELIG S SRVCON=$P(XLN,U,1),SRVPCT=$P(XLN,U,2),CFLOC=$P(XLN,U,3),CNUM=$P(XLN,U,4),PDSRV=$P(XLN,U,5),SRVEDT=$P(XLN,U,6),SRVSDT=$P(XLN,U,7),ELIGCOD=$P(XLN,U,8),ELIGST=$P(XLN,U,9),ELIGSDT=$P(XLN,U,10),POWSTAT=$P(XLN,U,11),VETST=$P(XLN,U,12)
"RTN","DVBCXFRC",32,0)
 S TYPE=$P(XLN,U,13),TYPEPTR=""
"RTN","DVBCXFRC",33,0)
 S:TYPE]"" TYPEPTR=$O(^DG(391,"B",TYPE,TYPEPTR))
"RTN","DVBCXFRC",34,0)
 S ELIGCOD=$O(^DIC(8,"D",+ELIGCOD,0))
"RTN","DVBCXFRC",35,0)
 S ELIGCOD=$S(ELIGCOD="":"",$D(^DIC(8,"D",+ELIGCOD)):$O(^DIC(8,"D",+ELIGCOD,0)),1:"")
"RTN","DVBCXFRC",36,0)
 S PDSRV=$S(PDSRV="":"",$D(^DIC(21,"D",PDSRV)):$O(^DIC(21,"D",PDSRV,0)),1:"")
"RTN","DVBCXFRC",37,0)
 Q
"RTN","DVBCXFRC",38,0)
 ;
"RTN","DVBCXFRC",39,0)
REQ0 S OLREQDA=$P(XLN,U,1),RO=$P(XLN,U,2),RONAM=$P(XLN,U,8),PRIO=$P(XLN,U,3),CFLOC=+$P(XLN,U,4),LREXMDT=$P(XLN,U,5),CFREQ=$P(XLN,U,6),LREXMDT=$P(XLN,U,7)
"RTN","DVBCXFRC",40,0)
 S CFLOC=$O(^DIC(4,"D",CFLOC,""))
"RTN","DVBCXFRC",41,0)
 S:'$D(^DIC(4,+CFLOC,0)) CFLOC=""
"RTN","DVBCXFRC",42,0)
 Q
"RTN","DVBCXFRC",43,0)
 ;
"RTN","DVBCXFRC",44,0)
ODIS S OTHDIS=$P(XLN,U,1),OTHDIS1=$P(XLN,U,2),OTHDIS2=$P(XLN,U,3)
"RTN","DVBCXFRC",45,0)
 Q
"RTN","DVBCXFRC",46,0)
 ;
"RTN","DVBCXFRC",47,0)
EXAM S EXAMS=$P(XLN,"^^",1),REASONS=$P(XLN,"^^",2)
"RTN","DVBCXFRC",48,0)
 Q
"RTN","DVBCXFRC",49,0)
 ;
"RTN","DVBCXFRC",50,0)
REMK S:'$D(CNT) CNT=0 S CNT=CNT+1,REMK(CNT)=XLN
"RTN","DVBCXFRC",51,0)
 Q
"RTN","DVBCXFRC",52,0)
 ;
"RTN","DVBCXFRC",53,0)
REQEDIT ;  ** Add entry to file #396.3 (request)
"RTN","DVBCXFRC",54,0)
 K DD,DO,DA,DR,DIC,X,Y S DIC="^DVB(396.3,",DLAYGO=396.3,DIC(0)="L",X=DFN
"RTN","DVBCXFRC",55,0)
 S DIC("DR")="1///NOW;2////"_RO_";3////.5;9////"_PRIO_";28///"_SITE1_";30////"_OLREQDA_";33////"_DT
"RTN","DVBCXFRC",56,0)
 D FILE^DICN K DLAYGO
"RTN","DVBCXFRC",57,0)
 S (DA,REQDA)=+Y I DA<0 S OUT=1 D BULL1^DVBCXFRD Q
"RTN","DVBCXFRC",58,0)
 ;Give Med Center Primary Division as routing location (DVBCDIV)
"RTN","DVBCXFRC",59,0)
 S DIE="^DVB(396.3,"
"RTN","DVBCXFRC",60,0)
 S DR="10////"_OTHDIS_";10.1////"_OTHDIS1_";10.2////"_OTHDIS2_";17////NT" D ^DIE
"RTN","DVBCXFRC",61,0)
 S DR="21////"_CFREQ_";23.3////"_LREXMDT_";24////"_DVBCDIV
"RTN","DVBCXFRC",62,0)
 D ^DIE K DIC,DIE,DD,DO
"RTN","DVBCXFRC",63,0)
 S CNT=0 I '$D(^DVB(396.3,REQDA,2,0)) S ^(0)="^^0^0^"_DT_"^^^^"
"RTN","DVBCXFRC",64,0)
 F ZI=0:0 S ZI=$O(REMK(ZI)) Q:ZI=""  S X=REMK(ZI) S CNT=CNT+1,^DVB(396.3,REQDA,2,CNT,0)=X F Y=3,4 S $P(^DVB(396.3,REQDA,2,0),U,Y)=CNT
"RTN","DVBCXFRC",65,0)
 S X="",DVBADMNM=$P(SITE1,".",1)
"RTN","DVBCXFRC",66,0)
 F I=1:1 S EXM=$P(EXAMS,U,I) Q:EXM=""  D SETVARS Q:OUT
"RTN","DVBCXFRC",67,0)
 ;if adding exams failed, then delete request
"RTN","DVBCXFRC",68,0)
 I OUT S DA=REQDA,DIK="^DVB(396.3," D ^DIK K DA,DIK
"RTN","DVBCXFRC",69,0)
 Q
"RTN","DVBCXFRC",70,0)
 ;
"RTN","DVBCXFRC",71,0)
PATEDIT ;  ** Add entry and/or update file #2 (patient)
"RTN","DVBCXFRC",72,0)
 N DVBCPT,DVBCARAY,DVBCERR,DVBCIENS,DOB2,NAME1,NAME2,BYEAR,X,Y
"RTN","DVBCXFRC",73,0)
 K DVBCNEW S DVBCPT=$$FIND1^DIC(2,,"X",SSN,"SSN",,"DVBCERR")
"RTN","DVBCXFRC",74,0)
 ;if error returned, send error msg
"RTN","DVBCXFRC",75,0)
 I DVBCPT="" S OUT=1 D BULL9^DVBCXFRD Q
"RTN","DVBCXFRC",76,0)
 ;if found matching ssn, make sure the name and dob also match
"RTN","DVBCXFRC",77,0)
 I +DVBCPT>0 D  Q
"RTN","DVBCXFRC",78,0)
 .S DVBCIENS=DVBCPT_"," K DVBCERR
"RTN","DVBCXFRC",79,0)
 .D GETS^DIQ(2,DVBCIENS,".01;.03;.09","I","DVBCARAY","DVBCERR")
"RTN","DVBCXFRC",80,0)
 .;if fm returned an error msg and no data, send error msg
"RTN","DVBCXFRC",81,0)
 .I '$D(DVBCARAY(2,DVBCIENS)) S OUT=1 D BULL10^DVBCXFRD Q
"RTN","DVBCXFRC",82,0)
 .;make sure about that ssn
"RTN","DVBCXFRC",83,0)
 .I SSN'=DVBCARAY(2,DVBCIENS,.09,"I") S OUT=1,DVBCERR(1)="Possible 'SSN' index problem.",DVBCERR(2)=""
"RTN","DVBCXFRC",84,0)
 .;if name and/or dob don't match, send error msg
"RTN","DVBCXFRC",85,0)
 .I (PNAM'=DVBCARAY(2,DVBCIENS,.01,"I"))!(DOB'=DVBCARAY(2,DVBCIENS,.03,"I")) D  Q:OUT
"RTN","DVBCXFRC",86,0)
 ..S X=$P(PNAM,",",1),NAME1(1)=$P(X," ",1),X=$P(PNAM,",",2),NAME1(2)=$P(X," ",1)
"RTN","DVBCXFRC",87,0)
 ..S X=$P(DVBCARAY(2,DVBCIENS,.01,"I"),",",1),NAME2(1)=$P(X," ",1),X=$P(DVBCARAY(2,DVBCIENS,.01,"I"),",",2),NAME2(2)=$P(X," ",1)
"RTN","DVBCXFRC",88,0)
 ..I (NAME1(1)'=NAME2(1))!(NAME1(2)'=NAME2(2)) S OUT=1
"RTN","DVBCXFRC",89,0)
 ..S BYEAR(1)=$E(DOB,1,3),BYEAR(2)=$E(DVBCARAY(2,DVBCIENS,.03,"I"),1,3)
"RTN","DVBCXFRC",90,0)
 ..I BYEAR(1)'=BYEAR(2) S OUT=1
"RTN","DVBCXFRC",91,0)
 ..I OUT D
"RTN","DVBCXFRC",92,0)
 ...S DVBCERR(1)="Patient name and/or DOB at target site does not match transfer request."
"RTN","DVBCXFRC",93,0)
 ...S DOB2=DVBCARAY(2,DVBCIENS,.03,"I") S Y=DOB2 X ^DD("DD") S DOB2=Y
"RTN","DVBCXFRC",94,0)
 ...S DVBCERR(2)="Name: "_DVBCARAY(2,DVBCIENS,.01,"I")_"   DOB: "_DOB2
"RTN","DVBCXFRC",95,0)
 ...D BULL10^DVBCXFRD
"RTN","DVBCXFRC",96,0)
 .;otherwise, update address info
"RTN","DVBCXFRC",97,0)
 .S DFN=+DVBCPT K X,Y,DIC
"RTN","DVBCXFRC",98,0)
 .D ADDEDIT
"RTN","DVBCXFRC",99,0)
 ;if no match, then add record
"RTN","DVBCXFRC",100,0)
 I +DVBCPT=0 D  Q
"RTN","DVBCXFRC",101,0)
 .K DA,DR,DIC,DO,DD,X,Y S DVBCNEW=1
"RTN","DVBCXFRC",102,0)
 .S DLAYGO=2,DIC="^DPT(",DIC(0)="L",X=PNAM,DIC("DR")=".02////"_SEX_";.03////"_DOB_";.09////"_SSN
"RTN","DVBCXFRC",103,0)
 .D FILE^DICN K DLAYGO S (DFN,DA)=+Y
"RTN","DVBCXFRC",104,0)
 .I DA<0 D BULL3^DVBCXFRD S OUT=1 Q
"RTN","DVBCXFRC",105,0)
 .S DGMSGF=1 ;why is this variable needed?
"RTN","DVBCXFRC",106,0)
 .D ADDEDIT
"RTN","DVBCXFRC",107,0)
 .S DIE="^DPT(",DA=DFN
"RTN","DVBCXFRC",108,0)
 .S DR(1,2,1)=".301////"_SRVCON_";.302////"_SRVPCT_";.314////"_CFLOC_";.313////"_CNUM_";.323////"_PDSRV_";.326////"_SRVEDT_";.327////"_SRVSDT_";.361////"_ELIGCOD
"RTN","DVBCXFRC",109,0)
 .S DR(1,2,2)=".3611////"_ELIGST_";.3612////"_ELIGSDT_";.525////"_POWSTAT_";1901////"_VETST
"RTN","DVBCXFRC",110,0)
 .S:TYPEPTR]"" DR(1,2,3)="391////"_TYPEPTR
"RTN","DVBCXFRC",111,0)
 .D ^DIE
"RTN","DVBCXFRC",112,0)
 Q
"RTN","DVBCXFRC",113,0)
 ;
"RTN","DVBCXFRC",114,0)
SETVARS ;  ** Add entry to file #396.4 (exam) **
"RTN","DVBCXFRC",115,0)
 I REASONS'="" DO
"RTN","DVBCXFRC",116,0)
 .S EXMRS=$P(REASONS,U,I) ;**Stuff Insufficient Reason
"RTN","DVBCXFRC",117,0)
 .S XMORPV="Transferred from "_DVBADMNM ;**Stuff Original Provider
"RTN","DVBCXFRC",118,0)
 S DIC="^DVB(396.4,"
"RTN","DVBCXFRC",119,0)
 S DIC(0)="L",DLAYGO=396.4
"RTN","DVBCXFRC",120,0)
 S DIC("DR")=".02////"_REQDA_";.03////"_EXM_";.04////O;63////"_DT
"RTN","DVBCXFRC",121,0)
 S:REASONS'="" DIC("DR")=DIC("DR")_";.11///"_EXMRS_";.12///"_XMORPV
"RTN","DVBCXFRC",122,0)
 S X=$$EXAM^DVBCUTL4 I 'X S OUT=1 D BULL2^DVBCXFRD Q
"RTN","DVBCXFRC",123,0)
 S DINUM=X K DD,DO D FILE^DICN
"RTN","DVBCXFRC",124,0)
 I +Y=-1 S OUT=1 D BULL2^DVBCXFRD
"RTN","DVBCXFRC",125,0)
 K DLAYGO,DIC,X,Y
"RTN","DVBCXFRC",126,0)
 Q
"RTN","DVBCXFRC",127,0)
 ;
"RTN","DVBCXFRC",128,0)
ADDEDIT ;  ** Edit Patient address (Always!) **
"RTN","DVBCXFRC",129,0)
 S DA=DFN,DIE="^DPT("
"RTN","DVBCXFRC",130,0)
 S:ADR1="" ADR1="@" S:ADR2="" ADR2="@" S:ADR3="" ADR3="@"
"RTN","DVBCXFRC",131,0)
 S:CITY="" CITY="@" S:STATE="" STATE="@" S:ZIP="" ZIP="@"
"RTN","DVBCXFRC",132,0)
 S:CNTY="" CNTY="@" S:HOMPHON="" HOMPHON="@" S:BUSPHON="" BUSPHON="@"
"RTN","DVBCXFRC",133,0)
 S DR=".111////"_ADR1_";.112////"_ADR2_";.113////"_ADR3_";.114////"_CITY_";.115////"_STATE_$S(ZIP4]"":";.1112////"_ZIP4,1:";.116////"_ZIP)_";.117////"_CNTY_";.131////"_HOMPHON_";.132////"_BUSPHON
"RTN","DVBCXFRC",134,0)
 D ^DIE K DIE,DA
"RTN","DVBCXFRC",135,0)
 Q
"RTN","DVBCXFRD")
0^2^B17456538
"RTN","DVBCXFRD",1,0)
DVBCXFRD ;ALB/GTS-557/THM-MISCELLANOUS TRANSFER BULLETINS ; 4/17/91  10:59 AM
"RTN","DVBCXFRD",2,0)
 ;;2.7;AMIE;**18**;Apr 10, 1995
"RTN","DVBCXFRD",3,0)
 ;
"RTN","DVBCXFRD",4,0)
BULL1 S FREAS="Addition of C&P request record at target site failed." K MCP D PAR Q
"RTN","DVBCXFRD",5,0)
 ;
"RTN","DVBCXFRD",6,0)
BULL2 ;  ** Adding exams failed & request deleted **
"RTN","DVBCXFRD",7,0)
 N FREAS,FREAS1
"RTN","DVBCXFRD",8,0)
 S FREAS="Addition of C&P exams for request record at target site failed."
"RTN","DVBCXFRD",9,0)
 S FREAS1="Therefore, the C&P request record was deleted."
"RTN","DVBCXFRD",10,0)
 K MCP D PAR
"RTN","DVBCXFRD",11,0)
 Q
"RTN","DVBCXFRD",12,0)
 ;
"RTN","DVBCXFRD",13,0)
BULL3 S FREAS="Addition of veteran in Patient file at target site failed." K MCP,DVBCNEW D PAR Q
"RTN","DVBCXFRD",14,0)
 ;
"RTN","DVBCXFRD",15,0)
BULL4 S FREAS="Missing C&P request for transfer in - pointer="_REQDA_".",MCP=1 D PAR Q
"RTN","DVBCXFRD",16,0)
 ;
"RTN","DVBCXFRD",17,0)
BULL5 S FREAS="Missing C&P exams for transfer in",MCP=1 D PAR Q
"RTN","DVBCXFRD",18,0)
 ;
"RTN","DVBCXFRD",19,0)
BULL6 S FREAS="Local unload of MailMan message failed." K MCP D PAR Q
"RTN","DVBCXFRD",20,0)
 ;
"RTN","DVBCXFRD",21,0)
BULL7 ;  **  Bulletin for failed address edit  **
"RTN","DVBCXFRD",22,0)
 S FREAS="Edit of veteran address in patient file at target site failed."
"RTN","DVBCXFRD",23,0)
 K MCP D PAR
"RTN","DVBCXFRD",24,0)
 Q
"RTN","DVBCXFRD",25,0)
 ;
"RTN","DVBCXFRD",26,0)
BULL8 ;  ** Target site has no primary division **
"RTN","DVBCXFRD",27,0)
 N FREAS,FREAS1
"RTN","DVBCXFRD",28,0)
 S FREAS="Addition of C&P request record at target site failed."
"RTN","DVBCXFRD",29,0)
 S FREAS1="Could not determine primary medical center division."
"RTN","DVBCXFRD",30,0)
 D PAR
"RTN","DVBCXFRD",31,0)
 Q
"RTN","DVBCXFRD",32,0)
 ;
"RTN","DVBCXFRD",33,0)
BULL9 ;  ** Duplicate SSNs exist or other problem in file #2 **
"RTN","DVBCXFRD",34,0)
 N ERR,FREAS,FREAS1
"RTN","DVBCXFRD",35,0)
 S FREAS="Update of patient data at target site failed."
"RTN","DVBCXFRD",36,0)
 ;if duplicate ssn, then send in error msg
"RTN","DVBCXFRD",37,0)
 I $D(DVBCERR("DIERR","E",299)) D
"RTN","DVBCXFRD",38,0)
 .S ERR=$O(DVBCERR("DIERR","E",299,0)) I ERR S FREAS1=DVBCERR("DIERR",ERR,"TEXT",1)
"RTN","DVBCXFRD",39,0)
 ;if other problem, then just send the first error msg available
"RTN","DVBCXFRD",40,0)
 I '$D(DVBCERR("DIERR","E",299)) D
"RTN","DVBCXFRD",41,0)
 .S FREAS1=DVBCERR("DIERR",1,"TEXT",1)
"RTN","DVBCXFRD",42,0)
 D PAR
"RTN","DVBCXFRD",43,0)
 Q
"RTN","DVBCXFRD",44,0)
 ;
"RTN","DVBCXFRD",45,0)
BULL10 ;  ** Same SSN but possibly different patient in file #2 **
"RTN","DVBCXFRD",46,0)
 N FREAS,FREAS1,FREAS2,FREAS3
"RTN","DVBCXFRD",47,0)
 S FREAS="Update of patient data at target site failed for SSN "_SSN_"."
"RTN","DVBCXFRD",48,0)
 ;if error returned from fm, just send the first error msg available
"RTN","DVBCXFRD",49,0)
 I $D(DVBCERR("DIERR")) S FREAS1=DVBCERR("DIERR",1,"TEXT",1)
"RTN","DVBCXFRD",50,0)
 ;if name or dob didn't match, then send back that info
"RTN","DVBCXFRD",51,0)
 I $D(DVBCERR(1)) S FREAS1=DVBCERR(1),FREAS2="At target site --",FREAS3=DVBCERR(2)
"RTN","DVBCXFRD",52,0)
 D PAR
"RTN","DVBCXFRD",53,0)
 Q
"RTN","DVBCXFRD",54,0)
 ;
"RTN","DVBCXFRD",55,0)
BULL11 ;  ** Regional office station# doesn't exist or not unique **
"RTN","DVBCXFRD",56,0)
 N FREAS,FREAS1,FREAS2
"RTN","DVBCXFRD",57,0)
 S FREAS="Addition of C&P request record at target site failed."
"RTN","DVBCXFRD",58,0)
 I RO="" S FREAS1="Your Regional Office station # ("_RONAM_") is not unique"
"RTN","DVBCXFRD",59,0)
 I RO=0 S FREAS1="Your Regional Office station # ("_RONAM_") could not be found"
"RTN","DVBCXFRD",60,0)
 S FREAS2="in the Institution file of the target site."
"RTN","DVBCXFRD",61,0)
 D PAR
"RTN","DVBCXFRD",62,0)
 Q
"RTN","DVBCXFRD",63,0)
 ;
"RTN","DVBCXFRD",64,0)
PAR K ^TMP("DVBC","BULL",$J) S XMSUB="C&P Request Transfer Failure",XMDUZ=.5,XMTEXT="^TMP(""DVBC"",""BULL"",$J,",L=0 I $D(MCP) S USR=$S($D(^DVB(396.3,REQDA,4)):$P(^(4),U,2),1:0) I USR>0 S XMY(USR)="" G PAR1
"RTN","DVBCXFRD",65,0)
 S XMY(USER_"@"_SITE1)=SITE
"RTN","DVBCXFRD",66,0)
 ;
"RTN","DVBCXFRD",67,0)
PAR1 S XMY(XMDUZ)="",L=1,^TMP("DVBC","BULL",$J,L,0)="The transfer of a C&P request "_$S($D(MCP):"from ",1:"to ")_$P(^DVB(396.1,1,0),U,1),L=L+1
"RTN","DVBCXFRD",68,0)
 K MCP S ^TMP("DVBC","BULL",$J,L,0)="for the following veteran has failed:",L=L+1
"RTN","DVBCXFRD",69,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   ",L=L+1
"RTN","DVBCXFRD",70,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   Name: "_PNAM_"   SSN: "_SSN_"   "_"C-Number: "_CNUM,L=L+1
"RTN","DVBCXFRD",71,0)
 S Y=DOB X ^DD("DD") S DOB2=Y
"RTN","DVBCXFRD",72,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   DOB: "_DOB2,L=L+1
"RTN","DVBCXFRD",73,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",74,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Reason for failure: ",L=L+1
"RTN","DVBCXFRD",75,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",76,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS,L=L+1
"RTN","DVBCXFRD",77,0)
 I $D(FREAS1) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS1,L=L+1
"RTN","DVBCXFRD",78,0)
 I $D(FREAS2) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS2,L=L+1
"RTN","DVBCXFRD",79,0)
 I $D(FREAS3) S ^TMP("DVBC","BULL",$J,L,0)="  "_FREAS3,L=L+1
"RTN","DVBCXFRD",80,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",81,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",82,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Original sender: "_USER_" at "_SITE1,L=L+1
"RTN","DVBCXFRD",83,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCXFRD",84,0)
 D ^XMD
"RTN","DVBCXFRD",85,0)
 Q
"VER")
8.0^21.0
**END**
**END**
