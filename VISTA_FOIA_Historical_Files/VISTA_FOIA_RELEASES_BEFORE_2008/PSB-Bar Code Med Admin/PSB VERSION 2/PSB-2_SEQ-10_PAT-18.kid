Released PSB*2*18 SEQ #10
Extracted from mail message
**KIDS**:PSB*2.0*18^

**INSTALL NAME**
PSB*2.0*18
"BLD",3753,0)
PSB*2.0*18^BAR CODE MED ADMIN^0^3030203^y
"BLD",3753,1,0)
^^21^21^3030130^
"BLD",3753,1,1,0)
Install this patch before installing Patch PSB*2*6. It will perform the
"BLD",3753,1,2,0)
same medication order validation as Patch PSB*2*6, and allows Pharmacists
"BLD",3753,1,3,0)
an opportunity to review "problem" medication orders before your site
"BLD",3753,1,4,0)
installs PSB*2*6. Ensure that PSB*2*6 is installed immediately following
"BLD",3753,1,5,0)
the correction of any problem medication orders. Failure to do so may
"BLD",3753,1,6,0)
result in medication orders not displaying on the Virtual Due List (VDL).
"BLD",3753,1,7,0)
 
"BLD",3753,1,8,0)
The person installing this patch will receive two separate MailMan
"BLD",3753,1,9,0)
messages with the following subjects:
"BLD",3753,1,10,0)
 
"BLD",3753,1,11,0)
BCMA Order Problem Notification Started on JAN 7,2003@08:24:18.
"BLD",3753,1,12,0)
This will let the user know the date and time the process started.
"BLD",3753,1,13,0)
 
"BLD",3753,1,14,0)
BCMA Order Problem Notification Finished on JAN 7,2003@08:30:47.
"BLD",3753,1,15,0)
This will let the user know the date and time the process finished.
"BLD",3753,1,16,0)
 
"BLD",3753,1,17,0)
The person installing this patch will also receive a MailMan message
"BLD",3753,1,18,0)
with the subject: BCMA Pre patch 6 - Order Problem Notification. This will
"BLD",3753,1,19,0)
let the user know that PSB*2*6 will have a problem displaying an order,
"BLD",3753,1,20,0)
which is identified in the message text. A separate MailMan message
"BLD",3753,1,21,0)
will be generated for each Order Problem.
"BLD",3753,4,0)
^9.64PA^^0
"BLD",3753,"INID")
^n
"BLD",3753,"INIT")
PSBPRSIX
"BLD",3753,"KRN",0)
^9.67PA^8989.52^19
"BLD",3753,"KRN",.4,0)
.4
"BLD",3753,"KRN",.401,0)
.401
"BLD",3753,"KRN",.402,0)
.402
"BLD",3753,"KRN",.403,0)
.403
"BLD",3753,"KRN",.5,0)
.5
"BLD",3753,"KRN",.84,0)
.84
"BLD",3753,"KRN",3.6,0)
3.6
"BLD",3753,"KRN",3.8,0)
3.8
"BLD",3753,"KRN",9.2,0)
9.2
"BLD",3753,"KRN",9.8,0)
9.8
"BLD",3753,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3753,"KRN",9.8,"NM",1,0)
PSBPRSIX^^0^B75461735
"BLD",3753,"KRN",9.8,"NM",2,0)
PSBPRM^^0^B5317245
"BLD",3753,"KRN",9.8,"NM",3,0)
PSBNWDL^^0^B84979052
"BLD",3753,"KRN",9.8,"NM","B","PSBNWDL",3)

"BLD",3753,"KRN",9.8,"NM","B","PSBPRM",2)

"BLD",3753,"KRN",9.8,"NM","B","PSBPRSIX",1)

"BLD",3753,"KRN",19,0)
19
"BLD",3753,"KRN",19.1,0)
19.1
"BLD",3753,"KRN",101,0)
101
"BLD",3753,"KRN",409.61,0)
409.61
"BLD",3753,"KRN",771,0)
771
"BLD",3753,"KRN",870,0)
870
"BLD",3753,"KRN",8989.51,0)
8989.51
"BLD",3753,"KRN",8989.52,0)
8989.52
"BLD",3753,"KRN",8994,0)
8994
"BLD",3753,"KRN","B",.4,.4)

"BLD",3753,"KRN","B",.401,.401)

"BLD",3753,"KRN","B",.402,.402)

"BLD",3753,"KRN","B",.403,.403)

"BLD",3753,"KRN","B",.5,.5)

"BLD",3753,"KRN","B",.84,.84)

"BLD",3753,"KRN","B",3.6,3.6)

"BLD",3753,"KRN","B",3.8,3.8)

"BLD",3753,"KRN","B",9.2,9.2)

"BLD",3753,"KRN","B",9.8,9.8)

"BLD",3753,"KRN","B",19,19)

"BLD",3753,"KRN","B",19.1,19.1)

"BLD",3753,"KRN","B",101,101)

"BLD",3753,"KRN","B",409.61,409.61)

"BLD",3753,"KRN","B",771,771)

"BLD",3753,"KRN","B",870,870)

"BLD",3753,"KRN","B",8989.51,8989.51)

"BLD",3753,"KRN","B",8989.52,8989.52)

"BLD",3753,"KRN","B",8994,8994)

"BLD",3753,"QUES",0)
^9.62^^
"BLD",3753,"REQB",0)
^9.611^^
"INIT")
PSBPRSIX
"MBREQ")
0
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
2.0^3020514^3020724^10000000048
"PKG",536,22,1,"PAH",1,0)
18^3030203^11874
"PKG",536,22,1,"PAH",1,1,0)
^^21^21^3030203
"PKG",536,22,1,"PAH",1,1,1,0)
Install this patch before installing Patch PSB*2*6. It will perform the
"PKG",536,22,1,"PAH",1,1,2,0)
same medication order validation as Patch PSB*2*6, and allows Pharmacists
"PKG",536,22,1,"PAH",1,1,3,0)
an opportunity to review "problem" medication orders before your site
"PKG",536,22,1,"PAH",1,1,4,0)
installs PSB*2*6. Ensure that PSB*2*6 is installed immediately following
"PKG",536,22,1,"PAH",1,1,5,0)
the correction of any problem medication orders. Failure to do so may
"PKG",536,22,1,"PAH",1,1,6,0)
result in medication orders not displaying on the Virtual Due List (VDL).
"PKG",536,22,1,"PAH",1,1,7,0)
 
"PKG",536,22,1,"PAH",1,1,8,0)
The person installing this patch will receive two separate MailMan
"PKG",536,22,1,"PAH",1,1,9,0)
messages with the following subjects:
"PKG",536,22,1,"PAH",1,1,10,0)
 
"PKG",536,22,1,"PAH",1,1,11,0)
BCMA Order Problem Notification Started on JAN 7,2003@08:24:18.
"PKG",536,22,1,"PAH",1,1,12,0)
This will let the user know the date and time the process started.
"PKG",536,22,1,"PAH",1,1,13,0)
 
"PKG",536,22,1,"PAH",1,1,14,0)
BCMA Order Problem Notification Finished on JAN 7,2003@08:30:47.
"PKG",536,22,1,"PAH",1,1,15,0)
This will let the user know the date and time the process finished.
"PKG",536,22,1,"PAH",1,1,16,0)
 
"PKG",536,22,1,"PAH",1,1,17,0)
The person installing this patch will also receive a MailMan message
"PKG",536,22,1,"PAH",1,1,18,0)
with the subject: BCMA Pre patch 6 - Order Problem Notification. This will
"PKG",536,22,1,"PAH",1,1,19,0)
let the user know that PSB*2*6 will have a problem displaying an order,
"PKG",536,22,1,"PAH",1,1,20,0)
which is identified in the message text. A separate MailMan message
"PKG",536,22,1,"PAH",1,1,21,0)
will be generated for each Order Problem.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSBNWDL")
0^3^B84979052
"RTN","PSBNWDL",1,0)
PSBNWDL ;BIRMINGHAM/EFC-BCMA PRE PATCH 6 ;May 2002
"RTN","PSBNWDL",2,0)
 ;;2.0;BAR CODE MED ADMIN;**18**;May 2002
"RTN","PSBNWDL",3,0)
 ;
"RTN","PSBNWDL",4,0)
 ;EN^PSJBCMA/2828
"RTN","PSBNWDL",5,0)
 ;
"RTN","PSBNWDL",6,0)
EN ;Begin printing due list
"RTN","PSBNWDL",7,0)
 ;
"RTN","PSBNWDL",8,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG
"RTN","PSBNWDL",9,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBNWDL",10,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBNWDL",11,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBNWDL",12,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBNWDL",13,0)
 .K PSBHDR
"RTN","PSBNWDL",14,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBNWDL",15,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(1)=PSBHDR(1)_Y_"  "
"RTN","PSBNWDL",16,0)
 .S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)_"-"
"RTN","PSBNWDL",17,0)
 .S Y=$P(PSBRPT(.1),U,9) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBNWDL",18,0)
 .S:$P(PSBRPT(.2),U,6) X="IV "
"RTN","PSBNWDL",19,0)
 .S:$P(PSBRPT(.2),U,7) X=X_$S(X]"":"& ",1:"")_"Unit Dose "
"RTN","PSBNWDL",20,0)
 .S PSBHDR(2)="Order Type(s): "_X_" -- "
"RTN","PSBNWDL",21,0)
 .F Y=1:1:4 D:$P(PSBRPT(.2),U,Y)
"RTN","PSBNWDL",22,0)
 ..S PSBHDR(2)=PSBHDR(2)_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" "
"RTN","PSBNWDL",23,0)
 .D PRINT(DFN)
"RTN","PSBNWDL",24,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBNWDL",25,0)
 Q
"RTN","PSBNWDL",26,0)
 ;
"RTN","PSBNWDL",27,0)
PRINT(DFN) ; Print from TMP($J...
"RTN","PSBNWDL",28,0)
 ; Multiple calls if a ward is selected
"RTN","PSBNWDL",29,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBODATE,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBNWDL",30,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBNWDL",31,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG
"RTN","PSBNWDL",32,0)
 W $$HDR()
"RTN","PSBNWDL",33,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBNWDL",34,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBNWDL",35,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBNWDL",36,0)
 S P=PSBODATE
"RTN","PSBNWDL",37,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBNWDL",38,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBNWDL",39,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D  Q
"RTN","PSBNWDL",40,0)
 .W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBNWDL",41,0)
 .W !,$$BLANKS(),$$FTR()
"RTN","PSBNWDL",42,0)
 S PSBINDX=0
"RTN","PSBNWDL",43,0)
 F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBNWDL",44,0)
 .S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBNWDL",45,0)
 .Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pending this version
"RTN","PSBNWDL",46,0)
 .S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBNWDL",47,0)
 .I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,8)) Q
"RTN","PSBNWDL",48,0)
 .Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBNWDL",49,0)
 .Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBNWDL",50,0)
 .S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBNWDL",51,0)
 .S Y=$P(PSBSTAT,U,2)
"RTN","PSBNWDL",52,0)
 .Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBNWDL",53,0)
 .Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBNWDL",54,0)
 .Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBNWDL",55,0)
 .Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBNWDL",56,0)
 .S PSBSCHT=Y
"RTN","PSBNWDL",57,0)
 .S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBNWDL",58,0)
 .S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBNWDL",59,0)
 .S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBNWDL",60,0)
 .S:PSBMED="" PSBMED="NOT FOUND"
"RTN","PSBNWDL",61,0)
 .S:PSBORD="" PSBORD="NOT FOUND"
"RTN","PSBNWDL",62,0)
 .S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBNWDL",63,0)
 I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT**" W !,$$BLANKS(),$$FTR() Q
"RTN","PSBNWDL",64,0)
 S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBNWDL",65,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBNWDL",66,0)
 .K PSBORD
"RTN","PSBNWDL",67,0)
 .S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBNWDL",68,0)
 .S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBNWDL",69,0)
 .S PSBMED=$QS(PSBGBL,6)
"RTN","PSBNWDL",70,0)
 .S PSBORD=$QS(PSBGBL,7)
"RTN","PSBNWDL",71,0)
 .D CLEAN^PSBVT
"RTN","PSBNWDL",72,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBNWDL",73,0)
 .D NOW^%DTC S PSBNOW=%
"RTN","PSBNWDL",74,0)
 .Q:PSBOSP'>PSBNOW  ; Expired 
"RTN","PSBNWDL",75,0)
 .Q:(PSBOSP<PSBOSTRT!(PSBOST>PSBOSTOP))&(PSBSCHT'="O")
"RTN","PSBNWDL",76,0)
 .S X=$$GET^XPAR("DIV","PSB ADMIN BEFORE")
"RTN","PSBNWDL",77,0)
 .; One time strt DT > DL Stp DT + admin bfr win
"RTN","PSBNWDL",78,0)
 .Q:PSBSCHT="O"&(PSBOST>$$FMADD^XLFDT(PSBOSTOP,"","",+X))
"RTN","PSBNWDL",79,0)
 .; One time > 12 hours older than start of DL window
"RTN","PSBNWDL",80,0)
 .; Order ok for this date? (check QOD/Q72H stuff)
"RTN","PSBNWDL",81,0)
 .;Get adm times using freq.
"RTN","PSBNWDL",82,0)
 .S (PSBYES,PSBODD)=0
"RTN","PSBNWDL",83,0)
 .S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBNWDL",84,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBNWDL",85,0)
 .I PSBYES,PSBADST="" D  Q
"RTN","PSBNWDL",86,0)
 ..D ERROR^PSBPRM(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBNWDL",87,0)
 .I PSBSCHT="OC" S PSBYES=1
"RTN","PSBNWDL",88,0)
 .I PSBSCHT="P" S PSBYES=1
"RTN","PSBNWDL",89,0)
 .I PSBONX["V" S PSBYES=1
"RTN","PSBNWDL",90,0)
 .I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBNWDL",91,0)
 .I PSBIVT["S",PSBISYR'=1 S PSBYES=1  ;  allow intermit syringe
"RTN","PSBNWDL",92,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBNWDL",93,0)
 .I PSBIVT["C",PSBCHEMT="A" S PSBYES=1  ;   allow Chemo w/ intrmit syror Pgback type
"RTN","PSBNWDL",94,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBNWDL",95,0)
 .I 'PSBYES,PSBADST="",PSBFREQ<1 D  Q
"RTN","PSBNWDL",96,0)
 ..D ERROR^PSBPRM(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBNWDL",97,0)
 .I +PSBFREQ>0 D
"RTN","PSBNWDL",98,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBNWDL",99,0)
 .I PSBODD,PSBADST'="" D  Q
"RTN","PSBNWDL",100,0)
 ..D ERROR^PSBPRM(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBNWDL",101,0)
 .I PSBADST'="" D
"RTN","PSBNWDL",102,0)
 ..F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBNWDL",103,0)
 ...;Invalid adm times
"RTN","PSBNWDL",104,0)
 ...D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBNWDL",105,0)
 ....D ERROR^PSBPRM(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBNWDL",106,0)
 .I PSBSCHT="C",PSBOTYP="U" Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)
"RTN","PSBNWDL",107,0)
 .I PSBSCHT="C",PSBOTYP="V",$G(PSBIVT)="P" Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ)
"RTN","PSBNWDL",108,0)
 .; One Time Given
"RTN","PSBNWDL",109,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBNWDL",110,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBNWDL",111,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBNWDL",112,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBNWDL",113,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBNWDL",114,0)
 .S PSBRMN=1
"RTN","PSBNWDL",115,0)
 .I PSBSCHT="O",PSBOST'=PSBOSP,PSBOSP<PSBOSTRT S PSBRMN=0
"RTN","PSBNWDL",116,0)
 .Q:'PSBRMN
"RTN","PSBNWDL",117,0)
 .; Is On-Call Given
"RTN","PSBNWDL",118,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBNWDL",119,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBNWDL",120,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBNWDL",121,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBNWDL",122,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBNWDL",123,0)
 .; Get last date/time given (Actually Given, not held refused etc.)
"RTN","PSBNWDL",124,0)
 .S PSBLGDT="",X=""
"RTN","PSBNWDL",125,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBNWDL",126,0)
 ..S PSBIEN=""
"RTN","PSBNWDL",127,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBNWDL",128,0)
 ...S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBNWDL",129,0)
 .S PSBADMIN=""
"RTN","PSBNWDL",130,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBNWDL",131,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBNWDL",132,0)
 ..D:PSBX=""
"RTN","PSBNWDL",133,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBNWDL",134,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBNWDL",135,0)
 ...I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBNWDL",136,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBNWDL",137,0)
 ..I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBNWDL",138,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBNWDL",139,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBNWDL",140,0)
 ..I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBNWDL",141,0)
 ..I PSBX="" D
"RTN","PSBNWDL",142,0)
 ...S PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) ;If non-standard schedule then calculate based on frequency 
"RTN","PSBNWDL",143,0)
 ..E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBNWDL",144,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBNWDL",145,0)
 ...F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBNWDL",146,0)
 ....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBNWDL",147,0)
 ....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)  ; Report Window
"RTN","PSBNWDL",148,0)
 ....D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBNWDL",149,0)
 ....D:(+PSBZ(0)<0)&(PSBCNT=1)
"RTN","PSBNWDL",150,0)
 .....S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)=""
"RTN","PSBNWDL",151,0)
 ....Q:+PSBZ(0)<0
"RTN","PSBNWDL",152,0)
 ....S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBNWDL",153,0)
 .D:$Y>(IOSL-12)
"RTN","PSBNWDL",154,0)
 ..W !?(IOM-36\2),"(Medications Continued on Next Page)"
"RTN","PSBNWDL",155,0)
 ..W $$FTR()
"RTN","PSBNWDL",156,0)
 ..W $$HDR()
"RTN","PSBNWDL",157,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBNWDL",158,0)
 .E  S PSBSM=""
"RTN","PSBNWDL",159,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBNWDL",160,0)
 .S X="",Y=0
"RTN","PSBNWDL",161,0)
 .W $$WRAP(14,34,PSBMED)
"RTN","PSBNWDL",162,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBNWDL",163,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBNWDL",164,0)
 .W ?78,PSBMRAB
"RTN","PSBNWDL",165,0)
 .W ?85 D:PSBLGDT
"RTN","PSBNWDL",166,0)
 ..W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3)
"RTN","PSBNWDL",167,0)
 ..W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBNWDL",168,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBNWDL",169,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBNWDL",170,0)
 .W ?120
"RTN","PSBNWDL",171,0)
 .W $S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBNWDL",172,0)
 .W $S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBNWDL",173,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2)
"RTN","PSBNWDL",174,0)
 .W ?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBNWDL",175,0)
 .W IOINHI  ; To Highlight the Dispense Drugs...
"RTN","PSBNWDL",176,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBNWDL",177,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBNWDL",178,0)
 ..W !?14,"*"
"RTN","PSBNWDL",179,0)
 ..W $$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBNWDL",180,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  D
"RTN","PSBNWDL",181,0)
 ..W !?14,"*"
"RTN","PSBNWDL",182,0)
 ..W $$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBNWDL",183,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  D
"RTN","PSBNWDL",184,0)
 ..W !?14,"*"
"RTN","PSBNWDL",185,0)
 ..W $$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBNWDL",186,0)
 .W IOINORM ; Highlight Off
"RTN","PSBNWDL",187,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBNWDL",188,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBNWDL",189,0)
 .S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBNWDL",190,0)
 .W $$WRAP(14,34,"Spec Inst: "_X)
"RTN","PSBNWDL",191,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBNWDL",192,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBNWDL",193,0)
 W $$BLANKS(),$$FTR()
"RTN","PSBNWDL",194,0)
 S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBNWDL",195,0)
 I $P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)) D EN^PSBODL1
"RTN","PSBNWDL",196,0)
 Q
"RTN","PSBNWDL",197,0)
 ;
"RTN","PSBNWDL",198,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBNWDL",199,0)
 F  Q:'$L(Z)  D
"RTN","PSBNWDL",200,0)
 .W:$X>X !
"RTN","PSBNWDL",201,0)
 .W:$X<X ?X
"RTN","PSBNWDL",202,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBNWDL",203,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBNWDL",204,0)
 .S:PSB<1 PSB=Y
"RTN","PSBNWDL",205,0)
 .W $E(Z,1,PSB)
"RTN","PSBNWDL",206,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBNWDL",207,0)
 Q ""
"RTN","PSBNWDL",208,0)
 ;
"RTN","PSBNWDL",209,0)
FTR() ; [Extrinsic] Page footer
"RTN","PSBNWDL",210,0)
 ;
"RTN","PSBNWDL",211,0)
 ; Sub Module Description:
"RTN","PSBNWDL",212,0)
 ; (No Description Available)
"RTN","PSBNWDL",213,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBNWDL",214,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBNWDL",215,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBNWDL",216,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBNWDL",217,0)
 Q ""
"RTN","PSBNWDL",218,0)
 ;
"RTN","PSBNWDL",219,0)
HDR() ; Page Header
"RTN","PSBNWDL",220,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBNWDL",221,0)
 W !,"Self",?86,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBNWDL",222,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBNWDL",223,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBNWDL",224,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBNWDL",225,0)
 Q ""
"RTN","PSBNWDL",226,0)
 ;
"RTN","PSBNWDL",227,0)
BLANKS() ; [Extrinsic] Print blanks at end of printout for changes
"RTN","PSBNWDL",228,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBNWDL",229,0)
 W !
"RTN","PSBNWDL",230,0)
 D:$Y>(IOSL-26)
"RTN","PSBNWDL",231,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBNWDL",232,0)
 .W $$FTR(),$$HDR() ; Not enough space for the blanks here - new page
"RTN","PSBNWDL",233,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBNWDL",234,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBNWDL",235,0)
 F X=1:1:4 D
"RTN","PSBNWDL",236,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBNWDL",237,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBNWDL",238,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBNWDL",239,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBNWDL",240,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBNWDL",241,0)
 .W !?20,"Spec"
"RTN","PSBNWDL",242,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBNWDL",243,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBNWDL",244,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBNWDL",245,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBNWDL",246,0)
 Q ""
"RTN","PSBNWDL",247,0)
 ;
"RTN","PSBNWDL",248,0)
 ;
"RTN","PSBPRM")
0^2^B5317245
"RTN","PSBPRM",1,0)
PSBPRM ;BIRMINGHAM/BSR-BCMA PRE PATCH 6 ;May 2002
"RTN","PSBPRM",2,0)
 ;;2.0;BAR CODE MED ADMIN;**18**;May 2002
"RTN","PSBPRM",3,0)
 ;
"RTN","PSBPRM",4,0)
ERROR(PSB1,PSB2,DFN,PSB3,PSB4)  ;
"RTN","PSBPRM",5,0)
 ; PSB1 = order #
"RTN","PSBPRM",6,0)
 ; PSB2 = orderable item
"RTN","PSBPRM",7,0)
 ; PSB3 = message to be sent
"RTN","PSBPRM",8,0)
 ; PSB4 = schedule
"RTN","PSBPRM",9,0)
 ; Send Error Msg about problems
"RTN","PSBPRM",10,0)
 S PSBMG=DUZ ;$$GET^XPAR("DIV","PSB MG DUE LIST ERROR",,"E")
"RTN","PSBPRM",11,0)
 Q:PSBMG=""
"RTN","PSBPRM",12,0)
 S PSBMSG(1)=" "
"RTN","PSBPRM",13,0)
 S PSBMSG(2)="  Please coordinate with pharmacy to correct order. "
"RTN","PSBPRM",14,0)
 S PSBMSG(3)=" "
"RTN","PSBPRM",15,0)
 S PSBMSG(4)="  Order Number....: "_PSB1
"RTN","PSBPRM",16,0)
 S PSBMSG(5)="  Orderable Item..: "_PSB2
"RTN","PSBPRM",17,0)
 S PSBMSG(6)="  Patient.........: "_$$GET1^DIQ(2,DFN_",",.01)_"("_$$GET1^DIQ(2,DFN_",",.09)_")"
"RTN","PSBPRM",18,0)
 S PSBMSG(7)="  Ward/Bed........:"_$$GET1^DIQ(2,DFN_",",.1)_"/"_$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBPRM",19,0)
 S PSBMSG(8)="  Reason..........: "_PSB3
"RTN","PSBPRM",20,0)
 S PSBMSG(9)="  Schedule........: "_PSB4
"RTN","PSBPRM",21,0)
 S PSBMSG(10)="  "
"RTN","PSBPRM",22,0)
 S PSBMSG(11)="NOTE:  Coordinate order corrections with the installation"
"RTN","PSBPRM",23,0)
 S PSBMSG(12)="       of PSB*2*6 to prevent display inconsistencies."
"RTN","PSBPRM",24,0)
 S PSBMSG(13)="     "
"RTN","PSBPRM",25,0)
 S PSBMSG(14)="                                          Thank you!    "
"RTN","PSBPRM",26,0)
 S XMY(DUZ)="",XMTEXT="PSBMSG(",XMSUB="BCMA Pre patch 6 - Order Problem Notification."
"RTN","PSBPRM",27,0)
 D ^XMD
"RTN","PSBPRM",28,0)
 K PSB1,PSB2,PSB3,PSB4,PSBMSG,PSBMG,XMY,XMSUB,XMTEXT
"RTN","PSBPRM",29,0)
 Q
"RTN","PSBPRM",30,0)
 ;
"RTN","PSBPRM",31,0)
MSGEND ;
"RTN","PSBPRM",32,0)
 K PSG,XMY
"RTN","PSBPRM",33,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSBPRM",34,0)
 S MSGSTART="BCMA Order Problem Notification Started  on "_Y_"."
"RTN","PSBPRM",35,0)
 S MSGFINAL="BCMA Order Problem Notification Finished  on "_Y_"."
"RTN","PSBPRM",36,0)
 I FLAGMSG="Y" S MSGPVAL=MSGSTART
"RTN","PSBPRM",37,0)
 I FLAGMSG="N" S MSGPVAL=MSGFINAL
"RTN","PSBPRM",38,0)
 S XMDUZ="BARCODE, MED ADMIN Pre Patch for PSB*2*6",XMSUB=MSGPVAL
"RTN","PSBPRM",39,0)
 S XMTEXT="PSG(",XMY(DUZ)=""
"RTN","PSBPRM",40,0)
 S PSG(1)=""
"RTN","PSBPRM",41,0)
 S PSG(2)="***"_MSGPVAL_"***"
"RTN","PSBPRM",42,0)
 S PSG(3)="                                  Thank You!"
"RTN","PSBPRM",43,0)
 D ^XMD
"RTN","PSBPRM",44,0)
 K FLAGMSG,MSGSTART,MSGFINAL,MSGPVAL
"RTN","PSBPRM",45,0)
 Q
"RTN","PSBPRM",46,0)
 ;
"RTN","PSBPRM",47,0)
 ;
"RTN","PSBPRSIX")
0^1^B75461735
"RTN","PSBPRSIX",1,0)
PSBPRSIX ;BIRMINGHAM/BSR-BCMA PRE PATCH 6 ;May 2002
"RTN","PSBPRSIX",2,0)
 ;;2.0;BAR CODE MED ADMIN;**18**;May 2002
"RTN","PSBPRSIX",3,0)
 ;
"RTN","PSBPRSIX",4,0)
 ; ^DPT/10035
"RTN","PSBPRSIX",5,0)
 ; WARD^NURSUT5/3052
"RTN","PSBPRSIX",6,0)
 ; File 211.4/1409
"RTN","PSBPRSIX",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBPRSIX",8,0)
 ; ^ORD(101.24/3429
"RTN","PSBPRSIX",9,0)
 ; ^XUSEC/10076
"RTN","PSBPRSIX",10,0)
 ;
"RTN","PSBPRSIX",11,0)
ENV ;Checks for DUZ and sets up process to be queued.
"RTN","PSBPRSIX",12,0)
 I $G(DUZ)="" W !,"Your Duz is not Defined. It must be defined to run this routine" Q
"RTN","PSBPRSIX",13,0)
 K ZTSAVE,ZTSK S ZTRTN="DATE^PSBPRSIX",ZTDESC="BCMA Pre PATCH for PSB*2*6",ZTIO="" D ^%ZTLOAD
"RTN","PSBPRSIX",14,0)
 W !!,"The check for Order Problems ",$S($D(ZTSK):"",1:" NOT"),"queued",!
"RTN","PSBPRSIX",15,0)
 I $D(ZTSK) D
"RTN","PSBPRSIX",16,0)
 .W !!,"You will receive a start email and a finished email from MAILMAN when Task # "_ZTSK_" HAS COMPLETED.",!
"RTN","PSBPRSIX",17,0)
 Q
"RTN","PSBPRSIX",18,0)
 ;
"RTN","PSBPRSIX",19,0)
DATE ;Sets date parameter to be passed to tag RPC.
"RTN","PSBPRSIX",20,0)
 ;Set start date from 0 days to 7 days in past.
"RTN","PSBPRSIX",21,0)
 S FLAGMSG="Y"  D MSGEND^PSBPRM ;Sends first email
"RTN","PSBPRSIX",22,0)
 F DAY=0:1:7 D
"RTN","PSBPRSIX",23,0)
 .S DTEA=$HOROLOG+DAY
"RTN","PSBPRSIX",24,0)
 .S %H=DTEA  D YX^%DTC
"RTN","PSBPRSIX",25,0)
 .S STRT=X_".0001",FNSH=X_".2400"
"RTN","PSBPRSIX",26,0)
 .D WARD
"RTN","PSBPRSIX",27,0)
 S FLAGMSG="N"  D MSGEND^PSBPRM ;Sends Final email
"RTN","PSBPRSIX",28,0)
 Q
"RTN","PSBPRSIX",29,0)
 ;
"RTN","PSBPRSIX",30,0)
WARD ;Gets active ward and pass WARD #.
"RTN","PSBPRSIX",31,0)
 S PSBIEN=0 F  S PSBIEN=$O(^NURSF(211.4,PSBIEN)) Q:PSBIEN'?.N  D
"RTN","PSBPRSIX",32,0)
 .I $$GET1^DIQ(211.4,PSBIEN_",",1.5)'["INACTIVE" D ACTWARD  Q
"RTN","PSBPRSIX",33,0)
 Q
"RTN","PSBPRSIX",34,0)
 ;
"RTN","PSBPRSIX",35,0)
ACTWARD ;Pass Active WARD # to tag RPC
"RTN","PSBPRSIX",36,0)
 S RESULTS="",PSBTYPE="DL",PSBSTRT=STRT
"RTN","PSBPRSIX",37,0)
 S PSBSTOP=FNSH,PSBINCL="1^0^0^0",PSBDFN=""
"RTN","PSBPRSIX",38,0)
 S PSBDEV="",PSBSORT="W",PSBOI="",PSBWLOC=PSBIEN,PSBWSORT="P"
"RTN","PSBPRSIX",39,0)
 S PSBFUTR="0^1^1^0"
"RTN","PSBPRSIX",40,0)
 ;
"RTN","PSBPRSIX",41,0)
 ;Calls PSBO Routine internally and passes RPC values
"RTN","PSBPRSIX",42,0)
 D RPC
"RTN","PSBPRSIX",43,0)
 Q
"RTN","PSBPRSIX",44,0)
 ;************
"RTN","PSBPRSIX",45,0)
 ;PSBO Routine                     
"RTN","PSBPRSIX",46,0)
 ;************
"RTN","PSBPRSIX",47,0)
RPC ;
"RTN","PSBPRSIX",48,0)
 ; Description:
"RTN","PSBPRSIX",49,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBPRSIX",50,0)
 ; CHUI report options to display on the client.
"RTN","PSBPRSIX",51,0)
 ;
"RTN","PSBPRSIX",52,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBPRSIX",53,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBPRSIX",54,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBPRSIX",55,0)
 S DFN=PSBDFN
"RTN","PSBPRSIX",56,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBPRSIX",57,0)
 I +PSBRPT(0)<1 D  Q
"RTN","PSBPRSIX",58,0)
 .S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2)
"RTN","PSBPRSIX",59,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBPRSIX",60,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBPRSIX",61,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBPRSIX",62,0)
 D:$G(PSBDEV)]""
"RTN","PSBPRSIX",63,0)
 .D NOW^%DTC
"RTN","PSBPRSIX",64,0)
 .D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",65,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",%,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",66,0)
 D:$G(PSBOI)]""
"RTN","PSBPRSIX",67,0)
 .D VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",68,0)
 D VAL^DIE(53.69,PSBIENS,.11,"F","P","PSBRET","PSBFDA")
"RTN","PSBPRSIX",69,0)
 D:$G(PSBSORT)]""
"RTN","PSBPRSIX",70,0)
 .D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",71,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",72,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBPRSIX",73,0)
 D:$G(PSBWSORT)]""
"RTN","PSBPRSIX",74,0)
 .D VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",75,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",76,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",77,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBPRSIX",78,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",79,0)
 D:$G(PSBINCL)]""
"RTN","PSBPRSIX",80,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",81,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",82,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",83,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",84,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",85,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",86,0)
 D:$G(PSBFUTR)]""
"RTN","PSBPRSIX",87,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",88,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",89,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",90,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBPRSIX",91,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBPRSIX",92,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBPRSIX",93,0)
 D HFSOPEN^PSBUTL("RPC") I POP D  Q
"RTN","PSBPRSIX",94,0)
 .S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$GET^XPAR("DIV","PSB HFS SCRATCH")
"RTN","PSBPRSIX",95,0)
 .S ^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEDGES."
"RTN","PSBPRSIX",96,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBPRSIX",97,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBPRSIX",98,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBPRSIX",99,0)
 D:$G(PSBDEV)]""
"RTN","PSBPRSIX",100,0)
 .D PRINT^PSBO1
"RTN","PSBPRSIX",101,0)
 Q
"RTN","PSBPRSIX",102,0)
 ;
"RTN","PSBPRSIX",103,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBPRSIX",104,0)
 N PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE
"RTN","PSBPRSIX",105,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBPRSIX",106,0)
 I +PSBRPT(0)<1 D  Q
"RTN","PSBPRSIX",107,0)
 .W !,"Error: ",$P(PSBRPT(0),U,2)
"RTN","PSBPRSIX",108,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSBPRSIX",109,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBPRSIX",110,0)
 W @IOF
"RTN","PSBPRSIX",111,0)
 D:'PSBSAVE
"RTN","PSBPRSIX",112,0)
 .W !,"Cancelling Request..."
"RTN","PSBPRSIX",113,0)
 .S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBPRSIX",114,0)
 D:PSBSAVE
"RTN","PSBPRSIX",115,0)
 .; Allow "'BROWSER" Device
"RTN","PSBPRSIX",116,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBPRSIX",117,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBPRSIX",118,0)
 ..D ^%ZIS
"RTN","PSBPRSIX",119,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBPRSIX",120,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBPRSIX",121,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) D  Q
"RTN","PSBPRSIX",122,0)
 ..I PSBTYPE="BL" D CHECK
"RTN","PSBPRSIX",123,0)
 ..Q:($G(PSBANS)="NO")!($G(PSBANS)="N")
"RTN","PSBPRSIX",124,0)
 ..S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBPRSIX",125,0)
 ..D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP
"RTN","PSBPRSIX",126,0)
 .W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBPRSIX",127,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBPRSIX",128,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBPRSIX",129,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBPRSIX",130,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBPRSIX",131,0)
 .D ^%ZTLOAD
"RTN","PSBPRSIX",132,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBPRSIX",133,0)
 K ^TMP("PSBO",$J)
"RTN","PSBPRSIX",134,0)
 Q
"RTN","PSBPRSIX",135,0)
 ;
"RTN","PSBPRSIX",136,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBPRSIX",137,0)
 N PSBWRD,PSBDFN
"RTN","PSBPRSIX",138,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBPRSIX",139,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBPRSIX",140,0)
 ;D:$$SETUP @("EN^TESB"_$P(PSBRPT(0),U,5))
"RTN","PSBPRSIX",141,0)
 D:$$SETUP @("EN^PSBNW"_$P(PSBRPT(0),U,5))
"RTN","PSBPRSIX",142,0)
 K ^TMP("PSBO",$J)
"RTN","PSBPRSIX",143,0)
 S ZTREQ="@"
"RTN","PSBPRSIX",144,0)
 Q
"RTN","PSBPRSIX",145,0)
 ;
"RTN","PSBPRSIX",146,0)
IOM() ; Returns good margin or not
"RTN","PSBPRSIX",147,0)
 Q:IOM'<132 1
"RTN","PSBPRSIX",148,0)
 W !,"**************************************************************"
"RTN","PSBPRSIX",149,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBPRSIX",150,0)
 W !,"**************************************************************"
"RTN","PSBPRSIX",151,0)
 W !
"RTN","PSBPRSIX",152,0)
 Q 0
"RTN","PSBPRSIX",153,0)
 ;
"RTN","PSBPRSIX",154,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBPRSIX",155,0)
 N PSB,PSBFLD,PSBMSG,PSBSTRT,PSBSTOP,PSBST,PSBDAYS
"RTN","PSBPRSIX",156,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  D
"RTN","PSBPRSIX",157,0)
 .S PSBFLD=$P(PSBFLDS,";",PSB)
"RTN","PSBPRSIX",158,0)
 .S PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBPRSIX",159,0)
 D:$D(PSBFLD(.11))
"RTN","PSBPRSIX",160,0)
 .K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15)
"RTN","PSBPRSIX",161,0)
 .K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBPRSIX",162,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBPRSIX",163,0)
 .D:'$D(PSBMSG)
"RTN","PSBPRSIX",164,0)
 ..S PSBMSG(0)="UNABLE TO FILE REQUEST"
"RTN","PSBPRSIX",165,0)
 ..S PSBMSG(1)=" "
"RTN","PSBPRSIX",166,0)
 ..S PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED"
"RTN","PSBPRSIX",167,0)
 ..S PSBMSG(3)=" "
"RTN","PSBPRSIX",168,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBPRSIX",169,0)
 .S Z="  Missing Field:"_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBPRSIX",170,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBPRSIX",171,0)
 ; Check Times
"RTN","PSBPRSIX",172,0)
 D:$G(PSBFLD(.16))
"RTN","PSBPRSIX",173,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBPRSIX",174,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBPRSIX",175,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMAMAH","B")_",",.42)  ;check maxdays
"RTN","PSBPRSIX",176,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBPRSIX",177,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBPRSIX",178,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBPRSIX",179,0)
 .D:PSBSTOP<PSBSTRT
"RTN","PSBPRSIX",180,0)
 ..S Y=$O(PSBMSG(""),-1)+1
"RTN","PSBPRSIX",181,0)
 ..S PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBPRSIX",182,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBPRSIX",183,0)
 ..S X=PSBSTOP\1 D H^%DTC I %H>PSBST D
"RTN","PSBPRSIX",184,0)
 ...S Y=$O(PSBMSG(""),-1)+1
"RTN","PSBPRSIX",185,0)
 ...S PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBPRSIX",186,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBPRSIX",187,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBPRSIX",188,0)
 S DDSERROR=1
"RTN","PSBPRSIX",189,0)
 Q
"RTN","PSBPRSIX",190,0)
 ;
"RTN","PSBPRSIX",191,0)
SETUP() ; Setup parameters for the report in PSBRPT
"RTN","PSBPRSIX",192,0)
 N PSBWRDL,PSBINDX,PSBWRDA
"RTN","PSBPRSIX",193,0)
 K ^TMP("PSBO",$J)
"RTN","PSBPRSIX",194,0)
 F X=0,.1,.2,.3,.4 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBPRSIX",195,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBPRSIX",196,0)
 .S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN
"RTN","PSBPRSIX",197,0)
 .S ^TMP("PSBO",$J,"B",$P(^DPT(PSBDFN,0),U),PSBDFN)=""
"RTN","PSBPRSIX",198,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBPRSIX",199,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD  D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBPRSIX",200,0)
 .S XT="" F  S XT=$O(PSBWRDA(PSBWRD,2,XT)) Q:XT=""  S PSBWRDL=$P(PSBWRDA(PSBWRD,2,XT,.01),U,2) D
"RTN","PSBPRSIX",201,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:'PSBDFN  D
"RTN","PSBPRSIX",202,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBPRSIX",203,0)
 ...D:$P(PSBRPT(.1),U,5)="P"
"RTN","PSBPRSIX",204,0)
 ....S PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBPRSIX",205,0)
 ...D:$P(PSBRPT(.1),U,5)="B"
"RTN","PSBPRSIX",206,0)
 ....S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U)
"RTN","PSBPRSIX",207,0)
 ....S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBPRSIX",208,0)
 ...D:$P(PSBRPT(.1),U,5)=""
"RTN","PSBPRSIX",209,0)
 ....S PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBPRSIX",210,0)
 ...S:$G(PSBINDX)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBPRSIX",211,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBPRSIX",212,0)
 Q 1
"RTN","PSBPRSIX",213,0)
 ;
"RTN","PSBPRSIX",214,0)
WRAP(X,Y,Z)    ; Quick text wrap
"RTN","PSBPRSIX",215,0)
 ;
"RTN","PSBPRSIX",216,0)
 ; Input Parameters Description:
"RTN","PSBPRSIX",217,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBPRSIX",218,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBPRSIX",219,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBPRSIX",220,0)
 ;
"RTN","PSBPRSIX",221,0)
 N PSB
"RTN","PSBPRSIX",222,0)
 F  Q:'$L(Z)  D
"RTN","PSBPRSIX",223,0)
 .W:$X>X !
"RTN","PSBPRSIX",224,0)
 .W:$X<X ?X
"RTN","PSBPRSIX",225,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBPRSIX",226,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBPRSIX",227,0)
 .S:PSB<1 PSB=Y
"RTN","PSBPRSIX",228,0)
 .W $E(Z,1,PSB)
"RTN","PSBPRSIX",229,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBPRSIX",230,0)
 Q ""
"RTN","PSBPRSIX",231,0)
 ;
"RTN","PSBPRSIX",232,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBPRSIX",233,0)
 K ^TMP("PSJ",$J)
"RTN","PSBPRSIX",234,0)
 N PSBDFN,PSBBAR,PSBDRUG
"RTN","PSBPRSIX",235,0)
 S PSBANS1=0,PSBFLAG=1
"RTN","PSBPRSIX",236,0)
 S PSBBAR=$P($P($G(^PSB(53.69,DA_",",.3)),U,1),"~",2)
"RTN","PSBPRSIX",237,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBPRSIX",238,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I")
"RTN","PSBPRSIX",239,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBPRSIX",240,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBPRSIX",241,0)
 .K Y,PSBORD
"RTN","PSBPRSIX",242,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBPRSIX",243,0)
 .F Y=0:0 S Y=$O(PSBORD(700,Y)) Q:'Y  D
"RTN","PSBPRSIX",244,0)
 ..I $P(PSBORD(700,Y,0),U,1)=PSBBAR,$P(PSBORD(1),U,7)="A" S PSBFLAG=0
"RTN","PSBPRSIX",245,0)
 I PSBFLAG D
"RTN","PSBPRSIX",246,0)
 .F I=0:0 D  Q:PSBANS1
"RTN","PSBPRSIX",247,0)
 ..W !,"Patient not currently on medication: ",PSBDRUG
"RTN","PSBPRSIX",248,0)
 ..R !,"Do you want to continue? ",PSBANS:10
"RTN","PSBPRSIX",249,0)
 ..I PSBANS="YES"!(PSBANS="Y")!(PSBANS="NO")!(PSBANS="N") S PSBANS1=1
"RTN","PSBPRSIX",250,0)
 Q
"RTN","PSBPRSIX",251,0)
 ;
"RTN","PSBPRSIX",252,0)
 ;
"RTN","PSBPRSIX",253,0)
 ;
"VER")
8.0^22.0
**END**
**END**
