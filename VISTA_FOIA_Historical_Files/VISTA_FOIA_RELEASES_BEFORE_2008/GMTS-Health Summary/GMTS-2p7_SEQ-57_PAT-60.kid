Released GMTS*2.7*60 SEQ #57
Extracted from mail message
**KIDS**:GMTS*2.7*60^

**INSTALL NAME**
GMTS*2.7*60
"BLD",3911,0)
GMTS*2.7*60^HEALTH SUMMARY^0^3021211^y
"BLD",3911,1,0)
^^2^2^3021022^^
"BLD",3911,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",3911,1,2,0)
patch GMTS*2.7*60.
"BLD",3911,4,0)
^9.64PA^^
"BLD",3911,"INID")
^y
"BLD",3911,"INIT")
POST^GMTSP60
"BLD",3911,"KRN",0)
^9.67PA^8989.52^19
"BLD",3911,"KRN",.4,0)
.4
"BLD",3911,"KRN",.401,0)
.401
"BLD",3911,"KRN",.402,0)
.402
"BLD",3911,"KRN",.403,0)
.403
"BLD",3911,"KRN",.5,0)
.5
"BLD",3911,"KRN",.84,0)
.84
"BLD",3911,"KRN",3.6,0)
3.6
"BLD",3911,"KRN",3.8,0)
3.8
"BLD",3911,"KRN",9.2,0)
9.2
"BLD",3911,"KRN",9.8,0)
9.8
"BLD",3911,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",3911,"KRN",9.8,"NM",1,0)
GMTSDEM^^0^B36734197
"BLD",3911,"KRN",9.8,"NM",2,0)
GMTSDEM2^^0^B60575939
"BLD",3911,"KRN",9.8,"NM",3,0)
GMTSDEMB^^0^B13170172
"BLD",3911,"KRN",9.8,"NM",4,0)
GMTSDGP^^0^B10461091
"BLD",3911,"KRN",9.8,"NM","B","GMTSDEM",1)

"BLD",3911,"KRN",9.8,"NM","B","GMTSDEM2",2)

"BLD",3911,"KRN",9.8,"NM","B","GMTSDEMB",3)

"BLD",3911,"KRN",9.8,"NM","B","GMTSDGP",4)

"BLD",3911,"KRN",19,0)
19
"BLD",3911,"KRN",19.1,0)
19.1
"BLD",3911,"KRN",101,0)
101
"BLD",3911,"KRN",409.61,0)
409.61
"BLD",3911,"KRN",771,0)
771
"BLD",3911,"KRN",870,0)
870
"BLD",3911,"KRN",8989.51,0)
8989.51
"BLD",3911,"KRN",8989.52,0)
8989.52
"BLD",3911,"KRN",8994,0)
8994
"BLD",3911,"KRN","B",.4,.4)

"BLD",3911,"KRN","B",.401,.401)

"BLD",3911,"KRN","B",.402,.402)

"BLD",3911,"KRN","B",.403,.403)

"BLD",3911,"KRN","B",.5,.5)

"BLD",3911,"KRN","B",.84,.84)

"BLD",3911,"KRN","B",3.6,3.6)

"BLD",3911,"KRN","B",3.8,3.8)

"BLD",3911,"KRN","B",9.2,9.2)

"BLD",3911,"KRN","B",9.8,9.8)

"BLD",3911,"KRN","B",19,19)

"BLD",3911,"KRN","B",19.1,19.1)

"BLD",3911,"KRN","B",101,101)

"BLD",3911,"KRN","B",409.61,409.61)

"BLD",3911,"KRN","B",771,771)

"BLD",3911,"KRN","B",870,870)

"BLD",3911,"KRN","B",8989.51,8989.51)

"BLD",3911,"KRN","B",8989.52,8989.52)

"BLD",3911,"KRN","B",8994,8994)

"BLD",3911,"QUES",0)
^9.62^^
"BLD",3911,"REQB",0)
^9.611^1^1
"BLD",3911,"REQB",1,0)
GMTS*2.7*58^2
"BLD",3911,"REQB","B","GMTS*2.7*58",1)

"INIT")
POST^GMTSP60
"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
60^3021211^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3021211
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*60.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMTSDEM")
0^1^B36734197
"RTN","GMTSDEM",1,0)
GMTSDEM ; SLC/DLT,KER - Demographics ; 12/11/2002
"RTN","GMTSDEM",2,0)
 ;;2.7;Health Summary;**28,49,55,56,60**;Oct 20, 1995
"RTN","GMTSDEM",3,0)
 ;                 
"RTN","GMTSDEM",4,0)
 ; External References
"RTN","GMTSDEM",5,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM",6,0)
 ;   DBIA 10061  OPD^VADPT
"RTN","GMTSDEM",7,0)
 ;   DBIA 10061  SVC^VADPT
"RTN","GMTSDEM",8,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEM",9,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEM",10,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEM",11,0)
 ;   DBIA  2967  ^DIC(31,
"RTN","GMTSDEM",12,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEM",13,0)
 ;                     
"RTN","GMTSDEM",14,0)
DEMOG ; Demographic (VADPT)
"RTN","GMTSDEM",15,0)
 N I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z
"RTN","GMTSDEM",16,0)
 D ADR,PER,SVC,BOS,COMB,ELIG,SC,SCDD,MT
"RTN","GMTSDEM",17,0)
 D NOK^GMTSDEM2,CD^GMTSDEMP(+($G(DFN)))
"RTN","GMTSDEM",18,0)
 D INS^GMTSDEM2,TF^GMTSDEMB(+($G(DFN)))
"RTN","GMTSDEM",19,0)
 D SRC^GMTSDEMB,END
"RTN","GMTSDEM",20,0)
 Q
"RTN","GMTSDEM",21,0)
DEMO(DFN) ;
"RTN","GMTSDEM",22,0)
 K ^TMP("GMTSDEMO",$J,+($G(DFN)))
"RTN","GMTSDEM",23,0)
 N GMTSDEMX,I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z
"RTN","GMTSDEM",24,0)
 S GMTSDEMX="" D DEMOG D:$D(GMTSTEST) ST
"RTN","GMTSDEM",25,0)
 Q
"RTN","GMTSDEM",26,0)
ADR ; Patient Address
"RTN","GMTSDEM",27,0)
 Q:$D(GMTSQIT)  D:$D(GMTSDEMX) NAM Q:$D(GMTSQIT)  N %,%H,VA,VAPA,VAERR D ADD^VADPT
"RTN","GMTSDEM",28,0)
 D WRT("Address",$S($L(VAPA(1)):VAPA(1),1:"Not available"),"Phone",VAPA(8),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM",29,0)
 I VAPA(2)'="" D WRT(($J("",21)_VAPA(2)),,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM",30,0)
 I VAPA(3)'="" D WRT(($J("",21)_VAPA(3)),,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM",31,0)
 I VAPA(4)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",32,0)
 . N STR S STR=VAPA(4)_", " S:VAPA(5)'="" STR=STR_$P($G(VAPA(5)),"^",2)_"  "
"RTN","GMTSDEM",33,0)
 . S:VAPA(6)'="" STR=STR_VAPA(6) D WRT("",STR,"County",$P(VAPA(7),"^",2),1)
"RTN","GMTSDEM",34,0)
 D WRT(" ",,,,0)
"RTN","GMTSDEM",35,0)
 Q
"RTN","GMTSDEM",36,0)
NAM ; Name/SSN/DOB/Sex
"RTN","GMTSDEM",37,0)
 N VAPTYP,VAHOW,VAROUT,VADM D DEM^VADPT
"RTN","GMTSDEM",38,0)
 D WRT("Name",$G(VADM(1)),"SSN",$E($P($G(VADM(2)),"^",2),1,11),1)
"RTN","GMTSDEM",39,0)
 D WRT("Date of Birth",$$EDT^GMTSU($P($G(VADM(3)),"^",1)),,,1)
"RTN","GMTSDEM",40,0)
 Q
"RTN","GMTSDEM",41,0)
PER ; Personal
"RTN","GMTSDEM",42,0)
 Q:$D(GMTSQIT)  N %,%H,VA,VADM,VAERR,VAPD D DEM^VADPT,OPD^VADPT
"RTN","GMTSDEM",43,0)
 I VADM(10)'=""!(VADM(4)'="") D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",44,0)
 . D WRT("Marital Status",$P($G(VADM(10)),"^",2),"Age",$P($G(VADM(4)),"^",1),1)
"RTN","GMTSDEM",45,0)
 I VADM(9)'=""!(VADM(5)'="") D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",46,0)
 . D WRT("Religion",$P($G(VADM(9)),"^",2),"Sex",$P($G(VADM(5)),"^",2),1)
"RTN","GMTSDEM",47,0)
 D RACE^GMTSDEM2 I VAPD(6)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",48,0)
 . D WRT("Occupation",$P($G(VAPD(6)),"^",1),,,1)
"RTN","GMTSDEM",49,0)
 Q
"RTN","GMTSDEM",50,0)
SVC ; Service
"RTN","GMTSDEM",51,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",52,0)
 I $P(VAEL(2),"^",1) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",53,0)
 . D WRT("Period of Service",$P($G(VAEL(2)),"^",2),,,1)
"RTN","GMTSDEM",54,0)
 Q
"RTN","GMTSDEM",55,0)
BOS ; Branch of Service
"RTN","GMTSDEM",56,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR,VASV,GMTSI,FROM,TO
"RTN","GMTSDEM",57,0)
 D SVC^VADPT F GMTSI=6,7,8 D
"RTN","GMTSDEM",58,0)
 . Q:'$D(VASV(GMTSI))  Q:+(VASV(GMTSI))=0
"RTN","GMTSDEM",59,0)
 . S FROM=$$EDT^GMTSU($P(VASV(GMTSI,4),U,1))
"RTN","GMTSDEM",60,0)
 . S TO=$$EDT^GMTSU($P(VASV(GMTSI,5),U,1))
"RTN","GMTSDEM",61,0)
 . S:$L(FROM)&('$L(TO)) TO="UNKNOWN"
"RTN","GMTSDEM",62,0)
 . D:GMTSI=6 WRT("Branch of Service",($P(VASV(GMTSI,1),U,2)_" "_FROM_" TO "_TO),,,1)
"RTN","GMTSDEM",63,0)
 . D:GMTSI'=6 WRT("",($P(VASV(GMTSI,1),U,2)_" "_FROM_" TO "_TO),,,1)
"RTN","GMTSDEM",64,0)
 Q
"RTN","GMTSDEM",65,0)
COMB ; Service Connected Disabilities
"RTN","GMTSDEM",66,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR,VASV D ELIG^VADPT,SVC^VADPT
"RTN","GMTSDEM",67,0)
 I $P(VAEL(2),U) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",68,0)
 . D WRT("Combat",$S(VASV(5):"YES",1:"NO"),"POW",$S(VASV(4):"YES",1:"NO"),1)
"RTN","GMTSDEM",69,0)
 Q
"RTN","GMTSDEM",70,0)
ELIG ; Eligibility
"RTN","GMTSDEM",71,0)
 Q:$D(GMTSQIT)  N Z,I,%,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",72,0)
 I $P(VAEL(1),"^",1) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",73,0)
 . D WRT("Eligibility",$P(VAEL(1),"^",2),$S(VAEL(8)'="":"Status",1:""),$P(VAEL(8),"^",2),1)
"RTN","GMTSDEM",74,0)
 I $O(VAEL(1,0)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",75,0)
 . S I=0 F Z=0:0 D  Q:$D(GMTSQIT)  Q:I=""
"RTN","GMTSDEM",76,0)
 . . Q:$D(GMTSQIT)  S I=$O(VAEL(1,I)) Q:I=""
"RTN","GMTSDEM",77,0)
 . . D WRT("",$P(VAEL(1,I),"^",2),,,1)
"RTN","GMTSDEM",78,0)
 Q
"RTN","GMTSDEM",79,0)
SC ; Service Connected Percent
"RTN","GMTSDEM",80,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",81,0)
 D:VAEL(3) WRT("S/C %",$P(VAEL(3),"^",2),,,1)
"RTN","GMTSDEM",82,0)
 Q
"RTN","GMTSDEM",83,0)
SCDD ; Service Connected Disabilities/Diagnosis
"RTN","GMTSDEM",84,0)
 Q:$D(GMTSQIT)  N SCD,SCDP,SCDS,IX,GMTSC S (IX,GMTSC)=0
"RTN","GMTSDEM",85,0)
 F  S IX=$O(^DPT(DFN,.372,IX)) Q:$D(GMTSQIT)  Q:+IX=0  D SCDP  Q:$D(GMTSQIT)
"RTN","GMTSDEM",86,0)
 Q
"RTN","GMTSDEM",87,0)
SCDP ; Service Connected Diagnosis
"RTN","GMTSDEM",88,0)
 Q:$D(GMTSQIT)  N SCD,SCDS,SCDP S SCD=^DPT(DFN,.372,IX,0)
"RTN","GMTSDEM",89,0)
 S SCDS=$S($P(SCD,"^",1):$P(^DIC(31,$P(SCD,"^",1),0),"^",1),1:"")
"RTN","GMTSDEM",90,0)
 S SCDP=$P(SCD,"^",2)_"% "_$S($P(SCD,"^",3):"SC",1:"")
"RTN","GMTSDEM",91,0)
 S GMTSC=+($G(GMTSC))+1
"RTN","GMTSDEM",92,0)
 I +($G(GMTSC))'>1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",93,0)
 . S STR="   S/C Disabilities: "_SCDS,STR=STR_$J("",(61-$L(STR)))_SCDP
"RTN","GMTSDEM",94,0)
 . D WRT(STR,,,,0)
"RTN","GMTSDEM",95,0)
 I +($G(GMTSC))>1 D
"RTN","GMTSDEM",96,0)
 . S STR=$J("",21)_SCDS,STR=STR_$J("",(61-$L(STR)))_SCDP
"RTN","GMTSDEM",97,0)
 . D WRT(STR,,,,0)
"RTN","GMTSDEM",98,0)
 Q
"RTN","GMTSDEM",99,0)
MT ; Means Test
"RTN","GMTSDEM",100,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",101,0)
 D:VAEL(9)'="" WRT("Means Test",$P(VAEL(9),"^",2),,,1)
"RTN","GMTSDEM",102,0)
 Q
"RTN","GMTSDEM",103,0)
NOK ; Next of Kin
"RTN","GMTSDEM",104,0)
 Q:$D(GMTSQIT)  N %,%H,VAOA S VAOA("A")=1 D OAD^VADPT
"RTN","GMTSDEM",105,0)
 Q:VAOA(9)=""  I VAOA(9)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",106,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",107,0)
 . W ?16,"NOK: ",VAOA(9)
"RTN","GMTSDEM",108,0)
 . W:VAOA(10)'="" ?51,"Relation: ",VAOA(10) W !
"RTN","GMTSDEM",109,0)
 I VAOA(1)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",110,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",111,0)
 . W:VAOA(1)]"" ?21,VAOA(1)
"RTN","GMTSDEM",112,0)
 . W:VAOA(8)'="" ?54,"Phone: ",VAOA(8) W !
"RTN","GMTSDEM",113,0)
 I VAOA(2)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",114,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(2),!
"RTN","GMTSDEM",115,0)
 I VAOA(3)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",116,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(3),!
"RTN","GMTSDEM",117,0)
 I VAOA(4)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",118,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",119,0)
 . W ?21,VAOA(4) W:VAOA(5) ", ",$P(VAOA(5),U,2)
"RTN","GMTSDEM",120,0)
 . W:VAOA(6) "  ",VAOA(6) W !
"RTN","GMTSDEM",121,0)
 Q
"RTN","GMTSDEM",122,0)
IEN ; Ineligible for Care Data
"RTN","GMTSDEM",123,0)
 Q:$D(GMTSQIT)  N STR,REM,WRD,%,%H,VAEL,VAERR,GMTSDT D ELIG^VADPT
"RTN","GMTSDEM",124,0)
 I +($P(VAEL(5,1),U,1))>0 D
"RTN","GMTSDEM",125,0)
 . S GMTSDT=$$EDT^GMTSU($P(VAEL(5,1),U,1))
"RTN","GMTSDEM",126,0)
 . Q:$D(GMTSQIT)  D WRT("Ineligible date",GMTSDT,,,1)
"RTN","GMTSDEM",127,0)
 . Q:$D(GMTSQIT)  S STR=$P(VAEL(5,2),U,2)_"  "_VAEL(5,3)_", "_$P(VAEL(5,4),U,2)
"RTN","GMTSDEM",128,0)
 . D WRT("Inelig. TWX source",STR,,,1)
"RTN","GMTSDEM",129,0)
 . Q:$D(GMTSQIT)  S STR=$G(VAEL(5,5))
"RTN","GMTSDEM",130,0)
 . F WRD=1:1 Q:$L(STR)'>58  D
"RTN","GMTSDEM",131,0)
 . . S REM=$P(STR," ",($L(STR," ")-WRD),$L(STR," "))
"RTN","GMTSDEM",132,0)
 . . S STR=$P(STR," ",1,($L(STR," ")-(WRD+1)))
"RTN","GMTSDEM",133,0)
 . D:$L(STR) WRT(($J("",21)_STR),,,,0)
"RTN","GMTSDEM",134,0)
 . D:$L(REM) WRT(($J("",21)_REM),,,,0)
"RTN","GMTSDEM",135,0)
 . D:$L(VAEL(5,6)) WRT("Reason",$E(VAEL(5,6),1,58),,,1)
"RTN","GMTSDEM",136,0)
 Q
"RTN","GMTSDEM",137,0)
 ;                      
"RTN","GMTSDEM",138,0)
WRT(CH1,CD1,CH2,CD2,FMT) ; Write/Save Demographic Line
"RTN","GMTSDEM",139,0)
 ;          
"RTN","GMTSDEM",140,0)
 ;   Input
"RTN","GMTSDEM",141,0)
 ;     CH1 - Column 1 Header or Preformated Line
"RTN","GMTSDEM",142,0)
 ;     CD1 - Column 1 Data
"RTN","GMTSDEM",143,0)
 ;     CH2 - Column 2 Header
"RTN","GMTSDEM",144,0)
 ;     CD2 - Column 2 Data
"RTN","GMTSDEM",145,0)
 ;     FMT - Format in Columns  1=Yes 0=No
"RTN","GMTSDEM",146,0)
 ;          
"RTN","GMTSDEM",147,0)
 ;   If the variable GMTSDEMX exist, then the data will 
"RTN","GMTSDEM",148,0)
 ;   be saved in a global array instead of written to the
"RTN","GMTSDEM",149,0)
 ;   screen.  Global array:
"RTN","GMTSDEM",150,0)
 ;          
"RTN","GMTSDEM",151,0)
 ;     ^TMP("GMTSDEMO",$J,DFN,#)=<demographic text>
"RTN","GMTSDEM",152,0)
 Q:$D(GMTSQIT)  N STR,BL,COL1,COL2,LN
"RTN","GMTSDEM",153,0)
 S LN=+($O(^TMP("GMTSDEMO",$J,+($G(DFN))," "),-1))+1,CH1=$G(CH1),CD1=$G(CD1),CH2=$G(CH2),CD2=$G(CD2),FMT=$G(FMT)
"RTN","GMTSDEM",154,0)
 S:+FMT'>0 STR=CH1
"RTN","GMTSDEM",155,0)
 I +FMT>0 D
"RTN","GMTSDEM",156,0)
 . S BL=$J("",(19-$L(CH1))),CH1=BL_CH1_$S($L(CH1)>0:": ",1:"  ")
"RTN","GMTSDEM",157,0)
 . S BL=$J("",(((59-$L(CH1))-$L(CH2))-2))
"RTN","GMTSDEM",158,0)
 . S CD1=$E(CD1,1,$L(BL)),COL1=CH1_CD1
"RTN","GMTSDEM",159,0)
 . S BL=$J("",((59-$L(COL1))-$L(CH2)))
"RTN","GMTSDEM",160,0)
 . S CH2=BL_CH2_$S($L(CH2)>0:": ",1:"  "),COL2=CH2_$E(CD2,1,17)
"RTN","GMTSDEM",161,0)
 . S STR=COL1_COL2
"RTN","GMTSDEM",162,0)
 I '$D(GMTSDEMX) D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(STR),!
"RTN","GMTSDEM",163,0)
 S:$D(GMTSDEMX) ^TMP("GMTSDEMO",$J,+($G(DFN)),LN)=STR
"RTN","GMTSDEM",164,0)
 Q
"RTN","GMTSDEM",165,0)
 ;                        
"RTN","GMTSDEM",166,0)
ST ; Show ^TMP Global Array
"RTN","GMTSDEM",167,0)
 W !! N NN,NC S NN="^TMP(""GMTSDEMO"","_$J_","_+($G(DFN))_")",NC="^TMP(""GMTSDEMO"","_$J_","_+($G(DFN))_"," F  S NN=$Q(@NN) Q:NN=""!(NN'[NC)  W !,@NN
"RTN","GMTSDEM",168,0)
 Q
"RTN","GMTSDEM",169,0)
END ; Clean-up and quit
"RTN","GMTSDEM",170,0)
 K I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM
"RTN","GMTSDEM",171,0)
 K GMI,TO,IX,X,Z Q
"RTN","GMTSDEM2")
0^2^B60575939
"RTN","GMTSDEM2",1,0)
GMTSDEM2 ; SLC/DLT,KER - Demographics (cont) ; 12/11/2002
"RTN","GMTSDEM2",2,0)
 ;;2.7;Health Summary;**56,58,60**;Oct 20, 1995
"RTN","GMTSDEM2",3,0)
 ;                 
"RTN","GMTSDEM2",4,0)
 ; External References
"RTN","GMTSDEM2",5,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM2",6,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEM2",7,0)
 ;   DBIA   951  ^IBE(355.1
"RTN","GMTSDEM2",8,0)
 ;   DBIA   794  ^DIC(36
"RTN","GMTSDEM2",9,0)
 ;   DBIA  2056  $$GET1^DIQ (file #36, and #355.1)
"RTN","GMTSDEM2",10,0)
 ;   DBIA 10145  ALL^IBCNS1  
"RTN","GMTSDEM2",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSDEM2",12,0)
 ;                     
"RTN","GMTSDEM2",13,0)
NOKC ; Next of Kin Component
"RTN","GMTSDEM2",14,0)
 N GMTSNOK S GMTSNOK="" D NOK Q
"RTN","GMTSDEM2",15,0)
NOK ; Next of Kin
"RTN","GMTSDEM2",16,0)
 Q:$D(GMTSQIT)  N %,%H,STR,STR1,STR2,NOKTYPE,ADR,VAERR,VAOA K VAOA("A") D OAD^VADPT
"RTN","GMTSDEM2",17,0)
 I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",18,0)
 . ;   Primary Next of Kin
"RTN","GMTSDEM2",19,0)
 . S NOKTYPE="Primary" D DNOK
"RTN","GMTSDEM2",20,0)
 . S VAOA("A")=3 D OAD^VADPT
"RTN","GMTSDEM2",21,0)
 . I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",22,0)
 . . ;   Secondary Next of Kin
"RTN","GMTSDEM2",23,0)
 . . K GMTSNOK S NOKTYPE="Secondary" D DNOK
"RTN","GMTSDEM2",24,0)
 Q
"RTN","GMTSDEM2",25,0)
DNOK ;   Display Next of Kin
"RTN","GMTSDEM2",26,0)
 D:'$D(GMTSNOK) WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",27,0)
 S STR1=$$UP^XLFSTR(VAOA(9)),STR2=$S('$L(VAOA(10)):"<not given>",1:$$REL($$UP^XLFSTR(VAOA(10))))
"RTN","GMTSDEM2",28,0)
 D WRT^GMTSDEM(($G(NOKTYPE)_" NOK"),STR1,"Relation",STR2,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",29,0)
 S ADR=$G(VAOA(1)) K VAOA(1) I '$L(ADR) S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",30,0)
 S STR=$S('$L(ADR):"<street address not available>",1:$$UP^XLFSTR(ADR))
"RTN","GMTSDEM2",31,0)
 K:STR="<street address not available>" VAOA(1),VAOA(2),VAOA(3)
"RTN","GMTSDEM2",32,0)
 D WRT^GMTSDEM("",STR,"Phone",VAOA(8),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",33,0)
 S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",34,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",35,0)
 S ADR=$G(VAOA(3))
"RTN","GMTSDEM2",36,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",37,0)
 I VAOA(4)'="" D
"RTN","GMTSDEM2",38,0)
 . S STR=$$UP^XLFSTR(VAOA(4)) S:VAOA(5) STR=STR_", "_$$UP^XLFSTR($P(VAOA(5),U,2)) S:VAOA(6) STR=STR_"  "_$$UP^XLFSTR(VAOA(6))
"RTN","GMTSDEM2",39,0)
 . D WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",40,0)
 Q
"RTN","GMTSDEM2",41,0)
REL(X) ; Relation
"RTN","GMTSDEM2",42,0)
 S X=$$UP^XLFSTR($G(X)) Q:'$L(X)  S:X="W" X="SPOUSE" S:X="H" X="SPOUSE" S:X="B" X="BROTHER" S:X="S" X="SISTER" S:X="A" X="AUNT" S:X="U" X="UNCLE" S:X="C" X="COUSIN"
"RTN","GMTSDEM2",43,0)
 S:"WIFE"[X X="SPOUSE" S:"HUSBAND"[X X="SPOUSE" S:"NONE"[X X="NONE" S:"UNKNOWN"[X X="UNKNOWN"
"RTN","GMTSDEM2",44,0)
 S:"BROTHER"[X X="BROTHER" S:"BROTHER"'[X&("BROTHER-IN-LAW"[X) X="BROTHER-IN-LAW" S:"BROTHER"'[X&("BROTHER IN LAW"[X) X="BROTHER-IN-LAW" S:$E(X,1,3)="BRO"&("BROTHER"'[X) X="BROTHER-IN-LAW"
"RTN","GMTSDEM2",45,0)
 S:"SISTER"[X X="SISTER" S:"SISTER"'[X&("SISTER-IN-LAW"[X) X="SISTER-IN-LAW" S:"SISTER"'[X&("SISTER IN LAW"[X) X="SISTER-IN-LAW" S:$E(X,1,3)="SIS"&("SISTER"'[X) X="SISTER-IN-LAW"
"RTN","GMTSDEM2",46,0)
 S:"AUNT"[X X="AUNT" S:"UNCLE"[X X="UNCLE" S:"COUSIN"[X X="COUSIN" S:"FATHER"[X X="FATHER" S:"MOTHER"[X X="MOTHER"
"RTN","GMTSDEM2",47,0)
 S:"FATHER"'[X&("GRANDFATHER"[X) X="GRANDFATHER" S:"FATHER"'[X&("GRAND FATHER"[X) X="GRANDFATHER" S:"MOTHER"'[X&("GRANDMOTHER"[X) X="GRANDMOTHER" S:"MOTHER"'[X&("GRAND MOTHER"[X) X="GRANDMOTHER"
"RTN","GMTSDEM2",48,0)
 S:"SON"[X X="SON" S:"SON"'[X&("SON-IN-LAW"[X) X="SON-IN-LAW" S:"SON"'[X&("SON IN LAW"[X) X="SON-IN-LAW" S:$E(X,1,3)="SON"&("SON"'[X) X="SON-IN-LAW"
"RTN","GMTSDEM2",49,0)
 S:"DAUGHTER"[X X="DAUGHTER" S:"DAUGHTER"'[X&("DAUGHTER-IN-LAW"[X) X="DAUGHTER-IN-LAW" S:"DAUGHTER"'[X&("DAUGHTER IN LAW"[X) X="DAUGHTER-IN-LAW" S:$E(X,1,3)="DAU"&("DAUGHTER"'[X) X="DAUGHTER-IN-LAW"
"RTN","GMTSDEM2",50,0)
 S:"NIECE"'[X&("NIECE IN LAW"[X) X="NIECE" S:"NEPHEW"'[X&("NEPHEW IN LAW"[X) X="NEPHEW"
"RTN","GMTSDEM2",51,0)
 Q X
"RTN","GMTSDEM2",52,0)
 ;                
"RTN","GMTSDEM2",53,0)
INS ; Insuraance Info
"RTN","GMTSDEM2",54,0)
 N I,INSURE,GMTSX,IEN,VAL,CLAIM,COMPANY,TYPE,COB,SUBSCRIB,GROUP,HOLDER,EFFECT,EXPIRE
"RTN","GMTSDEM2",55,0)
 D ALL^IBCNS1(DFN,"INSURE") Q:$O(INSURE(0))=""
"RTN","GMTSDEM2",56,0)
 S I=0 F  S I=$O(INSURE(I)) Q:'I  D   Q:$D(GMTSQIT)
"RTN","GMTSDEM2",57,0)
 . S (COMPANY,TYPE,GROUP,HOLDER,EFFECT,EXPIRE)=""
"RTN","GMTSDEM2",58,0)
 . S GMTSX=INSURE(I,0),IEN=+GMTSX
"RTN","GMTSDEM2",59,0)
 . ;   Insurance Company
"RTN","GMTSDEM2",60,0)
 . S COMPANY=$$GET1^DIQ(36,(+IEN_","),.01) Q:'$L(COMPANY)
"RTN","GMTSDEM2",61,0)
 . S CLAIM=INSURE(I,355.3)
"RTN","GMTSDEM2",62,0)
 . ;   Policy Type
"RTN","GMTSDEM2",63,0)
 . S IEN=$P(CLAIM,"^",9)
"RTN","GMTSDEM2",64,0)
 . S TYPE="" I IEN]"" D
"RTN","GMTSDEM2",65,0)
 . . S TYPE=$$GET1^DIQ(355.1,(+IEN_","),.01) S TYPE=$$ABR(TYPE)
"RTN","GMTSDEM2",66,0)
 . ;   Group Number
"RTN","GMTSDEM2",67,0)
 . S GROUP=$P(CLAIM,"^",4)
"RTN","GMTSDEM2",68,0)
 . S GMTSX=INSURE(I,0),VAL=$P(GMTSX,"^",6)
"RTN","GMTSDEM2",69,0)
 . ;   Insurance Policy Holder
"RTN","GMTSDEM2",70,0)
 . S HOLDER=$S(VAL="v":"SELF",VAL="s":"SPOUSE",1:"OTHER")
"RTN","GMTSDEM2",71,0)
 . ;   Insurace Effect Date
"RTN","GMTSDEM2",72,0)
 . S EFFECT=$P(GMTSX,"^",8)
"RTN","GMTSDEM2",73,0)
 . ;   Insurance Expiration Date
"RTN","GMTSDEM2",74,0)
 . S EXPIRE=$P(GMTSX,"^",4)
"RTN","GMTSDEM2",75,0)
 . ;   Subscriber ID
"RTN","GMTSDEM2",76,0)
 . S SUBSCRIB=$P($G(INSURE(I,0)),"^",2)
"RTN","GMTSDEM2",77,0)
 . ;   Coordination of Benefits
"RTN","GMTSDEM2",78,0)
 . S COB=+($P($G(INSURE(I,0)),"^",20))
"RTN","GMTSDEM2",79,0)
 . S COB=$S(COB=1:"PRIMARY",COB=2:"SECONDARY",COB=3:"TERTIARY",1:"UNKNOWN")
"RTN","GMTSDEM2",80,0)
 . Q:$D(GMTSQIT)  D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",81,0)
 . D WRT^GMTSDEM("Insurance Company",$E(COMPANY,1,27),"Holder",HOLDER,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",82,0)
 . I $L(TYPE)!($L(EFFECT)) D WRT^GMTSDEM("Policy Type",$E(TYPE,1,28),"Effective",$$EDT^GMTSU(EFFECT),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",83,0)
 . I $L(GROUP)!($L(EXPIRE)) D WRT^GMTSDEM("Group #",$E(GROUP,1,28),"Expires",$$EDT^GMTSU(EXPIRE),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",84,0)
 . I $L(SUBSCRIB)!($L(COB)) D WRT^GMTSDEM("Subscriber ID",$E(SUBSCRIB,1,28),"Coord. of Benefits",COB,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",85,0)
 Q
"RTN","GMTSDEM2",86,0)
 ;          
"RTN","GMTSDEM2",87,0)
RACE ; Race and Ethnicity
"RTN","GMTSDEM2",88,0)
 N GMTS D ER(+($G(DFN)),.GMTS) I $L($G(GMTS(2)))!($L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",89,0)
 . N GMTSD,GMTSI,GMTSC
"RTN","GMTSDEM2",90,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(6)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",91,0)
 . . S GMTSD=$P($G(GMTS(6)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",92,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Ethnicity",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",93,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",94,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSDEM2",95,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(2)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",96,0)
 . . S GMTSD=$P($G(GMTS(2)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",97,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",98,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",99,0)
 I '$L($G(GMTS(2)))&('$L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",100,0)
 . N GMTSD,GMTSI,GMTSC S GMTSD=$G(GMTS(.06)) D WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",101,0)
 Q
"RTN","GMTSDEM2",102,0)
RE ; Race and Ethnicity Component
"RTN","GMTSDEM2",103,0)
 N GMTS D ER(+($G(DFN)),.GMTS) I $L($G(GMTS(2)))!($L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",104,0)
 . N GMTSD,GMTSI,GMTSC
"RTN","GMTSDEM2",105,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(6)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",106,0)
 . . S GMTSD=$P($G(GMTS(6)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",107,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Ethnicity",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",108,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",109,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSDEM2",110,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(2)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",111,0)
 . . S GMTSD=$P($G(GMTS(2)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",112,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",113,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",114,0)
 I '$L($G(GMTS(2)))&('$L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",115,0)
 . N GMTSD,GMTSI,GMTSC S GMTSD=$G(GMTS(.06)) D WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",116,0)
 Q
"RTN","GMTSDEM2",117,0)
ER(DFN,GMTS) ;   Get Ethnicity and Race
"RTN","GMTSDEM2",118,0)
 N VADM,VA,VAERR,GMTSD,GMTSI,GMTSC,X,Y S DFN=+($G(DFN)) Q:+DFN=0
"RTN","GMTSDEM2",119,0)
 D DEM^VADPT S GMTSD=$P($G(VADM(8)),"^",2),GMTS(.06)=GMTSD,GMTS("OLD")=GMTSD
"RTN","GMTSDEM2",120,0)
 S GMTSI=0 F  S GMTSI=$O(VADM(11,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEM2",121,0)
 . S GMTSD=$P($G(VADM(11,GMTSI)),"^",2) S:$L(GMTSD) GMTS(6)=$G(GMTS(6))_"^"_GMTSD
"RTN","GMTSDEM2",122,0)
 S GMTSD=$G(GMTS(6)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",123,0)
 S GMTS(6)=GMTSD S GMTSI=0 F  S GMTSI=$O(VADM(12,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEM2",124,0)
 . S GMTSD=$P($G(VADM(12,GMTSI)),"^",2) S:$L(GMTSD) GMTS(2)=$G(GMTS(2))_"^"_GMTSD
"RTN","GMTSDEM2",125,0)
 S GMTSD=$G(GMTS(2)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",126,0)
 S GMTS(2)=GMTSD,GMTSD=$G(GMTS(6))_"^^"_$G(GMTS(2)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",127,0)
 S GMTS("NEW")=GMTSD,GMTS(.06)=$G(GMTS(.06)),GMTS(2)=$G(GMTS(2)),GMTS(6)=$G(GMTS(6))
"RTN","GMTSDEM2",128,0)
 Q
"RTN","GMTSDEM2",129,0)
 ;              
"RTN","GMTSDEM2",130,0)
ABR(X) ; Abbreviations
"RTN","GMTSDEM2",131,0)
 S X=$$UP^XLFSTR($G(X)) N TM,AB,SID S TM="PROCEDURES",AB="PROC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",132,0)
 S TM="SUPPLEMENTAL",AB="SUP" S:X[TM X=$$SW(X,TM,AB) S TM="ORGANIZATION",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="ORIGIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",133,0)
 S TM="ORGANIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="MAINTENANCE",AB="MAINT" S:X[TM X=$$SW(X,TM,AB) S TM="PROVIDER",AB="PROV" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",134,0)
 S TM="INDIVIDUAL",AB="INDIVID" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCIATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",135,0)
 S TM="PRACT",AB="PRACT" S:X[TM X=$$SW(X,TM,AB) S TM="INSURANCE",AB="INS" S:X[TM X=$$SW(X,TM,AB) S TM="ETC.",AB="ETC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",136,0)
 S TM="(ONLY)",AB="" S:X[TM X=$$SW(X,TM,AB) S TM="PROTECTION",AB="PROT" S:X[TM X=$$SW(X,TM,AB) S TM="PRACTICE",AB="PRACT" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",137,0)
 Q X
"RTN","GMTSDEM2",138,0)
SW(X,Y,Z) ; Swap Abbreviation with Term
"RTN","GMTSDEM2",139,0)
 N TM,AB
"RTN","GMTSDEM2",140,0)
 S X=$G(X),TM=$$TRIM($G(Y)),AB=$$TRIM($G(Z)) Q:X="" ""  Q:TM="" X  Q:TM=AB X
"RTN","GMTSDEM2",141,0)
 F  Q:X'[TM  S X=$P(X,TM,1)_AB_$P(X,TM,2)
"RTN","GMTSDEM2",142,0)
 Q X
"RTN","GMTSDEM2",143,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSDEM2",144,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSDEM2",145,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSDEM2",146,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSDEM2",147,0)
 Q X
"RTN","GMTSDEMB")
0^3^B13170172
"RTN","GMTSDEMB",1,0)
GMTSDEMB ; SLC/DLT,KER - Brief Demographic Component  ; 12/11/2002
"RTN","GMTSDEMB",2,0)
 ;;2.7;Health Summary;**29,49,55,56,60**;Oct 20, 1995
"RTN","GMTSDEMB",3,0)
 ;                    
"RTN","GMTSDEMB",4,0)
 ; External References
"RTN","GMTSDEMB",5,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4)
"RTN","GMTSDEMB",6,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEMB",7,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEMB",8,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEMB",9,0)
 ;   DBIA  2990  TFL^VAFCTFU1
"RTN","GMTSDEMB",10,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSDEMB",11,0)
 ;   DBIA  2171  $$LKUP^XUAF4
"RTN","GMTSDEMB",12,0)
 ;                  
"RTN","GMTSDEMB",13,0)
DEMOG ; Brief Demographics (VADPT)
"RTN","GMTSDEMB",14,0)
 N I,IX,VA,VAEL,VADM,VAPA,GMTSS,GMTSOUT,GMTSR D ELIG^VADPT,ADD^VADPT,DEM^VADPT
"RTN","GMTSDEMB",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEMB",16,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEMB",17,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEMB",18,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", ",$P(VAPA(5),"^",2),"  ",VAPA(6),!
"RTN","GMTSDEMB",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2)
"RTN","GMTSDEMB",20,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEMB",21,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2)
"RTN","GMTSDEMB",22,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEMB",23,0)
 D RACE^GMTSDEM2
"RTN","GMTSDEMB",24,0)
 D CD^GMTSDEMP(DFN) Q:$D(GMTSQIT)  D TF(DFN) Q:$D(GMTSQIT)  D SRC
"RTN","GMTSDEMB",25,0)
 K I,IX,VA,VAEL,VAPA
"RTN","GMTSDEMB",26,0)
 Q
"RTN","GMTSDEMB",27,0)
TF(X) ; Treating Facilities
"RTN","GMTSDEMB",28,0)
 Q:$D(GMTSQIT)  N DFN,GMTSC,GMTSDS,GMTSI,GMTSIEN,GMTSIT,GMTSS
"RTN","GMTSDEMB",29,0)
 N GMTSTA,GMTSTF,GMTSTF2,GMTSTFC,GMTSTY,GMTSTFT
"RTN","GMTSDEMB",30,0)
 S GMTSTFC=0,DFN=+($G(X)),U="^" D TFL^VAFCTFU1(.GMTSTF,+($G(DFN)))
"RTN","GMTSDEMB",31,0)
 S (GMTSLP,GMTSC,GMTSI,GMTSS)=0
"RTN","GMTSDEMB",32,0)
 F  S GMTSI=$O(GMTSTF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEMB",33,0)
 . S GMTSTFT=$G(GMTSTF(GMTSI))
"RTN","GMTSDEMB",34,0)
 . S:+($G(GMTSTF(GMTSI)))=776!(+($G(GMTSTF(GMTSI)))=200) $P(GMTSTFT,"^",2)="DEPT. OF DEFENSE"
"RTN","GMTSDEMB",35,0)
 . S GMTSTF2((99999999-(+($P($P($G(GMTSTF(GMTSI)),"^",3),".",1)))),+($$LKUP^XUAF4($P($G(GMTSTF(GMTSI)),"^",2))))=GMTSTFT
"RTN","GMTSDEMB",36,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSTF2(GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",37,0)
 . S GMTSIEN="" F  S GMTSIEN=$O(GMTSTF2(GMTSI,GMTSIEN)) Q:GMTSIEN=""  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",38,0)
 . . S GMTSTA=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",1)
"RTN","GMTSDEMB",39,0)
 . . S GMTSIT=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",2) Q:'$L(GMTSIT)
"RTN","GMTSDEMB",40,0)
 . . Q:GMTSIT="NO ICN"
"RTN","GMTSDEMB",41,0)
 . . S GMTSDS=$P($P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",3),".",1)
"RTN","GMTSDEMB",42,0)
 . . S:+GMTSDS>0 GMTSLP=1 S:+GMTSDS'>0 GMTSDS="",GMTSLP=0 Q:+GMTSLP=0
"RTN","GMTSDEMB",43,0)
 . . S:+GMTSDS>0 GMTSDS=$TR($$FMTE^XLFDT(GMTSDS,"5DZ"),"@"," ")
"RTN","GMTSDEMB",44,0)
 . . S:GMTSDS="" GMTSDS="--/--/----" S:+GMTSLP>0 GMTSC=GMTSC+1
"RTN","GMTSDEMB",45,0)
 . . I GMTSC=1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",46,0)
 . . . N STR
"RTN","GMTSDEMB",47,0)
 . . . D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",48,0)
 . . . S STR="  Treating Facility                 Type         Station     Last Seen"
"RTN","GMTSDEMB",49,0)
 . . . D WRT^GMTSDEM(STR,,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",50,0)
 . . . S STR="  ----------------------------      -----------  -------     ----------"
"RTN","GMTSDEMB",51,0)
 . . . D WRT^GMTSDEM(STR,,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",52,0)
 . . Q:$D(GMTSQIT)
"RTN","GMTSDEMB",53,0)
 . . S GMTSTY=$$GET1^DIQ(4,(+GMTSIEN_","),13,"E")
"RTN","GMTSDEMB",54,0)
 . . S:+GMTSTA<0 (GMTSTA,GMTSDS)=""
"RTN","GMTSDEMB",55,0)
 . . S:GMTSIT="NO ICN" GMTSIT="Not available"
"RTN","GMTSDEMB",56,0)
 . . S STR="  "_$G(GMTSIT)
"RTN","GMTSDEMB",57,0)
 . . S STR=STR_$J("",(36-$L(STR)))_$G(GMTSTY)
"RTN","GMTSDEMB",58,0)
 . . S STR=STR_$J("",(49-$L(STR)))_$J($G(GMTSTA),6)
"RTN","GMTSDEMB",59,0)
 . . S STR=STR_$J("",(61-$L(STR)))_$G(GMTSDS)
"RTN","GMTSDEMB",60,0)
 . . D WRT^GMTSDEM(STR,,,,0)
"RTN","GMTSDEMB",61,0)
 . . S GMTSTFC=GMTSTFC+1
"RTN","GMTSDEMB",62,0)
 Q
"RTN","GMTSDEMB",63,0)
SRC ; Source of Info
"RTN","GMTSDEMB",64,0)
 Q:$D(GMTSQIT)  N GMTSS,GMTSR,GMTSN,GMTST S GMTSR=0
"RTN","GMTSDEMB",65,0)
 ;   National Health Summary Type
"RTN","GMTSDEMB",66,0)
 S GMTSN=$S(+($G(^GMT(142,+($G(GMTSTYP)),"VA")))>0:1,1:0)
"RTN","GMTSDEMB",67,0)
 ;   Health Summary Type Name
"RTN","GMTSDEMB",68,0)
 S GMTST=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSDEMB",69,0)
 ;   Remote Data View HS Type
"RTN","GMTSDEMB",70,0)
 S:GMTSN>0&(GMTST["REMOTE") GMTSR=1
"RTN","GMTSDEMB",71,0)
 ;   Demographics Array
"RTN","GMTSDEMB",72,0)
 S:$D(GMTSDEMX) GMTSR=1
"RTN","GMTSDEMB",73,0)
 S GMTSS=$$SITE^GMTSU2 I GMTSR>0,$L(GMTSS) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",74,0)
 . D WRT^GMTSDEM("",,,,0) N STR
"RTN","GMTSDEMB",75,0)
 . S STR="  Source of Info: "_GMTSS D WRT^GMTSDEM(STR,,,,0)
"RTN","GMTSDEMB",76,0)
 Q
"RTN","GMTSDGP")
0^4^B10461091
"RTN","GMTSDGP",1,0)
GMTSDGP ; SLC/TRS,KER/NDBI - PTF Surgeries/Procedures ; 12/11/2002
"RTN","GMTSDGP",2,0)
 ;;2.7;Health Summary;**28,49,60**;Oct 20, 1995
"RTN","GMTSDGP",3,0)
 ;                    
"RTN","GMTSDGP",4,0)
 ; External References
"RTN","GMTSDGP",5,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGP",6,0)
 ;   DBIA  1372  ^DGPT("B"
"RTN","GMTSDGP",7,0)
 ;   DBIA  2929  OPC^A7RHSM
"RTN","GMTSDGP",8,0)
 ;   DBIA  2929  PRC^A7RHSM
"RTN","GMTSDGP",9,0)
 ;   DBIA 10083  ^ICD0( 
"RTN","GMTSDGP",10,0)
 ;   DBIA 10015  EN^DIQ1 (file 80.1)
"RTN","GMTSDGP",11,0)
 ;                    
"RTN","GMTSDGP",12,0)
ENS ; Module For History of PTF Surgery Episodes
"RTN","GMTSDGP",13,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",14,0)
 E  S CNTR=100
"RTN","GMTSDGP",15,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",16,0)
 S PTF=0
"RTN","GMTSDGP",17,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDS
"RTN","GMTSDGP",18,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) OPC^A7RHSM
"RTN","GMTSDGP",19,0)
 I $D(GMS) S O=0 F I=1:1 S O=$O(GMS(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMS(O) W ?21,$P(GMS(O,O1),U),?68,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",20,0)
 D KILLADM Q
"RTN","GMTSDGP",21,0)
ICDS ;   ICD Surgery
"RTN","GMTSDGP",22,0)
 N GMCZ,GMA,D0,DA,DR,DIC,II,IX,SURG,ZI Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGP",23,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDS1
"RTN","GMTSDGP",24,0)
 Q
"RTN","GMTSDGP",25,0)
ICDS1 ;   Load Surgery entries into GMS array (inverted)
"RTN","GMTSDGP",26,0)
 S GMCZ=2 S GMS(IX)="  Surgery  "_X F GMA=8:1:12 D SGY
"RTN","GMTSDGP",27,0)
 Q
"RTN","GMTSDGP",28,0)
SGY ;   Surgery Line
"RTN","GMTSDGP",29,0)
 K DIQ Q:$P(SURG,U,GMA)=""
"RTN","GMTSDGP",30,0)
 S DIC=80.1,DR="4;.01",DA=$P(SURG,U,GMA),DIQ="ICDS(" D EN^DIQ1
"RTN","GMTSDGP",31,0)
 I $D(ICDS(80.1,DA)) S GMS(IX,GMA)=$E(ICDS(80.1,DA,4),1,45)_U_ICDS(80.1,DA,.01)
"RTN","GMTSDGP",32,0)
 Q
"RTN","GMTSDGP",33,0)
 ;                    
"RTN","GMTSDGP",34,0)
ENP ; Module For History of PTF Procedures
"RTN","GMTSDGP",35,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",36,0)
 E  S CNTR=100
"RTN","GMTSDGP",37,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",38,0)
 S PTF=0
"RTN","GMTSDGP",39,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDP
"RTN","GMTSDGP",40,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) PRC^A7RHSM
"RTN","GMTSDGP",41,0)
 I $D(GMP) S O=0 F I=1:1 S O=$O(GMP(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMP(O) W ?21,$P(GMP(O,O1),U),?68,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",42,0)
 D KILLADM Q
"RTN","GMTSDGP",43,0)
 Q
"RTN","GMTSDGP",44,0)
ICDP ;   ICD Procedures
"RTN","GMTSDGP",45,0)
 N D0,DA,DIC,DR,GMCZ,GTA,II,IX,PRX,ZI Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGP",46,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDP1
"RTN","GMTSDGP",47,0)
 Q
"RTN","GMTSDGP",48,0)
ICDP1 ;   Load Procedure entries into GMP array (inverted)
"RTN","GMTSDGP",49,0)
 S GMCZ=2 S GMP(IX)="Procedure  "_X F GTA=5:1:9 D PXGY
"RTN","GMTSDGP",50,0)
 Q
"RTN","GMTSDGP",51,0)
PXGY ;   Procedure Line
"RTN","GMTSDGP",52,0)
 K DIQ
"RTN","GMTSDGP",53,0)
 Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGP",54,0)
 S DIC=80.1,DR="4;.01",DA=$P(PRX,U,GTA),DIQ="ICDP(" D EN^DIQ1
"RTN","GMTSDGP",55,0)
 I $D(ICDP(80.1,DA)) S GMP(IX,GTA)=$E(ICDP(80.1,DA,4),1,45)_U_ICDP(80.1,DA,.01)
"RTN","GMTSDGP",56,0)
 Q
"RTN","GMTSDGP",57,0)
 ;                    
"RTN","GMTSDGP",58,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDGP",59,0)
 K CNTR,GMCZ,LN1,IX,X,ZA,N,ICD,ICD0,PTF,GMC,O,O1,GMS,T1,T2,SURG,SURGY,PRX,PRXY,DATE,D1,I,IMT,GMA,GTA,II,ZI,GMP
"RTN","GMTSDGP",60,0)
 K ICDP,ICDS
"RTN","GMTSDGP",61,0)
 Q
"RTN","GMTSP60")
0^^B9572059
"RTN","GMTSP60",1,0)
GMTSP60 ; CIO/SLC - Post Install GMTS*2.7*60    ; 12/11/2002
"RTN","GMTSP60",2,0)
 ;;2.7;Health Summary;**60**;Oct 20, 1995
"RTN","GMTSP60",3,0)
 ;
"RTN","GMTSP60",4,0)
 Q
"RTN","GMTSP60",5,0)
POST ; Post Install
"RTN","GMTSP60",6,0)
 D MB(" Updating Health Summary Component Descriptions")
"RTN","GMTSP60",7,0)
 N GMTSD,GMTSB,GMTSDT S GMTSDT=$$DT^XLFDT,GMTSB=$O(^GMT(142.1,"C","BDEM",0)),GMTSD=$O(^GMT(142.1,"C","DEM",0))
"RTN","GMTSP60",8,0)
 I +GMTSD>0 D
"RTN","GMTSP60",9,0)
 . D MB("   MAS DEMOGRAPHICS            DEM    Demographics")
"RTN","GMTSP60",10,0)
 . K ^GMT(142.1,+GMTSD,3.5) S ^GMT(142.1,+GMTSD,3.5,0)="^142.35^7^7^"_GMTSDT_"^^^^"
"RTN","GMTSP60",11,0)
 . S ^GMT(142.1,+GMTSD,3.5,1,0)="This component contains the following patient demographic data "
"RTN","GMTSP60",12,0)
 . D MB(("     "_^GMT(142.1,+GMTSD,3.5,1,0)))
"RTN","GMTSP60",13,0)
 . S ^GMT(142.1,+GMTSD,3.5,2,0)="(if available) from the MAS package: address, phone, county, "
"RTN","GMTSP60",14,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,2,0)))
"RTN","GMTSP60",15,0)
 . S ^GMT(142.1,+GMTSD,3.5,3,0)="marital status, religion, age, sex, race, ethnicity, occupation,"
"RTN","GMTSP60",16,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,3,0)))
"RTN","GMTSP60",17,0)
 . S ^GMT(142.1,+GMTSD,3.5,4,0)="period of service, POW status (e.g., Y or N), branch of service,"
"RTN","GMTSP60",18,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,4,0)))
"RTN","GMTSP60",19,0)
 . S ^GMT(142.1,+GMTSD,3.5,5,0)="combat status (e.g., Y or N), eligibility code, current (verified)"
"RTN","GMTSP60",20,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,5,0)))
"RTN","GMTSP60",21,0)
 . S ^GMT(142.1,+GMTSD,3.5,6,0)="eligibility status, service connected %, mean test, primary and"
"RTN","GMTSP60",22,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,6,0)))
"RTN","GMTSP60",23,0)
 . S ^GMT(142.1,+GMTSD,3.5,7,0)="secondary next of kin (NOK), NOK phone number and address."
"RTN","GMTSP60",24,0)
 . D M(("     "_^GMT(142.1,+GMTSD,3.5,7,0)))
"RTN","GMTSP60",25,0)
 I +GMTSB>0 D 
"RTN","GMTSP60",26,0)
 . D MB("   MAS DEMOGRAPHICS BRIEF      BDEM   Brief Demographics")
"RTN","GMTSP60",27,0)
 . K ^GMT(142.1,+GMTSB,3.5) S ^GMT(142.1,+GMTSB,3.5,0)="^142.35^4^4^"_GMTSDT_"^^^"
"RTN","GMTSP60",28,0)
 . S ^GMT(142.1,+GMTSB,3.5,1,0)="This component contains information from the MAS package.  It "
"RTN","GMTSP60",29,0)
 . D MB(("     "_^GMT(142.1,+GMTSB,3.5,1,0)))
"RTN","GMTSP60",30,0)
 . S ^GMT(142.1,+GMTSB,3.5,2,0)="provides brief patient demographic information including: address,"
"RTN","GMTSP60",31,0)
 . D M(("     "_^GMT(142.1,+GMTSB,3.5,2,0)))
"RTN","GMTSP60",32,0)
 . S ^GMT(142.1,+GMTSB,3.5,3,0)="phone number, age, sex, race, ethnicity, mean test, and eligibility"
"RTN","GMTSP60",33,0)
 . D M(("     "_^GMT(142.1,+GMTSB,3.5,3,0)))
"RTN","GMTSP60",34,0)
 . S ^GMT(142.1,+GMTSB,3.5,4,0)="code (e.g., service connected 50-100%)."
"RTN","GMTSP60",35,0)
 . D M(("     "_^GMT(142.1,+GMTSB,3.5,4,0)))
"RTN","GMTSP60",36,0)
 D M("")
"RTN","GMTSP60",37,0)
 Q
"RTN","GMTSP60",38,0)
MB(X) ;   Message with Blank Line
"RTN","GMTSP60",39,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSP60",40,0)
M(X) ;   Message
"RTN","GMTSP60",41,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"VER")
8.0^22.0
**END**
**END**
