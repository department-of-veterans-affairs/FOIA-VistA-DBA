Released FH*5.5*1 SEQ #1
Extracted from mail message
**KIDS**:FH*5.5*1^

**INSTALL NAME**
FH*5.5*1
"BLD",5617,0)
FH*5.5*1^DIETETICS^0^3050524^y
"BLD",5617,4,0)
^9.64PA^118.2^2
"BLD",5617,4,115,0)
115
"BLD",5617,4,115,2,0)
^9.641^115.1619^2
"BLD",5617,4,115,2,115.1,0)
TF PRODUCT  (sub-file)
"BLD",5617,4,115,2,115.1,1,0)
^9.6411^4^3
"BLD",5617,4,115,2,115.1,1,1,0)
STRENGTH
"BLD",5617,4,115,2,115.1,1,3,0)
PRODUCT ML'S/DAY
"BLD",5617,4,115,2,115.1,1,4,0)
WATER ML'S/DAY
"BLD",5617,4,115,2,115.1619,0)
TUBEFEEDING PRODUCT  (sub-file)
"BLD",5617,4,115,2,115.1619,1,0)
^9.6411^4^2
"BLD",5617,4,115,2,115.1619,1,3,0)
PRODUCT ML'S/DAY
"BLD",5617,4,115,2,115.1619,1,4,0)
WATER ML'S/DAY
"BLD",5617,4,115,222)
y^y^p^^^^n^^n
"BLD",5617,4,115,224)

"BLD",5617,4,118.2,0)
118.2
"BLD",5617,4,118.2,2,0)
^9.641^118.2^1
"BLD",5617,4,118.2,2,118.2,0)
TUBEFEEDING  (File-top level)
"BLD",5617,4,118.2,2,118.2,1,0)
^9.6411^3^2
"BLD",5617,4,118.2,2,118.2,1,2,0)
AMT/UNIT
"BLD",5617,4,118.2,2,118.2,1,3,0)
KCAL/ML
"BLD",5617,4,118.2,222)
y^y^p^^^^n^^n
"BLD",5617,4,118.2,224)

"BLD",5617,4,"APDD",115,115.1)

"BLD",5617,4,"APDD",115,115.1,1)

"BLD",5617,4,"APDD",115,115.1,3)

"BLD",5617,4,"APDD",115,115.1,4)

"BLD",5617,4,"APDD",115,115.1619)

"BLD",5617,4,"APDD",115,115.1619,3)

"BLD",5617,4,"APDD",115,115.1619,4)

"BLD",5617,4,"APDD",118.2,118.2)

"BLD",5617,4,"APDD",118.2,118.2,2)

"BLD",5617,4,"APDD",118.2,118.2,3)

"BLD",5617,4,"B",115,115)

"BLD",5617,4,"B",118.2,118.2)

"BLD",5617,"INIT")
CONVC^FHOMUTL
"BLD",5617,"KRN",0)
^9.67PA^8989.52^19
"BLD",5617,"KRN",.4,0)
.4
"BLD",5617,"KRN",.401,0)
.401
"BLD",5617,"KRN",.402,0)
.402
"BLD",5617,"KRN",.403,0)
.403
"BLD",5617,"KRN",.5,0)
.5
"BLD",5617,"KRN",.84,0)
.84
"BLD",5617,"KRN",3.6,0)
3.6
"BLD",5617,"KRN",3.8,0)
3.8
"BLD",5617,"KRN",9.2,0)
9.2
"BLD",5617,"KRN",9.8,0)
9.8
"BLD",5617,"KRN",9.8,"NM",0)
^9.68A^29^29
"BLD",5617,"KRN",9.8,"NM",1,0)
FHOMRO1^^0^B63144106
"BLD",5617,"KRN",9.8,"NM",2,0)
FHOMRP1^^0^B7723216
"BLD",5617,"KRN",9.8,"NM",3,0)
FHOMRR1^^0^B18595487
"BLD",5617,"KRN",9.8,"NM",4,0)
FHASP2^^0^B4712504
"BLD",5617,"KRN",9.8,"NM",5,0)
FHDCR1A^^0^B42512138
"BLD",5617,"KRN",9.8,"NM",6,0)
FHDMP^^0^B21472376
"BLD",5617,"KRN",9.8,"NM",7,0)
FHDMP4^^0^B11891881
"BLD",5617,"KRN",9.8,"NM",8,0)
FHOMPP1^^0^B23129471
"BLD",5617,"KRN",9.8,"NM",9,0)
FHOMRMD^^0^B14582168
"BLD",5617,"KRN",9.8,"NM",10,0)
FHOMRT1^^0^B19762686
"BLD",5617,"KRN",9.8,"NM",11,0)
FHOMUTL^^0^B29468192
"BLD",5617,"KRN",9.8,"NM",12,0)
FHORD13^^0^B49207960
"BLD",5617,"KRN",9.8,"NM",13,0)
FHORD2^^0^B9794124
"BLD",5617,"KRN",9.8,"NM",14,0)
FHORD6^^0^B21232580
"BLD",5617,"KRN",9.8,"NM",15,0)
FHORD81^^0^B37486127
"BLD",5617,"KRN",9.8,"NM",16,0)
FHORT1^^0^B15603722
"BLD",5617,"KRN",9.8,"NM",17,0)
FHORT10^^0^B27436988
"BLD",5617,"KRN",9.8,"NM",18,0)
FHORT2^^0^B10349577
"BLD",5617,"KRN",9.8,"NM",19,0)
FHORT5A^^0^B25551328
"BLD",5617,"KRN",9.8,"NM",20,0)
FHORT5B^^0^B2882203
"BLD",5617,"KRN",9.8,"NM",21,0)
FHORX1^^0^B36932734
"BLD",5617,"KRN",9.8,"NM",22,0)
FHORX1A^^0^B53383181
"BLD",5617,"KRN",9.8,"NM",23,0)
FHORX1B^^0^B12206977
"BLD",5617,"KRN",9.8,"NM",24,0)
FHWOR5^^0^B19013679
"BLD",5617,"KRN",9.8,"NM",25,0)
FHWOR51^^0^B8841882
"BLD",5617,"KRN",9.8,"NM",26,0)
FHWOR5R^^0^B5367159
"BLD",5617,"KRN",9.8,"NM",27,0)
FHWOR71^^0^B28572181
"BLD",5617,"KRN",9.8,"NM",28,0)
FHOMRL1^^0^B11581637
"BLD",5617,"KRN",9.8,"NM",29,0)
FHWHEA^^0^B20746038
"BLD",5617,"KRN",9.8,"NM","B","FHASP2",4)

"BLD",5617,"KRN",9.8,"NM","B","FHDCR1A",5)

"BLD",5617,"KRN",9.8,"NM","B","FHDMP",6)

"BLD",5617,"KRN",9.8,"NM","B","FHDMP4",7)

"BLD",5617,"KRN",9.8,"NM","B","FHOMPP1",8)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRL1",28)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRMD",9)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRO1",1)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRP1",2)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRR1",3)

"BLD",5617,"KRN",9.8,"NM","B","FHOMRT1",10)

"BLD",5617,"KRN",9.8,"NM","B","FHOMUTL",11)

"BLD",5617,"KRN",9.8,"NM","B","FHORD13",12)

"BLD",5617,"KRN",9.8,"NM","B","FHORD2",13)

"BLD",5617,"KRN",9.8,"NM","B","FHORD6",14)

"BLD",5617,"KRN",9.8,"NM","B","FHORD81",15)

"BLD",5617,"KRN",9.8,"NM","B","FHORT1",16)

"BLD",5617,"KRN",9.8,"NM","B","FHORT10",17)

"BLD",5617,"KRN",9.8,"NM","B","FHORT2",18)

"BLD",5617,"KRN",9.8,"NM","B","FHORT5A",19)

"BLD",5617,"KRN",9.8,"NM","B","FHORT5B",20)

"BLD",5617,"KRN",9.8,"NM","B","FHORX1",21)

"BLD",5617,"KRN",9.8,"NM","B","FHORX1A",22)

"BLD",5617,"KRN",9.8,"NM","B","FHORX1B",23)

"BLD",5617,"KRN",9.8,"NM","B","FHWHEA",29)

"BLD",5617,"KRN",9.8,"NM","B","FHWOR5",24)

"BLD",5617,"KRN",9.8,"NM","B","FHWOR51",25)

"BLD",5617,"KRN",9.8,"NM","B","FHWOR5R",26)

"BLD",5617,"KRN",9.8,"NM","B","FHWOR71",27)

"BLD",5617,"KRN",19,0)
19
"BLD",5617,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5617,"KRN",19,"NM",1,0)
FHOMRMGR^^2
"BLD",5617,"KRN",19,"NM",2,0)
FHOMRL^^0
"BLD",5617,"KRN",19,"NM","B","FHOMRL",2)

"BLD",5617,"KRN",19,"NM","B","FHOMRMGR",1)

"BLD",5617,"KRN",19.1,0)
19.1
"BLD",5617,"KRN",101,0)
101
"BLD",5617,"KRN",409.61,0)
409.61
"BLD",5617,"KRN",771,0)
771
"BLD",5617,"KRN",870,0)
870
"BLD",5617,"KRN",8989.51,0)
8989.51
"BLD",5617,"KRN",8989.52,0)
8989.52
"BLD",5617,"KRN",8994,0)
8994
"BLD",5617,"KRN","B",.4,.4)

"BLD",5617,"KRN","B",.401,.401)

"BLD",5617,"KRN","B",.402,.402)

"BLD",5617,"KRN","B",.403,.403)

"BLD",5617,"KRN","B",.5,.5)

"BLD",5617,"KRN","B",.84,.84)

"BLD",5617,"KRN","B",3.6,3.6)

"BLD",5617,"KRN","B",3.8,3.8)

"BLD",5617,"KRN","B",9.2,9.2)

"BLD",5617,"KRN","B",9.8,9.8)

"BLD",5617,"KRN","B",19,19)

"BLD",5617,"KRN","B",19.1,19.1)

"BLD",5617,"KRN","B",101,101)

"BLD",5617,"KRN","B",409.61,409.61)

"BLD",5617,"KRN","B",771,771)

"BLD",5617,"KRN","B",870,870)

"BLD",5617,"KRN","B",8989.51,8989.51)

"BLD",5617,"KRN","B",8989.52,8989.52)

"BLD",5617,"KRN","B",8994,8994)

"BLD",5617,"QUES",0)
^9.62^^
"BLD",5617,"REQB",0)
^9.611^1^1
"BLD",5617,"REQB",1,0)
DIETETICS 5.5^1
"BLD",5617,"REQB","B","DIETETICS 5.5",1)

"FIA",115)
NUTRITION PERSON
"FIA",115,0)
^FHPT(
"FIA",115,0,0)
115
"FIA",115,0,1)
y^y^p^^^^n^^n
"FIA",115,0,10)

"FIA",115,0,11)

"FIA",115,0,"RLRO")

"FIA",115,0,"VR")
5.5^FH
"FIA",115,115)
1
"FIA",115,115.1)
1
"FIA",115,115.1,1)

"FIA",115,115.1,3)

"FIA",115,115.1,4)

"FIA",115,115.1619)
1
"FIA",115,115.1619,3)

"FIA",115,115.1619,4)

"FIA",118.2)
TUBEFEEDING
"FIA",118.2,0)
^FH(118.2,
"FIA",118.2,0,0)
118.2Is
"FIA",118.2,0,1)
y^y^p^^^^n^^n
"FIA",118.2,0,10)

"FIA",118.2,0,11)

"FIA",118.2,0,"RLRO")

"FIA",118.2,0,"VR")
5.5^FH
"FIA",118.2,118.2)
1
"FIA",118.2,118.2,2)

"FIA",118.2,118.2,3)

"INIT")
CONVC^FHOMUTL
"KRN",19,11730,-1)
2^1
"KRN",19,11730,0)
FHOMRMGR^Recurring Meals Menu^^M^1901
"KRN",19,11730,10,0)
^19.01IP^13^13
"KRN",19,11730,10,13,0)
12385^RM^8
"KRN",19,11730,10,13,"^")
FHOMRL
"KRN",19,11730,"U")
RECURRING MEALS MENU
"KRN",19,12385,-1)
0^2
"KRN",19,12385,0)
FHOMRL^Recurring Meals List by Location^^R^^^^^^^^
"KRN",19,12385,1,0)
^^2^2^3050331^
"KRN",19,12385,1,1,0)
This option allows the user to display a list of all recurring meals
"KRN",19,12385,1,2,0)
within the selected timeframe, which can be displayed by location or ALL.
"KRN",19,12385,25)
FHOMRL1
"KRN",19,12385,"U")
RECURRING MEALS LIST BY LOCATI
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",29,-1)
1^1
"PKG",29,0)
DIETETICS^FH^Dietetics/Nutrition & Food Service System
"PKG",29,20,0)
^9.402P^^
"PKG",29,22,0)
^9.49I^1^1
"PKG",29,22,1,0)
5.5^3050202^3040621^4572
"PKG",29,22,1,"PAH",1,0)
1^3050524
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
29
"RTN","FHASP2")
0^4^B4712504
"RTN","FHASP2",1,0)
FHASP2 ; HISC/REL - Nutrition Profile (cont.) ;10/4/93  11:44
"RTN","FHASP2",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHASP2",3,0)
 S X=$P($G(^DGPM(ADM,0)),"^",10) W !,"Adm. Dx: ",$E(X,1,27)
"RTN","FHASP2",4,0)
 S X(0)=$G(^FHPT(FHDFN,"A",ADM,0))
"RTN","FHASP2",5,0)
F1 D CUR^FHORD7 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHASP2",6,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) S COM=^(1) W:COM'="" !,"Comment: ",COM
"RTN","FHASP2",7,0)
 S TYP=$P(X,"^",8) I TYP'="" W !,"Service: ",$S(TYP="T":"Tray",TYP="D":"Dining Room",1:"Cafeteria")
"RTN","FHASP2",8,0)
 S DTP=$P(X(0),"^",3) I DTP D DTP^FH W !,"Expires: ",DTP
"RTN","FHASP2",9,0)
 S TF=$P(X(0),"^",4) G:TF<1 F2
"RTN","FHASP2",10,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHASP2",11,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHASP2",12,0)
 D DTP^FH W !!,"Tubefeed Ordered: ",DTP
"RTN","FHASP2",13,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHASP2",14,0)
 W !,"Total Quantity: ",TQU," ml",?42,"Total KCAL: ",CAL
"RTN","FHASP2",15,0)
 W:COM'="" !,"Comment: ",COM
"RTN","FHASP2",16,0)
F2 S NO=$P(X(0),"^",7),Y=$S('NO:"",1:^FHPT(FHDFN,"A",ADM,"SF",NO,0))
"RTN","FHASP2",17,0)
 S L=$P(Y,"^",4) W !!,"Supplemental Feeding: ",$S('L:"No Order",1:$P(^FH(118.1,L,0),"^",1)) G:'NO F3
"RTN","FHASP2",18,0)
 S DTP=$P(Y,"^",30) D DTP^FH W ?50,"Reviewed: ",DTP
"RTN","FHASP2",19,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$P(^FH(118,Z,0),"^",1)
"RTN","FHASP2",20,0)
 F K1=1:1:3 I N(K1)'="" W !?5,$P("10am; 2pm; 8pm",";",K1),":",?13,N(K1)
"RTN","FHASP2",21,0)
F3 K CAL,TF2,TQU,X(0),XY Q
"RTN","FHASP2",22,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHASP2",23,0)
 W !?3,$P($G(^FH(118.2,TUN,0)),"^",1),", ",$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")," Str., ",QUA Q
"RTN","FHDCR1A")
0^5^B42512138
"RTN","FHDCR1A",1,0)
FHDCR1A ; HISC/REL/NCA/RVD - Build Diet Cards ;1/21/99  14:04
"RTN","FHDCR1A",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHDCR1A",3,0)
B1 ; Store wards
"RTN","FHDCR1A",4,0)
 K ^TMP($J),NN,N,P S MFLG=0 D Q1^FHDCR1B D NOW^%DTC S (DTP,TIM)=% D DTP^FH S HD=DTP S:MEAL="A" MFLG=1
"RTN","FHDCR1A",5,0)
 S DTP=D1 D DTP^FH S (MDT,MEALDT)=DTP,MEALDT=$J("",62-$L(MEALDT)\2)_MEALDT
"RTN","FHDCR1A",6,0)
 S FHBOT=$P($G(^FH(119.9,1,4)),"^",1)
"RTN","FHDCR1A",7,0)
 S FHD1=D1-.00001,FHD2=D1+.99999
"RTN","FHDCR1A",8,0)
 S FHDFNSAV="",FHW1SAV=W1,FHFHPSAV=FHP,FHMEALSA=MEAL
"RTN","FHDCR1A",9,0)
 S:$G(FHDFN) FHDFNSAV=FHDFN
"RTN","FHDCR1A",10,0)
 I $G(DFN),'$D(^DPT(DFN,.1)) G OUTALL
"RTN","FHDCR1A",11,0)
 I '$G(DFN),$G(FHDFN) G OUTALL
"RTN","FHDCR1A",12,0)
 ;next process inpatient data
"RTN","FHDCR1A",13,0)
DFN I $G(DFN),$G(FHDFN) D  Q
"RTN","FHDCR1A",14,0)
 .S ADM=+$G(^DPT(DFN,.105)),W1=+$P($G(^FHPT(FHDFN,"A",+ADM,0)),"^",8)
"RTN","FHDCR1A",15,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24),RM=$G(^DPT(DFN,.101))
"RTN","FHDCR1A",16,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",17,0)
 .K PP,S,MM S NBR=0
"RTN","FHDCR1A",18,0)
 .I 'TPP D BLD^FHDCR11 D:NBR UPD,PRT^FHDCR1C Q
"RTN","FHDCR1A",19,0)
 .I 'MFLG D BLD^FHDCR1D D:NBR UPD,PRT^FHMTK1C Q
"RTN","FHDCR1A",20,0)
 .F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",21,0)
 .D UPD
"RTN","FHDCR1A",22,0)
 .D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",23,0)
 ;if ward, do specific ward/location;otherwise, do all entry for all
"RTN","FHDCR1A",24,0)
 ;wards/locations and all communication offices.
"RTN","FHDCR1A",25,0)
WARD I W1 S ^TMP($J,"W","01"_$P($G(^FH(119.6,+W1,0)),"^",1))=W1_"^"_$P($G(^FH(119.6,+W1,0)),"^",5,6)_"^"_$P($G(^FH(119.6,+W1,0)),"^",24)
"RTN","FHDCR1A",26,0)
 E  F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D
"RTN","FHDCR1A",27,0)
 .S P0=$G(^FH(119.6,W1,0)),WRDN=$P(P0,"^",1),SP=$P(P0,"^",5,6),D2=$P(P0,"^",8),FHPAR=$P(P0,"^",24),P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHDCR1A",28,0)
 .I FHP,D2'=FHP Q
"RTN","FHDCR1A",29,0)
 .S ^TMP($J,"W",P0_WRDN)=W1_"^"_SP_"^"_FHPAR Q
"RTN","FHDCR1A",30,0)
 S NX="" F  S NX=$O(^TMP($J,"W",NX)) Q:NX=""  S X1=$G(^(NX)),W1=+X1,FHS=$P(X1,"^",2),SP1=$P(X1,"^",3),FHPAR=$P(X1,"^",4),WRDN=$E(NX,3,99) S:'FHS&(FHPAR="Y") FHS=SP1 I FHS K ^TMP($J,"D") D
"RTN","FHDCR1A",31,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",32,0)
 ..D PATNAME^FHOMUTL Q:'$G(DFN)
"RTN","FHDCR1A",33,0)
 ..S ADM=$G(^FHPT("AW",W1,FHDFN))
"RTN","FHDCR1A",34,0)
 ..I SORT="A" S RM=$P($G(^DPT(DFN,0)),"^",1),DL=0,RMB=$G(^DPT(DFN,.101)) S:RMB="" RMB="***"
"RTN","FHDCR1A",35,0)
 ..E  S RI=$G(^DPT(DFN,.108)),RM=$G(^DPT(DFN,.101)) S:RM="" RM="***" S:RI RE=$O(^FH(119.6,"AR",+RI,W1,0)) S:'RI RE="" S DL=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:""),RMB=""
"RTN","FHDCR1A",36,0)
 ..S DL=$S(DL<1:99,DL<10:"0"_DL,1:DL)
"RTN","FHDCR1A",37,0)
 ..S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":DFN,1:RMB))=DFN_"^"_ADM_"^"_FHDFN Q
"RTN","FHDCR1A",38,0)
 .;
"RTN","FHDCR1A",39,0)
 .K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S DFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",40,0)
 ..S FHDFN=$P(FHX6,"^",3)
"RTN","FHDCR1A",41,0)
 ..S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",42,0)
 ..I TPP D  Q
"RTN","FHDCR1A",43,0)
 ...I 'MFLG D BLD^FHDCR1D,UPD Q
"RTN","FHDCR1A",44,0)
 ...F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",45,0)
 ...D UPD
"RTN","FHDCR1A",46,0)
 ...Q
"RTN","FHDCR1A",47,0)
 ..I 'TPP D BLD^FHDCR11 D UPD Q
"RTN","FHDCR1A",48,0)
 .I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",49,0)
 .D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",50,0)
 ;
"RTN","FHDCR1A",51,0)
OUTALL K ^TMP($J,"D")   ;reset/clean-up tmp global outpatient process.
"RTN","FHDCR1A",52,0)
 ;process outpatient data
"RTN","FHDCR1A",53,0)
 ;next recurring
"RTN","FHDCR1A",54,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>FHD2)  D
"RTN","FHDCR1A",55,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",56,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHDCR1A",57,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHDCR1A",58,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",59,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHDCR1A",60,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,7)
"RTN","FHDCR1A",61,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,8)
"RTN","FHDCR1A",62,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,9)
"RTN","FHDCR1A",63,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,10)
"RTN","FHDCR1A",64,0)
 ...S:FHDIET="" FHDIET=$P(FHKDAT,U,11)
"RTN","FHDCR1A",65,0)
 ...I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",66,0)
 ...I FHSTAT="C" Q
"RTN","FHDCR1A",67,0)
 ...I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",68,0)
 ...I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",69,0)
 ...S FHLOC="",FHRGS="OP"
"RTN","FHDCR1A",70,0)
 ...Q:'$G(FHW1)
"RTN","FHDCR1A",71,0)
 ...S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",72,0)
 ...I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",73,0)
 ...S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",74,0)
 ...I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",75,0)
 ...I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",76,0)
 ...D OUTW
"RTN","FHDCR1A",77,0)
 ;next guest
"RTN","FHDCR1A",78,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",79,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",80,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHDCR1A",81,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHDCR1A",82,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",83,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",84,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",85,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",86,0)
 ..S FHLOC="",FHRGS="GM"
"RTN","FHDCR1A",87,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",88,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",89,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",90,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",91,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",92,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",93,0)
 ..D OUTW
"RTN","FHDCR1A",94,0)
 ;next SPECIAL
"RTN","FHDCR1A",95,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",96,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",97,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHDCR1A",98,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",99,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",100,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHDCR1A",101,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",102,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",103,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",104,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",105,0)
 ..S FHLOC="",FHRGS="SM"
"RTN","FHDCR1A",106,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",107,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",108,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",109,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",110,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",111,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",112,0)
 ..D OUTW
"RTN","FHDCR1A",113,0)
 ;
"RTN","FHDCR1A",114,0)
 K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S FHDFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",115,0)
 .S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",116,0)
 .S FHDFN=$P(FHX6,"^",1),FHRGS=$P(FHX6,"^",2)
"RTN","FHDCR1A",117,0)
 .D PATNAME^FHOMUTL
"RTN","FHDCR1A",118,0)
 .S FHKD=$P(FHX6,"^",3),W1=$P(FHX6,"^",4)
"RTN","FHDCR1A",119,0)
 .Q:$G(FHRGS)!('$G(FHKD))
"RTN","FHDCR1A",120,0)
 .S RM="***",FHSTAT=""
"RTN","FHDCR1A",121,0)
 .S FHKDAT=$G(^FHPT(FHDFN,""_FHRGS_"",FHKD,0))
"RTN","FHDCR1A",122,0)
 .I FHRGS="GM" S W1=$P(FHKDAT,U,5),FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",123,0)
 .I FHRGS="OP" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHDCR1A",124,0)
 .I FHRGS="SM" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHDCR1A",125,0)
 .;don't process IF STATUS IS cancelled or denied
"RTN","FHDCR1A",126,0)
 .I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",127,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",128,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",129,0)
 .I TPP D  Q
"RTN","FHDCR1A",130,0)
 ..I 'MFLG,'ADM D OUT^FHDCR1D,@FHRGS Q
"RTN","FHDCR1A",131,0)
 ..F MEAL="B","N","E" D:'ADM OUT^FHDCR1D
"RTN","FHDCR1A",132,0)
 ..D:'ADM @FHRGS
"RTN","FHDCR1A",133,0)
 .I 'TPP,'ADM D OUT^FHDCR11 D @FHRGS Q
"RTN","FHDCR1A",134,0)
 I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",135,0)
 D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",136,0)
 Q
"RTN","FHDCR1A",137,0)
 ;
"RTN","FHDCR1A",138,0)
UPD ; Update Date/Time Diet Card was Printed
"RTN","FHDCR1A",139,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",16)=TIM Q
"RTN","FHDCR1A",140,0)
OUTP ;process outpatient using patient
"RTN","FHDCR1A",141,0)
 S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",142,0)
 I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",143,0)
 K PP,S,MM S NBR=0,RM="***"
"RTN","FHDCR1A",144,0)
 I 'TPP D OUT^FHDCR11 D:NBR @FHRGS,PRT^FHDCR1C Q
"RTN","FHDCR1A",145,0)
 I 'MFLG D OUT^FHDCR1D D:NBR @FHRGS,PRT^FHMTK1C Q
"RTN","FHDCR1A",146,0)
 F MEAL="B","N","E" D OUT^FHDCR1D
"RTN","FHDCR1A",147,0)
 D @FHRGS
"RTN","FHDCR1A",148,0)
 D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",149,0)
 Q
"RTN","FHDCR1A",150,0)
OP S $P(^FHPT(FHDFN,"OP",FHKD,0),"^",14)=TIM Q
"RTN","FHDCR1A",151,0)
GM S $P(^FHPT(FHDFN,"GM",FHKD,0),"^",8)=TIM Q
"RTN","FHDCR1A",152,0)
SM S $P(^FHPT(FHDFN,"SM",FHKD,0),"^",11)=TIM Q
"RTN","FHDCR1A",153,0)
 ;
"RTN","FHDCR1A",154,0)
OUTW ;process outpatient using all and ward.
"RTN","FHDCR1A",155,0)
 ;F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",156,0)
 D PATNAME^FHOMUTL
"RTN","FHDCR1A",157,0)
 I SORT="A" S RM=FHPTNM,DL=0,RMB="***"
"RTN","FHDCR1A",158,0)
 E  S (RI,RM,RE,RMB,DL)="***"
"RTN","FHDCR1A",159,0)
 S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":FHDFN,1:RMB)_FHMEAL)=FHDFN_"^"_FHRGS_"^"_FHKD_"^"_W1
"RTN","FHDCR1A",160,0)
 Q
"RTN","FHDMP")
0^6^B21472376
"RTN","FHDMP",1,0)
FHDMP ; HISC/REL/NCA/JH/RK/FAI - Patient Data Log ;10/19/04  13:26
"RTN","FHDMP",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHDMP",3,0)
BEGIN S ADM="",FHALL=1 D ^FHOMDPA
"RTN","FHDMP",4,0)
 G:'FHDFN CLEAN
"RTN","FHDMP",5,0)
 I $O(^FHPT(FHDFN,"A",0))<1 W !!,"NO ADMISSIONS ON FILE!" G OMDATE
"RTN","FHDMP",6,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="Q",DA=FHDFN,X="??" D ^DIC
"RTN","FHDMP",7,0)
 S WARD="" I $G(DFN)'="" S WARD=$G(^DPT(DFN,.1))
"RTN","FHDMP",8,0)
 K ADM
"RTN","FHDMP",9,0)
A0 W !!,"Select ADMISSION or RETURN for OUTPATIENT ",$S(WARD'="":" (or C for CURRENT)",1:""),": " R X:DTIME G:X["^" KIL D:X="c" TR^FH
"RTN","FHDMP",10,0)
 I (X="")&'($D(^FHPT(FHDFN,"RM"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) W !!,"NO OUTPATIENT DATA ON FILE!" G FHDMP
"RTN","FHDMP",11,0)
 I (X="")&($D(^FHPT(FHDFN,"RM"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) G OMDATE
"RTN","FHDMP",12,0)
 I WARD'="",X="C" S ADM=$G(^DPT("CN",WARD,DFN)) G CAD:ADM
"RTN","FHDMP",13,0)
 S DIC="^FHPT(FHDFN,""A"",",DIC(0)="EQM" D ^DIC G:Y<1 A0 S ADM=+Y
"RTN","FHDMP",14,0)
CAD I ADM,$G(^FHPT(FHDFN,"A",ADM,0)) S (SDT,STDT)=$P(^FHPT(FHDFN,"A",ADM,0),U,1),ENDT=DT G P0:SDT
"RTN","FHDMP",15,0)
 ;
"RTN","FHDMP",16,0)
OMDATE I '($D(^FHPT(FHDFN,"RM"))!$D(^FHPT(FHDFN,"GM"))!$D(^FHPT(FHDFN,"SM"))) W !!,"NO OUTPATIENT DATA ON FILE!" G FHDMP
"RTN","FHDMP",17,0)
 W !!,"This report will also display any existing outpatient meals data."
"RTN","FHDMP",18,0)
 W !,"Enter the Start Date and End Date for outpatient data.",!
"RTN","FHDMP",19,0)
 D STDATE^FHOMUTL S SDT=STDT I STDT="" Q
"RTN","FHDMP",20,0)
 S X="T+30" D ^%DT S ENDT=Y
"RTN","FHDMP",21,0)
 D DD^%DT S FHDTDF=Y K DIR
"RTN","FHDMP",22,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT
"RTN","FHDMP",23,0)
 D ^DIR
"RTN","FHDMP",24,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHDMP",25,0)
 D P0
"RTN","FHDMP",26,0)
 Q
"RTN","FHDMP",27,0)
P0 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHDMP",28,0)
 I $D(IO("Q")) S FHPGM="INOUT^FHDMP",FHLST="ADM^FHDFN^DFN^IEN200^PID^OPSD^STDT^ENDT^SDT" D EN2^FH G KIL
"RTN","FHDMP",29,0)
 U IO D INOUT D ^%ZISC K %ZIS,IOP G FHDMP
"RTN","FHDMP",30,0)
 Q
"RTN","FHDMP",31,0)
INOUT D F0
"RTN","FHDMP",32,0)
 Q:QT="^"  I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",33,0)
 Q:$G(ADM)
"RTN","FHDMP",34,0)
 W:QT'="^" !,LN,!,?15,"*** O U T P A T I E N T   M E A L   D A T A ***"
"RTN","FHDMP",35,0)
 Q:QT="^"  D DISP^FHOMRMD I EX=U Q
"RTN","FHDMP",36,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",37,0)
 Q:QT="^"  D ^FHDPSM I EX=U Q
"RTN","FHDMP",38,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDMP",39,0)
 Q:QT="^"  D ^FHDPGM I EX=U Q
"RTN","FHDMP",40,0)
CLEAN G KILL^XUSCLEAN
"RTN","FHDMP",41,0)
F0 D NOW^%DTC S DT=%\1,DTP=% D DTP^FH S NOW=DTP,S1=$S(IOST?1"C".E:IOSL,1:IOSL-6)
"RTN","FHDMP",42,0)
 D PATNAME^FHOMUTL
"RTN","FHDMP",43,0)
 ;S Y(0)=^DPT(DFN,0)
"RTN","FHDMP",44,0)
 S NAM=FHPTNM,SEX=FHSEX,DOB=FHDOB,PID=$G(PID),AGE=FHAGE,PG=0,QT=""
"RTN","FHDMP",45,0)
 S PRTFM=STDT_" TO  "_ENDT
"RTN","FHDMP",46,0)
 S DTP=STDT D DTP^FH S SDT1=DTP
"RTN","FHDMP",47,0)
 S DTP=ENDT D DTP^FH S EDT1=DTP
"RTN","FHDMP",48,0)
 S PRTFM=SDT1_"  TO  "_EDT1
"RTN","FHDMP",49,0)
 S LN="",$P(LN,"-",80)=""
"RTN","FHDMP",50,0)
 D HDR
"RTN","FHDMP",51,0)
 D ALG^FHCLN W !!,"Allergies: " S ALG=$S(ALG="":"None on file",1:ALG) D LNE
"RTN","FHDMP",52,0)
 W !!,"Food Preferences Currently on file:",!!?26,"Likes",?58,"Dislikes",!
"RTN","FHDMP",53,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0) D SP
"RTN","FHDMP",54,0)
 W ! S (M1,MM)="",L=0 F  S M1=$O(N(M1)) Q:M1=""  I $D(N(M1)) W $P(M1,"~",2) D  S MM=M1
"RTN","FHDMP",55,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M1,"L",P1)) S X1=$S(P1>0:N(M1,"L",P1),1:"") S:P2'="" P2=$O(N(M1,"D",P2)) S X2=$S(P2>0:N(M1,"D",P2),1:"") Q:P1=""&(P2="")  D W0 W:MM'=M1 !
"RTN","FHDMP",56,0)
 .  Q
"RTN","FHDMP",57,0)
 I $O(N(""))="" W !!,"No Food Preferences on file",! D ^FHDMP1 Q
"RTN","FHDMP",58,0)
 W ! K L,N,M,M1,M2 D ^FHDMP1 Q
"RTN","FHDMP",59,0)
W0 I X1'="" W ?12 S X=X1 D W1 S X1=X
"RTN","FHDMP",60,0)
 I X2'="" W ?46 S X=X2 D W1 S X2=X
"RTN","FHDMP",61,0)
 Q:X1=""&(X2="")  S:$Y'<S1 L=1 D:$Y'<S1 HDR G:QT="^" KIL W ! W:L ! S L=0 G W0
"RTN","FHDMP",62,0)
W1 I $L(X)<34 W X S X="" Q
"RTN","FHDMP",63,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHDMP",64,0)
 W $E(X,1,KK-2) S X=$E(X,KK+1,999) Q
"RTN","FHDMP",65,0)
SP S M=$P(X,"^",2) S:M="A" M="BNE" S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHDMP",66,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHDMP",67,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHDMP",68,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHDMP",69,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHDMP",70,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHDMP",71,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHDMP",72,0)
 Q
"RTN","FHDMP",73,0)
LNE ; Break Line if longer than 65 chars
"RTN","FHDMP",74,0)
 I $L(ALG)<66 W ALG Q
"RTN","FHDMP",75,0)
 F L=67:-1:1 Q:$E(ALG,L-1,L)=", "
"RTN","FHDMP",76,0)
 W $E(ALG,1,L-2)
"RTN","FHDMP",77,0)
 S ALG=$E(ALG,L+1,999)
"RTN","FHDMP",78,0)
 Q:ALG=""  W !?11
"RTN","FHDMP",79,0)
 G LNE
"RTN","FHDMP",80,0)
HDR ; Print Header
"RTN","FHDMP",81,0)
 S (EX,QT)="" I PG,IOST?1"C".E W:$X>1 ! W *7 R QT:DTIME S:'$T QT="^" Q:QT="^"
"RTN","FHDMP",82,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHDMP",83,0)
 W !,?15,"P  A  T  I  E  N  T     D  A  T  A     L  O  G",!
"RTN","FHDMP",84,0)
 W !,"Date Range:  ",PRTFM,?62,NOW,!!,PID,?17,NAM,?49,$S(SEX="M":"Male",SEX="F":"Female",1:""),?58,"Age ",AGE,?72,"Page ",PG Q
"RTN","FHDMP",85,0)
DTP ; Printable Date/Time
"RTN","FHDMP",86,0)
 Q:Y<1  W $J(+$E(Y,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(Y,4,5))_"-"_$E(Y,2,3)
"RTN","FHDMP",87,0)
 I Y["." S %=+$E(Y_"0",9,10) W $J($S(%>12:%-12,1:%),3)_":"_$E(Y_"000",11,12)_$S(%<12:"am",%<24:"pm",1:"m")
"RTN","FHDMP",88,0)
 K % Q
"RTN","FHDMP",89,0)
KIL ; User exit
"RTN","FHDMP",90,0)
 Q
"RTN","FHDMP4")
0^7^B11891881
"RTN","FHDMP4",1,0)
FHDMP4 ; HISC/REL/NCA - Patient Data Log (cont) ;5/7/92  15:36 
"RTN","FHDMP4",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHDMP4",3,0)
 S LST=1 D:$Y>(S1-4) HDR^FHDMP G:QT="^" KIL^FHDMP W !,LN,!?28,"T U B E F E E D I N G S"
"RTN","FHDMP4",4,0)
 I SDT F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"TF",K)) Q:K<1  S D1=$P(^(K,0),"^",1) Q:D1=""!(D1'<SDT)  S LST=K
"RTN","FHDMP4",5,0)
 S CT=0 F TF=LST-1:0 S TF=$O(^FHPT(FHDFN,"A",ADM,"TF",TF)) Q:TF<1  I $D(^(TF,0)) S X=^(0) D TF G:QT="^" KIL^FHDMP
"RTN","FHDMP4",6,0)
 I 'CT W !!,"No Tubefeedings ordered for this Admission"
"RTN","FHDMP4",7,0)
 W !
"RTN","FHDMP4",8,0)
 D:$Y>(S1-4) HDR^FHDMP G:QT="^" KIL^FHDMP W !,LN,!?23,"D I E T E T I C   C O N S U L T S"
"RTN","FHDMP4",9,0)
 S CT=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"DR",K)) Q:K<1  I $D(^(K,0)) S X=^(0) I $P(X,"^",1)'<SDT S CT=CT+1 D:$Y>(S1-6) HDR^FHDMP G:QT="^" KIL^FHDMP D CD
"RTN","FHDMP4",10,0)
 I 'CT W !!,"No Consultations ordered for this Admission"
"RTN","FHDMP4",11,0)
 W !
"RTN","FHDMP4",12,0)
 D:$Y>(S1-4) HDR^FHDMP G:QT="^" KIL^FHDMP W !,LN,!?24,"E A R L Y / L A T E   T R A Y S"
"RTN","FHDMP4",13,0)
 S CT=0 F K=SDT:0 S K=$O(^FHPT(FHDFN,"A",ADM,"EL",K)) Q:K<1  S X=^(K,0),CT=CT+1 D:$Y>(S1-4) HDR^FHDMP G:QT="^" KIL^FHDMP D EL
"RTN","FHDMP4",14,0)
 I 'CT W !!,"No Early or Late Trays ordered for this Admission"
"RTN","FHDMP4",15,0)
 W ! G ^FHDMP5
"RTN","FHDMP4",16,0)
TF W !!,"Order # ",TF S CT=CT+1
"RTN","FHDMP4",17,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S X1=^(TF2,0) D:$Y>(S1-8) HDR^FHDMP Q:QT="^"  D TF1
"RTN","FHDMP4",18,0)
 Q:QT="^"  W !,"Daily ML's:   ",$P(X,"^",3),?42,"Daily KCals: ",$P(X,"^",7)
"RTN","FHDMP4",19,0)
 S Y=$P(X,"^",5) W:Y'="" !,"Comment:      ",Y
"RTN","FHDMP4",20,0)
 S Y=$P(X,"^",1) W !,"Ordered:      " D DTP S Y=$P(X,"^",10) W ?42,"By: ",$P($G(^VA(200,+Y,0)),"^",1)
"RTN","FHDMP4",21,0)
 S Y=$P(X,"^",11) W !,"Cancelled:    " D DTP S Y=$P(X,"^",12) W ?42,"By: ",$P($G(^VA(200,+Y,0)),"^",1) Q
"RTN","FHDMP4",22,0)
TF1 S Y=$P(X1,"^",1) W !,"Product: ",$P($G(^FH(118.2,+Y,0)),"^",1),", "
"RTN","FHDMP4",23,0)
 S Y=$P(X1,"^",2) W $S(Y=4:"Full",Y=1:"1/4",Y=2:"1/2",1:"3/4")," Str., "
"RTN","FHDMP4",24,0)
 S FHTUBML=$P(X1,"^",3)
"RTN","FHDMP4",25,0)
 I FHTUBML["CC" S QUAFI=$P(FHTUBML,"CC",1),QUASE=$P(FHTUBML,"CC",2),FHTUBML=QUAFI_"ML"_QUASE
"RTN","FHDMP4",26,0)
 W FHTUBML
"RTN","FHDMP4",27,0)
 W !,"Product ML's: ",$P(X1,"^",4),?42,"Water ML's:  ",$P(X1,"^",5) Q
"RTN","FHDMP4",28,0)
CD S Y=$P(X,"^",2) W !!,"Request:   ",$P($G(^FH(119.5,+Y,0)),"^",1)
"RTN","FHDMP4",29,0)
 S Y=$P(X,"^",8) W ?62,"Status: ",$S(Y="A":"Active",Y="C":"Complete",Y="X":"Cancelled",1:"")
"RTN","FHDMP4",30,0)
 S Y=$P(X,"^",3) I Y'="" W !,"Comment:   ",Y
"RTN","FHDMP4",31,0)
 S Y=$P(X,"^",5) W !,"Clinician: ",$P($G(^VA(200,+Y,0)),"^",1)
"RTN","FHDMP4",32,0)
 S Y=$P(X,"^",11) W ?62,"Type:   ",$S(Y="I":"Initial",Y="F":"Follow-up",1:"")
"RTN","FHDMP4",33,0)
 S Y=$P(X,"^",1) W !,"Ordered:   " D DTP S Y=$P(X,"^",7) W ?45,"By: ",$P($G(^VA(200,+Y,0)),"^",1)
"RTN","FHDMP4",34,0)
 S Y=$P(X,"^",9) W !,"Cleared:   " D DTP S Y=$P(X,"^",10) W ?45,"By: ",$P($G(^VA(200,+Y,0)),"^",1) Q
"RTN","FHDMP4",35,0)
EL S Y=$P(X,"^",1) W !!,"Order:   " D DTP S Y=$P(X,"^",2) W ?28,"Meal: ",$S(Y="B":"Breakfast",Y="N":"Noon",Y="E":"Evening",1:"")
"RTN","FHDMP4",36,0)
 S Y=$P(X,"^",4) W ?47,"Bagged: ",$S(Y="Y":"Yes",Y="N":"No",1:"") W ?62,"Time: ",$P(X,"^",3)
"RTN","FHDMP4",37,0)
 S Y=$P(X,"^",6) W !,"Ordered: " D DTP S Y=$P(X,"^",5) W ?28,"By:   ",$P($G(^VA(200,+Y,0)),"^",1) Q
"RTN","FHDMP4",38,0)
DTP ; Printable Date/Time
"RTN","FHDMP4",39,0)
 Q:Y<1  W $J(+$E(Y,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(Y,4,5))_"-"_$E(Y,2,3)
"RTN","FHDMP4",40,0)
 I Y["." S %=+$E(Y_"0",9,10) W $J($S(%>12:%-12,1:%),3)_":"_$E(Y_"000",11,12)_$S(%<12:"am",%<24:"pm",1:"m")
"RTN","FHDMP4",41,0)
 K % Q
"RTN","FHOMPP1")
0^8^B23129471
"RTN","FHOMPP1",1,0)
FHOMPP1 ;Hines OIFO/RTK Patient Profile for CPRS (continued)  ;6/07/04  9:05
"RTN","FHOMPP1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMPP1",3,0)
 ;
"RTN","FHOMPP1",4,0)
 S FHB="" F I=1:1:80 S FHB=FHB_" "
"RTN","FHOMPP1",5,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMPP1",6,0)
 I '$O(^FHPT(FHDFN,"OP","B",STDT)) S N=1 D NEWL^FHOMPP S ^TMP($J,"FHPROF",DFN,FHX)="No Recurring Meals to Display" Q
"RTN","FHOMPP1",7,0)
 K FHLIST S EX="",NUM=0 D HDR
"RTN","FHOMPP1",8,0)
 F FHRMDT=STDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(EX=U)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0!(EX=U)  D
"RTN","FHOMPP1",9,0)
 .S NUM=NUM+1,FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMPP1",10,0)
 .S FHRM=$P(FHNODE,U,1)
"RTN","FHOMPP1",11,0)
 .S FHDOW=$$DOW^XLFDT(FHRM),FHDOW=$E(FHDOW,1,3)
"RTN","FHOMPP1",12,0)
 .S FHDTP=$$FMTE^XLFDT(FHRM,"P") S N=0 D NEWL^FHOMPP S ^TMP($J,"FHPROF",DFN,FHX)=NUM S FHJ=7 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_FHDOW_" - "_$E(FHDTP,1,12)
"RTN","FHOMPP1",13,0)
 .S FHLPT=$P(FHNODE,U,3),FHLOCZN=$G(^FH(119.6,FHLPT,0)) D
"RTN","FHOMPP1",14,0)
 ..S FHLOC=$E($P(FHLOCZN,U,1),1,10),FHSERV=$P(FHLOCZN,U,10)
"RTN","FHOMPP1",15,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLOCZN,U,5),FHSERV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMPP1",16,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMPP1",17,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMPP1",18,0)
 ..Q
"RTN","FHOMPP1",19,0)
 .S FHJ=27 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_FHLOC
"RTN","FHOMPP1",20,0)
 .S FHJ=39 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_$E(FHSRVPT,1,9)
"RTN","FHOMPP1",21,0)
 .S FHJ=52 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_$P(FHNODE,U,4)
"RTN","FHOMPP1",22,0)
 .S FHJ=57 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_$P(FHNODE,U,5)
"RTN","FHOMPP1",23,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)="Y" D DIETPAT S FHJ=61 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_$E(FHDIETP,1,12)
"RTN","FHOMPP1",24,0)
 .E  S FHDPTR=$P(FHNODE,U,2) S FHJ=61 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_$E($P($G(^FH(111,FHDPTR,0)),U,1),1,12)
"RTN","FHOMPP1",25,0)
 .S FHSTAT=$P(FHNODE,U,15) I FHSTAT="C" S FHJ=77 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_"C"
"RTN","FHOMPP1",26,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D
"RTN","FHOMPP1",27,0)
 ..S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",28,0)
 ..S FHNODE1=$G(^FHPT(FHDFN,"OP",FHRNUM,1))
"RTN","FHOMPP1",29,0)
 ..S FHSTATA=$P(FHNODE1,U,5) I FHSTATA="C" S ^TMP($J,"FHPROF",DFN,FHX)="        Additional Orders: "_$E($P(FHNODE1,U,1),1,46) S FHJ=77 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_"C" Q
"RTN","FHOMPP1",30,0)
 ..S ^TMP($J,"FHPROF",DFN,FHX)="        Additional Orders: "_$P(FHNODE1,U,1)
"RTN","FHOMPP1",31,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHOMPP1",32,0)
 ..S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",33,0)
 ..S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMPP1",34,0)
 ..S FHEL=FHNODE2
"RTN","FHOMPP1",35,0)
 ..S ^TMP($J,"FHPROF",DFN,FHX)="        Early/Late Tray Time: "_$P(FHEL,U,1)_"  Bagged Meal: "_$P(FHEL,U,2)
"RTN","FHOMPP1",36,0)
 ..S FHSTATE=$P(FHNODE2,U,6) I FHSTATE="C" S FHJ=77 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_"C" Q
"RTN","FHOMPP1",37,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHOMPP1",38,0)
 ..S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",39,0)
 ..S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3))
"RTN","FHOMPP1",40,0)
 ..S FHTU=FHNODE3
"RTN","FHOMPP1",41,0)
 ..S ^TMP($J,"FHPROF",DFN,FHX)="        Tubefeeding: " S FHSTATT=$P(FHTU,U,5) I FHSTATT="C" S FHJ=77 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_"C"
"RTN","FHOMPP1",42,0)
 ..S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",43,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMPP1",44,0)
 ...S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ,0))
"RTN","FHOMPP1",45,0)
 ...S FHTUPTR=$P(FHTUZN,U,1),FHTUSTR=$P(FHTUZN,U,2)
"RTN","FHOMPP1",46,0)
 ...I $P(FHTUZN,U,3)["CC" D
"RTN","FHOMPP1",47,0)
 ....S QUA=$P(FHTUZN,U,3)
"RTN","FHOMPP1",48,0)
 ....S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2)
"RTN","FHOMPP1",49,0)
 ....S $P(FHTUZN,U,3)=QUAFI_"ML"_QUASE
"RTN","FHOMPP1",50,0)
 ...S ^TMP($J,"FHPROF",DFN,FHX)="          "_$P($G(^FH(118.2,FHTUPTR,0)),U,1)_"  Strength: "_$S(FHTUSTR=1:"1/4",FHTUSTR=2:"1/2",FHTUSTR=3:"3/4",1:"FULL")_"  Quantity: "_$P(FHTUZN,U,3)
"RTN","FHOMPP1",51,0)
 ...S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",52,0)
 ...S ^TMP($J,"FHPROF",DFN,FHX)="          Total ML's: "_$P(FHTU,U,2)_"  Total KCALS/DAY: "_$P(FHTU,U,3)
"RTN","FHOMPP1",53,0)
 ..S FHTCOMM=$P(FHTU,U,1) I FHTCOMM'="" S N=0 D NEWL^FHOMPP S ^TMP($J,"FHPROF",DFN,FHX)="Comment: "_FHTCOMM
"RTN","FHOMPP1",54,0)
 .Q
"RTN","FHOMPP1",55,0)
 Q
"RTN","FHOMPP1",56,0)
DIETPAT ;
"RTN","FHOMPP1",57,0)
 S FHDIETS=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,7,11)
"RTN","FHOMPP1",58,0)
 S FHDIETP=""
"RTN","FHOMPP1",59,0)
 F PCE=1:1:5 D
"RTN","FHOMPP1",60,0)
 .S FHDPTR=$P(FHDIETS,U,PCE) I FHDPTR="" Q
"RTN","FHOMPP1",61,0)
 .S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,7)
"RTN","FHOMPP1",62,0)
 .I FHDNM="" S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,1)
"RTN","FHOMPP1",63,0)
 .S FHDIETP=FHDIETP_FHDNM_"," Q
"RTN","FHOMPP1",64,0)
 S FHDIETP=$E(FHDIETP,1,$L(FHDIETP)-1)
"RTN","FHOMPP1",65,0)
 Q
"RTN","FHOMPP1",66,0)
HDR ;
"RTN","FHOMPP1",67,0)
 ;S ^TMP($J,"FHPROF",DFN,FHX)="   OUTPATIENT NAME: " D PATNAME^FHOMUTL S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_FHPTNM_"   "_FHSSN
"RTN","FHOMPP1",68,0)
 ;S FHJ=66 D PAD S ^TMP($J,"FHPROF",DFN,FHX)=^TMP($J,"FHPROF",DFN,FHX)_PAD_FHSEX_" Age "_FHAGE
"RTN","FHOMPP1",69,0)
 S N=1 D NEWL^FHOMPP
"RTN","FHOMPP1",70,0)
 S ^TMP($J,"FHPROF",DFN,FHX)="                          Ordering   Service"
"RTN","FHOMPP1",71,0)
 S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",72,0)
 S ^TMP($J,"FHPROF",DFN,FHX)=" #   Date/Time            Location   Point       Meal Bag  Diet Ordered  Status"
"RTN","FHOMPP1",73,0)
 S N=0 D NEWL^FHOMPP
"RTN","FHOMPP1",74,0)
 S ^TMP($J,"FHPROF",DFN,FHX)="===  ==================  ==========  ==========  ==== ===  ============  ======"
"RTN","FHOMPP1",75,0)
 Q
"RTN","FHOMPP1",76,0)
PAD ;
"RTN","FHOMPP1",77,0)
 S FHU=^TMP($J,"FHPROF",DFN,FHX),A=$L(FHU),PAD=$E(FHB,1,FHJ-A)
"RTN","FHOMPP1",78,0)
 Q
"RTN","FHOMPP1",79,0)
END ;
"RTN","FHOMPP1",80,0)
 K EX,FHDIET,FHDIETP,FHDIETS,FHDTP,FHFIND,FHLOC,FHLPT,FHNODE,FHRM
"RTN","FHOMPP1",81,0)
 K FHRNUM,FHDPTR,FHDNM Q
"RTN","FHOMRL1")
0^28^B11581637
"RTN","FHOMRL1",1,0)
FHOMRL1 ;Hines OIFO/RTK OUTPATIENT MEALS RECURRING MEALS LIST  ;1/25/05  11:35
"RTN","FHOMRL1",2,0)
 ;;5.5;DIETETICS;**1**;Dec 22, 2004
"RTN","FHOMRL1",3,0)
 ;
"RTN","FHOMRL1",4,0)
 W @IOF,!!?20,"R E C U R R I N G   M E A L S   L I S T"
"RTN","FHOMRL1",5,0)
START S (EX,FHSELOC)="",FHPG=0
"RTN","FHOMRL1",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION or ALL: "
"RTN","FHOMRL1",7,0)
 S DIR(0)="SAO^A:ALL;L:LOCATION" D ^DIR
"RTN","FHOMRL1",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMRL1",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMRL1",10,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMRL1",11,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMRL1",12,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRL1",13,0)
 D DEV,START
"RTN","FHOMRL1",14,0)
 Q
"RTN","FHOMRL1",15,0)
DEV ;get device and set up queue
"RTN","FHOMRL1",16,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMRL1",17,0)
 I '$D(IO("Q")) U IO D DISP,^%ZISC,END Q
"RTN","FHOMRL1",18,0)
 S ZTRTN="DISP^FHOMRL1"
"RTN","FHOMRL1",19,0)
 S ZTSAVE("STDT")="",ZTSAVE("STDT1")="",ZTSAVE("EX")=""
"RTN","FHOMRL1",20,0)
 S ZTSAVE("ENDT")="",ZTSAVE("FHDFN")="",ZTSAVE("FHPG")=""
"RTN","FHOMRL1",21,0)
 S ZTSAVE("FHLBY")="",ZTSAVE("FHSELOC")=""
"RTN","FHOMRL1",22,0)
 S ZTDESC="Outpatient Meals Recurring Meals List" D ^%ZTLOAD
"RTN","FHOMRL1",23,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMRL1",24,0)
 D END Q
"RTN","FHOMRL1",25,0)
 Q
"RTN","FHOMRL1",26,0)
DISP ; First build data in ^TMP global
"RTN","FHOMRL1",27,0)
 K ^TMP($J)
"RTN","FHOMRL1",28,0)
 F FHXRDT=STDT1:0 S FHXRDT=$O(^FHPT("RM",FHXRDT)) Q:FHXRDT'>0!(FHXRDT>ENDT)!(EX=U)  D
"RTN","FHOMRL1",29,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHXRDT,FHDFN)) Q:FHDFN'>0!(EX=U)  D
"RTN","FHOMRL1",30,0)
 ..F FHRM=0:0 S FHRM=$O(^FHPT("RM",FHXRDT,FHDFN,FHRM)) Q:FHRM'>0!(EX=U)  D
"RTN","FHOMRL1",31,0)
 ...S FHZN=$G(^FHPT(FHDFN,"OP",FHRM,0))
"RTN","FHOMRL1",32,0)
 ...D PATNAME^FHOMUTL
"RTN","FHOMRL1",33,0)
 ...S FHLOC=$P(FHZN,U,3) I FHLBY'="A",FHSELOC'=FHLOC Q
"RTN","FHOMRL1",34,0)
 ...S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMRL1",35,0)
 ...S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMRL1",36,0)
 ...S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMRL1",37,0)
 ...S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHXRDT,FHPTNM_"~"_FHRM_"~"_FHDFN)=FHZN
"RTN","FHOMRL1",38,0)
 ...Q
"RTN","FHOMRL1",39,0)
 ..Q
"RTN","FHOMRL1",40,0)
 .Q
"RTN","FHOMRL1",41,0)
 ; Now display data from the ^TMP global
"RTN","FHOMRL1",42,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMRL1",43,0)
 .D:FHPG>0&(IOST?1"C".E) PG Q:EX=U
"RTN","FHOMRL1",44,0)
 .D HDR S FHPG=FHPG+1
"RTN","FHOMRL1",45,0)
 .F FHXRDT=0:0 S FHXRDT=$O(^TMP($J,FHLSRT,FHXRDT)) Q:FHXRDT'>0!(EX=U)  D
"RTN","FHOMRL1",46,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHXRDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMRL1",47,0)
 ...S FHZN=$G(^TMP($J,FHLSRT,FHXRDT,FHPTN)),FHLOC=$P(FHZN,U,3)
"RTN","FHOMRL1",48,0)
 ...S FHLOCZN=$G(^FH(119.6,FHLOC,0)),FHRNUM=$P(FHPTN,"~",2)
"RTN","FHOMRL1",49,0)
 ...S FHDFN=$P(FHPTN,"~",3),FHSTAT=$P(FHZN,U,15)
"RTN","FHOMRL1",50,0)
 ...W ! S DTP=FHXRDT D DTP^FH W DTP
"RTN","FHOMRL1",51,0)
 ...W ?11,$E($P(FHPTN,"~",1),1,20)
"RTN","FHOMRL1",52,0)
 ...W ?33,$P(FHZN,U,4)
"RTN","FHOMRL1",53,0)
 ...S FHSRV=$P(FHLOCZN,U,10)
"RTN","FHOMRL1",54,0)
 ...S FHSPT=$S(FHSRV["T":$P(FHLOCZN,U,5),FHSRV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRL1",55,0)
 ...S FHSRVPT="" I FHSPT'="" S FHSRVPT=$P($G(^FH(119.72,FHSPT,0)),U,1)
"RTN","FHOMRL1",56,0)
 ...W ?38,$E(FHSRVPT,1,14)
"RTN","FHOMRL1",57,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D DIETPAT^FHOMRR1 W ?54,$E(FHDIETP,1,18)
"RTN","FHOMRL1",58,0)
 ...I $P($G(^FH(119.6,FHLOC,1)),U,4)'="Y" S FHDPTR=$P(FHZN,U,2) Q:FHDPTR=""  W ?54,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,18)
"RTN","FHOMRL1",59,0)
 ...W ?76,FHSTAT
"RTN","FHOMRL1",60,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRL1",61,0)
 Q
"RTN","FHOMRL1",62,0)
PG ;
"RTN","FHOMRL1",63,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRL1",64,0)
 D HDR Q
"RTN","FHOMRL1",65,0)
HDR ;
"RTN","FHOMRL1",66,0)
 W:$Y @IOF
"RTN","FHOMRL1",67,0)
 W !?25,"R E C U R R I N G   M E A L   L I S T"
"RTN","FHOMRL1",68,0)
 W !!?5,"LOCATION: ",$P(FHLSRT,"~",2)
"RTN","FHOMRL1",69,0)
 W !!,"Date",?11,"Patient Name",?32,"Meal",?38,"Service Point"
"RTN","FHOMRL1",70,0)
 W ?54,"Diet Ordered",?74,"Status"
"RTN","FHOMRL1",71,0)
 W !,"=========",?11,"===================",?32,"===="
"RTN","FHOMRL1",72,0)
 W ?38,"==============",?54,"==================",?74,"======"
"RTN","FHOMRL1",73,0)
 Q
"RTN","FHOMRL1",74,0)
END ;
"RTN","FHOMRL1",75,0)
 K ENDT,FHXRDT,FHRM,STDT,STDT1 Q
"RTN","FHOMRMD")
0^9^B14582168
"RTN","FHOMRMD",1,0)
FHOMRMD ;Hines OIFO/RTK/FAI RECURRING MEALS REVIEW/DISPLAY  ;10/20/04  13:22
"RTN","FHOMRMD",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMRMD",3,0)
 ;
"RTN","FHOMRMD",4,0)
DISP ;
"RTN","FHOMRMD",5,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRMD",6,0)
 I '$O(^FHPT(FHDFN,"OP","B",STDT)) W !!,"No Recurring Meals to Display" Q
"RTN","FHOMRMD",7,0)
 K FHLIST S EX="",NUM=0 D HDR I $G(ENDT)="" S ENDT=9999999.99
"RTN","FHOMRMD",8,0)
 F FHRMDT=STDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)!(EX=U)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0!(EX=U)  D
"RTN","FHOMRMD",9,0)
 .S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMRMD",10,0)
 .S FHRM=$P(FHNODE,U,1)
"RTN","FHOMRMD",11,0)
 .S NUM=NUM+1,PAD=$S($L(NUM)<3:3-$L(NUM),1:1) W !?PAD,NUM
"RTN","FHOMRMD",12,0)
 .S FHLIST(NUM)=FHRNUM_"^"_FHRM
"RTN","FHOMRMD",13,0)
 .S FHDOW=$$DOW^XLFDT(FHRM),FHDOW=$E(FHDOW,1,3)
"RTN","FHOMRMD",14,0)
 .S FHDTP=$$FMTE^XLFDT(FHRM,"P") W ?6,FHDOW," - ",$E(FHDTP,1,12)
"RTN","FHOMRMD",15,0)
 .S FHLPT=$P(FHNODE,U,3),FHLOCZN=$G(^FH(119.6,FHLPT,0)) D
"RTN","FHOMRMD",16,0)
 ..S FHLOC=$E($P(FHLOCZN,U,1),1,10),FHSERV=$P(FHLOCZN,U,10)
"RTN","FHOMRMD",17,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLOCZN,U,5),FHSERV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRMD",18,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMRMD",19,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMRMD",20,0)
 ..Q
"RTN","FHOMRMD",21,0)
 .W ?26,FHLOC,?38,$E(FHSRVPT,1,9)
"RTN","FHOMRMD",22,0)
 .W ?51,$P(FHNODE,U,4),?56,$P(FHNODE,U,5)
"RTN","FHOMRMD",23,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)="Y" D DIETPAT W ?60,$E(FHDIETP,1,12)
"RTN","FHOMRMD",24,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)'="Y" S FHDPTR=$P(FHNODE,U,2) Q:FHDPTR=""  W ?60,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,12)
"RTN","FHOMRMD",25,0)
 .S FHSTAT=$P(FHNODE,U,15) I FHSTAT="C" W ?76,"C"
"RTN","FHOMRMD",26,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRMD",27,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D
"RTN","FHOMRMD",28,0)
 ..S FHNODE1=$G(^FHPT(FHDFN,"OP",FHRNUM,1))
"RTN","FHOMRMD",29,0)
 ..S FHSTATA=$P(FHNODE1,U,5) I FHSTATA="C" W !?7,"Additional Orders: ",$E($P(FHNODE1,U,1),1,46),?76,"C" Q
"RTN","FHOMRMD",30,0)
 ..W !?7,"Additional Orders: ",$P(FHNODE1,U,1)
"RTN","FHOMRMD",31,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHOMRMD",32,0)
 ..S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMRMD",33,0)
 ..S FHEL=FHNODE2
"RTN","FHOMRMD",34,0)
 ..W !?7,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMRMD",35,0)
 ..W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMRMD",36,0)
 ..S FHSTATE=$P(FHNODE2,U,6) I FHSTATE="C" W ?76,"C"
"RTN","FHOMRMD",37,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHOMRMD",38,0)
 ..S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3))
"RTN","FHOMRMD",39,0)
 ..S FHTU=FHNODE3
"RTN","FHOMRMD",40,0)
 ..W !?7,"Tubefeeding: " S FHSTATT=$P(FHTU,U,5) I FHSTATT="C" W ?76,"C"
"RTN","FHOMRMD",41,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMRMD",42,0)
 ...S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ,0))
"RTN","FHOMRMD",43,0)
 ...S FHTUPTR=$P(FHTUZN,U,1),FHTUSTR=$P(FHTUZN,U,2)
"RTN","FHOMRMD",44,0)
 ...W !?9,$P($G(^FH(118.2,FHTUPTR,0)),U,1),"  Strength: "
"RTN","FHOMRMD",45,0)
 ...W $S(FHTUSTR=1:"1/4",FHTUSTR=2:"1/2",FHTUSTR=3:"3/4",1:"FULL")
"RTN","FHOMRMD",46,0)
 ...I $P(FHTUZN,U,3)["CC" D  ;print ml instead of cc.
"RTN","FHOMRMD",47,0)
 ....S QUA=$P(FHTUZN,U,3)
"RTN","FHOMRMD",48,0)
 ....S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2)
"RTN","FHOMRMD",49,0)
 ....S $P(FHTUZN,U,3)=QUAFI_"ML"_QUASE
"RTN","FHOMRMD",50,0)
 ...W "  Quantity: ",$P(FHTUZN,U,3)
"RTN","FHOMRMD",51,0)
 ..W !?7,"Total ML's: ",$P(FHTU,U,2),"  Total KCALS/DAY: ",$P(FHTU,U,3)
"RTN","FHOMRMD",52,0)
 ..S FHTCOMM=$P(FHTU,U,1) I FHTCOMM'="" W !?7,"Comment: ",FHTCOMM
"RTN","FHOMRMD",53,0)
 .Q
"RTN","FHOMRMD",54,0)
 W ! Q
"RTN","FHOMRMD",55,0)
DIETPAT ;
"RTN","FHOMRMD",56,0)
 S FHDIETS=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,7,11)
"RTN","FHOMRMD",57,0)
 S FHDIETP=""
"RTN","FHOMRMD",58,0)
 F PCE=1:1:5 D
"RTN","FHOMRMD",59,0)
 .S FHDPTR=$P(FHDIETS,U,PCE) I FHDPTR="" Q
"RTN","FHOMRMD",60,0)
 .S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,7)
"RTN","FHOMRMD",61,0)
 .I FHDNM="" S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,1)
"RTN","FHOMRMD",62,0)
 .S FHDIETP=FHDIETP_FHDNM_"," Q
"RTN","FHOMRMD",63,0)
 S FHDIETP=$E(FHDIETP,1,$L(FHDIETP)-1)
"RTN","FHOMRMD",64,0)
 Q
"RTN","FHOMRMD",65,0)
PG ;
"RTN","FHOMRMD",66,0)
 Q:$O(^FHPT(FHDFN,"OP","B",FHRMDT))'>0
"RTN","FHOMRMD",67,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRMD",68,0)
 D HDR Q
"RTN","FHOMRMD",69,0)
HDR ;
"RTN","FHOMRMD",70,0)
 I $G(FHPP)'=1 W:$Y @IOF
"RTN","FHOMRMD",71,0)
 K FHPP W !?15,"R E C U R R I N G   M E A L S"
"RTN","FHOMRMD",72,0)
 W !!?3,"NAME: " D PATNAME^FHOMUTL W FHPTNM,"   ",FHSSN
"RTN","FHOMRMD",73,0)
 W !!?27,"Ordering",?38,"Service"
"RTN","FHOMRMD",74,0)
 W !?2,"#",?6,"Date/Time",?27,"Location",?38,"Point"
"RTN","FHOMRMD",75,0)
 W ?50,"Meal",?55,"Bag",?60,"Diet Ordered",?74,"Status"
"RTN","FHOMRMD",76,0)
 W !?1,"===",?6,"==================",?26,"=========="
"RTN","FHOMRMD",77,0)
 W ?38,"==========",?50,"====",?55,"===",?60,"============",?74,"======"
"RTN","FHOMRMD",78,0)
 Q
"RTN","FHOMRMD",79,0)
END ;
"RTN","FHOMRMD",80,0)
 K EX,FHDIET,FHDIETP,FHDIETS,FHDTP,FHFIND,FHLOC,FHLPT,FHNODE,FHRM
"RTN","FHOMRMD",81,0)
 K FHRNUM,FHDPTR,FHDNM Q
"RTN","FHOMRO1")
0^1^B63144106
"RTN","FHOMRO1",1,0)
FHOMRO1 ;Hines OIFO/RTK RECURRING MEALS ORDER EDIT  ;2/04/03  14:05
"RTN","FHOMRO1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMRO1",3,0)
 ;
"RTN","FHOMRO1",4,0)
 S FHDIET="" F FHDX=1:1:5 S FHDIETX(FHDX)=""
"RTN","FHOMRO1",5,0)
 S FHMSG1="R" D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMRO1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMRO1",7,0)
 D NOW^%DTC S X1=$E(%,1,7),X2=-1 D C^%DTC S FHNOW=X D CHECK
"RTN","FHOMRO1",8,0)
 I FHEXST=1 D ORDEDT,END Q
"RTN","FHOMRO1",9,0)
 D ORDER,END Q
"RTN","FHOMRO1",10,0)
ORDEDT ;
"RTN","FHOMRO1",11,0)
 W !!,"This person has an existing outpatient diet order."
"RTN","FHOMRO1",12,0)
 K DIR S DIR(0)="SBO^E:Edit;O:New Order"
"RTN","FHOMRO1",13,0)
 S DIR("A")="Edit the existing diet or order another one" D ^DIR
"RTN","FHOMRO1",14,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",15,0)
 I Y="O" D ORDER Q
"RTN","FHOMRO1",16,0)
 I Y="E" D EDIT Q
"RTN","FHOMRO1",17,0)
 Q
"RTN","FHOMRO1",18,0)
ORDER ;
"RTN","FHOMRO1",19,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",20,0)
DIETORD ;
"RTN","FHOMRO1",21,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" EXMSG^FHOMUTL Q:FHDIETX(1)=""  D DATE Q
"RTN","FHOMRO1",22,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",23,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMRO1",24,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",25,0)
 S DIC("B")=FHDEF,DIC("S")="I FHSPDTS[$P(^(0),U)" D ^DIC
"RTN","FHOMRO1",26,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",27,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",28,0)
 S FHDIET=+Y
"RTN","FHOMRO1",29,0)
DATE ;
"RTN","FHOMRO1",30,0)
 K DIR S DIR("A")="Select Start Date: ",DIR(0)="DAO^DT" D ^DIR
"RTN","FHOMRO1",31,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",32,0)
 S (FHOSTDT,STDT)=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",33,0)
 S FHMAX=$P($G(^FH(119.6,FHLOC,1)),U,2) I FHMAX="" S FHMAX=999
"RTN","FHOMRO1",34,0)
 D NOW^%DTC S FHTODAY=$E(%,1,7),X1=FHTODAY,X2=FHMAX D C^%DTC S FHCUT=X
"RTN","FHOMRO1",35,0)
 K DIR S DIR("A")="Select End Date: ",DIR(0)="DAO^"_STDT_":"_FHCUT D ^DIR
"RTN","FHOMRO1",36,0)
 I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",37,0)
 S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMRO1",38,0)
DAYS ;
"RTN","FHOMRO1",39,0)
 S FHIFLG=0 D SHDAYS
"RTN","FHOMRO1",40,0)
 K DIR S DIR("A")="Select Days of Week: ",DIR(0)="FAO"
"RTN","FHOMRO1",41,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",42,0)
 S FHDAYS=Y D DAYCHK I FHIFLG=1 D DAYS Q
"RTN","FHOMRO1",43,0)
 K DIR S DIR("A")="Select MEAL: "
"RTN","FHOMRO1",44,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMRO1",45,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",46,0)
 S FHMEAL=Y W !
"RTN","FHOMRO1",47,0)
 K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y" D ^DIR
"RTN","FHOMRO1",48,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMRO1",49,0)
 S STDTMP=STDT,FHTDTMP=FHTODAY D CHK1^FHOMRO2
"RTN","FHOMRO1",50,0)
 D SETNODE,UPD100
"RTN","FHOMRO1",51,0)
 I FHSETFLG=0 W !!!?5,"No meals ordered!",! Q
"RTN","FHOMRO1",52,0)
 S FHACT="O",FHOPTY="R" D SETORX^FHOMRO2
"RTN","FHOMRO1",53,0)
 S FHMSG1="R" D OKMSG^FHOMUTL
"RTN","FHOMRO1",54,0)
 S FHLTFLG=0 I STDTMP=FHTDTMP D CHK2^FHOMRO2
"RTN","FHOMRO1",55,0)
 I FHLTFLG=1 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHTODAY,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",56,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",57,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",58,0)
 .S FHEL="L",FHRMDT=FHTODAY D ORD^FHOMRE1
"RTN","FHOMRO1",59,0)
 Q
"RTN","FHOMRO1",60,0)
SETNODE ;
"RTN","FHOMRO1",61,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1) I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMRO1",62,0)
 S FHMPNUM=FHMPNUM+1,FHSETFLG=0
"RTN","FHOMRO1",63,0)
 K ODAYS S CCC=0,X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRO1",64,0)
 S ENDL=0 F  Q:ENDL=1  D
"RTN","FHOMRO1",65,0)
 .S CCC=CCC+1,X1=STDT,X2=1 D C^%DTC S STDT=X
"RTN","FHOMRO1",66,0)
 .I STDT>ENDT S ENDL=1 Q
"RTN","FHOMRO1",67,0)
 .S X=STDT D DOW^%DTC
"RTN","FHOMRO1",68,0)
 .I FHDAYS[$E("XMTWRFS",Y+1) S ODAYS(STDT)=STDT D SET
"RTN","FHOMRO1",69,0)
 .Q
"RTN","FHOMRO1",70,0)
 Q
"RTN","FHOMRO1",71,0)
SET ;
"RTN","FHOMRO1",72,0)
 S FHPREVML=0 D PREV I FHPREVML=1 Q
"RTN","FHOMRO1",73,0)
 S FHSETFLG=1
"RTN","FHOMRO1",74,0)
 ;I $O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRO1",75,0)
 S Y=STDT K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",76,0)
 S DIC(0)="L"  ;,DIC("P")=$P(^DD(115,16,0),U,2),X=+Y,DINUM=X
"RTN","FHOMRO1",77,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMRO1",78,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",79,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN),DA=+Y
"RTN","FHOMRO1",80,0)
 S DR="1////^S X=FHDIET;2////^S X=FHLOC;3////^S X=FHMEAL;5////^S X=FHMPNUM;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);.05////^S X=FHORN" D ^DIE
"RTN","FHOMRO1",81,0)
 Q
"RTN","FHOMRO1",82,0)
MULTDT ;
"RTN","FHOMRO1",83,0)
 S FHDIET="@" F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",84,0)
 D ^FHOMRO3 I $O(FHDI(0))="" F FHDX=1:1:5 S FHDIETX(FHDX)="" Q
"RTN","FHOMRO1",85,0)
 S FHDX=0 F FHD0=0:0 S FHD0=$O(FHDI(FHD0)) Q:FHD0=""  S FHDX=FHDX+1,FHDIETX(FHDX)=$P(FHDI(FHD0),"^",1)
"RTN","FHOMRO1",86,0)
 Q
"RTN","FHOMRO1",87,0)
SHDAYS ;
"RTN","FHOMRO1",88,0)
 W !!,"          Mon  Tues  Wed  Thur  Fri  Sat  Sun"
"RTN","FHOMRO1",89,0)
 W !,"           M     T    W     R    F    S    X"
"RTN","FHOMRO1",90,0)
 W !!,"Enter string of characters for desired days of week: e.g., MWF",!
"RTN","FHOMRO1",91,0)
 Q
"RTN","FHOMRO1",92,0)
DAYCHK ;
"RTN","FHOMRO1",93,0)
 S X=FHDAYS D TR^FH S FHDAYS=X
"RTN","FHOMRO1",94,0)
 S X1="" F K=1:1 S Z=$E(FHDAYS,K) Q:Z=""!(FHIFLG=1)  D
"RTN","FHOMRO1",95,0)
 .I X1[Z S FHIFLG=1 Q
"RTN","FHOMRO1",96,0)
 .I "MTWRFSX"'[Z S FHIFLG=1 Q
"RTN","FHOMRO1",97,0)
 .S X1=X1_Z Q
"RTN","FHOMRO1",98,0)
 I FHIFLG=1 W !!,"Please enter the desired days of the week.",!
"RTN","FHOMRO1",99,0)
 Q
"RTN","FHOMRO1",100,0)
PREV ;
"RTN","FHOMRO1",101,0)
 F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",STDT,FHRNUM)) Q:FHRNUM'>0!(FHPREVML=1)  D
"RTN","FHOMRO1",102,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL Q
"RTN","FHOMRO1",103,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" Q
"RTN","FHOMRO1",104,0)
 .D PATNAME^FHOMUTL S FHPREDT=$$FMTE^XLFDT(STDT,"P") I $G(FHHL7)'=1 D
"RTN","FHOMRO1",105,0)
 ..W !!?3,FHPTNM," ALREADY HAS A "
"RTN","FHOMRO1",106,0)
 ..W $S(FHMEAL="B":"BREAKFAST",FHMEAL="N":"NOON",1:"EVENING")
"RTN","FHOMRO1",107,0)
 ..W " MEAL ORDERED FOR ",FHPREDT
"RTN","FHOMRO1",108,0)
 .S FHPREVML=1
"RTN","FHOMRO1",109,0)
 Q
"RTN","FHOMRO1",110,0)
CHECK ;
"RTN","FHOMRO1",111,0)
 S FHEXST=0 I $O(^FHPT(FHDFN,"OP","B",FHNOW)) D
"RTN","FHOMRO1",112,0)
 .F FHRMDT=FHNOW:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)'="C" S FHEXST=1
"RTN","FHOMRO1",113,0)
 Q
"RTN","FHOMRO1",114,0)
END ;Kill local variables before exiting
"RTN","FHOMRO1",115,0)
 K A,AA,AB,CCC,CONT,ENDL,ENDT,FHDFN,FHDAYS,FHDEF,FHDIET,FHDIETS
"RTN","FHOMRO1",116,0)
 K FHDIETX1,FHDIETX2,FHDIETX3,FHDIETX4,FHDIETX5,FHEXST,FHIFLG,FHLOC
"RTN","FHOMRO1",117,0)
 K FHMPNUM,FHYIEN,FLAG,J,FHMEAL,MLT,ODAYS,SPDIETS,STDT
"RTN","FHOMRO1",118,0)
 Q
"RTN","FHOMRO1",119,0)
EDIT ;
"RTN","FHOMRO1",120,0)
 D NOW^%DTC S STDT=$E(%,1,7),FHDTRLE=%
"RTN","FHOMRO1",121,0)
 D DISP^FHOMRR1
"RTN","FHOMRO1",122,0)
EDT1 K DIR S DIR(0)="NAO^1:"_NUM,DIR("A")="Edit Which Order? " D ^DIR
"RTN","FHOMRO1",123,0)
 Q:$D(DIRUT)
"RTN","FHOMRO1",124,0)
 S ORDNUM=Y,Y=$P(FHLIST(ORDNUM),U,2) D DD^%DT W !,Y,!
"RTN","FHOMRO1",125,0)
 S DA=$P(FHLIST(ORDNUM),U,1),DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRO1",126,0)
 I $P($G(^FHPT(FHDFN,"OP",DA,0)),U,15)="C" W !!?3,"The selected order has been cancelled!",! D EDT1 Q
"RTN","FHOMRO1",127,0)
 S FHLPT=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,3),FHMEAL=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,4)
"RTN","FHOMRO1",128,0)
 D OUTLOC I FHLOC="" D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",129,0)
 I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D MULTDT D:FHDIETX(1)="" UPXMSG^FHOMUTL Q:FHDIETX(1)=""  S FHDIET="@" D SETEDT Q
"RTN","FHOMRO1",130,0)
 D DIETLST^FHOMUTL I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMRO1",131,0)
 S FHDEF2=$P($G(^FHPT(FHDFN,"OP",DA,0)),U,2) I FHDEF2'="" S FHDEF=$P($G(^FH(111,FHDEF2,0)),U,1)
"RTN","FHOMRO1",132,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMRO1",133,0)
 S DIC("B")=FHDEF,DIC("S")="I FHSPDTS[$P(^(0),U)" D ^DIC
"RTN","FHOMRO1",134,0)
 I $D(DUOUT) D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",135,0)
 I Y=-1 D UPXMSG^FHOMUTL Q
"RTN","FHOMRO1",136,0)
 S FHDIET=+Y F FHDX=1:1:5 S FHDIETX(FHDX)="@"
"RTN","FHOMRO1",137,0)
 ;
"RTN","FHOMRO1",138,0)
SETEDT ;
"RTN","FHOMRO1",139,0)
 W ! S FHZDA=DA,DR="2////^S X=FHLOC;1////^S X=FHDIET;6////^S X=FHDIETX(1);7////^S X=FHDIETX(2);8////^S X=FHDIETX(3);9////^S X=FHDIETX(4);10////^S X=FHDIETX(5);25////^S X=FHDTRLE"
"RTN","FHOMRO1",140,0)
 D ^DIE,UPDMSG^FHOMUTL,ED100
"RTN","FHOMRO1",141,0)
 Q
"RTN","FHOMRO1",142,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMRO1",143,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMRO1",144,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ",DIC("B")=FHLPT
"RTN","FHOMRO1",145,0)
 S DIC("A")="Select OUTPATIENT LOCATION: "
"RTN","FHOMRO1",146,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMRO1",147,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMRO1",148,0)
 S FHLOC=+Y Q
"RTN","FHOMRO1",149,0)
 ;
"RTN","FHOMRO1",150,0)
UPD100 ;Backdoor message to update file #100 with a new RM order
"RTN","FHOMRO1",151,0)
 QUIT  ;DISABLE THIS - PATCH 2** WILL REMOVE THE QUIT AND ENABLE THIS
"RTN","FHOMRO1",152,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",153,0)
 S FHODAYS=""
"RTN","FHOMRO1",154,0)
 F N=1:1:7 S FH1=$E(FHDAYS,N) Q:FH1=""  S M=$F("MTWRFSX",FH1)-1,N1(M)=""
"RTN","FHOMRO1",155,0)
 F N=0:0 S N=$O(N1(N)) Q:N'>0  S FHODAYS=FHODAYS_"~QJ"_N
"RTN","FHOMRO1",156,0)
 S FHODAYS=$E(FHODAYS,2,999)
"RTN","FHOMRO1",157,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",158,0)
 I FHDIET'="@" S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",159,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(ENDT)
"RTN","FHOMRO1",160,0)
 S FHOTDAY=$$FMTHL7^XLFDT(FHTODAY)
"RTN","FHOMRO1",161,0)
 S FILL="R;"_FHMPNUM_";"_FHOSTDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMRO1",162,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^"_FHODAYS_"^^"_FHOSTDT_"^"_FHOENDT_"||||||||"_FHOTDAY
"RTN","FHOMRO1",163,0)
 I FHDIET'="@" S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",164,0)
 I FHDIET="@" D
"RTN","FHOMRO1",165,0)
 .F N=0:0 S N=$O(FHDIETX(N)) Q:N'>0!(FHDIETX(N)="@")  S FHODNM=$P($G(^FH(111,FHDIETX(N),0)),U,1),MSG(N+4)="ODS|D|"_FHOMEAL_"|^^^"_FHDIETX(N)_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",166,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",167,0)
 Q
"RTN","FHOMRO1",168,0)
ED100 ;Backdoor message to update file #100 with an edited RM order
"RTN","FHOMRO1",169,0)
 QUIT  ;DISABLE THIS - PATCH 2** WILL REMOVE THE QUIT AND ENABLE THIS
"RTN","FHOMRO1",170,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRO1",171,0)
 S (FHOSTDT,FHOENDT)=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,1)
"RTN","FHOMRO1",172,0)
 S FHOSTDT=$$FMTHL7^XLFDT(FHOSTDT),FHOENDT=$$FMTHL7^XLFDT(FHOENDT)
"RTN","FHOMRO1",173,0)
 S FILL="RMEDIT;"_FHZDA,FHORN=$P($G(^FHPT(FHDFN,"OP",FHZDA,0)),U,12)
"RTN","FHOMRO1",174,0)
 S FHODNM=$P($G(^FH(111,FHDIET,0)),U,1)
"RTN","FHOMRO1",175,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMRO1",176,0)
 S MSG(4)="ORC|XX|"_FHORN_"^OR|"_FILL_"^FH||||^^^"_FHOSTDT_"^"_FHOENDT_"||||||||"
"RTN","FHOMRO1",177,0)
 S MSG(5)="ODS|D|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHODNM_"^99FHD|"
"RTN","FHOMRO1",178,0)
 D EVSEND^FHWOR
"RTN","FHOMRO1",179,0)
 Q
"RTN","FHOMRP1")
0^2^B7723216
"RTN","FHOMRP1",1,0)
FHOMRP1 ;Hines OIFO/RTK RECURRING MEALS PRINT EXPIRING LIST  ;4/17/03  09:45
"RTN","FHOMRP1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMRP1",3,0)
 W ! K DIR,DIC S DIR("A")="Select Outpatient Ordering Location: "
"RTN","FHOMRP1",4,0)
 S DIR(0)="PAO^119.6:EMQZ" D ^DIR Q:$D(DIRUT)
"RTN","FHOMRP1",5,0)
 I Y'=-1 S FHLOC=+Y
"RTN","FHOMRP1",6,0)
 S FHPARAM=$P($G(^FH(119.6,FHLOC,1)),U,3),FHNOEP=0
"RTN","FHOMRP1",7,0)
 I FHPARAM="" D  Q
"RTN","FHOMRP1",8,0)
 .W !!?5,"NOTICE: No value set for 'NUMBER OF DAYS FOR REVIEW' "
"RTN","FHOMRP1",9,0)
 .W !?5,"parameter -- CAN'T CONTINUE",!! Q
"RTN","FHOMRP1",10,0)
 D NOW^%DTC S FHTODAY=X,X1=FHTODAY,X2=FHPARAM D C^%DTC S FHDSDT=X
"RTN","FHOMRP1",11,0)
 S FHD=$$FMTE^XLFDT(FHDSDT,"P")
"RTN","FHOMRP1",12,0)
 W ! K DIR,DIC S DIR("A")="Display recurring meals expiring by: "
"RTN","FHOMRP1",13,0)
 S DIR(0)="DAEO^"_DT,DIR("B")=FHD D ^DIR Q:$D(DIRUT)
"RTN","FHOMRP1",14,0)
 I Y'=-1 S FHNDAYS=+Y
"RTN","FHOMRP1",15,0)
DEV ;get device and set up queue
"RTN","FHOMRP1",16,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMRP1",17,0)
 I '$D(IO("Q")) U IO D DISP,^%ZISC,END Q
"RTN","FHOMRP1",18,0)
 S ZTRTN="DISP^FHOMRP1"
"RTN","FHOMRP1",19,0)
 S ZTSAVE("FHLOC")="",ZTSAVE("FHPARAM")="",ZTSAVE("FHNDAYS")=""
"RTN","FHOMRP1",20,0)
 S ZTSAVE("FHTODAY")="",ZTSAVE("FHNOEP")=""
"RTN","FHOMRP1",21,0)
 S ZTDESC="Print Recurring Meals Expiration List" D ^%ZTLOAD
"RTN","FHOMRP1",22,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMRP1",23,0)
 D END Q
"RTN","FHOMRP1",24,0)
DISP ;
"RTN","FHOMRP1",25,0)
 S FHLZN=$G(^FH(119.6,FHLOC,0)),FHLOCNM=$P(FHLZN,U,1)
"RTN","FHOMRP1",26,0)
 W !!?2,"OUTPATIENT LOCATION: ",FHLOCNM
"RTN","FHOMRP1",27,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("C",FHLOC,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMRP1",28,0)
 .S FHRNUM=$O(^FHPT("C",FHLOC,FHDFN,""),-1)
"RTN","FHOMRP1",29,0)
 .S FHDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1)
"RTN","FHOMRP1",30,0)
 .I FHDT<FHNDAYS,FHDT>FHTODAY D
"RTN","FHOMRP1",31,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMRP1",32,0)
 ..D PATNAME^FHOMUTL S FHNOEP=1
"RTN","FHOMRP1",33,0)
 ..S FHDATE=$$FMTE^XLFDT(FHDT,"P")
"RTN","FHOMRP1",34,0)
 ..W !!?3,FHPTNM,"  RECURRING DIET ORDER EXPIRES ON: ",$E(FHDATE,1,12)
"RTN","FHOMRP1",35,0)
 ..W !?26,"Ordering",?38,"Service",!?6,"Date/Time",?26,"Location"
"RTN","FHOMRP1",36,0)
 ..W ?38,"Point",?50,"Meal",?56,"Diet Ordered"
"RTN","FHOMRP1",37,0)
 ..W !?6,"==================",?26,"=========="
"RTN","FHOMRP1",38,0)
 ..W ?38,"==========",?50,"====",?56,"================"
"RTN","FHOMRP1",39,0)
 ..;S FHDTP=$$FMTE^XLFDT(FHRM,"P") W ?6,FHDOW," - ",$E(FHDTP,1,12)
"RTN","FHOMRP1",40,0)
 ..S FHLNM=$E($P(FHLZN,U,1),1,10),FHSERV=$P(FHLZN,U,10)
"RTN","FHOMRP1",41,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLZN,U,5),FHSERV["C":$P(FHLZN,U,6),1:"")
"RTN","FHOMRP1",42,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMRP1",43,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMRP1",44,0)
 ..W !?6,$E(FHDATE,1,12),?26,FHLNM,?38,$E(FHSRVPT,1,9),?51,$P(FHNODE,U,4)
"RTN","FHOMRP1",45,0)
 ..I $P($G(^FH(119.6,FHLOC,1)),U,4)="Y" D DIETPAT^FHOMRR1 W ?56,$E(FHDIETP,1,24)
"RTN","FHOMRP1",46,0)
 ..I $P($G(^FH(119.6,FHLOC,1)),U,4)'="Y" S FHDPTR=$P(FHNODE,U,2) W ?56,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,24)
"RTN","FHOMRP1",47,0)
 I FHNOEP=0 D
"RTN","FHOMRP1",48,0)
 .S FHDSPDT=$$FMTE^XLFDT(FHNDAYS,"P")
"RTN","FHOMRP1",49,0)
 .W !!?3,"NO RECURRING MEAL PLANS EXPIRING FOR ",FHLOCNM
"RTN","FHOMRP1",50,0)
 .W " BEFORE ",FHDSPDT,"."
"RTN","FHOMRP1",51,0)
 Q
"RTN","FHOMRP1",52,0)
END ;
"RTN","FHOMRP1",53,0)
 K FHLOC,FHPARAM Q
"RTN","FHOMRR1")
0^3^B18595487
"RTN","FHOMRR1",1,0)
FHOMRR1 ;Hines OIFO/RTK RECURRING MEALS REVIEW/DISPLAY  ;2/04/03  14:05
"RTN","FHOMRR1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMRR1",3,0)
 ;
"RTN","FHOMRR1",4,0)
STRT K FHPSDT D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRR1",5,0)
 I STDT="" Q
"RTN","FHOMRR1",6,0)
 D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMRR1",7,0)
 S ENDT=ENDT_.99
"RTN","FHOMRR1",8,0)
 D DEV D STRT Q
"RTN","FHOMRR1",9,0)
 ;I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR Q
"RTN","FHOMRR1",10,0)
 ;
"RTN","FHOMRR1",11,0)
DEV ;get device and set up queue
"RTN","FHOMRR1",12,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMRR1",13,0)
 I '$D(IO("Q")) U IO D DISP,^%ZISC,END Q
"RTN","FHOMRR1",14,0)
 S ZTRTN="DISP^FHOMRR1"
"RTN","FHOMRR1",15,0)
 S ZTSAVE("STDT")="",ZTSAVE("FHDFN")=""
"RTN","FHOMRR1",16,0)
 S ZTDESC="Outpatient Meals Recurring Meals Display" D ^%ZTLOAD
"RTN","FHOMRR1",17,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMRR1",18,0)
 D END Q
"RTN","FHOMRR1",19,0)
DISP ;
"RTN","FHOMRR1",20,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT=X
"RTN","FHOMRR1",21,0)
 I '$O(^FHPT(FHDFN,"OP","B",STDT)) W !!,"No Recurring Meals to Display" Q
"RTN","FHOMRR1",22,0)
 K FHLIST S EX="",NUM=0 D HDR I $G(ENDT)="" S ENDT=9999999.99
"RTN","FHOMRR1",23,0)
 F FHRMDT=STDT:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)!(EX=U)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0!(EX=U)  D
"RTN","FHOMRR1",24,0)
 .S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0))
"RTN","FHOMRR1",25,0)
 .S FHRM=$P(FHNODE,U,1)
"RTN","FHOMRR1",26,0)
 .S NUM=NUM+1,PAD=$S($L(NUM)<3:3-$L(NUM),1:1) W !?PAD,NUM
"RTN","FHOMRR1",27,0)
 .S FHLIST(NUM)=FHRNUM_"^"_FHRM
"RTN","FHOMRR1",28,0)
 .S FHDOW=$$DOW^XLFDT(FHRM),FHDOW=$E(FHDOW,1,3)
"RTN","FHOMRR1",29,0)
 .S FHDTP=$$FMTE^XLFDT(FHRM,"P") W ?6,FHDOW," - ",$E(FHDTP,1,12)
"RTN","FHOMRR1",30,0)
 .S FHLPT=$P(FHNODE,U,3),FHLOCZN=$G(^FH(119.6,FHLPT,0)) D
"RTN","FHOMRR1",31,0)
 ..S FHLOC=$E($P(FHLOCZN,U,1),1,11),FHSERV=$P(FHLOCZN,U,10)
"RTN","FHOMRR1",32,0)
 ..S FHSRV=$S(FHSERV["T":$P(FHLOCZN,U,5),FHSERV["C":$P(FHLOCZN,U,6),1:"")
"RTN","FHOMRR1",33,0)
 ..I FHSRV="" S FHSRVPT="" Q
"RTN","FHOMRR1",34,0)
 ..S FHSRVPT=$P($G(^FH(119.72,FHSRV,0)),U,1)
"RTN","FHOMRR1",35,0)
 ..Q
"RTN","FHOMRR1",36,0)
 .W ?26,FHLOC,?39,$E(FHSRVPT,1,11),?52,$P(FHNODE,U,4)
"RTN","FHOMRR1",37,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)="Y" D DIETPAT W ?57,$E(FHDIETP,1,15)
"RTN","FHOMRR1",38,0)
 .I $P($G(^FH(119.6,FHLPT,1)),U,4)'="Y" S FHDPTR=$P(FHNODE,U,2) Q:FHDPTR=""  W ?57,$E($P($G(^FH(111,FHDPTR,0)),U,1),1,15)
"RTN","FHOMRR1",39,0)
 .S FHSTAT=$P(FHNODE,U,15) I FHSTAT="C" W ?76,"C"
"RTN","FHOMRR1",40,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMRR1",41,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,1)) D
"RTN","FHOMRR1",42,0)
 ..S FHNODE1=$G(^FHPT(FHDFN,"OP",FHRNUM,1))
"RTN","FHOMRR1",43,0)
 ..S FHSTATA=$P(FHNODE1,U,5) I FHSTATA="C" W !?7,"Additional Orders: ",$E($P(FHNODE1,U,1),1,46),?76,"C" Q
"RTN","FHOMRR1",44,0)
 ..W !?7,"Additional Orders: ",$P(FHNODE1,U,1)
"RTN","FHOMRR1",45,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHOMRR1",46,0)
 ..S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2))
"RTN","FHOMRR1",47,0)
 ..S FHEL=FHNODE2
"RTN","FHOMRR1",48,0)
 ..W !?7,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMRR1",49,0)
 ..W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMRR1",50,0)
 ..S FHSTATE=$P(FHNODE2,U,6) I FHSTATE="C" W ?76,"C"
"RTN","FHOMRR1",51,0)
 .I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHOMRR1",52,0)
 ..S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3))
"RTN","FHOMRR1",53,0)
 ..S FHTU=FHNODE3
"RTN","FHOMRR1",54,0)
 ..W !?7,"Tubefeeding: " S FHSTATT=$P(FHTU,U,5) I FHSTATT="C" W ?76,"C"
"RTN","FHOMRR1",55,0)
 ..F FHTZ=0:0 S FHTZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ)) Q:FHTZ'>0  D
"RTN","FHOMRR1",56,0)
 ...S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHTZ,0))
"RTN","FHOMRR1",57,0)
 ...S FHTUPTR=$P(FHTUZN,U,1),FHTUSTR=$P(FHTUZN,U,2)
"RTN","FHOMRR1",58,0)
 ...W !?9,$P($G(^FH(118.2,FHTUPTR,0)),U,1),"  Strength: "
"RTN","FHOMRR1",59,0)
 ...W $S(FHTUSTR=1:"1/4",FHTUSTR=2:"1/2",FHTUSTR=3:"3/4",1:"FULL")
"RTN","FHOMRR1",60,0)
 ...I $P(FHTUZN,U,3)["CC" D  ;print ml instead of cc.
"RTN","FHOMRR1",61,0)
 ....S QUA=$P(FHTUZN,U,3)
"RTN","FHOMRR1",62,0)
 ....S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2)
"RTN","FHOMRR1",63,0)
 ....S $P(FHTUZN,U,3)=QUAFI_"ML"_QUASE
"RTN","FHOMRR1",64,0)
 ...W "  Quantity: ",$P(FHTUZN,U,3)
"RTN","FHOMRR1",65,0)
 ..W !?7,"Total ML's: ",$P(FHTU,U,2),"  Total KCALS/DAY: ",$P(FHTU,U,3)
"RTN","FHOMRR1",66,0)
 ..S FHTCOMM=$P(FHTU,U,1) I FHTCOMM'="" W !?7,"Comment: ",FHTCOMM
"RTN","FHOMRR1",67,0)
 .Q
"RTN","FHOMRR1",68,0)
 W ! Q
"RTN","FHOMRR1",69,0)
DIETPAT ;
"RTN","FHOMRR1",70,0)
 S FHDIETS=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,7,11)
"RTN","FHOMRR1",71,0)
 S FHDIETP=""
"RTN","FHOMRR1",72,0)
 F PCE=1:1:5 D
"RTN","FHOMRR1",73,0)
 .S FHDPTR=$P(FHDIETS,U,PCE) I FHDPTR="" Q
"RTN","FHOMRR1",74,0)
 .S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,7)
"RTN","FHOMRR1",75,0)
 .I FHDNM="" S FHDNM=$P($G(^FH(111,FHDPTR,0)),U,1)
"RTN","FHOMRR1",76,0)
 .S FHDIETP=FHDIETP_FHDNM_"," Q
"RTN","FHOMRR1",77,0)
 S FHDIETP=$E(FHDIETP,1,$L(FHDIETP)-1)
"RTN","FHOMRR1",78,0)
 Q
"RTN","FHOMRR1",79,0)
PG ;
"RTN","FHOMRR1",80,0)
 Q:$O(^FHPT(FHDFN,"OP","B",FHRMDT))'>0
"RTN","FHOMRR1",81,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMRR1",82,0)
 D HDR Q
"RTN","FHOMRR1",83,0)
HDR ;
"RTN","FHOMRR1",84,0)
 I $G(FHPP)'=1 W:$Y @IOF
"RTN","FHOMRR1",85,0)
 K FHPP W !?5,"R E C U R R I N G   M E A L   D I S P L A Y"
"RTN","FHOMRR1",86,0)
 W !!?3,"OUTPATIENT NAME: " D PATNAME^FHOMUTL W FHPTNM,"   ",FHSSN
"RTN","FHOMRR1",87,0)
 W ?65,FHSEX," Age ",FHAGE
"RTN","FHOMRR1",88,0)
 W !!?26,"Ordering",?39,"Service"
"RTN","FHOMRR1",89,0)
 W !?2,"#",?6,"Date/Time",?26,"Location",?39,"Point"
"RTN","FHOMRR1",90,0)
 W ?51,"Meal",?57,"Diet Ordered",?74,"Status"
"RTN","FHOMRR1",91,0)
 W !?1,"===",?6,"==================",?26,"==========="
"RTN","FHOMRR1",92,0)
 W ?39,"===========",?51,"====",?57,"===============",?74,"======"
"RTN","FHOMRR1",93,0)
 Q
"RTN","FHOMRR1",94,0)
END ;
"RTN","FHOMRR1",95,0)
 K ENDT,EX,FHDIET,FHDIETP,FHDIETS,FHDTP,FHFIND,FHLOC,FHLPT,FHNODE,FHRM
"RTN","FHOMRR1",96,0)
 K FHRNUM,FHDPTR,FHDNM Q
"RTN","FHOMRT1")
0^10^B19762686
"RTN","FHOMRT1",1,0)
FHOMRT1 ;Hines OIFO/RTK OUTPATIENT MEALS TUBEFEEDING ORDERS  ;6/02/03  14:15
"RTN","FHOMRT1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMRT1",3,0)
 ;
"RTN","FHOMRT1",4,0)
 S FHMSG1="T" D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRT1",5,0)
 K NUM D DISP^FHOMRR1 I $G(NUM)="" Q
"RTN","FHOMRT1",6,0)
TF1 W ! K DIR S DIR("A")="Select Order(s)",DIR(0)="LO^1:"_NUM D ^DIR
"RTN","FHOMRT1",7,0)
 Q:$D(DIRUT)  S FHCLST=Y
"RTN","FHOMRT1",8,0)
 S FHCAN1=0 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)'="C" S FHCAN1=1
"RTN","FHOMRT1",9,0)
 I FHCAN1=0 W !!?3,"The selected order(s) have been cancelled!",! D TF1 Q
"RTN","FHOMRT1",10,0)
FHTUB S NO=0,FHWF=$S($D(^ORD(101)):1,1:0) D ^FHORT10
"RTN","FHOMRT1",11,0)
 I $O(TUN(0))="" D EXMSG^FHOMUTL Q
"RTN","FHOMRT1",12,0)
 S (FHTC,FHTK)=0,FHORN="" W !
"RTN","FHOMRT1",13,0)
 F FHK=0:0 S FHK=$O(TUN(FHK)) Q:FHK<1  D
"RTN","FHOMRT1",14,0)
 .S FHTC=FHTC+$P(TUN(FHK),"^",4)+$P(TUN(FHK),"^",5)
"RTN","FHOMRT1",15,0)
 .S FHTK=FHTK+$P(TUN(FHK),"^",6),FHSTR=$P(TUN(FHK),"^",2)
"RTN","FHOMRT1",16,0)
 .S FHPRO=$P(TUN(FHK),"^",1)
"RTN","FHOMRT1",17,0)
 .W !,"Product: ",$P($G(^FH(118.2,FHPRO,0)),"^",1),", "
"RTN","FHOMRT1",18,0)
 .W $S(FHSTR=4:"Full",FHSTR=2:"1/2",FHSTR=1:"1/4",1:"3/4"),", "
"RTN","FHOMRT1",19,0)
 .W $P(TUN(FHK),"^",3)
"RTN","FHOMRT1",20,0)
 .Q
"RTN","FHOMRT1",21,0)
 W !!,"Total Kcal: ",FHTK,?36,"Total Quantity: ",FHTC
"RTN","FHOMRT1",22,0)
 I FHTC>5000 W !!,"WARNING: Total amount exceeds 5000ml: ",FHTC," ml",!,"Please Edit the Tubefeeding and Modify." D FHTUB Q
"RTN","FHOMRT1",23,0)
 ;
"RTN","FHOMRT1",24,0)
 W ! K DIR S DIR("A")="Tubefeeding Comment: ",DIR(0)="FAO^1:160" D ^DIR
"RTN","FHOMRT1",25,0)
 I Y="^" D EXMSG^FHOMUTL Q
"RTN","FHOMRT1",26,0)
 S FHTEXT=Y
"RTN","FHOMRT1",27,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMRT1",28,0)
 D ^DIR I $D(DIRUT)!(Y=0) D EXMSG^FHOMUTL,END Q
"RTN","FHOMRT1",29,0)
 W !
"RTN","FHOMRT1",30,0)
 F A=1:1:NUM S FHC=$P(FHCLST,",",A) Q:FHC=""  S FHRNUM=FHLIST(FHC) D CHK
"RTN","FHOMRT1",31,0)
 D OKMSG^FHOMUTL Q
"RTN","FHOMRT1",32,0)
 D END Q
"RTN","FHOMRT1",33,0)
CHK ;
"RTN","FHOMRT1",34,0)
 I $P($G(^FHPT(FHDFN,"OP",+FHRNUM,0)),U,15)="C" S FHDTX=$P(FHRNUM,U,2),FHDTX=$$FMTE^XLFDT(FHDTX,"P") W !?3,"The order for ",$E(FHDTX,1,12)," has been cancelled -- not ordered!" Q
"RTN","FHOMRT1",35,0)
 D SET,UPD100
"RTN","FHOMRT1",36,0)
 Q
"RTN","FHOMRT1",37,0)
SET ;
"RTN","FHOMRT1",38,0)
 K ^FHPT(FHDFN,"OP",+FHRNUM,"TF") S FHEV=""
"RTN","FHOMRT1",39,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMRT1",40,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"",",DA=+FHRNUM
"RTN","FHOMRT1",41,0)
 S DR="18////^S X=FHTEXT;20////^S X=FHTC;21////^S X=FHTK;21.5////^S X=FHORN" D ^DIE
"RTN","FHOMRT1",42,0)
 F K=0:0 S K=$O(TUN(K)) Q:K<1  D
"RTN","FHOMRT1",43,0)
 .S Y=K K DIC,DO S DA(2)=FHDFN,DA(1)=+FHRNUM
"RTN","FHOMRT1",44,0)
 .S DIC="^FHPT("_DA(2)_",""OP"","_DA(1)_",""TF"","
"RTN","FHOMRT1",45,0)
 .S DIC(0)="L",DIC("P")=$P(^DD(115.016,19,0),U,2),X=+Y,DINUM=X
"RTN","FHOMRT1",46,0)
 .D FILE^DICN I Y=-1 Q
"RTN","FHOMRT1",47,0)
 .K DIE S DA(2)=FHDFN,DA(1)=+FHRNUM,DA=+Y
"RTN","FHOMRT1",48,0)
 .S FH1=$P(TUN(K),U,2),FH2=$P(TUN(K),U,3),FH3=$P(TUN(K),U,4)
"RTN","FHOMRT1",49,0)
 .S FH4=$P(TUN(K),U,5),FH5=$P(TUN(K),U,6)
"RTN","FHOMRT1",50,0)
 .S DIE="^FHPT("_DA(2)_",""OP"","_DA(1)_",""TF"","
"RTN","FHOMRT1",51,0)
 .S DR="1////^S X=FH1;2////^S X=FH2;3////^S X=FH3;4////^S X=FH4;5////^S X=FH5" D ^DIE
"RTN","FHOMRT1",52,0)
 .S X3=TUN(K),TUN=$P(X3,U,1),XX=$G(^FH(118.2,TUN,0)) D CALC^FHORX3
"RTN","FHOMRT1",53,0)
 .S FHEV=FHEV_P2_" "_$P(XX,"^",1)_", "
"RTN","FHOMRT1",54,0)
 .Q
"RTN","FHOMRT1",55,0)
 S FHACT="O",FHOPTY="T",FHAET=$E(FHEV,1,$L(FHEV)-2) D SETAET^FHOMRO2
"RTN","FHOMRT1",56,0)
 Q
"RTN","FHOMRT1",57,0)
END ;
"RTN","FHOMRT1",58,0)
 K A,FHFIND,FHCLST,FHC,FHRNUM,FHTEXT,FHTODAY,NUM Q
"RTN","FHOMRT1",59,0)
 Q
"RTN","FHOMRT1",60,0)
HL7SET ;
"RTN","FHOMRT1",61,0)
 ; Entry point for TF's placed from CPRS/OERR
"RTN","FHOMRT1",62,0)
 K TUN S (NO,TC,TK,TP,TW,S2)=0,CTR=5
"RTN","FHOMRT1",63,0)
 F NUM=1:1:5 S DATA=$G(FHMSG(CTR)) Q:DATA=""  S CTR=CTR+1,DATA1=$G(FHMSG(CTR)) Q:DATA1=""  D ^FHWOR51 S CTR=CTR+1 Q:TXT'=""
"RTN","FHOMRT1",64,0)
 I TXT'="" D ERR^FHOMWOR Q
"RTN","FHOMRT1",65,0)
 I $O(TUN(0))="" Q
"RTN","FHOMRT1",66,0)
 S (FHCOND,FHTC,FHTK)=0,FHTEXT=$E($P(DATA,"|",5),1,160)
"RTN","FHOMRT1",67,0)
 F FHK=0:0 S FHK=$O(TUN(FHK)) Q:FHK<1!(FHCOND=1)  D
"RTN","FHOMRT1",68,0)
 .I '$D(^FH(118.2,FHK)) S FHCOND=1 Q
"RTN","FHOMRT1",69,0)
 .S FHTC=FHTC+$P(TUN(FHK),"^",4)+$P(TUN(FHK),"^",5)
"RTN","FHOMRT1",70,0)
 .S FHTK=FHTK+$P(TUN(FHK),"^",6)
"RTN","FHOMRT1",71,0)
 .Q
"RTN","FHOMRT1",72,0)
 I FHCOND=1 S TXT="Invalid TF Product" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRT1",73,0)
 I FHTC>5000 S TXT="Total amount exceeds 5000ml" D ERR^FHOMWOR Q
"RTN","FHOMRT1",74,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRT1",75,0)
 F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D SET
"RTN","FHOMRT1",76,0)
 I '$D(FHRNUM) Q
"RTN","FHOMRT1",77,0)
 S FILL="T;"_FHRNUM_";"_FHTK_";"_FHTC_";"_FHTEXT_";"_FHORN
"RTN","FHOMRT1",78,0)
 D SEND^FHWOR Q
"RTN","FHOMRT1",79,0)
UPD100 ;Backdoor message to update file #100 with a new TF order
"RTN","FHOMRT1",80,0)
 QUIT  ;DISABLE THIS - PATCH 2** WILL REMOVE THE QUIT AND ENABLE THIS
"RTN","FHOMRT1",81,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRT1",82,0)
 S FILL="T;"_FHRNUM,MNUM=4,TFCOM=FHTEXT D NOW^%DTC S FHNOW=%
"RTN","FHOMRT1",83,0)
 S (FHODT,SDT)=$P(FHRNUM,U,2),FHODT=$$FMTHL7^XLFDT(FHODT)
"RTN","FHOMRT1",84,0)
 S MSG(MNUM)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"|||"_DUZ_"||"_DUZ_"|||"_FHNOW
"RTN","FHOMRT1",85,0)
 F FHTF=0:0 S FHTF=$O(TUN(FHTF)) Q:FHTF<1  S XX=$G(TUN(FHTF)) D TF1^FHWOR5
"RTN","FHOMRT1",86,0)
 D EVSEND^FHWOR
"RTN","FHOMRT1",87,0)
 Q
"RTN","FHOMUTL")
0^11^B29468192
"RTN","FHOMUTL",1,0)
FHOMUTL ;Hines OIFO/RTK OUTPATIENT MEALS UTILITIES  ;2/04/03  15:15
"RTN","FHOMUTL",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHOMUTL",3,0)
 ;
"RTN","FHOMUTL",4,0)
DIV ;ask for Communication office if Multi-division.
"RTN","FHOMUTL",5,0)
 N FHSCNT,FH
"RTN","FHOMUTL",6,0)
 K FHSITE,FHSITENM
"RTN","FHOMUTL",7,0)
 S FHSCNT=0 F FH=0:0 S FH=$O(^FH(119.73,FH)) Q:FH'>0  S FHSCNT=FHSCNT+1,FHSITE=FH,FHSITENM=$P($G(^FH(119.73,FH,0)),U,1)
"RTN","FHOMUTL",8,0)
 I (FHSCNT=1),($P($G(^FH(119.9,1,0)),U,20)'="Y") Q
"RTN","FHOMUTL",9,0)
D2 I FHSCNT>1 K FHSITE,FHSITENM,X R !!,"Select COMMUNICATION OFFICE (or ALL): ALL// ",X:DTIME S:X="" X="ALL" Q:'$T!("^"[X)  D TR^FH I X="ALL" S FHSITE=0
"RTN","FHOMUTL",10,0)
 I X'="ALL" K DIC S DIC="^FH(119.73,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S FHSITE=+Y,FHSITENM=$P(Y,U,2)
"RTN","FHOMUTL",11,0)
 Q
"RTN","FHOMUTL",12,0)
 ;
"RTN","FHOMUTL",13,0)
STDATE ;Prompt for start date (if FHPSDT="N" do not allow past dates)
"RTN","FHOMUTL",14,0)
 S STDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y
"RTN","FHOMUTL",15,0)
 K DIR S DIR("A")="Select Start Date: ",DIR("B")=FHDTDF
"RTN","FHOMUTL",16,0)
 S DIR(0)="DAO" I $G(FHPSDT)="N" S DIR(0)="DAO^FHDTDF"
"RTN","FHOMUTL",17,0)
 D ^DIR Q:$D(DIRUT)  S STDT=Y S Y=STDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",18,0)
 Q
"RTN","FHOMUTL",19,0)
ENDATE ;Prompt for end date
"RTN","FHOMUTL",20,0)
 S ENDT="" D NOW^%DTC S Y=X D DD^%DT S FHDTDF=Y K DIR
"RTN","FHOMUTL",21,0)
 S DIR("A")="Select End Date: ",DIR("B")=FHDTDF,DIR(0)="DAO^"_STDT D ^DIR
"RTN","FHOMUTL",22,0)
 Q:$D(DIRUT)  S ENDT=Y S Y=ENDT D DD^%DT W "  ",Y
"RTN","FHOMUTL",23,0)
 Q
"RTN","FHOMUTL",24,0)
OUTLOC ;Prompt for outpatient location - screen for ONLY Outpatient Locations
"RTN","FHOMUTL",25,0)
 S FHLOC="",FHOUT="O"
"RTN","FHOMUTL",26,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="AEQZ"
"RTN","FHOMUTL",27,0)
 S DIC("A")="Select Outpatient Ordering Location: "
"RTN","FHOMUTL",28,0)
 S DIC("S")="I $P(^(0),U,3)=FHOUT" D ^DIC
"RTN","FHOMUTL",29,0)
 Q:$D(DUOUT)  I Y=-1 Q
"RTN","FHOMUTL",30,0)
 S FHLOC=+Y,FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8)
"RTN","FHOMUTL",31,0)
 Q
"RTN","FHOMUTL",32,0)
 ;
"RTN","FHOMUTL",33,0)
GTFHDFN ;Get FHDFN, given DFN
"RTN","FHOMUTL",34,0)
 K DIR S DIR(0)="NAO",DIR("B")="ENTER DFN" D ^DIR Q:$D(DIRUT)  S ZZDFN=Y
"RTN","FHOMUTL",35,0)
 S FHZ115="P"_ZZDFN,FHDFN=$O(^FHPT("B",FHZ115,""))
"RTN","FHOMUTL",36,0)
 I '$D(^DPT(ZZDFN)) W !!,"DFN '",ZZDFN,"' NOT FOUND IN FILE 2",! Q
"RTN","FHOMUTL",37,0)
 I FHDFN="" W !!,"NO CORRESPONDING FHDFN"
"RTN","FHOMUTL",38,0)
 W !!," NAME: ",$P($G(^DPT(ZZDFN,0)),U,1)
"RTN","FHOMUTL",39,0)
 W !?2,"DFN: ",ZZDFN,!,"FHDFN: ",FHDFN,!
"RTN","FHOMUTL",40,0)
 Q
"RTN","FHOMUTL",41,0)
GETOPT ;Select outpatient for recurring meals
"RTN","FHOMUTL",42,0)
 S FHFIND=1 D ^FHOMDPA I FHDFN="" S FHFIND=0 Q
"RTN","FHOMUTL",43,0)
 I '$D(^FHPT(FHDFN,0)) S FHFIND=0 Q  ;W !!,"UNKNOWN SELECTION !"
"RTN","FHOMUTL",44,0)
 I $O(^FHPT(FHDFN,"OP",0))="" W !!,"NO RECURRING MEALS FOR THIS PERSON" S FHFIND=0 Q
"RTN","FHOMUTL",45,0)
 W ! D STDATE I STDT="" S FHFIND=0 Q
"RTN","FHOMUTL",46,0)
 Q
"RTN","FHOMUTL",47,0)
PATNAME ;Get name and demographics of patient/new person
"RTN","FHOMUTL",48,0)
 ;input variable: FHDFN
"RTN","FHOMUTL",49,0)
 S (FHDOB,FHBID,FHSEX,DFN)="" D GETZN
"RTN","FHOMUTL",50,0)
 I FILE="P" S FHPTNM=$P($G(^DPT(IEN,0)),U,1)
"RTN","FHOMUTL",51,0)
 I FILE="N" S FHPTNM=$P($G(^VA(200,IEN,0)),U,1)
"RTN","FHOMUTL",52,0)
 ;Get SSN,Age,DOB,Sex of patient/new person
"RTN","FHOMUTL",53,0)
 I FILE="P" D
"RTN","FHOMUTL",54,0)
 .S DFN=IEN
"RTN","FHOMUTL",55,0)
 .D PID^FHDPA S FHSSN=PID
"RTN","FHOMUTL",56,0)
 .S FHSEX=$P($G(^DPT(DFN,0)),U,2),FHDOB=$P($G(^DPT(DFN,0)),U,3)
"RTN","FHOMUTL",57,0)
 .S FHBID=BID
"RTN","FHOMUTL",58,0)
 I FILE="N" D
"RTN","FHOMUTL",59,0)
 .S IEN200=IEN,FHSSN=$P($G(^VA(200,IEN,1)),U,9)
"RTN","FHOMUTL",60,0)
 .S FHBID=$E(FHSSN,6,$L(FHSSN))
"RTN","FHOMUTL",61,0)
 .S FHSEX=$P($G(^VA(200,IEN,1)),U,2),FHDOB=$P($G(^VA(200,IEN,1)),U,3)
"RTN","FHOMUTL",62,0)
 S FHAGE="" D NOW^%DTC
"RTN","FHOMUTL",63,0)
 I FHDOB'="" S FHAGE=$E(%,1,3)-$E(FHDOB,1,3)-($E(%,4,7)<$E(FHDOB,4,7))
"RTN","FHOMUTL",64,0)
 Q
"RTN","FHOMUTL",65,0)
GETZN ;Get first piece of zero node in 115
"RTN","FHOMUTL",66,0)
 S FHPCZN=$P($G(^FHPT(FHDFN,0)),U,1),FILE=$E(FHPCZN,1)
"RTN","FHOMUTL",67,0)
 S IEN=$E(FHPCZN,2,99)
"RTN","FHOMUTL",68,0)
 Q
"RTN","FHOMUTL",69,0)
DIETVER ;Verify that diet selected is from the allowable diets in 119.9
"RTN","FHOMUTL",70,0)
 D DIETLST I $D(FHDIETS(FHDIET)) Q
"RTN","FHOMUTL",71,0)
 S FHDIET="" W *7," ==> NOT ALLOWED",! D DIETMSG Q
"RTN","FHOMUTL",72,0)
DIETHLP ;Display allowable diets from 119.9
"RTN","FHOMUTL",73,0)
 D DIETLST,DIETMSG Q
"RTN","FHOMUTL",74,0)
DIETLST ;Build list
"RTN","FHOMUTL",75,0)
 K FHDIETS,SPD S FHSPDTS="",SPD=$P($G(^FH(119.9,1,0)),U,2,6)
"RTN","FHOMUTL",76,0)
 S FHDEF=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHOMUTL",77,0)
 F A=1:1:5 S AB=$P(SPD,U,A) D
"RTN","FHOMUTL",78,0)
 .I AB="" Q
"RTN","FHOMUTL",79,0)
 .S FHDIETS(AB)=AB
"RTN","FHOMUTL",80,0)
 .S FHSPDTS=FHSPDTS_$P($G(^FH(111,AB,0)),U,1)_"^"
"RTN","FHOMUTL",81,0)
 Q
"RTN","FHOMUTL",82,0)
DIETMSG ;Display message
"RTN","FHOMUTL",83,0)
 W !?3,"You must select from the diets set up in the Site Parameters:"
"RTN","FHOMUTL",84,0)
 S AB="" F  S AB=$O(FHDIETS(AB)) Q:AB'>0  W !?3,$P($G(^FH(111,AB,0)),U)
"RTN","FHOMUTL",85,0)
 W ! Q
"RTN","FHOMUTL",86,0)
 Q
"RTN","FHOMUTL",87,0)
EXMSG ;Display message stating meal NOT ordered
"RTN","FHOMUTL",88,0)
 D TYPE
"RTN","FHOMUTL",89,0)
 W !!?3,FHMSGML," NOT ordered!",! H 2
"RTN","FHOMUTL",90,0)
 Q
"RTN","FHOMUTL",91,0)
OKMSG ;Display message stating meal ordered successfully
"RTN","FHOMUTL",92,0)
 D TYPE
"RTN","FHOMUTL",93,0)
 D PATNAME W !!?3,FHMSGML," ordered for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",94,0)
 Q
"RTN","FHOMUTL",95,0)
TYPE ;
"RTN","FHOMUTL",96,0)
 S FHMSGML=$S(FHMSG1="G":"Guest meal",FHMSG1="S":"Special meal",FHMSG1="R":"Recurring meal",FHMSG1="E":"Early/Late tray",FHMSG1="T":"Tubefeeding",1:"Additional order")
"RTN","FHOMUTL",97,0)
 Q
"RTN","FHOMUTL",98,0)
UPXMSG ;
"RTN","FHOMUTL",99,0)
 W !!?3,"Recurring meal NOT updated! ",! H 2
"RTN","FHOMUTL",100,0)
 Q
"RTN","FHOMUTL",101,0)
UPDMSG ;
"RTN","FHOMUTL",102,0)
 D PATNAME W !!?3,"Recurring meal updated for ",FHPTNM,"...",! H 2
"RTN","FHOMUTL",103,0)
 Q
"RTN","FHOMUTL",104,0)
SMSTAT ;Status of last special meal request
"RTN","FHOMUTL",105,0)
 S FHSMNUM=$O(^FHPT(FHDFN,"SM","B",""),-1) I FHSMNUM="" S FHSTAT="" Q
"RTN","FHOMUTL",106,0)
 I $E(FHSMNUM,1,7)'=DT S FHSTAT="" Q
"RTN","FHOMUTL",107,0)
 S FHSTAT=$P($G(^FHPT(FHDFN,"SM",FHSMNUM,0)),U,2)
"RTN","FHOMUTL",108,0)
 Q
"RTN","FHOMUTL",109,0)
RANGE ;Check for validity of range of numbers entered
"RTN","FHOMUTL",110,0)
 S FHCLST="",FLG="",X=FHNUM D TR^FH S FHNUM=X
"RTN","FHOMUTL",111,0)
 I FHNUM="A"!(FHNUM?1"A"1.2"L") S FHNUM="1-"_NUM
"RTN","FHOMUTL",112,0)
 F K=1:1 S K1=$P(FHNUM,",",K) Q:K1=""!(FLG="QUIT")  D
"RTN","FHOMUTL",113,0)
 .S K2=$S(K1["-":$P(K1,"-",2),1:+K1),K1=+K1 D CK I FLG="QUIT" Q
"RTN","FHOMUTL",114,0)
 .F K3=K1:1:K2 S FHCLST=FHCLST_K3_","
"RTN","FHOMUTL",115,0)
 Q
"RTN","FHOMUTL",116,0)
CK I K1<1!(K1>NUM)!(K1'?1N.N) D C1 Q
"RTN","FHOMUTL",117,0)
 I K2<1!(K2>NUM)!(K2'?1N.N) D C1 Q
"RTN","FHOMUTL",118,0)
 Q:K2'<K1
"RTN","FHOMUTL",119,0)
C1 W !,"  Enter numbers or range or ALL (E.G.,  1,3,4 or 3-5 or 1,3-5)" S FLG="QUIT",FHCLST="" Q
"RTN","FHOMUTL",120,0)
 Q
"RTN","FHOMUTL",121,0)
MSHOM ;Code MSG for outpatient orders
"RTN","FHOMUTL",122,0)
 D SITE^FH
"RTN","FHOMUTL",123,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",124,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",125,0)
 S FHOLOC=$G(^FH(119.6,FHLOC,"L",1,0))
"RTN","FHOMUTL",126,0)
 S FHOLOCNM=$P($G(^SC(FHOLOC,0)),U,1)
"RTN","FHOMUTL",127,0)
 S MSG(3)="PV1||O|"_FHOLOC_"^"_FHOLOCNM_"||||||||||||||||"
"RTN","FHOMUTL",128,0)
 Q
"RTN","FHOMUTL",129,0)
MSHCA ;Code Cancel/Discontinue for outpatient orders
"RTN","FHOMUTL",130,0)
 D NOW^%DTC S FHNOW=% K MSG S ACT="OC" D SITE^FH
"RTN","FHOMUTL",131,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHOMUTL",132,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHOMUTL",133,0)
 S DATE=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMUTL",134,0)
 S MSG(3)="ORC|"_ACT_"|"_FHORN_"^OR|"_FILL_"^FH|||||||||"_DUZ_"|||"_DATE_"|Dietetics Canceled order."
"RTN","FHOMUTL",135,0)
 Q
"RTN","FHOMUTL",136,0)
CONVC ;convert Amount/Unit in file 118.2, from "C" to "ML".
"RTN","FHOMUTL",137,0)
 F FHII=0:0 S FHII=$O(^FH(118.2,FHII)) Q:FHII'>0  D
"RTN","FHOMUTL",138,0)
 .S FHAU=$P(^FH(118.2,FHII,0),U,3)
"RTN","FHOMUTL",139,0)
 .I FHAU["C" S FHAF=$P(FHAU,"C",1),FHAS=$P(FHAU,"C",2) D
"RTN","FHOMUTL",140,0)
 ..S $P(^FH(118.2,FHII,0),U,3)=FHAF_"ML"_FHAS
"RTN","FHOMUTL",141,0)
 Q
"RTN","FHORD13")
0^12^B49207960
"RTN","FHORD13",1,0)
FHORD13 ; HISC/REL/NCA/RVD - Reprint Diet Label ;2/26/96  11:57
"RTN","FHORD13",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORD13",3,0)
 W @IOF,!!?21,"R E P R I N T   D I E T   L A B E L S"
"RTN","FHORD13",4,0)
F0 R !!,"Reprint by COMMUNICATION OFFICE, PATIENT, LOCATION or ALL? PATIENT// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="P" D TR^FH
"RTN","FHORD13",5,0)
 I $P("COMMUNICATION OFFICE",X,1)'="",$P("PATIENT",X,1)'="",$P("LOCATION",X,1)'="",$P("ALL",X,1)'="" W *7,!!,"  Answer with C, L, P or A" G F0
"RTN","FHORD13",6,0)
 S FHPR=$E(X,1),ALL=0,(FHX1,FHX2)="" G P0:FHPR?1"P",D2:FHPR?1"C",P1:FHPR?1"A"
"RTN","FHORD13",7,0)
W0 K DIC S DIC("A")="Select LOCATION: ",DIC="^FH(119.6,",DIC(0)="AEQM" W ! D ^DIC K DIC G KIL:"^"[X!$D(DTOUT),W0:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",8,0)
D2 K DIC S DIC("A")="Select COMMUNICATION OFFICE: ",DIC="^FH(119.73,",DIC(0)="AEMQ" W ! D ^DIC G KIL:"^"[X!$D(DTOUT),D2:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",9,0)
P0 S FHALL=1 D ^FHOMDPA I '$G(FHDFN),FHX1'="" G P1
"RTN","FHORD13",10,0)
 Q:'FHDFN
"RTN","FHORD13",11,0)
 S ADM="*"
"RTN","FHORD13",12,0)
 I 'DFN,$G(FHDFN) G PPT
"RTN","FHORD13",13,0)
 I $D(^DPT(DFN,.1)) S WARD=$G(^DPT(DFN,.1)) D
"RTN","FHORD13",14,0)
 .I $G(^DPT("CN",WARD,DFN)) S ADM=$G(^DPT("CN",WARD,DFN))
"RTN","FHORD13",15,0)
PPT S FHX1=$G(FHX1)_FHDFN_"^",FHX2=$G(FHX2)_ADM_"^" I $L(FHX1)<231,$L(FHX2)<231 G P0
"RTN","FHORD13",16,0)
 G:FHX1="" KIL
"RTN","FHORD13",17,0)
P1 ;
"RTN","FHORD13",18,0)
 W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHORD13",19,0)
 Q:$D(DIRUT)  S LABSTART=Y
"RTN","FHORD13",20,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select LABEL Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD13",21,0)
 I $D(IO("Q")) S FHPGM="Q1^FHORD13",FHLST="FHX1^FHX2^FHPR^LABSTART" D EN2^FH G KIL
"RTN","FHORD13",22,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHORD13",23,0)
Q1 ; Reprint the Diet Labels
"RTN","FHORD13",24,0)
 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1 S S2=LAB=2*5+36 D NOW^%DTC S NOW=%
"RTN","FHORD13",25,0)
 S COUNT=0,LINE=1
"RTN","FHORD13",26,0)
 S DTP=NOW D DTP^FH,^FHDEV G:FHX1>0 Q2
"RTN","FHORD13",27,0)
 S WRD=-FHX1 K ^TMP($J)
"RTN","FHORD13",28,0)
 F K1=0:0 S K1=$O(^FH(119.6,K1)) Q:K1<1  S X=^(K1,0) D F1
"RTN","FHORD13",29,0)
 S RM="" F  S RM=$O(^TMP($J,"DL",RM)) Q:RM=""  F DFN=0:0 S DFN=$O(^TMP($J,"DL",RM,DFN)) Q:DFN<1  S ADM=^(DFN) S FHZ115="P"_DFN D CHECK^FHOMDPA Q:FHDFN=""  D:ADM LST
"RTN","FHORD13",30,0)
 ;process outpatient
"RTN","FHORD13",31,0)
 D OUTP
"RTN","FHORD13",32,0)
 D PROUT
"RTN","FHORD13",33,0)
 I LAB>2 D DPLL^FHLABEL G KIL
"RTN","FHORD13",34,0)
 I LAB<3 F K7=1:1:18 W !
"RTN","FHORD13",35,0)
 G KIL
"RTN","FHORD13",36,0)
 ;
"RTN","FHORD13",37,0)
F1 I FHPR="C" S KK=$P(X,"^",8) I WRD,KK'=WRD Q
"RTN","FHORD13",38,0)
 I FHPR="L" S KK=$P(X,"^",1) I WRD,K1'=WRD Q
"RTN","FHORD13",39,0)
 S P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD13",40,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",K1,FHDFN)) Q:FHDFN<1  D
"RTN","FHORD13",41,0)
 .D PATNAME^FHOMUTL Q:DFN=""
"RTN","FHORD13",42,0)
 .S ADM=$G(^FHPT("AW",K1,FHDFN))
"RTN","FHORD13",43,0)
 .S RM=$G(^DPT(DFN,.101))
"RTN","FHORD13",44,0)
 .S:RM="" RM="***"
"RTN","FHORD13",45,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,K1,0)),1:"")
"RTN","FHORD13",46,0)
 .S R0=$S(RE:$P($G(^FH(119.6,K1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORD13",47,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORD13",48,0)
 .S ^TMP($J,"DL",P0_"~"_R0_"~"_RM,DFN)=ADM Q
"RTN","FHORD13",49,0)
 Q
"RTN","FHORD13",50,0)
 ;
"RTN","FHORD13",51,0)
Q2 F K7=1:1 S FHDFN=$P(FHX1,"^",K7) Q:FHDFN<1  D PATNAME^FHOMUTL S ADM=$P(FHX2,"^",K7) D:$G(ADM) LST I '$G(ADM) S FHDFNSAV(FHDFN)=FHDFN
"RTN","FHORD13",52,0)
 ;process outpatient
"RTN","FHORD13",53,0)
 D OUTP
"RTN","FHORD13",54,0)
 D PROUT
"RTN","FHORD13",55,0)
 I LAB>2 D DPLL^FHLABEL G KIL
"RTN","FHORD13",56,0)
Q3 I LAB<3 F K7=1:1:18 W !
"RTN","FHORD13",57,0)
 G KIL
"RTN","FHORD13",58,0)
 ;
"RTN","FHORD13",59,0)
LST ;
"RTN","FHORD13",60,0)
 Q:'$D(^FHPT(FHDFN,"A",ADM,0))  S X0=^(0)
"RTN","FHORD13",61,0)
 S FHORD=$P(X0,"^",2),X1=$P(X0,"^",5) Q:FHORD<1
"RTN","FHORD13",62,0)
 S W1=$P(X0,"^",8),W1=$P($G(^FH(119.6,+W1,0)),"^",1),R1=$G(^DPT(DFN,.101))
"RTN","FHORD13",63,0)
 Q:'$D(^DPT(DFN,0))  S Y0=^(0) D PID^FHDPA
"RTN","FHORD13",64,0)
 S W1=$E(W1,1,15),N1=$E($P(Y0,"^",1),1,22)
"RTN","FHORD13",65,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0))
"RTN","FHORD13",66,0)
 S (Y,X1)="" G:X="" L1 S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORD13",67,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") G:%<1 L1 S Y=$P($E(FHDU,%,999),";",1) G L1
"RTN","FHORD13",68,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORD13",69,0)
 S IS=$P(X0,"^",10),X1=$P(X,"^",8) I IS S IS=^FH(119.4,IS,0),X1=X1_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORD13",70,0)
 ;
"RTN","FHORD13",71,0)
L1 I LAB>2 D LL Q
"RTN","FHORD13",72,0)
 W !,$E(N1,1,S2-5-$L(W1)),?(S2-3-$L(W1)),W1,!,BID W @FHIO("EON") W ?(S2-3\2),X1 W @FHIO("EOF") W ?(S2-3-$L(R1)),R1 W @FHIO("EON") I $L(Y)<S2 W:LAB=2 ! W !!,Y,!!
"RTN","FHORD13",73,0)
 E  S L=$S($L($P(Y,",",1,3))<S2:3,1:2) W !!,$P(Y,",",1,L) W:LAB=2 ! W !,$E($P(Y,",",L+1,5),2,99),!
"RTN","FHORD13",74,0)
 W @FHIO("EOF") W:LAB=2 ?(S2-20),DTP,!! Q
"RTN","FHORD13",75,0)
 ;
"RTN","FHORD13",76,0)
OUTP ;process outpatient dat
"RTN","FHORD13",77,0)
 S (R1,FHW1SAV,FHFHPSAV)=""
"RTN","FHORD13",78,0)
 I FHPR="L" S FHW1SAV=-FHX1
"RTN","FHORD13",79,0)
 I FHPR="C" S FHFHPSAV=-FHX1
"RTN","FHORD13",80,0)
 S FHD1=DT-.00001,FHD2=DT+.99999
"RTN","FHORD13",81,0)
 ;next recurring
"RTN","FHORD13",82,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>FHD2)  D
"RTN","FHORD13",83,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",84,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHORD13",85,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHORD13",86,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHORD13",87,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHORD13",88,0)
 ...I FHSTAT="C" Q
"RTN","FHORD13",89,0)
 ...S FHDIET1=$P(FHKDAT,U,7)
"RTN","FHORD13",90,0)
 ...S FHDIET2=$P(FHKDAT,U,8)
"RTN","FHORD13",91,0)
 ...S FHDIET3=$P(FHKDAT,U,9)
"RTN","FHORD13",92,0)
 ...S FHDIET4=$P(FHKDAT,U,10)
"RTN","FHORD13",93,0)
 ...S FHDIET5=$P(FHKDAT,U,11)
"RTN","FHORD13",94,0)
 ...I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",95,0)
 ...I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",96,0)
 ...I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",97,0)
 ...S FHLOC="",FHRGS="OP"
"RTN","FHORD13",98,0)
 ...S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",99,0)
 ...I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",100,0)
 ...S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",101,0)
 ...D OUTW
"RTN","FHORD13",102,0)
 ;next guest
"RTN","FHORD13",103,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHORD13",104,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",105,0)
 ..I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",106,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHORD13",107,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHORD13",108,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHORD13",109,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",110,0)
 ..I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",111,0)
 ..S FHLOC=""
"RTN","FHORD13",112,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",113,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",114,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",115,0)
 ..D OUTW
"RTN","FHORD13",116,0)
 ;next SPECIAL
"RTN","FHORD13",117,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHORD13",118,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",119,0)
 ..I FHPR="P",'$D(FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",120,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHORD13",121,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHORD13",122,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",123,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHORD13",124,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHORD13",125,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHORD13",126,0)
 ..I $D(FHDFNSAV(FHDFN)),(FHDFN'=FHDFNSAV(FHDFN)) Q
"RTN","FHORD13",127,0)
 ..S FHLOC=""
"RTN","FHORD13",128,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHORD13",129,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHORD13",130,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHORD13",131,0)
 ..D OUTW
"RTN","FHORD13",132,0)
 Q
"RTN","FHORD13",133,0)
 ;
"RTN","FHORD13",134,0)
OUTW ;set all outpt data for printing
"RTN","FHORD13",135,0)
 D PATNAME^FHOMUTL
"RTN","FHORD13",136,0)
 S FHTC=""
"RTN","FHORD13",137,0)
 Q:'$D(^FH(119.6,FHW1,0))
"RTN","FHORD13",138,0)
 S P0=$P(^FH(119.6,FHW1,0),U,4)
"RTN","FHORD13",139,0)
 S P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD13",140,0)
 S FHW1N=$P(^FH(119.6,FHW1,0),U,1)
"RTN","FHORD13",141,0)
 S FHTC5=$P(^FH(119.6,FHW1,0),U,5)
"RTN","FHORD13",142,0)
 S FHTC6=$P(^FH(119.6,FHW1,0),U,6)
"RTN","FHORD13",143,0)
 I $G(FHTC5),$D(^FH(119.72,FHTC5,0)) S FHTC=FHTC_$P(^FH(119.72,FHTC5,0),U,2)
"RTN","FHORD13",144,0)
 I $G(FHTC6),$D(^FH(119.72,FHTC6,0)) S FHTC=FHTC_$P(^FH(119.72,FHTC6,0),U,2)
"RTN","FHORD13",145,0)
 S:$G(FHDIET) FHDIET=$P(^FH(111,FHDIET,0),U,7)
"RTN","FHORD13",146,0)
 I $G(FHDIET1) S FHDIET1=$P(^FH(111,FHDIET1,0),U,7) D
"RTN","FHORD13",147,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET1 Q
"RTN","FHORD13",148,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET1
"RTN","FHORD13",149,0)
 I $G(FHDIET2) S FHDIET2=$P(^FH(111,FHDIET2,0),U,7) D
"RTN","FHORD13",150,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET2 Q
"RTN","FHORD13",151,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET2
"RTN","FHORD13",152,0)
 I $G(FHDIET3) S FHDIET3=$P(^FH(111,FHDIET3,0),U,7) D
"RTN","FHORD13",153,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET3 Q
"RTN","FHORD13",154,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET3
"RTN","FHORD13",155,0)
 I $G(FHDIET4) S FHDIET4=$P(^FH(111,FHDIET4,0),U,7) D
"RTN","FHORD13",156,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET4 Q
"RTN","FHORD13",157,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET4
"RTN","FHORD13",158,0)
 I $G(FHDIET5) S FHDIET5=$P(^FH(111,FHDIET5,0),U,7) D
"RTN","FHORD13",159,0)
 .I FHDIET="" S FHDIET=FHDIET_FHDIET5 Q
"RTN","FHORD13",160,0)
 .I FHDIET'="" S FHDIET=FHDIET_", "_FHDIET5
"RTN","FHORD13",161,0)
 S ^TMP($J,"OUT",P0_"~"_$E(FHW1N,1,20)_"~"_$E(FHPTNM,1,26),FHDFN)=FHPTNM_"^"_FHW1N_"^"_FHBID_"^"_FHDIET_"^"_FHTC
"RTN","FHORD13",162,0)
 Q
"RTN","FHORD13",163,0)
 ;
"RTN","FHORD13",164,0)
PROUT ;print outptlabels
"RTN","FHORD13",165,0)
 S (X1,RM)=""
"RTN","FHORD13",166,0)
 F  S RM=$O(^TMP($J,"OUT",RM)) Q:RM=""  D
"RTN","FHORD13",167,0)
 .F FHDFN=0:0 S FHDFN=$O(^TMP($J,"OUT",RM,FHDFN)) Q:FHDFN'>0  D
"RTN","FHORD13",168,0)
 ..S FHOU=^TMP($J,"OUT",RM,FHDFN)
"RTN","FHORD13",169,0)
 ..S N1=$P(FHOU,U,1)
"RTN","FHORD13",170,0)
 ..S W1=$P(FHOU,U,2)
"RTN","FHORD13",171,0)
 ..S BID=$P(FHOU,U,3)
"RTN","FHORD13",172,0)
 ..S (Y,FHDIET)=$P(FHOU,U,4)
"RTN","FHORD13",173,0)
 ..S X1=$P(FHOU,U,5)
"RTN","FHORD13",174,0)
 ..D L1
"RTN","FHORD13",175,0)
 Q
"RTN","FHORD13",176,0)
 ;
"RTN","FHORD13",177,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHORD13",178,0)
 Q
"RTN","FHORD13",179,0)
LL D LAB^FHLABEL Q
"RTN","FHORD2")
0^13^B9794124
"RTN","FHORD2",1,0)
FHORD2 ; HISC/REL/NCA - Review Diet Orders ;11/7/92  09:57 
"RTN","FHORD2",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORD2",3,0)
F0 S ALL=0 D ^FHDPA G KIL:'DFN,KIL:'FHDFN,F0:'$D(^DGPM(ADM,0))
"RTN","FHORD2",4,0)
 S DTP=$P(^DGPM(ADM,0),"^",1) D DTP^FH
"RTN","FHORD2",5,0)
F01 W !!,"List Orders from Date/Time: "_DTP_" // " R X:DTIME G:'$T!(X["^") KIL S:X="" Y=0 I X'="" S %DT="EXTS" D ^%DT G:Y<1 F01
"RTN","FHORD2",6,0)
 S D4=Y D CUR^FHORD7 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHORD2",7,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) W !,"Comment: ",^(1)
"RTN","FHORD2",8,0)
 S X1=^FHPT(FHDFN,"A",ADM,0),DTP=$P(X1,"^",3) I DTP D DTP^FH W !,"Expires: ",DTP
"RTN","FHORD2",9,0)
 S TF=$P(X1,"^",4) G:TF<1 F1
"RTN","FHORD2",10,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHORD2",11,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHORD2",12,0)
 D DTP^FH W !!,"Tubefeed Ordered: ",DTP
"RTN","FHORD2",13,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHORD2",14,0)
 W !,"Total Quantity: ",TQU," ml",?42,"Total KCAL: ",CAL
"RTN","FHORD2",15,0)
 W:COM'="" !,"Comment: ",COM
"RTN","FHORD2",16,0)
F1 S CT=0 F K=0:0 S K=$O(^FHPT(FHDFN,"A",ADM,"OO",K)) Q:K<1  S X=^(K,0) I $P(X,"^",2)'<D4,$P(X,"^",5)="S" D L1
"RTN","FHORD2",17,0)
 S N1=0 F FHORD=0:0 S FHORD=$O(^FHPT(FHDFN,"A",ADM,"DI",FHORD)) Q:FHORD<1  S X=^(FHORD,0) D LST
"RTN","FHORD2",18,0)
 I 'N1 W !!,"No Diet Orders Entered",! G F0
"RTN","FHORD2",19,0)
 D TLN G F0
"RTN","FHORD2",20,0)
KIL K %,%DT,A1,ADM,ALL,C,CAL,COM,CT,D1,D2,D3,D4,DA,DTP,FHDFN,DFN,FHDU,FHLD,FHOR,I,K,KK,N1,NOW,FHORD,FHWF,FHPV,POP,TYP,TF,TF2,TQU,TUN,STR,QUA,WARD,X,X1,X2,XY,Y Q
"RTN","FHORD2",21,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHORD2",22,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORD2",23,0)
 W !,"Product: ",$P($G(^FH(118.2,TUN,0)),"^",1),", ",$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")," Str., ",QUA Q
"RTN","FHORD2",24,0)
L1 I 'CT W !!,"Saved Additional Orders:",! S CT=1
"RTN","FHORD2",25,0)
 S DTP=$P(X,"^",2) D DTP^FH W !,DTP,?20,$P(X,"^",3) Q
"RTN","FHORD2",26,0)
LST S COM=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) Q:$P(X,"^",9)<D4
"RTN","FHORD2",27,0)
 I 'N1 W !!,"    Effective         Expires         Type  Order",!
"RTN","FHORD2",28,0)
 S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7),D1=$P(X,"^",9),D2=$P(X,"^",10),TYP=$P(X,"^",8),D3=$P(X,"^",12),N1=N1+1
"RTN","FHORD2",29,0)
 S DTP=D1 D DTP^FH W !,DTP I D2 S DTP=D2 D DTP^FH W ?20,DTP
"RTN","FHORD2",30,0)
 W ?40,TYP,?44 D ORD I $L(Y)<36 W Y
"RTN","FHORD2",31,0)
 E  W $P(Y,", ",1,3) W:$P(Y,", ",4)'="" ",",!?44,$P(Y,", ",4,5)
"RTN","FHORD2",32,0)
 W:COM'="" !?44,COM Q
"RTN","FHORD2",33,0)
ORD S Y="" I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORD2",34,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORD2",35,0)
 Q
"RTN","FHORD2",36,0)
TLN W !!?24,"----- Diet Orders Time Line -----",!,"    Effective     Type  Order",!
"RTN","FHORD2",37,0)
 F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1  S FHORD=$P(^(KK,0),"^",2) D T1
"RTN","FHORD2",38,0)
 Q
"RTN","FHORD2",39,0)
T1 S X=^FHPT(FHDFN,"A",ADM,"DI",FHORD,0) Q:$P(X,"^",9)<D4
"RTN","FHORD2",40,0)
 S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7),TYP=$P(X,"^",8)
"RTN","FHORD2",41,0)
 S DTP=KK D DTP^FH W !,DTP,?20,TYP,?24 D ORD I $L(Y)<56 W Y Q
"RTN","FHORD2",42,0)
 W $P(Y,", ",1,4),",",!?24,$P(Y,", ",5) Q
"RTN","FHORD6")
0^14^B21232580
"RTN","FHORD6",1,0)
FHORD6 ; HISC/REL/NCA/JH/RTK - Diet Inquiry ;5/3/01  11:04
"RTN","FHORD6",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORD6",3,0)
 ;S ALL=0 D ^FHDPA G:'DFN KIL
"RTN","FHORD6",4,0)
 ;S FHALL=1 D ^FHOMDPA I 'DFN!('FHDFN) G KIL
"RTN","FHORD6",5,0)
 S FHALL=1 D ^FHOMDPA I 'FHDFN G KIL
"RTN","FHORD6",6,0)
 I FHDFN,DFN="" D ^FHOMPP Q  ;profile for file #200 outpatients
"RTN","FHORD6",7,0)
 I FHDFN,$G(^DPT(DFN,.1))="" D ^FHOMPP Q  ;profile for file #2 outpts
"RTN","FHORD6",8,0)
 K IOP S %ZIS="MQ",%ZIS("B")="HOME" W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD6",9,0)
 I $D(IO("Q")) S FHPGM="F0^FHORD6",FHLST="FHDFN^DFN^PID^ADM" D EN2^FH G KIL
"RTN","FHORD6",10,0)
 U IO D F0 D ^%ZISC K %ZIS,IOP G FHORD6
"RTN","FHORD6",11,0)
F0 ; Display Diet
"RTN","FHORD6",12,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,QT=""
"RTN","FHORD6",13,0)
 S WARD=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",8) S:WARD WARD=$P($G(^FH(119.6,WARD,0)),"^",1)
"RTN","FHORD6",14,0)
 S Y(0)=^DPT(DFN,0),SEX=$P(Y(0),"^",2),DOB=$P(Y(0),"^",3)
"RTN","FHORD6",15,0)
 S AGE=$E(NOW,1,3)-$E(DOB,1,3)-($E(NOW,4,7)<$E(DOB,4,7)),X=$P($G(^DPT(DFN,.101)),"^",1),RM=$E(WARD,1,15) S:X'="" RM=RM_"/"_X
"RTN","FHORD6",16,0)
 S QT="",PG=0 D HDR
"RTN","FHORD6",17,0)
 D ALG^FHCLN I ALG'="" W !!,"Allergies: ",ALG
"RTN","FHORD6",18,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0),M=$P(X,"^",2) S:M="A" M="BNE" D SP
"RTN","FHORD6",19,0)
 I $O(N(""))="" W !!,"No Food Preferences on file",! G A0
"RTN","FHORD6",20,0)
 W !!,"Food Preferences Currently on file",!!?23,"Likes",?57,"Dislikes",!
"RTN","FHORD6",21,0)
 W ! S (M,MM)="" F  S M=$O(N(M)) Q:M=""  I $D(N(M)) W $P(M,"~",2) D  Q:QT="^"  S MM=M ;P32
"RTN","FHORD6",22,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M,"L",P1)) S X1=$S(P1>0:N(M,"L",P1),1:"") S:P2'="" P2=$O(N(M,"D",P2)) S X2=$S(P2>0:N(M,"D",P2),1:"") Q:P1=""&(P2="")  D W0 Q:QT="^"  W:MM'=M ! ;P32
"RTN","FHORD6",23,0)
 .  Q
"RTN","FHORD6",24,0)
 W ! K L,N,M,M1,M2
"RTN","FHORD6",25,0)
 G:QT="^" KIL ;P32
"RTN","FHORD6",26,0)
A0 S X(0)=^FHPT(FHDFN,"A",ADM,0),X=$P(X(0),"^",10) G:X="" F1
"RTN","FHORD6",27,0)
 D:$Y>(IOSL-3) HDR G:QT="^" KIL W !!,"Isolation/Precaution Type is ",$P($G(^FH(119.4,X,0)),"^",1)
"RTN","FHORD6",28,0)
F1 D CUR^FHORD7 D:$Y>(IOSL-6) HDR G:QT="^" KIL W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHORD6",29,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) S COM=^(1) W:COM'="" !,"Comment: ",COM
"RTN","FHORD6",30,0)
 S TYP=$P(X,"^",8) I TYP'="" W !,"Service: ",$S(TYP="T":"Tray",TYP="D":"Dining Room",1:"Cafeteria")
"RTN","FHORD6",31,0)
 S DTP=$P(X(0),"^",3) I DTP D DTP^FH W !,"Expires: ",DTP
"RTN","FHORD6",32,0)
 S TF=$P(X(0),"^",4) G:TF<1 F2
"RTN","FHORD6",33,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHORD6",34,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHORD6",35,0)
 D DTP^FH W !!,"Tubefeed Ordered: ",DTP
"RTN","FHORD6",36,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHORD6",37,0)
 W !,"Total Quantity: ",TQU," ml",?42,"Total KCAL: ",CAL
"RTN","FHORD6",38,0)
 W:COM'="" !,"Comment: ",COM
"RTN","FHORD6",39,0)
F2 S NO=$P(X(0),"^",7),Y=$S('NO:"",1:^FHPT(FHDFN,"A",ADM,"SF",NO,0)) D:$Y>(IOSL-3) HDR G:QT="^" KIL
"RTN","FHORD6",40,0)
 S L=$P(Y,"^",4) W !!,"Supplemental Feeding: ",$S('L:"No Order",1:$P(^FH(118.1,L,0),"^",1)) G:'NO F3
"RTN","FHORD6",41,0)
 S DTP=$P(Y,"^",30) D DTP^FH W ?50,"Reviewed: ",DTP
"RTN","FHORD6",42,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$P(^FH(118,Z,0),"^",1)
"RTN","FHORD6",43,0)
 D:$Y>(IOSL-4) HDR G:QT="^" KIL F K1=1:1:3 I N(K1)'="" W !?5,$P("10am; 2pm; 8pm",";",K1),":",?13,N(K1)
"RTN","FHORD6",44,0)
F3 G ^FHORD61
"RTN","FHORD6",45,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHORD6",46,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORD6",47,0)
 W !,"Product: ",$P($G(^FH(118.2,TUN,0)),"^",1),", ",$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")," Str., ",QUA Q
"RTN","FHORD6",48,0)
SP S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHORD6",49,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHORD6",50,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHORD6",51,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHORD6",52,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHORD6",53,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHORD6",54,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHORD6",55,0)
 Q
"RTN","FHORD6",56,0)
W0 I X1'="" W ?12 S X=X1 D W1 S X1=X
"RTN","FHORD6",57,0)
 I X2'="" W ?46 S X=X2 D W1 S X2=X
"RTN","FHORD6",58,0)
 Q:X1=""&(X2="")  D:$Y'<(IOSL-2) HDR Q:QT="^"  W ! G W0 ;P32
"RTN","FHORD6",59,0)
W1 I $L(X)<34 W X S X="" Q
"RTN","FHORD6",60,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHORD6",61,0)
 W $E(X,1,KK-2) S X=$E(X,KK+1,999) Q
"RTN","FHORD6",62,0)
PAUSE ; Pause For Scroll
"RTN","FHORD6",63,0)
 I $E(IOST,1,2)="C-",PG R !!,"Press return to continue  ",YN:DTIME S:'$T!(YN["^") QT="^" Q:QT="^"  I "^"'[YN W !,"Enter a RETURN to Continue." G PAUSE
"RTN","FHORD6",64,0)
 Q
"RTN","FHORD6",65,0)
HDR ; Print Header
"RTN","FHORD6",66,0)
 D PAUSE Q:QT="^"
"RTN","FHORD6",67,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORD6",68,0)
 W !,PID,?16,$P(Y(0),"^",1),?48,SEX," Age ",AGE,?(79-$L(RM)),RM Q
"RTN","FHORD6",69,0)
KIL ; Final variable kill
"RTN","FHORD6",70,0)
 K %,%H,%I,%T,%ZIS,A1,ADM,AGE,ALG,ALL,BAG,C,CAL,COM,CON,CT,D3,DA,DAS,FHDU,FHDFN,DFN,DOB,DTP,FHOR,FHLD,I,IOP,K,K1,K2,KK,L,L1,LST,MEAL,N,NO,NOW,FHORD,FHWF,FHPV
"RTN","FHORD6",71,0)
 K POP,Q,QUA,QT,QTY,RM,SEX,PID,BID,STR,TYP,TF,TF2,TIM,TQU,TUN,WARD,X,X1,X2,XY,Y,YN,Z,Z1 Q
"RTN","FHORD81")
0^15^B37486127
"RTN","FHORD81",1,0)
FHORD81 ; HISC/REL/NCA - Diet Order Lists (cont) ;11/30/00  13:55
"RTN","FHORD81",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORD81",3,0)
 K C,^TMP("FH",$J) F L=0:0 S L=$O(^FH(118,L)) Q:L<1  I '$D(^FH(118,L,"I")) S C(L)=$P(^(0),"^",1)
"RTN","FHORD81",4,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,X1=DT,X2=-14 D C^%DTC S OLN=+X S X1=NOW,X2=-3 D C^%DTC S OLD=+X
"RTN","FHORD81",5,0)
 S X1=DT,X2=2 D C^%DTC S K3=+X
"RTN","FHORD81",6,0)
 F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0) D F0
"RTN","FHORD81",7,0)
 S (PG,REC)=0,NXW="" F  S NXW=$O(^TMP("FH",$J,NXW)) Q:NXW=""  F W1=0:0 S W1=$O(^TMP("FH",$J,NXW,W1)) Q:W1<1  D F2
"RTN","FHORD81",8,0)
 ;
"RTN","FHORD81",9,0)
OUTP ;Outpatient data
"RTN","FHORD81",10,0)
 D GETOUT^FHOMRBL1
"RTN","FHORD81",11,0)
 S (ADM,DTP,FHPTSA,RM,FHLSAV,FHI)=""
"RTN","FHORD81",12,0)
 F  S FHI=$O(^TMP($J,"FH",FHI)) Q:FHI=""  D
"RTN","FHORD81",13,0)
 .S FHJ="" F  S FHJ=$O(^TMP($J,"FH",FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORD81",14,0)
 ..S FHPTSA=FHJ
"RTN","FHORD81",15,0)
 ..F FHK=0:0 S FHK=$O(^TMP($J,"FH",FHI,FHJ,FHK)) Q:FHK'>0  D
"RTN","FHORD81",16,0)
 ...S FHDAT=""
"RTN","FHORD81",17,0)
 ...S FHL=$O(^TMP($J,"FH",FHI,FHJ,FHK,0))
"RTN","FHORD81",18,0)
 ...I $G(FHL) D REC Q
"RTN","FHORD81",19,0)
 ...D PROC
"RTN","FHORD81",20,0)
 W ! Q
"RTN","FHORD81",21,0)
 ;
"RTN","FHORD81",22,0)
PROC ;process/print
"RTN","FHORD81",23,0)
 S FHPLD=0
"RTN","FHORD81",24,0)
 S:FHDAT="" FHDAT=^TMP($J,"FH",FHI,FHJ,FHK)
"RTN","FHORD81",25,0)
 S FHCAT=$P(FHDAT,U,1)
"RTN","FHORD81",26,0)
 S FHDFN=$P(FHDAT,U,2)
"RTN","FHORD81",27,0)
 S FHDIE=$P(FHDAT,U,3)
"RTN","FHORD81",28,0)
 S FHSTA=$P(FHDAT,U,4)
"RTN","FHORD81",29,0)
 S FHMEAL=$P(FHDAT,U,5)
"RTN","FHORD81",30,0)
 S FHLOC=$P(FHDAT,U,6)
"RTN","FHORD81",31,0)
 S (FHSERT,FHSERC,FHSERD,FHSER)=""
"RTN","FHORD81",32,0)
 I $G(FHLOC),$D(^FH(119.6,FHLOC,0)) D
"RTN","FHORD81",33,0)
 .S:$P(^FH(119.6,FHLOC,0),U,5) FHSERT="T"
"RTN","FHORD81",34,0)
 .S:$P(^FH(119.6,FHLOC,0),U,6) FHSERC="C"
"RTN","FHORD81",35,0)
 .S:$P(^FH(119.6,FHLOC,0),U,7) FHSERD="D"
"RTN","FHORD81",36,0)
 .S FHSER=FHSERT_FHSERC_FHSERD
"RTN","FHORD81",37,0)
 I (FHXX="C"),(WRD>0),(WRD'=FHSTA) Q
"RTN","FHORD81",38,0)
 I (FHXX="L"),(WRD>0),(WRD'=FHLOC) Q
"RTN","FHORD81",39,0)
 I (SER'="A"),(FHSER'[SER) Q
"RTN","FHORD81",40,0)
 I FHI'=FHLSAV S FHLSAV=FHI,WRDN=$E(FHI,3,$L(FHI)) D HDR
"RTN","FHORD81",41,0)
 S FHDIET=""
"RTN","FHORD81",42,0)
 D PATNAME^FHOMUTL
"RTN","FHORD81",43,0)
 I FHLSAV'=FHI S FHLSAV=FHI D HDR
"RTN","FHORD81",44,0)
 W !!,?13,$E($P(FHJ,"^",1),1,24),?38,FHBID,?67,FHSER
"RTN","FHORD81",45,0)
 I $Y>(IOSL-6) D HDR
"RTN","FHORD81",46,0)
 I $D(^FH(111,FHDIE,0)) S FHDIET=$P(^FH(111,FHDIE,0),U,7)
"RTN","FHORD81",47,0)
 S FHTYP=$S(FHCAT="OP":"Recurring",FHCAT="GM":"Guest",FHCAT="SM":"Special",1:"")
"RTN","FHORD81",48,0)
 S DTP=FHK D DTP^FH
"RTN","FHORD81",49,0)
 W !,?14,"Diet Order: ",FHDIET,?40,"Meal: ","(",FHMEAL,")"
"RTN","FHORD81",50,0)
 W !,?14,"Service Type: ",FHTYP,?40,"Date: ",DTP
"RTN","FHORD81",51,0)
 S FHDAIN=$O(^FHPT(FHDFN,""_FHCAT_"","B",FHK,0))
"RTN","FHORD81",52,0)
 I $G(FHDAIN),$D(^FHPT(FHDFN,""_FHCAT_"",FHDAIN,"TF")) D OUTF
"RTN","FHORD81",53,0)
 S FHPLD=1
"RTN","FHORD81",54,0)
 D:'$G(FHL) ^FHORD83
"RTN","FHORD81",55,0)
 Q
"RTN","FHORD81",56,0)
 ;
"RTN","FHORD81",57,0)
REC ;set/get recurring data
"RTN","FHORD81",58,0)
 F FHL=0:0 S FHL=$O(^TMP($J,"FH",FHI,FHJ,FHK,FHL)) Q:FHL'>0  D
"RTN","FHORD81",59,0)
 .S FHDAT=^TMP($J,"FH",FHI,FHJ,FHK,FHL)
"RTN","FHORD81",60,0)
 .D PROC
"RTN","FHORD81",61,0)
 D:$G(FHPLD) ^FHORD83
"RTN","FHORD81",62,0)
 Q
"RTN","FHORD81",63,0)
 ;
"RTN","FHORD81",64,0)
OUTF ;outpatient TF
"RTN","FHORD81",65,0)
 S REC=1
"RTN","FHORD81",66,0)
 S (FHTFPR,FHTFQU,FHTFST,FHTFCOM,FHTFTC,FHTFKD,FHTFCN)=""
"RTN","FHORD81",67,0)
 I $G(FHDAIN),$D(^FHPT(FHDFN,"OP",FHDAIN,3)) D
"RTN","FHORD81",68,0)
 .S FHRDAT3=$G(^FHPT(FHDFN,"OP",FHDAIN,3))
"RTN","FHORD81",69,0)
 .S FHTFCOM=$P(FHRDAT3,U,1)
"RTN","FHORD81",70,0)
 .S FHTFTC=$P(FHRDAT3,U,2)
"RTN","FHORD81",71,0)
 .S FHTFTKD=$P(FHRDAT3,U,3)
"RTN","FHORD81",72,0)
 .S FHTFCN=$P(FHRDAT3,U,5)
"RTN","FHORD81",73,0)
 .S:FHTFCN="C" FHTFCN="Cancelled"
"RTN","FHORD81",74,0)
 F FHTFDA=0:0 S FHTFDA=$O(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA)) Q:FHTFDA'>0  D
"RTN","FHORD81",75,0)
 .S FHTFDAT=$G(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA,0))
"RTN","FHORD81",76,0)
 .S FHTFPR=$P(FHTFDAT,U,1)
"RTN","FHORD81",77,0)
 .I $G(FHTFPR),$D(^FH(118.2,FHTFPR,0)) S FHTFPR=$P(^FH(118.2,FHTFPR,0),U,1)
"RTN","FHORD81",78,0)
 .S FHTFST=$P(FHTFDAT,U,2)
"RTN","FHORD81",79,0)
 .S:$G(FHTFST) FHTFST=$S(FHTFST=1:"1/4",FHTFST=2:"1/2",FHTFST=3:"3/4",FHTFST=4:"FULL",1:"")
"RTN","FHORD81",80,0)
 .S FHTFQU=$P(FHTFDAT,U,3)
"RTN","FHORD81",81,0)
 .S FHTFCC=$P(FHTFDAT,U,4)
"RTN","FHORD81",82,0)
 .;I FHAOT'="" S ZZ="  Additional Order: "_FHAOT_" "_FHAOCN_" By: "_FHAOC D LNE^FHORD82
"RTN","FHORD81",83,0)
 .;I FHELTT'="" S ZZ="  Early/Late Tray Time: "_FHELTT_"  Bag Meal: "_FHELTBM D LNE^FHOR82
"RTN","FHORD81",84,0)
 .I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",85,0)
 .W !,?5,"Tubefeed.:"
"RTN","FHORD81",86,0)
 .S ZZ=FHTFCOM_"  TF Total MLs: "_FHTFTC_"  TF Total KCALS/Day: "_FHTFTKD_" "_FHTFCN W ZZ
"RTN","FHORD81",87,0)
 .I FHTFPR'="" D
"RTN","FHORD81",88,0)
 ..I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",89,0)
 ..W !,?5
"RTN","FHORD81",90,0)
 ..S ZZ="TF Product: "_FHTFPR_"  TF Strength: "_FHTFST_"  TF Quantity: "_FHTFQU
"RTN","FHORD81",91,0)
 ..W ZZ
"RTN","FHORD81",92,0)
 ..I $Y>(IOSL-6) D LNE^FHORD82
"RTN","FHORD81",93,0)
 ..W !,?5
"RTN","FHORD81",94,0)
 ..S ZZ="TF Product ML/Day: "_FHTFCC_" "_FHTFCN
"RTN","FHORD81",95,0)
 ..W ZZ
"RTN","FHORD81",96,0)
 Q
"RTN","FHORD81",97,0)
F0 ;
"RTN","FHORD81",98,0)
 I $P(X,U,3)="O" Q
"RTN","FHORD81",99,0)
 I FHXX="C" S K1=$P(X,"^",8) I WRD,K1'=WRD Q
"RTN","FHORD81",100,0)
 I FHXX="L" S K1=$P(X,"^",1) I WRD,W1'=WRD Q
"RTN","FHORD81",101,0)
 S K1=$S(FHXX="W":"",K1<1:99,K1<10:"0"_K1,1:K1),P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD81",102,0)
 S WRDN=$P(^FH(119.6,W1,0),"^",1),^TMP("FH",$J,K1_P0_$E(WRDN,1,26),W1)="" Q
"RTN","FHORD81",103,0)
F2 S WRDN=$P(^FH(119.6,W1,0),"^",1)
"RTN","FHORD81",104,0)
 K ^TMP($J) F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  S ADM=^(FHDFN) D RM
"RTN","FHORD81",105,0)
 Q:'$D(^TMP($J))  S NX="" D HDR
"RTN","FHORD81",106,0)
L2 S NX=$O(^TMP($J,NX)) I NX="" W ! Q
"RTN","FHORD81",107,0)
 S FHDFN=""
"RTN","FHORD81",108,0)
L3 ; Get Next Patient data
"RTN","FHORD81",109,0)
 S FHDFN=$O(^TMP($J,NX,FHDFN)) G:FHDFN="" L2 S ADM=^(FHDFN)
"RTN","FHORD81",110,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORD81",111,0)
 G:ADM<1 L3 S Y(0)=^DPT(DFN,0) G:'$D(^DGPM(ADM,0)) L3
"RTN","FHORD81",112,0)
 G:'$D(^FHPT(FHDFN,"A",ADM,0)) L3 S LEN=0 D CUR^FHORD7 S MEAL=Y,X0=^FHPT(FHDFN,"A",ADM,0) S:$L(MEAL)>48 LEN=$L($E(MEAL,1,48),",")
"RTN","FHORD81",113,0)
 I SER'="A",$P(X0,"^",5)'=SER G L3
"RTN","FHORD81",114,0)
 D:$Y>(IOSL-6) HDR S DTP=$P(^DGPM(ADM,0),"^",1) D DTP^FH
"RTN","FHORD81",115,0)
 S RM=$S(SRT="R":NX,$D(^DPT(DFN,.101)):^(.101),1:"") D PID^FHDPA
"RTN","FHORD81",116,0)
 W !!,RM,?13,$E($P(Y(0),"^",1),1,24),?38,BID,?47,DTP
"RTN","FHORD81",117,0)
 S Y=$P(X0,"^",5) I Y'="" W ?67,Y
"RTN","FHORD81",118,0)
 D GET I Y'="" W !?13,"Nut. Status: ",Y S X=+X5 D DT W ?72,X
"RTN","FHORD81",119,0)
 D ALG^FHCLN I ALG'="" W !?13,"Allergies: " S ZZ=ALG D LNE^FHORD82
"RTN","FHORD81",120,0)
 I "NO ORDER"'[MEAL!'$P(X0,"^",4) W !?13,"Diet Order: ",$S(LEN:$P(MEAL,",",1,LEN-1)_",",1:MEAL)
"RTN","FHORD81",121,0)
 I  I FHORD S X=$P(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),"^",9) D DT W ?72,X D:FHLD'="" NPO W:LEN !?24,$P(MEAL,",",LEN,999) D COM
"RTN","FHORD81",122,0)
 G ^FHORD82
"RTN","FHORD81",123,0)
GET S Y="",X5=$O(^FHPT(FHDFN,"S",0)) Q:X5=""  S X5=^(X5,0)
"RTN","FHORD81",124,0)
 Q:$P(X5,"^",1)<$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",1)
"RTN","FHORD81",125,0)
 S Y=$P($G(^FH(115.4,+$P(X5,"^",2),0)),"^",2) Q
"RTN","FHORD81",126,0)
NPO S LST=0 F K1=0:0 S K1=$O(^FHPT(FHDFN,"A",ADM,"AC",K1)) Q:K1<1!(K1>NOW)  I $P(^(K1,0),"^",2)=FHORD S LST=K1
"RTN","FHORD81",127,0)
 W:LST<OLD "*" Q
"RTN","FHORD81",128,0)
COM ; List comment if any
"RTN","FHORD81",129,0)
 S COM=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) Q:COM=""  I $L(COM)<51 W !?16,COM Q
"RTN","FHORD81",130,0)
 F LEN=51:-1:1 Q:$E(COM,LEN)=" "
"RTN","FHORD81",131,0)
 W !?16,$E(COM,1,LEN-1) S COM=$E(COM,LEN+1,999)
"RTN","FHORD81",132,0)
 W:COM'="" !?19,COM Q
"RTN","FHORD81",133,0)
DT S X=$J(+$E(X,6,7),2)_"-"_$P("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"," ",+$E(X,4,5)) Q
"RTN","FHORD81",134,0)
RM ;
"RTN","FHORD81",135,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORD81",136,0)
 I SRT="R" S RM=$G(^DPT(DFN,.101))
"RTN","FHORD81",137,0)
 E  S RM=$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHORD81",138,0)
 S:RM="" RM=" " S ^TMP($J,RM,FHDFN)=ADM Q
"RTN","FHORD81",139,0)
HDR ;W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1,DTP=NOW D DTP^FH
"RTN","FHORD81",140,0)
 W @IOF S PG=PG+1,DTP=NOW D DTP^FH
"RTN","FHORD81",141,0)
 W !,DTP,?(67-$L(WRDN)\2),WRDN," DIET ORDERS",?72,"Page ",PG
"RTN","FHORD81",142,0)
 I SER'="A" S X=$S(SER="T":"TRAY",SER="C":"CAFETERIA",1:"DINING ROOM")_" Service Only" W !!?(79-$L(X)\2),X
"RTN","FHORD81",143,0)
 W !!,"Room",?13,"Patient",?39,"ID#",?48,"Admission Date",?66,"Svc",?71,"Ord Date" Q
"RTN","FHORT1")
0^16^B15603722
"RTN","FHORT1",1,0)
FHORT1 ; HISC/REL/NCA - Tubefeeding ;8/19/96  14:55 ;
"RTN","FHORT1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORT1",3,0)
 S ALL=0 D ^FHDPA G:'DFN KIL G:'FHDFN KIL
"RTN","FHORT1",4,0)
 ; Set HL7
"RTN","FHORT1",5,0)
 D E0 G:'DFN KIL G:'FHDFN KIL S TF=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",4) D:TF CAN^FHORT2 D ^FHORT11 G:'FHWF KIL
"RTN","FHORT1",6,0)
 D TF^FHWOR5 F FHTF=0:0 S FHTF=$O(TUN(FHTF)) Q:FHTF<1  S XX=$G(TUN(FHTF)) D TF1^FHWOR5
"RTN","FHORT1",7,0)
 D:$D(MSG) MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHORT1",8,0)
 G KIL
"RTN","FHORT1",9,0)
E0 ; Process tubefeeding
"RTN","FHORT1",10,0)
 S (NO,T1,T2,T3,T4)=0,(PRO,TFCOM)="" K TUN
"RTN","FHORT1",11,0)
 S TF=$P(^FHPT(FHDFN,"A",ADM,0),"^",4) G:TF<1 E3
"RTN","FHORT1",12,0)
 W !!,"An ACTVE TUBEFEEDING ORDER exists!" D DIS^FHORT2
"RTN","FHORT1",13,0)
 R !!,"Do You Wish to Cancel the Existing Tubefeeding and Enter a New One? Y// ",ANS:DTIME I '$T!(ANS="^")  W *7,!!,"No order entered!" S (DFN,FHDFN)="" Q
"RTN","FHORT1",14,0)
 S:ANS="" ANS="Y" S X=ANS D TR^FH S ANS=X
"RTN","FHORT1",15,0)
 I $P("YES",ANS,1)'="",$P("NO",ANS,1)'="" W !!,"Answer YES to Cancel Existing Order and Enter a New One.",!,"Answer NO to Edit the Existing Tubefeeding Order.",!,"Enter ""^"" to Exit Completely." G E0
"RTN","FHORT1",16,0)
 I ANS?1"Y".E K TUN S TFCOM="",NO=0
"RTN","FHORT1",17,0)
 I ANS'?1"Y".E W *7,!!,"Edit the Existing Tubefeeding." S TFCOM=$P(T,"^",5)
"RTN","FHORT1",18,0)
 I NO=5 W !!,*7,"There are FIVE products already!",!,"You may edit them, or delete a product before adding any."
"RTN","FHORT1",19,0)
E3 D ^FHORT10 Q:'DFN  Q:'FHDFN
"RTN","FHORT1",20,0)
 I $O(TUN(0))="" W !!,"No Tubefeeding Products selected." G AB
"RTN","FHORT1",21,0)
 S (TC,TK)=0 W !
"RTN","FHORT1",22,0)
 F K=0:0 S K=$O(TUN(K)) Q:K<1  D
"RTN","FHORT1",23,0)
 .S TC=TC+$P(TUN(K),"^",4)+$P(TUN(K),"^",5)
"RTN","FHORT1",24,0)
 .S TK=TK+$P(TUN(K),"^",6),STR=$P(TUN(K),"^",2)
"RTN","FHORT1",25,0)
 .S PRO=$P(TUN(K),"^",1)
"RTN","FHORT1",26,0)
 .W !,"Product: ",$P($G(^FH(118.2,PRO,0)),"^",1),", "
"RTN","FHORT1",27,0)
 .W $S(STR=4:"Full",STR=2:"1/2",STR=1:"1/4",1:"3/4"),", "
"RTN","FHORT1",28,0)
 .W $P(TUN(K),"^",3)
"RTN","FHORT1",29,0)
 .Q
"RTN","FHORT1",30,0)
 W !!,"Total Kcal: ",TK,?36,"Total Quantity: ",TC
"RTN","FHORT1",31,0)
 I TC>5000 W *7,!!,"WARNING: Total amount exceeds 5000ml: ",TC," ml",!,"Please Edit the Tubefeeding and Modify." G E3
"RTN","FHORT1",32,0)
E31 R !!,"Is this Correct ? Y// ",X:DTIME G:'$T!(X="^") AB S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G E31
"RTN","FHORT1",33,0)
 G:X'?1"Y".E E3
"RTN","FHORT1",34,0)
 G:TC>5000 AB
"RTN","FHORT1",35,0)
E4 W !,"Comment: ",$S(TFCOM'="":TFCOM_"// ",1:"") R X:DTIME G:'$T!(X[U) AB I X'?.ANP W *7," ??" G E4
"RTN","FHORT1",36,0)
 I $L(X)>160!(X?1"?".E) W *7,!,"Enter a comment of up to 160 characters" G E4
"RTN","FHORT1",37,0)
 I X'="" S TFCOM=X
"RTN","FHORT1",38,0)
E5 R !,"Cancel all current or future tray orders? Y// ",YN:DTIME G:'$T!(YN["^") AB S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7," Answer YES or NO" G E5
"RTN","FHORT1",39,0)
 S CAN=YN?1"Y".E
"RTN","FHORT1",40,0)
E6 Q:FHWF=2  R !,"Ok to Enter Order? Y// ",YN:DTIME G:'$T!(YN["^") AB S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7," Answer YES or NO" G E6
"RTN","FHORT1",41,0)
 G:YN'?1"Y".E AB Q
"RTN","FHORT1",42,0)
KIL K %,%H,%I,A,A1,A2,A3,A4,ADM,ALL,ANS,C,CAN,COM,TFCOM,CS,D1,D2,D3,D4,FHDFN,DFN,DX,E,PID,BID,DIC,FHD,FHDR,FHORD,FLG,FLG1,FHLD,FHOR,FHPAR,FHWF,FHPV,FHTF,FHDU,I,K,NO,NOW,DTP,P,P1,P2,POP
"RTN","FHORT1",43,0)
 K OLDT,FHSAV,FHORN,MNUM,PR,PRO,NU,QUA,S1,S2,S3,STR,ST1,ST3,T,T1,T2,T3,T4,TC,TK,TF,TF2,TP,TT,TU,TUN,TW,TYP,UNT,WARD,WRD,X,X1,X2,XX,Y,Y0,Y2,YN,YY,Z,Z1,ZZ Q
"RTN","FHORT1",44,0)
AB W *7,!!,"Tubefeeding Order TERMINATED - No order entered!" S (DFN,FHDFN)="" Q
"RTN","FHORT10")
0^17^B27436988
"RTN","FHORT10",1,0)
FHORT10 ; HISC/REL/NCA - Tubefeeding (cont) ;8/6/96  12:00
"RTN","FHORT10",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORT10",3,0)
E1 S FLG1=0 W ! K DIC S DIC="^FH(118.2,",DIC(0)="AEQM",STR=4,QUA=""
"RTN","FHORT10",4,0)
 S DIC("A")="Select Tubefeeding Product: " D ^DIC K DIC G AB:"^"[X!$D(DTOUT),E1:Y<1
"RTN","FHORT10",5,0)
E1A I $D(TUN(+Y)) S STR=$P(TUN(+Y),"^",2),QUA=$P(TUN(+Y),"^",3) S X=QUA D:X'="" FIX S QUA=X S:'STR STR=4
"RTN","FHORT10",6,0)
 E  G:NO>4 AB S $P(TUN(+Y),"^",1)=+Y,NO=NO+1 W !?5,"Product ",$P($G(^FH(118.2,+Y,0)),"^",1)," added"
"RTN","FHORT10",7,0)
E10 W !,"Product: ",$P($G(^FH(118.2,+Y,0)),"^",1)_"// " R X:DTIME G:'$T!(X=U) AB
"RTN","FHORT10",8,0)
 I X="" G E11
"RTN","FHORT10",9,0)
 I X="@" K TUN(+Y) S NO=NO-1 W "  Product including Strength and Quantity DELETED." S FLG1=1 G MORE
"RTN","FHORT10",10,0)
 I X["?" D HELP^FHORTR G E10
"RTN","FHORT10",11,0)
 S OLDT=$G(TUN(+Y))
"RTN","FHORT10",12,0)
 S Y=$$SRCH^FHORTR(X) I 'Y S Y=+OLDT G E10
"RTN","FHORT10",13,0)
 I +Y'=+OLDT D  G E1A
"RTN","FHORT10",14,0)
 .I '$D(TUN(+Y)) K TUN(+OLDT) W !!,$P($G(^FH(118.2,+OLDT,0)),"^",1)," Replaced With ",$P($G(^FH(118.2,+Y,0)),"^",1)
"RTN","FHORT10",15,0)
 .Q
"RTN","FHORT10",16,0)
E11 S T(0)=^FH(118.2,+Y,0),(FLG,FLG1)=0,S2="",TT=+Y
"RTN","FHORT10",17,0)
 I $E($P(T(0),"^",3),$L($P(T(0),"^",3)))?1"G" S FLG=1 G F0
"RTN","FHORT10",18,0)
E2 W !,"Strength: (1=1/4, 2=1/2, 3=3/4, 4=FULL): ",STR,"// " R X:DTIME G AB:'$T!(X=U),F0:X=""
"RTN","FHORT10",19,0)
 I X'?1N!(X<1)!(X>4) W *7,!!,"Enter 1 to 4 to indicate strength." G E2
"RTN","FHORT10",20,0)
 S STR=+X
"RTN","FHORT10",21,0)
F0 W !,"Enter quantity as 2000 K, 100 ML/HOUR, 8 OZ/TID, 500 ML/HR X 16, 20 GRAMS/DAY etc."
"RTN","FHORT10",22,0)
E3 W !,"Quantity: ",$S(QUA:QUA_"// ",1:"") R X:DTIME G:'$T!(X["^") AB S:X="" X=QUA G:"?"[X F5 D TR^FH
"RTN","FHORT10",23,0)
 I X=QUA G:STR=$P(TUN(TT),"^",2) MORE
"RTN","FHORT10",24,0)
 S (TC,TK,TP,TW)=0
"RTN","FHORT10",25,0)
 I $E(X,$L(X))="K" S X=X_"/QD"
"RTN","FHORT10",26,0)
 S A1="" F K=1:1:$L(X) S Z=$E(X,K) I Z'=" " S A1=A1_Z
"RTN","FHORT10",27,0)
 F K=1:1:$L(A1) Q:$E(A1,K)?1U
"RTN","FHORT10",28,0)
 S A2=$E(A1,K,99),A1=+$E(A1,1,K-1)
"RTN","FHORT10",29,0)
 I A2?1"G".E,'FLG W *7,!!,"Cannot enter ""GRAMS"" if AMT/UNIT is specified in ML's." G F0
"RTN","FHORT10",30,0)
 S A3=$P(A2,"/",2),A2=$P(A2,"/",1)
"RTN","FHORT10",31,0)
 I FLG S XX=$F("KCAL CC ML OZ TBSP",A2) I XX W *7,!!,"Enter quantity in powder form when AMT/UNIT is in Grams (e.g., # GMS, 1 PKG, or 1 U/Frequency)." G F0
"RTN","FHORT10",32,0)
 D:FLG GRAM F K=1:1:11 S S1=$P("KCAL CC ML OZ UNITS BOTTLES CANS PKG TBSP GMS GRAMS"," ",K) G:$P(S1,A2,1)="" F3
"RTN","FHORT10",33,0)
 G F5
"RTN","FHORT10",34,0)
F3 S S1=$S(K=1:1,K<4:2,K=4:3,K=9:5,K>9:6,1:4),A2=$P(A3,"X",1),A3=$P(A3,"X",2)
"RTN","FHORT10",35,0)
 G:A2'?1U.E F5 I $L(A2)=1,"DH"'[A2 G F5
"RTN","FHORT10",36,0)
 S S2=$F("DAY QD QH HOUR HR BID TID Q2H Q3H Q4H Q6H QID",A2) G:'S2 F5 S S2=$S(S2<8:1,S2<19:2,S2<23:3,S2<27:4,S2<31:5,S2<35:6,S2<39:7,1:8)
"RTN","FHORT10",37,0)
 S QUA=A1_" "_$P("KCAL ML OZ UNITS TBSP GM"," ",S1),QUA=QUA_" "_$P($T(F6),";",S2+2)
"RTN","FHORT10",38,0)
 S:A3'="" QUA=QUA_" X "_(+A3)_" "_$S(A3["F":"fdgs",1:"hrs")
"RTN","FHORT10",39,0)
 I S1=1 S DX=$P(T(0),"^",4) G:'DX F5 S TK=A1,TC=A1/DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHORT10",40,0)
 I S1=4 S DX=+$P(T(0),"^",3) G:'DX F5 S TC=A1*DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHORT10",41,0)
 S:S1=2 TC=A1 S:S1=3 TC=A1*29.5 S:S1=5 TC=A1*15 I S1=6 S TC=0,A3=0 G C1
"RTN","FHORT10",42,0)
ML I 'A3 S A3=$P("1,24,2,3,12,8,6,4",",",S2) G C1
"RTN","FHORT10",43,0)
 I A3'["F" S A3=$S(S2=1:1,S2=2:A3,S2=3:2,S2=4:3,S2=5:A3\2,S2=6:A3\3,S2=7:A3\4,1:A3\6)
"RTN","FHORT10",44,0)
 E  S:S2=1 A3=1
"RTN","FHORT10",45,0)
C1 S TC=$J(TC*A3,0,0)
"RTN","FHORT10",46,0)
 W !!,"Quantity: ",QUA,"  -- Total: ",TC," ml"
"RTN","FHORT10",47,0)
 I TC>5000 W *7,!!,"WARNING: Total Amount should be between 0 to 5000 ml",!,"Please Edit Tubefeeding and Modify."
"RTN","FHORT10",48,0)
 S:TC'<1 TP=$S(STR=4:TC,STR=3:TC*.75,STR=2:TC/2,1:TC/4),TP=$J(TP,0,0),TW=TC-TP
"RTN","FHORT10",49,0)
 I S1'=1!(S1'=6) S TK="",DX=$P(T(0),"^",4) I DX S TK=DX*TP,TK=$J(TK,0,0)
"RTN","FHORT10",50,0)
 S $P(TUN(TT),"^",2,6)=STR_"^"_QUA_"^"_TP_"^"_TW_"^"_TK G:TC>5000 E1
"RTN","FHORT10",51,0)
MORE R !!,"Enter/Edit another Tubefeeding product ? N// ",ANS:DTIME G:'$T!(ANS="^") AB S:ANS="" ANS="N" S X=ANS D TR^FH S ANS=X
"RTN","FHORT10",52,0)
 I $P("YES",ANS,1)'="",$P("NO",ANS,1)'="" W *7,!,"Answer YES to Enter More Products or Edit Existing Product.",!,"Answer NO to End Entering and Editing and Process the Products.",!,"Enter ""^"" will Terminate process." G MORE
"RTN","FHORT10",53,0)
 I ANS?1"Y".E  D DISP^FHORTR G E1
"RTN","FHORT10",54,0)
 I FLG1,'NO S TF=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",4) D:TF CAN^FHORT2
"RTN","FHORT10",55,0)
 Q
"RTN","FHORT10",56,0)
FIX ; Reset Quantity to parsable string
"RTN","FHORT10",57,0)
 S K=$F(X,"fdgs") I K>1 S X=$E(X,1,K-5)_"F"
"RTN","FHORT10",58,0)
 S K=$F(X,"hrs") I K>1 S X=$E(X,1,K-5)
"RTN","FHORT10",59,0)
 F K=1:1:8 S Z=" "_$P($T(F6),";",K+2) I X[Z G F1
"RTN","FHORT10",60,0)
 Q
"RTN","FHORT10",61,0)
F1 S X=$P(X,Z,1)_"/"_$P("QD QH BID TID Q2H Q3H Q4H Q6H"," ",K)_$P(X,Z,2) Q
"RTN","FHORT10",62,0)
GRAM ; Get the Grams for powder form
"RTN","FHORT10",63,0)
 Q:$E(A2,1)="G"
"RTN","FHORT10",64,0)
 S A1=A1*+$P(T(0),"^",3),A2="GRAM"
"RTN","FHORT10",65,0)
 Q
"RTN","FHORT10",66,0)
AB W *7,!!,"Tubefeeding Order TERMINATED - No order entered!" D:FHWF=2 WAIT^FHORD71 S (DFN,FHDFN)="" K TUN Q
"RTN","FHORT10",67,0)
F5 W *7,!!,"Units may be K for Kcals, M for ml's, O for oz. or U for units (e.g., cans)"
"RTN","FHORT10",68,0)
 W !,"Frequency may be DAY, HOUR, QD, QH, BID, TID, QID, Q2H, Q3H, Q4H or Q6H"
"RTN","FHORT10",69,0)
 W !,"May also input 100ML/HR X 16 for 16 hours or 100ML/Q3H X 6F for 6 feedings."
"RTN","FHORT10",70,0)
 W !,"When feeding is specified, it is taken into account other than the predetermined frequency interval.",!,"If Frequency is ordered per day, the Total ml is always the Units ordered."
"RTN","FHORT10",71,0)
 W !,"Valid quantity for powder form product can be ""# GRAMS"" as 20 G, GRAMS",!,"or GMS or as 1 PKG or 1 U and the frequency (e.g.,20 GRAMS/DAY, 1 PKG/TID).",! G F0
"RTN","FHORT10",72,0)
F6 ;;per Day;per Hour;Twice a Day;Three times a Day;Every 2 Hours;Every 3 Hours;Every 4 Hours;Every 6 Hours
"RTN","FHORT2")
0^18^B10349577
"RTN","FHORT2",1,0)
FHORT2 ; HISC/REL/NCA - Tubefeeding Inquiry/Cancel ;6/25/96  10:50 ;
"RTN","FHORT2",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORT2",3,0)
EN2 ; Current Tubefeeding
"RTN","FHORT2",4,0)
 S (ALL,TF)=0 D ^FHDPA Q:'DFN  Q:'FHDFN
"RTN","FHORT2",5,0)
 S TF=$P(^FHPT(FHDFN,"A",ADM,0),"^",4)
"RTN","FHORT2",6,0)
 I TF<1 W !!,"No Tubefeeding Order Exists" Q
"RTN","FHORT2",7,0)
DIS ; Display Tubefeeding
"RTN","FHORT2",8,0)
 S T=^FHPT(FHDFN,"A",ADM,"TF",TF,0),DTP=$P(T,"^",1),NO=0 D DTP^FH W !!,"Date Ordered: ",DTP
"RTN","FHORT2",9,0)
 W ! F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S Y=^(TF2,0),TUN(+Y)=Y,NO=NO+1 D D1
"RTN","FHORT2",10,0)
 S TFCOM=$P(T,"^",5)
"RTN","FHORT2",11,0)
 W !!,"Total KCAL: ",$P(T,"^",7),?42,"Total Quantity: ",$P(T,"^",6)," ml"
"RTN","FHORT2",12,0)
 W:TFCOM'="" !,"Comment: ",TFCOM Q
"RTN","FHORT2",13,0)
D1 S TUN=$P(Y,"^",1),STR=$P(Y,"^",2),QUA=$P(Y,"^",3)
"RTN","FHORT2",14,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORT2",15,0)
 W !,"Product: ",$P($G(^FH(118.2,TUN,0)),"^",1),", ",$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")," Str., ",QUA Q
"RTN","FHORT2",16,0)
EN3 ; Cancel Tubefeeding
"RTN","FHORT2",17,0)
 D EN2 G:TF<1 KIL S FHD="N" D ASK G:FHD'="Y" KIL D CAN
"RTN","FHORT2",18,0)
 D CUR^FHORD7 I Y="" W *7,!!,"Note: NO current DIET ORDER exists for this patient!" G KIL
"RTN","FHORT2",19,0)
 G:"^^^^"'[FHOR KIL I FHLD'="" W *7,!!,"Note: Patient is on a WITHHOLD SERVICE Order!"
"RTN","FHORT2",20,0)
C1 R !!,"Do you wish to RESUME Tray Service? N// ",X:DTIME G:'$T!(X="^") KIL S:X="" X="N" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G C1
"RTN","FHORT2",21,0)
 G:X'?1"Y".E KIL S A2=0 F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1!(KK'<NOW)  I $P(^(KK,0),"^",2)=FHORD S A2=KK
"RTN","FHORT2",22,0)
 I 'A2 W *7,!!,"Cannot CANCEL -- Try using Cancel Withhold option!" G KIL
"RTN","FHORT2",23,0)
 S DT=$P(NOW,".",1),KK=A2,OLD=FHLD D T0^FHORD3 G KIL
"RTN","FHORT2",24,0)
ASK ; Ask if wish to cancel
"RTN","FHORT2",25,0)
 W !!,"Do you wish to CANCEL the ORIGINAL Tubefeeding? ",FHD,"// " R X:DTIME I '$T!(X["^") S FHD="N" Q
"RTN","FHORT2",26,0)
 S:X="" X=FHD D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G ASK
"RTN","FHORT2",27,0)
 S FHD=$E(X,1) W:FHD'="Y" "  ... no change" Q
"RTN","FHORT2",28,0)
CAN ; Perform cancel
"RTN","FHORT2",29,0)
 N FHORN,FILL,COM D NOW^%DTC S NOW=%
"RTN","FHORT2",30,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",4)="" K ^FHPT("ADTF",FHDFN,ADM)
"RTN","FHORT2",31,0)
 S $P(^FHPT(FHDFN,"A",ADM,"TF",TF,0),"^",11,12)=NOW_"^"_DUZ
"RTN","FHORT2",32,0)
 S FHORN=$P(^FHPT(FHDFN,"A",ADM,"TF",TF,0),"^",14)
"RTN","FHORT2",33,0)
 S FHSAV=$G(^FHPT(FHDFN,"A",ADM,"TF",TF,0))
"RTN","FHORT2",34,0)
 K % S EVT="T^C^"_TF D ^FHORX I FHORN S FILL="T"_";"_ADM_";"_TF_";"_$P(FHSAV,"^",6)_";"_$P(FHSAV,"^",7)_";"_$P(FHSAV,"^",5)_";" D CODE^FHWOR5 D:$D(MSG) MSG^XQOR("FH EVSEND OR",.MSG) K MSG,FHSAV,FILL
"RTN","FHORT2",35,0)
 Q
"RTN","FHORT2",36,0)
KIL K %,%H,%I,A1,A2,C,D1,D2,D3,DA,KK,P2,FHDU,NOW,X1,X2,OLD,FHDR,FHORD,FHPAR,FHLD,FHWF,FHPV,FHOR,I,K9,ADM,ALL,COM,TFCOM,FHDFN,DFN,FHD,POP,PID,BID,DTP,QUA,STR,T,TF,TF2,TUN,WARD,X,X9,Y Q
"RTN","FHORT5A")
0^19^B25551328
"RTN","FHORT5A",1,0)
FHORT5A ; HISC/REL/NCA/RVD - Tubefeeding Reports (cont) ;3/1/04  13:15
"RTN","FHORT5A",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORT5A",3,0)
 ;
"RTN","FHORT5A",4,0)
Q1 ; Print Tubefeeding Report
"RTN","FHORT5A",5,0)
 S PG=0 D NOW^%DTC S (DTP,NOW)=% D DTP^FH K ^TMP($J)
"RTN","FHORT5A",6,0)
INPAT ;get inpatient data
"RTN","FHORT5A",7,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT("ADTF",FHDFN)) Q:FHDFN<1  F ADM=0:0 S ADM=$O(^FHPT("ADTF",FHDFN,ADM)) Q:ADM<1  D PATNAME^FHOMUTL Q:DFN=""  D Q2
"RTN","FHORT5A",8,0)
 ;
"RTN","FHORT5A",9,0)
OUTPAT ;get outpatient data, for today's date.
"RTN","FHORT5A",10,0)
 F FHDFN=0:0  S FHDFN=$O(^FHPT("RM",DT,FHDFN)) Q:FHDFN'>0  F FHFIN=0:0 S FHFIN=$O(^FHPT("RM",DT,FHDFN,FHFIN)) Q:FHFIN'>0  D
"RTN","FHORT5A",11,0)
 .;quit if TF is cancelled
"RTN","FHORT5A",12,0)
 .I $D(^FHPT(FHDFN,"OP",FHFIN,3)),$P(^(3),U,5)="C" Q
"RTN","FHORT5A",13,0)
 .F FHTF=0:0 S FHTF=$O(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF)) Q:FHTF'>0  D
"RTN","FHORT5A",14,0)
 ..Q:'$D(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF,0))
"RTN","FHORT5A",15,0)
 ..S YY=$G(^FHPT(FHDFN,"OP",FHFIN,"TF",FHTF,0))
"RTN","FHORT5A",16,0)
 ..;
"RTN","FHORT5A",17,0)
 ..S TF2=FHTF
"RTN","FHORT5A",18,0)
 ..S Z=$G(^FHPT(FHDFN,"OP",FHFIN,0))
"RTN","FHORT5A",19,0)
 ..S XY=$G(^FHPT(FHDFN,"OP",FHFIN,3))
"RTN","FHORT5A",20,0)
 ..S (Z1,Z2)="",W1=$P(Z,"^",3)
"RTN","FHORT5A",21,0)
 ..S P0=$G(^FH(119.6,+W1,0)),Z3=$P(P0,"^",8),WARD=$P(P0,"^",1)
"RTN","FHORT5A",22,0)
 ..S CC=$P($G(^FH(119.73,+Z3,0)),"^",1)
"RTN","FHORT5A",23,0)
 ..I FHXX="C" S D2=$P(P0,"^",8) I FHP,FHP'=D2 Q
"RTN","FHORT5A",24,0)
 ..I FHXX="L" I FHP,FHP'=W1 Q
"RTN","FHORT5A",25,0)
 ..S P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORT5A",26,0)
 ..S TNOD=$S(FHXX="C":"99~"_CC,1:P0_"~"_WARD),CNOD=$S('SUM:TNOD,1:"0")
"RTN","FHORT5A",27,0)
 ..;
"RTN","FHORT5A",28,0)
 ..I FHOPT=3 D
"RTN","FHORT5A",29,0)
 ...S CTR=$G(^TMP($J,"C",CNOD,0))
"RTN","FHORT5A",30,0)
 ...;I "^^^^"[FHOR S:Z2 $P(CTR,"^",1)=$P(CTR,"^",1)+1 S:Z2 $P(CTR,"^",3)=$P(CTR,"^",3)+1
"RTN","FHORT5A",31,0)
 ...S $P(CTR,"^",1)=$P(CTR,"^",1)+1
"RTN","FHORT5A",32,0)
 ...;I "^^^^"'[FHOR,Z1="T" S:'Z2 $P(CTR,"^",2)=$P(CTR,"^",2)+1 S:Z2 $P(CTR,"^",4)=$P(CTR,"^",4)+1
"RTN","FHORT5A",33,0)
 ...S ^TMP($J,"C",CNOD,0)=CTR Q
"RTN","FHORT5A",34,0)
 ..;
"RTN","FHORT5A",35,0)
 ..S TP=$P(YY,"^",4) D PREP
"RTN","FHORT5A",36,0)
 ..;set ^tmp global for specific report.
"RTN","FHORT5A",37,0)
 ..D PATNAME^FHOMUTL
"RTN","FHORT5A",38,0)
 ..S PNOD=P0_"~"_WARD_"~"_FHDFN
"RTN","FHORT5A",39,0)
 ..I "135"[FHOPT S:'$D(^TMP($J,"C",CNOD,TUN,0)) ^(0)="" S $P(^(0),"^",1)=$P(^(0),"^",1)+TU,$P(^(0),"^",2)=$P(^(0),"^",2)+1
"RTN","FHORT5A",40,0)
 ..I "124"[FHOPT D
"RTN","FHORT5A",41,0)
 ...S:'$D(^TMP($J,"T",TNOD,PNOD,0)) ^(0)=$E(FHPTNM,1,22)_"^"_FHBID_"^"_WARD_"^^"_$P(XY,"^",1,3)
"RTN","FHORT5A",42,0)
 ...S ^TMP($J,"T",TNOD,PNOD,TF2,0)=$P(Y0,"^",1)_"^"_$P(Y0,"^",2)_"^"_TP_"^"_TW_"^"_TU_"^"_P1_"^"_STR_"^"_QUA_"^"_TUN
"RTN","FHORT5A",43,0)
 ;
"RTN","FHORT5A",44,0)
PRT ;prints corresponding reports.
"RTN","FHORT5A",45,0)
 I FHOPT=1 D PREP^FHORT5B,PULL^FHORT5C,DEL^FHORT5C Q
"RTN","FHORT5A",46,0)
 I FHOPT=2 D PREP^FHORT5B Q
"RTN","FHORT5A",47,0)
 I FHOPT=3 D CST^FHORT5D Q
"RTN","FHORT5A",48,0)
 I FHOPT=4 D LAB^FHORT5D Q
"RTN","FHORT5A",49,0)
 I FHOPT=5 D PULL^FHORT5C
"RTN","FHORT5A",50,0)
 Q
"RTN","FHORT5A",51,0)
Q2 S Z=$G(^FHPT(FHDFN,"A",ADM,0)),WARD=$P(Z,"^",8) S:WARD WARD=$P($G(^FH(119.6,WARD,0)),"^",1) I WARD="" G Q3
"RTN","FHORT5A",52,0)
 G:'$D(^DPT(DFN,.1)) Q3 S CADM=$G(^DPT("CN",^DPT(DFN,.1),DFN)) G:ADM'=CADM Q3
"RTN","FHORT5A",53,0)
 S TF=$P(Z,"^",4) G:TF<1 Q3
"RTN","FHORT5A",54,0)
 S Z1=$P(Z,"^",5),Z2=$P(Z,"^",7),W1=$P(Z,"^",8),P0=$G(^FH(119.6,+W1,0)),Z3=$P(P0,"^",8),CC=$P($G(^FH(119.73,+Z3,0)),"^",1)
"RTN","FHORT5A",55,0)
 I FHXX="C" S D2=$P(P0,"^",8) I FHP,FHP'=D2 Q
"RTN","FHORT5A",56,0)
 I FHXX="L" I FHP,FHP'=W1 Q
"RTN","FHORT5A",57,0)
 S P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORT5A",58,0)
 S TNOD=$S(FHXX="C":"99~"_CC,1:P0_"~"_WARD),CNOD=$S('SUM:TNOD,1:"0")
"RTN","FHORT5A",59,0)
 D CUR^FHORD7 I FHLD="P" Q
"RTN","FHORT5A",60,0)
 I FHOPT=3 D
"RTN","FHORT5A",61,0)
 .S CTR=$G(^TMP($J,"C",CNOD,0))
"RTN","FHORT5A",62,0)
 .I "^^^^"[FHOR S:'Z2 $P(CTR,"^",1)=$P(CTR,"^",1)+1 S:Z2 $P(CTR,"^",3)=$P(CTR,"^",3)+1
"RTN","FHORT5A",63,0)
 .I "^^^^"'[FHOR,Z1="T" S:'Z2 $P(CTR,"^",2)=$P(CTR,"^",2)+1 S:Z2 $P(CTR,"^",4)=$P(CTR,"^",4)+1
"RTN","FHORT5A",64,0)
 .S ^TMP($J,"C",CNOD,0)=CTR Q
"RTN","FHORT5A",65,0)
 I "124"[FHOPT D
"RTN","FHORT5A",66,0)
 .S RM=$G(^DPT(DFN,.101))
"RTN","FHORT5A",67,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHORT5A",68,0)
 .S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORT5A",69,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORT5A",70,0)
 .S PNOD=P0_"~"_R0_RM_"~"_DFN,X=^DPT(DFN,0) D PID^FHDPA
"RTN","FHORT5A",71,0)
 .S XY=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHORT5A",72,0)
 .S ^TMP($J,"T",TNOD,PNOD,0)=$E($P(X,"^",1),1,22)_"^"_BID_"^"_WARD_"^"_RM_"^"_$P(XY,"^",5,7) Q
"RTN","FHORT5A",73,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S YY=^(TF2,0) D LP
"RTN","FHORT5A",74,0)
 Q
"RTN","FHORT5A",75,0)
LP S TP=$P(YY,"^",4) D PREP
"RTN","FHORT5A",76,0)
 I "135"[FHOPT S:'$D(^TMP($J,"C",CNOD,TUN,0)) ^(0)="" S $P(^(0),"^",1)=$P(^(0),"^",1)+TU,$P(^(0),"^",2)=$P(^(0),"^",2)+1
"RTN","FHORT5A",77,0)
 I "124"[FHOPT S ^TMP($J,"T",TNOD,PNOD,TF2,0)=$P(Y0,"^",1)_"^"_$P(Y0,"^",2)_"^"_TP_"^"_TW_"^"_TU_"^"_P1_"^"_STR_"^"_QUA_"^"_TUN
"RTN","FHORT5A",78,0)
 Q
"RTN","FHORT5A",79,0)
Q3 K ^FHPT("ADTF",FHDFN,ADM)
"RTN","FHORT5A",80,0)
 I $D(^FHPT(FHDFN,"A",ADM,0)) S TF=$P(^(0),"^",4),$P(^(0),"^",4)="" I TF>0,$D(^FHPT(FHDFN,"A",ADM,"TF",TF,0)) S $P(^(0),"^",11)=NOW,ORIFN=$P(^(0),"^",14) I ORIFN S ORSTS=1 D ST^ORX
"RTN","FHORT5A",81,0)
 Q
"RTN","FHORT5A",82,0)
PREP ; Calculate Preparation
"RTN","FHORT5A",83,0)
 S TUN=$P(YY,"^",1),Y0=$G(^FH(118.2,TUN,0)) Q:Y0=""
"RTN","FHORT5A",84,0)
 S STR=$P(YY,"^",2),QUA=$P(YY,"^",3)
"RTN","FHORT5A",85,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHORT5A",86,0)
 I $E($P(Y0,"^",3),$L($P(Y0,"^",3)))="G" D GRM Q
"RTN","FHORT5A",87,0)
 S TU=$P(YY,"^",4)/$S(+$P(Y0,"^",3):+$P(Y0,"^",3),1:9999),TW=$P(YY,"^",5)
"RTN","FHORT5A",88,0)
 ;I TW<6 S TP="",TW="",TU=TU+.75\1,P1=TU Q  ;NOIS MWV-0303-21626
"RTN","FHORT5A",89,0)
 I TW<6 S TP="",TW="",P1=TU+.9999\1,TU=TU+.75\1 Q
"RTN","FHORT5A",90,0)
 S TU=TU+.2*4\1/4,TP=$J(TP/10,0)*10,TW=$J(TW/10,0)*10
"RTN","FHORT5A",91,0)
 S P1=$S(TU<1:"",1:TU\1) I TU#1 S:P1 P1=P1_"-" S P2=TU#1,P1=P1_$S(P2<.3:"1/4",P2<.6:"1/2",1:"3/4")
"RTN","FHORT5A",92,0)
 Q
"RTN","FHORT5A",93,0)
GRM ; Calculate Gram
"RTN","FHORT5A",94,0)
 S TW=0,X=QUA D FIX^FHORT10 S Z5="" F L=1:1:$L(X) I $E(X,L)'=" " S Z5=Z5_$E(X,L)
"RTN","FHORT5A",95,0)
 S Z5=$P(Z5,"/",2),Z5=$P(Z5,"X",2)
"RTN","FHORT5A",96,0)
 I 'Z5 S Z5=$P("1,24,2,3,12,8,6,4",",",K) G G1
"RTN","FHORT5A",97,0)
 I Z5'["F" S Z5=$S(K=1:1,K=2:Z5,K=3:2,K=4:3,K=5:Z5\2,K=6:Z5\3,K=7:Z5\4,1:Z5\6)
"RTN","FHORT5A",98,0)
 E  S:K=1 Z5=1
"RTN","FHORT5A",99,0)
G1 S TU=+QUA*Z5
"RTN","FHORT5A",100,0)
 S TU=TU/$S(+$P(Y0,"^",3):+$P(Y0,"^",3),1:9999)
"RTN","FHORT5A",101,0)
 S P1=$S(TU<1:"",1:TU\1) I P1="" S TU=TU+.95\1,P1=TU
"RTN","FHORT5A",102,0)
 I TU#1 S:P1 P1=P1_"-" S TU=TU#1,P1=P1_$S(TU<.3:"1/4",TU<.6:"1/2",1:"3/4")
"RTN","FHORT5A",103,0)
 Q
"RTN","FHORT5B")
0^20^B2882203
"RTN","FHORT5B",1,0)
FHORT5B ; HISC/REL/NCA - Tubefeeding Reports (cont) ;5/4/93  10:47 
"RTN","FHORT5B",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORT5B",3,0)
PREP ; Preparation Report
"RTN","FHORT5B",4,0)
 D:SUM HD1 S TNOD="" F  S TNOD=$O(^TMP($J,"T",TNOD)) Q:TNOD=""  D:'SUM HD1 D A2
"RTN","FHORT5B",5,0)
 Q
"RTN","FHORT5B",6,0)
A2 S PNOD="" F  S PNOD=$O(^TMP($J,"T",TNOD,PNOD)) Q:PNOD=""  S X0=^(PNOD,0) D A3
"RTN","FHORT5B",7,0)
 Q
"RTN","FHORT5B",8,0)
A3 D:$Y>(IOSL-10) HD1 W !,$P(X0,"^",3)," ",$P(X0,"^",4),!,$P(X0,"^",1),?23,$P(X0,"^",2)
"RTN","FHORT5B",9,0)
 F TF2=0:0 S TF2=$O(^TMP($J,"T",TNOD,PNOD,TF2)) Q:'TF2  S X1=^(TF2,0) D A4
"RTN","FHORT5B",10,0)
 S COM=$P(X0,"^",5) W:COM'="" ?66,COM,! Q
"RTN","FHORT5B",11,0)
A4 W ?31,$E($P(X1,"^",1),1,29) S STR=$P(X1,"^",7) W ?61,$S(STR=4:"Full",STR=2:"1/2",STR=1:"1/4",1:"3/4")
"RTN","FHORT5B",12,0)
 W ?66,$P(X1,"^",8),?101,$P(X1,"^",2),?110,$P(X1,"^",6)
"RTN","FHORT5B",13,0)
 S TW=$P(X1,"^",4) I TW W ?117,$J($P(X1,"^",3),5),?126,$J(TW,4)
"RTN","FHORT5B",14,0)
 W ! Q
"RTN","FHORT5B",15,0)
HD1 ; Preparation Header
"RTN","FHORT5B",16,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORT5B",17,0)
 W !,DTP,?39,"P R E P A R A T I O N   O F   T U B E F E E D I N G S",?125,"Page ",PG
"RTN","FHORT5B",18,0)
 S Y=$S(SUM:"CONSOLIDATED",1:$P(TNOD,"~",2)) W:Y'="" !!?(131-$L(Y)\2),Y
"RTN","FHORT5B",19,0)
 W !!,?112,"#",?119,"ML",?127,"ML"
"RTN","FHORT5B",20,0)
 W !,"Patient",?24,"ID#",?31,"Product",?61,"Str",?66,"Quantity",?101,"Unit",?110,"Units",?117,"Product",?126,"Water",!
"RTN","FHORT5B",21,0)
 Q
"RTN","FHORX1")
0^21^B36932734
"RTN","FHORX1",1,0)
FHORX1 ; HISC/REL/RVD - Diet Activity Report ;9/10/98  15:31
"RTN","FHORX1",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORX1",3,0)
 ;RVD patch #1 - get outpatient info from Nutrition Events file.
"RTN","FHORX1",4,0)
 ;
"RTN","FHORX1",5,0)
 D NOW^%DTC S NOW=%,TIM=""
"RTN","FHORX1",6,0)
R0 D DIV^FHOMUTL G:'$D(FHSITE) KIL
"RTN","FHORX1",7,0)
 S FHP=FHSITE
"RTN","FHORX1",8,0)
R1 R !!,"Do you want labels? N// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="N" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Enter YES or NO" G R1
"RTN","FHORX1",9,0)
 S LAB=X?1"Y".E
"RTN","FHORX1",10,0)
 S:$G(FHP) TIM=$P($G(^FH(119.73,FHP,0)),"^",$S(LAB:3,1:2))
"RTN","FHORX1",11,0)
 I 'TIM S TIM=DT
"RTN","FHORX1",12,0)
 S FHLBFLG=1 I LAB D  I FHLBFLG=0 Q
"RTN","FHORX1",13,0)
 .W ! K DIR,LABSTART S DIR(0)="NA^1:10",DIR("A")="If using laser label sheets, what row do you want to begin printing at? ",DIR("B")=1 D ^DIR
"RTN","FHORX1",14,0)
 .I $D(DIRUT) S FHLBFLG=0 Q
"RTN","FHORX1",15,0)
 .S LABSTART=Y Q
"RTN","FHORX1",16,0)
 S DTP=TIM D DTP^FH
"RTN","FHORX1",17,0)
R3 W !!,"Changes since Date/Time: ",DTP," // " R X:DTIME G:'$T!(X["^") KIL I X'="" S %DT="EXTS" D ^%DT K %DT G:Y<1 R3 S TIM=Y
"RTN","FHORX1",18,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select "_$S(LAB:"LABEL",1:"LIST")_" Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORX1",19,0)
 I $D(IO("Q")) S FHPGM="Q1^FHORX1",FHLST="TIM^LAB^FHP^LABSTART^FHSITE^FHSITENM" D EN2^FH G KIL
"RTN","FHORX1",20,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHORX1",21,0)
Q1 ; Print the Diet Activity Report
"RTN","FHORX1",22,0)
 S FHTIM=TIM    ;save date/time for recurring meal data.
"RTN","FHORX1",23,0)
 K ^TMP($J) D NOW^%DTC S NOW=%,DTP=TIM,TIM=TIM-.000001 D DTP^FH S H1=DTP_" - " S DTP=NOW D DTP^FH S H1=H1_DTP D ^FHDEV
"RTN","FHORX1",24,0)
 F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D WRD
"RTN","FHORX1",25,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHORX1",26,0)
 F LLL=TIM:0 S LLL=$O(^FH(119.8,"AD",LLL)) Q:LLL<1  F DA=0:0 S DA=$O(^FH(119.8,"AD",LLL,DA)) Q:DA<1  D Q3
"RTN","FHORX1",27,0)
 ;
"RTN","FHORX1",28,0)
OUTP ;get outpatient data
"RTN","FHORX1",29,0)
 F LLL=TIM:0 S LLL=$O(^FH(119.8,"AD",LLL)) Q:LLL<1  F DA=0:0 S DA=$O(^FH(119.8,"AD",LLL,DA)) Q:DA<1  D
"RTN","FHORX1",30,0)
 .S FHPROR=99,(FHTC,FHCOMO)=""
"RTN","FHORX1",31,0)
 .S Z=$G(^FH(119.8,DA,0)) Q:Z=""
"RTN","FHORX1",32,0)
 .S FHDTIM=$P(Z,"^",2),FHDFN=$P(Z,"^",3),FHOUTP=$P(Z,"^",5)
"RTN","FHORX1",33,0)
 .Q:FHOUTP'="Z"
"RTN","FHORX1",34,0)
 .S FHACTI=$P(Z,"^",6)
"RTN","FHORX1",35,0)
 .S FHDESC=$P(Z,"^",8),FHLOCN=$P(FHDESC,",",2)
"RTN","FHORX1",36,0)
 .S FHLOCN=$E(FHLOCN,2,$L(FHLOCN))
"RTN","FHORX1",37,0)
 .S:FHLOCN'="" FHLIEN=$O(^FH(119.6,"B",FHLOCN,0))
"RTN","FHORX1",38,0)
 .I $G(FHLIEN) D
"RTN","FHORX1",39,0)
 ..S FHPROR=$P($G(^FH(119.6,FHLIEN,0)),U,4)
"RTN","FHORX1",40,0)
 ..S FHSERV1=$P($G(^FH(119.6,FHLIEN,0)),U,5)
"RTN","FHORX1",41,0)
 ..I $G(FHSERV1),$D(^FH(119.72,FHSERV1,0)) S FHTC=FHTC_$P(^(0),U,2)
"RTN","FHORX1",42,0)
 ..S FHSERV2=$P($G(^FH(119.6,FHLIEN,0)),U,6)
"RTN","FHORX1",43,0)
 ..I $G(FHSERV2),$D(^FH(119.72,FHSERV2,0)) S FHTC=FHTC_$P(^(0),U,2)
"RTN","FHORX1",44,0)
 ..S FHSERV3=$P($G(^FH(119.6,FHLIEN,0)),U,7)
"RTN","FHORX1",45,0)
 ..I $G(FHSERV3) S FHTC=FHTC_"D"
"RTN","FHORX1",46,0)
 ..S FHCOMO=$P($G(^FH(119.6,FHLIEN,0)),U,8)
"RTN","FHORX1",47,0)
 .I $G(FHSITE),FHCOMO'=FHSITE Q
"RTN","FHORX1",48,0)
 .S FHCLER=$P(Z,"^",9)
"RTN","FHORX1",49,0)
 .S FHPTNM="***"
"RTN","FHORX1",50,0)
 .S:FHLOCN="" FHLOCN="***"
"RTN","FHORX1",51,0)
 .D PATNAME^FHOMUTL
"RTN","FHORX1",52,0)
 .S FHLPAT=FHPROR_"~"_FHLOCN_"~~~"_FHPTNM
"RTN","FHORX1",53,0)
 .S DTP=FHDTIM D DTP^FH
"RTN","FHORX1",54,0)
 .S ^TMP($J,"O",FHLPAT,DA)=FHACTI_"^"_DTP_"^"_FHBID_"^"_FHDESC_"^"_FHTC
"RTN","FHORX1",55,0)
 ;
"RTN","FHORX1",56,0)
 ;D PROSG   ;print outpatient data
"RTN","FHORX1",57,0)
 ;go to routines for printing report
"RTN","FHORX1",58,0)
 G ^FHORX1A:'LAB,^FHORX1B
"RTN","FHORX1",59,0)
WRD S P0=$G(^FH(119.6,W1,0)),WRDN=$P(P0,"^",1),D2=$P(P0,"^",8),P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORX1",60,0)
 I $G(FHP),D2=FHP S ^TMP($J,"W",W1)=P0_"~"_WRDN
"RTN","FHORX1",61,0)
 I '$G(FHP) S ^TMP($J,"W",W1)=P0_"~"_WRDN
"RTN","FHORX1",62,0)
 Q
"RTN","FHORX1",63,0)
Q3 S Z=$G(^FH(119.8,DA,0)) Q:Z=""  S TM1=($P(Z,"^",2)\1),FHDFN=$P(Z,"^",3),ADM=$P(Z,"^",4) Q:'$G(ADM)  Q:'$D(^FHPT(FHDFN,"A",ADM,0))
"RTN","FHORX1",64,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORX1",65,0)
 S WARD=$G(^DPT(DFN,.1)) G:WARD="" Q5 ; Not an inpatient
"RTN","FHORX1",66,0)
 I $G(^DPT("CN",WARD,DFN))'=ADM Q  ; Not current admission
"RTN","FHORX1",67,0)
 S X0=^FHPT(FHDFN,"A",ADM,0),W1=+$P(X0,"^",8) I '$D(^TMP($J,"W",W1)) Q  ; Not in this Comm Office
"RTN","FHORX1",68,0)
 S R1=$G(^DPT(DFN,.101))
"RTN","FHORX1",69,0)
 S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHORX1",70,0)
 S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORX1",71,0)
 S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORX1",72,0)
 S ^TMP($J,"I",^TMP($J,"W",W1)_"~"_R0_"~"_R1_"~"_FHDFN,DA)=$P(Z,"^",4,9) Q
"RTN","FHORX1",73,0)
Q5 ; process discharges
"RTN","FHORX1",74,0)
 S W1=+$P(Z,"^",8) Q:'W1  Q:'$D(^TMP($J,"W",W1))
"RTN","FHORX1",75,0)
 S ^TMP($J,"I",^TMP($J,"W",W1)_"~~***~"_FHDFN,DA)=$P(Z,"^",4,9)
"RTN","FHORX1",76,0)
 Q
"RTN","FHORX1",77,0)
 ;
"RTN","FHORX1",78,0)
PROSG ;process recurring, special and guest meals.
"RTN","FHORX1",79,0)
 S FHPLNM=""
"RTN","FHORX1",80,0)
 S:$G(FHP) FHPLNM=$P($G(^FH(119.73,FHP,0)),U,1)
"RTN","FHORX1",81,0)
REC ;for recurring meals
"RTN","FHORX1",82,0)
 ;S FHTMPS=$NA(^TMP($J,"OP","R",FHPLNM))
"RTN","FHORX1",83,0)
 S FHTMPS="^TMP($J,""OP"",""R"")"
"RTN","FHORX1",84,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORX1",85,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORX1",86,0)
 .S FHPROR="01",FHLOC=""
"RTN","FHORX1",87,0)
 .S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORX1",88,0)
 .S:$G(FHLOC) FHPROR=$P($G(^FH(119.6,FHLOC,0)),U,4)
"RTN","FHORX1",89,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>NOW)  D
"RTN","FHORX1",90,0)
 ..S (FHRDAT,FHIJKDAT)=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORX1",91,0)
 ..S $P(FHRDAT,U,3)=$P(FHIJKDAT,U,18)
"RTN","FHORX1",92,0)
 ..S $P(FHRDAT,U,4)=$P(FHIJKDAT,U,3)
"RTN","FHORX1",93,0)
 ..S $P(FHRDAT,U,9)=$P(FHIJKDAT,U,4)
"RTN","FHORX1",94,0)
 ..S $P(FHRDAT,U,5)=$P(FHIJKDAT,U,8)
"RTN","FHORX1",95,0)
 ..S $P(FHRDAT,U,8)=$P(FHIJKDAT,U,7)
"RTN","FHORX1",96,0)
 ..S $P(FHRDAT,U,13)=$P(FHIJKDAT,U,17)
"RTN","FHORX1",97,0)
 ..S FHLPAT=FHPROR_"~"_FHI_"~~~"_$P(FHIJKDAT,U,1)
"RTN","FHORX1",98,0)
 ..S ^TMP($J,"O",FHLPAT,FHK)="RECURRING"_"^"_FHJ_"^"_FHRDAT
"RTN","FHORX1",99,0)
SPEC ;for special meals
"RTN","FHORX1",100,0)
 ;S FHPLNM=$P($G(^FH(119.73,FHP,0)),U,1) Q:FHPLNM=""    ;quit if no comm
"RTN","FHORX1",101,0)
 ;S FHTMPS=$NA(^TMP($J,"OP","S"))
"RTN","FHORX1",102,0)
 S FHTMPS="^TMP($J,""OP"",""S"")"
"RTN","FHORX1",103,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORX1",104,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORX1",105,0)
 .S FHPROR="01",FHLOC=""
"RTN","FHORX1",106,0)
 .S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORX1",107,0)
 .S:$G(FHLOC) FHPROR=$P($G(^FH(119.6,FHLOC,0)),U,4)
"RTN","FHORX1",108,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>NOW)  D
"RTN","FHORX1",109,0)
 ..S FHIJKDAT=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORX1",110,0)
 ..S FHLPAT=FHPROR_"~"_FHI_"~~~"_$P(FHIJKDAT,U,1)
"RTN","FHORX1",111,0)
 ..S ^TMP($J,"O",FHLPAT,FHK)="SPECIAL"_"^"_FHJ_"^"_FHIJKDAT
"RTN","FHORX1",112,0)
 ;for guest meals
"RTN","FHORX1",113,0)
GUEST ;S FHTMPS=$NA(^TMP($J,"OP","G",FHPLNM))
"RTN","FHORX1",114,0)
 S FHTMPS="^TMP($J,""OP"",""G"")"
"RTN","FHORX1",115,0)
 S FHN="" F  S FHN=$O(@FHTMPS@(FHN)) Q:FHN=""  S FHI="" F  S FHI=$O(@FHTMPS@(FHN,FHI)) Q:FHI=""  S FHJ="" F  S FHJ=$O(@FHTMPS@(FHN,FHI,FHJ)) Q:FHJ=""  D
"RTN","FHORX1",116,0)
 .I (FHPLNM'=""),(FHN'=FHPLNM) Q
"RTN","FHORX1",117,0)
 .S FHPROR="01",FHLOC=""
"RTN","FHORX1",118,0)
 .S:$D(^FH(119.6,"B",FHI)) FHLOC=$O(^FH(119.6,"B",FHI,0))
"RTN","FHORX1",119,0)
 .S:$G(FHLOC) FHPROR=$P($G(^FH(119.6,FHLOC,0)),U,4)
"RTN","FHORX1",120,0)
 .F FHK=0:0 S FHK=$O(@FHTMPS@(FHN,FHI,FHJ,FHK)) Q:(FHK'>0)!(FHK>NOW)  D
"RTN","FHORX1",121,0)
 ..S FHIJKDAT=@FHTMPS@(FHN,FHI,FHJ,FHK)
"RTN","FHORX1",122,0)
 ..S FHGDIET=$P($G(^FH(119.9,1,0)),U,2)
"RTN","FHORX1",123,0)
 ..S $P(FHIJKDAT,U,9)=$P(FHIJKDAT,U,3)
"RTN","FHORX1",124,0)
 ..S $P(FHIJKDAT,U,14)=$P(FHIJKDAT,U,4)
"RTN","FHORX1",125,0)
 ..S $P(FHIJKDAT,U,15)=$P(FHIJKDAT,U,5)
"RTN","FHORX1",126,0)
 ..S FHGDIETN=$P(FHIJKDAT,U,6)
"RTN","FHORX1",127,0)
 ..I $G(FHGDIETN),$D(^FH(111,FHGDIETN,0)) D
"RTN","FHORX1",128,0)
 ...S FHGDTNM=$P(^FH(111,FHGDIETN,0),U,1)
"RTN","FHORX1",129,0)
 ..E  S:$G(FHGDIET) FHGDTNM=$P($G(^FH(111,FHGDIET,0)),U,1)
"RTN","FHORX1",130,0)
 ..S $P(FHIJKDAT,U,4)=FHGDTNM
"RTN","FHORX1",131,0)
 ..I $G(FHGDIET),$D(^FH(111,FHGDIET,0)) D
"RTN","FHORX1",132,0)
 ...S $P(FHIJKDAT,U,4)=$P(^FH(111,FHGDIET,0),U,1)
"RTN","FHORX1",133,0)
 ..S FHLPAT=FHPROR_"~"_FHI_"~~~"_$P(FHIJKDAT,U,1)
"RTN","FHORX1",134,0)
 ..S ^TMP($J,"O",FHLPAT,FHK)="GUEST"_"^"_FHJ_"^"_FHIJKDAT
"RTN","FHORX1",135,0)
 Q
"RTN","FHORX1",136,0)
 ;
"RTN","FHORX1",137,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHORX1A")
0^22^B53383181
"RTN","FHORX1A",1,0)
FHORX1A ; HISC/REL/NCA/RVD - Diet Activity Report (cont) ;3/17/95  10:06
"RTN","FHORX1A",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORX1A",3,0)
 ;
"RTN","FHORX1A",4,0)
 ;process inpatient data.
"RTN","FHORX1A",5,0)
 S PG=0 S FHPIO="** INPATIENT **" D HDR
"RTN","FHORX1A",6,0)
 S P0="",NN=0 F  S P0=$O(^TMP($J,"I",P0)) Q:P0=""  D LST
"RTN","FHORX1A",7,0)
 ;
"RTN","FHORX1A",8,0)
 ;process outpatient data.
"RTN","FHORX1A",9,0)
 S FHPIO="** OUTPATIENT **" D HDR
"RTN","FHORX1A",10,0)
 S P0="",NN=0 F  S P0=$O(^TMP($J,"O",P0)) Q:P0=""  D LST1
"RTN","FHORX1A",11,0)
 ;
"RTN","FHORX1A",12,0)
 S:$G(FHP) $P(^FH(119.73,FHP,0),"^",2)=NOW
"RTN","FHORX1A",13,0)
 I '$G(FHP) F FHII=0:0 S FHII=$O(^FH(119.73,FHII)) Q:FHII'>0  S $P(^FH(119.73,FHII,0),"^",2)=NOW
"RTN","FHORX1A",14,0)
 Q
"RTN","FHORX1A",15,0)
 ;
"RTN","FHORX1A",16,0)
LST K PP S NP=0 F DA=0:0 S DA=$O(^TMP($J,"I",P0,DA)) Q:DA<1  S Z=^(DA) D L1
"RTN","FHORX1A",17,0)
 D L2 Q
"RTN","FHORX1A",18,0)
 ;
"RTN","FHORX1A",19,0)
LST1 K PP S NP=0 F DA=0:0 S DA=$O(^TMP($J,"O",P0,DA)) Q:DA<1  S Z=^(DA) D T1,T2
"RTN","FHORX1A",20,0)
 Q
"RTN","FHORX1A",21,0)
 ;
"RTN","FHORX1A",22,0)
L1 ; Process event
"RTN","FHORX1A",23,0)
 S ADM=$P(Z,"^",1),TYP=$P(Z,"^",2),ACT=$P(Z,"^",3),FHORD=$P(Z,"^",4),TXT=$P(Z,"^",5),CLK=$P(Z,"^",6)
"RTN","FHORX1A",24,0)
 I 'FHORD S NN=NN+1,FHORD=NN
"RTN","FHORX1A",25,0)
 I "DIT"[TYP D
"RTN","FHORX1A",26,0)
 .I TYP="D",FHORD=1 S NP=1
"RTN","FHORX1A",27,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1A",28,0)
 .K PP(TYP) S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK Q
"RTN","FHORX1A",29,0)
 I "OPSF"[TYP D
"RTN","FHORX1A",30,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1A",31,0)
 .S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK Q
"RTN","FHORX1A",32,0)
 I "LM"[TYP S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT_"^"_CLK
"RTN","FHORX1A",33,0)
 Q
"RTN","FHORX1A",34,0)
 ;
"RTN","FHORX1A",35,0)
L2 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),FHDFN=$P(P0,"~",5)
"RTN","FHORX1A",36,0)
 D PATNAME^FHOMUTL Q:'$G(DFN)
"RTN","FHORX1A",37,0)
 S Y0=$G(^DPT(DFN,0))
"RTN","FHORX1A",38,0)
 S N1=$P(Y0,"^",1)
"RTN","FHORX1A",39,0)
 ;D PID^FHDPA
"RTN","FHORX1A",40,0)
 S TC=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",5),SF=$P($G(^(0)),"^",7),SO=$D(^FHPT("ASP",FHDFN,ADM))
"RTN","FHORX1A",41,0)
 D:$Y>(IOSL-6) HDR W !!,$E(W1_" "_R1,1,20),?22,N1,?50,BID,?63,$S(SF:"SF",1:""),?66,$S(SO:"SO",1:""),?73,TC,!
"RTN","FHORX1A",42,0)
 D ^FHORX1C D:NP NEWP Q
"RTN","FHORX1A",43,0)
 ;
"RTN","FHORX1A",44,0)
T1 ; Process outpatient event
"RTN","FHORX1A",45,0)
 S FHTDAT=$G(^TMP($J,"O",P0,DA))
"RTN","FHORX1A",46,0)
 S FHACTI=$P(FHTDAT,"^",1)
"RTN","FHORX1A",47,0)
 S DTP=$P(FHTDAT,"^",2)
"RTN","FHORX1A",48,0)
 S BID=$P(FHTDAT,"^",3)
"RTN","FHORX1A",49,0)
 S FHDESC=$P(FHTDAT,"^",4)
"RTN","FHORX1A",50,0)
 S FHTC=$P(FHTDAT,"^",5)
"RTN","FHORX1A",51,0)
 S FHDES1=$P(FHDESC,",",1)
"RTN","FHORX1A",52,0)
 S FHDIET=$P(FHDES1,":",2),FHDIET=$E(FHDIET,2,$L(FHDIET))
"RTN","FHORX1A",53,0)
 I FHDIET'="",$D(^FH(111,"B",FHDIET)) S FHDIDA=$O(^FH(111,"B",FHDIET,0))
"RTN","FHORX1A",54,0)
 I $G(FHDIDA),$D(^FH(111,FHDIDA,0)) S FHDIET=$P(^FH(111,FHDIDA,0),U,7)
"RTN","FHORX1A",55,0)
 S:FHDIET="" FHDIET="NO ORDER"
"RTN","FHORX1A",56,0)
 S Y=FHDIET
"RTN","FHORX1A",57,0)
 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),N1=$P(P0,"~",5)
"RTN","FHORX1A",58,0)
 Q
"RTN","FHORX1A",59,0)
 ;
"RTN","FHORX1A",60,0)
T2 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),FHDPTN=$P(P0,"~",5)
"RTN","FHORX1A",61,0)
 ;Q:'$G(FHDFN)
"RTN","FHORX1A",62,0)
 ;D PATNAME^FHOMUTL
"RTN","FHORX1A",63,0)
 ;S FHDASAV=DA
"RTN","FHORX1A",64,0)
 ;
"RTN","FHORX1A",65,0)
 I $D(^FH(119.8,DA,0)) S FHUSER=$P(^(0),U,9) S:$G(FHUSER) FHUSERN=$P(^VA(200,FHUSER,0),U,1)
"RTN","FHORX1A",66,0)
 S EVT=FHDESC_" by "_FHUSERN
"RTN","FHORX1A",67,0)
 I $Y>(IOSL-6) D HDR
"RTN","FHORX1A",68,0)
 W !!,$E(W1,1,20),?22,FHDPTN,?50,BID,?73,FHTC
"RTN","FHORX1A",69,0)
 W !!,?12,"Date of Activity: ",DTP
"RTN","FHORX1A",70,0)
 D LNE
"RTN","FHORX1A",71,0)
 Q
"RTN","FHORX1A",72,0)
 ;
"RTN","FHORX1A",73,0)
 F FHDA=0:0 S FHDA=$O(^TMP($J,"O",P0,FHDA)) Q:FHDA<1  S Z=^(FHDA) D
"RTN","FHORX1A",74,0)
 .S FHMTY=$P(Z,"^",1),FHPNM=$P(Z,"^",2),FHDTE=$P(Z,"^",4)
"RTN","FHORX1A",75,0)
 .S FHSTAT=$P(Z,"^",5)
"RTN","FHORX1A",76,0)
 .S FHSTANAM=""
"RTN","FHORX1A",77,0)
 .I FHMTY="SPECIAL" S FHSTANAM=$S(FHSTAT="C":"CANCELLED",FHSTAT="D":"DENIED",FHSTAT="A":"AUTHORIZED",1:"PENDING")
"RTN","FHORX1A",78,0)
 .I FHMTY="RECURRING",FHSTAT="C" D  Q
"RTN","FHORX1A",79,0)
 ..W:FHDTE'="" !!,?12,"Date: ",FHDTE
"RTN","FHORX1A",80,0)
 ..W !,?14,"CANCELLED!!!"
"RTN","FHORX1A",81,0)
 ..W:FHMTY'="" !,?14,"Service Type: ",FHMTY
"RTN","FHORX1A",82,0)
 .S FHCOMM=$P(Z,"^",10),FHTCD=$P(Z,"^",15)
"RTN","FHORX1A",83,0)
 .S FHCLA=$P(Z,"^",16),FHCOS=$P(Z,"^",17)
"RTN","FHORX1A",84,0)
 .S FHMEAL=$P(Z,"^",11),FHDIET=$P(Z,"^",6),FHCLRK=$P(Z,"^",7)
"RTN","FHORX1A",85,0)
 .I $Y>(IOSL-6) D HDR W !!,$E(W1,1,20),?22,FHPNM,?50,FHBID,?73,FHTCD
"RTN","FHORX1A",86,0)
 .I FHMTY="GUEST" D  Q
"RTN","FHORX1A",87,0)
 ..W:FHDTE'="" !!,?12,"Date: ",FHDTE
"RTN","FHORX1A",88,0)
 ..W:FHDIET'="" !,?14,"Diet: ",FHDIET
"RTN","FHORX1A",89,0)
 ..W:FHMEAL'="" !,?14,"Meal: (",FHMEAL,")"
"RTN","FHORX1A",90,0)
 ..I $Y>(IOSL-6) D HDR
"RTN","FHORX1A",91,0)
 ..W:FHMTY'="" !,?14,"Service Type: ",FHMTY
"RTN","FHORX1A",92,0)
 ..W:FHCLA'="" !,?14,"Classification: ",FHCLA
"RTN","FHORX1A",93,0)
 ..W:FHCOS'="" !,?14,"Charge: ",FHCOS
"RTN","FHORX1A",94,0)
 .;
"RTN","FHORX1A",95,0)
 .I FHMTY="SPECIAL" D  Q
"RTN","FHORX1A",96,0)
 ..W:FHDTE'="" !!,?12,"Date: ",FHDTE
"RTN","FHORX1A",97,0)
 ..W:FHDIET'="" !,?14,"Diet: ",FHDIET
"RTN","FHORX1A",98,0)
 ..W:FHSTANAM'="" !,?14,"Status: ",FHSTANAM
"RTN","FHORX1A",99,0)
 ..W:FHMEAL'="" !,?14,"Meal: (",FHMEAL,")"
"RTN","FHORX1A",100,0)
 ..W:FHMTY'="" !,?14,"Service Type: ",FHMTY
"RTN","FHORX1A",101,0)
 ..I FHCOMM'="" S EVT="  Comment: "_FHCOMM D LNE^FHORX1C
"RTN","FHORX1A",102,0)
 .S (FHAOT,FHAOC,FHELTT,FHELTBM,FHTFCOM,FHTFTC,FHTFTKD,FHTFPR)=""
"RTN","FHORX1A",103,0)
 .S (FHDAIN,FHAOCN)=""
"RTN","FHORX1A",104,0)
 .I $D(^FHPT(FHDFN,"OP","B",FHDA)) D
"RTN","FHORX1A",105,0)
 ..S FHDAIN=$O(^FHPT(FHDFN,"OP","B",FHDA,0))
"RTN","FHORX1A",106,0)
 .I $G(FHDAIN),$D(^FHPT(FHDFN,"OP",FHDAIN,1)) D
"RTN","FHORX1A",107,0)
 ..S FHRDAT1=$G(^FHPT(FHDFN,"OP",FHDAIN,1))
"RTN","FHORX1A",108,0)
 ..S FHAOT=$P(FHRDAT1,U,1)
"RTN","FHORX1A",109,0)
 ..S FHAOC=$P(FHRDAT1,U,2)
"RTN","FHORX1A",110,0)
 ..S FHAOCN=$P(FHRDAT1,U,5)
"RTN","FHORX1A",111,0)
 ..S:FHAOCN="C" FHAOCN="Cancelled"
"RTN","FHORX1A",112,0)
 ..I $G(FHAOC),($D(^VA(200,FHAOC,0))) S FHAOC=$P(^VA(200,FHAOC,0),U,1)
"RTN","FHORX1A",113,0)
 .I $D(^FHPT(FHDFN,"OP","SM",FHDA,1)) D
"RTN","FHORX1A",114,0)
 ..S FHRDAT1=$G(^FHPT(FHDFN,"OP","SM",FHDA,1))
"RTN","FHORX1A",115,0)
 ..S FHELTT=$P(FHRDAT1,U,1)
"RTN","FHORX1A",116,0)
 ..S FHELTBM=$P(FHRDAT1,U,2)
"RTN","FHORX1A",117,0)
 ..I $G(FHAOC),($D(^VA(200,FHAOC,0))) S FHAOC=$P(^VA(200,FHAOC,0),U,1)
"RTN","FHORX1A",118,0)
 .I $D(^FHPT(FHDFN,"OP",FHDA,2)) D
"RTN","FHORX1A",119,0)
 ..S FHRDAT2=$G(^FHPT(FHDFN,"OP",FHDAIN,2))
"RTN","FHORX1A",120,0)
 ..S FHELTT=$P(FHRDAT2,U,1)
"RTN","FHORX1A",121,0)
 ..S FHELTBM=$P(FHRDAT2,U,2)
"RTN","FHORX1A",122,0)
 .S FHTFCN=""
"RTN","FHORX1A",123,0)
 .I $G(FHDAIN),$D(^FHPT(FHDFN,"OP",FHDAIN,3)) D
"RTN","FHORX1A",124,0)
 ..S FHRDAT3=$G(^FHPT(FHDFN,"OP",FHDAIN,3))
"RTN","FHORX1A",125,0)
 ..S FHTFCOM=$P(FHRDAT3,U,1)
"RTN","FHORX1A",126,0)
 ..S FHTFTC=$P(FHRDAT3,U,2)
"RTN","FHORX1A",127,0)
 ..S FHTFTKD=$P(FHRDAT3,U,3)
"RTN","FHORX1A",128,0)
 ..S FHTFCN=$P(FHRDAT3,U,5)
"RTN","FHORX1A",129,0)
 ..S:FHTFCN="C" FHTFCN="Cancelled"
"RTN","FHORX1A",130,0)
 .;get Tube Feeding data
"RTN","FHORX1A",131,0)
 .I $G(FHDAIN) D
"RTN","FHORX1A",132,0)
 ..F FHTFDA=0:0 S FHTFDA=$O(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA)) Q:FHTFDA'>0  D
"RTN","FHORX1A",133,0)
 ...S FHTFDAT=$G(^FHPT(FHDFN,"OP",FHDAIN,"TF",FHTFDA,0))
"RTN","FHORX1A",134,0)
 ...S FHTFPR=$P(FHTFDAT,U,1)
"RTN","FHORX1A",135,0)
 ...I $G(FHTFPR),$D(^FH(118.2,FHTFPR,0)) S FHTFPR=$P(^FH(118.2,FHTFPR,0),U,1)
"RTN","FHORX1A",136,0)
 ...S FHTFST=$P(FHTFDAT,U,2)
"RTN","FHORX1A",137,0)
 ...S:$G(FHTFST) FHTFST=$S(FHTFST=1:"1/4",FHTFST=2:"1/2",FHTFST=3:"3/4",FHTFST=4:"FULL",1:"")
"RTN","FHORX1A",138,0)
 ...S FHTFQU=$P(FHTFDAT,U,3)
"RTN","FHORX1A",139,0)
 ...S FHTFCC=$P(FHTFDAT,U,4)
"RTN","FHORX1A",140,0)
 .W:FHDTE'="" !!,?12,"Date: ",FHDTE
"RTN","FHORX1A",141,0)
 .W:FHDIET'="" !,?14,"Diet: ",FHDIET
"RTN","FHORX1A",142,0)
 .W:FHMEAL'="" !,?14,"Meal: (",FHMEAL,")"
"RTN","FHORX1A",143,0)
 .W:FHMTY'="" !,?14,"Service Type: ",FHMTY
"RTN","FHORX1A",144,0)
 .;
"RTN","FHORX1A",145,0)
 .I FHAOT'="",FHMTY="RECURRING" S EVT="  Additional Order: "_FHAOT_" "_FHAOCN_" By: "_FHAOC D LNE^FHORX1C
"RTN","FHORX1A",146,0)
 .I FHELTT'="" S EVT="  Early/Late Tray Time: "_FHELTT_"  Bag Meal: "_FHELTBM D LNE^FHORX1C
"RTN","FHORX1A",147,0)
 .I FHTFCOM'="",FHMTY="RECURRING" S EVT="  TF: "_FHTFCOM_"  TF Total MLs: "_FHTFTC_"  TF Total KCALS/Day: "_FHTFTKD_" "_FHTFCN D LNE^FHORX1C
"RTN","FHORX1A",148,0)
 .I FHTFPR'="",FHMTY="RECURRING" D
"RTN","FHORX1A",149,0)
 ..S EVT="  TF Product: "_FHTFPR_"  TF Strength: "_FHTFST_"  TF Quantity: "_FHTFQU_"  TF Product ML/Day: "_FHTFCC_" "_FHTFCN
"RTN","FHORX1A",150,0)
 ..D LNE^FHORX1C
"RTN","FHORX1A",151,0)
 .;
"RTN","FHORX1A",152,0)
 K ALG I $G(DFN) D ALG^FHCLN I ALG'="" S EVT="Allergies: "_ALG,TYP="A" D LNE^FHORX1C
"RTN","FHORX1A",153,0)
 S DA=FHDASAV
"RTN","FHORX1A",154,0)
 ;get food preference
"RTN","FHORX1A",155,0)
 S FHFPDAT=$O(^FHPT(FHDFN,"P",0))
"RTN","FHORX1A",156,0)
 I $G(FHFPDAT) D
"RTN","FHORX1A",157,0)
 .F FHFPI=0:0 S FHFPI=$O(^FHPT(FHDFN,"P",FHFPI)) Q:FHFPI'>0  D
"RTN","FHORX1A",158,0)
 ..S FHFPDAT1=$G(^FHPT(FHDFN,"P",FHFPI,0))
"RTN","FHORX1A",159,0)
 ..S FHFP52=$P(FHFPDAT1,U,1)
"RTN","FHORX1A",160,0)
 ..S FHFPME=$P(FHFPDAT1,U,2)
"RTN","FHORX1A",161,0)
 ..I $G(FHFP52),$D(^FH(115.2,FHFP52,0)) D
"RTN","FHORX1A",162,0)
 ...S EVT="Pref: "_$P(^FH(115.2,FHFP52,0),U,1)_"  ("_FHFPME_")"
"RTN","FHORX1A",163,0)
 ...I $Y>(IOSL-6) D HDR W !!,$E(W1,1,20),?22,FHPNM,?50,FHBID,?73,FHTCD
"RTN","FHORX1A",164,0)
 ...D LNE^FHORX1C
"RTN","FHORX1A",165,0)
 Q
"RTN","FHORX1A",166,0)
 ;
"RTN","FHORX1A",167,0)
HDR ;W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1 W !?20,"D I E T   A C T I V I T Y   R E P O R T",?72,"Page ",PG
"RTN","FHORX1A",168,0)
 W @IOF S PG=PG+1 W !?20,"D I E T   A C T I V I T Y   R E P O R T",?72,"Page ",PG
"RTN","FHORX1A",169,0)
 W !!?(80-$L(H1)\2),H1
"RTN","FHORX1A",170,0)
 W !,?30,FHPIO
"RTN","FHORX1A",171,0)
 W !!,"Location",?22,"Patient",?50,"ID#",?62,"Sup/Std  Service"
"RTN","FHORX1A",172,0)
 Q
"RTN","FHORX1A",173,0)
 ;
"RTN","FHORX1A",174,0)
NEWP K ALG I $G(DFN) D ALG^FHCLN I ALG'="" S EVT="Allergies: "_ALG,TYP="A" D LNE^FHORX1C
"RTN","FHORX1A",175,0)
 Q:'$D(^FHPT(FHDFN,"P"))
"RTN","FHORX1A",176,0)
 S X1="Pref:" F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0) D N1
"RTN","FHORX1A",177,0)
 W:$L(X1)>6 !?12,X1 Q
"RTN","FHORX1A",178,0)
 ;
"RTN","FHORX1A",179,0)
N1 S Y=$G(^FH(115.2,+X,0)) Q:$P(Y,"^",2)'="D"
"RTN","FHORX1A",180,0)
 S Y=" "_$P(Y,"^",1)_" ("_$P(X,"^",2)_")"_$S($P(X,"^",4)="Y":" (D)",1:"") I $L(X1)+$L(Y)>48 W !?12,X1 S X1="Pref:"
"RTN","FHORX1A",181,0)
 S X1=X1_Y Q
"RTN","FHORX1A",182,0)
 ;
"RTN","FHORX1A",183,0)
LNE ; Break line if longer than 58 chars
"RTN","FHORX1A",184,0)
 I $Y>(IOSL-6) D HDR^FHORX1A W !
"RTN","FHORX1A",185,0)
 I $L(EVT)<59 G EX
"RTN","FHORX1A",186,0)
 F KK=59:-1:4 Q:$E(EVT,KK)?1P
"RTN","FHORX1A",187,0)
 I KK=4 S KK=45 W !?5,$E(EVT,1,58)
"RTN","FHORX1A",188,0)
 E  W !?5,$E(EVT,1,KK-1)
"RTN","FHORX1A",189,0)
 S EVT="    "_$E(EVT,KK+1,999) G LNE
"RTN","FHORX1A",190,0)
EX W !?5,EVT Q
"RTN","FHORX1B")
0^23^B12206977
"RTN","FHORX1B",1,0)
FHORX1B ; HISC/REL/RVD - Diet Activity Labels ;8/26/94  12:10
"RTN","FHORX1B",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHORX1B",3,0)
 ;
"RTN","FHORX1B",4,0)
 ;^tmp($J,"I" - for inpatient data.
"RTN","FHORX1B",5,0)
 ;^tmp($J,"O" - for outpatient data;
"RTN","FHORX1B",6,0)
 ;
"RTN","FHORX1B",7,0)
 ;S FHPIO="** INPATIENT **"
"RTN","FHORX1B",8,0)
 S S2=LAB=2*5+36 I LAB<3 D LHD
"RTN","FHORX1B",9,0)
 S COUNT=0,LINE=1
"RTN","FHORX1B",10,0)
 S P0="",NN=0 F  S P0=$O(^TMP($J,"I",P0)) Q:P0=""  D LST
"RTN","FHORX1B",11,0)
 ;S FHPIO="** OUTPATIENT **"
"RTN","FHORX1B",12,0)
 D LST1    ;go process event for outpatient
"RTN","FHORX1B",13,0)
 S:$G(FHP) $P(^FH(119.73,FHP,0),"^",3)=NOW
"RTN","FHORX1B",14,0)
 I '$G(FHP) F FHII=0:0 S FHII=$O(^FH(119.73,FHII)) Q:FHII'>0  S $P(^FH(119.73,FHII,0),"^",3)=NOW
"RTN","FHORX1B",15,0)
 I LAB>2 D DPLL^FHLABEL
"RTN","FHORX1B",16,0)
 I LAB<3 F L=1:1:18 W !
"RTN","FHORX1B",17,0)
 K ^TMP($J) D KILL^XUSCLEAN
"RTN","FHORX1B",18,0)
 Q
"RTN","FHORX1B",19,0)
LST K PP S NP=0,LOC=0 F DA=0:0 S DA=$O(^TMP($J,"I",P0,DA)) Q:DA<1  S Z=^(DA) D L1
"RTN","FHORX1B",20,0)
 Q:LOC
"RTN","FHORX1B",21,0)
 I $D(PP) D L2 D:$G(FHORD) WRT
"RTN","FHORX1B",22,0)
 Q
"RTN","FHORX1B",23,0)
 ;
"RTN","FHORX1B",24,0)
LST1 ;process outpatient
"RTN","FHORX1B",25,0)
 K PP S NP=0,LOC=0,P0="" F  S P0=$O(^TMP($J,"O",P0)) Q:P0=""  D T2
"RTN","FHORX1B",26,0)
 Q
"RTN","FHORX1B",27,0)
 ;
"RTN","FHORX1B",28,0)
L1 ; Process event for inpatient
"RTN","FHORX1B",29,0)
 S ADM=$P(Z,"^",1),TYP=$P(Z,"^",2),ACT=$P(Z,"^",3),FHORD=$P(Z,"^",4),TXT=$P(Z,"^",5)
"RTN","FHORX1B",30,0)
 Q:"DIL"'[TYP  I 'FHORD S NN=NN+1,FHORD=NN
"RTN","FHORX1B",31,0)
 I "DI"[TYP D
"RTN","FHORX1B",32,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1B",33,0)
 .K PP(TYP) S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT Q
"RTN","FHORX1B",34,0)
 I TYP="L" D
"RTN","FHORX1B",35,0)
 .I ACT="D" S LOC=1 Q
"RTN","FHORX1B",36,0)
 .S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT S:ACT="A" NP=1 Q
"RTN","FHORX1B",37,0)
 Q
"RTN","FHORX1B",38,0)
 ;
"RTN","FHORX1B",39,0)
L2 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),FHDFN=$P(P0,"~",5)
"RTN","FHORX1B",40,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORX1B",41,0)
 S Y0=$G(^DPT(DFN,0))
"RTN","FHORX1B",42,0)
 S N1=$P(Y0,"^",1) D PID^FHDPA
"RTN","FHORX1B",43,0)
 S TC=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",5),IS=$P($G(^(0)),"^",10),FHORD=+$P($G(^(0)),"^",2)
"RTN","FHORX1B",44,0)
 Q:'FHORD
"RTN","FHORX1B",45,0)
 I IS S IS=$G(^FH(119.4,IS,0)) I IS'="" S TC=TC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORX1B",46,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,"DI",FHORD,0)) D CUR
"RTN","FHORX1B",47,0)
 Q
"RTN","FHORX1B",48,0)
 ;
"RTN","FHORX1B",49,0)
T2 ;get the last outpatient entry.
"RTN","FHORX1B",50,0)
 K PP S NP=0,LOC=0 F FH8=0:0 S FH8=$O(^TMP($J,"O",P0,FH8)) Q:FH8'>0  D
"RTN","FHORX1B",51,0)
 .S FHTDAT=$G(^TMP($J,"O",P0,FH8))
"RTN","FHORX1B",52,0)
 .S FHACTI=$P(FHTDAT,"^",1)
"RTN","FHORX1B",53,0)
 .Q:FHACTI'="O"
"RTN","FHORX1B",54,0)
 .S BID=$P(FHTDAT,"^",3)
"RTN","FHORX1B",55,0)
 .S FHDESC=$P(FHTDAT,"^",4)
"RTN","FHORX1B",56,0)
 .S TC=$P(FHTDAT,"^",5)
"RTN","FHORX1B",57,0)
 .S FHDES1=$P(FHDESC,",",1)
"RTN","FHORX1B",58,0)
 .S FHDIET=$P(FHDES1,":",2),FHDIET=$E(FHDIET,2,$L(FHDIET))
"RTN","FHORX1B",59,0)
 .I FHDIET'="",$D(^FH(111,"B",FHDIET)) S FHDIDA=$O(^FH(111,"B",FHDIET,0))
"RTN","FHORX1B",60,0)
 .Q:'$G(FHDIDA)
"RTN","FHORX1B",61,0)
 .I $G(FHDIDA),$D(^FH(111,FHDIDA,0)) S FHDIET=$P(^FH(111,FHDIDA,0),U,7)
"RTN","FHORX1B",62,0)
 .;S:FHDIET="" FHDIET="NO ORDER"
"RTN","FHORX1B",63,0)
 .S Y=FHDIET
"RTN","FHORX1B",64,0)
 .S W1=$P(P0,"~",2),R1=$P(P0,"~",4),N1=$P(P0,"~",5)
"RTN","FHORX1B",65,0)
 .D WRT
"RTN","FHORX1B",66,0)
 Q
"RTN","FHORX1B",67,0)
 ;
"RTN","FHORX1B",68,0)
WRT I LAB>2 D LL Q
"RTN","FHORX1B",69,0)
 W !,$E(N1,1,S2-5-$L(W1)),?(S2-3-$L(W1)),W1,!,BID W:NP " *"
"RTN","FHORX1B",70,0)
 W @FHIO("EON") W ?(S2-3\2),TC W @FHIO("EOF") W ?(S2-3-$L(R1)),R1 W @FHIO("EON") I $L(Y)<S2 W:LAB=2 ! W !!,Y,!!
"RTN","FHORX1B",71,0)
 E  S L=$S($L($P(Y,",",1,3))<S2:3,1:2) W !!,$P(Y,",",1,L) W:LAB=2 ! W !,$E($P(Y,",",L+1,5),2,99),!
"RTN","FHORX1B",72,0)
 W @FHIO("EOF") W:LAB=2 ?(S2-20),$P(H1," - ",2),!! Q
"RTN","FHORX1B",73,0)
 ;
"RTN","FHORX1B",74,0)
LHD S A1=S2-30\2 W:LAB=2 ! W !?A1,"***************************",!?A1,"*",?(A1+26),"*",!?A1,"*",?(A1+5),$P(H1," - ",2),?(A1+26),"*"
"RTN","FHORX1B",75,0)
 W !?A1,"*",?(A1+26),"*",!?A1,"***************************",! W:LAB=2 !! Q
"RTN","FHORX1B",76,0)
CUR S Y="" Q:X=""  S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORX1B",77,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORX1B",78,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORX1B",79,0)
 Q
"RTN","FHORX1B",80,0)
LL ;
"RTN","FHORX1B",81,0)
 S X1=TC S:NP BID=BID_" *"
"RTN","FHORX1B",82,0)
 D LAB^FHLABEL Q
"RTN","FHWHEA")
0^29^B20746038
"RTN","FHWHEA",1,0)
FHWHEA ; HISC/REL - Health Summary ;7/16/96  15:47
"RTN","FHWHEA",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHWHEA",3,0)
 S FH9=9999999,FHS1=$S(GMTS2<1:1,1:FH9-GMTS2),FHS2=$S(GMTS1<1:FH9,1:FH9-GMTS1)
"RTN","FHWHEA",4,0)
 K ^UTILITY($J) S (FHN1,FHN2,FHN3,FHN4)=0
"RTN","FHWHEA",5,0)
 ; Nutrition Status in inverse order
"RTN","FHWHEA",6,0)
 S FHZ115="P"_DFN D CHECK^FHOMDPA I FHDFN="" Q
"RTN","FHWHEA",7,0)
 S FHL=0 F FHX1=GMTS1:0 S FHX1=$O(^FHPT(FHDFN,"S",FHX1)) Q:FHX1'>0!(FHX1>GMTS2)  I $D(^(FHX1,0)) S FHX2=^(0) D NS S ^UTILITY($J,"NS",FHX1,0)=$P(FHX2,"^",1)_"^"_FHY,FHL=FHL+1 I GMTSNDM=FHL Q
"RTN","FHWHEA",8,0)
 ; Dietetic Encounters
"RTN","FHWHEA",9,0)
 F FHX1=FHS1:0 S FHX1=$O(^FHEN("AP",DFN,FHX1)) Q:FHX1=""!(FHX1>FHS2)  F FHI=0:0 S FHI=$O(^FHEN("AP",DFN,FHX1,FHI)) Q:FHI<1  D EN
"RTN","FHWHEA",10,0)
 F FHADM=0:0 S FHADM=$O(^FHPT(FHDFN,"A",FHADM)) Q:FHADM'>0  D CHK
"RTN","FHWHEA",11,0)
 I GMTSNDM'>0 G KIL
"RTN","FHWHEA",12,0)
 I FHN1>GMTSNDM S FHL=0 F FHI=0:0 S FHI=$O(^UTILITY($J,"DI",FHI)) Q:FHI=""  S FHL=FHL+1 I FHL>GMTSNDM K ^UTILITY($J,"DI",FHI)
"RTN","FHWHEA",13,0)
 I FHN2>GMTSNDM S FHL=0 F FHI=0:0 S FHI=$O(^UTILITY($J,"TF",FHI)) Q:FHI=""  S FHL=FHL+1 I FHL>GMTSNDM K ^UTILITY($J,"TF",FHI)
"RTN","FHWHEA",14,0)
 I FHN3>GMTSNDM S FHL=0 F FHI=0:0 S FHI=$O(^UTILITY($J,"SF",FHI)) Q:FHI=""  S FHL=FHL+1 I FHL>GMTSNDM K ^UTILITY($J,"SF",FHI)
"RTN","FHWHEA",15,0)
 I FHN4>GMTSNDM S FHL=0 F FHI=0:0 S FHI=$O(^UTILITY($J,"EN",FHI)) Q:FHI=""  S FHL=FHL+1 I FHL>GMTSNDM K ^UTILITY($J,"EN",FHI)
"RTN","FHWHEA",16,0)
 G KIL
"RTN","FHWHEA",17,0)
CHK ;
"RTN","FHWHEA",18,0)
 S FHY=$P($G(^DGPM(FHADM,0)),"^",17) S:FHY>0 FHY=$P($G(^DGPM(+FHY,0)),"^",1)
"RTN","FHWHEA",19,0)
 I FHY,FHY<FHS1 Q
"RTN","FHWHEA",20,0)
 ; Diet Order in inverse order
"RTN","FHWHEA",21,0)
 S FHP="" F FHI=FHS1:0 S FHI=$O(^FHPT(FHDFN,"A",FHADM,"AC",FHI)) Q:FHI=""!(FHI>FHS2)  I $D(^(FHI,0)) S FHX=^(0) D DI S ^UTILITY($J,"DI",(FH9-FHI),0)=FHX,FHN1=FHN1+1 S:FHP $P(^UTILITY($J,"DI",FHP,0),"^",2)=FHI S FHP=FH9-FHI
"RTN","FHWHEA",22,0)
 ; Tubefeeding in inverse order
"RTN","FHWHEA",23,0)
 F FHI=0:0 S FHI=$O(^FHPT(FHDFN,"A",FHADM,"TF",FHI)) Q:FHI=""  I $D(^(FHI,0)) S FHX=^(0) D TF I FHX S ^UTILITY($J,"TF",(FH9-FHX1),0)=FHX,FHN2=FHN2+1
"RTN","FHWHEA",24,0)
 ; Supplemental feeding in inverse order
"RTN","FHWHEA",25,0)
 F FHI=0:0 S FHI=$O(^FHPT(FHDFN,"A",FHADM,"SF",FHI)) Q:FHI=""  I $D(^(FHI,0)) S FHX=^(0) D SF I FHX S ^UTILITY($J,"SF",FH9-FHX1,0)=FHX,FHN3=FHN3+1
"RTN","FHWHEA",26,0)
 Q
"RTN","FHWHEA",27,0)
DI ; Decode Diet Order
"RTN","FHWHEA",28,0)
 S FHX=^FHPT(FHDFN,"A",FHADM,"DI",$P(FHX,"^",2),0),FHX2=$G(^(1)),FHX3=""
"RTN","FHWHEA",29,0)
 S FHOR=$P(FHX,"^",2,6),FHLD=$P(FHX,"^",7),FHY=""
"RTN","FHWHEA",30,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") S:%>0 FHY=$P($E(FHDU,%,999),";",1) K % G D1
"RTN","FHWHEA",31,0)
 S FHY="" F FHK1=1:1:5 S FHL=$P(FHOR,"^",FHK1) I FHL S:FHY'="" FHY=FHY_", " S FHY=FHY_$P($G(^FH(111,FHL,0)),"^",7)
"RTN","FHWHEA",32,0)
 S FHX3=$P(FHX,"^",8) S:FHX3'="" FHX3=$S(FHX3="T":"Tray",FHX3="D":"Dining Room",1:"Cafeteria")
"RTN","FHWHEA",33,0)
D1 S FHX=FHI_"^"_$P(FHX,"^",10)_"^"_FHY_"^"_FHX2_"^"_FHX3 Q
"RTN","FHWHEA",34,0)
SF ; Decode Supp. Fdg.
"RTN","FHWHEA",35,0)
 S FHX1=$P(FHX,"^",2) I FHX1<FHS1!(FHX1>FHS2) S FHX="" Q
"RTN","FHWHEA",36,0)
 S FHL=4 F FHK1=1:1:3 S FHN(FHK1)="" F FHK2=1:1:4 S FHX2=$P(FHX,"^",FHL+1),FHX3=$P(FHX,"^",FHL+2),FHL=FHL+2 I FHX2 S:FHN(FHK1)'="" FHN(FHK1)=FHN(FHK1)_"; " S FHN(FHK1)=FHN(FHK1)_$S(FHX3:FHX3,1:1)_" "_$P($G(^FH(118,FHX2,0)),"^",1)
"RTN","FHWHEA",37,0)
 I $L(FHX1_"^"_$P(FHX,"^",32)_"^"_FHN(1)_"^"_FHN(2)_"^"_FHN(3))>240 D BRK
"RTN","FHWHEA",38,0)
 S FHX=(FHX1\1)_"^"_$P(FHX,"^",32)_"^"_FHN(1)_"^"_FHN(2)_"^"_FHN(3)
"RTN","FHWHEA",39,0)
 Q
"RTN","FHWHEA",40,0)
NS ; Decode Nut Status
"RTN","FHWHEA",41,0)
 S FHY=$P($G(^FH(115.4,+$P(FHX2,"^",2),0)),"^",2) Q
"RTN","FHWHEA",42,0)
TF ; Decode Tubefeeding
"RTN","FHWHEA",43,0)
 S FHX1=$P(FHX,"^",1) I FHX1<FHS1!(FHX1>FHS2) S FHX="" Q
"RTN","FHWHEA",44,0)
 S %=$O(^FHPT(FHDFN,"A",FHADM,"TF",FHI,"P",0)) S:% %=^(%,0)
"RTN","FHWHEA",45,0)
 S FHX2=$P(%,"^",1),FHX3=$P(%,"^",2),FHX4=$P(%,"^",3)
"RTN","FHWHEA",46,0)
 I FHX4["CC" S QUAFI=$P(FHX4,"CC",1),QUASE=$P(FHX4,"CC",2),FHX4=QUAFI_"ML"_QUASE
"RTN","FHWHEA",47,0)
 S:FHX2 FHX2=$S($D(^FH(118.2,FHX2,0)):$P(^(0),"^",1),1:" ")
"RTN","FHWHEA",48,0)
 S:FHX3 FHX3=$S(FHX3=4:"Full",FHX3=1:"1/4",FHX3=2:"1/2",1:"3/4")
"RTN","FHWHEA",49,0)
 S FHX=FHX1_"^"_$P(FHX,"^",11)_"^"_FHX2_"^"_FHX3_"^"_FHX4_"^"_$P(FHX,"^",6)_"^"_$P(FHX,"^",7)_"^"_$P(FHX,"^",5) Q
"RTN","FHWHEA",50,0)
EN ; Decode Dietetic Encounter
"RTN","FHWHEA",51,0)
 S FHX2=$G(^FHEN(FHI,0)),FHX3=$P(FHX2,"^",4) Q:'FHX3  S FHX3=$P($G(^FH(115.6,+FHX3,0)),"^",1)
"RTN","FHWHEA",52,0)
 S FHX=FHX1_"^"_FHX3_"^"_$P(FHX2,"^",11)_"^"_$P($G(^FHEN(FHI,"P",DFN,0)),"^",4)
"RTN","FHWHEA",53,0)
 S ^UTILITY($J,"EN",(FH9-FHX1),0)=FHX,FHN4=FHN4+1 Q
"RTN","FHWHEA",54,0)
 Q
"RTN","FHWHEA",55,0)
BRK ; Break Supplemental Feeding
"RTN","FHWHEA",56,0)
 S FHVAL=""
"RTN","FHWHEA",57,0)
 D STP(FHN(1),.FHVAL) S FHN(1)=FHVAL
"RTN","FHWHEA",58,0)
 D STP(FHN(2),.FHVAL) S FHN(2)=FHVAL
"RTN","FHWHEA",59,0)
 D STP(FHN(3),.FHVAL) S FHN(3)=FHVAL
"RTN","FHWHEA",60,0)
 Q
"RTN","FHWHEA",61,0)
STP(FHVAL1,FHVAL2) ; Strip Excess Spaces and truncate SF from 20 to 16 char
"RTN","FHWHEA",62,0)
 S FHVAL2=""
"RTN","FHWHEA",63,0)
 F FHK2=1:1:4 S FHP1=$P(FHVAL1,";",FHK2) I FHP1'="" S:$E(FHP1,1)=" " FHP1=$E(FHP1,2,$L(FHP1)) S:FHVAL2'="" FHVAL2=FHVAL2_";" S FHVAL2=FHVAL2_$E(FHP1,1,16)
"RTN","FHWHEA",64,0)
 Q
"RTN","FHWHEA",65,0)
KIL K %,FHADM,FHDU,FHI,FHK1,FHK2,FHL,FHLD,FHN,FHN1,FHN2,FHN3,FHN4,FHOR,FHP,FHP1,FHX,FHX1,FHX2,FHX3,FHX4,FHS1,FHS2,FH9,FHFHY,FHVAL,FHVAL1,FHVAL2 Q
"RTN","FHWOR5")
0^24^B19013679
"RTN","FHWOR5",1,0)
FHWOR5 ; HISC/NCA - HL7 Tubefeeding ;10/10/00  14:57
"RTN","FHWOR5",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHWOR5",3,0)
 K TUN S (NO,TC,TK,TP,TW,S2)=0,CTR=5
"RTN","FHWOR5",4,0)
 F NUM=1:1:5 S DATA=$G(FHMSG(CTR)) Q:DATA=""  S CTR=CTR+1,DATA1=$G(FHMSG(CTR)) Q:DATA1=""  D ^FHWOR51 S CTR=CTR+1 Q:TXT'=""
"RTN","FHWOR5",5,0)
 I TXT'="" D ERR^FHWOR Q
"RTN","FHWOR5",6,0)
 S (TC,TK)=0 W !
"RTN","FHWOR5",7,0)
 F TT=0:0 S TT=$O(TUN(TT)) Q:TT<1  D
"RTN","FHWOR5",8,0)
 .S TC=TC+$P(TUN(TT),"^",4)+$P(TUN(TT),"^",5)
"RTN","FHWOR5",9,0)
 .S TK=TK+$P(TUN(TT),"^",6) Q
"RTN","FHWOR5",10,0)
 I TC>5000 S TXT="WARNING: Total amount exceeds 5000ml. " D ERR^FHWOR Q
"RTN","FHWOR5",11,0)
 S FHRDER=+FHORN,CAN=$$CANCEL^ORCDFH(FHRDER),FHRDER=FHORN
"RTN","FHWOR5",12,0)
 ; Process TF
"RTN","FHWOR5",13,0)
 S FHTF=$P($G(^FHPT(FHDFN,"A",ADM,0)),"^",4) I FHTF D ORCAN
"RTN","FHWOR5",14,0)
 D ^FHORT11 S $P(^FHPT(FHDFN,"A",ADM,"TF",TF,0),"^",14)=+FHORN
"RTN","FHWOR5",15,0)
 S FILL="T"_";"_ADM_";"_TF_";"_TC_";"_TK_";"_TFCOM_";"_CAN D SEND^FHWOR
"RTN","FHWOR5",16,0)
 K %,A1,A2,A3,CAN,DATA,DATA1,DIET,DUR,DX,K,FHRDER,FHMSG,FHOL,FHSTR,FHY,QUA,S1,S2,T,TC,TF,TFCOM,TK,TP,TT,TUN,TW,TYP,X
"RTN","FHWOR5",17,0)
 Q
"RTN","FHWOR5",18,0)
ORCAN ; Cancel Tubefeeding when Order Comes From OE/RR
"RTN","FHWOR5",19,0)
 N FHORN,FILL,COM D NOW^%DTC S NOW=%
"RTN","FHWOR5",20,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",4)="" K ^FHPT("ADTF",FHDFN,ADM)
"RTN","FHWOR5",21,0)
 S $P(^FHPT(FHDFN,"A",ADM,"TF",FHTF,0),"^",11,12)=NOW_"^"_DUZ
"RTN","FHWOR5",22,0)
 S FHORN=$P(^FHPT(FHDFN,"A",ADM,"TF",FHTF,0),"^",14)
"RTN","FHWOR5",23,0)
 S FHSAV=$G(^FHPT(FHDFN,"A",ADM,"TF",FHTF,0))
"RTN","FHWOR5",24,0)
 K % S EVT="T^C^"_FHTF D ^FHORX I FHORN S FILL="T"_";"_ADM_";"_FHTF_";"_$P(FHSAV,"^",6)_";"_$P(FHSAV,"^",7)_";"_$P(FHSAV,"^",5)_";" D CODE D:$D(MSG) MSG^XQOR("FH EVSEND OR",.MSG) K MSG,FHSAV,FILL
"RTN","FHWOR5",25,0)
 Q
"RTN","FHWOR5",26,0)
CAN ; Process Cancel/Discontinue from OE/RR
"RTN","FHWOR5",27,0)
 S TF=$P(FILL,";",3) I 'TF D CSEND^FHWOR Q
"RTN","FHWOR5",28,0)
 D GADM^FHWORR
"RTN","FHWOR5",29,0)
 I '$D(^FHPT(FHDFN,"A",+ADM,"TF",+TF,0)) D CSEND^FHWOR Q
"RTN","FHWOR5",30,0)
 D NOW^%DTC S NOW=%
"RTN","FHWOR5",31,0)
 I $P($G(^FHPT(FHDFN,"A",ADM,0)),"^",4)'=TF D CSEND^FHWOR Q
"RTN","FHWOR5",32,0)
 I $P($G(^FHPT(FHDFN,"A",ADM,0)),"^",4)="" D CSEND^FHWOR Q
"RTN","FHWOR5",33,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",4)="" K ^FHPT("ADTF",FHDFN,ADM)
"RTN","FHWOR5",34,0)
 S $P(^FHPT(FHDFN,"A",ADM,"TF",TF,0),"^",11,12)=NOW_"^"_DUZ
"RTN","FHWOR5",35,0)
 S EVT="T^C^"_TF D ^FHORX K TF
"RTN","FHWOR5",36,0)
 S FHRDER=FHORN
"RTN","FHWOR5",37,0)
 D CSEND^FHWOR
"RTN","FHWOR5",38,0)
 D CUR^FHORD7 Q:Y=""
"RTN","FHWOR5",39,0)
 S FHCHK=$$RESUME^FHWORR(DFN) I 'FHCHK K FHDFN,FHRDER Q
"RTN","FHWOR5",40,0)
 S FHRES=$$RESUME^ORCDFH(FHRDER) I FHRES D RES K FHRES,FHRDER,FHCHK,FHDFN
"RTN","FHWOR5",41,0)
 Q
"RTN","FHWOR5",42,0)
RES ; Resume Current Tray Service From OE/RR.
"RTN","FHWOR5",43,0)
 N A2,KK,OLD D NOW^%DTC S NOW=%
"RTN","FHWOR5",44,0)
 S A2=0 F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1!(KK'<NOW)  I $P(^(KK,0),"^",2)=FHORD S A2=KK
"RTN","FHWOR5",45,0)
 I 'A2 Q
"RTN","FHWOR5",46,0)
 S DT=$P(NOW,".",1),KK=A2,OLD=FHLD D T0^FHORD3
"RTN","FHWOR5",47,0)
 K %,%H,%I,A1,A2,C,D1,D2,D3,DA,KK,P2,FHDU,NOW,X1,X2,OLD,FHDR,FHORD,FHPAR,FHLD,FHWF,FHPV,FHOR,I,K9,ADM,ALL,COM,TFCOM,FHDFN,DFN,FHD,POP,PID,BID,DTP,QUA,STR,T,TF,TF2,TUN,WARD,X,X9,Y
"RTN","FHWOR5",48,0)
 Q
"RTN","FHWOR5",49,0)
TF ; Code Tubefeeding
"RTN","FHWOR5",50,0)
 K MSG S FILL="T"_";"_ADM_";"_TF_";"_TC_";"_TK_";"_TFCOM_";"_CAN S MNUM=3
"RTN","FHWOR5",51,0)
 S SDT=NOW D SET
"RTN","FHWOR5",52,0)
 ; Code MSH, PID, and PV1
"RTN","FHWOR5",53,0)
 D MSH^FHWOR
"RTN","FHWOR5",54,0)
 ; Code ORC
"RTN","FHWOR5",55,0)
 S MNUM=MNUM+1
"RTN","FHWOR5",56,0)
 S MSG(MNUM)="ORC|SN||"_FILL_"^FH||||^^^"_SDT_"|||"_DUZ_"||"_DUZ_"|||"_NOW
"RTN","FHWOR5",57,0)
 Q
"RTN","FHWOR5",58,0)
TF1 ; Code Multiple Products ODS and ZQT
"RTN","FHWOR5",59,0)
 S STR=$P(XX,"^",2),STR=$S(STR=1:"1/4",STR="2":"1/2",STR=3:"3/4",1:"FULL")_" STRENGTH"
"RTN","FHWOR5",60,0)
 S X=$P(XX,"^",3) D FIX^FHORT10 S QUA=X D DECOD
"RTN","FHWOR5",61,0)
 S QUA=A1_"&"_$E(A2,1),ITVL=A3,MNUM=MNUM+1
"RTN","FHWOR5",62,0)
 S MSG(MNUM)="ODS|ZE||^^^"_+XX_"-"_$P(XX,"^",2)_"^"_$P($G(^FH(118.2,+XX,0)),"^",1)_"^99FHT"_$S(TFCOM'="":"|"_TFCOM,1:"")
"RTN","FHWOR5",63,0)
 S MNUM=MNUM+1
"RTN","FHWOR5",64,0)
 S MSG(MNUM)="ZQT||"_QUA_"^"_ITVL_"^"_$S(FDG'="":FDG,1:"")_"^"_SDT
"RTN","FHWOR5",65,0)
 K A1,A2,A3,FDG,FILL,FHWRD,HOSP,ITVL,L,RM,QUA,SITE,STR,WARD,Z,Z1
"RTN","FHWOR5",66,0)
 Q
"RTN","FHWOR5",67,0)
DECOD ; Decode Tubefeeding to send
"RTN","FHWOR5",68,0)
 S Z1="" F L=1:1:$L(QUA) S Z=$E(QUA,L) I Z'=" " S Z1=Z1_Z
"RTN","FHWOR5",69,0)
 F L=1:1:$L(Z1) Q:$E(Z1,L)?1U
"RTN","FHWOR5",70,0)
 S A2=$E(Z1,L,99),A1=+$E(Z1,1,L-1)
"RTN","FHWOR5",71,0)
 S A3=$P(A2,"/",2),A2=$P(A2,"/",1)
"RTN","FHWOR5",72,0)
 I A3'["X" S FDG="" Q
"RTN","FHWOR5",73,0)
 S FDG=$P(A3,"X",2),FDG=$S($E(FDG,$L(FDG))="F":"X"_+FDG,1:"H"_+FDG),A3=$P(A3,"X",1)
"RTN","FHWOR5",74,0)
 Q
"RTN","FHWOR5",75,0)
CODE ; Code Discontinue TF
"RTN","FHWOR5",76,0)
 K MSG S ACT="OD" D SITE^FH
"RTN","FHWOR5",77,0)
 ; code MSH
"RTN","FHWOR5",78,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||ORM"
"RTN","FHWOR5",79,0)
 ; code PID
"RTN","FHWOR5",80,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHWOR5",81,0)
 ; code ORC
"RTN","FHWOR5",82,0)
 S DATE=$$FMTHL7^XLFDT(NOW)
"RTN","FHWOR5",83,0)
 S MSG(3)="ORC|"_ACT_"|"_FHORN_"^OR|"_FILL_"^FH|||||||||"_FHPV_"|||"_DATE_"|Dietetics Discontinued Tubefeeding order."
"RTN","FHWOR5",84,0)
 K ACT,DATE,FILL,SITE
"RTN","FHWOR5",85,0)
 Q
"RTN","FHWOR5",86,0)
SET ; Set Date/Time in HL7 format
"RTN","FHWOR5",87,0)
 S:SDT SDT=$$FMTHL7^XLFDT(SDT)
"RTN","FHWOR5",88,0)
 S:NOW NOW=$$FMTHL7^XLFDT(NOW)
"RTN","FHWOR5",89,0)
 Q
"RTN","FHWOR5",90,0)
NA ; OE/RR Number Assign
"RTN","FHWOR5",91,0)
 S TF=+$P(FILL,";",3) Q:'TF  S:ADM'=$P(FILL,";",2) ADM=$P(FILL,";",2)
"RTN","FHWOR5",92,0)
 G:'+FHORN KIL
"RTN","FHWOR5",93,0)
 S $P(^FHPT(FHDFN,"A",ADM,"TF",TF,0),"^",14)=+FHORN
"RTN","FHWOR5",94,0)
KIL K MSG,FHORN,TF Q
"RTN","FHWOR51")
0^25^B8841882
"RTN","FHWOR51",1,0)
FHWOR51 ; HISC/NCA - HL7 Tubefeeding (Cont.) ;6/28/96  16:28
"RTN","FHWOR51",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHWOR51",3,0)
 I $E(DATA,1,3)'="ODS" S TXT="Message 5 not ODS as expected." Q
"RTN","FHWOR51",4,0)
 S TYP=$P(DATA,"|",2)
"RTN","FHWOR51",5,0)
 I TYP'="ZE" S TXT="Type of Diet Order not ZE as expected." Q
"RTN","FHWOR51",6,0)
 I $E(DATA1,1,3)'="ZQT" S TXT="Message not ZQT as expected." Q
"RTN","FHWOR51",7,0)
 S QUA=$P(DATA1,"|",3),A1=+QUA,A2=$E($P(QUA,"&",2),1),A3=$P(QUA,"^",2),FDG=$P(QUA,"^",3)
"RTN","FHWOR51",8,0)
 S (TC,TK,TP,TW)=0
"RTN","FHWOR51",9,0)
 S X=A1_A2_"/"_A3
"RTN","FHWOR51",10,0)
 I FDG'="","XH"'[$E(FDG,1) S FDG=""
"RTN","FHWOR51",11,0)
 S:'$E(FDG,2,99) FDG=""
"RTN","FHWOR51",12,0)
 I FDG'="" S X=X_$S($E(FDG,1)="H":"X"_$E(FDG,2,99),1:FDG_"F")
"RTN","FHWOR51",13,0)
 S QUA=X,A2=A2_"/"_$P(QUA,"/",2)
"RTN","FHWOR51",14,0)
 S DIET=$P(DATA,"|",4),DIET=$E(DIET,4,$L(DIET)),TFCOM=$E($P(DATA,"|",5),1,160)
"RTN","FHWOR51",15,0)
 S TT=+$P(DIET,"-",1) I 'TT S TXT="No internal entry number in coded identifier." Q
"RTN","FHWOR51",16,0)
 S STR=+$P(DIET,"-",2) I 'STR S TXT="No Tubefeeding Product Strength." Q
"RTN","FHWOR51",17,0)
 I $E($P(DIET,"^",3),1,5)'="99FHT" S TXT="No 99FHT code."
"RTN","FHWOR51",18,0)
 S T(0)=$G(^FH(118.2,+TT,0))
"RTN","FHWOR51",19,0)
 S A3=$P(A2,"/",2),A2=$P(A2,"/",1)
"RTN","FHWOR51",20,0)
 I $E($P(T(0),"^",3),$L($P(T(0),"^",3)))?1"G" S:$E(A2,1)'="G" A1=A1*+$P(T(0),"^",3),A2="GRAM"
"RTN","FHWOR51",21,0)
 F K=1:1:11 S S1=$P("KCAL CC ML OZ UNITS BOTTLES CANS PKG TBSP GMS GRAMS"," ",K) G:$P(S1,A2,1)="" F3
"RTN","FHWOR51",22,0)
 G ERR
"RTN","FHWOR51",23,0)
F3 S S1=$S(K=1:1,K<4:2,K=4:3,K=9:5,K>9:6,1:4),A2=$P(A3,"X",1),A3=$P(A3,"X",2)
"RTN","FHWOR51",24,0)
 G:A2'?1U.E ERR I $L(A2)=1,"DH"'[A2 G ERR
"RTN","FHWOR51",25,0)
 S S2=$F("DAY QD QH HOUR HR BID TID Q2H Q3H Q4H Q6H QID",A2) G:'S2 ERR S S2=$S(S2<8:1,S2<19:2,S2<23:3,S2<27:4,S2<31:5,S2<35:6,S2<39:7,1:8)
"RTN","FHWOR51",26,0)
 S QUA=A1_" "_$P("KCAL ML OZ UNITS TBSP GM"," ",S1),QUA=QUA_" "_$P($T(F6),";",S2+2)
"RTN","FHWOR51",27,0)
 S:A3'="" QUA=QUA_" X "_(+A3)_" "_$S(A3["F":"fdgs",1:"hrs")
"RTN","FHWOR51",28,0)
 I S1=1 S DX=$P(T(0),"^",4) G:'DX ERR  S TK=A1,TC=A1/DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR51",29,0)
 I S1=4 S DX=+$P(T(0),"^",3) G:'DX ERR S TC=A1*DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR51",30,0)
 S:S1=2 TC=A1 S:S1=3 TC=A1*29.5 S:S1=5 TC=A1*15 I S1=6 S TC=0,A3=0 G C1
"RTN","FHWOR51",31,0)
ML I 'A3 S A3=$P("1,24,2,3,12,8,6,4",",",S2) G C1
"RTN","FHWOR51",32,0)
 I A3'["F" S A3=$S(S2=1:1,S2=2:A3,S2=3:2,S2=4:3,S2=5:A3\2,S2=6:A3\3,S2=7:A3\4,1:A3\6)
"RTN","FHWOR51",33,0)
 E  S:S2=1 A3=1
"RTN","FHWOR51",34,0)
C1 S TC=$J(TC*A3,0,0)
"RTN","FHWOR51",35,0)
 I TC>5000 S TXT="WARNING: Total Amount should be between 0 to 5000 ml."  Q
"RTN","FHWOR51",36,0)
 S:TC'<1 TP=$S(STR=4:TC,STR=3:TC*.75,STR=2:TC/2,1:TC/4),TP=$J(TP,0,0),TW=TC-TP
"RTN","FHWOR51",37,0)
 I S1'=1!(S1'=6) S TK="",DX=$P(T(0),"^",4) I DX S TK=DX*TP,TK=$J(TK,0,0)
"RTN","FHWOR51",38,0)
 S $P(TUN(TT),"^",1,6)=TT_"^"_STR_"^"_QUA_"^"_TP_"^"_TW_"^"_TK,NO=NO+1
"RTN","FHWOR51",39,0)
 Q
"RTN","FHWOR51",40,0)
ERR S TXT="Wrong Interval/Duration." Q
"RTN","FHWOR51",41,0)
F6 ;;per Day;per Hour;Twice a Day;Three times a Day;Every 2 Hours;Every 3 Hours;Every 4 Hours;Every 6 Hours
"RTN","FHWOR5R")
0^26^B5367159
"RTN","FHWOR5R",1,0)
FHWOR5R ; HISC/NCA - HL7 Tubefeeding Function Call ;6/28/96  16:28
"RTN","FHWOR5R",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHWOR5R",3,0)
QUAN(FHS,FHQ) ; Entry Point for OE to get Tubefeeding Quantity.
"RTN","FHWOR5R",4,0)
 N A1,A2,A3,DX,K,QUA,S1,S2,STR,T,TC,TK,TT,X,FDG
"RTN","FHWOR5R",5,0)
 S QUA=FHQ,A1=+QUA,A2=$E($P(QUA,"&",2),1),A3=$P(QUA,"^",2),FDG=$P(QUA,"^",3),TC=""
"RTN","FHWOR5R",6,0)
 S X=A1_A2_"/"_A3
"RTN","FHWOR5R",7,0)
 I FDG'="","XH"'[$E(FDG,1) S FDG=""
"RTN","FHWOR5R",8,0)
 S:'$E(FDG,2,99) FDG=""
"RTN","FHWOR5R",9,0)
 I FDG'="" S X=X_$S($E(FDG,1)="H":"X"_$E(FDG,2,99),1:FDG_"F")
"RTN","FHWOR5R",10,0)
 S QUA=X,A2=A2_"/"_$P(QUA,"/",2)
"RTN","FHWOR5R",11,0)
 S TT=+$P(FHS,"-",1) I 'TT G:'TT EXIT
"RTN","FHWOR5R",12,0)
 S STR=+$P(FHS,"-",2) Q:'STR
"RTN","FHWOR5R",13,0)
 S T(0)=$G(^FH(118.2,+TT,0))
"RTN","FHWOR5R",14,0)
 S A3=$P(A2,"/",2),A2=$P(A2,"/",1)
"RTN","FHWOR5R",15,0)
 I $E($P(T(0),"^",3),$L($P(T(0),"^",3)))?1"G" S:$E(A2,1)'="G" A1=A1*+$P(T(0),"^",3),A2="GRAM"
"RTN","FHWOR5R",16,0)
 F K=1:1:11 S S1=$P("KCAL CC ML OZ UNITS BOTTLES CANS PKG TBSP GMS GRAMS"," ",K) G:$P(S1,A2,1)="" F3
"RTN","FHWOR5R",17,0)
 G EXIT
"RTN","FHWOR5R",18,0)
F3 S S1=$S(K=1:1,K<4:2,K=4:3,K=9:5,K>9:6,1:4),A2=$P(A3,"X",1),A3=$P(A3,"X",2)
"RTN","FHWOR5R",19,0)
 G:A2'?1U.E EXIT I $L(A2)=1,"DH"'[A2 G EXIT
"RTN","FHWOR5R",20,0)
 S S2=$F("DAY QD QH HOUR HR BID TID Q2H Q3H Q4H Q6H QID",A2) G:'S2 EXIT S S2=$S(S2<8:1,S2<19:2,S2<23:3,S2<27:4,S2<31:5,S2<35:6,S2<39:7,1:8)
"RTN","FHWOR5R",21,0)
 S QUA=A1_" "_$P("KCAL ML OZ UNITS TBSP GM"," ",S1),QUA=QUA_" "_$P($T(F6),";",S2+2)
"RTN","FHWOR5R",22,0)
 S:A3'="" QUA=QUA_" X "_(+A3)_" "_$S(A3["F":"fdgs",1:"hrs")
"RTN","FHWOR5R",23,0)
 I S1=1 S DX=$P(T(0),"^",4) G:'DX EXIT  S TK=A1,TC=A1/DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR5R",24,0)
 I S1=4 S DX=+$P(T(0),"^",3) G:'DX EXIT S TC=A1*DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR5R",25,0)
 S:S1=2 TC=A1 S:S1=3 TC=A1*29.5 S:S1=5 TC=A1*15 I S1=6 S TC=0,A3=0 G C1
"RTN","FHWOR5R",26,0)
ML I 'A3 S A3=$P("1,24,2,3,12,8,6,4",",",S2) G C1
"RTN","FHWOR5R",27,0)
 I A3'["F" S A3=$S(S2=1:1,S2=2:A3,S2=3:2,S2=4:3,S2=5:A3\2,S2=6:A3\3,S2=7:A3\4,1:A3\6)
"RTN","FHWOR5R",28,0)
 E  S:S2=1 A3=1
"RTN","FHWOR5R",29,0)
C1 S TC=$J(TC*A3,0,0)
"RTN","FHWOR5R",30,0)
 ;S:TC'<1 TP=$S(STR=4:TC,STR=3:TC*.75,STR=2:TC/2,1:TC/4),TP=$J(TP,0,0),TW=TC-TP
"RTN","FHWOR5R",31,0)
 ;I S1'=1!(S1'=6) S TK="",DX=$P(T(0),"^",4) I DX S TK=DX*TP,TK=$J(TK,0,0)
"RTN","FHWOR5R",32,0)
EXIT Q TC
"RTN","FHWOR5R",33,0)
F6 ;;per Day;per Hour;Twice a Day;Three times a Day;Every 2 Hours;Every 3 Hours;Every 4 Hours;Every 6 Hours
"RTN","FHWOR71")
0^27^B28572181
"RTN","FHWOR71",1,0)
FHWOR71 ; HISC/CAH - Diet Profile for CPRS ;1/30/97  08:54
"RTN","FHWOR71",2,0)
 ;;5.5;DIETETICS;**1**;Jan 28, 2005
"RTN","FHWOR71",3,0)
P(DFN) ;Dietetics Profile for CPRS
"RTN","FHWOR71",4,0)
 ; INPUT:   DFN = Patient file #2 internal record number
"RTN","FHWOR71",5,0)
 ; OUTPUT:  -1^displayable error text   (if invalid DFN or no profile)
"RTN","FHWOR71",6,0)
 ;     with version 5.5 selection of outpatients is allowed
"RTN","FHWOR71",7,0)
 ;          1 if successful, and displayable data in
"RTN","FHWOR71",8,0)
 ;   ^TMP($J,"FHPROF",DFN,n) = line of text
"RTN","FHWOR71",9,0)
 ;          where n = sequential number
"RTN","FHWOR71",10,0)
 ;
"RTN","FHWOR71",11,0)
 I 'DFN Q "-1^Invalid patient selection"
"RTN","FHWOR71",12,0)
 S FHZ115="P"_DFN D CHECK^FHOMDPA I FHDFN="" Q "-1^No Report Available"
"RTN","FHWOR71",13,0)
 N %,%H,%I,%T,%ZIS,A1,ADM,AGE,ALG,ALL,BAG,C,CAL,COM,CON,CT,D3,DA,DAS,FHDU,DOB,DTP,FHI,FHOR,FHLD,FHQ,I,IOP,K,K1,K2,KK,L,L1,LST,MEAL,N,NO,NOW,FHORD,FHWF,FHPV,FHX,FHY
"RTN","FHWOR71",14,0)
 N POP,Q,QUA,QT,QTY,RM,SEX,PID,BID,ST1,ST2,STR,TYP,TF,TF2,TIM,TQU,TUN,WARD,X,X1,X2,XY,Y,YN,Z,Z1
"RTN","FHWOR71",15,0)
 S FHQ=1 K ^TMP($J,"FHPROF",DFN) S FHX=0 D F0
"RTN","FHWOR71",16,0)
 Q FHQ
"RTN","FHWOR71",17,0)
F0 ; Display Diet
"RTN","FHWOR71",18,0)
 D NOW^%DTC S NOW=%,DT=NOW\1,QT=""
"RTN","FHWOR71",19,0)
 S WARD=$G(^DPT(DFN,.1)) I WARD="" D CPRS^FHOMPP Q
"RTN","FHWOR71",20,0)
 ;S WARD=$G(^DPT(DFN,.1)) I WARD="" S FHQ="-1^Not currently an inpatient" Q
"RTN","FHWOR71",21,0)
 S ADM=$G(^DPT("CN",WARD,DFN)) I ADM<1 S FHQ="-1^No current diet order" Q
"RTN","FHWOR71",22,0)
 I '$D(^FHPT(FHDFN,"A",ADM,0)) S FHQ="-1^No current diet order2" Q
"RTN","FHWOR71",23,0)
 K N S P1=1 F K=0:0 S K=$O(^FHPT(FHDFN,"P",K)) Q:K<1  S X=^(K,0),M=$P(X,"^",2) I M'="" S:M="A" M="BNE" D SP
"RTN","FHWOR71",24,0)
 I $O(N(""))="" S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="No Food Preferences on file" S FHX=$$SPACNG(0,FHX) G A0
"RTN","FHWOR71",25,0)
 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Food Preferences Currently on file" S FHX=$$SPACNG(1,FHX)
"RTN","FHWOR71",26,0)
 K ST1 S $P(ST1," ",81)="",$E(ST1,27,32)="Likes",$E(ST1,59,67)="Dislikes" S ^TMP($J,"FHPROF",DFN,FHX)=ST1 S FHX=$$SPACNG(1,FHX)
"RTN","FHWOR71",27,0)
 S (M1,M2,MM)="",FHX=$$SPACNG(0,FHX) F  S M1=$O(N(M1)) Q:M1=""  I $D(N(M1)) S ^TMP($J,"FHPROF",DFN,FHX)=$P(M1,"~",2) D
"RTN","FHWOR71",28,0)
 .  S (P1,P2)=0 F  S:P1'="" P1=$O(N(M1,"L",P1)) S X1=$S(P1>0:N(M1,"L",P1),1:"") S:P2'="" P2=$O(N(M1,"D",P2)) S X2=$S(P2>0:N(M1,"D",P2),1:"") Q:P1=""&(P2="")  D W0 S:M2'=M1 FHX=$$SPACNG(0,FHX)
"RTN","FHWOR71",29,0)
 .  S M2=M1 Q
"RTN","FHWOR71",30,0)
 S FHX=$$SPACNG(0,FHX) K L,N,M,M1,M2,MM,P1,P2
"RTN","FHWOR71",31,0)
A0 S X(0)=^FHPT(FHDFN,"A",ADM,0),X=$P(X(0),"^",10) G:X="" F1
"RTN","FHWOR71",32,0)
 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Isolation/Precaution Type is "_$P($G(^FH(119.4,X,0)),"^",1)
"RTN","FHWOR71",33,0)
F1 D CUR^FHORD7 S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Current Diet: "_$S(Y'="":Y,1:"No current order")
"RTN","FHWOR71",34,0)
 I Y'="",FHORD>0 I $D(^FHPT(FHDFN,"A",ADM,"DI",FHORD,1)) S COM=^(1) D
"RTN","FHWOR71",35,0)
 . I COM'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Comment: "_COM
"RTN","FHWOR71",36,0)
 S TYP=$P(X,"^",8) I TYP'="" D
"RTN","FHWOR71",37,0)
 . S FHX=$$SPACNG(0,FHX)
"RTN","FHWOR71",38,0)
 . S ^TMP($J,"FHPROF",DFN,FHX)="Service: "_$S(TYP="T":"Tray",TYP="D":"Dining Room",1:"Cafeteria")
"RTN","FHWOR71",39,0)
 S DTP=$P(X(0),"^",3) I DTP D DTP^FH S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Expires: "_DTP
"RTN","FHWOR71",40,0)
 S TF=$P(X(0),"^",4) G:TF<1 F2
"RTN","FHWOR71",41,0)
 S Y=^FHPT(FHDFN,"A",ADM,"TF",TF,0)
"RTN","FHWOR71",42,0)
 S DTP=$P(Y,"^",1),COM=$P(Y,"^",5),TQU=$P(Y,"^",6),CAL=$P(Y,"^",7)
"RTN","FHWOR71",43,0)
 D DTP^FH S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Tubefeed Ordered: "_DTP
"RTN","FHWOR71",44,0)
 F TF2=0:0 S TF2=$O(^FHPT(FHDFN,"A",ADM,"TF",TF,"P",TF2)) Q:TF2<1  S XY=^(TF2,0) D LP
"RTN","FHWOR71",45,0)
 S FHX=$$SPACNG(0,FHX) K ST1 S ST1="Total Quantity: "_TQU_" ml",$E(ST1,43,(56+$L(CAL)))="Total KCAL: "_CAL S ^TMP($J,"FHPROF",DFN,FHX)=ST1
"RTN","FHWOR71",46,0)
 I COM'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Comment: "_COM
"RTN","FHWOR71",47,0)
F2 S NO=$P(X(0),"^",7),Y=$S('NO:"",1:^FHPT(FHDFN,"A",ADM,"SF",NO,0))
"RTN","FHWOR71",48,0)
 S L=$P(Y,"^",4) S FHX=$$SPACNG(1,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Supplemental Feeding: "_$S('L:"No Order",1:$P(^FH(118.1,L,0),"^",1)) G:'NO F3
"RTN","FHWOR71",49,0)
 S DTP=$P(Y,"^",30) D DTP^FH S ^TMP($J,"FHPROF",DFN,FHX)=^(FHX)_"    Reviewed: "_DTP
"RTN","FHWOR71",50,0)
 S L=4 F K1=1:1:3 S K=0,N(K1)="" F K2=1:1:4 S Z=$P(Y,U,L+1),Q=$P(Y,U,L+2),L=L+2 I Z'="" S:'Q Q=1 S:N(K1)'="" N(K1)=N(K1)_"; " S N(K1)=N(K1)_Q_" "_$P(^FH(118,Z,0),"^",1)
"RTN","FHWOR71",51,0)
 S FHX=$$SPACNG(0,FHX) F K1=1:1:3 I N(K1)'="" S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)=$P("     10am;      2pm;      8pm",";",K1)_":    "_N(K1)
"RTN","FHWOR71",52,0)
F3 G ^FHWOR72
"RTN","FHWOR71",53,0)
LP S TUN=$P(XY,"^",1),STR=$P(XY,"^",2),QUA=$P(XY,"^",3)
"RTN","FHWOR71",54,0)
 I QUA["CC" S QUAFI=$P(QUA,"CC",1),QUASE=$P(QUA,"CC",2),QUA=QUAFI_"ML"_QUASE
"RTN","FHWOR71",55,0)
 S FHX=$$SPACNG(0,FHX) S ^TMP($J,"FHPROF",DFN,FHX)="Product: "_$P($G(^FH(118.2,TUN,0)),"^",1)_", "_$S(STR=4:"Full",STR=1:"1/4",STR=2:"1/2",1:"3/4")_" Str., "_QUA Q
"RTN","FHWOR71",56,0)
SP S Z=$G(^FH(115.2,+X,0)),L1=$P(Z,"^",1),KK=$P(Z,"^",2),M1="",DAS=$P(X,"^",4)
"RTN","FHWOR71",57,0)
 I KK="L" S Q=$P(X,"^",3),L1=$S(Q:Q,1:1)_" "_L1
"RTN","FHWOR71",58,0)
 I M="BNE" S M1="1~All Meals" G SP1
"RTN","FHWOR71",59,0)
 S Z1=$E(M,1) I Z1'="" S M1=$S(Z1="B":"2~Break",Z1="N":"3~Noon",1:"4~Even")
"RTN","FHWOR71",60,0)
 S Z1=$E(M,2) I Z1'="" S M1=M1_","_$S(Z1="B":"Break",Z1="N":"Noon",1:"Even")
"RTN","FHWOR71",61,0)
SP1 S:'$D(N(M1,KK,P1)) N(M1,KK,P1)="" I $L(N(M1,KK,P1))+$L(L1)<255 S N(M1,KK,P1)=N(M1,KK,P1)_$S(N(M1,KK,P1)="":"",1:", ")_L1_$S(DAS="Y":" (D)",1:"")
"RTN","FHWOR71",62,0)
 E  S:'$D(N(M1,KK,K)) N(M1,KK,K)="" S N(M1,KK,K)=L1_$S(DAS="Y":" (D)",1:"") S P1=K
"RTN","FHWOR71",63,0)
 Q
"RTN","FHWOR71",64,0)
W0 I X1'="" K ST2 S $P(ST2," ",13)="" S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_$E(ST2,1,(11-$L(FHY))) S X=X1 D W1 S X1=X
"RTN","FHWOR71",65,0)
 I X2'="" K ST2 S $P(ST2," ",47)="" S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_$E(ST2,1,(46-$L(FHY))) S X=X2 D W1 S X2=X
"RTN","FHWOR71",66,0)
 Q:X1=""&(X2="")  S FHX=$$SPACNG(0,FHX) G W0
"RTN","FHWOR71",67,0)
W1 I $L(X)<34 S FHY=$G(^TMP($J,"FHPROF",DFN,FHX)) S ^TMP($J,"FHPROF",DFN,FHX)=FHY_" "_X S X="" Q
"RTN","FHWOR71",68,0)
 F KK=35:-1:1 Q:$E(X,KK-1,KK)=", "
"RTN","FHWOR71",69,0)
 S ^TMP($J,"FHPROF",DFN,FHX)=^(FHX)_" "_$E(X,1,KK-2) S X=$E(X,KK+1,999)
"RTN","FHWOR71",70,0)
 Q
"RTN","FHWOR71",71,0)
SPACNG(FHI,FHX) ;Multiple spacing before next line of text in ^TMP global
"RTN","FHWOR71",72,0)
 N I F I=1:1:FHI S FHX=FHX+1 S ^TMP($J,"FHPROF",DFN,FHX)=" "
"RTN","FHWOR71",73,0)
 S FHX=FHX+1
"RTN","FHWOR71",74,0)
 Q FHX
"RTN","FHWOR71",75,0)
TEST ; FOR TESTING ONLY - DFN must be defined
"RTN","FHWOR71",76,0)
 S I="" F  S I=$O(^TMP($J,"FHPROF",DFN,I)) Q:I=""  W !,^TMP($J,"FHPROF",DFN,I)
"RTN","FHWOR71",77,0)
 Q
"UP",115,115.1,-3)
115^A
"UP",115,115.1,-2)
115.01^TF
"UP",115,115.1,-1)
115.04^P
"UP",115,115.1,0)
115.1
"UP",115,115.1619,-2)
115^OP
"UP",115,115.1619,-1)
115.016^TF
"UP",115,115.1619,0)
115.1619
"VER")
8.0^22
"^DD",115,115.1,1,0)
STRENGTH^RS^1:1/4;2:1/2;3:3/4;4:FULL;^0;2^Q
"^DD",115,115.1,1,3)

"^DD",115,115.1,1,21,0)
^^3^3^3050422^
"^DD",115,115.1,1,21,1,0)
This field contains the quantity of the tubefeeding and may
"^DD",115,115.1,1,21,2,0)
be expressed in Kilocalories per day, ml's per hour, or
"^DD",115,115.1,1,21,3,0)
similar rates.
"^DD",115,115.1,1,"DT")
3050422
"^DD",115,115.1,3,0)
PRODUCT ML'S/DAY^NJ5,0^^0;4^K:+X'=X!(X>10000)!(X<0)!(X?.E1"."1N.N) X
"^DD",115,115.1,3,3)
Type a Number between 0 and 10000, 0 Decimal Digits
"^DD",115,115.1,3,21,0)
^^2^2^3050422^
"^DD",115,115.1,3,21,1,0)
This is the number of ml's of the TF product which are contained in
"^DD",115,115.1,3,21,2,0)
the order for a day (or less than a day if so indicated).
"^DD",115,115.1,3,"DT")
3050422
"^DD",115,115.1,4,0)
WATER ML'S/DAY^NJ5,0^^0;5^K:+X'=X!(X>10000)!(X<0)!(X?.E1"."1N.N) X
"^DD",115,115.1,4,3)
Type a Number between 0 and 10000, 0 Decimal Digits
"^DD",115,115.1,4,21,0)
^^2^2^3050422^
"^DD",115,115.1,4,21,1,0)
This is the number of ml's of water to be used to dilute the TF product
"^DD",115,115.1,4,21,2,0)
if indicated.
"^DD",115,115.1,4,"DT")
3050422
"^DD",115,115.1619,3,0)
PRODUCT ML'S/DAY^NJ4,0^^0;4^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1619,3,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1619,3,21,0)
^^2^2^3050422^
"^DD",115,115.1619,3,21,1,0)
This field stores the product ml's per day of this tubefeeding product
"^DD",115,115.1619,3,21,2,0)
for the recurring meal.
"^DD",115,115.1619,3,"DT")
3050422
"^DD",115,115.1619,4,0)
WATER ML'S/DAY^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",115,115.1619,4,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",115,115.1619,4,21,0)
^^2^2^3050422^
"^DD",115,115.1619,4,21,1,0)
This field stores the water ml's per day of this tubefeeding product
"^DD",115,115.1619,4,21,2,0)
for the recurring meal.
"^DD",115,115.1619,4,"DT")
3050422
"^DD",118.2,118.2,2,0)
AMT/UNIT^RFX^^0;3^S:X[" " X=+X_$P(X," ",2) S:"MG"[$E(X,$L(+X)+1) X=+X_$E(X,$L(+X)+1) S:X["M" X=+X_"ML" K:($L(+X)>10)!($L(X)<2)!(+X>9999)!(+X<10)!("MLG"'[$E(X,$L(X))) X
"^DD",118.2,118.2,2,3)
Enter amount in ML's or in Grams.  Amount cannot exceed 9999.  The following are examples of valid entries 22ML, 40GRAMS, 20 G, or 100 M.
"^DD",118.2,118.2,2,21,0)
^^3^3^3050422^
"^DD",118.2,118.2,2,21,1,0)
This is the number of ml's or grams of product contained in the
"^DD",118.2,118.2,2,21,2,0)
dispensing unit. For products which require reconstitution
"^DD",118.2,118.2,2,21,3,0)
with water, it is the number of ml's after reconstitution.
"^DD",118.2,118.2,2,"DT")
3050502
"^DD",118.2,118.2,3,0)
KCAL/ML^RNJ7,2^^0;4^K:+X'=X!(X>1000)!(X<.1)!(X?.E1"."3N.N) X
"^DD",118.2,118.2,3,3)
Type a Number between .1 and 1000, 2 Decimal Digits
"^DD",118.2,118.2,3,21,0)
^^2^2^3050422^
"^DD",118.2,118.2,3,21,1,0)
This field contains the number of KiloCalories per ml of
"^DD",118.2,118.2,3,21,2,0)
product.
"^DD",118.2,118.2,3,"DT")
3050422
"BLD",5617,6)
^SEQ #1
**END**
**END**
