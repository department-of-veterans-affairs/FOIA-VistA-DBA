Released XU*8*229 SEQ #228
Extracted from mail message
**KIDS**:XU*8.0*229^

**INSTALL NAME**
XU*8.0*229
"BLD",559,0)
XU*8.0*229^KERNEL^0^3021223^y
"BLD",559,1,0)
^^2^2^3021028^^^
"BLD",559,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"BLD",559,1,2,0)
XU*8*229 KIDS fixes
"BLD",559,4,0)
^9.64PA^9.8^1
"BLD",559,4,9.8,0)
9.8
"BLD",559,4,9.8,2,0)
^9.641^9.8^2
"BLD",559,4,9.8,2,9.8,0)
ROUTINE  (File-top level)
"BLD",559,4,9.8,2,9.8,1,0)
^9.6411^7.3^2
"BLD",559,4,9.8,2,9.8,1,7.3,0)
PATCH LIST AT CHECKSUM TIME
"BLD",559,4,9.8,2,9.8,1,7.4,0)
KIDS INSTALL DATE
"BLD",559,4,9.8,2,9.818,0)
PATCH  (sub-file)
"BLD",559,4,9.8,2,9.818,1,0)
^9.6411^^
"BLD",559,4,9.8,222)
y^y^p^^^^n^^n
"BLD",559,4,9.8,224)

"BLD",559,4,"APDD",9.8,9.8)

"BLD",559,4,"APDD",9.8,9.8,7.3)

"BLD",559,4,"APDD",9.8,9.8,7.4)

"BLD",559,4,"APDD",9.8,9.818)

"BLD",559,4,"B",9.8,9.8)

"BLD",559,"KRN",0)
^9.67PA^8989.52^19
"BLD",559,"KRN",.4,0)
.4
"BLD",559,"KRN",.4,"NM",0)
^9.68A^^
"BLD",559,"KRN",.401,0)
.401
"BLD",559,"KRN",.402,0)
.402
"BLD",559,"KRN",.403,0)
.403
"BLD",559,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",559,"KRN",.403,"NM",1,0)
XPD EDIT BUILD    FILE #9.6^9.6^0
"BLD",559,"KRN",.403,"NM","B","XPD EDIT BUILD    FILE #9.6",1)

"BLD",559,"KRN",.5,0)
.5
"BLD",559,"KRN",.84,0)
.84
"BLD",559,"KRN",3.6,0)
3.6
"BLD",559,"KRN",3.8,0)
3.8
"BLD",559,"KRN",9.2,0)
9.2
"BLD",559,"KRN",9.8,0)
9.8
"BLD",559,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",559,"KRN",9.8,"NM",1,0)
XPDE^^0^B42835238
"BLD",559,"KRN",9.8,"NM",2,0)
XPDI^^0^B40794003
"BLD",559,"KRN",9.8,"NM",3,0)
XPDIJ^^0^B20974693
"BLD",559,"KRN",9.8,"NM",4,0)
XPDUTL1^^0^B6284187
"BLD",559,"KRN",9.8,"NM",5,0)
XPDIA1^^0^B50062561
"BLD",559,"KRN",9.8,"NM",6,0)
XPDET^^0^B32568215
"BLD",559,"KRN",9.8,"NM",7,0)
XPDTA^^0^B26161584
"BLD",559,"KRN",9.8,"NM",8,0)
XPDIP^^0^B38004820
"BLD",559,"KRN",9.8,"NM",9,0)
XPDI1^^0^B17185961
"BLD",559,"KRN",9.8,"NM",10,0)
XPDDP^^0^B35865617
"BLD",559,"KRN",9.8,"NM",11,0)
XPDIL1^^0^B35935554
"BLD",559,"KRN",9.8,"NM","B","XPDDP",10)

"BLD",559,"KRN",9.8,"NM","B","XPDE",1)

"BLD",559,"KRN",9.8,"NM","B","XPDET",6)

"BLD",559,"KRN",9.8,"NM","B","XPDI",2)

"BLD",559,"KRN",9.8,"NM","B","XPDI1",9)

"BLD",559,"KRN",9.8,"NM","B","XPDIA1",5)

"BLD",559,"KRN",9.8,"NM","B","XPDIJ",3)

"BLD",559,"KRN",9.8,"NM","B","XPDIL1",11)

"BLD",559,"KRN",9.8,"NM","B","XPDIP",8)

"BLD",559,"KRN",9.8,"NM","B","XPDTA",7)

"BLD",559,"KRN",9.8,"NM","B","XPDUTL1",4)

"BLD",559,"KRN",19,0)
19
"BLD",559,"KRN",19.1,0)
19.1
"BLD",559,"KRN",101,0)
101
"BLD",559,"KRN",409.61,0)
409.61
"BLD",559,"KRN",771,0)
771
"BLD",559,"KRN",870,0)
870
"BLD",559,"KRN",8989.51,0)
8989.51
"BLD",559,"KRN",8989.52,0)
8989.52
"BLD",559,"KRN",8994,0)
8994
"BLD",559,"KRN","B",.4,.4)

"BLD",559,"KRN","B",.401,.401)

"BLD",559,"KRN","B",.402,.402)

"BLD",559,"KRN","B",.403,.403)

"BLD",559,"KRN","B",.5,.5)

"BLD",559,"KRN","B",.84,.84)

"BLD",559,"KRN","B",3.6,3.6)

"BLD",559,"KRN","B",3.8,3.8)

"BLD",559,"KRN","B",9.2,9.2)

"BLD",559,"KRN","B",9.8,9.8)

"BLD",559,"KRN","B",19,19)

"BLD",559,"KRN","B",19.1,19.1)

"BLD",559,"KRN","B",101,101)

"BLD",559,"KRN","B",409.61,409.61)

"BLD",559,"KRN","B",771,771)

"BLD",559,"KRN","B",870,870)

"BLD",559,"KRN","B",8989.51,8989.51)

"BLD",559,"KRN","B",8989.52,8989.52)

"BLD",559,"KRN","B",8994,8994)

"BLD",559,"QUES",0)
^9.62^^
"BLD",559,"REQB",0)
^9.611^5^4
"BLD",559,"REQB",1,0)
XU*8.0*124^2
"BLD",559,"REQB",3,0)
XU*8.0*201^2
"BLD",559,"REQB",4,0)
XU*8.0*184^2
"BLD",559,"REQB",5,0)
XU*8.0*137^2
"BLD",559,"REQB","B","XU*8.0*124",1)

"BLD",559,"REQB","B","XU*8.0*137",5)

"BLD",559,"REQB","B","XU*8.0*184",4)

"BLD",559,"REQB","B","XU*8.0*201",3)

"FIA",9.8)
ROUTINE
"FIA",9.8,0)
^DIC(9.8,
"FIA",9.8,0,0)
9.8
"FIA",9.8,0,1)
y^y^p^^^^n^^n
"FIA",9.8,0,10)

"FIA",9.8,0,11)

"FIA",9.8,0,"RLRO")

"FIA",9.8,0,"VR")
8.0^XU
"FIA",9.8,9.8)
1
"FIA",9.8,9.8,7.3)

"FIA",9.8,9.8,7.4)

"FIA",9.8,9.8,8)

"FIA",9.8,9.818)
0
"KRN",.403,1,-1)
0^1
"KRN",.403,1,0)
XPD EDIT BUILD^#^^^2931104^^^9.6^0^0^1
"KRN",.403,1,40,0)
^.4031I^15^14
"KRN",.403,1,40,1,0)
1^^1,1^4^14
"KRN",.403,1,40,1,1)
Page 1
"KRN",.403,1,40,1,40,0)
^.4032PI^2^2
"KRN",.403,1,40,1,40,1,0)
XPD EDIT BUILD HDR^1^1,1^d
"KRN",.403,1,40,1,40,2,0)
XPD EDIT BUILD1^2^1,1^e
"KRN",.403,1,40,2,0)
2^^1,1^14^4
"KRN",.403,1,40,2,1)
Page 2
"KRN",.403,1,40,2,12)

"KRN",.403,1,40,2,40,0)
^.4032PI^13^3
"KRN",.403,1,40,2,40,1,0)
XPD EDIT BUILD HDR^1^1,1^d
"KRN",.403,1,40,2,40,3,0)
XPD EDIT BUILD2^2^1,1^e
"KRN",.403,1,40,2,40,13,0)
XPD EDIT BUILD30^3^5,1^e
"KRN",.403,1,40,2,40,13,2)
12^^f^1
"KRN",.403,1,40,3,0)
3^^5,1^^^1^17,79
"KRN",.403,1,40,3,1)
Kernel File^1,3,2
"KRN",.403,1,40,3,40,0)
^.4032PI^9^2
"KRN",.403,1,40,3,40,4,0)
XPD EDIT BUILD3^1^3,2^e
"KRN",.403,1,40,3,40,4,2)
9^^n
"KRN",.403,1,40,3,40,9,0)
XPD EDIT BUILD31^2^1,2^d
"KRN",.403,1,40,4,0)
4^^1,1^2^1
"KRN",.403,1,40,4,1)
File^
"KRN",.403,1,40,4,40,0)
^.4032PI^15^3
"KRN",.403,1,40,4,40,1,0)
XPD EDIT BUILD HDR^1^1,1^d
"KRN",.403,1,40,4,40,14,0)
XPD EDIT BUILD40^2^5,1^e
"KRN",.403,1,40,4,40,14,2)
12^^n
"KRN",.403,1,40,4,40,15,0)
XPD EDIT BUILD41^3^1,1^d
"KRN",.403,1,40,5,0)
5^^6,3^^^1^17,77
"KRN",.403,1,40,5,1)
Record Merge^2,2,8
"KRN",.403,1,40,5,40,0)
^.4032PI^6^1
"KRN",.403,1,40,5,40,6,0)
XPD EDIT BUILD5^1^1,3^e
"KRN",.403,1,40,7,0)
7^^5,1^^^1^17,78
"KRN",.403,1,40,7,1)
Entries^
"KRN",.403,1,40,7,40,0)
^.4032PI^5^1
"KRN",.403,1,40,7,40,5,0)
XPD EDIT BUILD4^2^1,1^e
"KRN",.403,1,40,8,0)
8^^5,2^^^1^15,78
"KRN",.403,1,40,8,1)
Package file
"KRN",.403,1,40,8,11)

"KRN",.403,1,40,8,40,0)
^.4032PI^23^3
"KRN",.403,1,40,8,40,7,0)
XPD EDIT BUILD6^2^3,2^e
"KRN",.403,1,40,8,40,7,1)
1
"KRN",.403,1,40,8,40,10,0)
XPD EDIT BUILD8^3^8,2^e
"KRN",.403,1,40,8,40,23,0)
XPD EDIT BUILD60^4^1,2^d
"KRN",.403,1,40,9,0)
9^^4,3^^^1^16,77
"KRN",.403,1,40,9,1)
Page 9
"KRN",.403,1,40,9,12)

"KRN",.403,1,40,9,40,0)
^.4032PI^24^2
"KRN",.403,1,40,9,40,11,0)
XPD EDIT BUILD9^1^1,2^e
"KRN",.403,1,40,9,40,24,0)
XPD EDIT BUILD9A^2^8,2^e
"KRN",.403,1,40,9,40,24,2)
4
"KRN",.403,1,40,10,0)
10^^5,4^^^1^9,76
"KRN",.403,1,40,10,1)
A/B namespace^
"KRN",.403,1,40,10,11)

"KRN",.403,1,40,10,12)

"KRN",.403,1,40,10,40,0)
^.4032PI^25^2
"KRN",.403,1,40,10,40,12,0)
XPD EDIT BUILD10^1^1,3^e
"KRN",.403,1,40,10,40,25,0)
XPD EDIT BUILD10A^2^2,2^e
"KRN",.403,1,40,10,40,25,2)
2
"KRN",.403,1,40,11,0)
11^^6,2^^^1^16,77
"KRN",.403,1,40,11,1)
Sub DD
"KRN",.403,1,40,11,40,0)
^.4032PI^18^2
"KRN",.403,1,40,11,40,16,0)
XPD EDIT BUILD42^1^2,3^e
"KRN",.403,1,40,11,40,16,2)
6^!IEN^n^^
"KRN",.403,1,40,11,40,18,0)
XPD EDIT BUILD44^2^1,3^d
"KRN",.403,1,40,12,0)
12^^7,3^^^1^15,76
"KRN",.403,1,40,12,1)
Sub Field
"KRN",.403,1,40,12,40,0)
^.4032PI^19^2
"KRN",.403,1,40,12,40,17,0)
XPD EDIT BUILD43^1^2,3^e
"KRN",.403,1,40,12,40,17,2)
6^!IEN^n
"KRN",.403,1,40,12,40,19,0)
XPD EDIT BUILD45^2^1,2^d
"KRN",.403,1,40,13,0)
13^^6,2^^^1^16,77
"KRN",.403,1,40,13,1)
Page 13
"KRN",.403,1,40,13,40,0)
^.4032PI^20^1
"KRN",.403,1,40,13,40,20,0)
XPD EDIT BUILD46^1^1,1^e
"KRN",.403,1,40,14,0)
14^^1,1^1^2
"KRN",.403,1,40,14,1)
Page 14
"KRN",.403,1,40,14,40,0)
^.4032PI^65^4
"KRN",.403,1,40,14,40,1,0)
XPD EDIT BUILD HDR^1^1,1^d
"KRN",.403,1,40,14,40,21,0)
XPD EDIT BUILD11^4^1,1^e
"KRN",.403,1,40,14,40,22,0)
XPD EDIT BUILD12^2^5,1^e
"KRN",.403,1,40,14,40,22,2)
4^^n
"KRN",.403,1,40,14,40,65,0)
XPD EDIT BUILD52^5^10,1^e
"KRN",.403,1,40,14,40,65,2)
4
"KRN",.403,1,40,15,0)
15^^2,1^^^1^17,79
"KRN",.403,1,40,15,1)
Install questions
"KRN",.403,1,40,15,40,0)
^.4032PI^8^1
"KRN",.403,1,40,15,40,8,0)
XPD EDIT BUILD7^1^1,1^e
"KRN",.404,1,0)
XPD EDIT BUILD HDR^9.6
"KRN",.404,1,40,0)
^.4044I^5^5
"KRN",.404,1,40,1,0)
1^Edit a Build^1^
"KRN",.404,1,40,1,2)
^^1,28^
"KRN",.404,1,40,2,0)
2^Name^3^
"KRN",.404,1,40,2,1)
.01
"KRN",.404,1,40,2,2)
2,7^30^2,1
"KRN",.404,1,40,2,4)
^^^1
"KRN",.404,1,40,3,0)
3^PAGE   OF 4^1^
"KRN",.404,1,40,3,2)
^^1,66^
"KRN",.404,1,40,4,0)
4^!M^1^
"KRN",.404,1,40,4,.1)
S $P(Y,"-",80)=""
"KRN",.404,1,40,4,2)
^^3,1^
"KRN",.404,1,40,5,0)
5^TYPE^3
"KRN",.404,1,40,5,1)
2
"KRN",.404,1,40,5,2)
2,51^14^2,45
"KRN",.404,1,40,5,4)
^^^1
"KRN",.404,2,0)
XPD EDIT BUILD1^9.6
"KRN",.404,2,12)

"KRN",.404,2,40,0)
^.4044I^19^13
"KRN",.404,2,40,1,0)
2^Name^3^
"KRN",.404,2,40,1,1)
.01
"KRN",.404,2,40,1,2)
5,29^50^5,23
"KRN",.404,2,40,5,0)
5^Environment Check Routine^3^
"KRN",.404,2,40,5,1)
913
"KRN",.404,2,40,5,2)
11,29^8^11,2
"KRN",.404,2,40,6,0)
7^Post-Install Routine^3^
"KRN",.404,2,40,6,1)
914
"KRN",.404,2,40,6,2)
15,29^17^15,7
"KRN",.404,2,40,7,0)
6^Pre-Install Routine^3^
"KRN",.404,2,40,7,1)
916
"KRN",.404,2,40,7,2)
13,29^17^13,8
"KRN",.404,2,40,11,0)
4^Description^3^
"KRN",.404,2,40,11,1)
3
"KRN",.404,2,40,11,2)
9,29^1^9,16
"KRN",.404,2,40,12,0)
1^1^1^
"KRN",.404,2,40,12,2)
^^1,71^
"KRN",.404,2,40,13,0)
3^Date Distributed^3
"KRN",.404,2,40,13,1)
.02
"KRN",.404,2,40,13,2)
7,29^11^7,11
"KRN",.404,2,40,14,0)
8^Pre-Transportation Routine^3
"KRN",.404,2,40,14,1)
900
"KRN",.404,2,40,14,2)
17,29^17^17,1
"KRN",.404,2,40,15,0)
11^Delete Routine^1
"KRN",.404,2,40,15,2)
^^9,57
"KRN",.404,2,40,16,0)
12^after install^1
"KRN",.404,2,40,16,2)
^^10,58
"KRN",.404,2,40,17,0)
13^Y/N^3
"KRN",.404,2,40,17,1)
913.1
"KRN",.404,2,40,17,2)
11,64^1^11,59
"KRN",.404,2,40,17,11)
N % S %(1)="Be VERY careful setting this to yes" D HLP^DDSUTL(.%)
"KRN",.404,2,40,18,0)
14^Y/N^3
"KRN",.404,2,40,18,1)
916.1
"KRN",.404,2,40,18,2)
13,64^1^13,59
"KRN",.404,2,40,18,11)
N % S %(1)="Be VERY careful setting this to yes" D HLP^DDSUTL(.%)
"KRN",.404,2,40,19,0)
15^Y/N^3
"KRN",.404,2,40,19,1)
914.1
"KRN",.404,2,40,19,2)
15,64^1^15,59
"KRN",.404,2,40,19,11)
N % S %(1)="Be VERY careful setting this to yes" D HLP^DDSUTL(.%)
"KRN",.404,3,0)
XPD EDIT BUILD2^9.6
"KRN",.404,3,12)

"KRN",.404,3,40,0)
^.4044I^2^2
"KRN",.404,3,40,1,0)
99^3^1^
"KRN",.404,3,40,1,2)
^^1,71^
"KRN",.404,3,40,2,0)
2^Build Components^1^
"KRN",.404,3,40,2,2)
^^4,28^1
"KRN",.404,4,0)
XPD EDIT BUILD3^9.68
"KRN",.404,4,40,0)
^.4044I^2^2
"KRN",.404,4,40,1,0)
1^^3^
"KRN",.404,4,40,1,1)
.01
"KRN",.404,4,40,1,2)
1,2^45
"KRN",.404,4,40,2,0)
2^^3
"KRN",.404,4,40,2,1)
.03
"KRN",.404,4,40,2,2)
1,50^26
"KRN",.404,4,40,2,3)
SEND TO SITE
"KRN",.404,4,40,2,4)
1
"KRN",.404,5,0)
XPD EDIT BUILD4^9.64
"KRN",.404,5,40,0)
^.4044I^18^7
"KRN",.404,5,40,1,0)
1^ DD Export Options ^1^
"KRN",.404,5,40,1,2)
^^1,27^1
"KRN",.404,5,40,2,0)
2^File^3^
"KRN",.404,5,40,2,1)
.01
"KRN",.404,5,40,2,2)
3,30^45^3,24
"KRN",.404,5,40,7,0)
7^Data Comes With File...^3^
"KRN",.404,5,40,7,1)
222.7
"KRN",.404,5,40,7,2)
12,33^3^12,8
"KRN",.404,5,40,7,3)
NO
"KRN",.404,5,40,7,10)
S:X="y" DDSSTACK=13
"KRN",.404,5,40,7,13)
D:X="y" PUT^DDSVAL(DIE,.DA,222.3,"f","","I")
"KRN",.404,5,40,13,0)
6^Screen to Determine DD Update^3
"KRN",.404,5,40,13,1)
223
"KRN",.404,5,40,13,2)
10,2^76^9,2^1
"KRN",.404,5,40,14,0)
5^Send Security Code^3
"KRN",.404,5,40,14,1)
222.2
"KRN",.404,5,40,14,2)
7,62^3^7,42
"KRN",.404,5,40,14,3)
YES
"KRN",.404,5,40,16,0)
4^Update the Data Dictionary^3
"KRN",.404,5,40,16,1)
222.1
"KRN",.404,5,40,16,2)
7,30^3^7,2
"KRN",.404,5,40,16,3)
YES
"KRN",.404,5,40,18,0)
3^Send Full or Partial DD...^3
"KRN",.404,5,40,18,1)
222.3
"KRN",.404,5,40,18,2)
5,33^7^5,5
"KRN",.404,5,40,18,3)
FULL
"KRN",.404,5,40,18,10)
S:X="p" DDSSTACK=11
"KRN",.404,5,40,18,13)
D:X="p" PAR964^XPDET
"KRN",.404,6,0)
XPD EDIT BUILD5^9.402
"KRN",.404,6,40,0)
^.4044I^4^4
"KRN",.404,6,40,1,0)
1^ Affects Record Merge ^1^
"KRN",.404,6,40,1,2)
^^1,23^1
"KRN",.404,6,40,2,0)
2^File Affected^3^
"KRN",.404,6,40,2,1)
.01
"KRN",.404,6,40,2,2)
3,16^45^3,1
"KRN",.404,6,40,3,0)
3^Name of Merge Routine^3^
"KRN",.404,6,40,3,1)
3
"KRN",.404,6,40,3,2)
5,24^8^5,1
"KRN",.404,6,40,4,0)
4^Record has Package Data^3^
"KRN",.404,6,40,4,1)
4
"KRN",.404,6,40,4,2)
10,1^70^8,21^1
"KRN",.404,7,0)
XPD EDIT BUILD6^9.4
"KRN",.404,7,11)
I $G(XPDBR) S DDSBR="COM" K XPDBR
"KRN",.404,7,40,0)
^.4044I^5^2
"KRN",.404,7,40,2,0)
2^Select Affects Record Merge^3^
"KRN",.404,7,40,2,1)
20
"KRN",.404,7,40,2,2)
5,31^30^5,2
"KRN",.404,7,40,5,0)
1^Primary Help Frame^3
"KRN",.404,7,40,5,1)
12
"KRN",.404,7,40,5,2)
3,31^30^3,11
"KRN",.404,8,0)
XPD EDIT BUILD7^9.62
"KRN",.404,8,40,0)
^.4044I^10^10
"KRN",.404,8,40,1,0)
2^Name^3^
"KRN",.404,8,40,1,1)
.01
"KRN",.404,8,40,1,2)
2,12^30^2,6
"KRN",.404,8,40,2,0)
3^DIR(0)^3^
"KRN",.404,8,40,2,1)
1
"KRN",.404,8,40,2,2)
4,12^65^4,4
"KRN",.404,8,40,3,0)
4^DIR(A)^3^
"KRN",.404,8,40,3,1)
2
"KRN",.404,8,40,3,2)
6,12^65^6,4
"KRN",.404,8,40,4,0)
5^DIR(A,#)^3^
"KRN",.404,8,40,4,1)
3
"KRN",.404,8,40,4,2)
7,12^1^7,2
"KRN",.404,8,40,5,0)
6^DIR(B)^3^
"KRN",.404,8,40,5,1)
4
"KRN",.404,8,40,5,2)
9,12^65^9,4
"KRN",.404,8,40,6,0)
7^DIR(?)^3^
"KRN",.404,8,40,6,1)
5
"KRN",.404,8,40,6,2)
11,12^65^11,4
"KRN",.404,8,40,7,0)
8^DIR(?,#)^3^
"KRN",.404,8,40,7,1)
6
"KRN",.404,8,40,7,2)
12,12^1^12,2
"KRN",.404,8,40,8,0)
9^DIR(??)^3^
"KRN",.404,8,40,8,1)
7
"KRN",.404,8,40,8,2)
13,12^64^13,3
"KRN",.404,8,40,9,0)
10^M Code^3
"KRN",.404,8,40,9,1)
10
"KRN",.404,8,40,9,2)
15,12^65^15,4
"KRN",.404,8,40,10,0)
1^ Install Questions ^1^
"KRN",.404,8,40,10,2)
^^1,27^1
"KRN",.404,9,0)
XPD EDIT BUILD31^9.67
"KRN",.404,9,40,0)
^.4044I^1^1
"KRN",.404,9,40,1,0)
1^!M^1^
"KRN",.404,9,40,1,.1)
S Y=" "_$P($G(^DIC(D1,0)),U)_" "
"KRN",.404,9,40,1,2)
^^1,27^
"KRN",.404,10,0)
XPD EDIT BUILD8^9.6
"KRN",.404,10,11)

"KRN",.404,10,40,0)
^.4044I^1^1
"KRN",.404,10,40,1,0)
1^Alpha/Beta Testing...^3
"KRN",.404,10,40,1,1)
20
"KRN",.404,10,40,1,2)
2,31^3^2,8
"KRN",.404,10,40,1,3)
NO
"KRN",.404,10,40,1,10)
S:X="y" DDSSTACK="9"
"KRN",.404,11,0)
XPD EDIT BUILD9^9.6
"KRN",.404,11,40,0)
^.4044I^5^4
"KRN",.404,11,40,1,0)
2^Installation Message^3
"KRN",.404,11,40,1,1)
21
"KRN",.404,11,40,1,2)
3,30^3^3,8
"KRN",.404,11,40,1,3)
NO
"KRN",.404,11,40,2,0)
3^Address for Usage Reporting^3
"KRN",.404,11,40,2,1)
22
"KRN",.404,11,40,2,2)
5,30^44^5,1
"KRN",.404,11,40,4,0)
1^ Alpha/Beta Testing ^1^
"KRN",.404,11,40,4,2)
^^1,26^1
"KRN",.404,11,40,5,0)
4^Package Namespace or Prefix:^1
"KRN",.404,11,40,5,2)
^^7,1
"KRN",.404,12,0)
XPD EDIT BUILD10^9.66
"KRN",.404,12,40,0)
^.4044I^1^1
"KRN",.404,12,40,1,0)
1^ Exclude Namespace or Prefix ^1
"KRN",.404,12,40,1,2)
^^1,20^1
"KRN",.404,13,0)
XPD EDIT BUILD30^9.67
"KRN",.404,13,40,0)
^.4044I^2^2
"KRN",.404,13,40,1,0)
1^^3
"KRN",.404,13,40,1,1)
.01
"KRN",.404,13,40,1,2)
2,1^24
"KRN",.404,13,40,1,4)
^^^2
"KRN",.404,13,40,1,10)
S DDSSTACK=3
"KRN",.404,13,40,2,0)
2^^4
"KRN",.404,13,40,2,2)
2,27^5
"KRN",.404,13,40,2,4)
^^1
"KRN",.404,13,40,2,30)
S Y="("_+$P($G(^XPD(9.6,DA(1),"KRN",DA,"NM",0)),U,4)_")"
"KRN",.404,14,0)
XPD EDIT BUILD40^9.64
"KRN",.404,14,40,0)
^.4044I^1^1
"KRN",.404,14,40,1,0)
1^^3
"KRN",.404,14,40,1,1)
.01
"KRN",.404,14,40,1,2)
2,7^45
"KRN",.404,14,40,1,10)
S DDSSTACK=7
"KRN",.404,15,0)
XPD EDIT BUILD41^9.6
"KRN",.404,15,40,0)
^.4044I^3^2
"KRN",.404,15,40,1,0)
1^2^1^
"KRN",.404,15,40,1,2)
^^1,71^
"KRN",.404,15,40,3,0)
2^File List  (Name or Number)^1
"KRN",.404,15,40,3,2)
^^4,28^1
"KRN",.404,16,0)
XPD EDIT BUILD42^9.641
"KRN",.404,16,40,0)
^.4044I^1^1
"KRN",.404,16,40,1,0)
1^^3
"KRN",.404,16,40,1,1)
.01
"KRN",.404,16,40,1,2)
1,1^45
"KRN",.404,16,40,1,10)
S DDSSTACK=12
"KRN",.404,17,0)
XPD EDIT BUILD43^9.6411
"KRN",.404,17,40,0)
^.4044I^1^1
"KRN",.404,17,40,1,0)
1^^3
"KRN",.404,17,40,1,1)
.01
"KRN",.404,17,40,1,2)
1,1^45
"KRN",.404,18,0)
XPD EDIT BUILD44^9.64
"KRN",.404,18,40,0)
^.4044I^1^1
"KRN",.404,18,40,1,0)
1^ Data Dictionary Number ^1^
"KRN",.404,18,40,1,2)
^^1,24^1
"KRN",.404,19,0)
XPD EDIT BUILD45^9.641
"KRN",.404,19,40,0)
^.4044I^1^1
"KRN",.404,19,40,1,0)
1^ Field Number ^1^
"KRN",.404,19,40,1,2)
^^1,24^1
"KRN",.404,20,0)
XPD EDIT BUILD46^9.64
"KRN",.404,20,40,0)
^.4044I^7^6
"KRN",.404,20,40,1,0)
1^ Data Export Options ^1^
"KRN",.404,20,40,1,2)
^^1,29^1
"KRN",.404,20,40,2,0)
2^Site's Data^3
"KRN",.404,20,40,2,1)
222.8
"KRN",.404,20,40,2,2)
3,21^15^3,8
"KRN",.404,20,40,2,3)
OVERWRITE
"KRN",.404,20,40,3,0)
5^Data List^3
"KRN",.404,20,40,3,1)
222.6
"KRN",.404,20,40,3,2)
7,21^30^7,10
"KRN",.404,20,40,4,0)
3^Resolve Pointers^3
"KRN",.404,20,40,4,1)
222.5
"KRN",.404,20,40,4,2)
5,21^3^5,3
"KRN",.404,20,40,4,3)
NO
"KRN",.404,20,40,5,0)
4^May User Override Data Update^3
"KRN",.404,20,40,5,1)
222.9
"KRN",.404,20,40,5,2)
5,68^3^5,37
"KRN",.404,20,40,5,3)
NO
"KRN",.404,20,40,7,0)
6^Screen to Select Data^3
"KRN",.404,20,40,7,1)
224
"KRN",.404,20,40,7,2)
10,3^72^9,3^1
"KRN",.404,21,0)
XPD EDIT BUILD11^9.6
"KRN",.404,21,40,0)
^.4044I^5^5
"KRN",.404,21,40,1,0)
1^4^1^
"KRN",.404,21,40,1,2)
^^1,71^
"KRN",.404,21,40,2,0)
3^Package File Link...^3
"KRN",.404,21,40,2,1)
1
"KRN",.404,21,40,2,2)
15,27^30^15,5
"KRN",.404,21,40,2,10)
S:X]"" DDSSTACK=8
"KRN",.404,21,40,3,0)
4^Track Package Nationally^3
"KRN",.404,21,40,3,1)
5
"KRN",.404,21,40,3,2)
17,27^3^17,1
"KRN",.404,21,40,3,3)
NO
"KRN",.404,21,40,3,10)

"KRN",.404,21,40,3,11)
S:$$GET^DDSVAL(DIE,.DA,1)="" DDSBR="^^COM"
"KRN",.404,21,40,4,0)
2^Install Questions^1^
"KRN",.404,21,40,4,2)
^^4,28^1
"KRN",.404,21,40,5,0)
5^Required Builds^1
"KRN",.404,21,40,5,2)
^^9,28
"KRN",.404,22,0)
XPD EDIT BUILD12^9.62
"KRN",.404,22,40,0)
^.4044I^1^1
"KRN",.404,22,40,1,0)
1^^3
"KRN",.404,22,40,1,1)
.01
"KRN",.404,22,40,1,2)
1,3^30
"KRN",.404,22,40,1,10)
S DDSSTACK=15
"KRN",.404,23,0)
XPD EDIT BUILD60^9.6
"KRN",.404,23,40,0)
^.4044I^3^3
"KRN",.404,23,40,1,0)
1^ Edit PACKAGE File ^1^
"KRN",.404,23,40,1,2)
^^1,26^1
"KRN",.404,23,40,2,0)
2^Name^3
"KRN",.404,23,40,2,1)
.01
"KRN",.404,23,40,2,2)
2,8^30^2,2
"KRN",.404,23,40,3,0)
3^!M^1^
"KRN",.404,23,40,3,.1)
S $P(Y,"-",76)=""
"KRN",.404,23,40,3,2)
^^3,1^
"KRN",.404,24,0)
XPD EDIT BUILD9A^9.66
"KRN",.404,24,40,0)
^.4044I^1^1
"KRN",.404,24,40,1,0)
1^^3
"KRN",.404,24,40,1,1)
.01
"KRN",.404,24,40,1,2)
2,2^4
"KRN",.404,24,40,1,10)
S DDSSTACK=10
"KRN",.404,25,0)
XPD EDIT BUILD10A^9.661
"KRN",.404,25,40,0)
^.4044I^1^1
"KRN",.404,25,40,1,0)
1^^3
"KRN",.404,25,40,1,1)
.01
"KRN",.404,25,40,1,2)
1,2^4
"KRN",.404,65,0)
XPD EDIT BUILD52^9.611
"KRN",.404,65,40,0)
^.4044I^2^2
"KRN",.404,65,40,1,0)
1^^3
"KRN",.404,65,40,1,1)
.01
"KRN",.404,65,40,1,2)
1,3^40
"KRN",.404,65,40,2,0)
2^^3
"KRN",.404,65,40,2,1)
1
"KRN",.404,65,40,2,2)
1,49^30
"KRN",.404,65,40,2,4)
1
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
229^3021223^2
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3021223
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*229 KIDS fixes
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","XPDDP")
0^10^B35865617
"RTN","XPDDP",1,0)
XPDDP ;SFISC/RSD - Display a package ;11/12/02  10:22
"RTN","XPDDP",2,0)
 ;;8.0;KERNEL;**21,28,44,68,100,108,229**;Jul 10, 1995
"RTN","XPDDP",3,0)
EN1 ;print from Build file
"RTN","XPDDP",4,0)
 N DIC,D0,XPD,XPDT,XPDST,Y,Z
"RTN","XPDDP",5,0)
 S XPDST=$$LOOK^XPDB1
"RTN","XPDDP",6,0)
 ;S D0=+Y,XPD("D0")="",Y="PNT^XPDDP(""XPD(9.6,D0)"")",Z="Build File Print"
"RTN","XPDDP",7,0)
 S XPD("XPDT(")="",Y="LST1^XPDDP",Z="Build File Print"
"RTN","XPDDP",8,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",9,0)
 Q
"RTN","XPDDP",10,0)
EN2 ;print from Distribution
"RTN","XPDDP",11,0)
 N D0,DIC,POP,XPD,XPDA,XPDNM,XPDT,XPDST,Y,Z,%ZIS
"RTN","XPDDP",12,0)
 S XPDST=$$LOOK^XPDI1("I $D(^XTMP(""XPDI"",Y))",1)
"RTN","XPDDP",13,0)
 S XPD("XPDT(")="",Y="LST2^XPDDP",Z="Transport Global Print",D0=$O(^XTMP("XPDI",XPDST,"BLD",0))
"RTN","XPDDP",14,0)
 Q:'D0
"RTN","XPDDP",15,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDDP",16,0)
 Q
"RTN","XPDDP",17,0)
 ;
"RTN","XPDDP",18,0)
LST1 ;
"RTN","XPDDP",19,0)
 K DIRUT N XPDIT S XPDIT=0
"RTN","XPDDP",20,0)
 F  S XPDIT=$O(XPDT(XPDIT)) Q:$D(DIRUT)!(XPDIT'>0)  D
"RTN","XPDDP",21,0)
 . S D0=+XPDT(XPDIT) D PNT("XPD(9.6,D0)")
"RTN","XPDDP",22,0)
 Q
"RTN","XPDDP",23,0)
 ;
"RTN","XPDDP",24,0)
LST2 ;Print from XPDT array
"RTN","XPDDP",25,0)
 K DIRUT N XPDIT S XPDIT=0
"RTN","XPDDP",26,0)
 F  S XPDIT=$O(XPDT(XPDIT)) Q:$D(DIRUT)!(XPDIT'>0)  D
"RTN","XPDDP",27,0)
 . S XPDA=+XPDT(XPDIT),D0=$O(^XTMP("XPDI",XPDA,"BLD",0)) D PNT("XTMP(""XPDI"",XPDA,""BLD"",D0)")
"RTN","XPDDP",28,0)
 Q
"RTN","XPDDP",29,0)
 ;
"RTN","XPDDP",30,0)
PNT(XPDGR) ;print a package, XPDGR=global root
"RTN","XPDDP",31,0)
 ;XPDFL=0 - Build - ^XPD(9.7 global root, 1 - Install - ^XTMP global root
"RTN","XPDDP",32,0)
 ;2 - Packman ^TMP($J, global root
"RTN","XPDDP",33,0)
 N I,J,K,X,XPD,XPDDT,XPDI,XPD0,XPDFL,XPDPG,XPDUL,XPDTYPE,XPDTRACK
"RTN","XPDDP",34,0)
 Q:$G(XPDGR)=""  S XPDGR="^"_XPDGR
"RTN","XPDDP",35,0)
 Q:'$D(@XPDGR@(0))
"RTN","XPDDP",36,0)
 S XPD0=^(0),XPDPG=1,XPDFL=$S($E(XPDGR,1,5)="^TMP(":2,1:$E(XPDGR,1,5)="^XTMP"),$P(XPDUL,"-",IOM)="",XPDDT=$$HTE^XLFDT($H,"1PM"),XPDTYPE=+$P(XPD0,U,3),XPDTRACK=$P(XPD0,U,5)
"RTN","XPDDP",37,0)
 W:$E(IOST,1,2)="C-" @IOF D HDR W XPDUL,!
"RTN","XPDDP",38,0)
 W "TYPE: ",$$EXTERNAL^DILFD(9.6,2,"",XPDTYPE)
"RTN","XPDDP",39,0)
 W !,"TRACK NATIONALLY: ",$$EXTERNAL^DILFD(9.6,5,"",XPDTRACK)
"RTN","XPDDP",40,0)
 W !,"NATIONAL PACKAGE: ",$P($G(^DIC(9.4,+$P(XPD0,U,2),0),$P(XPD0,U,2)),U)
"RTN","XPDDP",41,0)
 W !,"DESCRIPTION:",!
"RTN","XPDDP",42,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@(1,XPDI)) Q:'XPDI  I $D(^(XPDI,0)) W ^(0),! Q:$$CHK(4)
"RTN","XPDDP",43,0)
 Q:$D(DIRUT)  G:XPDTYPE=1 MULT
"RTN","XPDDP",44,0)
 W !,"ENVIRONMENT CHECK : ",$G(@XPDGR@("PRE"))
"RTN","XPDDP",45,0)
 W ?47,"DELETE ENV ROUTINE: ",$S($P($G(@XPDGR@("INID")),U)="y":"Yes",1:"No")
"RTN","XPDDP",46,0)
 W !
"RTN","XPDDP",47,0)
 I 'XPDTYPE D
"RTN","XPDDP",48,0)
 . W " PRE-INIT ROUTINE : ",$G(@XPDGR@("INI"))
"RTN","XPDDP",49,0)
 . W ?42,"DELETE PRE-INIT ROUTINE: ",$S($P($G(@XPDGR@("INID")),U,3)="y":"Yes",1:"No")
"RTN","XPDDP",50,0)
 . W !
"RTN","XPDDP",51,0)
 Q:$$CHK(4)  W "POST-INIT ROUTINE : ",$G(@XPDGR@("INIT"))
"RTN","XPDDP",52,0)
 W ?41,"DELETE POST-INIT ROUTINE: ",$S($P($G(@XPDGR@("INID")),U,2)="y":"Yes",1:"No")
"RTN","XPDDP",53,0)
 W !
"RTN","XPDDP",54,0)
 W:'XPDTYPE "PRE-TRANSPORT RTN : ",$G(@XPDGR@("PRET")),!
"RTN","XPDDP",55,0)
 G:XPDTYPE=2 GLOBAL
"RTN","XPDDP",56,0)
 I '$O(@XPDGR@(4,0)) Q:$$CHK(4)  G COMP
"RTN","XPDDP",57,0)
 S I=$$CHK(10,1) Q:I  I '$P(I,"^",2) W !! D HDR1 W XPDUL,!
"RTN","XPDDP",58,0)
PNT2 S XPDI=0 F  S XPDI=$O(@XPDGR@(4,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,222)) Q:$$CHK(4,1)  D
"RTN","XPDDP",59,0)
 .;file number, file name, partial DD
"RTN","XPDDP",60,0)
 .W !,XPDI,?12,$S('XPDFL:$P($G(^DIC(XPDI,0),"**unknown**"),U),1:$G(^XTMP("XPDI",XPDA,"FIA",XPDI)))
"RTN","XPDDP",61,0)
 .W ?41,$$EXTERNAL^DILFD(9.64,222.1,"",$P(XPD,U)),?47,$$EXTERNAL^DILFD(9.64,222.2,"",$P(XPD,U,2)),?53,$$EXTERNAL^DILFD(9.64,222.7,"",$P(XPD,U,7))
"RTN","XPDDP",62,0)
 .W ?60,$E($$EXTERNAL^DILFD(9.64,222.8,"",$P(XPD,U,8)),1,4),?67,$$EXTERNAL^DILFD(9.64,222.5,"",$P(XPD,U,5)),?73,$$EXTERNAL^DILFD(9.64,222.9,"",$P(XPD,U,9)),!
"RTN","XPDDP",63,0)
 .;print partial DD information
"RTN","XPDDP",64,0)
 .I $P(XPD,U,3)="p" S J=0 D
"RTN","XPDDP",65,0)
 ..W "Partial DD:"
"RTN","XPDDP",66,0)
 ..F  S J=$O(@XPDGR@(4,"APDD",XPDI,J)) Q:'J  W ?12,"subDD: ",J D  Q:$$CHK(4,1)
"RTN","XPDDP",67,0)
 ...I '$O(@XPDGR@(4,"APDD",XPDI,J,0)) W ! Q
"RTN","XPDDP",68,0)
 ...S I=0 F  S I=$O(@XPDGR@(4,"APDD",XPDI,J,I)) Q:'I  W ?30,"fld: ",I,!
"RTN","XPDDP",69,0)
 .I $D(@XPDGR@(4,XPDI,223)) W ?2,"DD SCREEN  : ",^(223),!
"RTN","XPDDP",70,0)
 .I $D(@XPDGR@(4,XPDI,224)) W ?2,"DATA SCREEN: ",^(224),!
"RTN","XPDDP",71,0)
COMP Q:$D(DIRUT)  W ! Q:$$CHK(3)  S I=0,XPD=$P(^DD(9.68,.03,0),U,3)
"RTN","XPDDP",72,0)
 ;print build components
"RTN","XPDDP",73,0)
 F  S I=$O(@XPDGR@("KRN",I)),K=0,J="" Q:$D(DIRUT)!'I  F  S J=$O(@XPDGR@("KRN",I,"NM","B",J)) Q:J=""  S X=$O(^(J,0)) Q:$$CHK(4)  D:X
"RTN","XPDDP",74,0)
 .S X=$G(@XPDGR@("KRN",I,"NM",X,0)) Q:X=""
"RTN","XPDDP",75,0)
 .;K is flag to write type of component
"RTN","XPDDP",76,0)
 .I 'K W !,$S($D(^DIC(I,0)):$P(^(0),U),XPDFL:$G(^XTMP("XPDI",XPDA,"FIA",I),"UNKNOWN"),1:"UNKNOWN")_":",! S K=1
"RTN","XPDDP",77,0)
 .;write the entry name and write the action
"RTN","XPDDP",78,0)
 .W ?3,$P(X,U),?50,$P($P(XPD,";",$P(X,U,3)+1),":",2),!
"RTN","XPDDP",79,0)
 Q:XPDFL=2
"RTN","XPDDP",80,0)
 ;XPDFL=2 this is a Packman message, called from XMP2 - Summarize
"RTN","XPDDP",81,0)
 ;XPDFL=1 this is a Install, the call backs are already Build Components
"RTN","XPDDP",82,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",83,0)
 I $O(@XPDGR@("QUES",0)) W !,"INSTALL QUESTIONS: " S I=0 D
"RTN","XPDDP",84,0)
 .F  S I=$O(@XPDGR@("QUES",I)) Q:'I  S X=$P(^(I,0),U),J=$G(^(1)),K=$G(^("A")) Q:$$CHK(5)  D
"RTN","XPDDP",85,0)
 ..W !?5,"SUBSCIRPT: ",X,!,"DIR(0)=",J W:K]"" !,"DIR(""A"")=",K,!
"RTN","XPDDP",86,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"A1",J,0))  W "DIR(""A"",",J,")=",^(0),!
"RTN","XPDDP",87,0)
 ..I $G(@XPDGR@("QUES",I,"B"))]"" W "DIR(""B"")=",^("B"),!
"RTN","XPDDP",88,0)
 ..I $G(@XPDGR@("QUES",I,"Q"))]"" W "DIR(""?"")=",^("Q"),!
"RTN","XPDDP",89,0)
 ..F J=1:1 Q:'$D(@XPDGR@("QUES",I,"Q1",J,0))  W "DIR(""?"",",J,")=",^(0),!
"RTN","XPDDP",90,0)
 ..I $G(@XPDGR@("QUES",I,"QQ"))]"" W "DIR(""??"")=",^("QQ"),!
"RTN","XPDDP",91,0)
 ..I $G(@XPDGR@("QUES",I,"M"))]"" W "M CODE: ",^("M"),!
"RTN","XPDDP",92,0)
 Q:$D(DIRUT)  Q:$$CHK(3)
"RTN","XPDDP",93,0)
 I $L($G(@XPDGR@("ABPKG"))) S XPD=^("ABPKG") D:$P(XPD,U)="y"
"RTN","XPDDP",94,0)
 .W !,"ALPHA/BETA TESTING:",$$EXTERNAL^DILFD(9.6,20,"",$P(XPD,U)),?40,"INSTALLATION MESSAGE: ",$$EXTERNAL^DILFD(9.6,21,"",$P(XPD,U,2))
"RTN","XPDDP",95,0)
 .W !,"ADDRESS: ",$P(XPD,U,3),!!,"INCLUDE NAMESPACE",?30,"EXCLUDE NAMESPACE" S I=0
"RTN","XPDDP",96,0)
 .F  S I=$O(@XPDGR@("ABNS",I)),J=0 Q:'I  W !?5,^(I,0) F  S J=$O(@XPDGR@("ABNS",I,1,J)) Q:'J  W ?35,^(J,0),! Q:$$CHK(3)
"RTN","XPDDP",97,0)
REQB Q:$D(DIRUT)  Q:$$CHK(4)
"RTN","XPDDP",98,0)
 I $O(@XPDGR@("REQB",0)) W !,"REQUIRED BUILDS:",?50,"ACTION:" D
"RTN","XPDDP",99,0)
 .S XPDI=0 F  S XPDI=$O(@XPDGR@("REQB",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",100,0)
 ..W !?3,$P(XPD,U),?50,$$EXTERNAL^DILFD(9.611,1,"",$P(XPD,U,2))
"RTN","XPDDP",101,0)
 Q
"RTN","XPDDP",102,0)
GLOBAL ;globals listing
"RTN","XPDDP",103,0)
 S I=$$CHK(8,1) Q:I  I '$P(I,"^",2) W !!,"GLOBAL:",?20,"KILL GLOBAL BEFORE INSTALL:"
"RTN","XPDDP",104,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@("GLO",XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",105,0)
 .W !?3,$P(XPD,U),?33,$$EXTERNAL^DILFD(9.65,1,"",$P(XPD,U,2))
"RTN","XPDDP",106,0)
 W ! Q
"RTN","XPDDP",107,0)
 ;
"RTN","XPDDP",108,0)
MULT ;multiple-package
"RTN","XPDDP",109,0)
 S I=$$CHK(10,1) Q:I  I '$P(I,"^",2) W !,"SEQUENCE OF BUILDS:"
"RTN","XPDDP",110,0)
 S XPDI=0 F  S XPDI=$O(@XPDGR@(10,XPDI)) Q:'XPDI  S XPD=$G(^(XPDI,0)) Q:$$CHK(4,1)  D
"RTN","XPDDP",111,0)
 .W !?2,XPDI,?8,$E($P(XPD,U),1,44),?54,$S($P(XPD,U,2)=1:"",1:"Not ")_"Required to Continue"
"RTN","XPDDP",112,0)
 W ! Q
"RTN","XPDDP",113,0)
 ;
"RTN","XPDDP",114,0)
 ;return 0 if header was not written, else "0^1"
"RTN","XPDDP",115,0)
CHK(Y,XPD) ;Y=excess lines XPD=1 print file header, return 1 to exit
"RTN","XPDDP",116,0)
 Q:$Y<(IOSL-Y) 0
"RTN","XPDDP",117,0)
 I $E(IOST,1,2)="C-" D  Q:'Y 1
"RTN","XPDDP",118,0)
 .N DIR,I,J,K,X
"RTN","XPDDP",119,0)
 .S DIR(0)="E" D ^DIR
"RTN","XPDDP",120,0)
 S XPD=$G(XPD),XPDPG=XPDPG+1
"RTN","XPDDP",121,0)
 W @IOF D HDR,HDR1:XPD
"RTN","XPDDP",122,0)
 W XPDUL,!
"RTN","XPDDP",123,0)
 Q "0^1"
"RTN","XPDDP",124,0)
 ;
"RTN","XPDDP",125,0)
XMP2(X,D0) ;called from ^XMP2
"RTN","XPDDP",126,0)
 N XPDA S XPDA=-1
"RTN","XPDDP",127,0)
 D PNT(X) Q
"RTN","XPDDP",128,0)
 ;
"RTN","XPDDP",129,0)
HDR W !,"PACKAGE: ",$P(XPD0,U),"     ",XPDDT,?70,"PAGE ",XPDPG,!
"RTN","XPDDP",130,0)
 Q
"RTN","XPDDP",131,0)
HDR1 W ?41,"UP",?47,"SEND",?53,"DATA",?73,"USER",!,?41,"DATE",?47,"SEC.",?53,"COMES",?60,"SITE",?67,"RSLV",?73,"OVER"
"RTN","XPDDP",132,0)
 W !,"FILE #",?12,"NAME",?41,"DD",?47,"CODE",?53,"W/FILE",?60,"DATA",?67,"PTS",?73,"RIDE",!
"RTN","XPDDP",133,0)
 Q
"RTN","XPDE")
0^1^B42835238
"RTN","XPDE",1,0)
XPDE ;SFISC/RSD - Package Edit ;10/10/2002  13:01
"RTN","XPDE",2,0)
 ;;8.0;KERNEL;**2,15,21,44,51,68,131,182,201,229**;Jul 10, 1995
"RTN","XPDE",3,0)
 Q
"RTN","XPDE",4,0)
 ;these tags are called from options.
"RTN","XPDE",5,0)
EDIT ;edit Build file package
"RTN","XPDE",6,0)
 N DA,DIR,DDSFILE,DR,Y,Z
"RTN","XPDE",7,0)
 Q:'$$DIC("AEMQLZ","",1)  S DA=+Y
"RTN","XPDE",8,0)
 I $P(Y,U,3) D NEW(DA)
"RTN","XPDE",9,0)
 S Z=$P(^XPD(9.6,DA,0),U,3)+1,DR="["_$P("XPD EDIT BUILD^XPD EDIT MP^XPD EDIT GP",U,Z)_"]",DDSFILE="^XPD(9.6,"
"RTN","XPDE",10,0)
 D ^DDS Q:'$G(DA)
"RTN","XPDE",11,0)
 ;if full DD, kill multiple for partial DD
"RTN","XPDE",12,0)
 S Y=0 F  S Y=$O(^XPD(9.6,DA,4,Y)) Q:'Y  S Z=$G(^(Y,222)) D
"RTN","XPDE",13,0)
 .K:$P(Z,U,3)="f" ^XPD(9.6,DA,4,Y,2),^XPD(9.6,DA,4,"APDD",Y)
"RTN","XPDE",14,0)
 D QUIT(DA)
"RTN","XPDE",15,0)
 Q
"RTN","XPDE",16,0)
COPY ;copy a Build file package
"RTN","XPDE",17,0)
 N DA,DIK,DIR,FR,FR0,TO,TO0,X,Y,Z W !
"RTN","XPDE",18,0)
 Q:'$$DIC("QEAMZ","Copy FROM what Package: ")
"RTN","XPDE",19,0)
 S FR=+Y,FR0=Y(0),Z="QEAMZL",Z("S")="I Y'="_FR
"RTN","XPDE",20,0)
 I '$$DIC(.Z,"Copy TO what Package: ") D QUIT(FR) Q
"RTN","XPDE",21,0)
 S TO=Y,TO0=Y(0)
"RTN","XPDE",22,0)
 ;if this is not new, then it will be purged before copy.
"RTN","XPDE",23,0)
 I '$P(TO,U,3) W !,$P(TO0,U)," package will be PURGED before the copy."
"RTN","XPDE",24,0)
 W ! S DIR(0)="Y",DIR("A")="OK to continue",DIR("B")="YES" D ^DIR
"RTN","XPDE",25,0)
 S DIK="^XPD(9.6,",DA=+TO
"RTN","XPDE",26,0)
 I 'Y!$D(DIRUT) D  W ! Q
"RTN","XPDE",27,0)
 .;they didn't want to continue, kill if it was a new package.
"RTN","XPDE",28,0)
 .I $P(TO,U,3) D ^DIK W $P(TO0,U)," being deleted!"
"RTN","XPDE",29,0)
 .;unlock both packages
"RTN","XPDE",30,0)
 .D QUIT(FR),QUIT(TO)
"RTN","XPDE",31,0)
 D WAIT^DICD
"RTN","XPDE",32,0)
 ;if not new, kill old data
"RTN","XPDE",33,0)
 K:'$P(TO,U,3) ^XPD(9.6,DA)
"RTN","XPDE",34,0)
 M ^XPD(9.6,DA)=^XPD(9.6,FR) S $P(^(DA,0),U)=$P(TO0,U)
"RTN","XPDE",35,0)
 D NEW(+TO)
"RTN","XPDE",36,0)
 ;if new National Package name, then kill x-ref
"RTN","XPDE",37,0)
 I $P(TO0,U,2)]"",$P(FR0,U,2)'=$P(TO0,U,2) K ^XPD(9.6,"C",$E($P(TO0,U,2),1,30),DA) S DIK(1)=1 D EN1^DIK
"RTN","XPDE",38,0)
 D QUIT(FR),QUIT(TO)
"RTN","XPDE",39,0)
 W "...Done.",!
"RTN","XPDE",40,0)
 Q
"RTN","XPDE",41,0)
BUILD ;build package from a namespace
"RTN","XPDE",42,0)
 N DIR,DIRUT,XPDA,XPDI,XPDF,XPDN,XPDX,XPDXL,X,X1,Y,Y1 W !
"RTN","XPDE",43,0)
 Q:'$$DIC("QEAML")
"RTN","XPDE",44,0)
 S XPDA=+Y W !
"RTN","XPDE",45,0)
 I $P(^XPD(9.6,XPDA,0),U,3) W !,"The Build Type must be SINGLE PACKAGE!!",! Q
"RTN","XPDE",46,0)
 ;if not a new package
"RTN","XPDE",47,0)
 I '$P(Y,U,3) D  I $D(DIRUT) D QUIT(XPDA) Q
"RTN","XPDE",48,0)
 .S DIR(0)="Y",DIR("A")="Package already exists, Want to PURGE the existing data",DIR("B")="NO",DIR("?")="YES will delete all the KERNEL FILE information for this package in the BUILD file."
"RTN","XPDE",49,0)
 .D ^DIR K DIR Q:'Y
"RTN","XPDE",50,0)
 .S Y=0 F  S Y=$O(^XPD(9.6,XPDA,"KRN",Y)) Q:'Y  K ^(Y,"NM")
"RTN","XPDE",51,0)
 E  D NEW(XPDA)
"RTN","XPDE",52,0)
 ;XPDN(0=excluded names or 1=include names, namespace)=""
"RTN","XPDE",53,0)
 W ! S DIR(0)="FO^1:15^K:X'?.1""-""1U.15UNP X",DIR("A")="Namespace",DIR("?")="Enter 1 to 15 characters, preceed with ""-"" to exclude namespace"
"RTN","XPDE",54,0)
 F  D ^DIR Q:$D(DIRUT)  S X=$E(Y,$L(Y))="*",%=$E(Y)="-",XPDN('%,$E(Y,%+1,$L(Y)-X))=""
"RTN","XPDE",55,0)
 I '$D(XPDN)!$D(DTOUT)!$D(DUOUT) D QUIT(XPDA) Q
"RTN","XPDE",56,0)
 W !!,"NAMESPACE  INCLUDE",?35,"EXCLUDE",!,?11,"-------",?35,"-------"
"RTN","XPDE",57,0)
 S (X,Y)="",(X1,Y1)=1
"RTN","XPDE",58,0)
 F  D  W !?11,X,?35,Y Q:'X1&'Y1
"RTN","XPDE",59,0)
 .S:X1 X=$O(XPDN(1,X)),X1=X]"" S:Y1 Y=$O(XPDN(0,Y)),Y1=Y]""
"RTN","XPDE",60,0)
 S DIR(0)="Y",DIR("A")="OK to continue",DIR("B")="YES" D ^DIR
"RTN","XPDE",61,0)
 I 'Y!$D(DIRUT) D QUIT(XPDA) Q
"RTN","XPDE",62,0)
 D WAIT^DICD S XPDX="",XPDI("IEN")=0
"RTN","XPDE",63,0)
 F  S XPDX=$O(XPDN(1,XPDX)),XPDXL=$L(XPDX),XPDF=0 Q:XPDX=""  D
"RTN","XPDE",64,0)
 .F  S XPDF=$O(^XPD(9.6,XPDA,"KRN",XPDF)) Q:'XPDF  D
"RTN","XPDE",65,0)
 ..N XPD,XPDIC,XPDJ,XPCNT W "."
"RTN","XPDE",66,0)
 ..;XPDIC is used in $$SCR1^XPDET
"RTN","XPDE",67,0)
 ..S XPDIC="^XPD(9.6,"_XPDA_",""KRN"","_XPDF_",""NM"",",XPCNT=0
"RTN","XPDE",68,0)
 ..D LIST^DIC(XPDF,"","","","*",.XPDI,XPDX,"","I $E(^(0),1,XPDXL)=XPDX,$$SCR1^XPDET(Y)")
"RTN","XPDE",69,0)
 ..F XPDJ=1:1 S X=$G(^TMP("DILIST",$J,1,XPDJ)) Q:X=""  D
"RTN","XPDE",70,0)
 ...S:XPDF<.404 %=^TMP("DILIST",$J,2,XPDJ)_",",X=$$TX^XPDET(X,$$GET1^DIQ(XPDF,%,$$TF^XPDET(XPDF),"I"))
"RTN","XPDE",71,0)
 ...S Y="+"_XPDJ_","_XPDF_","_XPDA_",",XPD(9.68,Y,.01)=X,XPD(9.68,Y,.03)=0
"RTN","XPDE",72,0)
 ...;Keep XPD from getting too big.
"RTN","XPDE",73,0)
 ...S XPCNT=XPCNT+1 I XPCNT>100 D UPDATE^DIE("","XPD") S XPCNT=0 K XPD
"RTN","XPDE",74,0)
 ..Q:'$D(XPD)  D UPDATE^DIE("","XPD")
"RTN","XPDE",75,0)
 D QUIT(XPDA)
"RTN","XPDE",76,0)
 W "...Done.",!
"RTN","XPDE",77,0)
 Q
"RTN","XPDE",78,0)
VER ;verify a Build file package
"RTN","XPDE",79,0)
 N XPDA,Y
"RTN","XPDE",80,0)
 Q:'$$DIC("AEMQZ")  S XPDA=+Y
"RTN","XPDE",81,0)
 D EN^XPDV
"RTN","XPDE",82,0)
 Q
"RTN","XPDE",83,0)
DIC(DIC,A,XPDL) ;DIC lookup to Build file, 9.6
"RTN","XPDE",84,0)
 N DLAYGO
"RTN","XPDE",85,0)
 S DIC(0)=$G(DIC),DIC="^XPD(9.6," S:$G(A)]"" DIC("A")=A
"RTN","XPDE",86,0)
 S:DIC(0)["L" DLAYGO=9.6,DIC("DR")="1;2//SINGLE PACKAGE;5//YES"
"RTN","XPDE",87,0)
 D ^DIC Q:Y<0 0
"RTN","XPDE",88,0)
 I '$G(XPDL) L +^XPD(9.6,+Y):0 E  W !,"Being accessed by another user" Q 0
"RTN","XPDE",89,0)
 Q +Y
"RTN","XPDE",90,0)
 ;
"RTN","XPDE",91,0)
NEW(DA) ;create Kernel Files multiple for package DA
"RTN","XPDE",92,0)
 N I,J,X,XPDNEWF,XPD,XPDI
"RTN","XPDE",93,0)
 S:'$D(^XPD(9.6,DA,"KRN",0)) ^XPD(9.6,DA,"KRN",0)=U_$P(^DD(9.6,7,0),U,2)
"RTN","XPDE",94,0)
 S I=0
"RTN","XPDE",95,0)
 F J=1:1 S X=+$P($T(FILES+J),";;",2) Q:'X  S:$D(^DD(X))&'$D(^XPD(9.6,DA,"KRN",X)) I=I+1,(XPDI(I),XPD(9.67,"+"_I_","_DA_",",.01))=X
"RTN","XPDE",96,0)
 Q:'$D(XPD)
"RTN","XPDE",97,0)
 ;XPDNEWF is a flag in INPUT transform of BUILD COMPONENT multiple
"RTN","XPDE",98,0)
 S XPDNEWF=1
"RTN","XPDE",99,0)
 D UPDATE^DIE("","XPD","XPDI")
"RTN","XPDE",100,0)
 Q
"RTN","XPDE",101,0)
QUIT(Y) ;unlock Y
"RTN","XPDE",102,0)
 L -^XPD(9.6,Y)
"RTN","XPDE",103,0)
 Q
"RTN","XPDE",104,0)
 ;
"RTN","XPDE",105,0)
 ;;file;install order;x-ref;file build;entry build;file pre;entry pre;file post;entry post;delete
"RTN","XPDE",106,0)
 ;You must put in code to delete anything
"RTN","XPDE",107,0)
FILES ;kernel files for field 7 in file 9.6
"RTN","XPDE",108,0)
 ;;9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"RTN","XPDE",109,0)
 ;;9.2;1;;;HELP^XPDTA1;HLPF1^XPDIA1;HLPE1^XPDIA1;HLPF2^XPDIA1;;HLPDEL^XPDIA1
"RTN","XPDE",110,0)
 ;;3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"RTN","XPDE",111,0)
 ;;19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"RTN","XPDE",112,0)
 ;;.5;4;;;EDEOUT^DIFROMSO(.5,DA,"",XPDA);FPRE^DIFROMSI(.5,"",XPDA);EPRE^DIFROMSI(.5,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.5,DA,"",XPDA)
"RTN","XPDE",113,0)
 ;;.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"RTN","XPDE",114,0)
 ;;.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"RTN","XPDE",115,0)
 ;;.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"RTN","XPDE",116,0)
 ;;.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"RTN","XPDE",117,0)
 ;;.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"RTN","XPDE",118,0)
 ;;3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"RTN","XPDE",119,0)
 ;;870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"RTN","XPDE",120,0)
 ;;771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"RTN","XPDE",121,0)
 ;;101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"RTN","XPDE",122,0)
 ;;8994;16;1;;;;;;;RPCDEL^XPDIA1
"RTN","XPDE",123,0)
 ;;409.61;17;1;;;;;;;LMDEL^XPDIA1
"RTN","XPDE",124,0)
 ;;19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"RTN","XPDE",125,0)
 ;;8994.2;19;1;;;;CRC32PE^XPDIA1;;;CRC32DEL^XPDIA1
"RTN","XPDE",126,0)
 ;;8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3
"RTN","XPDE",127,0)
 ;;8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3
"RTN","XPDET")
0^6^B32568215
"RTN","XPDET",1,0)
XPDET ;SFISC/RSD - Input tranforms & help for file 9.6 & 9.7 ;10/10/2002  15:43
"RTN","XPDET",2,0)
 ;;8.0;KERNEL;**15,39,41,44,51,58,66,137,229**;Jul 10, 1995
"RTN","XPDET",3,0)
 Q
"RTN","XPDET",4,0)
INPUTB(X) ;input tranfrom for NAME in BUILD file
"RTN","XPDET",5,0)
 ;X=user input
"RTN","XPDET",6,0)
 ;name must be unique
"RTN","XPDET",7,0)
 I $L(X)>50!($L(X)<3)!$D(^XPD(9.6,"B",X)) K X Q
"RTN","XPDET",8,0)
 I X["*" K:$P(X,"*",2,3)'?1.2N1"."1.2N.1(1"V",1"T").2N1"*"1.6N X Q
"RTN","XPDET",9,0)
 S %=$L(X," ") I %<2 K X Q
"RTN","XPDET",10,0)
 S %=$P(X," ",%) K:%'?1.2N1"."1.2N.1(1"V",1"T").2N X
"RTN","XPDET",11,0)
 Q
"RTN","XPDET",12,0)
INPUTE(X) ;input transform for ENTRIES in KERNEL FILES multiple
"RTN","XPDET",13,0)
 ;X=user input
"RTN","XPDET",14,0)
 N D,DD,DIC,DICR,DIX,DIY,DS,DO,XPDLK,Y
"RTN","XPDET",15,0)
 S XPDLK=$$GR(D1)
"RTN","XPDET",16,0)
 I XPDLK=""!X["*" K X Q
"RTN","XPDET",17,0)
 S DIC(0)="QEMZ",DIC=XPDLK
"RTN","XPDET",18,0)
 S:D1=9.8 DIC("S")="I $T(^@$P(^(0),U))]"""""
"RTN","XPDET",19,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",20,0)
 S X=Y(0,0)
"RTN","XPDET",21,0)
 ;check that this doesn't exist already
"RTN","XPDET",22,0)
 I $D(^XPD(9.6,D0,"KRN",D1,"NM","B",X)) K X Q
"RTN","XPDET",23,0)
 ;if fm file, change X to contain file # of template
"RTN","XPDET",24,0)
 I D1<.404 S X=$$TX(X,$P(Y(0),U,$S(D1=.403:8,1:4)))
"RTN","XPDET",25,0)
 Q
"RTN","XPDET",26,0)
GLOBALE(X) ;input transform for GLOBAL multiple .01 field in file 9.6
"RTN","XPDET",27,0)
 I $L(X)>30!($L(X)<2) K X Q
"RTN","XPDET",28,0)
 I X["(",X'[")" K X Q
"RTN","XPDET",29,0)
 ;change ' back to " for subscripts, they were changed in the Pre-Lookup node of the DD, 7.5. This was done to trick FM, which doesn't allow " in .01 fields
"RTN","XPDET",30,0)
 S X=$TR(X,"'","""")
"RTN","XPDET",31,0)
 I '$D(@("^"_X)) K X
"RTN","XPDET",32,0)
 Q
"RTN","XPDET",33,0)
INPUTMB(X) ;input transform for field 10 and 11 in file 9.6
"RTN","XPDET",34,0)
 ;X=user input
"RTN","XPDET",35,0)
 N D,DD,DIC,DICR,DIX,DIY,DS,DO,Y
"RTN","XPDET",36,0)
 ;can't select a global or multi package or itself (D0)
"RTN","XPDET",37,0)
 S DIC(0)="QEMZ",DIC="^XPD(9.6,",DIC("S")="I '$P(^(0),U,3),Y'="_D0
"RTN","XPDET",38,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",39,0)
 S X=Y(0,0)
"RTN","XPDET",40,0)
 Q
"RTN","XPDET",41,0)
LOOKE(X) ;special lookup for ENTRIES in KERNEL FILES multiple
"RTN","XPDET",42,0)
 Q:X'?1.E1"*"
"RTN","XPDET",43,0)
 N %,XPD,XPDI,XPDIC,XPDF,XPDLK,XPDX,Y
"RTN","XPDET",44,0)
 S XPDLK=$$GR(D1),XPDIC=DIC,XPDF=D1
"RTN","XPDET",45,0)
 I XPDLK="" K X Q
"RTN","XPDET",46,0)
 G:$E(X)="-" DEL
"RTN","XPDET",47,0)
 S XPDX=$P(X,"*"),XPDI("IEN")=0
"RTN","XPDET",48,0)
 D LIST^DIC(D1,"","","","*",.XPDI,XPDX,"","I $$SCR^XPDET(Y)")
"RTN","XPDET",49,0)
 I '$G(^TMP("DILIST",$J,0)) K X Q
"RTN","XPDET",50,0)
 K ^TMP("XPDX",$J)
"RTN","XPDET",51,0)
 ;loop thru list from lister and file using UPDATE^DIE
"RTN","XPDET",52,0)
 F XPDI=1:1 S X=$G(^TMP("DILIST",$J,1,XPDI)) Q:X=""  D
"RTN","XPDET",53,0)
 .S:D1<.404 %=^TMP("DILIST",$J,2,XPDI)_",",X=$$TX(X,$$GET1^DIQ(D1,%,$$TF(D1),"I"))
"RTN","XPDET",54,0)
 .S Y="+"_XPDI_","_D1_","_D0_",",^TMP("XPDX",$J,9.68,Y,.01)=X,^(.03)=0
"RTN","XPDET",55,0)
 I $D(^TMP("XPDX",$J)) D UPDATE^DIE("","^TMP(""XPDX"",$J)","^TMP(""XPD"",$J)")
"RTN","XPDET",56,0)
 ;if in Screenman then call MLOAD to update screen
"RTN","XPDET",57,0)
 I $D(DDS),$D(^TMP("XPD",$J)) D MLOAD^DDSUTL("^TMP(""XPD"",$J)")
"RTN","XPDET",58,0)
 S X=""
"RTN","XPDET",59,0)
 K ^TMP("XPDX",$J),^TMP("XPD",$J)
"RTN","XPDET",60,0)
 Q
"RTN","XPDET",61,0)
DEL ;delete using wild card
"RTN","XPDET",62,0)
 I X'?1"-"1.E1"*" K X Q
"RTN","XPDET",63,0)
 S X=$E(X,2,$L(X)-1),XPDX=X S:$L(X) XPDI("IEN")=0
"RTN","XPDET",64,0)
 D LIST^DIC(9.68,","_D1_","_D0_",","","","*",.XPDI,XPDX)
"RTN","XPDET",65,0)
 I '$G(^TMP("DILIST",$J,0)) K X Q
"RTN","XPDET",66,0)
 N DIK,DA,D2
"RTN","XPDET",67,0)
 S DIK=XPDIC,DA(1)=D1,DA(2)=D0
"RTN","XPDET",68,0)
 F XPDI=1:1 S (DA,D2)=$G(^TMP("DILIST",$J,2,XPDI)) Q:'DA  D
"RTN","XPDET",69,0)
 .D ^DIK
"RTN","XPDET",70,0)
 I $D(DDS) D MDEL^DDSUTL("^TMP(""DILIST"",$J,2)")
"RTN","XPDET",71,0)
 S X=""
"RTN","XPDET",72,0)
 K ^TMP("DILIST",$J)
"RTN","XPDET",73,0)
 Q
"RTN","XPDET",74,0)
HELP ;executable help of ENTRIES in KERNEL FILE multiple
"RTN","XPDET",75,0)
 N D,DIC,DIE,DIX,DIY,DO,DZ,DS,X,Y
"RTN","XPDET",76,0)
 ;file 9.8 is routine file, check that routine exists
"RTN","XPDET",77,0)
 S DIC=$$GR(D1),DIC(0)="M",X="??" Q:DIC=""  S:D1=9.8 DIC("S")="I $T(^@$P(^(0),U))]"""""
"RTN","XPDET",78,0)
 D ^DIC Q
"RTN","XPDET",79,0)
 ;
"RTN","XPDET",80,0)
HELPO ;executable help of INSTALL ORDER in KERNEL FILES multiple
"RTN","XPDET",81,0)
 N Y
"RTN","XPDET",82,0)
 W !,"Numbers in use:  ORDER     FILE#" S Y=0
"RTN","XPDET",83,0)
 F  S Y=$O(^XPD(9.6,D0,"KRN","AC",Y)) Q:'Y  W !,?18,$J(Y,2),?28,$O(^(Y,0))
"RTN","XPDET",84,0)
 W ! Q
"RTN","XPDET",85,0)
 ;
"RTN","XPDET",86,0)
HELPMB ;executable help of fields 10 & 11 in file 9.6
"RTN","XPDET",87,0)
 N D,DIC,DIE,DIX,DIY,DO,DZ,DS,X,Y
"RTN","XPDET",88,0)
 S DIC="^XPD(9.6,",DIC(0)="M",X="??",DIC("S")="I '$P(^(0),U,3),Y'="_D0
"RTN","XPDET",89,0)
 D ^DIC Q
"RTN","XPDET",90,0)
 ;
"RTN","XPDET",91,0)
SCRA(Y) ;screen of ACTION field in ENTRIES multiple in KERNEL FILES multiple, Y=action
"RTN","XPDET",92,0)
 ;Y=0 - send, 1 - delete, 2 - link, 3 - merge, 4 - attach, 5 - disable
"RTN","XPDET",93,0)
 ;all entries can send to site
"RTN","XPDET",94,0)
 Q:'Y 1
"RTN","XPDET",95,0)
 ;.5=function file, can't delete, all others can
"RTN","XPDET",96,0)
 I Y=1 Q (D1'=.5)
"RTN","XPDET",97,0)
 ;then rest of code check if it is a Option or Protocal and can have MENU ITEMS
"RTN","XPDET",98,0)
 Q:D1'=19&(D1'=101) 0
"RTN","XPDET",99,0)
 ;only Options and Protocol can disable
"RTN","XPDET",100,0)
 Q:Y=5 1
"RTN","XPDET",101,0)
 N FGR,X,XPDF,XPDT,XPDZ
"RTN","XPDET",102,0)
 ;get X=name, FGR=global reference, XPDF=file #
"RTN","XPDET",103,0)
 S XPDY=Y,XPDF=D1,X=$P(^XPD(9.6,D0,"KRN",D1,"NM",D2,0),U),FGR=$$FILE^XPDV(D1)
"RTN","XPDET",104,0)
 Q:X="" 0
"RTN","XPDET",105,0)
 ;X=ien of protocol or option
"RTN","XPDET",106,0)
 S X=+$O(@FGR@("B",X,0)) Q:'X 0
"RTN","XPDET",107,0)
 ;get type
"RTN","XPDET",108,0)
 S XPDT=$P($G(@FGR@(X,0)),U,4)
"RTN","XPDET",109,0)
 ;all Options and Protocols, except Event Drivers, can be attached
"RTN","XPDET",110,0)
 I XPDY=4 Q '(XPDF=101&(XPDT="E"))
"RTN","XPDET",111,0)
 ;Protocol and Type is Subscriber can't do anything else
"RTN","XPDET",112,0)
 I XPDF=101,XPDT="S" Q 0
"RTN","XPDET",113,0)
 ;if it has SUBSCRIBERS, node 775 then ok
"RTN","XPDET",114,0)
 I $O(@FGR@(X,775,0)) Q 1
"RTN","XPDET",115,0)
 ;if type is menu,potocol,protocol menu,limited,extended,window suite
"RTN","XPDET",116,0)
 I "MOQLXZ"[$P($G(@FGR@(X,0)),U,4) Q 1
"RTN","XPDET",117,0)
 ;if it has ITEMs, node 10 then ok
"RTN","XPDET",118,0)
 I $O(@FGR@(X,10,0)) Q 1
"RTN","XPDET",119,0)
 Q 0
"RTN","XPDET",120,0)
 ;
"RTN","XPDET",121,0)
 ;only Fileman templates need to know what file they are associated with.
"RTN","XPDET",122,0)
 ;this value is also triggered to field .02 in the DD.
"RTN","XPDET",123,0)
TX(X,Y) ;X=template name, Y=file #
"RTN","XPDET",124,0)
 Q X_"    FILE #"_Y
"RTN","XPDET",125,0)
 ;
"RTN","XPDET",126,0)
TF(F) ;F=file, return field of file# for templates
"RTN","XPDET",127,0)
 Q $S(F>.403:"",F<.403:4,1:7)
"RTN","XPDET",128,0)
 ;
"RTN","XPDET",129,0)
GR(X) Q $G(^DIC(X,0,"GL"))
"RTN","XPDET",130,0)
 ;
"RTN","XPDET",131,0)
 ;screens checks that X is not already in the ENTRIES multiple
"RTN","XPDET",132,0)
SCR(Y) ;screen logic for ENTRIES multiple in file 9.6
"RTN","XPDET",133,0)
 N %,X,Z
"RTN","XPDET",134,0)
 S Z=^(0),X=$P(Z,U)
"RTN","XPDET",135,0)
 ;FM files are less than .44
"RTN","XPDET",136,0)
 I XPDF<.44 D  Q:X="" 0
"RTN","XPDET",137,0)
 .S %=$S(XPDF=.403:$P(Z,U,8),1:$P(Z,U,4)),X=X_"    FILE #"_%
"RTN","XPDET",138,0)
 .S:XPDF'=.403&($P(Z,U,8)>2) %=0 S:'% X=""
"RTN","XPDET",139,0)
 ;routine must exist and must be type 'R'
"RTN","XPDET",140,0)
 I XPDF=9.8 Q:$T(^@X)=""!($P(Z,U,2)'="R") 0
"RTN","XPDET",141,0)
 Q '$D(@(XPDIC_"""B"",X)"))
"RTN","XPDET",142,0)
 ;
"RTN","XPDET",143,0)
 ;screen checks that X is not in the exclude list, XPDN(0)
"RTN","XPDET",144,0)
SCR1(Y) ;screen logic for exclude list
"RTN","XPDET",145,0)
 N %,X
"RTN","XPDET",146,0)
 ;if name X is in the exclude list, XPDN(0,X), then fail
"RTN","XPDET",147,0)
 S Y(0)=^(0),X=$P(Y(0),U) Q:$D(XPDN(0,X)) 0
"RTN","XPDET",148,0)
 ;check if X is refered in the namespace by check the subscript
"RTN","XPDET",149,0)
 ;before X, if sub exist and $P(X,sub)="" then it is part of the
"RTN","XPDET",150,0)
 ;namespace, fail and return 0
"RTN","XPDET",151,0)
 S %=$O(XPDN(0,X),-1) I $L(%) Q:$P(X,%)="" 0
"RTN","XPDET",152,0)
 Q $$SCR(.Y)
"RTN","XPDET",153,0)
 ;
"RTN","XPDET",154,0)
 ;screen on PACKAGE LINK field in file 9.6,
"RTN","XPDET",155,0)
PCK(Y) ;check Package File name, Y=ien in package file
"RTN","XPDET",156,0)
 N %,Y,Z
"RTN","XPDET",157,0)
 S Z=^(0)
"RTN","XPDET",158,0)
 ;DA is undef when you are adding a new Build without a version number
"RTN","XPDET",159,0)
 Q:'$D(^XPD(9.6,+$G(DA),0)) 1
"RTN","XPDET",160,0)
 S Y=$L($P(Z,U)),%=$P(^XPD(9.6,DA,0),U),%=$$PKG^XPDUTL(%)
"RTN","XPDET",161,0)
 Q $P(Z,U)=$E(%,1,Y)!($P(Z,U,2)=%)
"RTN","XPDET",162,0)
VOLE(X) ;input transform for VOLUME SET multiple in INSTALL file
"RTN","XPDET",163,0)
 ;X=user input
"RTN","XPDET",164,0)
 N D,DD,DIC,DICR,DIX,DIY,DO,DS,XPD,Y,%
"RTN","XPDET",165,0)
 ;(0;11)=SIGNON/PRODUCTION
"RTN","XPDET",166,0)
 S DIC(0)="QEMZ",DIC="^%ZIS(14.5,",DIC("S")="I $P(^(0),U,11)"
"RTN","XPDET",167,0)
 D ^DIC K:Y<0 X Q:'$D(X)
"RTN","XPDET",168,0)
 S X=Y(0,0)
"RTN","XPDET",169,0)
 Q
"RTN","XPDET",170,0)
VOLH ;executable help for VOLUME SET multiple in INSTALL file
"RTN","XPDET",171,0)
 N D,DD,DIC,DIE,DIX,DIY,DO,DS,DZ,X,Y,%
"RTN","XPDET",172,0)
 S X="??",DIC(0)="QEMZ",DIC="^%ZIS(14.5,",DIC("S")="I $P(^(0),U,11)"
"RTN","XPDET",173,0)
 D ^DIC
"RTN","XPDET",174,0)
 Q
"RTN","XPDET",175,0)
ID97 ;identifier for Install file
"RTN","XPDET",176,0)
 N XPDET,XPD,XPD0,XPD1,XPD2,XPD9
"RTN","XPDET",177,0)
 S XPD0=$G(^(0)),XPD1=$G(^(1)),XPD2=$G(^(2)),XPD9=$P(XPD0,U,9),XPD="" Q:XPD9=""
"RTN","XPDET",178,0)
 D
"RTN","XPDET",179,0)
 .;Loaded, get DATE LOADED
"RTN","XPDET",180,0)
 .I 'XPD9 S XPD=$$FMTE^XLFDT($P(XPD0,U,3),2) Q
"RTN","XPDET",181,0)
 .Q:XPD9>3
"RTN","XPDET",182,0)
 .;Started, get INSTALL START TIME
"RTN","XPDET",183,0)
 .I XPD9=2 S XPD=$$FMTE^XLFDT($P(XPD1,U),2) Q
"RTN","XPDET",184,0)
 .;Completed, get INSTALL COMPLETE TIME
"RTN","XPDET",185,0)
 .I XPD9=3 S XPD=$$FMTE^XLFDT($P(XPD1,U,3),2) Q
"RTN","XPDET",186,0)
 .;Queued, get QUEUED TASK NUMBER
"RTN","XPDET",187,0)
 .I XPD9=1 S XPD="#"_$P(XPD0,U,6) Q
"RTN","XPDET",188,0)
 S XPDET(1)="   "_$$EXTERNAL^DILFD(9.7,.02,"",XPD9)_"  "_XPD,XPDET(1,"F")="?0"
"RTN","XPDET",189,0)
 S:XPD2]"" XPDET(2)="=> "_$E(XPD2,1,70),XPDET(2,"F")="!?5"
"RTN","XPDET",190,0)
 D EN^DDIOL(.XPDET)
"RTN","XPDET",191,0)
 Q
"RTN","XPDET",192,0)
 ;not being used right now,
"RTN","XPDET",193,0)
DEL97(Y) ;delete access to file 9.7, 0-can't delete, 1-can
"RTN","XPDET",194,0)
 N %
"RTN","XPDET",195,0)
 S %=$P(^XPD(9.7,Y,0),U,9)
"RTN","XPDET",196,0)
 Q $S(%=3:1,%=2:0,$D(^XPD(9.7,"ASP",Y,1,Y)):1,1:0)
"RTN","XPDET",197,0)
 ;
"RTN","XPDET",198,0)
PAR964 ;Clear other fields if file is partial.  Called from within form
"RTN","XPDET",199,0)
 D PUT^DDSVAL(DIE,.DA,222.7,"n","","I") ;Send data NO
"RTN","XPDET",200,0)
 D PUT^DDSVAL(DIE,.DA,222.5,"","","I") ;Resolve pointer
"RTN","XPDET",201,0)
 D PUT^DDSVAL(DIE,.DA,222.8,"","","I") ;Sites Data
"RTN","XPDET",202,0)
 D PUT^DDSVAL(DIE,.DA,222.9,"n","","I") ;User Override
"RTN","XPDET",203,0)
 D PUT^DDSVAL(DIE,.DA,224,"","","I") ;Data Screen
"RTN","XPDET",204,0)
 Q
"RTN","XPDI")
0^2^B40794003
"RTN","XPDI",1,0)
XPDI ;SFISC/RSD - Install Process ;9/16/02  13:29
"RTN","XPDI",2,0)
 ;;8.0;KERNEL;**10,21,39,41,44,58,68,108,145,184,229**;Jul 10, 1995
"RTN","XPDI",3,0)
EN ;install
"RTN","XPDI",4,0)
 N DIR,DIRUT,POP,XPD,XPDA,XPDD,XPDIJ,XPDDIQ,XPDIT,XPDIABT,XPDNM,XPDNOQUE,XPDPKG,XPDREQAB,XPDST,XPDSET,XPDSET1,XPDT,XPDQUIT,XPDQUES,Y,ZTSK,%
"RTN","XPDI",5,0)
 S %="I '$P(^(0),U,9),$D(^XPD(9.7,""ASP"",Y,1,Y)),$D(^XTMP(""XPDI"",Y))",XPDST=$$LOOK^XPDI1(%)
"RTN","XPDI",6,0)
 Q:'XPDST!$D(XPDQUIT)
"RTN","XPDI",7,0)
 S XPDIT=0,(XPDSET,XPDSET1)=$P(^XPD(9.7,XPDST,0),U) K ^TMP($J)
"RTN","XPDI",8,0)
 ;Check each part of XPDT array
"RTN","XPDI",9,0)
 F  S XPDIT=$O(XPDT(XPDIT)) Q:'XPDIT  D  Q:'$D(XPDT)!$D(XPDQUIT)
"RTN","XPDI",10,0)
 .S XPDA=+XPDT(XPDIT),XPDNM=$P(XPDT(XPDIT),U,2),XPDPKG=+$P($G(^XPD(9.7,+XPDT(XPDIT),0)),U,2),%=$P(^(0),U,5)
"RTN","XPDI",11,0)
 .W !,"Checking Install for Package ",XPDNM
"RTN","XPDI",12,0)
 .;check that Install file was created correctly
"RTN","XPDI",13,0)
 .I '$D(^XPD(9.7,XPDA,"INI"))!'$D(^("INIT")) W !,"**INSTALL FILE IS CORRUPTED**",!,*7 S XPDQUIT=1 Q
"RTN","XPDI",14,0)
 .;run enviroment check routine
"RTN","XPDI",15,0)
 .;XPDREQAB req. build missing, =2 global killed
"RTN","XPDI",16,0)
 .I $$ENV^XPDIL1(1) S:$G(XPDREQAB)=2 XPDQUIT=1 Q
"RTN","XPDI",17,0)
 .;save variables that are setup in environ. chck. routine
"RTN","XPDI",18,0)
 .I $D(XPDNOQUE)!$D(XPDDIQ) D
"RTN","XPDI",19,0)
 ..S:$D(XPDNOQUE) ^XTMP("XPDI",XPDA,"ENVVAR","XPDNOQUE")=XPDNOQUE
"RTN","XPDI",20,0)
 ..I $D(XPDDIQ) M ^XTMP("XPDI",XPDA,"ENVVAR","XPDDIQ")=XPDDIQ
"RTN","XPDI",21,0)
 .D QUES^XPDI1(XPDA) Q:'$D(XPDT(+XPDIT))!$D(XPDQUIT)
"RTN","XPDI",22,0)
 .;XPDIJ=XPDA if XPDIJ routine is part of Build
"RTN","XPDI",23,0)
 .S:$D(^XTMP("XPDI",XPDA,"RTN","XPDIJ")) XPDIJ=XPDA
"RTN","XPDI",24,0)
 .D XQSET^XPDI1(XPDA)
"RTN","XPDI",25,0)
 ;NONE = no Build to install
"RTN","XPDI",26,0)
 G NONE:'$O(XPDT(""))!$D(XPDQUIT)!($G(XPDREQAB))
"RTN","XPDI",27,0)
 ;check that we have all Builds to install
"RTN","XPDI",28,0)
 S XPDA=XPDST,XPDNM=XPDSET,Y=0
"RTN","XPDI",29,0)
 F  S Y=$O(^XPD(9.7,"ASP",XPDA,Y)) Q:'Y  S %=+$O(^(Y,0)) I '$D(XPDT("DA",%)) G NONE
"RTN","XPDI",30,0)
 W !
"RTN","XPDI",31,0)
 ;See if a Master Build
"RTN","XPDI",32,0)
 S %=$O(^XTMP("XPDI",XPDA,"BLD",0)),%=$P(^(%,0),U,3) S:%=1 XPDT("MASTER")=XPDA
"RTN","XPDI",33,0)
 ;Inhibit Logon Question
"RTN","XPDI",34,0)
 D DIR^XPDIQ("XPI") I $D(DIRUT) D ABRTALL(2) Q
"RTN","XPDI",35,0)
 ;disable options question
"RTN","XPDI",36,0)
 D DIR^XPDIQ("XPZ") I $D(DIRUT) D ABRTALL(2) Q
"RTN","XPDI",37,0)
 ;XPDSET=set name,(also build name), of options that will be disabled
"RTN","XPDI",38,0)
 ;XPDSET1=setname or null if they don't want to disable
"RTN","XPDI",39,0)
 D  I XPDSET1="^" D ABRTALL(2) Q
"RTN","XPDI",40,0)
 .;if they say no, set XPDET1=""
"RTN","XPDI",41,0)
 .S:'$G(XPDQUES("XPZ1")) XPDSET1="",Y=0
"RTN","XPDI",42,0)
 .S ^XTMP("XQOO",XPDSET,0)=XPDSET_" is being installed by KIDS^"_DT_U_DUZ
"RTN","XPDI",43,0)
 .I XPDSET1]"" D  Q:XPDSET1="^"!(XPDSET1="")
"RTN","XPDI",44,0)
 ..;merge the options/protocols that were put in ^TMP($J,"XQOO",build name)
"RTN","XPDI",45,0)
 ..M ^XTMP("XQOO",XPDSET)=^TMP($J,"XQOO",XPDSET)
"RTN","XPDI",46,0)
 ..D INIT^XQOO(.XPDSET1) Q:"^"[XPDSET1
"RTN","XPDI",47,0)
 ..N DIR S DIR(0)="N^0:60:0",DIR("B")=0
"RTN","XPDI",48,0)
 ..S DIR("A")="Delay Install (Minutes)",DIR("?")="Enter the number of minutes to delay the installing of Routines after the Disable of Options"
"RTN","XPDI",49,0)
 ..W ! D ^DIR I $D(DIRUT) S XPDSET1="^"
"RTN","XPDI",50,0)
 .;Y is set in the call to DIR in previous .DO
"RTN","XPDI",51,0)
 .;save setname into first Build and the Delay in minutes, Y
"RTN","XPDI",52,0)
 .K XPD S XPD(9.7,XPDST_",",7)=(XPDSET1]"")_XPDSET,XPD(9.7,XPDST_",",8)=Y
"RTN","XPDI",53,0)
 .D FILE^DIE("","XPD")
"RTN","XPDI",54,0)
 ;check if they want to update other CPUs
"RTN","XPDI",55,0)
 I $G(XPDQUES("XPZ2")) D  I $D(DIRUT) D ABRTALL(2) Q
"RTN","XPDI",56,0)
 .N DA,DIE,DIR,DR,I,XPD,X,Y,Z
"RTN","XPDI",57,0)
 .;if they haven't already added Volume Sets, populate the mulitple
"RTN","XPDI",58,0)
 .I '$O(^XPD(9.7,XPDA,"VOL",0)) D  I $D(XPD) D UPDATE^DIE("","XPD")
"RTN","XPDI",59,0)
 ..X ^%ZOSF("UCI") S Y=$P(Y,",",2),(I,Z)=0
"RTN","XPDI",60,0)
 ..F  S I=$O(^%ZIS(14.5,I)) Q:'I  S X=$G(^(I,0)) S:$P(X,U)]""&$P(X,U,11)&($P(X,U)'=Y) Z=Z+1,XPD(9.703,"+"_Z_","_XPDA_",",.01)=$P(X,U)
"RTN","XPDI",61,0)
 .W !!,"I will Update the following VOLUME SETS:",!
"RTN","XPDI",62,0)
 .S I=0 F  S I=$O(^XPD(9.7,XPDA,"VOL",I)) Q:'I  W ?3,$P(^(I,0),U),!
"RTN","XPDI",63,0)
 .W ! S DIR(0)="Y",DIR("A")="Want to edit this list",DIR("B")="NO"
"RTN","XPDI",64,0)
 .D ^DIR Q:$D(DIRUT)  D:Y
"RTN","XPDI",65,0)
 ..S DA=XPDA,DIE="^XPD(9.7,",DR=30,DR(2,9.703)=".01"
"RTN","XPDI",66,0)
 ..D ^DIE
"RTN","XPDI",67,0)
 .I '$O(^XPD(9.7,XPDA,"VOL",0)) W !!,"No VOLUME SETS selected!!" Q
"RTN","XPDI",68,0)
 .Q:$$TM^%ZTLOAD  ;quit if Taskman is running
"RTN","XPDI",69,0)
 .W !!,"TASKMAN is not running. If you install now, you must run the routine XPDCPU",!,"in the production UCI for each of the VOLUME SETS you have listed once"
"RTN","XPDI",70,0)
 .W !,"the installation starts!!",!,"If you Queue the install, the VOLUME SETS will be updated automatically.",*7,*7,!!
"RTN","XPDI",71,0)
DEV S POP=0 S:'$D(^DD(3.5,0)) POP=1
"RTN","XPDI",72,0)
 ;check if home device is defined
"RTN","XPDI",73,0)
 I 'POP S IOP="",%ZIS=0 D ^%ZIS
"RTN","XPDI",74,0)
 ;Kernel Virgin Install
"RTN","XPDI",75,0)
 I POP S XPDA=XPDST D:$G(XPDIJ) XPDIJ^XPDI1 G EN^XPDIJ
"RTN","XPDI",76,0)
 ;set XPDA=starting Build, ask for device for messages
"RTN","XPDI",77,0)
 ;XPDNOQUE is defined means don't let them queue output
"RTN","XPDI",78,0)
 W !!,"Enter the Device you want to print the Install messages."
"RTN","XPDI",79,0)
 W:'$D(XPDNOQUE) !,"You can queue the install by enter a 'Q' at the device prompt."
"RTN","XPDI",80,0)
 W !,"Enter a '^' to abort the install.",!
"RTN","XPDI",81,0)
 S XPDA=XPDST,%ZIS=$P("Q",U,'$D(XPDNOQUE))
"RTN","XPDI",82,0)
 D ^%ZIS G:POP ASKABRT
"RTN","XPDI",83,0)
 ;reset expiration date to T+7 on transport global
"RTN","XPDI",84,0)
 S XPDD=$$FMADD^XLFDT(DT,7),^XTMP("XPDI",0)=XPDD_U_DT
"RTN","XPDI",85,0)
 I $D(IO("Q")) D  G ASKABRT:$D(ZTSK)[0 D XPDIJ^XPDI1:$G(XPDIJ),QUIT^XPDI1(XPDST) Q
"RTN","XPDI",86,0)
 . N DIR,NOW S NOW=$$HTFM^XLFDT($$HADD^XLFDT($H,,,2)) ;Must be in future
"RTN","XPDI",87,0)
 . S DIR(0)="DA^"_NOW_":"_XPDD_":AEFRSX"
"RTN","XPDI",88,0)
 . S DIR("A")="Request Start Time: "
"RTN","XPDI",89,0)
 . S DIR("B")=$$FMTE^XLFDT(NOW)
"RTN","XPDI",90,0)
 . S DIR("?",1)="Enter a Date including Time"
"RTN","XPDI",91,0)
 . S DIR("?",2)="The time must be in the future and not to exceed 7 days in the future."
"RTN","XPDI",92,0)
 . S DIR("?")="Current date/time: "_DIR("B")
"RTN","XPDI",93,0)
 . D ^DIR
"RTN","XPDI",94,0)
 .Q:$D(DIRUT)
"RTN","XPDI",95,0)
 .S ZTDTH=Y,ZTRTN="EN^XPDIJ",ZTDESC=XPDNM_" KIDS install",ZTSAVE("XPDA")=""
"RTN","XPDI",96,0)
 .D ^%ZTLOAD,HOME^%ZIS K IO("Q")
"RTN","XPDI",97,0)
 .Q:$D(ZTSK)[0
"RTN","XPDI",98,0)
 .W !,"Install Queued!",!!
"RTN","XPDI",99,0)
 .;save task into first Build
"RTN","XPDI",100,0)
 .K XPD S XPD(9.7,XPDST_",",5)=ZTSK,XPDIT=0
"RTN","XPDI",101,0)
 .F  S XPDIT=$O(XPDT(XPDIT)) Q:'XPDIT  S XPD(9.7,+XPDT(XPDIT)_",",.02)=1 D FILE^DIE("","XPD") K XPD
"RTN","XPDI",102,0)
 ;run install
"RTN","XPDI",103,0)
 U IO D XPDIJ^XPDI1:$G(XPDIJ),QUIT^XPDI1(XPDST) G EN^XPDIJ
"RTN","XPDI",104,0)
 Q
"RTN","XPDI",105,0)
 ;
"RTN","XPDI",106,0)
 ;XPDA=ien to del, XPDK=1 kill global, XPDALL=1 deleting all
"RTN","XPDI",107,0)
 ;XPDST=starting package.
"RTN","XPDI",108,0)
ABORT(XPDA,XPDK,XPDALL) ;abort install of Build XPDA
"RTN","XPDI",109,0)
 N %,DA,DIK,XPDJ,XPDNM,Y
"RTN","XPDI",110,0)
 Q:'$D(^XPD(9.7,XPDA,0))  S XPDNM=$P(^(0),U)
"RTN","XPDI",111,0)
 D BMES^XPDUTL(XPDNM_" Build will not be installed"_$S(XPDK=1:", Transport Global deleted!",1:"")),MES^XPDUTL("               "_$$HTE^XLFDT($H))
"RTN","XPDI",112,0)
 S DIK="^XPD(9.7,",XPDJ=XPDT("NM",XPDNM),DA=XPDA
"RTN","XPDI",113,0)
 ;kill XPDT array, but don't kill global if XPDK=2
"RTN","XPDI",114,0)
 K XPDT("NM",XPDNM),XPDT("DA",XPDA),XPDT(XPDJ),XPDT("GP") Q:XPDK=2
"RTN","XPDI",115,0)
 K ^XTMP("XPDI",XPDA)
"RTN","XPDI",116,0)
 ;if we are not deleting all packages and we are deleting the starting package
"RTN","XPDI",117,0)
 ;set the next package to the starting package. It must always be 1.
"RTN","XPDI",118,0)
 I '$G(XPDALL),XPDA=XPDST S Y=$O(XPDT(0)) D:Y
"RTN","XPDI",119,0)
 .;unlock starting install
"RTN","XPDI",120,0)
 .L -^XPD(9.7,XPDST)
"RTN","XPDI",121,0)
 .S XPDST=+XPDT(Y),XPDT(1)=XPDT(Y),XPDT("DA",XPDST)=1,XPDT("NM",$P(XPDT(Y),U,2))=1,XPDIT=0
"RTN","XPDI",122,0)
 .K XPDT(Y) N XPD
"RTN","XPDI",123,0)
 .S %="XPD(9.7,"""_XPDST_","")",@%@(3)=XPDST,@%@(4)=1
"RTN","XPDI",124,0)
 .;loop thru the rest of the packages and reset the starting package field
"RTN","XPDI",125,0)
 .F  S Y=$O(XPDT(Y)) Q:'Y  D
"RTN","XPDI",126,0)
 ..S XPD(9.7,+XPDT(Y)_",",3)=XPDST
"RTN","XPDI",127,0)
 .D FILE^DIE("","XPD")
"RTN","XPDI",128,0)
 D ^DIK
"RTN","XPDI",129,0)
 Q
"RTN","XPDI",130,0)
ASKABRT ;ask if want to unload distribution
"RTN","XPDI",131,0)
 N DIR,DIRUT,X,Y
"RTN","XPDI",132,0)
 S XPDQUIT=1,DIR(0)="Y",DIR("A")="Install ABORTED, Want to remove the Transport Globals",DIR("B")="YES"
"RTN","XPDI",133,0)
 W ! D ^DIR I Y D ABRTALL(1) Q
"RTN","XPDI",134,0)
 L -^XPD(9.7,XPDST)
"RTN","XPDI",135,0)
 Q
"RTN","XPDI",136,0)
ABRTALL(XPDK) ;abort all Builds
"RTN","XPDI",137,0)
 N XPDA
"RTN","XPDI",138,0)
 S XPDT=0
"RTN","XPDI",139,0)
 F  S XPDT=$O(XPDT(XPDT)) Q:'XPDT  S XPDA=+XPDT(XPDT) D ABORT(XPDA,XPDK,1)
"RTN","XPDI",140,0)
 ;unlock starting install
"RTN","XPDI",141,0)
 L -^XPD(9.7,XPDST)
"RTN","XPDI",142,0)
 Q
"RTN","XPDI",143,0)
NONE W !!,"**NOTHING INSTALLED**",!
"RTN","XPDI",144,0)
 Q
"RTN","XPDI1")
0^9^B17185961
"RTN","XPDI1",1,0)
XPDI1 ;SFISC/RSD - Cont of Install Process ;10/28/2002  17:14
"RTN","XPDI1",2,0)
 ;;8.0;KERNEL;**58,61,95,108,229**;Jul 10, 1995
"RTN","XPDI1",3,0)
 ;lookup into file 9.7, XPDS=DIC("S") for lookup
"RTN","XPDI1",4,0)
 ;return 0-fail or ien, XPDT=array of linked builds
"RTN","XPDI1",5,0)
LOOK(XPDS,XPDL) ;lookup Install
"RTN","XPDI1",6,0)
 N DIC,Y,XPD,XPDIT,%
"RTN","XPDI1",7,0)
 S DIC(0)="QEAMZ",DIC="^XPD(9.7,"
"RTN","XPDI1",8,0)
 S:$L($G(XPDS)) DIC("S")=XPDS
"RTN","XPDI1",9,0)
 D ^DIC Q:Y<0 0
"RTN","XPDI1",10,0)
 I '$G(XPDL) L +^XPD(9.7,+Y,0):0 E  W !,"Being accessed by another user" Q 0
"RTN","XPDI1",11,0)
 S XPD=+Y,XPDIT=0
"RTN","XPDI1",12,0)
 W !!,"This Distribution was loaded on ",$$FMTE^XLFDT($P(Y(0),U,3))," with header of ",!?3,$G(^XPD(9.7,XPD,2)),!?3,"It consisted of the following Install(s):",!
"RTN","XPDI1",13,0)
 ;build XPDT array
"RTN","XPDI1",14,0)
 I '$D(^XPD(9.7,"ASP",XPD)) D XPDT(1,XPD) Q XPD
"RTN","XPDI1",15,0)
 F  S XPDIT=$O(^XPD(9.7,"ASP",XPD,XPDIT)) Q:'XPDIT  S Y=+$O(^(XPDIT,0)) D XPDT(XPDIT,Y)
"RTN","XPDI1",16,0)
 I '$O(XPDT(0)) S XPDQUIT=1 D QUIT(XPD)
"RTN","XPDI1",17,0)
 Q XPD
"RTN","XPDI1",18,0)
 ;
"RTN","XPDI1",19,0)
QUIT(Y) ;unlock ien Y
"RTN","XPDI1",20,0)
 L -^XPD(9.7,+Y) Q
"RTN","XPDI1",21,0)
 ;
"RTN","XPDI1",22,0)
XPDT(P1,P2) ;Build XPDT array
"RTN","XPDI1",23,0)
 N % S %=$P($G(^XPD(9.7,P2,0)),U)
"RTN","XPDI1",24,0)
 I %="" W:$X ! W "**ERROR in Install, You need to remove the Distribution and reload it**",!  S XPDQUIT=1 Q
"RTN","XPDI1",25,0)
 S XPDT(P1)=P2_U_%,(XPDT("DA",P2),XPDT("NM",%))=P1 W:$X>64 ! W $J(%,15)
"RTN","XPDI1",26,0)
 Q
"RTN","XPDI1",27,0)
 ;
"RTN","XPDI1",28,0)
QUES(XPDA) ;install questions; XPDA=ien in file 9.7
"RTN","XPDI1",29,0)
 N XPDANS,XPDFIL,XPDFILN,XPDFILO,XPDFLG,XPDNM,XPDQUES,X,Y
"RTN","XPDI1",30,0)
 S XPDNM=$P(^XPD(9.7,XPDA,0),U) W !!,"Install Questions for ",XPDNM,!
"RTN","XPDI1",31,0)
 ;pre-init questions
"RTN","XPDI1",32,0)
 D DIR^XPDIQ("PRE") I $D(XPDQUIT) D ASKABRT^XPDI Q
"RTN","XPDI1",33,0)
 ;file install questions
"RTN","XPDI1",34,0)
 S (XPDFIL,XPDFLG)=0
"RTN","XPDI1",35,0)
 F  S XPDFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPDFIL)) Q:'XPDFIL  S X=^(XPDFIL),X(0)=^(XPDFIL,0),X(1)=^(XPDFIL),XPDFILO=^(0,1) D  Q:$D(XPDQUIT)
"RTN","XPDI1",36,0)
 .;check for DD screening logic
"RTN","XPDI1",37,0)
 .I $G(^(10))]"" N XPDSCR S XPDSCR=^(10) ;^(10) is ref to ^XTMP("XPDI",XPDA,"FIA",XPDFIL,0,10) from prev line
"RTN","XPDI1",38,0)
 .;XPDFILN=file name^global ref^partial DD
"RTN","XPDI1",39,0)
 .;XPDANS=new file^DD screen failed^Data exists^update file name^user
"RTN","XPDI1",40,0)
 .;doesn't want to update data  1=yes,0=no
"RTN","XPDI1",41,0)
 .S XPDFILN=X_X(0)_U_X(1),XPDANS='($D(^DIC(XPDFIL,0))#2)_"^^"_''$O(@(X(0)_"0)"))
"RTN","XPDI1",42,0)
 .I 'XPDFLG W !,"Incoming Files:" S XPDFLG=1
"RTN","XPDI1",43,0)
 .W ! D DIR^XPDIQ("XPF",XPDFIL_"#") Q:$D(XPDQUIT)
"RTN","XPDI1",44,0)
 .S:$G(XPDQUES("XPF"_XPDFIL_"#2"))=0 $P(XPDANS,U,5)=1
"RTN","XPDI1",45,0)
 .S ^XTMP("XPDI",XPDA,"FIA",XPDFIL,0,2)=XPDANS
"RTN","XPDI1",46,0)
 .;kill the answers so we can re-ask for next file
"RTN","XPDI1",47,0)
 .F I=1:1:2 K XPDQUES("XPF"_XPDFIL_"#"_I)
"RTN","XPDI1",48,0)
 ;XPDQUIT is by file questions in previous do loop, set in XPDIQ
"RTN","XPDI1",49,0)
 I $D(XPDQUIT) D ASKABRT^XPDI Q
"RTN","XPDI1",50,0)
 ;ask for coordinators to incoming mail groups
"RTN","XPDI1",51,0)
 S (XPDFIL,XPDFLG)=0
"RTN","XPDI1",52,0)
 F  S XPDFIL=$O(^XTMP("XPDI",XPDA,"KRN",3.8,XPDFIL)) Q:'XPDFIL  S X=^(XPDFIL,0),Y=$G(^(-1)) D  Q:$D(XPDQUIT)
"RTN","XPDI1",53,0)
 .;XPDANS=Mail Group name
"RTN","XPDI1",54,0)
 .Q:$P(Y,U)=1  ;Don't ask if deleting
"RTN","XPDI1",55,0)
 .S XPDANS=$P(X,U)
"RTN","XPDI1",56,0)
 .I 'XPDFLG W !!,"Incoming Mail Groups:" S XPDFLG=1
"RTN","XPDI1",57,0)
 .W ! D DIR^XPDIQ("XPM",XPDFIL_"#") Q:$D(XPDQUIT)
"RTN","XPDI1",58,0)
 .;kill the answers so we can re-ask for next MG
"RTN","XPDI1",59,0)
 .K XPDQUES("XPM"_XPDFIL_"#1")
"RTN","XPDI1",60,0)
 .Q
"RTN","XPDI1",61,0)
 I $D(XPDQUIT) D ASKABRT^XPDI Q
"RTN","XPDI1",62,0)
 ;ask to rebuild menus if Option is added
"RTN","XPDI1",63,0)
 S (XPDFIL,XPDFLG)=0
"RTN","XPDI1",64,0)
 S XPDFIL=$O(^XTMP("XPDI",XPDA,"KRN",19,XPDFIL))  D:XPDFIL
"RTN","XPDI1",65,0)
 .S X=^XTMP("XPDI",XPDA,"KRN",19,XPDFIL,0)
"RTN","XPDI1",66,0)
 .;XPDANS=Menu Rebuild Answer
"RTN","XPDI1",67,0)
 .S XPDANS=$P(X,U)
"RTN","XPDI1",68,0)
 .W ! D DIR^XPDIQ("XPO") Q:$D(XPDQUIT)
"RTN","XPDI1",69,0)
 I $D(XPDQUIT) D ASKABRT^XPDI Q
"RTN","XPDI1",70,0)
 ;post-init questions
"RTN","XPDI1",71,0)
 W ! D DIR^XPDIQ("POS") I $D(DIRUT)!$D(XPDQUIT) D ASKABRT^XPDI Q
"RTN","XPDI1",72,0)
 Q
"RTN","XPDI1",73,0)
 ;
"RTN","XPDI1",74,0)
XQSET(XPDA) ;get options & protocols to disable
"RTN","XPDI1",75,0)
 ;put in ^TMP($J,"XQOO",starting build name)
"RTN","XPDI1",76,0)
 N A,I,X,Y
"RTN","XPDI1",77,0)
 S I=0 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",19,I)) Q:'I  S X=^(I,0),A=^(-1) D
"RTN","XPDI1",78,0)
 .S Y=$O(^DIC(19,"B",$P(X,U),0))
"RTN","XPDI1",79,0)
 .;check that option exist and 0=send,1=delete,3=merge or 5=disable
"RTN","XPDI1",80,0)
 .I Y,$D(^DIC(19,Y,0)),$S('A:1,1:A#2) S ^TMP($J,"XQOO",XPDSET,19,Y)=$P(^(0),U,1,2)
"RTN","XPDI1",81,0)
 S I=0 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",101,I)) Q:'I  S X=^(I,0),A=^(-1) D
"RTN","XPDI1",82,0)
 .S Y=$O(^ORD(101,"B",$P(X,U),0))
"RTN","XPDI1",83,0)
 .I Y,$D(^ORD(101,Y,0)),$S(A=3:1,A=5:1,1:'A) S ^TMP($J,"XQOO",XPDSET,101,Y)=$P(^(0),U,1,2)
"RTN","XPDI1",84,0)
 Q
"RTN","XPDI1",85,0)
 ;XPDIJ need to install XPDIJ now & set routine flag to skip
"RTN","XPDI1",86,0)
XPDIJ N DIE,XPDA,XCM,XCN,XCS,X
"RTN","XPDI1",87,0)
 S XPDA=XPDIJ,DIE="^XTMP(""XPDI"",XPDIJ,""RTN"",""XPDIJ"",",XCN=0,X="XPDIJ"
"RTN","XPDI1",88,0)
 X ^%ZOSF("SAVE")
"RTN","XPDI1",89,0)
 S XCN=$$RTNUP^XPDUTL("XPDIJ",2)
"RTN","XPDI1",90,0)
 Q
"RTN","XPDIA1")
0^5^B50062561
"RTN","XPDIA1",1,0)
XPDIA1 ;SFISC/RSD - Install Pre/Post Actions for Kernel files cont. ;10/03/2002  16:59
"RTN","XPDIA1",2,0)
 ;;8.0;KERNEL;**2,44,51,58,68,85,131,146,182,229**;Jul 10, 1995
"RTN","XPDIA1",3,0)
 Q
"RTN","XPDIA1",4,0)
HLPF1 ;help frames file pre
"RTN","XPDIA1",5,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",6,0)
 Q
"RTN","XPDIA1",7,0)
HLPE1 ;entry pre
"RTN","XPDIA1",8,0)
 S ^TMP($J,"XPD",DA)="" K ^DIC(9.2,DA,1),^(2),^(3),^(10)
"RTN","XPDIA1",9,0)
 Q
"RTN","XPDIA1",10,0)
HLPF2 ;file post
"RTN","XPDIA1",11,0)
 N DA,DIK,I,X,Y,Y0
"RTN","XPDIA1",12,0)
 ;need to send error message, need to setup message
"RTN","XPDIA1",13,0)
 S DA=0,DIK=DIC F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA1",14,0)
 .;repoint Related Frame (2;0)
"RTN","XPDIA1",15,0)
 .S I=0 F  S I=$O(^DIC(9.2,DA,2,I)) Q:'I  S Y0=$G(^(I,0)),Y=$$LK^XPDIA("^DIC(9.2)",$P(Y0,U,2)),$P(^DIC(9.2,DA,2,I,0),U,2)=Y
"RTN","XPDIA1",16,0)
 .;repoint OBJECT (10;0)
"RTN","XPDIA1",17,0)
 .S (I,X)=0 F  S I=$O(^DIC(9.2,DA,10,I)) Q:'I  S Y0=$G(^(I,0)) D
"RTN","XPDIA1",18,0)
 ..S Y=$$LK^XPDIA("^MAG",$P(Y0,U)) S:Y $P(^DIC(9.2,DA,10,I,0),U)=Y,X=X+1_U_I
"RTN","XPDIA1",19,0)
 ..K:'Y ^DIC(9.2,DA,10,I)
"RTN","XPDIA1",20,0)
 .I X S $P(^DIC(9.2,DA,10,0),U,3,4)=$P(X,U,2)_U_+X
"RTN","XPDIA1",21,0)
 .D IX1^DIK
"RTN","XPDIA1",22,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",23,0)
 Q
"RTN","XPDIA1",24,0)
HLPDEL ;help frame delete
"RTN","XPDIA1",25,0)
 N DA,DIK,XPDI,XPDJ
"RTN","XPDIA1",26,0)
 S XPDI=0
"RTN","XPDIA1",27,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)),XPDJ=0 Q:'XPDI  D
"RTN","XPDIA1",28,0)
 .S DIK="^DIC(9.2,XPDJ,2,"
"RTN","XPDIA1",29,0)
 .;check other frames that point to this one
"RTN","XPDIA1",30,0)
 .F  S XPDJ=$O(^DIC(9.2,"AE",XPDI,XPDJ)) Q:'XPDJ  S Z=$O(^(XPDJ,0)) D:Z
"RTN","XPDIA1",31,0)
 ..K DA S DA=Z,DA(1)=XPDJ D ^DIK
"RTN","XPDIA1",32,0)
 .;delete this frame
"RTN","XPDIA1",33,0)
 .K DA S DA=XPDI,DIK="^DIC(9.2," D ^DIK
"RTN","XPDIA1",34,0)
 Q
"RTN","XPDIA1",35,0)
BULE1 ;bulletin entry pre
"RTN","XPDIA1",36,0)
 N X,I S I=0
"RTN","XPDIA1",37,0)
 ;save current Mail Groups (2)
"RTN","XPDIA1",38,0)
 I $G(^XMB(3.6,DA,2,0))]"" S X(0)=^(0) F  S I=$O(^XMB(3.6,DA,2,I)) Q:'I  S X(I)=$G(^(I,0))
"RTN","XPDIA1",39,0)
 K ^XMB(3.6,DA)
"RTN","XPDIA1",40,0)
 ;after killing data, put back Mail Groups before data merge
"RTN","XPDIA1",41,0)
 I $D(X) S ^XMB(3.6,DA,2,0)=X(0),I=0 F  S I=$O(X(I)) Q:'I  S ^XMB(3.6,DA,2,I,0)=X(I)
"RTN","XPDIA1",42,0)
 Q
"RTN","XPDIA1",43,0)
BULDEL ;del bulletins
"RTN","XPDIA1",44,0)
 D DELIEN^XPDUTL1(3.6,$G(%))
"RTN","XPDIA1",45,0)
 Q
"RTN","XPDIA1",46,0)
MAILGF1 ;mail groups file pre
"RTN","XPDIA1",47,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",48,0)
 Q
"RTN","XPDIA1",49,0)
MAILGE1 ;mail group entry pre
"RTN","XPDIA1",50,0)
 N I,J
"RTN","XPDIA1",51,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA1",52,0)
 ;save MEMBER GROUPS (5;0)
"RTN","XPDIA1",53,0)
 I $O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5,0)) M ^TMP($J,"XPD",DA,5)=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5) K ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5)
"RTN","XPDIA1",54,0)
 ;save MEMBER - REMOTE (6;0)
"RTN","XPDIA1",55,0)
 I $O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6,0)) M ^TMP($J,"XPD",DA,6)=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6) K ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6)
"RTN","XPDIA1",56,0)
 ;if there is a new Description, kill the old Description
"RTN","XPDIA1",57,0)
 K:$O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,2,0)) ^XMB(3.8,DA,2)
"RTN","XPDIA1",58,0)
 S I=^XMB(3.8,DA,0),J=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,0)
"RTN","XPDIA1",59,0)
 ;save REFERENCE COUNT (0;4) & LAST REFERENCED (0;5)
"RTN","XPDIA1",60,0)
 S:$P(I,U,4) $P(J,U,4)=$P(I,U,4) S:$P(I,U,5) $P(J,U,5)=$P(I,U,5)
"RTN","XPDIA1",61,0)
 ;check COORDINATOR (0;7), if exist then save, else bring in one that was asked during install question
"RTN","XPDIA1",62,0)
 D
"RTN","XPDIA1",63,0)
 .I $P(I,U,7) S $P(J,U,7)=$P(I,U,7) Q
"RTN","XPDIA1",64,0)
 .S %=$O(^XPD(9.7,XPDA,"QUES","B","XPM"_OLDA_"#1",0)) Q:'%
"RTN","XPDIA1",65,0)
 .S:$G(^XPD(9.7,XPDA,"QUES",%,1)) $P(J,U,7)=^(1)
"RTN","XPDIA1",66,0)
 S ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,0)=J,I=$G(^XMB(3.8,DA,3))
"RTN","XPDIA1",67,0)
 ;save ORGANIZER (3;1)
"RTN","XPDIA1",68,0)
 I $P(I,U) S $P(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,3),U)=$P(I,U)
"RTN","XPDIA1",69,0)
 Q
"RTN","XPDIA1",70,0)
MAILGF2 ;mail group file post
"RTN","XPDIA1",71,0)
 N DA,DIK,XPDMDA,XPDI,Y
"RTN","XPDIA1",72,0)
 S XPDMDA=0,DIK="^XMB(3.8,"
"RTN","XPDIA1",73,0)
 F  S XPDMDA=$O(^TMP($J,"XPD",XPDMDA)) Q:'XPDMDA  D
"RTN","XPDIA1",74,0)
 .;merge & repoint MEMBER GROUP (5;0)
"RTN","XPDIA1",75,0)
 .S XPDI=0
"RTN","XPDIA1",76,0)
 .F  S XPDI=$O(^TMP($J,"XPD",XPDMDA,5,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D:Y]"" ADD^XPDIA(3.811,XPDMDA,Y)
"RTN","XPDIA1",77,0)
 .;merge & repoint MEMBER - REMOTE (6;0)
"RTN","XPDIA1",78,0)
 .S XPDI=0
"RTN","XPDIA1",79,0)
 .F  S XPDI=$O(^TMP($J,"XPD",XPDMDA,6,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D:Y]"" ADD^XPDIA(3.812,XPDMDA,Y)
"RTN","XPDIA1",80,0)
 .S DA=XPDMDA D IX1^DIK
"RTN","XPDIA1",81,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",82,0)
 Q
"RTN","XPDIA1",83,0)
MAILGDEL(RT) ;Mail Group delete
"RTN","XPDIA1",84,0)
 D DELPTR^XPDUTL1(3.8,RT) ;Delete any pointer entries
"RTN","XPDIA1",85,0)
 D DELIEN^XPDUTL1(3.8,RT) ;Delete the entries
"RTN","XPDIA1",86,0)
 Q
"RTN","XPDIA1",87,0)
HLAPF1 ;HL7 application parameter #771 file pre
"RTN","XPDIA1",88,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",89,0)
 Q
"RTN","XPDIA1",90,0)
HLAPE1 ;HL7 application parameter #771 entry pre
"RTN","XPDIA1",91,0)
 N I,J
"RTN","XPDIA1",92,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA1",93,0)
 S I=^HL(771,DA,0),J=^XTMP("XPDI",XPDA,"KRN",771,OLDA,0)
"RTN","XPDIA1",94,0)
 ;save FACILITY NAME (0;3)
"RTN","XPDIA1",95,0)
 S:$P(I,U,3)]"" $P(J,U,3)=$P(I,U,3)
"RTN","XPDIA1",96,0)
 ;repoint MAIL GROUP (0;4)
"RTN","XPDIA1",97,0)
 S:$P(J,U,4)]"" $P(J,U,4)=$$LK^XPDIA("^XMB(3.8)",$P(J,U,4))
"RTN","XPDIA1",98,0)
 ;repoint COUNTRY CODE (0;7)
"RTN","XPDIA1",99,0)
 S:$P(J,U,7)]"" $P(J,U,7)=$$LK^XPDIA("^HL(779.004)",$P(J,U,7))
"RTN","XPDIA1",100,0)
 S ^XTMP("XPDI",XPDA,"KRN",771,OLDA,0)=J
"RTN","XPDIA1",101,0)
 ;remove HL7 SEGMENT (SEG;0), HL7 MESSAGE (MSG;0)
"RTN","XPDIA1",102,0)
 K ^HL(771,DA,"SEG"),^("MSG")
"RTN","XPDIA1",103,0)
 Q
"RTN","XPDIA1",104,0)
HLAPF2 ;HL7 application parameter #771 file post
"RTN","XPDIA1",105,0)
 N DA,DIK,XPDI,X,Y
"RTN","XPDIA1",106,0)
 S DA=0,DIK="^HL(771,"
"RTN","XPDIA1",107,0)
 F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA1",108,0)
 .;repoint HL7 SEGMENT (SEG;0)
"RTN","XPDIA1",109,0)
 .S XPDI=0
"RTN","XPDIA1",110,0)
 .F  S XPDI=$O(^HL(771,DA,"SEG",XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D
"RTN","XPDIA1",111,0)
 ..S X=$$LK^XPDIA("^HL(771.3)",$P(Y,U))
"RTN","XPDIA1",112,0)
 ..I X]"" S $P(^HL(771,DA,"SEG",XPDI,0),U)=X Q
"RTN","XPDIA1",113,0)
 ..K ^HL(771,DA,"SEG",XPDI)
"RTN","XPDIA1",114,0)
 .;repoint HL7 MESSAGE (MSG;0)
"RTN","XPDIA1",115,0)
 .S XPDI=0
"RTN","XPDIA1",116,0)
 .F  S XPDI=$O(^HL(771,DA,"MSG",XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D
"RTN","XPDIA1",117,0)
 ..S X=$$LK^XPDIA("^HL(771.3)",$P(Y,U))
"RTN","XPDIA1",118,0)
 ..I X]"" S $P(^HL(771,DA,"MSG",XPDI,0),U)=X Q
"RTN","XPDIA1",119,0)
 ..K ^HL(771,DA,"MSG",XPDI)
"RTN","XPDIA1",120,0)
 .D IX1^DIK
"RTN","XPDIA1",121,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",122,0)
 Q
"RTN","XPDIA1",123,0)
HLLLPE ;HL7 lower level protocol #869.2 entry pre
"RTN","XPDIA1",124,0)
 N I,J,L,TMP,Y
"RTN","XPDIA1",125,0)
 S L=$P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U),I=0
"RTN","XPDIA1",126,0)
 ;loop thru logical links and find those pointing to this llp
"RTN","XPDIA1",127,0)
 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",870,I)) Q:'I  S J=$G(^(I,0)) D
"RTN","XPDIA1",128,0)
 . Q:$P(J,U,3)'=L
"RTN","XPDIA1",129,0)
 . ;save llp into tmp, get the llp type field
"RTN","XPDIA1",130,0)
 . M TMP=^XTMP("XPDI",XPDA,"KRN",869.2,OLDA) S Y=$P(TMP(0),U,2)
"RTN","XPDIA1",131,0)
 . K TMP(-1),TMP(0)
"RTN","XPDIA1",132,0)
 . M ^XTMP("XPDI",XPDA,"KRN",870,I)=TMP S $P(^(I,0),U,3)=Y
"RTN","XPDIA1",133,0)
 S I=$P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U,2)
"RTN","XPDIA1",134,0)
 ;repoint LLP TYPE (0;2)
"RTN","XPDIA1",135,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U,2)=$$LK^XPDIA("^HLCS(869.1)",I)
"RTN","XPDIA1",136,0)
 S I=$P($G(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,100)),U)
"RTN","XPDIA1",137,0)
 ;repoint MAIL GROUP (100;1)
"RTN","XPDIA1",138,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,100),U)=$$LK^XPDIA("^XMB(3.8)",I)
"RTN","XPDIA1",139,0)
 ;save HLLP DEVICE (200;1)
"RTN","XPDIA1",140,0)
 S I=$G(^HLCS(869.2,DA,200))
"RTN","XPDIA1",141,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,200),U)=$P(I,U)
"RTN","XPDIA1",142,0)
 ;save X3.28 DEVICE (300;1)
"RTN","XPDIA1",143,0)
 S I=$G(^HLCS(869.2,DA,300))
"RTN","XPDIA1",144,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,300),U)=$P(I,U)
"RTN","XPDIA1",145,0)
 ;save TCP/IP Start-up Node (400;6)
"RTN","XPDIA1",146,0)
 S I=$G(^HLCS(869.2,DA,400))
"RTN","XPDIA1",147,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,400),U,6)=$P(I,U,6)
"RTN","XPDIA1",148,0)
 Q
"RTN","XPDIA1",149,0)
HLLLE ;HL7 logical link #870 entry pre
"RTN","XPDIA1",150,0)
 N I,J,K,L,Y
"RTN","XPDIA1",151,0)
 S I=^HLCS(870,DA,0),J=^XTMP("XPDI",XPDA,"KRN",870,OLDA,0)
"RTN","XPDIA1",152,0)
 ;repoint INSTITUTION (0;2)
"RTN","XPDIA1",153,0)
 I $P(J,U,2)]"" S Y=$$LK^XPDIA("^DIC(4)",$P(J,U,2)) D:Y=""  S $P(J,U,2)=Y
"RTN","XPDIA1",154,0)
 .D BMES^XPDUTL(" Couldn't resolve Institution "_$P(J,U,2)_" for Logical Link "_$P(^HLCS(870,DA,0),U))
"RTN","XPDIA1",155,0)
 ;repoint LLP TYPE (0;3)
"RTN","XPDIA1",156,0)
 S:$P(J,U,3)]"" $P(J,U,3)=$$LK^XPDIA("^HLCS(869.1)",$P(J,U,3))
"RTN","XPDIA1",157,0)
 ;repoint DOMAIN (0;7)
"RTN","XPDIA1",158,0)
 I $P(J,U,7)]"" S Y=$$LK^XPDIA("^DIC(4.2)",$P(J,U,7)) D:Y=""  S $P(J,U,7)=Y
"RTN","XPDIA1",159,0)
 .D BMES^XPDUTL(" Couldn't resolve Domain "_$P(J,U,7)_" for Logical Link "_$P(^HLCS(870,DA,0),U))
"RTN","XPDIA1",160,0)
 ;save node 0; pieces 4,5,6,7,10,11,12,19,21
"RTN","XPDIA1",161,0)
 F L=4:1:7,10:1:12,19,21 S:$P(I,U,L)]"" $P(J,U,L)=$P(I,U,L)
"RTN","XPDIA1",162,0)
 ;set SHUTDOWN LLP (0;15) no for DSM multi-listener and yes for all else
"RTN","XPDIA1",163,0)
 S Y=$P($G(^HLCS(870,DA,400)),U,3) S:Y]"" $P(J,U,15)=$S(Y="M":(^%ZOSF("OS")["OpenM"),1:1)
"RTN","XPDIA1",164,0)
 S ^XTMP("XPDI",XPDA,"KRN",870,OLDA,0)=J
"RTN","XPDIA1",165,0)
 S I=$P($G(^XTMP("XPDI",XPDA,"KRN",870,OLDA,100)),U)
"RTN","XPDIA1",166,0)
 ;repoint MAIL GROUP (100;1)
"RTN","XPDIA1",167,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",870,OLDA,100),U)=$$LK^XPDIA("^XMB(3.8)",I)
"RTN","XPDIA1",168,0)
 ;save data from site on nodes 200,300,400
"RTN","XPDIA1",169,0)
 F L=200,300,400 S I=$G(^HLCS(870,DA,L)) D:I]""
"RTN","XPDIA1",170,0)
 . S J=$G(^XTMP("XPDI",XPDA,"KRN",870,OLDA,L)) Q:J=""
"RTN","XPDIA1",171,0)
 . ;check local data (I) and if exist set incomming data (J)
"RTN","XPDIA1",172,0)
 . F K=1:1:10 S Y=$P(I,U,K) S:Y]"" $P(J,U,K)=Y
"RTN","XPDIA1",173,0)
 . S ^XTMP("XPDI",XPDA,"KRN",870,OLDA,L)=J
"RTN","XPDIA1",174,0)
 Q
"RTN","XPDIA1",175,0)
KEYDEL ;del security keys
"RTN","XPDIA1",176,0)
 N XPDI S XPDI=0
"RTN","XPDIA1",177,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  D DEL^XPDKEY(XPDI)
"RTN","XPDIA1",178,0)
 Q
"RTN","XPDIA1",179,0)
LMDEL ;del list manager templates
"RTN","XPDIA1",180,0)
 D DELIEN^XPDUTL1(409.61,$NA(^TMP($J,"XPDEL")))
"RTN","XPDIA1",181,0)
 Q
"RTN","XPDIA1",182,0)
RPCDEL ;del Kernel RPCs
"RTN","XPDIA1",183,0)
 D DELIEN^XPDUTL1(8994,$G(%))
"RTN","XPDIA1",184,0)
 Q
"RTN","XPDIA1",185,0)
CRC32PE ;pre entry for Kernel RPCs CRC32
"RTN","XPDIA1",186,0)
 ;if there is a new Description, kill the old Description
"RTN","XPDIA1",187,0)
 K:$O(^XTMP("XPDI",XPDA,"KRN",8994.2,OLDA,1,0)) ^XWB(8994.2,DA,1)
"RTN","XPDIA1",188,0)
 Q
"RTN","XPDIA1",189,0)
CRC32DEL ;del Kernel RPCs CRC32
"RTN","XPDIA1",190,0)
 D DELIEN^XPDUTL1(8994.2,$G(%))
"RTN","XPDIA1",191,0)
 Q
"RTN","XPDIA1",192,0)
HLAPDEL(RT) ;del HL7 application parameter #771
"RTN","XPDIA1",193,0)
 D DELIEN^XPDUTL1(771,RT)
"RTN","XPDIA1",194,0)
 Q
"RTN","XPDIA1",195,0)
HLLLDEL(RT) ;del HL7 logical link #870
"RTN","XPDIA1",196,0)
 N DA,DIK,XPDI,XPDJ,Y
"RTN","XPDIA1",197,0)
 S XPDI=0
"RTN","XPDIA1",198,0)
 ;loop thru protocols, #101, get LL field, 770.7 (700;7)
"RTN","XPDIA1",199,0)
 F  S XPDI=$O(^ORD(101,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,700)),U,7) D:Y
"RTN","XPDIA1",200,0)
 . Q:'$D(^TMP($J,"XPDEL",Y))
"RTN","XPDIA1",201,0)
 . K XPDJ S XPDJ(101,XPDI_",",770.7)="@"
"RTN","XPDIA1",202,0)
 . D FILE^DIE("","XPDJ")
"RTN","XPDIA1",203,0)
 ;subscription, #774
"RTN","XPDIA1",204,0)
 F  S XPDI=$O(TMP($J,"XPDEL",XPDI)) Q:'XPDI  D:$D(^HLS(774,"C",XPDI))
"RTN","XPDIA1",205,0)
 . S XPDJ=0 F  S XPDJ=$O(^HLS(774,"C",XPDI,XPDJ))
"RTN","XPDIA1",206,0)
 D DELIEN^XPDUTL1(870,RT)
"RTN","XPDIA1",207,0)
 Q
"RTN","XPDIJ")
0^3^B20974693
"RTN","XPDIJ",1,0)
XPDIJ ;SFISC/RSD - Install Job ;09/12/2002  15:22
"RTN","XPDIJ",2,0)
 ;;8.0;KERNEL;**2,21,28,41,44,68,81,95,108,124,229**;Jul 10, 1995
"RTN","XPDIJ",3,0)
EN ;install all packages
"RTN","XPDIJ",4,0)
 ;XPDA=ien of first package
"RTN","XPDIJ",5,0)
 ;this is needed to restore XPDIJ1
"RTN","XPDIJ",6,0)
 D LNRF("XPDIJ1")
"RTN","XPDIJ",7,0)
 ;D LNRF("XPDIQ") ;Pre-Install other KIDS routines
"RTN","XPDIJ",8,0)
 N IEN,XPDI,XPD0,XPDSET,XPDABORT,XPDMENU,XPDQUIT,XPDVOL,X,Y,ZTRTN,ZTDTH,ZTIO,ZTDESC,ZTSK
"RTN","XPDIJ",9,0)
 M X=DUZ N DUZ M DUZ=X S DUZ(0)="@" ;See that install has full FM priv.
"RTN","XPDIJ",10,0)
 I $$NEWERR^%ZTER N $ETRAP,$ESTACK S $ETRAP="D ERR^XPDIJ"
"RTN","XPDIJ",11,0)
 E  S X="ERR^XPDIJ",@^%ZOSF("TRAP")
"RTN","XPDIJ",12,0)
 Q:'$D(^XPD(9.7,+$G(XPDA),0))  S XPD0=^(0)
"RTN","XPDIJ",13,0)
 D INIT^XPDID
"RTN","XPDIJ",14,0)
 ;See if need to Inhibit Logons
"RTN","XPDIJ",15,0)
 I $$ANSWER^XPDIQ("XPI1") D INHIBIT^XPDIJ1("Y")
"RTN","XPDIJ",16,0)
 ;disable options & protocols for setname, XPDSET=1/0^setname^out of order msg.
"RTN","XPDIJ",17,0)
 S Y=$P(XPD0,U,8),XPDSET=+Y_U_$E(Y,2,99)_U_$S($L(Y):$P($G(^XTMP("XQOO",$E(Y,2,99),0)),U),1:"")
"RTN","XPDIJ",18,0)
 ;hang the number of seconds given in 0;10
"RTN","XPDIJ",19,0)
 I XPDSET D OFF^XQOO1($P(XPDSET,U,2)) I $P(XPD0,U,10) H ($P(XPD0,U,10)*60)
"RTN","XPDIJ",20,0)
 S Y=0
"RTN","XPDIJ",21,0)
 ;XPDABORT can be set in pre or post install to abort install
"RTN","XPDIJ",22,0)
 F  S Y=$O(^XPD(9.7,"ASP",XPDA,Y)) Q:'Y  S %=$O(^(Y,0)) D:%  Q:$D(XPDABORT)
"RTN","XPDIJ",23,0)
 .N XPD,XPDA,XPDNM,XPDV,XPDV0,XPDVOL,XPDX,XPDY,Y
"RTN","XPDIJ",24,0)
 .;Now do the Install
"RTN","XPDIJ",25,0)
 .S XPDA=%,XPDNM=$P($G(^XPD(9.7,XPDA,0)),U) D IN^XPDIJ1 Q:$D(XPDABORT)
"RTN","XPDIJ",26,0)
 ;
"RTN","XPDIJ",27,0)
 ;Now do Master Build Post INIT.
"RTN","XPDIJ",28,0)
 I '$D(XPDABORT),$D(XPDT("MASTER")) D
"RTN","XPDIJ",29,0)
 .S XPDBLD=$O(^XTMP("XPDI",XPDA,"BLD",0))
"RTN","XPDIJ",30,0)
 .D POST^XPDIJ1
"RTN","XPDIJ",31,0)
 ;ZTREQ tells taskman to delete task
"RTN","XPDIJ",32,0)
 I $G(ZTSK) S ZTREQ="@" D
"RTN","XPDIJ",33,0)
 .;remove task # from Install File
"RTN","XPDIJ",34,0)
 .N XPD S XPD(9.7,XPDA_",",5)="@"
"RTN","XPDIJ",35,0)
 .D FILE^DIE("","XPD")
"RTN","XPDIJ",36,0)
 ;quit if install was aborted
"RTN","XPDIJ",37,0)
 I $D(XPDABORT) D EXIT^XPDID("Install Aborted!!"),^%ZISC Q
"RTN","XPDIJ",38,0)
 ;put option back in order
"RTN","XPDIJ",39,0)
 I $P(XPDSET,U,2)]"" D ON^XQOO1($P(XPDSET,U,2)) K ^XTMP("XQOO",$P(XPDSET,U,2))
"RTN","XPDIJ",40,0)
 ;check if menu rebuild is wanted (only if option has been added)
"RTN","XPDIJ",41,0)
 I $$ANSWER^XPDIQ("XPO1") D
"RTN","XPDIJ",42,0)
 .D BMES^XPDUTL(" Call MENU rebuild"),KIDS^XQ81
"RTN","XPDIJ",43,0)
 .;check if need to queue menu rebuild on other CPUs
"RTN","XPDIJ",44,0)
 .D:$O(^XPD(9.7,XPDA,"VOL",0))
"RTN","XPDIJ",45,0)
 ..N XPDU,XPDY,XPDV,XPDV0,ZTUCI,ZTCPU
"RTN","XPDIJ",46,0)
 ..X ^%ZOSF("UCI") S XPDU=$P(Y,","),XPDY=$P(Y,",",2),XPDV=0
"RTN","XPDIJ",47,0)
 ..;loop thru VOLUMES SET and don't do current volume set
"RTN","XPDIJ",48,0)
 ..F  S XPDV=$O(^XPD(9.7,XPDA,"VOL",XPDV)) Q:'XPDV  S XPDV0=$P(^(XPDV,0),U) D:XPDV0'=XPDY
"RTN","XPDIJ",49,0)
 ...S ZTUCI=XPDU,ZTDTH=$H,ZTIO="",ZTDESC="Install Menu Rebuild",ZTCPU=XPDV0,ZTRTN="KIDS^XQ81" D ^%ZTLOAD
"RTN","XPDIJ",50,0)
 ;
"RTN","XPDIJ",51,0)
 ;See if need to reset inhibit logons
"RTN","XPDIJ",52,0)
 I $$ANSWER^XPDIQ("XPI1") D INHIBIT^XPDIJ1("N")
"RTN","XPDIJ",53,0)
 ;
"RTN","XPDIJ",54,0)
 ;clean up globals
"RTN","XPDIJ",55,0)
 S Y=0
"RTN","XPDIJ",56,0)
 F  S Y=$O(^XPD(9.7,"ASP",XPDA,Y)) Q:'Y  S XPDI=$O(^(Y,0)) D:XPDI
"RTN","XPDIJ",57,0)
 . N %,Y,XPD,X
"RTN","XPDIJ",58,0)
 . ;See if need to delete Env,Pre,Post routines.
"RTN","XPDIJ",59,0)
 . S %=$O(^XTMP("XPDI",XPDI,"BLD",0)),XPD=$G(^XTMP("XPDI",XPDI,"BLD",%,"INID"))
"RTN","XPDIJ",60,0)
 . I '$$GET^XUPARAM("XPD NO_EPP_DELETE") F %=1:1:3 I $P(XPD,U,%)="y" D
"RTN","XPDIJ",61,0)
 . . S X=^XTMP("XPDI",XPDI,$P("PRE^INIT^INI",U,%)) S:X[U X=$P(X,U,2) X:X]"" ^%ZOSF("DEL")
"RTN","XPDIJ",62,0)
 . ;kill transport global
"RTN","XPDIJ",63,0)
 . K ^XTMP("XPDI",XPDI)
"RTN","XPDIJ",64,0)
 . ;update the status field
"RTN","XPDIJ",65,0)
 . S XPD(9.7,XPDI_",",.02)=3
"RTN","XPDIJ",66,0)
 . D FILE^DIE("","XPD")
"RTN","XPDIJ",67,0)
 D EXIT^XPDID("Install Completed"),^%ZISC
"RTN","XPDIJ",68,0)
 Q
"RTN","XPDIJ",69,0)
 ;
"RTN","XPDIJ",70,0)
SAVE(X) ;restore routine X
"RTN","XPDIJ",71,0)
 N %,DIE,XCM,XCN,XCS
"RTN","XPDIJ",72,0)
 S DIE="^XTMP(""XPDI"",XPDA,""RTN"",X,",XCN=0
"RTN","XPDIJ",73,0)
 X ^%ZOSF("SAVE")
"RTN","XPDIJ",74,0)
 Q
"RTN","XPDIJ",75,0)
RTN(XPDA) ;restore all routines for package XPDA
"RTN","XPDIJ",76,0)
 ;^XPD("XPDI",XPDA,"RTN",routine name)=0-install, 1-delete, 2-skip^checksum
"RTN","XPDIJ",77,0)
 Q:$G(XPDA)=""
"RTN","XPDIJ",78,0)
 N X,XPDI,XPDJ S XPDI=""
"RTN","XPDIJ",79,0)
 F  S XPDI=$O(^XTMP("XPDI",XPDA,"RTN",XPDI)) Q:XPDI=""  S XPDJ=^(XPDI) D
"RTN","XPDIJ",80,0)
 .;if we are doing VT graphic display, set counter
"RTN","XPDIJ",81,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIJ",82,0)
 .I 'XPDJ D SAVE(XPDI) Q
"RTN","XPDIJ",83,0)
 .;set checksum to null, since routine wasn't loaded
"RTN","XPDIJ",84,0)
 .I $P(XPDJ,U,2) S $P(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"KRN",9.8,"NM",$P(XPDJ,U,2),0),U,4)=""
"RTN","XPDIJ",85,0)
 .I $P(XPDJ,U)=1 S X=XPDI X ^%ZOSF("DEL")
"RTN","XPDIJ",86,0)
 ;if graphic display, update full count
"RTN","XPDIJ",87,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIJ",88,0)
 Q
"RTN","XPDIJ",89,0)
 ;
"RTN","XPDIJ",90,0)
VOLERR(V,F) ;volume set not updated,V=volume set, F=flag
"RTN","XPDIJ",91,0)
 N XQA,XQAMSG,XPDMES
"RTN","XPDIJ",92,0)
 S XPDMES(1)=" ",XPDMES(2)=" ** Job on VOLUME SET "_V_$S(F:" never started **",1:" has been idle for an hour.")
"RTN","XPDIJ",93,0)
 S XPDMES(3)=" ** "_V_" has NOT been updated! **"
"RTN","XPDIJ",94,0)
 S XQA(DUZ)="",XQAMSG="VOLUME SET "_V_" NOT updated for Install "_$E($P($G(^XPD(9.7,+$G(XPDA),0)),"^"),1,30)
"RTN","XPDIJ",95,0)
 D MES^XPDUTL(.XPDMES),SETUP^XQALERT
"RTN","XPDIJ",96,0)
 Q
"RTN","XPDIJ",97,0)
 ;come here on error, record error in Install file and cleanup var.
"RTN","XPDIJ",98,0)
ERR N XPDERROR,XQA,XQAMSG
"RTN","XPDIJ",99,0)
 S XPDERROR=$$EC^%ZOSV
"RTN","XPDIJ",100,0)
 ;record error, write message, reset terminal
"RTN","XPDIJ",101,0)
 D ^%ZTER,BMES^XPDUTL(XPDERROR),EXIT^XPDID()
"RTN","XPDIJ",102,0)
 S XQA(DUZ)="",XQAMSG="Install "_$E($P($G(^XPD(9.7,+$G(XPDA),0)),"^"),1,30)_" has encountered an Error."
"RTN","XPDIJ",103,0)
 D SETUP^XQALERT G UNWIND^%ZTER
"RTN","XPDIJ",104,0)
 ;
"RTN","XPDIJ",105,0)
LNRF(RN) ;Load needed routines first
"RTN","XPDIJ",106,0)
 I $D(^XTMP("XPDI",XPDA,"RTN",RN)) D
"RTN","XPDIJ",107,0)
 .N DIE,XCM,XCN,XCS,X
"RTN","XPDIJ",108,0)
 .S DIE="^XTMP(""XPDI"",XPDA,""RTN"",RN,",XCN=0,X=RN
"RTN","XPDIJ",109,0)
 .X ^%ZOSF("SAVE")
"RTN","XPDIJ",110,0)
 .S XCN=$$RTNUP^XPDUTL(RN,2)
"RTN","XPDIJ",111,0)
 Q
"RTN","XPDIL1")
0^11^B35935554
"RTN","XPDIL1",1,0)
XPDIL1 ;SFISC/RSD - cont. of load Distribution Global ;11/14/2002  07:35
"RTN","XPDIL1",2,0)
 ;;8.0;KERNEL;**15,17,39,41,44,66,68,76,85,100,108,229**;Jul 10, 1995
"RTN","XPDIL1",3,0)
 ;
"RTN","XPDIL1",4,0)
PKG(XPDA) ;check Package file
"RTN","XPDIL1",5,0)
 N XPD,XPDCP,XPDNM,XPDNOQUE,XPDPKG,X,Y,%
"RTN","XPDIL1",6,0)
 S XPDNM=$P(XPDT(XPDIT),U,2) W !?3,XPDNM
"RTN","XPDIL1",7,0)
 ;check KIDS version against sites version, skip if package is Kernel
"RTN","XPDIL1",8,0)
 I $$PKG^XPDUTL(XPDNM)'["KERNEL" D  I $D(XPDQUIT) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",9,0)
 .;this is part of a Kernel multi package
"RTN","XPDIL1",10,0)
 .Q:$O(XPDT("NM","KERNEL"))["KERNEL"
"RTN","XPDIL1",11,0)
 .S Y=$G(^XTMP("XPDI",XPDA,"VER"))
"RTN","XPDIL1",12,0)
 .I $$VERSION^XPDUTL("XU")<Y W !!,"But I need Version ",+Y," of KERNEL!"  S XPDQUIT=1
"RTN","XPDIL1",13,0)
 .I $$VERSION^XPDUTL("VA FILEMAN")<$P(Y,U,2) W !,"But I Need Version ",+$P(Y,U,2)," of VA FILEMAN!" S XPDQUIT=1
"RTN","XPDIL1",14,0)
 ;get national package name
"RTN","XPDIL1",15,0)
 S %=$O(^XTMP("XPDI",XPDA,"PKG",0)),XPDPKG(0)=$G(^(+%,0)),XPDPKG=%
"RTN","XPDIL1",16,0)
 ;XPDPKG=new ien^old ien
"RTN","XPDIL1",17,0)
 I XPDPKG D  S XPDPKG=+Y_U_XPDPKG
"RTN","XPDIL1",18,0)
 .N D,DIC
"RTN","XPDIL1",19,0)
 .S DIC="^DIC(9.4,",DIC(0)="X",X=$P(XPDPKG(0),U)
"RTN","XPDIL1",20,0)
 .D ^DIC Q:Y>0
"RTN","XPDIL1",21,0)
 .;if lookup fails try Prefix, C x-ref
"RTN","XPDIL1",22,0)
 .S X=$P(XPDPKG(0),U,2),D="C" D IX^DIC
"RTN","XPDIL1",23,0)
 ;add package to Install file
"RTN","XPDIL1",24,0)
 I XPDPKG>0 S XPD(9.7,XPDA_",",1)=+XPDPKG D FILE^DIE("","XPD")
"RTN","XPDIL1",25,0)
 ;XPDSKPE= does site want to run Environ. Check
"RTN","XPDIL1",26,0)
 I '$G(XPDSKPE) Q:$$ENV(0)=1
"RTN","XPDIL1",27,0)
 ;global package can't have pre or post inits
"RTN","XPDIL1",28,0)
 Q:$D(XPDGP)
"RTN","XPDIL1",29,0)
 ;create pre-init checkpoint
"RTN","XPDIL1",30,0)
 S XPDCP="INI" I '$$NEWCP^XPDUTL("XPD PREINSTALL COMPLETED") D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",31,0)
 S %=$$INRTN("INI")
"RTN","XPDIL1",32,0)
 ;check for routine, use as call back
"RTN","XPDIL1",33,0)
 I $L(%),'$$NEWCP^XPDUTL("XPD PREINSTALL STARTED",%) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",34,0)
 ;create post-init checkpoint
"RTN","XPDIL1",35,0)
 S XPDCP="INIT" I '$$NEWCP^XPDUTL("XPD POSTINSTALL COMPLETED") D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",36,0)
 S %=$$INRTN("INIT")
"RTN","XPDIL1",37,0)
 I $L(%),'$$NEWCP^XPDUTL("XPD POSTINSTALL STARTED",%) D ABORT^XPDI(XPDA,1) Q
"RTN","XPDIL1",38,0)
 ;create fileman and components check points and file rest of data
"RTN","XPDIL1",39,0)
 D XPCK^XPDIK("FIA"),XPCK^XPDIK("KRN")
"RTN","XPDIL1",40,0)
 Q
"RTN","XPDIL1",41,0)
INST(XPDNM) ;add to Install file
"RTN","XPDIL1",42,0)
 N %X,DIC,DIR,DIRUT,DLAYGO,X,XPD,XPDA,XPDIE,XPDDIQ,Y,SH
"RTN","XPDIL1",43,0)
 ;check if Build was already installed
"RTN","XPDIL1",44,0)
 ;XPD=0 abort install, else XPD=ien in Install file
"RTN","XPDIL1",45,0)
 I $D(^XPD(9.7,"B",XPDNM)) S (SH,Y)=0 D  Q:$D(XPD) XPD
"RTN","XPDIL1",46,0)
 . W !,"Build ",XPDNM," has been loaded before, here is when: "
"RTN","XPDIL1",47,0)
 . F  S Y=$O(^XPD(9.7,"B",XPDNM,Y)) Q:'Y  D
"RTN","XPDIL1",48,0)
 .. Q:'$D(^XPD(9.7,Y,0))  S %=^(0)
"RTN","XPDIL1",49,0)
 .. W !?6,$P(%,U),"   "
"RTN","XPDIL1",50,0)
 .. I $P(%,U,9)<3,$D(^XTMP("XPDI",Y)) W "**Transport Global already exists**",*7 S XPD=0 Q
"RTN","XPDIL1",51,0)
 .. S %X=$X W $$EXTERNAL^DILFD(9.7,.02,"",$P(%,U,9)),!?%X,"was loaded on ",$$FMTE^XLFDT($P($G(^XPD(9.7,Y,1)),U))
"RTN","XPDIL1",52,0)
 . ;quit if transport global exist
"RTN","XPDIL1",53,0)
 . Q:$D(XPD)
"RTN","XPDIL1",54,0)
 . S DIR(0)="Y",DIR("A")="OK to continue with Load",DIR("B")="NO"
"RTN","XPDIL1",55,0)
 . D ^DIR W ! I $D(DIRUT)!'Y S XPD=0 Q
"RTN","XPDIL1",56,0)
 S DIC="^XPD(9.7,",DIC(0)="XL",DLAYGO=9.7,X=""""_XPDNM_""""
"RTN","XPDIL1",57,0)
 ;add to Install file, must be new
"RTN","XPDIL1",58,0)
 D ^DIC
"RTN","XPDIL1",59,0)
 I Y<0 S SH=0 W !,"Can't add Build ",XPDNM," to Install File" Q 0
"RTN","XPDIL1",60,0)
 ;set starting package to Y, if it is not already defined
"RTN","XPDIL1",61,0)
 S:'XPDST XPDST=+Y
"RTN","XPDIL1",62,0)
 ;XPDT array keeps track of all packages in this distribution
"RTN","XPDIL1",63,0)
 S XPDA=+Y,XPDT(XPDIT)=XPDA_U_XPDNM,(XPDT("DA",XPDA),XPDT("NM",XPDNM))=XPDIT
"RTN","XPDIL1",64,0)
 S %="XPDIE(9.7,"""_XPDA_","")",@%@(.02)=0,@%@(2)=$$NOW^XLFDT,@%@(3)=XPDST,@%@(4)=XPDIT,@%@(5)="",@%@(6)=XPDST("H1")
"RTN","XPDIL1",65,0)
 D FILE^DIE("","XPDIE")
"RTN","XPDIL1",66,0)
 I '$D(SH) W !?3,XPDNM ;SH is set when some other part of INST shows the name
"RTN","XPDIL1",67,0)
 Q XPDA
"RTN","XPDIL1",68,0)
 ;
"RTN","XPDIL1",69,0)
 ;XPDQUIT quit current package install, 1=kill global, 2=leave global
"RTN","XPDIL1",70,0)
 ;XPDQUIT(package) quit package install, 1=kill, 2=leave
"RTN","XPDIL1",71,0)
 ;XPDABORT quit the entire distribution, 1=kill, 2=leave
"RTN","XPDIL1",72,0)
 ;XPDENV 0=loading distribution, 1=installing
"RTN","XPDIL1",73,0)
ENV(XPDENV) ;enviroment check & version check
"RTN","XPDIL1",74,0)
 ;returns 0=ok, 1=rejected kill global, 2=rejected leave global
"RTN","XPDIL1",75,0)
 N %,DIR,XPDI,XPDQUIT,XPDABORT,XPDDONE,XPDGREF,XPDMBREQ
"RTN","XPDIL1",76,0)
 M X=DUZ N DUZ M DUZ=X S DUZ(0)="@" ;See that ENV check has full FM priv.
"RTN","XPDIL1",77,0)
 S XPDGREF="^XTMP(""XPDI"","_XPDA_",""TEMP"")"
"RTN","XPDIL1",78,0)
 S XPDMBREQ=$G(^XTMP("XPDI",XPDA,"MBREQ"))
"RTN","XPDIL1",79,0)
 S $P(^XPD(9.7,XPDA,0),U,7)=XPDMBREQ
"RTN","XPDIL1",80,0)
 ;check version number
"RTN","XPDIL1",81,0)
 I XPDPKG>0 D  I $G(XPDQUIT) D ABORT^XPDI(XPDA,1) Q 1
"RTN","XPDIL1",82,0)
 .N DIR,DIRUT,X,Y
"RTN","XPDIL1",83,0)
 .S %=+$$VER^XPDUTL(XPDNM),Y=+$G(^DIC(9.4,+XPDPKG,"VERSION")),X=XPDNM["*"
"RTN","XPDIL1",84,0)
 .;if patch, version must be the same
"RTN","XPDIL1",85,0)
 .I X,%'=Y W !,"This Patch is for Version ",%,", you are running Version ",Y,! S XPDQUIT=1
"RTN","XPDIL1",86,0)
 .;if package, version must be greater or equal
"RTN","XPDIL1",87,0)
 .I 'X,%<Y W !,"You have a Version greater than mine!",! S XPDQUIT=1
"RTN","XPDIL1",88,0)
 .Q:'$G(XPDQUIT)
"RTN","XPDIL1",89,0)
 .I $G(XPDMBREQ) D  S XPDQUIT=0,XPDDONE=1 Q
"RTN","XPDIL1",90,0)
 . . D MES^XPDUTL("**ABORT** Required Build "_XPDNM_", did not pass internal KIDS checks!"),ABRTALL^XPDI(1),NONE^XPDI
"RTN","XPDIL1",91,0)
 . . Q
"RTN","XPDIL1",92,0)
 .S DIR(0)="Y",DIR("A")="Want to continue installing this build",DIR("B")="NO"
"RTN","XPDIL1",93,0)
 .D ^DIR I Y K XPDQUIT
"RTN","XPDIL1",94,0)
 .Q
"RTN","XPDIL1",95,0)
 Q:$G(XPDDONE) 1
"RTN","XPDIL1",96,0)
 S %=$$REQB I % S (XPDABORT,XPDREQAB)=% G ABORT
"RTN","XPDIL1",97,0)
 S %=$G(^XTMP("XPDI",XPDA,"PRE")) D:%]""
"RTN","XPDIL1",98,0)
 .W !,"Will first run the Environment Check Routine, ",%,!
"RTN","XPDIL1",99,0)
 .D SAVE^XPDIJ(%),@("^"_%)
"RTN","XPDIL1",100,0)
ABORT I $G(XPDABORT) D  Q XPDABORT
"RTN","XPDIL1",101,0)
 .;if during load & leave global quit
"RTN","XPDIL1",102,0)
 .I 'XPDENV,XPDABORT=2 Q
"RTN","XPDIL1",103,0)
 .D ABRTALL^XPDI(XPDABORT)
"RTN","XPDIL1",104,0)
 Q:'$D(XPDQUIT) 0
"RTN","XPDIL1",105,0)
 I $G(XPDQUIT) D ABORT^XPDI(XPDA,XPDQUIT)
"RTN","XPDIL1",106,0)
 S XPDI=""
"RTN","XPDIL1",107,0)
 ;don't do if loading & leave global, need to keep XPDT(array)
"RTN","XPDIL1",108,0)
 F  S XPDI=$O(XPDQUIT(XPDI)) Q:XPDI=""  D:'(XPDQUIT(XPDI)=2&'XPDENV)
"RTN","XPDIL1",109,0)
 .S %=$G(XPDT("NM",XPDI)) D:% ABORT^XPDI(+XPDT(%),XPDQUIT(XPDI))
"RTN","XPDIL1",110,0)
 S XPDQUIT=$S($G(XPDQUIT):XPDQUIT,'$O(XPDT(0))!'$D(^XTMP("XPDI",XPDA)):1,1:0)
"RTN","XPDIL1",111,0)
 Q XPDQUIT
"RTN","XPDIL1",112,0)
 ;
"RTN","XPDIL1",113,0)
REQB() ;check for Required Builds
"RTN","XPDIL1",114,0)
 ;returns 0=ok, 1=failed kill global, 2=failed leave global
"RTN","XPDIL1",115,0)
 N XPDACT,XPDBLD,XPDI,XPDQ,XPDQUIT,XPDX,XPDX0,X,Y
"RTN","XPDIL1",116,0)
 S XPDBLD=$O(^XTMP("XPDI",XPDA,"BLD",0)),XPDQUIT=0,XPDI=0
"RTN","XPDIL1",117,0)
 Q:'$D(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"REQB")) 0
"RTN","XPDIL1",118,0)
 F  S XPDI=$O(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"REQB",XPDI)) Q:'XPDI  S XPDX0=^(XPDI,0) D
"RTN","XPDIL1",119,0)
 .S XPDQ=0,XPDX=$P(XPDX0,U),XPDACT=$P(XPDX0,U,2),X=$$PKG^XPDUTL(XPDX),Y=$$VER^XPDUTL(XPDX),Z=$$VERSION^XPDUTL(X)
"RTN","XPDIL1",120,0)
 .;quit if current version is greater than what we are checking for
"RTN","XPDIL1",121,0)
 .Q:Z>Y
"RTN","XPDIL1",122,0)
 .I XPDX'["*" S:Z<Y XPDQ=2
"RTN","XPDIL1",123,0)
 .E  S:'$$PATCH^XPDUTL(XPDX) XPDQ=1
"RTN","XPDIL1",124,0)
 .;quit if patch is already on system
"RTN","XPDIL1",125,0)
 .Q:'XPDQ
"RTN","XPDIL1",126,0)
 .;quit if patch is sequenced prior within this build 
"RTN","XPDIL1",127,0)
 .I $D(XPDT("NM",XPDX)),(XPDT("NM",XPDX)<XPDT("NM",XPDNM)) S XPDQ=0 Q
"RTN","XPDIL1",128,0)
 .S XPDQUIT=$S(XPDACT>XPDQUIT:XPDACT,1:XPDQUIT)
"RTN","XPDIL1",129,0)
 .;XPDACT=0 warning, =1 abort & kill global, =2 abort
"RTN","XPDIL1",130,0)
 .W !!,$S(XPDACT:"**INSTALL ABORTED**",1:"**WARNING**")_$S(XPDQ=1:" Patch ",1:" Package ")_XPDX_" is Required "_$S(XPDACT:"to install",1:"for")_" this package!!",!
"RTN","XPDIL1",131,0)
 Q:'XPDQUIT 0
"RTN","XPDIL1",132,0)
 ;don't do if leave global and loading
"RTN","XPDIL1",133,0)
 D:'(XPDQUIT=2&'XPDENV) ABORT^XPDI(XPDA,XPDQUIT)
"RTN","XPDIL1",134,0)
 Q XPDQUIT
"RTN","XPDIL1",135,0)
 ;
"RTN","XPDIL1",136,0)
 ;return a routine that can be run
"RTN","XPDIL1",137,0)
INRTN(X) N Y
"RTN","XPDIL1",138,0)
 S Y=$G(^XTMP("XPDI",XPDA,X)) Q:Y="" ""
"RTN","XPDIL1",139,0)
 S Y=$S(Y["^":Y,1:"^"_Y)
"RTN","XPDIL1",140,0)
 Q Y
"RTN","XPDIP")
0^8^B38004820
"RTN","XPDIP",1,0)
XPDIP ;SFISC/RSD - Install Package & Routine file ;12/17/2002  11:30
"RTN","XPDIP",2,0)
 ;;8.0;KERNEL;**15,21,28,30,41,44,51,58,83,92,100,108,137,229**;Jul 10, 1995
"RTN","XPDIP",3,0)
 Q
"RTN","XPDIP",4,0)
PKG ;
"RTN","XPDIP",5,0)
 N %,OLDA,DA,DIK,XPD,XPDFIL,XPDPKG,XPDBLDA,Y
"RTN","XPDIP",6,0)
 ;update variable for graphic display
"RTN","XPDIP",7,0)
 I $D(XPDIDVT) S XPDIDTOT=10,XPDIDMOD=1,XPDIDCNT=0 D:XPDIDVT UPDATE^XPDID(0)
"RTN","XPDIP",8,0)
 ;XPDPKG=ien of Package file, OLDA=old Package ien
"RTN","XPDIP",9,0)
 S Y=$$PKGADD,XPDPKG=$P(Y,U),OLDA=$P(Y,U,2)
"RTN","XPDIP",10,0)
 ;Package file entry not sent, XPDPKG=0
"RTN","XPDIP",11,0)
 G:'XPDPKG PKGEND
"RTN","XPDIP",12,0)
 ;update version multiple
"RTN","XPDIP",13,0)
 S DA=XPDPKG D PKGV
"RTN","XPDIP",14,0)
PKGH I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",15,0)
 S %=$P(^DIC(9.4,XPDPKG,0),U,4)
"RTN","XPDIP",16,0)
 ;repoint Help Frame (0;4)
"RTN","XPDIP",17,0)
 I $L(%),'% S $P(^DIC(9.4,XPDPKG,0),U,4)=$$LK^XPDIA("^DIC(9.2)",%),DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",18,0)
 ;update node 20 for Patient Merge
"RTN","XPDIP",19,0)
 N REC,IEN
"RTN","XPDIP",20,0)
 S REC=0
"RTN","XPDIP",21,0)
 F  S REC=$O(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC)) Q:'REC  D
"RTN","XPDIP",22,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",.01)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,1)
"RTN","XPDIP",23,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",3)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,3)
"RTN","XPDIP",24,0)
 .S IEN(9.402,"?+1,"_XPDPKG_",",4)=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,1))
"RTN","XPDIP",25,0)
 .D UPDATE^DIE("","IEN")
"RTN","XPDIP",26,0)
 .Q
"RTN","XPDIP",27,0)
 ;
"RTN","XPDIP",28,0)
PKGEND S XPDBLDA=$$BLD(XPDBLD) Q:'XPDBLDA
"RTN","XPDIP",29,0)
 ;move Alpha/Beta testing info to Kernel site para file
"RTN","XPDIP",30,0)
 I XPDPKG S %=$G(^XPD(9.6,XPDBLDA,"ABPKG")) D
"RTN","XPDIP",31,0)
 .;Install message and they have an address, set flag in XPDIST
"RTN","XPDIP",32,0)
 .I $P(%,U)="y",$P(%,U,2)="y",$L($P(%,U,3)) S $P(XPDIST,U,2)=$P(%,U,3)
"RTN","XPDIP",33,0)
 .D EN^XQABLOAD(XPDBLDA)
"RTN","XPDIP",34,0)
 Q
"RTN","XPDIP",35,0)
PKGADD() ;check Package file, add if not there
"RTN","XPDIP",36,0)
 ;return new Package file ien^old ien
"RTN","XPDIP",37,0)
 N DA,DIK,XPD,XPDFIL,XPDO,X,Y
"RTN","XPDIP",38,0)
 S DA=+$P(^XPD(9.7,XPDA,0),U,2),XPDO=+$O(^XTMP("XPDI",XPDA,"PKG",0)),X=$P($G(^(XPDO,0)),U)
"RTN","XPDIP",39,0)
 I DA,$D(^DIC(9.4,DA,0)) Q DA_U_XPDO
"RTN","XPDIP",40,0)
 ;quit if there was no package entry sent
"RTN","XPDIP",41,0)
 Q:'XPDO "0^0"
"RTN","XPDIP",42,0)
 S XPDFIL=9.4,Y=$$DIC^XPDIK(9.4,X) Q:'Y "0^0"
"RTN","XPDIP",43,0)
 S DA=+Y
"RTN","XPDIP",44,0)
 ;if new entry in package file, bring in everything
"RTN","XPDIP",45,0)
 I $P(Y,U,3) D
"RTN","XPDIP",46,0)
 .M ^DIC(9.4,DA)=^XTMP("XPDI",XPDA,"PKG",XPDO)
"RTN","XPDIP",47,0)
 .;kill the -1 flag node first
"RTN","XPDIP",48,0)
 .K ^DIC(9.4,DA,-1)
"RTN","XPDIP",49,0)
 .;re-cross ref after adding a new package
"RTN","XPDIP",50,0)
 .S DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",51,0)
 ;add package to file 9.7
"RTN","XPDIP",52,0)
 S XPD(9.7,XPDA_",",1)=DA D FILE^DIE("","XPD")
"RTN","XPDIP",53,0)
 Q DA_U_XPDO
"RTN","XPDIP",54,0)
 ;
"RTN","XPDIP",55,0)
BLD(XPDBLD) ;add Build entry, XPDBLD=Build ien in ^XTMP("XPDI",XPDA,"BLD",
"RTN","XPDIP",56,0)
 N %,DA,DIK,XPDFIL,Y
"RTN","XPDIP",57,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",58,0)
 ;XPDBLD=Build ien in ^XTMP, set in XPDIJ
"RTN","XPDIP",59,0)
 S XPDFIL=9.6,Y=$$DIC^XPDIK(9.6,XPDNM) Q:'Y ""
"RTN","XPDIP",60,0)
 S DA=+Y
"RTN","XPDIP",61,0)
 ;Build entry not new, remove old data
"RTN","XPDIP",62,0)
 I '$P(Y,U,3) S %=$P(^XPD(9.6,DA,0),U,2) K ^XPD(9.6,DA) K:% ^XPD(9.6,"C",%,DA)
"RTN","XPDIP",63,0)
 M ^XPD(9.6,DA)=^XTMP("XPDI",XPDA,"BLD",XPDBLD)
"RTN","XPDIP",64,0)
 ;reset Package File Link (0;2)
"RTN","XPDIP",65,0)
 ;XPDIST = national site tracking^A/B install message address
"RTN","XPDIP",66,0)
 S $P(^XPD(9.6,DA,0),U,2)=$S(XPDPKG:XPDPKG,1:"") S:$P(^(0),U,5)="y" XPDIST=1
"RTN","XPDIP",67,0)
 ;re-index cross-ref. on fields .01 and 1
"RTN","XPDIP",68,0)
 S DIK="^XPD(9.6," F Y=.01,1 S DIK(1)=Y D EN1^DIK
"RTN","XPDIP",69,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",70,0)
 Q DA
"RTN","XPDIP",71,0)
 ;
"RTN","XPDIP",72,0)
 ;update the version multiple in the package file
"RTN","XPDIP",73,0)
PKGV N %
"RTN","XPDIP",74,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",75,0)
 ;%=ien in the Version multiple_U_ien in Patch multiple in ^XTMP
"RTN","XPDIP",76,0)
 S %=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,-1))
"RTN","XPDIP",77,0)
 I XPDNM'["*" D  Q
"RTN","XPDIP",78,0)
 .S %=+% Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,%,0))  S %=^(0) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",79,0)
 .S $P(%,U,3,4)=DT_U_DUZ,%=$$PKGVER(DA,.%)
"RTN","XPDIP",80,0)
 ;update patch history multiple
"RTN","XPDIP",81,0)
 Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,+%,"PAH",+$P(%,U,2),0))  S %=$P(^(0),U) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",82,0)
 ;check File Comment, %=patch number
"RTN","XPDIP",83,0)
 S:^XPD(9.7,XPDA,2)[" SEQ #" %=$P(^(2),"*",3)
"RTN","XPDIP",84,0)
 S $P(%,U,2,3)=DT_U_DUZ,%=$$PKGPAT(DA,$$VER^XPDUTL(XPDNM),.%)
"RTN","XPDIP",85,0)
 Q
"RTN","XPDIP",86,0)
 ;
"RTN","XPDIP",87,0)
PKGVER(XPDPDA,XPDI) ;update version in package file, XPDPDA=Package file ien, return ien
"RTN","XPDIP",88,0)
 ;XPDI=version^date distr.^date installed^install by
"RTN","XPDIP",89,0)
 ;XPDI(1)=root of description field
"RTN","XPDIP",90,0)
 N I,X,XPD,XPDIEN,XPDJ,XPDV
"RTN","XPDIP",91,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,$P(XPDI,U)) Q:'XPDV 0
"RTN","XPDIP",92,0)
 S XPD(9.4,XPDPDA_",",13)=$P(XPDI,U),X="XPD(9.49,"""_XPDV_XPDIEN_""")"
"RTN","XPDIP",93,0)
 F I=1:1:3 S:$P(XPDI,U,I+1)]"" @X@(I)=$P(XPDI,U,I+1)
"RTN","XPDIP",94,0)
 S:$D(XPDI(1)) @X@(41)=XPDI(1)
"RTN","XPDIP",95,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",96,0)
 Q XPDV
"RTN","XPDIP",97,0)
 ;
"RTN","XPDIP",98,0)
PKGPAT(XPDPDA,XPDV,XPDI) ;update patch history
"RTN","XPDIP",99,0)
 ;INPUT: XPDPDA=Package file ien, XPDV=version
"RTN","XPDIP",100,0)
 ;XPDI=patch^date installed^install by,   returns version ien^patch ien
"RTN","XPDIP",101,0)
 N I,X,XPD,XPDP,XPDIEN
"RTN","XPDIP",102,0)
 ;quit if we can't find the version multiple, resets XPDV=ien of version
"RTN","XPDIP",103,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,XPDV) Q:'XPDV 0
"RTN","XPDIP",104,0)
 S XPDIEN=","_XPDV_XPDIEN,XPDP=$$MDIC(9.4901,XPDIEN,$P(XPDI,U)) Q:'XPDP 0
"RTN","XPDIP",105,0)
 S X="XPD(9.4901,"""_XPDP_XPDIEN_""")"
"RTN","XPDIP",106,0)
 F I=.02,.03 S:$P(XPDI,U,I*100)]"" @X@(I)=$P(XPDI,U,I*100)
"RTN","XPDIP",107,0)
 S:$D(XPDI(1)) @X@(1)=XPDI(1)
"RTN","XPDIP",108,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",109,0)
 Q XPDV_U_XPDP
"RTN","XPDIP",110,0)
 ;
"RTN","XPDIP",111,0)
 ;XPDF=subfile #,XPDIEN=ien string, X=input
"RTN","XPDIP",112,0)
MDIC(XPDF,XPDIEN,XPDX) ;
"RTN","XPDIP",113,0)
 N DIERR,XPD,XPDN
"RTN","XPDIP",114,0)
 D FIND^DIC(XPDF,XPDIEN,"","XQf",XPDX,5,"","","","XPD")
"RTN","XPDIP",115,0)
 ;one or more matches, just return first one
"RTN","XPDIP",116,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIP",117,0)
 .N %
"RTN","XPDIP",118,0)
 .S %(1)=$P(^DD(XPDF,.01,0),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIP",119,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIP",120,0)
 ;add a new entry
"RTN","XPDIP",121,0)
 S XPDN(XPDF,"+1"_XPDIEN,.01)=XPDX K XPD
"RTN","XPDIP",122,0)
 D UPDATE^DIE("","XPDN","XPD")
"RTN","XPDIP",123,0)
 I '$G(XPD(1)) D BMES^XPDUTL(" "_$P(^DD(XPDF,.01,0),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIP",124,0)
 Q XPD(1)
"RTN","XPDIP",125,0)
 ;
"RTN","XPDIP",126,0)
RTN ;move rtns to install file
"RTN","XPDIP",127,0)
 N XPD,XPDC,XPDCR,XPDI,XPDJ,XPDK,XPDL,XPDM,XPDR,XPDRH,X,NOW
"RTN","XPDIP",128,0)
 K ^XPD(9.7,XPDA,"RTN"),^TMP($J)
"RTN","XPDIP",129,0)
 S (XPDC,XPDCR,XPDRH)=0,XPDJ="",NOW=$$NOW^XLFDT()
"RTN","XPDIP",130,0)
 ;get all routines that were loaded, XPDM=action
"RTN","XPDIP",131,0)
 ;actions are 0=load, 1=delete, 2=skip
"RTN","XPDIP",132,0)
 F  S XPDJ=$O(^XTMP("XPDI",XPDA,"RTN",XPDJ)) Q:XPDJ=""  S XPDM=^(XPDJ) D:'XPDM
"RTN","XPDIP",133,0)
 .;XPD, build array to update ROUTINE multiple in INSTALL file
"RTN","XPDIP",134,0)
 .S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",135,0)
 .;XPDR, build array to update ROUTINE file, Set install date
"RTN","XPDIP",136,0)
 .;S:'$D(^DIC(9.8,"B",XPDJ)) XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R"
"RTN","XPDIP",137,0)
 .S XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R",^(7.4)=NOW ;**229
"RTN","XPDIP",138,0)
 ;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",139,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDTOT*.4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",140,0)
 F XPDK="DIKZ","DIEZ","DIPZ" D
"RTN","XPDIP",141,0)
 .S XPDI=0
"RTN","XPDIP",142,0)
 .;loop thru list of compile template routines
"RTN","XPDIP",143,0)
 .;XTMP("XPDI",XPDA,"DIKZ",ien,routine name)
"RTN","XPDIP",144,0)
 .F  S XPDI=$O(^XTMP("XPDI",XPDA,XPDK,XPDI)),XPDJ="" Q:'XPDI  D
"RTN","XPDIP",145,0)
 ..I 'XPDRH D BMES^XPDUTL(" The following Routines were created during this install:") S XPDRH=1
"RTN","XPDIP",146,0)
 ..F  S XPDJ=$O(^XTMP("XPDI",XPDA,XPDK,XPDI,XPDJ)) Q:XPDJ=""  D:'$D(^XTMP("XPDI",XPDA,"RTN",XPDJ))
"RTN","XPDIP",147,0)
 ...S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",148,0)
 ...D MES^XPDUTL("     "_XPDJ)
"RTN","XPDIP",149,0)
 ;update routine multiple in Install file with routines and
"RTN","XPDIP",150,0)
 ;compile template routines
"RTN","XPDIP",151,0)
 I $D(^TMP($J,"XPD"))>9 D
"RTN","XPDIP",152,0)
 .D UPDATE^DIE("","^TMP($J,""XPD"")","^TMP($J,""XPDL"")")
"RTN","XPDIP",153,0)
 .;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",154,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+(XPDIDTOT*.40) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",155,0)
 ;update Routine file
"RTN","XPDIP",156,0)
 D:$D(^TMP($J,"XPDR"))>9 UPDATE^DIE("","^TMP($J,""XPDR"")")
"RTN","XPDIP",157,0)
 ;if we are doing VT graphic display, update 100%
"RTN","XPDIP",158,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",159,0)
 Q
"RTN","XPDTA")
0^7^B26161584
"RTN","XPDTA",1,0)
XPDTA ;SFISC/RSD - Build Actions for Kernel Files ;12/23/2002  09:28
"RTN","XPDTA",2,0)
 ;;8.0;KERNEL;**15,44,58,131,229**;Jul 10, 1995
"RTN","XPDTA",3,0)
 Q
"RTN","XPDTA",4,0)
 ;^XTMP("XPDT",XPDA,"KRN",FILE,DA) is the global root
"RTN","XPDTA",5,0)
 ;DA=ien in ^XTMP,XPDNM=package name, XPDA=package ien in ^XPD(9.6,
"RTN","XPDTA",6,0)
OPT ;options
"RTN","XPDTA",7,0)
 N %,%1,%2
"RTN","XPDTA",8,0)
 ;if link, kill everything and just process the menu items
"RTN","XPDTA",9,0)
 I XPDFL=2 D  G OPTT
"RTN","XPDTA",10,0)
 .S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",19,DA,%)) Q:'%  K:%'=10 ^(%)
"RTN","XPDTA",11,0)
 ;resolve Package (0;12), remove Creator (0;5)
"RTN","XPDTA",12,0)
 S %=^XTMP("XPDT",XPDA,"KRN",19,DA,0),$P(%,U,12)=$$PT("^DIC(9.4)",$P(%,U,12)),$P(%,U,5)=""
"RTN","XPDTA",13,0)
 ;resolve Help Frame (0;7), kill Permitted Devices (3.96;0) & queue node (200)
"RTN","XPDTA",14,0)
 S $P(%,U,7)=$$PT("^DIC(9.2)",$P(%,U,7)),^XTMP("XPDT",XPDA,"KRN",19,DA,0)=% K ^(3.96),^(200)
"RTN","XPDTA",15,0)
 ;resolve Server Bulletin (220;1), Server Mailgroup (220;3)
"RTN","XPDTA",16,0)
 I $D(^XTMP("XPDT",XPDA,"KRN",19,DA,220)) S %=^(220),$P(%,U)=$$PT("^XMB(3.6)",+%),$P(%,U,3)=$$PT("^XMB(3.8)",$P(%,U,3)),^XTMP("XPDT",XPDA,"KRN",19,DA,220)=%
"RTN","XPDTA",17,0)
 ;resolve RPC (RPC;0), must be type Broker
"RTN","XPDTA",18,0)
 I $D(^XTMP("XPDT",XPDA,"KRN",19,DA,"RPC")) K:$P(^(0),U,4)'="B" ^("RPC") D
"RTN","XPDTA",19,0)
 .;kill  "B"=name x-ref, it will be re-indexed when installed
"RTN","XPDTA",20,0)
 .K ^XTMP("XPDT",XPDA,"KRN",19,DA,"RPC","B")
"RTN","XPDTA",21,0)
 .;loop thru RPCs and resolve (RPC;1)
"RTN","XPDTA",22,0)
 .S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",19,DA,"RPC",%)) Q:'%  S %1=$G(^(%,0)) D
"RTN","XPDTA",23,0)
 ..S %2=$$PT("^XWB(8994)",+%1)
"RTN","XPDTA",24,0)
 ..;if can't resolve then delete
"RTN","XPDTA",25,0)
 ..I %2="" K ^XTMP("XPDT",XPDA,"KRN",19,DA,"RPC",%,0) Q
"RTN","XPDTA",26,0)
 ..;save the RPC name
"RTN","XPDTA",27,0)
 ..S $P(^XTMP("XPDT",XPDA,"KRN",19,DA,"RPC",%,0),U)=%2
"RTN","XPDTA",28,0)
 .Q
"RTN","XPDTA",29,0)
OPTT ;Menus can only exist for options of type: menu,protocol,protocol menu,
"RTN","XPDTA",30,0)
 ;extended action, limited, window suite
"RTN","XPDTA",31,0)
 I "LMOQXZ"'[$P(^XTMP("XPDT",XPDA,"KRN",19,DA,0),U,4) K ^(10) Q
"RTN","XPDTA",32,0)
 ;kill  "B"=name, "C"=synonyms x-ref, it will be re-indexed when installed
"RTN","XPDTA",33,0)
 K ^XTMP("XPDT",XPDA,"KRN",19,DA,10,"B"),^("C")
"RTN","XPDTA",34,0)
 ;loop thru 10=Menus and resolve Menu (10;1), kill if it doesn't resolve
"RTN","XPDTA",35,0)
 S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",19,DA,10,%)) Q:'%  S %1=$G(^(%,0)) D
"RTN","XPDTA",36,0)
 .S %2=$$PT("^DIC(19)",+%1)
"RTN","XPDTA",37,0)
 .;items must be sent by themselves, check "B" x-ref
"RTN","XPDTA",38,0)
 .I $L(%2),$D(^XPD(9.6,XPDA,"KRN",19,"NM","B",%2)) S ^XTMP("XPDT",XPDA,"KRN",19,DA,10,%,U)=%2 Q
"RTN","XPDTA",39,0)
 .;if I couldn't resolve this option, then kill it
"RTN","XPDTA",40,0)
 .K ^XTMP("XPDT",XPDA,"KRN",19,DA,10,%)
"RTN","XPDTA",41,0)
 Q
"RTN","XPDTA",42,0)
PRO ;protocols
"RTN","XPDTA",43,0)
 N %,%1,%2
"RTN","XPDTA",44,0)
 ;if link, kill everything and just process the menu items
"RTN","XPDTA",45,0)
 I XPDFL=2 D  G PROT
"RTN","XPDTA",46,0)
 .S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",101,DA,%)) Q:'%  K:%'=10 ^(%)
"RTN","XPDTA",47,0)
 ;resolve Package (0;12), remove Creator (0;5)
"RTN","XPDTA",48,0)
 S %=^XTMP("XPDT",XPDA,"KRN",101,DA,0),$P(%,U,12)=$$PT("^DIC(9.4)",$P(%,U,12)),$P(%,U,5)=""
"RTN","XPDTA",49,0)
 ;kill under Menus (10), "B"=name, "C"=synonyms
"RTN","XPDTA",50,0)
 S ^XTMP("XPDT",XPDA,"KRN",101,DA,0)=%
"RTN","XPDTA",51,0)
 ;resolve File Link (5;1), its a variable pointer
"RTN","XPDTA",52,0)
 S %=$P($G(^XTMP("XPDT",XPDA,"KRN",101,DA,5)),U),%1=$P(%,";",2)
"RTN","XPDTA",53,0)
 I %,$D(@("^"_%1_+%_",0)")) S $P(^XTMP("XPDT",XPDA,"KRN",101,DA,5),U)=$P(^(0),U)_";"_%1
"RTN","XPDTA",54,0)
 ;resolve HL7 fields, node 770
"RTN","XPDTA",55,0)
 S %=$G(^XTMP("XPDT",XPDA,"KRN",101,DA,770)) I $L(%) D  S ^XTMP("XPDT",XPDA,"KRN",101,DA,770)=%
"RTN","XPDTA",56,0)
 .S $P(%,U)=$$PT("^HL(771)",$P(%,U)),$P(%,U,2)=$$PT("^HL(771)",$P(%,U,2))
"RTN","XPDTA",57,0)
 .S $P(%,U,3)=$$PT("^HL(771.2)",$P(%,U,3)),$P(%,U,11)=$$PT("^HL(771.2)",$P(%,U,11))
"RTN","XPDTA",58,0)
 .S $P(%,U,4)=$$PT("^HL(779.001)",$P(%,U,4)),$P(%,U,7)=$$PT("^HLCS(870)",$P(%,U,7))
"RTN","XPDTA",59,0)
 .S $P(%,U,8)=$$PT("^HL(779.003)",$P(%,U,8)),$P(%,U,9)=$$PT("^HL(779.003)",$P(%,U,9))
"RTN","XPDTA",60,0)
 .S $P(%,U,10)=$$PT("^HL(771.5)",$P(%,U,10))
"RTN","XPDTA",61,0)
PROT ;loop thru 10=Menus and resolve Menu (10;1), kill if it doesn't resolve
"RTN","XPDTA",62,0)
 ;kill under Menus (10), "B"=name, "C"=synonyms
"RTN","XPDTA",63,0)
 I $D(^XTMP("XPDT",XPDA,"KRN",101,DA,10,0)) K ^("B"),^("C")
"RTN","XPDTA",64,0)
 S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",101,DA,10,%)) Q:'%  S %1=$G(^(%,0)) D
"RTN","XPDTA",65,0)
 .;%2=.01 of Menu(protocol)
"RTN","XPDTA",66,0)
 .S %2=$$PT("^ORD(101)",+%1)
"RTN","XPDTA",67,0)
 .;Menu must also be sent by itself, check "B" x-ref
"RTN","XPDTA",68,0)
 .I $L(%2),$D(^XPD(9.6,XPDA,"KRN",101,"NM","B",%2)) S ^XTMP("XPDT",XPDA,"KRN",101,DA,10,%,U)=%2,$P(^XTMP("XPDT",XPDA,"KRN",101,DA,10,%,0),U,4)=$$PT("^ORD(101)",$P(%1,U,4)) Q
"RTN","XPDTA",69,0)
 .K ^XTMP("XPDT",XPDA,"KRN",101,DA,10,%)
"RTN","XPDTA",70,0)
 ;If type is Event Driver and sending Subscribers (775)
"RTN","XPDTA",71,0)
 I $P(^XTMP("XPDT",XPDA,"KRN",101,DA,0),U,4)="E" D
"RTN","XPDTA",72,0)
 . ;kill Menu multiple and Subscriber x-ref "B"=name
"RTN","XPDTA",73,0)
 . K ^XTMP("XPDT",XPDA,"KRN",101,DA,10),^(775,"B")
"RTN","XPDTA",74,0)
 . ;loop thru 775=Subscribers and resolve pointer (775;1)
"RTN","XPDTA",75,0)
 . S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",101,DA,775,%)) Q:'%  S %1=$G(^(%,0)) D
"RTN","XPDTA",76,0)
 .. ;%2=.01 of subscriber(protocol)
"RTN","XPDTA",77,0)
 .. S %2=$$PT("^ORD(101)",+%1)
"RTN","XPDTA",78,0)
 .. ;protocol must also be sent by itself, check "B" x-ref
"RTN","XPDTA",79,0)
 .. I $L(%2),$D(^XPD(9.6,XPDA,"KRN",101,"NM","B",%2)) S ^XTMP("XPDT",XPDA,"KRN",101,DA,775,%,U)=%2 Q
"RTN","XPDTA",80,0)
 .. K ^XTMP("XPDT",XPDA,"KRN",101,DA,775,%)
"RTN","XPDTA",81,0)
 ;quit if no Access multiple
"RTN","XPDTA",82,0)
 Q:'$D(^XTMP("XPDT",XPDA,"KRN",101,DA,3,0))  K ^("B")
"RTN","XPDTA",83,0)
 ;loop thru Access and resolve (3;1), kill if it doesn't resolve
"RTN","XPDTA",84,0)
 S %=0 F  S %=$O(^XTMP("XPDT",XPDA,"KRN",101,DA,3,%)) Q:'%  S %1=$G(^(%,0)) D
"RTN","XPDTA",85,0)
 .;%2=.01 of Menu(protocol)
"RTN","XPDTA",86,0)
 .S %2=$$PT("^DIC(19.1)",+%1)
"RTN","XPDTA",87,0)
 .I $L(%2) S ^XTMP("XPDT",XPDA,"KRN",101,DA,3,%,0)=%2 Q
"RTN","XPDTA",88,0)
 .K ^XTMP("XPDT",XPDA,"KRN",101,DA,3,%)
"RTN","XPDTA",89,0)
 Q
"RTN","XPDTA",90,0)
RTNE ;routine entry build action
"RTN","XPDTA",91,0)
 N %,X,XPD
"RTN","XPDTA",92,0)
 ;move routine to ^XTMP("XPDT",DPK1,"RTN",routine name
"RTN","XPDTA",93,0)
 ;routines will have the checksum in XTMP("XPDT",XPDA,"RTN",X) & in
"RTN","XPDTA",94,0)
 ;Build file
"RTN","XPDTA",95,0)
 S X=$P(^XTMP("XPDT",XPDA,"KRN",9.8,DA,0),U),XPD=^(-1)
"RTN","XPDTA",96,0)
 Q:X=""  S %=$$LOAD(X,XPD),$P(^XPD(9.6,XPDA,"KRN",9.8,"NM",+$P(XPD,U,2),0),U,4)=%
"RTN","XPDTA",97,0)
 K ^XTMP("XPDT",XPDA,"KRN",9.8,DA)
"RTN","XPDTA",98,0)
 Q
"RTN","XPDTA",99,0)
RTNF ;routine file build action
"RTN","XPDTA",100,0)
 N X,Y,% S Y=0
"RTN","XPDTA",101,0)
 ;the routines that are left in XTMP("XPDT",XPDA,"KRN",9.8) are to be
"RTN","XPDTA",102,0)
 ;deleted at site, move name field to RTN node
"RTN","XPDTA",103,0)
 F  S Y=$O(^XTMP("XPDT",XPDA,"KRN",9.8,Y)) Q:'Y  S %=^(Y,-1),X=^(0) D
"RTN","XPDTA",104,0)
 .I +%=1 S ^XTMP("XPDT",XPDA,"RTN",X)=%,^("RTN")=$G(^XTMP("XPDT",XPDA,"RTN"))+1
"RTN","XPDTA",105,0)
 ;kill everything
"RTN","XPDTA",106,0)
 K ^XTMP("XPDT",XPDA,"KRN",9.8)
"RTN","XPDTA",107,0)
 Q
"RTN","XPDTA",108,0)
PT(GR,DA) ;GR=file global ref, DA=ien, return .01 value
"RTN","XPDTA",109,0)
 Q:'DA ""
"RTN","XPDTA",110,0)
 I $D(@GR@(+DA,0))#2 Q $P(^(0),U)
"RTN","XPDTA",111,0)
 Q ""
"RTN","XPDTA",112,0)
 ;
"RTN","XPDTA",113,0)
LOAD(X,XPD) ;load routine X, XPD=action^ien in Build file
"RTN","XPDTA",114,0)
 ;XPD = 0-load, 1-delete, 2-skip, returns checksum
"RTN","XPDTA",115,0)
 ;quit if routine is already saved
"RTN","XPDTA",116,0)
 Q:$D(^XTMP("XPDT",XPDA,"RTN",X)) $P(^(X),U,3)
"RTN","XPDTA",117,0)
 N DIF,XCNP,%N,%A,FDA,IEN
"RTN","XPDTA",118,0)
 S DIF="^XTMP(""XPDT"",XPDA,""RTN"",X,",XCNP=0
"RTN","XPDTA",119,0)
 X ^%ZOSF("LOAD")
"RTN","XPDTA",120,0)
 ;^XTMP("XPDT",XPDA,"RTN",X)=action^ien in Build^checksum
"RTN","XPDTA",121,0)
 S %N=$$SUMB^XPDRSUM($NA(^XTMP("XPDT",XPDA,"RTN",X))),^XTMP("XPDT",XPDA,"RTN",X)=XPD_U_"B"_%N
"RTN","XPDTA",122,0)
 ;update count node
"RTN","XPDTA",123,0)
 S ^("RTN")=$G(^XTMP("XPDT",XPDA,"RTN"))+1
"RTN","XPDTA",124,0)
 ;S IEN=$O(^DIC(9.8,"B",X,0))
"RTN","XPDTA",125,0)
 S IEN=$$FIND1^DIC(9.8,"","X",X)
"RTN","XPDTA",126,0)
 I IEN D
"RTN","XPDTA",127,0)
 . S %A=$$SUMA^XPDRSUM($NA(^XTMP("XPDT",XPDA,"RTN",X)))
"RTN","XPDTA",128,0)
 . S IEN="?+2,"_IEN_",",FDA(9.818,IEN,.01)=$P(XPDT(XPDT),U,2)
"RTN","XPDTA",129,0)
 . S FDA(9.818,IEN,2)=%A_"/"_%N
"RTN","XPDTA",130,0)
 . D UPDATE^DIE("","FDA","IEN")
"RTN","XPDTA",131,0)
 Q "B"_%N
"RTN","XPDUTL1")
0^4^B6284187
"RTN","XPDUTL1",1,0)
XPDUTL1 ;SFISC/RWF - KIDS utilities (Delete pointers) ;10/28/2002  09:33
"RTN","XPDUTL1",2,0)
 ;;8.0;KERNEL;**229**;Jul 10,1995
"RTN","XPDUTL1",3,0)
 Q
"RTN","XPDUTL1",4,0)
 ;New with patch 229
"RTN","XPDUTL1",5,0)
 ;DELPTR will go thru all the files that point to a given file and
"RTN","XPDUTL1",6,0)
 ;delete any pointer to a set of deleted entries.
"RTN","XPDUTL1",7,0)
 ;FILE is the file number that the entries are being deleted from.
"RTN","XPDUTL1",8,0)
 ;DELRT is the closed root of an array of IEN values being deleted.
"RTN","XPDUTL1",9,0)
 ;SKIP is an array of files to skip from deleting
"RTN","XPDUTL1",10,0)
DELPTR(FILE,DELRT,SKIP) ;
"RTN","XPDUTL1",11,0)
 N DA,FDA,IENS,PFL,PFE,EXE
"RTN","XPDUTL1",12,0)
 S PFL=0
"RTN","XPDUTL1",13,0)
 F  S PFL=$O(^DD(FILE,0,"PT",PFL)),PFE=0 Q:PFL'>0  D
"RTN","XPDUTL1",14,0)
 . I $D(SKIP(PFL)) Q  ;Skip this File
"RTN","XPDUTL1",15,0)
 . F  S PFE=$O(^DD(FILE,0,"PT",PFL,PFE)) Q:PFE'>0  D
"RTN","XPDUTL1",16,0)
 . . D BUILD(PFL,PFE) Q
"RTN","XPDUTL1",17,0)
 . Q
"RTN","XPDUTL1",18,0)
 Q
"RTN","XPDUTL1",19,0)
 ;
"RTN","XPDUTL1",20,0)
BUILD(FL,FE) ;BUILD and Execute SCAN
"RTN","XPDUTL1",21,0)
 N DIC,CNT,FLD,LV,EX,ND,QUIT
"RTN","XPDUTL1",22,0)
 S LV=0,EX=0,QUIT=0,FLD=$G(^DD(FL,FE,0)) Q:'$L(FLD)
"RTN","XPDUTL1",23,0)
 ;Get the pointing field
"RTN","XPDUTL1",24,0)
 S EX(LV,1)=FLD,FLD(0)=$P(FLD,"^",4),FLD(1)=$P(FLD(0),";"),FLD(2)=$P(FLD(0),";",2)
"RTN","XPDUTL1",25,0)
 S EX(LV,2)=FLD(1) ;Save the node
"RTN","XPDUTL1",26,0)
 ;find the path to this field
"RTN","XPDUTL1",27,0)
 S DIC=$$PATH(LV+1,FL,FE) ;Leave EX as global
"RTN","XPDUTL1",28,0)
 I QUIT Q  ;Couldn't build the path
"RTN","XPDUTL1",29,0)
 ;Build the code to check this pointer value
"RTN","XPDUTL1",30,0)
 S ND=FLD(1)
"RTN","XPDUTL1",31,0)
 S EX(LV)="S X=$P($G("_DIC_"ND)),U,"_FLD(2)_") I $L(X),$D(@DELRT@(X)) S IEN=$$IENS^DILF(.DA),CNT=CNT+1,FDA("_PFL_",IEN,"_PFE_")=""@"" D:CNT>10 FILE^XPDUTL1"
"RTN","XPDUTL1",32,0)
 ;Run the scan
"RTN","XPDUTL1",33,0)
 D SCAN
"RTN","XPDUTL1",34,0)
 Q
"RTN","XPDUTL1",35,0)
 ;
"RTN","XPDUTL1",36,0)
PATH(LV,FL,FE) ;Return path to node
"RTN","XPDUTL1",37,0)
 N DIC,DA,FLD,FL2,FE2
"RTN","XPDUTL1",38,0)
 ;At the root of the file
"RTN","XPDUTL1",39,0)
 S DA=$S(LV>1:"DA("_(LV-1)_")",1:"DA")
"RTN","XPDUTL1",40,0)
 I $D(^DIC(FL,0,"GL")) D  Q DIC_DA_","
"RTN","XPDUTL1",41,0)
 . S DIC=$G(^DIC(FL,0,"GL"))
"RTN","XPDUTL1",42,0)
 . S EX(LV,1)=DIC,EX=LV
"RTN","XPDUTL1",43,0)
 . S EX(LV)="S "_DA_"=0 F  S "_DA_"=$O("_DIC_DA_")) Q:"_DA_"'>0  X EX("_(LV-1)_")"
"RTN","XPDUTL1",44,0)
 . Q
"RTN","XPDUTL1",45,0)
 ;In a sub-file
"RTN","XPDUTL1",46,0)
 S FL2=$G(^DD(FL,0,"UP")) I 'FL2 S QUIT=1 Q ""
"RTN","XPDUTL1",47,0)
 S FE2=$O(^DD(FL2,"SB",FL,0)) I 'FE2 S QUIT=1 Q ""
"RTN","XPDUTL1",48,0)
 S FLD=$G(^DD(FL2,FE2,0)),FLD(0)=$P(FLD,"^",4),FLD(1)=$P(FLD(0),";"),FLD(2)=$P(FLD(0),";",2)
"RTN","XPDUTL1",49,0)
 S ND(LV)=FLD(1) ;Use a variable for nodes
"RTN","XPDUTL1",50,0)
 S DIC=$$PATH(LV+1,FL2,FE2)_"ND("_LV_"),"_DA
"RTN","XPDUTL1",51,0)
 S EX(LV,1)=DIC
"RTN","XPDUTL1",52,0)
 S EX(LV)="S "_DA_"=0 F  S "_DA_"=$O("_DIC_")) Q:"_DA_"'>0  X EX("_(LV-1)_")"
"RTN","XPDUTL1",53,0)
 Q DIC_","
"RTN","XPDUTL1",54,0)
 ;
"RTN","XPDUTL1",55,0)
SCAN ;Manage the scan of a file
"RTN","XPDUTL1",56,0)
 N CNT,DA,FDA
"RTN","XPDUTL1",57,0)
 S CNT=0
"RTN","XPDUTL1",58,0)
 X EX(EX)
"RTN","XPDUTL1",59,0)
 I CNT>0 D FILE
"RTN","XPDUTL1",60,0)
 Q
"RTN","XPDUTL1",61,0)
FILE ;File a FDA
"RTN","XPDUTL1",62,0)
 N MSG S CNT=0
"RTN","XPDUTL1",63,0)
 D FILE^DIE("KS","FDA","MSG")
"RTN","XPDUTL1",64,0)
 ;I $D(MSG) ZW MSG ;***DEBUG***
"RTN","XPDUTL1",65,0)
 Q
"RTN","XPDUTL1",66,0)
 ;
"RTN","XPDUTL1",67,0)
DELIEN(FL,RT) ;Delete the iens in RT from file FL
"RTN","XPDUTL1",68,0)
 N DA,DIK,XPDI
"RTN","XPDUTL1",69,0)
 S DIK=$G(^DIC(FL,0,"GL")),XPDI=0 Q:'$L(DIK)
"RTN","XPDUTL1",70,0)
 F  S XPDI=$O(@RT@(XPDI)) Q:'XPDI  S DA=XPDI D ^DIK
"RTN","XPDUTL1",71,0)
 Q
"RTN","XPDUTL1",72,0)
 ;
"SEC","^DD",9.8,9.8,7.3,8.5)

"SEC","^DD",9.8,9.8,7.3,9)

"SEC","^DD",9.8,9.8,7.4,8.5)
#
"SEC","^DD",9.8,9.8,7.4,9)
#
"UP",9.8,9.818,-1)
9.8^8
"UP",9.8,9.818,0)
9.818
"VER")
8.0^22.0
"^DD",9.8,9.8,7.3,0)
PATCH LIST AT CHECKSUM TIME^F^^4;3^K:$L(X)>200!($L(X)<2) X
"^DD",9.8,9.8,7.3,3)
Answer must be 2-200 characters in length.
"^DD",9.8,9.8,7.3,21,0)
^^2^2^3021217^
"^DD",9.8,9.8,7.3,21,1,0)
This field holds the patch list from the second line of the routine at the
"^DD",9.8,9.8,7.3,21,2,0)
time the checksum was updated by the XTRUTL routine.
"^DD",9.8,9.8,7.3,"DT")
3021217
"^DD",9.8,9.8,7.4,0)
KIDS INSTALL DATE^D^^4.1;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9.8,9.8,7.4,3)

"^DD",9.8,9.8,7.4,21,0)
^^3^3^3021217^
"^DD",9.8,9.8,7.4,21,1,0)
This field will be updated by KIDS when a package is installed.  A cross
"^DD",9.8,9.8,7.4,21,2,0)
reference on this field could provide a way for GT.M sites to link in new
"^DD",9.8,9.8,7.4,21,3,0)
code on the fly.
"^DD",9.8,9.8,7.4,"DT")
3021217
"^DD",9.8,9.8,8,0)
PATCH^9.818^^8;0
"^DD",9.8,9.818,0)
PATCH SUB-FIELD^^2^2
"^DD",9.8,9.818,0,"DT")
3021023
"^DD",9.8,9.818,0,"IX","B",9.818,.01)

"^DD",9.8,9.818,0,"NM","PATCH")

"^DD",9.8,9.818,0,"UP")
9.8
"^DD",9.8,9.818,.01,0)
PATCH^F^^0;1^K:$L(X)>30!($L(X)<6)!'((X["*")!(X[" ")) X
"^DD",9.8,9.818,.01,1,0)
^.1
"^DD",9.8,9.818,.01,1,1,0)
9.818^B
"^DD",9.8,9.818,.01,1,1,1)
S ^DIC(9.8,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",9.8,9.818,.01,1,1,2)
K ^DIC(9.8,DA(1),8,"B",$E(X,1,30),DA)
"^DD",9.8,9.818,.01,3)
Enter a Patch name, must be 6-30 characters in length
"^DD",9.8,9.818,.01,21,0)
^^1^1^3021023^
"^DD",9.8,9.818,.01,21,1,0)
This field holds a Package or Patch name that includes this routine.
"^DD",9.8,9.818,.01,"DT")
3021023
"^DD",9.8,9.818,2,0)
CHECKSUM^F^^0;2^K:$L(X)>30!($L(X)<2)!'(X?1.N.1"/".N) X
"^DD",9.8,9.818,2,.1)
CheckSum
"^DD",9.8,9.818,2,3)
Answer must be 2-30 characters in length
"^DD",9.8,9.818,2,21,0)
^^3^3^3021023^
"^DD",9.8,9.818,2,21,1,0)
This field holds the Checksum(A)/Checksum(B) that KIDS calculated when
"^DD",9.8,9.818,2,21,2,0)
creating the transport global.  It is used to keep a history of the patch
"^DD",9.8,9.818,2,21,3,0)
values.
"^DD",9.8,9.818,2,"DT")
3021023
**END**
**END**
