EMERGENCY Released PRS*4*83 SEQ #77
Extracted from mail message
**KIDS**:PRS*4.0*83^

**INSTALL NAME**
PRS*4.0*83
"BLD",4687,0)
PRS*4.0*83^PAID^0^3030417^y
"BLD",4687,1,0)
^^1^1^3030417^
"BLD",4687,1,1,0)
See the patch description on FORUM for a complete description of this patch.
"BLD",4687,4,0)
^9.64PA^^
"BLD",4687,"INIT")
START^PRSXP83
"BLD",4687,"KRN",0)
^9.67PA^8989.52^19
"BLD",4687,"KRN",.4,0)
.4
"BLD",4687,"KRN",.401,0)
.401
"BLD",4687,"KRN",.402,0)
.402
"BLD",4687,"KRN",.403,0)
.403
"BLD",4687,"KRN",.5,0)
.5
"BLD",4687,"KRN",.84,0)
.84
"BLD",4687,"KRN",3.6,0)
3.6
"BLD",4687,"KRN",3.8,0)
3.8
"BLD",4687,"KRN",9.2,0)
9.2
"BLD",4687,"KRN",9.8,0)
9.8
"BLD",4687,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4687,"KRN",9.8,"NM",1,0)
PRSDV459^^0^B21814009
"BLD",4687,"KRN",9.8,"NM","B","PRSDV459",1)

"BLD",4687,"KRN",19,0)
19
"BLD",4687,"KRN",19.1,0)
19.1
"BLD",4687,"KRN",101,0)
101
"BLD",4687,"KRN",409.61,0)
409.61
"BLD",4687,"KRN",771,0)
771
"BLD",4687,"KRN",870,0)
870
"BLD",4687,"KRN",8989.51,0)
8989.51
"BLD",4687,"KRN",8989.52,0)
8989.52
"BLD",4687,"KRN",8994,0)
8994
"BLD",4687,"KRN","B",.4,.4)

"BLD",4687,"KRN","B",.401,.401)

"BLD",4687,"KRN","B",.402,.402)

"BLD",4687,"KRN","B",.403,.403)

"BLD",4687,"KRN","B",.5,.5)

"BLD",4687,"KRN","B",.84,.84)

"BLD",4687,"KRN","B",3.6,3.6)

"BLD",4687,"KRN","B",3.8,3.8)

"BLD",4687,"KRN","B",9.2,9.2)

"BLD",4687,"KRN","B",9.8,9.8)

"BLD",4687,"KRN","B",19,19)

"BLD",4687,"KRN","B",19.1,19.1)

"BLD",4687,"KRN","B",101,101)

"BLD",4687,"KRN","B",409.61,409.61)

"BLD",4687,"KRN","B",771,771)

"BLD",4687,"KRN","B",870,870)

"BLD",4687,"KRN","B",8989.51,8989.51)

"BLD",4687,"KRN","B",8989.52,8989.52)

"BLD",4687,"KRN","B",8994,8994)

"BLD",4687,"QUES",0)
^9.62^^
"BLD",4687,"REQB",0)
^9.611^1^1
"BLD",4687,"REQB",1,0)
PRS*4.0*78^1
"BLD",4687,"REQB","B","PRS*4.0*78",1)

"INIT")
START^PRSXP83
"MBREQ")
0
"PKG",408,-1)
1^1
"PKG",408,0)
PAID^PRS^PAID
"PKG",408,20,0)
^9.402P^^
"PKG",408,22,0)
^9.49I^1^1
"PKG",408,22,1,0)
4.0^2950912^2960130
"PKG",408,22,1,"PAH",1,0)
83^3030417
"PKG",408,22,1,"PAH",1,1,0)
^^1^1^3030417
"PKG",408,22,1,"PAH",1,1,1,0)
See the patch description on FORUM for a complete description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRSDV459")
0^1^B21814009
"RTN","PRSDV459",1,0)
PRSDV459 ;HISC/FPT-VIEW PAID PAYRUN DATA ;04/11/2003
"RTN","PRSDV459",2,0)
 ;;4.0;PAID;**78,83**;Sep 21, 1995
"RTN","PRSDV459",3,0)
 K CHOICE F LOOP=1:1:8 S CHOICE(LOOP)=$T(TABLE+LOOP)
"RTN","PRSDV459",4,0)
PP ;select pay period
"RTN","PRSDV459",5,0)
 K DIC S DIC="^PRST(459,",DIC(0)="AEMQZ" D ^DIC I Y'>0 D KILL1,KILL2 Q
"RTN","PRSDV459",6,0)
 S PP=+Y,PPNAME=$P(^PRST(459,PP,0),U,1)
"RTN","PRSDV459",7,0)
EMP K DASHES S $P(DASHES,"-",80)="-"
"RTN","PRSDV459",8,0)
 K DIC,^UTILITY("DIQ1",$J) S DIC="^PRST(459,"_PP_",""P"",",DIC(0)="AEMQZ" D ^DIC K DIC G:Y'>0 PP
"RTN","PRSDV459",9,0)
 S EMP=+Y,ZERO=^PRST(459,PP,"P",EMP,0),NAME=$P(^PRSPC(EMP,0),U,1)
"RTN","PRSDV459",10,0)
 S SSN=$P(ZERO,U,2),SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PRSDV459",11,0)
 S TLU=$P(ZERO,U,13),STATION=$P(^PRSPC(EMP,0),U,7)
"RTN","PRSDV459",12,0)
 S Y=$P(^PRSPC(EMP,0),U,49) X ^DD(450,458,2.1) S CCORG=Y
"RTN","PRSDV459",13,0)
 S DS=$P($G(^PRSPC(EMP,1)),U,42)
"RTN","PRSDV459",14,0)
CAT S CLNGTH=$L(CCORG),TAB=(80-CLNGTH)\2,TAB=TAB-1
"RTN","PRSDV459",15,0)
 W @IOF,!,NAME,?TAB,CCORG,?62,"DUTY STATION: ",STATION_DS
"RTN","PRSDV459",16,0)
 W !,SSN,?71,"T&L: ",TLU,!,DASHES,!,"PAY PERIOD: ",PPNAME
"RTN","PRSDV459",17,0)
 W !! F LOOP=1:1:4 W !,?20,$P(CHOICE(LOOP),";",3),?23,$P(CHOICE(LOOP),";",4)
"RTN","PRSDV459",18,0)
SAN W ! K DIR,DIRUT,DIROUT,DTOUT,DUOUT S DIR(0)="NAO^1:4:0",DIR("A")="Select a number: ",DIR("?")="Type a number between 1 and 4" D ^DIR I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) D KILL1 G EMP
"RTN","PRSDV459",19,0)
 I X="@" W !!,*7,DIR("?")_"." G SAN
"RTN","PRSDV459",20,0)
 G:X="" EMP
"RTN","PRSDV459",21,0)
 S CATEGORY=$P(CHOICE(+Y),";",4),(PRNTORDR,DRSUB)=$P(CHOICE(+Y),";",5),PAGE=0
"RTN","PRSDV459",22,0)
 F  Q:DRSUB'[","  S DRSUB=$P(DRSUB,",")_";"_$P(DRSUB,",",2,999)
"RTN","PRSDV459",23,0)
 S IOFSAV=IOF
"RTN","PRSDV459",24,0)
 K %ZIS,IOP S %ZIS="MQ",%ZIS("B")="" D ^%ZIS I POP D KILL1,KILL2 Q
"RTN","PRSDV459",25,0)
 S IOF=IOFSAV
"RTN","PRSDV459",26,0)
 F LOOP="CATEGORY","CCORG","CLNGTH","DASHES","DS","EMP","DRSUB","NAME","PAGE","PP","PPNAME","PRNTORDR","SSN","STATION","TAB","TLU" S ZTSAVE(LOOP)=""
"RTN","PRSDV459",27,0)
 I $D(IO("Q")) S ZTIO=ION,ZTDESC="DISPLAY PAYRUN DATA",ZTRTN="DISPLAY^PRSDV459",ZTREQ="@",ZTSAVE("ZTREQ")="" D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued!" D KILL1 G CAT
"RTN","PRSDV459",28,0)
 U IO D DISPLAY G:PRTC=0 CAT
"RTN","PRSDV459",29,0)
 I $E(IOST,1)="C" D:PRTC="" PRTC G:PRTC=0 CAT
"RTN","PRSDV459",30,0)
 D:$E(IOST,1)'="C" ^%ZISC
"RTN","PRSDV459",31,0)
 W @IOF G CAT
"RTN","PRSDV459",32,0)
DISPLAY ;display payrun data
"RTN","PRSDV459",33,0)
 S DIQ(0)="EIN",DIC=459,DR=1,DR(459.01)=DRSUB,DA(459.01)=EMP,DA=PP D EN^DIQ1
"RTN","PRSDV459",34,0)
 W:$E(IOST,1)="C" @IOF D HEADER S FIELDN=0
"RTN","PRSDV459",35,0)
 S PRTC="",PRNTVALS="F FIELDN="_PRNTORDR_" D WRITE Q:PRTC=0"
"RTN","PRSDV459",36,0)
 X PRNTVALS
"RTN","PRSDV459",37,0)
KILL1 ;kill most variables and close the device
"RTN","PRSDV459",38,0)
 K D0,DIC,DIQ,DIQ2,DIR,DIRUT,DIROUT,DR,DRSUB,DTOUT,DUOUT,FIELDN,IOFSAV,IOP,LOOP,POP,PRNTVALS,X,Y,ZERO,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,%ZIS,^UTILITY("DIQ1",$J)
"RTN","PRSDV459",39,0)
 Q
"RTN","PRSDV459",40,0)
KILL2 ;kill the remaining variables
"RTN","PRSDV459",41,0)
 K CATEGORY,CCORG,CHOICE,CLNGTH,DA,DS,DASHES,EMP,NAME,PAGE,PP,PPNAME,PRTC,PRNTORDR,SSN,STATION,TAB,TLU,ZTREQ Q
"RTN","PRSDV459",42,0)
WRITE ;write the data
"RTN","PRSDV459",43,0)
 S NODEDD=^DD(459.01,FIELDN,0),DESC=$G(^UTILITY("DIQ1",$J,459.01,EMP,FIELDN,"E"))
"RTN","PRSDV459",44,0)
 I (DESC="")!(DESC="NA") K NODEDD,DESC Q
"RTN","PRSDV459",45,0)
 S INTERNAL=^UTILITY("DIQ1",$J,459.01,EMP,FIELDN,"I")
"RTN","PRSDV459",46,0)
 I $P(NODEDD,U,2)["NJ",+INTERNAL=0 K NODEDD,DESC Q
"RTN","PRSDV459",47,0)
 I PRTC=1 D HEADER S PRTC=""
"RTN","PRSDV459",48,0)
 W !,$P(NODEDD,U,1)
"RTN","PRSDV459",49,0)
 W ?30,$S($P(NODEDD,U,5)["""$""":$J($FN(INTERNAL,",",2),14),$P(NODEDD,U,2)["NJ":$J(INTERNAL,14,2),$P(NODEDD,U,2)["D":$J(DESC,14),1:$J(INTERNAL,14))
"RTN","PRSDV459",50,0)
 I $P(NODEDD,U,2)'["D",INTERNAL'=DESC D DESC
"RTN","PRSDV459",51,0)
 K DESC,INTERNAL,NODEDD
"RTN","PRSDV459",52,0)
 I $E(IOST,1)="C",$Y>(IOSL-4) D PRTC
"RTN","PRSDV459",53,0)
 Q
"RTN","PRSDV459",54,0)
PRTC ;press return to continue
"RTN","PRSDV459",55,0)
 W ! K DIR,DIRUT,DIROUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR S PRTC=Y S:$D(DIRUT) PRTC=0
"RTN","PRSDV459",56,0)
 Q
"RTN","PRSDV459",57,0)
HEADER ;print header
"RTN","PRSDV459",58,0)
 W:$Y>0 @IOF S PAGE=PAGE+1
"RTN","PRSDV459",59,0)
 S CLNGTH=$L(CCORG),TAB=(80-CLNGTH)\2,TAB=TAB-1
"RTN","PRSDV459",60,0)
 W !,NAME,?TAB,CCORG,?62,"DUTY STATION: ",STATION_DS
"RTN","PRSDV459",61,0)
 W !,SSN,?71,"T&L: ",TLU,!,DASHES
"RTN","PRSDV459",62,0)
 S CLNGTH=$L(CATEGORY),TAB=(80-CLNGTH)\2,TAB=TAB-1
"RTN","PRSDV459",63,0)
 W !,"PAY PERIOD: ",PPNAME,?TAB,CATEGORY,?73,"PAGE ",PAGE
"RTN","PRSDV459",64,0)
 W !,DASHES
"RTN","PRSDV459",65,0)
 K CLNGTH,TAB Q
"RTN","PRSDV459",66,0)
DESC ;write description
"RTN","PRSDV459",67,0)
 I $L(DESC)<33 W ?47,DESC Q
"RTN","PRSDV459",68,0)
 S COLUMN=47,LGTH=0
"RTN","PRSDV459",69,0)
 F LOOP1=1:1 Q:LGTH=$L(DESC)!(LGTH>($L(DESC)))  W:$L($P(DESC," ",LOOP1))>(80-COLUMN) ! S:$L($P(DESC," ",LOOP1))>(80-COLUMN) COLUMN=47 W ?COLUMN,$P(DESC," ",LOOP1) S COLUMN=COLUMN+$L($P(DESC," ",LOOP1))+1,LGTH=LGTH+$L($P(DESC," ",LOOP1))+1
"RTN","PRSDV459",70,0)
 K COLUMN,LGTH,LOOP1 Q
"RTN","PRSDV459",71,0)
TABLE ;set subfile dr variable
"RTN","PRSDV459",72,0)
 ;;1;GENERAL INFORMATION;2,3,4,5,6,11,13,110,122,123,112,118,111,7,8,9,10,115,116,117
"RTN","PRSDV459",73,0)
 ;;2;EARNINGS;81,82,83,73,85,124,149,86,87,94,95,101,90,91,97,99,100,88,89,92,93,98,96,102,103,104,104.1,105,109,113,114,108,106,107,74
"RTN","PRSDV459",74,0)
 ;;3;DEDUCTIONS;20,21,22,23,24,27,28,29,25,26,39,40,56,57,60,63,66,59,62,65,58,61,64,33,34,35,30,31,32,36,37,41,42,43,44,45,46,47,48,55,53,54,67.1,67,68.1,68,68.3,68.2,68.5,68.4,69,70,71,72,38,84,49,50,51,52,150,151,152,153
"RTN","PRSDV459",75,0)
 ;;4;LEAVE;75,76,77,78,79,80,80.1,80.2,106,107,154,155,156,157,158
"RTN","PRSDV459",76,0)
 ;;;
"RTN","PRSXP83")
0^^B5503598
"RTN","PRSXP83",1,0)
PRSXP83 ;WCIOFO/MGD-DELETE PP 03-06 ;04/16/2003
"RTN","PRSXP83",2,0)
 ;;4.0;PAID;**83**;Sep 21, 1995
"RTN","PRSXP83",3,0)
 ;
"RTN","PRSXP83",4,0)
 Q
"RTN","PRSXP83",5,0)
 ;
"RTN","PRSXP83",6,0)
 ; This program will delete PP 03-06 from the PAID PAYRUN DATA (#459)
"RTN","PRSXP83",7,0)
 ; file so that Central PAID can re-send the corrected download.
"RTN","PRSXP83",8,0)
 ; A message will be sent to Pam McClaran and Matt Dill to help with
"RTN","PRSXP83",9,0)
 ; the tracking of which sites have installed the patch and have deleted 
"RTN","PRSXP83",10,0)
 ; PP 03-06.
"RTN","PRSXP83",11,0)
 ;
"RTN","PRSXP83",12,0)
 ; For more details see the patch description on FORUM.
"RTN","PRSXP83",13,0)
 ;
"RTN","PRSXP83",14,0)
START ; Main Driver
"RTN","PRSXP83",15,0)
 ;
"RTN","PRSXP83",16,0)
 K ^TMP($J),TMP
"RTN","PRSXP83",17,0)
 N DA,DIK,MESS1,STANUM,TIME,TMP,U,XMSUB
"RTN","PRSXP83",18,0)
 S U="^",DA=0
"RTN","PRSXP83",19,0)
 D NOW^%DTC
"RTN","PRSXP83",20,0)
 S Y=%
"RTN","PRSXP83",21,0)
 D DD^%DT
"RTN","PRSXP83",22,0)
 S TIME=Y
"RTN","PRSXP83",23,0)
 W !!,"Post install routine PRSXP83 beginning at ",TIME_"."
"RTN","PRSXP83",24,0)
 ;
"RTN","PRSXP83",25,0)
 ; Get Station Number
"RTN","PRSXP83",26,0)
 ;
"RTN","PRSXP83",27,0)
 S STANUM=$$KSP^XUPARAM("INST")_","
"RTN","PRSXP83",28,0)
 S STANUM=$$GET1^DIQ(4,STANUM,99)
"RTN","PRSXP83",29,0)
 S MESS1="Station: "_STANUM_" - "
"RTN","PRSXP83",30,0)
 ;
"RTN","PRSXP83",31,0)
 S DA=$O(^PRST(459,"B","03-06",DA))
"RTN","PRSXP83",32,0)
 ;
"RTN","PRSXP83",33,0)
 ; Check to see if the entry does not exist
"RTN","PRSXP83",34,0)
 ;
"RTN","PRSXP83",35,0)
 I DA'>0 D
"RTN","PRSXP83",36,0)
 . S ^TMP($J,"MGD",1)=MESS1_"PP 03-06 Not Found."
"RTN","PRSXP83",37,0)
 . W !!,MESS1_"PP 03-06 Not Found."
"RTN","PRSXP83",38,0)
 . W !,"Please contact NVS at 888-596-4357."
"RTN","PRSXP83",39,0)
 . S XMSUB="STATION "_STANUM_" PP 03-06 Not Found."
"RTN","PRSXP83",40,0)
 ;
"RTN","PRSXP83",41,0)
 ; Check to see if the entry does exist and delete it
"RTN","PRSXP83",42,0)
 ;
"RTN","PRSXP83",43,0)
 I DA>0 D
"RTN","PRSXP83",44,0)
 . I '$D(^PRST(459,DA,0)) D
"RTN","PRSXP83",45,0)
 . . S ^TMP($J,"MGD",1)=MESS1_"PP 03-06 Not Found."
"RTN","PRSXP83",46,0)
 . . W !!,MESS1_"PP 03-06 Not Found."
"RTN","PRSXP83",47,0)
 . . W !,"Please contact NVS at 888-596-4357."
"RTN","PRSXP83",48,0)
 . . S XMSUB="STATION "_STANUM_" PP 03-06 Not Found."
"RTN","PRSXP83",49,0)
 . I $D(^PRST(459,DA,0)) D
"RTN","PRSXP83",50,0)
 . . S DIK="^PRST(459,"
"RTN","PRSXP83",51,0)
 . . D ^DIK
"RTN","PRSXP83",52,0)
 . . S ^TMP($J,"MGD",1)=MESS1_"PP 03-06 Deleted at "_TIME_"."
"RTN","PRSXP83",53,0)
 . . W !!,MESS1_"PP 03-06 Deleted at "_TIME_"."
"RTN","PRSXP83",54,0)
 . . S XMSUB="STATION "_STANUM_" PP 03-06 Deleted at "_TIME_"."
"RTN","PRSXP83",55,0)
 ;
"RTN","PRSXP83",56,0)
XMT ; Send status via mail message
"RTN","PRSXP83",57,0)
 ;
"RTN","PRSXP83",58,0)
 I $D(^TMP($J,"MGD")) D
"RTN","PRSXP83",59,0)
 . N DIFROM,XMDUZ,XMTEXT,XMY
"RTN","PRSXP83",60,0)
 . S XMDUZ=.5
"RTN","PRSXP83",61,0)
 . S XMTEXT="^TMP($J,""MGD"","
"RTN","PRSXP83",62,0)
 . S XMY("MATT.DILL@MED.VA.GOV")="",XMY(DUZ)=""
"RTN","PRSXP83",63,0)
 . S XMY("DILL.MATT@FORUM.VA.GOV")=""
"RTN","PRSXP83",64,0)
 . S XMY("PAM.MCCLARAN@MED.VA.GOV")=""
"RTN","PRSXP83",65,0)
 . S XMY("MCCLARAN.PAM@FORUM.VA.GOV")=""
"RTN","PRSXP83",66,0)
 . D ^XMD
"RTN","PRSXP83",67,0)
 ;
"RTN","PRSXP83",68,0)
 K ^TMP($J),Y,%
"RTN","PRSXP83",69,0)
 W !!,"Post install routine PRSXP83 completed.",!
"RTN","PRSXP83",70,0)
 Q
"VER")
8.0^22
**END**
**END**
