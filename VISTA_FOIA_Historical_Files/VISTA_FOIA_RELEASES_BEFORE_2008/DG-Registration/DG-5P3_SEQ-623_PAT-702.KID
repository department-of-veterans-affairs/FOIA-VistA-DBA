Released DG*5.3*702 SEQ #623
Extracted from mail message
**KIDS**:DG*5.3*702^

**INSTALL NAME**
DG*5.3*702
"BLD",6620,0)
DG*5.3*702^REGISTRATION^0^3060612^y
"BLD",6620,1,0)
^^4^4^3060612^
"BLD",6620,1,1,0)
This patch fixes a problem with collateral patient names, the zip codes
"BLD",6620,1,2,0)
of emergency contacts and designees, the data dictionary of the 
"BLD",6620,1,3,0)
INPATIENT CPT CODE file (#46) and the 'Edit Census Date Parameters'
"BLD",6620,1,4,0)
option.
"BLD",6620,4,0)
^9.64PA^^
"BLD",6620,6)
1^
"BLD",6620,"INI")
DG702PRE
"BLD",6620,"INID")
n^n^n
"BLD",6620,"INIT")
CLEANUP^DG702PST
"BLD",6620,"KRN",0)
^9.67PA^8989.52^19
"BLD",6620,"KRN",.4,0)
.4
"BLD",6620,"KRN",.401,0)
.401
"BLD",6620,"KRN",.402,0)
.402
"BLD",6620,"KRN",.403,0)
.403
"BLD",6620,"KRN",.5,0)
.5
"BLD",6620,"KRN",.84,0)
.84
"BLD",6620,"KRN",3.6,0)
3.6
"BLD",6620,"KRN",3.8,0)
3.8
"BLD",6620,"KRN",9.2,0)
9.2
"BLD",6620,"KRN",9.8,0)
9.8
"BLD",6620,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",6620,"KRN",9.8,"NM",2,0)
DPTLK2^^0^B31398139
"BLD",6620,"KRN",9.8,"NM",3,0)
DGPTC^^0^B11894116
"BLD",6620,"KRN",9.8,"NM",4,0)
DGRPE^^0^B49305780
"BLD",6620,"KRN",9.8,"NM",5,0)
DG702PRE^^0^B227239
"BLD",6620,"KRN",9.8,"NM",6,0)
DG702PST^^0^B6208847
"BLD",6620,"KRN",9.8,"NM","B","DG702PRE",5)

"BLD",6620,"KRN",9.8,"NM","B","DG702PST",6)

"BLD",6620,"KRN",9.8,"NM","B","DGPTC",3)

"BLD",6620,"KRN",9.8,"NM","B","DGRPE",4)

"BLD",6620,"KRN",9.8,"NM","B","DPTLK2",2)

"BLD",6620,"KRN",19,0)
19
"BLD",6620,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",6620,"KRN",19,"NM",1,0)
DGPT CENSUS DATE DISPLAY^^0
"BLD",6620,"KRN",19,"NM",2,0)
DGPT CENSUS REGEN WORKFILE^^0
"BLD",6620,"KRN",19,"NM",3,0)
DGPT CENSUS SUPERVISOR^^0
"BLD",6620,"KRN",19,"NM","B","DGPT CENSUS DATE DISPLAY",1)

"BLD",6620,"KRN",19,"NM","B","DGPT CENSUS REGEN WORKFILE",2)

"BLD",6620,"KRN",19,"NM","B","DGPT CENSUS SUPERVISOR",3)

"BLD",6620,"KRN",19.1,0)
19.1
"BLD",6620,"KRN",101,0)
101
"BLD",6620,"KRN",409.61,0)
409.61
"BLD",6620,"KRN",771,0)
771
"BLD",6620,"KRN",870,0)
870
"BLD",6620,"KRN",8989.51,0)
8989.51
"BLD",6620,"KRN",8989.52,0)
8989.52
"BLD",6620,"KRN",8994,0)
8994
"BLD",6620,"KRN","B",.4,.4)

"BLD",6620,"KRN","B",.401,.401)

"BLD",6620,"KRN","B",.402,.402)

"BLD",6620,"KRN","B",.403,.403)

"BLD",6620,"KRN","B",.5,.5)

"BLD",6620,"KRN","B",.84,.84)

"BLD",6620,"KRN","B",3.6,3.6)

"BLD",6620,"KRN","B",3.8,3.8)

"BLD",6620,"KRN","B",9.2,9.2)

"BLD",6620,"KRN","B",9.8,9.8)

"BLD",6620,"KRN","B",19,19)

"BLD",6620,"KRN","B",19.1,19.1)

"BLD",6620,"KRN","B",101,101)

"BLD",6620,"KRN","B",409.61,409.61)

"BLD",6620,"KRN","B",771,771)

"BLD",6620,"KRN","B",870,870)

"BLD",6620,"KRN","B",8989.51,8989.51)

"BLD",6620,"KRN","B",8989.52,8989.52)

"BLD",6620,"KRN","B",8994,8994)

"BLD",6620,"PRE")
DG702PST
"BLD",6620,"QUES",0)
^9.62^^
"BLD",6620,"REQB",0)
^9.611^3^3
"BLD",6620,"REQB",1,0)
DG*5.3*643^1
"BLD",6620,"REQB",2,0)
DG*5.3*672^1
"BLD",6620,"REQB",3,0)
DG*5.3*680^1
"BLD",6620,"REQB","B","DG*5.3*643",1)

"BLD",6620,"REQB","B","DG*5.3*672",2)

"BLD",6620,"REQB","B","DG*5.3*680",3)

"INI")
DG702PRE
"INIT")
CLEANUP^DG702PST
"KRN",19,2273,-1)
0^3
"KRN",19,2273,0)
DGPT CENSUS SUPERVISOR^Supervisor Menu^^M^^DG PTFSUP^^^^^^REGISTRATION
"KRN",19,2273,1,0)
^^3^3^3060317^
"KRN",19,2273,1,1,0)
This menu contains options needed to manage the PTF Census
"KRN",19,2273,1,2,0)
module.  Options include, displaying a Census Date and
"KRN",19,2273,1,3,0)
regenerating the CENSUS WORKFILE.
"KRN",19,2273,10,0)
^19.01IP^2^2
"KRN",19,2273,10,1,0)
2274^
"KRN",19,2273,10,1,"^")
DGPT CENSUS DATE DISPLAY
"KRN",19,2273,10,2,0)
2275^
"KRN",19,2273,10,2,"^")
DGPT CENSUS REGEN WORKFILE
"KRN",19,2273,99)
60341,59204
"KRN",19,2273,"U")
SUPERVISOR MENU
"KRN",19,2274,-1)
0^1
"KRN",19,2274,0)
DGPT CENSUS DATE DISPLAY^Display Census Date Parameters^^R^^DG PTFSUP^^^^^^REGISTRATION
"KRN",19,2274,1,0)
^19.06^7^7^3060317^^
"KRN",19,2274,1,1,0)
 
"KRN",19,2274,1,2,0)
This option displays a 'Quick Parameter Profile'. 
"KRN",19,2274,1,3,0)
This profile can be used to view the parameters.
"KRN",19,2274,1,4,0)
One parameter, WORKFILE LAST UPDATED,
"KRN",19,2274,1,5,0)
is updated at the end of the 'Regenerate
"KRN",19,2274,1,6,0)
Census Workfile'.  This profile can be used to 
"KRN",19,2274,1,7,0)
monitor the completion of the regeneration.
"KRN",19,2274,25)
7^DGPTC
"KRN",19,2274,"U")
DISPLAY CENSUS DATE PARAMETERS
"KRN",19,2275,-1)
0^2
"KRN",19,2275,0)
DGPT CENSUS REGEN WORKFILE^Regenerate Census Workfile^^R^^DG PTFSUP^^^^^^REGISTRATION
"KRN",19,2275,1,0)
^^39^39^3060317^
"KRN",19,2275,1,1,0)
This options allows the supervisor to regenerate the CENSUS WORKFILE
"KRN",19,2275,1,2,0)
entries for a particular census date.
"KRN",19,2275,1,3,0)
 
"KRN",19,2275,1,4,0)
This option places one entry in the CENSUS WORKFILE for each
"KRN",19,2275,1,5,0)
admission needing a census record for that selected census date.
"KRN",19,2275,1,6,0)
 
"KRN",19,2275,1,7,0)
The workfile is an extract of data from the admission data for the
"KRN",19,2275,1,8,0)
patients who were inpatients as of 11:59 on the census date.  This
"KRN",19,2275,1,9,0)
workfile makes the printing of the 'Census Status Report' faster 
"KRN",19,2275,1,10,0)
than otherwise would be possible.  Without this workfile, it
"KRN",19,2275,1,11,0)
would be neccessary to scan all admissions prior to the census 
"KRN",19,2275,1,12,0)
date to determine if the admission was still active on the census date.
"KRN",19,2275,1,13,0)
 
"KRN",19,2275,1,14,0)
This option only needs to be run at the beginning of the census process 
"KRN",19,2275,1,15,0)
and at the end of the process to ensure that no admissions have been 
"KRN",19,2275,1,16,0)
added via bed control.  However, this option can be run at anytime
"KRN",19,2275,1,17,0)
if desired. 
"KRN",19,2275,1,18,0)
 
"KRN",19,2275,1,19,0)
NOTE:  The 'Census Status Report' uses the the CENSUS WORKFILE. 
"KRN",19,2275,1,20,0)
       As a result, the 'Census Status Report' should not be run until 
"KRN",19,2275,1,21,0)
       after the regeneration is complete.
"KRN",19,2275,1,22,0)
 
"KRN",19,2275,1,23,0)
NOTE:  The first time the 'Census Status Report' is run for a
"KRN",19,2275,1,24,0)
       particular census date, the CENSUS WORKFILE is automatically
"KRN",19,2275,1,25,0)
       generated.
"KRN",19,2275,1,26,0)
 
"KRN",19,2275,1,27,0)
At the end of the regeneration process, the WORKFILE LAST UPDATED
"KRN",19,2275,1,28,0)
field in the PTF CENSUS DATE file is updated with the current
"KRN",19,2275,1,29,0)
date and time.
"KRN",19,2275,1,30,0)
 
"KRN",19,2275,1,31,0)
The 'Display Census Date Parameters' option displays all the 
"KRN",19,2275,1,32,0)
parameters associated with a census date, including WORKFILE 
"KRN",19,2275,1,33,0)
LAST UPDATED. A supervisor can use this option to
"KRN",19,2275,1,34,0)
monitor the completion of a regeneration.
"KRN",19,2275,1,35,0)
 
"KRN",19,2275,1,36,0)
Also, at the end of the regeneration process, a Mailman bulletin
"KRN",19,2275,1,37,0)
is sent to the user requesting the regeneration.  This bulletin
"KRN",19,2275,1,38,0)
will indicate any changes that may have occurred as a result of
"KRN",19,2275,1,39,0)
regeneration.
"KRN",19,2275,25)
GEN^DGPTCR
"KRN",19,2275,"U")
REGENERATE CENSUS WORKFILE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
702^3060612^100850
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3060612
"PKG",5,22,1,"PAH",1,1,1,0)
This patch fixes a problem with collateral patient names, the zip codes
"PKG",5,22,1,"PAH",1,1,2,0)
of emergency contacts and designees, the data dictionary of the 
"PKG",5,22,1,"PAH",1,1,3,0)
INPATIENT CPT CODE file (#46) and the 'Edit Census Date Parameters'
"PKG",5,22,1,"PAH",1,1,4,0)
option.
"PRE")
DG702PST
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","DG702PRE")
0^5^B227239
"RTN","DG702PRE",1,0)
DG702PRE ;BAY/JAT;
"RTN","DG702PRE",2,0)
 ;;5.3;Registration;**702**;Aug 13,1993
"RTN","DG702PRE",3,0)
 ;
"RTN","DG702PRE",4,0)
 ; This is a pre-init routine for DG*5.3*702
"RTN","DG702PRE",5,0)
 ; The purpose is to fix dd for file 46
"RTN","DG702PRE",6,0)
 ;
"RTN","DG702PRE",7,0)
EN ;
"RTN","DG702PRE",8,0)
 D BMES^XPDUTL("Updating data dictionary for file #46")
"RTN","DG702PRE",9,0)
 K ^DD(46,"GL",0,"3 ",.03)
"RTN","DG702PRE",10,0)
 S ^DD(46,"GL",0,3,.03)=""
"RTN","DG702PRE",11,0)
 Q
"RTN","DG702PST")
0^6^B6208847
"RTN","DG702PST",1,0)
DG702PST ;BAY/JAT;
"RTN","DG702PST",2,0)
 ;;5.3;Registration;**702**;Aug 13,1993
"RTN","DG702PST",3,0)
 ;
"RTN","DG702PST",4,0)
 ; This is a post-init routine for DG*5.3*702
"RTN","DG702PST",5,0)
 ; The purpose is to relink File #2 and File #20 records
"RTN","DG702PST",6,0)
 ;
"RTN","DG702PST",7,0)
 ; do environment check
"RTN","DG702PST",8,0)
ENV S XPDABORT=""
"RTN","DG702PST",9,0)
 D PROGCHK(.XPDABORT)
"RTN","DG702PST",10,0)
 I XPDABORT="" K XPDABORT
"RTN","DG702PST",11,0)
 Q
"RTN","DG702PST",12,0)
PROGCHK(XPDABORT) ; checks for necessary programmer variables
"RTN","DG702PST",13,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DG702PST",14,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DG702PST",15,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","DG702PST",16,0)
 .S XPDABORT=2
"RTN","DG702PST",17,0)
 Q
"RTN","DG702PST",18,0)
 ;
"RTN","DG702PST",19,0)
CLEANUP  ;
"RTN","DG702PST",20,0)
 D BMES^XPDUTL("Synchronize Patient file records with file #20")
"RTN","DG702PST",21,0)
 N DGIEN,DG20IEN,DG2PTR,DG2NAME,DG20PTR,DG20NAME,FDATA,DIERR,DGSTUFF,DA,DIK,CNT
"RTN","DG702PST",22,0)
 S CNT=0
"RTN","DG702PST",23,0)
 S DGIEN=0
"RTN","DG702PST",24,0)
 F  S DGIEN=$O(^VA(20,"BB",2,.01,DGIEN)) Q:'DGIEN  D
"RTN","DG702PST",25,0)
 .Q:DGIEN'[",0,"
"RTN","DG702PST",26,0)
 .S DG20IEN=$O(^VA(20,"BB",2,.01,DGIEN,0))
"RTN","DG702PST",27,0)
 .S DG2PTR=$P(DGIEN,",")
"RTN","DG702PST",28,0)
 .S DG2NAME=$P($G(^DPT(DG2PTR,0)),U)
"RTN","DG702PST",29,0)
 .S DG20PTR=$P($G(^DPT(DG2PTR,"NAME")),U)
"RTN","DG702PST",30,0)
 .S DG20NAME=$P(^VA(20,DG20IEN,1),U)_","_$P(^VA(20,DG20IEN,1),U,2)
"RTN","DG702PST",31,0)
 .I $P(^VA(20,DG20IEN,1),U,3)'="" S DG20NAME=DG20NAME_" "_$P(^VA(20,DG20IEN,1),U,3)
"RTN","DG702PST",32,0)
 .I $P(^VA(20,DG20IEN,1),U,5)'="" S DG20NAME=DG20NAME_" "_$P(^VA(20,DG20IEN,1),U,5)
"RTN","DG702PST",33,0)
 .I DG2NAME'=DG20NAME Q
"RTN","DG702PST",34,0)
 .;repoint the Patient file record to the good file 20 record
"RTN","DG702PST",35,0)
 .K FDATA,DIERR
"RTN","DG702PST",36,0)
 .S FDATA(2,DG2PTR_",",1.01)=DG20IEN
"RTN","DG702PST",37,0)
 .D FILE^DIE("","FDATA","DIERR")
"RTN","DG702PST",38,0)
 .K FDATA,DIERR
"RTN","DG702PST",39,0)
 .;kill the bad file 20 record - MUST KILL BEFORE REPOINTING THE OTHER 
"RTN","DG702PST",40,0)
 .S DA=DG20PTR
"RTN","DG702PST",41,0)
 .S DIK="^VA(20,"
"RTN","DG702PST",42,0)
 .D ^DIK
"RTN","DG702PST",43,0)
 .K DA,DIK
"RTN","DG702PST",44,0)
 .;repoint the good file 20 record to the Patient file record
"RTN","DG702PST",45,0)
 .S DGSTUFF=DG2PTR_","
"RTN","DG702PST",46,0)
 .S FDATA(20,DG20IEN_",",.03)=DGSTUFF
"RTN","DG702PST",47,0)
 .D FILE^DIE("","FDATA","DIERR")
"RTN","DG702PST",48,0)
 .K FDATA,DIERR
"RTN","DG702PST",49,0)
 .D MES^XPDUTL("Patient file DFN "_DG2PTR_" synchronized with file #20 record IEN "_DG20IEN)
"RTN","DG702PST",50,0)
 .S CNT=CNT+1
"RTN","DG702PST",51,0)
 D BMES^XPDUTL("Total number of Patient file records synchronized: "_CNT)
"RTN","DG702PST",52,0)
 Q
"RTN","DGPTC")
0^3^B11894116^B12346357
"RTN","DGPTC",1,0)
DGPTC ;ALB/MJK - Census Main Options; 15 APR 90 ; 5/11/01 1:15pm
"RTN","DGPTC",2,0)
 ;;5.3;Registration;**383,643,702**;Aug 13, 1993
"RTN","DGPTC",3,0)
 ;
"RTN","DGPTC",4,0)
 D DT^DICRW S X="DGPTC",DIK="^DOPT("""_X_""","
"RTN","DGPTC",5,0)
 G A:$D(^DOPT(X,10))
"RTN","DGPTC",6,0)
 S ^DOPT(X,0)="Census Main Options^1N^"
"RTN","DGPTC",7,0)
 F I=1:1 S Y=$T(@I) Q:Y=""  S ^DOPT(X,I,0)=$P(Y,";",3,99)
"RTN","DGPTC",8,0)
 D IXALL^DIK
"RTN","DGPTC",9,0)
 ;
"RTN","DGPTC",10,0)
A W !! S DIC="^DOPT(""DGPTC"",",DIC(0)="IQEAM"
"RTN","DGPTC",11,0)
 D ^DIC Q:Y<0  D @+Y G A
"RTN","DGPTC",12,0)
 ;
"RTN","DGPTC",13,0)
1 ;;Load/Edit PTF Record
"RTN","DGPTC",14,0)
 G ^DGPTF
"RTN","DGPTC",15,0)
 ;
"RTN","DGPTC",16,0)
2 ;;Release Closed Census Record
"RTN","DGPTC",17,0)
 S Y=2 D RTY^DGPTUTL,^DGPTFREL
"RTN","DGPTC",18,0)
 Q
"RTN","DGPTC",19,0)
 ;
"RTN","DGPTC",20,0)
3 ;;Open Closed Census Record
"RTN","DGPTC",21,0)
 S Y=2 D RTY^DGPTUTL,HEL^DGPTFDEL
"RTN","DGPTC",22,0)
 K DGADM,DGDOM,DGNHCU,MASD,MASDEV,PARA,DG,DGHEM Q
"RTN","DGPTC",23,0)
 ;
"RTN","DGPTC",24,0)
4 ;;Transmit Census Records
"RTN","DGPTC",25,0)
 D CLOSE G Q4:'Y
"RTN","DGPTC",26,0)
 S Y=2 D RTY^DGPTUTL,^DGPTFTR
"RTN","DGPTC",27,0)
Q4 K DGCN,DGCN0 Q
"RTN","DGPTC",28,0)
 ;
"RTN","DGPTC",29,0)
5 ;;Re-Open Released/Transmitted Records
"RTN","DGPTC",30,0)
 S Y=2 D RTY^DGPTUTL,DREL^DGPTFDEL
"RTN","DGPTC",31,0)
 Q
"RTN","DGPTC",32,0)
 ;
"RTN","DGPTC",33,0)
6 ;;Census Outputs
"RTN","DGPTC",34,0)
 G ^DGPTCO
"RTN","DGPTC",35,0)
 ;
"RTN","DGPTC",36,0)
7 ;;Census Date Parameters
"RTN","DGPTC",37,0)
 D CHKCUR^DGPTCO1
"RTN","DGPTC",38,0)
 K DGDASH W ! D DATE^DGPTCO1 S:Y]"" DIC("B")=Y
"RTN","DGPTC",39,0)
 S DIC="^DG(45.86,",DIC(0)="AELMQ" D ^DIC K DIC G Q7:Y<0
"RTN","DGPTC",40,0)
 S (D0,DGCN)=+Y D PAR
"RTN","DGPTC",41,0)
 ;S DA=DGCN,DIE="^DG(45.86,",DR="[DGPT CENSUS DATE]" D ^DIE K DIE,DR,DQ,DE
"RTN","DGPTC",42,0)
 ;I '$D(Y) S D0=DGCN D PAR W !!
"RTN","DGPTC",43,0)
Q7 K DGCN,D0,DA Q
"RTN","DGPTC",44,0)
 ;
"RTN","DGPTC",45,0)
8 ;;Regenerate Census WorkFile
"RTN","DGPTC",46,0)
 D GEN^DGPTCR
"RTN","DGPTC",47,0)
 Q
"RTN","DGPTC",48,0)
 ;
"RTN","DGPTC",49,0)
9 ;;Send 099 Transmission for Census Record
"RTN","DGPTC",50,0)
 D CLOSE G Q9:'Y
"RTN","DGPTC",51,0)
 S Y=2 D RTY^DGPTUTL,EN^DGPTF099
"RTN","DGPTC",52,0)
Q9 K DGCN,DGCN0 Q
"RTN","DGPTC",53,0)
 ;
"RTN","DGPTC",54,0)
10 ;;Close Census Reord
"RTN","DGPTC",55,0)
 W ! S DIC="^DGPT(",DIC(0)="AEMZQ",DIC("S")="I '$P(^(0),U,6),$P(^(0),U,11)=1"
"RTN","DGPTC",56,0)
 D ^DIC K DIC G Q10:Y<0
"RTN","DGPTC",57,0)
 S (DGPTF,PTF)=+Y,DFN=+Y(0) D PM^DGPTUTL,CEN^DGPTC1
"RTN","DGPTC",58,0)
 I '$D(DGCST) W !!,*7," >>>> Census transactions are not required for this PTF record." G 10
"RTN","DGPTC",59,0)
 I DGCST W !!,*7," >>>> This PTF record is already closed for census. (Census #",$S($D(DGCI):DGCI,1:""),")" G 10
"RTN","DGPTC",60,0)
 D UPDT^DGPTUTL:'$P(Y(0),U,4) S DGPTFE=$P(^DGPT(PTF,0),U,4)
"RTN","DGPTC",61,0)
 S Y=+$S($D(^DG(45.86,+DGCN,0)):+^(0),1:"") D FMT^DGPTUTL
"RTN","DGPTC",62,0)
 S Y=2 D RTY^DGPTUTL
"RTN","DGPTC",63,0)
 D CLS^DGPTC1
"RTN","DGPTC",64,0)
 I 'DGCST W !!," >>>> Not able to close for census.  Please use 'Load/Edit' option to edit PTF."
"RTN","DGPTC",65,0)
 D Q1^DGPTF G 10
"RTN","DGPTC",66,0)
Q10 K DG1,DGL,DGADM,DGPTFMT,DFN,PTF,DGPTFE,DGRTY,DGRTY0,DGPTF D KVAR^DGPTC1 Q
"RTN","DGPTC",67,0)
 ; 
"RTN","DGPTC",68,0)
CLOSE ; -- can we xmit?
"RTN","DGPTC",69,0)
 D CEN^DGPTUTL S Y=1
"RTN","DGPTC",70,0)
 I 'DGCN W !!?5,*7,"There is currently no active census being conducted." S Y=0 G CLOSEQ
"RTN","DGPTC",71,0)
 I DT>$P(DGCN0,U,2) S Y=$P(DGCN0,U,2) X ^DD("DD") W !!?5,*7,"Census Close date has passed (",Y,").",!?5,"No transmissions allowed." S Y=0 G CLOSEQ
"RTN","DGPTC",72,0)
CLOSEQ Q
"RTN","DGPTC",73,0)
 ;
"RTN","DGPTC",74,0)
PAR ; census date parameter profile
"RTN","DGPTC",75,0)
 ;  input: D0 := ifn of ^DG(45.86)
"RTN","DGPTC",76,0)
 S X="DGPTXCP" X ^%ZOSF("TEST") G PARQ:'$T
"RTN","DGPTC",77,0)
 K DGDASH,DXS S $P(DGDASH,"-",81)="",IOP="HOME" D ^%ZIS K IOP
"RTN","DGPTC",78,0)
 W @IOF,*13,$E(DGDASH,1,28)," Quick Parameter Profile ",$E(DGDASH,1,27)
"RTN","DGPTC",79,0)
 D ^DGPTXCP W !,DGDASH
"RTN","DGPTC",80,0)
PARQ K DGDASH,DXS Q
"RTN","DGRPE")
0^4^B49305780^B49313400
"RTN","DGRPE",1,0)
DGRPE ;ALB/MRL,LBD,BRM - REGISTRATIONS EDITS ; 8/11/05 1:02pm
"RTN","DGRPE",2,0)
 ;;5.3;Registration;**32,114,139,169,175,247,190,343,397,342,454,415,489,506,244,547,522,528,555,508,451,626,638,624,677,672,702**;Aug 13, 1993
"RTN","DGRPE",3,0)
 ;
"RTN","DGRPE",4,0)
 ;DGDR contains a string of edits; edit=screen*10+item #
"RTN","DGRPE",5,0)
 ;
"RTN","DGRPE",6,0)
 ;line tag screen*10+item*1000 = continuation line
"RTN","DGRPE",7,0)
 ;
"RTN","DGRPE",8,0)
 I DGRPS=1,DGDR["101," D CEDITS^DGRPECE(DFN)
"RTN","DGRPE",9,0)
 I DGRPS=8 D ^DGRPEIS,Q Q  ; family demographic edit...not conventional!!  :)
"RTN","DGRPE",10,0)
 I DGRPS=9 D EDIT9^DGRPEIS2,Q Q  ; income screening data ($$$)
"RTN","DGRPE",11,0)
 I DGRPS=5,DGDR["501," D
"RTN","DGRPE",12,0)
 .I $G(DGPRFLG) D PREG^IBCNBME(DFN) Q
"RTN","DGRPE",13,0)
 .D REG^IBCNBME(DFN)
"RTN","DGRPE",14,0)
 .Q
"RTN","DGRPE",15,0)
 ;-- Tricare screen #15
"RTN","DGRPE",16,0)
 I DGRPS=15 D EDIT^DGRP15,Q Q
"RTN","DGRPE",17,0)
 ;
"RTN","DGRPE",18,0)
 N DGPH,DGPHFLG
"RTN","DGRPE",19,0)
 K DR S (DA,Y)=DFN,DIE="^DPT(",DR="",DGDRS="DR",DGCT=0
"RTN","DGRPE",20,0)
 G ^DGRPE1:DGRPS>6
"RTN","DGRPE",21,0)
 I DGRPS=4 D ^DGRPE4
"RTN","DGRPE",22,0)
 K DR S (DA,Y)=DFN,DIE="^DPT(",DR="",DGDRS="DR",DGCT=0
"RTN","DGRPE",23,0)
 F I=1:1 S J=$P(DGDR,",",I) Q:J=""  F J1=J,J*1000,J*1000+1,J*1000+2 Q:'$T(@J1)  S DGDRD=$P($T(@J1),";;",2) D S
"RTN","DGRPE",24,0)
 D ^DIE
"RTN","DGRPE",25,0)
 ;check for Combat Vet status
"RTN","DGRPE",26,0)
 I $G(DGCVFLG)=1,($P($$CVEDT^DGCV(DFN),U,2)']"") D
"RTN","DGRPE",27,0)
 . W !!,"**NOTE-Change(s) made in this session deleted the veteran's Combat Vet status!"
"RTN","DGRPE",28,0)
 . S DIR(0)="EA" D ^DIR K DIR
"RTN","DGRPE",29,0)
 I $G(DGPHFLG)>0 D EDITPH1^DGRPLE()
"RTN","DGRPE",30,0)
Q K DA,DIE,DR,DGCT,DGCVFLG,DGDR,DGDRD,DGDRS,DGRPADI,I,J,J1,DGCOMLOC
"RTN","DGRPE",31,0)
 Q
"RTN","DGRPE",32,0)
S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q
"RTN","DGRPE",33,0)
 S DGCT=DGCT+1,DGDRS="DR(1,2,"_DGCT_")",@DGDRS=DGDRD Q
"RTN","DGRPE",34,0)
 Q
"RTN","DGRPE",35,0)
 ;
"RTN","DGRPE",36,0)
101 ;;
"RTN","DGRPE",37,0)
102 ;;1;
"RTN","DGRPE",38,0)
103 ;;.091;
"RTN","DGRPE",39,0)
104 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);
"RTN","DGRPE",40,0)
105 ;;.12105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1217;I X']"" W !?4,$C(7),"But I need a Start Date for this Temporary Address." S Y=.12105;.1218;.1211;I X']"" W !?4,$C(7),"But I need at least one line of a Temporary address." S Y=.12105;
"RTN","DGRPE",41,0)
105000 ;;.1212;S:X']"" Y=.1214;.1213:.1215;.12112;Q;.12111;.1219;@15;K DIE("NO^");
"RTN","DGRPE",42,0)
109 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);.02;D DR109^DGRPE;6;2;K DR(2,2.02),DR(2,2.06);.05;.08;K DIE("NO^");
"RTN","DGRPE",43,0)
111 ;;.14105//NO;S:X="N" Y="@111" S:X="Y" DIE("NO^")="";.1417;I X']"" W !?4,$C(7),"But I need a Start Date." S Y=.14105;.1418;D DR111^DGRPE;.141;I '$P($$CAACT^DGRPCADD(DFN),U,2) W !?4,"But I need at least one active category." S Y=.14105;
"RTN","DGRPE",44,0)
111000 ;;K DR(2,2.141);.1411;I X']"" W !?4,$C(7),"I need at least one line of Address." S Y=.14105;.1412;S:X']"" Y=.1414;.1413;.1414;.1415;.1416;Q;.14111;@111;K DIE("NO^");
"RTN","DGRPE",45,0)
112 ;;.134;.135;.133
"RTN","DGRPE",46,0)
201 ;;.05;.08;.092;.093;.2401:.2403;57.4//NOT APPLICABLE;
"RTN","DGRPE",47,0)
202 ;;1010.15//NO;S:X'="Y" Y="@22";S DIE("NO^")="";1010.152;I X']"" W !?4,*7,"But I need to know where you were treated most recently." S Y=1010.15;1010.151;1010.154;S:X']"" Y="@22";1010.153;@22;K DIE("NO^");
"RTN","DGRPE",48,0)
203 ;;D DR203^DGRPE;6ETHNICITY;2RACE;K DR(2,2.02),DR(2,2.06);
"RTN","DGRPE",49,0)
205 ;;.181;
"RTN","DGRPE",50,0)
301 ;;.211;S:X']"" Y="@31";.212;.2125//NO;I X="Y" S DGADD=".21" D AD^DGRPE S Y=.21011;.213;S:X']"" Y=.216;.214;S:X']"" Y=.216;.215:.217;.2207;.219;.21011;@31;
"RTN","DGRPE",51,0)
302 ;;.2191;S:X']"" Y="@32";.2192;.21925//NO;I X="Y" S DGADD=".211" D AD^DGRPE S Y=.211011;
"RTN","DGRPE",52,0)
302000 ;;.2193;S:X']"" Y=.2196;.2194;S:X']"" Y=.2196;.2195:.2197;.2203;.2199;.211011;@32;
"RTN","DGRPE",53,0)
303 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@33";.3305//NO;I X="Y" S Y="@34",DGX1=1 S:$D(^DPT(DFN,.22)) $P(^(.22),U,1)=$P(^(.22),U,7);@33;.331;S:X']"" DGX1=2,Y="@34";.332;@34;
"RTN","DGRPE",54,0)
303000 ;;S:$G(DGX1) Y="@341";.333;S:X']"" Y=.336;.334;S:X']"" Y=.336;.335:.337;.2201;.339;.33011;S DGX1=2;@341;
"RTN","DGRPE",55,0)
303001 ;;S:$G(DGX1)=2 Y="@35";S DGX2=$G(^DPT(DA,.21));.331///^S X=$P(DGX2,U);.332///^S X=$P(DGX2,U,2);.333////^S X=$P(DGX2,U,3);.334///^S X=$P(DGX2,U,4);@35;
"RTN","DGRPE",56,0)
303002 ;;S:$G(DGX1)=2 Y="@351";.335///^S X=$P(DGX2,U,5);.336///^S X=$P(DGX2,U,6);.337///^S X=$P(DGX2,U,7);.338///^S X=$P(DGX2,U,8);.339///^S X=$P(DGX2,U,9);.33011///^S X=$P(DGX2,U,11);@351;K DGX1,DGX2;
"RTN","DGRPE",57,0)
304 ;;.3311;S:X']"" Y="@36";.3312;.3313;S:X']"" Y=.3316;.3314;S:X']"" Y=.3316;.3315:.3317;.2204;.3319;.331011;@36;        
"RTN","DGRPE",58,0)
305 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@37";.3405//NO;I X="Y" S DGX1=1,Y="@371" S:$D(^DPT(DFN,.22)) $P(^(.22),U,2)=$P(^(.22),U,7);@37;.341;S:X']"" DGX1=2,Y="@371";.342;@371;
"RTN","DGRPE",59,0)
305000 ;;S:$G(DGX1) Y="@38";.343;S:X']"" Y=.346;.344;S:X']"" Y=.346;.345:.347;.2202;.349;.34011;S DGX1=2;@38;
"RTN","DGRPE",60,0)
305001 ;;S:$G(DGX1)=2 Y="@381";S DGX2=$G(^DPT(DA,.21));.341///^S X=$P(DGX2,U);.342///^S X=$P(DGX2,U,2);.343///^S X=$P(DGX2,U,3);.344///^S X=$P(DGX2,U,4);@381
"RTN","DGRPE",61,0)
305002 ;;S:$G(DGX1)=2 Y="@39";.345///^S X=$P(DGX2,U,5);.346///^S X=$P(DGX2,U,6);.347///^S X=$P(DGX2,U,7);.348///^S X=$P(DGX2,U,8);.349///^S X=$P(DGX2,U,9);.34011///^S X=$P(DGX2,U,11);@39;K DGX1,DGX2;
"RTN","DGRPE",62,0)
401 ;;.01;.31115;S:($S(X']"":1,X=3:1,X=9:1,1:0)) Y="@41" S:(X'=5) Y=.3111;.31116;.3111;S:X']"" Y="@41";.3113;S:X']"" Y=.3116;.3114;S:X']"" Y=.3116;.3115:.3117;.2205;.3119;@41;
"RTN","DGRPE",63,0)
402 ;;.2514;.2515;S:($S(X']"":1,X=3:1,X=9:1,1:0)) Y="@42" S:(X'=5) Y=.251;.2516;.251;S:X']"" Y="@42";.252;S:X']"" Y=.255;.253;S:X']"" Y=.255;.254:.256;.2206;.258;@42;
"RTN","DGRPE",64,0)
501 ;;
"RTN","DGRPE",65,0)
502 ;;.381;.382///NOW;
"RTN","DGRPE",66,0)
503 ;;.383;
"RTN","DGRPE",67,0)
601 ;;.325;S:X']"" Y="@61";S:$$FV^DGRPMS(X)'=1 Y=".328";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y=".325";.328;.326;.327;.324;
"RTN","DGRPE",68,0)
601000 ;;.3285//NO;S:X'="Y" Y="@61";.3291;S:X']"" Y="@61";S:$$FV^DGRPMS(X)'=1 Y=".3294";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y=".3291";.3294;.3292;.3293;.329;
"RTN","DGRPE",69,0)
601001 ;;.32945//NO;S:X'="Y" Y="@61";.3296;S:X']"" Y="@61";S:$$FV^DGRPMS(X)'=1 Y=".3299";.3214;I X']"" W !?4,$C(7),"Proof is required for Filipino Vet." S Y=".3296";.3299;.3297;.3298;.3295;@61;
"RTN","DGRPE",70,0)
602 ;;.525//NO;S:X'="Y" Y="@62";.526:.528;@62;
"RTN","DGRPE",71,0)
603 ;;.5291//NO;S:X'="Y" Y="@63";.5292:.5294;@63;
"RTN","DGRPE",72,0)
604 ;;.32101//NO;S:X'="Y" Y="@64";.32104;.32105;@64;
"RTN","DGRPE",73,0)
605 ;;.32102//NO;S:X'="Y" Y="@65";.32107;.32109;.3211;.3213;@65;
"RTN","DGRPE",74,0)
606 ;;.32103//NO;S:X'="Y" Y="@66";.3212;.32111;@66;
"RTN","DGRPE",75,0)
607 ;;.3221//NO;S:X'="Y" Y="@67";.3222;Q;.3223;@67;
"RTN","DGRPE",76,0)
608 ;;.3224//NO;S:X'="Y" Y="@68";.3225;Q;.3226;@68;
"RTN","DGRPE",77,0)
609 ;;.3227//NO;S:X'="Y" Y="@69";.3228;Q;.3229;@69;
"RTN","DGRPE",78,0)
610 ;;.32201//NO;S:X'="Y" Y="@610";.322011;Q;.322012;@610;
"RTN","DGRPE",79,0)
611 ;;.322016//NO;S:X'="Y" Y="@611";.322017;Q;.322018;@611;
"RTN","DGRPE",80,0)
612 ;;.322013//NO;S:X'="Y" Y="@612";.322014;Q;.322015;@612;
"RTN","DGRPE",81,0)
613 ;;I $P($G(^DPT(DFN,.361)),U,3)="H" S Y="@6131";.3602//NO;.3603//NO;S Y="@6132";@6131;.3602;.3603;@6132;
"RTN","DGRPE",82,0)
614 ;;.368//NO;.369//NO;I $S('$D(^DPT(DA,.36)):1,$P(^(.36),U,8)="Y"!($P(^(.36),U,9)="Y"):0,1:1) S Y="@614";.37;@614;
"RTN","DGRPE",83,0)
615 ;;.322019//NO;S:X'="Y" Y="@615";.32202;Q;.322021;@615;
"RTN","DGRPE",84,0)
616 ;;S DGPHFLG=0;.531;S:X'="Y" DGX=X,Y="@616";.532///^S X="PENDING";S Y="@6161";@616;S:DGX'="N" Y="@6162";.533///^S X="VAMC";@6161;S DGPHFLG=1;.535///^S X=$$DIV^DGRPLE();@6162;
"RTN","DGRPE",85,0)
617 ;;D REG^DGNTQ(DFN);
"RTN","DGRPE",86,0)
AD N DGZ4,DGPC
"RTN","DGRPE",87,0)
 S X=$S($D(^DPT(DA,.11)):^(.11),1:""),DGZ4=$P(X,U,12),DGPHONE=$S($D(^(.13)):$P(^(.13),U,1),1:""),Y=$S($D(^(DGADD)):^(DGADD),1:""),^(DGADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_DGPHONE_U_$P(Y,U,10)
"RTN","DGRPE",88,0)
 I DGZ4 S DGPC=$S((DGADD=.33):1,(DGADD=.34):2,(DGADD=.211):3,(DGADD=.331):4,(DGADD=.311):5,(DGADD=.25):6,(DGADD=.21):7,1:0) S:DGPC $P(^DPT(DFN,.22),U,DGPC)=DGZ4
"RTN","DGRPE",89,0)
 K DGADD,DGPHONE Q
"RTN","DGRPE",90,0)
DR109 ;Drop through (use same logic as DR203)
"RTN","DGRPE",91,0)
DR203 S DR(2,2.02)=".01RACE;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.02,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2031"";.02;@2031;"
"RTN","DGRPE",92,0)
 S DR(2,2.06)=".01ETHNICITY;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.06,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2032"";.02;@2032;"
"RTN","DGRPE",93,0)
 Q
"RTN","DGRPE",94,0)
DR111 ;Set DR string for Confidential Address categories
"RTN","DGRPE",95,0)
 S DR(2,2.141)=".01;1//YES;"
"RTN","DGRPE",96,0)
 Q
"RTN","DPTLK2")
0^2^B31398139^B31148790
"RTN","DPTLK2",1,0)
DPTLK2 ;ALB/RMO - MAS Patient Look-up Add New Patient ; 2/8/05 8:13am
"RTN","DPTLK2",2,0)
 ;;5.3;Registration;**32,197,214,244,532,578,615,620,647,680,702**;Aug 13, 1993
"RTN","DPTLK2",3,0)
 N DPTCT,DGVV,DPTLIDR,DGCOL S DGCOL=0
"RTN","DPTLK2",4,0)
 I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",5,0)
 I '$D(DUZ(0)) W:DIC(0)["Q" !?3,*7,"Unable to Add Patient. Your Fileman Access Code is undefined." S DPTDFN=-1 G Q
"RTN","DPTLK2",6,0)
 I $S($D(DLAYGO):2\1-(DLAYGO\1),1:1),DUZ(0)'="@",$D(^DIC(2,0,"LAYGO")) F I=1:1 I DUZ(0)[$E(^("LAYGO"),I) Q:I'>$L(^("LAYGO"))  S DPTDFN=-1 W:DIC(0)["Q" *7," ??" G Q
"RTN","DPTLK2",7,0)
 N DG20NAME S DG20NAME=DPTX,DPTX=$$FORMAT^XLFNAME7(.DG20NAME,3,30,,1)
"RTN","DPTLK2",8,0)
 S DPTX=$S($E(DPTX)[""""&($E(DPTX,$L(DPTX))[""""):$P(DPTX,"""",2),$E(DPTX)["""":$P(DPTX,"""",2),$E(DPTX,$L(DPTX))["""":$P(DPTX,"""",1),1:DPTX)
"RTN","DPTLK2",9,0)
 I $L(DPTX)<3!($L(DPTX)>30)!(DPTX?1P.E)!(DPTX'[",")!(DPTX'?1U.ANP) W:DIC(0)["Q" *7," ??" S DPTDFN=-1 G Q
"RTN","DPTLK2",10,0)
 ; DG*647
"RTN","DPTLK2",11,0)
 I $P($G(XQY0),U)="DG COLLATERAL PATIENT" S DGCOL=1,DGCOL("DR")=$P(DIC("DR"),";",5,8)
"RTN","DPTLK2",12,0)
 K DPTLID I DIC(0)["E" D ASKADD D  G Q:DPTDFN<0 I ('$D(DIC("DR")))!(DGCOL) D CHKID G Q:DPTDFN<0 D ^DPTLK3 G Q:DPTDFN<0 W !!?3,"...adding new patient"
"RTN","DPTLK2",13,0)
 .S:DPTDFN<1&('$D(DTOUT)) DUOUT=1
"RTN","DPTLK2",14,0)
 S X=DPTX,DPT("NO^")=$G(DIE("NO^")) K DD,DO,DPTX N DPTZNV
"RTN","DPTLK2",15,0)
 S:$D(DPT("DR")) DIC("DR")="S DIE(""NO^"")=""BACK"";"_DPT("DR")
"RTN","DPTLK2",16,0)
 I DGCOL S:$D(DPT("DR")) DIC("DR")=DPT("DR")_";"_DGCOL("DR")
"RTN","DPTLK2",17,0)
 D FILE^DICN K:$D(DPT("DR")) DIC("DR")
"RTN","DPTLK2",18,0)
 I +Y>0 W ?24,"...new patient added",!?3
"RTN","DPTLK2",19,0)
 S DPTDFN=Y S:$L(DPT("NO^")) DIE("NO^")=DPT("NO^")
"RTN","DPTLK2",20,0)
 ;offer prompt of patient file components
"RTN","DPTLK2",21,0)
 K DA,DIE,DR
"RTN","DPTLK2",22,0)
 S DIE="^DPT(",DA=+Y,DR="S DIE(""NO^"")=""BACK"";.01///^S (X,DPTZNV)=$$NCEDIT^DPTNAME(DA,1,.DG20NAME)"
"RTN","DPTLK2",23,0)
 D ^DIE K DR
"RTN","DPTLK2",24,0)
 ;look for other (local) identifiers
"RTN","DPTLK2",25,0)
 I '$D(DIC("DR")),DIC(0)["E",'DGCOL D
"RTN","DPTLK2",26,0)
 .F DPTID=0:0 S DPTID=$O(^DD(2,0,"ID",DPTID)) Q:'DPTID  D
"RTN","DPTLK2",27,0)
 ..I $F(DPTGID,U_DPTID_U) Q
"RTN","DPTLK2",28,0)
 ..I '$D(^DD(2,DPTID,0)) Q
"RTN","DPTLK2",29,0)
 ..S DPTLID=""
"RTN","DPTLK2",30,0)
 ..S DPTLIDR=$S('$D(DPTLIDR):DPTID,1:DPTLIDR_";"_DPTID)
"RTN","DPTLK2",31,0)
 I $D(DPTLID) W !!?3,"Please enter the following additional information:",!?3 S DIE="^DPT(",DA=+DPTDFN,DIE("NO^")="BACK",DR=DPTLIDR D ^DIE K DIE,DA,DR
"RTN","DPTLK2",32,0)
 ;
"RTN","DPTLK2",33,0)
Q K DFN,DPT("DR"),DPTLID,DPTGID,DPTID,DPTID0,DPTIDS
"RTN","DPTLK2",34,0)
 Q
"RTN","DPTLK2",35,0)
 ;
"RTN","DPTLK2",36,0)
ASKADD I $D(DDS) I $Y>21 D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK2",37,0)
 S Y=+$P(^DPT(0),U,4)+1 W !?3,*7,"ARE YOU ADDING ",$S(DPTX'?.N:"'"_DPTX_"' AS ",1:""),"A NEW PATIENT (THE ",Y,$S(Y#10=1&(Y#100-11):"ST",Y#10=2&(Y#100-12):"ND",Y#10=3&(Y#100-13):"RD",1:"TH"),")"
"RTN","DPTLK2",38,0)
 S %=2 D YN^DICN S DPTDFN=$S(%<0!(%=2):-1,%=1:1,1:0) I 'DPTDFN W !?6,"Enter 'YES' to add a new applicant, or 'NO' not to." G ASKADD
"RTN","DPTLK2",39,0)
 I %=1 S:$$CONF1^DPTNAME(DPTX)'=1 DPTDFN=-1
"RTN","DPTLK2",40,0)
 Q
"RTN","DPTLK2",41,0)
 ;
"RTN","DPTLK2",42,0)
CHKID K DFN S DPTDFN=1,DPTGID="^.02^.03^.09^391^1901^.301^994^" I DGCOL S DPTGID="^.03^.09^.02^.3601^"
"RTN","DPTLK2",43,0)
 F DPTCT=2:1 S DPTID=$P(DPTGID,U,DPTCT) Q:'DPTID!(DPTDFN<0)  D CHKID1
"RTN","DPTLK2",44,0)
 Q
"RTN","DPTLK2",45,0)
 ;
"RTN","DPTLK2",46,0)
CHKID1 I $D(^DD(2,DPTID,0)) S DPT("DR")=$S('$D(DPT("DR")):DPTID,1:DPT("DR")_";"_DPTID),DPTID0=^DD(2,DPTID,0) D ASKID S:'$D(X) DPTDFN=-1
"RTN","DPTLK2",47,0)
 Q
"RTN","DPTLK2",48,0)
 ;
"RTN","DPTLK2",49,0)
ASKID N DGREC W !?3,"PATIENT ",$P(DPTID0,U),": " R X:DTIME D  I $D(DTOUT)!$G(DUOUT)!($G(DGREC)=1) W !?6,*7,"<'",DPTX,"'> NOT ADDED" K X Q
"RTN","DPTLK2",50,0)
 .S:'$T DTOUT=U
"RTN","DPTLK2",51,0)
 .S:X="^" DUOUT=1
"RTN","DPTLK2",52,0)
 .Q:$D(DTOUT)!($G(DUOUT))
"RTN","DPTLK2",53,0)
 .I DPTID=.09 D
"RTN","DPTLK2",54,0)
 ..N DGNEWPT
"RTN","DPTLK2",55,0)
 ..S DGNEWPT=1
"RTN","DPTLK2",56,0)
 ..D REC^DGSEC
"RTN","DPTLK2",57,0)
 I X["^" W:$E(X)["^" !?6,*7,"Sorry, '^' not allowed!" W " ??" G ASKID
"RTN","DPTLK2",58,0)
 ; field 994 is not a required field
"RTN","DPTLK2",59,0)
 I DPTID=994 I X["?" D HLPID G ASKID
"RTN","DPTLK2",60,0)
 I DPTID=994 I X="" G SKIP
"RTN","DPTLK2",61,0)
 I X["?"!(X="") W:X="" *7," ??" D HLPID G ASKID
"RTN","DPTLK2",62,0)
 I $P(DPTID0,U,2)["S" F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) K:Y="" X Q:Y=""  I $P(Y,":",1)=X!($E($P(Y,":",2),1,$L(X))=X) S X=$P(Y,":",1),DPTSET=$P(Y,":",2) Q
"RTN","DPTLK2",63,0)
SKIP I $P(DPTID0,U,2)["P" D P1 G ASKID:Y'>0 Q:'$D(X)  S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",64,0)
 I DPTID=.301,$D(X) D CHKIT Q:'$D(X)  I $D(X) W:$D(DPTSET) " ",DPTSET S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",65,0)
 I DPTID'=.301 X $P(DPTID0,U,5,99) I $D(X) W:$D(DPTSET) " ",DPTSET S DPTIDS(DPTID)=X,DPT("DR")=DPT("DR")_"///"_X K DPTSET Q
"RTN","DPTLK2",66,0)
 W:'$D(X)&($P(DPTID0,U,2)'["D") *7," ??" D HLPID G ASKID
"RTN","DPTLK2",67,0)
 ;
"RTN","DPTLK2",68,0)
HLPID W:$D(^DD(2,DPTID,.1)) !?5,^(.1) W:$D(^DD(2,DPTID,3)) !?5,^(3) I $D(X),X["?" F I=0:0 S I=$O(^DD(2,DPTID,21,I)) Q:'I!(I>3&(X?1"?"))  I $D(^(I,0)) W !?5,^(0) I I>2,X?1"?" W !?5,"..."
"RTN","DPTLK2",69,0)
 X:$D(^DD(2,DPTID,4)) ^(4) I $P(DPTID0,U,2)["D" S X="?",%DT="E" D ^%DT
"RTN","DPTLK2",70,0)
 I $P(DPTID0,U,2)["S" W !?7,"CHOOSE FROM: " F I=1:1 S Y=$P($P(DPTID0,U,3),";",I) Q:Y=""  W !?7,$P(Y,":",1),?15," ",$P(Y,":",2)
"RTN","DPTLK2",71,0)
 I $P(DPTID0,U,2)["P" D P1
"RTN","DPTLK2",72,0)
 Q
"RTN","DPTLK2",73,0)
P1 I DPTID=".3601" S X=$$UCASE^DPTLK1(X) ;DG*5.3*680
"RTN","DPTLK2",74,0)
 S DPTDIC=$G(DIC),DPTDIC(0)=$G(DIC(0)) S:$D(DIC("S")) DPTDIC("S")=DIC("S") S:$D(DIC("W")) DPTDIC("W")=DIC("W") S DIC="^"_$P(DPTID0,"^",3),DIC(0)="QEMZ",D="B" D IX^DIC
"RTN","DPTLK2",75,0)
 S DIC=DPTDIC,DIC(0)=DPTDIC(0) S:$D(DPTDIC("S")) DIC("S")=DPTDIC("S") S:$D(DPTDIC("W")) DIC("W")=DPTDIC("W") K DPTDIC D DO^DIC1 S:X["^" DPTDFN=-1 I X'["^",X'["?",Y'>0 S X="?" G P1
"RTN","DPTLK2",76,0)
 ; DG*5.3*680  S X=+Y stores the IEN of the sponsor picked to pass to FILE^DICN 
"RTN","DPTLK2",77,0)
 I DPTID=".3601" S X=+Y I '$D(^DPT(+Y,"VET"))!($P($G(^DPT(+Y,"VET")),U)'="Y") D EN^DDIOL("Sponsor must be a veteran","","!?4") K X W !?6,*7,"<'",DPTX,"'> NOT ADDED"
"RTN","DPTLK2",78,0)
 Q
"RTN","DPTLK2",79,0)
CHKIT ; do input transform for .301
"RTN","DPTLK2",80,0)
 I X'="Y" Q
"RTN","DPTLK2",81,0)
 S DGVV=DPTIDS(391),DGVV=$O(^DG(391,"B",DGVV,0))
"RTN","DPTLK2",82,0)
 S DGVV=$S($D(^DG(391,+DGVV,0)):$P(^(0),"^",2),1:"")
"RTN","DPTLK2",83,0)
 I DPTIDS(1901)'="Y",'DGVV D EN^DDIOL("Applicant is NOT a veteran!!","","!?4") K X W !?6,*7,"<'",DPTX,"'> NOT ADDED"
"RTN","DPTLK2",84,0)
 Q
"RTN","DPTLK2",85,0)
DEL ;Delete logic
"RTN","DPTLK2",86,0)
 N I,J,A,G,Q,ERR S Q="""",ERR=0 F I=0:0 S I=$O(^DD(2,0,"PT",I)) Q:'I  F J=0:0 S J=$O(^DD(2,0,"PT",I,J)) Q:'J  D
"RTN","DPTLK2",87,0)
  .F K=0:0 S K=$O(^DD(I,+J,1,K)) Q:'K  S A=$G(^(K,0)) I $L($P(A,U,2)),'$L($P(A,U,3)) D
"RTN","DPTLK2",88,0)
 ..S G=$G(^DIC(+I,0,"GL")) Q:'$L(G)  I $D(@(G_Q_$P(A,U,2)_Q_","_DA_")")) W !,"Entry in "_$P($G(^DIC(I,0)),U)_" ("_I_") refers to this patient" S ERR=1 Q
"RTN","DPTLK2",89,0)
 I ERR
"VER")
8.0^22.0
"BLD",6620,6)
^623
**END**
**END**
