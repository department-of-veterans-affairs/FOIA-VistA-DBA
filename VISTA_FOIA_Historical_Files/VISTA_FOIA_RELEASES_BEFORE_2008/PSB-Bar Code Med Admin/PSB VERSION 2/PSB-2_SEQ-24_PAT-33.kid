EMERGENCY Released PSB*2*33 SEQ #24
Extracted from mail message
**KIDS**:PSB*2.0*33^

**INSTALL NAME**
PSB*2.0*33
"BLD",4386,0)
PSB*2.0*33^BAR CODE MED ADMIN^0^3030827^y
"BLD",4386,1,0)
^^17^17^3030827^
"BLD",4386,1,1,0)
Problem: NOIS SAJ-0803-71312
"BLD",4386,1,2,0)
An IV Piggyback order with a Schedule Type of Continuous that has Admin 
"BLD",4386,1,3,0)
times, (i.e., Q12H with admin times of 0800-2000), and a frequency set to 
"BLD",4386,1,4,0)
null, does not display on the Bar Code Medication Administration (BCMA) 
"BLD",4386,1,5,0)
Graphical User Interface (GUI) Virtual Due List (VDL) IVP/IVPB Medication 
"BLD",4386,1,6,0)
Tab and the Due List [PSBODL] option. The VDL and the Due List [PSBODL] 
"BLD",4386,1,7,0)
option also do not generate a Due List Error Notification message.
"BLD",4386,1,8,0)
 
"BLD",4386,1,9,0)
Corrective Action:
"BLD",4386,1,10,0)
The BCMA Due List [PSBODL] option, and the VDL will generate a Due List 
"BLD",4386,1,11,0)
Error Notification message for IV Piggyback medication orders with a 
"BLD",4386,1,12,0)
Schedule Type of Continuous that have Admin times, and A frequency set to 
"BLD",4386,1,13,0)
null. The BCMA Due List [PSBODL] option, and the VDL will generate a Due 
"BLD",4386,1,14,0)
List Error Notification message for orders with Schedule Type of 
"BLD",4386,1,15,0)
Continuous that are Unit Dose and IV Piggyback orders that have schedules 
"BLD",4386,1,16,0)
names in the format of administration times but the Admin times do not 
"BLD",4386,1,17,0)
exist on the order (i.e., schedule = 1200-1600 admin times = NULL).
"BLD",4386,4,0)
^9.64PA^^0
"BLD",4386,"ABPKG")
n
"BLD",4386,"INID")
n^n^n
"BLD",4386,"KRN",0)
^9.67PA^8989.52^19
"BLD",4386,"KRN",.4,0)
.4
"BLD",4386,"KRN",.401,0)
.401
"BLD",4386,"KRN",.402,0)
.402
"BLD",4386,"KRN",.403,0)
.403
"BLD",4386,"KRN",.403,"NM",0)
^9.68A^^0
"BLD",4386,"KRN",.5,0)
.5
"BLD",4386,"KRN",.5,"NM",0)
^9.68A^^
"BLD",4386,"KRN",.84,0)
.84
"BLD",4386,"KRN",3.6,0)
3.6
"BLD",4386,"KRN",3.8,0)
3.8
"BLD",4386,"KRN",9.2,0)
9.2
"BLD",4386,"KRN",9.8,0)
9.8
"BLD",4386,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",4386,"KRN",9.8,"NM",3,0)
PSBODL^^0^B83453984
"BLD",4386,"KRN",9.8,"NM",4,0)
PSBVDLPB^^0^B67411231
"BLD",4386,"KRN",9.8,"NM",5,0)
PSBVDLUD^^0^B63958364
"BLD",4386,"KRN",9.8,"NM","B","PSBODL",3)

"BLD",4386,"KRN",9.8,"NM","B","PSBVDLPB",4)

"BLD",4386,"KRN",9.8,"NM","B","PSBVDLUD",5)

"BLD",4386,"KRN",19,0)
19
"BLD",4386,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4386,"KRN",19.1,0)
19.1
"BLD",4386,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4386,"KRN",101,0)
101
"BLD",4386,"KRN",409.61,0)
409.61
"BLD",4386,"KRN",771,0)
771
"BLD",4386,"KRN",870,0)
870
"BLD",4386,"KRN",8989.51,0)
8989.51
"BLD",4386,"KRN",8989.51,"NM",0)
^9.68A^^0
"BLD",4386,"KRN",8989.52,0)
8989.52
"BLD",4386,"KRN",8989.52,"NM",0)
^9.68A^^0
"BLD",4386,"KRN",8994,0)
8994
"BLD",4386,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",4386,"KRN","B",.4,.4)

"BLD",4386,"KRN","B",.401,.401)

"BLD",4386,"KRN","B",.402,.402)

"BLD",4386,"KRN","B",.403,.403)

"BLD",4386,"KRN","B",.5,.5)

"BLD",4386,"KRN","B",.84,.84)

"BLD",4386,"KRN","B",3.6,3.6)

"BLD",4386,"KRN","B",3.8,3.8)

"BLD",4386,"KRN","B",9.2,9.2)

"BLD",4386,"KRN","B",9.8,9.8)

"BLD",4386,"KRN","B",19,19)

"BLD",4386,"KRN","B",19.1,19.1)

"BLD",4386,"KRN","B",101,101)

"BLD",4386,"KRN","B",409.61,409.61)

"BLD",4386,"KRN","B",771,771)

"BLD",4386,"KRN","B",870,870)

"BLD",4386,"KRN","B",8989.51,8989.51)

"BLD",4386,"KRN","B",8989.52,8989.52)

"BLD",4386,"KRN","B",8994,8994)

"BLD",4386,"QUES",0)
^9.62^^
"BLD",4386,"REQB",0)
^9.611^6^1
"BLD",4386,"REQB",6,0)
PSB*2.0*28^2
"BLD",4386,"REQB","B","PSB*2.0*28",6)

"MBREQ")
0
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
2.0^3020514^3020719^11874
"PKG",536,22,1,"PAH",1,0)
33^3030827^10000000071
"PKG",536,22,1,"PAH",1,1,0)
^^17^17^3030827
"PKG",536,22,1,"PAH",1,1,1,0)
Problem: NOIS SAJ-0803-71312
"PKG",536,22,1,"PAH",1,1,2,0)
An IV Piggyback order with a Schedule Type of Continuous that has Admin 
"PKG",536,22,1,"PAH",1,1,3,0)
times, (i.e., Q12H with admin times of 0800-2000), and a frequency set to 
"PKG",536,22,1,"PAH",1,1,4,0)
null, does not display on the Bar Code Medication Administration (BCMA) 
"PKG",536,22,1,"PAH",1,1,5,0)
Graphical User Interface (GUI) Virtual Due List (VDL) IVP/IVPB Medication 
"PKG",536,22,1,"PAH",1,1,6,0)
Tab and the Due List [PSBODL] option. The VDL and the Due List [PSBODL] 
"PKG",536,22,1,"PAH",1,1,7,0)
option also do not generate a Due List Error Notification message.
"PKG",536,22,1,"PAH",1,1,8,0)
 
"PKG",536,22,1,"PAH",1,1,9,0)
Corrective Action:
"PKG",536,22,1,"PAH",1,1,10,0)
The BCMA Due List [PSBODL] option, and the VDL will generate a Due List 
"PKG",536,22,1,"PAH",1,1,11,0)
Error Notification message for IV Piggyback medication orders with a 
"PKG",536,22,1,"PAH",1,1,12,0)
Schedule Type of Continuous that have Admin times, and A frequency set to 
"PKG",536,22,1,"PAH",1,1,13,0)
null. The BCMA Due List [PSBODL] option, and the VDL will generate a Due 
"PKG",536,22,1,"PAH",1,1,14,0)
List Error Notification message for orders with Schedule Type of 
"PKG",536,22,1,"PAH",1,1,15,0)
Continuous that are Unit Dose and IV Piggyback orders that have schedules 
"PKG",536,22,1,"PAH",1,1,16,0)
names in the format of administration times but the Admin times do not 
"PKG",536,22,1,"PAH",1,1,17,0)
exist on the order (i.e., schedule = 1200-1600 admin times = NULL).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSBODL")
0^3^B83453984
"RTN","PSBODL",1,0)
PSBODL ;BIRMINGHAM/EFC-DUE LIST ;May 2002
"RTN","PSBODL",2,0)
 ;;2.0;BAR CODE MED ADMIN;**1,3,6,26,28,33**;May 2002 
"RTN","PSBODL",3,0)
 ;
"RTN","PSBODL",4,0)
 ; Reference/IA
"RTN","PSBODL",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBODL",6,0)
 ;
"RTN","PSBODL",7,0)
EN ; Print DL
"RTN","PSBODL",8,0)
 ;
"RTN","PSBODL",9,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG
"RTN","PSBODL",10,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBODL",11,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBODL",12,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBODL",13,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODL",14,0)
 .K PSBHDR
"RTN","PSBODL",15,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBODL",16,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(1)=PSBHDR(1)_Y_"  "
"RTN","PSBODL",17,0)
 .S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)_"-"
"RTN","PSBODL",18,0)
 .S Y=$P(PSBRPT(.1),U,9) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBODL",19,0)
 .S:$P(PSBRPT(.2),U,6) X="IV "
"RTN","PSBODL",20,0)
 .S:$P(PSBRPT(.2),U,7) X=X_$S(X]"":"& ",1:"")_"Unit Dose "
"RTN","PSBODL",21,0)
 .S PSBHDR(2)="Order Type(s): "_X_" -- "
"RTN","PSBODL",22,0)
 .F Y=1:1:4 D:$P(PSBRPT(.2),U,Y)
"RTN","PSBODL",23,0)
 ..S PSBHDR(2)=PSBHDR(2)_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" "
"RTN","PSBODL",24,0)
 .D PRINT(DFN)
"RTN","PSBODL",25,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBODL",26,0)
 Q
"RTN","PSBODL",27,0)
 ;
"RTN","PSBODL",28,0)
PRINT(DFN) ;P ^TMP($J.
"RTN","PSBODL",29,0)
 ; Mult calls I all wds
"RTN","PSBODL",30,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBODATE,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBODL",31,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBODL",32,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG
"RTN","PSBODL",33,0)
 W $$HDR()
"RTN","PSBODL",34,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBODL",35,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBODL",36,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBODL",37,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBODL",38,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBODL",39,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 D  Q
"RTN","PSBODL",40,0)
 .W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",41,0)
 .W !,$$BLANKS(),$$FTR()
"RTN","PSBODL",42,0)
 S PSBINDX=0
"RTN","PSBODL",43,0)
 F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBODL",44,0)
 .S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBODL",45,0)
 .Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pend this ver
"RTN","PSBODL",46,0)
 .S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBODL",47,0)
 .I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,8)) Q
"RTN","PSBODL",48,0)
 .Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBODL",49,0)
 .Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBODL",50,0)
 .S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBODL",51,0)
 .S Y=$P(PSBSTAT,U,2)
"RTN","PSBODL",52,0)
 .Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBODL",53,0)
 .Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBODL",54,0)
 .Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBODL",55,0)
 .Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBODL",56,0)
 .S PSBSCHT=Y
"RTN","PSBODL",57,0)
 .S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBODL",58,0)
 .S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBODL",59,0)
 .S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBODL",60,0)
 .S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBODL",61,0)
 I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **" W !,$$BLANKS(),$$FTR() Q
"RTN","PSBODL",62,0)
 S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBODL",63,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBODL",64,0)
 .K PSBORD
"RTN","PSBODL",65,0)
 .S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBODL",66,0)
 .S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBODL",67,0)
 .S PSBMED=$QS(PSBGBL,6)
"RTN","PSBODL",68,0)
 .S PSBORD=$QS(PSBGBL,7)
"RTN","PSBODL",69,0)
 .D CLEAN^PSBVT
"RTN","PSBODL",70,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL",71,0)
 .D NOW^%DTC S PSBNOW=%
"RTN","PSBODL",72,0)
 .Q:PSBOSP<PSBOSTRT  ;
"RTN","PSBODL",73,0)
 .Q:(PSBOSP<PSBOSTRT!(PSBOST>PSBOSTOP))&(PSBSCHT'="O")
"RTN","PSBODL",74,0)
 .S X=$$GET^XPAR("DIV","PSB ADMIN BEFORE")
"RTN","PSBODL",75,0)
 .; strt DT > DL Stp DT + adm b
"RTN","PSBODL",76,0)
 .Q:PSBSCHT="O"&(PSBOST>$$FMADD^XLFDT(PSBOSTOP,"","",+X))
"RTN","PSBODL",77,0)
 .S (PSBYES,PSBODD,PSBDAYB,PSBSCBR)=0
"RTN","PSBODL",78,0)
 .S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1,PSBDAYB=1
"RTN","PSBODL",79,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBSCBR=1
"RTN","PSBODL",80,0)
 .I PSBYES,PSBADST="" D  Q
"RTN","PSBODL",81,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBODL",82,0)
 .I PSBSCHT="OC" S PSBYES=1
"RTN","PSBODL",83,0)
 .I PSBSCHT="P" S PSBYES=1
"RTN","PSBODL",84,0)
 .I PSBONX["V" S PSBYES=1
"RTN","PSBODL",85,0)
 .I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBODL",86,0)
 .I PSBIVT["S",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",87,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",88,0)
 .I PSBIVT["C",PSBCHEMT="A" S PSBYES=1
"RTN","PSBODL",89,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL",90,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBODL",91,0)
 .I PSBSCHT="P" S PSBFREQ=1440
"RTN","PSBODL",92,0)
 .I PSBSCHT="O" S PSBFREQ=1440
"RTN","PSBODL",93,0)
 .I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBODL",94,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBODL",95,0)
 .S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMRAB)
"RTN","PSBODL",96,0)
 .I 'PSBDAYB,'PSBSCBR,PSBSCHT="C",PSBVALB="1",PSBADST'="",PSBFREQ<1 D  Q   ;B
"RTN","PSBODL",97,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBODL",98,0)
 .I +PSBFREQ>0 D
"RTN","PSBODL",99,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL",100,0)
 .I PSBODD,PSBADST'="" D  Q
"RTN","PSBODL",101,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBODL",102,0)
 .I PSBADST'="" D
"RTN","PSBODL",103,0)
 ..F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBODL",104,0)
 ...;Inv ADM
"RTN","PSBODL",105,0)
 ...D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBODL",106,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBODL",107,0)
 .I PSBSCHT="C",PSBOTYP="U" Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)
"RTN","PSBODL",108,0)
 .I PSBSCHT="C",$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR),'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ) Q
"RTN","PSBODL",109,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBODL",110,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBODL",111,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",112,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",113,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",114,0)
 .S PSBRMN=1
"RTN","PSBODL",115,0)
 .I PSBSCHT="O",PSBOST'=PSBOSP,PSBOSP<PSBOSTRT S PSBRMN=0
"RTN","PSBODL",116,0)
 .Q:'PSBRMN
"RTN","PSBODL",117,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBODL",118,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBODL",119,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",120,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",121,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",122,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL",123,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL",124,0)
 ..S PSBIEN=""
"RTN","PSBODL",125,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL",126,0)
 ...S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBODL",127,0)
 .S PSBADMIN="" K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL",128,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL",129,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL",130,0)
 ..D:PSBX=""
"RTN","PSBODL",131,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",132,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",133,0)
 ...I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",134,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",135,0)
 ..I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",136,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",137,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL",138,0)
 ..I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",139,0)
 ..I PSBX="" D
"RTN","PSBODL",140,0)
 ...S:($G(PSBFREQ)>29)!(PSBFREQ="D") PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL",141,0)
 ..E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL",142,0)
 ..D:PSBX'=""
"RTN","PSBODL",143,0)
 ...F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL",144,0)
 ....F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL",145,0)
 .....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL",146,0)
 .....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)
"RTN","PSBODL",147,0)
 .....D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBODL",148,0)
 .....D:(+PSBZ(0)<0)&(PSBCNT=1)
"RTN","PSBODL",149,0)
 ......S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)=""
"RTN","PSBODL",150,0)
 .....Q:+PSBZ(0)<0
"RTN","PSBODL",151,0)
 .....S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",152,0)
 ..I +$G(PSBFREQ)>0,$G(PSBFREQ)<30,PSBADMIN'="0000" S PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL",153,0)
 .D:$Y>(IOSL-(12+($L(PSBADMIN)/27)))
"RTN","PSBODL",154,0)
 ..W !?(IOM-36\2),"(Medications Continued on Next Page)"
"RTN","PSBODL",155,0)
 ..W $$FTR()
"RTN","PSBODL",156,0)
 ..W $$HDR()
"RTN","PSBODL",157,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL",158,0)
 .E  S PSBSM=""
"RTN","PSBODL",159,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL",160,0)
 .S X="",Y=0
"RTN","PSBODL",161,0)
 .W $$WRAP(14,34,PSBMED)
"RTN","PSBODL",162,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL",163,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBODL",164,0)
 .W ?78,PSBMRAB
"RTN","PSBODL",165,0)
 .W ?85 D:PSBLGDT
"RTN","PSBODL",166,0)
 ..W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3)
"RTN","PSBODL",167,0)
 ..W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL",168,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBODL",169,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBODL",170,0)
 .W ?120
"RTN","PSBODL",171,0)
 .W $S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBODL",172,0)
 .W $S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBODL",173,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2)
"RTN","PSBODL",174,0)
 .W ?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL",175,0)
 .W IOINHI
"RTN","PSBODL",176,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL",177,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL",178,0)
 ..W !?14,"*"
"RTN","PSBODL",179,0)
 ..W $$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL",180,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  D
"RTN","PSBODL",181,0)
 ..W !?14,"*"
"RTN","PSBODL",182,0)
 ..W $$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL",183,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  D
"RTN","PSBODL",184,0)
 ..W !?14,"*"
"RTN","PSBODL",185,0)
 ..W $$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL",186,0)
 .W IOINORM ; Hlight Off
"RTN","PSBODL",187,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL",188,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL",189,0)
 .S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBODL",190,0)
 .W $$WRAP(14,34,"Spec Inst: "_X)
"RTN","PSBODL",191,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",192,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",193,0)
 W $$BLANKS(),$$FTR()
"RTN","PSBODL",194,0)
 S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBODL",195,0)
 I $P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)) D EN^PSBODL1
"RTN","PSBODL",196,0)
 Q
"RTN","PSBODL",197,0)
 ;
"RTN","PSBODL",198,0)
WRAP(X,Y,Z) ;
"RTN","PSBODL",199,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL",200,0)
 .W:$X>X !
"RTN","PSBODL",201,0)
 .W:$X<X ?X
"RTN","PSBODL",202,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL",203,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL",204,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL",205,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL",206,0)
 .S Z=$E(Z,PSB+1,255)
"RTN","PSBODL",207,0)
 Q ""
"RTN","PSBODL",208,0)
 ;
"RTN","PSBODL",209,0)
FTR() ;
"RTN","PSBODL",210,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL",211,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL",212,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL",213,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL",214,0)
 Q ""
"RTN","PSBODL",215,0)
 ;
"RTN","PSBODL",216,0)
HDR() ;
"RTN","PSBODL",217,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL",218,0)
 W !,"Self",?86,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL",219,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL",220,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL",221,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",222,0)
 Q ""
"RTN","PSBODL",223,0)
 ;
"RTN","PSBODL",224,0)
BLANKS() ;
"RTN","PSBODL",225,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL",226,0)
 W !
"RTN","PSBODL",227,0)
 D:$Y>(IOSL-26)
"RTN","PSBODL",228,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBODL",229,0)
 .W $$FTR(),$$HDR() ; New page - no room for blanks
"RTN","PSBODL",230,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL",231,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL",232,0)
 F X=1:1:4 D
"RTN","PSBODL",233,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",234,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBODL",235,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBODL",236,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBODL",237,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBODL",238,0)
 .W !?20,"Spec"
"RTN","PSBODL",239,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBODL",240,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBODL",241,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBODL",242,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",243,0)
 Q ""
"RTN","PSBODL",244,0)
 ;
"RTN","PSBVDLPB")
0^4^B67411231
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE LIST ;May 2002
"RTN","PSBVDLPB",2,0)
 ;;2.0;BAR CODE MED ADMIN;**1,6,20,33**;May 2002
"RTN","PSBVDLPB",3,0)
 ;
"RTN","PSBVDLPB",4,0)
 ; Reference/IA
"RTN","PSBVDLPB",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLPB",6,0)
 ;
"RTN","PSBVDLPB",7,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",8,0)
 ;
"RTN","PSBVDLPB",9,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",10,0)
 ;
"RTN","PSBVDLPB",11,0)
 ; Description:
"RTN","PSBVDLPB",12,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",13,0)
 ; client VDL
"RTN","PSBVDLPB",14,0)
 ;
"RTN","PSBVDLPB",15,0)
 ;
"RTN","PSBVDLPB",16,0)
 N PSBDATA
"RTN","PSBVDLPB",17,0)
 K ^TMP("PSB",$J,"PBTAB")
"RTN","PSBVDLPB",18,0)
 S ^TMP("PSB",$J,"PBTAB",0)=1
"RTN","PSBVDLPB",19,0)
 S ^TMP("PSB",$J,"PBTAB",1)="-1^No Active Orders at this Time."
"RTN","PSBVDLPB",20,0)
 ;
"RTN","PSBVDLPB",21,0)
 K ^TMP("PSJ",$J) D EN^PSJBCMA(DFN,PSBNOW,PSBTRDT)
"RTN","PSBVDLPB",22,0)
 ;
"RTN","PSBVDLPB",23,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",24,0)
 ;
"RTN","PSBVDLPB",25,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBVDLPB",26,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLPB",27,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",28,0)
 .;
"RTN","PSBVDLPB",29,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",30,0)
 .;
"RTN","PSBVDLPB",31,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLPB",32,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBMR)
"RTN","PSBVDLPB",33,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLPB",34,0)
 .Q:PSBOSP<PSBWBEG  ; For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",35,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLPB",36,0)
 .Q:PSBNGF  ;  Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",37,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",38,0)
 .;
"RTN","PSBVDLPB",39,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",40,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",41,0)
 .;
"RTN","PSBVDLPB",42,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",43,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",44,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",45,0)
 .;
"RTN","PSBVDLPB",46,0)
 .; Is One Time Given
"RTN","PSBVDLPB",47,0)
 .;
"RTN","PSBVDLPB",48,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",49,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",50,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",51,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLPB",52,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",53,0)
 .;
"RTN","PSBVDLPB",54,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",55,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",56,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",57,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",58,0)
 .;
"RTN","PSBVDLPB",59,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",60,0)
 .;
"RTN","PSBVDLPB",61,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",62,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",63,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",64,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLPB",65,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBON,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",66,0)
 .;
"RTN","PSBVDLPB",67,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",68,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",69,0)
 .;
"RTN","PSBVDLPB",70,0)
 .S PSBREC=""
"RTN","PSBVDLPB",71,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",72,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",73,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",74,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",75,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",76,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",77,0)
 .S Y=""
"RTN","PSBVDLPB",78,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",79,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",80,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",81,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",82,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",83,0)
 .S $P(PSBREC,U,10)=PSBMR ; route
"RTN","PSBVDLPB",84,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",85,0)
 .S (PSBCNT,PSBFLAG)=0,Y=""
"RTN","PSBVDLPB",86,0)
 .F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y),-1) Q:Y=""  Q:PSBFLAG=1  D
"RTN","PSBVDLPB",87,0)
 ..S $P(PSBREC,U,11)=$S(Y:Y,1:"")
"RTN","PSBVDLPB",88,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBVDLPB",89,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) I PSBSTUS'="N" S PSBFLAG=1
"RTN","PSBVDLPB",90,0)
 ...S $P(PSBREC,U,20)=$S(PSBSTUS="N":"",1:PSBSTUS)
"RTN","PSBVDLPB",91,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",92,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",93,0)
 ....;I PSBCNT=1 S PSBFLAG=1
"RTN","PSBVDLPB",94,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",95,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",96,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",97,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLPB",98,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLPB",99,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLPB",100,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLPB",101,0)
 .S $P(PSBREC,U,12)=""  ; med log ien iserted below
"RTN","PSBVDLPB",102,0)
 .S $P(PSBREC,U,13)=""  ; med log status inserted below
"RTN","PSBVDLPB",103,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLPB",104,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",105,0)
 .S $P(PSBREC,U,16)=0  ; Default to not injectable
"RTN","PSBVDLPB",106,0)
 .;S $P(PSBREC,U,16)="^IVP^IM^SC^"[PSBMR
"RTN","PSBVDLPB",107,0)
 .;Scan for injectable routes
"RTN","PSBVDLPB",108,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLPB",109,0)
 ..I PSBMR?@(".E1"""_X_""".E") S $P(PSBREC,U,16)=1
"RTN","PSBVDLPB",110,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",111,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",112,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",113,0)
 .;S X=PSBDOSEF
"RTN","PSBVDLPB",114,0)
 .;S:X?1"CAP".E!(X?1"TAB".E) $P(PSBREC,U,18)=X ; Dosage form
"RTN","PSBVDLPB",115,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE
"RTN","PSBVDLPB",116,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",117,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",118,0)
 .;
"RTN","PSBVDLPB",119,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",120,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",121,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",122,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",123,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",124,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",125,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",126,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",127,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",128,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",129,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",130,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",131,0)
 .;
"RTN","PSBVDLPB",132,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",133,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",134,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",135,0)
 .;
"RTN","PSBVDLPB",136,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",137,0)
 .; process admintimes
"RTN","PSBVDLPB",138,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",139,0)
 .S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBVDLPB",140,0)
 .I PSBYES,PSBADST="" D  Q
"RTN","PSBVDLPB",141,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBVDLPB",142,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",143,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D  Q
"RTN","PSBVDLPB",144,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBVDLPB",145,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",146,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",147,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",148,0)
 .I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBVDLPB",149,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBVDLPB",150,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",151,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",152,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",153,0)
 .I +PSBFREQ>0 D
"RTN","PSBVDLPB",154,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",155,0)
 .I PSBODD,PSBADST'="" D  Q
"RTN","PSBVDLPB",156,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBVDLPB",157,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",158,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",159,0)
 .;S PSBDAYS=$$DAYS(PSBSCH) ; Days between doses i.e. Q72H=3
"RTN","PSBVDLPB",160,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",161,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",162,0)
 ..D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBVDLPB",163,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",164,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",165,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",166,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",167,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",168,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",169,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",170,0)
 ..;
"RTN","PSBVDLPB",171,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",172,0)
 ..;
"RTN","PSBVDLPB",173,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",174,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",175,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",176,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",177,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",178,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",179,0)
 ;
"RTN","PSBVDLPB",180,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",181,0)
 D VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",182,0)
 Q
"RTN","PSBVDLPB",183,0)
 ;
"RTN","PSBVDLUD")
0^5^B63958364
"RTN","PSBVDLUD",1,0)
PSBVDLUD ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;May 2002
"RTN","PSBVDLUD",2,0)
 ;;2.0;BAR CODE MED ADMIN;**6,20,26,28,33**;May 2002
"RTN","PSBVDLUD",3,0)
 ;
"RTN","PSBVDLUD",4,0)
 ; Reference/IA
"RTN","PSBVDLUD",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLUD",6,0)
 ;
"RTN","PSBVDLUD",7,0)
EN(DFN,PSBDT) ;
"RTN","PSBVDLUD",8,0)
 ;
"RTN","PSBVDLUD",9,0)
 ;
"RTN","PSBVDLUD",10,0)
 ; Description:
"RTN","PSBVDLUD",11,0)
 ; Returns the current unit dose order set for today to display
"RTN","PSBVDLUD",12,0)
 ; on the client VDL
"RTN","PSBVDLUD",13,0)
 ;
"RTN","PSBVDLUD",14,0)
 N PSBDATA
"RTN","PSBVDLUD",15,0)
 K ^TMP("PSB",$J,"UDTAB")
"RTN","PSBVDLUD",16,0)
 S ^TMP("PSB",$J,"UDTAB",0)=1
"RTN","PSBVDLUD",17,0)
 S ^TMP("PSB",$J,"UDTAB",1)="-1^No Active Orders at this Time."
"RTN","PSBVDLUD",18,0)
 ;
"RTN","PSBVDLUD",19,0)
 K ^TMP("PSJ",$J) D EN^PSJBCMA(DFN,PSBNOW,PSBTRDT)
"RTN","PSBVDLUD",20,0)
 ;
"RTN","PSBVDLUD",21,0)
 I $G(^TMP("PSJ",$J,1,0))=-1  Q  ; No orders
"RTN","PSBVDLUD",22,0)
 ;
"RTN","PSBVDLUD",23,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBVDLUD",24,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLUD",25,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLUD",26,0)
 .;
"RTN","PSBVDLUD",27,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLUD",28,0)
 .;
"RTN","PSBVDLUD",29,0)
 .Q:PSBONX["V"  ;No IVs on UD tab
"RTN","PSBVDLUD",30,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLUD",31,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLUD",32,0)
 .Q:PSBOSP<PSBWBEG  ; For Non one-times Order Stop Date/Time < vdl window
"RTN","PSBVDLUD",33,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLUD",34,0)
 .Q:PSBNGF  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLUD",35,0)
 .Q:PSBMR="IVP"!(PSBMR="IV PUSH")
"RTN","PSBVDLUD",36,0)
 .;
"RTN","PSBVDLUD",37,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLUD",38,0)
 .;
"RTN","PSBVDLUD",39,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",40,0)
 .Q:PSBOSP<%
"RTN","PSBVDLUD",41,0)
 .;
"RTN","PSBVDLUD",42,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLUD",43,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLUD",44,0)
 .I PSBSCHT'="O",PSBOSTS'="A",PSBOSTS'="H",PSBOSTS'="R",PSBOSTS'="RE",PSBOSTS'="O" Q
"RTN","PSBVDLUD",45,0)
 .;
"RTN","PSBVDLUD",46,0)
 .; Is One Time Given
"RTN","PSBVDLUD",47,0)
 .;
"RTN","PSBVDLUD",48,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLUD",49,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",50,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",51,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",52,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",53,0)
 .;
"RTN","PSBVDLUD",54,0)
 .; How long does One Time remain on VDL ??
"RTN","PSBVDLUD",55,0)
 .S PSBRMN=1
"RTN","PSBVDLUD",56,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBVDLUD",57,0)
 .Q:'PSBRMN
"RTN","PSBVDLUD",58,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLUD",59,0)
 .;
"RTN","PSBVDLUD",60,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLUD",61,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",62,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",63,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",64,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",65,0)
 .;
"RTN","PSBVDLUD",66,0)
 .S PSBREC=""
"RTN","PSBVDLUD",67,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLUD",68,0)
 .S $P(PSBREC,U,2)=PSBONX ; order
"RTN","PSBVDLUD",69,0)
 .S $P(PSBREC,U,3)=PSBON ; order ien
"RTN","PSBVDLUD",70,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLUD",71,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLUD",72,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLUD",73,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; self med
"RTN","PSBVDLUD",74,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLUD",75,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLUD",76,0)
 .S $P(PSBREC,U,10)=PSBMR ; route
"RTN","PSBVDLUD",77,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLUD",78,0)
 .S (PSBCNT,PSBFLAG)=0,Y=""
"RTN","PSBVDLUD",79,0)
 .F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y),-1) Q:Y=""  Q:PSBFLAG=1  D
"RTN","PSBVDLUD",80,0)
 ..S $P(PSBREC,U,11)=$S(Y:Y,1:"")
"RTN","PSBVDLUD",81,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBVDLUD",82,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) I PSBSTUS'="N" S PSBFLAG=1
"RTN","PSBVDLUD",83,0)
 ...S $P(PSBREC,U,20)=$S(PSBSTUS="N":"",1:PSBSTUS)
"RTN","PSBVDLUD",84,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLUD",85,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLUD",86,0)
 ....;I PSBCNT=1 S PSBFLAG=1
"RTN","PSBVDLUD",87,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLUD",88,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",89,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",90,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLUD",91,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLUD",92,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLUD",93,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM",$P(PSBREC,U,20)=PSBSTUS D LAST^PSBVDLU1
"RTN","PSBVDLUD",94,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLUD",95,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLUD",96,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLUD",97,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLUD",98,0)
 .S $P(PSBREC,U,16)=0  ; Default to not injectable
"RTN","PSBVDLUD",99,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLUD",100,0)
 ..I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBVDLUD",101,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLUD",102,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLUD",103,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLUD",104,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ; Dosage form
"RTN","PSBVDLUD",105,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLUD",106,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLUD",107,0)
 .;
"RTN","PSBVDLUD",108,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLUD",109,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",110,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBVDLUD",111,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLUD",112,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1 ;If drug was inactivated
"RTN","PSBVDLUD",113,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ; Inactive
"RTN","PSBVDLUD",114,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBVDLUD",115,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4)
"RTN","PSBVDLUD",116,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLUD",117,0)
 .;
"RTN","PSBVDLUD",118,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLUD",119,0)
 .S PSBQRR=0
"RTN","PSBVDLUD",120,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLUD",121,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",122,0)
 .;
"RTN","PSBVDLUD",123,0)
 .; Now we deal with only continuous
"RTN","PSBVDLUD",124,0)
 .; process admintimes
"RTN","PSBVDLUD",125,0)
 .; Display an order on the VDL based on the frequency received from IPM **PSB*2.0*3
"RTN","PSBVDLUD",126,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLUD",127,0)
 .I PSBSCH="" D
"RTN","PSBVDLUD",128,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"No Schedule on this order")
"RTN","PSBVDLUD",129,0)
 .S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBVDLUD",130,0)
 .I PSBYES,PSBADST="" D  Q
"RTN","PSBVDLUD",131,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBVDLUD",132,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLUD",133,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D  Q
"RTN","PSBVDLUD",134,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBVDLUD",135,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLUD",136,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLUD",137,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLUD",138,0)
 .I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBVDLUD",139,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBVDLUD",140,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("UDTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLUD",141,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLUD",142,0)
 .I +PSBFREQ>0 D
"RTN","PSBVDLUD",143,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLUD",144,0)
 .I PSBODD,PSBADST'="" D  Q
"RTN","PSBVDLUD",145,0)
 ..D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBVDLUD",146,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLUD",147,0)
 .; build all orders for both days.
"RTN","PSBVDLUD",148,0)
 .F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBVDLUD",149,0)
 ..;For invalid admin times
"RTN","PSBVDLUD",150,0)
 ..D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBVDLUD",151,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLUD",152,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLUD",153,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",154,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",155,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",156,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",157,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",158,0)
 ..;
"RTN","PSBVDLUD",159,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLUD",160,0)
 ..;
"RTN","PSBVDLUD",161,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLUD",162,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",163,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",164,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",165,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",166,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",167,0)
 .K PSBSTUS
"RTN","PSBVDLUD",168,0)
 K PSBREC D EN^PSBVDLPA
"RTN","PSBVDLUD",169,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLUD",170,0)
 D VNURSE^PSBVDLU1("UDTAB")
"RTN","PSBVDLUD",171,0)
 D CLEAN^PSBVT
"RTN","PSBVDLUD",172,0)
 Q
"RTN","PSBVDLUD",173,0)
 ;
"VER")
8.0^22.0
**END**
**END**
