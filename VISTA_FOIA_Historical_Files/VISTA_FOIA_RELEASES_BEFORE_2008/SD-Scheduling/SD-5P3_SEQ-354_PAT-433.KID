Released SD*5.3*433 SEQ #354
Extracted from mail message
**KIDS**:SD*5.3*433^

**INSTALL NAME**
SD*5.3*433
"BLD",6101,0)
SD*5.3*433^SCHEDULING^0^3050729^y
"BLD",6101,1,0)
^^3^3^3050729^
"BLD",6101,1,1,0)
Associated Clinic not printing on Practitioner's Patients and Team 
"BLD",6101,1,2,0)
Patient Listing reports.  This patch will also back out changes made in 
"BLD",6101,1,3,0)
patch 432.
"BLD",6101,4,0)
^9.64PA^^
"BLD",6101,"ABPKG")
n
"BLD",6101,"KRN",0)
^9.67PA^8989.52^19
"BLD",6101,"KRN",.4,0)
.4
"BLD",6101,"KRN",.401,0)
.401
"BLD",6101,"KRN",.402,0)
.402
"BLD",6101,"KRN",.403,0)
.403
"BLD",6101,"KRN",.5,0)
.5
"BLD",6101,"KRN",.84,0)
.84
"BLD",6101,"KRN",3.6,0)
3.6
"BLD",6101,"KRN",3.8,0)
3.8
"BLD",6101,"KRN",9.2,0)
9.2
"BLD",6101,"KRN",9.8,0)
9.8
"BLD",6101,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6101,"KRN",9.8,"NM",1,0)
SCRPTP3^^0^B26975202
"BLD",6101,"KRN",9.8,"NM",2,0)
SCRPPAT2^^0^B28106328
"BLD",6101,"KRN",9.8,"NM",3,0)
SCRPU3^^0^B19204612
"BLD",6101,"KRN",9.8,"NM","B","SCRPPAT2",2)

"BLD",6101,"KRN",9.8,"NM","B","SCRPTP3",1)

"BLD",6101,"KRN",9.8,"NM","B","SCRPU3",3)

"BLD",6101,"KRN",19,0)
19
"BLD",6101,"KRN",19.1,0)
19.1
"BLD",6101,"KRN",101,0)
101
"BLD",6101,"KRN",409.61,0)
409.61
"BLD",6101,"KRN",771,0)
771
"BLD",6101,"KRN",870,0)
870
"BLD",6101,"KRN",8989.51,0)
8989.51
"BLD",6101,"KRN",8989.52,0)
8989.52
"BLD",6101,"KRN",8994,0)
8994
"BLD",6101,"KRN","B",.4,.4)

"BLD",6101,"KRN","B",.401,.401)

"BLD",6101,"KRN","B",.402,.402)

"BLD",6101,"KRN","B",.403,.403)

"BLD",6101,"KRN","B",.5,.5)

"BLD",6101,"KRN","B",.84,.84)

"BLD",6101,"KRN","B",3.6,3.6)

"BLD",6101,"KRN","B",3.8,3.8)

"BLD",6101,"KRN","B",9.2,9.2)

"BLD",6101,"KRN","B",9.8,9.8)

"BLD",6101,"KRN","B",19,19)

"BLD",6101,"KRN","B",19.1,19.1)

"BLD",6101,"KRN","B",101,101)

"BLD",6101,"KRN","B",409.61,409.61)

"BLD",6101,"KRN","B",771,771)

"BLD",6101,"KRN","B",870,870)

"BLD",6101,"KRN","B",8989.51,8989.51)

"BLD",6101,"KRN","B",8989.52,8989.52)

"BLD",6101,"KRN","B",8994,8994)

"BLD",6101,"QUES",0)
^9.62^^
"BLD",6101,"REQB",0)
^9.611^2^2
"BLD",6101,"REQB",1,0)
SD*5.3*231^1
"BLD",6101,"REQB",2,0)
SD*5.3*432^1
"BLD",6101,"REQB","B","SD*5.3*231",1)

"BLD",6101,"REQB","B","SD*5.3*432",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
433^3050729
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3050729
"PKG",16,22,1,"PAH",1,1,1,0)
Associated Clinic not printing on Practitioner's Patients and Team 
"PKG",16,22,1,"PAH",1,1,2,0)
Patient Listing reports.  This patch will also back out changes made in 
"PKG",16,22,1,"PAH",1,1,3,0)
patch 432.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SCRPPAT2")
0^2^B28106328
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ; 12/12/00 3:46pm
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48,174,181,177,231,433**;AUG 13, 1993
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCRPPAT2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCRPPAT2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",13,0)
 S NXT=0
"RTN","SCRPPAT2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCRPPAT2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCRPPAT2",17,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",19,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCRPPAT2",22,0)
 K:SUMM @STORE@("PT")
"RTN","SCRPPAT2",23,0)
 Q
"RTN","SCRPPAT2",24,0)
 ;
"RTN","SCRPPAT2",25,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",26,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",27,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",28,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,CNAME,PTA,PTAN,TIEN
"RTN","SCRPPAT2",29,0)
 N PC,TNODE,TNAME,PINF,POSN,PRCP
"RTN","SCRPPAT2",30,0)
 S NXT=0
"RTN","SCRPPAT2",31,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",32,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",33,0)
 .Q:NODE=""
"RTN","SCRPPAT2",34,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",35,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",36,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",37,0)
 .Q:PTP=""
"RTN","SCRPPAT2",38,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",39,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",40,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",41,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",42,0)
 .I $G(TEAM)'=1,'$D(TEAM(TIEN)) Q  ;not a selected team
"RTN","SCRPPAT2",43,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",44,0)
 .Q:TNODE=""  I $G(INST)'=1,'$D(INST(+$P(TNODE,U,7))) Q
"RTN","SCRPPAT2",45,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",46,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",47,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",48,0)
 .Q:TPN=""
"RTN","SCRPPAT2",49,0)
 .I $G(ROLE)'=1,'$D(ROLE(+$P(TPN,U,3))) Q  ;not a selected role
"RTN","SCRPPAT2",50,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",51,0)
 .S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",52,0)
 .;commented next line off - clinic enrollment no longer needed SD*5.3*433
"RTN","SCRPPAT2",53,0)
 .;D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",54,0)
 .S CNAME=$P($G(^SC(CLIEN,0)),"^")  ; SD*5.3*433 remove enroll check
"RTN","SCRPPAT2",55,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",56,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",57,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",58,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPI,DT),U,2)
"RTN","SCRPPAT2",59,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN,1)
"RTN","SCRPPAT2",60,0)
 .;$$PDATA returns pt name,pid,mt,pelig,status,status date,last appt,nxt appt
"RTN","SCRPPAT2",61,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;formats data for display
"RTN","SCRPPAT2",62,0)
 Q
"RTN","SCRPPAT2",63,0)
 ;
"RTN","SCRPPAT2",64,0)
CECHK(CLIEN,CNAME,PIEN) ;
"RTN","SCRPPAT2",65,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",66,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",67,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",68,0)
 ;
"RTN","SCRPPAT2",69,0)
 N EN,NODE
"RTN","SCRPPAT2",70,0)
 S CNAME=""
"RTN","SCRPPAT2",71,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",72,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",73,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",74,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",75,0)
 .Q:NODE=""
"RTN","SCRPPAT2",76,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",77,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",78,0)
 Q
"RTN","SCRPPAT2",79,0)
 ;
"RTN","SCRPPAT2",80,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCRPPAT2",81,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",82,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",83,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",84,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",85,0)
 ;TNAME - team name
"RTN","SCRPPAT2",86,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",87,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",88,0)
 ;POSN - position name
"RTN","SCRPPAT2",89,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",90,0)
 ;PRCP - preceptor name
"RTN","SCRPPAT2",91,0)
 ;
"RTN","SCRPPAT2",92,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",93,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",94,0)
 I ERR Q
"RTN","SCRPPAT2",95,0)
 ;
"RTN","SCRPPAT2",96,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",97,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",98,0)
 Q
"RTN","SCRPPAT2",99,0)
 ;
"RTN","SCRPPAT2",100,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI) ;
"RTN","SCRPPAT2",101,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",102,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",103,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",104,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",105,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",106,0)
 ;TNAME - team name
"RTN","SCRPPAT2",107,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",108,0)
 ;
"RTN","SCRPPAT2",109,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",110,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",111,0)
 S PTNAME=$E($P(PINF,"^",2),1,15) ;patient name
"RTN","SCRPPAT2",112,0)
 Q:$D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN))
"RTN","SCRPPAT2",113,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",114,0)
 ;
"RTN","SCRPPAT2",115,0)
 I 'SUMM,'$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",116,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",117,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",118,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",119,0)
 ;
"RTN","SCRPPAT2",120,0)
 S @STORE@("TOTAL",IIEN,PRAC,TIEN,TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,TIEN,TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",121,0)
 Q:SUMM
"RTN","SCRPPAT2",122,0)
 ;
"RTN","SCRPPAT2",123,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",124,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",125,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),18)=$E(PID,6,10) ;last 4 pid - 5 places is for any pseudo
"RTN","SCRPPAT2",126,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",127,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",128,0)
 ;Removed by patch 174
"RTN","SCRPPAT2",129,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",130,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",131,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",132,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",133,0)
 Q
"RTN","SCRPTP3")
0^1^B26975202
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48,98,177,231,433**;AUG 13, 1993
"RTN","SCRPTP3",3,0)
 ;
"RTN","SCRPTP3",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",5,0)
 ;
"RTN","SCRPTP3",6,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",7,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",8,0)
 ;TIEN - team ien
"RTN","SCRPTP3",9,0)
 ;
"RTN","SCRPTP3",10,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",11,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",12,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR,PCAP,ROLN
"RTN","SCRPTP3",13,0)
 S INACTIVE=0
"RTN","SCRPTP3",14,0)
 S NXT=0
"RTN","SCRPTP3",15,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",16,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",17,0)
 .Q:NODE=""
"RTN","SCRPTP3",18,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",19,0)
 .S PTNAME=$P(NODE,"^",2) ;patient name
"RTN","SCRPTP3",20,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",21,0)
 .;
"RTN","SCRPTP3",22,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",23,0)
 .Q:PNODE=""
"RTN","SCRPTP3",24,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",25,0)
 .D PID^VADPT6
"RTN","SCRPTP3",26,0)
 .S PID=VA("BID")
"RTN","SCRPTP3",27,0)
 .;
"RTN","SCRPTP3",28,0)
 .S TPA=$$TPAR(PTAI,"")
"RTN","SCRPTP3",29,0)
 .I TPA'=-1 D
"RTN","SCRPTP3",30,0)
 ..S PIEN=$P(TPA,"^")
"RTN","SCRPTP3",31,0)
 ..S PNAME=$P(TPA,"^",2)
"RTN","SCRPTP3",32,0)
 ..S CNAME=$P(TPA,"^",3)
"RTN","SCRPTP3",33,0)
 ..S LAST=$P(TPA,"^",4)
"RTN","SCRPTP3",34,0)
 ..S NEXT=$P(TPA,"^",5)
"RTN","SCRPTP3",35,0)
 ..;
"RTN","SCRPTP3",36,0)
 ..S FLAG="Y"
"RTN","SCRPTP3",37,0)
 ..S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",38,0)
 ..S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",39,0)
 ..S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",40,0)
 ..S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",41,0)
 ..S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",42,0)
 ..S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",43,0)
 ..;
"RTN","SCRPTP3",44,0)
 ..D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",45,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",46,0)
 .;
"RTN","SCRPTP3",47,0)
 .;check for other assignments
"RTN","SCRPTP3",48,0)
 .N TPIN
"RTN","SCRPTP3",49,0)
 .S CNT=""
"RTN","SCRPTP3",50,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",51,0)
 ..S TPIN=$$TPAR(PTAI,CNT)
"RTN","SCRPTP3",52,0)
 ..Q:TPIN=-1
"RTN","SCRPTP3",53,0)
 ..S PIEN=$P(TPIN,"^")
"RTN","SCRPTP3",54,0)
 ..S PNAME=$P(TPIN,"^",2)
"RTN","SCRPTP3",55,0)
 ..S CNAME=$P(TPIN,"^",3)
"RTN","SCRPTP3",56,0)
 ..S LAST=$P(TPIN,"^",4)
"RTN","SCRPTP3",57,0)
 ..S NEXT=$P(TPIN,"^",5)
"RTN","SCRPTP3",58,0)
 ..S ROLN=$P(TPIN,U,6)
"RTN","SCRPTP3",59,0)
 ..S PCAP=$P(TPIN,U,7)
"RTN","SCRPTP3",60,0)
 ..I '$D(FLAG) D
"RTN","SCRPTP3",61,0)
 ...S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",62,0)
 ...S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",63,0)
 ...S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",64,0)
 ...S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",65,0)
 ...S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",66,0)
 ...S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",67,0)
 ...;
"RTN","SCRPTP3",68,0)
 ...D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",69,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT,ROLN,PCAP)
"RTN","SCRPTP3",70,0)
 I INACTIVE S @STORE@(INST,TIEN,"INACT")=""
"RTN","SCRPTP3",71,0)
 Q
"RTN","SCRPTP3",72,0)
 ;
"RTN","SCRPTP3",73,0)
TPAR(PTAI,START) ;
"RTN","SCRPTP3",74,0)
 N PTPA,TPIEN,TPNODE,ROL,CNAME,CIEN,ENROLL,OKAY,PNAME,NEXT,LAST,PAIEN
"RTN","SCRPTP3",75,0)
 N ROLN,PCAP
"RTN","SCRPTP3",76,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",77,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",78,0)
 IF START="" D
"RTN","SCRPTP3",79,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",80,0)
 ELSE  D
"RTN","SCRPTP3",81,0)
 .S PTPA=START
"RTN","SCRPTP3",82,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",83,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0)) ;patient team position assignment node
"RTN","SCRPTP3",84,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",85,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",86,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",87,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",88,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",89,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",90,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",91,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",92,0)
 ; ^ not a selected role
"RTN","SCRPTP3",93,0)
 S ROLN=$P($G(^SD(403.46,ROL,0)),U) ;role name
"RTN","SCRPTP3",94,0)
 ;
"RTN","SCRPTP3",95,0)
 S PCAP=$S($P(PTPAN,U,5)<1:"NPC",+$$OKPREC3^SCMCLK(TPIEN,DT)>0:" AP",1:"PCP") ;PC?
"RTN","SCRPTP3",96,0)
 ;
"RTN","SCRPTP3",97,0)
 S CIEN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTP3",98,0)
 S CNAME=$P($G(^SC(CIEN,0)),"^") ;clinic name
"RTN","SCRPTP3",99,0)
 ;check patient status
"RTN","SCRPTP3",100,0)
 S OKAY=""
"RTN","SCRPTP3",101,0)
 I CIEN>0&(PSTAT'=1) S OKAY=$$PST^SCRPTP(PTIEN,CIEN)
"RTN","SCRPTP3",102,0)
 Q:(CIEN>0)&('OKAY)&(PSTAT'=1) -1
"RTN","SCRPTP3",103,0)
 ; ^ not selected patient status
"RTN","SCRPTP3",104,0)
 ;
"RTN","SCRPTP3",105,0)
 ;next two lines commented off - SD*5.3*433
"RTN","SCRPTP3",106,0)
 ;S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",107,0)
 ;I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",108,0)
 ;
"RTN","SCRPTP3",109,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",110,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",111,0)
 ;SD*5.3*231
"RTN","SCRPTP3",112,0)
 I +PAIEN=0 S PIEN=0,PNAME="[Inactive Position]"
"RTN","SCRPTP3",113,0)
 ;
"RTN","SCRPTP3",114,0)
 S (NEXT,LAST)=""
"RTN","SCRPTP3",115,0)
 I +CIEN>0 S NEXT=$$GETNEXT^SCRPU3(PTIEN,CIEN) ;next appointment
"RTN","SCRPTP3",116,0)
 I +CIEN>0 S LAST=$$GETLAST^SCRPU3(PTIEN,CIEN) ;last appointment
"RTN","SCRPTP3",117,0)
 ;
"RTN","SCRPTP3",118,0)
 Q PIEN_U_PNAME_U_CNAME_U_LAST_U_NEXT_U_ROLN_U_PCAP
"RTN","SCRPTP3",119,0)
 ;
"RTN","SCRPTP3",120,0)
ENRL(PTIEN,CLIEN) ;
"RTN","SCRPTP3",121,0)
 ;
"RTN","SCRPTP3",122,0)
 N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",123,0)
 S FOUND=0
"RTN","SCRPTP3",124,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",125,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",126,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",127,0)
 S NXT=""
"RTN","SCRPTP3",128,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",129,0)
 .;check if active enrollment
"RTN","SCRPTP3",130,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",131,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",132,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",133,0)
 .S FOUND=1
"RTN","SCRPTP3",134,0)
 Q FOUND
"RTN","SCRPTP3",135,0)
 ;
"RTN","SCRPTP3",136,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",137,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",138,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",139,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",140,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",141,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",142,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",143,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",144,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",145,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",146,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",147,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",148,0)
 ;
"RTN","SCRPU3")
0^3^B19204612
"RTN","SCRPU3",1,0)
SCRPU3 ;ALB/CMM - GENERIC UTILITIES ; 29 Jun 99  04:11PM
"RTN","SCRPU3",2,0)
 ;;5.3;Scheduling;**41,45,52,140,181,177,432,433**;AUG 13, 1993
"RTN","SCRPU3",3,0)
 ;
"RTN","SCRPU3",4,0)
ELIG(DFN) ;
"RTN","SCRPU3",5,0)
 ;Gets Primary Eligibility
"RTN","SCRPU3",6,0)
 N PRIM
"RTN","SCRPU3",7,0)
 I '$D(^DPT(DFN,.36)) Q 0
"RTN","SCRPU3",8,0)
 I '$D(^DIC(8,+$P(^DPT(DFN,.36),"^"),0)) Q 0
"RTN","SCRPU3",9,0)
 S PRIM=$P($G(^DIC(8,$P($G(^DPT(DFN,.36)),"^"),0)),"^",9)
"RTN","SCRPU3",10,0)
 ;MAS Primary Eligibility Code
"RTN","SCRPU3",11,0)
 S PRIM=$P($G(^DIC(8.1,PRIM,0)),"^")
"RTN","SCRPU3",12,0)
 ;
"RTN","SCRPU3",13,0)
 S PRIM=$TR(PRIM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SCRPU3",14,0)
 I PRIM="NON-SERVICE CONNECTED" S PRIM="NSC"
"RTN","SCRPU3",15,0)
 I PRIM["SERVICE CONNECTED" S PRIM=$P(PRIM,"SERVICE CONNECTED")_"SC"_$P(PRIM,"SERVICE CONNECTED",2,999)
"RTN","SCRPU3",16,0)
 I PRIM["LESS THAN" S PRIM=$P(PRIM,"LESS THAN")_"<"_$P(PRIM,"LESS THAN",2,999)
"RTN","SCRPU3",17,0)
 I PRIM[" TO " S PRIM=$P(PRIM," TO ")_"-"_$P(PRIM," TO ",2,999)
"RTN","SCRPU3",18,0)
 I PRIM["%" S PRIM=$TR(PRIM,"%","")
"RTN","SCRPU3",19,0)
 S PRIM=$E(PRIM,1,9)
"RTN","SCRPU3",20,0)
 Q PRIM
"RTN","SCRPU3",21,0)
 ;
"RTN","SCRPU3",22,0)
GETNEXT(DFN,CLN) ;
"RTN","SCRPU3",23,0)
 ;Get next appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",24,0)
 ;Returning the date in 00/00/0000 format
"RTN","SCRPU3",25,0)
 N NEXT,APPT,FOUND
"RTN","SCRPU3",26,0)
 S APPT=DT,FOUND=0,NEXT=""
"RTN","SCRPU3",27,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT)) Q:APPT=""!(FOUND)  D
"RTN","SCRPU3",28,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0))&($P(^DPT(DFN,"S",APPT,0),"^",2)'["C") S FOUND=1,NEXT=$TR($$FMTE^XLFDT(APPT,"5DF")," ","0")
"RTN","SCRPU3",29,0)
 Q NEXT
"RTN","SCRPU3",30,0)
 ;
"RTN","SCRPU3",31,0)
GETLAST(DFN,CLN) ;
"RTN","SCRPU3",32,0)
 ;Get last appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",33,0)
 ;Returning the date in 00/00/0000 format
"RTN","SCRPU3",34,0)
 N LAST,APPT,FOUND,STATUS
"RTN","SCRPU3",35,0)
 S APPT=DT,FOUND=0,LAST=""
"RTN","SCRPU3",36,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT),-1) Q:APPT=""!(APPT=0)!(FOUND)  D
"RTN","SCRPU3",37,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0)) S STATUS=$P(^DPT(DFN,"S",APPT,0),"^",2) D
"RTN","SCRPU3",38,0)
 ..I STATUS=""!("NAPCA"'[STATUS) S FOUND=1,LAST=$TR($$FMTE^XLFDT(APPT,"5DF")," ","0")
"RTN","SCRPU3",39,0)
 ..Q
"RTN","SCRPU3",40,0)
 .Q
"RTN","SCRPU3",41,0)
 Q LAST
"RTN","SCRPU3",42,0)
 ;
"RTN","SCRPU3",43,0)
PDEVICE() ;
"RTN","SCRPU3",44,0)
 ;Generic Printer Call
"RTN","SCRPU3",45,0)
 N TION,POP
"RTN","SCRPU3",46,0)
 S %ZIS="QN" D ^%ZIS K %ZIS Q:POP!(ION="^") -1
"RTN","SCRPU3",47,0)
 S TION=ION
"RTN","SCRPU3",48,0)
 I $D(IO("Q")) S TION="Q;"_TION
"RTN","SCRPU3",49,0)
 Q TION_"^"_IOST
"RTN","SCRPU3",50,0)
 ;
"RTN","SCRPU3",51,0)
GETTIME() ;
"RTN","SCRPU3",52,0)
 ;Prompt for Queue Time
"RTN","SCRPU3",53,0)
 N X,Y
"RTN","SCRPU3",54,0)
 S DIR(0)="D^::RFE",DIR("A")="Start Time",DIR("B")="NOW"
"RTN","SCRPU3",55,0)
 D ^DIR
"RTN","SCRPU3",56,0)
 I $D(DTOUT)!(X="") S Y=$H
"RTN","SCRPU3",57,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCRPU3",58,0)
 K DIR,DTOUT,DUOUT,DIROUT
"RTN","SCRPU3",59,0)
 Q Y
"RTN","SCRPU3",60,0)
 ;
"RTN","SCRPU3",61,0)
HOLD(PAGE,TIT,MARG) ;
"RTN","SCRPU3",62,0)
 ;device is home, reached end of page
"RTN","SCRPU3",63,0)
 N X
"RTN","SCRPU3",64,0)
 S MARG=$G(MARG) S:MARG'>80 MARG=80
"RTN","SCRPU3",65,0)
 W !!,"Press Any Key to Continue or '^' to Quit" R X:DTIME
"RTN","SCRPU3",66,0)
 I '$T!(X="^") S STOP=1 Q
"RTN","SCRPU3",67,0)
 D NEWP1(.PAGE,TIT,MARG)
"RTN","SCRPU3",68,0)
 Q
"RTN","SCRPU3",69,0)
 ;
"RTN","SCRPU3",70,0)
NEWP1(PAGE,TITL,MARG) ;
"RTN","SCRPU3",71,0)
 ;new page
"RTN","SCRPU3",72,0)
 ;
"RTN","SCRPU3",73,0)
 S MARG=$G(MARG) S:MARG'>80 MARG=80
"RTN","SCRPU3",74,0)
 D STOPCHK^DGUTL
"RTN","SCRPU3",75,0)
 I $G(STOP) D STOPPED^DGUTL Q
"RTN","SCRPU3",76,0)
 W:PAGE>0 @IOF
"RTN","SCRPU3",77,0)
 S PAGE=PAGE+1
"RTN","SCRPU3",78,0)
 D TITLE(PAGE,TITL,MARG)
"RTN","SCRPU3",79,0)
 Q
"RTN","SCRPU3",80,0)
 ;
"RTN","SCRPU3",81,0)
TITLE(PG,TITL,MARG) ;
"RTN","SCRPU3",82,0)
 N PDATE,SCX,SCI
"RTN","SCRPU3",83,0)
 S MARG=$G(MARG) S:MARG'>80 MARG=80
"RTN","SCRPU3",84,0)
 S PDATE=$$FMTE^XLFDT(DT,"5D")
"RTN","SCRPU3",85,0)
 S SCI=(IOM-$L(TITL)\2) S:SCI<24 SCI=24
"RTN","SCRPU3",86,0)
 S SCX="Printed on: "_PDATE
"RTN","SCRPU3",87,0)
 S $E(SCX,SCI)=TITL
"RTN","SCRPU3",88,0)
 S $E(SCX,(IOM-6-$L(PG)))="Page: "_PG
"RTN","SCRPU3",89,0)
 W SCX,!
"RTN","SCRPU3",90,0)
 Q
"RTN","SCRPU3",91,0)
 ;
"RTN","SCRPU3",92,0)
CLOSE ;close device
"RTN","SCRPU3",93,0)
 D:$E(IOST)'="C" ^%ZISC
"RTN","SCRPU3",94,0)
 Q
"RTN","SCRPU3",95,0)
 ;
"RTN","SCRPU3",96,0)
OPEN ;opens device
"RTN","SCRPU3",97,0)
 IF IOST?1"C-".E D  Q  ;%zis has already been called via $$pdevice
"RTN","SCRPU3",98,0)
 .W @IOF
"RTN","SCRPU3",99,0)
 D ^%ZIS
"RTN","SCRPU3",100,0)
 Q:POP
"RTN","SCRPU3",101,0)
 U IO
"RTN","SCRPU3",102,0)
 Q
"RTN","SCRPU3",103,0)
 ;
"RTN","SCRPU3",104,0)
NODATA(TITL) ;
"RTN","SCRPU3",105,0)
 ;no data to print
"RTN","SCRPU3",106,0)
 ;returns 1
"RTN","SCRPU3",107,0)
 D OPEN
"RTN","SCRPU3",108,0)
 D TITLE(1,TITL)
"RTN","SCRPU3",109,0)
 W !,"No data to report"
"RTN","SCRPU3",110,0)
 D CLOSE
"RTN","SCRPU3",111,0)
 Q 1
"RTN","SCRPU3",112,0)
 ;
"RTN","SCRPU3",113,0)
HELP W:'$D(VAUTNA) !,"ENTER:",!?5,"- A or ALL for all ",VAUTSTR,"s, or"
"RTN","SCRPU3",114,0)
 W:($D(VAUTTN))&(VAUTSTR="TEAM") !?5,"- N or NOT for not assigned to a team or"
"RTN","SCRPU3",115,0)
 W:($D(VAUTPO))&(VAUTSTR="PRACTITIONER") !?5,"- N or NONE or NOT for not assigned to a Practitioner"
"RTN","SCRPU3",116,0)
 W !?5,"- Select individual "_VAUTSTR W:'$D(VAUTPO) " -- limit 20"
"RTN","SCRPU3",117,0)
 W !?5,"Imprecise selections will yield an additional prompt."
"RTN","SCRPU3",118,0)
 I $O(@VAUTVB@(0))]"" W !?5,"- An entry preceeded by a minus [-] sign to remove entry from list."
"RTN","SCRPU3",119,0)
 I $O(@VAUTVB@(0))]"" W !,"NOTE, you have already selected:" S VAJ=0 F VAJ1=0:0 S VAJ=$O(@VAUTVB@(VAJ)) Q:VAJ=""  W !?8,$S(VAUTNI=1:VAJ,1:@VAUTVB@(VAJ))
"RTN","SCRPU3",120,0)
 Q
"RTN","SCRPU3",121,0)
 ;
"RTN","SCRPU3",122,0)
CONV(ORIGA,NEWA) ;
"RTN","SCRPU3",123,0)
 ;ORIGA - original array - name(ien)=data
"RTN","SCRPU3",124,0)
 ;NEWA - new array - name(n)=ien^data
"RTN","SCRPU3",125,0)
 ;
"RTN","SCRPU3",126,0)
 N ENT,CNT
"RTN","SCRPU3",127,0)
 S ENT=0,CNT=0
"RTN","SCRPU3",128,0)
 S NEWA=ORIGA
"RTN","SCRPU3",129,0)
 F  S ENT=$O(ORIGA(ENT)) Q:ENT=""!(ENT'?.N)  D
"RTN","SCRPU3",130,0)
 .S CNT=CNT+1
"RTN","SCRPU3",131,0)
 .S NEWA(CNT)=ENT_"^"_ORIGA(ENT)
"RTN","SCRPU3",132,0)
 Q
"VER")
8.0^22.0
"BLD",6101,6)
^SEQ #354
**END**
**END**
