Released SD*5.3*243 SEQ #255
Extracted from mail message
**KIDS**:SD*5.3*243^

**INSTALL NAME**
SD*5.3*243
"BLD",3793,0)
SD*5.3*243^SCHEDULING^0^3030218^y
"BLD",3793,1,0)
^^10^10^3030218^
"BLD",3793,1,1,0)
SCRPW24:
"BLD",3793,1,2,0)
Modified linetag ENES to call FileMan API EXTERNAL^DILFD.
"BLD",3793,1,3,0)
Modified linetag ENROL to remove the statement- Q:X>366 "".
"BLD",3793,1,4,0)
 
"BLD",3793,1,5,0)
SCRPW43:
"BLD",3793,1,6,0)
Corrected enrollment priority selection list at SCAT+10, adding a zero 
"BLD",3793,1,7,0)
back in front of 'No Enrollment'.
"BLD",3793,1,8,0)
 
"BLD",3793,1,9,0)
SDCLAS & SDCLAS1:
"BLD",3793,1,10,0)
Added logic to handle GMT Copay Status.
"BLD",3793,4,0)
^9.64PA^^
"BLD",3793,"ABPKG")
n
"BLD",3793,"KRN",0)
^9.67PA^19^17
"BLD",3793,"KRN",.4,0)
.4
"BLD",3793,"KRN",.401,0)
.401
"BLD",3793,"KRN",.402,0)
.402
"BLD",3793,"KRN",.403,0)
.403
"BLD",3793,"KRN",.5,0)
.5
"BLD",3793,"KRN",.84,0)
.84
"BLD",3793,"KRN",3.6,0)
3.6
"BLD",3793,"KRN",3.8,0)
3.8
"BLD",3793,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",3793,"KRN",9.2,0)
9.2
"BLD",3793,"KRN",9.8,0)
9.8
"BLD",3793,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",3793,"KRN",9.8,"NM",1,0)
SCRPW24^^0^B72576733
"BLD",3793,"KRN",9.8,"NM",2,0)
SDCLAS^^0^B18724083
"BLD",3793,"KRN",9.8,"NM",3,0)
SDCLAS1^^0^B22892302
"BLD",3793,"KRN",9.8,"NM",4,0)
SCRPW43^^0^B51211017
"BLD",3793,"KRN",9.8,"NM","B","SCRPW24",1)

"BLD",3793,"KRN",9.8,"NM","B","SCRPW43",4)

"BLD",3793,"KRN",9.8,"NM","B","SDCLAS",2)

"BLD",3793,"KRN",9.8,"NM","B","SDCLAS1",3)

"BLD",3793,"KRN",19,0)
19
"BLD",3793,"KRN",19,"NM",0)
^9.68A^^
"BLD",3793,"KRN",19.1,0)
19.1
"BLD",3793,"KRN",101,0)
101
"BLD",3793,"KRN",409.61,0)
409.61
"BLD",3793,"KRN",771,0)
771
"BLD",3793,"KRN",870,0)
870
"BLD",3793,"KRN",8994,0)
8994
"BLD",3793,"KRN","B",.4,.4)

"BLD",3793,"KRN","B",.401,.401)

"BLD",3793,"KRN","B",.402,.402)

"BLD",3793,"KRN","B",.403,.403)

"BLD",3793,"KRN","B",.5,.5)

"BLD",3793,"KRN","B",.84,.84)

"BLD",3793,"KRN","B",3.6,3.6)

"BLD",3793,"KRN","B",3.8,3.8)

"BLD",3793,"KRN","B",9.2,9.2)

"BLD",3793,"KRN","B",9.8,9.8)

"BLD",3793,"KRN","B",19,19)

"BLD",3793,"KRN","B",19.1,19.1)

"BLD",3793,"KRN","B",101,101)

"BLD",3793,"KRN","B",409.61,409.61)

"BLD",3793,"KRN","B",771,771)

"BLD",3793,"KRN","B",870,870)

"BLD",3793,"KRN","B",8994,8994)

"BLD",3793,"QUES",0)
^9.62^^
"BLD",3793,"REQB",0)
^9.611^1^1
"BLD",3793,"REQB",1,0)
SD*5.3*258^2
"BLD",3793,"REQB","B","SD*5.3*258",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
243^3030218^123456872
"PKG",16,22,1,"PAH",1,1,0)
^^10^10^3030218
"PKG",16,22,1,"PAH",1,1,1,0)
SCRPW24:
"PKG",16,22,1,"PAH",1,1,2,0)
Modified linetag ENES to call FileMan API EXTERNAL^DILFD.
"PKG",16,22,1,"PAH",1,1,3,0)
Modified linetag ENROL to remove the statement- Q:X>366 "".
"PKG",16,22,1,"PAH",1,1,4,0)
 
"PKG",16,22,1,"PAH",1,1,5,0)
SCRPW43:
"PKG",16,22,1,"PAH",1,1,6,0)
Corrected enrollment priority selection list at SCAT+10, adding a zero 
"PKG",16,22,1,"PAH",1,1,7,0)
back in front of 'No Enrollment'.
"PKG",16,22,1,"PAH",1,1,8,0)
 
"PKG",16,22,1,"PAH",1,1,9,0)
SDCLAS & SDCLAS1:
"PKG",16,22,1,"PAH",1,1,10,0)
Added logic to handle GMT Copay Status.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SCRPW24")
0^1^B72576733
"RTN","SCRPW24",1,0)
SCRPW24 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;06/19/99
"RTN","SCRPW24",2,0)
 ;;5.3;Scheduling;**144,163,180,254,243**;AUG 13, 1993
"RTN","SCRPW24",3,0)
 ;06/19/99 ACS - Added CPT modifier API calls
"RTN","SCRPW24",4,0)
 ;
"RTN","SCRPW24",5,0)
APAC(SDX) ;Get all procedure codes
"RTN","SCRPW24",6,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U),SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U)_U_$P(SDY(SDI),U,16) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",7,0)
 D APAC^SCRPW241(.SDX)
"RTN","SCRPW24",8,0)
 D NX Q
"RTN","SCRPW24",9,0)
 ;
"RTN","SCRPW24",10,0)
APOTR ;Transform procedure external value
"RTN","SCRPW24",11,0)
 ;S $P(SDX,U,2)=$P(SDX,U,2)_" "_$P(^ICPT(+SDX,0),U,2) Q
"RTN","SCRPW24",12,0)
 D APOTR^SCRPW241(.SDX)
"RTN","SCRPW24",13,0)
 Q
"RTN","SCRPW24",14,0)
 ;
"RTN","SCRPW24",15,0)
APAP(SDX) ;Get ambulatory procedures (no E&M codes)
"RTN","SCRPW24",16,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I '$D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",17,0)
 D APAP^SCRPW241(.SDX)
"RTN","SCRPW24",18,0)
 D NX Q
"RTN","SCRPW24",19,0)
 ;
"RTN","SCRPW24",20,0)
APEM(SDX) ;Get evaluation and management codes
"RTN","SCRPW24",21,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I $D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",22,0)
 D APEM^SCRPW241(.SDX)
"RTN","SCRPW24",23,0)
 D NX Q
"RTN","SCRPW24",24,0)
 ;
"RTN","SCRPW24",25,0)
CLCG(SDX) ;Get clinic group
"RTN","SCRPW24",26,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,31) I SDX,$D(^SD(409.67,SDX)) S SDX=SDX_U_$P(^SD(409.67,SDX,0),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",27,0)
 D NX Q
"RTN","SCRPW24",28,0)
 ;
"RTN","SCRPW24",29,0)
CLCN(SDX) ;Get clinic name
"RTN","SCRPW24",30,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=SDX_U_$P($G(^SC(SDX,0)),U) I $L($P(SDX,U,2)) S SDX(1)=SDX
"RTN","SCRPW24",31,0)
 D NX Q
"RTN","SCRPW24",32,0)
 ;
"RTN","SCRPW24",33,0)
CLCS(SDX) ;Get clinic service
"RTN","SCRPW24",34,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,8) D FST(.SDX,44,9) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",35,0)
 D NX Q
"RTN","SCRPW24",36,0)
 ;
"RTN","SCRPW24",37,0)
DXAD(SDX) ;Get all diagnoses
"RTN","SCRPW24",38,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX S SDX=SDX_U_$P($G(^ICD9(+SDX,0)),U) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",39,0)
 D NX Q
"RTN","SCRPW24",40,0)
 ;
"RTN","SCRPW24",41,0)
DXOTR ;Transform diagnosis external value
"RTN","SCRPW24",42,0)
 S SDX=SDX_" "_$P(^ICD9(+SDX,0),U,3) Q
"RTN","SCRPW24",43,0)
 ;
"RTN","SCRPW24",44,0)
DXGS(SDX,SDZ) ;Get GAF score
"RTN","SCRPW24",45,0)
 K SDX N SDI,SDY S SDY=$S(SDZ="H":$P($P(SDOE0,U),"."),1:DT)_.9999,SDY=9999999-SDY,SDY=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY))
"RTN","SCRPW24",46,0)
 I SDY S SDI=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY,""),-1) I SDI S SDX=+$P($G(^YSD(627.8,SDI,60)),U,3) I SDX S SDX(1)=SDX_U_SDX
"RTN","SCRPW24",47,0)
 D NX Q
"RTN","SCRPW24",48,0)
 ;
"RTN","SCRPW24",49,0)
DXGSQ(SDI) ;Set up GAF help text
"RTN","SCRPW24",50,0)
 S SDIRQ("?",1)="Specify a value representing the Global Assessment of Functioning (GAF) score."
"RTN","SCRPW24",51,0)
 I SDI="H" S SDIRQ("?")="Status as of the encounter date/time is used to determine 'historical' values."
"RTN","SCRPW24",52,0)
 I SDI="C" S SDIRQ("?")="Status as of the report run date is used to determine 'current' values."
"RTN","SCRPW24",53,0)
 Q
"RTN","SCRPW24",54,0)
 ;
"RTN","SCRPW24",55,0)
DXPD(SDX) ;Get primary diagnosis
"RTN","SCRPW24",56,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($G(^ICD9(+SDX,0)),U) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX Q
"RTN","SCRPW24",57,0)
 D NX Q
"RTN","SCRPW24",58,0)
 ;
"RTN","SCRPW24",59,0)
DXSD(SDX) ;Get secondary diagnoses
"RTN","SCRPW24",60,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($G(^ICD9(+SDX,0)),U) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",61,0)
 D NX Q
"RTN","SCRPW24",62,0)
 ;
"RTN","SCRPW24",63,0)
ENED(SDX,SDZ) ;Get enrollment date
"RTN","SCRPW24",64,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",65,0)
 D NX Q
"RTN","SCRPW24",66,0)
 ;
"RTN","SCRPW24",67,0)
ENEF(SDX,SDZ) ;Get enrollment effective date
"RTN","SCRPW24",68,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U,8) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",69,0)
 D NX Q
"RTN","SCRPW24",70,0)
 ;
"RTN","SCRPW24",71,0)
ENEP(SDX,SDZ) ;Get enrollment priority
"RTN","SCRPW24",72,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,7) D FST(.SDX,27.11,.07) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",73,0)
 D NX Q
"RTN","SCRPW24",74,0)
 ;
"RTN","SCRPW24",75,0)
ENES(SDX,SDZ) ;Get enrollment status
"RTN","SCRPW24",76,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,4),SDX=SDX_U_$$EXTERNAL^DILFD(27.11,.04,"F",SDX) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",77,0)
 D NX Q
"RTN","SCRPW24",78,0)
 ;
"RTN","SCRPW24",79,0)
ENFR(SDX,SDZ) ;Get enrollment facility received
"RTN","SCRPW24",80,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,6) I SDX S SDX=SDX_U_$P($G(^DIC(4,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",81,0)
 D NX Q
"RTN","SCRPW24",82,0)
 ;
"RTN","SCRPW24",83,0)
ENSE(SDX,SDZ) ;Get enrollment source of enrollment
"RTN","SCRPW24",84,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,3) D FST(.SDX,27.11,.03) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",85,0)
 D NX Q
"RTN","SCRPW24",86,0)
 ;
"RTN","SCRPW24",87,0)
ENQ(SDZ) ;Set up help text for enrollment
"RTN","SCRPW24",88,0)
 I SDZ="H" S SDIRQ("?")="Enrollment status as of the encounter date/time is used for 'historical' values."
"RTN","SCRPW24",89,0)
 I SDZ="C" S SDIRQ("?")="Enrollment status as of the report run date is used for 'current' values."
"RTN","SCRPW24",90,0)
 Q
"RTN","SCRPW24",91,0)
 ;
"RTN","SCRPW24",92,0)
OEAT(SDX) ;Get encounter appointment type
"RTN","SCRPW24",93,0)
 K SDX S SDX=$P(SDOE0,U,10) I SDX S SDX=SDX_U_$P($G(^SD(409.1,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",94,0)
 D NX Q
"RTN","SCRPW24",95,0)
 ;
"RTN","SCRPW24",96,0)
OEDV(SDX) ;Get encounter division
"RTN","SCRPW24",97,0)
 K SDX S SDX=$P(SDOE0,U,11) I SDX S SDX=SDX_U_$P($G(^DG(40.8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",98,0)
 D NX Q
"RTN","SCRPW24",99,0)
 ;
"RTN","SCRPW24",100,0)
OEEE(SDX) ;Get encounter eligibility
"RTN","SCRPW24",101,0)
 K SDX S SDX=$P(SDOE0,U,13) I SDX S SDX=SDX_U_$P($G(^DIC(8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",102,0)
 D NX Q
"RTN","SCRPW24",103,0)
 ;
"RTN","SCRPW24",104,0)
OEOP(SDX) ;Get encounter originating process type
"RTN","SCRPW24",105,0)
 K SDX S SDX=$P(SDOE0,U,8) D FST(.SDX,409.68,.08) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",106,0)
 D NX Q
"RTN","SCRPW24",107,0)
 ;
"RTN","SCRPW24",108,0)
OEPA(SDX) ;Get encounter patient
"RTN","SCRPW24",109,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L(VADM(1)) S SDX(1)=DFN_U_VADM(1)
"RTN","SCRPW24",110,0)
 D NX Q
"RTN","SCRPW24",111,0)
 ;
"RTN","SCRPW24",112,0)
OEES(SDX) ;Get encounter status
"RTN","SCRPW24",113,0)
 K SDX S SDX=$P(SDOE0,U,12) I SDX S SDX=SDX_U_$P($G(^SD(409.63,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",114,0)
 D NX Q
"RTN","SCRPW24",115,0)
 ;
"RTN","SCRPW24",116,0)
OETS(SDX) ;Get transmission status
"RTN","SCRPW24",117,0)
 K SDX S SDX(1)=$$STX^SCRPW8(SDOE,SDOE0) Q
"RTN","SCRPW24",118,0)
 ;
"RTN","SCRPW24",119,0)
TSQ(DIR) ;Set up DIR array for transmission status question
"RTN","SCRPW24",120,0)
 K DIR S DIR("A")="Select transmission status",DIR("?")="This value represents the transmission status of the encounter record."
"RTN","SCRPW24",121,0)
 S DIR(0)="SO^0:Not checked-out;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW24",122,0)
 Q
"RTN","SCRPW24",123,0)
 ;
"RTN","SCRPW24",124,0)
CLQ(DIR,SDZ) ;Set up DIR array for classification questions
"RTN","SCRPW24",125,0)
 K DIR S SDZ=$S(SDZ="A":"Agent Orange exposure",SDZ="I":"ionizing radiation exposure",SDZ="S":"service connected condition",1:"environmental contaminants exposure")
"RTN","SCRPW24",126,0)
 S DIR(0)="SO^1:YES;0:NO",DIR("A")="Treatment related to "_SDZ,DIR("?")="Indicates if treatment was related to "_SDZ Q
"RTN","SCRPW24",127,0)
 ;
"RTN","SCRPW24",128,0)
OECL(SDX,SDZ) ;Get classification values
"RTN","SCRPW24",129,0)
 K SDX N SDY S SDZ=$S(SDZ="A":1,SDZ="I":2,SDZ="S":3,SDZ="E":4,1:"") I SDZ D CLASK^SDCO2(SDOE,.SDY) S SDX=$P($G(SDY(SDZ)),U,2) I $L(SDX) S SDX(1)=$S(SDX=1:"1^YES",1:"0^NO")
"RTN","SCRPW24",130,0)
 D NX Q
"RTN","SCRPW24",131,0)
 ;
"RTN","SCRPW24",132,0)
OEOU(SDX) ;Get option used to create
"RTN","SCRPW24",133,0)
 K SDX S SDX=+$P(SDOE0,U,5),SDX=+$P($G(^AUPNVSIT(SDX,0)),U,24)
"RTN","SCRPW24",134,0)
 N SDY D GETS^DIQ(19,SDX,.01,"","SDY")
"RTN","SCRPW24",135,0)
 S SDX=SDX_U_SDY(19,SDX_",",.01) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",136,0)
 D NX Q
"RTN","SCRPW24",137,0)
 ;
"RTN","SCRPW24",138,0)
SUQ(DIR) ;Set up DIR() array for Scheduled/unscheduled question
"RTN","SCRPW24",139,0)
 K DIR S DIR("A")="Select outpatient activity type",DIR("?",1)="Only pre-scheduled appointments will be reflected as SCHEDULED.  All other",DIR("?",2)="types of activity (add/edits, registrations, walkins or unscheduled activity)"
"RTN","SCRPW24",140,0)
 S DIR("?")="will be reflected as UNSCHEDULED.",DIR(0)="SO^S:SCHEDULED;U:UNSCHEDULED" Q
"RTN","SCRPW24",141,0)
 ;
"RTN","SCRPW24",142,0)
OESU(SDX) ;Get scheduled/unscheduled status
"RTN","SCRPW24",143,0)
 N SDAP0 K SDX S SDX(1)=""
"RTN","SCRPW24",144,0)
 I $P(SDOE0,U,8)=1 D  Q:$L(SDX(1))
"RTN","SCRPW24",145,0)
 .S SDAP0=$G(^DPT(+$P(SDOE0,U,2),"S",+SDOE0,0))
"RTN","SCRPW24",146,0)
 .Q:$P(SDAP0,U,20)'=SDOE  Q:$P(SDAP0,U,7)=4
"RTN","SCRPW24",147,0)
 .S SDX(1)="S^SCHEDULED" Q
"RTN","SCRPW24",148,0)
 S SDX(1)="U^UNSCHEDULED" Q
"RTN","SCRPW24",149,0)
 ;
"RTN","SCRPW24",150,0)
PCPR(SDX,SDZ) ;Get primary care provider
"RTN","SCRPW24",151,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",152,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",153,0)
 D NX Q
"RTN","SCRPW24",154,0)
 ;
"RTN","SCRPW24",155,0)
PCTM(SDX,SDZ) ;Get priamry care team
"RTN","SCRPW24",156,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",157,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",158,0)
 D NX Q
"RTN","SCRPW24",159,0)
 ;
"RTN","SCRPW24",160,0)
PDPA(SDX) ;Get patient age
"RTN","SCRPW24",161,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I VADM(4)=+VADM(4) S SDX(1)=VADM(4)_U_VADM(4)
"RTN","SCRPW24",162,0)
 D NX Q
"RTN","SCRPW24",163,0)
 ;
"RTN","SCRPW24",164,0)
PDPS(SDX) ;Get patient sex
"RTN","SCRPW24",165,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L($P(VADM(5),U,2)) S SDX(1)=VADM(5)
"RTN","SCRPW24",166,0)
 D NX Q
"RTN","SCRPW24",167,0)
 ;
"RTN","SCRPW24",168,0)
PDSC(SDX) ;Get patient state/county
"RTN","SCRPW24",169,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L($P(VAPA(7),U,2)) S SDX(1)=$P(VAPA(5),U)_";"_$P(VAPA(7),U)_U_$P(VAPA(5),U,2)_" / "_$P(VAPA(7),U,2)
"RTN","SCRPW24",170,0)
 D NX Q
"RTN","SCRPW24",171,0)
 ;
"RTN","SCRPW24",172,0)
PDZC(SDX) ;Get patient zip code
"RTN","SCRPW24",173,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L(VAPA(6)) S SDX(1)=VAPA(6)_U_VAPA(6)
"RTN","SCRPW24",174,0)
 D NX Q
"RTN","SCRPW24",175,0)
 ;
"RTN","SCRPW24",176,0)
ENROL(SDATE)  ;Get enrollment record (most recent to encounter date)
"RTN","SCRPW24",177,0)
 N SDY,SDI,X1,X2,X,%Y S:SDATE#1=0 SDATE=SDATE+.9999 S SDI=0 F  S SDI=$O(^DGEN(27.11,"C",+$P(SDOE0,U,2),SDI)) Q:'SDI  S SDY=$G(^DGEN(27.11,SDI,0)),SDY(+SDY)=SDY
"RTN","SCRPW24",178,0)
 S SDI=$O(SDY(SDATE),-1) Q:'SDI ""  S X1=$P($P(SDOE0,U),"."),X2=SDI D ^%DTC Q SDY(SDI)
"RTN","SCRPW24",179,0)
 ;
"RTN","SCRPW24",180,0)
NX S:$D(SDX)<10 SDX(1)="~~~NONE~~~^~~~NONE~~~" Q
"RTN","SCRPW24",181,0)
 ;
"RTN","SCRPW24",182,0)
FST(SDX,SDFI,SDFE) ;Field set transform
"RTN","SCRPW24",183,0)
 Q:'$L(SDX)  N SDY,SDI D FIELD^DID(SDFI,SDFE,"","POINTER","SDY") S SDY=SDY("POINTER") F SDI=1:1:$L(SDY,";") I SDX=$P($P(SDY,";",SDI),":") S SDX=SDX_U_$P($P(SDY,";",SDI),":",2) Q
"RTN","SCRPW24",184,0)
 Q
"RTN","SCRPW43")
0^4^B51211017
"RTN","SCRPW43",1,0)
SCRPW43 ;RENO/KEITH - Means Test/Eligibility/Enrollment Report ; 24 Aug 99  9:25 PM
"RTN","SCRPW43",2,0)
 ;;5.3;Scheduling;**144,176,199,258,243**;AUG 13, 1993
"RTN","SCRPW43",3,0)
 D ASK1^SCRPW41 Q
"RTN","SCRPW43",4,0)
 ;
"RTN","SCRPW43",5,0)
START ;Print report
"RTN","SCRPW43",6,0)
 D BLD^SCRPW21 S T="~"
"RTN","SCRPW43",7,0)
 S SDMD="",SDMD=$O(SDDIV(SDMD)),SDMD=$O(SDDIV(SDMD)),(SDSTOP,SDOUT)=0,SDT=$P(SD("BDT"),U) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW43",8,0)
 F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!SDOUT!(SDT>SD("EDT"))  S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE!SDOUT  D
"RTN","SCRPW43",9,0)
 .S SDOE0=$$GETOE^SDOE(SDOE) I $P(SDOE0,U,2),'$P(SDOE0,U,6),$P(SDOE0,U,11),$$DIV($P(SDOE0,U,11)),$D(SD("STAT",+$P(SDOE0,U,12))) D GET
"RTN","SCRPW43",10,0)
 G:SDOUT EXIT G ^SCRPW44
"RTN","SCRPW43",11,0)
 ;
"RTN","SCRPW43",12,0)
EXIT G EXIT1^SCRPW42
"RTN","SCRPW43",13,0)
 ;
"RTN","SCRPW43",14,0)
SCAT ;Select format subcategory
"RTN","SCRPW43",15,0)
 K DIR S (SDNUL,SDOUT)=0 I $P(SD("FMT",2),U)="MT" D
"RTN","SCRPW43",16,0)
 .S DIR(0)="SOA^AS:SC MT COPAY EXEMPT;AN:NSC MT COPAY EXEMPT;C:MT COPAY REQUIRED;G:GMT COPAY REQUIRED;NO:NON-VETERAN;XO:NOT APPLICABLE;UO:UNKNOWN/REQUIRED"
"RTN","SCRPW43",17,0)
 .S DIR("A")="Select Means Test indicator: ALL// ",DIR("?")="Specify which Means Test indicator(s) you wish to include on the report."
"RTN","SCRPW43",18,0)
 .Q
"RTN","SCRPW43",19,0)
 I $P(SD("FMT",2),U)="EE" D
"RTN","SCRPW43",20,0)
 .S DIR(0)="POA^8:AEMQZ",DIR("A")="Select encounter eligibility: ALL// "
"RTN","SCRPW43",21,0)
 .S DIR("?")="Specify which encounter eligibilities you wish to include in the report."
"RTN","SCRPW43",22,0)
 .Q
"RTN","SCRPW43",23,0)
 I $P(SD("FMT",2),U)="EP" D
"RTN","SCRPW43",24,0)
 .S DIR(0)="SOA^1:Group 1;2:Group 2;3:Group 3;4:Group 4;5:Group 5;6:Group 6;7:Group 7;8:Group 8;0:No enrollment"
"RTN","SCRPW43",25,0)
 .S DIR("A")="Select patient enrollment priority: ALL// "
"RTN","SCRPW43",26,0)
 .S DIR("?")="Specify which patient enrollment priorities you wish to include in the report."
"RTN","SCRPW43",27,0)
 .Q
"RTN","SCRPW43",28,0)
 F  D SCAT1 Q:SDNUL!SDOUT  S DIR("A")=$P(DIR("A"),"ALL")
"RTN","SCRPW43",29,0)
 Q:SDOUT  I SDNUL,'$D(SD("FMT",3)) S SD("FMT",3,"ALL")="ALL"
"RTN","SCRPW43",30,0)
 Q
"RTN","SCRPW43",31,0)
 ;
"RTN","SCRPW43",32,0)
SCAT1 D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW43",33,0)
 I X="" S SDNUL=1 Q
"RTN","SCRPW43",34,0)
 I $D(SD("FMT",3,"X",$P(Y,U))) D SDEL Q
"RTN","SCRPW43",35,0)
 S SD("FMT",3,$P(Y,U))=$P(Y(0),U) Q
"RTN","SCRPW43",36,0)
 ;
"RTN","SCRPW43",37,0)
SDEL ;Delete sub-category
"RTN","SCRPW43",38,0)
 N DIR S DIR(0)="Y",DIR("A")="This item has already been selected, do you want to delete it" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW43",39,0)
 Q:'Y  K SD("FMT",3,$P(Y,U)) Q
"RTN","SCRPW43",40,0)
 ;
"RTN","SCRPW43",41,0)
PDIS ;Parameter display
"RTN","SCRPW43",42,0)
 D SUBT^SCRPW50("**** Report Parameters Selected ****") W ! D PD1(0) W !
"RTN","SCRPW43",43,0)
 K DIR S DIR(0)="Y",DIR("A")="Ok",DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW43",44,0)
 S SDOUT=Y'=1 Q
"RTN","SCRPW43",45,0)
 ;
"RTN","SCRPW43",46,0)
PD1(SDI) ;Print parameters
"RTN","SCRPW43",47,0)
 ;Required input: SDI=0 for all division selections or division ifn
"RTN","SCRPW43",48,0)
 N SDLF,C S C=(IOM-80\2),SDLF=0 I SDI D PDP("Report for",SDDIV(SDI),1) Q:SDOUT
"RTN","SCRPW43",49,0)
 I 'SDI D PDP("Report for",SDDIV,2) Q:SDOUT  D
"RTN","SCRPW43",50,0)
 .F  S SDI=$O(SDDIV(SDI)) Q:'SDI!SDOUT  D PDP("Division",SDDIV(SDI),1)
"RTN","SCRPW43",51,0)
 Q:SDOUT  D PDP("Beginning date",SD("BDT"),2,0,1) Q:SDOUT  D PDP("Ending date",SD("EDT"),2) Q:SDOUT
"RTN","SCRPW43",52,0)
 D PDP("Report format",SD("FMT",1),2,0,1) Q:SDOUT  I $P(SD("FMT",1),U)="D" D
"RTN","SCRPW43",53,0)
 .D PDP("Detail category",SD("FMT",2),2,0,1) Q:SDOUT  S SDI="",(SDII,SDL1)=0
"RTN","SCRPW43",54,0)
 .F  S SDI=$O(SD("FMT",3,SDI)) Q:SDI=""!SDOUT  D PDP($$LC($P(SD("FMT",2),U,2)),SD("FMT",3,SDI),1,SDII,'SDL1) S (SDL1,SDII)=1
"RTN","SCRPW43",55,0)
 .Q
"RTN","SCRPW43",56,0)
 Q:SDOUT  S (SDI,SDII,SDL1)=0 F  S SDI=$O(SD("STAT",SDI)) Q:'SDI!SDOUT  D PDP("Encounter status",SD("STAT",SDI),1,SDII,'SDL1) S (SDL1,SDII)=1
"RTN","SCRPW43",57,0)
 Q:$P(SD("FMT",1),U)="S"  S SDX="Output sort elements"
"RTN","SCRPW43",58,0)
 I SD("SORT")=0 D PDP(SDX,"(NONE SELECTED)",1,0,1) Q
"RTN","SCRPW43",59,0)
 I $E(IOST)="C",SDLF+SD("SORT")>18 D WAIT Q:SDOUT
"RTN","SCRPW43",60,0)
 I $Y>(IOSL-3-SD("SORT")),$E(IOST)="P" D HDR^SCRPW44 Q:SDOUT
"RTN","SCRPW43",61,0)
 W:$E(IOST)="C" !!?(C),SDX,":" W:$E(IOST)="P" !!,$J(SDX,(IOM-6\2)),":"
"RTN","SCRPW43",62,0)
 S SDI=0 F  S SDI=$O(SD("SORT",SDI)) Q:'SDI  S SDX=SD("SORT",SDI) W:SDI>1 ! W ?($S($E(IOST)="P":(IOM\2-1),1:C+19+(3*SDI))) S SDL=$S($P(SDX,U,3):(IOM-11-$X),1:(IOM-$X)) W $E($P(SDX,U,2),1,SDL)_$S($P(SDX,U,3):" <pagefeed>",1:"")
"RTN","SCRPW43",63,0)
 Q
"RTN","SCRPW43",64,0)
 ;
"RTN","SCRPW43",65,0)
PDP(SDT,SDX,SDP,SDL,SDL1) ;Print parameter display line
"RTN","SCRPW43",66,0)
 ;Required input: SDT=parameter title
"RTN","SCRPW43",67,0)
 ;Required input: SDX=parameter value
"RTN","SCRPW43",68,0)
 ;Required input: SDP=$P of SDX to print
"RTN","SCRPW43",69,0)
 ;Optional input: SDL=1 to suppress title and do line feed
"RTN","SCRPW43",70,0)
 ;Optional input: SDL1=1 to do additional line feed
"RTN","SCRPW43",71,0)
 S SDLF=SDLF+1 I $E(IOST)="C",SDLF#18=0 D WAIT Q:SDOUT
"RTN","SCRPW43",72,0)
 I $Y>(IOSL-3),$E(IOST)="P" D HDR^SCRPW44 Q:SDOUT
"RTN","SCRPW43",73,0)
 I $G(SDL1) W ! S SDLF=SDLF+1
"RTN","SCRPW43",74,0)
 W ! W:'$G(SDL) $J(SDT,(IOM-6\2)),":" W ?(IOM\2-1),$P(SDX,U,SDP) Q
"RTN","SCRPW43",75,0)
 ;
"RTN","SCRPW43",76,0)
WAIT ;Do CRT pause
"RTN","SCRPW43",77,0)
 N DIR W ! S DIR(0)="E" D ^DIR S SDOUT=Y'=1 W ! Q
"RTN","SCRPW43",78,0)
 ;
"RTN","SCRPW43",79,0)
LC(X) ;Lowercase value
"RTN","SCRPW43",80,0)
 N SDI F SDI=2:1:$L(X) I $E(X,SDI)?1U,$E(X,SDI-1)?1A S X=$E(X,0,SDI-1)_$C($A(X,SDI)+32)_$E(X,SDI+1,999)
"RTN","SCRPW43",81,0)
 Q X
"RTN","SCRPW43",82,0)
 ;
"RTN","SCRPW43",83,0)
DIV(SDIV) ;Evaluate division
"RTN","SCRPW43",84,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW43",85,0)
 ;
"RTN","SCRPW43",86,0)
GET ;Gather report information
"RTN","SCRPW43",87,0)
 N SDINC
"RTN","SCRPW43",88,0)
 S DFN=$P(SDOE0,U,2),SDIV=$P(SDOE0,U,11),SDSTOP=SDSTOP+1 D:SDSTOP#2000=0 STOP Q:SDOUT
"RTN","SCRPW43",89,0)
 S SDMT=$$MTI^SCDXUTL0(DFN,$P(SDOE0,U),$P(SDOE0,U,13),$P(SDOE0,U,10),SDOE)
"RTN","SCRPW43",90,0)
 S:"NXU"[SDMT SDMT=SDMT_"O" S SDEL=$P(SDOE0,U,13) S:'$L(SDEL) SDEL="NONE"
"RTN","SCRPW43",91,0)
 S SDEP=+$P($$ENROL^SCRPW24(DT),U,7),SDINC=$$INCL()
"RTN","SCRPW43",92,0)
 S SDMT=$S(SDMT="AN":"NSC MT Copay exempt (AN)",SDMT="AS":"SC MT Copay exempt (AS)",SDMT="C":"MT Copay req'd (C)",SDMT="G":"GMT Copay req'd (G)",SDMT="NO":"Non-veteran (NO)",SDMT="XO":"Not applicable (XO)",SDMT="UO":"Unknown/Req'd (UO)",1:"NN")
"RTN","SCRPW43",93,0)
 I SDMT="NN" S SDMT="~~~NONE~~~"
"RTN","SCRPW43",94,0)
 S SDEL=$P($G(^DIC(8,+SDEL,0)),U) S:'$L(SDEL) SDEL="~~~NONE~~~"
"RTN","SCRPW43",95,0)
 S SDEP=$S(SDEP=0:"No enrollment",1:"Group "_SDEP)
"RTN","SCRPW43",96,0)
 D SET0(SDIV) D:SDMD SET0(0) Q:$P(SD("FMT",1),U)="S"
"RTN","SCRPW43",97,0)
 S SDX=$P(SD("FMT",2),U),SDX=$S(SDX="MT":SDMT,SDX="EE":SDEL,1:SDEP),SDY=SDMT_U_SDEL_U_SDEP
"RTN","SCRPW43",98,0)
 I SDINC,$P(SD("FMT",1),U)="D" D SET1($P(SDOE0,U,11)) D:SDMD SET1(0)
"RTN","SCRPW43",99,0)
 Q
"RTN","SCRPW43",100,0)
 ;
"RTN","SCRPW43",101,0)
SET0(SDIV) ;Set TMP global for summary
"RTN","SCRPW43",102,0)
 S ^TMP("SCRPW",$J,0,SDIV,"MT",SDMT,"ENC")=$G(^TMP("SCRPW",$J,0,SDIV,"MT",SDMT,"ENC"))+1
"RTN","SCRPW43",103,0)
 S ^TMP("SCRPW",$J,0,SDIV,"MTP",SDMT,DFN,$P($P(SDOE0,U),"."))=""
"RTN","SCRPW43",104,0)
 S ^TMP("SCRPW",$J,0,SDIV,"EE",SDEL,"ENC")=$G(^TMP("SCRPW",$J,0,SDIV,"EE",SDEL,"ENC"))+1
"RTN","SCRPW43",105,0)
 S ^TMP("SCRPW",$J,0,SDIV,"EEP",SDEL,DFN,$P($P(SDOE0,U),"."))=""
"RTN","SCRPW43",106,0)
 S ^TMP("SCRPW",$J,0,SDIV,"EP",SDEP,"ENC")=$G(^TMP("SCRPW",$J,0,SDIV,"EP",SDEP,"ENC"))+1
"RTN","SCRPW43",107,0)
 S ^TMP("SCRPW",$J,0,SDIV,"EPP",SDEP,DFN,$P($P(SDOE0,U),"."))=""
"RTN","SCRPW43",108,0)
 S ^TMP("SCRPW",$J,0,SDIV,"RPT","ENC")=$G(^TMP("SCRPW",$J,0,SDIV,"RPT","ENC"))+1
"RTN","SCRPW43",109,0)
 S ^TMP("SCRPW",$J,0,SDIV,"RPT",DFN,$P($P(SDOE0,U),"."))=""
"RTN","SCRPW43",110,0)
 Q
"RTN","SCRPW43",111,0)
 ;
"RTN","SCRPW43",112,0)
SET1(SDIV) ;Set TMP global for detail
"RTN","SCRPW43",113,0)
 S SD0=$G(^DPT(DFN,0)),SDSSN=$P(SD0,U,9),SDPNAM=$P(SD0,U) Q:'$L(SDPNAM)
"RTN","SCRPW43",114,0)
 N SDS I SD("SORT") S SDI="" F  S SDI=$O(SD("SORT",SDI)) Q:'SDI  S SDS(SDI)=$$SORT($P(SD("SORT",SDI),U))
"RTN","SCRPW43",115,0)
 I 'SD("SORT") S ^TMP("SCRPW",$J,1,SDIV,SDX,SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",116,0)
 I SD("SORT")=1 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",117,0)
 I SD("SORT")=2 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDS(2),SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",118,0)
 I SD("SORT")=3 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDS(2),SDS(3),SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",119,0)
 S SDUI=$$DSV(SDIV,SDX,SDS(1),SDS(2),SDS(3),SDS(4))
"RTN","SCRPW43",120,0)
 I SD("SORT")=4 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDS(2),SDS(3),SDS(4))=SDUI,^TMP("SCRPW",$J,2,SDUI,SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",121,0)
 I SD("SORT")=5 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDS(2),SDS(3),SDS(4))=SDUI,^TMP("SCRPW",$J,2,SDUI,SDS(5),SDPNAM,DFN)=SDSSN_U_SDY Q
"RTN","SCRPW43",122,0)
 I SD("SORT")=6 S ^TMP("SCRPW",$J,1,SDIV,SDX,SDS(1),SDS(2),SDS(3),SDS(4))=SDUI,^TMP("SCRPW",$J,2,SDUI,SDS(5),SDS(6),SDPNAM,DFN)=SDSSN_U_SDY
"RTN","SCRPW43",123,0)
 Q
"RTN","SCRPW43",124,0)
 ;
"RTN","SCRPW43",125,0)
DSV(SDIV,S0,S1,S2,S3,S4) ;Produce detail sort value
"RTN","SCRPW43",126,0)
 ;Required input: SDIV=division
"RTN","SCRPW43",127,0)
 ;Required input: S0, S1, S2, S3, S4=subscript values
"RTN","SCRPW43",128,0)
 N SDX S SDX=$G(^TMP("SCRPW",$J,3,SDIV,S0,S1,S2,S3,S4)) Q:SDX SDX
"RTN","SCRPW43",129,0)
 S (SDX,^TMP("SCRPW",$J,3,SDIV,0))=$G(^TMP("SCRPW",$J,3,SDIV,0))+1
"RTN","SCRPW43",130,0)
 S ^TMP("SCRPW",$J,3,SDIV,S0,S1,S2,S3,S4)=SDX Q SDX
"RTN","SCRPW43",131,0)
 ;
"RTN","SCRPW43",132,0)
SORT(SDACR) ;Return sort value
"RTN","SCRPW43",133,0)
 ;Required input: SDACR=data element acronym
"RTN","SCRPW43",134,0)
 N SDACT,SDX,SDOE0
"RTN","SCRPW43",135,0)
 S SDOE0=U_DFN_U,SDACT=^TMP("SCRPW",$J,"ACT",SDACR) X $P(SDACT,T,7)
"RTN","SCRPW43",136,0)
 S SDX=$O(SDX("")) Q $P(SDX(SDX),U,2)
"RTN","SCRPW43",137,0)
 ;
"RTN","SCRPW43",138,0)
STOP ;Check for stop task request
"RTN","SCRPW43",139,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW43",140,0)
 ;
"RTN","SCRPW43",141,0)
INCL() ;Determine if encounter should be included in detailed report
"RTN","SCRPW43",142,0)
 ;Output: 1=yes, 0=no
"RTN","SCRPW43",143,0)
 Q:$P(SD("FMT",1),U)="S" 1
"RTN","SCRPW43",144,0)
 N SDFMT S SDFMT=$P(SD("FMT",2),U)
"RTN","SCRPW43",145,0)
 Q:$D(SD("FMT",3,"ALL")) 1
"RTN","SCRPW43",146,0)
 I SDFMT="MT",$D(SD("FMT",3,SDMT)) Q 1
"RTN","SCRPW43",147,0)
 I SDFMT="EE",$D(SD("FMT",3,SDEL)) Q 1
"RTN","SCRPW43",148,0)
 I SDFMT="EP",$D(SD("FMT",3,SDEP)) Q 1
"RTN","SCRPW43",149,0)
 Q 0
"RTN","SDCLAS")
0^2^B18724083
"RTN","SDCLAS",1,0)
SDCLAS ;ALB/TMP,MRY - Clinic Assignment List Extract ;12/23/92  11:42
"RTN","SDCLAS",2,0)
 ;;5.3;Scheduling;**63,243**;Aug 13, 1993
"RTN","SDCLAS",3,0)
 S DIV="" D DIV^SDUTL I $T D CALST^SDDIV Q:Y<0
"RTN","SDCLAS",4,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDCLAS",5,0)
 S SDIFN="",SDI=0,DIC="^SC(",DIC(0)="EFMQ",DIC("S")="I $P(^(0),U,3)=""C"",'$G(^(""OOS"")),$S(DIV="""":1,$P(^(0),U,15)=DIV:1,1:0)" D SELECT^SDCLAS0 K DIC Q:X["^"
"RTN","SDCLAS",6,0)
 S Y=DT D DTS^SDUTL S SDTS=Y
"RTN","SDCLAS",7,0)
OPT2 W !!,"Select 'As of' Date: ",SDTS," // " R X:DTIME Q:X["^"  I X']"" S SDTS=DT G OVR
"RTN","SDCLAS",8,0)
 S %DT(0)=-DT,%DT="EPX" D ^%DT K %DT
"RTN","SDCLAS",9,0)
 I Y'>0 W !,*7,"A date must be entered here to get a 'snapshot' of the clinic's enrollment as of",!,"  this date.  Date can not be in future." G OPT2
"RTN","SDCLAS",10,0)
 S SDTS=+Y
"RTN","SDCLAS",11,0)
OVR I SDSRT="C",SDSAV']"",SDIFN'="ALL",$S('$D(^SC(SDIFN,"I")):0,+^("I")=0:0,+^("I")>SDTS:0,+$P(^("I"),"^",2)'>SDTS&(+$P(^("I"),"^",2)'=0):0,1:1) W !,"Clinic ",$S(SDTS=DT:"is",1:"was")," inactive" W:SDTS<DT " on date selected" G END^SDCLAS1
"RTN","SDCLAS",12,0)
 W !!,*7,"This needs to be printed at 132 columns"
"RTN","SDCLAS",13,0)
 S PGM="START^SDCLAS",VAR="SDIFN^SDSRT^DIV^SDTS^SDSAV^SDFAST",VAL=SDIFN_"^"_SDSRT_"^"_DIV_"^"_SDTS_"^"_SDSAV_"^"_SDFAST D ZIS^DGUTQ Q:POP
"RTN","SDCLAS",14,0)
START K ^UTILITY($J) S SDSTOP=$S(SDSRT="S":SDIFN,1:""),SD1="",U="^" U IO G:SDIFN="ALL"!(SDSRT="S")!(SDSAV]"") ALL
"RTN","SDCLAS",15,0)
ONE S ONE=1 D INIT F SDAPPT=SDTS:0 S SDAPPT=$N(^SC(SDIFN,"S",SDAPPT)) Q:SDAPPT'>0  D PT
"RTN","SDCLAS",16,0)
 D:'SDFAST AEB^SDCLAS0 G ^SDCLAS1
"RTN","SDCLAS",17,0)
ALL S ONE=0 I SDSAV']"" F SDIFN=0:0 S SDIFN=$N(^SC(SDIFN)) Q:SDIFN'>0  I $P(^(SDIFN,0),"^",3)="C" D APPT
"RTN","SDCLAS",18,0)
 I SDSAV]"" D APART F SDIFN=0:0 S SDIFN=$N(SDZ(SDIFN)) Q:SDIFN'>0  I $D(^SC(SDIFN,0)),$P(^(0),"^",3)="C" D APPT
"RTN","SDCLAS",19,0)
 G ^SDCLAS1
"RTN","SDCLAS",20,0)
APPT D CHECK I 'POP K ^UTILITY($J,"PAT",SDIFN) D INIT F SDAPPT=SDTS:0 S SDAPPT=$N(^SC(SDIFN,"S",SDAPPT)) D:SDAPPT>0 PT I SDAPPT'>0 D:'SDFAST AEB^SDCLAS0 Q
"RTN","SDCLAS",21,0)
 Q
"RTN","SDCLAS",22,0)
PT F SD=0:0 S SD=$N(^SC(SDIFN,"S",SDAPPT,1,SD)) Q:SD'>0  S DFN=+^(SD,0) D PT1
"RTN","SDCLAS",23,0)
 Q
"RTN","SDCLAS",24,0)
PT1 I '$D(^UTILITY($J,"PAT",SDIFN,DFN)),$D(^DPT(DFN,0)),$D(^("S",SDAPPT,0)),$P(^(0),"^",2)=""!($P(^(0),"^",2)="I"),$S('$D(^DPT(DFN,.35)):1,'^(.35):1,1:0) D S,EXT^SDCLAS0
"RTN","SDCLAS",25,0)
 Q
"RTN","SDCLAS",26,0)
S S Y(0)=^DPT(DFN,0),SDACT=1,SDENR=0 D SET1
"RTN","SDCLAS",27,0)
 F I=0:0 S I=$N(^DPT(DFN,"DE","B",SDIFN,I)) Q:I'>0  I $D(^DPT(DFN,"DE",I,0)) D EDENR Q:SDENR
"RTN","SDCLAS",28,0)
 S ^UTILITY($J,"PAT",SDIFN,DFN)="" S:'$D(Y(1))!('SDENR) Y(1)="" I '$D(^UTILITY($J,"PAT"," ",DFN)) D MT S ^UTILITY($J,"PAT"," ",DFN)=$P(Y(0),"^",9)_"^"_SDELIG_"^"_SDZIP_"^"_$P(Y(0),"^",3)_U_SDMT
"RTN","SDCLAS",29,0)
 Q
"RTN","SDCLAS",30,0)
EDENR K Y(1) F I1=0:0 S I1=$N(^DPT(DFN,"DE",I,1,I1)) Q:I1'>0  S X=$P(^(I1,0),"^"),X(1)=$P(^(0),"^",3) Q:X>SDTS  S:'X(1)!(X(1)>SDTS) Y(1)=^(0),SDENR=1 Q:SDENR
"RTN","SDCLAS",31,0)
 Q
"RTN","SDCLAS",32,0)
SET1 S SDELIG=$S($D(^DPT(DFN,.36)):$P(^(.36),"^",1),1:""),SDELIG=$S($D(^DIC(8,+SDELIG,0)):SDELIG,1:""),SDELIG(1)=$S(SDELIG]"":$P(^(0),"^",5),1:""),SDZIP=$S($D(^DPT(DFN,.11)):$P(^(.11),"^",6),1:"")
"RTN","SDCLAS",33,0)
 Q
"RTN","SDCLAS",34,0)
MT ;
"RTN","SDCLAS",35,0)
 S SDMT="*" Q:SDELIG(1)']""  I SDELIG(1)="N" S SDMT="N" Q
"RTN","SDCLAS",36,0)
 S SDMT=$$LST^DGMTU(DFN) I SDMT']"" S SDMT=$S(SDELIG'=6:"A",1:"X") Q
"RTN","SDCLAS",37,0)
 S:$P(SDMT,U,2)>SDTS SDMT=$$LST^DGMTU(DFN,SDTS)
"RTN","SDCLAS",38,0)
 I $P(SDMT,U,4)="P" S SDMT=$$PA^DGMTUTL($P(SDMT,U)),SDMT=$S('$D(SDMT):"U",SDMT="MT":"C",SDMT="GMT":"G",1:"U")
"RTN","SDCLAS",39,0)
 E  S SDMT=$P(SDMT,U,4)
"RTN","SDCLAS",40,0)
 I SDMT="" S SDMT="X"
"RTN","SDCLAS",41,0)
 I SDMT="P" S SDMT="C"
"RTN","SDCLAS",42,0)
 I SDMT="R" S SDMT="U"
"RTN","SDCLAS",43,0)
 I SDMT="N" S SDMT="A"
"RTN","SDCLAS",44,0)
 D DOM^SDOPC4(DFN,SDTS_.9,.SDMT) I SDMT="X0" S SDMT="X"
"RTN","SDCLAS",45,0)
 K SDMT1 Q
"RTN","SDCLAS",46,0)
CHECK S POP=0 I SDSRT="S",SDSTOP'="ALL",$P(^SC(SDIFN,0),"^",7)'=SDSTOP S POP=1 Q
"RTN","SDCLAS",47,0)
 I $S(DIV="":1,$P(^SC(SDIFN,0),"^",15)=DIV:1,1:0),$S('$D(^SC(SDIFN,"I")):1,+^("I")=0:1,+^("I")>DT:1,+$P(^("I"),"^",2)'>DT&(+$P(^("I"),"^",2)'=0):1,1:0) Q
"RTN","SDCLAS",48,0)
 S POP=1 Q
"RTN","SDCLAS",49,0)
APART S SDZ="" F I=1:1 Q:$P(SDSAV,",",I)']""  S SDZ=$P(SDSAV,",",I) D:SDZ["--" SPLIT^SDCLAS0 I SDZ'["--" S:'$D(SDZ(+SDZ)) SDZ(+SDZ)=""
"RTN","SDCLAS",50,0)
 Q
"RTN","SDCLAS",51,0)
INIT F I1="SDENR","SDACT" S I2="^UTILITY("_$J_","""_I1_""","_SDIFN_")",@I2=0
"RTN","SDCLAS",52,0)
 Q
"RTN","SDCLAS1")
0^3^B22892302
"RTN","SDCLAS1",1,0)
SDCLAS1 ;ALB/TMP,MRY - Clinic Assignment Listing ; 12/23/02
"RTN","SDCLAS1",2,0)
 ;;5.3;Scheduling;**140,243**;Aug 13, 1993
"RTN","SDCLAS1",3,0)
 K Y,ONE,SDT,SDIFN,DIC,SDAPPT,SDCL,DFN,SDELIG,SDMT,SDMT1,SDLAST,SDNEXT,I,I1,SDTT
"RTN","SDCLAS1",4,0)
 S PG=0,PG1=1,SDCLIN=0
"RTN","SDCLAS1",5,0)
 F I=0:0 S SDCLIN=$N(^UTILITY($J,"S",SDCLIN)) Q:SDCLIN<0  D MTINIT F SDCL=0:0 S SDCL=$N(^UTILITY($J,"S",SDCLIN,SDCL)) D:SDCL'>0 TOT Q:SDCL'>0  S SDIFN=SDCL W @IOF D HDR S SDNAM=0 D PATIENT
"RTN","SDCLAS1",6,0)
 G END
"RTN","SDCLAS1",7,0)
MTINIT F I1="A","B","C","G","N","U","X","*" S I2="SDMT1(""""_I1_"""")",@I2=0
"RTN","SDCLAS1",8,0)
 Q
"RTN","SDCLAS1",9,0)
PATIENT F I1=0:0 S SDNAM=$N(^UTILITY($J,"S",SDCLIN,SDCL,SDNAM)) Q:SDNAM<0  F DFN=0:0 S DFN=$N(^UTILITY($J,"S",SDCLIN,SDCL,SDNAM,DFN)) Q:DFN'>0  D PRT
"RTN","SDCLAS1",10,0)
 Q
"RTN","SDCLAS1",11,0)
PRT I $Y>(IOSL-5) W @IOF D HDR
"RTN","SDCLAS1",12,0)
 S Y=^UTILITY($J,"S",SDCLIN,SDCL,SDNAM,DFN),Y1=^UTILITY($J,"PAT"," ",DFN)
"RTN","SDCLAS1",13,0)
 S SDACT=+$P(Y,"^",4),SDFLG=$S(SDACT&($P(Y,"^",5)):"*",SDACT&('$P(Y,"^",5)):"+",1:" ")
"RTN","SDCLAS1",14,0)
 W !,?0,SDFLG,SDNAM,?32,$P(Y1,"^") W ?45,$S($P(Y,"^",6)="O":"OPT",$P(Y,"^",6)="A":"AC",1:"")
"RTN","SDCLAS1",15,0)
 S SDEL=$S($D(^DIC(8,+$P(Y1,"^",2),0)):$P(^(0),"^"),1:"") W ?52,SDEL S SDEL1=$S(SDEL']"":"Unknown",1:+$P(Y1,"^",2)),SDELIG(SDEL1)=$S($D(SDELIG(SDEL1)):SDELIG(SDEL1)+1,1:1)
"RTN","SDCLAS1",16,0)
 S SDMT=$P(Y1,"^",5),SDMT1(SDMT)=SDMT1(SDMT)+1
"RTN","SDCLAS1",17,0)
 S X=+$P(Y,"^",3) I X D DAYS W ?87,X
"RTN","SDCLAS1",18,0)
 S SDY=Y,Y=$P(SDY,"^") D DTS^SDUTL W ?96,Y S Y=$P(SDY,"^",2) D DTS^SDUTL W ?110,Y S Y=SDY
"RTN","SDCLAS1",19,0)
 S X1=SDTS,X2=$P(Y1,"^",4) D AGE W ?124,SDAGE
"RTN","SDCLAS1",20,0)
 S SDCAT=$S(SDMT="U":"REQUIRED",SDMT="N":"NOT REQ",SDMT="*":"UNKNOWN",SDMT="U":"REQUIRED",SDMT="X":"NOT APPLICABLE",SDMT="A":"NSC MT COPAY EXEMPT",SDMT="C":"MT COPAY REQUIRED",SDMT="G":"GMT COPAY REQUIRED",1:"CATEGORY "_SDMT) W !?52,SDCAT
"RTN","SDCLAS1",21,0)
 Q
"RTN","SDCLAS1",22,0)
DAYS S X1=SDTS,X2=+X D ^%DTC Q
"RTN","SDCLAS1",23,0)
HDR S X1=$S($D(^SC(SDCL,0)):^(0),1:""),SDCLNAM=$P(X1,"^"),SDIV=$S($D(^DG(40.8,+$P(X1,"^",15),0)):$P(^(0),"^"),1:""),SDSTOP=$S($D(^DIC(40.7,+$P(X1,"^",7),0)):$P(^(0),"^",2),1:"")
"RTN","SDCLAS1",24,0)
HDR1 S PG=PG+1,PG1=0 W !,?2,"As of Date: " S Y=SDTS D DTS^SDUTL W Y,?53,"CLINIC  ASSIGNMENT  LISTING",?92,"Page ",PG,?106,"Stop Code ",SDSTOP,!,?2,"Print Date: " S Y=DT D DTS^SDUTL W Y
"RTN","SDCLAS1",25,0)
 S X=(132-$L(SDCLNAM)-4)\2+1 W ?X,"FOR ",SDCLNAM
"RTN","SDCLAS1",26,0)
 I SDIV]"" S X=(132-$L(SDIV))\2+1 W !,?X,SDIV
"RTN","SDCLAS1",27,0)
 W !! S SDL="",$P(SDL,"-",133)="" W SDL
"RTN","SDCLAS1",28,0)
 Q:$D(SDTT)  W !,?83,"Number of",?98,"Date of",?108,"Date of",!,?43,"Patient",?65,"Elig",?83,"Days",?98,"Last",?108,"Next",!,?12,"Name",?35,"SSN",?43,"Status",?65,"Code",?83,"Enrolled"
"RTN","SDCLAS1",29,0)
 W ?98,"Visit",?108,"Appointment",?124,"Age",!
"RTN","SDCLAS1",30,0)
 W !,?1,"* = Enrolled and active as of " S Y=SDTS D DTS^SDUTL W Y I 'SDFAST W !,?1,"+ = Enrolled as of ",Y," with no future appts."
"RTN","SDCLAS1",31,0)
 W !,SDL,! Q
"RTN","SDCLAS1",32,0)
TOT S SDTT="" Q:'$D(^SC(SDIFN))  I $Y>(IOSL-5) W @IOF D HDR1
"RTN","SDCLAS1",33,0)
 W !!,?3,"NUMBER OF ACTIVE PATIENTS   : ",$J(+$G(^UTILITY($J,"SDACT",SDIFN)),5) D CKHDR
"RTN","SDCLAS1",34,0)
 I 'SDFAST W !,?3,"NUMBER OF ENROLLED PATIENTS",!,?5,"(NO FUTURE APPOINTMENTS)  : ",$J(+$G(^UTILITY($J,"SDENR",SDIFN)),5) D CKHDR
"RTN","SDCLAS1",35,0)
 W !!,?3,"Eligibility Code Totals:     ",SDCLNAM,!! S X1=""
"RTN","SDCLAS1",36,0)
 F SDEL=0:0 S SDEL=$N(^DIC(8,SDEL)) S X1=$S(X1="":5,X1=93:5,1:X1+44) D:X1=5 CKHDR D PRT1 Q:SDEL'>0
"RTN","SDCLAS1",37,0)
 W !!,?3,"Means Test Category Totals:  ",SDCLNAM,!! S X1=""
"RTN","SDCLAS1",38,0)
 S SDMT="" F A=0:0 S SDMT=$O(SDMT1(SDMT)) Q:SDMT']""  S X1=$S(X1="":5,X1=49:5,1:49) D:X1=5 CKHDR D PRT2
"RTN","SDCLAS1",39,0)
 K SDELIG,SDMT1,SDTT Q
"RTN","SDCLAS1",40,0)
PRT1 W ?X1,$S(SDEL'>0:"Unknown",1:$P(^DIC(8,SDEL,0),"^",1)) S:SDEL'>0 SDEL="Unknown" W ?(X1+30),": ",$S($D(SDELIG(SDEL)):$J(SDELIG(SDEL),5),1:$J("0",5)) W:X1=93 !
"RTN","SDCLAS1",41,0)
 Q
"RTN","SDCLAS1",42,0)
PRT2 W ?X1,$S(SDMT["A":"NSC MT COPAY EXEMPT",SDMT["B":"CATEGORY B",SDMT["C":"MT COPAY REQUIRED",SDMT["G":"GMT COPAY REQUIRD",SDMT["N":"NON-VETERAN",SDMT["U":"REQUIRED (NOT DONE)",SDMT["X":"NOT APPLICABLE",1:"UNKNOWN")
"RTN","SDCLAS1",43,0)
 W ?(X1+19),": ",$S($D(SDMT1(SDMT)):$J(SDMT1(SDMT),5),1:$J("0",5)) W:X1=49 !
"RTN","SDCLAS1",44,0)
 Q
"RTN","SDCLAS1",45,0)
CKHDR I $Y>(IOSL-5) W @IOF D HDR1 W !
"RTN","SDCLAS1",46,0)
 Q
"RTN","SDCLAS1",47,0)
END W ! K %,%T,%Y,DGA1,DGX,A,A1,A2,A3,DG1,DGT,PGM,POP,VAL,VAR,X2,Y1,SDCL,SDTT,SDCLIN,SDNAM,PG,PG1,DFN,Y,I,I1,I2,I3,X,X1,SDEL,SDEL1,SDSTAT,SDCNTY,SDCLNAM,SDIV,SDSTOP,Z1,ZTSK,%IS,SD1,SDEN,ALL,DIV,SDI,SDAGE,SDIFN,SDSAV,SDSRT,SDY,SDZIP,SD,SDZ,SDHX
"RTN","SDCLAS1",48,0)
 K %ZIS,SD02,SDACT,SDENR,SDFAST,SDFLG,SDL,SDTS,SDMT,^UTILITY($J) D CLOSE^DGUTQ Q
"RTN","SDCLAS1",49,0)
AGE D ^%DTC S SDAGE=X\365 Q
"VER")
8.0^22.0
**END**
**END**
