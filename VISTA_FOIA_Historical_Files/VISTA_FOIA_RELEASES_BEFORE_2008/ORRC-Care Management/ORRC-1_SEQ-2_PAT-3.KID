Released ORRC*1*3 SEQ #2
Extracted from mail message
**KIDS**:ORRC*1.0*3^

**INSTALL NAME**
ORRC*1.0*3
"BLD",5368,0)
ORRC*1.0*3^CARE MANAGEMENT^0^3060420^y
"BLD",5368,1,0)
^^2^2^3041208^
"BLD",5368,1,1,0)
Refer to the National Patch Module for complete details of the 
"BLD",5368,1,2,0)
enhancements included in this patch.
"BLD",5368,4,0)
^9.64PA^^
"BLD",5368,"KRN",0)
^9.67PA^8989.52^19
"BLD",5368,"KRN",.4,0)
.4
"BLD",5368,"KRN",.401,0)
.401
"BLD",5368,"KRN",.402,0)
.402
"BLD",5368,"KRN",.403,0)
.403
"BLD",5368,"KRN",.5,0)
.5
"BLD",5368,"KRN",.84,0)
.84
"BLD",5368,"KRN",3.6,0)
3.6
"BLD",5368,"KRN",3.8,0)
3.8
"BLD",5368,"KRN",9.2,0)
9.2
"BLD",5368,"KRN",9.8,0)
9.8
"BLD",5368,"KRN",9.8,"NM",0)
^9.68A^2^1
"BLD",5368,"KRN",9.8,"NM",2,0)
ORRCOR^^0^B48128294
"BLD",5368,"KRN",9.8,"NM","B","ORRCOR",2)

"BLD",5368,"KRN",19,0)
19
"BLD",5368,"KRN",19.1,0)
19.1
"BLD",5368,"KRN",101,0)
101
"BLD",5368,"KRN",409.61,0)
409.61
"BLD",5368,"KRN",771,0)
771
"BLD",5368,"KRN",870,0)
870
"BLD",5368,"KRN",8989.51,0)
8989.51
"BLD",5368,"KRN",8989.52,0)
8989.52
"BLD",5368,"KRN",8994,0)
8994
"BLD",5368,"KRN","B",.4,.4)

"BLD",5368,"KRN","B",.401,.401)

"BLD",5368,"KRN","B",.402,.402)

"BLD",5368,"KRN","B",.403,.403)

"BLD",5368,"KRN","B",.5,.5)

"BLD",5368,"KRN","B",.84,.84)

"BLD",5368,"KRN","B",3.6,3.6)

"BLD",5368,"KRN","B",3.8,3.8)

"BLD",5368,"KRN","B",9.2,9.2)

"BLD",5368,"KRN","B",9.8,9.8)

"BLD",5368,"KRN","B",19,19)

"BLD",5368,"KRN","B",19.1,19.1)

"BLD",5368,"KRN","B",101,101)

"BLD",5368,"KRN","B",409.61,409.61)

"BLD",5368,"KRN","B",771,771)

"BLD",5368,"KRN","B",870,870)

"BLD",5368,"KRN","B",8989.51,8989.51)

"BLD",5368,"KRN","B",8989.52,8989.52)

"BLD",5368,"KRN","B",8994,8994)

"BLD",5368,"QUES",0)
^9.62^^
"BLD",5368,"REQB",0)
^9.611^1^1
"BLD",5368,"REQB",1,0)
ORRC*1.0*1^2
"BLD",5368,"REQB","B","ORRC*1.0*1",1)

"MBREQ")
0
"PKG",395,-1)
1^1
"PKG",395,0)
CARE MANAGEMENT^ORRC^Care Mgt Modules
"PKG",395,20,0)
^9.402P^^
"PKG",395,22,0)
^9.49I^1^1
"PKG",395,22,1,0)
1.0^3040116^3040426^1119
"PKG",395,22,1,"PAH",1,0)
3^3060420
"PKG",395,22,1,"PAH",1,1,0)
^^2^2^3060420
"PKG",395,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module for complete details of the 
"PKG",395,22,1,"PAH",1,1,2,0)
enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORRCOR")
0^2^B48128294^B42048781
"RTN","ORRCOR",1,0)
ORRCOR ;SLC/MKB - OR data for CM ; 25 Jul 2003  9:31 AM
"RTN","ORRCOR",2,0)
 ;;1.0;CARE MANAGEMENT;**3**;Jul 15, 2003
"RTN","ORRCOR",3,0)
 ;
"RTN","ORRCOR",4,0)
PTUNS(ORY,ORUSR) ; -- Return list of patients with unsigned orders by ORUSR
"RTN","ORRCOR",5,0)
 ; in @ORY@(PAT) = #unsigned orders
"RTN","ORRCOR",6,0)
 ;    @ORY@(PAT,"ORU:ien;act")=""
"RTN","ORRCOR",7,0)
 ; [from ORRCDPT]
"RTN","ORRCOR",8,0)
 N IDX,PAT,IFN,ACT,NUM,X
"RTN","ORRCOR",9,0)
 S ORY=$NA(^TMP($J,"ORRCORU")),IDX="^OR(100,""AS"")" K @ORY
"RTN","ORRCOR",10,0)
 F  S IDX=$Q(@IDX) Q:IDX'?1"^OR(100,""AS"",".E  D
"RTN","ORRCOR",11,0)
 . S PAT=+$P($P(IDX,",",3),"""",2),IFN=+$P(IDX,",",5),ACT=+$P(IDX,",",6)
"RTN","ORRCOR",12,0)
 . Q:+$P($G(^OR(100,IFN,8,ACT,0)),U,3)'=ORUSR
"RTN","ORRCOR",13,0)
 . S X=+$G(ORY(PAT)),ORY(PAT)=X+1,ORY(PAT,"ORU:"_IFN_";"_ACT)=""
"RTN","ORRCOR",14,0)
 Q
"RTN","ORRCOR",15,0)
 ;
"RTN","ORRCOR",16,0)
IDS(ORY,ORPAT,ORTYPE,ORBEG,OREND) ; -- Return order IDs for ORPAT where
"RTN","ORRCOR",17,0)
 ; ORTYPE = ORN: Active Nursing Orders (2)
"RTN","ORRCOR",18,0)
 ;          ORV: Orders Unverified by Nursing (9)
"RTN","ORRCOR",19,0)
 ; in @ORY@(PAT) = #orders
"RTN","ORRCOR",20,0)
 ;    @ORY@(PAT,ID)= ! if completed (for ORN), else null
"RTN","ORRCOR",21,0)
 ; [from ORRCDPT1]
"RTN","ORRCOR",22,0)
 N ORN,ORWARD,ORFLG,ORID,ORDG,ORPKG,ORLIST,ORI,ORIFN,STS,PKG,X
"RTN","ORRCOR",23,0)
 S ORY=$NA(^TMP($J,"ORRCORU")) K @ORY
"RTN","ORRCOR",24,0)
 S ORPAT=+$G(ORPAT)_";DPT(",ORTYPE=$G(ORTYPE,"ORD")
"RTN","ORRCOR",25,0)
 S ORWARD=$G(^DPT(+ORPAT,.1)) S:$L(ORWARD) ORWARD=+$O(^DIC(42,"B",ORWARD,0))
"RTN","ORRCOR",26,0)
 S ORFLG=$S(ORTYPE="ORU":11,ORTYPE="ORV":9,1:2),ORID=ORTYPE_":"
"RTN","ORRCOR",27,0)
 S ORDG=$S(ORTYPE="ORN":"NURS",1:"ALL"),ORDG=+$O(^ORD(100.98,"B",ORDG,0))
"RTN","ORRCOR",28,0)
 S ORPKG=+$O(^DIC(9.4,"C","OR",0))
"RTN","ORRCOR",29,0)
 ;S (ORBEG,OREND)="" I ORFLG=9 S OREND=$$NOW^XLFDT,ORBEG=OREND-1
"RTN","ORRCOR",30,0)
 D EN^ORQ1(ORPAT,ORDG,ORFLG,,$G(ORBEG),$G(OREND)) S (ORI,CNT)=0
"RTN","ORRCOR",31,0)
 F  S ORI=+$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<1  S ORIFN=^(ORI) D
"RTN","ORRCOR",32,0)
 . S STS=$P($G(^OR(100,+ORIFN,3)),U,3),PKG=+$P($G(^(0)),U,14),X=""
"RTN","ORRCOR",33,0)
 . ;I ORTYPE="ORV",STS=1,+$G(^(6))=10 Q  ;changed ??
"RTN","ORRCOR",34,0)
 . I ORTYPE="ORN","^1^2^7^11^12^13^14^"[(U_STS_U)!(PKG'=ORPKG) S X="!" ;can't complete
"RTN","ORRCOR",35,0)
 . S CNT=CNT+1,@ORY@(+ORPAT,ORID_ORIFN)=X
"RTN","ORRCOR",36,0)
 S:CNT @ORY@(+ORPAT)=CNT K ^TMP("ORR",$J,ORLIST)
"RTN","ORRCOR",37,0)
 ;if ORTYPE=ORN also get all other GEN TEXT ORDERS not in NURSING display group
"RTN","ORRCOR",38,0)
 Q:ORTYPE'="ORN"
"RTN","ORRCOR",39,0)
 S ORDG="CLINIC ORDERS",ORDG=+$O(^ORD(100.98,"B",ORDG,0))
"RTN","ORRCOR",40,0)
 D EN^ORQ1(ORPAT,ORDG,ORFLG,,$G(ORBEG),$G(OREND))
"RTN","ORRCOR",41,0)
 S ORI=0 F  S ORI=+$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<1  D
"RTN","ORRCOR",42,0)
 . S ORIFN=$G(^TMP("ORR",$J,ORLIST,ORI))
"RTN","ORRCOR",43,0)
 . S STS=$P($G(^OR(100,+ORIFN,3)),U,3),PKG=+$P($G(^(0)),U,14),X=""
"RTN","ORRCOR",44,0)
 . I ORTYPE="ORN","^1^2^7^11^12^13^14^"[(U_STS_U)!(PKG'=ORPKG) S X="!" ;can't complete
"RTN","ORRCOR",45,0)
 . Q:(PKG'=ORPKG)
"RTN","ORRCOR",46,0)
 . S CNT=CNT+1,@ORY@(+ORPAT,ORID_ORIFN)=X
"RTN","ORRCOR",47,0)
 S:CNT @ORY@(+ORPAT)=CNT K ^TMP("ORR",$J,ORLIST)
"RTN","ORRCOR",48,0)
 Q
"RTN","ORRCOR",49,0)
 ;
"RTN","ORRCOR",50,0)
LISTUNS(ORY,ORUSR,ORPAT,ORDET) ; -- Return unsigned orders by ORUSR for ORPAT
"RTN","ORRCOR",51,0)
 ; in @ORY@(#) = Item=ID^Text^OrderDate in HL7 format
"RTN","ORRCOR",52,0)
 ;             = Order=line of order text, and also if ORDET
"RTN","ORRCOR",53,0)
 ;             = Text=line of report text
"RTN","ORRCOR",54,0)
 ; [from LIST^ORRCSIG]
"RTN","ORRCOR",55,0)
 N ORN,ORDT,ORIFN,ORACT,ORID,ORRCTX,I
"RTN","ORRCOR",56,0)
 S ORY=$NA(^TMP($J,"ORRCORD")) K @ORY
"RTN","ORRCOR",57,0)
 S ORUSR=+$G(ORUSR),ORPAT=+$G(ORPAT)_";DPT(",ORN=0
"RTN","ORRCOR",58,0)
 S ORDT=0 F  S ORDT=+$O(^OR(100,"AS",ORPAT,ORDT)) Q:ORDT<1  D
"RTN","ORRCOR",59,0)
 . S ORIFN=0 F  S ORIFN=+$O(^OR(100,"AS",ORPAT,ORDT,ORIFN)) Q:ORIFN<1  D
"RTN","ORRCOR",60,0)
 .. S ORACT=0 F  S ORACT=+$O(^OR(100,"AS",ORPAT,ORDT,ORIFN,ORACT)) Q:ORACT<1  D
"RTN","ORRCOR",61,0)
 ... Q:+$P($G(^OR(100,ORIFN,8,ORACT,0)),U,3)'=ORUSR  S ORID=ORIFN_";"_ORACT
"RTN","ORRCOR",62,0)
 ... D TEXT^ORQ12(.ORRCTX,ORID,200)
"RTN","ORRCOR",63,0)
 ... S ORN=ORN+1,@ORY@(ORN)="Item=ORU:"_ORID_U_$$TXT1_U_$$FMTHL7^XLFDT(ORDT)_U_$$STS(ORIFN)
"RTN","ORRCOR",64,0)
 ... S I=0 F  S I=$O(ORRCTX(I)) Q:I<1  S ORN=ORN+1,@ORY@(ORN)="Order="_ORRCTX(I)
"RTN","ORRCOR",65,0)
 ... I $G(ORDET) D ORD ;add Detailed Display to @ORY@(#)
"RTN","ORRCOR",66,0)
 ;S ORY(0)=CNT
"RTN","ORRCOR",67,0)
 Q
"RTN","ORRCOR",68,0)
 ;
"RTN","ORRCOR",69,0)
LIST(ORY,ORPAT,ORTYPE,ORUSR,ORDET,ORBEG,OREND) ; -- Return orders for ORPAT where
"RTN","ORRCOR",70,0)
 ; ORTYPE = ORN: Active Nursing Orders (2)
"RTN","ORRCOR",71,0)
 ;          ORV: Orders Unverified by Nursing (9)
"RTN","ORRCOR",72,0)
 ;          ORU: Unsigned Orders by ORUSR (11)
"RTN","ORRCOR",73,0)
 ; in @ORY@(#) = Item=ID^Text^OrderDate in HL7 format^Status
"RTN","ORRCOR",74,0)
 ;             = Order=line of order text, & if ORDET
"RTN","ORRCOR",75,0)
 ;             = Text=line of report text
"RTN","ORRCOR",76,0)
 ;    where ID = ORTYPE_":"_order#;action#
"RTN","ORRCOR",77,0)
 ; RPC = ORRC ORDERS BY PATIENT
"RTN","ORRCOR",78,0)
 N ORN,ORWARD,ORIGVIEW,ORFLG,ORID,ORDG,ORLIST,ORI,ORIFN,ORACT,OR0,ORA0,ORDT,ORRCTX,I
"RTN","ORRCOR",79,0)
 S ORY=$NA(^TMP($J,"ORRCORD")) K @ORY
"RTN","ORRCOR",80,0)
 S ORUSR=+$G(ORUSR),ORPAT=+$G(ORPAT)_";DPT(",ORTYPE=$G(ORTYPE,"ORD")
"RTN","ORRCOR",81,0)
 S ORWARD=$G(^DPT(+ORPAT,.1)),ORIGVIEW=1
"RTN","ORRCOR",82,0)
 S:$L(ORWARD) ORWARD=+$O(^DIC(42,"B",ORWARD,0))
"RTN","ORRCOR",83,0)
 S ORFLG=$S(ORTYPE="ORU":11,ORTYPE="ORV":9,1:2),ORID=ORTYPE_":"
"RTN","ORRCOR",84,0)
 S ORDG=$S(ORTYPE="ORN":"NURS",1:"ALL"),ORDG=+$O(^ORD(100.98,"B",ORDG,0))
"RTN","ORRCOR",85,0)
 S:$G(ORBEG) ORBEG=$$HL7TFM^XLFDT(ORBEG) S:$G(OREND) OREND=$$HL7TFM^XLFDT(OREND)
"RTN","ORRCOR",86,0)
 D EN^ORQ1(ORPAT,ORDG,ORFLG,,$G(ORBEG),$G(OREND)) S (ORI,ORN)=0
"RTN","ORRCOR",87,0)
 F  S ORI=+$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<1  S ORIFN=^(ORI) D
"RTN","ORRCOR",88,0)
 . S ORACT=+$P(ORIFN,";",2) S:ORACT<1 ORACT=+$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORRCOR",89,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORA0=$G(^(8,ORACT,0))
"RTN","ORRCOR",90,0)
 . I ORFLG=11,+$P(ORA0,U,3)'=ORUSR Q
"RTN","ORRCOR",91,0)
 . S ORDT=$S('$P(OR0,U,8):$P(ORA0,U),"^DC^HD^"[(U_$P(ORA0,U,2)_U):$P(ORA0,U),1:$P(OR0,U,8))
"RTN","ORRCOR",92,0)
 . D TEXT^ORQ12(.ORRCTX,ORIFN,200)
"RTN","ORRCOR",93,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item="_ORID_ORIFN_U_$$TXT1_U_$$FMTHL7^XLFDT(ORDT)_U_$$STS(ORIFN)
"RTN","ORRCOR",94,0)
 . S I=0 F  S I=$O(ORRCTX(I)) Q:I<1  S ORN=ORN+1,@ORY@(ORN)="Order="_ORRCTX(I)
"RTN","ORRCOR",95,0)
 . I $G(ORDET) D ORD ;add Detailed Display to @ORY@(#)
"RTN","ORRCOR",96,0)
 Q
"RTN","ORRCOR",97,0)
 ;
"RTN","ORRCOR",98,0)
DETAIL(ORY,ORDER) ; -- Return details of ORDERs
"RTN","ORRCOR",99,0)
 ; where ORDER(#) = ID
"RTN","ORRCOR",100,0)
 ; in @ORY@(#) = Item=ID^Text^OrderDate in HL7 format^Status
"RTN","ORRCOR",101,0)
 ;             = Order=line of order text
"RTN","ORRCOR",102,0)
 ;             = Text=line of report text
"RTN","ORRCOR",103,0)
 ; RPC = ORRC ORDERS BY ID [and from DETAIL^ORRCSIG]
"RTN","ORRCOR",104,0)
 N ORN,ORI,ORID,ORIFN,ORACT,ORDT,ORRCTX,I
"RTN","ORRCOR",105,0)
 S ORN=0,ORY=$NA(^TMP($J,"ORRCORD")) K @ORY
"RTN","ORRCOR",106,0)
 S ORI="" F  S ORI=$O(ORDER(ORI)) Q:ORI=""  S ORID=ORDER(ORI) D
"RTN","ORRCOR",107,0)
 . S ORIFN=$P(ORID,":",2),ORACT=+$P(ORIFN,";",2)
"RTN","ORRCOR",108,0)
 . S:ORACT<1 ORACT=+$P($G(^OR(100,+ORIFN,3)),U,7) S:ORACT<1 ORACT=1
"RTN","ORRCOR",109,0)
 . S ORDT=+$G(^OR(100,+ORIFN,8,ORACT,0))
"RTN","ORRCOR",110,0)
 . D TEXT^ORQ12(.ORRCTX,ORIFN,200)
"RTN","ORRCOR",111,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item="_ORID_U_$$TXT1_U_$P($$FMTHL7^XLFDT(ORDT),"-")_U_$$STS(ORIFN)
"RTN","ORRCOR",112,0)
 . S I=0 F  S I=$O(ORRCTX(I)) Q:I<1  S ORN=ORN+1,@ORY@(ORN)="Order="_ORRCTX(I)
"RTN","ORRCOR",113,0)
 . D ORD
"RTN","ORRCOR",114,0)
 Q
"RTN","ORRCOR",115,0)
 ;
"RTN","ORRCOR",116,0)
TXT(IFN) ; -- Return [first line of] order IFN's text
"RTN","ORRCOR",117,0)
 N ORRCTX,Y D TEXT^ORQ12(.ORRCTX,$G(IFN),200)
"RTN","ORRCOR",118,0)
 S Y=$G(ORRCTX(1))_$S($O(ORRCTX(1)):"...",1:"")
"RTN","ORRCOR",119,0)
 Q Y
"RTN","ORRCOR",120,0)
 ;
"RTN","ORRCOR",121,0)
TXT1() ; -- Return [first line of] order text from ORRCTX()
"RTN","ORRCOR",122,0)
 N Y
"RTN","ORRCOR",123,0)
 S Y=$G(ORRCTX(1))_$S($O(ORRCTX(1)):"...",1:"")
"RTN","ORRCOR",124,0)
 Q Y
"RTN","ORRCOR",125,0)
 ;
"RTN","ORRCOR",126,0)
STS(IFN) ; --Return name of order IFN's status
"RTN","ORRCOR",127,0)
 N STS,X,Y
"RTN","ORRCOR",128,0)
 S STS=+$P($G(^OR(100,+$G(IFN),3)),U,3)
"RTN","ORRCOR",129,0)
 S X=$P($G(^ORD(100.01,STS,0)),U),Y=$$LOW^XLFSTR(X)
"RTN","ORRCOR",130,0)
 Q Y
"RTN","ORRCOR",131,0)
 ;
"RTN","ORRCOR",132,0)
ORD ; -- Add details of ORIFN to @ORY@(ORN)
"RTN","ORRCOR",133,0)
 Q:'+$G(ORIFN)  N ORRCZ,ORI,ORVP
"RTN","ORRCOR",134,0)
 S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORRCOR",135,0)
 S ORRCZ="^TMP($J,""ORRCTXT"")" D DETAIL^ORQ2(.ORRCZ,ORIFN)
"RTN","ORRCOR",136,0)
 S ORI=0 F  S ORI=$O(@ORRCZ@(ORI)) Q:ORI<1  S ORN=ORN+1,@ORY@(ORN)="Text="_@ORRCZ@(ORI)
"RTN","ORRCOR",137,0)
 K @ORRCZ
"RTN","ORRCOR",138,0)
 Q
"RTN","ORRCOR",139,0)
 ;
"RTN","ORRCOR",140,0)
VERIFY(ORY,ORUSR,ORDER) ; -- Mark ORDERs as verified by ORUSR
"RTN","ORRCOR",141,0)
 ;where ORDER(#) = ID = ORV:order#;action#
"RTN","ORRCOR",142,0)
 ;returns ORY(#) = ID^1 if successful, else ID^0^error
"RTN","ORRCOR",143,0)
 ;RPC = ORRC ORDERS VERIFY
"RTN","ORRCOR",144,0)
 Q:'$G(ORUSR)  N ORVER,ORI,ORID,ORIFN,ORACT,ORA0,ORLK,ORES,ORERR,ORVP,ORWARD
"RTN","ORRCOR",145,0)
 K ORY S ORVER="N"
"RTN","ORRCOR",146,0)
 S ORI=""  F  S ORI=$O(ORDER(ORI)) Q:ORI=""  D
"RTN","ORRCOR",147,0)
 . S ORID=ORDER(ORI),ORIFN=$P(ORID,":",2),ORACT=+$P(ORIFN,";",2)
"RTN","ORRCOR",148,0)
 . I ORACT<1 S ORACT=+$P($G(^OR(100,+ORIFN,3)),U,7),ORIFN=+ORIFN_";"_ORACT
"RTN","ORRCOR",149,0)
 . S ORA0=$G(^OR(100,+ORIFN,8,ORACT,0)) I $P(ORA0,U,9) D  Q  ;verified
"RTN","ORRCOR",150,0)
 .. N WHO,WHEN,X S WHO=$P(ORA0,U,8),WHEN=$P(ORA0,U,9),X=""
"RTN","ORRCOR",151,0)
 .. S:WHO X=X_" by "_$$UP^XLFSTR($$NAME^XUSER(WHO,"F"))
"RTN","ORRCOR",152,0)
 .. S:WHEN X=X_" on "_$$FMTE^XLFDT(WHEN,"2P")
"RTN","ORRCOR",153,0)
 .. S ORY(ORI)=ORID_"^0^This order has been verified"_X_"!" Q
"RTN","ORRCOR",154,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK S ORY(ORI)=ORID_U_ORLK Q
"RTN","ORRCOR",155,0)
 . S ORES(ORIFN)=ORID,ORES("B",ORIFN)=ORI
"RTN","ORRCOR",156,0)
 . D REPLCD^ORCACT1 ;incl unverified replaced orders
"RTN","ORRCOR",157,0)
 Q:'$O(ORES(0))  S ORIFN=0 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN<1  D
"RTN","ORRCOR",158,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2),ORVP(ORVP)=""
"RTN","ORRCOR",159,0)
 . D EN^ORCSEND(ORIFN,"VR","","",,,.ORERR),UNLK1^ORX2(+ORIFN)
"RTN","ORRCOR",160,0)
 . S ORID=$G(ORES(ORIFN)),ORI=+$G(ORES("B",ORIFN))
"RTN","ORRCOR",161,0)
 . I ORI S ORY(ORI)=ORID_U_$S($G(ORERR):"0^"_$P(ORERR,U,2),1:1)
"RTN","ORRCOR",162,0)
 S ORVP="" F  S ORVP=$O(ORVP(ORVP)) Q:ORVP=""  D
"RTN","ORRCOR",163,0)
 . S ORWARD=$S($G(^DPT(+ORVP,.105)):1,1:0) ;inpt
"RTN","ORRCOR",164,0)
 . D CKALERT^ORCACT1 ;delete unver orders alerts
"RTN","ORRCOR",165,0)
 Q
"RTN","ORRCOR",166,0)
 ;
"RTN","ORRCOR",167,0)
COMP(ORY,ORUSR,ORDER) ; -- Mark ORDERs as completed by ORUSR
"RTN","ORRCOR",168,0)
 ;where ORDER(#) = ID = ORN:order#;action#
"RTN","ORRCOR",169,0)
 ;returns ORY(#) = ID^1 if successful, else ID^0^error
"RTN","ORRCOR",170,0)
 ;RPC = ORRC ORDERS COMPLETE
"RTN","ORRCOR",171,0)
 Q:'$G(ORUSR)  N ORNOW,ORI,ORID,ORIFN,ORLK
"RTN","ORRCOR",172,0)
 K ORY S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORRCOR",173,0)
 S ORI=""  F  S ORI=$O(ORDER(ORI)) Q:ORI=""  D
"RTN","ORRCOR",174,0)
 . S ORID=ORDER(ORI),ORIFN=+$P(ORID,":",2)
"RTN","ORRCOR",175,0)
 . S ORLK=$$LOCK1^ORX2(ORIFN) I 'ORLK S ORY(ORI)=ORID_U_ORLK Q
"RTN","ORRCOR",176,0)
 . D COMP^ORCSAVE2(ORIFN,ORUSR,ORNOW),UNLK1^ORX2(ORIFN)
"RTN","ORRCOR",177,0)
 . S ORY(ORI)=ORID_U_$S($P($G(^OR(100,ORIFN,6)),U,6):1,1:0)
"RTN","ORRCOR",178,0)
 Q
"VER")
8.0^22.0
"BLD",5368,6)
^2
**END**
**END**
