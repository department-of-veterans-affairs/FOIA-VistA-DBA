Released IB*2*382 SEQ #352
Extracted from mail message
**KIDS**:IB*2.0*382^

**INSTALL NAME**
IB*2.0*382
"BLD",6723,0)
IB*2.0*382^INTEGRATED BILLING^0^3071206^y
"BLD",6723,1,0)
^9.61A^1^1^3071019^^
"BLD",6723,1,1,0)
Reasonable Charges v2.11.  Charges are effective 10/01/07.
"BLD",6723,4,0)
^9.64PA^^
"BLD",6723,6.3)
2
"BLD",6723,"INID")
^n
"BLD",6723,"INIT")
POST^IBYPSL
"BLD",6723,"KRN",0)
^9.67PA^8989.52^19
"BLD",6723,"KRN",.4,0)
.4
"BLD",6723,"KRN",.401,0)
.401
"BLD",6723,"KRN",.402,0)
.402
"BLD",6723,"KRN",.403,0)
.403
"BLD",6723,"KRN",.5,0)
.5
"BLD",6723,"KRN",.84,0)
.84
"BLD",6723,"KRN",3.6,0)
3.6
"BLD",6723,"KRN",3.8,0)
3.8
"BLD",6723,"KRN",9.2,0)
9.2
"BLD",6723,"KRN",9.8,0)
9.8
"BLD",6723,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6723,"KRN",9.8,"NM",1,0)
IBCRHBRV^^0^B44079599
"BLD",6723,"KRN",9.8,"NM",2,0)
IBCRHBS8^^0^B45885095
"BLD",6723,"KRN",9.8,"NM",3,0)
IBCRHBV1^^1^
"BLD",6723,"KRN",9.8,"NM",4,0)
IBYPSL^^0^B8389539
"BLD",6723,"KRN",9.8,"NM",5,0)
IBCRBG^^0^B58493786
"BLD",6723,"KRN",9.8,"NM","B","IBCRBG",5)

"BLD",6723,"KRN",9.8,"NM","B","IBCRHBRV",1)

"BLD",6723,"KRN",9.8,"NM","B","IBCRHBS8",2)

"BLD",6723,"KRN",9.8,"NM","B","IBCRHBV1",3)

"BLD",6723,"KRN",9.8,"NM","B","IBYPSL",4)

"BLD",6723,"KRN",19,0)
19
"BLD",6723,"KRN",19.1,0)
19.1
"BLD",6723,"KRN",101,0)
101
"BLD",6723,"KRN",409.61,0)
409.61
"BLD",6723,"KRN",771,0)
771
"BLD",6723,"KRN",870,0)
870
"BLD",6723,"KRN",8989.51,0)
8989.51
"BLD",6723,"KRN",8989.52,0)
8989.52
"BLD",6723,"KRN",8994,0)
8994
"BLD",6723,"KRN","B",.4,.4)

"BLD",6723,"KRN","B",.401,.401)

"BLD",6723,"KRN","B",.402,.402)

"BLD",6723,"KRN","B",.403,.403)

"BLD",6723,"KRN","B",.5,.5)

"BLD",6723,"KRN","B",.84,.84)

"BLD",6723,"KRN","B",3.6,3.6)

"BLD",6723,"KRN","B",3.8,3.8)

"BLD",6723,"KRN","B",9.2,9.2)

"BLD",6723,"KRN","B",9.8,9.8)

"BLD",6723,"KRN","B",19,19)

"BLD",6723,"KRN","B",19.1,19.1)

"BLD",6723,"KRN","B",101,101)

"BLD",6723,"KRN","B",409.61,409.61)

"BLD",6723,"KRN","B",771,771)

"BLD",6723,"KRN","B",870,870)

"BLD",6723,"KRN","B",8989.51,8989.51)

"BLD",6723,"KRN","B",8989.52,8989.52)

"BLD",6723,"KRN","B",8994,8994)

"BLD",6723,"QUES",0)
^9.62^^
"BLD",6723,"REQB",0)
^9.611^1^1
"BLD",6723,"REQB",1,0)
IB*2.0*365^1
"BLD",6723,"REQB","B","IB*2.0*365",1)

"INIT")
POST^IBYPSL
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
382^3071206
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3071206
"PKG",200,22,1,"PAH",1,1,1,0)
Reasonable Charges v2.11.  Charges are effective 10/01/07.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBCRBG")
0^5^B58493786^B48558770
"RTN","IBCRBG",1,0)
IBCRBG ;ALB/ARH - RATES: BILL SOURCE EVENTS (INPT) ; 21 MAY 96
"RTN","IBCRBG",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,51,142,159,210,245,382**;21-MAR-94;Build 2
"RTN","IBCRBG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRBG",4,0)
 ;
"RTN","IBCRBG",5,0)
INPTPTF(IBIFN,CS) ; search PTF record for billable bedsections, transfer DRGs, and length of stay 
"RTN","IBCRBG",6,0)
 ; - screens out days for pass, leave and SC treatment
"RTN","IBCRBG",7,0)
 ; - adds charges for only one BS if the ins company does not allow multiple bedsections per bill (36,.06)
"RTN","IBCRBG",8,0)
 ; Output: ^TMP($J,"IBCRC-INDT", BILLABLE DATE) = MOVE DT/TM ^ BILL BS ^ SC FLAG ^ DRG ^ DIV ^ SPECIALTY ^ MOVE #
"RTN","IBCRBG",9,0)
 ;
"RTN","IBCRBG",10,0)
 N IB0,DFN,PTF,IBU,IBBDT,IBEDT,IBTF,IBADM,IBX,IBINSMBS
"RTN","IBCRBG",11,0)
 K ^TMP($J,"IBCRC-PTF"),^TMP($J,"IBCRC-DIV"),^TMP($J,"IBCRC-INDT")
"RTN","IBCRBG",12,0)
 ;
"RTN","IBCRBG",13,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),DFN=$P(IB0,U,2) Q:'DFN
"RTN","IBCRBG",14,0)
 S IBTF=$P(IB0,U,6),PTF="" S:$P(IB0,U,5)<3 PTF=$P(IB0,U,8) Q:'PTF
"RTN","IBCRBG",15,0)
 S IBINSMBS=0,IBX=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBCRBG",16,0)
 I 'IBX,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBX=$$CURR^IBCEF2(IBIFN)
"RTN","IBCRBG",17,0)
 I $P($G(^DIC(36,+IBX,0)),U,6)=0 S IBINSMBS=1 ; 1 bs per bill
"RTN","IBCRBG",18,0)
 ;
"RTN","IBCRBG",19,0)
 S IBU=$G(^DGCR(399,+IBIFN,"U")) Q:'IBU
"RTN","IBCRBG",20,0)
 S IBBDT=+IBU,IBEDT=$P(IBU,U,2) Q:'IBEDT
"RTN","IBCRBG",21,0)
 ;
"RTN","IBCRBG",22,0)
 S IBADM=$O(^DGPM("APTF",PTF,0)) ; find corresponding admission
"RTN","IBCRBG",23,0)
 ;
"RTN","IBCRBG",24,0)
 D PTF(PTF) ; get movements and bedsections
"RTN","IBCRBG",25,0)
 D PTFDV(PTF) ; reset movements and bedsections for ward/division
"RTN","IBCRBG",26,0)
 D PTFFY(PTF,IBBDT,IBEDT) ; reset movements for FY DRG change
"RTN","IBCRBG",27,0)
 ;
"RTN","IBCRBG",28,0)
 D BSLOS(IBBDT,IBEDT,IBTF,IBADM,IBINSMBS) ; calculate days in bedsections within timeframe of the bill
"RTN","IBCRBG",29,0)
 ;
"RTN","IBCRBG",30,0)
 K ^TMP($J,"IBCRC-PTF"),^TMP($J,"IBCRC-DIV")
"RTN","IBCRBG",31,0)
 ;
"RTN","IBCRBG",32,0)
 D INPTRSET^IBCRBG2(IBIFN,$G(CS))
"RTN","IBCRBG",33,0)
 Q
"RTN","IBCRBG",34,0)
 ;
"RTN","IBCRBG",35,0)
PTF(PTF) ; find all movements in PTF for the admission by date and billing bedsection (501 movement)
"RTN","IBCRBG",36,0)
 ; the movement date is the date the patient left the bedsection
"RTN","IBCRBG",37,0)
 ; Output: ^TMP($J,"IBCRC-PTF", MOVE DT/TM)=MOVE DT/TM ^ BILL BED ^ SC FLAG ^ TRANSFER DRG ^ ^ SPECIALTY ^ MOVE #
"RTN","IBCRBG",38,0)
 ;
"RTN","IBCRBG",39,0)
 N IBMOVE,IBMVLN,IBBILLBS,IBENDDT,IBMSC,IBMDRG S PTF=+$G(PTF)
"RTN","IBCRBG",40,0)
 S IBMOVE=0 F  S IBMOVE=$O(^DGPT(PTF,"M",IBMOVE)) Q:'IBMOVE  D
"RTN","IBCRBG",41,0)
 . S IBMVLN=^DGPT(PTF,"M",IBMOVE,0)
"RTN","IBCRBG",42,0)
 . S IBBILLBS=+$$SPBB($P(IBMVLN,U,2)) ;                                 billable bedsection
"RTN","IBCRBG",43,0)
 . S IBENDDT=+$P(IBMVLN,U,10) I 'IBENDDT S IBENDDT=DT ;                 movement date (last date in bedsection)
"RTN","IBCRBG",44,0)
 . S IBMSC="" I +$P(IBMVLN,U,18)=1 S IBMSC=1 ;                          sc movement
"RTN","IBCRBG",45,0)
 . S IBMDRG=$$MVDRG(PTF,IBMOVE) ;                                       movement DRG
"RTN","IBCRBG",46,0)
 . S ^TMP($J,"IBCRC-PTF",IBENDDT)=IBENDDT_U_IBBILLBS_U_IBMSC_U_IBMDRG_U_U_+$P(IBMVLN,U,2)_U_IBMOVE
"RTN","IBCRBG",47,0)
 Q
"RTN","IBCRBG",48,0)
 ;
"RTN","IBCRBG",49,0)
SPBB(SPCLTY) ; find the billable bedsection for a Specialty (42.4)
"RTN","IBCRBG",50,0)
 ; returns billable bedsection IFN ^ billable bedsection name
"RTN","IBCRBG",51,0)
 N IBX,IBY,IBZ S IBZ=0
"RTN","IBCRBG",52,0)
 S IBX=$P($G(^DIC(42.4,+$G(SPCLTY),0)),U,5)
"RTN","IBCRBG",53,0)
 I IBX'="" S IBY=$O(^DGCR(399.1,"B",IBX,0)) I +IBY S IBZ=IBY_U_IBX
"RTN","IBCRBG",54,0)
 Q IBZ
"RTN","IBCRBG",55,0)
 ;
"RTN","IBCRBG",56,0)
BSLOS(IBBDT,IBEDT,IBTF,IBADM,IBINSMBS) ; from the array of PTF movments get all bedsections and their LOS covered by date range of the bill
"RTN","IBCRBG",57,0)
 ; adds all days for first cronological bs if ins comp wants only a single bs per bill, even if not sequential
"RTN","IBCRBG",58,0)
 ; the movement date is the date the patient left the bedsection, so admission date is not in PTF array
"RTN","IBCRBG",59,0)
 ;
"RTN","IBCRBG",60,0)
 ; Input:  ^TMP($J,"IBCRC-PTF", MOVE DT/TM) = MOVE DT/TM ^ BILL BS ^ SC FLAG ^ DRG ^ DIV ^ SPECIALTY ^ MOVE #
"RTN","IBCRBG",61,0)
 ; Output: ^TMP($J,"IBCRC-INDT", BILLABLE DATE) = MOVE DT/TM ^ BILL BS ^ SC FLAG ^ DRG ^ DIV ^ SPECIALTY ^ MOVE #
"RTN","IBCRBG",62,0)
 ;
"RTN","IBCRBG",63,0)
 N IBSBDT,IBSEDT,IBS,IBLASTDT,IBX
"RTN","IBCRBG",64,0)
 S IBSBDT=IBBDT+.3 ;                        discount any movements ending on or before the begin date
"RTN","IBCRBG",65,0)
 S IBSEDT=IBEDT\1
"RTN","IBCRBG",66,0)
 ; 
"RTN","IBCRBG",67,0)
 I ",2,3,"'[IBTF S IBSEDT=IBSEDT-.01 ;      final bill, do not count last day
"RTN","IBCRBG",68,0)
 ;
"RTN","IBCRBG",69,0)
 I +$G(IBADM) S IBX=$$AD^IBCU64(IBADM) I +IBX,($P(IBX,U,1)\1)=($P(IBX,U,2)\1) S IBSBDT=IBBDT ; reset 1 day stays
"RTN","IBCRBG",70,0)
 ;
"RTN","IBCRBG",71,0)
 S IBS=IBSBDT-.01 F  S IBS=$O(^TMP($J,"IBCRC-PTF",IBS)) Q:'IBS  D SET S IBLASTDT=IBS Q:(IBLASTDT\1)>IBSEDT
"RTN","IBCRBG",72,0)
 ;
"RTN","IBCRBG",73,0)
 Q
"RTN","IBCRBG",74,0)
 ;
"RTN","IBCRBG",75,0)
SET ; checks a specific movement to determine if it should be billed and what the length of stay is
"RTN","IBCRBG",76,0)
 ; setting of the movement date determines how many days are counted in the bedsection
"RTN","IBCRBG",77,0)
 N IBMVLN,IBMBDT,IBMEDT,IBMTF,IBMLOS,IBI,IBCHGDT
"RTN","IBCRBG",78,0)
 S IBMVLN=$G(^TMP($J,"IBCRC-PTF",IBS))
"RTN","IBCRBG",79,0)
 I '$P(IBMVLN,U,2) Q  ;                                              non-billable bedsection
"RTN","IBCRBG",80,0)
 I +$P(IBMVLN,U,3) Q  ;                                              sc movement
"RTN","IBCRBG",81,0)
 I +IBINSMBS,+$G(IBLASTDT) Q  ;                                      ins does not allow multiple bs
"RTN","IBCRBG",82,0)
 ;
"RTN","IBCRBG",83,0)
 S IBMBDT=$S(IBBDT>$G(IBLASTDT):IBBDT,1:IBLASTDT),IBMBDT=IBMBDT\1 ;  start cnt on begin dt or last move dt
"RTN","IBCRBG",84,0)
 S IBMEDT=$S(IBS<IBEDT:IBS,1:IBEDT),IBMEDT=IBMEDT\1 ;                end cnt on move dt or end dt
"RTN","IBCRBG",85,0)
 S IBMTF=$S(IBEDT<(IBS\1):IBTF,1:1) ;                                last movement gets timeframe
"RTN","IBCRBG",86,0)
 S IBMLOS=$$LOS^IBCU64(IBMBDT,IBMEDT,IBMTF,IBADM) Q:'IBMLOS  ;       calculate the LOS for the movement
"RTN","IBCRBG",87,0)
 ;
"RTN","IBCRBG",88,0)
 F IBI=1:1:IBMLOS S IBCHGDT=$$FMADD^XLFDT(IBMBDT,(IBI-1)),^TMP($J,"IBCRC-INDT",+IBCHGDT)=IBMVLN
"RTN","IBCRBG",89,0)
 Q
"RTN","IBCRBG",90,0)
 ;
"RTN","IBCRBG",91,0)
BBS(X) ; returns true if pointer passed in is a billable bedsection ^ bedsection name
"RTN","IBCRBG",92,0)
 N IBX,IBY S IBY=0,IBX=$G(^DGCR(399.1,+$G(X),0)) I +$P(IBX,U,5) S IBY=1_U_$P(IBX,U,1)
"RTN","IBCRBG",93,0)
 Q IBY
"RTN","IBCRBG",94,0)
 ;
"RTN","IBCRBG",95,0)
 Q
"RTN","IBCRBG",96,0)
 ;
"RTN","IBCRBG",97,0)
PTFDV(PTF) ; find all ward/location transfers in PTF for the patient to determine the site/division the patient was in
"RTN","IBCRBG",98,0)
 ; the division of the ward will be added to the PTF bedsection movements
"RTN","IBCRBG",99,0)
 ; Input:  ^TMP($J,"IBCRC-PTF", move dt/tm) = move dt/tm ^ bill bs ^ sc flag ^ move drg ^ ^ specialty ^ move #
"RTN","IBCRBG",100,0)
 ; Output: ^TMP($J,"IBCRC-PTF", move dt/tm) = move dt/tm ^ bill bs ^ sc flag ^ move drg ^ WARD DIV ^ spec ^ move#
"RTN","IBCRBG",101,0)
 ;          ^TMP($J,"IBCRC-DIV", TRANSFER DATE/TIME) = WARD DIVISION
"RTN","IBCRBG",102,0)
 N IBTRNSF,IBTRLN,IBENDDT,IBTRDV,IBMVDT,IBTRDT
"RTN","IBCRBG",103,0)
 ;
"RTN","IBCRBG",104,0)
 I '$O(^TMP($J,"IBCRC-PTF",0)) Q
"RTN","IBCRBG",105,0)
 ;
"RTN","IBCRBG",106,0)
 ; get all ward transfers
"RTN","IBCRBG",107,0)
 S IBTRNSF=0 F  S IBTRNSF=$O(^DGPT(PTF,535,IBTRNSF)) Q:'IBTRNSF  D
"RTN","IBCRBG",108,0)
 . S IBTRLN=$G(^DGPT(PTF,535,+IBTRNSF,0))
"RTN","IBCRBG",109,0)
 . S IBENDDT=$P(IBTRLN,U,10) I 'IBENDDT S IBENDDT=DT ;                  transfer date (last date in ward)
"RTN","IBCRBG",110,0)
 . S IBTRDV=$P($G(^DIC(42,+$P(IBTRLN,U,6),0)),U,11) Q:'IBTRDV  ;        losing ward division
"RTN","IBCRBG",111,0)
 . S ^TMP($J,"IBCRC-DIV",IBENDDT)=IBTRDV
"RTN","IBCRBG",112,0)
 ;
"RTN","IBCRBG",113,0)
 ; if the ward transfer does not coincide with a specialty transfer add bedsection move on the transfer date
"RTN","IBCRBG",114,0)
 S IBENDDT=0 F  S IBENDDT=$O(^TMP($J,"IBCRC-DIV",IBENDDT)) Q:'IBENDDT  D
"RTN","IBCRBG",115,0)
 . S IBMVDT=$O(^TMP($J,"IBCRC-PTF",(IBENDDT-.0000001)))
"RTN","IBCRBG",116,0)
 . I 'IBMVDT Q  ; - transfer movement dates after the discharge date in the PTF file (inconsistent)
"RTN","IBCRBG",117,0)
 . I $P(IBENDDT,".")'=$P(IBMVDT,".") S ^TMP($J,"IBCRC-PTF",IBENDDT)=$G(^TMP($J,"IBCRC-PTF",IBMVDT))
"RTN","IBCRBG",118,0)
 ;
"RTN","IBCRBG",119,0)
 ; add the ward division to the bedsection/specialty
"RTN","IBCRBG",120,0)
 S IBENDDT=0 F  S IBENDDT=$O(^TMP($J,"IBCRC-PTF",IBENDDT)) Q:'IBENDDT  D
"RTN","IBCRBG",121,0)
 . S IBTRDT=$O(^TMP($J,"IBCRC-DIV",(IBENDDT-.0000001))) ;              ward transfer covering this bedsection
"RTN","IBCRBG",122,0)
 . S IBTRDV=$G(^TMP($J,"IBCRC-DIV",+IBTRDT)) ;                         ward division
"RTN","IBCRBG",123,0)
 . I +IBTRDV S $P(^TMP($J,"IBCRC-PTF",IBENDDT),U,5)=IBTRDV
"RTN","IBCRBG",124,0)
 Q
"RTN","IBCRBG",125,0)
 ;
"RTN","IBCRBG",126,0)
PTFFY(PTF,BEGDT,ENDDT) ; add movement for FY (10/1) if date range covers FY and DRG changes
"RTN","IBCRBG",127,0)
 ; the DRG may change on FY so check and if necessary add movement for pre-FY with old DRG
"RTN","IBCRBG",128,0)
 ; Input:  ^TMP($J,"IBCRC-PTF", move dt/tm) = move dt/tm ^ bill bs ^ sc flag ^ move drg ^ ^ specialty ^ move #
"RTN","IBCRBG",129,0)
 ; Output: ^TMP($J,"IBCRC-PTF", move dt/tm) = move dt/tm ^ bill bs ^ sc flag ^ MOVE DRG ^ ward div ^ spec ^ move#
"RTN","IBCRBG",130,0)
 N IBBEGDT,IBENDDT,IBYRB,IBYRE,IBYR,IBFY,IBMVLN,IBMVDRG,IBMOVE,IBFYDRG Q:'$G(PTF)
"RTN","IBCRBG",131,0)
 Q:'$G(BEGDT)  S IBFY=$E(BEGDT,1,3)_"1001" I (BEGDT>IBFY)!($G(ENDDT)<IBFY) Q
"RTN","IBCRBG",132,0)
 ;
"RTN","IBCRBG",133,0)
 S IBBEGDT=BEGDT,IBENDDT=BEGDT\1 F  S IBENDDT=$O(^TMP($J,"IBCRC-PTF",IBENDDT)) Q:'IBENDDT  D  S IBBEGDT=IBENDDT
"RTN","IBCRBG",134,0)
 . S IBYRB=$E(IBBEGDT,1,3),IBYRE=$E(IBENDDT,1,3) I (IBYRE-IBYRB)>10 Q
"RTN","IBCRBG",135,0)
 . F IBYR=IBYRB:1:IBYRE S IBFY=IBYR_"1001" I IBBEGDT<IBFY,IBENDDT>IBFY D
"RTN","IBCRBG",136,0)
 .. S IBMVLN=$G(^TMP($J,"IBCRC-PTF",IBENDDT)),IBMVDRG=$P(IBMVLN,U,4),IBMOVE=$P(IBMVLN,U,7)
"RTN","IBCRBG",137,0)
 .. S IBFYDRG=$$MVDRG(PTF,IBMOVE,IBYR_"0930")
"RTN","IBCRBG",138,0)
 .. I IBMVDRG'=IBFYDRG S $P(IBMVLN,U,4)=IBFYDRG S ^TMP($J,"IBCRC-PTF",IBFY)=IBMVLN
"RTN","IBCRBG",139,0)
 Q
"RTN","IBCRBG",140,0)
 ;
"RTN","IBCRBG",141,0)
MVDRG(PTF,M,CDATE) ; Return the DRG for a specific PTF Movememt (M=move ifn)
"RTN","IBCRBG",142,0)
 ; CDATE is optional, used if need to calculate DRG for some day within the move, not at the end date
"RTN","IBCRBG",143,0)
 N DPT0,PTF0,PTFM0,PTF70,IBBEG,IBEND,IBDSST,IBDX,IBPRC0,IBPRC,IBDRG,IBI,IBJ,IBP
"RTN","IBCRBG",144,0)
 N SEX,AGE,ICDDX,ICDPRC,ICDEXP,ICDDMS,ICDTRS,ICDDRG,ICDMDC,ICDRTC,ICDDATE
"RTN","IBCRBG",145,0)
 S IBDRG=""
"RTN","IBCRBG",146,0)
 ;
"RTN","IBCRBG",147,0)
 S PTF0=$G(^DGPT(+$G(PTF),0)),DPT0=$G(^DPT(+$P(PTF0,U,1),0)) I DPT0="" G MVDRGQ
"RTN","IBCRBG",148,0)
 S PTFM0=$G(^DGPT(+PTF,"M",+$G(M),0)) I 'PTFM0 G MVDRGQ
"RTN","IBCRBG",149,0)
 S PTF70=$G(^DGPT(+PTF,70)),IBDSST=+$P(PTF70,U,3)
"RTN","IBCRBG",150,0)
 ;
"RTN","IBCRBG",151,0)
 S IBEND=+$P(PTFM0,U,10) I 'IBEND S IBEND=DT+.9
"RTN","IBCRBG",152,0)
 S IBBEG=$O(^DGPT(+PTF,"M","AM",IBEND),-1) I 'IBBEG S IBBEG=$P(PTF0,U,2)
"RTN","IBCRBG",153,0)
 ;
"RTN","IBCRBG",154,0)
 S SEX=$P(DPT0,U,2)
"RTN","IBCRBG",155,0)
 S AGE=$P(DPT0,U,3),AGE=$$FMDIFF^XLFDT(IBEND,AGE)\365.25
"RTN","IBCRBG",156,0)
 ;
"RTN","IBCRBG",157,0)
 S (ICDEXP,ICDDMS,ICDTRS)=0 I +PTF70,+PTF70=$P(PTFM0,U,10) D
"RTN","IBCRBG",158,0)
 . I IBDSST>5 S ICDEXP=1 ;  patient expired
"RTN","IBCRBG",159,0)
 . I IBDSST=4 S ICDDMS=1 ;  patient left against medical advice
"RTN","IBCRBG",160,0)
 . I IBDSST=5,+$P(PTF70,U,13) S ICDTRS=1 ; patient transfered to another facility
"RTN","IBCRBG",161,0)
 ;
"RTN","IBCRBG",162,0)
 S IBJ=0 F IBI=5:1:9 S IBDX=$P(PTFM0,U,IBI) I +IBDX,($$ICD9^IBACSV(+IBDX)'="") S IBJ=IBJ+1,ICDDX(IBJ)=IBDX
"RTN","IBCRBG",163,0)
 ;
"RTN","IBCRBG",164,0)
 I '$O(ICDDX(0)) G MVDRGQ
"RTN","IBCRBG",165,0)
 ;
"RTN","IBCRBG",166,0)
 S IBJ=0
"RTN","IBCRBG",167,0)
 S IBP=0 F  S IBP=$O(^DGPT(+PTF,"S",IBP)) Q:'IBP  D  ; surguries
"RTN","IBCRBG",168,0)
 . S IBPRC0=$G(^DGPT(+PTF,"S",IBP,0)) Q:'IBPRC0
"RTN","IBCRBG",169,0)
 . I +IBPRC0'<IBBEG,+IBPRC0'>IBEND D
"RTN","IBCRBG",170,0)
 .. F IBI=8:1:12 S IBPRC=$P(IBPRC0,U,IBI) I +IBPRC,($$ICD0^IBACSV(+IBPRC)'="") S IBJ=IBJ+1,ICDPRC(IBJ)=+IBPRC
"RTN","IBCRBG",171,0)
 ;
"RTN","IBCRBG",172,0)
 S IBP=0 F  S IBP=$O(^DGPT(+PTF,"P",IBP)) Q:'IBP  D  ; procedures
"RTN","IBCRBG",173,0)
 . S IBPRC0=$G(^DGPT(+PTF,"P",IBP,0)) Q:'IBPRC0
"RTN","IBCRBG",174,0)
 . I +IBPRC0'<IBBEG,+IBPRC0'>IBEND D
"RTN","IBCRBG",175,0)
 .. F IBI=5:1:9 S IBPRC=$P(IBPRC0,U,IBI) I +IBPRC,($$ICD0^IBACSV(+IBPRC)'="") S IBJ=IBJ+1,ICDPRC(IBJ)=+IBPRC
"RTN","IBCRBG",176,0)
 ;
"RTN","IBCRBG",177,0)
 S ICDDATE=$S(+$G(CDATE):CDATE,+$P(PTFM0,U,10):+$P(PTFM0,U,10),1:DT) ; date for the DRG Grouper versioning
"RTN","IBCRBG",178,0)
 D ^ICDDRG S IBDRG=$G(ICDDRG)
"RTN","IBCRBG",179,0)
 ;
"RTN","IBCRBG",180,0)
MVDRGQ Q IBDRG
"RTN","IBCRHBRV")
0^1^B44079599^B78430329
"RTN","IBCRHBRV",1,0)
IBCRHBRV ;ALB/ARH - RATES: UPLOAD (RC) VERSION FUNCTIONS ; 14-FEB-01
"RTN","IBCRHBRV",2,0)
 ;;2.0;INTEGRATED BILLING;**148,169,245,270,285,298,325,334,355,360,365,382**;21-MAR-94;Build 2
"RTN","IBCRHBRV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRHBRV",4,0)
 ;
"RTN","IBCRHBRV",5,0)
 ; RC functions related to Version.  Update VLIST with new versions.  Update FTYPE if new types of files.
"RTN","IBCRHBRV",6,0)
 ;
"RTN","IBCRHBRV",7,0)
SELVERS() ; get version to upload from user
"RTN","IBCRHBRV",8,0)
 N DIR,DIRUT,DTOUT,DUOUT,IBVLIST,IBQUIT,IBVERS,IBI,IBJ,IBX,X,Y
"RTN","IBCRHBRV",9,0)
 ;
"RTN","IBCRHBRV",10,0)
 S IBVLIST=$$VERSTR(),IBQUIT=0,IBVERS=0
"RTN","IBCRHBRV",11,0)
 ;
"RTN","IBCRHBRV",12,0)
 W !!,"Select the version of Reasonable Charges to upload."
"RTN","IBCRHBRV",13,0)
 S DIR("?",1)="Enter the code from the list corresponding to the version of Reasonable Charges"
"RTN","IBCRHBRV",14,0)
 S DIR("?",2)="to upload.  There are no version 1.3, 2.2, or 2.10 (ten) RC charges." S DIR("?",3)=" "
"RTN","IBCRHBRV",15,0)
 S DIR("?",4)="Versions: "_IBVLIST S DIR("?",5)=" " S DIR("?")="Enter version number to upload."
"RTN","IBCRHBRV",16,0)
 ;
"RTN","IBCRHBRV",17,0)
 F IBI=1:1 D  I +IBQUIT Q
"RTN","IBCRHBRV",18,0)
 . W !!,?5,"Select one of the following:",!
"RTN","IBCRHBRV",19,0)
 . F IBJ=1:1 S IBX=$P(IBVLIST,",",IBJ) Q:'IBX  W !,?10,IBX,?20,"Reasonable Charges version ",IBX
"RTN","IBCRHBRV",20,0)
 . ;
"RTN","IBCRHBRV",21,0)
 . W ! S DIR("A")="Enter Version" S DIR(0)="FO^1:5" D ^DIR I $D(DIRUT) S IBQUIT=1
"RTN","IBCRHBRV",22,0)
 . I Y>0,(","_IBVLIST_",")[(","_Y_",") S IBVERS=Y,IBQUIT=1 W "  Reasonable Charges version ",IBVERS
"RTN","IBCRHBRV",23,0)
 ;
"RTN","IBCRHBRV",24,0)
 Q IBVERS
"RTN","IBCRHBRV",25,0)
 ;
"RTN","IBCRHBRV",26,0)
VERSION() ; return currently loaded version of RC files (1, 1.1, ...)
"RTN","IBCRHBRV",27,0)
 N IBX S IBX=$G(^XTMP("IBCR RC SITE","VERSION"))
"RTN","IBCRHBRV",28,0)
 Q IBX
"RTN","IBCRHBRV",29,0)
 ;
"RTN","IBCRHBRV",30,0)
VERSDT(VERS) ; return Effective Date of a version of RC files, either version passed in or currently loaded version
"RTN","IBCRHBRV",31,0)
 N IBI,LINE,IBX S IBX="" S VERS=+$G(VERS) I 'VERS S VERS=$$VERSION
"RTN","IBCRHBRV",32,0)
 I +VERS F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  I VERS=+LINE S IBX=$P(LINE,U,3)
"RTN","IBCRHBRV",33,0)
 Q IBX
"RTN","IBCRHBRV",34,0)
 ;
"RTN","IBCRHBRV",35,0)
VERSEDT(VERS) ; return Inactive Date of a version of RC files, either version passed in or currently loaded version
"RTN","IBCRHBRV",36,0)
 N IBI,LINE,IBX S IBX="" S VERS=+$G(VERS) I 'VERS S VERS=$$VERSION
"RTN","IBCRHBRV",37,0)
 I +VERS F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  I VERS=+LINE S IBX=$P(LINE,U,4)
"RTN","IBCRHBRV",38,0)
 Q IBX
"RTN","IBCRHBRV",39,0)
 ;
"RTN","IBCRHBRV",40,0)
VERSALL() ; return all RC versions and corresponding effective date 'VERS;EFFDT^VERS;EFFDT^...'
"RTN","IBCRHBRV",41,0)
 N IBI,LINE,IBX,IBC S IBX="",IBC=""
"RTN","IBCRHBRV",42,0)
 F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  S IBX=IBX_IBC_+LINE_";"_$P(LINE,U,3),IBC=U
"RTN","IBCRHBRV",43,0)
 Q IBX
"RTN","IBCRHBRV",44,0)
 ;
"RTN","IBCRHBRV",45,0)
VERSEND() ; return all RC versions and corresponding inactive date 'VERS;INACTIVE DT^VERS;INACTIVE DT^...'
"RTN","IBCRHBRV",46,0)
 N IBI,LINE,IBX,IBC S IBX="",IBC=""
"RTN","IBCRHBRV",47,0)
 F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  I $P(LINE,U,4) S IBX=IBX_IBC_+LINE_";"_$P(LINE,U,4),IBC=U
"RTN","IBCRHBRV",48,0)
 Q IBX
"RTN","IBCRHBRV",49,0)
 ;
"RTN","IBCRHBRV",50,0)
VERSITE(SITE) ; returns the list of versions loaded for a particular site
"RTN","IBCRHBRV",51,0)
 ; *** uses 99201 in the RC PHYSICIAN set to check which versions/dates are loaded
"RTN","IBCRHBRV",52,0)
 ; *** so 99201 must have a pro charge in all versions, if not it must be replaced with an item that does
"RTN","IBCRHBRV",53,0)
 N IBCS,IBXRF,IBITM,IBVERS,IBCSFN,IBI,IBV,IBX,IBY,IBC
"RTN","IBCRHBRV",54,0)
 S IBVERS=$$VERSALL,IBITM=99201
"RTN","IBCRHBRV",55,0)
 ;
"RTN","IBCRHBRV",56,0)
 I $G(SITE)'="" S IBCS="RC-PHYSICIAN" F  S IBCS=$O(^IBE(363.1,"B",IBCS)) Q:IBCS'["RC-PHYSICIAN"  D
"RTN","IBCRHBRV",57,0)
 . S IBV=$L(IBCS," ") I $P(IBCS," ",IBV)'=SITE Q
"RTN","IBCRHBRV",58,0)
 . S IBCSFN=$O(^IBE(363.1,"B",IBCS,0)) Q:'IBCSFN  S IBXRF="AIVDTS"_IBCSFN
"RTN","IBCRHBRV",59,0)
 . F IBI=1:1 S IBV=$P(IBVERS,U,IBI) Q:'IBV  I $O(^IBA(363.2,IBXRF,IBITM,-$P(IBV,";",2),0)) S IBY(+IBV)=""
"RTN","IBCRHBRV",60,0)
 ;
"RTN","IBCRHBRV",61,0)
 S (IBX,IBC)="" F IBI=1:1 S IBV=+$P(IBVERS,U,IBI) Q:'IBV  I $D(IBY(IBV)) S IBX=IBX_IBC_IBV S IBC=","
"RTN","IBCRHBRV",62,0)
 ;
"RTN","IBCRHBRV",63,0)
 Q IBX
"RTN","IBCRHBRV",64,0)
 ;
"RTN","IBCRHBRV",65,0)
MSGSITE(SITE) ; display a message indicating which versions are loaded for a site
"RTN","IBCRHBRV",66,0)
 N IBVERS Q:'$G(SITE)
"RTN","IBCRHBRV",67,0)
 S IBVERS=$$VERSITE(SITE)
"RTN","IBCRHBRV",68,0)
 I 'IBVERS W !!,?12,"There appear to be no RC charges already loaded for "_SITE_"."
"RTN","IBCRHBRV",69,0)
 I +IBVERS W !!,?12,"RC versions "_IBVERS_" appear to be already loaded for "_SITE_"."
"RTN","IBCRHBRV",70,0)
 Q
"RTN","IBCRHBRV",71,0)
 ;
"RTN","IBCRHBRV",72,0)
MSGVERS(SITE) ; check if versions are being loaded in the correct order, should be loaded in date order
"RTN","IBCRHBRV",73,0)
 ;   - if loading a version that has already been loaded for the site
"RTN","IBCRHBRV",74,0)
 ;   - if loading a version when any future versions have already been loaded for the site
"RTN","IBCRHBRV",75,0)
 ;   - if loading a version when the last version has not yet been loaded for the site
"RTN","IBCRHBRV",76,0)
 ; *** uses 99201 in the RC PHYSICIAN set to check which versions/dates are loaded
"RTN","IBCRHBRV",77,0)
 ; *** so 99201 must have a pro charge in all versions, if not it must be replaced with an item that does
"RTN","IBCRHBRV",78,0)
 N IBVERS,IBVDTC,IBVERSIN,IBVERSC,IBVERSO,IBI,VERSTR Q:'$G(SITE)
"RTN","IBCRHBRV",79,0)
 ;
"RTN","IBCRHBRV",80,0)
 S IBVERS=$$VERSION Q:'IBVERS  S IBVDTC=$$VERSDT,IBVERSIN=","_$$VERSITE(SITE)_",",IBVERSC=","_IBVERS_","
"RTN","IBCRHBRV",81,0)
 ;
"RTN","IBCRHBRV",82,0)
 ; check if loading a version that has already been loaded
"RTN","IBCRHBRV",83,0)
 I IBVERSIN[IBVERSC D
"RTN","IBCRHBRV",84,0)
 . W !!,?5,"*** It appears version RC v",IBVERS," has already been loaded for this site ***"
"RTN","IBCRHBRV",85,0)
 ;
"RTN","IBCRHBRV",86,0)
 ; check if loading a version when any future versions have already been loaded
"RTN","IBCRHBRV",87,0)
 S VERSTR=","_$$VERSTR()_",",VERSTR=$P(VERSTR,IBVERSC,2) ; all versions after current version
"RTN","IBCRHBRV",88,0)
 F IBI=1:1 S IBVERSO=$P(VERSTR,",",IBI) Q:'IBVERSO  I IBVERSIN[(","_IBVERSO_",")  D
"RTN","IBCRHBRV",89,0)
 . W !!,?5,">>> Currently trying to load RC v"_IBVERS_" but RC v"_IBVERSO_" appears to be already",!,?9,"loaded for this site.  The versions should be loaded in date order."
"RTN","IBCRHBRV",90,0)
 ;
"RTN","IBCRHBRV",91,0)
 ; check if loading a version when the last version has not yet been loaded
"RTN","IBCRHBRV",92,0)
 S VERSTR=","_$$VERSTR(1)_",",VERSTR=$P(VERSTR,IBVERSC,2) ; all versions before current version, reverse order
"RTN","IBCRHBRV",93,0)
 S IBVERSO=$P(VERSTR,",",1) I +IBVERSO,IBVERSIN'[(","_IBVERSO_",") D
"RTN","IBCRHBRV",94,0)
 . W !!,?5,"*** Currently trying to load RC v"_IBVERS_" but RC v"_IBVERSO_" does not appear to be",!,?9,"loaded for this site.  The versions should be loaded in date order."
"RTN","IBCRHBRV",95,0)
 . W !!,?5,">>> Continue only if there will never be a need to bill events before ",!,?9,$$FMTE^XLFDT(IBVDTC,2)," for this site.  If RC v"_IBVERSO_" will be needed for this site then",!,?9,"load it first."
"RTN","IBCRHBRV",96,0)
 ;
"RTN","IBCRHBRV",97,0)
 Q
"RTN","IBCRHBRV",98,0)
 ;
"RTN","IBCRHBRV",99,0)
VERSTR(RVRS) ; returns string containing list of all Reasonable Charges versions with charges, separated by ","
"RTN","IBCRHBRV",100,0)
 ; RVRS - if set, returns the list of versions in reverse order
"RTN","IBCRHBRV",101,0)
 N IBI,LINE,IBS,IBR,IBC,IBX  S (IBS,IBR,IBC,IBX)=""
"RTN","IBCRHBRV",102,0)
 F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  S IBS=IBS_IBC_+LINE,IBR=+LINE_IBC_IBR S IBC=","
"RTN","IBCRHBRV",103,0)
 S IBX=IBS I +$G(RVRS) S IBX=IBR
"RTN","IBCRHBRV",104,0)
 Q IBX
"RTN","IBCRHBRV",105,0)
 ;
"RTN","IBCRHBRV",106,0)
 ;
"RTN","IBCRHBRV",107,0)
 ;
"RTN","IBCRHBRV",108,0)
 ;
"RTN","IBCRHBRV",109,0)
 ;
"RTN","IBCRHBRV",110,0)
 ;
"RTN","IBCRHBRV",111,0)
 ;
"RTN","IBCRHBRV",112,0)
 ; File Names:  'IBRCyymmx.TXT'   w/ yymm - year month of version release (except v1)
"RTN","IBCRHBRV",113,0)
 ;              'IBRCyymm', file version identifier prefix, from VLIST text version description
"RTN","IBCRHBRV",114,0)
 ;              x=A-I/F, single character file identifier, from FTYPE text file description
"RTN","IBCRHBRV",115,0)
 ;
"RTN","IBCRHBRV",116,0)
FILES(IBFILES,VERS) ; returns array of source Host Files and data for version requested, pass IBFILES by reference
"RTN","IBCRHBRV",117,0)
 N IBI,LINE,IBTYPE,IBFILE,IBNAME,IBDESC S VERS=+$G(VERS) I 'VERS S VERS=1
"RTN","IBCRHBRV",118,0)
 ;
"RTN","IBCRHBRV",119,0)
 ; get requested versions data
"RTN","IBCRHBRV",120,0)
 F IBI=1:1 S LINE=$P($T(VLIST+IBI),";;",2,99) Q:'LINE  I VERS=+LINE S IBTYPE=$P(LINE,U,2),IBFILE=$P(LINE,U,5) Q
"RTN","IBCRHBRV",121,0)
 ;
"RTN","IBCRHBRV",122,0)
 ; get requested versions files
"RTN","IBCRHBRV",123,0)
 I +$G(IBTYPE) F IBI=1:1 S LINE=$P($T(@("FT"_IBTYPE)+IBI),";;",2,99) Q:LINE=""  D
"RTN","IBCRHBRV",124,0)
 . S IBNAME=IBFILE_$P(LINE,":",1)_".TXT",IBDESC="RC v"_+VERS_" "_$P(LINE,":",2,99)
"RTN","IBCRHBRV",125,0)
 . S IBFILES(IBNAME)=IBDESC
"RTN","IBCRHBRV",126,0)
 Q
"RTN","IBCRHBRV",127,0)
 ;
"RTN","IBCRHBRV",128,0)
 ;
"RTN","IBCRHBRV",129,0)
 ; versions and their critical data, add new versions here
"RTN","IBCRHBRV",130,0)
VLIST ; version ^ file type/version ^ effective date ^ inactive date ^ file prefix
"RTN","IBCRHBRV",131,0)
 ;;1.0^1^2990901^3001101^IBRCV
"RTN","IBCRHBRV",132,0)
 ;;1.1^1^3001102^3010507^IBRC0011
"RTN","IBCRHBRV",133,0)
 ;;1.2^1^3010508^3030428^IBRC0105
"RTN","IBCRHBRV",134,0)
 ;;1.4^1^3030429^3031218^IBRC0304
"RTN","IBCRHBRV",135,0)
 ;;2.0^2^3031219^3040414^IBRC0312
"RTN","IBCRHBRV",136,0)
 ;;2.1^2^3040415^3041231^IBRC0404
"RTN","IBCRHBRV",137,0)
 ;;2.3^2^3050101^3050410^IBRC0501
"RTN","IBCRHBRV",138,0)
 ;;2.4^2^3050411^3050930^IBRC0504
"RTN","IBCRHBRV",139,0)
 ;;2.5^2^3051001^3051231^IBRC0510
"RTN","IBCRHBRV",140,0)
 ;;2.6^2^3060101^3060824^IBRC0601
"RTN","IBCRHBRV",141,0)
 ;;2.7^2^3060825^3060930^IBRC0608
"RTN","IBCRHBRV",142,0)
 ;;2.8^2^3061001^3061231^IBRC0610
"RTN","IBCRHBRV",143,0)
 ;;2.9^2^3070101^3070930^IBRC0701
"RTN","IBCRHBRV",144,0)
 ;;2.11^2^3071001^^IBRC0710
"RTN","IBCRHBRV",145,0)
 ;;
"RTN","IBCRHBRV",146,0)
 ; 
"RTN","IBCRHBRV",147,0)
 ; 
"RTN","IBCRHBRV",148,0)
 ; 
"RTN","IBCRHBRV",149,0)
 ; 
"RTN","IBCRHBRV",150,0)
 ; 
"RTN","IBCRHBRV",151,0)
 ; 
"RTN","IBCRHBRV",152,0)
 ; 
"RTN","IBCRHBRV",153,0)
FTYPE ; file type/versions and relevant data
"RTN","IBCRHBRV",154,0)
 ; file identifer is used with XTMP subscript 'IBCR RC ' and routine label to parse file
"RTN","IBCRHBRV",155,0)
 ; file identifier : file name/description ^ file identifier ^ number of columns (for v2+)
"RTN","IBCRHBRV",156,0)
 ;
"RTN","IBCRHBRV",157,0)
FT1 ; Reasonable Charge File Type 1 files
"RTN","IBCRHBRV",158,0)
 ;;A:Inpatient Facility Charges^A
"RTN","IBCRHBRV",159,0)
 ;;B:Inpatient Facility Area Factors^B
"RTN","IBCRHBRV",160,0)
 ;;C:Outpatient Facility Charges^C
"RTN","IBCRHBRV",161,0)
 ;;D:Outpatient Facility Area Factors^D
"RTN","IBCRHBRV",162,0)
 ;;E:Physician Charges E^E
"RTN","IBCRHBRV",163,0)
 ;;F:Physician Charges F^F
"RTN","IBCRHBRV",164,0)
 ;;G:Physician Charges G^G
"RTN","IBCRHBRV",165,0)
 ;;H:Physician Area Factors^H
"RTN","IBCRHBRV",166,0)
 ;;I:Physician Unit Area Factors^I
"RTN","IBCRHBRV",167,0)
 ;;
"RTN","IBCRHBRV",168,0)
 ;
"RTN","IBCRHBRV",169,0)
FT2 ; Reasonable Charges File Type 2 files
"RTN","IBCRHBRV",170,0)
 ;;A:Inpatient Facility Charges^A^10
"RTN","IBCRHBRV",171,0)
 ;;B:Outpatient Facility Charges^B^14
"RTN","IBCRHBRV",172,0)
 ;;C:Professional Charges^C^23
"RTN","IBCRHBRV",173,0)
 ;;D:Service Category Codes^D^4
"RTN","IBCRHBRV",174,0)
 ;;E:Area Factors^E^41
"RTN","IBCRHBRV",175,0)
 ;;F:VA Sites and Zip Codes^F^4
"RTN","IBCRHBRV",176,0)
 ;;
"RTN","IBCRHBS8")
0^2^B45885095^B45646528
"RTN","IBCRHBS8",1,0)
IBCRHBS8 ;ALB/ARH - RATES: UPLOAD (RC 2+) CALCULATIONS CHARGE ; 10-OCT-03
"RTN","IBCRHBS8",2,0)
 ;;2.0;INTEGRATED BILLING;**245,382**;21-MAR-94;Build 2
"RTN","IBCRHBS8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCRHBS8",4,0)
 ;
"RTN","IBCRHBS8",5,0)
 ;
"RTN","IBCRHBS8",6,0)
ISA(SITE,ITLINE) ; Return Inpatient DRG Standard Ancillary Charge
"RTN","IBCRHBS8",7,0)
 N IBCHG,IBZIP,IBAA,IBCTI,IBCTIAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",8,0)
 I $P(ITLINE,U,2)'="DRG" G ISAQ
"RTN","IBCRHBS8",9,0)
 ;
"RTN","IBCRHBS8",10,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G ISAQ
"RTN","IBCRHBS8",11,0)
 S IBCTI=$P($G(ITLINE),U,4),IBCTIAAP=$S(IBCTI="S":3,IBCTI="N":5,1:0) I 'IBCTIAAP G ISAQ
"RTN","IBCRHBS8",12,0)
 ;
"RTN","IBCRHBS8",13,0)
 S IBCHG=$P(ITLINE,U,6)*$P(IBAA,U,IBCTIAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",14,0)
 ;
"RTN","IBCRHBS8",15,0)
ISAQ Q IBCHG
"RTN","IBCRHBS8",16,0)
 ;
"RTN","IBCRHBS8",17,0)
ISR(SITE,ITLINE) ; Return Inpatient DRG Standard Room & Board Charge
"RTN","IBCRHBS8",18,0)
 N IBCHG,IBZIP,IBAA,IBCTI,IBCTIAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",19,0)
 I $P(ITLINE,U,2)'="DRG" G ISRQ
"RTN","IBCRHBS8",20,0)
 ;
"RTN","IBCRHBS8",21,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G ISRQ
"RTN","IBCRHBS8",22,0)
 S IBCTI=$P($G(ITLINE),U,4),IBCTIAAP=$S(IBCTI="S":2,IBCTI="N":4,1:0) I 'IBCTIAAP G ISRQ
"RTN","IBCRHBS8",23,0)
 ;
"RTN","IBCRHBS8",24,0)
 S IBCHG=$P(ITLINE,U,5)*$P(IBAA,U,IBCTIAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",25,0)
 ;
"RTN","IBCRHBS8",26,0)
ISRQ Q IBCHG
"RTN","IBCRHBS8",27,0)
 ;
"RTN","IBCRHBS8",28,0)
IIA(SITE,ITLINE) ; Return Inpatient DRG ICU Ancillary Charge
"RTN","IBCRHBS8",29,0)
 N IBCHG,IBZIP,IBAA,IBCTI,IBCTIAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",30,0)
 I $P(ITLINE,U,2)'="DRG" G IIAQ
"RTN","IBCRHBS8",31,0)
 ;
"RTN","IBCRHBS8",32,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G IIAQ
"RTN","IBCRHBS8",33,0)
 S IBCTI=$P($G(ITLINE),U,4),IBCTIAAP=$S(IBCTI="S":3,IBCTI="N":5,1:0) I 'IBCTIAAP G IIAQ
"RTN","IBCRHBS8",34,0)
 ;
"RTN","IBCRHBS8",35,0)
 S IBCHG=$P(ITLINE,U,8)*$P(IBAA,U,IBCTIAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",36,0)
 ;
"RTN","IBCRHBS8",37,0)
IIAQ Q IBCHG
"RTN","IBCRHBS8",38,0)
 ;
"RTN","IBCRHBS8",39,0)
IIR(SITE,ITLINE) ; Return Inpatient DRG ICU Room & Board Charge
"RTN","IBCRHBS8",40,0)
 N IBCHG,IBZIP,IBAA,IBCTI,IBCTIAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",41,0)
 I $P(ITLINE,U,2)'="DRG" G IIRQ
"RTN","IBCRHBS8",42,0)
 ;
"RTN","IBCRHBS8",43,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G IIRQ
"RTN","IBCRHBS8",44,0)
 S IBCTI=$P($G(ITLINE),U,4),IBCTIAAP=$S(IBCTI="S":2,IBCTI="N":4,1:0) I 'IBCTIAAP G IIRQ
"RTN","IBCRHBS8",45,0)
 ;
"RTN","IBCRHBS8",46,0)
 S IBCHG=$P(ITLINE,U,7)*$P(IBAA,U,IBCTIAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",47,0)
 ;
"RTN","IBCRHBS8",48,0)
IIRQ Q IBCHG
"RTN","IBCRHBS8",49,0)
 ;
"RTN","IBCRHBS8",50,0)
ISNF(SITE,ITLINE) ; Return Inpatient Skilled Nursing Facility Per Diem
"RTN","IBCRHBS8",51,0)
 N IBCHG,IBZIP,IBAA S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",52,0)
 I $P(ITLINE,U,2)'="SNF" G ISNFQ
"RTN","IBCRHBS8",53,0)
 I $P(ITLINE,U,1)'="999",$P(ITLINE,U,1)'="000" G ISNFQ
"RTN","IBCRHBS8",54,0)
 ;
"RTN","IBCRHBS8",55,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G ISNFQ
"RTN","IBCRHBS8",56,0)
 ;
"RTN","IBCRHBS8",57,0)
 S IBCHG=$P(ITLINE,U,5)*$P(IBAA,U,6) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",58,0)
 ;
"RTN","IBCRHBS8",59,0)
ISNFQ Q IBCHG
"RTN","IBCRHBS8",60,0)
 ;
"RTN","IBCRHBS8",61,0)
 ;
"RTN","IBCRHBS8",62,0)
FAC(SITE,ITLINE) ; Return Facility Charge (Table B) for All Charge and Unit Types
"RTN","IBCRHBS8",63,0)
 ; each line record contains 1 charge that may be calculated in multiple ways
"RTN","IBCRHBS8",64,0)
 N IBCHG,IBUT S IBCHG=0,SITE=$G(SITE),ITLINE=$G(ITLINE)
"RTN","IBCRHBS8",65,0)
 ;
"RTN","IBCRHBS8",66,0)
 S IBUT=$P(ITLINE,U,10)
"RTN","IBCRHBS8",67,0)
 ;
"RTN","IBCRHBS8",68,0)
 I IBUT=1 S IBCHG=$$FSTD(SITE,ITLINE) G FACQ
"RTN","IBCRHBS8",69,0)
 I IBUT=4 S IBCHG=$$FSTD(SITE,ITLINE) G FACQ
"RTN","IBCRHBS8",70,0)
 I IBUT=2 S IBCHG=$$FHRS(SITE,ITLINE) G FACQ
"RTN","IBCRHBS8",71,0)
 ;
"RTN","IBCRHBS8",72,0)
FACQ Q IBCHG
"RTN","IBCRHBS8",73,0)
 ;
"RTN","IBCRHBS8",74,0)
FSTD(SITE,ITLINE) ; Return Facility Charge of Unit Type = 1 or 4 (Standard and Miles)
"RTN","IBCRHBS8",75,0)
 N IBCHG,IBZIP,IBUT,IBAA,IBSCC,IBSCCAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",76,0)
 S IBUT=$P(ITLINE,U,10) I IBUT'=1,IBUT'=4 G FSTDQ
"RTN","IBCRHBS8",77,0)
 ;
"RTN","IBCRHBS8",78,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G FSTDQ
"RTN","IBCRHBS8",79,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,5)),IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G FSTDQ
"RTN","IBCRHBS8",80,0)
 ;
"RTN","IBCRHBS8",81,0)
 S IBCHG=$P(ITLINE,U,8)*$P(IBAA,U,IBSCCAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",82,0)
 ;
"RTN","IBCRHBS8",83,0)
FSTDQ Q IBCHG
"RTN","IBCRHBS8",84,0)
 ;
"RTN","IBCRHBS8",85,0)
FHRS(SITE,ITLINE) ; Return Facility Charge of Unit Type = 2 (Hours)
"RTN","IBCRHBS8",86,0)
 N IBCHG,IBCHGB,IBZIP,IBUT,IBAA,IBSCC,IBSCCAAP S (IBCHG,IBCHGB)=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",87,0)
 S IBUT=$P(ITLINE,U,10) I IBUT'=2 G FHRSQ
"RTN","IBCRHBS8",88,0)
 ;
"RTN","IBCRHBS8",89,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G FHRSQ
"RTN","IBCRHBS8",90,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,5)),IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G FHRSQ
"RTN","IBCRHBS8",91,0)
 ;
"RTN","IBCRHBS8",92,0)
 S IBCHG=$P(ITLINE,U,8)*$P(IBAA,U,IBSCCAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",93,0)
 S IBCHGB=$P(ITLINE,U,9)*$P(IBAA,U,IBSCCAAP) S IBCHGB=$J(IBCHGB,0,2)
"RTN","IBCRHBS8",94,0)
 ;
"RTN","IBCRHBS8",95,0)
FHRSQ Q IBCHG_U_IBCHGB
"RTN","IBCRHBS8",96,0)
 ;
"RTN","IBCRHBS8",97,0)
 ;
"RTN","IBCRHBS8",98,0)
PROF(SITE,ITLINE) ; Return Professional Charge (Table C) for All Charge and Unit Types
"RTN","IBCRHBS8",99,0)
 ; each line record contains 1 charge that may be calculated in multiple ways
"RTN","IBCRHBS8",100,0)
 N IBCHG,IBCT,IBUT S IBCHG=0,SITE=$G(SITE),ITLINE=$G(ITLINE)
"RTN","IBCRHBS8",101,0)
 ;
"RTN","IBCRHBS8",102,0)
 S IBCT=$P(ITLINE,U,8)
"RTN","IBCRHBS8",103,0)
 S IBUT=$P(ITLINE,U,16)
"RTN","IBCRHBS8",104,0)
 ;
"RTN","IBCRHBS8",105,0)
 I IBUT=1,IBCT="RBRVS" S IBCHG=$$PRBRVS(SITE,ITLINE) G PROFQ
"RTN","IBCRHBS8",106,0)
 I IBUT=1,IBCT="TotalUnits" S IBCHG=$$PTRVU(SITE,ITLINE) G PROFQ
"RTN","IBCRHBS8",107,0)
 I IBUT=1,IBCT="NW" S IBCHG=$$PNW(SITE,ITLINE) G PROFQ
"RTN","IBCRHBS8",108,0)
 I IBUT=3,IBCT="Anesth" S IBCHG=$$PANES(SITE,ITLINE) G PROFQ
"RTN","IBCRHBS8",109,0)
 ;
"RTN","IBCRHBS8",110,0)
PROFQ Q IBCHG
"RTN","IBCRHBS8",111,0)
 ;
"RTN","IBCRHBS8",112,0)
PRBRVS(SITE,ITLINE) ; Return Professional RBRVS Based Charge
"RTN","IBCRHBS8",113,0)
 N IBCHG,IBZIP,IBCTI,IBUT,IBAA,IBSCC,IBSCCAAP,IBPEP,IBWE,IBPE,IBCF S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",114,0)
 S IBCTI=$P(ITLINE,U,8) I IBCTI'="RBRVS" G PRBRVSQ
"RTN","IBCRHBS8",115,0)
 S IBUT=$P(ITLINE,U,16) I IBUT'=1 G PRBRVSQ
"RTN","IBCRHBS8",116,0)
 ;
"RTN","IBCRHBS8",117,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G PRBRVSQ
"RTN","IBCRHBS8",118,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,6)) S IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G PRBRVSQ
"RTN","IBCRHBS8",119,0)
 ;
"RTN","IBCRHBS8",120,0)
 S IBPEP=$S($P(SITE,U,5)=3:11,1:10) ; provider/non-provider site
"RTN","IBCRHBS8",121,0)
 ;
"RTN","IBCRHBS8",122,0)
 S IBWE=$P(ITLINE,U,9)*$P(IBAA,U,7)
"RTN","IBCRHBS8",123,0)
 S IBPE=$P(ITLINE,U,IBPEP)*$P(IBAA,U,8)
"RTN","IBCRHBS8",124,0)
 S IBCF=$P(IBSCC,U,3)*$P(IBAA,U,IBSCCAAP)
"RTN","IBCRHBS8",125,0)
 ;
"RTN","IBCRHBS8",126,0)
 S IBCHG=(IBWE+IBPE)*IBCF S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",127,0)
 ;
"RTN","IBCRHBS8",128,0)
PRBRVSQ Q IBCHG
"RTN","IBCRHBS8",129,0)
 ;
"RTN","IBCRHBS8",130,0)
 ;
"RTN","IBCRHBS8",131,0)
PTRVU(SITE,ITLINE) ; Return Professional Total RVU Charge
"RTN","IBCRHBS8",132,0)
 N IBCHG,IBZIP,IBCTI,IBUT,IBAA,IBSCC,IBSCCAAP,IBUN,IBCF S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",133,0)
 S IBCTI=$P(ITLINE,U,8) I IBCTI'="TotalUnits" G PTRVUQ
"RTN","IBCRHBS8",134,0)
 S IBUT=$P(ITLINE,U,16) I IBUT'=1 G PTRVUQ
"RTN","IBCRHBS8",135,0)
 ;
"RTN","IBCRHBS8",136,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G PTRVUQ
"RTN","IBCRHBS8",137,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,6)) S IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G PTRVUQ
"RTN","IBCRHBS8",138,0)
 ;
"RTN","IBCRHBS8",139,0)
 S IBUN=$P(ITLINE,U,12)*$P(IBAA,U,9)
"RTN","IBCRHBS8",140,0)
 S IBCF=$P(IBSCC,U,3)*$P(IBAA,U,IBSCCAAP)
"RTN","IBCRHBS8",141,0)
 ;
"RTN","IBCRHBS8",142,0)
 S IBCHG=IBUN*IBCF S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",143,0)
 ;
"RTN","IBCRHBS8",144,0)
PTRVUQ Q IBCHG
"RTN","IBCRHBS8",145,0)
 ;
"RTN","IBCRHBS8",146,0)
PNW(SITE,ITLINE) ; Return Professional Nationwide Charge
"RTN","IBCRHBS8",147,0)
 N IBCHG,IBZIP,IBCTI,IBUT,IBAA,IBSCC,IBSCCAAP S IBCHG=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",148,0)
 S IBCTI=$P(ITLINE,U,8) I IBCTI'="NW" G PNWQ
"RTN","IBCRHBS8",149,0)
 S IBUT=$P(ITLINE,U,16) I IBUT'=1 G PNWQ
"RTN","IBCRHBS8",150,0)
 ;
"RTN","IBCRHBS8",151,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G PNWQ
"RTN","IBCRHBS8",152,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,6)) S IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G PNWQ
"RTN","IBCRHBS8",153,0)
 ;
"RTN","IBCRHBS8",154,0)
 S IBCHG=$P(ITLINE,U,14)*$P(IBAA,U,IBSCCAAP) S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",155,0)
 ;
"RTN","IBCRHBS8",156,0)
PNWQ Q IBCHG
"RTN","IBCRHBS8",157,0)
 ;
"RTN","IBCRHBS8",158,0)
PANES(SITE,ITLINE) ; Return Professional Anesthesia Charge
"RTN","IBCRHBS8",159,0)
 N IBCHG,IBCHGB,IBZIP,IBCTI,IBUT,IBAA,IBSCC,IBSCCAAP,IBCF S (IBCHG,IBCHGB)=0,ITLINE=$G(ITLINE),IBZIP=$P($G(SITE),U,4)
"RTN","IBCRHBS8",160,0)
 S IBCTI=$P(ITLINE,U,8) I IBCTI'="Anesth" G PANESQ
"RTN","IBCRHBS8",161,0)
 S IBUT=$P(ITLINE,U,16) I IBUT'=3 G PANESQ
"RTN","IBCRHBS8",162,0)
 ;
"RTN","IBCRHBS8",163,0)
 S IBAA=$$GETAA(IBZIP) I $P(IBAA,U,1)'=IBZIP G PANESQ
"RTN","IBCRHBS8",164,0)
 S IBSCC=$$GETSCC($P(ITLINE,U,6)) S IBSCCAAP=$P(IBSCC,U,4) I 'IBSCCAAP G PANESQ
"RTN","IBCRHBS8",165,0)
 ;
"RTN","IBCRHBS8",166,0)
 S IBCF=$P(IBSCC,U,3)*$P(IBAA,U,IBSCCAAP)
"RTN","IBCRHBS8",167,0)
 ;
"RTN","IBCRHBS8",168,0)
 S IBCHG=$P(ITLINE,U,14)*IBCF S IBCHG=$J(IBCHG,0,2)
"RTN","IBCRHBS8",169,0)
 S IBCHGB=$P(ITLINE,U,13)*IBCF S IBCHGB=$J(IBCHGB,0,2)
"RTN","IBCRHBS8",170,0)
 ;
"RTN","IBCRHBS8",171,0)
PANESQ Q IBCHG_U_IBCHGB
"RTN","IBCRHBS8",172,0)
 ;
"RTN","IBCRHBS8",173,0)
 ;
"RTN","IBCRHBS8",174,0)
 ;
"RTN","IBCRHBS8",175,0)
 ;
"RTN","IBCRHBS8",176,0)
GETAA(ZIP) ; return Area Factor entry for Zip from Table E
"RTN","IBCRHBS8",177,0)
 N IBTMPAA,IBAALN,IBDIV,IBDIVLN S IBAALN="",IBTMPAA="IBCR RC E",IBDIV=""
"RTN","IBCRHBS8",178,0)
 ;
"RTN","IBCRHBS8",179,0)
 I $G(ZIP)?3N S IBDIV=$O(^XTMP(IBTMPAA,"A",ZIP,0))
"RTN","IBCRHBS8",180,0)
 I +IBDIV S IBDIVLN=$G(^XTMP(IBTMPAA,IBDIV)) I $P(IBDIVLN,U,1)=ZIP S IBAALN=IBDIVLN
"RTN","IBCRHBS8",181,0)
 ;
"RTN","IBCRHBS8",182,0)
 Q IBAALN
"RTN","IBCRHBS8",183,0)
 ;
"RTN","IBCRHBS8",184,0)
GETSCC(SCC) ; return Service Category Code entry from Table D
"RTN","IBCRHBS8",185,0)
 N IBTMPSCC,IBSCC,IBSCCLN,IBLN S IBSCCLN="",IBTMPSCC="IBCR RC D",IBSCC=""
"RTN","IBCRHBS8",186,0)
 ;
"RTN","IBCRHBS8",187,0)
 I +$G(SCC) S IBSCC=$O(^XTMP(IBTMPSCC,"A",SCC,0))
"RTN","IBCRHBS8",188,0)
 I +IBSCC S IBLN=$G(^XTMP(IBTMPSCC,IBSCC)) I $P(IBLN,U,1)=SCC S IBSCCLN=IBLN
"RTN","IBCRHBS8",189,0)
 ;
"RTN","IBCRHBS8",190,0)
 Q IBSCCLN
"RTN","IBCRHBV1")
1^3^^B9246679
"RTN","IBYPSL")
0^4^B8389539^n/a
"RTN","IBYPSL",1,0)
IBYPSL ;ALB/ARH - IB*2.0*382 POST INIT: REASONABLE CHARGES V2.11 ; 21-OCT-2007
"RTN","IBYPSL",2,0)
 ;;2.0;INTEGRATED BILLING;**382**;21-MAR-94;Build 2
"RTN","IBYPSL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBYPSL",4,0)
 ;
"RTN","IBYPSL",5,0)
 ;
"RTN","IBYPSL",6,0)
 Q
"RTN","IBYPSL",7,0)
 ;
"RTN","IBYPSL",8,0)
POST ;
"RTN","IBYPSL",9,0)
 N IBA
"RTN","IBYPSL",10,0)
 S IBA(1)="",IBA(2)="    Reasonable Charges v2.11 Post-Install .....",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSL",11,0)
 ;
"RTN","IBYPSL",12,0)
 D CHGINA("") ; inactivate all RC charges in #363.2
"RTN","IBYPSL",13,0)
 ;
"RTN","IBYPSL",14,0)
 S IBA(1)="",IBA(2)="    Reasonable Charges v2.11 Post-Install Complete",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSL",15,0)
 ;
"RTN","IBYPSL",16,0)
 Q
"RTN","IBYPSL",17,0)
 ;
"RTN","IBYPSL",18,0)
 ;
"RTN","IBYPSL",19,0)
 ;
"RTN","IBYPSL",20,0)
CHGINA(VERS) ; inactive charges from previous versions of Reasonable Charges
"RTN","IBYPSL",21,0)
 ; VERS = version to begin inactivations with (1, 1.1, 1.2, ...)
"RTN","IBYPSL",22,0)
 ; - Inactive date added is the first RC Version Inactive date after the effective date of the charge
"RTN","IBYPSL",23,0)
 ; - if the charge already has an inactive date less than the Version Inactive Date then no change is made
"RTN","IBYPSL",24,0)
 ;
"RTN","IBYPSL",25,0)
 N IBA,IBI,IBX,IBSTART,IBENDATE,IBCS,IBCS0,IBBR0,IBXRF,IBITM,IBNEF,IBCI,IBCI0,IBCIEF,IBCIIA,IBNEWIA
"RTN","IBYPSL",26,0)
 N DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y,IBCNT S IBCNT=0
"RTN","IBYPSL",27,0)
 ;
"RTN","IBYPSL",28,0)
 S IBA(1)="      >> Inactivating Existing Reasonable Charges, Please Wait..." D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSL",29,0)
 ;
"RTN","IBYPSL",30,0)
 S IBSTART="" I $G(VERS)'="" S IBSTART=$$VERSDT^IBCRHBRV(VERS)
"RTN","IBYPSL",31,0)
 S IBENDATE=$$VERSEND^IBCRHBRV
"RTN","IBYPSL",32,0)
 ;
"RTN","IBYPSL",33,0)
 S IBCS=0 F  S IBCS=$O(^IBE(363.1,IBCS)) Q:'IBCS  D
"RTN","IBYPSL",34,0)
 . S IBCS0=$G(^IBE(363.1,IBCS,0)) Q:IBCS0=""
"RTN","IBYPSL",35,0)
 . S IBBR0=$G(^IBE(363.3,+$P(IBCS0,U,2),0)) I $E(IBBR0,1,3)'="RC " Q
"RTN","IBYPSL",36,0)
 . ;
"RTN","IBYPSL",37,0)
 . S IBXRF="AIVDTS"_IBCS
"RTN","IBYPSL",38,0)
 . S IBITM=0 F  S IBITM=$O(^IBA(363.2,IBXRF,IBITM)) Q:'IBITM  D
"RTN","IBYPSL",39,0)
 .. S IBNEF="" F  S IBNEF=$O(^IBA(363.2,IBXRF,IBITM,IBNEF)) Q:IBNEF=""  Q:-IBNEF<IBSTART  D
"RTN","IBYPSL",40,0)
 ... ;
"RTN","IBYPSL",41,0)
 ... S IBCI=0 F  S IBCI=$O(^IBA(363.2,IBXRF,IBITM,IBNEF,IBCI)) Q:'IBCI  D
"RTN","IBYPSL",42,0)
 .... S IBCI0=$G(^IBA(363.2,IBCI,0)) Q:IBCI0=""
"RTN","IBYPSL",43,0)
 .... S IBCIEF=$P(IBCI0,U,3),IBCIIA=$P(IBCI0,U,4),IBNEWIA=""
"RTN","IBYPSL",44,0)
 .... ;
"RTN","IBYPSL",45,0)
 .... F IBI=2:1 S IBX=+$P(IBENDATE,";",IBI) S IBNEWIA=IBX Q:'IBX  Q:IBCIEF'>IBX
"RTN","IBYPSL",46,0)
 .... ;
"RTN","IBYPSL",47,0)
 .... I 'IBNEWIA Q
"RTN","IBYPSL",48,0)
 .... I +IBCIIA,IBCIIA'>IBNEWIA Q
"RTN","IBYPSL",49,0)
 .... ;
"RTN","IBYPSL",50,0)
 .... S DR=".04////"_+IBNEWIA,DIE="^IBA(363.2,",DA=+IBCI D ^DIE K DIE,DIC,DA,DR,X,Y S IBCNT=IBCNT+1
"RTN","IBYPSL",51,0)
 ;
"RTN","IBYPSL",52,0)
 S IBA(1)="         Done.  "_IBCNT_" existing charges inactivated " D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPSL",53,0)
 Q
"RTN","IBYPSL",54,0)
 ;
"RTN","IBYPSL",55,0)
 ;
"RTN","IBYPSL",56,0)
 ;
"RTN","IBYPSL",57,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBYPSL",58,0)
 N IBX,IBY S IBY=""
"RTN","IBYPSL",59,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBYPSL",60,0)
 Q IBY
"RTN","IBYPSL",61,0)
 ;
"RTN","IBYPSL",62,0)
MSG(X) ;
"RTN","IBYPSL",63,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPSL",64,0)
 S IBA(IBX)=$G(X)
"RTN","IBYPSL",65,0)
 Q
"VER")
8.0^22.0
"BLD",6723,6)
^352
**END**
**END**
