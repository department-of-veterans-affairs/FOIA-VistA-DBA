Released PRCA*4.5*246 SEQ #217
Extracted from mail message
**KIDS**:PRCA*4.5*246^

**INSTALL NAME**
PRCA*4.5*246
"BLD",6725,0)
PRCA*4.5*246^ACCOUNTS RECEIVABLE^0^3060512^y
"BLD",6725,1,0)
^^4^4^3060512^
"BLD",6725,1,1,0)
Patch PRCA*4.5*246 re-enables two Katrina-related functions
"BLD",6725,1,2,0)
that became inactive on 4/30/06.  They are the option
"BLD",6725,1,3,0)
Emergency Response Report and the patch PRCA*4.5*241
"BLD",6725,1,4,0)
post-initialization process.
"BLD",6725,4,0)
^9.64PA^^
"BLD",6725,"ABPKG")
n
"BLD",6725,"KRN",0)
^9.67PA^8989.52^19
"BLD",6725,"KRN",.4,0)
.4
"BLD",6725,"KRN",.401,0)
.401
"BLD",6725,"KRN",.402,0)
.402
"BLD",6725,"KRN",.403,0)
.403
"BLD",6725,"KRN",.5,0)
.5
"BLD",6725,"KRN",.84,0)
.84
"BLD",6725,"KRN",3.6,0)
3.6
"BLD",6725,"KRN",3.8,0)
3.8
"BLD",6725,"KRN",9.2,0)
9.2
"BLD",6725,"KRN",9.8,0)
9.8
"BLD",6725,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6725,"KRN",9.8,"NM",1,0)
RCKATP^^0^B52728564
"BLD",6725,"KRN",9.8,"NM",2,0)
RCKATRPT^^0^B33045980
"BLD",6725,"KRN",9.8,"NM","B","RCKATP",1)

"BLD",6725,"KRN",9.8,"NM","B","RCKATRPT",2)

"BLD",6725,"KRN",19,0)
19
"BLD",6725,"KRN",19.1,0)
19.1
"BLD",6725,"KRN",101,0)
101
"BLD",6725,"KRN",409.61,0)
409.61
"BLD",6725,"KRN",771,0)
771
"BLD",6725,"KRN",870,0)
870
"BLD",6725,"KRN",8989.51,0)
8989.51
"BLD",6725,"KRN",8989.52,0)
8989.52
"BLD",6725,"KRN",8994,0)
8994
"BLD",6725,"KRN","B",.4,.4)

"BLD",6725,"KRN","B",.401,.401)

"BLD",6725,"KRN","B",.402,.402)

"BLD",6725,"KRN","B",.403,.403)

"BLD",6725,"KRN","B",.5,.5)

"BLD",6725,"KRN","B",.84,.84)

"BLD",6725,"KRN","B",3.6,3.6)

"BLD",6725,"KRN","B",3.8,3.8)

"BLD",6725,"KRN","B",9.2,9.2)

"BLD",6725,"KRN","B",9.8,9.8)

"BLD",6725,"KRN","B",19,19)

"BLD",6725,"KRN","B",19.1,19.1)

"BLD",6725,"KRN","B",101,101)

"BLD",6725,"KRN","B",409.61,409.61)

"BLD",6725,"KRN","B",771,771)

"BLD",6725,"KRN","B",870,870)

"BLD",6725,"KRN","B",8989.51,8989.51)

"BLD",6725,"KRN","B",8989.52,8989.52)

"BLD",6725,"KRN","B",8994,8994)

"BLD",6725,"QUES",0)
^9.62^^
"BLD",6725,"REQB",0)
^9.611^2^2
"BLD",6725,"REQB",1,0)
PRCA*4.5*242^2
"BLD",6725,"REQB",2,0)
PRCA*4.5*241^2
"BLD",6725,"REQB","B","PRCA*4.5*241",2)

"BLD",6725,"REQB","B","PRCA*4.5*242",1)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
246^3060512
"PKG",142,22,1,"PAH",1,1,0)
^^4^4^3060512
"PKG",142,22,1,"PAH",1,1,1,0)
Patch PRCA*4.5*246 re-enables two Katrina-related functions
"PKG",142,22,1,"PAH",1,1,2,0)
that became inactive on 4/30/06.  They are the option
"PKG",142,22,1,"PAH",1,1,3,0)
Emergency Response Report and the patch PRCA*4.5*241
"PKG",142,22,1,"PAH",1,1,4,0)
post-initialization process.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RCKATP")
0^1^B52728564^B52172732
"RTN","RCKATP",1,0)
RCKATP ;ALB/CPM - ADJUST ACCOUNTS FOR KATRINA VETS ; 28-FEB-06
"RTN","RCKATP",2,0)
 ;;4.5;Accounts Receivable;**241,246**;Mar 20, 1995
"RTN","RCKATP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCKATP",4,0)
 Q
"RTN","RCKATP",5,0)
 ;
"RTN","RCKATP",6,0)
 ;
"RTN","RCKATP",7,0)
POST ; Queue PRCA*4.5*241 post-init job.
"RTN","RCKATP",8,0)
 ;
"RTN","RCKATP",9,0)
 D BMES^XPDUTL(">>> Queuing the post-initialization to run now...")
"RTN","RCKATP",10,0)
 S ZTDTH=$H,ZTRTN="EN^RCKATP",ZTIO=""
"RTN","RCKATP",11,0)
 S ZTDESC="RC - PATCH PRCA*4.5*241 POST INITIALIZATION"
"RTN","RCKATP",12,0)
 D ^%ZTLOAD
"RTN","RCKATP",13,0)
 I $D(ZTSK) D MES^XPDUTL(" >> Queued as task #"_ZTSK_".")
"RTN","RCKATP",14,0)
 I '$D(ZTSK) D MES^XPDUTL(" >> Unable to queue task - contact EVS.")
"RTN","RCKATP",15,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO
"RTN","RCKATP",16,0)
 Q
"RTN","RCKATP",17,0)
 ;
"RTN","RCKATP",18,0)
 ;
"RTN","RCKATP",19,0)
EN ; Queued entry point to run the PRCA*4.5*241 post init.
"RTN","RCKATP",20,0)
 ;
"RTN","RCKATP",21,0)
 D EX ;                    exempt interest - return RCTOTAL
"RTN","RCKATP",22,0)
 ;
"RTN","RCKATP",23,0)
 S RCRES=$$CAN^IBAKAT() ;  cancel copay charges
"RTN","RCKATP",24,0)
 ;
"RTN","RCKATP",25,0)
 D BULL ;                  generate bulletin with results
"RTN","RCKATP",26,0)
 ;
"RTN","RCKATP",27,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","RCKATP",28,0)
 K RCTOTAL,RCRES
"RTN","RCKATP",29,0)
 Q
"RTN","RCKATP",30,0)
 ;
"RTN","RCKATP",31,0)
 ;
"RTN","RCKATP",32,0)
EX ; Entry point to exempt interest/admin charges
"RTN","RCKATP",33,0)
 ;
"RTN","RCKATP",34,0)
 ; - get all 'Katrina' vets based on interest/admin charges 
"RTN","RCKATP",35,0)
 K ^TMP("RCKATP",$J)
"RTN","RCKATP",36,0)
 S RCCOM(1)="INTEREST ADJUSTMENT FOR HURRICANE KATRINA VETERAN"
"RTN","RCKATP",37,0)
 S RCD=3050828.9
"RTN","RCKATP",38,0)
 F  S RCD=$O(^PRCA(433,"AT",13,RCD)) Q:'RCD!($P(RCD,".")>3060430)  D
"RTN","RCKATP",39,0)
 .S RCT=0 F  S RCT=$O(^PRCA(433,"AT",13,RCD,RCT)) Q:'RCT  D
"RTN","RCKATP",40,0)
 ..S RCB=+$P($G(^PRCA(433,RCT,0)),"^",2) Q:'RCB
"RTN","RCKATP",41,0)
 ..I '$P($G(^PRCA(430,RCB,0)),"^",12) Q
"RTN","RCKATP",42,0)
 ..S RCDPT=+$P($G(^PRCA(430,RCB,0)),"^",9)
"RTN","RCKATP",43,0)
 ..S RCDEB=$G(^RCD(340,RCDPT,0))
"RTN","RCKATP",44,0)
 ..Q:$P(RCDEB,"^")'["DPT"  Q:'RCDEB
"RTN","RCKATP",45,0)
 ..;Q:$$EMERES^PRCAUTL(+RCDEB)=""
"RTN","RCKATP",46,0)
 ..Q:$$EMGRES^DGUTL(+RCDEB)=""
"RTN","RCKATP",47,0)
 ..Q:$P(RCDEB,"^",8)  ;    vet has been already been processed
"RTN","RCKATP",48,0)
 ..;
"RTN","RCKATP",49,0)
 ..; - store the vet and bill
"RTN","RCKATP",50,0)
 ..S ^TMP("RCKATP",$J,RCDPT,RCB)=""
"RTN","RCKATP",51,0)
 ;
"RTN","RCKATP",52,0)
 ; - look for extra interest exemptions to create
"RTN","RCKATP",53,0)
 S RCTOTAL="0^0"
"RTN","RCKATP",54,0)
 S RCDEB=0 F  S RCDEB=$O(^TMP("RCKATP",$J,RCDEB)) Q:'RCDEB  D
"RTN","RCKATP",55,0)
 .;
"RTN","RCKATP",56,0)
 .; - initialize bucket and new patient flag
"RTN","RCKATP",57,0)
 .S (RCBUCK,RCNEWP)=0
"RTN","RCKATP",58,0)
 .S RCB=0 F  S RCB=$O(^TMP("RCKATP",$J,RCDEB,RCB)) Q:'RCB  D
"RTN","RCKATP",59,0)
 ..;
"RTN","RCKATP",60,0)
 ..; - review transactions to find interest added/exempted
"RTN","RCKATP",61,0)
 ..S RCCB=$$GETTRANS^RCDPBTLM(RCB),RCH=0,RCHOLD=""
"RTN","RCKATP",62,0)
 ..S RCDT=3050828.9 F  S RCDT=$O(RCLIST(RCDT)) Q:'RCDT  D
"RTN","RCKATP",63,0)
 ...S RCT=0 F  S RCT=$O(RCLIST(RCDT,RCT)) Q:'RCT  D
"RTN","RCKATP",64,0)
 ....S RCV=RCLIST(RCDT,RCT)
"RTN","RCKATP",65,0)
 ....;
"RTN","RCKATP",66,0)
 ....; - if transaction is an interest charge, save off amount
"RTN","RCKATP",67,0)
 ....I RCV["INTEREST/ADM. CHARGE",RCDT<3060501 S RCH=1 D  Q
"RTN","RCKATP",68,0)
 .....S $P(RCHOLD,"^")=$P(RCHOLD,"^")+$P(RCV,"^",3)
"RTN","RCKATP",69,0)
 .....S $P(RCHOLD,"^",2)=$P(RCHOLD,"^",2)+$P(RCV,"^",4)
"RTN","RCKATP",70,0)
 ....;
"RTN","RCKATP",71,0)
 ....; - if transaction is an interest exemption, save off (+) amount
"RTN","RCKATP",72,0)
 ....I RCV["EXEMPT INT/ADM. COST",RCH D  Q
"RTN","RCKATP",73,0)
 .....S $P(RCHOLD,"^",3)=$P(RCHOLD,"^",3)-$P(RCV,"^",3)
"RTN","RCKATP",74,0)
 .....S $P(RCHOLD,"^",4)=$P(RCHOLD,"^",4)-$P(RCV,"^",4)
"RTN","RCKATP",75,0)
 ..;
"RTN","RCKATP",76,0)
 ..; - get total amounts of interest added and exempted
"RTN","RCKATP",77,0)
 ..S RCINT=$P(RCHOLD,"^")+$P(RCHOLD,"^",2)
"RTN","RCKATP",78,0)
 ..S RCEXEM=$P(RCHOLD,"^",3)+$P(RCHOLD,"^",4)
"RTN","RCKATP",79,0)
 ..;
"RTN","RCKATP",80,0)
 ..; - quit if interest added less than or equal to exemptions
"RTN","RCKATP",81,0)
 ..S RCAPPLY=RCINT-RCEXEM
"RTN","RCKATP",82,0)
 ..Q:RCAPPLY'>0
"RTN","RCKATP",83,0)
 ..;
"RTN","RCKATP",84,0)
 ..; - get bill's interest balance
"RTN","RCKATP",85,0)
 ..S RCNEWP=1
"RTN","RCKATP",86,0)
 ..S X=$G(^PRCA(430,RCB,7)),RCINTB=$P(X,"^",2)+$P(X,"^",3)
"RTN","RCKATP",87,0)
 ..;
"RTN","RCKATP",88,0)
 ..; - if no balance, put in bucket and quit
"RTN","RCKATP",89,0)
 ..I 'RCINTB S RCBUCK=RCBUCK+RCAPPLY Q
"RTN","RCKATP",90,0)
 ..;
"RTN","RCKATP",91,0)
 ..; - adjust bucket and amount to apply
"RTN","RCKATP",92,0)
 ..S RCAMT=$S(RCAPPLY'<RCINTB:RCINTB,1:RCAPPLY)
"RTN","RCKATP",93,0)
 ..S RCBUCK=$S(RCAPPLY>RCINTB:RCBUCK+(RCAPPLY-RCINTB),1:RCBUCK)
"RTN","RCKATP",94,0)
 ..;
"RTN","RCKATP",95,0)
 ..; - will apply RCAMT - spread over admin then interest.
"RTN","RCKATP",96,0)
 ..S RCAPA=$S(RCAMT'<$P(X,"^",3):$P(X,"^",3),1:RCAMT)
"RTN","RCKATP",97,0)
 ..S RCAPI=RCAMT-RCAPA
"RTN","RCKATP",98,0)
 ..S RC=$$EXEMPT^RCBEUTR2(RCB,RCAPI_"^"_RCAPA,.RCCOM,0)
"RTN","RCKATP",99,0)
 ..;
"RTN","RCKATP",100,0)
 ..; - update total amount exempted
"RTN","RCKATP",101,0)
 ..S $P(RCTOTAL,"^",2)=$P(RCTOTAL,"^",2)+RCAMT
"RTN","RCKATP",102,0)
 .;
"RTN","RCKATP",103,0)
 .;
"RTN","RCKATP",104,0)
 .; - set debtor as having been processed
"RTN","RCKATP",105,0)
 .S $P(^RCD(340,RCDEB,0),"^",8)=1
"RTN","RCKATP",106,0)
 .;
"RTN","RCKATP",107,0)
 .; - if an amount is left in the bucket, process it,
"RTN","RCKATP",108,0)
 .;   update total exempted, and the number of vets exempted
"RTN","RCKATP",109,0)
 .I RCBUCK D
"RTN","RCKATP",110,0)
 ..D EN^RCKATPD($P($G(^RCD(340,RCDEB,0)),"^"),RCBUCK,RCCOM(1))
"RTN","RCKATP",111,0)
 ..S $P(RCTOTAL,"^",2)=$P(RCTOTAL,"^",2)+RCBUCK
"RTN","RCKATP",112,0)
 .I RCNEWP S $P(RCTOTAL,"^")=$P(RCTOTAL,"^")+1
"RTN","RCKATP",113,0)
 ;
"RTN","RCKATP",114,0)
 ;
"RTN","RCKATP",115,0)
 K ^TMP("RCKATP",$J)
"RTN","RCKATP",116,0)
 K RCD,RCT,RCB,RCDPT,RCDEB,RCBUCK,RCNEWP,RC,RCCB,RCH,RCHOLD,RCDT
"RTN","RCKATP",117,0)
 K RCLIST,RCV,RCINT,RCINTB,RCEXEM,RCAPPLY,RCAMT,RCAPA,RCAPI,RCCOM,X
"RTN","RCKATP",118,0)
 Q
"RTN","RCKATP",119,0)
 ;
"RTN","RCKATP",120,0)
 ;
"RTN","RCKATP",121,0)
CHK(DFN) ; Check to see if vet should have charges cancelled
"RTN","RCKATP",122,0)
 ;  Input:  DFN  --  Pointer to patient in file 2
"RTN","RCKATP",123,0)
 ; Output:    0  --  No, don't cancel charges
"RTN","RCKATP",124,0)
 ;            1  --  Yes, cancel charges
"RTN","RCKATP",125,0)
 N RCDEB,RCH
"RTN","RCKATP",126,0)
 S RCH=0
"RTN","RCKATP",127,0)
 ;I $$EMERES^PRCAUTL(DFN)="" G CHKQ
"RTN","RCKATP",128,0)
 I $$EMGRES^DGUTL(DFN)="" G CHKQ
"RTN","RCKATP",129,0)
 S RCDEB=$O(^RCD(340,"B",DFN_";DPT(",0))
"RTN","RCKATP",130,0)
 ;
"RTN","RCKATP",131,0)
 ; - if a Katrina vet is not in file #340, must look for held charges
"RTN","RCKATP",132,0)
 I 'RCDEB S RCH=1 G CHKQ
"RTN","RCKATP",133,0)
 ;
"RTN","RCKATP",134,0)
 ; - make sure charges have not yet been canceled
"RTN","RCKATP",135,0)
 I '$P($G(^RCD(340,RCDEB,0)),"^",9) S RCH=1
"RTN","RCKATP",136,0)
CHKQ Q RCH
"RTN","RCKATP",137,0)
 ;
"RTN","RCKATP",138,0)
 ;
"RTN","RCKATP",139,0)
TPP(RCTI,RCH) ; Identify decreases that are credits for third party payments
"RTN","RCKATP",140,0)
 ;  Input:  RCTI  --  Pointer to AR Transaction in file 433
"RTN","RCKATP",141,0)
 ;           RCH  --  Array of 'counted' transactions passed by reference
"RTN","RCKATP",142,0)
 ; Output:  RCRES --  1^2, where
"RTN","RCKATP",143,0)
 ;                      1 = total amount of credit adjustments
"RTN","RCKATP",144,0)
 ;                      2 = pointer to the affected bill in file #430
"RTN","RCKATP",145,0)
 ;
"RTN","RCKATP",146,0)
 N RCRES,RCB,RCAMT,RCT,RCTD,RCQ,RCI,RCS
"RTN","RCKATP",147,0)
 S RCRES="",RCAMT=0
"RTN","RCKATP",148,0)
 I '$G(RCTI) G TPPQ
"RTN","RCKATP",149,0)
 S RCB=+$P($G(^PRCA(433,RCTI,0)),"^",2) I 'RCB G TPPQ
"RTN","RCKATP",150,0)
 S RCAMT=0
"RTN","RCKATP",151,0)
 S RCT=RCTI F  S RCT=$O(^PRCA(433,"C",RCB,RCT)) Q:'RCT  D
"RTN","RCKATP",152,0)
 .Q:$D(RCH(RCB,RCT))  ;    transaction has been counted
"RTN","RCKATP",153,0)
 .S RCTD=$G(^PRCA(433,RCT,1))
"RTN","RCKATP",154,0)
 .Q:$P(RCTD,"^",2)'=35  ;  not a decrease
"RTN","RCKATP",155,0)
 .;
"RTN","RCKATP",156,0)
 .; - check for a potential 'Katrina decrease'
"RTN","RCKATP",157,0)
 .S RCQ=0,RCS="HURRICANE KATRINA VETERAN" D  Q:RCQ
"RTN","RCKATP",158,0)
 ..S RCI=0 F  S RCI=$O(^PRCA(433,RCT,7,RCI)) Q:'RCI  D  Q:RCQ
"RTN","RCKATP",159,0)
 ...I $G(^PRCA(433,RCT,7,RCI,0))[RCS S RCQ=1
"RTN","RCKATP",160,0)
 .;
"RTN","RCKATP",161,0)
 .; - increment the credit amount
"RTN","RCKATP",162,0)
 .S RCAMT=RCAMT+$P(RCTD,"^",5),RCH(RCB,RCT)=""
"RTN","RCKATP",163,0)
 ;
"RTN","RCKATP",164,0)
 S RCRES=RCAMT_"^"_RCB
"RTN","RCKATP",165,0)
TPPQ Q RCRES
"RTN","RCKATP",166,0)
 ;
"RTN","RCKATP",167,0)
 ;
"RTN","RCKATP",168,0)
DEC(RCBILL,RCAMT) ; Decrease a bill
"RTN","RCKATP",169,0)
 ;  Input:  RCBILL  --  Bill Number of a bill in file 430
"RTN","RCKATP",170,0)
 ;           RCAMT  --  Amount to decrease bill
"RTN","RCKATP",171,0)
 ; Output:  RCBUCK  --  Amount not decreased, to go to bucket
"RTN","RCKATP",172,0)
 ;
"RTN","RCKATP",173,0)
 N RCBUCK,RCMSG,RCT
"RTN","RCKATP",174,0)
 S RCBUCK=RCAMT
"RTN","RCKATP",175,0)
 S RCB=$O(^PRCA(430,"B",RCBILL,0))
"RTN","RCKATP",176,0)
 I RCB D
"RTN","RCKATP",177,0)
 .S RCMSG="CANCEL COPAYMENTS FOR HURRICANE KATRINA VETERAN"
"RTN","RCKATP",178,0)
 .D DEC^PRCASER1(RCB,.RCBUCK,DUZ,RCMSG,"",.RCT)
"RTN","RCKATP",179,0)
DECQ Q RCBUCK
"RTN","RCKATP",180,0)
 ;
"RTN","RCKATP",181,0)
 ;
"RTN","RCKATP",182,0)
FLAG(DFN) ; Flag veteran as having had copay charges cancelled
"RTN","RCKATP",183,0)
 ;  Input:  DFN  --  Pointer to patient in file 2
"RTN","RCKATP",184,0)
 ;
"RTN","RCKATP",185,0)
 N RCDEB
"RTN","RCKATP",186,0)
 S RCDEB=$O(^RCD(340,"B",DFN_";DPT(",0))
"RTN","RCKATP",187,0)
 I 'RCDEB D
"RTN","RCKATP",188,0)
 .S DIC="^RCD(340,",DIC(0)="QL",X=DFN_";DPT(",DLAYGO=340
"RTN","RCKATP",189,0)
 .K DD,DO D FILE^DICN K DIC,DLAYGO,DO,DD S RCDEB=+Y
"RTN","RCKATP",190,0)
 I RCDEB>0 S $P(^RCD(340,RCDEB,0),"^",9)=1
"RTN","RCKATP",191,0)
 Q
"RTN","RCKATP",192,0)
 ;
"RTN","RCKATP",193,0)
 ;
"RTN","RCKATP",194,0)
ADJ(DFN,RCAMT) ; Make final credit adjustments to the vet's account
"RTN","RCKATP",195,0)
 ;  Input:  DFN  --  Pointer to patient in file 2
"RTN","RCKATP",196,0)
 ;        RCAMT  --  Amount to decrease from account
"RTN","RCKATP",197,0)
 ;
"RTN","RCKATP",198,0)
 N RCDEBN,RCMSG
"RTN","RCKATP",199,0)
 S RCDEBN=DFN_";DPT("
"RTN","RCKATP",200,0)
 S RCMSG="CANCEL COPAYMENTS FOR HURRICANE KATRINA VETERAN"
"RTN","RCKATP",201,0)
 D EN^RCKATPD(RCDEBN,RCAMT,RCMSG)
"RTN","RCKATP",202,0)
 Q
"RTN","RCKATP",203,0)
 ;
"RTN","RCKATP",204,0)
 ;
"RTN","RCKATP",205,0)
BULL ; Send job completion bulletin
"RTN","RCKATP",206,0)
 N XMSUB,XMTEXT,XMY,XMDUZ,RCT,RCN
"RTN","RCKATP",207,0)
 S RCT(1)="The patch PRCA*4.5*241 post initialization has completed."
"RTN","RCKATP",208,0)
 S RCT(2)=" "
"RTN","RCKATP",209,0)
 S RCT(3)="Number of Veterans with Interest Exempted:  "_+RCTOTAL
"RTN","RCKATP",210,0)
 S RCT(4)="        Total Amount of Interest Exempted: $"_$J($P(RCTOTAL,"^",2),0,2)
"RTN","RCKATP",211,0)
 S RCT(5)=" "
"RTN","RCKATP",212,0)
 I RCRES="" S RCT(6)="*** Note: Copay Charges were not cancelled - contact EVS ***"
"RTN","RCKATP",213,0)
 I RCRES'="" D
"RTN","RCKATP",214,0)
 .S RCT(6)="Number of Veterans with Charges Cancelled:  "_+RCRES
"RTN","RCKATP",215,0)
 .S RCT(7)="        Total Amount of Charges Cancelled: $"_$J($P(RCRES,"^",2),0,2)
"RTN","RCKATP",216,0)
 .S RCT(8)="   Total Amount of Held Charges Cancelled: $"_$J($P(RCRES,"^",3),0,2)
"RTN","RCKATP",217,0)
 ;
"RTN","RCKATP",218,0)
 S XMSUB="Job Completion - PRCA*4.5*241 Post Initialization"
"RTN","RCKATP",219,0)
 S XMTEXT="RCT("
"RTN","RCKATP",220,0)
 S XMY("G.PRCA ADJUSTMENT TRANS")="",XMY(DUZ)=""
"RTN","RCKATP",221,0)
 S XMDUZ="ACCOUNTS RECEIVABLE"
"RTN","RCKATP",222,0)
 D ^XMD
"RTN","RCKATP",223,0)
 Q
"RTN","RCKATRPT")
0^2^B33045980^B32447812
"RTN","RCKATRPT",1,0)
RCKATRPT ;ALB/MAF-KATRINA FINANCIAL STATEMENT REPORT ;12/1/05  4:14 PM
"RTN","RCKATRPT",2,0)
V ;;4.5;Accounts Receivable;**242,246**;Mar 20, 1995
"RTN","RCKATRPT",3,0)
 ;
"RTN","RCKATRPT",4,0)
EN1 ;
"RTN","RCKATRPT",5,0)
 N RCTYPE,X,%,DUOUT,DTOUT,DIR,RCDATE,Y
"RTN","RCKATRPT",6,0)
 S DIR("A")="(S)UMMARY OR (D)ETAIL?: ",DIR(0)="SBA^S:SUMMARY TOTALS ONLY;D:DETAILS AND SUMMARY"
"RTN","RCKATRPT",7,0)
 S DIR("B")="S" D ^DIR K DIR
"RTN","RCKATRPT",8,0)
 I $D(DTOUT)!$D(DUOUT)!(Y="") G RPTQ
"RTN","RCKATRPT",9,0)
 S RCTYPE=Y
"RTN","RCKATRPT",10,0)
 D NOW^%DTC
"RTN","RCKATRPT",11,0)
 S RCDATE=DT
"RTN","RCKATRPT",12,0)
 ; Ask device
"RTN","RCKATRPT",13,0)
 N ZTRTN,ZTSK,ZTSAVE,ZTDESC,%ZIS,POP
"RTN","RCKATRPT",14,0)
 S %ZIS="QM" D ^%ZIS G:POP RPTQ
"RTN","RCKATRPT",15,0)
 I $D(IO("Q")) D  G RPTQ
"RTN","RCKATRPT",16,0)
 . S ZTRTN="EN^RCKATRPT",ZTSAVE("RCTYPE")="",ZTSAVE("RCDATE")="",ZTDESC="KATRINA REPORT"
"RTN","RCKATRPT",17,0)
 . D ^%ZTLOAD
"RTN","RCKATRPT",18,0)
 . W !!,$S($D(ZTSK):"Your task number "_ZTSK_" has been queued.",1:"Unavailable")
"RTN","RCKATRPT",19,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCKATRPT",20,0)
 U IO
"RTN","RCKATRPT",21,0)
 D EN^RCKATRPT
"RTN","RCKATRPT",22,0)
RPTQ Q
"RTN","RCKATRPT",23,0)
EN ;
"RTN","RCKATRPT",24,0)
 N BBAL,DEB,RCDFN,X,SITE,Y,%,%H,%I,RCSITE,DFN,BN,RCDCL,RCDL,RCPAG,STAT,TOTAMT,TOTVET,BAL,DATA,INT,RCTOT,AC,OP,PRE,ADM,PB,RCFLAG,X1,X2
"RTN","RCKATRPT",25,0)
 K ^XTMP("RCKATRPT")
"RTN","RCKATRPT",26,0)
 D NOW^%DTC S X1=DT,X2=30 D C^%DTC
"RTN","RCKATRPT",27,0)
 S ^XTMP("RCKATRPT",0)=DT_"^"_X_"^Katrina Detailed Report"
"RTN","RCKATRPT",28,0)
 S (DEB,TOTAMT,TOTVET)=0
"RTN","RCKATRPT",29,0)
 K ^TMP("RCDEBTOR",$J),^TMP("RCTOT",$J),^TMP("DEBTOR",$J),^TMP("RCSITE",$J),^TMP("RCDFN",$J),^TMP("RCBBL",$J)
"RTN","RCKATRPT",30,0)
 F  S DEB=$O(^RCD(340,"AB","DPT(",DEB)) Q:DEB=""  D
"RTN","RCKATRPT",31,0)
 .   I $L(+$$SSN^RCFN01(DEB))<5 Q
"RTN","RCKATRPT",32,0)
 .   ;Check for Emergency Response Indicator (ERI) Flag.
"RTN","RCKATRPT",33,0)
 .   ;N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMERES^PRCAUTL(+RCDFN)']"" Q
"RTN","RCKATRPT",34,0)
 .   N RCDFN S RCDFN=$P($G(^RCD(340,DEB,0)),"^",1) I $$EMGRES^DGUTL(+RCDFN)']"" Q
"RTN","RCKATRPT",35,0)
 .   S BBAL=0 D BBAL ;get bill bal
"RTN","RCKATRPT",36,0)
 D PRINT
"RTN","RCKATRPT",37,0)
 K ^TMP("RCDEBTOR",$J),^TMP("RCTOT",$J),^TMP("DEBTOR",$J),^TMP("RCSITE",$J),^TMP("RCDFN",$J),^TMP("RCBBL",$J)
"RTN","RCKATRPT",38,0)
 Q
"RTN","RCKATRPT",39,0)
BBAL ;get bills balances return array
"RTN","RCKATRPT",40,0)
 G:'DEB BBALQ
"RTN","RCKATRPT",41,0)
 S AC=+$O(^PRCA(430.3,"AC",102,0)),OP=+$O(^PRCA(430.3,"AC",112,0))
"RTN","RCKATRPT",42,0)
 F STAT=AC,OP F BN=0:0 S BN=$O(^PRCA(430,"AS",DEB,STAT,BN)) Q:'BN  D
"RTN","RCKATRPT",43,0)
 .I '$D(^TMP("RCBBL",$J,DEB)) S (BBAL,PB,INT,ADM)=0 S ^TMP("RCBBL",$J,DEB)=""
"RTN","RCKATRPT",44,0)
 .S BAL=$G(^PRCA(430,BN,7))
"RTN","RCKATRPT",45,0)
 .S SITE=$S($P($G(^PRCA(430,BN,0)),"^",12):$P($G(^PRCA(430,BN,0)),"^",12),1:"SITE UNKNOWN")
"RTN","RCKATRPT",46,0)
 .I '$D(^TMP("DEBTOR",$J,SITE,DEB)) S TOTVET=TOTVET+1
"RTN","RCKATRPT",47,0)
 .S PB=PB+$P(BAL,"^",1),INT=INT+$P(BAL,"^",2),ADM=ADM+$P(BAL,"^",3)
"RTN","RCKATRPT",48,0)
 .S BBAL=$P(BAL,"^",1)+$P(BAL,"^",2)+$P(BAL,"^",3)
"RTN","RCKATRPT",49,0)
 .S ^TMP("DEBTOR",$J,SITE,DEB,+RCDFN,BN)=$P(BAL,"^",1)_"^"_$P(BAL,"^",2)_"^"_$P(BAL,"^",3)_"^"_BBAL
"RTN","RCKATRPT",50,0)
 .S ^TMP("RCDEBTOR",$J,SITE,DEB,+RCDFN)=PB_"^"_INT_"^"_ADM_"^"_(PB+INT+ADM)
"RTN","RCKATRPT",51,0)
 .S RCTOT=$G(^TMP("RCTOT",$J,SITE)),$P(^TMP("RCTOT",$J,SITE),"^",1)=$P(RCTOT,"^",1)+$P(BAL,"^",1),$P(^TMP("RCTOT",$J,SITE),"^",2)=$P(RCTOT,"^",2)+$P(BAL,"^",2)
"RTN","RCKATRPT",52,0)
 .S $P(^TMP("RCTOT",$J,SITE),"^",3)=$P(RCTOT,"^",3)+$P(BAL,"^",3),$P(^TMP("RCTOT",$J,SITE),"^",4)=$P(RCTOT,"^",4)+BBAL
"RTN","RCKATRPT",53,0)
 .Q
"RTN","RCKATRPT",54,0)
BBALQ Q
"RTN","RCKATRPT",55,0)
PRINT ;PRINT THE REPORT
"RTN","RCKATRPT",56,0)
 S $P(RCDCL,"=",81)="",(SITE,RCPAG)=0
"RTN","RCKATRPT",57,0)
 D HEAD
"RTN","RCKATRPT",58,0)
 I '$D(^TMP("RCDEBTOR",$J)) W !!,"No data meets this criteria" Q
"RTN","RCKATRPT",59,0)
 I RCTYPE="D" D
"RTN","RCKATRPT",60,0)
 .S RCFLAG=0 F  S SITE=$O(^TMP("DEBTOR",$J,SITE)) Q:SITE=""!(RCFLAG)  S DEB=0 F  S DEB=$O(^TMP("DEBTOR",$J,SITE,DEB)) Q:DEB=""!(RCFLAG)  D
"RTN","RCKATRPT",61,0)
 ..S DFN=0 F  S DFN=$O(^TMP("DEBTOR",$J,SITE,DEB,DFN)) Q:DFN=""!(RCFLAG)  S BN=0 F  S BN=$O(^TMP("DEBTOR",$J,SITE,DEB,DFN,BN)) Q:BN=""!(RCFLAG)  D:$Y+5>IOSL RET Q:RCFLAG  D PRDATA
"RTN","RCKATRPT",62,0)
 ..Q
"RTN","RCKATRPT",63,0)
 .Q
"RTN","RCKATRPT",64,0)
 I RCTYPE="D" Q:RCFLAG  S RCTYPE="S" S RCPAG=0 D RET Q:RCFLAG
"RTN","RCKATRPT",65,0)
 I RCTYPE="S" D
"RTN","RCKATRPT",66,0)
 .F  S SITE=$O(^TMP("RCTOT",$J,SITE)) Q:SITE=""  D PRDATA
"RTN","RCKATRPT",67,0)
 .Q
"RTN","RCKATRPT",68,0)
 Q
"RTN","RCKATRPT",69,0)
RET ;
"RTN","RCKATRPT",70,0)
 F X=$Y:1:(IOSL-3) W !
"RTN","RCKATRPT",71,0)
 I IOST'?1"C-".E D  Q
"RTN","RCKATRPT",72,0)
 .I RCTYPE="D" K ^TMP("RCSITE",$J,SITE),^TMP("RCDFN",$J,DFN)
"RTN","RCKATRPT",73,0)
 .D HEAD
"RTN","RCKATRPT",74,0)
 N DIR,DUOUT,DTOUT
"RTN","RCKATRPT",75,0)
 S DIR(0)="EA",DIR("A")="Enter <RET> to continue or ^ to quit " D ^DIR
"RTN","RCKATRPT",76,0)
 I $D(DTOUT)!$D(DUOUT) S RCFLAG=1 Q:RCFLAG
"RTN","RCKATRPT",77,0)
 I RCTYPE="D" K ^TMP("RCSITE",$J,SITE),^TMP("RCDFN",$J,DFN)
"RTN","RCKATRPT",78,0)
HEAD ;HEADING DETAILED
"RTN","RCKATRPT",79,0)
 N Y S RCPAG=RCPAG+1
"RTN","RCKATRPT",80,0)
 W @IOF,"Financial"_$S(RCTYPE="S":" Summary ",1:" Detailed ")_"Statement for Hurricane Katrina ",?53 S Y=RCDATE D DD^%DT W Y,"   ",$J("PAGE: "_RCPAG,12),!
"RTN","RCKATRPT",81,0)
 I RCTYPE="S" D
"RTN","RCKATRPT",82,0)
 .W !,"SITE",?25,"#AFFECTED VETS",?48,"TOTAL AMT.",?65,"AVG. AMOUNT/VET"
"RTN","RCKATRPT",83,0)
 I RCTYPE="D" D
"RTN","RCKATRPT",84,0)
 .W !,"BILL #",?17,"PRINC. BAL",?41,"INT.",?56,"ADM.",?75,"TOTAL"
"RTN","RCKATRPT",85,0)
 W !,RCDCL
"RTN","RCKATRPT",86,0)
 Q
"RTN","RCKATRPT",87,0)
PRDATA ;WRITE THE DATA
"RTN","RCKATRPT",88,0)
 ;W !
"RTN","RCKATRPT",89,0)
 I RCTYPE="S" D
"RTN","RCKATRPT",90,0)
 .S TOTAMT=$P($G(^TMP("RCTOT",$J,SITE)),"^",4)
"RTN","RCKATRPT",91,0)
 .W !,$P($$SITE^VASITE(),"^",2),?20,$J(TOTVET,18),?40,$J("$"_TOTAMT,18),?60,$J("$"_$P(TOTAMT/TOTVET,".",1)_"."_$E($P(TOTAMT/TOTVET,".",2),1,2),18)
"RTN","RCKATRPT",92,0)
 .S ^XTMP("RCKATRPT",SITE,"TOTGRAND")=TOTVET_"^"_TOTAMT_"^"_$P(TOTAMT/TOTVET,".",1)_"."_$E($P(TOTAMT/TOTVET,".",2),1,2)
"RTN","RCKATRPT",93,0)
 I RCTYPE="D" D
"RTN","RCKATRPT",94,0)
 .N DATA
"RTN","RCKATRPT",95,0)
 .S DATA=$G(^TMP("DEBTOR",$J,SITE,DEB,DFN,BN))
"RTN","RCKATRPT",96,0)
 . I '$D(^TMP("RCSITE",$J,SITE)) W !,?35,$P($$SITE^VASITE(),"^",2),! S ^TMP("RCSITE",$J,SITE)=""
"RTN","RCKATRPT",97,0)
 . I '$D(^TMP("RCDFN",$J,DFN)) W !,DEB_":"_$P($G(^DPT(DFN,0)),"^",1) S ^TMP("RCDFN",$J,DFN)=""
"RTN","RCKATRPT",98,0)
 . W !,$P($G(^PRCA(430,BN,0)),"^",1),?12,$S($P($G(DATA),"^",1):$J("$"_$P(DATA,"^",1),15),1:$J("$0",15)),?30,$S($P($G(DATA),"^",2):$J("$"_$P(DATA,"^",2),15),1:$J("$0",15))
"RTN","RCKATRPT",99,0)
 .W ?45,$S($P($G(DATA),"^",3):$J("$"_$P(DATA,"^",3),15),1:$J("$0",15)),?65,$S($P($G(DATA),"^",4):$J("$"_$P(DATA,"^",4),15),1:$J("$0",15))
"RTN","RCKATRPT",100,0)
 .S ^TMP("RCSITE",$J,SITE)="",^TMP("RCDFN",$J,DFN)=""
"RTN","RCKATRPT",101,0)
 .I '$O(^TMP("DEBTOR",$J,SITE,DEB,DFN,BN)) D
"RTN","RCKATRPT",102,0)
 ..I $Y+5>IOSL D RET Q:RCFLAG  W !,?35,$P($$SITE^VASITE(),"^",2),!!,DEB_":"_$P($G(^DPT(DFN,0)),"^",1),! S ^TMP("RCSITE",$J,SITE)="",^TMP("RCDFN",$J,DFN)=""
"RTN","RCKATRPT",103,0)
 ..N X
"RTN","RCKATRPT",104,0)
 ..S X=$G(^TMP("RCDEBTOR",$J,SITE,DEB,DFN))
"RTN","RCKATRPT",105,0)
 ..S $P(RCDL,"-",65)="" W !,"------",?16,RCDL
"RTN","RCKATRPT",106,0)
 ..W !,"TOTAL: ",?12,$J("$"_$P(X,"^",1),15),?30,$J("$"_$P(X,"^",2),15),?45,$J("$"_$P(X,"^",3),15),?65,$J("$"_$P(X,"^",4),15),!
"RTN","RCKATRPT",107,0)
 ..S ^XTMP("RCKATRPT",SITE,DEB,DFN,"TOT")=DEB_"^"_"^"_X
"RTN","RCKATRPT",108,0)
 .S ^XTMP("RCKATRPT",SITE,DEB,DFN,BN)=DEB_"^"_BN_"^"_DATA
"RTN","RCKATRPT",109,0)
 .Q
"RTN","RCKATRPT",110,0)
 Q
"VER")
8.0^22.0
"BLD",6725,6)
^217
**END**
**END**
