Released PSJ*5*145 SEQ #169
Extracted from mail message
**KIDS**:PSJ*5.0*145^

**INSTALL NAME**
PSJ*5.0*145
"BLD",5687,0)
PSJ*5.0*145^INPATIENT MEDICATIONS^0^3070614^y
"BLD",5687,1,0)
^^60^60^3070614^
"BLD",5687,1,1,0)
 
"BLD",5687,1,2,0)
1. Sites reported that location designation for inpatients who received 
"BLD",5687,1,3,0)
orders in a clinic was incorrect. In some cases the clinic location was 
"BLD",5687,1,4,0)
overwriting the ward location designation. In many instances an error 
"BLD",5687,1,5,0)
appeared in the routine PSGMAR1 for printing the 24 hr MAR.
"BLD",5687,1,6,0)
 
"BLD",5687,1,7,0)
This patch corrects this issue by adding new prompts to aid in printing 
"BLD",5687,1,8,0)
out orders for both ward locations and clinics. No location designations 
"BLD",5687,1,9,0)
are overwritten. When printing by Ward Group/Patient, or by Ward/Patient, 
"BLD",5687,1,10,0)
all orders for a patient are grouped together by the patient's name
"BLD",5687,1,11,0)
regardless of location. HD84581, HD94525, HD94701, HD94753,HD94951, 
"BLD",5687,1,12,0)
HD9500, HD95644, HD96287, HD97627, HD99007, HD101172, HD121955,
"BLD",5687,1,13,0)
HD127037, HD130450, HD133140, HD133726, HD151842, HD152395, HD152987,
"BLD",5687,1,14,0)
HD153754, HD154263, HD155098, HD155822, HD157154, HD166444, HD176045, 
"BLD",5687,1,15,0)
HD181032, HD181254, HD184077  
"BLD",5687,1,16,0)
 
"BLD",5687,1,17,0)
The following prompts are included when printing by Ward, Ward Group, 
"BLD",5687,1,18,0)
Clinic, or Clinic Group.
"BLD",5687,1,19,0)
 
"BLD",5687,1,20,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): WARD
"BLD",5687,1,21,0)
Include Clinic Orders? Y/N
"BLD",5687,1,22,0)
If Yes is selected, both ward and clinic orders are printed for
"BLD",5687,1,23,0)
patients on a ward.
"BLD",5687,1,24,0)
If No is selected, only the ward orders are printed.
"BLD",5687,1,25,0)
 
"BLD",5687,1,26,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): GROUP
"BLD",5687,1,27,0)
Select by WARD GROUP (W) or CLINIC GROUP (C): WARD
"BLD",5687,1,28,0)
Include Clinic Orders? Y/N
"BLD",5687,1,29,0)
If Yes is selected, both ward and clinic orders are printed for
"BLD",5687,1,30,0)
patients in a Ward Group.
"BLD",5687,1,31,0)
If No is selected, only the ward orders are printed for patients in a
"BLD",5687,1,32,0)
Ward Group.
"BLD",5687,1,33,0)
 
"BLD",5687,1,34,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): CLINIC
"BLD",5687,1,35,0)
Include Ward Orders? Y/N
"BLD",5687,1,36,0)
If Yes is selected, both clinic and ward orders are printed for
"BLD",5687,1,37,0)
patients in a clinic.
"BLD",5687,1,38,0)
If No is selected, only the clinic orders are printed.
"BLD",5687,1,39,0)
 
"BLD",5687,1,40,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): GROUP
"BLD",5687,1,41,0)
Select by WARD GROUP (W) or CLINIC GROUP (C): CLINIC
"BLD",5687,1,42,0)
Include Ward Orders? Y/N
"BLD",5687,1,43,0)
If Yes is selected, both clinic and ward orders are printed for
"BLD",5687,1,44,0)
patients in a Clinic Group.
"BLD",5687,1,45,0)
If No is selected, only the clinic orders are printed for patients in a
"BLD",5687,1,46,0)
Clinic Group.
"BLD",5687,1,47,0)
 
"BLD",5687,1,48,0)
 
"BLD",5687,1,49,0)
2. After the installation of PSJ*5.0*111 and PSJ*5.0*131, the formatting 
"BLD",5687,1,50,0)
on the MAR reports was adversely affected. Sites reported pagination was 
"BLD",5687,1,51,0)
off, pages displayed too much empty space, and the signature block no 
"BLD",5687,1,52,0)
longer appeared at the bottom of each page.
"BLD",5687,1,53,0)
 
"BLD",5687,1,54,0)
Code modifications have been made in the MAR routines to correct the 
"BLD",5687,1,55,0)
formatting problems. Page numbering has been corrected.  The signature 
"BLD",5687,1,56,0)
block prints at the end of each page. Pending orders, non-clinic and 
"BLD",5687,1,57,0)
clinic orders will display in the correct location on
"BLD",5687,1,58,0)
the MAR report. Orders with a stop date/time greater than or equal to the 
"BLD",5687,1,59,0)
selected 24 Hour MAR start date/time will print out correctly. HD94303, 
"BLD",5687,1,60,0)
HD94836, HD95397, HD97108, HD107645, HD114937, PSI-06-002
"BLD",5687,4,0)
^9.64PA^^
"BLD",5687,6)
6^
"BLD",5687,6.3)
17
"BLD",5687,"ABPKG")
n
"BLD",5687,"KRN",0)
^9.67PA^8989.52^19
"BLD",5687,"KRN",.4,0)
.4
"BLD",5687,"KRN",.401,0)
.401
"BLD",5687,"KRN",.402,0)
.402
"BLD",5687,"KRN",.403,0)
.403
"BLD",5687,"KRN",.5,0)
.5
"BLD",5687,"KRN",.84,0)
.84
"BLD",5687,"KRN",3.6,0)
3.6
"BLD",5687,"KRN",3.8,0)
3.8
"BLD",5687,"KRN",9.2,0)
9.2
"BLD",5687,"KRN",9.8,0)
9.8
"BLD",5687,"KRN",9.8,"NM",0)
^9.68A^21^13
"BLD",5687,"KRN",9.8,"NM",4,0)
PSGMIV^^0^B47833428
"BLD",5687,"KRN",9.8,"NM",10,0)
PSGMMIV^^0^B45072835
"BLD",5687,"KRN",9.8,"NM",11,0)
PSGSEL^^0^B40642983
"BLD",5687,"KRN",9.8,"NM",12,0)
PSGMAR^^0^B42245197
"BLD",5687,"KRN",9.8,"NM",13,0)
PSGMAR0^^0^B72001544
"BLD",5687,"KRN",9.8,"NM",14,0)
PSGMAR1^^0^B8879806
"BLD",5687,"KRN",9.8,"NM",15,0)
PSGMAR2^^0^B12705829
"BLD",5687,"KRN",9.8,"NM",16,0)
PSGMMAR^^0^B27316363
"BLD",5687,"KRN",9.8,"NM",17,0)
PSGMMAR0^^0^B68830195
"BLD",5687,"KRN",9.8,"NM",18,0)
PSGMMAR1^^0^B18809433
"BLD",5687,"KRN",9.8,"NM",19,0)
PSGMMAR2^^0^B40124630
"BLD",5687,"KRN",9.8,"NM",20,0)
PSGMMAR3^^0^B7615317
"BLD",5687,"KRN",9.8,"NM",21,0)
PSGMMAR5^^0^B14152055
"BLD",5687,"KRN",9.8,"NM","B","PSGMAR",12)

"BLD",5687,"KRN",9.8,"NM","B","PSGMAR0",13)

"BLD",5687,"KRN",9.8,"NM","B","PSGMAR1",14)

"BLD",5687,"KRN",9.8,"NM","B","PSGMAR2",15)

"BLD",5687,"KRN",9.8,"NM","B","PSGMIV",4)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR",16)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR0",17)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR1",18)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR2",19)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR3",20)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMAR5",21)

"BLD",5687,"KRN",9.8,"NM","B","PSGMMIV",10)

"BLD",5687,"KRN",9.8,"NM","B","PSGSEL",11)

"BLD",5687,"KRN",19,0)
19
"BLD",5687,"KRN",19,"NM",0)
^9.68A^^
"BLD",5687,"KRN",19.1,0)
19.1
"BLD",5687,"KRN",101,0)
101
"BLD",5687,"KRN",409.61,0)
409.61
"BLD",5687,"KRN",771,0)
771
"BLD",5687,"KRN",870,0)
870
"BLD",5687,"KRN",8989.51,0)
8989.51
"BLD",5687,"KRN",8989.52,0)
8989.52
"BLD",5687,"KRN",8994,0)
8994
"BLD",5687,"KRN","B",.4,.4)

"BLD",5687,"KRN","B",.401,.401)

"BLD",5687,"KRN","B",.402,.402)

"BLD",5687,"KRN","B",.403,.403)

"BLD",5687,"KRN","B",.5,.5)

"BLD",5687,"KRN","B",.84,.84)

"BLD",5687,"KRN","B",3.6,3.6)

"BLD",5687,"KRN","B",3.8,3.8)

"BLD",5687,"KRN","B",9.2,9.2)

"BLD",5687,"KRN","B",9.8,9.8)

"BLD",5687,"KRN","B",19,19)

"BLD",5687,"KRN","B",19.1,19.1)

"BLD",5687,"KRN","B",101,101)

"BLD",5687,"KRN","B",409.61,409.61)

"BLD",5687,"KRN","B",771,771)

"BLD",5687,"KRN","B",870,870)

"BLD",5687,"KRN","B",8989.51,8989.51)

"BLD",5687,"KRN","B",8989.52,8989.52)

"BLD",5687,"KRN","B",8994,8994)

"BLD",5687,"QUES",0)
^9.62^^
"BLD",5687,"REQB",0)
^9.611^1^1
"BLD",5687,"REQB",1,0)
PSJ*5.0*131^2
"BLD",5687,"REQB","B","PSJ*5.0*131",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
145^3070614^10000000010
"PKG",197,22,1,"PAH",1,1,0)
^^60^60^3070614
"PKG",197,22,1,"PAH",1,1,1,0)
 
"PKG",197,22,1,"PAH",1,1,2,0)
1. Sites reported that location designation for inpatients who received 
"PKG",197,22,1,"PAH",1,1,3,0)
orders in a clinic was incorrect. In some cases the clinic location was 
"PKG",197,22,1,"PAH",1,1,4,0)
overwriting the ward location designation. In many instances an error 
"PKG",197,22,1,"PAH",1,1,5,0)
appeared in the routine PSGMAR1 for printing the 24 hr MAR.
"PKG",197,22,1,"PAH",1,1,6,0)
 
"PKG",197,22,1,"PAH",1,1,7,0)
This patch corrects this issue by adding new prompts to aid in printing 
"PKG",197,22,1,"PAH",1,1,8,0)
out orders for both ward locations and clinics. No location designations 
"PKG",197,22,1,"PAH",1,1,9,0)
are overwritten. When printing by Ward Group/Patient, or by Ward/Patient, 
"PKG",197,22,1,"PAH",1,1,10,0)
all orders for a patient are grouped together by the patient's name
"PKG",197,22,1,"PAH",1,1,11,0)
regardless of location. HD84581, HD94525, HD94701, HD94753,HD94951, 
"PKG",197,22,1,"PAH",1,1,12,0)
HD9500, HD95644, HD96287, HD97627, HD99007, HD101172, HD121955,
"PKG",197,22,1,"PAH",1,1,13,0)
HD127037, HD130450, HD133140, HD133726, HD151842, HD152395, HD152987,
"PKG",197,22,1,"PAH",1,1,14,0)
HD153754, HD154263, HD155098, HD155822, HD157154, HD166444, HD176045, 
"PKG",197,22,1,"PAH",1,1,15,0)
HD181032, HD181254, HD184077  
"PKG",197,22,1,"PAH",1,1,16,0)
 
"PKG",197,22,1,"PAH",1,1,17,0)
The following prompts are included when printing by Ward, Ward Group, 
"PKG",197,22,1,"PAH",1,1,18,0)
Clinic, or Clinic Group.
"PKG",197,22,1,"PAH",1,1,19,0)
 
"PKG",197,22,1,"PAH",1,1,20,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): WARD
"PKG",197,22,1,"PAH",1,1,21,0)
Include Clinic Orders? Y/N
"PKG",197,22,1,"PAH",1,1,22,0)
If Yes is selected, both ward and clinic orders are printed for
"PKG",197,22,1,"PAH",1,1,23,0)
patients on a ward.
"PKG",197,22,1,"PAH",1,1,24,0)
If No is selected, only the ward orders are printed.
"PKG",197,22,1,"PAH",1,1,25,0)
 
"PKG",197,22,1,"PAH",1,1,26,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): GROUP
"PKG",197,22,1,"PAH",1,1,27,0)
Select by WARD GROUP (W) or CLINIC GROUP (C): WARD
"PKG",197,22,1,"PAH",1,1,28,0)
Include Clinic Orders? Y/N
"PKG",197,22,1,"PAH",1,1,29,0)
If Yes is selected, both ward and clinic orders are printed for
"PKG",197,22,1,"PAH",1,1,30,0)
patients in a Ward Group.
"PKG",197,22,1,"PAH",1,1,31,0)
If No is selected, only the ward orders are printed for patients in a
"PKG",197,22,1,"PAH",1,1,32,0)
Ward Group.
"PKG",197,22,1,"PAH",1,1,33,0)
 
"PKG",197,22,1,"PAH",1,1,34,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): CLINIC
"PKG",197,22,1,"PAH",1,1,35,0)
Include Ward Orders? Y/N
"PKG",197,22,1,"PAH",1,1,36,0)
If Yes is selected, both clinic and ward orders are printed for
"PKG",197,22,1,"PAH",1,1,37,0)
patients in a clinic.
"PKG",197,22,1,"PAH",1,1,38,0)
If No is selected, only the clinic orders are printed.
"PKG",197,22,1,"PAH",1,1,39,0)
 
"PKG",197,22,1,"PAH",1,1,40,0)
Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): GROUP
"PKG",197,22,1,"PAH",1,1,41,0)
Select by WARD GROUP (W) or CLINIC GROUP (C): CLINIC
"PKG",197,22,1,"PAH",1,1,42,0)
Include Ward Orders? Y/N
"PKG",197,22,1,"PAH",1,1,43,0)
If Yes is selected, both clinic and ward orders are printed for
"PKG",197,22,1,"PAH",1,1,44,0)
patients in a Clinic Group.
"PKG",197,22,1,"PAH",1,1,45,0)
If No is selected, only the clinic orders are printed for patients in a
"PKG",197,22,1,"PAH",1,1,46,0)
Clinic Group.
"PKG",197,22,1,"PAH",1,1,47,0)
 
"PKG",197,22,1,"PAH",1,1,48,0)
 
"PKG",197,22,1,"PAH",1,1,49,0)
2. After the installation of PSJ*5.0*111 and PSJ*5.0*131, the formatting 
"PKG",197,22,1,"PAH",1,1,50,0)
on the MAR reports was adversely affected. Sites reported pagination was 
"PKG",197,22,1,"PAH",1,1,51,0)
off, pages displayed too much empty space, and the signature block no 
"PKG",197,22,1,"PAH",1,1,52,0)
longer appeared at the bottom of each page.
"PKG",197,22,1,"PAH",1,1,53,0)
 
"PKG",197,22,1,"PAH",1,1,54,0)
Code modifications have been made in the MAR routines to correct the 
"PKG",197,22,1,"PAH",1,1,55,0)
formatting problems. Page numbering has been corrected.  The signature 
"PKG",197,22,1,"PAH",1,1,56,0)
block prints at the end of each page. Pending orders, non-clinic and 
"PKG",197,22,1,"PAH",1,1,57,0)
clinic orders will display in the correct location on
"PKG",197,22,1,"PAH",1,1,58,0)
the MAR report. Orders with a stop date/time greater than or equal to the 
"PKG",197,22,1,"PAH",1,1,59,0)
selected 24 Hour MAR start date/time will print out correctly. HD94303, 
"PKG",197,22,1,"PAH",1,1,60,0)
HD94836, HD95397, HD97108, HD107645, HD114937, PSI-06-002
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","PSGMAR")
0^12^B42245197^B40463616
"RTN","PSGMAR",1,0)
PSGMAR ;BIR/CML3-24 HOUR MAR - MAIN DRIVER ;14 Oct 98 / 4:27 PM
"RTN","PSGMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMAR",3,0)
 ;
"RTN","PSGMAR",4,0)
EN ;
"RTN","PSGMAR",5,0)
 ;
"RTN","PSGMAR",6,0)
 NEW PSGOP
"RTN","PSGMAR",7,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE
"RTN","PSGMAR",8,0)
 D MARFORM^PSGMUTL G:PSGMARB=0 DONE S:PSGMARB'=1 PSGMARS=3
"RTN","PSGMAR",9,0)
 G:PSGMARB'=1 ENDATE F  R !!,"Print (C)ontinuous sheets, (P)RN sheets, or (B)oth? B// ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^CPB"[X&($L(X)<2)  W:X'?1."?" $C(7),"  ??" D:X?1."?" SHTH
"RTN","PSGMAR",10,0)
 G:X="^" DONE I X="" W "  (Both)" S PSGMARS=3
"RTN","PSGMAR",11,0)
 E  W $S(X="C":"ontinuous",X="P":"RN",1:"oth") S PSGMARS=$F("CPB",X)-1
"RTN","PSGMAR",12,0)
 ;
"RTN","PSGMAR",13,0)
ENDATE ; get start date
"RTN","PSGMAR",14,0)
 S %DT="ETX",Y=-1 F  W !!,"Enter START DATE/TIME for 24 hour MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH D ^%DT Q:Y>0
"RTN","PSGMAR",15,0)
 I Y'>0 W $C(7),!!?5,"(No date selected for MAR run.)" G DONE
"RTN","PSGMAR",16,0)
 S PSGMARDT=+$E(Y,1,10) D:$P(PSGMARDT,".",2)
"RTN","PSGMAR",17,0)
 .S PSGPLS=PSGMARDT,PSGPLF=$$EN^PSGCT(PSGPLS,-1),ST=$P(PSGPLS_0,".",2),FT=$P(PSGPLF_0,".",2)
"RTN","PSGMAR",18,0)
 .S PSGMARSD=$E(ST,1,2),PSGMARFD=$E(FT,1,2) S:'PSGMARSD PSGMARSD="01" S PSGMARFD=$S(+PSGMARSD=1:24,PSGMARSD=PSGMARFD:PSGMARSD-1,1:PSGMARFD) S:$L(PSGMARFD)<2 PSGMARFD=0_PSGMARFD
"RTN","PSGMAR",19,0)
 .I ST>1 S X1=$P(PSGPLF,"."),X2=1 D C^%DTC S PSGPLF=X
"RTN","PSGMAR",20,0)
 .S PSGPLS=+(PSGPLS_"."_ST),PSGPLF=+(PSGPLF_"."_FT)
"RTN","PSGMAR",21,0)
 .S PSGMARSP=$$ENDTC2^PSGMI(PSGPLS),PSGMARFP=$$ENDTC2^PSGMI(PSGPLF)
"RTN","PSGMAR",22,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGMARWD=+$G(PSJPWD),PSGRBPPN=""
"RTN","PSGMAR",23,0)
 I '$D(PSGOENOF) S (PSGP,PSGPAT)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMAR",24,0)
 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMAR",25,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMAR",26,0)
 ;
"RTN","PSGMAR",27,0)
ENQ ; when queued
"RTN","PSGMAR",28,0)
 N F,P,DRGI,DRGN,DRGT,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMAR",29,0)
 S PSJACNWP=1 U IO D ^PSGMAR0 I $D(^TMP($J))>9 D ^PSGMAR1
"RTN","PSGMAR",30,0)
 ;DAM 5-01-07
"RTN","PSGMAR",31,0)
 I $D(PSGREP) K ^XTMP(PSGREP)
"RTN","PSGMAR",32,0)
 ;END DAM
"RTN","PSGMAR",33,0)
 D ^%ZISC G DONE
"RTN","PSGMAR",34,0)
 ;
"RTN","PSGMAR",35,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMAR",36,0)
DONE ;
"RTN","PSGMAR",37,0)
 I '$D(PSGOENOF) D ENKV^PSGSETU
"RTN","PSGMAR",38,0)
 K AD,ASTERS,BD,BLN,C,CNTR,DA1,DA2,DAO,DFN,DRG,DX,EXPIRE,FD,FT,HX,L,LN1,LN14,LN2,LN3,LN4,LN5,LN6,LN7,MOS,MSG1,MSG2,ND2,NG,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGPLF,PSGPLS,PSGPLC,PSGPLO,QX,TMSTR,XX
"RTN","PSGMAR",39,0)
 K PSGADR,PSGALG,PSGD,PSGDW,PSGFORM,PSGMAR,PSGMARB,PSGMARDF,PSGMARDT,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMARS,PSGMARSD,PSGL
"RTN","PSGMAR",40,0)
 K PSGMARSM,PSGMARSP,PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMAR",41,0)
 K PSJSTOP,PSJPWDO,PSGMARO,ST,PSGSS,PSGSSH,PSTXDT,PST,PTM,PWDN,PSJACNWP,QST,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1,^TMP($J)
"RTN","PSGMAR",42,0)
 K PSGST,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGMTYPE,PSGPG,PSGMFOR,PSGMTYPE,PSGPG,PSGRBPPN,PSGS0XT,PSGS0Y
"RTN","PSGMAR",43,0)
 K HT,ON,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDES,ONHOLD
"RTN","PSGMAR",44,0)
 D ENKV^PSGLOI
"RTN","PSGMAR",45,0)
 Q
"RTN","PSGMAR",46,0)
 ;
"RTN","PSGMAR",47,0)
G ; get ward group
"RTN","PSGMAR",48,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMAR",49,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMAR",50,0)
 . S PSGMARWG=+Y
"RTN","PSGMAR",51,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMAR",52,0)
 D RBPPN^PSJMDIR
"RTN","PSGMAR",53,0)
 Q
"RTN","PSGMAR",54,0)
 ;
"RTN","PSGMAR",55,0)
W ; get ward
"RTN","PSGMAR",56,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y'>0 S PSJSTOP=1 Q
"RTN","PSGMAR",57,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR
"RTN","PSGMAR",58,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMAR",59,0)
 Q
"RTN","PSGMAR",60,0)
 ;
"RTN","PSGMAR",61,0)
P ; get patient
"RTN","PSGMAR",62,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMAR",63,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMAR",64,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMAR",65,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMAR",66,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMAR",67,0)
 Q
"RTN","PSGMAR",68,0)
 ;
"RTN","PSGMAR",69,0)
C ;
"RTN","PSGMAR",70,0)
 ;DAM Add new variable to hold numerical value of CLINIC 5-01-07
"RTN","PSGMAR",71,0)
 S PSGCLNC=""
"RTN","PSGMAR",72,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMAR",73,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",74,0)
CDIC ;
"RTN","PSGMAR",75,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y S PSGCLNC=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",76,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMAR",77,0)
 Q
"RTN","PSGMAR",78,0)
L ;
"RTN","PSGMAR",79,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMAR",80,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMAR",81,0)
LDIC ;
"RTN","PSGMAR",82,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMAR",83,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMAR",84,0)
 Q
"RTN","PSGMAR",85,0)
DEV ; ask print device and queue if asked to
"RTN","PSGMAR",86,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMAR",ZTDESC="24 HOUR MAR" S:PSGMARB ZTSAVE("PSGMARS")="" D
"RTN","PSGMAR",87,0)
 . F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARDT","PSGSS","PSGMARB","PSGMARDF","PSGMTYPE","PSGRBPPN","^TMP($J,","PSGINCL","PSGINCLG","PSGINWD","PSGINWDG" S ZTSAVE(X)=""
"RTN","PSGMAR",88,0)
 I $P(PSGMARDT,".",2) F X="PSGPLS","PSGPLF","PSGMARSD","PSGMARFD","PSGMARSP","PSGMARFP" S ZTSAVE(X)=""
"RTN","PSGMAR",89,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMAR",90,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for 24 hour MAR run." W:$D(ZTSK) !?3,"24 hour MAR Queued!" K ZTSK Q
"RTN","PSGMAR",91,0)
 I 'IO("Q") U IO
"RTN","PSGMAR",92,0)
 ;
"RTN","PSGMAR",93,0)
BH ;
"RTN","PSGMAR",94,0)
 W !!,"  Enter a 'Y' to print BLANK (no data) MARs for the patient(s) you select.",!,"Enter an 'N' (or press the RETURN key) to print MARs complete with orders.",!,"Enter an  '^' to exit this option now." Q
"RTN","PSGMAR",95,0)
 ;
"RTN","PSGMAR",96,0)
DH ;
"RTN","PSGMAR",97,0)
 W !!?2,"Enter the START DATE of the 24 hour period for which this MAR is to print.",!,"Unless the BLANK MARs are selected, all orders for the patient(s) selected that",!,"are (or were) active during the date range selected will print."
"RTN","PSGMAR",98,0)
 W !?2,"Time is not required.  If time is not entered, the default time is used (if",!,"found in the site parameters).  If the default time is not found, the start of",!,"the day is used." Q
"RTN","PSGMAR",99,0)
 ;
"RTN","PSGMAR",100,0)
SHTH ;
"RTN","PSGMAR",101,0)
 W !!?2,"Enter 'C' to print ONLY CONTINUOUS blank sheets for the patients selected.",!,"Enter 'P' to print ONLY PRN sheets.  Enter 'B' (or press RETURN) to print BOTH",!,"sheets for each patient." Q
"RTN","PSGMAR",102,0)
 ;
"RTN","PSGMAR",103,0)
ENLM ;
"RTN","PSGMAR",104,0)
 S PSGOENOF=1,PSGPAT(PSGP)="",PSGSS="P" G EN
"RTN","PSGMAR0")
0^13^B72001544^B31846437
"RTN","PSGMAR0",1,0)
PSGMAR0 ;BIR/CML3-GATHERS INFO FOR 24 HOUR MAR ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111,145**;16 DEC 97;Build 17
"RTN","PSGMAR0",3,0)
 ;
"RTN","PSGMAR0",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMAR0",5,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMAR0",6,0)
 ; Reference to CUR^FHORD7 supported by DBIA #2019.
"RTN","PSGMAR0",7,0)
ENQ ;
"RTN","PSGMAR0",8,0)
 S PSGMSORT=$P($G(^PS(59.7,1,26)),U,4)
"RTN","PSGMAR0",9,0)
 K ^TMP($J) D NOW^%DTC S PSGDT=%,PSGMARWN="",PSJACNWP=1 D @("G"_PSGSS) I $D(^TMP($J))<10 U IO W:$Y @IOF W !!,"(No data found for 24 hour MAR run.)"
"RTN","PSGMAR0",10,0)
 ;
"RTN","PSGMAR0",11,0)
 ;
"RTN","PSGMAR0",12,0)
DONE ;
"RTN","PSGMAR0",13,0)
 K PSGMFOR
"RTN","PSGMAR0",14,0)
 Q
"RTN","PSGMAR0",15,0)
 ;
"RTN","PSGMAR0",16,0)
GG ; find individual wards in this ward group
"RTN","PSGMAR0",17,0)
 F PSGMARWD=0:0 S PSGMARWD=$O(^PS(57.5,"AC",PSGMARWG,PSGMARWD)) Q:'PSGMARWD  D GW
"RTN","PSGMAR0",18,0)
 Q
"RTN","PSGMAR0",19,0)
 ;
"RTN","PSGMAR0",20,0)
GW ; find patients in each ward
"RTN","PSGMAR0",21,0)
 I $D(^DIC(42,PSGMARWD,0)),$P(^(0),"^")]"" S PSGMARWN=$P(^(0),"^")
"RTN","PSGMAR0",22,0)
 E  Q
"RTN","PSGMAR0",23,0)
 ;
"RTN","PSGMAR0",24,0)
 I 'PSGMARWG S PSGMARWG=+$O(^PS(57.5,"AB",PSGMARWD,0))
"RTN","PSGMAR0",25,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGMARWN,PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI
"RTN","PSGMAR0",26,0)
 Q
"RTN","PSGMAR0",27,0)
 ;
"RTN","PSGMAR0",28,0)
GP ; go thru selected patients
"RTN","PSGMAR0",29,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI
"RTN","PSGMAR0",30,0)
 Q
"RTN","PSGMAR0",31,0)
 ;
"RTN","PSGMAR0",32,0)
GL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D GC
"RTN","PSGMAR0",33,0)
 Q
"RTN","PSGMAR0",34,0)
GC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGMAR0",35,0)
 D DTSET:'$P(PSGMARDT,".",2)
"RTN","PSGMAR0",36,0)
 ;DEM 04/19/2006 - PSGCAD = User selected start date/time minus .0001
"RTN","PSGMAR0",37,0)
 S PSGCAD=PSGPLS-.0001
"RTN","PSGMAR0",38,0)
 F  S PSGCAD=$O(^PS(55,"AIVC",PSGCAD)) Q:PSGCAD=""  D  ;DEM 04/19/2006 - Index by order stop date/time.
"RTN","PSGMAR0",39,0)
 . S PSGP=0
"RTN","PSGMAR0",40,0)
 . F  S PSGP=$O(^PS(55,"AIVC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI  ;DEM 04/19/2006 - Removed S PSJPWDN="C!"_CL D GPI. Want to rollup patients non-clinic orders under patients location.
"RTN","PSGMAR0",41,0)
 ;DEM 04/19/2006 - PSGCAD = User selected start date/time minus .0001
"RTN","PSGMAR0",42,0)
 S PSGCAD=PSGPLS-.0001
"RTN","PSGMAR0",43,0)
 F  S PSGCAD=$O(^PS(55,"AUDC",PSGCAD)) Q:PSGCAD=""  D  ;DEM 04/19/2006 - Index by order stop date/time.
"RTN","PSGMAR0",44,0)
 . S PSGP=0
"RTN","PSGMAR0",45,0)
 . F  S PSGP=$O(^PS(55,"AUDC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1),DTSET:'$P(PSGMARDT,".",2) D GPI  ;DEM 04/19/2006 - Removed S PSJPWDN="C!"_CL D GPI. Want to rollup patients non-clinic orders under patients location.
"RTN","PSGMAR0",46,0)
 Q
"RTN","PSGMAR0",47,0)
GPI ; get patient info
"RTN","PSGMAR0",48,0)
 ; PSGTMALL=1(sort by all team), PSGTM=1(individual team(S) selected).
"RTN","PSGMAR0",49,0)
 S TM="" S:PSGSS="P"!(PSGSS="C")!(PSGSS="L") PSGMARWN=$S(PSJPWDN]"":PSJPWDN,1:"NOT FOUND")
"RTN","PSGMAR0",50,0)
 S:PSJPRB="" PSJPRB="zz"
"RTN","PSGMAR0",51,0)
 S:"GPCL"[PSGSS!('$G(PSGTM)&'$G(PSGTMALL)) TM="zz"
"RTN","PSGMAR0",52,0)
 S:$G(TM)="" TM=$S(PSJPRB="zz":0,1:+$O(^PS(57.7,"AWRT",PSGMARWD,PSJPRB,0))),TM=$S('TM:"zz",'$D(^PS(57.7,PSGMARWD,1,TM,0)):TM,$P(^(0),"^")]"":$P(^(0),"^"),1:TM)
"RTN","PSGMAR0",53,0)
 Q:'$G(PSGTMALL)&$G(PSGTM)&'$D(PSGTM(TM))
"RTN","PSGMAR0",54,0)
 S PPN=$E($P(PSGP(0),"^"),1,15)_"^"_PSGP
"RTN","PSGMAR0",55,0)
 N SUB1,SUB2 S:PSGRBPPN="P" SUB1=PPN,SUB2=PSJPRB S:PSGRBPPN="R" SUB1=PSJPRB,SUB2=PPN
"RTN","PSGMAR0",56,0)
 I PSGMARB=1 D SPN Q
"RTN","PSGMAR0",57,0)
 I PSGMTYPE[1 F XTYPE=2:1:6 D @XTYPE
"RTN","PSGMAR0",58,0)
 I PSGMTYPE'[1 F XTYPE=2:1:6 D:PSGMTYPE[XTYPE @XTYPE
"RTN","PSGMAR0",59,0)
 N PSGMAR24  ;DEM 04/19/2006 - 24 Hour MAR flag for call to shared routine ^PSGMMAR5 (24 Hour MAR Reports and 7 Day/14 Day MAR Reports both call ^PSGMMAR5).
"RTN","PSGMAR0",60,0)
 S PSGMAR24=1
"RTN","PSGMAR0",61,0)
 D ^PSGMMAR5
"RTN","PSGMAR0",62,0)
 K PSGMAR24
"RTN","PSGMAR0",63,0)
 D:$S(PSGSS["P"!(PSGSS="C")!(PSGSS="L"):$D(^TMP($J,PPN)),1:$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2))) SPN
"RTN","PSGMAR0",64,0)
 Q
"RTN","PSGMAR0",65,0)
 ;
"RTN","PSGMAR0",66,0)
2 ;Loop thru UD orders
"RTN","PSGMAR0",67,0)
 ;DEM 04/19/2006
"RTN","PSGMAR0",68,0)
 ;       Location variable PSGMARWC added to correctly rollup orders
"RTN","PSGMAR0",69,0)
 ;       under location. The location can change if the UD order is
"RTN","PSGMAR0",70,0)
 ;       assoicated with a clinic location. If the location changes
"RTN","PSGMAR0",71,0)
 ;       under the aforementioned scenario, then PSGMARWC preserves
"RTN","PSGMAR0",72,0)
 ;       the original value and is used to restore location to it's
"RTN","PSGMAR0",73,0)
 ;       original value.
"RTN","PSGMAR0",74,0)
 ;
"RTN","PSGMAR0",75,0)
 N PSGMARWC
"RTN","PSGMAR0",76,0)
 S PSGMARWC=PSGMARWN    ;DEM 04/19/2006 - Preserve original value of patients location. If location is changed, then restore to original value after call to ORSET.
"RTN","PSGMAR0",77,0)
 F PST="C","O","OC","P","R" F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F PSGMARO=0:0 S PSGMARO=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,PSGMARO)) Q:'PSGMARO  D ORSET S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMAR0",78,0)
 S PST="S" D ^PSGMIV
"RTN","PSGMAR0",79,0)
 Q
"RTN","PSGMAR0",80,0)
3 ;Loop thru IV orders that are Piggy back and Syringes types. 
"RTN","PSGMAR0",81,0)
 F PST="P","S" D ^PSGMIV
"RTN","PSGMAR0",82,0)
 Q
"RTN","PSGMAR0",83,0)
4 ;Loop thru IV orders(Additives).
"RTN","PSGMAR0",84,0)
 S PST="A" D ^PSGMIV
"RTN","PSGMAR0",85,0)
 Q
"RTN","PSGMAR0",86,0)
5 ;Loop thru IV orders(Hyperal).
"RTN","PSGMAR0",87,0)
 S PST="H" D ^PSGMIV
"RTN","PSGMAR0",88,0)
 Q
"RTN","PSGMAR0",89,0)
6 ;Loop thru IV order(Chemo).
"RTN","PSGMAR0",90,0)
 S PST="C" D ^PSGMIV
"RTN","PSGMAR0",91,0)
 Q
"RTN","PSGMAR0",92,0)
 ;
"RTN","PSGMAR0",93,0)
 ; PSGMFOR is set to bypass "fill on request" when call ^PSGPL0.
"RTN","PSGMAR0",94,0)
ORSET ; order record set
"RTN","PSGMAR0",95,0)
 S PSGMFOR="",ND2=$G(^PS(55,PSGP,5,PSGMARO,2)),(SD,X)=$P($P(ND2,"^",2),".") Q:X>PSGPLF  S FD=$P($P(ND2,"^",4),"."),T=$P(ND2,"^",6)
"RTN","PSGMAR0",96,0)
 ; 
"RTN","PSGMAR0",97,0)
 S A=$G(^PS(55,PSGP,5,PSGMARO,8)) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D SPN
"RTN","PSGMAR0",98,0)
 ;
"RTN","PSGMAR0",99,0)
 NEW MARX D DRGDISP^PSJLMUT1(PSGP,+PSGMARO_"U",20,0,.MARX,1)
"RTN","PSGMAR0",100,0)
 S DRG=MARX(1)_U_PSGMARO_"U",QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",$P(ND2,"^")["PRN":"OR",1:"CR")
"RTN","PSGMAR0",101,0)
 ;
"RTN","PSGMAR0",102,0)
 S X="" I "OB"]QST,$P(ND2,U)'["@",$P(ND2,U,2)'>PSGPLS,$P(ND2,U,4)'<PSGPLF,$P(ND2,U,5),$P(ND2,U,6)<1441,$P(ND2,U,6)'="D" S X=$P(ND2,U,5),PSGPLC=1
"RTN","PSGMAR0",103,0)
 E  I "OB"]QST S PSGPLO=PSGMARO K PSGMAR D ^PSGPL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMAR0",104,0)
 S X=$S(QST["C"!(QST["O"):$P(ND2,"^",5),1:"")_"^"_X
"RTN","PSGMAR0",105,0)
 ;
"RTN","PSGMAR0",106,0)
 ;
"RTN","PSGMAR0",107,0)
 ;DAM 5-01-07 Add next line to include non-IV meds when printing by PATIENT and choosing to print "ALL MEDS"
"RTN","PSGMAR0",108,0)
 I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X Q
"RTN","PSGMAR0",109,0)
 ;
"RTN","PSGMAR0",110,0)
 ;DAM 5-01-07  Add check to see if user wants to include ward orders when printing by CLINIC GROUP
"RTN","PSGMAR0",111,0)
 I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X Q
"RTN","PSGMAR0",112,0)
 ;
"RTN","PSGMAR0",113,0)
 ;DAM 5-01-07 Add check to see if user wants to include ward orders when printing by CLINIC  
"RTN","PSGMAR0",114,0)
 I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) D  Q
"RTN","PSGMAR0",115,0)
 . S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMAR0",116,0)
 Q:(PSGSS="L")!(PSGSS="C")
"RTN","PSGMAR0",117,0)
 ;
"RTN","PSGMAR0",118,0)
 ; DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by WARD GROUP
"RTN","PSGMAR0",119,0)
 I PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMAR0",120,0)
 ;
"RTN","PSGMAR0",121,0)
 ;DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by WARD. 
"RTN","PSGMAR0",122,0)
 I (PSGSS="W") Q:((PSGINCL="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMAR0",123,0)
 ;
"RTN","PSGMAR0",124,0)
 ;DAM 5-01-07  Add an XTMP global to swap location and patient name in the subscripts when printing MAR by WARD/PATIENT or WARD GROUP.
"RTN","PSGMAR0",125,0)
 N PSGDEM S PSGDEM=X    ;transfer contents of patient drug information contained in "X" above to  a new variable temporarily
"RTN","PSGMAR0",126,0)
 S PSGREP="PSGM_"_$J
"RTN","PSGMAR0",127,0)
 S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMAR0",128,0)
 S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMAR0",129,0)
 I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct XTMP global for printing by WARD
"RTN","PSGMAR0",130,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=PSGDEM
"RTN","PSGMAR0",131,0)
 I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP
"RTN","PSGMAR0",132,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=PSGDEM
"RTN","PSGMAR0",133,0)
 S X=PSGDEM    ;transfer contents of patient drug information contained in PSGDEM back to X
"RTN","PSGMAR0",134,0)
 ;End DAM modifications 5-01-07
"RTN","PSGMAR0",135,0)
 Q
"RTN","PSGMAR0",136,0)
 ;
"RTN","PSGMAR0",137,0)
SPN ; set patient node
"RTN","PSGMAR0",138,0)
 D DIET
"RTN","PSGMAR0",139,0)
 S X=$P(PSGP(0),U)_U_$E($P(PSJPDOB,U,2),1,10)_";"_PSJPAGE_U_VA("PID")_U_PSJPDX_U_PSJPWT_U_PSJPWTD_U_PSJPHT_U_PSJPHTD_U_$P(PSJPAD,U,2)_U_$P(PSJPTD,U,2)_U_$P(PSJPSEX,U,2)_U_PSJPWD_U_PSGPLS_U_PSGPLF_U_PSGMARSD_U_PSGMARFD_U_PSGMARSP_U_PSGMARFP
"RTN","PSGMAR0",140,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN)=X_U_PSGMARWN_U_PSJPRB Q
"RTN","PSGMAR0",141,0)
 ;
"RTN","PSGMAR0",142,0)
 ;
"RTN","PSGMAR0",143,0)
 ;DAM 5-01-07  Add check to see if user wants to include clinic orders when printing by ward. 
"RTN","PSGMAR0",144,0)
 I PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMAR0",145,0)
 ;
"RTN","PSGMAR0",146,0)
 ;DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by ward group.
"RTN","PSGMAR0",147,0)
 I PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMAR0",148,0)
 ;
"RTN","PSGMAR0",149,0)
 ;DAM 5-01-07  Add an XTMP global to reverse location and patient name in the subscripts when printing MAR by WARD/PATIENT or WARD GROUP.
"RTN","PSGMAR0",150,0)
 N PSGDEM S PSGDEM=X    ;transfer contents of patient demographics contained in "X" above to  a new variable temporarily
"RTN","PSGMAR0",151,0)
 S PSGREP="PSGM_"_$J
"RTN","PSGMAR0",152,0)
 S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMAR0",153,0)
 S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMAR0",154,0)
 I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D    ;Construct XTMP global for printing by WARD
"RTN","PSGMAR0",155,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2)=PSGDEM
"RTN","PSGMAR0",156,0)
 I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D   ;Construct XTMP global for printing by WARD GROUP
"RTN","PSGMAR0",157,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2)=PSGDEM
"RTN","PSGMAR0",158,0)
 S X=PSGDEM    ;transfer contents of patient demographics contained in PSGDEM back to X
"RTN","PSGMAR0",159,0)
 ;End DAM modifications 3-7-07
"RTN","PSGMAR0",160,0)
 Q
"RTN","PSGMAR0",161,0)
DIET ; Include abbr. diet label if indicated in the Site par.
"RTN","PSGMAR0",162,0)
 NEW ADM,DFN,PSJMPAR K PSJDIET
"RTN","PSGMAR0",163,0)
 S PSJMPAR=$G(^PS(59.7,1,26))
"RTN","PSGMAR0",164,0)
 Q:'$P(PSJMPAR,U,3)
"RTN","PSGMAR0",165,0)
 S DFN=PSGP,ADM=$G(^DPT("CN",PSGMARWN,DFN))
"RTN","PSGMAR0",166,0)
 I +ADM D CUR^FHORD7 S PSJDIET=Y
"RTN","PSGMAR0",167,0)
 Q
"RTN","PSGMAR0",168,0)
 ;
"RTN","PSGMAR0",169,0)
DTSET ;
"RTN","PSGMAR0",170,0)
 S (PSGPLS,PSGPLF)=PSGMARDT
"RTN","PSGMAR0",171,0)
 S PSJSYSW=$O(^PS(59.6,"B",+$G(PSJPWD),0))
"RTN","PSGMAR0",172,0)
 S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGMAR0",173,0)
 I $D(PSJSYSW0),$P(PSJSYSW0,"^",8) S ST=$P(PSJSYSW0,"^",8),FT=$P(PSJSYSW0,"^",9)
"RTN","PSGMAR0",174,0)
 E  S ST="0001",FT=24
"RTN","PSGMAR0",175,0)
SET S PSGMARSD=$E(ST,1,2),PSGMARFD=$E(FT,1,2) S:'PSGMARSD PSGMARSD="01" S PSGMARFD=$S(+PSGMARSD=1:24,PSGMARSD=PSGMARFD:PSGMARSD-1,1:PSGMARFD) S:$L(PSGMARFD)<2 PSGMARFD=0_PSGMARFD
"RTN","PSGMAR0",176,0)
 I ST>1 S X1=$P(PSGPLF,"."),X2=1 D C^%DTC S PSGPLF=X
"RTN","PSGMAR0",177,0)
 S PSGPLS=+(PSGPLS_"."_ST),PSGPLF=+(PSGPLF_"."_FT)
"RTN","PSGMAR0",178,0)
 S PSGMARSP=$$ENDTC2^PSGMI(PSGPLS),PSGMARFP=$$ENDTC2^PSGMI(PSGPLF)
"RTN","PSGMAR0",179,0)
 Q
"RTN","PSGMAR1")
0^14^B8879806^B6611470
"RTN","PSGMAR1",1,0)
PSGMAR1 ;BIR/CML3-SORT ORDERS FOR 24 HOUR MAR ;22 JUL 96 / 7:06 AM
"RTN","PSGMAR1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,111,145**;16 DEC 97;Build 17
"RTN","PSGMAR1",3,0)
 ;
"RTN","PSGMAR1",4,0)
 ;
"RTN","PSGMAR1",5,0)
SP ; start print
"RTN","PSGMAR1",6,0)
 U IO S (LN1,LN2,PSGOP,PN,RB,WDN,TM)="",PSGLSTOP=1,$P(LN1,"-",133)="",$P(LN2,"-",126)=""
"RTN","PSGMAR1",7,0)
 K BLN S BLN(1)=$E(LN1,1,20),BLN(2)=" Indicate RIGHT (R)",BLN(3)=" or LEFT (L)",BLN(4)=" 1. DELTOID",BLN(5)=" 2. ABDOMEN",BLN(6)=" 3. ILIAC CREST",BLN(7)=" 4. GLUTEAL",BLN(8)=" 5. THIGH",BLN(9)="PRN: E=Effective",BLN(10)="     N=Not Effective"
"RTN","PSGMAR1",8,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PN=$O(^TMP($J,PN)) Q:PN=""  D P
"RTN","PSGMAR1",9,0)
 Q:(PSGSS="P")!(PSGSS="C")!(PSGSS="L") 
"RTN","PSGMAR1",10,0)
 F  S (PTM,TM)=$O(^TMP($J,TM)) Q:TM=""  F  S (PWDN,WDN)=$O(^TMP($J,TM,WDN)) Q:WDN=""  D
"RTN","PSGMAR1",11,0)
 . I PSGRBPPN="R" F  S (PRB,RB)=$O(^TMP($J,TM,WDN,RB)) Q:RB=""  F  S PN=$O(^TMP($J,TM,WDN,RB,PN)) Q:PN=""  S PPN=^(PN) D PI,^PSGMAR2
"RTN","PSGMAR1",12,0)
 ;
"RTN","PSGMAR1",13,0)
 ;DAM 5-01-07 - rewrite above lines to utilize the ^XTMP global set up in PSGMAR0 for printing by WARD/PATIENT or WARD GROUP
"RTN","PSGMAR1",14,0)
 I PSGRBPPN="P" F  S (PTM,TM)=$O(^XTMP(PSGREP,TM)) Q:TM=""  F  S PN=$O(^XTMP(PSGREP,TM,PN)) Q:PN=""  D
"RTN","PSGMAR1",15,0)
 . F  S (PWDN,WDN)=$O(^XTMP(PSGREP,TM,PN,WDN)) Q:WDN=""  D
"RTN","PSGMAR1",16,0)
 . . F  S (PRB,RB)=$O(^XTMP(PSGREP,TM,PN,WDN,RB)) Q:RB=""  S PPN=^(RB) D PI,^PSGMAR2
"RTN","PSGMAR1",17,0)
 Q
"RTN","PSGMAR1",18,0)
 ;
"RTN","PSGMAR1",19,0)
P ;
"RTN","PSGMAR1",20,0)
 ;
"RTN","PSGMAR1",21,0)
 N TMPPWDN
"RTN","PSGMAR1",22,0)
 I PSGMARB=1 S PPN=^TMP($J,PN),PWDN=$S(PSGSS="C":$G(PSGAPWDN),1:$P(PPN,U,19)),PRB=$S(PSGSS="C":"",1:$P(PPN,U,20)),PTM="zz" D PI,^PSGMAR2 Q
"RTN","PSGMAR1",23,0)
 S TMPPWDN=$P(^TMP($J,PN),U,19)
"RTN","PSGMAR1",24,0)
 S:TMPPWDN="" TMPPWDN="zz"
"RTN","PSGMAR1",25,0)
 S PWDN=""
"RTN","PSGMAR1",26,0)
 F  S PWDN=$O(^TMP($J,PN,PWDN)) Q:PWDN=""  S TMPPWDN=PWDN S PPN=^TMP($J,PN),PRB=$P(PPN,U,20),PTM="zz" D PI,^PSGMAR2 S PWDN=TMPPWDN
"RTN","PSGMAR1",27,0)
 Q
"RTN","PSGMAR1",28,0)
 ;
"RTN","PSGMAR1",29,0)
PI ; Parses patient information.  Does not contain medication info.
"RTN","PSGMAR1",30,0)
 K PSGMPG,PSGMPGN
"RTN","PSGMAR1",31,0)
 S:PTM="zz" PTM="NOT FOUND" S:PWDN="zz" PWDN="NOT FOUND" S:PRB="zz" PRB="NOT FOUND"
"RTN","PSGMAR1",32,0)
 S (PSGOP,PSGP)=+$P(PN,U,2),PSGP(0)=$P(PN,U),BD=$P(PPN,U,2),PSSN=$P(PPN,U,3),DX=$P(PPN,U,4),WT=$P(PPN,U,5)_" "_$P(PPN,U,6)
"RTN","PSGMAR1",33,0)
 S HT=$P(PPN,U,7)_" "_$P(PPN,U,8),AD=$P(PPN,U,9),TD=$P(PPN,U,10),PSEX=$P(PPN,U,11),PSGLWD=$P(PPN,U,12)
"RTN","PSGMAR1",34,0)
 S PSGPLS=$P(PPN,U,13),PSGPLF=$P(PPN,U,14),PSGMARSD=$P(PPN,U,15),PSGMARFD=$P(PPN,U,16),PSGMARSP=$P(PPN,U,17),PSGMARFP=$P(PPN,U,18)
"RTN","PSGMAR1",35,0)
 S PPN=$P(PPN,U),PAGE=$P(BD,";",2),BD=$P(BD,";"),DFN=PSGP
"RTN","PSGMAR1",36,0)
 D ATS^PSJMUTL(115,117,1)
"RTN","PSGMAR1",37,0)
 Q
"RTN","PSGMAR2")
0^15^B12705829^B12031682
"RTN","PSGMAR2",1,0)
PSGMAR2 ;BIR/CML3-PRINT 24 HOUR MAR(UD) ;14 Oct 98 / 4:28 PM
"RTN","PSGMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMAR2",3,0)
 ;
"RTN","PSGMAR2",4,0)
S1 I PSGMARB'=2 S:PSGMARS'=2 (PST,OPST)="C" D:PSGMARS'=2 HEADER^PSGMAR3,BOT^PSGMAR3 S:PSGMARS'=1 (PST,OPST)="P" D:PSGMARS'=1 HEADER^PSGMAR3,BOT^PSGMAR3 Q:PSGMARB=1
"RTN","PSGMAR2",5,0)
 D NOW^%DTC S PSGDT=%,(PST,OPST)=""
"RTN","PSGMAR2",6,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMAR2",7,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") D P Q
"RTN","PSGMAR2",8,0)
 D W
"RTN","PSGMAR2",9,0)
 Q
"RTN","PSGMAR2",10,0)
 ;
"RTN","PSGMAR2",11,0)
P ;***Print on Patient order
"RTN","PSGMAR2",12,0)
 ;
"RTN","PSGMAR2",13,0)
 ;
"RTN","PSGMAR2",14,0)
 I $O(^TMP($J,PN,PWDN,0))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",15,0)
 F  S PST=$O(^TMP($J,PN,PWDN,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",16,0)
 . F  S DAO=$O(^TMP($J,PN,PWDN,PST,DAO)) Q:DAO=""  S PSGMARTS=^TMP($J,PN,PWDN,PST,DAO) D PRT
"RTN","PSGMAR2",17,0)
 I $O(^TMP($J,PN,PWDN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",18,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",19,0)
 Q
"RTN","PSGMAR2",20,0)
 ;
"RTN","PSGMAR2",21,0)
W ;***Print Ward/Ward group
"RTN","PSGMAR2",22,0)
 ;DAM 5-01-07  Utilize the XTMP global while reverses patient name and location
"RTN","PSGMAR2",23,0)
 I $S(PSGRBPPN="P":$O(^XTMP(PSGREP,TM,PN,WDN,RB,0)),1:$O(^TMP($J,TM,WDN,RB,PN,0)))'["C" S (PST,OPST)="C" D HEADER^PSGMAR3,BOT^PSGMAR3 S (PST,OPST)=""
"RTN","PSGMAR2",24,0)
 ;
"RTN","PSGMAR2",25,0)
 D:PSGRBPPN="P" PPN D:PSGRBPPN="R" RB
"RTN","PSGMAR2",26,0)
 Q
"RTN","PSGMAR2",27,0)
 ;
"RTN","PSGMAR2",28,0)
PPN ;***Sort by Patient
"RTN","PSGMAR2",29,0)
 ;
"RTN","PSGMAR2",30,0)
 ;DAM - 5-01-07 Utilize the XTMP global set up in PSGMAR0 when printing by WARD/PATIENT or WARD GROUP/PATIENT 
"RTN","PSGMAR2",31,0)
 F  S PST=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",32,0)
 . F  S DAO=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",33,0)
 I $O(^XTMP(PSGREP,TM,PN,WDN,RB,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",34,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",35,0)
 ;
"RTN","PSGMAR2",36,0)
 Q
"RTN","PSGMAR2",37,0)
 ;
"RTN","PSGMAR2",38,0)
RB ;***Sort by Room bed
"RTN","PSGMAR2",39,0)
 F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  D:$E(OPST)'=$E(PST) BOT^PSGMAR3:OPST]"",HEADER^PSGMAR3 S OPST=PST,DAO="" D
"RTN","PSGMAR2",40,0)
 . F  S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMAR2",41,0)
 I $O(^TMP($J,TM,WDN,RB,PN,"CV6"))="" D BOT^PSGMAR3 S (PST,OPST)="O" D HEADER^PSGMAR3
"RTN","PSGMAR2",42,0)
 S PSGMPGN="LAST PAGE: " D BOT^PSGMAR3
"RTN","PSGMAR2",43,0)
 Q
"RTN","PSGMAR2",44,0)
 ;
"RTN","PSGMAR2",45,0)
PRT ; order info
"RTN","PSGMAR2",46,0)
 NEW MARLB,DRUGNAME,NAME
"RTN","PSGMAR2",47,0)
 S ON=$P(DAO,U,2) D ONHOLD^PSGMMAR2
"RTN","PSGMAR2",48,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMIV Q
"RTN","PSGMAR2",49,0)
 D:PSGMAROC>5 ENB^PSGMAR3,HEADER^PSGMAR3 I PST["V" D PRT^PSGMIV Q
"RTN","PSGMAR2",50,0)
 S TMSTR=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI,TS^PSGMAR3(PSGMARTS),MARLB^PSGMUTL(47)
"RTN","PSGMAR2",51,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",52,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",53,0)
 NEW PSGX F PSGX=1:1:MARLB W !,MARLB(PSGX) W:PST["C" ?48,"|",$G(TS(PSGX)) D PRT2
"RTN","PSGMAR2",54,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMAR2",55,0)
 Q
"RTN","PSGMAR2",56,0)
PRT2 ;
"RTN","PSGMAR2",57,0)
 W ?55,"|"
"RTN","PSGMAR2",58,0)
 I PSGX=3,(PST'["Z"),(PST["C") D TMSTR^PSGMAR3
"RTN","PSGMAR2",59,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMAR2",60,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMAR2",61,0)
 . D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMAR2",62,0)
 I PSGX#6=0 W:PSGMAROC<6 !?7,LN2 S:PSGX'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMAR2",63,0)
 Q
"RTN","PSGMIV")
0^4^B47833428^B28210747
"RTN","PSGMIV",1,0)
PSGMIV ;BIR/MV-IV ORDER FOR THE 24 HOUR MAR. ;25 Nov 98 / 9:07 AM
"RTN","PSGMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,20,21,28,58,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMIV",3,0)
 ;
"RTN","PSGMIV",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMIV",5,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMIV",6,0)
 ;
"RTN","PSGMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMIV",8,0)
 S ON=""
"RTN","PSGMIV",9,0)
 F PSGMARED=PSGPLS-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMIV",10,0)
 Q
"RTN","PSGMIV",11,0)
IV ;*** Sort IV orders for 24 Hrs MAR.
"RTN","PSGMIV",12,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMIV",13,0)
 Q:P(2)>PSGPLF
"RTN","PSGMIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMIV",16,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMIV",17,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMIV",18,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMIV",19,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_ON_"V" D
"RTN","PSGMIV",20,0)
 . N A
"RTN","PSGMIV",21,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMIV",22,0)
 . . N X,X1,Y
"RTN","PSGMIV",23,0)
 . . D SPN^PSGMAR0
"RTN","PSGMIV",24,0)
 . . Q
"RTN","PSGMIV",25,0)
 . . ;
"RTN","PSGMIV",26,0)
 . I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q                         ;DAM 5-01-07 Print by PATIENT
"RTN","PSGMIV",27,0)
 . I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q     ;DAM 5-01-07 Print by clinic group
"RTN","PSGMIV",28,0)
 . I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""  Q    ;DAM 5-01-07 Print by Clinic
"RTN","PSGMIV",29,0)
 . ;
"RTN","PSGMIV",30,0)
 . ;DAM 5-01-07 Set up XTMP global where location and patient names are switched
"RTN","PSGMIV",31,0)
 . I '$G(PSGREP) N PSGDEM1 S PSGDEM1=X D   ;transfer contents of patient drug information contained in "X" above to a new variable temporarily
"RTN","PSGMIV",32,0)
 . . S PSGREP="PSGM_"_$J
"RTN","PSGMIV",33,0)
 . . S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMIV",34,0)
 . . S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMIV",35,0)
 . I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D         ;Construct XTMP global for printing by WARD and sort by PATIENT
"RTN","PSGMIV",36,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMIV",37,0)
 . . D SPN^PSGMAR0
"RTN","PSGMIV",38,0)
 . I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP and sort by PATIENT
"RTN","PSGMIV",39,0)
 . .  S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMIV",40,0)
 . .  D SPN^PSGMAR0
"RTN","PSGMIV",41,0)
 . S X=$G(PSGDEM1)
"RTN","PSGMIV",42,0)
 . ;END DAM
"RTN","PSGMIV",43,0)
 . ;
"RTN","PSGMIV",44,0)
 . I PSGRBPPN="R",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct TMP global for printing by WARD and sort by ROOM/BED
"RTN","PSGMIV",45,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",46,0)
 . I PSGRBPPN="R",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D      ;Construct TMP global for printing by WARD GROUP and sort by ROOM/BED
"RTN","PSGMIV",47,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMIV",48,0)
 . ;
"RTN","PSGMIV",49,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMIV",50,0)
 ;
"RTN","PSGMIV",51,0)
 Q
"RTN","PSGMIV",52,0)
PRT ;*** Print IV orders.
"RTN","PSGMIV",53,0)
 K TS,P,DRG NEW ON55,LN,PSJLABEL S PSJLABEL=1
"RTN","PSGMIV",54,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:ON["V" GT55^PSIVORFB
"RTN","PSGMIV",55,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMIV",56,0)
 S TS=1,TMSTR="" I P(9)]"" D ORSET,TS^PSGMAR3(P(11))
"RTN","PSGMIV",57,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMIV",58,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMIV",59,0)
 S PSGLFFD=PSGPLF
"RTN","PSGMIV",60,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMIV",61,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMIV",62,0)
 D LNNEED,PRTIV
"RTN","PSGMIV",63,0)
 Q
"RTN","PSGMIV",64,0)
LNNEED ;*** Find lines needed per label.
"RTN","PSGMIV",65,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMIV",66,0)
 ;*** Add number of lines needed for additives and solutions and 1 line
"RTN","PSGMIV",67,0)
 ;*** for infusion rate and x line for OPI. Divide by 5 to determine
"RTN","PSGMIV",68,0)
 ;*** of label(s) needed for this order.
"RTN","PSGMIV",69,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMIV",70,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMIV",71,0)
 S X=(NAMENEED+X+2) S X=$S(X<6:1,1:((X-6)\5)+2)
"RTN","PSGMIV",72,0)
 S LN=$S(TS/6>X:TS/6,1:X)
"RTN","PSGMIV",73,0)
 Q
"RTN","PSGMIV",74,0)
 ;
"RTN","PSGMIV",75,0)
OS ; order record set
"RTN","PSGMIV",76,0)
 Q
"RTN","PSGMIV",77,0)
 ;
"RTN","PSGMIV",78,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMIV",79,0)
 D ONHOLD^PSGMMAR2
"RTN","PSGMIV",80,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMAR3,HEADER^PSGMAR3
"RTN","PSGMIV",81,0)
 NEW PSGL S PSGL="|"
"RTN","PSGMIV",82,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,PSGL,$G(TS(1)),?55,"|"
"RTN","PSGMIV",83,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMIV",84,0)
 I ON["V" D
"RTN","PSGMIV",85,0)
 . I $G(ONHOLD) W "O N  H O L D" Q
"RTN","PSGMIV",86,0)
 . W $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMIV",87,0)
 . Q
"RTN","PSGMIV",88,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMIV",89,0)
 W ?39,"(",$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMIV",90,0)
 W ?48,PSGL,$G(TS(2)),?55,"|" S L=3
"RTN","PSGMIV",91,0)
 NEW NAME,PSIVX
"RTN","PSGMIV",92,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("AD",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("AD",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:(PSIVX=1&((PSGST="O")!(PSGST="C"))) TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",93,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMIV",94,0)
 NEW PSJPRT2
"RTN","PSGMIV",95,0)
 F PSIVX=0:0 S PSIVX=$O(DRG("SOL",PSIVX)) Q:'PSIVX  D NAME^PSIVUTL(DRG("SOL",PSIVX),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMIV",96,0)
 . W:(Y>1!(PSIVX>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",97,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",PSIVX),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,PSGL,$G(TS(L)),?55,"|" D:L=3 TMSTR^PSGMAR3 D L(1)
"RTN","PSGMIV",98,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,PSGL,$G(TS(L)),?55,"|" I L>5,(L#5) W !
"RTN","PSGMIV",99,0)
 I '$O(DRG("AD",0))!('$O(DRG("SOL",0))) W !?48,PSGL,$G(TS(L)),?55,"|" S L=5
"RTN","PSGMIV",100,0)
 I P(4)="C",'(L#5),P("OPI")="" W !,"*CAUTION-CHEMOTHERAPY*" S L=L+1 Q
"RTN","PSGMIV",101,0)
 I P(4)="C" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",102,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMIV",103,0)
 E  D L(1)
"RTN","PSGMIV",104,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMIV",105,0)
 I P("OPI")'="" D
"RTN","PSGMIV",106,0)
 . W:(L#6)=0 !
"RTN","PSGMIV",107,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D  W Y1," "
"RTN","PSGMIV",108,0)
 . I ($X+$L(Y1))>47 W ?48,PSGL,$G(TS(L)),?55,"|" D L(1) W !
"RTN","PSGMIV",109,0)
 I L>TS,(L#6) W ?48,PSGL,$G(TS(L)),?55,"|" S L=L+1 W:L#6=0 !
"RTN","PSGMIV",110,0)
 I (TS-1)>L W ?48,PSGL,$G(TS(L)),?55,"|" D
"RTN","PSGMIV",111,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,PSGL,$G(TS(L)),?55,"|"
"RTN","PSGMIV",112,0)
 . S L=L+1
"RTN","PSGMIV",113,0)
 F  Q:'(L#6)  W !?48,PSGL,$G(TS(L)),?55,"|" S L=L+1
"RTN","PSGMIV",114,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMIV",115,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMIV",116,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2
"RTN","PSGMIV",117,0)
 Q
"RTN","PSGMIV",118,0)
 ;
"RTN","PSGMIV",119,0)
L(X) ;***Check to see if a new block is needed.
"RTN","PSGMIV",120,0)
 S L=L+X
"RTN","PSGMIV",121,0)
 I L#6=0,PSGMAROC<6 W !,"See next label for continuation",?48,PSGL,$G(TS(L)),?55,"|" W:PSGMAROC<6 !?7,LN2 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMIV",122,0)
 .I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMAR3,HEADER^PSGMAR3 S PSGMAROC=1
"RTN","PSGMIV",123,0)
 Q
"RTN","PSGMIV",124,0)
ORSET ; order record set
"RTN","PSGMIV",125,0)
 Q:PST["P"!P(9)=""
"RTN","PSGMIV",126,0)
 S PSGMFOR="",(SD,X)=$P(P(2),".") Q:X>PSGPLF  S FD=$P(P(3),"."),PSGOES="",X=P(9) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMIV",127,0)
 S X="" I "OB"]PST,$P(P(9),"^")'["@",P(2)'>PSGPLS,P(3)'<PSGPLF,P(11),T<1441,T'="D" S X=P(11),PSGPLC=1
"RTN","PSGMIV",128,0)
 E  I "OB"]PST!(PST["OV") K PSGMAR D SETL0 S (Q,X)="" F QX=0:0 S Q=$O(PSGMAR(Q)) Q:Q=""  S X=X_$E("0",2-$L(Q))_Q_"-"
"RTN","PSGMIV",129,0)
 S TMSTR=X
"RTN","PSGMIV",130,0)
 K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGMIV",131,0)
 Q
"RTN","PSGMIV",132,0)
SETL0 ;*** Set variable to use in ^PSGPL0 to calculate admin time.
"RTN","PSGMIV",133,0)
 K PSGMAR S PSGPLC=0
"RTN","PSGMIV",134,0)
 S ND1=P(4),ST=P(2),PLSD=P(3),TS=P(11),MN=T,ND=P(9) I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGMIV",135,0)
 D ENIV^PSGPL0
"RTN","PSGMIV",136,0)
 Q
"RTN","PSGMIV",137,0)
 ;
"RTN","PSGMIV",138,0)
RPHINIT(RPH) ; Find initial for the person who completed the IV order.
"RTN","PSGMIV",139,0)
 S RPH=$P($G(^PS(55,PSGP,"IV",+ON,4)),U,4)
"RTN","PSGMIV",140,0)
 S:+RPH RPH=$$DEFINIT(+RPH)
"RTN","PSGMIV",141,0)
 I RPH="" S RPH="_____"
"RTN","PSGMIV",142,0)
 Q
"RTN","PSGMIV",143,0)
DEFINIT(X)         ;
"RTN","PSGMIV",144,0)
 S X=$G(^VA(200,X,0)),RPH=$P(X,U,2) Q:RPH]"" RPH
"RTN","PSGMIV",145,0)
 S X=$P(X,U),RPH=$E(X,$F(X,","))_$E(X) Q RPH
"RTN","PSGMMAR")
0^16^B27316363^B25479504
"RTN","PSGMMAR",1,0)
PSGMMAR ;BIR/CML3-MULTIPLE DAY MARS - MAIN DRIVER ;14 Oct 98 / 4:28 PM
"RTN","PSGMMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,110,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMMAR",3,0)
 F  R !!,"HOW MANY DAYS? (7/14) ",PSGMARDF:DTIME S:'$T PSGMARDF="^" Q:"^"[PSGMARDF  Q:PSGMARDF=7!(PSGMARDF=14)  W $C(7),"  7 OR 14 DAY MAR!!"
"RTN","PSGMMAR",4,0)
 G:"^"[PSGMARDF DONE G EN
"RTN","PSGMMAR",5,0)
 ;
"RTN","PSGMMAR",6,0)
EN7 ;
"RTN","PSGMMAR",7,0)
 S PSGMARDF=7 G EN
"RTN","PSGMMAR",8,0)
 ;
"RTN","PSGMMAR",9,0)
EN14 ;
"RTN","PSGMMAR",10,0)
 S PSGMARDF=14
"RTN","PSGMMAR",11,0)
 ;
"RTN","PSGMMAR",12,0)
EN ;
"RTN","PSGMMAR",13,0)
 NEW DRUGNAME,F,MARLB,NAME,UP,PSGOP
"RTN","PSGMMAR",14,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE K PSGMAROF
"RTN","PSGMMAR",15,0)
 ;
"RTN","PSGMMAR",16,0)
EN1 ;
"RTN","PSGMMAR",17,0)
 D MARFORM^PSGMUTL G:'PSGMARB DONE
"RTN","PSGMMAR",18,0)
 ;
"RTN","PSGMMAR",19,0)
ENOE ;
"RTN","PSGMMAR",20,0)
 D SD^PSGMMARH W ! D ^DIR K DIR,DTOUT,DUOUT,DIRUT,DIROUT G:"^"[$E(Y) DONE S PSGMARS=$F("CPBO",Y)-1
"RTN","PSGMMAR",21,0)
 ;
"RTN","PSGMMAR",22,0)
DATE ;
"RTN","PSGMMAR",23,0)
 S %DT="ETSX",Y=-1 F  W !!,"Enter START DATE/TIME for "_PSGMARDF_" day MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH^PSGMMARH D ^%DT Q:Y>0
"RTN","PSGMMAR",24,0)
 I Y'>0 W $C(7),!!?5,"(No date selected, or MAR run.)" G DONE
"RTN","PSGMMAR",25,0)
 S PSGMARSD=+Y,X1=$P(+Y,"."),X2=PSGMARDF-1 D C^%DTC S PSGMARFD=X
"RTN","PSGMMAR",26,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGRBPPN="",PSGMARWD=+$G(PSJPWD)
"RTN","PSGMMAR",27,0)
 I '$G(PSGMAROF),'$G(PSGOENOF)!($G(PSGSS)="") S (PSGP,PSGPAT,PSGMARWD)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMMAR",28,0)
 I PSGMARB'=1 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMMAR",29,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMMAR",30,0)
 ;
"RTN","PSGMMAR",31,0)
ENQ ; when queued
"RTN","PSGMMAR",32,0)
 N DRGI,DRGN,DRGT,LN,P,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMMAR",33,0)
 D ^PSGMMAR0 I $D(^TMP($J))>9 D ^PSGMMAR1 K ^TMP($J)
"RTN","PSGMMAR",34,0)
 ;DAM 5-01-07
"RTN","PSGMMAR",35,0)
 I $D(PSGREP) K ^XTMP(PSGREP)
"RTN","PSGMMAR",36,0)
 ;END DAM
"RTN","PSGMMAR",37,0)
 D ^%ZISC G DONE
"RTN","PSGMMAR",38,0)
 ;
"RTN","PSGMMAR",39,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMMAR",40,0)
DONE ;
"RTN","PSGMMAR",41,0)
 I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU
"RTN","PSGMMAR",42,0)
 K:'$D(PSGVBY) PSGSS,PSGSSH
"RTN","PSGMMAR",43,0)
 D ENKV^PSGLOI
"RTN","PSGMMAR",44,0)
 K AD,ASTERS,BD,BLN,CNTR,DA1,DA2,DAO,DIC,DRG,DX,EXPIRE,FD,HX,L,LN1,LN14,LN2,LN3,LN31,LN32,LN4,LN5,LN6,LN7
"RTN","PSGMMAR",45,0)
 K MOS,MSG1,MSG2,N,ND2,NAMENEED,NEED,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGMAPA,PSGMAPB,PSGMAPC,PSGMAPD,PSGADR,PSGALG,PSGS0Y,PSGXDT
"RTN","PSGMMAR",46,0)
 K PSGD,PSGDW,PSGMAR,PSGMARB,PSGMARDF,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMAROF,PSGMARPT,PSGMARS,PSGMARSD,PSGMARSM,PSGMARSP
"RTN","PSGMMAR",47,0)
 K PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMMAR",48,0)
 K DFN,NG,NO,ON,PST,PTM,PWDN,QST,PSJACNWP,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1
"RTN","PSGMMAR",49,0)
 K PSJSTOP,PSJPWDO,PSGMARO,PSGMTYPE,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGPG
"RTN","PSGMMAR",50,0)
 K HT,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDESC,ONHOLD
"RTN","PSGMMAR",51,0)
 Q
"RTN","PSGMMAR",52,0)
 ;
"RTN","PSGMMAR",53,0)
G ;
"RTN","PSGMMAR",54,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMMAR",55,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMMAR",56,0)
 . S PSGMARWG=+Y
"RTN","PSGMMAR",57,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMMAR",58,0)
 D RBPPN^PSJMDIR
"RTN","PSGMMAR",59,0)
 Q
"RTN","PSGMMAR",60,0)
 ;
"RTN","PSGMMAR",61,0)
W ;
"RTN","PSGMMAR",62,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",63,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR S Y=PSGMARWD
"RTN","PSGMMAR",64,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMMAR",65,0)
 Q
"RTN","PSGMMAR",66,0)
 ;
"RTN","PSGMMAR",67,0)
P ;
"RTN","PSGMMAR",68,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMMAR",69,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMMAR",70,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMMAR",71,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMMAR",72,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMMAR",73,0)
 Q
"RTN","PSGMMAR",74,0)
 ;
"RTN","PSGMMAR",75,0)
C ;
"RTN","PSGMMAR",76,0)
 ;DAM 5-01-07 Add new variable to hold numerical value of CLINIC
"RTN","PSGMMAR",77,0)
 S PSGCLNC=""
"RTN","PSGMMAR",78,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGMMAR",79,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",80,0)
CDIC ;
"RTN","PSGMMAR",81,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y S PSGCLNC=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",82,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGMMAR",83,0)
 Q
"RTN","PSGMMAR",84,0)
L ;
"RTN","PSGMMAR",85,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGMMAR",86,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGMMAR",87,0)
LDIC ;
"RTN","PSGMMAR",88,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",89,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGMMAR",90,0)
 Q
"RTN","PSGMMAR",91,0)
DEV ;
"RTN","PSGMMAR",92,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMMAR",ZTDESC=PSGMARDF_" DAY MAR" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARSD","PSGMARFD","PSGSS","PSGMARB","PSGMARDF","PSGMARS","PSGINCL","PSGINCLG","PSGINWD","PSGINWDG" S ZTSAVE(X)=""
"RTN","PSGMMAR",93,0)
 F X="PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMMAR",94,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMMAR",95,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for "_PSGMARDF_" day MAR run." W:$D(ZTSK) !?3,PSGMARDF_" Day MAR Queued!" K ZTSK Q
"RTN","PSGMMAR",96,0)
 I 'IO("Q") U IO
"RTN","PSGMMAR",97,0)
 ;
"RTN","PSGMMAR",98,0)
ENOR S PSGP=+ORVP
"RTN","PSGMMAR",99,0)
ENLM ;
"RTN","PSGMMAR",100,0)
 NEW VADM
"RTN","PSGMMAR",101,0)
 D ENCV^PSGSETU I $D(QUIT) K PSGMARDF Q
"RTN","PSGMMAR",102,0)
 D ^PSJAC S PSGPAT=1,PSGPAT(PSGP)="",PSGMAROF=1,PSGSS="P" G EN1
"RTN","PSGMMAR0")
0^17^B68830195^B36138021
"RTN","PSGMMAR0",1,0)
PSGMMAR0 ;BIR/CML3-GATHERS INFO FOR MD CMR ;14 Oct 98 / 9:40 AM
"RTN","PSGMMAR0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,15,20,111,145**;16 DEC 97;Build 17
"RTN","PSGMMAR0",3,0)
 ;
"RTN","PSGMMAR0",4,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMAR0",5,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMMAR0",6,0)
 ;
"RTN","PSGMMAR0",7,0)
ENQ ; start sort; where queue comes in at
"RTN","PSGMMAR0",8,0)
 N SUB1,SUB2 S (SUB1,SUB2)=""
"RTN","PSGMMAR0",9,0)
 S PSGMSORT=$P($G(^PS(59.7,1,26)),U,4)
"RTN","PSGMMAR0",10,0)
 K PSGD S X=$P(PSGMARSD,"."),PSGDW="" F Q=0:1:PSGMARDF-1 S X1=$P(PSGMARSD,"."),X2=Q D:Q C^%DTC S PSGD(X)=$E(X,4,5)_"/"_$E(X,6,7),HX=X D DW^%DTC S $P(PSGD(HX),U,2)=X
"RTN","PSGMMAR0",11,0)
 K ^TMP($J) D NOW^%DTC S PSGDT=%,PSGMARWN="",PSJACNWP=1 D @("G"_PSGSS)
"RTN","PSGMMAR0",12,0)
 ;* K ^TMP($J),PSJACNWP D NOW^%DTC S PSGDT=%,PSGMARWN="" D @("G"_PSGSS)
"RTN","PSGMMAR0",13,0)
 I $D(^TMP($J))<10 U IO W:$Y @IOF W !!,"(No data found for "_PSGMARDF_" day MAR run.)"
"RTN","PSGMMAR0",14,0)
 ;
"RTN","PSGMMAR0",15,0)
DONE ;
"RTN","PSGMMAR0",16,0)
 Q
"RTN","PSGMMAR0",17,0)
 ;
"RTN","PSGMMAR0",18,0)
GG ; find individual wards in this ward group
"RTN","PSGMMAR0",19,0)
 S ^TMP($J)=PSGMARWG F PSGMARWD=0:0 S PSGMARWD=$O(^PS(57.5,"AC",PSGMARWG,PSGMARWD)) Q:'PSGMARWD  D GW
"RTN","PSGMMAR0",20,0)
 Q
"RTN","PSGMMAR0",21,0)
 ;
"RTN","PSGMMAR0",22,0)
GW ; find patients in each ward
"RTN","PSGMMAR0",23,0)
 I $D(^DIC(42,PSGMARWD,0)),$P(^(0),U)]"" S PSGMARWN=$P(^(0),U)
"RTN","PSGMMAR0",24,0)
 E  Q
"RTN","PSGMMAR0",25,0)
 I 'PSGMARWG S PSGMARWG=+$O(^PS(57.5,"AB",PSGMARWD,0))
"RTN","PSGMMAR0",26,0)
 I $D(^TMP($J))[0,PSGMARWG S ^($J)=PSGMARWG
"RTN","PSGMMAR0",27,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGMARWN,PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1) I PSGMARB!$O(^PS(55,PSGP,5,"AUS",PSGMARSD))!$O(^PS(55,PSGP,"IV","AIS",PSGMARSD)) D GPI
"RTN","PSGMMAR0",28,0)
 Q
"RTN","PSGMMAR0",29,0)
 ;
"RTN","PSGMMAR0",30,0)
GP ; go thru selected patients
"RTN","PSGMMAR0",31,0)
 F PSGP=0:0 S PSGP=$O(PSGPAT(PSGP)) Q:'PSGP  D PSJAC2^PSJAC(1) I PSGMARB!$O(^PS(55,PSGP,5,"AUS",PSGMARSD))!$O(^PS(55,PSGP,"IV","AIS",PSGMARSD)) D GPI
"RTN","PSGMMAR0",32,0)
 Q
"RTN","PSGMMAR0",33,0)
 ;
"RTN","PSGMMAR0",34,0)
GL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D GC
"RTN","PSGMMAR0",35,0)
 Q
"RTN","PSGMMAR0",36,0)
GC S PSGAPWDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGMMAR0",37,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1)
"RTN","PSGMMAR0",38,0)
 S PSGCAD=PSGMARSD
"RTN","PSGMMAR0",39,0)
 F  S PSGCAD=$O(^PS(55,"AIVC",PSGCAD)) Q:PSGCAD=""  D
"RTN","PSGMMAR0",40,0)
 . S PSGP=0
"RTN","PSGMMAR0",41,0)
 . F  S PSGP=$O(^PS(55,"AIVC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1) D GPI
"RTN","PSGMMAR0",42,0)
 S PSGCAD=PSGMARSD
"RTN","PSGMMAR0",43,0)
 F  S PSGCAD=$O(^PS(55,"AUDC",PSGCAD)) Q:PSGCAD=""  D
"RTN","PSGMMAR0",44,0)
 . S PSGP=0
"RTN","PSGMMAR0",45,0)
 . F  S PSGP=$O(^PS(55,"AUDC",PSGCAD,CL,PSGP)) Q:PSGP=""  D PSJAC2^PSJAC(1) D GPI
"RTN","PSGMMAR0",46,0)
 Q
"RTN","PSGMMAR0",47,0)
 ;
"RTN","PSGMMAR0",48,0)
GPI ; get patient info
"RTN","PSGMMAR0",49,0)
 ; PSGTMALL=1(sort by all team), PSGTM=1(individual team(S) selected).
"RTN","PSGMMAR0",50,0)
 S TM="" S:PSGSS="P"!(PSGSS="C")!(PSGSS="L") PSGMARWN=$S(PSJPWDN]"":PSJPWDN,1:"NOT FOUND")
"RTN","PSGMMAR0",51,0)
 S:PSJPRB="" PSJPRB="zz"
"RTN","PSGMMAR0",52,0)
 S:"GPCL"[PSGSS!('$G(PSGTM)&'$G(PSGTMALL)) TM="zz"
"RTN","PSGMMAR0",53,0)
 S:$G(TM)="" TM=$S(PSJPRB="zz":0,1:+$O(^PS(57.7,"AWRT",PSGMARWD,PSJPRB,0))),TM=$S('TM:"zz",'$D(^PS(57.7,PSGMARWD,1,TM,0)):TM,$P(^(0),U)]"":$P(^(0),U),1:TM)
"RTN","PSGMMAR0",54,0)
 Q:'$G(PSGTMALL)&$G(PSGTM)&'$D(PSGTM(TM))  ; Elimin. none selected team
"RTN","PSGMMAR0",55,0)
 S PPN=$E($P(PSGP(0),U),1,15)_U_PSGP
"RTN","PSGMMAR0",56,0)
 S:PSGRBPPN="P" SUB1=PPN,SUB2=PSJPRB S:PSGRBPPN="R" SUB1=PSJPRB,SUB2=PPN
"RTN","PSGMMAR0",57,0)
 I PSGMARB=1 D SPN Q
"RTN","PSGMMAR0",58,0)
 I PSGMTYPE[1 F XTYPE=2:1:6 D @XTYPE
"RTN","PSGMMAR0",59,0)
 I PSGMTYPE'[1 F XTYPE=2:1:6 D:PSGMTYPE[XTYPE @XTYPE
"RTN","PSGMMAR0",60,0)
 D ^PSGMMAR5
"RTN","PSGMMAR0",61,0)
 D:$S(PSGSS["P"!(PSGSS="L")!(PSGSS="C"):$D(^TMP($J,PPN)),1:$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2))) SPN
"RTN","PSGMMAR0",62,0)
 I $D(^TMP($J))'>10,(PSGMARB=3) D SPN
"RTN","PSGMMAR0",63,0)
 Q
"RTN","PSGMMAR0",64,0)
 ;
"RTN","PSGMMAR0",65,0)
2 ;Loop thru UD orders
"RTN","PSGMMAR0",66,0)
 ;DEM 04/19/2006
"RTN","PSGMMAR0",67,0)
 ;       Location variable PSGMARWC added to correctly rollup orders
"RTN","PSGMMAR0",68,0)
 ;       under location. The location can change if the UD order is
"RTN","PSGMMAR0",69,0)
 ;       assoicated with a clinic location. If the location changes
"RTN","PSGMMAR0",70,0)
 ;       under the aforementioned scenario, then PSGMARWC preserves
"RTN","PSGMMAR0",71,0)
 ;       the original value and is used to restore location to it's
"RTN","PSGMMAR0",72,0)
 ;       original value.
"RTN","PSGMMAR0",73,0)
 ;
"RTN","PSGMMAR0",74,0)
 N PSGMARWC
"RTN","PSGMMAR0",75,0)
 S PSGMARWC=PSGMARWN  ;DEM 04/19/2006 - Preserve original value of patients location. If location is changed, then restore to original value after call to OS.
"RTN","PSGMMAR0",76,0)
 I PSGMARS'=2 F PST="C" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMAR0",77,0)
 I PSGMARS'=1 F PST="O","OC","P" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMAR0",78,0)
 S PST="R" F PSGMARED=PSGMARSD:0 S PSGMARED=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED)) Q:'PSGMARED  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",PST,PSGMARED,ON)) Q:'ON  D OS S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMAR0",79,0)
 S PST="S" D ^PSGMMIV
"RTN","PSGMMAR0",80,0)
 Q
"RTN","PSGMMAR0",81,0)
3 ;Loop thru IV orders that are Piggy back and Syringes types.
"RTN","PSGMMAR0",82,0)
 F PST="P","S" D ^PSGMMIV
"RTN","PSGMMAR0",83,0)
 Q
"RTN","PSGMMAR0",84,0)
4 ;Loop thru IV orders(Admixtures).
"RTN","PSGMMAR0",85,0)
 S PST="A" D ^PSGMMIV
"RTN","PSGMMAR0",86,0)
 Q
"RTN","PSGMMAR0",87,0)
5 ;Loop thru IV orders(Hyperal).
"RTN","PSGMMAR0",88,0)
 S PST="H" D ^PSGMMIV
"RTN","PSGMMAR0",89,0)
 Q
"RTN","PSGMMAR0",90,0)
6 ;Loop thru IV order(Chemo).
"RTN","PSGMMAR0",91,0)
 S PST="C" D ^PSGMMIV
"RTN","PSGMMAR0",92,0)
 Q
"RTN","PSGMMAR0",93,0)
 ;
"RTN","PSGMMAR0",94,0)
OS ; order record set
"RTN","PSGMMAR0",95,0)
 N A
"RTN","PSGMMAR0",96,0)
 S ND2=$G(^PS(55,PSGP,5,ON,2)),SD=$P(ND2,U,2) I $S($P(SD,".")>PSGMARFD:1,PSGMARS=1:$P(ND2,U)["PRN",1:0) Q
"RTN","PSGMMAR0",97,0)
 S A=$G(^PS(55,PSGP,5,ON,8)) I $P(A,"^",1)]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D SPN
"RTN","PSGMMAR0",98,0)
 S FD=$P($P(ND2,U,4),"."),T=$P(ND2,U,6)
"RTN","PSGMMAR0",99,0)
 NEW MARX D DRGDISP^PSJLMUT1(PSGP,+ON_"U",20,0,.MARX,1) S DRG=MARX(1)_$E(SD,2,7)_U_+ON_"U"
"RTN","PSGMMAR0",100,0)
 S QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",$P(ND2,U)["PRN":"OR",1:"CR")
"RTN","PSGMMAR0",101,0)
 S QQ="" I QST["C" D DTS($P(ND2,U)) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSGMMAR0",102,0)
 I $P(ND2,U,6)="D",$P(ND2,U,5)="" S $P(ND2,U,5)=$E($P($P(ND2,U,2),".",2)_"0000",1,4)
"RTN","PSGMMAR0",103,0)
 S X=$S(QST["C"!(QST="O"):$P(ND2,U,5),1:"")_U_QQ
"RTN","PSGMMAR0",104,0)
 ;
"RTN","PSGMMAR0",105,0)
 ;
"RTN","PSGMMAR0",106,0)
 ;DAM 5-01-07 Add next line to include non-IV meds when printing by PATIENT and choosing to print "ALL MEDS"
"RTN","PSGMMAR0",107,0)
 I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X Q
"RTN","PSGMMAR0",108,0)
 ;
"RTN","PSGMMAR0",109,0)
 ;DAM 5-01-07  Add check to see if user wants to include ward orders when printing by CLINIC GROUP
"RTN","PSGMMAR0",110,0)
 I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X Q
"RTN","PSGMMAR0",111,0)
 ;
"RTN","PSGMMAR0",112,0)
 ;DAM 5-01-07 Add check to see if user wants to include ward orders when printing by CLINIC
"RTN","PSGMMAR0",113,0)
 I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) D  Q
"RTN","PSGMMAR0",114,0)
 . S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMMAR0",115,0)
 ;
"RTN","PSGMMAR0",116,0)
 Q:(PSGSS="L")!(PSGSS="C")
"RTN","PSGMMAR0",117,0)
 ;
"RTN","PSGMMAR0",118,0)
 ;DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by WARD GROUP
"RTN","PSGMMAR0",119,0)
 I PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMMAR0",120,0)
 ;
"RTN","PSGMMAR0",121,0)
 ;DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by WARD.
"RTN","PSGMMAR0",122,0)
 I (PSGSS="W") Q:((PSGINCL="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=X
"RTN","PSGMMAR0",123,0)
 ;
"RTN","PSGMMAR0",124,0)
 ;DAM 5-01-07  Add an XTMP global to swap location and patient name in the subscripts when printing MAR by WARD/PATIENT or WARD GROUP.
"RTN","PSGMMAR0",125,0)
 N PSGDEM S PSGDEM=X    ;transfer contents of patient drug information contained in "X" above to  a new variable temporarily
"RTN","PSGMMAR0",126,0)
 S PSGREP="PSGM_"_$J
"RTN","PSGMMAR0",127,0)
 S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMMAR0",128,0)
 S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMMAR0",129,0)
 I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct XTMP global for printing by WARD
"RTN","PSGMMAR0",130,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=PSGDEM
"RTN","PSGMMAR0",131,0)
 I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP
"RTN","PSGMMAR0",132,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=PSGDEM
"RTN","PSGMMAR0",133,0)
 S X=PSGDEM      ;transfer contents of patient drug information contained in PSGDEM back to X
"RTN","PSGMMAR0",134,0)
 ;End DAM modifications 5-01-07
"RTN","PSGMMAR0",135,0)
 Q
"RTN","PSGMMAR0",136,0)
 ;
"RTN","PSGMMAR0",137,0)
DTS(SCHEDULE) ;
"RTN","PSGMMAR0",138,0)
 K S S S=0 I SCHEDULE["@"!(T="D") S WD=$S(SCHEDULE["@":$P(SCHEDULE,"@"),1:SCHEDULE) F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  F QQ=1:1:$L(WD,"-") I $P($P(PSGD(Q),U,2),$P(WD,"-",QQ))="" S S(Q)="",S=S+1 Q
"RTN","PSGMMAR0",139,0)
 Q:SCHEDULE["@"!(T="D")  Q:T'>1440  S WD=$P(PSGMARSD,".") I '(T#1440) S (SD,X)=$P(SD,"."),PSGT=T\1440 F QQ=0:1 S X1=SD,X2=QQ*PSGT D:X2 C^%DTC I X'<WD S S=S+1 Q:X>PSGMARFD  Q:X>FD  S S(X)=""
"RTN","PSGMMAR0",140,0)
 K PSGT Q:'(T#1440)  S PSGT=T,X1=PSGMARSD,(ST,X2)=SD I PSGMARSD>SD D ^%DTC I X>1 S ST=$$EN^PSGCT(SD,X-1*1440\T*T)
"RTN","PSGMMAR0",141,0)
 S (PSGS,X)=ST F PSGX=0:1 S AM=PSGT*PSGX,ST=PSGS S:AM X=$$EN^PSGCT(ST,AM) S X=$P(X,".") I X'<WD Q:X>PSGMARFD  Q:X>FD  I '$D(S(X)) S S=S+1,S(X)=""
"RTN","PSGMMAR0",142,0)
 K AM,ST,PSGS,PSGT,PSGX Q
"RTN","PSGMMAR0",143,0)
 ;
"RTN","PSGMMAR0",144,0)
SPN ; set patient node
"RTN","PSGMMAR0",145,0)
 D DIET^PSGMAR0
"RTN","PSGMMAR0",146,0)
 S X=$P(PSGP(0),U)_U_$E($P(PSJPDOB,U,2),1,10)_";"_PSJPAGE_U_VA("PID")_U_PSJPDX_U_PSJPWT_U_PSJPWTD_U_PSJPHT_U_PSJPHTD_U_$P(PSJPAD,U,2)_U_$P(PSJPTD,U,2)_U_$P(PSJPSEX,U,2)_U_PSJPWD
"RTN","PSGMMAR0",147,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN)=X_U_PSGMARWN_U_PSJPRB Q
"RTN","PSGMMAR0",148,0)
 ;
"RTN","PSGMMAR0",149,0)
 ;DAM 5-01-07  Add check to see if user wants to include clinic orders when printing by ward.
"RTN","PSGMMAR0",150,0)
 I PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMMAR0",151,0)
 ;
"RTN","PSGMMAR0",152,0)
 ;DAM 5-01-07 Add check to see if user wants to include clinic orders when printing by ward group.
"RTN","PSGMMAR0",153,0)
 I PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  S ^TMP($J,TM,PSGMARWN,SUB1,SUB2)=X
"RTN","PSGMMAR0",154,0)
 ;
"RTN","PSGMMAR0",155,0)
 ;DAM 5-01-07  Add an XTMP global to reverse location and patient name in the subscripts when printing MAR by WARD/PATIENT or WARD GROUP. 
"RTN","PSGMMAR0",156,0)
 N PSGDEM S PSGDEM=X    ;transfer contents of patient demographics contained in "X" above to  a new variable temporarily
"RTN","PSGMMAR0",157,0)
 S PSGREP="PSGM_"_$J
"RTN","PSGMMAR0",158,0)
 S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMMAR0",159,0)
 S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMMAR0",160,0)
 I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D    ;Construct XTMP global for printing by WARD
"RTN","PSGMMAR0",161,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2)=PSGDEM
"RTN","PSGMMAR0",162,0)
 I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D   ;Construct XTMP global for printing by WARD GROUP
"RTN","PSGMMAR0",163,0)
 . S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2)=PSGDEM
"RTN","PSGMMAR0",164,0)
 S X=PSGDEM    ;transfer contents of patient demographics contained in PSGDEM back to X
"RTN","PSGMMAR0",165,0)
 ;End DAM modifications 5-01-07
"RTN","PSGMMAR0",166,0)
 Q
"RTN","PSGMMAR1")
0^18^B18809433^B16034896
"RTN","PSGMMAR1",1,0)
PSGMMAR1 ;BIR/CML3-PRINTS MD MAR ;12 Mar 98 / 9:33 AM
"RTN","PSGMMAR1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,8,92,111,145**;16 DEC 97;Build 17
"RTN","PSGMMAR1",3,0)
 ;
"RTN","PSGMMAR1",4,0)
 ;
"RTN","PSGMMAR1",5,0)
SP ; start print
"RTN","PSGMMAR1",6,0)
 U IO S WG=$S($D(^TMP($J))#2:+^($J),1:0),WGN=$S('$D(^PS(57.5,WG,0)):WG,$P(^(0),"^")]"":$P(^(0),"^"),1:WG),(LN1,LN2,PSGOP,PN,RB,WDN,TM)="",PSGLSTOP=1,$P(LN1,"-",133)="",$P(LN2,"-",126)=""
"RTN","PSGMMAR1",7,0)
 S MOS="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",(LN3,LN14,QQ)=""
"RTN","PSGMMAR1",8,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  S LN3=LN3_" "_$E("  ",1,PSGMARDF=7+1)_$S(PSGMARDF=7:$P(PSGD(Q),"^"),1:$E(Q,6,7))_$E("  ",1,PSGMARDF=7+1) S:PSGMARDF=7 QQ=Q I PSGMARDF=14 S LN14=LN14_"  "_$S($E(Q,4,5)'=$E(QQ,4,5):$P(MOS,"^",+PSGD(Q)),1:"   "),QQ=Q
"RTN","PSGMMAR1",9,0)
 S (LN4,LN7)="|" F Q=1:1:PSGMARDF S LN4=LN4_$E("_________",1,$S(PSGMARDF=7:9,1:4))_"|",LN7=LN7_$E("         ",1,$S(PSGMARDF=7:9,1:4))_"|"
"RTN","PSGMMAR1",10,0)
 S LN5="|-------|-------|----------------------|------|----------------------|------|",LN6="  DATE    TIME          REASON           INIT         RESULT           INIT"
"RTN","PSGMMAR1",11,0)
 S LN31="|--------|--------|-----------------------------------------|------|-----------------------|-----------------------|--------|------|"
"RTN","PSGMMAR1",12,0)
 S LN32="|        |        |                                       |       |                      |                      |        |       |"
"RTN","PSGMMAR1",13,0)
 K BLN S BLN(1)=$E(LN1,1,36),BLN(2)="   Indicate RIGHT (R) or LEFT (L)",BLN(3)="",BLN(4)="   (IM)                   (SUB Q)",BLN(5)="1. DELTOID             6. UPPER ARM",BLN(6)="2. VENTRAL GLUTEAL     7. ABDOMEN"
"RTN","PSGMMAR1",14,0)
 S BLN(7)="3. GLUTEUS MEDIUS      8. THIGH",BLN(8)="4. MID(ANTERIOR) THIGH 9. BUTTOCK",BLN(9)="5. VASTUS LATERALIS   10. UPPER BACK",BLN(10)=" PRN: E=Effective   N=Not Effective"
"RTN","PSGMMAR1",15,0)
 S ASTERS=$E("*********",1,PSGMARDF=7*5+4),EXPIRE=$S(PSGMARDF=14:"****",1:"*********"),SPACES=$E("         ",1,PSGMARDF=7*5+4) F X="PSGMARSD","PSGMARFD" S @($E(X,1,7)_"P")=$P($$ENDTC2^PSGMI(@X)," ")
"RTN","PSGMMAR1",16,0)
 ;
"RTN","PSGMMAR1",17,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PN=$O(^TMP($J,PN)) Q:PN=""  D P
"RTN","PSGMMAR1",18,0)
 Q:(PSGSS="P")!(PSGSS="C")!(PSGSS="L")
"RTN","PSGMMAR1",19,0)
 ;
"RTN","PSGMMAR1",20,0)
 F  S (PTM,TM)=$O(^TMP($J,TM)) Q:TM=""  F  S (PWDN,WDN)=$O(^TMP($J,TM,WDN)) Q:WDN=""  D
"RTN","PSGMMAR1",21,0)
 . I PSGRBPPN="R" F  S (PRB,RB)=$O(^TMP($J,TM,WDN,RB)) Q:RB=""  F  S PN=$O(^TMP($J,TM,WDN,RB,PN)) Q:PN=""  S PPN=^(PN) D PI,^PSGMMAR2:PSGMARS'=2,BLANK^PSGMMAR3:(PSGMARS=2&(PSGMARB'=2)),^PSGMMAR3:PSGMARS'=1
"RTN","PSGMMAR1",22,0)
 ;
"RTN","PSGMMAR1",23,0)
 ;DAM 5-01-07 - Utilize the ^XTMP global set up in PSGMMAR0 for printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMAR1",24,0)
 I PSGRBPPN="P" F  S (PTM,TM)=$O(^XTMP(PSGREP,TM)) Q:TM=""  F  S PN=$O(^XTMP(PSGREP,TM,PN)) Q:PN=""  D
"RTN","PSGMMAR1",25,0)
 . F  S (PWDN,WDN)=$O(^XTMP(PSGREP,TM,PN,WDN)) Q:WDN=""  D
"RTN","PSGMMAR1",26,0)
 . . F  S (PRB,RB)=$O(^XTMP(PSGREP,TM,PN,WDN,RB)) Q:RB=""  S PPN=^(RB) D PI,^PSGMMAR2:PSGMARS'=2,BLANK^PSGMMAR3:(PSGMARS=2&(PSGMARB'=2)),^PSGMMAR3:PSGMARS'=1
"RTN","PSGMMAR1",27,0)
 Q
"RTN","PSGMMAR1",28,0)
 ;
"RTN","PSGMMAR1",29,0)
P ;
"RTN","PSGMMAR1",30,0)
 ;
"RTN","PSGMMAR1",31,0)
 N TMPPWDN
"RTN","PSGMMAR1",32,0)
 I (PSGMARB=1)!($D(^TMP($J,PN))=1) D  Q
"RTN","PSGMMAR1",33,0)
 . S PPN=^TMP($J,PN),PWDN=$S(PSGSS="C":$G(PSGAPWDN),1:$P(PPN,U,13)),PRB=$S(PSGSS="C":"",1:$P(PPN,U,14)),PTM="zz"
"RTN","PSGMMAR1",34,0)
 . D PI
"RTN","PSGMMAR1",35,0)
 . I PSGMARS'=2 D ^PSGMMAR2
"RTN","PSGMMAR1",36,0)
 . I PSGMARS'=1 D:(PSGMARS=2&(PSGMARB'=2)) BLANK^PSGMMAR3 D ^PSGMMAR3
"RTN","PSGMMAR1",37,0)
 . Q
"RTN","PSGMMAR1",38,0)
 ;
"RTN","PSGMMAR1",39,0)
 S TMPPWDN=$P(^TMP($J,PN),U,13)
"RTN","PSGMMAR1",40,0)
 S:TMPPWDN="" TMPPWDN="zz"
"RTN","PSGMMAR1",41,0)
 S PWDN=""
"RTN","PSGMMAR1",42,0)
 F  S PWDN=$O(^TMP($J,PN,PWDN)) Q:PWDN=""  S TMPPWDN=PWDN S PPN=^TMP($J,PN),PRB=$P(PPN,U,14),PTM="zz" D  S PWDN=TMPPWDN
"RTN","PSGMMAR1",43,0)
 . D PI
"RTN","PSGMMAR1",44,0)
 . I PSGMARS'=2 D ^PSGMMAR2
"RTN","PSGMMAR1",45,0)
 . I PSGMARS'=1 D:(PSGMARS=2&(PSGMARB'=2)) BLANK^PSGMMAR3 D ^PSGMMAR3
"RTN","PSGMMAR1",46,0)
 . Q
"RTN","PSGMMAR1",47,0)
 ;
"RTN","PSGMMAR1",48,0)
 Q
"RTN","PSGMMAR1",49,0)
 ;
"RTN","PSGMMAR1",50,0)
PI ;
"RTN","PSGMMAR1",51,0)
 K PSGMPG,PSGMPGN
"RTN","PSGMMAR1",52,0)
 S:PTM="zz" PTM="NOT FOUND" S:PWDN="zz" PWDN="NOT FOUND" S:PRB="zz" PRB="NOT FOUND"
"RTN","PSGMMAR1",53,0)
 S (PSGOP,PSGP)=+$P(PN,U,2),PSGP(0)=$P(PN,U),BD=$P(PPN,U,2),PSSN=$P(PPN,U,3),DX=$P(PPN,U,4),WT=$P(PPN,U,5)_" "_$P(PPN,U,6)
"RTN","PSGMMAR1",54,0)
 S HT=$P(PPN,U,7)_" "_$P(PPN,U,8),AD=$P(PPN,U,9)
"RTN","PSGMMAR1",55,0)
 S TD=$P(PPN,U,10),PSEX=$P(PPN,U,11),PSGLWD=$P(PPN,U,12),PPN=$P(PPN,U),PAGE=$P(BD,";",2),BD=$P(BD,";"),DFN=PSGP
"RTN","PSGMMAR1",56,0)
 D ATS^PSJMUTL(115,117,1)
"RTN","PSGMMAR1",57,0)
 Q
"RTN","PSGMMAR2")
0^19^B40124630^B33296503
"RTN","PSGMMAR2",1,0)
PSGMMAR2 ;BIR/CML3-MD MARS - PRINT C ORDERS(UD) ;09 Feb 99 / 12:50 PM
"RTN","PSGMMAR2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMMAR2",3,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGMMAR2",4,0)
S1 ;
"RTN","PSGMMAR2",5,0)
 I PSGMARB'=1 S:PSGRBPPN="P" X=PN,Y=RB S:PSGRBPPN="R" X=RB,Y=PN D
"RTN","PSGMMAR2",6,0)
 . I PSGRBPPN="R" S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,PWDN,0)),1:$O(^TMP($J,TM,WDN,X,Y,0)))'["C"
"RTN","PSGMMAR2",7,0)
 . I PSGRBPPN="P"  S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,PWDN,0)),1:$O(^XTMP(PSGREP,TM,X,WDN,Y,0)))'["C"    ;DAM 5-01-07 Rewrite  to utilize XTMP global when printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMAR2",8,0)
 ;
"RTN","PSGMMAR2",9,0)
 I (PSGSS="P")!(PSGSS="C")!(PSGSS="L") S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,PWDN,0)),1:$O(^TMP($J,TM,WDN,X,Y,0)))'["C"
"RTN","PSGMMAR2",10,0)
 ;
"RTN","PSGMMAR2",11,0)
 I $S(PSGMARB'=2:1,"34"[PSGMARS:NO,1:0) D:(PSGMARS'=4) HEADER,BOT D:PSGMARS'=1 BLANK^PSGMMAR3 Q:PSGMARB=1
"RTN","PSGMMAR2",12,0)
 ;
"RTN","PSGMMAR2",13,0)
 Q:NO  D NOW^%DTC S PSGDT=%,(DAO,PST)="" I PSGSS'="P",PSGSS'="C",PSGSS'="L" D HEADER
"RTN","PSGMMAR2",14,0)
 ;
"RTN","PSGMMAR2",15,0)
 S PSGMPG=0,PSGMPGN="PAGE: "
"RTN","PSGMMAR2",16,0)
 D @($S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):"P",1:"W"))
"RTN","PSGMMAR2",17,0)
 D BOT
"RTN","PSGMMAR2",18,0)
 Q
"RTN","PSGMMAR2",19,0)
P ; Print on Patient order
"RTN","PSGMMAR2",20,0)
 ;
"RTN","PSGMMAR2",21,0)
 D HEADER
"RTN","PSGMMAR2",22,0)
 F  S PST=$O(^TMP($J,PN,PWDN,PST)) Q:PST'["C"  D
"RTN","PSGMMAR2",23,0)
 . S DAO=""
"RTN","PSGMMAR2",24,0)
 . F  S DAO=$O(^TMP($J,PN,PWDN,PST,DAO)) Q:DAO=""  S PSGMARTS=^TMP($J,PN,PWDN,PST,DAO) D PRT
"RTN","PSGMMAR2",25,0)
 . Q
"RTN","PSGMMAR2",26,0)
 ;
"RTN","PSGMMAR2",27,0)
 S:$O(^TMP($J,PN,PWDN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",28,0)
 Q
"RTN","PSGMMAR2",29,0)
 ;
"RTN","PSGMMAR2",30,0)
W ; Print Ward/Ward group
"RTN","PSGMMAR2",31,0)
 ;DAM 5-01-07 Utilize the XTMP global for printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMAR2",32,0)
 I PSGRBPPN="P" D
"RTN","PSGMMAR2",33,0)
 . F  S PST=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO)  D PRT
"RTN","PSGMMAR2",34,0)
 . ;
"RTN","PSGMMAR2",35,0)
 . S:$O(^XTMP(PSGREP,TM,PN,WDN,RB,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",36,0)
 . ;
"RTN","PSGMMAR2",37,0)
 I PSGRBPPN="R" D
"RTN","PSGMMAR2",38,0)
 . F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST'["C"  F Q=0:0 S DAO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAO)) Q:DAO=""  S PSGMARTS=^(DAO) D PRT
"RTN","PSGMMAR2",39,0)
 . S:$O(^TMP($J,TM,WDN,RB,PN,"N"))="" PSGMPGN="LAST PAGE: "
"RTN","PSGMMAR2",40,0)
 Q
"RTN","PSGMMAR2",41,0)
HEADER ; pat info
"RTN","PSGMMAR2",42,0)
 S:'$G(PSGXDT) PSGXDT=PSGDT ;Reason was that PSGDT kept reset somewhere
"RTN","PSGMMAR2",43,0)
 S PSGMAROC=0,(MSG1,MSG2)="" W:$G(PSGPG)&($Y) @IOF S PSGPG=1 W !?1,"CONTINUOUS SHEET",?61,PSGMARDF," DAY MAR",?100,PSGMARSP,"  through  ",PSGMARFP
"RTN","PSGMMAR2",44,0)
 W !?5,$P($$SITE(80),U,2),?102,"Printed on  "_$$ENDTC2^PSGMI(PSGXDT)
"RTN","PSGMMAR2",45,0)
 W !?5,"Name:  "_PPN,?62,"Weight (kg): "_WT,?103,"Loc: "_$S(PWDN'["C!":PWDN,1:$P($G(^SC($P(PWDN,"!",2),0)),"^"))
"RTN","PSGMMAR2",46,0)
 W !?6,"PID:  "_PSSN,?25,"DOB: "_BD_"  ("_PAGE_")",?62,"Height (cm): "_HT,?99,"Room-Bed: "_$S(PWDN'["C!":PRB,1:"")
"RTN","PSGMMAR2",47,0)
 W !?6,"Sex:  "_PSEX,?25," Dx: "_DX,?$S(TD:94,1:99),$S(TD:"Last Transfer: "_TD,1:"Admitted: "_$S(PWDN'["C!":AD,1:""))
"RTN","PSGMMAR2",48,0)
 I '$D(PSGALG) W !,"Allergies:  See attached list of Allergies/Adverse Reactions"
"RTN","PSGMMAR2",49,0)
 NEW PSGX S PSGX=0 D ATS^PSGMAR3(.PSGX) D:PSGX HEADER Q:PSGX
"RTN","PSGMMAR2",50,0)
 W !,?49,"Admin"
"RTN","PSGMMAR2",51,0)
 W:$G(PSJDIET)]"" ?57,"Diet: ",PSJDIET
"RTN","PSGMMAR2",52,0)
 W:PSGMARDF=14 ?55,LN14 W !?1,"Order",?9,"Start",?21,"Stop",?49,"Times" W ?55,LN3," notes",!,LN1
"RTN","PSGMMAR2",53,0)
 Q
"RTN","PSGMMAR2",54,0)
PRT ; order info
"RTN","PSGMMAR2",55,0)
 S ON=$P(DAO,U,2) D ONHOLD
"RTN","PSGMMAR2",56,0)
 I +PSGMSORT,$S(ON["V":1,ON["P":$P($G(^PS(53.1,+ON,0)),U,4)="F",1:0) D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",57,0)
 D:PSGMAROC>5 ENB,HEADER I PST["CV"!(PST["CZV") D PRT^PSGMMIVC Q
"RTN","PSGMMAR2",58,0)
 S PSGMARGD=$P(PSGMARTS,"^",2),PSGMARTS=$P(PSGMARTS,"^"),PSGORD=$P(DAO,U,2) S:PSGORD["P" PSJPSTO=PST,PST=$S(+PSGMSORT:"CZ",1:PST) D ^PSGLOI
"RTN","PSGMMAR2",59,0)
 D TS^PSGMAR3(PSGMARTS)
"RTN","PSGMMAR2",60,0)
 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR2",61,0)
 I (PSGMAROC>4&(MARLB>6))!(TS/6>6)!((TS/6+PSGMAROC)>6) D BOT,HEADER
"RTN","PSGMMAR2",62,0)
 S PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",63,0)
 NEW PRTLN F PRTLN=1:1:MARLB W !,MARLB(PRTLN),?48,"|",$G(TS(PRTLN)) D CELL(PRTLN,'(PRTLN#6)) D PRT2
"RTN","PSGMMAR2",64,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR2",65,0)
 Q
"RTN","PSGMMAR2",66,0)
PRT2 ;
"RTN","PSGMMAR2",67,0)
 I PSGMAROC>5,(TS/6>7) D
"RTN","PSGMMAR2",68,0)
 . S MSG1="*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMAR2",69,0)
 . D BOT,HEADER
"RTN","PSGMMAR2",70,0)
 I PRTLN#6=0 W:PSGMAROC<6 !?7,LN2 S:PRTLN'=MARLB PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR2",71,0)
 Q
"RTN","PSGMMAR2",72,0)
CHKLAB ; Check to see if next label is needed.
"RTN","PSGMMAR2",73,0)
 I '((L+1)#6) W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1,"See next label for continuation",?48,"| ",$G(TS(L+1)) D CELL(L+1,1) W:PSGMAROC<6 !?7,LN2,!?1 S L=L+2,PSGMAROC=PSGMAROC+1 D  Q
"RTN","PSGMMAR2",74,0)
 . I PSGMAROC>5,(TS/6>7) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT,HEADER
"RTN","PSGMMAR2",75,0)
 E  W ?48,"| ",$G(TS(L)) D CELL(L,0) W !?1 S L=L+1
"RTN","PSGMMAR2",76,0)
 Q
"RTN","PSGMMAR2",77,0)
INIT ; Print the initials on the label.
"RTN","PSGMMAR2",78,0)
 W !?1,$E("WS",1,PSGLWS*2),?4,$S(PSGLSM:$E("HSM",PSGLSM,3),1:""),?8,$E("NF",1,PSGLNF*2),?30,"RPH: ",PSGLRPH,?39," RN: ",PSGLRN,?48,"| ",?50,$G(TS(L)) D CELL(L,1)
"RTN","PSGMMAR2",79,0)
 Q
"RTN","PSGMMAR2",80,0)
CELL(X,X1) ; Print the **** on the not to be given cells.
"RTN","PSGMMAR2",81,0)
 N QTS,CELL S CELL=$E($S(X1:"         ",1:"_________"),1,PSGMARDF=7*5+4)
"RTN","PSGMMAR2",82,0)
 I PST["CZ",(X=6) NEW PSGLFFD,PSGMARGD S P(9)="",PSGLFFD="9999999",PSGMARGD="" W ?55 D ASTERS Q
"RTN","PSGMMAR2",83,0)
 I TS=1,'PSGMARTS,(X=6) W ?55 S P(9)=1 D ASTERS K P(9) Q
"RTN","PSGMMAR2",84,0)
 I $G(TS(X))="" W ?55,$S(X1:LN7,1:LN4) Q
"RTN","PSGMMAR2",85,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  S QTS=Q_"."_TS(X) W ?55,"|"_$S(QTS<PSGLSSD:EXPIRE,QTS'<PSGLFFD:EXPIRE,PSGMARGD="":ASTERS,$G(ONHOLD):$E("Hold     ",1,$L(CELL)),PSGMARGD[$P(PSGD(Q),"^"):CELL,1:ASTERS)
"RTN","PSGMMAR2",86,0)
 W "|"
"RTN","PSGMMAR2",87,0)
 Q
"RTN","PSGMMAR2",88,0)
ASTERS ; Print the **** on the first label.
"RTN","PSGMMAR2",89,0)
 I ONHOLD N HSPACE S HSPACE=SPACES,SPACES=$E("Hold           ",1,$L(HSPACE))
"RTN","PSGMMAR2",90,0)
 S PSGLFFD=$P(PSGLFFD,".") F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  W "|"_$S(Q<$P(PSGLSSD,"."):ASTERS,Q=PSGLFFD:EXPIRE,Q>PSGLFFD:ASTERS,(PSGMARGD=""&($G(P(9))="")):SPACES,PSGMARGD[$P(PSGD(Q),"^"):SPACES,1:ASTERS)
"RTN","PSGMMAR2",91,0)
 W "|"
"RTN","PSGMMAR2",92,0)
 I ONHOLD S SPACES=HSPACE
"RTN","PSGMMAR2",93,0)
 Q
"RTN","PSGMMAR2",94,0)
BOT ; bottom of MAR
"RTN","PSGMMAR2",95,0)
 I MSG1]"" F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7)
"RTN","PSGMMAR2",96,0)
 I PSGMAROC<6 S PSGMAROC=6-PSGMAROC F Q=1:1:PSGMAROC F QQ=1:1:6 W ! W:QQ=1 ?6,"|",?19,"|" W:34[QQ ?12,$S(QQ=3:MSG1,1:MSG2) W ?55,$S(QQ<6:LN4,1:LN7) I QQ=6,Q<PSGMAROC W !?7,LN2
"RTN","PSGMMAR2",97,0)
ENB ;
"RTN","PSGMMAR2",98,0)
 I $D(PSGMPG) S PSGMPG=PSGMPG+1 S PSGMPGN=$S(PSGMPGN'["LAST":"PAGE: ",1:PSGMPGN)_PSGMPG
"RTN","PSGMMAR2",99,0)
 W !,LN1
"RTN","PSGMMAR2",100,0)
 W !,"|",?11,"SIGNATURE/TITLE",?38,"| INIT |          INJECTION SITES           |",?87,"MED/DOSE OMITTED",?107,"|     REASON     | INIT |"
"RTN","PSGMMAR2",101,0)
 F Q=1:1:10 W !,"|"_$E(LN1,1,37)_"|------|"_BLN(Q),?82,"|"_$E(LN1,1,24)_"|"_$E(LN1,1,16)_"|------|"
"RTN","PSGMMAR2",102,0)
 W !,LN1,!?3,PPN,?45,PSSN,?58,"Room-Bed: "_$S(PWDN'["C!":PRB,1:""),?100,$S($D(PSGMPG):PSGMPGN,1:""),?116,"VA FORM 10-2970",*13
"RTN","PSGMMAR2",103,0)
 Q
"RTN","PSGMMAR2",104,0)
SITE(LEN) ;* Get the Institution name
"RTN","PSGMMAR2",105,0)
 ;* Input : LEN = Report width (80 or 132 column)
"RTN","PSGMMAR2",106,0)
 ;* Output: space needed to center text ^ VAMC name
"RTN","PSGMMAR2",107,0)
 NEW X
"RTN","PSGMMAR2",108,0)
 S X=$$NAME^VASITE
"RTN","PSGMMAR2",109,0)
 I X="" S X=$$SITE^VASITE S:X]"" X="VAMC:  "_$P(X,U,2)_" ("_$P(X,U,3)_")"
"RTN","PSGMMAR2",110,0)
 I X="" Q ""
"RTN","PSGMMAR2",111,0)
 Q (LEN-$L(X))/2_U_X
"RTN","PSGMMAR2",112,0)
ONHOLD ;Check order to see if it's ON hold, set Flag True if it is
"RTN","PSGMMAR2",113,0)
 S ONHOLD=0
"RTN","PSGMMAR2",114,0)
 N PSGON
"RTN","PSGMMAR2",115,0)
 S PSGON=+ON
"RTN","PSGMMAR2",116,0)
 ;If unit dose order, check Hold Status field = Active Hold
"RTN","PSGMMAR2",117,0)
 I (ON["A")!(ON["O")!(ON["U") I $P($G(^PS(55,$P(PN,"^",2),5,PSGON,0)),"^",9)="H" S ONHOLD=1 Q
"RTN","PSGMMAR2",118,0)
 ;If IV Order, check Status field = Hold
"RTN","PSGMMAR2",119,0)
 I ON["V" I $P($G(^PS(55,$P(PN,"^",2),"IV",PSGON,0)),"^",17)="H" S ONHOLD=1 Q
"RTN","PSGMMAR2",120,0)
 Q
"RTN","PSGMMAR3")
0^20^B7615317^B7209208
"RTN","PSGMMAR3",1,0)
PSGMMAR3 ;BIR/CML3-MD MARS - SORT O/P ORDERS ;21 Oct 98 / 12:22 PM
"RTN","PSGMMAR3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMMAR3",3,0)
 ;
"RTN","PSGMMAR3",4,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSGMMAR3",5,0)
 ;
"RTN","PSGMMAR3",6,0)
S1 ; Print non-blank prn.
"RTN","PSGMMAR3",7,0)
 Q:PSGMARB=1
"RTN","PSGMMAR3",8,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB
"RTN","PSGMMAR3",9,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",10,0)
 S NO=$S(PSGSS="P"!(PSGSS="C")!(PSGSS="L"):$O(^TMP($J,PN,PWDN,"N"))="",PSGRBPPN="P":$O(^TMP($J,TM,WDN,PN,RB,"N"))="",1:$O(^TMP($J,TM,WDN,RB,PN,"N"))="")
"RTN","PSGMMAR3",11,0)
 Q:NO
"RTN","PSGMMAR3",12,0)
 D NOW^%DTC S PSGDT=%,(DAO,DAOO)="",PST="N",PSGMAROC=0
"RTN","PSGMMAR3",13,0)
 K ^TMP($J,"1PRN")
"RTN","PSGMMAR3",14,0)
 I PSGSS'="P",PSGSS'="C",PSGSS'="L" D
"RTN","PSGMMAR3",15,0)
 . I PSGRBPPN="P" F  S PST=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST)) Q:PST=""  F  S DAOO=$O(^XTMP(PSGREP,TM,PN,WDN,RB,PST,DAOO)) Q:DAOO=""  S PSGMARTS=^(DAOO) D SET    ;DAM 5-01-07 add XTMP global
"RTN","PSGMMAR3",16,0)
 . I PSGRBPPN="R" F  S PST=$O(^TMP($J,TM,WDN,RB,PN,PST)) Q:PST=""  F  S DAOO=$O(^TMP($J,TM,WDN,RB,PN,PST,DAOO)) Q:DAOO=""  S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",17,0)
 I PSGSS="P"!(PSGSS="C")!(PSGSS="L") F  S PST=$O(^TMP($J,PN,PWDN,PST)) Q:PST=""  D
"RTN","PSGMMAR3",18,0)
 . N DAOO S DAOO=""
"RTN","PSGMMAR3",19,0)
 . F  S DAOO=$O(^TMP($J,PN,PWDN,PST,DAOO)) Q:DAOO=""  I $D(^TMP($J,PN,PWDN,PST,DAOO))#10 S PSGMARTS=^(DAOO) D SET
"RTN","PSGMMAR3",20,0)
 . Q
"RTN","PSGMMAR3",21,0)
 ;
"RTN","PSGMMAR3",22,0)
 D EN^PSGMMAR4
"RTN","PSGMMAR3",23,0)
 Q
"RTN","PSGMMAR3",24,0)
 ;
"RTN","PSGMMAR3",25,0)
SET ; set ^tmp array
"RTN","PSGMMAR3",26,0)
 S PSGORD=$P(DAOO,U,2)
"RTN","PSGMMAR3",27,0)
 I PSGORD["V" D IVPRN^PSGMMIV Q
"RTN","PSGMMAR3",28,0)
 I +PSGMSORT,PSGORD["P" S PSJPSTO=PST,PST="OZ"
"RTN","PSGMMAR3",29,0)
 S PSGORD=+PSGORD_$S(PSGORD["P":"P",1:"A") D ^PSGLOI
"RTN","PSGMMAR3",30,0)
 S TS=0 D MARLB^PSGMUTL(47)
"RTN","PSGMMAR3",31,0)
 I ((MARLB/6)+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMAR3",32,0)
 I ((MARLB/6)+PSGMAROC)>(BL/2) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT(.RT,"^")
"RTN","PSGMMAR3",33,0)
 E  D LTRT(.LT,"")
"RTN","PSGMMAR3",34,0)
 D LAB
"RTN","PSGMMAR3",35,0)
 I $D(PSJPSTO) S PST=PSJPSTO K PSJPSTO
"RTN","PSGMMAR3",36,0)
 Q
"RTN","PSGMMAR3",37,0)
 ;
"RTN","PSGMMAR3",38,0)
LAB ;***Print the 1st label for the order.
"RTN","PSGMMAR3",39,0)
 NEW X,J S J=0
"RTN","PSGMMAR3",40,0)
 ;naked reference below goes with full reference on right of =
"RTN","PSGMMAR3",41,0)
 F X=1:1:MARLB S J=J+1,^(J)=$G(^TMP($J,"1PRN",PG,LAB,J))_UP_MARLB(X) D
"RTN","PSGMMAR3",42,0)
 . I X=6,(MARLB>6) D
"RTN","PSGMMAR3",43,0)
 . . S J=0
"RTN","PSGMMAR3",44,0)
 . . I PSGMAROC>(BL/2) D LTRT(.RT,"^")
"RTN","PSGMMAR3",45,0)
 . . E  D LTRT(.LT,"")
"RTN","PSGMMAR3",46,0)
 Q
"RTN","PSGMMAR3",47,0)
 ;
"RTN","PSGMMAR3",48,0)
LTRT(X,Y)         ;***Increment Left or Right label value.
"RTN","PSGMMAR3",49,0)
 S LAB=X,X=X+1,UP=Y,PSGMAROC=PSGMAROC+1
"RTN","PSGMMAR3",50,0)
 Q
"RTN","PSGMMAR3",51,0)
BLANK ; Print blank prn form
"RTN","PSGMMAR3",52,0)
 NEW INIT,NEED,LT,RT,BL,PG,LAB,UP
"RTN","PSGMMAR3",53,0)
 S BL=$S($P($G(^PS(59.7,1,26)),U):6,1:4),(PG,LT,RT)=1
"RTN","PSGMMAR3",54,0)
 I PSGMARB'=2 D PSGMARB^PSGMMAR4
"RTN","PSGMMAR3",55,0)
 Q
"RTN","PSGMMAR5")
0^21^B14152055^B4624280
"RTN","PSGMMAR5",1,0)
PSGMMAR5 ;BIR/CML3-MD MARS - GATHER INFO FOR ACK ORDERS ;14 Oct 98 / 4:29 PM
"RTN","PSGMMAR5",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,111,145**;16 DEC 97;Build 17
"RTN","PSGMMAR5",3,0)
 ;
"RTN","PSGMMAR5",4,0)
PEND ;*** Only select orders that were acknowledged by nurses and
"RTN","PSGMMAR5",5,0)
 ;*** still having pending status.
"RTN","PSGMMAR5",6,0)
 ;The next 4 lines are looking only at ward parameters.  If there is an inpatient with pending orders, the orders will print on the MAR.
"RTN","PSGMMAR5",7,0)
 NEW PSJSYSW,PSJSYSW0
"RTN","PSGMMAR5",8,0)
 S PSJSYSW=$O(^PS(59.6,"B",+$G(PSJPWD),0))
"RTN","PSGMMAR5",9,0)
 S:PSJSYSW PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSGMMAR5",10,0)
 Q:'+$P($G(PSJSYSW0),U,6)   ;Quit if the order is not pending.
"RTN","PSGMMAR5",11,0)
 ;
"RTN","PSGMMAR5",12,0)
 NEW ND,ON,TYPE,QST
"RTN","PSGMMAR5",13,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AV",PSGP,ON)) Q:'ON  D
"RTN","PSGMMAR5",14,0)
 . S ND=$G(^PS(53.1,ON,0)),TYPE=$P(ND,U,4)
"RTN","PSGMMAR5",15,0)
 . I $P(ND,U,7)="P"!($P($G(^PS(53.1,ON,2)),U)["PRN") S QST="OZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSGMMAR5",16,0)
 . E  S QST="CZ"_$S($P(ND,U,4)="F":"V",1:"A")
"RTN","PSGMMAR5",17,0)
 . I PSGMTYPE[1 D:TYPE'="F" SETTMP D:TYPE="F" IV
"RTN","PSGMMAR5",18,0)
 . I PSGMTYPE'[1 D
"RTN","PSGMMAR5",19,0)
 .. I PSGMTYPE[2,(TYPE="U") D SETTMP Q
"RTN","PSGMMAR5",20,0)
 .. I PSGMTYPE'[2,(TYPE="I") D SETTMP Q
"RTN","PSGMMAR5",21,0)
 .. I PSGMTYPE[4,(TYPE="F") D IV
"RTN","PSGMMAR5",22,0)
 Q
"RTN","PSGMMAR5",23,0)
 ;
"RTN","PSGMMAR5",24,0)
SETTMP ;*** Setup ^tmp for pending U/D and Inpatient med IVs.
"RTN","PSGMMAR5",25,0)
 ;*** OZ_(V/A) = PRN/One time orders (V=IV).
"RTN","PSGMMAR5",26,0)
 ;*** CZ_(V/A) = Continuous orders (A=U/D).
"RTN","PSGMMAR5",27,0)
 I PSGMARS=2,(QST["CZ") Q
"RTN","PSGMMAR5",28,0)
 I PSGMARS=1,(QST["OZ") Q
"RTN","PSGMMAR5",29,0)
 NEW MARX
"RTN","PSGMMAR5",30,0)
 D DRGDISP^PSJLMUT1(PSGP,+ON_"P",20,0,.MARX,1) S DRG=MARX(1)_U_+ON_"P"
"RTN","PSGMMAR5",31,0)
 N PSGMARWC,A  ;DEM 04/19/2006 - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMMAR5",32,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMMAR5",33,0)
 S A=$G(^PS(53.1,+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMMAR5",34,0)
 . N X
"RTN","PSGMMAR5",35,0)
 . D:$G(PSGMAR24) SPN^PSGMAR0 D:'$G(PSGMAR24) SPN^PSGMMAR0
"RTN","PSGMMAR5",36,0)
 . Q
"RTN","PSGMMAR5",37,0)
 I (PSGSS="P")!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)="" S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC Q
"RTN","PSGMMAR5",38,0)
 S ^TMP($J,TM,PSGMARWN,SUB1,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=""
"RTN","PSGMMAR5",39,0)
 ;
"RTN","PSGMMAR5",40,0)
 ;DAM 5-01-07 add XTMP global for printing when PSGSS is not "P", "C", or "L".  This reverses PSGMARWN (ward) and SUB1 (patient) so printing will occur with all locations (ward and clinic) appearing together under the patient's name
"RTN","PSGMMAR5",41,0)
 S ^XTMP(PSGREP,TM,SUB1,PSGMARWN,SUB2,$S(+PSGMSORT:$E(QST,1),1:QST),DRG)=""
"RTN","PSGMMAR5",42,0)
 ;
"RTN","PSGMMAR5",43,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC Q
"RTN","PSGMMAR5",44,0)
 Q
"RTN","PSGMMAR5",45,0)
 ;
"RTN","PSGMMAR5",46,0)
IV ;*** Sort IV pending orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMAR5",47,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMAR5",48,0)
 S X=$P(P("MR"),U,2)
"RTN","PSGMMAR5",49,0)
 S QST=QST_4
"RTN","PSGMMAR5",50,0)
 N PSGMARWC  ;DEM 04/19/2006 - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMMAR5",51,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMMAR5",52,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"P" D
"RTN","PSGMMAR5",53,0)
 . N A
"RTN","PSGMMAR5",54,0)
 . S A=$G(^PS(53.1,+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMMAR5",55,0)
 . . N X
"RTN","PSGMMAR5",56,0)
 . . D:$G(PSGMAR24) SPN^PSGMAR0 D:'$G(PSGMAR24) SPN^PSGMMAR0
"RTN","PSGMMAR5",57,0)
 . . Q
"RTN","PSGMMAR5",58,0)
 . I PSGSS="P"!(PSGSS="C")!(PSGSS="L") S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q
"RTN","PSGMMAR5",59,0)
 . S:PSGRBPPN="R" ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMAR5",60,0)
 . S:PSGRBPPN="P" ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""  ;DAM 5-01-07 set ^XTMP global when sorting by patient
"RTN","PSGMMAR5",61,0)
 . Q
"RTN","PSGMMAR5",62,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMAR5",63,0)
 Q
"RTN","PSGMMIV")
0^10^B45072835^B24646294
"RTN","PSGMMIV",1,0)
PSGMMIV ;BIR/MV-IV ORDER FOR THE 7/14 DAY MAR. ;25 Nov 98 / 9:24 AM
"RTN","PSGMMIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,21,58,111,131,145**;16 DEC 97;Build 17
"RTN","PSGMMIV",3,0)
 ;
"RTN","PSGMMIV",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIV",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIV",6,0)
 ;
"RTN","PSGMMIV",7,0)
START ;*** Read IV orders
"RTN","PSGMMIV",8,0)
 NEW MULTIPG
"RTN","PSGMMIV",9,0)
 S ON=""
"RTN","PSGMMIV",10,0)
 F PSGMARED=PSGMARSD-.0001:0 S PSGMARED=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED)) Q:'PSGMARED  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGMARED,ON)) Q:ON=""  D IV
"RTN","PSGMMIV",11,0)
 Q
"RTN","PSGMMIV",12,0)
IV ;*** Sort IV orders for 24 Hrs, 7/14 Day MAR.
"RTN","PSGMMIV",13,0)
 K DRG,P N X,ON55,PSJLABEL S DFN=PSGP,PSJLABEL=1 D GT55^PSIVORFB
"RTN","PSGMMIV",14,0)
 Q:P(2)>PSGMARFD
"RTN","PSGMMIV",15,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGMMIV",16,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGMMIV",17,0)
 S QST=$S(P(9)["PRN":"OVP",QST="O":"OVO",1:"CV")_XTYPE
"RTN","PSGMMIV",18,0)
 Q:(PSGMARS=2&(QST["C"))
"RTN","PSGMMIV",19,0)
 Q:(PSGMARS=1&(QST["O"))
"RTN","PSGMMIV",20,0)
 N PSGMARWC  ;DEM (05/30/2006) - PSGMARWC is used to preserve original value of PSGMARWN (patient location) in case location is changed by an order with a clinic location.
"RTN","PSGMMIV",21,0)
 S PSGMARWC=PSGMARWN
"RTN","PSGMMIV",22,0)
 I $G(DRG) S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),X=$E($P(X,U,2),1,20)_U_+ON_"V" D
"RTN","PSGMMIV",23,0)
 . N A
"RTN","PSGMMIV",24,0)
 . S A=$G(^PS(55,PSGP,"IV",+ON,"DSS")) I $P(A,"^")]"" S PSGMARWN="C!"_$P(A,"^") I $G(SUB1)]"",$G(SUB2)]"",'$D(^TMP($J,TM,PSGMARWN,SUB1,SUB2)) D
"RTN","PSGMMIV",25,0)
 . . N X,Y
"RTN","PSGMMIV",26,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",27,0)
 . . Q
"RTN","PSGMMIV",28,0)
 . . ;
"RTN","PSGMMIV",29,0)
 . I PSGSS="P" S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q                         ;DAM  5-01-07 Print by PATIENT
"RTN","PSGMMIV",30,0)
 . I PSGSS="L" Q:((PSGINWDG="")&(PSGMARWN'["C!"))  S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)="" Q     ;DAM  5-01-07 Print by clinic group
"RTN","PSGMMIV",31,0)
 . I PSGSS="C" Q:((PSGINWD="")&(PSGMARWN'["C!"))  I ((PSGMARWN[PSGCLNC)!(PSGMARWN'["C!")) S ^TMP($J,PPN,PSGMARWN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""  Q    ;DAM 5-01-07 Print by Clinic
"RTN","PSGMMIV",32,0)
 . ;
"RTN","PSGMMIV",33,0)
 . ;DAM 5-01-07 Set up XTMP global where location and patient names are switched for printing by WARD/PATIENT or WARD GROUP/PATIENT
"RTN","PSGMMIV",34,0)
 . I '$G(PSGREP) N PSGDEM1 S PSGDEM1=X D    ;transfer contents of patient drug information contained in "X" above to  a new variable temporarily
"RTN","PSGMMIV",35,0)
 . . S PSGREP="PSGM_"_$J
"RTN","PSGMMIV",36,0)
 . . S X1=DT,X2=1 D C^%DTC K %,%H,%T
"RTN","PSGMMIV",37,0)
 . . S ^XTMP(PSGREP,0)=X_U_DT
"RTN","PSGMMIV",38,0)
 . I PSGRBPPN="P",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D         ;Construct XTMP global for printing by WARD and sort by PATIENT
"RTN","PSGMMIV",39,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",40,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",41,0)
 . I PSGRBPPN="P",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D       ;Construct XTMP global for printing by WARD GROUP and sort by PATIENT
"RTN","PSGMMIV",42,0)
 . . S ^XTMP(PSGREP,TM,PPN,PSGMARWN,PSJPRB,$S(+PSGMSORT:$E(QST,1),1:QST),PSGDEM1)=""
"RTN","PSGMMIV",43,0)
 . . D SPN^PSGMMAR0
"RTN","PSGMMIV",44,0)
 . S X=$G(PSGDEM1)      ;Return value of X from PSGDEM1 back to X
"RTN","PSGMMIV",45,0)
 . ;
"RTN","PSGMMIV",46,0)
 . I PSGRBPPN="R",PSGSS="W" Q:((PSGINCL="")&(PSGMARWN["C!"))  D        ;Construct TMP global for printing by WARD and sort by ROOM/BED
"RTN","PSGMMIV",47,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",48,0)
 . I PSGRBPPN="R",PSGSS="G" Q:((PSGINCLG="")&(PSGMARWN["C!"))  D      ;Construct TMP global for printing by WARD GROUP and sort by ROOM/BED
"RTN","PSGMMIV",49,0)
 . . S ^TMP($J,TM,PSGMARWN,PSJPRB,PPN,$S(+PSGMSORT:$E(QST,1),1:QST),X)=""
"RTN","PSGMMIV",50,0)
  . ;End DAM modifications 5-01-07
"RTN","PSGMMIV",51,0)
  . ;
"RTN","PSGMMIV",52,0)
 S:PSGMARWN'=PSGMARWC PSGMARWN=PSGMARWC
"RTN","PSGMMIV",53,0)
 Q
"RTN","PSGMMIV",54,0)
IVPRN ;*** Set ^tmp to store IV orders that have schedule of PRN.
"RTN","PSGMMIV",55,0)
 K P,DRG NEW ON55,CHEMO,TXT,PSJLABEL
"RTN","PSGMMIV",56,0)
 S ON=$P(DAOO,U,2),DFN=$P(PN,U,2),PSJLABEL=1
"RTN","PSGMMIV",57,0)
 ;* D:PST'["Z" GT55^PSIVORFB
"RTN","PSGMMIV",58,0)
 ;* I PST["Z" D GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",59,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSGMMIV",60,0)
 D:ON["P" GT531^PSIVORFA(DFN,ON)
"RTN","PSGMMIV",61,0)
 D SETVAR,SETLTRT
"RTN","PSGMMIV",62,0)
 ;the two naked references below refer to the full reference to the right of the = sign
"RTN","PSGMMIV",63,0)
 S ^(1)=$G(^TMP($J,"1PRN",PG,LAB,1))_UP_"      |            |"
"RTN","PSGMMIV",64,0)
 S ^(2)=$G(^TMP($J,"1PRN",PG,LAB,2))_UP_$E(P("LOG"),1,5)_" |",LN=3
"RTN","PSGMMIV",65,0)
 ;* S:PST["Z" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",66,0)
 ;* S:PST'["Z" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",67,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",68,0)
 S:ON["P" ^(2)=^(2)_"P E N D I N G"
"RTN","PSGMMIV",69,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",70,0)
 S:ON["V" ^(2)=^(2)_$E(P(2),1,5)_$E(P(2),9,14)_" |"_P(3)
"RTN","PSGMMIV",71,0)
 ;Naked reference below refers to ^TMP($J,"1PRN",PG,LAB,2)
"RTN","PSGMMIV",72,0)
 S ^(2)=$$SETSTR^VALM1("("_$E(PSGP(0))_$E(PSSN,8,12)_")",^(2),40,7)
"RTN","PSGMMIV",73,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  S TXT=$$WRTDRG^PSIVUTL(DRG("AD",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT)
"RTN","PSGMMIV",74,0)
 S TXT="in "
"RTN","PSGMMIV",75,0)
 ;; F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",76,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSGMMIV",77,0)
 . S TXT=TXT_$$WRTDRG^PSIVUTL(DRG("SOL",X),47) S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",78,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" S TXT=TXT_"   "_PSJPRT2 S:LN=3 TXT=TXT_$$SP(47-$L(TXT))_PSGST,PSGST="" D CHK(.TXT) S TXT="   "
"RTN","PSGMMIV",79,0)
 S TXT=$P(P("MR"),U,2)_" "_P(9)_" "_P(8) D CHK(.TXT)
"RTN","PSGMMIV",80,0)
 I P(4)="C" S CHEMO="*CAUTION-CHEMOTHERAPY*" D:P("OPI")]"" CHK(CHEMO)
"RTN","PSGMMIV",81,0)
 S Y1="" F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=Y1_$P($P(P("OPI"),"^")," ",Y)_" " I $L(Y1)>47 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",82,0)
 I $L(Y1)>28 D CHK(Y1) S Y1=""
"RTN","PSGMMIV",83,0)
 I Y1<29,'(LN#6) S TXT=$S((P("OPI")=""&$D(CHEMO)):CHEMO,1:Y1),X=29-$L(TXT),TXT=TXT_$$SP(X)_INIT
"RTN","PSGMMIV",84,0)
 E  D  S TXT=$$SP(29)_INIT,LN=LN+1
"RTN","PSGMMIV",85,0)
 . ;the following three naked references below refer to the full references to the right of the = sign
"RTN","PSGMMIV",86,0)
 .  I LN=5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_Y1
"RTN","PSGMMIV",87,0)
 .  E  D:$L(Y1) CHK(Y1) F LN=LN:1:5 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_""
"RTN","PSGMMIV",88,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT
"RTN","PSGMMIV",89,0)
 Q
"RTN","PSGMMIV",90,0)
SETVAR ;***Initialize variables.
"RTN","PSGMMIV",91,0)
 NEW TMSTR
"RTN","PSGMMIV",92,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC^PSGMI(P(X))
"RTN","PSGMMIV",93,0)
 S PSGST=$S(P(9)["PRN":"P",P(2)=P(3):"O",1:"C"),TMSTR=P(11),PSGLFFD=PSGMARFD
"RTN","PSGMMIV",94,0)
 D INITOPI^PSGMMIVC
"RTN","PSGMMIV",95,0)
 ;;S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(37-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",96,0)
 S INIT="RPH: "_PSGLRPH,INIT=INIT_$$SP(38-($L(INIT)+29))_"RN: "_PSGLRN
"RTN","PSGMMIV",97,0)
 ;* S INIT="RPH: "_PSGLRPH_" RN: "_PSGLRN
"RTN","PSGMMIV",98,0)
 ;* S INIT="RPH: "_$S(PSGLRPH]"":PSGLRPH_" ",1:"_____")_" RN: "_$S($G(PSGLRN)]"":PSGLRN,1:"_____")
"RTN","PSGMMIV",99,0)
 ;*** If OPI<29 char, it is ok to put INITs in the same line.
"RTN","PSGMMIV",100,0)
 ;*** If OPI=""&it's a Chemo order, warning & Inits prt on same line.
"RTN","PSGMMIV",101,0)
 ;*** Add number lines needed for additives and solutions and 1 line
"RTN","PSGMMIV",102,0)
 ;*** for infusion rate and 1 line for start/stop date.
"RTN","PSGMMIV",103,0)
 ;*** Multiple labels can have up to 5 lines per label and the last
"RTN","PSGMMIV",104,0)
 ;*** label can have up to 6 lines..
"RTN","PSGMMIV",105,0)
 ;
"RTN","PSGMMIV",106,0)
 NEW X S NAMENEED=0
"RTN","PSGMMIV",107,0)
 F X="AD","SOL" D NAMENEED^PSJMUTL(X,47,.NEED) S NAMENEED=NAMENEED+NEED
"RTN","PSGMMIV",108,0)
 S MULTIPG=0,NEED=1
"RTN","PSGMMIV",109,0)
 ;* S X=($L(P("OPI"))>28)+1+(P("OPI")]""&(P(4)="C"))
"RTN","PSGMMIV",110,0)
 ;* Find # of lines needed for OPI -- (($L(P("OPI"))\47)
"RTN","PSGMMIV",111,0)
 ;* If the last line in OPI < 29 --(($L(P("OPI")#47)>28) include init.
"RTN","PSGMMIV",112,0)
 S X=($L($P(P("OPI"),"^"))\47)+(($L($P(P("OPI"),"^"))#47)>28)+1+($P(P("OPI"),"^")]""&(P(4)="C"))
"RTN","PSGMMIV",113,0)
 S X=(NAMENEED+X+2) S:X>5 NEED=((X-6)\5)+2
"RTN","PSGMMIV",114,0)
 S:NEED>BL MULTIPG=1
"RTN","PSGMMIV",115,0)
 Q
"RTN","PSGMMIV",116,0)
CHK(TXT) ;
"RTN","PSGMMIV",117,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",118,0)
 I '(LN#6) S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"See next label for continuation",LN=1 D
"RTN","PSGMMIV",119,0)
 . I PSGMAROC+1>(BL/2) D
"RTN","PSGMMIV",120,0)
 . . I PSGMAROC=BL-1,MULTIPG D
"RTN","PSGMMIV",121,0)
 . . .;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",122,0)
 . . .F LN=LN:1:6 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_"" S:LN=3 ^(LN)=UP_"*** CONTINUE ON NEXT PAGE ***"
"RTN","PSGMMIV",123,0)
 . . .S PG=PG+1,(LN,LT,RT)=1,(PSGMAROC,MULTIPG)=0 D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",124,0)
 . . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",125,0)
 . E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",126,0)
 ;naked reference below refers to the full reference to the right of the = sign
"RTN","PSGMMIV",127,0)
 S ^(LN)=$G(^TMP($J,"1PRN",PG,LAB,LN))_UP_TXT,LN=LN+1,TXT=""
"RTN","PSGMMIV",128,0)
 Q
"RTN","PSGMMIV",129,0)
SETLTRT ;*** Increment line number for left or right label on PRN sheet.
"RTN","PSGMMIV",130,0)
 I (NEED+PSGMAROC)>BL S:PSGMAROC PG=PG+1,(LT,RT)=1,PSGMAROC=0
"RTN","PSGMMIV",131,0)
 I NEED+PSGMAROC=BL D  Q
"RTN","PSGMMIV",132,0)
 . I PSGMAROC<(BL/2) D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",133,0)
 . E  D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",134,0)
 I PSGMAROC,((NEED+PSGMAROC)>(BL/2)) S PSGMAROC=$S(PSGMAROC>(BL/2):PSGMAROC,1:(BL/2)) D LTRT^PSGMMAR3(.RT,"^")
"RTN","PSGMMIV",135,0)
 E  D LTRT^PSGMMAR3(.LT,"")
"RTN","PSGMMIV",136,0)
 Q
"RTN","PSGMMIV",137,0)
SP(X) ;***Set up spaces need between info on TXT for the label.
"RTN","PSGMMIV",138,0)
 N Y S $P(Y," ",X)=" "
"RTN","PSGMMIV",139,0)
 Q $G(Y)
"RTN","PSGSEL")
0^11^B40642983^B26408346
"RTN","PSGSEL",1,0)
PSGSEL ;BIR/CML3-SELECT ORDERS BY WARD, WARD GROUP, OR PATIENT ; 15 May 98 / 9:26 AM
"RTN","PSGSEL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,111,145**;16 DEC 97;Build 17
"RTN","PSGSEL",3,0)
SELECT ; give user choice to select by
"RTN","PSGSEL",4,0)
 S:'$D(PSGSSH) PSGSSH="GENERIC"
"RTN","PSGSEL",5,0)
 F  R !!,"Select by GROUP (G), WARD (W), CLINIC (C), or PATIENT (P): ",PSGSS:DTIME W:'$T $C(7) S:'$T PSGSS="^" Q:"^"[PSGSS  D CHK I "CGPW"[PSGSS Q
"RTN","PSGSEL",6,0)
 ;
"RTN","PSGSEL",7,0)
 N PSGPRMT
"RTN","PSGSEL",8,0)
 S PSGPRMT=$P(XQY0,U,1)
"RTN","PSGSEL",9,0)
 ;DAM   5-01-07  Adding new prompt.  If user selects to print by WARD, he is prompted to "Include Clinic Orders?"  If user selects to print by CLINIC, he is prompted to "Include Ward Orders?"
"RTN","PSGSEL",10,0)
 S PSGINCL=""
"RTN","PSGSEL",11,0)
 I PSGSS["W" D
"RTN","PSGSEL",12,0)
 . I (PSGPRMT'["MAR") Q
"RTN","PSGSEL",13,0)
 . N DIR,DUOUT,DIRUT,DTOUT,X,Y
"RTN","PSGSEL",14,0)
 . S DIR(0)="Y"
"RTN","PSGSEL",15,0)
 . W !
"RTN","PSGSEL",16,0)
 . S DIR("A")="Include Clinic Orders"
"RTN","PSGSEL",17,0)
 . D ^DIR
"RTN","PSGSEL",18,0)
 . I Y=1 S PSGINCL=1
"RTN","PSGSEL",19,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)) S Y=0
"RTN","PSGSEL",20,0)
 ;
"RTN","PSGSEL",21,0)
 S PSGINWD=""
"RTN","PSGSEL",22,0)
 I PSGSS["C" D
"RTN","PSGSEL",23,0)
 . I (PSGPRMT'["MAR") Q
"RTN","PSGSEL",24,0)
 . N DIR,DUOUT,DIRUT,DTOUT,X,Y
"RTN","PSGSEL",25,0)
 . S DIR(0)="Y"
"RTN","PSGSEL",26,0)
 . W !
"RTN","PSGSEL",27,0)
 . S DIR("A")="Include Ward Orders"
"RTN","PSGSEL",28,0)
 . D ^DIR
"RTN","PSGSEL",29,0)
 . I Y=1 S PSGINWD=1
"RTN","PSGSEL",30,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)) S Y=0
"RTN","PSGSEL",31,0)
 ;End DAM 5-01-07
"RTN","PSGSEL",32,0)
 ;
"RTN","PSGSEL",33,0)
 K PSGSSA Q:PSGSS'="G"
"RTN","PSGSEL",34,0)
 F  R !!,"Select by WARD GROUP (W) or CLINIC GROUP (C): ",PSGSS2:DTIME W:'$T $C(7) S:'$T PSGSS2="^" Q:"^"[PSGSS2  D CHK2 I "CW"[PSGSS2 Q
"RTN","PSGSEL",35,0)
 G SELECT:PSGSS2="" S PSGSS=$S(PSGSS2="C":"L",1:"G")
"RTN","PSGSEL",36,0)
 ;
"RTN","PSGSEL",37,0)
 ;DAM 5-01-07  Adding new prompt.  If user selects to print by WARD GROUP, he is prompted to "Include Clinic Orders?"  If user selects to print by CLINIC GROUP, he is prompted to "Include Ward Orders?"
"RTN","PSGSEL",38,0)
 S PSGINCLG=""
"RTN","PSGSEL",39,0)
 I PSGSS2["W" D
"RTN","PSGSEL",40,0)
 . I (PSGPRMT'["MAR") Q
"RTN","PSGSEL",41,0)
 . N DIR,DUOUT,DIRUT,DTOUT,X,Y
"RTN","PSGSEL",42,0)
 . S DIR(0)="Y"
"RTN","PSGSEL",43,0)
 . W !
"RTN","PSGSEL",44,0)
 . S DIR("A")="Include Clinic Orders"
"RTN","PSGSEL",45,0)
 . D ^DIR
"RTN","PSGSEL",46,0)
 . I Y=1 S PSGINCLG=1
"RTN","PSGSEL",47,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)) S Y=0
"RTN","PSGSEL",48,0)
 ;
"RTN","PSGSEL",49,0)
 S PSGINWDG=""
"RTN","PSGSEL",50,0)
 I PSGSS2["C" D
"RTN","PSGSEL",51,0)
 . I (PSGPRMT'["MAR") Q
"RTN","PSGSEL",52,0)
 . N DIR,DUOUT,DIRUT,DTOUT,X,Y
"RTN","PSGSEL",53,0)
 . S DIR(0)="Y"
"RTN","PSGSEL",54,0)
 . W !
"RTN","PSGSEL",55,0)
 . S DIR("A")="Include Ward Orders"
"RTN","PSGSEL",56,0)
 . D ^DIR
"RTN","PSGSEL",57,0)
 . I Y=1 S PSGINWDG=1
"RTN","PSGSEL",58,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)) S Y=0
"RTN","PSGSEL",59,0)
 ;End DAM 5-01-07
"RTN","PSGSEL",60,0)
 ;
"RTN","PSGSEL",61,0)
 K PSGSSA Q
"RTN","PSGSEL",62,0)
 ;
"RTN","PSGSEL",63,0)
CHK ;
"RTN","PSGSEL",64,0)
 ;I PSGSS=" ",$D(^DISV(DUZ,"PSGSEL")) S PSGSS=^("PSGSEL") W $S(PSGSS="P":"PATIENT",PSGSS="W":"WARD",PSGSS="G":"GROUP",1:"") Q:PSGSS]""&("GPW"[PSGSS)
"RTN","PSGSEL",65,0)
 I PSGSS=" " W $S(PSGSS="P":"PATIENT",PSGSS="W":"WARD",PSGSS="G":"GROUP",PSGSS="C":"CLINIC",1:"") Q:PSGSS]""&("GPWC"[PSGSS)
"RTN","PSGSEL",66,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS) S PSGSSA=PSGSSA_$S($E(PSGSS,Q)'?1L:$E(PSGSS,Q),1:$C($A(PSGSS,Q)-32))
"RTN","PSGSEL",67,0)
 F X="CLINIC","GROUP","WARD","PATIENT" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS=$E(PSGSSA) Q
"RTN","PSGSEL",68,0)
 Q:$T  I PSGSS'?1."?" W $C(7),"  ??" S PSGSS="Z" Q
"RTN","PSGSEL",69,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter an '^'." Q
"RTN","PSGSEL",70,0)
 ;
"RTN","PSGSEL",71,0)
CHK2 ;
"RTN","PSGSEL",72,0)
 S PSGSSA="" F Q=1:1:$L(PSGSS2) S PSGSSA=PSGSSA_$S($E(PSGSS2,Q)'?1L:$E(PSGSS2,Q),1:$C($A(PSGSS2,Q)-32))
"RTN","PSGSEL",73,0)
 F X="WARD","CLINIC" I $P(X,PSGSSA)="" W $P(X,PSGSSA,2,99) S PSGSS2=$E(PSGSSA) Q
"RTN","PSGSEL",74,0)
 Q:$T  I PSGSS2'?1."?" W $C(7),"  ??" S PSGSS2="Z" Q
"RTN","PSGSEL",75,0)
 W ! D @PSGSSH W !!?2,"To leave this option, press the RETURN key or enter an '^'." Q
"RTN","PSGSEL",76,0)
 ;
"RTN","PSGSEL",77,0)
HELP ; the following are the help text messages for the various options
"RTN","PSGSEL",78,0)
 ;
"RTN","PSGSEL",79,0)
GENERIC W !!,?2,"To run this option for an entire WARD GROUP, enter a 'G'.  To run this option for a single WARD, enter a 'W'.  To run this option for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",80,0)
 ;
"RTN","PSGSEL",81,0)
VBW W !!?2,"To verify all of the orders in an entire WARD GROUP, enter a 'G'. To verify   all of the orders in an entire CLNIC GROUP, enter 'CG'."
"RTN","PSGSEL",82,0)
 W " To verify all of the    orders in a single WARD, enter a 'W'. To verify all of the orders in a single   CLINIC, enter a 'C'."
"RTN","PSGSEL",83,0)
 W "To verify all of the orders for a single PATIENT, enter a   'P'." Q
"RTN","PSGSEL",84,0)
 ;
"RTN","PSGSEL",85,0)
EXP W !?2,"To print STOP ORDER NOTICES for an entire WARD GROUP, enter a 'G'.  To print  notices for a single WARD, enter a 'W'.  To print notices for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",86,0)
 ;
"RTN","PSGSEL",87,0)
MAR W !?2,"To run a Medication Administration Record (MAR or CMR) for an entire WARD",!,"GROUP, enter a 'G'.  To run an MAR for a single WARD, enter a 'W'.  To run an   MAR for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",88,0)
 ;
"RTN","PSGSEL",89,0)
LBL W !?2,"To print labels for all of the orders in an entire WARD GROUP, enter a 'G'.   To print labels for all of the orders in a WARD, enter a 'W'.  To print the",!,"labels for a single PATIENT, enter a 'P'." Q
"RTN","PSGSEL",90,0)
 ;
"RTN","PSGSEL",91,0)
TCR W !?2,"To run a TOTAL COST REPORT for an entire WARD GROUP, enter a 'G'.  To run the report for a single WARD, enter a 'W'.  To run the report for a single PATIENT,",!,"or a set of PATIENTS, enter a 'P'." Q
"RTN","PSGSEL",92,0)
 ;
"RTN","PSGSEL",93,0)
PPR W !?2,"To print PATIENT PROFILES for an entire WARD GROUP, enter a 'G'.  To print    profiles for a single WARD, enter a 'W'.  To print a profile for a single",!,"PATIENT, enter a 'P'." Q
"RTN","PSGSEL",94,0)
 ;
"RTN","PSGSEL",95,0)
AP W !?2,"To print ACTION PROFILES for an entire WARD GROUP, enter a 'G'.  To print",!,"ACTION PROFILES for a single WARD, enter a 'W'.  To print an ACTION PROFILE",!,"for a single patient, enter a 'P'.  PLEASE NOTE that only patients"
"RTN","PSGSEL",96,0)
 W " with active",!,"orders are selectable, and that only patients with active orders will print for",!,"a ward or ward group." Q
"RTN","PSGSEL",97,0)
ORVC W !?2,"To complete orders for an entire WARD GROUP, enter a 'G'. To complete orders for an entire CLINIC GROUP, enter 'CG'"
"RTN","PSGSEL",98,0)
 W "To complete orders for a single WARD, enter a 'W'.  To complete orders for a single PATIENT, enter",!,"a 'P'." Q
"VER")
8.0^22.0
"BLD",5687,6)
^169
**END**
**END**
