
=============================================================================
Run Date: NOV 09, 2005                     Designation: IVM*2*108
Package : IVM - INCOME VERIFICATION MATCH     Priority: Mandatory
Version : 2        SEQ #92                      Status: Released
                  Compliance Date: DEC 10, 2005
=============================================================================

Associated patches: (v)IVM*2*79    <<= must be installed BEFORE `IVM*2*108'
                    (v)IVM*2*102   <<= must be installed BEFORE `IVM*2*108'

Subject: IVM ADDRESS UPDATE LOG

Category: 
  - Routine
  - Data Dictionary
  - Enhancement (Mandatory)

Description:
============

 This project (patches IVM*2.0*108 and DG*5.3*658) is enhancing Address 
 HL7 Transmission uploads (ORU~Z05) and manual updates to the veteran's 
 permanent address, and fixes two problems revolving around an 
 INSTITUTION #4 File look-up API. The enhancements are in the Demographics
 Upload [IVM UPLOAD DEM] option for address updates received from the
 Health Eligibility Center (HEC). They focus on changes made in
 Registration [DG REGISTER PATIENT], Pre-Registration [DGPRE PRE-REGISTER
 OPTION], and Load/Edit Patient Data [DG LOAD PATIENT DATA]. Two new
 options, Patient Address Update [DG ADDRESS UPDATE] and IVM Address Change
 Log Report [IVM ADDRESS CHANGE LOG REPORT] are being added. A new file,
 IVM ADDRESS CHANGE LOG #301.7 File, is being added with this project to
 store and report the history of a veteran's permanent address changes. A 
 post-init routine will populate the ADDRESS CHANGE DT/TM #.118 field of
 the PATIENT #2 File if it is null. Once the cleanup has run to completion,
 an address cleanup summary MailMan message with a recap of the number of
 records processed and number of instances of the anomaly (null #.118
 field) found and corrected will be generated and sent to the installer.
  
  
 This patch (IVM*2.0*108) covers the following enhancements and 
 modifications:
  
 Issue I - Create/Implement New IVM ADDRESS CHANGE LOG #301.7 File
 ======================================================================
 The new IVM ADDRESS CHANGE LOG #301.7 File is being implemented with 
 this patch (IVM*2.0*108). A record will be created for each update to 
 the veteran's address from the following existing menu options:
 Registration [DG REGISTER PATIENT], Pre-Registration [DGPRE PRE-REGISTER
 OPTION], and Load/Edit Patient Data [DG LOAD PATIENT DATA], as well as
 from the new option Patient Address Update [DG ADDRESS UPDATE]. A record
 will also be created for all uploaded (both automatic and manually
 accepted) address changes from the Demographics Upload [IVM UPLOAD DEM]
 options.
  
 The number of records will vary from site to site depending on the 
 number of address changes incurred by the veterans. The estimated global
 growth is minimal because the enhancements being instituted with this
 project are limiting the number of required address updates. At some time
 in the future after the IVM ADDRESS CHANGE LOG #301.7 File has been able
 to collect data for a while, there are plans to re-visit the log and
 determine the possible need to purge entries from the file.
  
 The following historical Permanent Address information will be stored in 
 the new IVM ADDRESS CHANGE LOG #301.7 File:
  
       ADDRESS CHANGE DT/TM (field #.01)
       PATIENT (field #1)
       ADDRESS CHANGE USER (field #2)
       ADDRESS CHANGE SOURCE (field #3)
       ADDRESS CHANGE SITE (field #3.5)
       PRIOR ADDRESS CHANGE DT/TM (field #4)
       PRIOR ADDRESS CHANGE USER (field #5)
       PRIOR ADDRESS CHANGE SITE (field #6)
       PRIOR ADDRESS CHANGE SOURCE (field #7)
       PRIOR PHONE NUMBER [RESIDENCE] (field #8)
       PRIOR STREET ADDRESS [LINE 1] (field #9)
       PRIOR STREET ADDRESS [LINE 2] (field #10)
       PRIOR CITY [8F] (field #11)
       PRIOR COUNTY (field #12)
       PRIOR STATE (field #13)
       PRIOR ZIP+4 (field #14)
  
 Issue II - Add Functionality to Send Vet's Info to MPI for DOD Deletion
 =======================================================================
 A Demographic Data (Lazarus) ORU~Z05 HL7 Transmission is processed
 through the Demographics Upload option, and then automatically uploaded.
 This patch (IVM*2.0*108) is adding a function to transmit the veteran's
 information to the MPI, after receiving/processing a Date of Death
 deletion ORU~Z05 (Lazarus) transmission from the HEC.
  
 Issue III - Create the IVM ADDRESS CHANGE LOG REPORT
 ======================================================================
 A new option, IVM Address Change Log Report [IVM ADDRESS CHANGE LOG 
 REPORT] is being added to the IVM OUTPUT MENU option and will list 
 records where the address has changed more than once in the past 90 
 days. The report will contain the information from the IVM ADDRESS 
 CHANGE LOG #301.7 File. The functionality being delivered with this 
 project will be minimal, due to the lack of available data. After the 
 file has been installed, and records have been added, a subsequent patch 
 (IVM*2.0*106) will be updating the reporting functionality of the IVM 
 Address Change Log Report.
  
 Issue IV - Remove Bad Address Indicator (BAI)
 ======================================================================
 In the Demographics Upload option, either through an automatic upload or 
 with the manual review and acceptance of an address update, the data 
 value in the BAD ADDRESS INDICATOR #.121 field in the PATIENT #2 File
 should be removed.  This is not currently happening, and is causing an
 issue with the receipt of address updates that should not be automatically
 uploaded.  The continued existence of the BAI is causing all subsequent
 ORU~Z05 transmissions to automatically upload.  The update process for the
 IVM UPLOAD DEM option will be modified from a non-validated to a validated
 record update.  This will enable the FileMan Data Dictionary triggers to
 process the removal of the BAI (non-validated updates bypass field
 triggers).
  
  
   
 SOFTWARE RETRIEVAL
 ==================
    
 The software for this patch is not being distributed through the National
 Patch Module. This patch is being distributed as a host file. The host
 file will contain the following two KIDS builds:
    
             Host file name:    IVM_2_P108.KID
    
                     Builds: IVM*2.0*108
                             DG*5.3*658
    
 Sites may retrieve the software directly using FTP from the
 ANONYMOUS.SOFTWARE directory at the following OI Field Offices:
    
                     Albany   : ftp.fo-albany.med.va.gov
                     Hines    : ftp.fo-hines.med.va.gov
               Salt Lake City : ftp.fo-slc.med.va.gov
       First Available Server : download.vista.med.va.gov
    
 The following file will be available:
    
     File Name            Description
     ---------            -----------
     IVM_2_P108.KID       Host File containing KIDS software distribution
   
 Note:  Use ASCII mode when transferring the .KID file.
   
   
 DOCUMENTATION RETRIEVAL
 =======================
   
 Sites may retrieve the user documentation directly using FTP from the
 ANONYMOUS.SOFTWARE directory at the following OI Field Offices:
    
                 Albany   : ftp.fo-albany.med.va.gov
                 Hines    : ftp.fo-hines.med.va.gov
           Salt Lake City : ftp.fo-slc.med.va.gov
   First Available Server : download.vista.med.va.gov (preferred method)
   
                                                                          
  The following files will be available:
    
       File Name                     Description
       ---------                     -----------      
 IVM_2_P108_TM.PDF -             Updates to the IVM V. 2.0 Technical 
                                                              Manual
 IVM_2_P108_UM.PDF -             Updates to the IVM V. 2.0 User Manual 
 DG_5_3_P658_REG_UM.PDF -        Updates to the PIMS V. 5.3 Registration 
                                                             User Manual
 DG_5_3_P658_ADTBE_UM.PDF -      Updates to the PIMS V. 5.3 Menus, Intro,
                                            Orientation, etc. User Manual
  
  Note:  Use Binary mode when transferring the .PDF files.
   
  The VistA Documentation Library [VDL] web site contains all end-user 
  manuals.  The address is http://www.va.gov/vdl/.
  
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following NOIS/Remedy ticket(s):
 ---------------------------------------------------------
 HD0000000066418 - HEC transmissions for DOD removal not triggering an 
                   update to the MPI
 HD0000000106354 - Automatic Removal of Flag
  
  
 Overview of NOIS/Remedy Message(s):
 ---------------------------
 1. HD0000000066418 - HEC transmissions for DOD removal are not triggering 
 an update to the MPI.  An ADT-A31 message needs to be sent to the MPI at 
 the completion of the HEC/IVM unsolicited update so that the MPI and the 
 site data will stay in synch.
  
 2. HD0000000106354 - The Bad Address Indicator is not automatically being 
 removed when uploading an ORU~Z05 Address update either automatically or 
 manually from the IVM UPLOAD DEM option.  A four slash stuffing is being 
 used instead of a three slash, when updating the address.  This prevents 
 the trigger from firing.
    
    
 Test Sites:
 -----------
 Durham (Large)
 Puget Sound (Integrated)
 West Palm Beach (Large)
  
   
         ================INSTALLATION INSTRUCTIONS =================
  
 Note:  Because DG*5.3*658 brings in a new option, IRM should make sure 
 the Non-interactive Build Primary Menu Trees option [XQBUILDTREEQUE] is 
 scheduled to run the first night after the day these patches are
 installed.
  
 If these patches (IVM*2.0*108 and DG*5.3*658) are installed during the 
 normal workday, it is recommended that the following menu options (File 
 #19) should be disabled to prevent possible conflicts while running the
 KIDS Install. Other VistA users will not be affected.
   
               Register a Patient       [DG REGISTER PATIENT]
               Load/Edit Patient Data   [DG LOAD PATIENT DATA]
               Preregister a Patient    [DGPRE PRE-REGISTER OPTION]
               Patient Address Update   [DG ADDRESS UPDATE]
               IVM Output Menu          [IVM OUTPUT MENU]
               IVM BACKGROUND JOB       [IVM BACKGROUND JOB]            
               Demographics Upload      [IVM UPLOAD DEM]                
   
   
 This patch can be loaded with users on the system.  The patch should be 
 installed during non-peak hours.  Installation will take approximately 5 
 minutes.
   
   
        ************** PRE-INSTALLATION INSTRUCTIONS **********************
   
        You may wish to stop the HL7 filers prior to the install to prevent
        possible 'No Source Errors' from occurring. No transmissions will 
        be lost if the filers are not stopped first, they will be picked up
        once the filers are restarted.
   
        *******************************************************************
   
   
   1.   DOWNLOAD HOST KIDS FILE
        -----------------------
        Download the KIDS file IVM_2_P108.KID from the ANONYMOUS.SOFTWARE
        directory of either Albany, Hines, or the Salt Lake OI Field Office
        to the appropriate directory on your system.
    
   2.   LOAD DISTRIBUTION
        -----------------
        Use the 'LOAD A DISTRIBUTION' option on the KIDS INSTALLATION
        menu, and enter:  the directory onto which you have 
        downloaded the host file, immediately followed by IVM_2_P108.KID.
  
    
   3.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only)
        -----------------------
        Disable routine mapping on all systems for the routines listed in
        step 3 below.
    
        NOTE:  If the routines included in this patch are not currently in
               your mapped routine set, please skip this step.
    
   4.   COMPONENTS SENT WITH PATCH 
        --------------------------
        The following data dictionary has been added with this patch:
  
        #301.7    IVM ADDRESS CHANGE LOG
   
         Total number of data dictionaries - 1
   
        The following menu options were added or modified with this patch:
  
        [IVM ADDRESS CHANGE LOG REPORT]
        [IVM OUTPUT MENU]
  
         Total number of menu options added - 2
  
  
        The following is a list of the routines included in this patch.
        The second line of each of these routines now looks like:
  
             ;;2.0;INCOME VERIFICATION MATCH;**[Patch List]**; 21-OCT-94
  
                             CHECK^XTSUMBLD results
        Routine name  Before Patch   After Patch       Patch List
        ============  ============   ===========   ===================
        IVMADDRP      N/A            5750155       108
        IVMLDEM6      12913082       13276409      10,58,73,79,108
        IVMLDEMD      12239740       12407269      102,108
   
         Total number of routines - 3
  
   
   5.   START UP KIDS
        -------------
        Start up the Kernel Installation and Distribution System Menu
        [XPD MAIN]:
    
             Edits and Distribution ...
             Utilities ...
             Installation ...
    
   Select Kernel Installation & Distribution System Option: INStallation
                                                            ---
             Load a Distribution
             Print Transport Global
             Compare Transport Global to Current System
             Verify Checksums in Transport Global
             Install Package(s)
             Restart Install of Package(s)
             Unload a Distribution
             Backup a Transport Global
    
   Select Installation Option:
   
   6.   Select Installation Option:
        --------------------------
    
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter IVM*2.0*108):
    
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
   
   7.   Select Installation Option: Install Package(s)
                                    ----------------
        **This is the step to start the installation of this KIDS patch:
    
       a.  Choose the Install Package(s) option to start the patch install.
       b.  When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion
           of Install? YES//' answer NO. 
       c.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
           YES//' answer NO.
       d.  When prompted 'Want to DISABLE Scheduled Options, Menu
           Options, and Protocols? YES//' answer YES.
       e.  When prompted 'Enter options you wish to mark as 'Out Of
           Order':'  Enter the following options:
   
               Register a Patient       [DG REGISTER PATIENT]
               Load/Edit Patient Data   [DG LOAD PATIENT DATA]          
               Preregister a Patient    [DGPRE PRE-REGISTER OPTION]
               Patient Address Update   [DG ADDRESS UPDATE]
               IVM Output Menu          [IVM OUTPUT MENU]
               IVM BACKGROUND JOB       [IVM BACKGROUND JOB]            
               Demographics Upload      [IVM UPLOAD DEM]
  
  
 NOTE:  The DG build includes a post-install cleanup to populate the 
 ADDRESS CHANGE DT/TM #.118 field of the PATIENT #2 File if it was 
 previously null. Issue V in the patch description for DG*5.3*658 
 explains how the field will be populated. Once the process has run to
 completion, a MailMan message ("DG*5.3*658: ADDRESS CLEANUP - SUMMARY
 REPORT") with a recap of the number of records processed and corrected, as
 well as percentage completed, will be generated and sent to the installer.
   
   
        ************** POST-INSTALLATION INSTRUCTIONS *************
   
        1.  When the installation is complete, be sure to re-start the 
         filers if you chose to stop them. 
        2.  Make sure the Non-interactive Build Primary Menu Trees option
         [XQBUILDTREEQUE] is scheduled to run the first night after the day
         this patch is installed.
        3.  IRM should consult with Pharmacy and other coordinators to
         select menu(s) to which the new Patient Address Update [DG ADDRESS
         UPDATE] option should be added and/or users to which the new
         option should be assigned.
  
   
        ***********************************************************

Routine Information:
====================
Routine Name: IVMADDRP
Routine Name: IVMLDEM6
 Description of Changes:
  Original Code:
  --------------
    
           ; determine correct address change date/time to use
           D ADDRDT(DFN,IVMDA2,IVMDA1)
           ;
  LOOP     ; - loop thru fields in ^IVM(301.92,"AD" x-ref
    
    
           ;
           I IVMFLAG W "completed.",!
           ;
    
    
           ; - update specified address field in the Patient (#2) file
           S DIE="^DPT(",DA=DFN,DR=IVMFIELD_"////^S X=IVMVALUE"
           D ^DIE K DA,DIE,DR
    
    
           ; - check for required parameters
           Q:'$G(DFN) IVMFLAG
           ;
           S IVMDA2=$G(IVM3015)
    
    
           ...D DELETE^IVMLDEM5(IVMDA2,IVMDA1," ") ; Dummy up name parameter
           Q IVMFLAG
           ;
    
    
    
  Modified Code:
  --------------
    
           ; determine correct address change date/time to use
           D ADDRDT(DFN,IVMDA2,IVMDA1)
           ;
  LOOP     ;
           N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
           ;
           ; - loop thru fields in ^IVM(301.92,"AD" x-ref
    
    
           ;
           I IVMFLAG W "completed.",! D
           .N DGCURR
           .D GETUPDTS^DGADDUTL(DFN,.DGCURR)
           .D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGCURR)
           ;
    
    
           ; - update specified address field in the Patient (#2) file
           S DIE="^DPT(",DA=DFN,DR=IVMFIELD_"///^S X=IVMVALUE"
           D ^DIE K DA,DIE,DR
    
    
           ; - check for required parameters
           Q:'$G(DFN) IVMFLAG
           ;
           N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
           ;
           S IVMDA2=$G(IVM3015)
    
    
           ...D DELETE^IVMLDEM5(IVMDA2,IVMDA1," ") ; Dummy up name parameter
           I IVMFLAG D
           .N DGCURR
           .D GETUPDTS^DGADDUTL(DFN,.DGCURR)
           .D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGCURR)
           Q IVMFLAG
           ;

Routine Name: IVMLDEMD
 Description of Changes:
  Original Code:
  --------------
    
  AUTODEL  ;
           N DFNDOD S DFNDOD=0 I $P($G(^DPT(+DFN,.35)),U)>0 S DFNDOD=1
           F DODFIELD="ZPD09","ZPD31","ZPD32" D
           .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
           .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) 
  Q:IVMJ']""
           .; - check for data node in (#301.511) sub-file
           .S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
           .Q:'(+IVMNODE)
           .;   load Date of Death deletion rec'd from IVM into DHCP (#2) 
  file
           .I DODFIELD="ZPD09" I DFNDOD D UPLOAD(+DFN,.351,"@") S IVMFLAG=1
           .; - remove entry from (#301.511) sub-file
    
    
    
  Modified Code:
  --------------
    
  AUTODEL  ;
           N DFNDOD,DODMPI S DFNDOD=0 I $P($G(^DPT(+DFN,.35)),U)>0 S 
  DFNDOD=1
           F DODFIELD="ZPD09","ZPD31","ZPD32" D
           .S IVMI=$O(^IVM(301.92,"C",DODFIELD,"")) I IVMI="" Q
           .S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,"")) 
  Q:IVMJ']""
           .; - check for data node in (#301.511) sub-file
           .S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
           .Q:'(+IVMNODE)
           .;   load Date of Death deletion rec'd from IVM into DHCP (#2) 
  file
           .I DODFIELD="ZPD09" I DFNDOD D UPLOAD(+DFN,.351,"@") S 
  DODMPI=$$A31^MPIFA31B(+DFN),IVMFLAG=1
           .; - remove entry from (#301.511) sub-file


=============================================================================
User Information:
Entered By  : MULLER,RICHARD                Date Entered  : MAY 11, 2005
Completed By: RUDINGER,NANCY L.             Date Completed: NOV 07, 2005
Released By : GANUS,MAUNETTE                Date Released : NOV 09, 2005
=============================================================================


Packman Mail Message:
=====================

No routines included
