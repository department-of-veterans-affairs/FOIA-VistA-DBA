Released TIU*1*142 SEQ #134
Extracted from mail message
**KIDS**:TIU*1.0*142^

**INSTALL NAME**
TIU*1.0*142
"BLD",3901,0)
TIU*1.0*142^TEXT INTEGRATION UTILITIES^0^3021217^y
"BLD",3901,1,0)
^^2^2^3020924^^^
"BLD",3901,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",3901,1,2,0)
under TIU*1.0*142.
"BLD",3901,4,0)
^9.64PA^^
"BLD",3901,"ABPKG")
n
"BLD",3901,"KRN",0)
^9.67PA^8989.52^19
"BLD",3901,"KRN",.4,0)
.4
"BLD",3901,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3901,"KRN",.401,0)
.401
"BLD",3901,"KRN",.402,0)
.402
"BLD",3901,"KRN",.403,0)
.403
"BLD",3901,"KRN",.5,0)
.5
"BLD",3901,"KRN",.84,0)
.84
"BLD",3901,"KRN",3.6,0)
3.6
"BLD",3901,"KRN",3.8,0)
3.8
"BLD",3901,"KRN",9.2,0)
9.2
"BLD",3901,"KRN",9.8,0)
9.8
"BLD",3901,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3901,"KRN",9.8,"NM",1,0)
TIURS1^^0^B70138545
"BLD",3901,"KRN",9.8,"NM",2,0)
TIUCNSLT^^0^B21079184
"BLD",3901,"KRN",9.8,"NM","B","TIUCNSLT",2)

"BLD",3901,"KRN",9.8,"NM","B","TIURS1",1)

"BLD",3901,"KRN",19,0)
19
"BLD",3901,"KRN",19.1,0)
19.1
"BLD",3901,"KRN",101,0)
101
"BLD",3901,"KRN",409.61,0)
409.61
"BLD",3901,"KRN",771,0)
771
"BLD",3901,"KRN",870,0)
870
"BLD",3901,"KRN",8989.51,0)
8989.51
"BLD",3901,"KRN",8989.52,0)
8989.52
"BLD",3901,"KRN",8994,0)
8994
"BLD",3901,"KRN","B",.4,.4)

"BLD",3901,"KRN","B",.401,.401)

"BLD",3901,"KRN","B",.402,.402)

"BLD",3901,"KRN","B",.403,.403)

"BLD",3901,"KRN","B",.5,.5)

"BLD",3901,"KRN","B",.84,.84)

"BLD",3901,"KRN","B",3.6,3.6)

"BLD",3901,"KRN","B",3.8,3.8)

"BLD",3901,"KRN","B",9.2,9.2)

"BLD",3901,"KRN","B",9.8,9.8)

"BLD",3901,"KRN","B",19,19)

"BLD",3901,"KRN","B",19.1,19.1)

"BLD",3901,"KRN","B",101,101)

"BLD",3901,"KRN","B",409.61,409.61)

"BLD",3901,"KRN","B",771,771)

"BLD",3901,"KRN","B",870,870)

"BLD",3901,"KRN","B",8989.51,8989.51)

"BLD",3901,"KRN","B",8989.52,8989.52)

"BLD",3901,"KRN","B",8994,8994)

"BLD",3901,"QUES",0)
^9.62^^
"BLD",3901,"REQB",0)
^9.611^3^3
"BLD",3901,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",3901,"REQB",2,0)
TIU*1.0*131^2
"BLD",3901,"REQB",3,0)
TIU*1.0*109^2
"BLD",3901,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",3901,"REQB","B","TIU*1.0*109",3)

"BLD",3901,"REQB","B","TIU*1.0*131",2)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
142^3021217
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3021217
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*142.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUCNSLT")
0^2^B21079184
"RTN","TIUCNSLT",1,0)
TIUCNSLT ; SLC/JER - Patient movement look-up ;12/17/02
"RTN","TIUCNSLT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,31,109,131,142**;Jun 20, 1997
"RTN","TIUCNSLT",3,0)
 ; External References
"RTN","TIUCNSLT",4,0)
 ;   DBIA 2324   $$ISA^USRLM
"RTN","TIUCNSLT",5,0)
 ;   DBIA 3473   SEND^GMRCTIU
"RTN","TIUCNSLT",6,0)
 ;   DBIA 3473   GET^GMRCTIU
"RTN","TIUCNSLT",7,0)
 ;   DBIA 3575   ROLLBACK^GMRCTIU1
"RTN","TIUCNSLT",8,0)
GETCNSLT(DFN,TIUCPF,TIUDA,TIUOVR,TIUNOCS) ; Match consult result
"RTN","TIUCNSLT",9,0)
 ;to an active request
"RTN","TIUCNSLT",10,0)
 ; Call with:
"RTN","TIUCNSLT",11,0)
 ;     [DFN] - patient file entry number
"RTN","TIUCNSLT",12,0)
 ;  [TIUCPF] - flag to indicate clinical procedure (Optional)
"RTN","TIUCNSLT",13,0)
 ;  [TIUDA] - TIU document IEN of consult result (Optional).
"RTN","TIUCNSLT",14,0)
 ;            If TIUDA has a request, return it w/o asking user.
"RTN","TIUCNSLT",15,0)
 ;  [TIUOVR] - flag to override restrictions on selectable requests
"RTN","TIUCNSLT",16,0)
 ;             (Optional).  If not received or received as null, reset
"RTN","TIUCNSLT",17,0)
 ;             according to whether user is in MIS.
"RTN","TIUCNSLT",18,0)
 ;  [TIUNOCS] - Returns -1 if no consult requests for patient.
"RTN","TIUCNSLT",19,0)
 ;      Note - If DA is defined and TIU document DA has a request,
"RTN","TIUCNSLT",20,0)
 ;             code returns its request instead of asking user.
"RTN","TIUCNSLT",21,0)
 ;   Returns:     TIUY  - Variable pointer to consult request
"RTN","TIUCNSLT",22,0)
AGN ; Loop for handling repeated attempts
"RTN","TIUCNSLT",23,0)
 N TIUI,TIUII,TIUER,TIUOK,TIUOUT,TIUX,TIUY,TIUCNT,X
"RTN","TIUCNSLT",24,0)
 S TIUNOCS=""
"RTN","TIUCNSLT",25,0)
 I +DFN'>0 S TIUOUT=1 Q 0
"RTN","TIUCNSLT",26,0)
 ; Added TIUNOCS **142
"RTN","TIUCNSLT",27,0)
 I +$G(GMRCO) S TIUX=+$G(GMRCO) G GETX
"RTN","TIUCNSLT",28,0)
 ; -- If TIUDA is not defined, try DA for backward
"RTN","TIUCNSLT",29,0)
 ;    compatibility:
"RTN","TIUCNSLT",30,0)
 S TIUDA=$S('$D(TIUDA):+$G(DA),1:+TIUDA)
"RTN","TIUCNSLT",31,0)
 ; -- Ignore TIUDA if it doesn't match pt DFN:
"RTN","TIUCNSLT",32,0)
 I $P($G(^TIU(8925,TIUDA,0)),U,2)'=+DFN S TIUDA=0
"RTN","TIUCNSLT",33,0)
 ; -- If TIUDA or its parent already has a request,
"RTN","TIUCNSLT",34,0)
 ;    return it & don't ask user:
"RTN","TIUCNSLT",35,0)
 I +$P($G(^TIU(8925,TIUDA,14)),U,5) S TIUX=+$P($G(^(14)),U,5) G GETX
"RTN","TIUCNSLT",36,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUX=+$$DADCR(TIUDA) G:+TIUX>0 GETX
"RTN","TIUCNSLT",37,0)
 ; -- If override flag is null or is not defined, set it according to
"RTN","TIUCNSLT",38,0)
 ;    user's membership in MIS:
"RTN","TIUCNSLT",39,0)
 S TIUOVR=$S($G(TIUOVR)="":+$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION"),1:+TIUOVR)
"RTN","TIUCNSLT",40,0)
 D SEND^GMRCTIU(DFN,$G(TIUOVR),$G(TIUCPF))
"RTN","TIUCNSLT",41,0)
 ; If no consult requests for patient, then quit
"RTN","TIUCNSLT",42,0)
 I $S($G(^TMP("GMRCR",$J,"TIU",1,0))["No Consults":1,'$D(^TMP("GMRCR",$J,"TIU")):1,1:0) D  Q -1
"RTN","TIUCNSLT",43,0)
 . W !!,$C(7),"No CONSULT REQUESTS to Result for ",$P($G(^DPT(DFN,0)),U),".",!
"RTN","TIUCNSLT",44,0)
 . S TIUNOCS=-1
"RTN","TIUCNSLT",45,0)
 ; Added TIUNOCS to quit if no consults on CT **142
"RTN","TIUCNSLT",46,0)
 S (TIUCNT,TIUI)=0 F  S TIUI=+$O(^TMP("GMRCR",$J,"TIU",TIUI)) Q:+TIUI'>0  D
"RTN","TIUCNSLT",47,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUCNSLT",48,0)
 W !,"You must link this Result to a Consult Request...",!
"RTN","TIUCNSLT",49,0)
 D  I +TIUER Q:+$G(TIUOUT) 0  G AGN
"RTN","TIUCNSLT",50,0)
 . W !,"The following CONSULT REQUEST"
"RTN","TIUCNSLT",51,0)
 . W $S(+TIUCNT>1:"(S) are",1:" is")," available:"
"RTN","TIUCNSLT",52,0)
 . S (TIUER,TIUOK,TIUI)=0
"RTN","TIUCNSLT",53,0)
 . F  S TIUI=$O(^TMP("GMRCR",$J,"TIU",TIUI)) Q:+TIUI'>0!+TIUER!+TIUOK  D
"RTN","TIUCNSLT",54,0)
 . . S TIUII=TIUI,TIUX=$G(^TMP("GMRCR",$J,"TIU",TIUI,0))
"RTN","TIUCNSLT",55,0)
 . . D WRITE I '(TIUI#5) D BREAK
"RTN","TIUCNSLT",56,0)
 . Q:$D(TIUOUT)
"RTN","TIUCNSLT",57,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUCNSLT",58,0)
 . I TIUII#5 D BREAK Q:$D(TIUOUT)
"RTN","TIUCNSLT",59,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUCNSLT",60,0)
 . S TIUX=$O(^TMP("GMRCR",$J,"TIU","B",+TIUOK,0))
"RTN","TIUCNSLT",61,0)
 . ;,^DISV(DUZ,"^GMR(123,",DFN)=+TIUX
"RTN","TIUCNSLT",62,0)
 . W "  ",+TIUX
"RTN","TIUCNSLT",63,0)
GETX S TIUY=+TIUX_";GMR(123,"
"RTN","TIUCNSLT",64,0)
 Q $G(TIUY)
"RTN","TIUCNSLT",65,0)
BREAK ; Handle prompting
"RTN","TIUCNSLT",66,0)
 W !,"CHOOSE 1-",TIUII W:$D(^TMP("GMRCR",$J,"TIU",TIUII+1,0)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT" W ": " R X:DTIME
"RTN","TIUCNSLT",67,0)
 I $S('$T!(X["^"):1,X=""&'$D(^TMP("GMRCR",$J,"TIU",TIUII+1)):1,1:0) S TIUER=1,TIUNOCS=0 Q    ; Added TIUNOCS **142
"RTN","TIUCNSLT",68,0)
 I X="" S TIUNOCS=0 Q    ; **142
"RTN","TIUCNSLT",69,0)
 ;I X=" ",$D(^DISV(DUZ,"^GMR(123,",DFN)) S TIUX=^(DFN) I $D(TIUMLST("TIUMVDA",+TIUX)) S TIUOK=+$O(^TMP("GMRCR",$J,"TIU","C",+TIUX,0)) Q
"RTN","TIUCNSLT",70,0)
 I X'=+X!'$D(^TMP("GMRCR",$J,"TIU",+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUCNSLT",71,0)
 S TIUOK=X
"RTN","TIUCNSLT",72,0)
 Q
"RTN","TIUCNSLT",73,0)
DADCR(DA) ; Get the Consult request associated with the parent record
"RTN","TIUCNSLT",74,0)
 N TIUDADA,TIUY S TIUDADA=$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUCNSLT",75,0)
 S TIUY=$P($G(^TIU(8925,TIUDADA,14)),U,5)
"RTN","TIUCNSLT",76,0)
 Q TIUY
"RTN","TIUCNSLT",77,0)
WRITE W !,TIUX
"RTN","TIUCNSLT",78,0)
 Q
"RTN","TIUCNSLT",79,0)
POST(TIUDA,STATUS) ; Post status updates to Consult Tracking
"RTN","TIUCNSLT",80,0)
 N GMRCDA,DA,TIUAUTH S GMRCDA=+$P($G(^TIU(8925,+TIUDA,14)),U,5)
"RTN","TIUCNSLT",81,0)
 I +GMRCDA'>0 Q
"RTN","TIUCNSLT",82,0)
 S TIUAUTH=$P($G(^TIU(8925,TIUDA,12)),U,2)
"RTN","TIUCNSLT",83,0)
 D GET^GMRCTIU(GMRCDA,TIUDA,STATUS,TIUAUTH)
"RTN","TIUCNSLT",84,0)
 Q 
"RTN","TIUCNSLT",85,0)
ISCNSLT(TIUY,TITLE) ; Boolean RPC to evaluate whether TITLE is a CONSULT
"RTN","TIUCNSLT",86,0)
 N TIUCLASS
"RTN","TIUCNSLT",87,0)
 S TIUCLASS=+$$CLASS
"RTN","TIUCNSLT",88,0)
 I +TIUCLASS'>0 S TIUY=0 Q
"RTN","TIUCNSLT",89,0)
 S TIUY=+$$ISA^TIULX(TITLE,TIUCLASS)
"RTN","TIUCNSLT",90,0)
 Q
"RTN","TIUCNSLT",91,0)
CHANGE(TIUDA,TIUCPF,TIUNOCS) ; Re-direct the TIU Document to a different CT Record
"RTN","TIUCNSLT",92,0)
 N DA,DFN,DIE,DR,GMRCO,GMRCSTAT,GMRCVP,TIUD0,TIUD14
"RTN","TIUCNSLT",93,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD14=$G(^(14))
"RTN","TIUCNSLT",94,0)
 S DFN=$P(TIUD0,U,2),GMRCO=$P(TIUD14,U,5)
"RTN","TIUCNSLT",95,0)
 Q:+DFN'>0
"RTN","TIUCNSLT",96,0)
 I +GMRCO D ROLLBACK(TIUDA) K GMRCO
"RTN","TIUCNSLT",97,0)
CHAGN S DA=TIUDA,TIUNOCS=0
"RTN","TIUCNSLT",98,0)
 W ! S GMRCVP=+$$GETCNSLT(DFN,$G(TIUCPF),"","",.TIUNOCS)_";GMR(123,"
"RTN","TIUCNSLT",99,0)
 I +GMRCVP=0 W !!,$C(7),"You must select a Consult Request...Restoring record."
"RTN","TIUCNSLT",100,0)
 I +GMRCVP'>0 D RETREAT(TIUDA,TIUD14) S TIUPOP=1 Q
"RTN","TIUCNSLT",101,0)
 S DIE=8925,DA=TIUDA,DR="1405////^S X=GMRCVP" D ^DIE
"RTN","TIUCNSLT",102,0)
 S GMRCO=+GMRCVP,GMRCSTAT=$S($P(TIUD0,U,5)>6:"COMPLETED",1:"INCOMPLETE")
"RTN","TIUCNSLT",103,0)
 D POST(TIUDA,GMRCSTAT)
"RTN","TIUCNSLT",104,0)
 Q
"RTN","TIUCNSLT",105,0)
RETREAT(DA,TIUD14) ; If Pt has no requests, retreat gracefully
"RTN","TIUCNSLT",106,0)
 N DIE,DR,GMRCO,GMRCSTAT
"RTN","TIUCNSLT",107,0)
 S DIE=8925,DR="1405////^S X=$P(TIUD14,U,5)" D ^DIE
"RTN","TIUCNSLT",108,0)
 S GMRCO=+$P(TIUD14,U,5)
"RTN","TIUCNSLT",109,0)
 S GMRCSTAT=$S($P(TIUD0,U,5)>6:"COMPLETED",1:"INCOMPLETE")
"RTN","TIUCNSLT",110,0)
 D POST(TIUDA,GMRCSTAT)
"RTN","TIUCNSLT",111,0)
 Q
"RTN","TIUCNSLT",112,0)
ROLLBACK(TIUDA) ; Roll back CT Record when TIU changes require it
"RTN","TIUCNSLT",113,0)
 N GMRCDA,DIE,DR,DA S GMRCDA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUCNSLT",114,0)
 Q:+GMRCDA'>0
"RTN","TIUCNSLT",115,0)
 D ROLLBACK^GMRCTIU1(GMRCDA,TIUDA)
"RTN","TIUCNSLT",116,0)
 S DIE="^TIU(8925,",DA=TIUDA,DR="1405///@" D ^DIE
"RTN","TIUCNSLT",117,0)
 Q
"RTN","TIUCNSLT",118,0)
CLASS() ; What is the TIU Class (or Document Class) for CONSULTS
"RTN","TIUCNSLT",119,0)
 N GMRCY
"RTN","TIUCNSLT",120,0)
 S GMRCY=+$O(^TIU(8925.1,"B","CONSULTS",0))
"RTN","TIUCNSLT",121,0)
 I +GMRCY>0,$S($P($G(^TIU(8925.1,+GMRCY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S GMRCY=0
"RTN","TIUCNSLT",122,0)
 Q GMRCY
"RTN","TIURS1")
0^1^B70138545
"RTN","TIURS1",1,0)
TIURS1 ; SLC/JER - Additional /es/ actions ;12/17/02
"RTN","TIURS1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,36,58,100,109,142**;Jun 20, 1997
"RTN","TIURS1",3,0)
 ;12/11/00 Moved ELSIG,MULTIPRN,LIST here from TIURS
"RTN","TIURS1",4,0)
ELSIG ; Sign rec
"RTN","TIURS1",5,0)
 N TIULST,TIUSLST,TIURJCT,TIUES,TIUI,X,X1,Y,TIUDAARY,TIUCHNG
"RTN","TIURS1",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS1",7,0)
 I $P(TIUPRM0,U,2)'>0 W !,"Electronic signature not yet enabled." H 3 G ELSIGX
"RTN","TIURS1",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",9,0)
 S TIUI=0 I $D(VALMY)>9 D CLEAR^VALM1
"RTN","TIURS1",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",11,0)
 . N TIU0,TIU12,TIUSTAT,TIUEVNT,TIUTYPE,TIUPOP,TIU15,TIUDPRM
"RTN","TIURS1",12,0)
 . N ASK,SIGNER,COSIGNER,XTRASGNR,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURS1",13,0)
 . S (ASK,TIUPOP)=0
"RTN","TIURS1",14,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",15,0)
 . S TIUDA=$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",16,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",17,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",18,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",19,0)
 . S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS1",20,0)
 . S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS1",21,0)
 . S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS1",22,0)
 . I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS1",23,0)
 . S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS1",24,0)
 . S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS1",25,0)
 . S TIUEVNT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS1",26,0)
 . D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS1",27,0)
 . S ASK=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS1",28,0)
 . I +ASK>0 D
"RTN","TIURS1",29,0)
 . . L +^TIU(8925,+TIUDA):1
"RTN","TIURS1",30,0)
 . . E  S ASK="0^ Another user is editing this entry."
"RTN","TIURS1",31,0)
 . I +ASK'>0,$P(ASK,U,2)]"" D  I 1
"RTN","TIURS1",32,0)
 . . D FULL^VALM1
"RTN","TIURS1",33,0)
 . . W !!,"Item #",TIUI,": ",$P(ASK,U,2),! K VALMY(TIUI)
"RTN","TIURS1",34,0)
 . . W !,"Removed from signature list.",!
"RTN","TIURS1",35,0)
 . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",36,0)
 . E  D
"RTN","TIURS1",37,0)
 . . ;If document is a clinical procedures title, check if clinical
"RTN","TIURS1",38,0)
 . . ;procedure fields are required.  If the fields are required, prompt for
"RTN","TIURS1",39,0)
 . . ;them and don't permit the user to sign unless the fields are defined.
"RTN","TIURS1",40,0)
 . . I +$$ISA^TIULX(+TIU0,+$$CLASS^TIUCP),$$REQCPF^TIULP(+$P($G(^TIU(8925,+TIUDA,14)),U,5)) D  Q:+TIUPOP
"RTN","TIURS1",41,0)
 . . . N TIUCPFLD
"RTN","TIURS1",42,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",43,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need Procedure Summary Code and Date/Time Performed..."
"RTN","TIURS1",44,0)
 . . . I $G(^TIU(8925,+TIUDA,702)),$P(^(702),U)]"",$P(^(702),U,2)]"" S TIUCPFLD=1 Q
"RTN","TIURS1",45,0)
 . . . S TIUCPFLD=$$ASKCPF^TIURS(TIUDA)
"RTN","TIURS1",46,0)
 . . . I +TIUCPFLD'>0 D
"RTN","TIURS1",47,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",48,0)
 . . . . W !!,"Item #",TIUI,": MUST have a Procedure Summary Code and Date/Time Performed",!,"before you may sign."
"RTN","TIURS1",49,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",50,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",51,0)
 . . I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,DUZ):1,+$P(TIU15,U,6):1,1:0),(+$P(TIU12,U,8)'>0) D  Q:+TIUPOP
"RTN","TIURS1",52,0)
 . . . N COSIGNER
"RTN","TIURS1",53,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",54,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need cosignature..."
"RTN","TIURS1",55,0)
 . . . S COSIGNER=$$ASKCSNR^TIURS(TIUDA,DUZ)
"RTN","TIURS1",56,0)
 . . . I +COSIGNER'>0 D
"RTN","TIURS1",57,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",58,0)
 . . . . W !!,"Item #",TIUI,": MUST have a cosigner, before you may sign."
"RTN","TIURS1",59,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",60,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",61,0)
 . . N TIU,TIUY
"RTN","TIURS1",62,0)
 . . D EN^VALM("TIU SIGN/COSIGN")
"RTN","TIURS1",63,0)
 I $D(TIUSLST)'>9 D  G ELSIGX
"RTN","TIURS1",64,0)
 . S VALMSG="** Signature List Empty...Nothing signed. **"
"RTN","TIURS1",65,0)
 I $D(TIUSLST)>9 D
"RTN","TIURS1",66,0)
 . N TIUIO
"RTN","TIURS1",67,0)
 . S TIUES=$$ASKSIG^TIULA1
"RTN","TIURS1",68,0)
 . I '+TIUES S VALMSG="** Nothing Signed. **" D FIXLSTNW^TIULM Q
"RTN","TIURS1",69,0)
 . D FULL^VALM1
"RTN","TIURS1",70,0)
 . D MULTIPRN(.TIUSLST,.TIUIO)
"RTN","TIURS1",71,0)
 . S TIUI=0 F  S TIUI=$O(TIUSLST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",72,0)
 . . N TIUPY,XTRASGNR
"RTN","TIURS1",73,0)
 . . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI)),TIUDA=$P(TIUDATA,U,2)
"RTN","TIURS1",74,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",75,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",76,0)
 . . S XTRASGNR=+$P(TIUSLST(TIUI),U,3)
"RTN","TIURS1",77,0)
 . . I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS1",78,0)
 . . I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIURS1",79,0)
 . . I +TIUSLST(TIUI),(TIUIO]"") D RPC^TIUPD(.TIUPY,TIUDA,TIUIO,$P(TIUSLST(TIUI),U,2))
"RTN","TIURS1",80,0)
 . D FULL^VALM1
"RTN","TIURS1",81,0)
ELSIGX I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURS1",82,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURS1",83,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",84,0)
 S VALMBCK="R"
"RTN","TIURS1",85,0)
 D VMSG($G(TIULST),.TIUDAARY,"signed")
"RTN","TIURS1",86,0)
 Q
"RTN","TIURS1",87,0)
VMSG(TIULST,TIUDAARY,ACTION) ; Set VALMSG for messagebar, bold changed items
"RTN","TIURS1",88,0)
 N TIUI,LINENO,ACTFIRST
"RTN","TIURS1",89,0)
 S ACTFIRST=$S(ACTION="Encounter Data Edited":1,ACTION="Signers identified/edited":1,ACTION="Title changed":1,1:0)
"RTN","TIURS1",90,0)
 I TIULST']"" D  Q
"RTN","TIURS1",91,0)
 . I ACTFIRST S VALMSG="** No changes made. **" Q
"RTN","TIURS1",92,0)
 . S VALMSG="** Nothing "_ACTION_". **"
"RTN","TIURS1",93,0)
 I ACTION="copied" S ACTION="copied; See end of list"
"RTN","TIURS1",94,0)
 S TIULST=$$NEWLST(TIULST,.TIUDAARY)
"RTN","TIURS1",95,0)
 I TIULST]"" D
"RTN","TIURS1",96,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",97,0)
 . . S VALMSG="** "_ACTION_" for item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_". **"
"RTN","TIURS1",98,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_". **"
"RTN","TIURS1",99,0)
 I TIULST']"" D
"RTN","TIURS1",100,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",101,0)
 . . S VALMSG="** "_ACTION_"; item(s) no longer in list. **"
"RTN","TIURS1",102,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_", no longer in list. **"
"RTN","TIURS1",103,0)
 . ;S VALMSG="** Item(s) "_ACTION_", no longer in list. **"
"RTN","TIURS1",104,0)
 Q:$G(^TMP("TIUR",$J,"RTN"))="TIUROR"
"RTN","TIURS1",105,0)
 F TIUI=1:1 S LINENO=$P(TIULST,", ",TIUI) Q:'LINENO  D
"RTN","TIURS1",106,0)
 . D CNTRL^VALM10(LINENO,1,$G(VALM("RM")),IOINHI,IOINORM)
"RTN","TIURS1",107,0)
 Q
"RTN","TIURS1",108,0)
NEWLST(TIULST,TIUDAARY) ; Return TIULST with updated item numbers
"RTN","TIURS1",109,0)
 N TIUI,TIULNO,TIUDA,TIUNLNO,TIUNLST
"RTN","TIURS1",110,0)
 S TIUNLST=""
"RTN","TIURS1",111,0)
 F TIUI=1:1 S TIULNO=$P(TIULST,",",TIUI) Q:'TIULNO  D
"RTN","TIURS1",112,0)
 . S TIUDA=TIUDAARY(TIULNO),TIUNLNO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIURS1",113,0)
 . I TIUNLNO S TIUNLST=$G(TIUNLST)_$S($G(TIUNLST)]"":", ",1:"")_TIUNLNO
"RTN","TIURS1",114,0)
 Q TIUNLST
"RTN","TIURS1",115,0)
 ;
"RTN","TIURS1",116,0)
MULTIPRN(TIUSLST,TIUIO) ; ask device
"RTN","TIURS1",117,0)
 N TIUI,TIUASK,TIUION,TIUPOK,IO,TIUPLIST,TIUSCRN S (TIUI,TIUPOK)=0
"RTN","TIURS1",118,0)
 F  S TIUI=$O(TIUSLST(TIUI)) Q:TIUI'>0!+TIUPOK  S:+TIUSLST(TIUI) TIUPOK=1
"RTN","TIURS1",119,0)
 I '+TIUPOK S TIUIO="" Q
"RTN","TIURS1",120,0)
 S TIUPLIST=$$LIST(.TIUSLST)
"RTN","TIURS1",121,0)
 W !!,"Please specify the device for printing item"
"RTN","TIURS1",122,0)
 W $S(TIUPLIST[",":"s",TIUPLIST["-":"s",1:""),": ",TIUPLIST,!!
"RTN","TIURS1",123,0)
 S TIUSCRN="I $L($G(^%ZIS(1,+Y,""TYPE""))),("";HFS;MT;BAR;VTRM;RES;CHAN;IMPC;""'[("";""_^(""TYPE"")_"";""))"
"RTN","TIURS1",124,0)
 S TIUION=$$DEVICE^TIUDEV(.TIUIO,"LAST","N",TIUSCRN,"Q")
"RTN","TIURS1",125,0)
 I '$L(TIUION) S TIUIO=""
"RTN","TIURS1",126,0)
 D ^%ZISC
"RTN","TIURS1",127,0)
 Q
"RTN","TIURS1",128,0)
LIST(LIST) ; build print list
"RTN","TIURS1",129,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIURS1",130,0)
 F  S TIUI=$O(LIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",131,0)
 . S:+LIST(TIUI) TIUY=$G(TIUY)_$S($G(TIUY)]"":", ",1:"")_TIUI
"RTN","TIURS1",132,0)
 Q $G(TIUY)
"RTN","TIURS1",133,0)
 ;
"RTN","TIURS1",134,0)
ADDSIG(TIUDA,DA) ; Apply extra signatures to a document
"RTN","TIURS1",135,0)
 N DIE,DR
"RTN","TIURS1",136,0)
 S DIE=8925.7
"RTN","TIURS1",137,0)
 S DR=".04////"_$$NOW^TIULC_";.05////"_DUZ_";.06///^S X=$$SIGNAME^TIULS("_DUZ_");.07///^S X=$$SIGTITL^TIULS("_DUZ_");.08////E"
"RTN","TIURS1",138,0)
 D ^DIE
"RTN","TIURS1",139,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURS1",140,0)
 Q
"RTN","TIURS1",141,0)
CNVPOST ; Change Titles/Convert Postings
"RTN","TIURS1",142,0)
 N TIUI,TIULST,Y,TIUVIEW,TIUCHNG,TIUDAARY
"RTN","TIURS1",143,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinary note before changing title.",! H 3 Q
"RTN","TIURS1",144,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",145,0)
 S TIUI=0
"RTN","TIURS1",146,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURS1",147,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURS1",148,0)
 . N TIU,TIUDA,DFN,TIUDATA,VALMY,XQORM,TIUVIEW,RSTRCTD
"RTN","TIURS1",149,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",150,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",151,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",152,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",153,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",154,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURS1",155,0)
 . I +TIUVIEW'>0 D  Q  ; Exclude records user can't view
"RTN","TIURS1",156,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),! ; Echo denial message
"RTN","TIURS1",157,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",158,0)
 . S TIUCHNG=0
"RTN","TIURS1",159,0)
 . D EN^VALM("TIU CHANGE TITLE")
"RTN","TIURS1",160,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",161,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",162,0)
 ; -- Update list: --
"RTN","TIURS1",163,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURS1",164,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",165,0)
 S VALMBCK="R"
"RTN","TIURS1",166,0)
 D VMSG($G(TIULST),.TIUDAARY,"Title changed")
"RTN","TIURS1",167,0)
 Q
"RTN","TIURS1",168,0)
CNVPOST1 ; Convert Single Posting to another title
"RTN","TIURS1",169,0)
 N TIUD0,DIE,DR,TIUTITL,CHKSUM,TIUCHTTL,TIUCLSS,TIUCON
"RTN","TIURS1",170,0)
 ; Added TIUCON for **142
"RTN","TIURS1",171,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUCHNG=0
"RTN","TIURS1",172,0)
 ; Added TIUNOCS for **142
"RTN","TIURS1",173,0)
 D FULL^VALM1
"RTN","TIURS1",174,0)
 I +TIUD0=81 S TIUCHTTL="0^You may not change the TITLE of an ADDENDUM."
"RTN","TIURS1",175,0)
 I '$D(TIUCHTTL) S TIUCHTTL=$$CANDO^TIULP(TIUDA,"CHANGE TITLE")
"RTN","TIURS1",176,0)
 I +TIUCHTTL,$$DADORKID^TIUGBR(TIUDA) S TIUCHTTL="0^Interdisciplinary entries must be detached before changing titles." ;**100
"RTN","TIURS1",177,0)
 I +TIUCHTTL'>0 D  Q
"RTN","TIURS1",178,0)
 . W !!,$C(7),$P(TIUCHTTL,U,2),! ; Echo denial
"RTN","TIURS1",179,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",180,0)
 L +^TIU(8925,TIUDA,0):1
"RTN","TIURS1",181,0)
 E  D  Q
"RTN","TIURS1",182,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! ; Echo denial
"RTN","TIURS1",183,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",184,0)
 S TIUTITL=$$ASKTITLE^TIULA3(+$$CLINDOC^TIULC1(+TIUD0,TIUDA),+TIUD0)
"RTN","TIURS1",185,0)
 S TIUCLSS=$$CLASS^TIUCNSLT()
"RTN","TIURS1",186,0)
 S TIUCON=+$$ISA^TIULX(TIUTITL,TIUCLSS)
"RTN","TIURS1",187,0)
 I TIUCON=1 D CHANGE^TIUCNSLT(TIUDA,"",.TIUNOCS)
"RTN","TIURS1",188,0)
 I $G(TIUNOCS)=-1 D  Q
"RTN","TIURS1",189,0)
 . K TIUNOCS
"RTN","TIURS1",190,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")  ; **142
"RTN","TIURS1",191,0)
 S DIE=8925,DA=TIUDA
"RTN","TIURS1",192,0)
 S DR=".01////^S X="_TIUTITL_";.04////^S X="_$$DOCCLASS^TIULC1(TIUTITL)
"RTN","TIURS1",193,0)
 D ^DIE
"RTN","TIURS1",194,0)
 I +$G(^TIU(8925,+TIUDA,0))'=+TIUD0 S TIUCHNG=1
"RTN","TIURS1",195,0)
 S CHKSUM=+$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")")
"RTN","TIURS1",196,0)
 D AUDIT^TIUEDI1(TIUDA,CHKSUM,CHKSUM)
"RTN","TIURS1",197,0)
 L -^TIU(8925,TIUDA,0)
"RTN","TIURS1",198,0)
 K TIUNOCS
"RTN","TIURS1",199,0)
 Q
"VER")
8.0^22.0
**END**
**END**
