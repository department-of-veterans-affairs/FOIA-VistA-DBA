Released DG*5.3*553 SEQ #493
Extracted from mail message
**KIDS**:DG*5.3*553^

**INSTALL NAME**
DG*5.3*553
"BLD",4478,0)
DG*5.3*553^REGISTRATION^0^3031204^y
"BLD",4478,1,0)
^^1^1^3031110^
"BLD",4478,1,1,0)
Fix to ADT/HL7 messaging
"BLD",4478,4,0)
^9.64PA^^
"BLD",4478,"ABPKG")
n
"BLD",4478,"KRN",0)
^9.67PA^8989.52^19
"BLD",4478,"KRN",.4,0)
.4
"BLD",4478,"KRN",.401,0)
.401
"BLD",4478,"KRN",.402,0)
.402
"BLD",4478,"KRN",.403,0)
.403
"BLD",4478,"KRN",.5,0)
.5
"BLD",4478,"KRN",.84,0)
.84
"BLD",4478,"KRN",3.6,0)
3.6
"BLD",4478,"KRN",3.8,0)
3.8
"BLD",4478,"KRN",9.2,0)
9.2
"BLD",4478,"KRN",9.8,0)
9.8
"BLD",4478,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4478,"KRN",9.8,"NM",1,0)
VAFCCCAP^^0^B20698403
"BLD",4478,"KRN",9.8,"NM","B","VAFCCCAP",1)

"BLD",4478,"KRN",19,0)
19
"BLD",4478,"KRN",19.1,0)
19.1
"BLD",4478,"KRN",101,0)
101
"BLD",4478,"KRN",409.61,0)
409.61
"BLD",4478,"KRN",771,0)
771
"BLD",4478,"KRN",870,0)
870
"BLD",4478,"KRN",8989.51,0)
8989.51
"BLD",4478,"KRN",8989.52,0)
8989.52
"BLD",4478,"KRN",8994,0)
8994
"BLD",4478,"KRN","B",.4,.4)

"BLD",4478,"KRN","B",.401,.401)

"BLD",4478,"KRN","B",.402,.402)

"BLD",4478,"KRN","B",.403,.403)

"BLD",4478,"KRN","B",.5,.5)

"BLD",4478,"KRN","B",.84,.84)

"BLD",4478,"KRN","B",3.6,3.6)

"BLD",4478,"KRN","B",3.8,3.8)

"BLD",4478,"KRN","B",9.2,9.2)

"BLD",4478,"KRN","B",9.8,9.8)

"BLD",4478,"KRN","B",19,19)

"BLD",4478,"KRN","B",19.1,19.1)

"BLD",4478,"KRN","B",101,101)

"BLD",4478,"KRN","B",409.61,409.61)

"BLD",4478,"KRN","B",771,771)

"BLD",4478,"KRN","B",870,870)

"BLD",4478,"KRN","B",8989.51,8989.51)

"BLD",4478,"KRN","B",8989.52,8989.52)

"BLD",4478,"KRN","B",8994,8994)

"BLD",4478,"QUES",0)
^9.62^^
"BLD",4478,"REQB",0)
^9.611^1^1
"BLD",4478,"REQB",1,0)
DG*5.3*179^2
"BLD",4478,"REQB","B","DG*5.3*179",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
553^3031204
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3031204
"PKG",5,22,1,"PAH",1,1,1,0)
Fix to ADT/HL7 messaging
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VAFCCCAP")
0^1^B20698403
"RTN","VAFCCCAP",1,0)
VAFCCCAP ;ALB/CMM,PKE OUTPATIENT CAPTURE TEST ;4/12/95
"RTN","VAFCCCAP",2,0)
 ;;5.3;Registration;**91,179,553**;Jun 06, 1996
"RTN","VAFCCCAP",3,0)
 ;
"RTN","VAFCCCAP",4,0)
 ;
"RTN","VAFCCCAP",5,0)
CAP ;Only fire if check-in,check-out, add/edit add, add/edit change
"RTN","VAFCCCAP",6,0)
 I ($G(SDAMEVT)<4)!($G(SDAMEVT)>7) Q
"RTN","VAFCCCAP",7,0)
 ;quit if no change
"RTN","VAFCCCAP",8,0)
 I +$G(SDATA("BEFORE","STATUS"))=3,+$G(SDATA("AFTER","STATUS"))=3
"RTN","VAFCCCAP",9,0)
 IF  I $P($G(SDATA("AFTER","STATUS")),"^",3)'="ACTION REQ/CHECKED IN"
"RTN","VAFCCCAP",10,0)
 IF  I $P($G(SDATA("BEFORE","STATUS")),"^",3)'="NO ACTION TAKEN/TODAY" Q
"RTN","VAFCCCAP",11,0)
 ;check to see if sending is on or off
"RTN","VAFCCCAP",12,0)
 I '$P($$SEND^VAFHUTL(),"^",2) Q
"RTN","VAFCCCAP",13,0)
 ;check if protocol disabled or no clients
"RTN","VAFCCCAP",14,0)
 I $$PROTOCHK("VAFC ADT-A08-SDAM SERVER") Q
"RTN","VAFCCCAP",15,0)
 ;Queue to run NOW, returns control back to outpatient event driver
"RTN","VAFCCCAP",16,0)
 S ZTRTN="EN^VAFCCCAP",ZTDESC="PIMS Outpatient HL7 v2.3 Capture"
"RTN","VAFCCCAP",17,0)
 S ZTSAVE("SDHDL")="",ZTSAVE("SDAMEVT")="",ZTSAVE("SDATA")="",ZTSAVE("^TMP(""SDEVT"",$J,")="",ZTIO="",ZTDTH=$H
"RTN","VAFCCCAP",18,0)
 D ^%ZTLOAD
"RTN","VAFCCCAP",19,0)
 ;W !?3,$G(ZTSK)
"RTN","VAFCCCAP",20,0)
 Q
"RTN","VAFCCCAP",21,0)
 ;
"RTN","VAFCCCAP",22,0)
EN ;
"RTN","VAFCCCAP",23,0)
 N DFN,HLD,EVDT,CHK,ERR,SEND,NEW,EVENT,HOSP,THLD,PTR,REM,HPTR
"RTN","VAFCCCAP",24,0)
 ;
"RTN","VAFCCCAP",25,0)
 ;Appointments
"RTN","VAFCCCAP",26,0)
 ;
"RTN","VAFCCCAP",27,0)
 I SDAMEVT=4!(SDAMEVT=5) D
"RTN","VAFCCCAP",28,0)
 .S DFN=$P(SDATA,"^",2),EVDT=$P(SDATA,"^",3),PTR=$$GETPTR^VAFHCUTL(1),PTR=PTR_";SCE(",(CHK,UP,REM)=""
"RTN","VAFCCCAP",29,0)
 .I SDAMEVT=4 S PTR=DFN_";DPT(" ;check-in or unscheduled visit check-in
"RTN","VAFCCCAP",30,0)
 .;Need to check if deleting check-out
"RTN","VAFCCCAP",31,0)
 .;if deleting check-out and no pivot file entry exists don't send
"RTN","VAFCCCAP",32,0)
 .I +$G(SDATA("AFTER","STATUS"))=3&(+$G(SDATA("BEFORE","STATUS"))=2) S CHK=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR),PTR=$$UPPTR(DFN,EVDT) S:PTR="@" REM=1 S:+CHK>0 UP=$$UPDATE^VAFHUTL(+CHK,EVDT,PTR,REM) S:+CHK<0!(+UP<0) SEND="N"
"RTN","VAFCCCAP",33,0)
 .;set send to N if deleting and not in pivot file
"RTN","VAFCCCAP",34,0)
 .I '$D(SEND) D
"RTN","VAFCCCAP",35,0)
 ..S HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",36,0)
 ..I +HLD=-1 S HPTR=DFN_";DPT(",HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,HPTR) I +HLD'=-1 S UP=$$UPDATE^VAFHUTL(+HLD,EVDT,PTR,"")
"RTN","VAFCCCAP",37,0)
 ..I +HLD=-1 S HLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",38,0)
 ..;S EVENT=$P(HLD,":"),ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",39,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",40,0)
 ..D SETUP
"RTN","VAFCCCAP",41,0)
 ;
"RTN","VAFCCCAP",42,0)
 ;Stop codes, Add/Edits
"RTN","VAFCCCAP",43,0)
 I SDAMEVT=6!(SDAMEVT=7) D
"RTN","VAFCCCAP",44,0)
 .N HLD,STOP,THLD,REMOVE,UP
"RTN","VAFCCCAP",45,0)
 .S HLD="",STOP="N",ERR=""
"RTN","VAFCCCAP",46,0)
 .F  K EVENT S REMOVE="N",HLD=$O(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD)) Q:HLD=""!(STOP="Y")  D
"RTN","VAFCCCAP",47,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'=""&($P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",6)'="") S STOP="Y" Q
"RTN","VAFCCCAP",48,0)
 ..;If STOP="Y" stop code was not stand alone
"RTN","VAFCCCAP",49,0)
 ..;If STOP="N" stop code is stand alone
"RTN","VAFCCCAP",50,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")="" D
"RTN","VAFCCCAP",51,0)
 ...S REMOVE="Y",DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",52,0)
 ...S EVENT=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",53,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'="" D
"RTN","VAFCCCAP",54,0)
 ...S DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",55,0)
 ..I '$D(EVENT) S THLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR),EVENT=$P(THLD,":")
"RTN","VAFCCCAP",56,0)
 ..I REMOVE="Y" S PTR="@",UP=$$UPDATE^VAFHUTL(+EVENT,EVDT,PTR,1)
"RTN","VAFCCCAP",57,0)
 ..;I +EVENT>0 S ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",58,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",59,0)
 ..I +EVENT>0 D SETUP
"RTN","VAFCCCAP",60,0)
 ;
"RTN","VAFCCCAP",61,0)
EXIT ;
"RTN","VAFCCCAP",62,0)
 I +ERR<0 D ERROR(ERR,DFN)
"RTN","VAFCCCAP",63,0)
 D KILL^HLTRANS
"RTN","VAFCCCAP",64,0)
 Q
"RTN","VAFCCCAP",65,0)
 ;
"RTN","VAFCCCAP",66,0)
ERROR(PNUM,DFN) ;
"RTN","VAFCCCAP",67,0)
 ;Error message unable to generate A08 Message
"RTN","VAFCCCAP",68,0)
 N GBL S GBL="^TMP($J,""ERR"")"
"RTN","VAFCCCAP",69,0)
 I +PNUM<0 S @GBL@(0)="ERROR",@GBL@(1)=$P(PNUM,"^",2)_", unable to generate A08 Message" D EBULL^VAFHUTL2(DFN,"","",$P(GBL,")")_",")
"RTN","VAFCCCAP",70,0)
 Q
"RTN","VAFCCCAP",71,0)
 ;
"RTN","VAFCCCAP",72,0)
UPPTR(DFN,ADATE) ;
"RTN","VAFCCCAP",73,0)
 ;Have deleted checkout, update variable pointer
"RTN","VAFCCCAP",74,0)
 N PTR S PTR="@"
"RTN","VAFCCCAP",75,0)
 I $D(^DPT(DFN,"S",ADATE,0)) S PTR=DFN_";DPT("
"RTN","VAFCCCAP",76,0)
 Q PTR
"RTN","VAFCCCAP",77,0)
 ;
"RTN","VAFCCCAP",78,0)
SETUP ;
"RTN","VAFCCCAP",79,0)
 N PIVOTPTR
"RTN","VAFCCCAP",80,0)
 S EVENT=$P(HLD,":")
"RTN","VAFCCCAP",81,0)
 S EVNTINFO="^TMP(""VAFCMSG"",""EVNTINFO"","_$J_")"
"RTN","VAFCCCAP",82,0)
 K @EVNTINFO
"RTN","VAFCCCAP",83,0)
 S PIVOTPTR=+$O(^VAT(391.71,"D",EVENT,0))
"RTN","VAFCCCAP",84,0)
 I ('PIVOTPTR) S ERR="-1^Unable to create entry in ADT/HL7 PIVOT FILE" Q
"RTN","VAFCCCAP",85,0)
 S @EVNTINFO@("PIVOT")=PIVOTPTR
"RTN","VAFCCCAP",86,0)
 S @EVNTINFO@("SERVER PROTOCOL")="VAFC ADT-A08-SDAM SERVER"
"RTN","VAFCCCAP",87,0)
 S @EVNTINFO@("VAR-PTR")=PTR
"RTN","VAFCCCAP",88,0)
 S @EVNTINFO@("EVENT-NUM")=EVENT
"RTN","VAFCCCAP",89,0)
 S ERR=$$BCSTADT^VAFCMSG0(DFN,"A08",EVDT,EVNTINFO)
"RTN","VAFCCCAP",90,0)
 K @EVNTINFO
"RTN","VAFCCCAP",91,0)
 Q
"RTN","VAFCCCAP",92,0)
PROTOCHK(SPROTO) ;
"RTN","VAFCCCAP",93,0)
 ; input   server protocol
"RTN","VAFCCCAP",94,0)
 ;output   1 if disabled or has no clients
"RTN","VAFCCCAP",95,0)
 N HL
"RTN","VAFCCCAP",96,0)
 D INIT^HLFNC2(SPROTO,.HL,1)
"RTN","VAFCCCAP",97,0)
 K HLQ,HLECH,HLFS
"RTN","VAFCCCAP",98,0)
 Q $D(HL)#2
"VER")
8.0^22.0
**END**
**END**
