Released SD*5.3*356 SEQ #324
Extracted from mail message
**KIDS**:SD*5.3*356^

**INSTALL NAME**
SD*5.3*356
"BLD",5481,0)
SD*5.3*356^SCHEDULING^0^3050112^y
"BLD",5481,1,0)
^^4^4^3050112^
"BLD",5481,1,1,0)
THIS PATCH CORRECTS 2 PROBLEMS. THE FIRST FIXES THE DATE PROMPT IN THE 
"BLD",5481,1,2,0)
PRE-APPOINTMENT LETTERS. THE SECOND GIVES THE ABILITY TO PRINT A 
"BLD",5481,1,3,0)
CANCELLATION LETTER WHEN RESCHEDULING AN APPOINTMENT FOR THE SAME 
"BLD",5481,1,4,0)
DATE/TIME IN A DIFFERENT CLINIC.
"BLD",5481,4,0)
^9.64PA^^
"BLD",5481,"ABPKG")
n
"BLD",5481,"KRN",0)
^9.67PA^8989.52^19
"BLD",5481,"KRN",.4,0)
.4
"BLD",5481,"KRN",.401,0)
.401
"BLD",5481,"KRN",.402,0)
.402
"BLD",5481,"KRN",.403,0)
.403
"BLD",5481,"KRN",.5,0)
.5
"BLD",5481,"KRN",.84,0)
.84
"BLD",5481,"KRN",3.6,0)
3.6
"BLD",5481,"KRN",3.8,0)
3.8
"BLD",5481,"KRN",9.2,0)
9.2
"BLD",5481,"KRN",9.8,0)
9.8
"BLD",5481,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5481,"KRN",9.8,"NM",1,0)
SDLTP^^0^B21279101
"BLD",5481,"KRN",9.8,"NM",2,0)
SDUTL^^0^B7885799
"BLD",5481,"KRN",9.8,"NM",3,0)
SDM2^^0^B18130720
"BLD",5481,"KRN",9.8,"NM","B","SDLTP",1)

"BLD",5481,"KRN",9.8,"NM","B","SDM2",3)

"BLD",5481,"KRN",9.8,"NM","B","SDUTL",2)

"BLD",5481,"KRN",19,0)
19
"BLD",5481,"KRN",19.1,0)
19.1
"BLD",5481,"KRN",101,0)
101
"BLD",5481,"KRN",409.61,0)
409.61
"BLD",5481,"KRN",771,0)
771
"BLD",5481,"KRN",870,0)
870
"BLD",5481,"KRN",8989.51,0)
8989.51
"BLD",5481,"KRN",8989.52,0)
8989.52
"BLD",5481,"KRN",8994,0)
8994
"BLD",5481,"KRN","B",.4,.4)

"BLD",5481,"KRN","B",.401,.401)

"BLD",5481,"KRN","B",.402,.402)

"BLD",5481,"KRN","B",.403,.403)

"BLD",5481,"KRN","B",.5,.5)

"BLD",5481,"KRN","B",.84,.84)

"BLD",5481,"KRN","B",3.6,3.6)

"BLD",5481,"KRN","B",3.8,3.8)

"BLD",5481,"KRN","B",9.2,9.2)

"BLD",5481,"KRN","B",9.8,9.8)

"BLD",5481,"KRN","B",19,19)

"BLD",5481,"KRN","B",19.1,19.1)

"BLD",5481,"KRN","B",101,101)

"BLD",5481,"KRN","B",409.61,409.61)

"BLD",5481,"KRN","B",771,771)

"BLD",5481,"KRN","B",870,870)

"BLD",5481,"KRN","B",8989.51,8989.51)

"BLD",5481,"KRN","B",8989.52,8989.52)

"BLD",5481,"KRN","B",8994,8994)

"BLD",5481,"QUES",0)
^9.62^^
"BLD",5481,"REQB",0)
^9.611^3^3
"BLD",5481,"REQB",1,0)
SD*5.3*80^2
"BLD",5481,"REQB",2,0)
SD*5.3*140^2
"BLD",5481,"REQB",3,0)
SD*5.3*168^2
"BLD",5481,"REQB","B","SD*5.3*140",2)

"BLD",5481,"REQB","B","SD*5.3*168",3)

"BLD",5481,"REQB","B","SD*5.3*80",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
356^3050112
"PKG",16,22,1,"PAH",1,1,0)
^^4^4^3050112
"PKG",16,22,1,"PAH",1,1,1,0)
THIS PATCH CORRECTS 2 PROBLEMS. THE FIRST FIXES THE DATE PROMPT IN THE 
"PKG",16,22,1,"PAH",1,1,2,0)
PRE-APPOINTMENT LETTERS. THE SECOND GIVES THE ABILITY TO PRINT A 
"PKG",16,22,1,"PAH",1,1,3,0)
CANCELLATION LETTER WHEN RESCHEDULING AN APPOINTMENT FOR THE SAME 
"PKG",16,22,1,"PAH",1,1,4,0)
DATE/TIME IN A DIFFERENT CLINIC.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDLTP")
0^1^B21279101
"RTN","SDLTP",1,0)
SDLTP ;ALB/LDB - PRINT SCHEDULING LETTERS ; 11/27/00 1:53pm
"RTN","SDLTP",2,0)
 ;;5.3;Scheduling;**79,106,170,80,356**;Aug 13, 1993
"RTN","SDLTP",3,0)
R D EXIT S SD9=0,SDLT=1,DIC=407.6,DIC(0)="AEQMZ",DIC("A")="SELECT THE TYPE OF LETTER TO PRINT: ",DIC("S")="I ""^A^C^N^P^""[(""^""_$P($G(^(0)),U)_""^"")" D ^DIC G:Y'>0 EXIT S L0=Y(0,0) K DIC,DA
"RTN","SDLTP",4,0)
R1 R !,"PRINT LETTER ASSIGNED TO THE CLINIC(S)" S %=1 D YN^DICN G:'% HELP1 G:%<0 EXIT I %=1 S SDLET=0 G DIV
"RTN","SDLTP",5,0)
R2 K DIC,X,Y S DIC=407.5,DIC("S")="I $P(^(0),""^"",2)="_""""_L0_"""",DIC(0)="AEQMZ" D ^DIC G:Y'>0 EXIT S SDLET=+Y
"RTN","SDLTP",6,0)
DIV S SDLT1=SDLET,SDV1=$O(^DG(40.8,0)) K DIC,X,Y I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S DIC=40.8,DIC(0)="AEQM" D @($S(L0="P":"PALST",L0="C":"CNLET",L0="N":"NSLET1",1:"PCNLET")_"^SDDIV") G:+Y<0 R S SDV1=+Y
"RTN","SDLTP",7,0)
 S VAUTD=0,VAUTD(SDV1)=$P(^DG(40.8,SDV1,0),"^"),SDFORM=0,SDTIME="*" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=1
"RTN","SDLTP",8,0)
L0 I L0="C" D IND G:$D(DTOUT)!(%=-1) R
"RTN","SDLTP",9,0)
 S VAUTNI=2 I "AP"[L0!(L0="C"&(SD9)) D PC G:S1=-1 R I "Pp"[S1 D PAT G R:Y<0,DATE
"RTN","SDLTP",10,0)
 S SDCONC="B" I L0="P" D NCOUNT^SDAL0 I SDCONC=U G R
"RTN","SDLTP",11,0)
 D NCLINIC^SDAL0 G:Y<0 R I VAUTC D EX G:%Y="^"!($D(DTOUT)) R I $D(X),X="^" G R
"RTN","SDLTP",12,0)
DATE N %DT I L0="P" S SDT00="AEF"
"RTN","SDLTP",13,0)
 D DATE^SDUTL G:POP&('$D(SDBD)) EXIT G:POP&(X="^") EXIT S:'$D(SDED) SDED=SDBD S L2=$S(L0="C"&('SD9):"BEG1^SDC0",L0="N":"BC^SDN1",L0="P":"^SDL1",1:"^SDCNL")
"RTN","SDLTP",14,0)
QUE S DGPGM=L2,DGVAR="SDCONC^SDLT^SDFORM^SDV1^SDLT1^SDLET^VAUTD#^SDBD^SDED"_$S($D(VAUTNALL):"^VAUTNALL",1:"")_$S($D(VAUTC):"^VAUTC#",1:"")_$S($D(VAUTN):"^VAUTN#",1:"")
"RTN","SDLTP",15,0)
 S DGVAR=DGVAR_$S(L2="^SDCNL":"^SD9",1:"^SDTIME")_$S($D(S1):"^S1",1:"")_$S($D(SDVAUTC):"^SDVAUTC#",1:"")
"RTN","SDLTP",16,0)
 D ZIS^DGUTQ G:POP EXIT
"RTN","SDLTP",17,0)
 U IO D @L2
"RTN","SDLTP",18,0)
EXIT K %,%Y,A2,BEGDATE,C,DIC,DGPGM,DGVAR,DIV,DIW,DIWF,DIWL,DIWR,DIWT,ENDDATE,ENDATE,L,LL,L0,L2,POP,S1,SD9,SDC,SDDAT,SDCL,SC,SDADD,SDARRAY,SDTADB,SDTADE,SDBD,SDCONC,SDCNT,SDD,SDED,SDHX,SDIV,SDFORM,SDLET,SDLT1,SDLT,SDMDT,SDT0,SDTIME,SDV,SDV1,SDX
"RTN","SDLTP",19,0)
 K SDX1,VAUTC,VAUTN,VAUTNI,VAUTD,SDVAUTC,X,XX,Y,W,Z0,Z5,^UTILITY("SDLT"),^UTILITY($J,"W") D CLOSE^DGUTQ Q
"RTN","SDLTP",20,0)
HELP W !,"LETTER TYPE MUST EXIST IN LETTERS TYPE FILE!" S DIC=407.6 K DIC("S") D ^DIC G R
"RTN","SDLTP",21,0)
HELP1 W !,"If you want to print another letter for the selected clinic(s), you must answer",!,"""N"""_" and select another letter of the appropriate type. If you do this, that ",!,"letter will print for (ALL) the selected clinic(s)." G R1
"RTN","SDLTP",22,0)
PC R !,"Enter 'P' for individual PATIENT letters or 'C' for letters by CLINIC: P// ",S1:DTIME S:S1["^"!('$T) S1=-1 Q:S1=-1  S:S1="" S1="P" I "PCpc"'[S1 W "??" D HELP2 G PC
"RTN","SDLTP",23,0)
 Q
"RTN","SDLTP",24,0)
HELP2 W !,"Entering 'P' will allow you to select PATIENT(S) and entering a 'C' will allow",!,"you to select CLINIC(S)." Q
"RTN","SDLTP",25,0)
PAT S VAUTNI=2,VAUTNALL=1 D PATIENT^VAUTOMA Q
"RTN","SDLTP",26,0)
EX S SDCNT=0 W !,"Do you want to exclude any Clinic(s)" S %=2 D YN^DICN I '% W !,"RESPOND YES OR NO" G EX
"RTN","SDLTP",27,0)
 K SDVAUTC Q:%-1
"RTN","SDLTP",28,0)
EXASK S DIC=44,DIC(0)="AEQM",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))",DIC("A")="Select Clinic to be excluded: " D ^DIC K DIC("A"),DIC("S") Q:"^"[X  G:Y<0 EXASK I $D(SDVAUTC(+Y)) W !,*7,"THIS CLINIC HAS ALREADY BEEN SELECTED!" G EXASK
"RTN","SDLTP",29,0)
 S SDCNT=SDCNT+1,SDVAUTC(+Y)="" W " ...OK" W:SDCNT'<10 !,*7,"ONLY TEN CLINICS ARE ALLOWED TO BE SELECTED!" G:SDCNT<10 EXASK
"RTN","SDLTP",30,0)
 Q
"RTN","SDLTP",31,0)
MAX W !,*7,"NO MORE THAN TEN CLINICS ALLOWED TO BE EXCLUDED" Q
"RTN","SDLTP",32,0)
IND S %=1,SD9=0 W !,"DID CLINIC CANCEL AVAILABILITY" D YN^DICN I '% D HLP3 G IND
"RTN","SDLTP",33,0)
 S:%-1 SD9=1 Q
"RTN","SDLTP",34,0)
HLP3 W !!,"If the clinic was cancelled for any length of time respond 'Y'.",!,"If individual appointments were cancelled without cancelling the clinic respond 'N'",! Q
"RTN","SDLTP",35,0)
 W !,"CLINIC CANCELLATION LETTERS will be selectable with 'C' response.",! Q
"RTN","SDM2")
0^3^B18130720
"RTN","SDM2",1,0)
SDM2 ;SF/GFT - MAKE APPOINTMENT ; 07 Jan 2000  6:30 PM
"RTN","SDM2",2,0)
 ;;5.3;Scheduling;**32,132,168,356**;Aug 13, 1993
"RTN","SDM2",3,0)
 W *7,!,"PATIENT ALREADY HAS APPOINTMENT "
"RTN","SDM2",4,0)
 N SDATA,SDCMHDL ; for evt dvr
"RTN","SDM2",5,0)
 I $D(^DPT(DFN,"S",SD,0)),$P(^(0),"^",2)'["C" S S=SD,I=+^(0) D FLEN W "(",APL," MINUTES) THEN" D IN,PROT G:$D(SDPROT) ^SDM1 R ".",!,"  DO YOU WANT TO CANCEL IT? ",X:DTIME S X=$$UP^XLFSTR(X) D:X?1"Y".A STAT G CAN:X?1"Y".A W "??",*7 G ^SDM1
"RTN","SDM2",6,0)
SDAY S %=1 W "ON THE SAME DAY (" D AT,IN W ") ...OK" D YN^DICN I '% W !,"RESPOND YES OR NO",!,"PATIENT ALREADY HAS APPOINTMENT " G SDAY
"RTN","SDM2",7,0)
 G ^SDM1:(%-1),PRECAN^SDM1
"RTN","SDM2",8,0)
 ;
"RTN","SDM2",9,0)
CAN Q:'$D(^SC(I,"SL"))  S SCI=I,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDM2",10,0)
 S SD17=$P(^DPT(DFN,"S",S,0),"^") K ^SC("ARAD",I,S,DFN) S (DA,SDSY)=0 F SDSX=0:0 S SDSX=$O(^SC(I,"S",S,1,SDSX)) Q:'SDSX  Q:'$D(^(SDSX,0))  D C Q:SDSY&(DA)
"RTN","SDM2",11,0)
 I $D(^DPT("ASDPSD","B",DIV,$P(S,"."),DFN)) D CK1
"RTN","SDM2",12,0)
 G OUT:'SDSY S SL1=$P(^SC(I,"S",S,1,SDSY,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDM2",13,0)
 S SDRT="D",SDTTM=SD,SDPL=SDSY,SDSC=I D RT^SDUTL
"RTN","SDM2",14,0)
 I I'=SC D
"RTN","SDM2",15,0)
 .W !
"RTN","SDM2",16,0)
 .S DIR("A")="DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT"
"RTN","SDM2",17,0)
 .S DIR("A",1)="THIS IS THE ONLY OPPORTUNITY.",DIR("B")="YES"
"RTN","SDM2",18,0)
 .S DIR(0)="Y" D ^DIR W !
"RTN","SDM2",19,0)
 .Q:(Y'=1)
"RTN","SDM2",20,0)
 .N SDWH,A,SC,SDCL S SDWH="P",A=+DFN,SDCL(1)=I_"^"_S N DFN
"RTN","SDM2",21,0)
 .S %ZIS("A")="Device for cancellation letter: ",%ZIS("B")=""
"RTN","SDM2",22,0)
 .D ^%ZIS Q:POP  U IO
"RTN","SDM2",23,0)
 .D SDLET^SDCNP1A
"RTN","SDM2",24,0)
 .D ^%ZISC
"RTN","SDM2",25,0)
 K ^SC(I,"S",S,1,SDSY)
"RTN","SDM2",26,0)
 I '$D(^SC(I,"ST",$P(SD,"."),1)) G OUT
"RTN","SDM2",27,0)
 S SD1(1)=^SC(I,"SL"),SD1=$P(SD1(1),"^",3),SB1=$S(SD1:SD1,1:8)-1/100,SD1=$P(SD1(1),"^",6),HSI1=$S(SD1:SD1,1:4),SI1=$S(SD1="":4,SD1<3:4,SD1:SD1,1:4),SDDIF1=$S(HSI1<3:8/HSI1,1:2) K SD1
"RTN","SDM2",28,0)
 S S=^SC(I,"ST",$P(SD,"."),1),SDQ=SD#1-SB1*100,ST=SDQ#1*SI1\.6+($P(SDQ,".")*SI1),SS=SL1*HSI1/60
"RTN","SDM2",29,0)
 I SDQ'<1 F I=ST+ST:SDDIF1 S SDQ=$E(STR,$F(STR,$E(S,I+1))) Q:SDQ=""  S S=$E(S,1,I)_SDQ_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDM2",30,0)
 S ^(1)=S K SL1,SB1,SDDIF1,HSI1,SI1,SDQ ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDM2",31,0)
OUT D EVT Q:$D(SDNSF)  W *7,!,"APPOINTMENT IN ",$P(^SC(SCI,0),"^",1)," CANCELLED!" S X=SD D DOW^SDM1 W !,"APPOINTMENT NOW BEING MADE IN ",$P(^SC(SC,0),"^",1) K SCI G S^SDM1
"RTN","SDM2",32,0)
 ;
"RTN","SDM2",33,0)
C I +^SC(I,"S",S,1,SDSX,0)=DFN,$P(^(0),"^",9)'["C" S SDSY=SDSX Q
"RTN","SDM2",34,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=SDSX Q  ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDSX,"OB")
"RTN","SDM2",35,0)
 ;
"RTN","SDM2",36,0)
AT W "AT ",$E(S_0,9,10),":",$E(S_"000",11,12) Q
"RTN","SDM2",37,0)
IN W:SC-I&$D(^SC(I,0)) " IN ",$P(^(0),U,1) Q
"RTN","SDM2",38,0)
PROT K SDPROT
"RTN","SDM2",39,0)
 I $D(^SC(I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(I,"SDPRIV",DUZ)) D  Q
"RTN","SDM2",40,0)
 .W !!,*7,">>> Access to ",$$CNAM(I)," is prohibited!"
"RTN","SDM2",41,0)
 .W !,"    Only users with a special code may access this clinic.",!
"RTN","SDM2",42,0)
 .S SDPROT=""
"RTN","SDM2",43,0)
 ;
"RTN","SDM2",44,0)
 I $$CODT^SDCOU(DFN,SD,I) D  Q
"RTN","SDM2",45,0)
 .W !?5,*7,">>> A check out date has been entered for this appointment!"
"RTN","SDM2",46,0)
 .W !?5,"    Please enter another date and time.   Thank you.",!
"RTN","SDM2",47,0)
 .S SDPROT=""
"RTN","SDM2",48,0)
 Q
"RTN","SDM2",49,0)
 ;
"RTN","SDM2",50,0)
CNAM(SDCL) ;Return clinic name
"RTN","SDM2",51,0)
 ;Input: SDCL=clinic ien
"RTN","SDM2",52,0)
 N SDX
"RTN","SDM2",53,0)
 S SDX=$P($G(^SC(+SDCL,0)),U)
"RTN","SDM2",54,0)
 Q $S($L(SDX):SDX,1:"this clinic")
"RTN","SDM2",55,0)
 ;
"RTN","SDM2",56,0)
FLEN S APL="" I $D(^SC(I,"S",SD)) F ZL=0:0 S ZL=$O(^SC(I,"S",SD,1,ZL)) Q:ZL=""  I +^(ZL,0)=DFN S APL=$P(^SC(I,"S",SD,1,ZL,0),"^",2)
"RTN","SDM2",57,0)
 Q
"RTN","SDM2",58,0)
 ;
"RTN","SDM2",59,0)
DISP G ^SDM1 ; LINE TAG IS NO LONGER USED
"RTN","SDM2",60,0)
 ;W !?4 K S F SDQ=Y:0 S SDQ=$N(^SC(SC,"S",SDQ)) Q:Y+1<SDQ!(SDQ<0)  F I=0:0 S I=$N(^SC(SC,"S",SDQ,1,I)) Q:I'>0  Q:'$D(^(I,0))  S ST=$S($P(^(0),U,4)="":"BLANK",1:"'"_$E($P(^(0),U,4),1,28)_"'"),S(ST)=$S($D(S(ST)):S(ST)+1,1:1)
"RTN","SDM2",61,0)
 ;I '$D(S) W "NO APPNT'S SCHEDULED YET" G ^SDM1
"RTN","SDM2",62,0)
 ;W "'OTHER' TYPES ALREADY SCHEDULED:   ",!
"RTN","SDM2",63,0)
 ;S S=0 F I=0:1 S S=$N(S(S)) G ^SDM1:S=-1 W:$X+$L(S)>72 ! W S,": ",S(S),"     "
"RTN","SDM2",64,0)
CK1 S SDZ=0 F SD1=$P(S,"."):0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDZ=1 Q
"RTN","SDM2",65,0)
 Q:SDZ  F SD1=2,4 I $D(^SC("AAS",SD1,$P(S,"."),DFN)) S SDZ=1 Q
"RTN","SDM2",66,0)
 Q:SDZ  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDM2",67,0)
 Q:SDZ  K ^DPT("ASDPSD","B",DIV,$P(S,"."),DFN) Q
"RTN","SDM2",68,0)
STAT N X S SDCMHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,SD,I,"",SDCMHDL),NOW^%DTC
"RTN","SDM2",69,0)
 S $P(^DPT(DFN,"S",SD,0),"^",2)="C",$P(^(0),"^",14)=$E(%,1,12) S:$D(DUZ) $P(^(0),"^",12)=DUZ S ^DPT("ASDCN",+^(0),SD,DFN)="" Q
"RTN","SDM2",70,0)
 ;
"RTN","SDM2",71,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM2",72,0)
 ; -- cancel event
"RTN","SDM2",73,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCMHDL)
"RTN","SDM2",74,0)
 Q
"RTN","SDUTL")
0^2^B7885799
"RTN","SDUTL",1,0)
SDUTL ;MAN/GRR - SCHEDULING UTILITY PROGRAM ; 18 JUN 84  11:31 AM
"RTN","SDUTL",2,0)
 ;;5.3;Scheduling;**140,356**;Aug 13, 1993
"RTN","SDUTL",3,0)
DATE S:$D(%DT(0)) SDT0=%DT(0) S:$D(SDT00) %DT=SDT00 S POP=0 K BEGDATE,ENDDATE W !!,"**** Date Range Selection ****"
"RTN","SDUTL",4,0)
 W ! S %DT=$S($D(SDT00):SDT00,1:"AE"),%DT("A")="   Beginning DATE : "
"RTN","SDUTL",5,0)
 D ^%DT S:Y<0 POP=1 G:Y<0 EX S (BEGDATE,SDBD)=Y
"RTN","SDUTL",6,0)
 W ! S %DT=$S($D(SDT00):SDT00,1:"AE"),%DT("A")="   Ending    DATE : "
"RTN","SDUTL",7,0)
 D ^%DT K %DT S:Y<0 POP=1 G:Y<0 EX G:Y<SDBD HELP W ! S (ENDDATE,SDED)=Y
"RTN","SDUTL",8,0)
EX K SDT0,SDT00 Q
"RTN","SDUTL",9,0)
 ;
"RTN","SDUTL",10,0)
Q G QUE^DGUTQ
"RTN","SDUTL",11,0)
 ;
"RTN","SDUTL",12,0)
DQ G DQ^DGUTQ
"RTN","SDUTL",13,0)
 ;
"RTN","SDUTL",14,0)
ZIS G ZIS^DGUTQ
"RTN","SDUTL",15,0)
 K PGM,VAL,VAR Q
"RTN","SDUTL",16,0)
 ;
"RTN","SDUTL",17,0)
CLOSE G CLOSE^DGUTQ Q
"RTN","SDUTL",18,0)
 Q
"RTN","SDUTL",19,0)
TIME D DT S SDZ01=$H,SDTIME=$P(SDZ01,",",2),SDTIME=DT_(SDTIME\60#60/100+(SDTIME\3600)/100)
"RTN","SDUTL",20,0)
 Q
"RTN","SDUTL",21,0)
ETIME S Y=(X-SD00)*86400,X1=$P(X,",",2),X2=$P(SD00,",",2),X3=Y-X2+X1,X=X3\3600,X1=X3#3600\60
"RTN","SDUTL",22,0)
 Q
"RTN","SDUTL",23,0)
OUT W *7 I ($Y+4)<IOSL F SDXX=$Y:1:IOSL-4 W !
"RTN","SDUTL",24,0)
 R !!,"Press return to continue or ""^"" to escape ",X:DTIME I X["^"!('$T) S SDEND=1
"RTN","SDUTL",25,0)
 Q
"RTN","SDUTL",26,0)
DTS S Y=$TR($$FMTE^XLFDT(Y,"5DF")," ","0") Q
"RTN","SDUTL",27,0)
DT K %DT S X="T" D ^%DT S DT=Y,U="^" Q
"RTN","SDUTL",28,0)
DIV I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2)
"RTN","SDUTL",29,0)
 Q
"RTN","SDUTL",30,0)
AT S Y1=$S(+$P(Y,".",2):"."_$P(Y,".",2),1:""),Y=$S(+$P(Y,".",1):$P(Y,".",1),1:"")
"RTN","SDUTL",31,0)
 I Y]"" D D^DIQ
"RTN","SDUTL",32,0)
 I Y1]"" S Y1=$E($P(Y1,".",2)_"0000",1,4),Y2=Y1>1159 S:Y1>1259 Y1=Y1-1200 S Y1=Y1\100_":"_$E(Y1#100+100,2,3)_" "_$E("AP",Y2+1)_"M"
"RTN","SDUTL",33,0)
 I Y]"",Y1]"" S Y=Y_" @"_Y1
"RTN","SDUTL",34,0)
 I Y']"",Y1]"" S Y=Y1
"RTN","SDUTL",35,0)
 K Y1,Y2 Q
"RTN","SDUTL",36,0)
LAPPT W *7,!,"Appointment length is inconsistent with inc/hr (",SDZ0,") for this clinic" K X
"RTN","SDUTL",37,0)
 Q
"RTN","SDUTL",38,0)
RT Q:$S(SDTTM<DT:1,'$D(^DIC(195.4,1,"UP")):1,'^("UP"):1,1:0)
"RTN","SDUTL",39,0)
 I SDRT="A" D QUE^RTQ2 Q
"RTN","SDUTL",40,0)
 I SDRT="D",$D(^SC(SDSC,"S",SDTTM,1,SDPL,"RTR")),^("RTR") S RTPAR=+^("RTR") D CANCEL^RTQ2 K RTPAR Q
"RTN","SDUTL",41,0)
 Q
"RTN","SDUTL",42,0)
 ;
"RTN","SDUTL",43,0)
RTSET I $D(^SC(SDSC,"S",SDTTM,1,SDPL,0)),DFN=+^(0),$P(^(0),"^",9)'["C",'$D(^("RTR")) S ^("RTR")=RTPAR
"RTN","SDUTL",44,0)
 Q
"RTN","SDUTL",45,0)
NOTES K IOP S L=0,DIC="^DIC(9.4,",FLDS="[SDREL]",BY="[SDREL]",FR="""SCHEDULING"",3.8",TO=FR,DHD="SCHEDULING V3.8 RELEASE NOTES" G EN1^DIP
"RTN","SDUTL",46,0)
I S:'$D(DTIME) DTIME=300 D:'$D(DT) DT S:'$D(U) U="^" Q
"RTN","SDUTL",47,0)
HELP W "??",!?5,"Ending date must not be before beginning date" S:$D(SDT0) %DT(0)=SDT0 G DATE
"VER")
8.0^22.0
**END**
**END**
