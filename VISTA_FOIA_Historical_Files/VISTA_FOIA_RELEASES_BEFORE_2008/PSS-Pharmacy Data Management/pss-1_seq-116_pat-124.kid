Released PSS*1*124 SEQ #116
Extracted from mail message
**KIDS**:PSS*1.0*124^

**INSTALL NAME**
PSS*1.0*124
"BLD",7187,0)
PSS*1.0*124^PHARMACY DATA MANAGEMENT^0^3070823^y
"BLD",7187,1,0)
^^6^6^3070823^
"BLD",7187,1,1,0)
This patch will correct the issues reported in:
"BLD",7187,1,2,0)
  
"BLD",7187,1,3,0)
1) HD68616  - PSSMARK   DRUG INACTIVE DATE IN FUTURE BLOCKS CMOP MARK
"BLD",7187,1,4,0)
TODAY
"BLD",7187,1,5,0)
2) HD70218  - PSSHLU    Drug file edits change value in orderable item
"BLD",7187,1,6,0)
file
"BLD",7187,4,0)
^9.64PA^^
"BLD",7187,6.3)
2
"BLD",7187,"ABPKG")
n
"BLD",7187,"KRN",0)
^9.67PA^8989.52^19
"BLD",7187,"KRN",.4,0)
.4
"BLD",7187,"KRN",.401,0)
.401
"BLD",7187,"KRN",.402,0)
.402
"BLD",7187,"KRN",.403,0)
.403
"BLD",7187,"KRN",.5,0)
.5
"BLD",7187,"KRN",.84,0)
.84
"BLD",7187,"KRN",3.6,0)
3.6
"BLD",7187,"KRN",3.8,0)
3.8
"BLD",7187,"KRN",9.2,0)
9.2
"BLD",7187,"KRN",9.8,0)
9.8
"BLD",7187,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",7187,"KRN",9.8,"NM",2,0)
PSSHLU^^0^B9158562
"BLD",7187,"KRN",9.8,"NM",3,0)
PSSMARK^^0^B43854225
"BLD",7187,"KRN",9.8,"NM","B","PSSHLU",2)

"BLD",7187,"KRN",9.8,"NM","B","PSSMARK",3)

"BLD",7187,"KRN",19,0)
19
"BLD",7187,"KRN",19.1,0)
19.1
"BLD",7187,"KRN",101,0)
101
"BLD",7187,"KRN",409.61,0)
409.61
"BLD",7187,"KRN",771,0)
771
"BLD",7187,"KRN",870,0)
870
"BLD",7187,"KRN",8989.51,0)
8989.51
"BLD",7187,"KRN",8989.52,0)
8989.52
"BLD",7187,"KRN",8994,0)
8994
"BLD",7187,"KRN","B",.4,.4)

"BLD",7187,"KRN","B",.401,.401)

"BLD",7187,"KRN","B",.402,.402)

"BLD",7187,"KRN","B",.403,.403)

"BLD",7187,"KRN","B",.5,.5)

"BLD",7187,"KRN","B",.84,.84)

"BLD",7187,"KRN","B",3.6,3.6)

"BLD",7187,"KRN","B",3.8,3.8)

"BLD",7187,"KRN","B",9.2,9.2)

"BLD",7187,"KRN","B",9.8,9.8)

"BLD",7187,"KRN","B",19,19)

"BLD",7187,"KRN","B",19.1,19.1)

"BLD",7187,"KRN","B",101,101)

"BLD",7187,"KRN","B",409.61,409.61)

"BLD",7187,"KRN","B",771,771)

"BLD",7187,"KRN","B",870,870)

"BLD",7187,"KRN","B",8989.51,8989.51)

"BLD",7187,"KRN","B",8989.52,8989.52)

"BLD",7187,"KRN","B",8994,8994)

"BLD",7187,"QUES",0)
^9.62^^
"BLD",7187,"REQB",0)
^9.611^3^2
"BLD",7187,"REQB",1,0)
PSS*1.0*38^1
"BLD",7187,"REQB",3,0)
PSS*1.0*82^1
"BLD",7187,"REQB","B","PSS*1.0*38",1)

"BLD",7187,"REQB","B","PSS*1.0*82",3)

"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,20,0)
^9.402P^^
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
124^3070823
"PKG",488,22,1,"PAH",1,1,0)
^^6^6^3070823
"PKG",488,22,1,"PAH",1,1,1,0)
This patch will correct the issues reported in:
"PKG",488,22,1,"PAH",1,1,2,0)
  
"PKG",488,22,1,"PAH",1,1,3,0)
1) HD68616  - PSSMARK   DRUG INACTIVE DATE IN FUTURE BLOCKS CMOP MARK
"PKG",488,22,1,"PAH",1,1,4,0)
TODAY
"PKG",488,22,1,"PAH",1,1,5,0)
2) HD70218  - PSSHLU    Drug file edits change value in orderable item
"PKG",488,22,1,"PAH",1,1,6,0)
file
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSSHLU")
0^2^B9158562^B8895894
"RTN","PSSHLU",1,0)
PSSHLU ;BIR/RLW-UTILITIES USED IN BUILDING HL7 SEGMENTS ;11/14/96
"RTN","PSSHLU",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**38,124**;9/30/97;Build 2
"RTN","PSSHLU",3,0)
 ;
"RTN","PSSHLU",4,0)
INIT ; set up HL7 application variables
"RTN","PSSHLU",5,0)
 ;I '$D(HLNDAP) S HLNDAP=0,HLNDAP=$O(^HL(770,"B","OE/RR",HLNDAP)),HLSDT="PS" D INIT^HLTRANS I $D(HLERR) W !!?7,"THE HL7 INITIALIZATION FAILED",!! Q
"RTN","PSSHLU",6,0)
 S PSJI=1
"RTN","PSSHLU",7,0)
 S PSSHINST=$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),"^",17),99)),"^") S ^TMP("HLS",$J,"PS",PSJI)="MSH|^~\&|PHARMACY|"_$G(PSSHINST)_"|||||MFN" K PSSHINST
"RTN","PSSHLU",8,0)
 S PSJCLEAR="F J=0:1:LIMIT S FIELD(J)="""""
"RTN","PSSHLU",9,0)
 Q
"RTN","PSSHLU",10,0)
 ;
"RTN","PSSHLU",11,0)
SEGMENT(LIMIT) ;
"RTN","PSSHLU",12,0)
 N SUBSEG,SEGLENGT S SUBSEG=0,SEGMENT(SUBSEG)="" F J=0:1:LIMIT D
"RTN","PSSHLU",13,0)
 .I SEGMENT(SUBSEG)']"" S SEGMENT(SUBSEG)=FIELD(J) Q
"RTN","PSSHLU",14,0)
 .S SEGLENGT=$L(SEGMENT(SUBSEG))+$L(FIELD(J))
"RTN","PSSHLU",15,0)
 .I SEGLENGT<245 S SEGMENT(SUBSEG)=SEGMENT(SUBSEG)_"|"_FIELD(J) Q
"RTN","PSSHLU",16,0)
 .I $L(SEGMENT(SUBSEG))=245 S SUBSEG=SUBSEG+1,SEGMENT(SUBSEG)="|"_FIELD(J) Q
"RTN","PSSHLU",17,0)
 .S SEGMENT(SUBSEG)=SEGMENT(SUBSEG)_"|"_$E(FIELD(J),1,244-$L(SEGMENT(SUBSEG))),SUBSEG=SUBSEG+1,SEGMENT(SUBSEG)=$E(FIELD(J),SEGLENGT-245,SEGLENGT+1)
"RTN","PSSHLU",18,0)
 S PSJI=PSJI+1,^TMP("HLS",$J,"PS",PSJI)=SEGMENT(0)
"RTN","PSSHLU",19,0)
 F J=1:1 Q:'$D(SEGMENT(J))  S ^TMP("HLS",$J,"PS",PSJI,J)=SEGMENT(J)
"RTN","PSSHLU",20,0)
 Q
"RTN","PSSHLU",21,0)
 ;
"RTN","PSSHLU",22,0)
CALL(HLEVN) ; call DHCP HL7 package -or- protocol, to pass Orders
"RTN","PSSHLU",23,0)
 ; HLEVN = number of segments in message
"RTN","PSSHLU",24,0)
 ;D EN^HLTRANS W:$D(HLERR) !!?7,"***ERROR IN CREATING HL7 MAIL MESSAGE***"
"RTN","PSSHLU",25,0)
 S MSG="^TMP(""HLS"",$J,""PS"")"
"RTN","PSSHLU",26,0)
 D MSG^XQOR("PS EVSEND OR",.MSG)
"RTN","PSSHLU",27,0)
 Q
"RTN","PSSHLU",28,0)
 ;
"RTN","PSSHLU",29,0)
MF(HLEVN) ; call DHCP HL7 -or- protocol, to pass Master File transactions
"RTN","PSSHLU",30,0)
 ; HLEVN = number of segments in message
"RTN","PSSHLU",31,0)
 ;D EN^HLTRANS W:$D(HLERR) !!?7,"***ERROR IN CREATING HL7 MAIL MESSAGE***"
"RTN","PSSHLU",32,0)
 S MSG="^TMP(""HLS"",$J,""PS"")"
"RTN","PSSHLU",33,0)
 D MSG^XQOR("PS MFSEND OR",.MSG)
"RTN","PSSHLU",34,0)
 Q
"RTN","PSSHLU",35,0)
 ;
"RTN","PSSHLU",36,0)
SCH(HLEVN)         ; call to pass Schedule file to OE/RR
"RTN","PSSHLU",37,0)
 S MSG="^TMP(""HLS"",$J,""PS"")"
"RTN","PSSHLU",38,0)
 D MSG^XQOR("PS EVSEND SCH",.MSG)
"RTN","PSSHLU",39,0)
 Q
"RTN","PSSHLU",40,0)
 ;
"RTN","PSSHLU",41,0)
USAGE(POI) ;
"RTN","PSSHLU",42,0)
 N USAGE,PSSDDINX,I F I="O","I","B","A","V" S USAGE(I)=0
"RTN","PSSHLU",43,0)
 I $P($G(^PS(50.7,POI,0)),"^",3) G IVFLAG
"RTN","PSSHLU",44,0)
 S I="" F PSSDDINX=0:0 S PSSDDINX=$O(^PS(50.7,"A50",POI,PSSDDINX)) Q:'PSSDDINX  D
"RTN","PSSHLU",45,0)
 .I '$P($G(^PSDRUG(PSSDDINX,"I")),"^")!(+$P($G(^("I")),"^")>DT) D
"RTN","PSSHLU",46,0)
 ..S USAGE=$P($G(^PSDRUG(PSSDDINX,2)),"^",3),USAGE=$TR(USAGE,"U","I") F I="O","I" S:USAGE[I USAGE(I)=USAGE(I)+1
"RTN","PSSHLU",47,0)
 .N PSSOAD,PSSOSD
"RTN","PSSHLU",48,0)
 .F PSSOAD=0:0 S PSSOAD=$O(^PSDRUG("A526",PSSDDINX,PSSOAD)) Q:'PSSOAD  D
"RTN","PSSHLU",49,0)
 ..Q:$P($G(^PS(52.6,PSSOAD,"I")),"^")&(+$P($G(^PS(52.6,PSSOAD,"I")),"^")'>DT)
"RTN","PSSHLU",50,0)
 ..S USAGE("I")=USAGE("I")+1,USAGE("V")=USAGE("V")+1
"RTN","PSSHLU",51,0)
 ..I $P($G(^PS(52.6,PSSOAD,0)),"^",13) S USAGE("A")=USAGE("A")+1
"RTN","PSSHLU",52,0)
 .F PSSOSD=0:0 S PSSOSD=$O(^PSDRUG("A527",PSSDDINX,PSSOSD)) Q:'PSSOSD  D
"RTN","PSSHLU",53,0)
 ..Q:$P($G(^PS(52.7,PSSOSD,"I")),"^")&(+$P($G(^PS(52.7,PSSOSD,"I")),"^")'>DT)
"RTN","PSSHLU",54,0)
 ..S USAGE("I")=USAGE("I")+1,USAGE("V")=USAGE("V")+1
"RTN","PSSHLU",55,0)
 ..I $P($G(^PS(52.7,PSSOSD,0)),"^",13) S USAGE("B")=USAGE("B")+1
"RTN","PSSHLU",56,0)
 I $G(DEA)[2,USAGE("O")>0 S USAGE("O")=0  ;; <*124 RJS>
"RTN","PSSHLU",57,0)
IVFLAG ;
"RTN","PSSHLU",58,0)
 S USAGE="" F I="O","I","B","A","V" S USAGE=USAGE_I_USAGE(I)
"RTN","PSSHLU",59,0)
 Q USAGE
"RTN","PSSMARK")
0^3^B43854225^B43019250
"RTN","PSSMARK",1,0)
PSSMARK ;BIR/WRT-Review single NDF matches for CMOP ; 10/27/98 13:44
"RTN","PSSMARK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,17,20,28,57,82,124**;9/30/97;Build 2
"RTN","PSSMARK",3,0)
 ;
"RTN","PSSMARK",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSMARK",5,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSMARK",6,0)
 ;Reference to ^PSNTRAN("END" supported by DBIA #2527
"RTN","PSSMARK",7,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSMARK",8,0)
 ;
"RTN","PSSMARK",9,0)
PICK S U="^" S PSXFL=0 D TEXT F PSXMM=1:1 D PICK1 S:'$D(PSXFL) PSXFL=0 Q:PSXFL
"RTN","PSSMARK",10,0)
DONE K PSXBT,PSXF,PSXFL,PSXVAP,PSXVP,PSXGN,PSXUM,PSXDN,PSXDP,PSXCMOP,PSXLOC,PSXZERO,PSXODE,PSXMM,PSXOU,PSXG,X,Y,PSXIDENT,PSXNDF,PSXVAPN,NONCE,PSXNEXT,PSXLAST,RTC,PSXNOW,PSXID,PSSEXP
"RTN","PSSMARK",11,0)
 Q
"RTN","PSSMARK",12,0)
TEXT W !!,"This option allows you to choose entries from your drug file and helps you",!,"review your NDF matches and mark individual entries to send to CMOP.",!
"RTN","PSSMARK",13,0)
 W !,"If you mark the entry to transmit to CMOP, it will replace your Dispense Unit",!,"with the VA Dispense Unit. In addition, you may overwrite the local drug name",!,"with the VA Print Name and the entry will remain uneditable.",!
"RTN","PSSMARK",14,0)
 Q
"RTN","PSSMARK",15,0)
DISPLAY W @IOF W !!?3,"Local Drug Generic Name: ",PSXLOC W !!,?16,"ORDER UNIT: "
"RTN","PSSMARK",16,0)
 I $D(^PSDRUG(PSXUM,660)) S PSXODE=^PSDRUG(PSXUM,660) I $P(PSXODE,"^",2) S PSXOU=$P(PSXODE,"^",2) I $D(^DIC(51.5)),$D(^DIC(51.5,PSXOU)) W ?28,$S('$D(PSXOU):"",1:$P(^DIC(51.5,PSXOU,0),"^",1))
"RTN","PSSMARK",17,0)
 W !,"DISPENSE UNITS/ORDER UNITS: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",5)),!,?13,"DISPENSE UNIT: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",8)),!,"   PRICE PER DISPENSE UNIT: ",$S('$D(PSXODE):"",1:$P(PSXODE,"^",6))
"RTN","PSSMARK",18,0)
 W !!,"VA Print Name: ",PSXVAP,?59,"VA Dispense Unit: ",PSXDP,!,"VA Drug Class: ",$P(^PS(50.605,$P(PSXDN,"^",6),0),"^",1),?50,"CMOP ID: ",PSXID D CHECK
"RTN","PSSMARK",19,0)
 Q
"RTN","PSSMARK",20,0)
CHECK I $D(^PSDRUG("AQ",PSXUM)),$P(^PSDRUG(PSXUM,3),"^",1)=1 D UNMARK
"RTN","PSSMARK",21,0)
 Q:PSXBT=1  I '$D(^PSDRUG("AQ",PSXUM)) D MARK
"RTN","PSSMARK",22,0)
 Q
"RTN","PSSMARK",23,0)
MARK Q:PSXBT=1  W !!,"Do you wish to mark this drug to transmit to CMOP? " K DIR S DIR(0)="Y" D ^DIR D OUT I "Nn^"[X K X,Y,DIRUT S PSXBT=1,PSXF=1 Q:PSXF=1  Q:PSXBT=1
"RTN","PSSMARK",24,0)
 I "Yy"[X S $P(^PSDRUG(PSXUM,660),"^",8)=PSXDP,^PSDRUG(PSXUM,3)=1,^PSDRUG("AQ",PSXUM)="",DA=PSXUM D ^PSSREF,IDENT K DA D QDM,QUEST,QUES2 S PSXF=1
"RTN","PSSMARK",25,0)
 Q
"RTN","PSSMARK",26,0)
UNMARK Q:PSXF=1  W !!,"Do you wish to UNmark this drug to transmit to CMOP? " K DIR S DIR(0)="Y" D ^DIR D OUT I "Nn^"[X K X,Y,DIRUT S PSXF=1 Q
"RTN","PSSMARK",27,0)
 I "Yy"[X S $P(^PSDRUG(PSXUM,3),"^",1)=0 K ^PSDRUG("AQ",PSXUM) S DA=PSXUM D ^PSSREF K DA S PSXF=1,PSXBT=1 Q:PSXBT=1
"RTN","PSSMARK",28,0)
 Q
"RTN","PSSMARK",29,0)
QUES2 W !!,"Do you wish to overwrite your local name? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will overwrite GENERIC NAME with the VA Print Name." D ^DIR D OUT I "Nn^"[X D SYN K X,Y,DIRUT S PSXG=1 Q:PSXG=1
"RTN","PSSMARK",30,0)
 I "Yy"[X D DUP I '$D(^PSDRUG("B",PSXVAP)) S $P(^PSDRUG(PSXUM,0),"^",1)=PSXVAP D XREF,OLDNM S PSXF=1,PSXG=1
"RTN","PSSMARK",31,0)
 Q
"RTN","PSSMARK",32,0)
DUP I PSXVAP'=PSXLOC,$D(^PSDRUG("B",PSXVAP)) W !,"You cannot write over the GENERIC NAME because one already has that",!,"VA Print Name. You cannot have duplicate names.",!
"RTN","PSSMARK",33,0)
 Q
"RTN","PSSMARK",34,0)
XREF K:PSXLOC'=PSXVAP ^PSDRUG("B",PSXLOC,PSXUM) S:PSXLOC'=PSXVAP ^PSDRUG("B",PSXVAP,PSXUM)="" I $D(^PSNTRAN(PSXUM,"END")) S $P(^PSNTRAN(PSXUM,"END"),"^",3)=PSXVAP,$P(^PSNTRAN("END"),"^",3)=PSXVAP
"RTN","PSSMARK",35,0)
 Q
"RTN","PSSMARK",36,0)
BLD ;
"RTN","PSSMARK",37,0)
 I $D(^PSDRUG(PSXUM,"I")) D  ;; <*124 RJS
"RTN","PSSMARK",38,0)
 .N X,X1,X2
"RTN","PSSMARK",39,0)
 .S X1=$G(^PSDRUG(PSXUM,"I")),X2=DT D ^%DTC
"RTN","PSSMARK",40,0)
 .S:X<1 PSSEXP(1)="It has been inactivated."  ;; *124 RJS >
"RTN","PSSMARK",41,0)
 I $D(^PSDRUG(PSXUM,2)),$P(^PSDRUG(PSXUM,2),"^",3)'["O" S PSSEXP(2)="It is not marked for outpatient pharmacy use."
"RTN","PSSMARK",42,0)
BLD5 I $P(^PSDRUG(PSXUM,0),"^",3)[1!($P(^(0),"^",3)[2) S PSSEXP(3)="It is a schedule I or schedule II controlled substance."
"RTN","PSSMARK",43,0)
 I '$D(^PSDRUG(PSXUM,"ND")) S PSSEXP(4)="It is not matched to NDF."
"RTN","PSSMARK",44,0)
 I $D(^PSDRUG(PSXUM,"ND")),$P(^PSDRUG(PSXUM,"ND"),"^",2)']"" S PSSEXP(5)="It is not matched to NDF."
"RTN","PSSMARK",45,0)
 ;
"RTN","PSSMARK",46,0)
BLD1 S PSSXX="" I $D(^PSDRUG(PSXUM,"ND")) S PSXDN=^PSDRUG(PSXUM,"ND"),PSXGN=$P(PSXDN,"^",1),PSXVP=$P(PSXDN,"^",3) S PSSXX=$$PROD2^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSMARK",47,0)
 I $P(PSSXX,"^",3)'=1 S PSSEXP(6)="It is not marked for CMOP in NDF." Q
"RTN","PSSMARK",48,0)
 I '$O(PSSEXP(0)),PSSXX]"",$P(PSSXX,"^",3)=1 S PSXVAP=$P(PSSXX,"^"),PSXDP=$P(PSSXX,"^",4)
"RTN","PSSMARK",49,0)
 Q
"RTN","PSSMARK",50,0)
PICK1 S DIC="^PSDRUG(",DIC(0)="QEAM" D ^DIC K DIC I Y<0 S PSXFL=1 Q
"RTN","PSSMARK",51,0)
 K PSSEXP
"RTN","PSSMARK",52,0)
 S PSXUM=+Y,PSXLOC=$P(Y,"^",2) S PSSEXP(0)="",PSXF=0,PSXBT=0 D BLD
"RTN","PSSMARK",53,0)
PICK2 I $O(PSSEXP(0)) W !!,"This drug cannot be marked for the following reason(s).",! F PSSXX=0:0 S PSSXX=$O(PSSEXP(PSSXX)) Q:'PSSXX  W !,PSSEXP(PSSXX)
"RTN","PSSMARK",54,0)
 I $O(PSSEXP(0)) K PSSEXP W ! Q
"RTN","PSSMARK",55,0)
GOTIT S PSXID=$P(PSSXX,"^",2),PSXZERO=^PSDRUG(PSXUM,0) D DISPLAY
"RTN","PSSMARK",56,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU S XX=""
"RTN","PSSMARK",57,0)
 I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSXUM) D  Q:PSXF  Q:PSXBT
"RTN","PSSMARK",58,0)
 . F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSMARK",59,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSMARK",60,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) D:$G(DNSNAM)&(DMFU="YES") DRG^PSSDGUPD(PSXUM,"",DNSNAM,DNSPORT)
"RTN","PSSMARK",61,0)
 Q
"RTN","PSSMARK",62,0)
OUT I $D(DTOUT),DTOUT=1 S PSXFL=1
"RTN","PSSMARK",63,0)
 Q
"RTN","PSSMARK",64,0)
IDENT S PSXNDF=$P(^PSDRUG(PSXUM,"ND"),"^",1),PSXVAPN=$P(^PSDRUG(PSXUM,"ND"),"^",3),DA=PSXNDF,K=PSXVAPN S X=$$PROD2^PSNAPIS(DA,K),PSXIDENT=$P(X,"^",2),$P(^PSDRUG(PSXUM,"ND"),"^",10)=PSXIDENT,^PSDRUG("AQ1",PSXIDENT,PSXUM)=""
"RTN","PSSMARK",65,0)
 Q
"RTN","PSSMARK",66,0)
QUEST I $D(PSXODE),$P(PSXODE,"^",8)'=PSXDP W !!,"Your old Dispense Unit  ",$P(PSXODE,"^",8),"  does not match the new one  ",PSXDP,".",!,"You may wish to edit the Price Per Order Unit and/or The Dispense",!,"Units Per Order Unit.",! D QUESTA
"RTN","PSSMARK",67,0)
 Q
"RTN","PSSMARK",68,0)
QUESTA S DIE="^PSDRUG(",DA=PSXUM,DR="13;15",DIE("NO^")="BACK" D ^DIE K DIE("NO^")
"RTN","PSSMARK",69,0)
 Q
"RTN","PSSMARK",70,0)
OLDNM D OLD I $D(NONCE) D OLD1
"RTN","PSSMARK",71,0)
 Q
"RTN","PSSMARK",72,0)
OLD D NOW^%DTC I $D(^PSDRUG(PSXUM,900,1,0)) S NONCE=0,PSXLAST=0 F RTC=0:0 S RTC=$O(^PSDRUG(PSXUM,900,RTC)) Q:'RTC  S PSXLAST=PSXLAST+1,PSXNEXT=PSXLAST+1
"RTN","PSSMARK",73,0)
 I '$D(^PSDRUG(PSXUM,900,1,0)) S ^PSDRUG(PSXUM,900,1,0)=PSXLOC_"^"_X
"RTN","PSSMARK",74,0)
 Q
"RTN","PSSMARK",75,0)
OLD1 I NONCE=0 S ^PSDRUG(PSXUM,900,PSXNEXT,0)=PSXLOC_"^"_X,NONCE=1
"RTN","PSSMARK",76,0)
 Q
"RTN","PSSMARK",77,0)
SYN S:'$D(^PSDRUG(PSXUM,1,0)) ^PSDRUG(PSXUM,1,0)="^50.1A^0^0" I '$D(^PSDRUG("C",PSXVAP,PSXUM)) S PSXNOW=$P(^PSDRUG(PSXUM,1,0),"^",3)+1,^PSDRUG(PSXUM,1,PSXNOW,0)=PSXVAP,^PSDRUG("C",PSXVAP,PSXUM,PSXNOW)="" D SYN1
"RTN","PSSMARK",78,0)
 Q
"RTN","PSSMARK",79,0)
SYN1 S $P(^PSDRUG(PSXUM,1,0),"^",3)=PSXNOW,$P(^PSDRUG(PSXUM,1,0),"^",4)=$P(^PSDRUG(PSXUM,1,0),"^",4)+1
"RTN","PSSMARK",80,0)
 Q
"RTN","PSSMARK",81,0)
QDM S DIE="^PSDRUG(",DA=PSXUM,DR=215 D ^DIE
"RTN","PSSMARK",82,0)
 Q
"VER")
8.0^22.0
"BLD",7187,6)
^116
**END**
**END**
