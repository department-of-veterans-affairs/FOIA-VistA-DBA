Released TIU*1*208 SEQ #201
Extracted from mail message
**KIDS**:TIU*1.0*208^

**INSTALL NAME**
TIU*1.0*208
"BLD",6577,0)
TIU*1.0*208^TEXT INTEGRATION UTILITIES^0^3060130^y
"BLD",6577,1,0)
^^3^3^3051220^
"BLD",6577,1,1,0)
Fix display of a long Author's name in the TIU BROWSE menu options and 
"BLD",6577,1,2,0)
fix the duplicate display of notes in the TIU SEARCH BY PATIENT/TITLE 
"BLD",6577,1,3,0)
option.
"BLD",6577,4,0)
^9.64PA^^
"BLD",6577,"ABPKG")
n
"BLD",6577,"KRN",0)
^9.67PA^8989.52^19
"BLD",6577,"KRN",.4,0)
.4
"BLD",6577,"KRN",.401,0)
.401
"BLD",6577,"KRN",.402,0)
.402
"BLD",6577,"KRN",.403,0)
.403
"BLD",6577,"KRN",.5,0)
.5
"BLD",6577,"KRN",.84,0)
.84
"BLD",6577,"KRN",3.6,0)
3.6
"BLD",6577,"KRN",3.8,0)
3.8
"BLD",6577,"KRN",9.2,0)
9.2
"BLD",6577,"KRN",9.8,0)
9.8
"BLD",6577,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6577,"KRN",9.8,"NM",1,0)
TIUBR^^0^45272783
"BLD",6577,"KRN",9.8,"NM",2,0)
TIUR2^^0^64720639
"BLD",6577,"KRN",9.8,"NM",3,0)
TIUSRVR1^^0^34950114
"BLD",6577,"KRN",9.8,"NM","B","TIUBR",1)

"BLD",6577,"KRN",9.8,"NM","B","TIUR2",2)

"BLD",6577,"KRN",9.8,"NM","B","TIUSRVR1",3)

"BLD",6577,"KRN",19,0)
19
"BLD",6577,"KRN",19.1,0)
19.1
"BLD",6577,"KRN",101,0)
101
"BLD",6577,"KRN",409.61,0)
409.61
"BLD",6577,"KRN",771,0)
771
"BLD",6577,"KRN",870,0)
870
"BLD",6577,"KRN",8989.51,0)
8989.51
"BLD",6577,"KRN",8989.52,0)
8989.52
"BLD",6577,"KRN",8994,0)
8994
"BLD",6577,"KRN","B",.4,.4)

"BLD",6577,"KRN","B",.401,.401)

"BLD",6577,"KRN","B",.402,.402)

"BLD",6577,"KRN","B",.403,.403)

"BLD",6577,"KRN","B",.5,.5)

"BLD",6577,"KRN","B",.84,.84)

"BLD",6577,"KRN","B",3.6,3.6)

"BLD",6577,"KRN","B",3.8,3.8)

"BLD",6577,"KRN","B",9.2,9.2)

"BLD",6577,"KRN","B",9.8,9.8)

"BLD",6577,"KRN","B",19,19)

"BLD",6577,"KRN","B",19.1,19.1)

"BLD",6577,"KRN","B",101,101)

"BLD",6577,"KRN","B",409.61,409.61)

"BLD",6577,"KRN","B",771,771)

"BLD",6577,"KRN","B",870,870)

"BLD",6577,"KRN","B",8989.51,8989.51)

"BLD",6577,"KRN","B",8989.52,8989.52)

"BLD",6577,"KRN","B",8994,8994)

"BLD",6577,"QUES",0)
^9.62^^
"BLD",6577,"REQB",0)
^9.611^3^3
"BLD",6577,"REQB",1,0)
TIU*1.0*173^2
"BLD",6577,"REQB",2,0)
TIU*1.0*113^2
"BLD",6577,"REQB",3,0)
TIU*1.0*186^2
"BLD",6577,"REQB","B","TIU*1.0*113",2)

"BLD",6577,"REQB","B","TIU*1.0*173",1)

"BLD",6577,"REQB","B","TIU*1.0*186",3)

"MBREQ")
0
"PKG",506,-1)
1^1
"PKG",506,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",506,20,0)
^9.402P^^
"PKG",506,22,0)
^9.49I^1^1
"PKG",506,22,1,0)
1.0^2970620^2970916^3316
"PKG",506,22,1,"PAH",1,0)
208^3060130
"PKG",506,22,1,"PAH",1,1,0)
^^3^3^3060130
"PKG",506,22,1,"PAH",1,1,1,0)
Fix display of a long Author's name in the TIU BROWSE menu options and 
"PKG",506,22,1,"PAH",1,1,2,0)
fix the duplicate display of notes in the TIU SEARCH BY PATIENT/TITLE 
"PKG",506,22,1,"PAH",1,1,3,0)
option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUBR")
0^1^B45272783^B45272130
"RTN","TIUBR",1,0)
TIUBR ; SLC/JER - Browse Action Subroutines ;4/18/2001 16:36
"RTN","TIUBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**32,87,93,58,100,162,112,173,208**;Jun 20, 1997
"RTN","TIUBR",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC to TIUBR1.
"RTN","TIUBR",4,0)
EN ; Entry code for LM templates TIU BROWSE
"RTN","TIUBR",5,0)
 N TIUY
"RTN","TIUBR",6,0)
 ;Kill TIUGDATA in CLEAN; don't new it here
"RTN","TIUBR",7,0)
 ; -- Set TIUGDATA, which describes the note originally
"RTN","TIUBR",8,0)
 ;    selected to be browsed. --
"RTN","TIUBR",9,0)
 ; TIUGDATA = 0 or
"RTN","TIUBR",10,0)
 ;          = TIUDA^HASIDKID^TIUD21^PRMSORT, where
"RTN","TIUBR",11,0)
 ;            PRMSORT = "TITLE" or "REFDT".  See 8925.95, fld .18
"RTN","TIUBR",12,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBR",13,0)
 D BLDTMP(TIUDA)
"RTN","TIUBR",14,0)
 Q
"RTN","TIUBR",15,0)
HDR ; Build Header
"RTN","TIUBR",16,0)
 N TIUDTYP,DFN
"RTN","TIUBR",17,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUBR",18,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR",19,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUBR",20,0)
 ;  Docmt header line Patname, SSN, [Location, Visit]:
"RTN","TIUBR",21,0)
 S VALMHDR(2)=$$SETREC(TIUGDATA)
"RTN","TIUBR",22,0)
 Q
"RTN","TIUBR",23,0)
BLDTMP(TIUDA) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUBR",24,0)
 ; Requires TIUDA = IFN of note selected to be browsed.
"RTN","TIUBR",25,0)
 ; Needs TIUGDATA, set in EN
"RTN","TIUBR",26,0)
 N TIUI,TIUL,TIUREC,TIUDADD,ONBROWSE S (TIUDADD,TIUI)=0
"RTN","TIUBR",27,0)
 N TIUNAME K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUBR",28,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUBR",29,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUBR",30,0)
 D INQUIRE^TIUGBR(TIUDA,.TIUREC)
"RTN","TIUBR",31,0)
 I $D(TIUREC)>9 W !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUBR",32,0)
 ; --- if the document has a browse action, execute it ---
"RTN","TIUBR",33,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUBR",34,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUBR",35,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUBR",36,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",37,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUBR",38,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",39,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUBR",40,0)
 S ^TMP("TIUVIEW",$J,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUBR",41,0)
 S $P(^TMP("TIUVIEW",$J,0),U,3,4)=$G(TIUL)_U_$G(TIUL),VALMCNT=+$G(TIUL)
"RTN","TIUBR",42,0)
 Q
"RTN","TIUBR",43,0)
LOADSUPP(METHOD,TIUDA,TIUL) ; Execute OnBrowse/Load Supplementary data
"RTN","TIUBR",44,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUBR",45,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUBR",46,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR",47,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUBR",48,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",49,0)
 K @TIUY
"RTN","TIUBR",50,0)
 Q
"RTN","TIUBR",51,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load dictation, transcription data, etc.
"RTN","TIUBR",52,0)
 ; Requires array TIUREC, TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",53,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUBR",54,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUBR",55,0)
 ;      entry, since they vary by entry.
"RTN","TIUBR",56,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUBR",57,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUBR",58,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUBR",59,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUBR",60,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUBR",61,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUBR",62,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUBR",63,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUBR",64,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUBR",65,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUBR",66,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUBR",67,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUBR",68,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUBR",69,0)
 I SELCHLD!SELPRNT D
"RTN","TIUBR",70,0)
 . D IDTOP^TIUGBR(TIUDA,.TIUL,SHORT,CURPRNT)
"RTN","TIUBR",71,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUBR",72,0)
 I SHORT D
"RTN","TIUBR",73,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",74,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",75,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",76,0)
 I 'SHORT D
"RTN","TIUBR",77,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",78,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),$G(TIUY),4,39)
"RTN","TIUBR",79,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",80,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUBR",81,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",82,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",83,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",84,0)
 . . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("SURGEON: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),6,32) Q
"RTN","TIUBR",85,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),2,32)
"RTN","TIUBR",86,0)
 . E  D
"RTN","TIUBR",87,0)
 . . S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),7,27)
"RTN","TIUBR",88,0)
 . . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("SURGEON: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),6,32)
"RTN","TIUBR",89,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUBR",90,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),$G(TIUY),39,40)
"RTN","TIUBR",91,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),$G(TIUY),36,40)
"RTN","TIUBR",92,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",93,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",94,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),$G(TIUY),6,36)
"RTN","TIUBR",95,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",96,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",97,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",98,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",99,0)
 E  D
"RTN","TIUBR",100,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),$G(TIUY),6,74)
"RTN","TIUBR",101,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",102,0)
 . S TIUL=TIUL+1,TIUY="",@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",103,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUBR",104,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))_" Has ADDENDA ***"
"RTN","TIUBR",105,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",106,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR",107,0)
 Q
"RTN","TIUBR",108,0)
 ;
"RTN","TIUBR",109,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUBR",110,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",111,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUBR",112,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUBR",113,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUBR",114,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUBR",115,0)
 S TIUK=0
"RTN","TIUBR",116,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUBR",117,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUBR",118,0)
 . D LOADID^TIUGBR(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUBR",119,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUBR",120,0)
 Q
"RTN","TIUBR",121,0)
 ;
"RTN","TIUBR",122,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUBR",123,0)
 N TIUY,TIUTYP
"RTN","TIUBR",124,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUBR",125,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUBR",126,0)
 Q TIUY
"RTN","TIUBR",127,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUBR",128,0)
 N TIUDADT,TIUJ,CANSEE
"RTN","TIUBR",129,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUBR",130,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",131,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUBR",132,0)
 S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUBR",133,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR",134,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",135,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR",136,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUBR",137,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",138,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUBR",139,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUBR",140,0)
 Q
"RTN","TIUBR",141,0)
 ;
"RTN","TIUBR",142,0)
SETREC(TIUGDATA) ; Sets docmt header line Patname, SSN, [Location, Visit]
"RTN","TIUBR",143,0)
 ; Requires TIUGDATA
"RTN","TIUBR",144,0)
 N Y
"RTN","TIUBR",145,0)
 S Y=$$SETSTR^VALM1($$NAME^TIULS($G(TIU("PNM")),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUBR",146,0)
 S Y=$$SETSTR^VALM1($G(TIU("SSN")),$G(Y),16,12)
"RTN","TIUBR",147,0)
 ; ---- If TIUDA is an ID entry, write ID, ADDENDED? in header
"RTN","TIUBR",148,0)
 ;      and leave out entry-specific info (Location, Visit)
"RTN","TIUBR",149,0)
 ;      since that goes with each individual entry: ----
"RTN","TIUBR",150,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D  G SETRX
"RTN","TIUBR",151,0)
 . S Y=$$SETSTR^VALM1("Interdisciplinary "_$S($P(TIUGDATA,U,2):"Note",1:"Entry"),$G(Y),29,23)
"RTN","TIUBR",152,0)
 . I $P(TIUGDATA,U,2) S Y=$$SETSTR^VALM1("ADDENDED?"_$S($$HASADDEN^TIULC1(+TIUDA,1):" Yes",1:" No"),$G(Y),66,13)
"RTN","TIUBR",153,0)
 S Y=$$SETSTR^VALM1($P($G(TIU("LOC")),U,2),$G(Y),30,17)
"RTN","TIUBR",154,0)
 I $L($G(TIU("WARD"))) D
"RTN","TIUBR",155,0)
 . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/CCYY"),$G(Y),48,15)
"RTN","TIUBR",156,0)
 . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/CCYY"),$G(Y),65,15)
"RTN","TIUBR",157,0)
 I '$L($G(TIU("WARD"))) D
"RTN","TIUBR",158,0)
 . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+$G(TIU("EDT")),"MM/DD/CCYY HR:MIN"),$G(Y),51,28)
"RTN","TIUBR",159,0)
SETRX Q Y
"RTN","TIUBR",160,0)
 ;
"RTN","TIUBR",161,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUBR",162,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1,TIUGDATA
"RTN","TIUBR",163,0)
 Q
"RTN","TIUR2")
0^2^B64720639^B57493092
"RTN","TIUR2",1,0)
TIUR2  ; SLC/JER - Integrated Document Review ;1/29/04
"RTN","TIUR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,113,208**;Jun 20, 1997
"RTN","TIUR2",3,0)
 ; 12/12/00 new rtn, from splitting TIUR1
"RTN","TIUR2",4,0)
REPLACE(TIUDA,SORTVAL,SORTFLD,DATTIM,EXPAND,FORGETAD) ; Fix ^TMP("TIUI",$J).
"RTN","TIUR2",5,0)
 ;Remove ID kid or addm records from ^TMP("TIUI",$J), and replace
"RTN","TIUR2",6,0)
 ;with parent record instead.
"RTN","TIUR2",7,0)
 ; Requires TIUDA, SORTVAL, SORTFLD, DATTIM.
"RTN","TIUR2",8,0)
 ; Passes back opt array EXPAND, where EXPAND(IFN)=""
"RTN","TIUR2",9,0)
 ; opt flag FORGETAD: don't expand parent for sake of addm
"RTN","TIUR2",10,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PVAL,GPVAL,PDATTIM,GPDATTIM,NODE
"RTN","TIUR2",11,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUR2",12,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUR2",13,0)
 I IDPRNT D
"RTN","TIUR2",14,0)
 . S PVAL=$$RESOLVE^TIUR1(IDPRNT,SORTFLD)
"RTN","TIUR2",15,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIURM":+$G(^TIU(8925,IDPRNT,12)),1:+$G(^TIU(8925,IDPRNT,13))) ; rtn TIURM uses "F" XREF, whose date is ENTRY DT.
"RTN","TIUR2",16,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",17,0)
 S ADDMPRNT=+$P($G(^TIU(8925,TIUDA,0)),U,6) ; assume TIUDA is not component
"RTN","TIUR2",18,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUR2",19,0)
 I ADDMPRNT D
"RTN","TIUR2",20,0)
 . S PVAL=$$RESOLVE^TIUR1(ADDMPRNT,SORTFLD)
"RTN","TIUR2",21,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMPRNT,13)),1:+$G(^TIU(8925,ADDMPRNT,12)))
"RTN","TIUR2",22,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",23,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUR2",24,0)
 ; -- If TIUDA is not an ID kid, not addm, just quit: --
"RTN","TIUR2",25,0)
 I 'IDPRNT,'ADDMPRNT Q
"RTN","TIUR2",26,0)
 ; -- Take kid or addm out of array:
"RTN","TIUR2",27,0)
 S NODE=^TMP("TIUI",$J,SORTVAL,DATTIM,TIUDA)
"RTN","TIUR2",28,0)
 K ^TMP("TIUI",$J,SORTVAL,DATTIM,TIUDA)
"RTN","TIUR2",29,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUR2",30,0)
 I IDPRNT D  Q
"RTN","TIUR2",31,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",32,0)
 . Q:$$CHKPAR(IDPRNT)
"RTN","TIUR2",33,0)
 . S ^TMP("TIUI",$J,PVAL,PDATTIM,IDPRNT)=NODE
"RTN","TIUR2",34,0)
 ; -- If TIUDA is an addendum, put its (g)parent in array:
"RTN","TIUR2",35,0)
 I ADDMPRNT D  Q
"RTN","TIUR2",36,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",37,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUR2",38,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUR2",39,0)
 . I ADDMGPNT D  I 1
"RTN","TIUR2",40,0)
 . . S GPVAL=$$RESOLVE^TIUR1(ADDMGPNT,SORTFLD)
"RTN","TIUR2",41,0)
 . . S GPDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMGPNT,13)),1:+$G(^TIU(8925,ADDMGPNT,12)))
"RTN","TIUR2",42,0)
 . . S GPDATTIM=9999999-GPDATTIM
"RTN","TIUR2",43,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",44,0)
 . . Q:$$CHKPAR(ADDMGPNT)
"RTN","TIUR2",45,0)
 . . S ^TMP("TIUI",$J,GPVAL,GPDATTIM,ADDMGPNT)=NODE
"RTN","TIUR2",46,0)
 . E  D
"RTN","TIUR2",47,0)
 . . Q:$$CHKPAR(ADDMPRNT)
"RTN","TIUR2",48,0)
 . . S ^TMP("TIUI",$J,PVAL,PDATTIM,ADDMPRNT)=NODE
"RTN","TIUR2",49,0)
 Q
"RTN","TIUR2",50,0)
 ;
"RTN","TIUR2",51,0)
CHKPAR(CHKDA) ;
"RTN","TIUR2",52,0)
 N TIU1,TIU2,TIU3,TIURES
"RTN","TIUR2",53,0)
 S TIU1="",TIURES=0
"RTN","TIUR2",54,0)
 F  S TIU1=$O(^TMP("TIUI",$J,TIU1)) Q:TIU1=""!(TIURES)  D
"RTN","TIUR2",55,0)
 . S TIU2=""
"RTN","TIUR2",56,0)
 . F  S TIU2=$O(^TMP("TIUI",$J,TIU1,TIU2)) Q:TIU2=""!(TIURES)  D
"RTN","TIUR2",57,0)
 . . S TIU3=""
"RTN","TIUR2",58,0)
 . . F  S TIU3=$O(^TMP("TIUI",$J,TIU1,TIU2,TIU3)) Q:TIU3=""!(TIURES)  D
"RTN","TIUR2",59,0)
 . . . I TIU3=ADDMPRNT S TIURES=1
"RTN","TIUR2",60,0)
 Q TIURES
"RTN","TIUR2",61,0)
 ;
"RTN","TIUR2",62,0)
SETLIST(TIUORDER,VALMCNT,SCREEN) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIUR2",63,0)
 ;List Template list
"RTN","TIUR2",64,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIUR2",65,0)
 S SORTVAL=""
"RTN","TIUR2",66,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIUR2",67,0)
 . S TIUDTM=0
"RTN","TIUR2",68,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIUR2",69,0)
 . . S TIUDA=0
"RTN","TIUR2",70,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",71,0)
 . . . ; D ADDELMNT(TIUDA,.VALMCNT) ; P113
"RTN","TIUR2",72,0)
 . . . I SCREEN=1!(SCREEN="ALL") D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIUR2",73,0)
 . . . I SCREEN>1,$G(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA))=SCREEN D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIUR2",74,0)
 Q
"RTN","TIUR2",75,0)
 ;
"RTN","TIUR2",76,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Puts elements in List Template list
"RTN","TIUR2",77,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIUR2",78,0)
 S VALMCNT=0
"RTN","TIUR2",79,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR2",80,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR2",81,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1) ;A for ascending
"RTN","TIUR2",82,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUR2",83,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIUR2",84,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",85,0)
 . . S TIUDA=0
"RTN","TIUR2",86,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUR2",87,0)
 . . . D REPLACE(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIUR2",88,0)
 D SETLIST(TIUORDER,.VALMCNT,SCREEN)
"RTN","TIUR2",89,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIUR2",90,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",91,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIUR2",92,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIUR2",93,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIUR2",94,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIUR2",95,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",96,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIUR2",97,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIUR2",98,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIUR2",99,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIUR2",100,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIUR2",101,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD(.TIUEXPKD,STATUS("WORDS"))
"RTN","TIUR2",102,0)
 Q
"RTN","TIUR2",103,0)
 ;
"RTN","TIUR2",104,0)
EXPANDKD(TIUEXPKD,STATWORD,CONTEXT) ; Expand items to show kids that meet
"RTN","TIUR2",105,0)
 ;search criteria.
"RTN","TIUR2",106,0)
 ; Requires array TIUEXPKD, requires VALMCNT
"RTN","TIUR2",107,0)
 ; Requires nonnull: STATWORD (from TIUR1) or CONTEXT (from TIUROR).
"RTN","TIUR2",108,0)
 N TIUEXP2,YESEXPD,LINENO,HELP,TIUTWO
"RTN","TIUR2",109,0)
 ; -- Expand only for status unsigned or uncosigned, & not for "ALL":
"RTN","TIUR2",110,0)
 I STATWORD]"" Q:((STATWORD["ALL")!((STATWORD'["UNSIGNED")&(STATWORD'["UNCOSIGNED")))
"RTN","TIUR2",111,0)
 I $G(CONTEXT) Q:((CONTEXT'=2)&(CONTEXT'=3))  ;unsigned, uncosigned
"RTN","TIUR2",112,0)
 I (5*TIUEXPKD+$G(VALMCNT))>50 D  Q:'YESEXPD
"RTN","TIUR2",113,0)
 . W !!,"      There are ",TIUEXPKD," items (Interdisciplinary Notes, Addenda) to expand",!,"        in a list of ",VALMCNT," items."
"RTN","TIUR2",114,0)
 . S HELP="NO saves time building the list, but 'hides' relevant items under their parent until you expand the parent yourself."
"RTN","TIUR2",115,0)
 . S YESEXPD=$$READ^TIUU("Y","  Shall I take the extra time to expand them before I list them","NO",HELP)
"RTN","TIUR2",116,0)
 D LOAD^TIUROR1(.TIUEXPKD,.TIUEXP2)
"RTN","TIUR2",117,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR2",118,0)
 ; Try again if not in list til expanded once:
"RTN","TIUR2",119,0)
 ; (Can't use BREATHE^TIUROR1 again since it COLLAPSES now.)
"RTN","TIUR2",120,0)
 Q:'$D(TIUEXP2)
"RTN","TIUR2",121,0)
 S TIUDA=0
"RTN","TIUR2",122,0)
 F  S TIUDA=$O(TIUEXP2(TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",123,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUR2",124,0)
 . Q:'LINENO
"RTN","TIUR2",125,0)
 . S TIUTWO(LINENO)=""
"RTN","TIUR2",126,0)
 S LINENO=VALMCNT+1
"RTN","TIUR2",127,0)
 F  S LINENO=$O(TIUTWO(LINENO),-1) Q:'LINENO  D
"RTN","TIUR2",128,0)
 . D BREATHE^TIURL1(LINENO,1)
"RTN","TIUR2",129,0)
 Q
"RTN","TIUR2",130,0)
 ;
"RTN","TIUR2",131,0)
ADDELMNT(TIUDA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIUR2",132,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,XDT,TIULST4,INSTA,TIUSTN
"RTN","TIUR2",133,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIUR2",134,0)
 N PREFIX,TIUGDATA
"RTN","TIUR2",135,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIUR2",136,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIUR2",137,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIUR2",138,0)
 . S TIUCNT=0
"RTN","TIUR2",139,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUR2",140,0)
 S TIUD13=$G(^TIU(8925,TIUDA,13)),TIUD15=$G(^TIU(8925,TIUDA,15))
"RTN","TIUR2",141,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIUR2",142,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIUR2",143,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIUR2",144,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIUR2",145,0)
 S TIULI=$E(PT)
"RTN","TIUR2",146,0)
 S PT=PREFIX_PT
"RTN","TIUR2",147,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIUR2",148,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIUR2",149,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIUR2",150,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIUR2",151,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIUR2",152,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIUR2",153,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIUR2",154,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIUR2",155,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIUR2",156,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIUR2",157,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIUR2",158,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIUR2",159,0)
 S INSTA=""
"RTN","TIUR2",160,0)
 I +$P(TIUD12,U,12)>0 D
"RTN","TIUR2",161,0)
 . S TIUSTN=$$NS^XUAF4($P(TIUD12,U,12))
"RTN","TIUR2",162,0)
 . I $P(TIUSTN,U,2)]"" S INSTA=$P(TIUSTN,U,2)
"RTN","TIUR2",163,0)
 S INSTA=$E(INSTA,1,8)
"RTN","TIUR2",164,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUR2",165,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIUR2",166,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIUR2",167,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIUR2",168,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIUR2",169,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIUR2",170,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIUR2",171,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIUR2",172,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIUR2",173,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"EXPECTED COSIGNER")
"RTN","TIUR2",174,0)
 S TIUREC=$$SETFLD^VALM1(INSTA,TIUREC,"DIVISION")
"RTN","TIUR2",175,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIUR2",176,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W:TIUCNT#10'>0 "."
"RTN","TIUR2",177,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_TIUDA_U_PREFIX
"RTN","TIUR2",178,0)
 S ^TMP("TIUR",$J,"IEN",TIUDA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIUR2",179,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA,TIUD0)
"RTN","TIUR2",180,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",TIUDA)=TIUGDATA
"RTN","TIUR2",181,0)
 I +$G(APPEND) D
"RTN","TIUR2",182,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIUR2",183,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURH
"RTN","TIUR2",184,0)
 . S VALMSG="** Item(s) #"_$$ITMLIST(TIUCNT,$G(VALMSG))_" Added **"
"RTN","TIUR2",185,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIUR2",186,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIUR2",187,0)
 . S VALMCNT=TIUCNT
"RTN","TIUR2",188,0)
 . I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",189,0)
 Q
"RTN","TIUR2",190,0)
ITMLIST(TIUITM,TIUMSG) ; Add Message
"RTN","TIUR2",191,0)
 N TIULIST
"RTN","TIUR2",192,0)
 I $E($G(TIUMSG),1,7)'="** Item" S TIULIST=TIUITM G ITMLISTX
"RTN","TIUR2",193,0)
 S TIULIST=$P($P($G(TIUMSG)," Added **"),"#",2)_" & "_TIUITM
"RTN","TIUR2",194,0)
ITMLISTX Q $G(TIULIST)
"RTN","TIUR2",195,0)
 Q
"RTN","TIUSRVR1")
0^3^B34950114^B34949493
"RTN","TIUSRVR1",1,0)
TIUSRVR1 ; SLC/JER - RPC for record-wise GET ; 01/22/2002 16:48
"RTN","TIUSRVR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,32,87,89,100,109,112,173,186,208**;Jun 20, 1997
"RTN","TIUSRVR1",3,0)
TGET(TIUY,TIUDA,ACTION) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUSRVR1",4,0)
 N TIUL,TIUREC,TIUARR,TIUGDATA,TIUNAME,TIUPRM0,TIUPRM1,X,Y,TIUCPF,ONBROWSE
"RTN","TIUSRVR1",5,0)
 K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",6,0)
 S ACTION=$G(ACTION,"VIEW"),TIUL=0
"RTN","TIUSRVR1",7,0)
 D SETPARM^TIULE
"RTN","TIUSRVR1",8,0)
 S TIUGDATA=$$SETGDATA(TIUDA)
"RTN","TIUSRVR1",9,0)
 S TIUY=$NA(^TMP("TIUVIEW",$J))
"RTN","TIUSRVR1",10,0)
 S TIUARR="^TMP(""TIUVIEW"",$J)"
"RTN","TIUSRVR1",11,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRVR1",12,0)
 ; Initialize ^TMP("TIU FOCUS",$J) to the entry that has focus
"RTN","TIUSRVR1",13,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUSRVR1",14,0)
 ; if the document has a browse action, execute it
"RTN","TIUSRVR1",15,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVR1",16,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUSRVR1",17,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",18,0)
 ;Set a flag to indicate whether or not a Title is a memer of the
"RTN","TIUSRVR1",19,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVR1",20,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRVR1",21,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",22,0)
 D INQUIRE^TIUSRVR2(TIUDA,.TIUREC,TIUCPF)
"RTN","TIUSRVR1",23,0)
 ; First, load dictation, transcription data, etc.
"RTN","TIUSRVR1",24,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA,TIUCPF)
"RTN","TIUSRVR1",25,0)
 ; Next, load the remainder of the record
"RTN","TIUSRVR1",26,0)
 D LOADREC^TIUSRVR2(TIUDA,.TIUL,TIUGDATA,0,ACTION)
"RTN","TIUSRVR1",27,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",28,0)
 S VALMCNT=+$G(TIUL)
"RTN","TIUSRVR1",29,0)
 Q
"RTN","TIUSRVR1",30,0)
SETGDATA(TIUDA) ; Set TIUGDATA
"RTN","TIUSRVR1",31,0)
 N TIUDPRM,TIUY,SORT S TIUY=""
"RTN","TIUSRVR1",32,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,TIUDA,0)),.TIUDPRM,TIUDA)
"RTN","TIUSRVR1",33,0)
 S SORT=$S(+$P(TIUDPRM(0),U,18):"TITLE",1:"REFDT")
"RTN","TIUSRVR1",34,0)
 I +$G(^TIU(8925,TIUDA,21)) S TIUY=TIUDA_U_0_U_+$G(^(21))_U_SORT G SETGX
"RTN","TIUSRVR1",35,0)
 I +$O(^TIU(8925,"GDAD",TIUDA,0)) S TIUY=TIUDA_U_1_U_0_U_SORT
"RTN","TIUSRVR1",36,0)
SETGX Q TIUY
"RTN","TIUSRVR1",37,0)
LOADSUPP(METHOD,TIUDA,TIUL) ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRVR1",38,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRVR1",39,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRVR1",40,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR1",41,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUSRVR1",42,0)
 S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=" "
"RTN","TIUSRVR1",43,0)
 K @TIUY
"RTN","TIUSRVR1",44,0)
 Q
"RTN","TIUSRVR1",45,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA,TIUCPF) ; Load top information
"RTN","TIUSRVR1",46,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUSRVR1",47,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUSRVR1",48,0)
 ;      entry, since they vary by entry.
"RTN","TIUSRVR1",49,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUSRVR1",50,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUSRVR1",51,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUSRVR1",52,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUSRVR1",53,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUSRVR1",54,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUSRVR1",55,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUSRVR1",56,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUSRVR1",57,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUSRVR1",58,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUSRVR1",59,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUSRVR1",60,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUSRVR1",61,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUSRVR1",62,0)
 I SELCHLD!SELPRNT D IDTOP(TIUDA,.TIUL,SHORT,CURPRNT) I 1
"RTN","TIUSRVR1",63,0)
 S TIUY=""
"RTN","TIUSRVR1",64,0)
 E  I $L(TIUREC(8925,+TIUDA,.01)) D
"RTN","TIUSRVR1",65,0)
 . S TIUY=$$SETSTR^VALM1("TITLE: "_TIUREC(8925,+TIUDA,.01),TIUY,8,64)
"RTN","TIUSRVR1",66,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",67,0)
 S TIUY=""
"RTN","TIUSRVR1",68,0)
 I SHORT D
"RTN","TIUSRVR1",69,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",70,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",71,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",72,0)
 S TIUY=""
"RTN","TIUSRVR1",73,0)
 I 'SHORT D
"RTN","TIUSRVR1",74,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",75,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),TIUY,4,39)
"RTN","TIUSRVR1",76,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",77,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUSRVR1",78,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",79,0)
 . S TIUY=""
"RTN","TIUSRVR1",80,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",81,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",82,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),TIUY,7,27)
"RTN","TIUSRVR1",83,0)
 . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("    SURGEON: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",84,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUSRVR1",85,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),TIUY,39,40)
"RTN","TIUSRVR1",86,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),TIUY,36,40)
"RTN","TIUSRVR1",87,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",88,0)
 . S TIUY=""
"RTN","TIUSRVR1",89,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),TIUY,6,36)
"RTN","TIUSRVR1",90,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",92,0)
 ; * 173 
"RTN","TIUSRVR1",93,0)
 I TIUREC(8925,+TIUDA,.05)="UNCOSIGNED" D
"RTN","TIUSRVR1",94,0)
 . S TIUY="",TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",95,0)
 . S TIUY="",TIUL=TIUL+1,TIUY=$$SETSTR^VALM1("*** NOT YET COSIGNED ***",TIUY,20,51),@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",96,0)
 S TIUY=""
"RTN","TIUSRVR1",97,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) D  I 1
"RTN","TIUSRVR1",98,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",99,0)
 E  D
"RTN","TIUSRVR1",100,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),TIUY,6,74)
"RTN","TIUSRVR1",101,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",102,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",103,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR1",104,0)
 ; Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR1",105,0)
 I $G(TIUCPF) D
"RTN","TIUSRVR1",106,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",107,0)
 . S TIUY=$$SETSTR^VALM1("PROCEDURE SUMMARY CODE: "_TIUREC(8925,+TIUDA,70201),$G(TIUY),1,54)
"RTN","TIUSRVR1",108,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",109,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",110,0)
 . S TIUY=$$SETSTR^VALM1("DATE/TIME PERFORMED: "_TIUREC(8925,+TIUDA,70202),$G(TIUY),1,41)
"RTN","TIUSRVR1",111,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",112,0)
 . S TIUL=TIUL+1,TIUY="",@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",113,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUSRVR1",114,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVR1",115,0)
 . S TIUY=TIUY_" Has ADDENDA ***"
"RTN","TIUSRVR1",116,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",117,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",118,0)
 Q
"RTN","TIUSRVR1",119,0)
 ;
"RTN","TIUSRVR1",120,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRVR1",121,0)
 N TIUY,TIUTYP
"RTN","TIUSRVR1",122,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRVR1",123,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRVR1",124,0)
 Q TIUY
"RTN","TIUSRVR1",125,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUSRVR1",126,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUSRVR1",127,0)
 ; Called by LOADTOP
"RTN","TIUSRVR1",128,0)
 N TIUY,TIUX,TIU
"RTN","TIUSRVR1",129,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR1",130,0)
 I SHORT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUSRVR1",131,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR1",132,0)
 S TIUY="",TIUX="TITLE: "_$P($G(TIU("DOCTYP")),U,2)
"RTN","TIUSRVR1",133,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,1,67)
"RTN","TIUSRVR1",134,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",135,0)
 Q:SHORT
"RTN","TIUSRVR1",136,0)
 S TIUY="",TIUX="LOCATION: "_$P($G(TIU("LOC")),U,2)
"RTN","TIUSRVR1",137,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,5,31)
"RTN","TIUSRVR1",138,0)
 I $L($G(TIU("WARD"))) D  I 1
"RTN","TIUSRVR1",139,0)
 . S TIUX="ADMISSION DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",140,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,34,37)
"RTN","TIUSRVR1",141,0)
 E  D
"RTN","TIUSRVR1",142,0)
 . S TIUX="VISIT DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",143,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,38,33)
"RTN","TIUSRVR1",144,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",145,0)
 Q
"VER")
8.0^22.0
"BLD",6577,6)
^201
**END**
**END**
