Released IB*2*182 SEQ #191
Extracted from mail message
**KIDS**:IB*2.0*182^

**INSTALL NAME**
IB*2.0*182
"BLD",3722,0)
IB*2.0*182^INTEGRATED BILLING^0^3030225^y
"BLD",3722,1,0)
^^1^1^3020905^
"BLD",3722,1,1,0)
Interface between IB and QuadraMed.
"BLD",3722,4,0)
^9.64PA^^
"BLD",3722,"KRN",0)
^9.67PA^8989.52^19
"BLD",3722,"KRN",.4,0)
.4
"BLD",3722,"KRN",.401,0)
.401
"BLD",3722,"KRN",.402,0)
.402
"BLD",3722,"KRN",.403,0)
.403
"BLD",3722,"KRN",.5,0)
.5
"BLD",3722,"KRN",.84,0)
.84
"BLD",3722,"KRN",3.6,0)
3.6
"BLD",3722,"KRN",3.8,0)
3.8
"BLD",3722,"KRN",9.2,0)
9.2
"BLD",3722,"KRN",9.8,0)
9.8
"BLD",3722,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",3722,"KRN",9.8,"NM",1,0)
IBCB1^^0^B69271261
"BLD",3722,"KRN",9.8,"NM",2,0)
IBCB2^^0^B49972168
"BLD",3722,"KRN",9.8,"NM",3,0)
IBCCC2^^0^B49867202
"BLD",3722,"KRN",9.8,"NM",4,0)
IBCCCB^^0^B80922057
"BLD",3722,"KRN",9.8,"NM",5,0)
IBCU1^^0^B23386720
"BLD",3722,"KRN",9.8,"NM",6,0)
IBCCPT^^0^B55414765
"BLD",3722,"KRN",9.8,"NM","B","IBCB1",1)

"BLD",3722,"KRN",9.8,"NM","B","IBCB2",2)

"BLD",3722,"KRN",9.8,"NM","B","IBCCC2",3)

"BLD",3722,"KRN",9.8,"NM","B","IBCCCB",4)

"BLD",3722,"KRN",9.8,"NM","B","IBCCPT",6)

"BLD",3722,"KRN",9.8,"NM","B","IBCU1",5)

"BLD",3722,"KRN",19,0)
19
"BLD",3722,"KRN",19.1,0)
19.1
"BLD",3722,"KRN",101,0)
101
"BLD",3722,"KRN",409.61,0)
409.61
"BLD",3722,"KRN",771,0)
771
"BLD",3722,"KRN",870,0)
870
"BLD",3722,"KRN",8989.51,0)
8989.51
"BLD",3722,"KRN",8989.52,0)
8989.52
"BLD",3722,"KRN",8994,0)
8994
"BLD",3722,"KRN","B",.4,.4)

"BLD",3722,"KRN","B",.401,.401)

"BLD",3722,"KRN","B",.402,.402)

"BLD",3722,"KRN","B",.403,.403)

"BLD",3722,"KRN","B",.5,.5)

"BLD",3722,"KRN","B",.84,.84)

"BLD",3722,"KRN","B",3.6,3.6)

"BLD",3722,"KRN","B",3.8,3.8)

"BLD",3722,"KRN","B",9.2,9.2)

"BLD",3722,"KRN","B",9.8,9.8)

"BLD",3722,"KRN","B",19,19)

"BLD",3722,"KRN","B",19.1,19.1)

"BLD",3722,"KRN","B",101,101)

"BLD",3722,"KRN","B",409.61,409.61)

"BLD",3722,"KRN","B",771,771)

"BLD",3722,"KRN","B",870,870)

"BLD",3722,"KRN","B",8989.51,8989.51)

"BLD",3722,"KRN","B",8989.52,8989.52)

"BLD",3722,"KRN","B",8994,8994)

"BLD",3722,"QUES",0)
^9.62^^
"BLD",3722,"REQB",0)
^9.611^3^3
"BLD",3722,"REQB",1,0)
IB*2.0*161^1
"BLD",3722,"REQB",2,0)
IB*2.0*197^1
"BLD",3722,"REQB",3,0)
IB*2.0*174^1
"BLD",3722,"REQB","B","IB*2.0*161",1)

"BLD",3722,"REQB","B","IB*2.0*174",3)

"BLD",3722,"REQB","B","IB*2.0*197",2)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
182^3030225
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3030225
"PKG",200,22,1,"PAH",1,1,1,0)
Interface between IB and QuadraMed.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","IBCB1")
0^1^B69271261
"RTN","IBCB1",1,0)
IBCB1 ;ALB/AAS - Process bill after enter/edited ;2-NOV-89
"RTN","IBCB1",2,0)
 ;;2.0;INTEGRATED BILLING;**70,106,51,137,161,182**;21-MAR-94
"RTN","IBCB1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCB1",4,0)
 ;
"RTN","IBCB1",5,0)
 ;MAP TO DGCRB1
"RTN","IBCB1",6,0)
 ;
"RTN","IBCB1",7,0)
 ;IBQUIT = Flag to stop processing
"RTN","IBCB1",8,0)
 ;IBVIEW = Flag for Bill has been viewed
"RTN","IBCB1",9,0)
 ;IBDISP = Flag for Bill entering display been viewed.
"RTN","IBCB1",10,0)
 ;
"RTN","IBCB1",11,0)
 K ^UTILITY($J) I $D(IBAC),IBAC>1 G @IBAC
"RTN","IBCB1",12,0)
1 ;complete bill
"RTN","IBCB1",13,0)
 D END,EDITS^IBCB2 G:IBQUIT END
"RTN","IBCB1",14,0)
 ;
"RTN","IBCB1",15,0)
 I '$$IICM^IBCB2(IBIFN) G END ; Ingenix ClaimsManager
"RTN","IBCB1",16,0)
 I '$$IIQMED^IBCB2(IBIFN) G END ; DSS QuadraMed Claims Scrubber
"RTN","IBCB1",17,0)
 ;
"RTN","IBCB1",18,0)
3 ;authorize bill/request MRA
"RTN","IBCB1",19,0)
 I '$D(^XUSEC("IB AUTHORIZE",DUZ))!('$D(IBIFN)) W !!,"You do not hold the Authorize Key.",! G END
"RTN","IBCB1",20,0)
 I '$P($G(^IBE(350.9,1,1)),"^",23),DUZ=$P(^DGCR(399,IBIFN,"S"),"^",2) W !!,"Entering user can not authorize.",! G END
"RTN","IBCB1",21,0)
 I $P(^DGCR(399,IBIFN,"S"),"^",9) W !,"Already Approved, Can't change" G END
"RTN","IBCB1",22,0)
 D:'$G(IBAC)!($G(IBAC)>1) EDITS^IBCB2 G:IBQUIT END
"RTN","IBCB1",23,0)
 ;
"RTN","IBCB1",24,0)
 I $G(IBAC)'=1,'$$IICM^IBCB2(IBIFN) G END ; Ingenix ClaimsManager
"RTN","IBCB1",25,0)
 I $G(IBAC)'=1,'$$IIQMED^IBCB2(IBIFN) G END ; DSS QuadraMed Claims Scrubber
"RTN","IBCB1",26,0)
 ;
"RTN","IBCB1",27,0)
AUTH S IBMRA=$$REQMRA^IBEFUNC(IBIFN)
"RTN","IBCB1",28,0)
 S IBEND=0
"RTN","IBCB1",29,0)
 I IBMRA["R" D  G:IBEND END ;MRA normally required, but MEDIGAP ins co
"RTN","IBCB1",30,0)
 . ;                         doesn't want/need it or MRA parameter off
"RTN","IBCB1",31,0)
 . N DIR,Y,X,IBINS
"RTN","IBCB1",32,0)
 . S IBINS=$P($G(^DIC(36,+$$POLICY^IBCEF(IBIFN,1,$$COBN^IBCEF(IBIFN)+1),0)),U)
"RTN","IBCB1",33,0)
 . Q:$$MCRWNR^IBEFUNC(+IBINS)
"RTN","IBCB1",34,0)
 . S DIR(0)="YA",DIR("B")="YES",DIR("A",1)=""
"RTN","IBCB1",35,0)
 . S DIR("A",2)="THIS BILL HAS PRIOR INSURANCE OF MEDICARE, BUT "
"RTN","IBCB1",36,0)
 . S DIR("?",1)="If you answer NO, the bill will not be authorized"
"RTN","IBCB1",37,0)
 . S DIR("?")="If you answer YES, this bill will automatically become a "_$P("secondary^tertiary",U,$$COBN^IBCEF(IBIFN))_" bill"
"RTN","IBCB1",38,0)
 . I +$P($G(^IBE(350.9,1,8)),U,10)'<2 D
"RTN","IBCB1",39,0)
 .. S DIR(2)="THE INSURANCE CO: ",DIR("A",3)=IBINS_" DOES NOT WANT/NEED AN MRA"
"RTN","IBCB1",40,0)
 . E  D
"RTN","IBCB1",41,0)
 .. S DIR("A",2)="THE SITE PARAMETER",DIR("A",3)="FOR MRA REQUESTS IS TURNED OFF"
"RTN","IBCB1",42,0)
 . S DIR("A",4)=" "
"RTN","IBCB1",43,0)
 . S DIR("A")="DO YOU WANT THIS BILL TO GO DIRECTLY TO "_IBINS_"? " D ^DIR K DIR
"RTN","IBCB1",44,0)
 . I Y'=1 S IBEND=1 W !,"Can't continue",! Q
"RTN","IBCB1",45,0)
 . D COBCHG^IBCCC2(IBIFN,+$$CURR^IBCEF2(IBIFN))
"RTN","IBCB1",46,0)
 ;
"RTN","IBCB1",47,0)
 W !!,"THIS BILL WILL "_$P("NOT ^",U,$$TXMT^IBCEF4(IBIFN)+1)_"BE TRANSMITTED ELECTRONICALLY"
"RTN","IBCB1",48,0)
 W !!,"WANT TO ",$S('IBMRA:"AUTHORIZE BILL",1:"REQUEST AN MRA")," AT THIS TIME" S %=2 D YN^DICN G:%=-1!(%=2) END
"RTN","IBCB1",49,0)
 I '% W !?4,"YES - If finished entering bill information and to allow bill to be printed or transmitted",!?4,"No - To take no action" G AUTH
"RTN","IBCB1",50,0)
 S (DIC,DIE)=399,IBYY=$S('IBMRA:"@90",1:"@901"),DA=IBIFN,DR="[IB STATUS]" D ^DIE K DIC,DIE,IBYY D:$D(IBX3) DISAP^IBCBULL
"RTN","IBCB1",51,0)
 I $S('IBMRA:'$P(^DGCR(399,IBIFN,"S"),"^",9),1:'$P($G(^DGCR(399,IBIFN,"TX")),U,6)) G END
"RTN","IBCB1",52,0)
 ;
"RTN","IBCB1",53,0)
 D AUTOCK^IBCEU2(IBIFN) ; Checks for need to add any codes to bill based on information already on bill, specifically for EDI purposes
"RTN","IBCB1",54,0)
 S IBTXSTAT=$$TXMT^IBCEF4(IBIFN,,1)  ;Determine transmit, whether live/test
"RTN","IBCB1",55,0)
 I IBTXSTAT D  I IBMRA D CTCOPY^IBCCCB(IBIFN,1) G END
"RTN","IBCB1",56,0)
 .W !,"  Adding "
"RTN","IBCB1",57,0)
 .W:+IBTXSTAT=2 "test" W " bill to BILL TRANSMISSION File"_$S('IBMRA:"",1:" for MRA submission")_".",!
"RTN","IBCB1",58,0)
 .W:+IBTXSTAT=1&IBMRA "  Bill is no longer editable unless returned in error from Medicare."
"RTN","IBCB1",59,0)
 .S Y=$$ADDTBILL(IBIFN,+IBTXSTAT)
"RTN","IBCB1",60,0)
 .W ! W:'$P(Y,U,3) *7 W $S($P(Y,U,3):"  Bill will be submitted electronically",1:"  Error loading into transmit file - bill can not be transmitted.")
"RTN","IBCB1",61,0)
 .;
"RTN","IBCB1",62,0)
 ;
"RTN","IBCB1",63,0)
 W !,"Passing completed Bill to Accounts Receivable.  Bill is no longer editable."
"RTN","IBCB1",64,0)
 D ARPASS(IBIFN,1)
"RTN","IBCB1",65,0)
 G:'$G(PRCASV("OKAY")) END
"RTN","IBCB1",66,0)
 W !,"Completed Bill Successfully sent to Accounts Receivable." D FIND^IBOHCK(DFN,IBIFN)
"RTN","IBCB1",67,0)
 S IBRESUB=$$RESUB^IBCECSA4($S($G(IBCNCOPY):$P($G(^DGCR(399,IBIFN,0)),U,15),1:IBIFN),+IBTXSTAT,"E")
"RTN","IBCB1",68,0)
 I IBRESUB>0 D
"RTN","IBCB1",69,0)
 . N IBDA,IB
"RTN","IBCB1",70,0)
 . S IB=+$S('$G(IBCNCOPY):IBIFN,1:$P($G(^DGCR(399,IBIFN,0)),U,15))
"RTN","IBCB1",71,0)
 . S IBDA=+$$LAST364^IBCEF4(IB)
"RTN","IBCB1",72,0)
 . I IBDA D UPDEDI^IBCEM(IBDA,$S($G(IBCNCOPY):"R",1:"E"))
"RTN","IBCB1",73,0)
 K IBTXPRT
"RTN","IBCB1",74,0)
 ;
"RTN","IBCB1",75,0)
4 ;generate/print bill
"RTN","IBCB1",76,0)
 G:'$D(IBIFN) END
"RTN","IBCB1",77,0)
 S:'$D(IBMRA) IBMRA=+$$NEEDMRA^IBEFUNC(IBIFN)
"RTN","IBCB1",78,0)
 I 'IBMRA,'$P(^DGCR(399,IBIFN,"S"),"^",9) W !!,*7,"Not Authorized, Can Not Print!" G END
"RTN","IBCB1",79,0)
 I IBMRA,'$P(^DGCR(399,IBIFN,"TX"),"^",6) W !!,*7,"Not Ready For MRA Submission, Can Not Print!" G END
"RTN","IBCB1",80,0)
 S IBTXSTAT=$$TXMT^IBCEF4(IBIFN)
"RTN","IBCB1",81,0)
 I IBMRA,$$NEEDMRA^IBEFUNC(IBIFN)'["R" W !!,*7,"MRA Submission not yet confirmed by Austin, Can Not Print!" Q:$S('IBTXSTAT:1,1:"XP"'[$P($G(^IBA(364,+$$LAST364^IBCEF4(IBIFN),0)),U,3))
"RTN","IBCB1",82,0)
 I +IBTXSTAT,$D(^IBA(364,"ABDT",IBIFN)) S IBTXOK="" D  I 'IBTXOK S %=2 G GENTX
"RTN","IBCB1",83,0)
 . N IBX,IBTST
"RTN","IBCB1",84,0)
 . S IBX=+$$LAST364^IBCEF4(IBIFN),IBTST=""
"RTN","IBCB1",85,0)
 . I $$TEST^IBCEF4(IBIFN) S (IBTXOK,IBTST)=1
"RTN","IBCB1",86,0)
 . I "XP"[$P($G(^IBA(364,IBX,0)),U,3) D:'IBTST  Q
"RTN","IBCB1",87,0)
 .. W !!,*7,"This Bill Can Not Be Printed Until Transmit Confirmed" W:IBMRA " (to request an MRA)" D:'$D(IBVIEW) VIEW^IBCB2
"RTN","IBCB1",88,0)
 . W !!,"This Bill Has Already Been Transmitted" W:IBMRA " (to request an MRA)"
"RTN","IBCB1",89,0)
 . S DIR("B")="Y",DIR("A")="WANT TO PRINT IT ANYWAY",DIR(0)="Y" D ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)!'Y  S IBTXOK=1
"RTN","IBCB1",90,0)
 D DISP^IBCB2
"RTN","IBCB1",91,0)
 S:'$D(IBQUIT) IBQUIT=0
"RTN","IBCB1",92,0)
 D:'$D(IBVIEW) VIEW^IBCB2 G:IBQUIT END
"RTN","IBCB1",93,0)
 S IBPNT=$P(^DGCR(399,IBIFN,"S"),"^",12)
"RTN","IBCB1",94,0)
GEN I $$TEST^IBCEF4(IBIFN) W !!,"THIS BILL IS BEING USED AS A TRANSMISSION TEST BILL"
"RTN","IBCB1",95,0)
 W !!,"WANT TO ",$S(IBPNT]"":"RE-",1:""),"PRINT BILL AT THIS TIME" S %=2 D YN^DICN I %=-1 D:+$G(IBAC)=1 END,CTCOPY^IBCCCB(IBIFN) G END
"RTN","IBCB1",96,0)
 I '% W !?4,"YES - to print the bill now",!?4,"NO - To take no action" G GEN
"RTN","IBCB1",97,0)
GENTX I %'=1 D:+$G(IBAC)=1 END,CTCOPY^IBCCCB(IBIFN) G END
"RTN","IBCB1",98,0)
 I 'IBPNT D:$D(IBTXPRT) TXPRTS D EN1^IBCF D:$D(IBTXPRT) TXPRT D:+$G(IBAC)=1 END,CTCOPY^IBCCCB(IBIFN) G END
"RTN","IBCB1",99,0)
RPNT G:$$NEEDMRA^IBEFUNC(IBIFN) END
"RTN","IBCB1",100,0)
 R !!,"(2)nd Notice, (3)rd Notice, (C)opy or (O)riginal: C// ",IBPNT:DTIME S:IBPNT="" IBPNT="C" G:IBPNT["^" END
"RTN","IBCB1",101,0)
 S IBPNT=$E(IBPNT,1) I "23oOcC"'[IBPNT W !?5,"Enter 'O' to reprint the original bill or",!?5,"Enter 'C' to reprint the bill as a duplicate copy or",!?5,"Enter '2' or '3' to print 2nd or 3rd follow-up notices." S IBPNT=1 G RPNT
"RTN","IBCB1",102,0)
 W "  (",$S("cC"[IBPNT:"COPY","oO"[IBPNT:"ORIGINAL",IBPNT=2:"2nd NOTICE",IBPNT=3:"3rd NOTICE",1:""),")"
"RTN","IBCB1",103,0)
 I $D(IBTXPRT) D
"RTN","IBCB1",104,0)
 . D TXPRTS
"RTN","IBCB1",105,0)
 . I "oOcC"[IBPNT S IBRESUB=$$RESUB^IBCECSA4(IBIFN,1,"P")
"RTN","IBCB1",106,0)
 S IBPNT=$S("oO"[IBPNT:1,"cC"[IBPNT:0,1:IBPNT)
"RTN","IBCB1",107,0)
 D EN1X^IBCF D:$D(IBTXPRT) TXPRT
"RTN","IBCB1",108,0)
 ;
"RTN","IBCB1",109,0)
END K IBER,IBEND D END^IBCBB1 K IBQUIT,IBVIEW,IBDISP,IBST,IB,PRCAERCD,PRCAERR,PRCASVC,PRCAT,DGRA2,IBBT,IBCH,IBNDS,IBOA,IBREV,IBX,DGXRF1,PRCAORA,IBX3,DGBILLBS,DGII,DGVISCNT,DGFIL,DGTE,IBTXOK,IBTXSTAT,IBMRA,IBNOFIX
"RTN","IBCB1",110,0)
 K %DT,DIC,DIE,I,J,X,Y,Y1,Y2,IBER,IBDFN,IBDSDT,IBJ,IBNDI1,IBZZ,VA,IBMA,IBXDT,DI,PRCAPAYR,DGBS,DGCNT,DGDA,DGPAG,DGREVC,DGRV,DGTEXT,DGTOTPAG,IBOPV,DGLCNT,DGTEXT1,DGRSPAC,DGSM,IBPNT,DGINPT,DGLL,IBCPTN,IBFL
"RTN","IBCB1",111,0)
 K IBOPV1,IBOPV2,IBCHG,DGBIL1,DGU,DDH,IBA1,IBINS,IBPROC,PRCARI K:'$D(PRCASV("NOTICE")) PRCASV
"RTN","IBCB1",112,0)
 K ^TMP("IBXDATA",$J),^TMP("IBXEDIT",$J)
"RTN","IBCB1",113,0)
 K IBCISNT,IBCISTAT,IBCIERR   ; remove ClaimsManager variables
"RTN","IBCB1",114,0)
 Q
"RTN","IBCB1",115,0)
 ;
"RTN","IBCB1",116,0)
TX1(IBX,RESUB) ; Transmit a single bill from file 364 entry # IBX
"RTN","IBCB1",117,0)
 ; RESUB = flag (1 = resubmitting a bill, 0 = submitting bill 1st time)
"RTN","IBCB1",118,0)
 ; Returns 1 if successfully extracted to mailman queue for transmission,
"RTN","IBCB1",119,0)
 ;         0 if extract not successful
"RTN","IBCB1",120,0)
 N IBTXOK,IBVVSAVE
"RTN","IBCB1",121,0)
 K ^TMP("IBRESUBMIT",$J),^TMP("IBONE",$J)
"RTN","IBCB1",122,0)
 S IBVVSAVE("IBX")=IBX,^TMP("IBONE",$J)=+$G(RESUB),^($J,IBX)=""
"RTN","IBCB1",123,0)
 D ONE^IBCE837
"RTN","IBCB1",124,0)
 S IBX=IBVVSAVE("IBX")
"RTN","IBCB1",125,0)
 I $P($G(^IBA(364,IBX,0)),U,3)="P" S IBTXOK=1
"RTN","IBCB1",126,0)
 K ^TMP("IBONE",$J)
"RTN","IBCB1",127,0)
 Q $G(IBTXOK)
"RTN","IBCB1",128,0)
 ;
"RTN","IBCB1",129,0)
ARONLY(IBIFN) ; Pass bill to A/R, but that's all
"RTN","IBCB1",130,0)
 D ARPASS(IBIFN,0)
"RTN","IBCB1",131,0)
 Q
"RTN","IBCB1",132,0)
 ;
"RTN","IBCB1",133,0)
ARPASS(IBIFN,UPDOK) ;Pass bill to A/R as NEW BILL
"RTN","IBCB1",134,0)
 ;IBIFN = bill entry #
"RTN","IBCB1",135,0)
 ;UPDOK = flag 1: if error going to A/R, allow interactive edit
"RTN","IBCB1",136,0)
 ;             0: send bulletin to IB EDI for error going to A/R
"RTN","IBCB1",137,0)
 Q:+$$STA^PRCAFN(+IBIFN)'=201  ;Must not have been sent previously
"RTN","IBCB1",138,0)
 D GVAR^IBCBB
"RTN","IBCB1",139,0)
 ;Can't be an ins co that won't reimburse
"RTN","IBCB1",140,0)
 Q:$S($P($G(^DGCR(399,IBIFN,0)),U,11)="i":'IBNDMP,1:0)
"RTN","IBCB1",141,0)
 D ARRAY^IBCBB1,^PRCASVC6
"RTN","IBCB1",142,0)
 D REL^PRCASVC:$G(PRCASV("OKAY"))
"RTN","IBCB1",143,0)
 I '$G(PRCASV("OKAY")) D
"RTN","IBCB1",144,0)
 . N IBQUIT,IBQUIT1
"RTN","IBCB1",145,0)
 . S IBQUIT=0
"RTN","IBCB1",146,0)
 . I $G(UPDOK) D  Q
"RTN","IBCB1",147,0)
 .. F  D  Q:IBQUIT
"RTN","IBCB1",148,0)
 ... D DSPARERR^IBCB2("")
"RTN","IBCB1",149,0)
 ... Q:IBQUIT
"RTN","IBCB1",150,0)
 ... I $$ASKEDIT^IBCB2($G(IBAC)) D VIEW1^IBCB2 Q
"RTN","IBCB1",151,0)
 ... S IBQUIT=1
"RTN","IBCB1",152,0)
 . N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","IBCB1",153,0)
 . S XMSUB="ERROR PASSING BILL TO A/R ON CONFIRMATION",XMTEXT="IBT(",XMY="G.IB EDI",XMDUZ=.5
"RTN","IBCB1",154,0)
 . S IBT(1)="A problem has been detected while trying to pass bill "_$P($G(^DGCR(399,IBIFN,0)),U)_" to"
"RTN","IBCB1",155,0)
 . S IBT(2)="Accounts Receivable when updating the bill's electronic confirmation."
"RTN","IBCB1",156,0)
 . S IBT(3)="Please use the option PASS BILL TO A/R to complete this process."
"RTN","IBCB1",157,0)
 . D ^XMD
"RTN","IBCB1",158,0)
 Q
"RTN","IBCB1",159,0)
 ;
"RTN","IBCB1",160,0)
ADDTBILL(IBIFN,TXST) ; Add new transmit bill rec to file 364 for bill IBIFN
"RTN","IBCB1",161,0)
 ; TXST = test flag 1=live, 2=test
"RTN","IBCB1",162,0)
 N COB,DD,DO,DIC,DLAYGO,X
"RTN","IBCB1",163,0)
 S TXST=($G(TXST)/2\1),COB=$$COB^IBCEF(IBIFN)
"RTN","IBCB1",164,0)
 S DIC(0)="L",DIC="^IBA(364,",DLAYGO=364,X=IBIFN,DIC("DR")=".03///X;.04///NOW;.07////"_TXST_";.08////"_COB D FILE^DICN
"RTN","IBCB1",165,0)
 Q Y
"RTN","IBCB1",166,0)
 ;
"RTN","IBCB1",167,0)
TXPRTS ; Save off last print date to see if bill was reprinted without queueing
"RTN","IBCB1",168,0)
 I '$$NEEDMRA^IBEFUNC(IBIFN) S IBTXPRT("PRT")=$P($G(^DGCR(399,IBIFN,"S")),U,14)
"RTN","IBCB1",169,0)
 Q
"RTN","IBCB1",170,0)
 ;
"RTN","IBCB1",171,0)
TXPRT ; Set variable if print was tasked or bill was printed (last print date changed)
"RTN","IBCB1",172,0)
 I '$$NEEDMRA^IBEFUNC(IBIFN),$S($G(ZTSK):1,1:IBTXPRT("PRT")'=$P($G(^DGCR(399,IBIFN,"S")),U,14)) S IBTXPRT=1
"RTN","IBCB1",173,0)
 Q
"RTN","IBCB1",174,0)
 ;
"RTN","IBCB2")
0^2^B49972168
"RTN","IBCB2",1,0)
IBCB2 ;ALB/AAS - Process bill after enter/edited ;13-DEC-89
"RTN","IBCB2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,51,161,182**;21-MAR-94
"RTN","IBCB2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCB2",4,0)
 ;
"RTN","IBCB2",5,0)
 ;MAP TO DGCRB2
"RTN","IBCB2",6,0)
 ;
"RTN","IBCB2",7,0)
 ;IBQUIT = Flag to stop processing
"RTN","IBCB2",8,0)
 ;IBVIEW = Flag showing Bill has been viewed
"RTN","IBCB2",9,0)
 ;IBDISP = Flag showing Bill entering display has been viewed.
"RTN","IBCB2",10,0)
 ;IBNOFIX = Flag to indicate do not ask to edit or review bill screens
"RTN","IBCB2",11,0)
 ;
"RTN","IBCB2",12,0)
VIEW ;View screens; if status allows editing , allow editing
"RTN","IBCB2",13,0)
 N Y,DIR
"RTN","IBCB2",14,0)
 S IBPOPOUT=0
"RTN","IBCB2",15,0)
 S IBVIEW=1,IBV=$S($D(IBV):IBV,1:1)
"RTN","IBCB2",16,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A")="WANT TO "_$S('IBV:"EDIT",1:"REVIEW")_" SCREENS? ",DIR("?",1)="   YES - to "_$S('IBV:"EDIT",1:"REVIEW")_" the screens",DIR("?")="   NO - To take no action"
"RTN","IBCB2",17,0)
 D ^DIR K DIR
"RTN","IBCB2",18,0)
 S:$D(DTOUT) IBQUIT=1
"RTN","IBCB2",19,0)
 Q:Y'=1
"RTN","IBCB2",20,0)
VIEW1 S IBVIEW=1,IBEDIT=0
"RTN","IBCB2",21,0)
 D SCREENS
"RTN","IBCB2",22,0)
 S:$G(IBPOPOUT) IBQUIT=1
"RTN","IBCB2",23,0)
 Q
"RTN","IBCB2",24,0)
 ;
"RTN","IBCB2",25,0)
DISP S IB("S")=$S($D(^DGCR(399,IBIFN,"S")):^("S"),1:"")
"RTN","IBCB2",26,0)
 W ! D DISP^IBCNQ W !
"RTN","IBCB2",27,0)
 S IBDISP=1 Q
"RTN","IBCB2",28,0)
 Q
"RTN","IBCB2",29,0)
 ;
"RTN","IBCB2",30,0)
EDITS ; Perform edits on bill prior to authorization/transmission
"RTN","IBCB2",31,0)
 S IBQUIT=0
"RTN","IBCB2",32,0)
 I '$D(IBER)!('$D(PRCASV)) D ALLED(.IBQUIT)
"RTN","IBCB2",33,0)
 ;
"RTN","IBCB2",34,0)
 ; If the user is wanting to quit, but there are some unresolved
"RTN","IBCB2",35,0)
 ; errors reported by ClaimsManager, then capture the user's Exit
"RTN","IBCB2",36,0)
 ; comments.
"RTN","IBCB2",37,0)
 ;
"RTN","IBCB2",38,0)
 I $$CM^IBCIUT1(IBIFN),IBQUIT,$P($G(^IBA(351.9,IBIFN,0)),U,2)=4 D COMMENT^IBCIUT7(IBIFN,1)
"RTN","IBCB2",39,0)
 ;
"RTN","IBCB2",40,0)
 Q:IBQUIT
"RTN","IBCB2",41,0)
 D:'$D(IBDISP) DISP
"RTN","IBCB2",42,0)
 D:'$D(IBVIEW) VIEW
"RTN","IBCB2",43,0)
 Q
"RTN","IBCB2",44,0)
 ;
"RTN","IBCB2",45,0)
ALLED(IBQUIT) ; Billing edit/correction
"RTN","IBCB2",46,0)
 N IBQUIT1,IBDONE1,IBDONE,IBEDIT,IBCORR,IBER,IBPRT,IBXERR
"RTN","IBCB2",47,0)
 S (IBQUIT,IBDONE,IBCORR)=0,IBER=""
"RTN","IBCB2",48,0)
 ; IBDONE = 1 ==> exit, no errors 
"RTN","IBCB2",49,0)
 ; IBQUIT = 1 ==> exit, errors not corrected
"RTN","IBCB2",50,0)
 I $$FT^IBCEF(IBIFN)=2,'$G(IBNOFIX) D DISP24(IBIFN,.IBCORR,.IBQUIT)
"RTN","IBCB2",51,0)
 ;
"RTN","IBCB2",52,0)
 F  D  Q:IBQUIT!IBDONE  D VIEW1 I $$FT^IBCEF(IBIFN)=2,'$G(IBNOFIX),'IBQUIT S IBCORR=0 D DISP24(IBIFN,.IBCORR,.IBQUIT)
"RTN","IBCB2",53,0)
 . I $G(IBPOPOUT) S IBQUIT=1
"RTN","IBCB2",54,0)
 . Q:IBQUIT!IBCORR
"RTN","IBCB2",55,0)
 . I $G(IBNOFIX) D
"RTN","IBCB2",56,0)
 .. W !!,"... Checking claim validity"
"RTN","IBCB2",57,0)
 . E  D
"RTN","IBCB2",58,0)
 .. W !!,"... Executing national IB edits"
"RTN","IBCB2",59,0)
 . D EN^IBCBB,LOCERR
"RTN","IBCB2",60,0)
 . ;
"RTN","IBCB2",61,0)
 . I $G(IBER)'=""!$D(IBXERR) D  Q:'IBDONE
"RTN","IBCB2",62,0)
 .. D DSPLERR ; Displays warnings/errors
"RTN","IBCB2",63,0)
 .. K IBXERR
"RTN","IBCB2",64,0)
 .. Q:IBQUIT!(IBDONE)
"RTN","IBCB2",65,0)
 .. I $G(IBNOFIX) S IBDONE=1 Q
"RTN","IBCB2",66,0)
 .. I '$$ASKEDIT($G(IBAC)) W ! S IBQUIT=1 ; Don't want to re-edit
"RTN","IBCB2",67,0)
 .. ;
"RTN","IBCB2",68,0)
 . I $G(IBNOFIX) S IBDONE=1 Q
"RTN","IBCB2",69,0)
 . S IBEDIT=0
"RTN","IBCB2",70,0)
 . I $S($P($G(^DGCR(399,IBIFN,0)),U,13)>2:1,$D(PRCASV):'$D(PRCASV("OKAY")),1:0) D  S:'IBQUIT&'IBEDIT IBDONE=1 Q
"RTN","IBCB2",71,0)
 .. N IBQUIT1
"RTN","IBCB2",72,0)
 .. S IBQUIT1=0
"RTN","IBCB2",73,0)
 .. W !!!,"... Executing A/R edits"
"RTN","IBCB2",74,0)
 .. I $P($G(^DGCR(399,IBIFN,0)),U,13)>2 D GVAR^IBCBB,ARRAY^IBCBB1
"RTN","IBCB2",75,0)
 .. D ARCHK($G(IBNOFIX),0,.IBQUIT1,.IBQUIT,.IBEDIT,.PRCASV)
"RTN","IBCB2",76,0)
 . S IBDONE=1 ; No errors
"RTN","IBCB2",77,0)
 . S:$G(IBPRT("PRT"))'<0 IBQUIT=0
"RTN","IBCB2",78,0)
 Q
"RTN","IBCB2",79,0)
 ;
"RTN","IBCB2",80,0)
ARCHK(IBNOFIX,IBNOPRT,IBQUIT1,IBQUIT,IBEDIT,PRCASV) ; A/R Verification
"RTN","IBCB2",81,0)
 ; Returns IBEDIT, IBQUIT1, IBQUIT,PRCASV array if passed by reference
"RTN","IBCB2",82,0)
 ; IBNOFIX = 1 if no editing needed
"RTN","IBCB2",83,0)
 ; IBNOPRT = 1 if no printing needed
"RTN","IBCB2",84,0)
 F  D ^PRCASVC6 D  Q:IBQUIT1!IBEDIT  D GVAR^IBCBB,ARRAY^IBCBB1
"RTN","IBCB2",85,0)
 . I '$G(IBNOPRT) Q:$G(IBPRT("PRT"))<0
"RTN","IBCB2",86,0)
 . I PRCASV("OKAY") W:'$G(IBNOPRT) !!,"No A/R errors found" S IBQUIT1=1 Q
"RTN","IBCB2",87,0)
 . I 'PRCASV("OKAY") D  Q
"RTN","IBCB2",88,0)
 .. D DSPARERR($G(IBNOPRT)) ; Display A/R errors
"RTN","IBCB2",89,0)
 .. Q:IBQUIT
"RTN","IBCB2",90,0)
 .. I $G(IBNOFIX) S IBQUIT1=1 Q
"RTN","IBCB2",91,0)
 .. I '$$ASKEDIT($G(IBAC)) W !,"There is an unresolved A/R error - cannot authorize bill" D PAUSE^VALM1 S (IBQUIT,IBQUIT1)=1 Q
"RTN","IBCB2",92,0)
 .. S IBEDIT=1
"RTN","IBCB2",93,0)
 ;
"RTN","IBCB2",94,0)
 Q
"RTN","IBCB2",95,0)
 ;
"RTN","IBCB2",96,0)
DSPLERR ; Display national/local edits failed
"RTN","IBCB2",97,0)
 N Z
"RTN","IBCB2",98,0)
 D PRTH(.IBPRT)
"RTN","IBCB2",99,0)
 I IBPRT("PRT")<0 S IBQUIT=1 Q
"RTN","IBCB2",100,0)
 S Z=0 F  S Z=$O(^TMP($J,"BILL-WARN",Z)) Q:'Z  W !,^(Z) W:'$O(^(Z)) !
"RTN","IBCB2",101,0)
 S Y2=""
"RTN","IBCB2",102,0)
 I IBER'="WARN" F I=1:1 S X=$P(IBER,";",I) Q:X=""  W:I=1 !?5,"**Errors**:" I $D(^IBE(350.8,+$O(^IBE(350.8,"AC",X,0)),0)) S Y=^(0),Y1=$P(Y,"^",5),Y2=Y2_Y1 I Y1<5 W !?5,$E($P(Y,"^",2),1,80)
"RTN","IBCB2",103,0)
 ; IBXERR = local edits return error array
"RTN","IBCB2",104,0)
 ; If IBXERR returns = 1 then we have at least one error
"RTN","IBCB2",105,0)
 ;                   = "" or 0, then we have only local warnings
"RTN","IBCB2",106,0)
 ;           undefined = no local errors or warnings
"RTN","IBCB2",107,0)
 I $D(IBXERR) D
"RTN","IBCB2",108,0)
 . S I="" W !!,?3,"Local Edits:"
"RTN","IBCB2",109,0)
 . S:$G(IBXERR) Y2=3,IBER="L"
"RTN","IBCB2",110,0)
 . F  S I=$O(IBXERR(I)) Q:I=""  W !,?5,$E(IBXERR(I),1,75)
"RTN","IBCB2",111,0)
 I $G(IBPRT("PRT")) D CLOSE(.IBPRT)
"RTN","IBCB2",112,0)
 G:$G(IBNOFIX) Q
"RTN","IBCB2",113,0)
 I $G(IBER)="WARN"!($G(IBXERR)=0) D  ;Warnings only - make biller stop and look
"RTN","IBCB2",114,0)
 . W !
"RTN","IBCB2",115,0)
 . N DIR,X,Y
"RTN","IBCB2",116,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("A",1)="THIS BILL STILL HAS ONE OR MORE WARNINGS - PLEASE REVIEW THEM CAREFULLY",DIR("A")="ARE YOU SURE IT'S OK TO CONTINUE? "
"RTN","IBCB2",117,0)
 . D ^DIR K DIR
"RTN","IBCB2",118,0)
 . I Y'=1 S Y2=3 Q
"RTN","IBCB2",119,0)
 . S IBER="",IBDONE=1 K IBXERR
"RTN","IBCB2",120,0)
 I $S(Y2'["3"&'$G(IBXERR):0,1:1) K IBXERR
"RTN","IBCB2",121,0)
Q K ^TMP($J,"BILL-WARN")
"RTN","IBCB2",122,0)
 Q
"RTN","IBCB2",123,0)
 ;
"RTN","IBCB2",124,0)
DSPARERR(IBNOPRT) ; Displays A/R errors
"RTN","IBCB2",125,0)
 N I,J,Y,X,ERRPRT
"RTN","IBCB2",126,0)
 I '$G(IBNOPRT) D PRTH(.IBPRT) I IBPRT("PRT")<0 S IBQUIT=1 Q
"RTN","IBCB2",127,0)
 I $P($G(PRCAERR),U,2)'="" D
"RTN","IBCB2",128,0)
 . N Z
"RTN","IBCB2",129,0)
 . S Z=+$O(^IBE(350.8,"C",$P(PRCAERR,U,2),0)),Z=$P($G(^IBE(350.8,+Z,0)),U,2)
"RTN","IBCB2",130,0)
 . W !,?5,"An A/R error has been reported - bill cannot be authorized",!!,?5,$P(PRCAERR,U,2)," - ",$S(Z'="":Z,1:"??")
"RTN","IBCB2",131,0)
 E  D
"RTN","IBCB2",132,0)
 . W !,?5,"An undetermined A/R error was found - "_$G(PRCAERR)
"RTN","IBCB2",133,0)
 I $G(IBPRT("PRT")) D CLOSE(.IBPRT)
"RTN","IBCB2",134,0)
 Q
"RTN","IBCB2",135,0)
 ;
"RTN","IBCB2",136,0)
NOPTF S IBAC1=1 I $D(^DGCR(399,IBIFN,0)),$P(^(0),"^",8),'$D(^DGPT($P(^(0),"^",8),0)) S IBAC1=0
"RTN","IBCB2",137,0)
 Q
"RTN","IBCB2",138,0)
 ;
"RTN","IBCB2",139,0)
NOPTF1 W !!,*7,"PTF Record for this Bill was DELETED!",!,"Further processing not allowed.  Cancel and re-enter." Q
"RTN","IBCB2",140,0)
 ;
"RTN","IBCB2",141,0)
LOCERR ; Check for local edits
"RTN","IBCB2",142,0)
 ; Execute screen post-processor for bills with local scrn 9 affiliations
"RTN","IBCB2",143,0)
 N IBZ,IBXIEN,IBPRT
"RTN","IBCB2",144,0)
 K IBXERR
"RTN","IBCB2",145,0)
 S IBZ=$$LOCSCRN^IBCSC9(IBIFN)
"RTN","IBCB2",146,0)
 I IBZ S IBXIEN=IBIFN W !!,"... Executing local IB edits" D FPOST^IBCEFG7(IBZ,0,.IBXERR) I '$D(IBXERR) W !!,"No errors found for local edits"
"RTN","IBCB2",147,0)
 Q
"RTN","IBCB2",148,0)
 ;
"RTN","IBCB2",149,0)
PRTH(IBPRT,IBA) ; Print a heading for error/warnings sent to a printer
"RTN","IBCB2",150,0)
 ; Returns IBPRT = 1 if valid pritner selected
"RTN","IBCB2",151,0)
 ;         IBPRT = -1 if '^' entered
"RTN","IBCB2",152,0)
 ;         IBPRT = 0 if home device
"RTN","IBCB2",153,0)
 N POP,%ZIS,POP
"RTN","IBCB2",154,0)
 S %ZIS("A")="ERROR/WARNING OUTPUT DEVICE: "
"RTN","IBCB2",155,0)
 D ^%ZIS
"RTN","IBCB2",156,0)
 I POP S IBPRT("PRT")=-1 Q
"RTN","IBCB2",157,0)
 I IO=IO(0) S IBPRT("PRT")=0 Q
"RTN","IBCB2",158,0)
 S IBPRT("PRT")=1
"RTN","IBCB2",159,0)
 U IO
"RTN","IBCB2",160,0)
 W !,"INCONSISTENCIES LIST FOR BILL #: ",$P($G(^DGCR(399,IBIFN,0)),U),!,$J("",29),"AT: ",$$FMTE^XLFDT($$NOW^XLFDT,2),!,$J("",19),"GENERATED BY: ",$P($G(^VA(200,DUZ,0)),U),!!
"RTN","IBCB2",161,0)
 Q
"RTN","IBCB2",162,0)
 ;
"RTN","IBCB2",163,0)
CLOSE(IBPRT) ; Close device, reset printer flag
"RTN","IBCB2",164,0)
 D ^%ZISC
"RTN","IBCB2",165,0)
 S IBPRT("PRT")=0
"RTN","IBCB2",166,0)
 D HOME^%ZIS
"RTN","IBCB2",167,0)
 Q
"RTN","IBCB2",168,0)
 ;
"RTN","IBCB2",169,0)
ASKEDIT(IBAC) ; Ask if edit/review of bill is desired
"RTN","IBCB2",170,0)
 ; FUNCTION returns 0/1 for NO/YES
"RTN","IBCB2",171,0)
 ; IBAC = flag for function being performed - to determine edit/review
"RTN","IBCB2",172,0)
 N DIR,X,Y
"RTN","IBCB2",173,0)
 S DIR(0)="YA"
"RTN","IBCB2",174,0)
 S DIR("A",1)=" ",DIR("A",2)=" ",DIR("A")="Do you wish to "_$S($G(IBAC)<4:"edit",1:"review")_" the inconsistencies now? ",DIR("B")="NO"
"RTN","IBCB2",175,0)
 S DIR("?",1)=" ",DIR("?",2)=" ",DIR("?",3)="   YES - To edit inconsistent fields",DIR("?")="   NO - To discontinue this process."
"RTN","IBCB2",176,0)
 D ^DIR K DIR
"RTN","IBCB2",177,0)
 Q (Y=1)
"RTN","IBCB2",178,0)
 ;
"RTN","IBCB2",179,0)
SCREENS ;
"RTN","IBCB2",180,0)
 N IBH
"RTN","IBCB2",181,0)
 D ^IBCSCU,^IBCSC1
"RTN","IBCB2",182,0)
 I $G(IBV) K IBPOPOUT
"RTN","IBCB2",183,0)
 Q
"RTN","IBCB2",184,0)
 ;
"RTN","IBCB2",185,0)
DISP24(IBIFN,IBCORR,IBQUIT) ;
"RTN","IBCB2",186,0)
 W @IOF D BL24^IBCSCH(IBIFN,0)
"RTN","IBCB2",187,0)
 S DIR("A",1)=" ",DIR("A")="Are the above charges correct for this bill? ",DIR("B")="YES",DIR(0)="YA" D ^DIR K DIR
"RTN","IBCB2",188,0)
 I Y'=1 D
"RTN","IBCB2",189,0)
 . I Y=0,$$ASKEDIT($G(IBAC)) S IBCORR=1 Q
"RTN","IBCB2",190,0)
 . S IBQUIT=1
"RTN","IBCB2",191,0)
 Q
"RTN","IBCB2",192,0)
 ;
"RTN","IBCB2",193,0)
IICM(IBIFN) ; Ingenix ClaimsManager: Claim Scrubber
"RTN","IBCB2",194,0)
 ; Send the bill to ClaimsManager, the IBCISTAT variable returned from ClaimsManager indicates
"RTN","IBCB2",195,0)
 ;         3 - Passed CM with no errors
"RTN","IBCB2",196,0)
 ;         5 - User overriding the CM errors
"RTN","IBCB2",197,0)
 ;         7 - the CM interface isn't working
"RTN","IBCB2",198,0)
 ;        11 - User overriding the CM errors (CM not updated)
"RTN","IBCB2",199,0)
 ; 
"RTN","IBCB2",200,0)
 ; Returns False (0) if the bill fails the ClaimsManager Scrubber/errors found
"RTN","IBCB2",201,0)
 ; Returns True (1) if the bill passed the ClaimsManager Scrubber/no errors found or ClaimsManager not On at site
"RTN","IBCB2",202,0)
 ;
"RTN","IBCB2",203,0)
 N IBOK S IBOK=1
"RTN","IBCB2",204,0)
 I +$G(IBIFN),$$CM^IBCIUT1(IBIFN) S IBCISNT=1 D ST2^IBCIST I '$F(".3.5.7.11.","."_IBCISTAT_".") S IBOK=0
"RTN","IBCB2",205,0)
 Q IBOK
"RTN","IBCB2",206,0)
 ;
"RTN","IBCB2",207,0)
IIQMED(IBIFN) ; DSS QuadraMed Interface: QuadraMed Claim Scrubber
"RTN","IBCB2",208,0)
 ; Send the bill to the QuadraMed Claim Scrubber
"RTN","IBCB2",209,0)
 ; Returns False (0) if the bill fails the QuadraMed Scrubber/errors found
"RTN","IBCB2",210,0)
 ; Returns True (1) if the bill passed the QuadraMed Scrubber/no errors found or QuadraMed not On at site
"RTN","IBCB2",211,0)
 ;
"RTN","IBCB2",212,0)
 ; QuadraMed Scrubber EN^VEJDIBSC returns IBQMED = 1 if no error found, returns 0 if error found
"RTN","IBCB2",213,0)
 ;
"RTN","IBCB2",214,0)
 N IBQMED S IBQMED=1
"RTN","IBCB2",215,0)
 I +$G(IBIFN),$$QMED^IBCU1("EN^VEJDIBSC",IBIFN) D EN^VEJDIBSC(IBIFN)
"RTN","IBCB2",216,0)
 Q IBQMED
"RTN","IBCCC2")
0^3^B49867202
"RTN","IBCCC2",1,0)
IBCCC2 ;ALB/AAS - CANCEL AND CLONE A BILL - CONTINUED ;25-JAN-90
"RTN","IBCCC2",2,0)
 ;;2.0;INTEGRATED BILLING;**80,106,124,138,51,151,137,161,182**;21-MAR-94
"RTN","IBCCC2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCCC2",4,0)
 ;
"RTN","IBCCC2",5,0)
 ;MAP TO DGCRCC2
"RTN","IBCCC2",6,0)
 ;
"RTN","IBCCC2",7,0)
 ;STEP 5 - get remainder of data to move and store in MCCR then x-ref
"RTN","IBCCC2",8,0)
 ;STEP 6 - go to screens, come out to IBB1 or something like that
"RTN","IBCCC2",9,0)
 ;
"RTN","IBCCC2",10,0)
STEP5 S IBIFN1=$P(^DGCR(399,IBIFN,0),"^",15) G END:$S(IBIFN1="":1,'$D(^DGCR(399,IBIFN1,0)):1,1:0)
"RTN","IBCCC2",11,0)
 ;
"RTN","IBCCC2",12,0)
 ;move pure data nodes
"RTN","IBCCC2",13,0)
 F I="I1","I2","I3","M1" I $D(^DGCR(399,IBIFN1,I)) S ^DGCR(399,IBIFN,I)=^DGCR(399,IBIFN1,I)
"RTN","IBCCC2",14,0)
 ;
"RTN","IBCCC2",15,0)
 ;move top level data node. ;Do not move 'TX' node
"RTN","IBCCC2",16,0)
 F I="U","U1","U2","UF2","UF3","UF31","C","M" I $D(^DGCR(399,IBIFN1,I)) S IBND(I)=^(I) D @I
"RTN","IBCCC2",17,0)
 ;
"RTN","IBCCC2",18,0)
 ;move multiple level data
"RTN","IBCCC2",19,0)
 F I="CC","OC","OP","RC","CP","CV","PRV" I $D(^DGCR(399,IBIFN1,I,0)) D @I
"RTN","IBCCC2",20,0)
 ;
"RTN","IBCCC2",21,0)
 D FTPRV^IBCEU5(IBIFN) ; Ask change prov type if form type not the same
"RTN","IBCCC2",22,0)
 D COBCHG(IBIFN,,.IBCOB)
"RTN","IBCCC2",23,0)
 ;
"RTN","IBCCC2",24,0)
 D ^IBCCC3 ; copy table files (362.3)
"RTN","IBCCC2",25,0)
 ;
"RTN","IBCCC2",26,0)
 S I=$G(^DGCR(399,IBIFN1,0)) I $P(I,U,13)=7,$P(I,U,20)=1 D COPYB^IBCDC(IBIFN1,IBIFN) ; update auto bill files
"RTN","IBCCC2",27,0)
 D PRIOR(IBIFN) ; add new bill to previous bills in series, primary/secondary
"RTN","IBCCC2",28,0)
 I +$G(IBCTCOPY) N IBAUTO S IBAUTO=1 D BILL^IBCRBC(IBIFN),CPTMOD26^IBCU73(IBIFN) D RECALL^DILFD(399,IBIFN_",",DUZ) G END
"RTN","IBCCC2",29,0)
 ;
"RTN","IBCCC2",30,0)
STEP6 N IBGOEND
"RTN","IBCCC2",31,0)
 I '$G(IBCE("EDI"))!$G(IBCE("EDI","NEW")),'$G(IBCEAUTO) D IBSCEDT G END:$G(IBGOEND)
"RTN","IBCCC2",32,0)
 ;
"RTN","IBCCC2",33,0)
 ;
"RTN","IBCCC2",34,0)
END K DFN,IB,IBA,IBA2,IBAD,IBADD1,IBBNO,IBCAN,IBCCC,IBDA,IBDPT,IBDR,IBDT,IBI,IBI1,IBIDS,IBIFN,IBIFN1,IBND,IBQUIT,IBU,IBUN,IBARST,IBCOB,IBCNCOPY,IBCBCOPY
"RTN","IBCCC2",35,0)
 K IBV,IBV1,IBW,IBWW,IBYN,IBZZ,PRCASV,PRCAERCD,PRCAERR,PRCASVC,PRCAT,IBBT,IBCH,IBNDS,IBOA,IBREV,IBX,DGXRF1,VAEL,VAERR,IBAC,IBCCC,IBDD1,IBIN,DGREV,DGREV00,DGREVHDR,IBCHK
"RTN","IBCCC2",36,0)
 K IBBS,IBLS,DGPCM,IBIP,IBND0,IBNDU,IBO,IBPTF,IBST,IBUC,IBDD,D,%,%DT,DIC,VA,VADM,X,X1,X2,X3,X4,Y,I,J,K,DGRVRCAL,DDH,DGACTDT,DGAMNT,DGBR,DGBRN,DGBSI,DGBSLOS,IBA1,IBOD,IBINS,IBN,IBPROC,DGFUNC,DGIFN
"RTN","IBCCC2",37,0)
 Q
"RTN","IBCCC2",38,0)
 ;
"RTN","IBCCC2",39,0)
 ;
"RTN","IBCCC2",40,0)
IBSCEDT ; call the IB bill edit screens and validate the data
"RTN","IBCCC2",41,0)
 N IBV,IBPAR,IBAC,IBHV,IBH,IBCIREDT
"RTN","IBCCC2",42,0)
 D RECALL^DILFD(399,IBIFN_",",DUZ)
"RTN","IBCCC2",43,0)
ST1 S IBV=0 D ^IBCSCU,^IBCSC1 I $G(IBPOPOUT) S IBGOEND=1 G IBSCX
"RTN","IBCCC2",44,0)
 S IBAC=1
"RTN","IBCCC2",45,0)
 D ^IBCB1
"RTN","IBCCC2",46,0)
 I $G(IBCIREDT) G ST1
"RTN","IBCCC2",47,0)
IBSCX ;
"RTN","IBCCC2",48,0)
 Q
"RTN","IBCCC2",49,0)
 ;
"RTN","IBCCC2",50,0)
 ;
"RTN","IBCCC2",51,0)
U F J=3,4,6:1:17,20 I $P(IBND("U"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U"),"^",J)=$P(IBND("U"),"^",J)
"RTN","IBCCC2",52,0)
 Q
"RTN","IBCCC2",53,0)
U1 F J=1:1:9,13,14 I $P(IBND("U1"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U1"),"^",J)=$P(IBND("U1"),"^",J)
"RTN","IBCCC2",54,0)
 Q
"RTN","IBCCC2",55,0)
U2 F J=1:1:19 I $P(IBND("U2"),"^",J)]"" S $P(^DGCR(399,IBIFN,"U2"),"^",J)=$P(IBND("U2"),"^",J)
"RTN","IBCCC2",56,0)
 Q
"RTN","IBCCC2",57,0)
UF2 F J=1 I $P(IBND("UF2"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF2"),"^",J)=$P(IBND("UF2"),"^",J)
"RTN","IBCCC2",58,0)
 Q
"RTN","IBCCC2",59,0)
UF3 F J=1:1:7 I $P(IBND("UF3"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF3"),"^",J)=$P(IBND("UF3"),"^",J)
"RTN","IBCCC2",60,0)
 Q
"RTN","IBCCC2",61,0)
UF31 F J=1:1:3 I $P(IBND("UF31"),"^",J)]"" S $P(^DGCR(399,IBIFN,"UF31"),"^",J)=$P(IBND("UF31"),"^",J)
"RTN","IBCCC2",62,0)
 Q
"RTN","IBCCC2",63,0)
C F J=10 I $P(IBND("C"),"^",J)]"" S $P(^DGCR(399,IBIFN,"C"),"^",J)=$P(IBND("C"),"^",J)
"RTN","IBCCC2",64,0)
 I '$D(^DGCR(399,IBIFN1,"CP")) D CP1
"RTN","IBCCC2",65,0)
 Q
"RTN","IBCCC2",66,0)
M F J=1:1:14 I $P(IBND("M"),"^",J)]"" S $P(^DGCR(399,IBIFN,"M"),"^",J)=$P(IBND("M"),"^",J)
"RTN","IBCCC2",67,0)
 Q
"RTN","IBCCC2",68,0)
CC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",69,0)
 S IBDD=399.04 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",70,0)
OP S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",71,0)
 S IBDD=399.043 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",72,0)
 Q
"RTN","IBCCC2",73,0)
OC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",74,0)
 S IBDD=399.041 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",75,0)
 Q
"RTN","IBCCC2",76,0)
CV ; Don't copy value codes from inpatient inst to inpatient prof bills
"RTN","IBCCC2",77,0)
 I $$FT^IBCEF(IBIFN1)'=2,$$FT^IBCEF(IBIFN)=2 Q
"RTN","IBCCC2",78,0)
 S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",79,0)
 S IBDD=399.047 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",80,0)
 Q
"RTN","IBCCC2",81,0)
RC S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",82,0)
 S IBDD=399.042 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S IBND("RC")=^(0) F K=1:1:15 S $P(^DGCR(399,IBIFN,I,J,0),"^",K)=$P(IBND("RC"),"^",K),X=$P(IBND("RC"),"^",K)
"RTN","IBCCC2",83,0)
 Q
"RTN","IBCCC2",84,0)
CP S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",85,0)
 I +$G(IBNOCPT) Q
"RTN","IBCCC2",86,0)
 S IBDD=399.0304 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) S IBND("CP")=^(0),IBND("CP-AUX")=$G(^("AUX")) D
"RTN","IBCCC2",87,0)
 . F K=1:1:7,9:1:13,15:1:20 S $P(^DGCR(399,IBIFN,I,J,0),"^",K)=$P(IBND("CP"),"^",K)
"RTN","IBCCC2",88,0)
 . I IBND("CP-AUX")'="" F K=1:1:8 S $P(^DGCR(399,IBIFN,I,J,"AUX"),"^",K)=$P(IBND("CP-AUX"),"^",K)
"RTN","IBCCC2",89,0)
 . I $D(^DGCR(399,IBIFN1,I,J,"MOD",0)) S ^DGCR(399,IBIFN,I,J,"MOD",0)=^DGCR(399,IBIFN1,I,J,"MOD",0) D
"RTN","IBCCC2",90,0)
 .. S K=0 F  S K=$O(^DGCR(399,IBIFN1,I,J,"MOD",K)) Q:'K  D
"RTN","IBCCC2",91,0)
 ... I $G(IBNOTC),$P($$MOD^ICPTMOD(+$P($G(^DGCR(399,IBIFN1,I,J,"MOD",K,0)),U,2),"I"),U,2)="TC" Q  ; Don't copy TC modifier from inst to prof bill
"RTN","IBCCC2",92,0)
 ... S ^DGCR(399,IBIFN,I,J,"MOD",K,0)=^DGCR(399,IBIFN1,I,J,"MOD",K,0)
"RTN","IBCCC2",93,0)
CP1 S IBCOD=$P($G(^DGCR(399,IBIFN,0)),"^",9) Q:IBCOD=""!('$D(^DGCR(399,IBIFN1,"C")))
"RTN","IBCCC2",94,0)
 I IBCOD=9 F DGI=4,5,6 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICD0(",DGPROCDT=$P(^("C"),"^",DGI+7) D FILE
"RTN","IBCCC2",95,0)
 I IBCOD=4 F DGI=1,2,3 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICPT(",DGPROCDT=$P(^("C"),"^",DGI+10) D FILE
"RTN","IBCCC2",96,0)
 I IBCOD=5 F DGI=7,8,9 I $P(^DGCR(399,IBIFN1,"C"),"^",DGI) S X=$P(^("C"),"^",DGI)_";ICPT(",DGPROCDT=$P(^("C"),"^",DGI+4) D FILE
"RTN","IBCCC2",97,0)
 Q
"RTN","IBCCC2",98,0)
 ;
"RTN","IBCCC2",99,0)
PRV S ^DGCR(399,IBIFN,I,0)=^DGCR(399,IBIFN1,I,0)
"RTN","IBCCC2",100,0)
 N Z,Z0
"RTN","IBCCC2",101,0)
 S Z=$P($G(^DGCR(399,IBIFN,0)),U,19),Z0=$P($G(^DGCR(399,IBIFN1,0)),U,19)
"RTN","IBCCC2",102,0)
 S IBDD=399.0222 F J=0:0 S J=$O(^DGCR(399,IBIFN1,I,J)) Q:'J  I $D(^(J,0)) D
"RTN","IBCCC2",103,0)
 . S ^DGCR(399,IBIFN,I,J,0)=^DGCR(399,IBIFN1,I,J,0),X=$P(^(0),"^")
"RTN","IBCCC2",104,0)
 . I Z'=Z0,$S(X=3:Z0=3,X=4:Z0=2,1:0) S $P(^DGCR(399,IBIFN,I,J,0),U)=(Z0+1)
"RTN","IBCCC2",105,0)
 Q
"RTN","IBCCC2",106,0)
 ;
"RTN","IBCCC2",107,0)
COB S J=0 F  S J=$O(IBCOB(I,J)) Q:'J  S $P(^DGCR(399,IBIFN,I),U,J)=IBCOB(I,J)
"RTN","IBCCC2",108,0)
 Q
"RTN","IBCCC2",109,0)
 ;
"RTN","IBCCC2",110,0)
FILE N DIC,DIE,DR,DA,X,Y,DLAYGO,DD,DO
"RTN","IBCCC2",111,0)
 I '$D(^DGCR(399,IBIFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCCC2",112,0)
 S DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""CP""," Q:X=""  D FILE^DICN K DO,DD Q:+Y<1  S DA=+Y
"RTN","IBCCC2",113,0)
 S DIE="^DGCR(399,"_DA(1)_",""CP"",",DR="1///"_DGPROCDT D ^DIE
"RTN","IBCCC2",114,0)
 K DGPROCDT
"RTN","IBCCC2",115,0)
 Q
"RTN","IBCCC2",116,0)
 ;
"RTN","IBCCC2",117,0)
INDEX ;index entire file (set logic)
"RTN","IBCCC2",118,0)
 S DIK="^DGCR(399,",DA=IBIFN D IX1^DIK K DA,DIK
"RTN","IBCCC2",119,0)
 Q
"RTN","IBCCC2",120,0)
 ;
"RTN","IBCCC2",121,0)
PRIOR(IBIFN) ; set Secondary/Tertiary Bill #s on prior bills, if the bill is cancelled remove it from prior bills
"RTN","IBCCC2",122,0)
 N IBSEQ,IBSEQN,IBM1,I,IBIFN1
"RTN","IBCCC2",123,0)
 S IBSEQ=$$COB^IBCEF(IBIFN)
"RTN","IBCCC2",124,0)
 S IBSEQN=$S(IBSEQ="S":6,IBSEQ="T":7,1:"") Q:'IBSEQN
"RTN","IBCCC2",125,0)
 ;
"RTN","IBCCC2",126,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1")) I +$P(^DGCR(399,IBIFN,0),U,13)=7 S IBIFN=""
"RTN","IBCCC2",127,0)
 F I=5,6 I I<IBSEQN  S IBIFN1=+$P(IBM1,U,I) I +IBIFN1,$D(^DGCR(399,+IBIFN1,0)) S $P(^DGCR(399,IBIFN1,"M1"),U,IBSEQN)=IBIFN
"RTN","IBCCC2",128,0)
 Q
"RTN","IBCCC2",129,0)
 ;
"RTN","IBCCC2",130,0)
COBCHG(IBIFN,IBINS,IBCOB) ; Make changes for a new COB payer for bill
"RTN","IBCCC2",131,0)
 ; IBIFN = ien of bill in file 399
"RTN","IBCCC2",132,0)
 ; IBINS = ien of bill's current insurance (optional)
"RTN","IBCCC2",133,0)
 ; IBCOB = array subscripted by node,piece of COB data field change
"RTN","IBCCC2",134,0)
 ;
"RTN","IBCCC2",135,0)
 N I
"RTN","IBCCC2",136,0)
 ; Subtract the Prior Payments from the bill's Offset (these are re-added by triggers)
"RTN","IBCCC2",137,0)
 F I=4,5,6  S $P(^DGCR(399,IBIFN,"U1"),U,2)=$P($G(^DGCR(399,IBIFN,"U1")),U,2)-$P($G(^DGCR(399,IBIFN,"U2")),U,I)
"RTN","IBCCC2",138,0)
 ;
"RTN","IBCCC2",139,0)
 I $G(IBINS),$$MCRWNR^IBEFUNC(IBINS) D
"RTN","IBCCC2",140,0)
 . ;MCRWNR is current insurance ... move payer only
"RTN","IBCCC2",141,0)
 . N IBCOBN,IBX
"RTN","IBCCC2",142,0)
 . S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCCC2",143,0)
 . S IBCOB(0,15)=""
"RTN","IBCCC2",144,0)
 . S IBCOB(0,21)=$P("S^T^",U,IBCOBN)
"RTN","IBCCC2",145,0)
 . S IBCOB("M1",IBCOBN+4)=IBIFN
"RTN","IBCCC2",146,0)
 . S IBCOB("TX",1)="",IBCOB("TX",2)="",IBCOB("TX",6)=""
"RTN","IBCCC2",147,0)
 . S IBX=$$REQMRA^IBEFUNC(IBIFN)
"RTN","IBCCC2",148,0)
 . I IBX=0 S IBCOB("TX",5)=0
"RTN","IBCCC2",149,0)
 . I IBX["R" S IBCOB("TX",5)="A"
"RTN","IBCCC2",150,0)
 . I IBX=1 D
"RTN","IBCCC2",151,0)
 .. N Z,Z0,IBOK
"RTN","IBCCC2",152,0)
 .. S (IBOK,Z)=0
"RTN","IBCCC2",153,0)
 .. F  S Z=$O(^IBM(361.1,"ABS",IBIFN,IBCOBN,Z)) Q:'Z  D  Q:IBOK
"RTN","IBCCC2",154,0)
 ... S Z0=$G(^IBM(361.1,Z,0))
"RTN","IBCCC2",155,0)
 ... I "23"[$P(Z0,U,16) S IBOK=1
"RTN","IBCCC2",156,0)
 .. I 'IBOK S IBCOB("TX",5)=$E("AC",IBOK+1)
"RTN","IBCCC2",157,0)
 . D PRIOR(IBIFN)
"RTN","IBCCC2",158,0)
 ;
"RTN","IBCCC2",159,0)
 ;reset fields for next Sequence Payer
"RTN","IBCCC2",160,0)
 F I=0,"M1","U2","TX" I $D(IBCOB(I)) D COB
"RTN","IBCCC2",161,0)
 ;
"RTN","IBCCC2",162,0)
 ; fire xrefs set logic
"RTN","IBCCC2",163,0)
 D INDEX
"RTN","IBCCC2",164,0)
 ;
"RTN","IBCCC2",165,0)
 K IBCOB("TX")
"RTN","IBCCC2",166,0)
 Q
"RTN","IBCCC2",167,0)
 ;
"RTN","IBCCCB")
0^4^B80922057
"RTN","IBCCCB",1,0)
IBCCCB ;ALB/ARH - COPY BILL FOR COB ;06-19-97
"RTN","IBCCCB",2,0)
 ;;2.0;INTEGRATED BILLING;**80,106,51,151,137,182**;21-MAR-94
"RTN","IBCCCB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCCCB",4,0)
 ;
"RTN","IBCCCB",5,0)
 ; Copy bill for COB w/out cancelling, update some flds
"RTN","IBCCCB",6,0)
 ; Primary->Secondary->Tertiary
"RTN","IBCCCB",7,0)
ASK ;
"RTN","IBCCCB",8,0)
 S IBCBCOPY=1 ; flag that copy function entered thru Copy COB option
"RTN","IBCCCB",9,0)
 ;
"RTN","IBCCCB",10,0)
 D KVAR S IBCAN=2,IBU="UNSPECIFIED"
"RTN","IBCCCB",11,0)
 ;
"RTN","IBCCCB",12,0)
 S IBX=$$PB^IBJTU2 S:+IBX=2 IBIFN=$P(IBX,U,2) I +IBX=1 S DFN=$P(IBX,U,2),IBV=1,IBAC=5 D DATE^IBCB
"RTN","IBCCCB",13,0)
 I '$G(IBIFN) G EXIT
"RTN","IBCCCB",14,0)
 ;
"RTN","IBCCCB",15,0)
 D DSPRB^IBCCCB0(IBIFN)
"RTN","IBCCCB",16,0)
 ;
"RTN","IBCCCB",17,0)
CHKB ; Entrypoint-COB processing via EDI's COB Mgmt
"RTN","IBCCCB",18,0)
 ; Ask if final EOB was received for previous bill
"RTN","IBCCCB",19,0)
 I '$$FINALEOB^IBCCCB0(IBIFN) G EXIT
"RTN","IBCCCB",20,0)
 ; Warn if previous bill not at least authorized
"RTN","IBCCCB",21,0)
 I '$$COBOK^IBCCCB0(IBIFN) G EXIT
"RTN","IBCCCB",22,0)
 S IBX=$G(^DGCR(399,+IBIFN,0)),DFN=$P(IBX,U,2),IBDT=$P(IBX,U,3)\1,IBER=""
"RTN","IBCCCB",23,0)
 I IBCAN>1 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 G ASK1
"RTN","IBCCCB",24,0)
 ;
"RTN","IBCCCB",25,0)
 F IBI=0,"S","U1","M","MP","M1" S IB(IBI)=$G(^DGCR(399,IBIFN,IBI))
"RTN","IBCCCB",26,0)
 I IB(0)="" S IBER="Invalid Bill Number" D ERROR G ASK1
"RTN","IBCCCB",27,0)
 ;
"RTN","IBCCCB",28,0)
 I IB("S")]"",+$P(IB("S"),U,16),$P(IB("S"),U,17)]"" W !!,"This bill was cancelled on " S Y=$P(IB("S"),U,17) X ^DD("DD") W Y," by ",$S($P(IB("S"),U,18)']"":IBU,$D(^VA(200,$P(IB("S"),U,18),0)):$P(^(0),U,1),1:IBU),"." G ASK1
"RTN","IBCCCB",29,0)
 ;
"RTN","IBCCCB",30,0)
 S IBCOB=$$COB^IBCEF(IBIFN),IBCOBN=$TR(IBCOB,"PSTA","12")
"RTN","IBCCCB",31,0)
 S IBMRAIO=+$$CURR^IBCEF2(IBIFN),IBMRAO=$$MCRWNR^IBEFUNC(IBMRAIO)
"RTN","IBCCCB",32,0)
 S IBNMOLD=$S(IBCOB="P":"Primary",IBCOB="S":"Secondary",IBCOB="T":"Tertiary",IBCOB="A":"Patient",1:"")_$S(IBMRAO:"-MRA Only",1:"")
"RTN","IBCCCB",33,0)
 S IBINSOLD=$G(^DIC(36,$S(IB("MP"):+IB("MP"),IBMRAO:IBMRAIO,1:0),0))
"RTN","IBCCCB",34,0)
 ;
"RTN","IBCCCB",35,0)
NEXTP ; If current bill=MEDICARE WNR and valid 'next payer', use same
"RTN","IBCCCB",36,0)
 ;  bill for new payer
"RTN","IBCCCB",37,0)
 ; If next valid 'payer' is ins co or MEDICARE WNR, create new bill
"RTN","IBCCCB",38,0)
 S IBCOBN=IBCOBN+1,IBNM=$S(IBCOBN=2:"Secondary Payer",IBCOBN=3:"Tertiary Payer",1:"")
"RTN","IBCCCB",39,0)
 ;
"RTN","IBCCCB",40,0)
 I IBNM="" S IBER=$P(IB(0),U,1)_" is a "_IBNMOLD_" bill, there is no next bill in the series." D ERROR G ASK1
"RTN","IBCCCB",41,0)
 ;
"RTN","IBCCCB",42,0)
 S IBX=+$P(IB("M1"),U,(4+IBCOBN)),IBY=$G(^DGCR(399,+IBX,0)),IBCOBIL(+IBIFN)=""
"RTN","IBCCCB",43,0)
 ;
"RTN","IBCCCB",44,0)
 I $P(IBY,U,13)=7 S IBER="The "_$P(IBNM," ",1)_" bill "_$P(IBY,U,1)_" has been cancelled." D ERROR S IBX=""
"RTN","IBCCCB",45,0)
 ;
"RTN","IBCCCB",46,0)
 I +IBX,$D(IBCOBIL(+IBX)) S IBER="Next bill in series can not be determined." D ERROR G ASK1
"RTN","IBCCCB",47,0)
 I +IBX S IBER=$P(IBNM," ",1)_" bill already defined for this series: "_$P(IBY,U,1) D ERROR S IBIFN=IBX G ASK1
"RTN","IBCCCB",48,0)
 ;
"RTN","IBCCCB",49,0)
 S IBINSN=$P(IB("M"),U,IBCOBN) I 'IBINSN S IBER="There is no "_IBNM_" for "_$P(IB(0),U,1)_"." D ERROR G ASK1
"RTN","IBCCCB",50,0)
 S IBINS=$G(^DIC(36,+IBINSN,0)) I IBINS="" S IBER="The "_IBNM_" for "_$P(IB(0),U,1)_" is not a valid Insurance Co." D ERROR G ASK1
"RTN","IBCCCB",51,0)
 ;
"RTN","IBCCCB",52,0)
 S IBMRA=0
"RTN","IBCCCB",53,0)
 I $P(IBINS,U,2)="N" S IBQ=0 D  G:IBQ NEXTP
"RTN","IBCCCB",54,0)
 . I $$MCRWNR^IBEFUNC(IBINSN) D  Q
"RTN","IBCCCB",55,0)
 .. ; Check if a valid tert ins if MCR WNR secondary
"RTN","IBCCCB",56,0)
 .. I IBCOBN'>2 D
"RTN","IBCCCB",57,0)
 ... N Z
"RTN","IBCCCB",58,0)
 ... S Z=+$P(IB("M"),U,IBCOBN+1)
"RTN","IBCCCB",59,0)
 ... I Z,$D(^DIC(36,Z,0)),$P(^(0),U,2)'="N" S IBMRA=1,IBNM=$P(IBNM," ")_"-MRA.Only"
"RTN","IBCCCB",60,0)
 .. I 'IBMRA S IBER="MEDICARE will not reimburse and no further valid insurance for bill" D ERROR S IBQ=1
"RTN","IBCCCB",61,0)
 . S IBER=$P(IB(0),U,1)_" "_IBNM_", "_$P(IBINS,U,1)_", will not Reimburse" D ERROR S IBQ=1
"RTN","IBCCCB",62,0)
 ;
"RTN","IBCCCB",63,0)
 W !!
"RTN","IBCCCB",64,0)
 S DIR("?")="Enter Yes to "_$S('$G(IBMRAO):"create a new bill in the bill series for this care.  The new bill will be the "_$P(IBNM," ")_" bill ",1:"enter the MRA information and change the payer to the "_$P(IBNM,"-")_" payer")
"RTN","IBCCCB",65,0)
 S DIR("?")=DIR("?")_$S('IBMRA:"with the "_IBNM_" responsible for payment.",1:"and will request an MRA from MEDICARE.")
"RTN","IBCCCB",66,0)
 S DIR(0)="YO",DIR("A")=$S('$G(IBMRAO):"Copy "_$P(IB(0),U,1)_" for a bill to the ",1:"Change payer on bill "_$P(IB(0),U,1)_" to ")_IBNM_", "_$P(IBINS,U,1) D ^DIR K DIR I Y'=1 G ASK1
"RTN","IBCCCB",67,0)
 ;
"RTN","IBCCCB",68,0)
 W !
"RTN","IBCCCB",69,0)
 S DIR("?")="  This will be added to the new bill as a prior payment and subtracted from the charges due for the new bill."
"RTN","IBCCCB",70,0)
 ;
"RTN","IBCCCB",71,0)
 I '$G(IBMRAO) D
"RTN","IBCCCB",72,0)
 . N Z
"RTN","IBCCCB",73,0)
 .S DIR("?")="Enter the amount of the payment from the payer of the "_IBNMOLD_" bill."_DIR("?")
"RTN","IBCCCB",74,0)
 .S DIR("A")="Prior Payment from "_$P(IB(0),U,1)_" "_IBNMOLD_" Payer, "_$P(IBINSOLD,U,1)_": "
"RTN","IBCCCB",75,0)
 . S Z=$$EOBTOT^IBCEU1(IBIFN,$$COBN^IBCEF(IBIFN))
"RTN","IBCCCB",76,0)
 . S:Z DIR("B")=Z
"RTN","IBCCCB",77,0)
 E  D
"RTN","IBCCCB",78,0)
 . N Z
"RTN","IBCCCB",79,0)
 .S DIR("?")="Enter the MEDICARE allowed amt from the MRA received for this bill."_DIR("?")
"RTN","IBCCCB",80,0)
 . S DIR("A")="MRA Allowed Amount from "_$P(IB(0),U,1)_" "_IBNMOLD_": "
"RTN","IBCCCB",81,0)
 . S Z=$$EOBTOT^IBCEU1(IBIFN,$$COBN^IBCEF(IBIFN))
"RTN","IBCCCB",82,0)
 . S:Z DIR("B")=Z
"RTN","IBCCCB",83,0)
 ;
"RTN","IBCCCB",84,0)
 S DIR(0)="NOA^0:99999999:2"
"RTN","IBCCCB",85,0)
 D ^DIR K DIR I Y=""!$D(DIRUT) G ASK1
"RTN","IBCCCB",86,0)
 K:'IBMRAO IBCOB
"RTN","IBCCCB",87,0)
 S IBCOB("U2",IBCOBN+2)=Y
"RTN","IBCCCB",88,0)
 ;
"RTN","IBCCCB",89,0)
 I 'IBMRAO D
"RTN","IBCCCB",90,0)
 . S IBCOB(0,15)=""
"RTN","IBCCCB",91,0)
 . S IBCOB(0,21)=$S(IBCOBN=2:"S",IBCOBN=3:"T",1:"") Q:IBCOB(0,21)=""
"RTN","IBCCCB",92,0)
 . S IBCOB("M1",IBCOBN+3)=IBIFN
"RTN","IBCCCB",93,0)
 . ;
"RTN","IBCCCB",94,0)
 . S IBIDS(.15)=IBIFN
"RTN","IBCCCB",95,0)
 I 'IBMRAO Q:IBCOB(0,21)=""  D KVAR G STEP2^IBCCC
"RTN","IBCCCB",96,0)
 D COBCHG^IBCCC2(IBIFN,IBMRAIO,.IBCOB)
"RTN","IBCCCB",97,0)
END Q
"RTN","IBCCCB",98,0)
 ;
"RTN","IBCCCB",99,0)
ASK1 ; If entering thru EDI COB processing, don't ask for new bill, quit
"RTN","IBCCCB",100,0)
 I $G(IBCBASK) G EXIT
"RTN","IBCCCB",101,0)
 G ASK
"RTN","IBCCCB",102,0)
 ;
"RTN","IBCCCB",103,0)
ERROR ;
"RTN","IBCCCB",104,0)
 W !,IBER,! S IBER=""
"RTN","IBCCCB",105,0)
 Q
"RTN","IBCCCB",106,0)
 ;
"RTN","IBCCCB",107,0)
EXIT K IBCAN,IBCOB,IBU
"RTN","IBCCCB",108,0)
KVAR K IBX,IBY,IBI,IBIFN,DFN,IBDT,IB,IBCOBN,IBNMOLD,IBINSOLD,IBNM,IBINSN,IBINS,IBER,DIR,IBAC,IBAC1,IBV,X,Y,IBDATA,IBT,IBND0,DIRUT,IBCOBIL,IBMRA,IBMRAI,IBMRAO,IBMRAIO,IBCBCOPY
"RTN","IBCCCB",109,0)
 K ^UTILITY($J)
"RTN","IBCCCB",110,0)
 Q
"RTN","IBCCCB",111,0)
 ;
"RTN","IBCCCB",112,0)
DSPRB(IBIFN) ; display related bills
"RTN","IBCCCB",113,0)
 ;
"RTN","IBCCCB",114,0)
 D DSPRB^IBCCCB0(IBIFN) ; Code moved for size too big
"RTN","IBCCCB",115,0)
 Q
"RTN","IBCCCB",116,0)
 ;
"RTN","IBCCCB",117,0)
 ; ==============
"RTN","IBCCCB",118,0)
 ; 
"RTN","IBCCCB",119,0)
 ; Copy a bill for Reasonable Charges without cancelling it, update certain fields
"RTN","IBCCCB",120,0)
 ;
"RTN","IBCCCB",121,0)
 ; there is always both inpt inst (created first) and prof charges, always need both bills
"RTN","IBCCCB",122,0)
 ; there may be both outpt inst (created first) and prof charges, may not need both bills
"RTN","IBCCCB",123,0)
 ; if billing by episode rather than by day (current standard) then may need multiple prof bills per day
"RTN","IBCCCB",124,0)
 ; 
"RTN","IBCCCB",125,0)
 ; Inst bills are copied to create prof Bills automatically
"RTN","IBCCCB",126,0)
 ; Subsequent prof bills may be created if the user wants them
"RTN","IBCCCB",127,0)
 ;
"RTN","IBCCCB",128,0)
 ; Only the first bill in the COB series of bills should be copied for the next prof bill
"RTN","IBCCCB",129,0)
 ; The primary inst bill should be copied to get the secondary inst bill
"RTN","IBCCCB",130,0)
 ; The primary prof bill should be copied to get the secondary prof bill
"RTN","IBCCCB",131,0)
 ;
"RTN","IBCCCB",132,0)
CTCOPY(IBIFN,IBMRA) ; based on the type of bill, copy without cancelling
"RTN","IBCCCB",133,0)
 ; IBMRA = 1 if an MRA bill and copy for prof components is desired
"RTN","IBCCCB",134,0)
 ;
"RTN","IBCCCB",135,0)
 D CTCOPY^IBCCCB0(IBIFN,$G(IBMRA)) ;Moved due to routine size
"RTN","IBCCCB",136,0)
 Q
"RTN","IBCCCB",137,0)
 ;
"RTN","IBCCCB",138,0)
CTCOPY1(IBIFN) ;  Copy a Reasonable Charges inst bill to create a prof bill:
"RTN","IBCCCB",139,0)
 ;   - Billing Rate must be Reasonable Charges
"RTN","IBCCCB",140,0)
 ;   - Bill being copied must be an inst bill
"RTN","IBCCCB",141,0)
 ;   - Prof bill must not already exist for the event date
"RTN","IBCCCB",142,0)
 ;   - If the bill is outpt at least one CPT must have prof charges
"RTN","IBCCCB",143,0)
 ;   - Procedure codes are copied only if the care is outpt
"RTN","IBCCCB",144,0)
 ;
"RTN","IBCCCB",145,0)
 N IB0,IBU,IBBTYPE,IBBCTO,IBBCTN,IBBCTOD,IBBCTND,IBNOCPT,IBCTCOPY,IBX,IBHV,IBNOTC
"RTN","IBCCCB",146,0)
 ;
"RTN","IBCCCB",147,0)
 S IBCTCOPY=1 ; flag - the copy function entered to auto copy Inst->Prof
"RTN","IBCCCB",148,0)
 ;
"RTN","IBCCCB",149,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBU=$G(^("U")) Q:'IBU
"RTN","IBCCCB",150,0)
 S IBBTYPE=$S($P(IB0,U,5)<3:"Inpatient",1:"Outpatient")
"RTN","IBCCCB",151,0)
 ;
"RTN","IBCCCB",152,0)
 S IBBCTO=$P(IB0,U,27),IBBCTN=0 I 'IBBCTO Q
"RTN","IBCCCB",153,0)
 I IBBCTO=1 S IBBCTN=2 ; inst defined, create prof
"RTN","IBCCCB",154,0)
 I 'IBBCTN Q
"RTN","IBCCCB",155,0)
 ;
"RTN","IBCCCB",156,0)
 I '$$BILLRATE^IBCRU3($P(IB0,U,7),$P(IB0,U,5),$P(IBU,U,1,2),"RC") Q  ; copy only reasonable charges bills
"RTN","IBCCCB",157,0)
 ;
"RTN","IBCCCB",158,0)
 S IBBCTOD=$S(IBBCTO=1:"INSTITUTIONAL",2:"PROFESSIONAL"),IBBCTND=$S(IBBCTN=1:"INSTITUTIONAL",2:"PROFESSIONAL")
"RTN","IBCCCB",159,0)
 ;
"RTN","IBCCCB",160,0)
 I $P(IB0,U,5)>2,'$$CPTCHG^IBCRCU1(IBIFN,"PROF") W !!!,"There are no Reasonable Charges Outpatient Professional charges for this bill,",!,"second bill not created.",!! Q
"RTN","IBCCCB",161,0)
 ;
"RTN","IBCCCB",162,0)
 W !!!,"This ",IBBTYPE," ",IBBCTOD," bill may have corresponding ",IBBCTND," charges."
"RTN","IBCCCB",163,0)
 ;
"RTN","IBCCCB",164,0)
 I '$G(^DGCR(399,IBIFN,"U1")) W !!,"The current bill has no charges defined, no second bill created." Q
"RTN","IBCCCB",165,0)
 ;
"RTN","IBCCCB",166,0)
 S IBX=$$CTCHK^IBCU41(IBIFN) I +IBX W !!,"There is an existing ",IBBTYPE," ",IBBCTND," bill (",$P($G(^DGCR(399,+IBX,0)),U,1),") that appears",!,"to correspond to this ",IBBCTOD," bill, second bill not created.",!! Q
"RTN","IBCCCB",167,0)
 ;
"RTN","IBCCCB",168,0)
 W !,"Creating an ",IBBTYPE," ",IBBCTND," bill.",!!
"RTN","IBCCCB",169,0)
 ;
"RTN","IBCCCB",170,0)
 S IBCOB(0,27)=IBBCTN
"RTN","IBCCCB",171,0)
 S IBIDS(.15)=IBIFN D KVAR
"RTN","IBCCCB",172,0)
 ;
"RTN","IBCCCB",173,0)
 I $P(IB0,U,5)<3 S IBNOCPT=1 ; do not copy inpt facility procedures (ICD) to inpt prof bill
"RTN","IBCCCB",174,0)
 S IBNOTC=1 ; don't copy TC modifier from inst to prof bill
"RTN","IBCCCB",175,0)
 D STEP2^IBCCC ; copy/create second bill
"RTN","IBCCCB",176,0)
 ;
"RTN","IBCCCB",177,0)
 I $G(IBHV("IBIFN1"))!(IBCTCOPY=1) D FTPRV^IBCEU5(+$G(IBHV("IBIFN1")),1) ; Change att to rend prov if new prof bill added
"RTN","IBCCCB",178,0)
 S IBV=0,IBAC=1
"RTN","IBCCCB",179,0)
 ;
"RTN","IBCCCB",180,0)
 ; DSS QuadraMed Interface: CPT Sequence and Diagnosis Linkage
"RTN","IBCCCB",181,0)
 I +$G(IBHV("IBIFN1")),$$QMED^IBCU1("CTCOPY^VEJDIBE1",IBHV("IBIFN1")) D CTCOPY^VEJDIBE1(IBHV("IBIFN1"))
"RTN","IBCCCB",182,0)
 Q
"RTN","IBCCCB",183,0)
 ;
"RTN","IBCCCB",184,0)
CTCOPY2(IBIFN) ; Copy a Reasonable Charges prof bill to create another prof bill if user wants another:
"RTN","IBCCCB",185,0)
 ;   - Billing Rate must be Reasonable Charges
"RTN","IBCCCB",186,0)
 ;   - Bill being copied must be a prof bill
"RTN","IBCCCB",187,0)
 ;   - Procedures are not copied
"RTN","IBCCCB",188,0)
 ;
"RTN","IBCCCB",189,0)
 N IB0,IBU,IBBTYPE,IBBCTO,IBNOCPT,IBCTCOPY,IBX,DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBCCCB",190,0)
 ;
"RTN","IBCCCB",191,0)
 S IBCTCOPY=2 ; flag indicating the copy function is entered to auto Copy prof->prof
"RTN","IBCCCB",192,0)
 ;
"RTN","IBCCCB",193,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)) Q:IB0=""  S IBU=$G(^("U")) Q:'IBU
"RTN","IBCCCB",194,0)
 S IBBTYPE=$S($P(IB0,U,5)<3:"Inpatient",1:"Outpatient")
"RTN","IBCCCB",195,0)
 S IBBCTO=$P(IB0,U,27) I IBBCTO'=2 Q  ; prof bills only
"RTN","IBCCCB",196,0)
 ;
"RTN","IBCCCB",197,0)
 I '$$BILLRATE^IBCRU3($P(IB0,U,7),$P(IB0,U,5),$P(IBU,U,1,2),"RC") Q  ; copy only reasonable charges bills
"RTN","IBCCCB",198,0)
 ;
"RTN","IBCCCB",199,0)
 I '$G(^DGCR(399,IBIFN,"U1")) Q  ; if the current bill has no charges do not allow creation of another one
"RTN","IBCCCB",200,0)
 ;
"RTN","IBCCCB",201,0)
 ; ask if they want a second prof bill
"RTN","IBCCCB",202,0)
 S DIR("?",1)="If answered Yes, the current bill will be copied, without being cancelled,"
"RTN","IBCCCB",203,0)
 S DIR("?",2)="to create another Professional bill for the same dates of care.",DIR("?",3)=" "
"RTN","IBCCCB",204,0)
 S DIR("?")="Enter Yes if multiple professional bills are needed for the care provided on this date."
"RTN","IBCCCB",205,0)
 S DIR("A")="Copy this bill to create another Professional bill for this date now"
"RTN","IBCCCB",206,0)
 W !! S DIR(0)="Y",DIR("B")="No" D ^DIR I $D(DIRUT)!('Y) Q
"RTN","IBCCCB",207,0)
 ;
"RTN","IBCCCB",208,0)
 W !,"Creating an ",IBBTYPE," Professional bill.",!!
"RTN","IBCCCB",209,0)
 ;
"RTN","IBCCCB",210,0)
 S IBIDS(.15)=IBIFN D KVAR
"RTN","IBCCCB",211,0)
 ;
"RTN","IBCCCB",212,0)
 S IBNOCPT=1
"RTN","IBCCCB",213,0)
 D STEP2^IBCCC ; copy/create second prof bill
"RTN","IBCCCB",214,0)
 S IBV=0,IBAC=1
"RTN","IBCCCB",215,0)
 Q
"RTN","IBCCCB",216,0)
 ;
"RTN","IBCCPT")
0^6^B55414765
"RTN","IBCCPT",1,0)
IBCCPT ;ALB/LDB/AAS - MCCR OUTPATIENT VISITS LISTING CONT. ;29 MAY 90
"RTN","IBCCPT",2,0)
 ;;2.0;INTEGRATED BILLING;**55,62,52,91,106,125,51,148,174,182**;21-MAR-94
"RTN","IBCCPT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCCPT",4,0)
 ;
"RTN","IBCCPT",5,0)
 ;MAP TO DGCRCPT
"RTN","IBCCPT",6,0)
 ;
"RTN","IBCCPT",7,0)
EN1(IBQUERY,IBHLP) ;
"RTN","IBCCPT",8,0)
 K DIR
"RTN","IBCCPT",9,0)
EN D:$D(DIR) HLP W @IOF S DGU=0 K DGCPT,^UTILITY($J) D VST(.IBQUERY)
"RTN","IBCCPT",10,0)
 D CHDR,WRNO
"RTN","IBCCPT",11,0)
 S (DGCNT,DGCNT1)=0 F  S DGCNT=$O(^UTILITY($J,"CPT-CNT",DGCNT)) Q:'DGCNT  S DGNOD=^(DGCNT),DGCPT=+DGNOD,DGDAT=$P(DGNOD,"^",2),DGBIL=$P(DGNOD,"^",3),DGASC=$P(DGNOD,"^",4),DGDIV=$P(DGNOD,"^",5),DGCNT1=DGCNT1+1 D CPRT I DGU="^" S DGCNT=DGCNT-1 Q
"RTN","IBCCPT",12,0)
 I DGU'="^" F Y=$Y:1:IOSL-6 W !
"RTN","IBCCPT",13,0)
OK1 K Y Q:'$D(^UTILITY($J,"CPT-CNT"))!($D(DIR))!($G(IBHLP))
"RTN","IBCCPT",14,0)
OK S DIR(0)="LAO^1:"_DGCNT1_"^K:X[""."" X",DIR("?")="^N DIR D EN1^IBCCPT(.IBQUERY,1)",DIR("A")="SELECT CPT CODE(S) TO INCLUDE IN THIS BILL: "
"RTN","IBCCPT",15,0)
 D ^DIR K DIR I 'Y D Q1^IBCOPV1 Q
"RTN","IBCCPT",16,0)
 S IBFT=+$P(^DGCR(399,IBIFN,0),"^",19)
"RTN","IBCCPT",17,0)
OK2 W !,"YOU HAVE SELECTED CPT CODE(S) NUMBERED-",$E(Y,1,$L(Y)-1),!,"IS THIS CORRECT" S %=1 D YN^DICN I %=-1 S IBOUT=1 D Q^IBCOPV1 Q
"RTN","IBCCPT",18,0)
 I +Y,'% W !,"Respond 'Y'es to include these codes in the bill.",!,"Respond 'N'o to reselect." G OK2
"RTN","IBCCPT",19,0)
 I +Y,%=2 G OK
"RTN","IBCCPT",20,0)
 ;
"RTN","IBCCPT",21,0)
FILE S DGCPT1=Y,(DGCNT,DGCNT2)=0
"RTN","IBCCPT",22,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR=".09///5" D ^DIE K DR,DA,DIE
"RTN","IBCCPT",23,0)
 F I9=1:1 S I1=$P(DGCPT1,",",I9) Q:'I1  I $D(^UTILITY($J,"CPT-CNT",I1)) S DGNOD=^(I1) D FILE1
"RTN","IBCCPT",24,0)
 D Q1^IBCOPV1 Q
"RTN","IBCCPT",25,0)
 ;
"RTN","IBCCPT",26,0)
FILE1 ;  file procedures, if BASC, only for 1 visit date
"RTN","IBCCPT",27,0)
 K DGNOADD S (X,DINUM)=$P(DGNOD,"^",2) D VFILE1^IBCOPV1 K DINUM,X
"RTN","IBCCPT",28,0)
 N IBCPTNM S IBCPTNM=$$CPT^ICPTCOD(+DGNOD,+$P(DGNOD,U,2))
"RTN","IBCCPT",29,0)
 I $D(DGNOADD) W !?10,"Can't add Amb. Surg. ",$P(IBCPTNM,U,2)," without visit date!" Q  ;don't add cpt for date that can't go on bill
"RTN","IBCCPT",30,0)
 I IBFT'=2,+$P(DGNOD,"^",4),$$TOMANY($P(DGNOD,"^",2)) W !?10,"Can't add Billable Amb. Surg. ",$P(IBCPTNM,U,2)," when more than one visit date!",*7 Q
"RTN","IBCCPT",31,0)
 D DSPPRC(IBCPTNM,DGNOD)
"RTN","IBCCPT",32,0)
 ;
"RTN","IBCCPT",33,0)
 S:'$D(^DGCR(399,IBIFN,"CP",0)) DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCCPT",34,0)
 S DLAYGO=399,DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""CP"",",DIC(0)="L",X=+DGNOD_";ICPT(" K DD,DO D FILE^DICN S (DA,IBPROCP)=+Y K DO,DD,DLAYGO,DIC("P")
"RTN","IBCCPT",35,0)
 ;
"RTN","IBCCPT",36,0)
 S DR="1///"_$P(DGNOD,"^",2)
"RTN","IBCCPT",37,0)
 I +$P(DGNOD,"^",8) S DR=DR_";18///`"_+$P(DGNOD,"^",8)
"RTN","IBCCPT",38,0)
 I +$P(DGNOD,"^",9) S DR=DR_";6///`"_+$P(DGNOD,"^",9)
"RTN","IBCCPT",39,0)
 I +$P(DGNOD,"^",5) S DR=DR_";5////"_+$P(DGNOD,"^",5)
"RTN","IBCCPT",40,0)
 I +$P(DGNOD,"^",11) S DR=DR_";20////"_+$P(DGNOD,"^",11)
"RTN","IBCCPT",41,0)
 S DIE=DIC D ^DIE
"RTN","IBCCPT",42,0)
 D:$P(DGNOD,U,10)'="" ADDMOD(IBIFN,IBPROCP,$P(DGNOD,U,10))
"RTN","IBCCPT",43,0)
 ;
"RTN","IBCCPT",44,0)
 S DR="16"
"RTN","IBCCPT",45,0)
 I '$P(DGNOD,"^",8) S DR=DR_";18"
"RTN","IBCCPT",46,0)
 I '$P(DGNOD,"^",9) S DR=DR_";6"
"RTN","IBCCPT",47,0)
 I '$P(DGNOD,"^",5) S DR=DR_";5"
"RTN","IBCCPT",48,0)
 S:IBFT=2 DR=DR_";8;9;17//NO"
"RTN","IBCCPT",49,0)
 S DIE=DIC D ^DIE
"RTN","IBCCPT",50,0)
 ;
"RTN","IBCCPT",51,0)
 ; DSS QuadraMed Interface: CPT Sequence and Diagnosis Linkage for Single CPT
"RTN","IBCCPT",52,0)
 I $$QMED^IBCU1("DX^VEJDIBE1",IBIFN) D DX^VEJDIBE1(IBIFN,IBPROCP)
"RTN","IBCCPT",53,0)
 ;
"RTN","IBCCPT",54,0)
 Q:$D(Y)
"RTN","IBCCPT",55,0)
 D DX^IBCU72(IBIFN,IBPROCP):IBFT=2
"RTN","IBCCPT",56,0)
 I IBFT=2 S X=$$ADDTNL^IBCU7(IBIFN,.DA)
"RTN","IBCCPT",57,0)
 L ^DGCR(399,IBIFN):1
"RTN","IBCCPT",58,0)
 K DIE,DIC,DR,DA,IBPROCP
"RTN","IBCCPT",59,0)
 Q
"RTN","IBCCPT",60,0)
 ;
"RTN","IBCCPT",61,0)
CPRT D:$Y+6>IOSL SCR Q:DGU="^"
"RTN","IBCCPT",62,0)
 N IBCPTNM,IBNBM,IBMODS,J,IBZ S IBNBM="",IBCPTNM=$$CPT^ICPTCOD(DGCPT) Q:'IBCPTNM
"RTN","IBCCPT",63,0)
 W !,DGCNT,")",?5,$P(IBCPTNM,U,2),?13,$E($P(IBCPTNM,U,3),1,24),?39,$E($P($G(^SC(+$P(DGNOD,U,9),0)),U,1),1,15),?56,$$FMTE^XLFDT(DGDAT,2)
"RTN","IBCCPT",64,0)
 I +DGBIL,+$P($G(DGNOD),U,6) S IBNBM="  *ON BILL/"_$E($P(DGNOD,U,7),1,4)_"*"
"RTN","IBCCPT",65,0)
 I IBNBM="",DGBIL S IBNBM="  *ON THIS BILL*"
"RTN","IBCCPT",66,0)
 I IBNBM="",+$P($G(DGNOD),U,6) S IBNBM="  "_$E($P(DGNOD,U,7),1,12)
"RTN","IBCCPT",67,0)
 W ?64,IBNBM
"RTN","IBCCPT",68,0)
 ;
"RTN","IBCCPT",69,0)
 S IBMODS=$P($G(DGNOD),U,10) F J=1:1 S IBZ=$P(IBMODS,",",J) Q:IBZ=""  S IBZ=$$MOD^ICPTMOD(IBZ,"I") W !,?13,$P(IBZ,U,2),?18,$P(IBZ,U,3)
"RTN","IBCCPT",70,0)
 Q
"RTN","IBCCPT",71,0)
CHDR W @IOF,!,?15,"<<CURRENT PROCEDURAL TERMINOLOGY CODES>>",!!,?10,"LISTING FROM VISIT DATES WITH ASSOCIATED CPT CODES",!,?22,"IN OUTPT ENCOUNTERS FILE",!
"RTN","IBCCPT",72,0)
 K ^TMP("IBVIS",$J)
"RTN","IBCCPT",73,0)
 S L="",$P(L,"=",80)="" W !,L,!,"NO.",?5,"CODE",?13,"SHORT NAME",?39,"CLINIC",?56,"DATE",!,L,! K L
"RTN","IBCCPT",74,0)
 Q
"RTN","IBCCPT",75,0)
ADDMOD(IBIFN,IBY,IBMOD) ; Add modifier(s) from PCE procedure to CPT code mult
"RTN","IBCCPT",76,0)
 N DIE,DR,DIC,DA,DO,DD,IBS,IBM
"RTN","IBCCPT",77,0)
 F IBS=1:1:$L(IBMOD,",") S DA(2)=IBIFN,DA(1)=IBY,X=$O(^DGCR(399,DA(2),"CP",DA(1),"MOD","B",""),-1)+1 S IBM=$P(IBMOD,",",IBS) I IBM'="" D
"RTN","IBCCPT",78,0)
 . S:'$D(^DGCR(399,DA(2),"CP",DA(1),"MOD")) DIC("P")=$$GETSPEC^IBEFUNC(399.0304,16)
"RTN","IBCCPT",79,0)
 . S DIC(0)="L",DIC="^DGCR(399,"_IBIFN_",""CP"","_IBY_",""MOD"",",DLAYGO=399.30416,DIC("DR")=".02////"_IBM
"RTN","IBCCPT",80,0)
 . D FILE^DICN K DIC,DO,DD
"RTN","IBCCPT",81,0)
 Q
"RTN","IBCCPT",82,0)
 ;
"RTN","IBCCPT",83,0)
DSPPRC(CPTNM,NOD) ; display summary of procedure being added
"RTN","IBCCPT",84,0)
 N IBI,IBL,IBMODS,IBMOD,IBPRVTYP,IBPRV I $G(CPTNM)=""!($G(NOD)="") Q
"RTN","IBCCPT",85,0)
 S IBMODS=$P(NOD,U,10),IBPRVTYP="",IBPRV=""
"RTN","IBCCPT",86,0)
 I +$P(NOD,U,8) S IBPRV=$P($G(^VA(200,+$P(NOD,U,8),0)),U,1),IBPRVTYP=$P($$PRVTYP^IBCRU6(+$P(NOD,U,8)),U,3) S IBL=$S(($L(IBPRVTYP)+$L(IBPRV))>32:"",1:" - ")
"RTN","IBCCPT",87,0)
 ;
"RTN","IBCCPT",88,0)
 W !!?4,"Adding CPT Procedure: ",$P(CPTNM,U,2),?34,$P(CPTNM,U,3)
"RTN","IBCCPT",89,0)
 I IBMODS'="" F IBI=1:1 S IBMOD=$P(IBMODS,",",IBI) Q:'IBMOD  S IBMOD=$$MOD^ICPTMOD(IBMOD,"I") W !,?34,$P(IBMOD,U,2)," - ",$E($P(IBMOD,U,3),1,40)
"RTN","IBCCPT",90,0)
 W !,?34,"Visit: ",$$FMTE^XLFDT(+$P(NOD,U,2),2),", ",$E($P($G(^SC(+$P(NOD,U,9),0)),U,1),1,29)
"RTN","IBCCPT",91,0)
 I IBPRV'="" W !,?34,"Provider: ",$E(IBPRV,1,35) I IBPRVTYP'="" W:IBL="" !,?44 W IBL,IBPRVTYP
"RTN","IBCCPT",92,0)
 W !
"RTN","IBCCPT",93,0)
 Q
"RTN","IBCCPT",94,0)
 ;
"RTN","IBCCPT",95,0)
VST(IBQUERY) ;Procedures for outpatient visits ... If IBQUERY is defined
"RTN","IBCCPT",96,0)
 ;  on entry, the QUERY OBJECT defined by this value will be used for
"RTN","IBCCPT",97,0)
 ;  loop to extract procedures for visits, otherwise, a new QUERY will be opened
"RTN","IBCCPT",98,0)
 ;  If passed by reference, IBQUERY will be ret'd as the new QUERY ref #
"RTN","IBCCPT",99,0)
 S DGCNT=0 I $O(^DGCR(399,IBIFN,"OP",0)) F V=0:0 S V=$O(^DGCR(399,IBIFN,"OP",V)) Q:'V  S (IBOPV1,IBOPV2)=V D PROC(.IBQUERY)
"RTN","IBCCPT",100,0)
 I $O(^DGCR(399,IBIFN,"OP",0)) K ^TMP("IBVIS",$J) G VSTQ
"RTN","IBCCPT",101,0)
 S IBOPV1=$P(^DGCR(399,IBIFN,"U"),"^"),IBOPV2=$P(^("U"),"^",2)
"RTN","IBCCPT",102,0)
 D PROC(.IBQUERY) K ^TMP("IBVIS",$J)
"RTN","IBCCPT",103,0)
VSTQ Q
"RTN","IBCCPT",104,0)
 ;
"RTN","IBCCPT",105,0)
WRNO W:'$O(^UTILITY($J,"CPT-CNT",0)) !,"NO CPT CODES ON FILE FOR THE ",$S($O(^DGCR(399,IBIFN,"OP",0)):"VISIT DATES ON THIS BILL",1:"PERIOD THAT THIS STATEMENT COVERS")
"RTN","IBCCPT",106,0)
 Q
"RTN","IBCCPT",107,0)
SCR Q:DGU="^"  I $E(IOST,1,2)["C-",$Y+6>IOSL F Y=$Y:1:IOSL-5 W !
"RTN","IBCCPT",108,0)
 I  R !,"Press return to continue or ""^"" to exit display ",DGU:DTIME D:DGU'="^" CHDR
"RTN","IBCCPT",109,0)
 Q
"RTN","IBCCPT",110,0)
HLP W !!,"Enter a number between 1 and ",DGCNT1," or a range of numbers separated with commas",!,"or dashes, e.g., 1,3,5 or 2-4,8"
"RTN","IBCCPT",111,0)
 W !,"The number(s) must appear as a selectable number in the sequential list." R H:5 K H Q
"RTN","IBCCPT",112,0)
CPT S DA(1)=IBIFN,IBCCPTZ=$P(^DGCR(399,DA(1),0),U,9),IBCCPTX=$S($D(^DGCR(399,DA(1),"C"))&IBCCPTZ:1,1:0)
"RTN","IBCCPT",113,0)
 K DIK,DGTE,I1 Q
"RTN","IBCCPT",114,0)
 ;
"RTN","IBCCPT",115,0)
PROC(IBQUERY) ;  -find outpatient procedures, flag if billable
"RTN","IBCCPT",116,0)
 ;  -  ^utility($j,cpt-cnt,count)=code^date^on bill^is BASC^divis^nb^nb mess^provider^clinic^mod,mod^Opt Enc Ptr
"RTN","IBCCPT",117,0)
 N IBVAL,IBCBK,IBFILTER
"RTN","IBCCPT",118,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=IBOPV1,IBVAL("EDT")=(IBOPV2+.99)
"RTN","IBCCPT",119,0)
 ; Must be a billable appt type and outpt enctr status of CHECKED OUT
"RTN","IBCCPT",120,0)
 S IBFILTER=""
"RTN","IBCCPT",121,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,7),$$DSP^IBEFUNC($P(Y0,U,10),+Y0),'$D(^TMP(""IBVIS"",$J,+$P(Y0,U,5))) S ^TMP(""IBVIS"",$J,+$P(Y0,U,5))="""" D EXTPROC^IBCCPT(IBIFN,Y,Y0,.DGCNT)"
"RTN","IBCCPT",122,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,IBFILTER,IBCBK,0,.IBQUERY) K ^TMP("DIERR",$J)
"RTN","IBCCPT",123,0)
 ;
"RTN","IBCCPT",124,0)
 Q
"RTN","IBCCPT",125,0)
EXTPROC(IBIFN,IBOE,IBOE0,IBCNT) ; Extract procedures for an encounter
"RTN","IBCCPT",126,0)
 ; IBIFN = the ien of the bill
"RTN","IBCCPT",127,0)
 ; IBOE0 = 0-node of the outpatient encounter file entry IBOE
"RTN","IBCCPT",128,0)
 ; IBCNT  extracted entry counter
"RTN","IBCCPT",129,0)
 N I2,I7,IBCPT,IBCPTS,IBDIV,IBOED,IBZERR,Z,IBCPTDAT,IBCPTPRV,IBCLINIC,IBZ,IBONBILL,IBMODS
"RTN","IBCCPT",130,0)
 D GETCPT^SDOE(IBOE,"IBCPTS","IBZERR")
"RTN","IBCCPT",131,0)
 Q:'$O(IBCPTS(0))  ;No procedures for this encounter
"RTN","IBCCPT",132,0)
 I '$$BDSRC^IBEFUNC3($P($G(IBOE0),U,5)) Q  ; non-billable visit data source
"RTN","IBCCPT",133,0)
 S IBOED=$$NBOE^IBCU81(IBOE,IBOE0)
"RTN","IBCCPT",134,0)
 S I7=IBOE0\1,IBDIV=$P(IBOE0,U,11)
"RTN","IBCCPT",135,0)
 S IBCLINIC="" I +$P(IBOE0,U,4),+$$CLNSCRN^IBCU(I7,+$P(IBOE0,U,4)) S IBCLINIC=+$P(IBOE0,U,4)
"RTN","IBCCPT",136,0)
 S I2=0 F  S I2=$O(IBCPTS(I2)) Q:'I2  D
"RTN","IBCCPT",137,0)
 . S IBCPT=$P(IBCPTS(I2),U)
"RTN","IBCCPT",138,0)
 . S IBCPTPRV=$P($G(IBCPTS(I2,12)),U,4)
"RTN","IBCCPT",139,0)
 . S IBONBILL=0 S IBZ=0 F  S IBZ=$O(^DGCR(399,IBIFN,"CP","B",IBCPT_";ICPT(",IBZ)) Q:'IBZ  I $P($G(^DGCR(399,IBIFN,"CP",IBZ,0)),U,2)=I7 S IBONBILL=1
"RTN","IBCCPT",140,0)
 . S IBMODS="",IBZ=0 F  S IBZ=$O(IBCPTS(I2,1,IBZ)) Q:'IBZ  S IBMODS=IBMODS_$S(IBMODS="":"",1:",")_+$G(IBCPTS(I2,1,IBZ,0))
"RTN","IBCCPT",141,0)
 . S IBCPTDAT=IBCPT_U_I7_U_IBONBILL_U_0_U_IBDIV_U_$P(IBOED,U,1)_U_$P(IBOED,U,2)_U_IBCPTPRV_U_IBCLINIC_U_IBMODS_U_IBOE
"RTN","IBCCPT",142,0)
 . F Z=1:1:$P(IBCPTS(I2),U,16) S IBCNT=IBCNT+1,^UTILITY($J,"CPT-CNT",IBCNT)=IBCPTDAT
"RTN","IBCCPT",143,0)
 I $O(IBCPTS(0)),'$D(^UTILITY($J,"CPT",+IBOE0,0)) S ^(0)="Y"
"RTN","IBCCPT",144,0)
 Q
"RTN","IBCCPT",145,0)
 ;
"RTN","IBCCPT",146,0)
TOMANY(DATE) ;  - returns 1 if more than 1 visit date on bill (for basc)
"RTN","IBCCPT",147,0)
 G TOMANYQ:'$D(DATE)
"RTN","IBCCPT",148,0)
 S DGVCNT=+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4)
"RTN","IBCCPT",149,0)
 I DGVCNT>1!(DGVCNT=1&('$D(^DGCR(399,IBIFN,"OP",DATE)))) K DGVCNT Q 1
"RTN","IBCCPT",150,0)
TOMANYQ Q 0
"RTN","IBCU1")
0^5^B23386720
"RTN","IBCU1",1,0)
IBCU1 ;ALB/MRL - BILLING UTILITY ROUTINE (CONTINUED) ;01 JUN 88 12:00
"RTN","IBCU1",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,106,138,51,182**;21-MAR-94
"RTN","IBCU1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU1",4,0)
 ;
"RTN","IBCU1",5,0)
 ;MAP TO DGCRU1
"RTN","IBCU1",6,0)
 ;
"RTN","IBCU1",7,0)
 ;procedure doesn't appear to be used (6/4/93), if it is used, what for??
"RTN","IBCU1",8,0)
 ;where would multiple provider numbers comde from?  ARH
"RTN","IBCU1",9,0)
 ;BCH    ;Blue Cross/Shield Help
"RTN","IBCU1",10,0)
 W ! S IB01=$P($G(^IBE(350.9,1,1)),"^",6)
"RTN","IBCU1",11,0)
 I IB01]"" W "CHOOSE FROM",!!?4,"1 - ",$P(IB01,"^",6) F IB00=2,3 I $P(IB01,"^",$S(IB00=2:14,1:15))]"" W !?4,IB00," - ",$P(IB01,"^",$S(IB00=2:14,1:15))
"RTN","IBCU1",12,0)
 W:IB01']"" "NO BLUE CROSS/SHIELD PROVIDER NUMBERS IDENTIFIED TO SELECT FROM!" W ! W:IB01]"" !,"OR " W "ENTER BLUE CROSS/SHIELD PROVIDER # (BETWEEN 3-13 CHARACTERS)",! K IB00,IB01 Q
"RTN","IBCU1",13,0)
 ;
"RTN","IBCU1",14,0)
RCD ;Revenue Code Display
"RTN","IBCU1",15,0)
 Q:'$D(^DGCR(399,IBIFN,"RC"))
"RTN","IBCU1",16,0)
 W @IOF,!,"Revenue Code Listing",?34,"Units",?45,"Charge" W:$$FT^IBCEF(IBIFN)=3 ?56,"Non-Cov"
"RTN","IBCU1",17,0)
 S DGIFN=0 F IBI=0:0 S DGIFN=$O(^DGCR(399,IBIFN,"RC",DGIFN)) Q:'DGIFN  I $D(^DGCR(399,IBIFN,"RC",DGIFN,0)) S Z=^(0) D DISRC
"RTN","IBCU1",18,0)
 W !
"RTN","IBCU1",19,0)
 I $D(DIC(0)) S DIC(0)=DIC(0)_"N"
"RTN","IBCU1",20,0)
 Q
"RTN","IBCU1",21,0)
DISRC N Z0 W !?1,DGIFN,?4,$P(^DGCR(399.2,+Z,0),"^"),"-",$E($P(^DGCR(399.2,+Z,0),"^",2),1,19)
"RTN","IBCU1",22,0)
 I +$P(Z,U,6) W ?28,$P($$CPT^ICPTCOD(+$P(Z,U,6)),U,2)
"RTN","IBCU1",23,0)
 W ?36,$P(Z,"^",3),?40 S X=$P(Z,"^",2),X2="2$" D COMMA^%DTC W X
"RTN","IBCU1",24,0)
 I $$FT^IBCEF(IBIFN)=3,$P(Z,U,9)'="" S X=$P(Z,U,9),X2="2$" D COMMA^%DTC W ?51,X
"RTN","IBCU1",25,0)
 I $D(^DGCR(399.1,+$P(Z,"^",5),0)) W ?64,$E($P(^(0),"^"),1,15)
"RTN","IBCU1",26,0)
 I $S($P(Z,U,15):1,1:$P(Z,U,10)=3) D
"RTN","IBCU1",27,0)
 . W !,?5,"(Rx: ",$S($P(Z,U,11):$P($G(^IBA(362.4,$P(Z,U,11),0)),U),1:"Link Missing"),"  Procedure "_$S($P(Z,U,15):"#"_$P(Z,U,15)_" "_$$CPTNM^IBCRBH1(IBIFN,4,$P(Z,U,15)),1:"Link Missing"),")"
"RTN","IBCU1",28,0)
 Q
"RTN","IBCU1",29,0)
 ;
"RTN","IBCU1",30,0)
RVCPRC(IBIFN,IBD0) ; returns 1 if CHAMPVA rate type + 2 if HCFA 1500, 0 otherwise
"RTN","IBCU1",31,0)
 ; IBD0 - zero node of bill if available, not required
"RTN","IBCU1",32,0)
 N X S X=0
"RTN","IBCU1",33,0)
 I $G(IBD0)="" S IBD0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU1",34,0)
 I $P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,1)="CHAMPVA" S X=X+1
"RTN","IBCU1",35,0)
 I $P(IBD0,U,19)=2 S X=X+2
"RTN","IBCU1",36,0)
 Q X
"RTN","IBCU1",37,0)
 ;
"RTN","IBCU1",38,0)
ORDNXT(IFN) ;CALLED BY TRIGGER ON (362.3,.02) THAT SETS DX PRINT ORDER (362.3,.03),
"RTN","IBCU1",39,0)
 ;returns the highest print order used on the bill plus 3, returns 3 if no existing print order
"RTN","IBCU1",40,0)
 ;used for the default print order so that dx's can be printed in order of entry without any input by the user,
"RTN","IBCU1",41,0)
 ;3 is added to allow spaces for additions, changes, moves
"RTN","IBCU1",42,0)
 N X,Y S X="" I $D(^DGCR(399,+$G(IFN),0)) S X=3,Y=0 F  S Y=$O(^IBA(362.3,"AO",+IFN,Y)) Q:'Y  S X=Y+3
"RTN","IBCU1",43,0)
 Q X
"RTN","IBCU1",44,0)
 ;
"RTN","IBCU1",45,0)
ORDDUP(ORD,DIFN) ;returns true if print order ORD is already defined for a bill (not same entry)
"RTN","IBCU1",46,0)
 N IBX,IBY S IBY=0
"RTN","IBCU1",47,0)
 I +$G(ORD) S IBX=$G(^IBA(362.3,+$G(DIFN),0)) I +IBX,+$P(IBX,U,3)'=ORD,$D(^IBA(362.3,"AO",+$P(IBX,U,2),+ORD)) S IBY=1
"RTN","IBCU1",48,0)
 Q IBY
"RTN","IBCU1",49,0)
 ;
"RTN","IBCU1",50,0)
DXDUP(DX,DIFN,IFN) ;returns true if DX is already defined for a bill (not same entry)
"RTN","IBCU1",51,0)
 ;either DIFN or IFN can be passed, both are not needed, DIFN is needed during edit so can reenter the same dx
"RTN","IBCU1",52,0)
 N IBX,IBY S IBY=0 I +$G(DX),'$G(IFN) S IBX=$G(^IBA(362.3,+$G(DIFN),0)),IFN=+$P(IBX,U,2)
"RTN","IBCU1",53,0)
 I +$G(DX),$D(^IBA(362.3,"AIFN"_+IFN,+DX)),$O(^IBA(362.3,"AIFN"_+IFN,+DX,0))'=+$G(DIFN) S IBY=1
"RTN","IBCU1",54,0)
 Q IBY
"RTN","IBCU1",55,0)
 ;
"RTN","IBCU1",56,0)
DXBSTAT(DIFN,IFN) ;returns a diagnosis' bill status (either DIFN or IFN can be passed, both are not needed)
"RTN","IBCU1",57,0)
 N IBX,IBY I '$G(IFN) S IBX=$G(^IBA(362.3,+$G(DIFN),0)),IFN=+$P(IBX,U,2)
"RTN","IBCU1",58,0)
 S IBY=+$P($G(^DGCR(399,+IFN,0)),U,13)
"RTN","IBCU1",59,0)
 Q IBY
"RTN","IBCU1",60,0)
 ;
"RTN","IBCU1",61,0)
RXSTAT(DRUG,PIFN,FILLDT) ; returns status/definition of rx
"RTN","IBCU1",62,0)
 ; returns: ORIGINAL ^ RELEASED/RETURNED TO STOCK ^ DRUG DEA
"RTN","IBCU1",63,0)
 N IBX,IBY,IBZ,IBLN S IBLN="",DRUG=+$G(DRUG),PIFN=+$G(PIFN),FILLDT=+$G(FILLDT)
"RTN","IBCU1",64,0)
 ;
"RTN","IBCU1",65,0)
 S IBX=$G(^PSRX(PIFN,2)),IBZ="" I IBX'="",$P(IBX,U,2)=$G(FILLDT) D  I IBZ'="" S $P(IBLN,U,2)=IBZ
"RTN","IBCU1",66,0)
 . S IBLN="ORG"
"RTN","IBCU1",67,0)
 . ;I +$G(^PS(59.7,1,49.99))<6 Q
"RTN","IBCU1",68,0)
 . I '$P(IBX,U,13) S IBZ="NR"
"RTN","IBCU1",69,0)
 . I +$P(IBX,U,15) S:IBZ'="" IBZ=IBZ_"-" S IBZ=IBZ_"RTS"
"RTN","IBCU1",70,0)
 ;
"RTN","IBCU1",71,0)
 I IBLN="" S IBX=$O(^PSRX(PIFN,1,"B",FILLDT,0)),IBX=$G(^PSRX(PIFN,1,+IBX,0)),IBZ="" I IBX'="" D  I IBZ'="" S $P(IBLN,U,2)=IBZ
"RTN","IBCU1",72,0)
 . ;I +$G(^PS(59.7,1,49.99))<6 Q
"RTN","IBCU1",73,0)
 . I '$P(IBX,U,18) S IBZ="NR"
"RTN","IBCU1",74,0)
 . I +$P(IBX,U,16) S:IBZ'="" IBZ=IBZ_"-" S IBZ=IBZ_"RTS"
"RTN","IBCU1",75,0)
 ;
"RTN","IBCU1",76,0)
 S IBX=$G(^PSDRUG(DRUG,0)) I IBX'="" S IBY=$P(IBX,U,3),IBZ="" D  I IBZ'="" S $P(IBLN,U,3)=IBZ
"RTN","IBCU1",77,0)
 . I IBY["9" S IBZ="OTC"
"RTN","IBCU1",78,0)
 . I IBY["I" S:IBZ'="" IBZ=IBZ_"-" S IBZ=IBZ_"INV"
"RTN","IBCU1",79,0)
 . I IBY["S" S:IBZ'="" IBZ=IBZ_"-" S IBZ=IBZ_"SUP"
"RTN","IBCU1",80,0)
 Q IBLN
"RTN","IBCU1",81,0)
 ;
"RTN","IBCU1",82,0)
PRVLIC(NPIFN,IBDT,ARR,STIFN) ; returns the Provider License data from the New Person file active on a date
"RTN","IBCU1",83,0)
 ; Input:   NPIFN = pointer to file 200,              IBDT = date to check (if none passed then all returned)
"RTN","IBCU1",84,0)
 ;          ARR = array pass by reference (optional), STIFN = state to return as value of function (optional)
"RTN","IBCU1",85,0)
 ; Output:  ARR(X) = license state (ifn) ^ license ^ expiration date (200,541)
"RTN","IBCU1",86,0)
 ;          return value = license data of state requested or if no state passed in then count found
"RTN","IBCU1",87,0)
 N IBX,IBY,IBLN,IBCNT S IBX=0,IBCNT=0 K ARR
"RTN","IBCU1",88,0)
 I +$G(NPIFN) S IBY=0 F  S IBY=$O(^VA(200,NPIFN,"PS1",IBY)) Q:'IBY  D
"RTN","IBCU1",89,0)
 . S IBLN=$G(^VA(200,NPIFN,"PS1",IBY,0))
"RTN","IBCU1",90,0)
 . I +$G(IBDT),+$P(IBLN,U,3),$P(IBLN,U,3)<IBDT Q
"RTN","IBCU1",91,0)
 . I +$G(STIFN),+STIFN=+IBLN S IBX=IBLN
"RTN","IBCU1",92,0)
 . S IBCNT=IBCNT+1,ARR(IBCNT)=IBLN
"RTN","IBCU1",93,0)
 S ARR=IBCNT I '$G(STIFN) S IBX=IBCNT
"RTN","IBCU1",94,0)
 Q IBX
"RTN","IBCU1",95,0)
 ;
"RTN","IBCU1",96,0)
DELPR(IB,IBX) ; Deletes the corresponding RX proc when the RX pointer is
"RTN","IBCU1",97,0)
 ; deleted
"RTN","IBCU1",98,0)
 ; IB = the ien of the bill in file 399
"RTN","IBCU1",99,0)
 ; IBX = the ien of the entry in the procedure multiple to be deleted
"RTN","IBCU1",100,0)
 ;
"RTN","IBCU1",101,0)
 N DA,DIK,X,Y
"RTN","IBCU1",102,0)
 S DA(1)=IB,DA=IBX
"RTN","IBCU1",103,0)
 I $D(^DGCR(399,DA(1),"CP",DA,0)) S DIK="^DGCR(399,"_DA(1)_",""CP""," D ^DIK
"RTN","IBCU1",104,0)
 Q
"RTN","IBCU1",105,0)
 ;
"RTN","IBCU1",106,0)
MODHLP(DA) ; Executable modifier help 399.042  .14
"RTN","IBCU1",107,0)
 ; DA = iens of the current entry DA(1) = file 399 ien
"RTN","IBCU1",108,0)
 ;                                DA    = file 399.042 ien
"RTN","IBCU1",109,0)
 N Z,IBZ
"RTN","IBCU1",110,0)
 I $P($G(^DGCR(399,+$G(DA(1)),"RC",+$G(DA),0)),U,14)'="" S Z=$P(^(0),U,14) D
"RTN","IBCU1",111,0)
 . N Q
"RTN","IBCU1",112,0)
 . S Q=1
"RTN","IBCU1",113,0)
 . S IBZ(1)="Current modifier"_$S($P(Z,";",2)'="":"s are:",1:"is:")
"RTN","IBCU1",114,0)
 . I $P(Z,";")'="" S Q=Q+1,IBZ(Q)="  "_$P(Z,";")_"  "_$P($$MOD^ICPTMOD($P(Z,";")),U,3)
"RTN","IBCU1",115,0)
 . I $P(Z,";",2)'="" S Q=Q+1,IBZ(Q)="  "_$P(Z,";",2)_"  "_$P($$MOD^ICPTMOD($P(Z,";",2)),U,3)
"RTN","IBCU1",116,0)
 . S Q=Q+1,IBZ(Q)=" "
"RTN","IBCU1",117,0)
 . D EN^DDIOL(.IBZ)
"RTN","IBCU1",118,0)
 ;
"RTN","IBCU1",119,0)
 N DIC S DIC="^DIC(81.3,",DIC(0)="E",DIC("S")="I $$MODP^ICPTMOD($P($G(^DGCR(399,DA(1),""RC"",DA,0)),U,6),Y,""I"")>0" D ^DIC
"RTN","IBCU1",120,0)
 Q
"RTN","IBCU1",121,0)
 ;
"RTN","IBCU1",122,0)
QMED(IBRTN,IBIFN) ; DSS QuadraMed Interface: DSS/QuadraMed Available
"RTN","IBCU1",123,0)
 ; return 1 if QuadraMed Interface is On and available for the type of bill
"RTN","IBCU1",124,0)
 ; - routine must exist on the system (interface is 'On')
"RTN","IBCU1",125,0)
 ; Input: IBRTN = tag^routine, if it exists then Interface is 'On'
"RTN","IBCU1",126,0)
 ;        IBIFN = Bill IFN, bill to check if appropriate for sending to QuadraMed
"RTN","IBCU1",127,0)
 ; 
"RTN","IBCU1",128,0)
 N IBON S IBON=0
"RTN","IBCU1",129,0)
 I +$G(IBIFN),$G(IBRTN)'="",$T(@IBRTN)'="" S IBON=1
"RTN","IBCU1",130,0)
 Q IBON
"VER")
8.0^22.0
**END**
**END**
