Released GMRC*3*15 SEQ #18
Extracted from mail message
**KIDS**:GMRC*3.0*15^

**INSTALL NAME**
GMRC*3.0*15
"BLD",2376,0)
GMRC*3.0*15^CONSULT/REQUEST TRACKING^0^3010316^y
"BLD",2376,1,0)
^^1^1^3010201^
"BLD",2376,1,1,0)
See the National Patch Module for a complete list of enhancements.
"BLD",2376,4,0)
^9.64PA^8989.51^4
"BLD",2376,4,123,0)
123
"BLD",2376,4,123,2,0)
^9.641^123.03^2
"BLD",2376,4,123,2,123,0)
REQUEST/CONSULTATION  (File-top level)
"BLD",2376,4,123,2,123,1,0)
^9.6411^13^2
"BLD",2376,4,123,2,123,1,4,0)
PROCEDURE/REQUEST TYPE
"BLD",2376,4,123,2,123,1,13,0)
REQUEST TYPE
"BLD",2376,4,123,2,123.03,0)
ASSOCIATED RESULTS  (sub-file)
"BLD",2376,4,123,2,123.03,1,0)
^9.6411^^
"BLD",2376,4,123,222)
y^y^p^^^^n
"BLD",2376,4,123.3,0)
123.3
"BLD",2376,4,123.3,222)
y^y^f^^y^^y^o^n
"BLD",2376,4,123.3,224)
I Y=1
"BLD",2376,4,123.5,0)
123.5
"BLD",2376,4,123.5,2,0)
^9.641^123.5101^2
"BLD",2376,4,123.5,2,123.5,0)
REQUEST SERVICES  (File-top level)
"BLD",2376,4,123.5,2,123.5,1,0)
^9.6411^1.06^1
"BLD",2376,4,123.5,2,123.5,1,1.06,0)
RESULT MGMT USER CLASS
"BLD",2376,4,123.5,2,123.5101,0)
PROCEDURE TYPE  (sub-file)
"BLD",2376,4,123.5,2,123.5101,1,0)
^9.6411^.01^1
"BLD",2376,4,123.5,2,123.5101,1,.01,0)
PROCEDURE TYPE
"BLD",2376,4,123.5,222)
y^y^p^^^^n
"BLD",2376,4,8989.51,0)
8989.51
"BLD",2376,4,8989.51,222)
n^n^f^^y^^y^o^n
"BLD",2376,4,8989.51,224)
I $P(^(0),"^")="GMRC PROCEDURE CONVERSION"
"BLD",2376,4,"APDD",123,123)

"BLD",2376,4,"APDD",123,123,4)

"BLD",2376,4,"APDD",123,123,13)

"BLD",2376,4,"APDD",123,123.03)

"BLD",2376,4,"APDD",123.5,123.5)

"BLD",2376,4,"APDD",123.5,123.5,1.06)

"BLD",2376,4,"APDD",123.5,123.5101)

"BLD",2376,4,"APDD",123.5,123.5101,.01)

"BLD",2376,4,"B",123,123)

"BLD",2376,4,"B",123.3,123.3)

"BLD",2376,4,"B",123.5,123.5)

"BLD",2376,4,"B",8989.51,8989.51)

"BLD",2376,"ABPKG")
n
"BLD",2376,"INID")
y^n
"BLD",2376,"INIT")
EN^GMRCYP15
"BLD",2376,"KRN",0)
^9.67PA^19^18
"BLD",2376,"KRN",.4,0)
.4
"BLD",2376,"KRN",.401,0)
.401
"BLD",2376,"KRN",.402,0)
.402
"BLD",2376,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",2376,"KRN",.402,"NM",1,0)
GMRC PROCEDURE SETUP    FILE #123.3^123.3^0
"BLD",2376,"KRN",.402,"NM",2,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",2376,"KRN",.402,"NM","B","GMRC PROCEDURE SETUP    FILE #123.3",1)

"BLD",2376,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",2)

"BLD",2376,"KRN",.403,0)
.403
"BLD",2376,"KRN",.5,0)
.5
"BLD",2376,"KRN",.84,0)
.84
"BLD",2376,"KRN",3.6,0)
3.6
"BLD",2376,"KRN",3.8,0)
3.8
"BLD",2376,"KRN",9.2,0)
9.2
"BLD",2376,"KRN",9.8,0)
9.8
"BLD",2376,"KRN",9.8,"NM",0)
^9.68A^38^37
"BLD",2376,"KRN",9.8,"NM",1,0)
GMRC101H^^0^B4989844
"BLD",2376,"KRN",9.8,"NM",2,0)
GMRC1233^^0^B2226146
"BLD",2376,"KRN",9.8,"NM",3,0)
GMRCAFRD^^0^B31943912
"BLD",2376,"KRN",9.8,"NM",4,0)
GMRCAR^^0^B26252788
"BLD",2376,"KRN",9.8,"NM",5,0)
GMRCAU^^0^B51325271
"BLD",2376,"KRN",9.8,"NM",7,0)
GMRCDIS^^0^B31159012
"BLD",2376,"KRN",9.8,"NM",8,0)
GMRCEDT1^^0^B35410674
"BLD",2376,"KRN",9.8,"NM",9,0)
GMRCEDT2^^0^B14307374
"BLD",2376,"KRN",9.8,"NM",10,0)
GMRCEDT3^^0^B13328286
"BLD",2376,"KRN",9.8,"NM",11,0)
GMRCEDT4^^0^B79732350
"BLD",2376,"KRN",9.8,"NM",12,0)
GMRCGUIC^^0^B49411950
"BLD",2376,"KRN",9.8,"NM",13,0)
GMRCHL72^^0^B13779096
"BLD",2376,"KRN",9.8,"NM",14,0)
GMRCHL7A^^0^B28780212
"BLD",2376,"KRN",9.8,"NM",15,0)
GMRCMED^^0^B35624704
"BLD",2376,"KRN",9.8,"NM",16,0)
GMRCMER^^0^B3351189
"BLD",2376,"KRN",9.8,"NM",17,0)
GMRCP5D^^0^B40989181
"BLD",2376,"KRN",9.8,"NM",18,0)
GMRCPR0^^0^B17021041
"BLD",2376,"KRN",9.8,"NM",19,0)
GMRCSLDT^^0^B10503696
"BLD",2376,"KRN",9.8,"NM",20,0)
GMRCSLM1^^0^B46308886
"BLD",2376,"KRN",9.8,"NM",21,0)
GMRCSLM2^^0^B41842756
"BLD",2376,"KRN",9.8,"NM",22,0)
GMRCSLM3^^0^B19201390
"BLD",2376,"KRN",9.8,"NM",23,0)
GMRCSLM4^^0^B23194760
"BLD",2376,"KRN",9.8,"NM",24,0)
GMRCTIU^^0^B13862450
"BLD",2376,"KRN",9.8,"NM",25,0)
GMRCTIU3^^0^B7873536
"BLD",2376,"KRN",9.8,"NM",26,0)
GMRCTIUE^^0^B43714179
"BLD",2376,"KRN",9.8,"NM",27,0)
GMRCTIUL^^0^B15774660
"BLD",2376,"KRN",9.8,"NM",28,0)
GMRCP5A^^0^B56916285
"BLD",2376,"KRN",9.8,"NM",29,0)
GMRCGUIU^^0^B26290875
"BLD",2376,"KRN",9.8,"NM",30,0)
GMRCACTM^^0^B4282247
"BLD",2376,"KRN",9.8,"NM",31,0)
GMRCYP15^^0^B37132960
"BLD",2376,"KRN",9.8,"NM",32,0)
GMRCGUIA^^0^B41403314
"BLD",2376,"KRN",9.8,"NM",33,0)
GMRCTIUP^^0^B59164447
"BLD",2376,"KRN",9.8,"NM",34,0)
GMRCART^^0^B38165721
"BLD",2376,"KRN",9.8,"NM",35,0)
GMRCUTL1^^0^B10653002
"BLD",2376,"KRN",9.8,"NM",36,0)
GMRCDRFR^^0^B9430906
"BLD",2376,"KRN",9.8,"NM",37,0)
GMRCP5B^^0^B29816764
"BLD",2376,"KRN",9.8,"NM",38,0)
GMRCASV1^^0^B2709883
"BLD",2376,"KRN",9.8,"NM","B","GMRC101H",1)

"BLD",2376,"KRN",9.8,"NM","B","GMRC1233",2)

"BLD",2376,"KRN",9.8,"NM","B","GMRCACTM",30)

"BLD",2376,"KRN",9.8,"NM","B","GMRCAFRD",3)

"BLD",2376,"KRN",9.8,"NM","B","GMRCAR",4)

"BLD",2376,"KRN",9.8,"NM","B","GMRCART",34)

"BLD",2376,"KRN",9.8,"NM","B","GMRCASV1",38)

"BLD",2376,"KRN",9.8,"NM","B","GMRCAU",5)

"BLD",2376,"KRN",9.8,"NM","B","GMRCDIS",7)

"BLD",2376,"KRN",9.8,"NM","B","GMRCDRFR",36)

"BLD",2376,"KRN",9.8,"NM","B","GMRCEDT1",8)

"BLD",2376,"KRN",9.8,"NM","B","GMRCEDT2",9)

"BLD",2376,"KRN",9.8,"NM","B","GMRCEDT3",10)

"BLD",2376,"KRN",9.8,"NM","B","GMRCEDT4",11)

"BLD",2376,"KRN",9.8,"NM","B","GMRCGUIA",32)

"BLD",2376,"KRN",9.8,"NM","B","GMRCGUIC",12)

"BLD",2376,"KRN",9.8,"NM","B","GMRCGUIU",29)

"BLD",2376,"KRN",9.8,"NM","B","GMRCHL72",13)

"BLD",2376,"KRN",9.8,"NM","B","GMRCHL7A",14)

"BLD",2376,"KRN",9.8,"NM","B","GMRCMED",15)

"BLD",2376,"KRN",9.8,"NM","B","GMRCMER",16)

"BLD",2376,"KRN",9.8,"NM","B","GMRCP5A",28)

"BLD",2376,"KRN",9.8,"NM","B","GMRCP5B",37)

"BLD",2376,"KRN",9.8,"NM","B","GMRCP5D",17)

"BLD",2376,"KRN",9.8,"NM","B","GMRCPR0",18)

"BLD",2376,"KRN",9.8,"NM","B","GMRCSLDT",19)

"BLD",2376,"KRN",9.8,"NM","B","GMRCSLM1",20)

"BLD",2376,"KRN",9.8,"NM","B","GMRCSLM2",21)

"BLD",2376,"KRN",9.8,"NM","B","GMRCSLM3",22)

"BLD",2376,"KRN",9.8,"NM","B","GMRCSLM4",23)

"BLD",2376,"KRN",9.8,"NM","B","GMRCTIU",24)

"BLD",2376,"KRN",9.8,"NM","B","GMRCTIU3",25)

"BLD",2376,"KRN",9.8,"NM","B","GMRCTIUE",26)

"BLD",2376,"KRN",9.8,"NM","B","GMRCTIUL",27)

"BLD",2376,"KRN",9.8,"NM","B","GMRCTIUP",33)

"BLD",2376,"KRN",9.8,"NM","B","GMRCUTL1",35)

"BLD",2376,"KRN",9.8,"NM","B","GMRCYP15",31)

"BLD",2376,"KRN",19,0)
19
"BLD",2376,"KRN",19,"NM",0)
^9.68A^9^9
"BLD",2376,"KRN",19,"NM",1,0)
GMRC PROCEDURE SETUP^^0
"BLD",2376,"KRN",19,"NM",2,0)
GMRC MGR^^2
"BLD",2376,"KRN",19,"NM",3,0)
GMRC SETUP PROTOCOLS^^1^
"BLD",2376,"KRN",19,"NM",4,0)
GMRC PROTOCOL DETAILED REPORT^^1^
"BLD",2376,"KRN",19,"NM",5,0)
GMRC PROTOCOL LIST^^1^
"BLD",2376,"KRN",19,"NM",6,0)
GMRC MEDICINE PKG INTERFACE^^1^
"BLD",2376,"KRN",19,"NM",7,0)
GMRC MEDICINE USER^^1^
"BLD",2376,"KRN",19,"NM",8,0)
GMRC TEST DEFAULT REASON^^0
"BLD",2376,"KRN",19,"NM",9,0)
GMRC REPORTS^^3
"BLD",2376,"KRN",19,"NM","B","GMRC MEDICINE PKG INTERFACE",6)

"BLD",2376,"KRN",19,"NM","B","GMRC MEDICINE USER",7)

"BLD",2376,"KRN",19,"NM","B","GMRC MGR",2)

"BLD",2376,"KRN",19,"NM","B","GMRC PROCEDURE SETUP",1)

"BLD",2376,"KRN",19,"NM","B","GMRC PROTOCOL DETAILED REPORT",4)

"BLD",2376,"KRN",19,"NM","B","GMRC PROTOCOL LIST",5)

"BLD",2376,"KRN",19,"NM","B","GMRC REPORTS",9)

"BLD",2376,"KRN",19,"NM","B","GMRC SETUP PROTOCOLS",3)

"BLD",2376,"KRN",19,"NM","B","GMRC TEST DEFAULT REASON",8)

"BLD",2376,"KRN",19.1,0)
19.1
"BLD",2376,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2376,"KRN",101,0)
101
"BLD",2376,"KRN",101,"NM",0)
^9.68A^10^10
"BLD",2376,"KRN",101,"NM",1,0)
GMRCACT SELECT MED RESULT^^0
"BLD",2376,"KRN",101,"NM",2,0)
GMRCACTM MED RESULTING^^0
"BLD",2376,"KRN",101,"NM",3,0)
GMRCACT ASSOCIATE RESULTS^^0
"BLD",2376,"KRN",101,"NM",4,0)
GMRCACT DISPLAY MED RESULT^^0
"BLD",2376,"KRN",101,"NM",5,0)
GMRCACT REMOVE MED RESULT^^0
"BLD",2376,"KRN",101,"NM",6,0)
GMRCACT DISASSOC MED RSLT^^0
"BLD",2376,"KRN",101,"NM",7,0)
GMRCACTM DISASSOC MED RSLT^^0
"BLD",2376,"KRN",101,"NM",8,0)
GMRCACTM DEFAULT REASON^^2
"BLD",2376,"KRN",101,"NM",9,0)
GMRCU SELECT DEF REAS PROC^^0
"BLD",2376,"KRN",101,"NM",10,0)
GMRCACTM SERVICE ACTION MENU^^2
"BLD",2376,"KRN",101,"NM","B","GMRCACT ASSOCIATE RESULTS",3)

"BLD",2376,"KRN",101,"NM","B","GMRCACT DISASSOC MED RSLT",6)

"BLD",2376,"KRN",101,"NM","B","GMRCACT DISPLAY MED RESULT",4)

"BLD",2376,"KRN",101,"NM","B","GMRCACT REMOVE MED RESULT",5)

"BLD",2376,"KRN",101,"NM","B","GMRCACT SELECT MED RESULT",1)

"BLD",2376,"KRN",101,"NM","B","GMRCACTM DEFAULT REASON",8)

"BLD",2376,"KRN",101,"NM","B","GMRCACTM DISASSOC MED RSLT",7)

"BLD",2376,"KRN",101,"NM","B","GMRCACTM MED RESULTING",2)

"BLD",2376,"KRN",101,"NM","B","GMRCACTM SERVICE ACTION MENU",10)

"BLD",2376,"KRN",101,"NM","B","GMRCU SELECT DEF REAS PROC",9)

"BLD",2376,"KRN",409.61,0)
409.61
"BLD",2376,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",2376,"KRN",409.61,"NM",1,0)
GMRC ASSOCIATE RESULTS^^0
"BLD",2376,"KRN",409.61,"NM",2,0)
GMRC DISASSOC RESULTS^^0
"BLD",2376,"KRN",409.61,"NM","B","GMRC ASSOCIATE RESULTS",1)

"BLD",2376,"KRN",409.61,"NM","B","GMRC DISASSOC RESULTS",2)

"BLD",2376,"KRN",771,0)
771
"BLD",2376,"KRN",869.2,0)
869.2
"BLD",2376,"KRN",870,0)
870
"BLD",2376,"KRN",8994,0)
8994
"BLD",2376,"KRN","B",.4,.4)

"BLD",2376,"KRN","B",.401,.401)

"BLD",2376,"KRN","B",.402,.402)

"BLD",2376,"KRN","B",.403,.403)

"BLD",2376,"KRN","B",.5,.5)

"BLD",2376,"KRN","B",.84,.84)

"BLD",2376,"KRN","B",3.6,3.6)

"BLD",2376,"KRN","B",3.8,3.8)

"BLD",2376,"KRN","B",9.2,9.2)

"BLD",2376,"KRN","B",9.8,9.8)

"BLD",2376,"KRN","B",19,19)

"BLD",2376,"KRN","B",19.1,19.1)

"BLD",2376,"KRN","B",101,101)

"BLD",2376,"KRN","B",409.61,409.61)

"BLD",2376,"KRN","B",771,771)

"BLD",2376,"KRN","B",869.2,869.2)

"BLD",2376,"KRN","B",870,870)

"BLD",2376,"KRN","B",8994,8994)

"BLD",2376,"PRE")
GMRC15EN
"BLD",2376,"QUES",0)
^9.62^^
"BLD",2376,"REQB",0)
^9.611^12^11
"BLD",2376,"REQB",1,0)
GMRC*3.0*1^2
"BLD",2376,"REQB",2,0)
GMRC*3.0*4^2
"BLD",2376,"REQB",3,0)
GMRC*3.0*10^2
"BLD",2376,"REQB",4,0)
GMRC*3.0*11^2
"BLD",2376,"REQB",5,0)
GMRC*3.0*13^2
"BLD",2376,"REQB",6,0)
GMRC*3.0*14^2
"BLD",2376,"REQB",7,0)
GMRC*3.0*12^2
"BLD",2376,"REQB",9,0)
GMRC*3.0*16^2
"BLD",2376,"REQB",10,0)
GMRC*3.0*18^2
"BLD",2376,"REQB",11,0)
GMRC*3.0*20^2
"BLD",2376,"REQB",12,0)
OR*3.0*98^2
"BLD",2376,"REQB","B","GMRC*3.0*1",1)

"BLD",2376,"REQB","B","GMRC*3.0*10",3)

"BLD",2376,"REQB","B","GMRC*3.0*11",4)

"BLD",2376,"REQB","B","GMRC*3.0*12",7)

"BLD",2376,"REQB","B","GMRC*3.0*13",5)

"BLD",2376,"REQB","B","GMRC*3.0*14",6)

"BLD",2376,"REQB","B","GMRC*3.0*16",9)

"BLD",2376,"REQB","B","GMRC*3.0*18",10)

"BLD",2376,"REQB","B","GMRC*3.0*20",11)

"BLD",2376,"REQB","B","GMRC*3.0*4",2)

"BLD",2376,"REQB","B","OR*3.0*98",12)

"DATA",123.3,1,0)
UNKNOWN PROCEDURE^1^^
"DATA",8989.51,118,0)
GMRC PROCEDURE CONVERSION^Procedure Conversion status^0
"DATA",8989.51,118,1)
N^0:3
"DATA",8989.51,118,20,0)
^8989.512^3^3^3000606^^
"DATA",8989.51,118,20,1,0)
This parameter is used to record the progress and status of the conversion
"DATA",8989.51,118,20,2,0)
of Consult Procedure data from the PROTOCOL file to the GMRC PROCEDURES
"DATA",8989.51,118,20,3,0)
file.
"DATA",8989.51,118,30,0)
^8989.513I^1^1
"DATA",8989.51,118,30,1,0)
1^9.4
"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^y^p^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,4)

"FIA",123,123,13)

"FIA",123,123,50)

"FIA",123,123.03)
0
"FIA",123.3)
GMRC PROCEDURE
"FIA",123.3,0)
^GMR(123.3,
"FIA",123.3,0,0)
123.3O
"FIA",123.3,0,1)
y^y^f^^y^^y^o^n
"FIA",123.3,0,10)

"FIA",123.3,0,11)
I Y=1
"FIA",123.3,0,"RLRO")

"FIA",123.3,0,"VR")
3.0^GMRC
"FIA",123.3,123.3)
0
"FIA",123.3,123.31)
0
"FIA",123.3,123.3124)
0
"FIA",123.3,123.3125)
0
"FIA",123.3,123.32)
0
"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5I
"FIA",123.5,0,1)
y^y^p^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,1.06)

"FIA",123.5,123.5,101)

"FIA",123.5,123.5101)
1
"FIA",123.5,123.5101,.01)

"FIA",8989.51)
PARAMETER DEFINITION
"FIA",8989.51,0)
^XTV(8989.51,
"FIA",8989.51,0,0)
8989.51I
"FIA",8989.51,0,1)
n^n^f^^y^^y^o^n
"FIA",8989.51,0,10)

"FIA",8989.51,0,11)
I $P(^(0),"^")="GMRC PROCEDURE CONVERSION"
"FIA",8989.51,0,"RLRO")

"FIA",8989.51,0,"VR")
3.0^GMRC
"FIA",8989.51,8989.51)
0
"FIA",8989.51,8989.512)
0
"FIA",8989.51,8989.513)
0
"INIT")
EN^GMRCYP15
"KRN",.402,763,-1)
0^2
"KRN",.402,763,0)
GMRC SETUP REQUEST SERVICE^3001213.1253^^123.5^^^3001213
"KRN",.402,763,"DIAB",1,0,123.5,1)
1.11;"ABBREVIATED PRINT NAME (Optional)"
"KRN",.402,763,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.54,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.57,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.58,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.59,0)
ALL
"KRN",.402,763,"DR",1,123.5)
I '$D(GMRCSAFE) D EN^DDIOL("Editing of this file should only be done via the Setup Request Services option.") S Y="";I $G(GMRCSAFE) S Y=123.01;.01;123.01///^S X="CONSULTS";I $G(GMRCSAFE) S Y=1.1;
"KRN",.402,763,"DR",1,123.5,1)
1.11ABBREVIATED PRINT NAME (Optional)~;1.1;123.03///^S X="GMRCACTM SERVICE ACTION MENU";2;123.09;1.04;1.05;125;I $G(GMRCSAFE) S Y=123.08;1.01;1.02;124;1.03;D EN^DDIOL(" ");123.08;123.1;123.2;.08;D EN^DDIOL(" ");123.3;123.31;123.35;
"KRN",.402,763,"DR",1,123.5,2)
123.33;123.34;.07;D EN^DDIOL(" ");123.5;1.06;.06;10;
"KRN",.402,763,"DR",2,123.51)
.01:2
"KRN",.402,763,"DR",2,123.52)
.01
"KRN",.402,763,"DR",2,123.53)
.01
"KRN",.402,763,"DR",2,123.54)
.01:2
"KRN",.402,763,"DR",2,123.55)
.01
"KRN",.402,763,"DR",2,123.555)
.01:.02
"KRN",.402,763,"DR",2,123.57)
.01
"KRN",.402,763,"DR",2,123.58)
.01:.02
"KRN",.402,763,"DR",2,123.59)
.01
"KRN",.402,1346,-1)
0^1
"KRN",.402,1346,0)
GMRC PROCEDURE SETUP^3001213.0919^@^123.3^^@^3010122
"KRN",.402,1346,"DIAB",1,1,123.31,0)
ALL
"KRN",.402,1346,"DIAB",1,1,123.32,0)
ALL
"KRN",.402,1346,"DIAB",5,0,123.3,0)
.02//"YES"
"KRN",.402,1346,"DR",1,123.3)
.01;I '$G(GMRCNEW) S Y="@99";D EN^DDIOL("The new procedure will not be orderable unless the INACTIVE flag is deleted.");Q;.02//^S X="YES";S Y="@999";@99;.02;@999;1;2;.05;D EN^DDIOL(" ");125;.07;.08;124;.09;S Y="^";
"KRN",.402,1346,"DR",2,123.31)
.01
"KRN",.402,1346,"DR",2,123.32)
.01
"KRN",19,2046,-1)
2^2
"KRN",19,2046,0)
GMRC MGR^Consult Management^^M^.5^^^^^^^128
"KRN",19,2046,10,0)
^19.01IP^20^18
"KRN",19,2046,10,15,0)
7884^TD^29
"KRN",19,2046,10,15,"^")
GMRC TEST DEFAULT REASON
"KRN",19,2046,10,19,0)
8160^PR^31
"KRN",19,2046,10,19,"^")
GMRC PROCEDURE SETUP
"KRN",19,2046,10,20,0)
4142^RPT^1
"KRN",19,2046,10,20,"^")
GMRC REPORTS
"KRN",19,2046,"U")
CONSULT MANAGEMENT
"KRN",19,4142,-1)
3^9
"KRN",19,4142,0)
GMRC REPORTS^Consult Tracking Reports^^M^^^^^^^^
"KRN",19,4142,10,0)
^19.01IP^11^8
"KRN",19,4142,99)
58405,34529
"KRN",19,4142,"U")
CONSULT TRACKING REPORTS
"KRN",19,7884,-1)
0^8
"KRN",19,7884,0)
GMRC TEST DEFAULT REASON^Test Default Reason for Request^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,7884,1,0)
^^8^8^3001020^
"KRN",19,7884,1,1,0)
This option will allow the Clinical Coordinator or IRM to test the default
"KRN",19,7884,1,2,0)
reason for request for a given service or procedure without placing an
"KRN",19,7884,1,3,0)
order.
"KRN",19,7884,1,4,0)
 
"KRN",19,7884,1,5,0)
This option prompts for the selection of a procedure or a service from the
"KRN",19,7884,1,6,0)
consult hierarchy and a patient name. The default reason will be presented
"KRN",19,7884,1,7,0)
based on the selected patient in a list manager format. This format allows
"KRN",19,7884,1,8,0)
searching, printing etc. 
"KRN",19,7884,25)
EN^GMRCDRFR
"KRN",19,7884,"U")
TEST DEFAULT REASON FOR REQUES
"KRN",19,8160,-1)
0^1
"KRN",19,8160,0)
GMRC PROCEDURE SETUP^Setup procedures^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,8160,25)
EN^GMRC1233
"KRN",19,8160,"U")
SETUP PROCEDURES
"KRN",19,8166,-1)
1^3
"KRN",19,8166,0)
GMRC SETUP PROTOCOLS
"KRN",19,8167,-1)
1^4
"KRN",19,8167,0)
GMRC PROTOCOL DETAILED REPORT
"KRN",19,8168,-1)
1^5
"KRN",19,8168,0)
GMRC PROTOCOL LIST
"KRN",19,8169,-1)
1^6
"KRN",19,8169,0)
GMRC MEDICINE PKG INTERFACE
"KRN",19,8170,-1)
1^7
"KRN",19,8170,0)
GMRC MEDICINE USER
"KRN",101,1395,-1)
0^3
"KRN",101,1395,0)
GMRCACT ASSOCIATE RESULTS^Associate Result^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1395,1,0)
^^2^2^3000104^^^
"KRN",101,1395,1,1,0)
Associate Results with a consult allows the user to associate Medicine
"KRN",101,1395,1,2,0)
package results with a consult.
"KRN",101,1395,2,0)
^101.02A^^0
"KRN",101,1395,2,1,0)
 
"KRN",101,1395,2,"B"," ",1)

"KRN",101,1395,4)
^3^^AR
"KRN",101,1395,15)
I $G(GMRCO) D REFRESH^GMRCMED(GMRCO)
"KRN",101,1395,20)
D AR^GMRCMED("")
"KRN",101,1395,99)
58405,34520
"KRN",101,2112,-1)
2^10
"KRN",101,2112,0)
GMRCACTM SERVICE ACTION MENU^Service Action Menu^^Q^18^^^^^^^128
"KRN",101,2112,10,0)
^101.01PA^26^15
"KRN",101,2112,10,26,0)
5762^RM^24^^^Remove Med Rslt
"KRN",101,2112,10,26,"^")
GMRCACT REMOVE MED RESULT
"KRN",101,5423,-1)
2^8
"KRN",101,5423,0)
GMRCACTM DEFAULT REASON^Testing actions for default reason^^M^1322^^^^^^^128
"KRN",101,5423,10,0)
^101.01PA^3^3
"KRN",101,5423,10,3,0)
5763^SR^3^
"KRN",101,5423,10,3,"^")
GMRCU SELECT DEF REAS PROC
"KRN",101,5757,-1)
0^2
"KRN",101,5757,0)
GMRCACTM MED RESULTING^Consult/Medicine Resulting actions^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5757,4)
26^3
"KRN",101,5757,10,0)
^101.01PA^2^2
"KRN",101,5757,10,1,0)
1395^AR^1^
"KRN",101,5757,10,1,"^")
GMRCACT ASSOCIATE RESULTS
"KRN",101,5757,10,2,0)
5759^DR^2^
"KRN",101,5757,10,2,"^")
GMRCACT DISPLAY MED RESULT
"KRN",101,5757,26)
D PHDR^GMRCMED
"KRN",101,5757,28)
Select action: 
"KRN",101,5757,99)
58405,34521
"KRN",101,5758,-1)
0^1
"KRN",101,5758,0)
GMRCACT SELECT MED RESULT^Select Medicine Result^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5758,15)
S XQORM("HIJACK")=$O(^ORD(101,"B","GMRCACTM MED RESULTING",0))_"ORD(101,"
"KRN",101,5758,20)
D SET^GMRCMED(+$P(XQORNOD(0),"=",2))
"KRN",101,5758,99)
58405,34521
"KRN",101,5759,-1)
0^4
"KRN",101,5759,0)
GMRCACT DISPLAY MED RESULT^Display selected medicine result^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5759,15)
S VALMBCK="R"
"KRN",101,5759,20)
D DISPRES^GMRCMED("")
"KRN",101,5759,99)
58405,34521
"KRN",101,5760,-1)
0^6
"KRN",101,5760,0)
GMRCACT DISASSOC MED RSLT^Disassociate medicine results^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5760,1,0)
^101.06^2^2^3010109^^^
"KRN",101,5760,1,1,0)
This protocol will allow a MEDICINE package result to be disassociated
"KRN",101,5760,1,2,0)
from the consult procedure request to which it is linked.
"KRN",101,5760,15)
I $G(GMRCO) D REFRESH^GMRCDIS(GMRCO)
"KRN",101,5760,20)
D FULL^VALM1,EN1^GMRCDIS("")
"KRN",101,5760,99)
58405,34521
"KRN",101,5761,-1)
0^7
"KRN",101,5761,0)
GMRCACTM DISASSOC MED RSLT^Disassociate Medicine Result menu^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5761,1,0)
^^2^2^3000225^^
"KRN",101,5761,1,1,0)
This menu contains actions that me taken when disassociating a MEDICINE
"KRN",101,5761,1,2,0)
package result from a consult procedure request to which it is linked.
"KRN",101,5761,4)
26^3
"KRN",101,5761,10,0)
^101.01PA^2^2
"KRN",101,5761,10,1,0)
5760^DM^1^^^Disassociate result
"KRN",101,5761,10,1,"^")
GMRCACT DISASSOC MED RSLT
"KRN",101,5761,10,2,0)
5759^DR^2^^^Display Result
"KRN",101,5761,10,2,"^")
GMRCACT DISPLAY MED RESULT
"KRN",101,5761,15)

"KRN",101,5761,26)
D PHDR^GMRCDIS
"KRN",101,5761,28)
Select Action:
"KRN",101,5761,99)
58405,34521
"KRN",101,5762,-1)
0^5
"KRN",101,5762,0)
GMRCACT REMOVE MED RESULT^Remove Med Rslt^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5762,1,0)
^^3^3^3000225^
"KRN",101,5762,1,1,0)
This protocol will allow display and selection of those Medicine package
"KRN",101,5762,1,2,0)
results associated with a consult procedure request and allow one or more 
"KRN",101,5762,1,3,0)
results to be unlinked from the consult.  
"KRN",101,5762,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5762,20)
D DIS^GMRCDIS("")
"KRN",101,5762,99)
58421,47496
"KRN",101,5763,-1)
0^9
"KRN",101,5763,0)
GMRCU SELECT DEF REAS PROC^Select new Procedure^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5763,1,0)
^^2^2^3001020^
"KRN",101,5763,1,1,0)
This protocol allows the selection of a procedure for which to test the
"KRN",101,5763,1,2,0)
default reason for request.
"KRN",101,5763,15)
S VALMBCK="R"
"KRN",101,5763,20)
D SELPROC^GMRCDRFR,HDR^GMRCDRFR,INIT^GMRCDRFR
"KRN",101,5763,99)
58405,34521
"KRN",409.61,277,-1)
0^1
"KRN",409.61,277,0)
GMRC ASSOCIATE RESULTS^1^^80^5^17^1^1^^GMRCACTM MED RESULTING^Procedure/Medicine Resulting^1^^1
"KRN",409.61,277,1)
^GMRCACTM DISPLAY ACTIONS
"KRN",409.61,277,"ARRAY")
 ^TMP("GMRCR",$J,"DT")
"KRN",409.61,277,"COL",0)
^409.621^3^3
"KRN",409.61,277,"COL",1,0)
PROCEDURE^6^20^Type of Proc.^H
"KRN",409.61,277,"COL",2,0)
PROC DATE^30^18^Procedure Date^H
"KRN",409.61,277,"COL",3,0)
SUMMARY^50^25^Summary^H
"KRN",409.61,277,"COL","B","PROC DATE",2)

"KRN",409.61,277,"COL","B","PROCEDURE",1)

"KRN",409.61,277,"COL","B","SUMMARY",3)

"KRN",409.61,277,"FNL")
D EXIT^GMRCMER
"KRN",409.61,277,"HDR")
D HDRAR^GMRCMER
"KRN",409.61,277,"HLP")
D HELP^GMRCMER
"KRN",409.61,277,"INIT")
D INITAR^GMRCMER
"KRN",409.61,790,-1)
0^2
"KRN",409.61,790,0)
GMRC DISASSOC RESULTS^1^^80^5^20^0^1^Associated Results^GMRCACTM DISASSOC MED RSLT^Disassociate Results^1^^1
"KRN",409.61,790,1)
^GMRCACTM DISPLAY ACTIONS
"KRN",409.61,790,"ARRAY")
 ^TMP("GMRCR",$J,"DT")
"KRN",409.61,790,"FNL")
D EXIT^GMRCDIS
"KRN",409.61,790,"HDR")
D HDR^GMRCDIS
"KRN",409.61,790,"INIT")
D INIT^GMRCDIS
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PGL",123.3,0,5,.05)
TYPE OF PROCEDURE^*P697.2'^MCAR(697.2,^0;5^S DIC("S")="I $$PATCH^XPDUTL(""MC*2.3*27"")" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
15^3010316^1322
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^3010316
"PKG",128,22,1,"PAH",1,1,1,0)
See the National Patch Module for a complete list of enhancements.
"PRE")
GMRC15EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
38
"RTN","GMRC101H")
0^1^B4989844
"RTN","GMRC101H",1,0)
GMRC101H ;SLC/DCM - SET UP HL-7 MESSAGE TO UPDATE OERR ORDERABLE ITEMS FILE WITH NEW CONSULT TYPE ;5/20/98  14:20
"RTN","GMRC101H",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,15**;DEC 27, 1997
"RTN","GMRC101H",3,0)
EN(ELC,RLECODE,ORDA,ORNAME,GMRCARRY,GMRCPRFX) ;entry point to set up HL-7 message to update orderable items file - file 101.43
"RTN","GMRC101H",4,0)
 ;ELC=message type - MFN or UPD
"RTN","GMRC101H",5,0)
 ;RLECODE=record level event code from table 180
"RTN","GMRC101H",6,0)
 ;DA=IEN of procedure in ^ORD(101
"RTN","GMRC101H",7,0)
 ;ORNAME=procedure name
"RTN","GMRC101H",8,0)
 ;GMRCARRY=array of synonyms for procedure
"RTN","GMRC101H",9,0)
 ;GMRCPRFX=prefix from ^ORD(101, i.e., "GMRCR " or "GMRCT "
"RTN","GMRC101H",10,0)
 S MSH=$$MSH^GMRCHL7,$P(MSH,"|",3)=$S(GMRCPRFX="GMRCR ":"PROCEDURES",1:"CONSULTS"),$P(MSH,"|",9)="MFN"
"RTN","GMRC101H",11,0)
 S MFI=$$MFI(RLECODE)
"RTN","GMRC101H",12,0)
 S MFE=$$MFE(ELC,ORDA,ORNAME,GMRCPRFX)
"RTN","GMRC101H",13,0)
 D ZSY(.GMRCARRY)
"RTN","GMRC101H",14,0)
 D BUILD
"RTN","GMRC101H",15,0)
 K HLQ,MFE,MSH,MFI,MSG,MSGND,ND,ND1,ND2,ZSY,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRC101H",16,0)
 Q
"RTN","GMRC101H",17,0)
BUILD ;build the HL-7 array into its export form
"RTN","GMRC101H",18,0)
 S ND=1,MSG="GMRCMSG"
"RTN","GMRC101H",19,0)
 S @(MSG_"("_ND_")")=MSH,ND=ND+1
"RTN","GMRC101H",20,0)
 S @(MSG_"("_ND_")")=MFI,ND=ND+1
"RTN","GMRC101H",21,0)
 S @(MSG_"("_ND_")")=MFE,ND=ND+1
"RTN","GMRC101H",22,0)
 I $O(ZSY(0)) D
"RTN","GMRC101H",23,0)
 .S ND1=0 F  S ND1=$O(ZSY(ND1)) Q:ND1=""  S @(MSG_"("_ND_")")=ZSY(ND1),ND=ND+1
"RTN","GMRC101H",24,0)
 .K ND1
"RTN","GMRC101H",25,0)
 .Q
"RTN","GMRC101H",26,0)
 K ND
"RTN","GMRC101H",27,0)
 Q
"RTN","GMRC101H",28,0)
 ;
"RTN","GMRC101H",29,0)
MFI(MTP) ;set MFI HL-7 segment
"RTN","GMRC101H",30,0)
 S MFI="MFI|123.3^GMRC PROCEDURE^99DD||"_MTP_"|||NE"
"RTN","GMRC101H",31,0)
 Q MFI
"RTN","GMRC101H",32,0)
 ;
"RTN","GMRC101H",33,0)
MFE(RSPLVL,ORXDA,GMRCPRNO,PFX) ;set MFE HL-7 segment
"RTN","GMRC101H",34,0)
 N X
"RTN","GMRC101H",35,0)
 S X="MFE|"_RSPLVL_"|||^^^"_ORXDA_"^"_GMRCPRNO_"^99PRC"
"RTN","GMRC101H",36,0)
 Q X
"RTN","GMRC101H",37,0)
ZSY(ARRAY) ;set ZSY segment of the HL-7 segment; contains synonyms
"RTN","GMRC101H",38,0)
 S ND1="",ND2=1
"RTN","GMRC101H",39,0)
 F  S ND1=$O(ARRAY(ND1)) Q:ND1=""  S ZSY(ND2)="ZSY|"_ND2_"|"_ARRAY(ND1)_"|",ND2=ND2+1
"RTN","GMRC101H",40,0)
 K ND,ND1
"RTN","GMRC101H",41,0)
 Q
"RTN","GMRC101H",42,0)
SVC(SVCIEN,SVCNAME,EVCODE) ;format an HL-7 message that defines a new service
"RTN","GMRC101H",43,0)
 ;SVCIEN=Service IEN from file 123.5
"RTN","GMRC101H",44,0)
 ;SVCNAME=Service name, i.e., Medicine
"RTN","GMRC101H",45,0)
 ;EVCODE=record level event code from HL-7 table 180
"RTN","GMRC101H",46,0)
 K GMRCMSG
"RTN","GMRC101H",47,0)
 S MSH=$$MSH^GMRCHL7,$P(MSH,"|",9)="MFN"
"RTN","GMRC101H",48,0)
 S MFI="MFI|123.5^Request Services^99DD||"_$S(EVCODE="MUP":"UPD",1:"REP")_"|||NE"
"RTN","GMRC101H",49,0)
 S MFE="MFE|"_EVCODE_"|||^^^"_SVCIEN_"^"_SVCNAME_"^99CON"
"RTN","GMRC101H",50,0)
 I $L($O(^GMR(123.5,SVCIEN,2,"B",""))) D
"RTN","GMRC101H",51,0)
 .S ND="",ND1=0 F  S ND=$O(^GMR(123.5,SVCIEN,2,"B",ND)) Q:ND=""  S ND1=ND1+1,GMRCARRY(ND1)=ND
"RTN","GMRC101H",52,0)
 .D ZSY(.GMRCARRY)
"RTN","GMRC101H",53,0)
 .Q
"RTN","GMRC101H",54,0)
 D BUILD
"RTN","GMRC101H",55,0)
 K GMRCARRY,ND,ND1,HLQ,MSG,MSH,MFI,MFE,SEP1,SEP2,SEP3,SEP4,SEP5,ZSY
"RTN","GMRC101H",56,0)
 Q
"RTN","GMRC1233")
0^2^B2226146
"RTN","GMRC1233",1,0)
GMRC1233 ;SLC/JFR - CREATE/EDIT GMRC PROCEDURES;1/11/99 12:05
"RTN","GMRC1233",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15**;DEC 27, 1997
"RTN","GMRC1233",3,0)
EN ;START HERE
"RTN","GMRC1233",4,0)
 N DLAYGO,DIE,DIC,X,Y,GMRCNEW,GMRCTIT,DUOUT,DTOUT,DA,DR,UPDATE
"RTN","GMRC1233",5,0)
 S DIC="^GMR(123.3,",DIC(0)="AELZMQ",DLAYGO=123.3
"RTN","GMRC1233",6,0)
 S DIC("A")="Select Procedure:"
"RTN","GMRC1233",7,0)
 D ^DIC I Y<1 Q
"RTN","GMRC1233",8,0)
 S GMRCIT=+Y
"RTN","GMRC1233",9,0)
 I $P(Y,U,3) S GMRCNEW=1
"RTN","GMRC1233",10,0)
 S DIE=DIC,DA=GMRCIT,DR="[GMRC PROCEDURE SETUP]" D ^DIE
"RTN","GMRC1233",11,0)
 S UPDATE=$$OI(+$G(GMRCNEW),GMRCIT)
"RTN","GMRC1233",12,0)
 I +UPDATE W !!,"Orderable Item Updated"
"RTN","GMRC1233",13,0)
 I '+UPDATE W !!,$C(7),"Unable to update Orderable Item"
"RTN","GMRC1233",14,0)
 Q
"RTN","GMRC1233",15,0)
OI(NEW,PROC) ;get procedure info and update orderable item
"RTN","GMRC1233",16,0)
 I '$D(PROC) Q 0
"RTN","GMRC1233",17,0)
 I '$D(^GMR(123.3,+PROC)) Q 0
"RTN","GMRC1233",18,0)
 N NAME,CTRLC,ACTION,GMRCSYNS,GMRCMSG
"RTN","GMRC1233",19,0)
 S NAME=$P(^GMR(123.3,+PROC,0),U)
"RTN","GMRC1233",20,0)
 I $G(NEW) S CTRLC="MAD",ACTION="REP"
"RTN","GMRC1233",21,0)
 ;I +$P(^GMR(123.3,+PROC,0),U,2),'$G(NEW) S CTRLC="MDC"
"RTN","GMRC1233",22,0)
 I +$P(^GMR(123.3,+PROC,0),U,2) S CTRLC="MDC"
"RTN","GMRC1233",23,0)
 I '$D(CTRLC) S CTRLC="MUP"
"RTN","GMRC1233",24,0)
 I '$D(ACTION) S ACTION="UPD"
"RTN","GMRC1233",25,0)
 D SYNS(PROC,.GMRCSYNS)
"RTN","GMRC1233",26,0)
 D EN^GMRC101H(CTRLC,ACTION,+PROC,NAME,.GMRCSYNS,"GMRCR ")
"RTN","GMRC1233",27,0)
 D MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRC1233",28,0)
 Q 1
"RTN","GMRC1233",29,0)
SYNS(IEN,ARRAY) ;get synonyms and load into ARRAY
"RTN","GMRC1233",30,0)
 Q:'IEN
"RTN","GMRC1233",31,0)
 N I S I=0
"RTN","GMRC1233",32,0)
 F  S I=$O(^GMR(123.3,IEN,1,I)) Q:'I  D
"RTN","GMRC1233",33,0)
 . S ARRAY(I)=$P(^GMR(123.3,IEN,1,I,0),U)
"RTN","GMRC1233",34,0)
 Q
"RTN","GMRC15EN")
0^^B494620
"RTN","GMRC15EN",1,0)
GMRC15EN ;SLC/JFR - ENVIRONMENT CHECK GMRC*3*15; 2/1/00 08:07
"RTN","GMRC15EN",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15**;DEC 27, 1997
"RTN","GMRC15EN",3,0)
 N GMRCMCVR
"RTN","GMRC15EN",4,0)
 S GMRCMCVR=$$VERSION^XPDUTL("MC")
"RTN","GMRC15EN",5,0)
 I 'GMRCMCVR Q
"RTN","GMRC15EN",6,0)
 I GMRCMCVR,'$$PATCH^XPDUTL("MC*2.3*27") D
"RTN","GMRC15EN",7,0)
 . W !,"Patch MC*2.3*27 is required for installation of this patch"
"RTN","GMRC15EN",8,0)
 . W !,"GMRC*3*15 will not be installed."
"RTN","GMRC15EN",9,0)
 . S XPDQUIT=2
"RTN","GMRC15EN",10,0)
 Q
"RTN","GMRCACTM")
0^30^B4282247
"RTN","GMRCACTM",1,0)
GMRCACTM ; SLC/DLT,DCM,JFR - Set GMRCACTM with action menu based on Service ;11/21/00 13:40
"RTN","GMRCACTM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,11,18,15**;DEC 27, 1997
"RTN","GMRCACTM",3,0)
 ;
"RTN","GMRCACTM",4,0)
 ; This routine invokes IA #2425
"RTN","GMRCACTM",5,0)
 ;
"RTN","GMRCACTM",6,0)
CPRS(GMRCPM,GUI) ;Entry point for setting menu actions for CPRS user
"RTN","GMRCACTM",7,0)
 ;Input:
"RTN","GMRCACTM",8,0)
 ;  GMRCPM=a list of File 123 IEN's to check for menu actions.
"RTN","GMRCACTM",9,0)
 ;       Passed in as '300;303;295;309;313'
"RTN","GMRCACTM",10,0)
 ;  GUI =1 if coming from the GUI; return field name in ORFLG also
"RTN","GMRCACTM",11,0)
 ;Output:
"RTN","GMRCACTM",12,0)
 ;  ORFLG(ien)= A^B^C^D^E^F^G where:
"RTN","GMRCACTM",13,0)
 ;    Ien = internal entry of record in file 123
"RTN","GMRCACTM",14,0)
 ;    A = a number representing one of the following:
"RTN","GMRCACTM",15,0)
 ;       1 - user has only review capabilities
"RTN","GMRCACTM",16,0)
 ;       2 - user has full update capabilities
"RTN","GMRCACTM",17,0)
 ;       3 - user has administrative update capabilities
"RTN","GMRCACTM",18,0)
 ;    B = field in file 123.5 (REQUEST SERVICES) that gave the user 
"RTN","GMRCACTM",19,0)
 ;        update authority (ex.  Update user w/o Notification)
"RTN","GMRCACTM",20,0)
 ;    C = Service in file 123.5 (REQUEST SERVICES) that gave the user
"RTN","GMRCACTM",21,0)
 ;        update authority (ex. CARDIOLOGY,NEUROLOGY)
"RTN","GMRCACTM",22,0)
 ;    D = contains a 1 if user is allowed to associate medicine results
"RTN","GMRCACTM",23,0)
 ;        with a consult procedure request
"RTN","GMRCACTM",24,0)
 ;    F = contain a 1 if user can disassociate a medicine result that was
"RTN","GMRCACTM",25,0)
 ;        incorrectly associated with a consult procedure request
"RTN","GMRCACTM",26,0)
 ;    G = contains a 1 if user is allowed to EDIT and RESUBMIT a canceled
"RTN","GMRCACTM",27,0)
 ;        request
"RTN","GMRCACTM",28,0)
 ;
"RTN","GMRCACTM",29,0)
 I '$L(GMRCPM) S ORFLG=1 Q
"RTN","GMRCACTM",30,0)
 K ORFLG
"RTN","GMRCACTM",31,0)
 N I,GMRCSS,GMRCIEN
"RTN","GMRCACTM",32,0)
 F I=1:1 S ORFLG=1,GMRCIEN=$P(GMRCPM,";",I) Q:GMRCIEN=""  D
"RTN","GMRCACTM",33,0)
 .S ORFLG(GMRCIEN)=1 ;set default answer to read only
"RTN","GMRCACTM",34,0)
 .S GMRCSS=+$P($G(^GMR(123,+GMRCIEN,0)),"^",5)
"RTN","GMRCACTM",35,0)
 .Q:'+$G(GMRCSS)
"RTN","GMRCACTM",36,0)
 .;when service is defined, check for service user 
"RTN","GMRCACTM",37,0)
 .D EN
"RTN","GMRCACTM",38,0)
 .S ORFLG(GMRCIEN)=ORFLG
"RTN","GMRCACTM",39,0)
 .I ORFLG>1 D
"RTN","GMRCACTM",40,0)
 .. ;can DUZ associate med results?
"RTN","GMRCACTM",41,0)
 .. S $P(ORFLG(GMRCIEN),U,4)=$$CANDOMED^GMRCGUIU(GMRCIEN)
"RTN","GMRCACTM",42,0)
 . ;can DUZ disassociate a med result?
"RTN","GMRCACTM",43,0)
 . S $P(ORFLG(GMRCIEN),U,5)=+$$REMUSR^GMRCDIS(GMRCIEN)
"RTN","GMRCACTM",44,0)
 . ;can user edit/resubmit
"RTN","GMRCACTM",45,0)
 . I $$VALPROV^GMRCEDIT(GMRCIEN) S $P(ORFLG(GMRCIEN),U,6)=1
"RTN","GMRCACTM",46,0)
 . Q
"RTN","GMRCACTM",47,0)
 Q
"RTN","GMRCACTM",48,0)
 ;
"RTN","GMRCACTM",49,0)
EN ;Set GMRCACTM with appropriate menu of actions based on user
"RTN","GMRCACTM",50,0)
 ;If ORFLG is DEFINED then GMRCACTM is returned as a set of codes:
"RTN","GMRCACTM",51,0)
 ;    1 = GMRCACTM USER REVIEW SCREEN - simple actions
"RTN","GMRCACTM",52,0)
 ;    2 = GMRCACTM SERVICE ACTION menu  - all actions possible for
"RTN","GMRCACTM",53,0)
 ;        clinical user in service
"RTN","GMRCACTM",54,0)
 ;    3 =  administrative user
"RTN","GMRCACTM",55,0)
 ; initialize GMRCACTM for read only
"RTN","GMRCACTM",56,0)
 S GMRCACTM="GMRCACTM USER REVIEW SCREEN"
"RTN","GMRCACTM",57,0)
 ; if service and entry aren't defined, assume read only access
"RTN","GMRCACTM",58,0)
 I '$D(XQADATA),$S('+$G(GMRCSS):1,1:0) D  Q
"RTN","GMRCACTM",59,0)
 .I $D(ORFLG) S ORFLG(GMRCIEN)=1 K GMRCACTM
"RTN","GMRCACTM",60,0)
 .Q
"RTN","GMRCACTM",61,0)
 ;
"RTN","GMRCACTM",62,0)
 ;Get the users service update level
"RTN","GMRCACTM",63,0)
 N GMRCFLG
"RTN","GMRCACTM",64,0)
 S GMRCFLG=$$VALID^GMRCAU(+GMRCSS,"",,$G(GUI))
"RTN","GMRCACTM",65,0)
 ;
"RTN","GMRCACTM",66,0)
 ;If ORFLG is all that should be returned, than set and exit
"RTN","GMRCACTM",67,0)
 I $D(ORFLG) D  Q
"RTN","GMRCACTM",68,0)
 . K GMRCACTM
"RTN","GMRCACTM",69,0)
 . I GMRCFLG=0 S ORFLG=1 Q
"RTN","GMRCACTM",70,0)
 . S ORFLG=GMRCFLG Q
"RTN","GMRCACTM",71,0)
 ;Process the GMRCFLG value to get the GMRCACTM defined.
"RTN","GMRCACTM",72,0)
 I GMRCFLG>0 D  Q
"RTN","GMRCACTM",73,0)
 . S GMRCACTM="GMRCACTM SERVICE ACTION MENU"
"RTN","GMRCACTM",74,0)
 Q
"RTN","GMRCAFRD")
0^3^B31943912
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM - Forward Req (FR) Action from Review Screen ;7/16/98  01:48
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,15**;DEC 27, 1997
"RTN","GMRCAFRD",3,0)
 ;
"RTN","GMRCAFRD",4,0)
 ; This routine invokes IA #2395
"RTN","GMRCAFRD",5,0)
 ;
"RTN","GMRCAFRD",6,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",7,0)
 N ORVP,GMRCLCK,DFN
"RTN","GMRCAFRD",8,0)
 W !!,"Forward Request To Another Service For Action."
"RTN","GMRCAFRD",9,0)
 W !,"Select the service to send the consult to.",!
"RTN","GMRCAFRD",10,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",11,0)
 N GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCAD,GMRCTO,GMRCADUZ
"RTN","GMRCAFRD",12,0)
 K GMRCQUT,GMRCSEL
"RTN","GMRCAFRD",13,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",14,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",15,0)
 I '$$LOCK^GMRCA1(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",16,0)
 S GMRCLCK=1
"RTN","GMRCAFRD",17,0)
 ;
"RTN","GMRCAFRD",18,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",19,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",20,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=9 D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",21,0)
 .S GMRCMSG="Invalid action. This consult has partial results."
"RTN","GMRCAFRD",22,0)
 .S GMRCMSG(1)="Remove the associated results before forwarding."
"RTN","GMRCAFRD",23,0)
 .D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",24,0)
 ;
"RTN","GMRCAFRD",25,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",26,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",27,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",28,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",29,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",30,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",31,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",32,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",33,0)
 D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",34,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",35,0)
 I '$G(GMRCAD) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCAFRD",36,0)
 N GMRCSS,GMRCSSNM,GMRCA,GMRCMSG
"RTN","GMRCAFRD",37,0)
 D DEFAULT
"RTN","GMRCAFRD",38,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",39,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",40,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",41,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",42,0)
 S GMRCA=17,DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",43,0)
 S DR="1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA;.1///@"
"RTN","GMRCAFRD",44,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",45,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",46,0)
 S GMRCOM=1 D AUDIT^GMRCP ;GMRCORNP is the responsible provider here
"RTN","GMRCAFRD",47,0)
 ;
"RTN","GMRCAFRD",48,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO) ;unlk before FWD changes order #
"RTN","GMRCAFRD",49,0)
 ;
"RTN","GMRCAFRD",50,0)
FRMSG ; Common logic used by GUI and List Manager to process the HL7 message
"RTN","GMRCAFRD",51,0)
 ; to update the order in OE/RR and then forward an alert to recipients
"RTN","GMRCAFRD",52,0)
 ; is passed in as the DUZ instead of the responsible provider
"RTN","GMRCAFRD",53,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX^FORWARD",$G(DUZ),$G(VISIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAFRD",54,0)
 S GMRCADUZ=""
"RTN","GMRCAFRD",55,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",56,0)
 I +$G(GMRCORNP) S GMRCADUZ(+GMRCORNP)="" ;alert original provider of forward
"RTN","GMRCAFRD",57,0)
 S GMRCORTX="Forwarded consult "_$$ORTX^GMRCAU(+GMRCO)_" ("_GMRCURG_")"
"RTN","GMRCAFRD",58,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,1) ;GMRCO=IEN of consult from file 123; 27 is notification entry from file ORD(100.9
"RTN","GMRCAFRD",59,0)
 K GMRCOM
"RTN","GMRCAFRD",60,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",61,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",62,0)
 D END
"RTN","GMRCAFRD",63,0)
 Q
"RTN","GMRCAFRD",64,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",65,0)
 N X,Y,XQORM,DIROUT,DTOUT,DIRUT,DUOUT
"RTN","GMRCAFRD",66,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",67,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",68,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",69,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",70,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",71,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",72,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",73,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D EN^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",74,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",75,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",76,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",77,0)
 Q
"RTN","GMRCAFRD",78,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",79,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",80,0)
 N GMRC,GMRCDIC,GMRCPLI,GMRCPRI
"RTN","GMRCAFRD",81,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",82,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",83,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",84,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",85,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",86,0)
 S GMRCPRI=$P(GMRC(0),"^",8) I GMRCPRI["ORD(101" D
"RTN","GMRCAFRD",87,0)
 . S GMRCPR=$$GET1^DIQ(101,+GMRCPRI,1)
"RTN","GMRCAFRD",88,0)
 I $L(GMRCPRI),GMRCPRI'["ORD(101" D  ;ZPROC
"RTN","GMRCAFRD",89,0)
 . S GMRCPR=$$GET1^DIQ(123.3,+GMRCPRI,.01)
"RTN","GMRCAFRD",90,0)
TYPE ;This entry point is used when the only default needed is the GMRCTYPE
"RTN","GMRCAFRD",91,0)
 ;Called by GMRCGUIA to get variables ready for FRMSG call.
"RTN","GMRCAFRD",92,0)
 S GMRCTYPE=$$GET1^DIQ(123,+GMRCO,13,"I") ;ZPROC (P or C)
"RTN","GMRCAFRD",93,0)
 Q
"RTN","GMRCAFRD",94,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",95,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCAFRD",96,0)
 K GETPROV,GMRCDG,GMRCDEV,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP
"RTN","GMRCAFRD",97,0)
 K GMRCTYPE,GMRCORTX,GMRCPL,GMRCPR,GMRCSEL,GMRCURG,GMRCADUZ,Y
"RTN","GMRCAFRD",98,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCAFRD",99,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",100,0)
 Q
"RTN","GMRCAR")
0^4^B26252788
"RTN","GMRCAR",1,0)
GMRCAR ;SLC/DLT,JFR - Associate Results ;7/21/00  12:20
"RTN","GMRCAR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,15**;DEC 27, 1997
"RTN","GMRCAR",3,0)
AR ;Associate results with request
"RTN","GMRCAR",4,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAR",5,0)
 I '$D(GMRCSEL) D SEL^GMRCA2 I $D(DTOUT)!$D(DIROUT) S GMRCQIT="" Q
"RTN","GMRCAR",6,0)
 I 'GMRCSEL G END
"RTN","GMRCAR",7,0)
 S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0)),GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCAR",8,0)
 I $P(GMRC(0),"^",12)=1 W !!,"THIS ORDER HAS BEEN DISCONTINUED, PLEASE SELECT OR ADD ANOTHER ORDER!",!! G END
"RTN","GMRCAR",9,0)
 S GMRCQIT="" Q
"RTN","GMRCAR",10,0)
ARMED ;Entry to associate results with a consult/request
"RTN","GMRCAR",11,0)
 N GMRCQIT,GMRCQUT,GMRCPROC,GMRCSR,MCROOT,MCFILE,Y
"RTN","GMRCAR",12,0)
 I '$$VERSION^XPDUTL("MC") D  Q
"RTN","GMRCAR",13,0)
 . N GMRCMSG
"RTN","GMRCAR",14,0)
 . S GMRCMSG="Medicine Package Not Installed. Can't Associate Results."
"RTN","GMRCAR",15,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAR",16,0)
 I $$VERSION^XPDUTL("MC")'>2.0 D  Q
"RTN","GMRCAR",17,0)
 . N GMRCMSG
"RTN","GMRCAR",18,0)
 . S GMRCMSG="**Version 2.2 of Medicine required to associate results with Consults**"
"RTN","GMRCAR",19,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAR",20,0)
 . S GMRCQUT=1
"RTN","GMRCAR",21,0)
 I $D(XQY0),$E(XQY0,1,2)="MC" G AR
"RTN","GMRCAR",22,0)
 I '$D(GMRCO) D SEL^GMRCA2 I 'GMRCSEL G END
"RTN","GMRCAR",23,0)
 I $D(VALM) D FULL^VALM1
"RTN","GMRCAR",24,0)
 I '$D(GMRCO) S GMRCO=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCAR",25,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCAR",26,0)
 S GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCAR",27,0)
 I GMRCPROC="" D  G END
"RTN","GMRCAR",28,0)
 . S GMRCMSG="No Procedure was ordered - Cannot Associate Results."
"RTN","GMRCAR",29,0)
 . D EXAC^GMRCADC(GMRCMSG) S GMRCQIT=1
"RTN","GMRCAR",30,0)
 I '$P(^GMR(123.3,+GMRCPROC,0),U,5) D  I $G(GMRCQIT)=1  G END
"RTN","GMRCAR",31,0)
 . D EXAC^GMRCADC("This procedure not configured for Medicine Resulting")
"RTN","GMRCAR",32,0)
 . S GMRCQIT=1
"RTN","GMRCAR",33,0)
 I $P(GMRC(0),"^",12)=1 D  G END
"RTN","GMRCAR",34,0)
 . S GMRCMSG="THIS ORDER HAS BEEN DISCONTINUED!"
"RTN","GMRCAR",35,0)
 . D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1
"RTN","GMRCAR",36,0)
 I +$P(GMRC(0),"^",15),$P(GMRC(0),U,15)["MCAR" D
"RTN","GMRCAR",37,0)
 . S GMRCSR=$P(GMRC(0),"^",15)
"RTN","GMRCAR",38,0)
 . S GMRCSR=U_$P(GMRCSR,";",2)_$P(GMRCSR,";")_",0)"
"RTN","GMRCAR",39,0)
 . I '$D(@GMRCSR) D  I $G(GMRCQIT)=1 Q
"RTN","GMRCAR",40,0)
 .. S GMRCMSG="This request is currently associated with results "
"RTN","GMRCAR",41,0)
 .. S GMRCMSG=GMRCMSG_"no longer available" D EXAC^GMRCADC(GMRCMSG),END
"RTN","GMRCAR",42,0)
 .. S GMRCQIT=1
"RTN","GMRCAR",43,0)
 .S X=$P(@GMRCSR,"^",1) D REGDTM^GMRCU S X1=X
"RTN","GMRCAR",44,0)
 .S X=$P(^GMR(123,GMRCO,0),"^",7) D REGDTM^GMRCU
"RTN","GMRCAR",45,0)
 .W !,"  Results entered on "_X1_" are associated "
"RTN","GMRCAR",46,0)
 .W !,"  with this request ordered on "_X
"RTN","GMRCAR",47,0)
 . S DIR(0)="YA",DIR("A")="Would you like to continue? "
"RTN","GMRCAR",48,0)
 . S DIR("B")="No" D ^DIR I Y<1 S GMRCQIT=1 Q
"RTN","GMRCAR",49,0)
 . Q
"RTN","GMRCAR",50,0)
 I $G(GMRCQIT)=1 Q
"RTN","GMRCAR",51,0)
 S MCROOT=$$GET1^DIQ(697.2,+$P(^GMR(123.3,+GMRCPROC,0),U,5),1)
"RTN","GMRCAR",52,0)
 D RESULTS^GMRCMED(MCROOT,$P(^GMR(123,+GMRCO,0),U,2))
"RTN","GMRCAR",53,0)
 I $D(^TMP("GMRCR",$J,"DT")) D EN^GMRCMER S VALMBCK="R",GMRCQIT=1
"RTN","GMRCAR",54,0)
 I '$D(^TMP("GMRCR",$J,"DT"))&'($G(GMRCQIT)) D
"RTN","GMRCAR",55,0)
 . N MSG
"RTN","GMRCAR",56,0)
 . S MSG="No results are available to associate with this request."
"RTN","GMRCAR",57,0)
 . D EXAC^GMRCADC(MSG)
"RTN","GMRCAR",58,0)
 Q
"RTN","GMRCAR",59,0)
LKUP ;look up on procedure file using "C" cross-reference
"RTN","GMRCAR",60,0)
 N Y,DIC
"RTN","GMRCAR",61,0)
 S GMRCDIC="^"_GMRCGL_",""C"","_DFN_")" I '$D(@GMRCDIC) S GMRCMSG="No "_GMRCPRNM_" results available for "_$P(^DPT(DFN,0),"^") D EXAC^GMRCADC(GMRCMSG) G END
"RTN","GMRCAR",62,0)
 S DIC="^"_GMRCGL_",",DIC(0)="XEZ",D="C",X=$P(^DPT(DFN,0),"^"),DIC("S")="I $P(^(0),U,2)=DFN" W !,"Results for "_$P(^DPT(DFN,0),"^")
"RTN","GMRCAR",63,0)
 D MIX^DIC1 G:+Y<0 END
"RTN","GMRCAR",64,0)
 S GMRCSR=+Y_";"_GMRCGL_",",GMRCSRDT=Y(0,0)
"RTN","GMRCAR",65,0)
 N GMRCEND S GMRCEND=0 W ! S DIR(0)="Y",DIR("A")="Do you want to review these results first",DIR("B")="Y" D ^DIR K DIR I Y D  G:GMRCEND END
"RTN","GMRCAR",66,0)
 .W @IOF S GMRCSRS=GMRCSR D AREN^GMRCSLM3(GMRCO,GMRCSR),EN^GMRCMER S GMRCSR=GMRCSRS
"RTN","GMRCAR",67,0)
 .I GMRCCT=1 S GMRCEND=1 Q
"RTN","GMRCAR",68,0)
 .N DIR,DIROUT,DTOUT,DUOUT
"RTN","GMRCAR",69,0)
 .W !! S DIR(0)="Y",DIR("A")="Are these the right results to be associated with the selected request",DIR("B")="N" D ^DIR K DIR S:$D(DIROUT)!$D(DTOUT)!(X="^") GMRCEND=1
"RTN","GMRCAR",70,0)
 .I Y=0 K GMRCSR S GMRCEND=1
"RTN","GMRCAR",71,0)
 I GMRCEND K GMRCEND G END
"RTN","GMRCAR",72,0)
 I '$D(GMRCSR) K GMRCEND W ! G LKUP
"RTN","GMRCAR",73,0)
 I '+GMRCSR G END
"RTN","GMRCAR",74,0)
ORSTS ;Check if status needs update to complete
"RTN","GMRCAR",75,0)
 N ORSTS
"RTN","GMRCAR",76,0)
 I $P(GMRC(0),"^",12)=2 W !,"This request is already completed, no updating performed for this request",!,"Press the <ENTER> key to EXIT " R X:DTIME G END
"RTN","GMRCAR",77,0)
 W ! S DIR(0)="Y",DIR("A")="Shall I update the order status to complete",DIR("B")="N",DIR("?")="Type 'Y' for 'YES' or 'N' for 'NO' and press <ENTER> key." D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!$D(DUOUT) G END
"RTN","GMRCAR",78,0)
 S ORSTS=$S(Y:2,1:9)
"RTN","GMRCAR",79,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=ORSTS&(+$P(^GMR(123,GMRCO,0),"^",15)) G END
"RTN","GMRCAR",80,0)
 S GETPROV="Clinician responsible for results" D GETPROV^GMRCAU I '$D(GMRCORNP) S GMRCQIT="" G END
"RTN","GMRCAR",81,0)
 S GMRCSVSS=GMRCSVCN D RESULT^GMRCR S GMRCSS=GMRCSVSS K GMRCSVSS,ORIFN
"RTN","GMRCAR",82,0)
 S GMRCVP=$O(^ORD(101,"B","GMRCR "_GMRCPROC,0)) I GMRCVP]"" S GMRCVP=GMRCVP_";ORD(101," D AD^GMRCSLM1,INIT^GMRCSLM
"RTN","GMRCAR",83,0)
END ;
"RTN","GMRCAR",84,0)
 K ORIFN,GMRCO,GMRCEND,GMRCGL,GMRCDIC,GMRCMSG,GMRCVP,DIC,D,GMRCSR,GMRCSRDT,GMRCSRS,GMRCTM,GMRCBM,X,X1,GETPROV
"RTN","GMRCAR",85,0)
 K GMRCO,GMRC(0),GMRCSR,MCFILE,MCPROC,GMRCPROC,GMRCPRNM
"RTN","GMRCAR",86,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCAR",87,0)
 Q
"RTN","GMRCART")
0^34^B38165721
"RTN","GMRCART",1,0)
GMRCART ;SLC/DCM,DLT - Result display logic ;6/29/98  23:50
"RTN","GMRCART",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,15**;DEC 27, 1997
"RTN","GMRCART",3,0)
 ;
"RTN","GMRCART",4,0)
 ; This routine invokes IA #2638
"RTN","GMRCART",5,0)
 ;
"RTN","GMRCART",6,0)
RT(GMRCO) ;Result Display logic - called from GMRCA1
"RTN","GMRCART",7,0)
 N GMRCCT,GMRCTMP,GMRCSR,GMRCTUFN,GMRCSTS,GMRCMSG
"RTN","GMRCART",8,0)
 ;
"RTN","GMRCART",9,0)
 S GMRCSR=$P($G(^GMR(123,+GMRCO,0)),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCART",10,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",11,0)
 I '$$RESOLUS^GMRCAU(GMRCSTS),('+GMRCSR&('GMRCTUFN)) S GMRCMSG="No results available for review." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCART",12,0)
 ;
"RTN","GMRCART",13,0)
 W !,"Compiling Result Display..."
"RTN","GMRCART",14,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCART",15,0)
 K ^TMP("GMRCR",$J,"DT") S GMRCCT=1
"RTN","GMRCART",16,0)
 S XQORM("A")="Select Action: "
"RTN","GMRCART",17,0)
 S:$D(VALMAR) GMRCVAL=VALMAR
"RTN","GMRCART",18,0)
 S GMRCTMP="^TMP(""GMRCR"",$J,""DT"")"
"RTN","GMRCART",19,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",20,0)
 ;
"RTN","GMRCART",21,0)
 D GETRSLT(GMRCTMP)
"RTN","GMRCART",22,0)
 ;
"RTN","GMRCART",23,0)
 D EN^VALM("GMRC RESULTS DISPLAY")
"RTN","GMRCART",24,0)
 S:$D(GMRCVAL) VALMAR=GMRCVAL S:$D(LNCT) VALMCNT=LNCT
"RTN","GMRCART",25,0)
 D KILL^VALM10()
"RTN","GMRCART",26,0)
 K OREND,ORAGE,ORIO,ORDOB,ORFT,ORHI,ORIFN,ORNP,ORL,ORPD,ORPNM,ORPV,ORSEQ,ORSEX,ORWARD,ORDG
"RTN","GMRCART",27,0)
 K GMRCDVL,GMRCLCT,GMRCRPT,GMRCTUFN,GMRCVAL,MCFILE,MCPROC,GMRCX,GMRCTO,GMRCPRNM
"RTN","GMRCART",28,0)
 D END
"RTN","GMRCART",29,0)
 Q
"RTN","GMRCART",30,0)
 ;
"RTN","GMRCART",31,0)
GETRSLT(TMPGLOB) ;load the results into global defined in TMPGLOB
"RTN","GMRCART",32,0)
 ;used for GUI formated results and list manager
"RTN","GMRCART",33,0)
 N GMRCCTS,SF,TAB
"RTN","GMRCART",34,0)
 S TAB="",$P(TAB," ",31)=""
"RTN","GMRCART",35,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCART",36,0)
 K @TMPGLOB
"RTN","GMRCART",37,0)
 S GMRCCT=1
"RTN","GMRCART",38,0)
 I $L($P(^GMR(123,GMRCO,0),"^",19)) S SF=$P(^(0),"^",19),@TMPGLOB@(GMRCCT,0)="Significant Findings: "_$S(SF="Y":"**Yes**",SF="N":"No",1:"Unknown"),GMRCCT=GMRCCT+1
"RTN","GMRCART",39,0)
 ;S @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",40,0)
 D PRINT^GMRCTIUP(GMRCO,GMRCCT,1)
"RTN","GMRCART",41,0)
 S GMRCCTS=GMRCCT ;save the line count before printing med and TIU notes
"RTN","GMRCART",42,0)
 D GETMCAR
"RTN","GMRCART",43,0)
 D GETCP
"RTN","GMRCART",44,0)
 D GETRES
"RTN","GMRCART",45,0)
 I GMRCCT=GMRCCTS D  ;check if count changed for notes or med results
"RTN","GMRCART",46,0)
 . S:+$L($G(SF)) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1 ;GMRCDVL_GMRCDVL
"RTN","GMRCART",47,0)
 . S @TMPGLOB@(GMRCCT,0)="No TIU results or Medicine results available for this consult"
"RTN","GMRCART",48,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCART",49,0)
 ;
"RTN","GMRCART",50,0)
 D GETCOM
"RTN","GMRCART",51,0)
 I GMRCCT>2 S @TMPGLOB@(GMRCCT,0)="",$P(@TMPGLOB@(GMRCCT,0),"=",81)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",52,0)
 Q
"RTN","GMRCART",53,0)
 ;
"RTN","GMRCART",54,0)
GETMCAR ;load the medicine results into TMPGLOB
"RTN","GMRCART",55,0)
 Q:'$O(^TMP("GMRCR",$J,"MCAR",0))
"RTN","GMRCART",56,0)
 N ND,ND1
"RTN","GMRCART",57,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"MCAR",ND)) Q:ND=""!(ND?1A.E)  D
"RTN","GMRCART",58,0)
 .S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",59,0)
 .S @TMPGLOB@(GMRCCT,0)=TAB_"Medicine Package Report",GMRCCT=GMRCCT+1
"RTN","GMRCART",60,0)
 .S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"MCAR",ND,ND1)) Q:ND1=""  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"MCAR",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",61,0)
 .Q
"RTN","GMRCART",62,0)
 K ^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCART",63,0)
 Q
"RTN","GMRCART",64,0)
 ;
"RTN","GMRCART",65,0)
GETCP ; Load up any Clin. Proc. results
"RTN","GMRCART",66,0)
 Q:'$O(^TMP("GMRCR",$J,"CP",0))
"RTN","GMRCART",67,0)
 N ND,ND1
"RTN","GMRCART",68,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"CP",ND)) Q:ND=""!(ND?1A.E)  D
"RTN","GMRCART",69,0)
 .S @TMPGLOB@(GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",70,0)
 .S @TMPGLOB@(GMRCCT,0)=TAB_"Clinical Procedure Report",GMRCCT=GMRCCT+1
"RTN","GMRCART",71,0)
 .S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"CP",ND,ND1)) Q:ND1=""  D
"RTN","GMRCART",72,0)
 .. S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"CP",ND,ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",73,0)
 .Q
"RTN","GMRCART",74,0)
 K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCART",75,0)
 Q
"RTN","GMRCART",76,0)
 ;
"RTN","GMRCART",77,0)
GETRES ;load the TIU notes into TMPGLOB
"RTN","GMRCART",78,0)
 Q:'+$O(^TMP("GMRCR",$J,"RES",0))
"RTN","GMRCART",79,0)
 ;
"RTN","GMRCART",80,0)
 N ND,ND1
"RTN","GMRCART",81,0)
 S ND=0 F  S ND=$O(^TMP("GMRCR",$J,"RES",ND)) Q:(ND="")!(ND?1A.E)  D
"RTN","GMRCART",82,0)
 . I $D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) D
"RTN","GMRCART",83,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",84,0)
 . . S @TMPGLOB@(GMRCCT,0)=$E(GMRCDVL,1,80-$L(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT"))\2)_^("GMRCRPT")_$E(GMRCDVL,1,80-$L(^("GMRCRPT"))\2)
"RTN","GMRCART",85,0)
 . . S GMRCCT=GMRCCT+1
"RTN","GMRCART",86,0)
 . S:'$D(^TMP("GMRCR",$J,"RES",ND,"TEXT","GMRCRPT")) @TMPGLOB@(GMRCCT,0)=GMRCDVL_GMRCDVL,GMRCCT=GMRCCT+1
"RTN","GMRCART",87,0)
 . S:$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",0)) @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",88,0)
 . S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1)) Q:ND1?1A.E!(ND1="")  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"TEXT",ND1,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",89,0)
 . I $O(^TMP("GMRCR",$J,"RES",ND,"ADD",0)) S ND1=0 F  S ND1=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1)) Q:ND1=""   D
"RTN","GMRCART",90,0)
 . . S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",91,0)
 . . S @TMPGLOB@(GMRCCT,0)=TAB_"ADDENDUM TO REPORT",GMRCCT=GMRCCT+1
"RTN","GMRCART",92,0)
 . . S ND2=0 F  S ND2=$O(^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2)) Q:ND2=""!(ND2?1A.E)  S @TMPGLOB@(GMRCCT,0)=^TMP("GMRCR",$J,"RES",ND,"ADD",ND1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",93,0)
 . . Q
"RTN","GMRCART",94,0)
 . Q
"RTN","GMRCART",95,0)
 K ^TMP("GMRCR",$J,"RES")
"RTN","GMRCART",96,0)
 Q
"RTN","GMRCART",97,0)
 ;
"RTN","GMRCART",98,0)
GETCOM ;Get the comments for resolution actions
"RTN","GMRCART",99,0)
 S GMRCSTS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCART",100,0)
 Q:'$$RESOLUS^GMRCAU(+GMRCSTS) 
"RTN","GMRCART",101,0)
 ;
"RTN","GMRCART",102,0)
 ;Loop thru actions to find the resolution type actions
"RTN","GMRCART",103,0)
 N ND,ND1,ND2
"RTN","GMRCART",104,0)
 S ND="" F  S ND=$O(^GMR(123,+GMRCO,40,"B",ND)) Q:ND=""  S ND1=$O(^GMR(123,+GMRCO,40,"B",ND,"")) D
"RTN","GMRCART",105,0)
 . ;
"RTN","GMRCART",106,0)
 . ;Check for resulting action types:complete,sig finding,dc,cancel
"RTN","GMRCART",107,0)
 . N GMRCAIEN
"RTN","GMRCART",108,0)
 . S GMRCAIEN=$P($G(^GMR(123,+GMRCO,40,ND1,0)),"^",2)
"RTN","GMRCART",109,0)
 . I '$$RESOLUA^GMRCAU(GMRCAIEN) Q
"RTN","GMRCART",110,0)
 . ;
"RTN","GMRCART",111,0)
 . ;save the action header info in case there are comments
"RTN","GMRCART",112,0)
 . N GMRCAHDR,GMRCPROV,GMRCENBY,GMRCENDT
"RTN","GMRCART",113,0)
 . D SAVEHDR
"RTN","GMRCART",114,0)
 . ;
"RTN","GMRCART",115,0)
 . ;check for comments, print header on first pass
"RTN","GMRCART",116,0)
 . S ND2=0
"RTN","GMRCART",117,0)
 . F  S ND2=$O(^GMR(123,GMRCO,40,ND1,1,ND2)) Q:ND2=""  D
"RTN","GMRCART",118,0)
 . . I +$G(GMRCAHDR) D GETHDR ;GMRCAHDR will =1 on first pass
"RTN","GMRCART",119,0)
 . . S @TMPGLOB@(GMRCCT,0)=^GMR(123,GMRCO,40,ND1,1,ND2,0),GMRCCT=GMRCCT+1
"RTN","GMRCART",120,0)
 . . Q
"RTN","GMRCART",121,0)
 . Q
"RTN","GMRCART",122,0)
 Q
"RTN","GMRCART",123,0)
 ;
"RTN","GMRCART",124,0)
SAVEHDR ;Save the action header info to print later if there are comments
"RTN","GMRCART",125,0)
 S GMRCAHDR=1 ;flag to print action header on first pass of comments
"RTN","GMRCART",126,0)
 ;save the provider, entered by and date
"RTN","GMRCART",127,0)
 S GMRCPROV=$P(^GMR(123,GMRCO,40,ND1,0),"^",4),GMRCENBY=$P(^(0),"^",5)
"RTN","GMRCART",128,0)
 S GMRCENDT=$$FMTE^XLFDT($P($G(^GMR(123,GMRCO,40,ND1,0)),"^",3))
"RTN","GMRCART",129,0)
 Q
"RTN","GMRCART",130,0)
 ;
"RTN","GMRCART",131,0)
GETHDR ;Print the comment header if the action had a comment
"RTN","GMRCART",132,0)
 S @TMPGLOB@(GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCART",133,0)
 S @TMPGLOB@(GMRCCT,0)=$$CENTER^GMRCP5D("("_$P($G(^GMR(123.1,GMRCAIEN,0)),"^",8)_" Comment)"),GMRCCT=GMRCCT+1
"RTN","GMRCART",134,0)
 S @TMPGLOB@(GMRCCT,0)="      Entered by: "_$S($L(GMRCENBY):$P(^VA(200,GMRCENBY,0),"^",1),1:"")_" - "_GMRCENDT,GMRCCT=GMRCCT+1
"RTN","GMRCART",135,0)
 I +GMRCPROV S @TMPGLOB@(GMRCCT,0)="      Responsible Clinician: "_$P($G(^VA(200,GMRCPROV,0)),"^",1),GMRCCT=GMRCCT+1
"RTN","GMRCART",136,0)
 K GMRCAHDR
"RTN","GMRCART",137,0)
 Q
"RTN","GMRCART",138,0)
 ; 
"RTN","GMRCART",139,0)
END ;kill off variables and exit
"RTN","GMRCART",140,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCART",141,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCART",142,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCART",143,0)
 Q
"RTN","GMRCASV1")
0^38^B2709883
"RTN","GMRCASV1",1,0)
GMRCASV1 ;SLC/JFR - HIERARCHY MGMT cont'd ; 02/14/01 14:28
"RTN","GMRCASV1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**18,15**;DEC 27, 1997
"RTN","GMRCASV1",3,0)
 ;
"RTN","GMRCASV1",4,0)
 ; This routine invokes IA #3252
"RTN","GMRCASV1",5,0)
 ;
"RTN","GMRCASV1",6,0)
 Q  ; don't start at the top
"RTN","GMRCASV1",7,0)
GUI(GMRCARR,GMRCSTRT,GMRCWHY,GMRCSYN) ;;return CSLT services for GUI
"RTN","GMRCASV1",8,0)
 ;Input:
"RTN","GMRCASV1",9,0)
 ; GMRCARR - passed in as the array to return results in
"RTN","GMRCASV1",10,0)
 ; GMRCSTRT- service to begin building from
"RTN","GMRCASV1",11,0)
 ; GMRCWHY - 0 for display, 1 for forwarding or ordering
"RTN","GMRCASV1",12,0)
 ; GMRCSYN - Boolean: 1=return synonyms, 0=do not
"RTN","GMRCASV1",13,0)
 ;Output: Array formatted as follows-
"RTN","GMRCASV1",14,0)
 ;      svc ien^svc name or syn^parent^has children^svc usage
"RTN","GMRCASV1",15,0)
 ;
"RTN","GMRCASV1",16,0)
 N GMRCDG,GMRCGRP,GMRCTO
"RTN","GMRCASV1",17,0)
 S GMRCDG=GMRCSTRT,GMRCTO=GMRCWHY
"RTN","GMRCASV1",18,0)
 D SERV1^GMRCASV I '$D(^TMP("GMRCSLIST",$J)) Q
"RTN","GMRCASV1",19,0)
 I '$G(GMRCSYN) M @GMRCARR=^TMP("GMRCSLIST",$J) Q  ;no synonyms needed
"RTN","GMRCASV1",20,0)
 N GMRC,GMRCSVC,GMRCS,NEXT,PIEC
"RTN","GMRCASV1",21,0)
 S GMRC=0,NEXT=$O(^TMP("GMRCSLIST",$J," "),-1)+1
"RTN","GMRCASV1",22,0)
 F  S GMRC=$O(^TMP("GMRCSLIST",$J,GMRC)) Q:'GMRC  Q:$P(^TMP("GMRCSLIST",$J,GMRC),U,5)="S"  D
"RTN","GMRCASV1",23,0)
 . I $P(^TMP("GMRCSLIST",$J,GMRC),U,5)=1 Q
"RTN","GMRCASV1",24,0)
 . S GMRCSVC=+^TMP("GMRCSLIST",$J,GMRC)
"RTN","GMRCASV1",25,0)
 . S GMRCS=0
"RTN","GMRCASV1",26,0)
 . F  S GMRCS=$O(^GMR(123.5,GMRCSVC,2,GMRCS)) Q:'GMRCS  D
"RTN","GMRCASV1",27,0)
 .. S PIEC(1)=GMRCSVC
"RTN","GMRCASV1",28,0)
 .. S PIEC(2)=$P(^GMR(123.5,GMRCSVC,0),U)
"RTN","GMRCASV1",29,0)
 .. S PIEC(2)=^GMR(123.5,GMRCSVC,2,GMRCS,0)_"  <"_PIEC(2)_">"
"RTN","GMRCASV1",30,0)
 .. S ^TMP("GMRCSLIST",$J,NEXT)=PIEC(1)_"^"_PIEC(2)_"^^^S"
"RTN","GMRCASV1",31,0)
 .. S NEXT=NEXT+1
"RTN","GMRCASV1",32,0)
 .. Q
"RTN","GMRCASV1",33,0)
 . Q
"RTN","GMRCASV1",34,0)
 M @GMRCARR=^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",35,0)
 K ^TMP("GMRCSLIST",$J)
"RTN","GMRCASV1",36,0)
 Q
"RTN","GMRCAU")
0^5^B51325271
"RTN","GMRCAU",1,0)
GMRCAU ;SLC/DLT,JFR - Action Utilities  ;9/8/98  03:33
"RTN","GMRCAU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,11,14,12,15**;DEC 27, 1997
"RTN","GMRCAU",3,0)
 ;
"RTN","GMRCAU",4,0)
 ; This routine invokes IA #2324,#2692
"RTN","GMRCAU",5,0)
 ;
"RTN","GMRCAU",6,0)
GETPROV K GMRCORNP N DIR S DIR(0)="123.02,3"
"RTN","GMRCAU",7,0)
 S DIR("A")=$S($D(GETPROV):GETPROV,1:"Responsible Clinician")
"RTN","GMRCAU",8,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!(X="^") S GMRCQIT="Q" Q
"RTN","GMRCAU",9,0)
 G:Y<1 GETPROV S GMRCORNP=+Y
"RTN","GMRCAU",10,0)
 Q
"RTN","GMRCAU",11,0)
GETDT ;Get actual activity date
"RTN","GMRCAU",12,0)
 K GMRCQIT,%
"RTN","GMRCAU",13,0)
 D NOW^%DTC S (X,GMRCDT)=% D REGDTM^GMRCU S GMRCAD=X
"RTN","GMRCAU",14,0)
 S DIR(0)="123.02,2",DIR("A")=$S($D(GETDT):GETDT,1:"Date/Time of Actual Activity"),DIR("B")="NOW" D ^DIR K DIR I $D(DIRUT) S GMRCQIT="Q" Q
"RTN","GMRCAU",15,0)
 I X="NOW" K GMRCAD,Y Q
"RTN","GMRCAU",16,0)
 S GMRCAD=Y K X,Y,DIRUT,DUOUT
"RTN","GMRCAU",17,0)
 Q
"RTN","GMRCAU",18,0)
ORTX(GMRCO) ;Get the abbreviated text for alert displays
"RTN","GMRCAU",19,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",20,0)
 N GMRCSVC,GMRCSSNM,GMRCPROC,GMRCORTX
"RTN","GMRCAU",21,0)
 S GMRCSSNM=$$SVC(GMRCO)
"RTN","GMRCAU",22,0)
 S GMRCPROC=$$PROC(GMRCO)
"RTN","GMRCAU",23,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",24,0)
 Q GMRCORTX
"RTN","GMRCAU",25,0)
 ;
"RTN","GMRCAU",26,0)
SVC(GMRCO) ;Get abbreviated service text
"RTN","GMRCAU",27,0)
 N GMRCSSNM,GMRCSVC
"RTN","GMRCAU",28,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCAU",29,0)
 I +GMRCSVC S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCAU",30,0)
 Q GMRCSSNM
"RTN","GMRCAU",31,0)
PROC(GMRCO) ;Get abbreviated procedure text
"RTN","GMRCAU",32,0)
 N GMRCPROC
"RTN","GMRCAU",33,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAU",34,0)
 I +GMRCPROC S GMRCPROC=$$GET1^DIQ(123.3,+GMRCPROC,.01)
"RTN","GMRCAU",35,0)
 Q GMRCPROC
"RTN","GMRCAU",36,0)
 ;
"RTN","GMRCAU",37,0)
LMTX(GMRCO) ;Get the text for list manager displays
"RTN","GMRCAU",38,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",39,0)
 N GMRCSVC,GMRCSSNM,GMRCREQ,GMRCORTX
"RTN","GMRCAU",40,0)
 S GMRCSSNM=$$SVC(GMRCO)
"RTN","GMRCAU",41,0)
 S GMRCREQ=$$PROC(GMRCO)
"RTN","GMRCAU",42,0)
 S GMRCORTX=$S($L(GMRCREQ):($E(GMRCSSNM,1,10)_" "_$E(GMRCREQ,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",43,0)
 Q GMRCORTX
"RTN","GMRCAU",44,0)
 ;
"RTN","GMRCAU",45,0)
 ;
"RTN","GMRCAU",46,0)
VALID(GMRCSER,GMRCO,GMRCUSER,GMRCTST) ;Get users update authority
"RTN","GMRCAU",47,0)
 ; check GMRCSS and all parents for authority
"RTN","GMRCAU",48,0)
 ; codes returned are same as $$VALIDU
"RTN","GMRCAU",49,0)
 N GMRCUPDL,GMRCLIS,GMRCHKD,GMRCNT,GMRCLP,GMRCQUIT
"RTN","GMRCAU",50,0)
 I '$G(GMRCUSER) S GMRCUSER=DUZ
"RTN","GMRCAU",51,0)
 ; check initial service first
"RTN","GMRCAU",52,0)
 S GMRCUPDL=$$VALIDU(GMRCSER,GMRCUSER) I +GMRCUPDL D  G VALEX
"RTN","GMRCAU",53,0)
 . I $G(GMRCTST) S $P(GMRCUPDL,U,3)=$P($G(^GMR(123.5,+GMRCSER,0)),U)
"RTN","GMRCAU",54,0)
 S GMRCHKD(GMRCSER)="",GMRCNT=1
"RTN","GMRCAU",55,0)
 ; find parents if set to process, quit if none
"RTN","GMRCAU",56,0)
 I '$P($G(^GMR(123.5,+GMRCSER,0)),U,7) G VALEX ;process parents = 0
"RTN","GMRCAU",57,0)
 D FINDPAR(GMRCSER,.GMRCNT) I '$D(GMRCLIS) S GMRCUPDL=0 G VALEX
"RTN","GMRCAU",58,0)
 S GMRCLP=0
"RTN","GMRCAU",59,0)
 F  S GMRCLP=$O(GMRCLIS(GMRCLP)) Q:'GMRCLP!($D(GMRCQUIT))  D  I +GMRCUPDL G VALEX
"RTN","GMRCAU",60,0)
 . I +$P(GMRCLIS(GMRCLP),U,2) K GMRCLIS(GMRCLP) Q  ;been checked
"RTN","GMRCAU",61,0)
 . I '$D(GMRCHKD(+GMRCLIS(GMRCLP))) D
"RTN","GMRCAU",62,0)
 .. ; check parent 
"RTN","GMRCAU",63,0)
 .. S GMRCUPDL=$$VALIDU(+GMRCLIS(GMRCLP),GMRCUSER)
"RTN","GMRCAU",64,0)
 .. S GMRCHKD(+GMRCLIS(GMRCLP))=""
"RTN","GMRCAU",65,0)
 . S $P(GMRCLIS(GMRCLP),U,2)=1
"RTN","GMRCAU",66,0)
 . I +GMRCUPDL D  Q  ;got one
"RTN","GMRCAU",67,0)
 .. S:$G(GMRCTST) $P(GMRCUPDL,U,3)=$P($G(^GMR(123.5,+GMRCLIS(GMRCLP),0)),U)
"RTN","GMRCAU",68,0)
 . I $P(^GMR(123.5,+GMRCLIS(GMRCLP),0),U,7) D  ;process parents
"RTN","GMRCAU",69,0)
 .. D FINDPAR(+GMRCLIS(GMRCLP),.GMRCNT)
"RTN","GMRCAU",70,0)
 . S GMRCLP=0 ;start back at top and don't miss any
"RTN","GMRCAU",71,0)
VALEX Q GMRCUPDL
"RTN","GMRCAU",72,0)
FINDPAR(SERV,ARCNT)     ;find parents of SERV
"RTN","GMRCAU",73,0)
 ; SERV = service to find parents of
"RTN","GMRCAU",74,0)
 ; ARCNT = next array element
"RTN","GMRCAU",75,0)
 N PARENT
"RTN","GMRCAU",76,0)
 S PARENT=0
"RTN","GMRCAU",77,0)
 F  S PARENT=$O(^GMR(123.5,"APC",SERV,PARENT)) Q:'PARENT  D
"RTN","GMRCAU",78,0)
 . S GMRCLIS(ARCNT)=PARENT
"RTN","GMRCAU",79,0)
 . S ARCNT=ARCNT+1
"RTN","GMRCAU",80,0)
 Q
"RTN","GMRCAU",81,0)
 ;
"RTN","GMRCAU",82,0)
VALIDU(GMRCSS,GMRCUSR) ;Check to see if user is an update user
"RTN","GMRCAU",83,0)
 ;The value returned is the equivalent of this set of codes:
"RTN","GMRCAU",84,0)
 ;    0 = not an update user
"RTN","GMRCAU",85,0)
 ;    2 = update user
"RTN","GMRCAU",86,0)
 ;    3 = administrative update user
"RTN","GMRCAU",87,0)
 N GMRCUPD
"RTN","GMRCAU",88,0)
 I '$G(GMRCUSR) S GMRCUSR=DUZ
"RTN","GMRCAU",89,0)
 I '+$G(GMRCSS) Q 0
"RTN","GMRCAU",90,0)
 I +$P($G(^GMR(123.5,GMRCSS,0)),U,6) Q 2_$$FIELD(.06)
"RTN","GMRCAU",91,0)
 I $D(^GMR(123.5,+GMRCSS,123.3,"B",GMRCUSR)) Q 2_$$FIELD(123.3)
"RTN","GMRCAU",92,0)
 I GMRCUSR=$P($G(^GMR(123.5,+GMRCSS,123)),"^",8) Q 2_$$FIELD(123.08)
"RTN","GMRCAU",93,0)
 I $D(^GMR(123.5,+GMRCSS,123.33,"B",GMRCUSR)) Q 3_$$FIELD(123.33)
"RTN","GMRCAU",94,0)
 ;
"RTN","GMRCAU",95,0)
 S GMRCUPD=0
"RTN","GMRCAU",96,0)
 ; check service teams to notify, update teams w/o and admin teams w/o
"RTN","GMRCAU",97,0)
 N NODE F NODE=123.1,123.31,123.34 D  I +GMRCUPD Q
"RTN","GMRCAU",98,0)
 . I '$D(^GMR(123.5,+GMRCSS,NODE)) Q
"RTN","GMRCAU",99,0)
 . D TEAM(.GMRCUPD,NODE,GMRCUSR)
"RTN","GMRCAU",100,0)
 I +GMRCUPD Q GMRCUPD
"RTN","GMRCAU",101,0)
 ;
"RTN","GMRCAU",102,0)
 ; check ASU user classes in field 123.35
"RTN","GMRCAU",103,0)
 S GMRCUPD=$$USR(GMRCSS,GMRCUSR)
"RTN","GMRCAU",104,0)
 I +GMRCUPD Q GMRCUPD
"RTN","GMRCAU",105,0)
 ;
"RTN","GMRCAU",106,0)
 I $D(^GMR(123.5,+GMRCSS,123.2)) D LOC(.GMRCUPD) Q:+GMRCUPD GMRCUPD
"RTN","GMRCAU",107,0)
 Q 0
"RTN","GMRCAU",108,0)
 ;
"RTN","GMRCAU",109,0)
LOC(GMRCUPD) ;Check for the DUZ in the NOTIFICATION BY PT LOCATION multiple
"RTN","GMRCAU",110,0)
 N GMRCL,GMRCTM
"RTN","GMRCAU",111,0)
 S GMRCL=0 ;Check if DUZ is associated with any location/ward
"RTN","GMRCAU",112,0)
 F  S GMRCL=$O(^GMR(123.5,+GMRCSS,123.2,GMRCL))  Q:'GMRCL!+GMRCUPD  D  Q:+GMRCUPD
"RTN","GMRCAU",113,0)
 . ;Get user and/or team assigned to location
"RTN","GMRCAU",114,0)
 . S GMRCL(0)=$G(^GMR(123.5,+GMRCSS,123.2,+GMRCL,0))
"RTN","GMRCAU",115,0)
 . I $P(GMRCL(0),"^",2)=DUZ S GMRCUPD=2 Q
"RTN","GMRCAU",116,0)
 . I $P(GMRCL(0),"^",3) S GMRCTM=$P(GMRCL(0),"^",3) ;D CHKTM
"RTN","GMRCAU",117,0)
 Q
"RTN","GMRCAU",118,0)
 ;
"RTN","GMRCAU",119,0)
TEAM(TYPE,SUBSC,USER) ;Check for the DUZ in the multiple of SUBSC
"RTN","GMRCAU",120,0)
 N GMRCTM,GMRCHIT
"RTN","GMRCAU",121,0)
 S GMRCTM=""
"RTN","GMRCAU",122,0)
 I '$G(USER) S USER=DUZ
"RTN","GMRCAU",123,0)
 F  S GMRCTM=$O(^GMR(123.5,GMRCSS,SUBSC,"B",GMRCTM)) Q:'GMRCTM!+TYPE  D
"RTN","GMRCAU",124,0)
 . S GMRCHIT=$$CHKTM(GMRCTM,USER) Q:'GMRCHIT
"RTN","GMRCAU",125,0)
 . S TYPE=$S(SUBSC=123.34:3,1:2)_$$FIELD(SUBSC)
"RTN","GMRCAU",126,0)
 Q
"RTN","GMRCAU",127,0)
 ;
"RTN","GMRCAU",128,0)
CHKTM(TEAM,PERS) ;checks for PERS in list of users on TEAM
"RTN","GMRCAU",129,0)
 ;Input:  TEAM must be set to the Order Team entry number
"RTN","GMRCAU",130,0)
 ;Output: 1 will be returned PERS is on TEAM
"RTN","GMRCAU",131,0)
 N ND,GMRCLST,FOUND
"RTN","GMRCAU",132,0)
 S GMRCLST=""
"RTN","GMRCAU",133,0)
 D TEAMPROV^ORQPTQ1(.GMRCLST,TEAM)
"RTN","GMRCAU",134,0)
 I $P(GMRCLST(1),"^",2)="No providers found." Q 0
"RTN","GMRCAU",135,0)
 S ND=0
"RTN","GMRCAU",136,0)
 F  S ND=$O(GMRCLST(ND)) Q:ND=""  I +GMRCLST(ND)=PERS S FOUND=1 Q
"RTN","GMRCAU",137,0)
 Q $S($G(FOUND):1,1:0)
"RTN","GMRCAU",138,0)
 ;
"RTN","GMRCAU",139,0)
USR(SERV,USER) ; check USR classes for user
"RTN","GMRCAU",140,0)
 N UCLS,UPD
"RTN","GMRCAU",141,0)
 I '$O(^GMR(123.5,+SERV,123.35,0)) Q 0
"RTN","GMRCAU",142,0)
 S UCLS=0,UPD=0
"RTN","GMRCAU",143,0)
 F  S UCLS=$O(^GMR(123.5,+SERV,123.35,"B",UCLS)) Q:'UCLS!(+UPD)  D
"RTN","GMRCAU",144,0)
 . Q:'UCLS
"RTN","GMRCAU",145,0)
 . S UPD=$$ISA^USRLM(USER,UCLS)
"RTN","GMRCAU",146,0)
 . I +UPD S UPD=2_$$FIELD(123.35)
"RTN","GMRCAU",147,0)
 . Q
"RTN","GMRCAU",148,0)
 Q UPD
"RTN","GMRCAU",149,0)
FIELD(GMRCFLD) ;return field name where became update user
"RTN","GMRCAU",150,0)
 I '$G(GMRCTST) Q ""
"RTN","GMRCAU",151,0)
 D FIELD^DID(123.5,GMRCFLD,,"LABEL","GMRCFLD")
"RTN","GMRCAU",152,0)
 Q "^"_$G(GMRCFLD("LABEL"))
"RTN","GMRCAU",153,0)
COMPLETE(GMRCA) ;Determine if the action is a complete action (10,13,14)
"RTN","GMRCAU",154,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",155,0)
 Q $S(GMRCA=13:1,GMRCA=14:1,GMRCA=10:1,1:0)
"RTN","GMRCAU",156,0)
 ;   10=administrative complete, 13=ADDENDUM ADDED, 14=New Note
"RTN","GMRCAU",157,0)
 ;
"RTN","GMRCAU",158,0)
RESOLUA(GMRCA) ;Determine if action has resolution info for clinician
"RTN","GMRCAU",159,0)
 ;Action value is based on value in ^ORD(100.01,"
"RTN","GMRCAU",160,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",161,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",162,0)
 Q $S(GMRCA=4:1,GMRCA=6:1,GMRCA=10:1,GMRCA=11:1,GMRCA=12:1,GMRCA=13:1,GMRCA=14:1,GMRCA=19:1,1:0)
"RTN","GMRCAU",163,0)
 ;    4=Sig Findings, 6=discontinued, 10=administrative complete
"RTN","GMRCAU",164,0)
 ;    11=Edit/resubmit
"RTN","GMRCAU",165,0)
 ;    12=Disassociate result, 13=Addendum Added, 14=New Note
"RTN","GMRCAU",166,0)
 ;    19=cancelled
"RTN","GMRCAU",167,0)
 ;
"RTN","GMRCAU",168,0)
RESOLUS(GMRCSTS) ;Determine status indicates the consult has a resolution
"RTN","GMRCAU",169,0)
 ;Status value is based on values in ^ORD(100.01,"
"RTN","GMRCAU",170,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",171,0)
 S GMRCSTS=$G(GMRCSTS)
"RTN","GMRCAU",172,0)
 Q $S(GMRCSTS:1,GMRCSTS=2:1,GMRCSTS=13:1,1:0)
"RTN","GMRCAU",173,0)
 ;    1=dc,2=comp,13=canc
"RTN","GMRCAU",174,0)
 ;
"RTN","GMRCAU",175,0)
TEST ;called from GMRC UPDATE AUTHORITY
"RTN","GMRCAU",176,0)
 ; determines how a user gets update authority for a service 
"RTN","GMRCAU",177,0)
 W !
"RTN","GMRCAU",178,0)
 N GMRCSRV,GMRCUSR,UPD,GMRCDG,GMRC1
"RTN","GMRCAU",179,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","GMRCAU",180,0)
 S DIR(0)="PO^123.5:EM",DIR("A")="Select Consult Service"
"RTN","GMRCAU",181,0)
 S DIR("?")="Choose the consult service to check update status of user"
"RTN","GMRCAU",182,0)
 S DIR("??")="^D TESTHELP^GMRCAU(""ALL SERVICES"")" D ^DIR
"RTN","GMRCAU",183,0)
 I $D(DIRUT) Q
"RTN","GMRCAU",184,0)
 S GMRCSRV=+Y
"RTN","GMRCAU",185,0)
 N DIR
"RTN","GMRCAU",186,0)
 S DIR(0)="PO^200:EM",DIR("A")="Choose user to check for update status"
"RTN","GMRCAU",187,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCAU",188,0)
 S GMRCUSR=+Y
"RTN","GMRCAU",189,0)
 S UPD=$$VALID(GMRCSRV,,GMRCUSR,1)
"RTN","GMRCAU",190,0)
 I +UPD=0 W !!,"This user has no update authority"
"RTN","GMRCAU",191,0)
 I +UPD D
"RTN","GMRCAU",192,0)
 . I +UPD=2 W !!,"This user is an update user for: ",$P(UPD,U,3)
"RTN","GMRCAU",193,0)
 . I +UPD=3 W !!,"This user is an administrative user for: ",$P(UPD,U,3)
"RTN","GMRCAU",194,0)
 . W !,"via the ",$P(UPD,U,2)," field."
"RTN","GMRCAU",195,0)
 . W ! I $L($P(UPD,U,3)) D
"RTN","GMRCAU",196,0)
 .. I $P(UPD,U,3)'=$P(^GMR(123.5,+GMRCSRV,0),U) D HIER^GMRCT($P(UPD,U,3))
"RTN","GMRCAU",197,0)
 W !!
"RTN","GMRCAU",198,0)
 K GMRCSRV,GMRCUSR,UPD
"RTN","GMRCAU",199,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","GMRCAU",200,0)
 G TEST
"RTN","GMRCAU",201,0)
TESTHELP(GMRCSVNM) ;wrapper for LISTSRV^GMRCASV
"RTN","GMRCAU",202,0)
 N DIR,GMRC1,GMRCDG
"RTN","GMRCAU",203,0)
 D LISTSRV^GMRCASV
"RTN","GMRCAU",204,0)
 Q
"RTN","GMRCAU",205,0)
TSTINTRO ;entry action of GMRC UPDATE AUTHORITY option
"RTN","GMRCAU",206,0)
 W !!,"This option will allow you to check a user's update authority for any given"
"RTN","GMRCAU",207,0)
 W !,"service in the consults hierarchy.  If the PROCESS PARENTS FOR UPDATES field"
"RTN","GMRCAU",208,0)
 W !,"is set to YES, all ancestors of the selected service will be checked."
"RTN","GMRCAU",209,0)
 W !,"The type of update authority and the service to which they are assigned will"
"RTN","GMRCAU",210,0)
 W !,"be displayed.",!!
"RTN","GMRCAU",211,0)
 Q
"RTN","GMRCDIS")
0^7^B31159012
"RTN","GMRCDIS",1,0)
GMRCDIS ;SLC/JFR - LM ROUTINE TO DISASSOCIATE MED RESULTS; 4/4/00 11:20
"RTN","GMRCDIS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15**;DEC 27, 1997
"RTN","GMRCDIS",3,0)
 ;
"RTN","GMRCDIS",4,0)
 ; This routine invokes IA #2324,#3042,#3120
"RTN","GMRCDIS",5,0)
 ;
"RTN","GMRCDIS",6,0)
EN ;invoke list template
"RTN","GMRCDIS",7,0)
 D EN^VALM("GMRC DISASSOC RESULTS")
"RTN","GMRCDIS",8,0)
 Q
"RTN","GMRCDIS",9,0)
HDR ;format list template header
"RTN","GMRCDIS",10,0)
 N GMRCVTIT
"RTN","GMRCDIS",11,0)
 S GMRCVTIT="Procedure/Medicine Resulting"
"RTN","GMRCDIS",12,0)
 D HDR^GMRCSLDT
"RTN","GMRCDIS",13,0)
 S VALMHDR(2)="Consult No.: "_GMRCO
"RTN","GMRCDIS",14,0)
 S VALMHDR(2)=$$SETSTR^VALM1("Associated Medicine Results",VALMHDR(2),30,28)
"RTN","GMRCDIS",15,0)
 Q
"RTN","GMRCDIS",16,0)
PHDR    ;set protocols into actions
"RTN","GMRCDIS",17,0)
 S VALMSG=$$CJ^XLFSTR("Select action or item number    ?? for help",80)
"RTN","GMRCDIS",18,0)
 S XQORM("M")=3
"RTN","GMRCDIS",19,0)
 D SHOW^VALM
"RTN","GMRCDIS",20,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRCACT SELECT MED RESULT",0))_"^1:"_VALMCNT
"RTN","GMRCDIS",21,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCDIS",22,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCDIS",23,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCDIS",24,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCDIS",25,0)
 S XQORM("KEY","DM")=$O(^ORD(101,"B","GMRCACT DISASSOC MED RSLT",0))_"^1"
"RTN","GMRCDIS",26,0)
 S XQORM("KEY","DR")=$O(^ORD(101,"B","GMRCACT DISPLAY MED RESULT",0))_"^1"
"RTN","GMRCDIS",27,0)
 Q
"RTN","GMRCDIS",28,0)
INIT ; set up array into ^TMP("GMRCR",$J,"DT"...
"RTN","GMRCDIS",29,0)
 ; should already have it
"RTN","GMRCDIS",30,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",999999),-1),VALMBG=1
"RTN","GMRCDIS",31,0)
 Q
"RTN","GMRCDIS",32,0)
GETRES(GMRCO) ; get associated MEDICINE results and format
"RTN","GMRCDIS",33,0)
 N RES,GMRCMCR,CNT,DATA
"RTN","GMRCDIS",34,0)
 S RES=0,CNT=1
"RTN","GMRCDIS",35,0)
 F  S RES=$O(^GMR(123,GMRCO,50,RES)) Q:'RES  D
"RTN","GMRCDIS",36,0)
 . I $G(^GMR(123,GMRCO,50,RES,0))'["MCAR" Q
"RTN","GMRCDIS",37,0)
 . S GMRCMCR=$$SINGLE^MCAPI(^GMR(123,GMRCO,50,RES,0))
"RTN","GMRCDIS",38,0)
 . S DATA=""
"RTN","GMRCDIS",39,0)
 . S DATA=$$SETSTR^VALM1(CNT,DATA,2,$L(CNT))
"RTN","GMRCDIS",40,0)
 . S DATA=$$SETSTR^VALM1($P(GMRCMCR,U),DATA,6,23)
"RTN","GMRCDIS",41,0)
 . S DATA=$$SETSTR^VALM1($P(GMRCMCR,U,6),DATA,30,$L($P(GMRCMCR,U,6)))
"RTN","GMRCDIS",42,0)
 . S DATA=$$SETSTR^VALM1($P(GMRCMCR,U,7),DATA,50,$L($P(GMRCMCR,U,7)))
"RTN","GMRCDIS",43,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,0)=DATA
"RTN","GMRCDIS",44,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,1)=^GMR(123,GMRCO,50,RES,0)
"RTN","GMRCDIS",45,0)
 . S CNT=CNT+1
"RTN","GMRCDIS",46,0)
 Q
"RTN","GMRCDIS",47,0)
DIS(GMRCO) ;select consult and start disassoc process
"RTN","GMRCDIS",48,0)
 N GMRCQUT,GMRCQIT,GMRCSS,GMRCMSG
"RTN","GMRCDIS",49,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCDIS",50,0)
 I '+$G(GMRCO) Q
"RTN","GMRCDIS",51,0)
 I '$$LOCK^GMRCA1(GMRCO) Q
"RTN","GMRCDIS",52,0)
 S GMRCMSG=$$REMUSR(GMRCO,DUZ) I '+GMRCMSG D  Q
"RTN","GMRCDIS",53,0)
 . N MSG
"RTN","GMRCDIS",54,0)
 . I '$L($P(GMRCMSG,U,2)) D
"RTN","GMRCDIS",55,0)
 .. S MSG="You are not authorized to disassociate results."
"RTN","GMRCDIS",56,0)
 . D EXAC^GMRCADC($S($D(MSG):MSG,1:$P(GMRCMSG,U,2)))
"RTN","GMRCDIS",57,0)
 D GETRES(GMRCO)
"RTN","GMRCDIS",58,0)
 D EN
"RTN","GMRCDIS",59,0)
 D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCDIS",60,0)
 Q
"RTN","GMRCDIS",61,0)
EXIT ;
"RTN","GMRCDIS",62,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCDIS",63,0)
 Q
"RTN","GMRCDIS",64,0)
EN1(GMRCRSLT) ; select result and verify remove action
"RTN","GMRCDIS",65,0)
 I '+$G(^TMP("GMRCR",$J,"DT",1,1)) D  Q  ;no result there
"RTN","GMRCDIS",66,0)
 . D EXAC^GMRCADC("There are no results to remove")
"RTN","GMRCDIS",67,0)
 N RESTXT,RESULT,DIR,X,Y,DUOUT,DTOUT,DIROUT
"RTN","GMRCDIS",68,0)
 I '$G(ITEM),'$G(GMRCMEDR) D  Q:'ITEM
"RTN","GMRCDIS",69,0)
 . S ITEM=$$SELECT^GMRCMED(VALMCNT)
"RTN","GMRCDIS",70,0)
 . D SET^GMRCMED(ITEM)
"RTN","GMRCDIS",71,0)
 I $G(GMRCMEDR) S ITEM=GMRCMEDR
"RTN","GMRCDIS",72,0)
 D FULL^VALM1
"RTN","GMRCDIS",73,0)
 S RESTXT=$E(^TMP("GMRCR",$J,"DT",ITEM,0),6,80)
"RTN","GMRCDIS",74,0)
 S RESULT=^TMP("GMRCR",$J,"DT",ITEM,1) Q:'+RESULT
"RTN","GMRCDIS",75,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","GMRCDIS",76,0)
 S DIR("A",1)="",DIR("A",2)="   "_RESTXT,DIR("A",3)=""
"RTN","GMRCDIS",77,0)
 S DIR("A")="Are you sure you want to disassociate this result? "
"RTN","GMRCDIS",78,0)
 D ^DIR I Y<1 Q
"RTN","GMRCDIS",79,0)
 D REMOVE(GMRCO,RESULT)
"RTN","GMRCDIS",80,0)
 Q
"RTN","GMRCDIS",81,0)
REMOVE(GMRCO,RSLT,GMRCAD,GMRCORNP) ;disassociate result
"RTN","GMRCDIS",82,0)
 ; remove rslt, log actv, update sts, send alerts
"RTN","GMRCDIS",83,0)
 ; Input:
"RTN","GMRCDIS",84,0)
 ;  GMRCO    - ien from file 123
"RTN","GMRCDIS",85,0)
 ;  RSLT     - medicine result in var ptr form (e.g. "19;MCAR(691.5,")
"RTN","GMRCDIS",86,0)
 ;  GMRCAD   - FM date/time of action (optional)
"RTN","GMRCDIS",87,0)
 ;  GMRCORNP - DUZ of person performing action  (optional) 
"RTN","GMRCDIS",88,0)
 ;
"RTN","GMRCDIS",89,0)
 N GMRCRES,DIK,DA,GMRCQUT,GMRCQIT
"RTN","GMRCDIS",90,0)
 S GMRCRES=$O(^GMR(123,+GMRCO,50,"B",RSLT,0)) I 'GMRCRES D  Q
"RTN","GMRCDIS",91,0)
 . D EXAC^GMRCADC("This result is no longer associated with the request")
"RTN","GMRCDIS",92,0)
 ; delete result entry
"RTN","GMRCDIS",93,0)
 S DA(1)=+GMRCO,DA=GMRCRES,DIK="^GMR(123,"_DA(1)_",50," D ^DIK
"RTN","GMRCDIS",94,0)
 I $P(^GMR(123,+GMRCO,0),U,15)=RSLT D
"RTN","GMRCDIS",95,0)
 . N DA,DIE,DR
"RTN","GMRCDIS",96,0)
 . S DIE="^GMR(123,",DA=+GMRCO,DR="11///@" D ^DIE
"RTN","GMRCDIS",97,0)
 ; update activity tracking
"RTN","GMRCDIS",98,0)
 N GMRCA,GMRCRSLT
"RTN","GMRCDIS",99,0)
 S GMRCA=12,GMRCRSLT=RSLT
"RTN","GMRCDIS",100,0)
 D AUDIT^GMRCP
"RTN","GMRCDIS",101,0)
 ; Update status back to active if not completed before
"RTN","GMRCDIS",102,0)
 N GMRCDFN,GMRCTYP
"RTN","GMRCDIS",103,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCDIS",104,0)
 I $$STSCHG(GMRCO) D
"RTN","GMRCDIS",105,0)
 . N GMRCSTS
"RTN","GMRCDIS",106,0)
 . S GMRCSTS=6 D STATUS^GMRCP
"RTN","GMRCDIS",107,0)
 . ; update CPRS
"RTN","GMRCDIS",108,0)
 . S GMRCTYP=$P(^GMR(123,+GMRCO,0),U,17)
"RTN","GMRCDIS",109,0)
 . D EN^GMRCHL7(GMRCDFN,+GMRCO,GMRCTYP,"","SC",$G(GMRCORNP),"")
"RTN","GMRCDIS",110,0)
 ; send notification?
"RTN","GMRCDIS",111,0)
 I '$G(GMRCORNP) S GMRCORNP=DUZ
"RTN","GMRCDIS",112,0)
 I GMRCORNP'=$P(^GMR(123,+GMRCO,0),U,14) D
"RTN","GMRCDIS",113,0)
 . Q:'$P(^GMR(123,+GMRCO,0),U,14)
"RTN","GMRCDIS",114,0)
 . N GMRCADUZ,GMRCORTX
"RTN","GMRCDIS",115,0)
 . S GMRCADUZ($P(^GMR(123,+GMRCO,0),U,14))=""
"RTN","GMRCDIS",116,0)
 . S GMRCORTX="Result removed from "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCDIS",117,0)
 . D MSG^GMRCP(GMRCDFN,GMRCORTX,GMRCO,27,.GMRCADUZ,0)
"RTN","GMRCDIS",118,0)
 Q
"RTN","GMRCDIS",119,0)
 ;
"RTN","GMRCDIS",120,0)
STSCHG(GMRCIEN) ;completed before or go back
"RTN","GMRCDIS",121,0)
 I $O(^GMR(123,GMRCIEN,50,0)) Q 0 ;still at least one result
"RTN","GMRCDIS",122,0)
 N CHG,ACT,I S ACT=0,CHG=1,I=0
"RTN","GMRCDIS",123,0)
 F  S I=$O(^GMR(123,GMRCIEN,40,I)) Q:'I  S ACT=^(I,0) D
"RTN","GMRCDIS",124,0)
 . I $P(ACT,U,2)=10,'$L($P(ACT,U,9)) S CHG=0 ; admin completed before
"RTN","GMRCDIS",125,0)
 . Q
"RTN","GMRCDIS",126,0)
 Q CHG
"RTN","GMRCDIS",127,0)
 ;
"RTN","GMRCDIS",128,0)
REFRESH(GMRCIEN) ;re-build list of associated results
"RTN","GMRCDIS",129,0)
 I $G(GMRCMEDR) D RESETIT^GMRCMED(GMRCMEDR)
"RTN","GMRCDIS",130,0)
 K ^TMP("GMRCR",$J,"DT"),GMRCMEDR
"RTN","GMRCDIS",131,0)
 D GETRES(GMRCIEN)
"RTN","GMRCDIS",132,0)
 I '$O(^TMP("GMRCR",$J,"DT",0)) D
"RTN","GMRCDIS",133,0)
 . S ^TMP("GMRCR",$J,"DT",1,0)="No further results to disassociate"
"RTN","GMRCDIS",134,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",""),-1)
"RTN","GMRCDIS",135,0)
 S VALMBCK="R"
"RTN","GMRCDIS",136,0)
 Q
"RTN","GMRCDIS",137,0)
REMUSR(GMRCIEN,USER) ; check to see if user is authorized to remove results
"RTN","GMRCDIS",138,0)
 N GMRCSS,GMRCCLS,RES
"RTN","GMRCDIS",139,0)
 I '+$P($G(^GMR(123,GMRCIEN,0)),U,8) Q 0
"RTN","GMRCDIS",140,0)
 S GMRCSS=$P(^GMR(123,GMRCIEN,0),U,5) I 'GMRCSS Q 0  ;no service
"RTN","GMRCDIS",141,0)
 S GMRCCLS=$P($G(^GMR(123.5,GMRCSS,1)),U,6) I 'GMRCCLS Q 0  ;no class
"RTN","GMRCDIS",142,0)
 I '$O(^GMR(123,GMRCIEN,50,0)) Q "0^There are no results associated with this request." ;no results to remove
"RTN","GMRCDIS",143,0)
 S RES=""
"RTN","GMRCDIS",144,0)
 F  S RES=$O(^GMR(123,GMRCIEN,50,"B",RES)) Q:RES=""  Q:RES["MCAR"
"RTN","GMRCDIS",145,0)
 I RES="" Q "0^There are no Medicine results associated with this request." ;no med results
"RTN","GMRCDIS",146,0)
 I '$G(USER) S USER=DUZ
"RTN","GMRCDIS",147,0)
 I $$ISA^USRLM(USER,GMRCCLS) Q 1  ;part of USR CLASS in fld 1.06
"RTN","GMRCDIS",148,0)
 Q 0
"RTN","GMRCDRFR")
0^36^B9430906
"RTN","GMRCDRFR",1,0)
GMRCDRFR ;SLC/JFR - DEFAULT REASON FOR REQUEST UTILS ; 11/12/00 12:00
"RTN","GMRCDRFR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**12,15**;DEC 27, 1997
"RTN","GMRCDRFR",3,0)
 ;
"RTN","GMRCDRFR",4,0)
 ; This routine invokes IA #2876
"RTN","GMRCDRFR",5,0)
 ;
"RTN","GMRCDRFR",6,0)
EN ; -- main entry point for GMRC DEFAULT REASON
"RTN","GMRCDRFR",7,0)
 N GMRCSV,GMRCDFN,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT
"RTN","GMRCDRFR",8,0)
 S DIR(0)="SOA^S:service;P:procedure"
"RTN","GMRCDRFR",9,0)
 S DIR("A")="Test default for service or procedure? "
"RTN","GMRCDRFR",10,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCDRFR",11,0)
 I Y="S" D SELSS Q:'$D(GMRCSV)
"RTN","GMRCDRFR",12,0)
 I Y="P" D SELPROC Q:'$D(GMRCPROC)
"RTN","GMRCDRFR",13,0)
 D SELPT Q:'$D(GMRCPAT)
"RTN","GMRCDRFR",14,0)
 D INIT
"RTN","GMRCDRFR",15,0)
 D EN^VALM("GMRC DEFAULT REASON")
"RTN","GMRCDRFR",16,0)
 Q
"RTN","GMRCDRFR",17,0)
 ;
"RTN","GMRCDRFR",18,0)
SELPT ;get new patient 
"RTN","GMRCDRFR",19,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT
"RTN","GMRCDRFR",20,0)
 D FULL^VALM1
"RTN","GMRCDRFR",21,0)
 S DIR(0)="PO^2:EQM" D ^DIR
"RTN","GMRCDRFR",22,0)
 I $D(DIRUT) Q
"RTN","GMRCDRFR",23,0)
 S GMRCPAT=+Y
"RTN","GMRCDRFR",24,0)
 K ^TMP("GMRCRFR",$J)
"RTN","GMRCDRFR",25,0)
 Q
"RTN","GMRCDRFR",26,0)
 ;
"RTN","GMRCDRFR",27,0)
SELSS ; get new service
"RTN","GMRCDRFR",28,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT
"RTN","GMRCDRFR",29,0)
 D FULL^VALM1
"RTN","GMRCDRFR",30,0)
 K GMRCSV,GMRCPROC
"RTN","GMRCDRFR",31,0)
 S DIR(0)="PO^123.5:EMQ",DIR("A")="Select Service"
"RTN","GMRCDRFR",32,0)
 D ^DIR
"RTN","GMRCDRFR",33,0)
 I $D(DIRUT) Q
"RTN","GMRCDRFR",34,0)
 S GMRCSV=+Y_";99CON"
"RTN","GMRCDRFR",35,0)
 K ^TMP("GMRCRFR",$J)
"RTN","GMRCDRFR",36,0)
 Q
"RTN","GMRCDRFR",37,0)
 ;
"RTN","GMRCDRFR",38,0)
SELPROC ; get a new procedure
"RTN","GMRCDRFR",39,0)
 ;
"RTN","GMRCDRFR",40,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT
"RTN","GMRCDRFR",41,0)
 D FULL^VALM1
"RTN","GMRCDRFR",42,0)
 K GMRCSV,GMRCPROC
"RTN","GMRCDRFR",43,0)
 S DIR(0)="PO^123.3:EMQ",DIR("A")="Select Procedure"
"RTN","GMRCDRFR",44,0)
 D ^DIR
"RTN","GMRCDRFR",45,0)
 I $D(DIRUT) Q
"RTN","GMRCDRFR",46,0)
 S GMRCPROC=+Y_";99PRC"
"RTN","GMRCDRFR",47,0)
 K ^TMP("GMRCRFR",$J)
"RTN","GMRCDRFR",48,0)
 Q
"RTN","GMRCDRFR",49,0)
 ;
"RTN","GMRCDRFR",50,0)
HDR ; -- header code
"RTN","GMRCDRFR",51,0)
 I $D(GMRCPROC) S VALMHDR(1)="Procedure: "_$P(^GMR(123.3,+GMRCPROC,0),U)
"RTN","GMRCDRFR",52,0)
 I $D(GMRCSV) S VALMHDR(1)="Service: "_$P(^GMR(123.5,+GMRCSV,0),U)
"RTN","GMRCDRFR",53,0)
 S VALMHDR(2)="Patient: "_$$GET1^DIQ(2,+GMRCPAT,.01)
"RTN","GMRCDRFR",54,0)
 Q
"RTN","GMRCDRFR",55,0)
 ;
"RTN","GMRCDRFR",56,0)
INIT ; -- init variables and list array
"RTN","GMRCDRFR",57,0)
 Q:$D(^TMP("GMRCRFR",$J))
"RTN","GMRCDRFR",58,0)
 D GETDEF($NA(^TMP("GMRCRFR",$J)),$S($D(GMRCSV):GMRCSV,1:GMRCPROC),GMRCPAT,1)
"RTN","GMRCDRFR",59,0)
 I '$D(^TMP("GMRCRFR",$J)) D
"RTN","GMRCDRFR",60,0)
 . S ^TMP("GMRCRFR",$J,1,0)="No default Reason for Request exists for the selected item."
"RTN","GMRCDRFR",61,0)
 S VALMCNT=$O(^TMP("GMRCRFR",$J,999999),-1)
"RTN","GMRCDRFR",62,0)
 S VALMBG=1
"RTN","GMRCDRFR",63,0)
 Q
"RTN","GMRCDRFR",64,0)
 ;
"RTN","GMRCDRFR",65,0)
HELP ; -- help code
"RTN","GMRCDRFR",66,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCDRFR",67,0)
 Q
"RTN","GMRCDRFR",68,0)
 ;
"RTN","GMRCDRFR",69,0)
EXIT ; -- exit code
"RTN","GMRCDRFR",70,0)
 K GMRCSV,GMRCPAT,GMRCPROC
"RTN","GMRCDRFR",71,0)
 Q
"RTN","GMRCDRFR",72,0)
 ;
"RTN","GMRCDRFR",73,0)
EXPND ; -- expand code
"RTN","GMRCDRFR",74,0)
 Q
"RTN","GMRCDRFR",75,0)
 ;
"RTN","GMRCDRFR",76,0)
GETDEF(GMRCARR,GMRCSRV,GMRCDFN,RESOLV) ; return default reason for request
"RTN","GMRCDRFR",77,0)
 ; GMRCARR = array to return containing default RFR
"RTN","GMRCDRFR",78,0)
 ; GMRCSRV = reference to file 123.5 (#;99CON) or file 123.3 (#;99PRC)
"RTN","GMRCDRFR",79,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCDRFR",80,0)
 ; RESOLV = 1 or 0 ; if RESOLV=1 GMRCARR will be returned resolved 
"RTN","GMRCDRFR",81,0)
 Q:'+GMRCSRV
"RTN","GMRCDRFR",82,0)
 N GMRCFIL
"RTN","GMRCDRFR",83,0)
 S GMRCFIL=$S(GMRCSRV[";99PRC":123.3,1:123.5)
"RTN","GMRCDRFR",84,0)
 Q:'$D(^GMR(GMRCFIL,+GMRCSRV,124))
"RTN","GMRCDRFR",85,0)
 I '$D(GMRCDFN)!('$G(RESOLV)) D  Q
"RTN","GMRCDRFR",86,0)
 . M @GMRCARR=^GMR(GMRCFIL,+GMRCSRV,124)
"RTN","GMRCDRFR",87,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(GMRCFIL,+GMRCSRV,124)))
"RTN","GMRCDRFR",88,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCDRFR",89,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCDRFR",90,0)
 Q
"RTN","GMRCDRFR",91,0)
REAF(GMRCOI) ;return value of RESTRICT DEFAULT REASON EDIT field to CPRS
"RTN","GMRCDRFR",92,0)
 ;Input:
"RTN","GMRCDRFR",93,0)
 ;  GMRCOI - ref to file 123.5 (ien;99CON) or file 123.3 (ien;99PRC)
"RTN","GMRCDRFR",94,0)
 ;Output:
"RTN","GMRCDRFR",95,0)
 ; Integer    0 - unrestricted
"RTN","GMRCDRFR",96,0)
 ;            1 - ask on edit only
"RTN","GMRCDRFR",97,0)
 ;            2 - no editing
"RTN","GMRCDRFR",98,0)
 ;
"RTN","GMRCDRFR",99,0)
 N FILE
"RTN","GMRCDRFR",100,0)
 S FILE=$S(GMRCOI["99PRC":123.3,1:123.5)
"RTN","GMRCDRFR",101,0)
 I '$O(^GMR(FILE,+GMRCOI,124,0)) Q 0
"RTN","GMRCDRFR",102,0)
 I FILE=123.5 Q +$P($G(^GMR(FILE,+GMRCOI,1)),U,3) ;cslt service
"RTN","GMRCDRFR",103,0)
 Q +$P($G(^GMR(FILE,+GMRCOI,0)),U,9) ;procedure
"RTN","GMRCEDT1")
0^8^B35410674
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM,JFR - EDIT A CONSULT AND RE-SEND AS NEW ;1/3/99 23:19
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCEDT1",3,0)
 ;
"RTN","GMRCEDT1",4,0)
 ; This routine invokes IA #2638
"RTN","GMRCEDT1",5,0)
 ;
"RTN","GMRCEDT1",6,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",7,0)
 ;GMRCSS=To Service   GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",8,0)
 ;GMRCURG=Urgency     GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",9,0)
 ;GMRCATN=Attention   GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",10,0)
 ;GMRCPNM=Patient Name  GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",11,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCINO,GMRCDIAG,LN
"RTN","GMRCEDT1",12,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",13,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",12)) S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CURRENT STATUS: (Not Editable): "_$P(^ORD(100.01,$P(^(0),"^",12),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",14,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",15,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",16,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED BY (Not Editable): "_$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",17,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED COMMENT (Not Editable):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",18,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",19,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",20,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",$P(^(0),"-",79)="",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",21,0)
 ..Q
"RTN","GMRCEDT1",22,0)
 .Q
"RTN","GMRCEDT1",23,0)
 S GMRCSS=$S($D(GMRCEDT(1)):GMRCEDT(1),1:$P(^GMR(123,+GMRCO,0),"^",5)_U_$P(^GMR(123.5,$P(^GMR(123,+GMRCO,0),"^",5),0),U))
"RTN","GMRCEDT1",24,0)
 S GMRCPROC=$S($D(GMRCED(1)):GMRCED(1),1:$P(^GMR(123,+GMRCO,0),"^",8)_U_$$GET1^DIQ(123.3,+$P(^GMR(123,+GMRCO,0),"^",8),.01))
"RTN","GMRCEDT1",25,0)
 S GMRCURG=$S($D(GMRCED(3)):GMRCED(3),1:$P(^GMR(123,+GMRCO,0),"^",9)_U_$$GET1^DIQ(101,+$P(^(0),"^",9),1))
"RTN","GMRCEDT1",26,0)
 S GMRCPL=$S($D(GMRCED(4)):GMRCED(4),1:$P(^GMR(123,+GMRCO,0),"^",10)_U_$$GET1^DIQ(101,+$P(^(0),U,10),1))
"RTN","GMRCEDT1",27,0)
 S GMRCATN=$S($D(GMRCED(5)):GMRCED(5),1:$P(^GMR(123,+GMRCO,0),"^",11)_U_$$GET1^DIQ(200,+$P(^(0),U,11),.01))
"RTN","GMRCEDT1",28,0)
 I '$D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",29,0)
 . I $D(GMRCED(6)),$L($P(GMRCED(6),U,2)) D  Q
"RTN","GMRCEDT1",30,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",31,0)
 . S GMRCDIAG=$S($D(GMRCED(6)):GMRCED(6),1:$G(^GMR(123,+GMRCO,30)))
"RTN","GMRCEDT1",32,0)
 I $D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",33,0)
 . I $D(GMRCED(6)),$L(GMRCED(6)) D  Q
"RTN","GMRCEDT1",34,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",35,0)
 . S GMRCDIAG=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT1",36,0)
 I $D(GMRCED(2)) S GMRCINO=GMRCED(2)
"RTN","GMRCEDT1",37,0)
 I '$D(GMRCINO) S GMRCINO=$P(^GMR(123,+GMRCO,0),U,18)_U_$S($P(^(0),U,18)="I":"Inpatient",1:"Outpatient")
"RTN","GMRCEDT1",38,0)
 S GMRCREQ=$S(+$P(^GMR(123,+GMRCO,0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCEDT1",39,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="SENDING PROVIDER (Not Editable): "_$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",14),.01),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",40,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="REQUEST TYPE (Not Editable): "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",41,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR("-",79),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",42,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  TO SERVICE (Not Editable): "_$P(GMRCSS,U,2) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",43,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=" ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",44,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="1 PROCEDURE: "_$P(GMRCPROC,U,2)
"RTN","GMRCEDT1",45,0)
 D:+GMRCPROC RVRS(GMRCLNO,$D(GMRCED(1))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",46,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="2 Performed as INPT OR OUTPT: "_$P(GMRCINO,U,2) D RVRS(GMRCLNO,$D(GMRCED(2))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",47,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="3 URGENCY: "_$P(GMRCURG,U,2) D RVRS(GMRCLNO,$D(GMRCED(3))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",48,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="4 PLACE OF CONSULTATION: "_$P(GMRCPL,U,2) D RVRS(GMRCLNO,$D(GMRCED(4))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",49,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="5 ATTENTION (CONSULTANT): "_$P(GMRCATN,U,2) D RVRS(GMRCLNO,$D(GMRCED(5))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",50,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="6 PROVISIONAL DIAGNOSIS: "_GMRCDIAG D RVRS(GMRCLNO,$D(GMRCED(6))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",51,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="7 REASON FOR REQUEST:" D RVRS(GMRCLNO,$D(^TMP("GMRCED",$J,20))) S GMRCLNO=GMRCLNO+1 D
"RTN","GMRCEDT1",52,0)
 . I $D(^TMP("GMRCED",$J,20)) D  Q
"RTN","GMRCEDT1",53,0)
 .. N ND S ND=0
"RTN","GMRCEDT1",54,0)
 .. F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT1",55,0)
 ... D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",56,0)
 ... S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT1",57,0)
 ... S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",58,0)
 . N ND S ND=0
"RTN","GMRCEDT1",59,0)
 . F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  D
"RTN","GMRCEDT1",60,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0)
"RTN","GMRCEDT1",61,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",62,0)
 .Q
"RTN","GMRCEDT1",63,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="8 COMMENT(S): (Add Only)" D RVRS(GMRCLNO) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",64,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT1",65,0)
 . D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",66,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  New Comment:",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",67,0)
 . N ND S ND=0 F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT1",68,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT1",69,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",70,0)
 N GMRCEDCT
"RTN","GMRCEDT1",71,0)
 S GMRCD=0,GMRCEDCT=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",72,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCT=GMRCEDCT+1,GMRCEDCM(GMRCEDCT)=GMRCDD D
"RTN","GMRCEDT1",73,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="ADDED COMMENT (Not Editable) Entered: "_$P($$FMTE^XLFDT($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",1)),"@",1)
"RTN","GMRCEDT1",74,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_$S($L($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4),0),"^",1),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",75,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",76,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",77,0)
 ..Q
"RTN","GMRCEDT1",78,0)
 .Q
"RTN","GMRCEDT1",79,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=""
"RTN","GMRCEDT1",80,0)
 K FLG
"RTN","GMRCEDT1",81,0)
 Q
"RTN","GMRCEDT1",82,0)
RVRS(LINE,EDITED) ;reverse video for fields that can be edited
"RTN","GMRCEDT1",83,0)
 I '$G(EDITED) D CNTRL^VALM10(LINE,1,1,IORVON,IORVOFF) Q
"RTN","GMRCEDT1",84,0)
 D CNTRL^VALM10(LINE,1,1,IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","GMRCEDT1",85,0)
 Q
"RTN","GMRCEDT2")
0^9^B14307374
"RTN","GMRCEDT2",1,0)
GMRCEDT2 ;SLC/JFR,DCM - RESUBMIT A CANCELLED CONSULT ;1/4/99 00:27
"RTN","GMRCEDT2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCEDT2",3,0)
EN(GMRCO,COMNO) ;entry point into the routine
"RTN","GMRCEDT2",4,0)
 ;COMNO=CMDA from ^GMRCEDT2=comments array IEN from ^GMR(123,IEN,40,
"RTN","GMRCEDT2",5,0)
 ;GMRCO=IEN of the consult from file 123
"RTN","GMRCEDT2",6,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT2",7,0)
 .S GMRCMSG="***     Consult Has Already Been Resubmitted   ***"
"RTN","GMRCEDT2",8,0)
 .S GMRCMSG(1)="***  No Further Action Is Required Or Allowed ***"
"RTN","GMRCEDT2",9,0)
 .D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCEDT2",10,0)
 .S:'$D(GMRCRSUB) GMRCRSUB=1
"RTN","GMRCEDT2",11,0)
 .Q
"RTN","GMRCEDT2",12,0)
 N MSG S MSG=$$EDRESOK(GMRCO)
"RTN","GMRCEDT2",13,0)
 I '+MSG D EXAC^GMRCADC($P(MSG,U,2)) Q
"RTN","GMRCEDT2",14,0)
 I '$D(GMRCGUIF) W !,"Resubmitting Consult ... One moment please ..."
"RTN","GMRCEDT2",15,0)
 K ^TMP("GMRCSUB",$J) S ^TMP("GMRCSUB",$J)=0
"RTN","GMRCEDT2",16,0)
 I $D(GMRCEDT(1)) S ^TMP("GMRCSUB",$J,1)="GMRCSS^"_+GMRCEDT(1)
"RTN","GMRCEDT2",17,0)
 I $D(GMRCED(1)) D
"RTN","GMRCEDT2",18,0)
 . I $P(GMRCED(1),U)=$P(^GMR(123,+GMRCO,0),U,8) K GMRCED(1) Q
"RTN","GMRCEDT2",19,0)
 . S ^TMP("GMRCSUB",$J,2)="GMRCPROC^"_+GMRCED(1)_";GMR(123.3,"
"RTN","GMRCEDT2",20,0)
 I $D(GMRCED(2)) D
"RTN","GMRCEDT2",21,0)
 . I $P(GMRCED(2),U)=$P(^GMR(123,+GMRCO,0),U,18) K GMRCED(2) Q
"RTN","GMRCEDT2",22,0)
 . S ^TMP("GMRCSUB",$J,3)="GMRCION^"_$P(GMRCED(2),U)
"RTN","GMRCEDT2",23,0)
 I $D(GMRCED(3)) D
"RTN","GMRCEDT2",24,0)
 . I $P(GMRCED(3),U)=$P(^GMR(123,+GMRCO,0),U,9) K GMRCED(3) Q
"RTN","GMRCEDT2",25,0)
 . S ^TMP("GMRCSUB",$J,4)="GMRCURG^"_$P(GMRCED(3),U)
"RTN","GMRCEDT2",26,0)
 I $D(GMRCED(4)) D
"RTN","GMRCEDT2",27,0)
 . I $P(GMRCED(4),U)=$P(^GMR(123,+GMRCO,0),U,10) K GMRCED(4) Q
"RTN","GMRCEDT2",28,0)
 . S ^TMP("GMRCSUB",$J,5)="GMRCPL^"_$P(GMRCED(4),U)
"RTN","GMRCEDT2",29,0)
 I $D(GMRCED(5)) D
"RTN","GMRCEDT2",30,0)
 . I $P(GMRCED(5),U)=$P(^GMR(123,+GMRCO,0),U,11) K GMRCED(5) Q
"RTN","GMRCEDT2",31,0)
 . I '$L($P(GMRCED(5),U)) S $P(GMRCED(5),U)="@"
"RTN","GMRCEDT2",32,0)
 . S ^TMP("GMRCSUB",$J,6)="GMRCATN^"_$P(GMRCED(5),U)
"RTN","GMRCEDT2",33,0)
 I $D(GMRCED(6)) D
"RTN","GMRCEDT2",34,0)
 . I GMRCED(6)=$G(^GMR(123,+GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",35,0)
 . I $P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"=$G(^GMR(123,GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",36,0)
 . I '$L($P(GMRCED(6),U)) S $P(GMRCED(6),U,1,2)="@"
"RTN","GMRCEDT2",37,0)
 . I $L($P(GMRCED(6),U,2)),$P(GMRCED(6),U,2)'="@" D
"RTN","GMRCEDT2",38,0)
 .. S $P(GMRCED(6),U)=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT2",39,0)
 . S ^TMP("GMRCSUB",$J,7)="GMRCDIAG^"_GMRCED(6)
"RTN","GMRCEDT2",40,0)
 I $D(^TMP("GMRCED",$J,20)) S ^TMP("GMRCSUB",$J,20)="GMRCRFQ^" D
"RTN","GMRCEDT2",41,0)
 . N ND S ND=0
"RTN","GMRCEDT2",42,0)
 . F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT2",43,0)
 .. S ^TMP("GMRCSUB",$J,20,ND)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT2",44,0)
 I $D(^TMP("GMRCED",$J,40)) S ^TMP("GMRCSUB",$J,40)="COMMENT^" D
"RTN","GMRCEDT2",45,0)
 . N ND S ND=0
"RTN","GMRCEDT2",46,0)
 . F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT2",47,0)
 .. S ^TMP("GMRCSUB",$J,40,ND)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT2",48,0)
 D FILE^GMRCGUIC(+GMRCO,$NAME(^TMP("GMRCSUB",$J)),1)
"RTN","GMRCEDT2",49,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCEDT2",50,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14)
"RTN","GMRCEDT2",51,0)
 S GMRCTYPE=$P(^GMR(123,+GMRCO,0),U,17),GMRCTRLC="XX",VISIT="",RMBED=""
"RTN","GMRCEDT2",52,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="8////^S X=5;9////^S X=11" D ^DIE
"RTN","GMRCEDT2",53,0)
 K DIE,DA,DR
"RTN","GMRCEDT2",54,0)
 S GMRCRSUB=1
"RTN","GMRCEDT2",55,0)
 S GMRCURG=$P(^GMR(123,+GMRCO,0),"^",9)
"RTN","GMRCEDT2",56,0)
 I +$P(^GMR(123,+GMRCO,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCEDT2",57,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5)
"RTN","GMRCEDT2",58,0)
 I +GMRCSVC D
"RTN","GMRCEDT2",59,0)
 . D EN^GMRCT(GMRCSVC)
"RTN","GMRCEDT2",60,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCEDT2",61,0)
 K GMRCFL,GMRCPROV,GMRCTYPE,GMRCTRLC,VISIT,RMBED,GMRCOM,GMRCURG
"RTN","GMRCEDT2",62,0)
 K GMRCSVC,GMRCORTX
"RTN","GMRCEDT2",63,0)
 Q
"RTN","GMRCEDT2",64,0)
EDRESOK(GMRCDA) ;check cslt or proc to see if still resubmittable
"RTN","GMRCEDT2",65,0)
 ; if procedure is inactive or no services, not resubmittable
"RTN","GMRCEDT2",66,0)
 ; if service is grouper or disabled, not resubmittable
"RTN","GMRCEDT2",67,0)
 N MSG,GMRC
"RTN","GMRCEDT2",68,0)
 Q:'$D(^GMR(123,+$G(GMRCDA),0)) "0^Invalid Consult Number"
"RTN","GMRCEDT2",69,0)
 S GMRC(0)=^GMR(123,+GMRCDA,0)
"RTN","GMRCEDT2",70,0)
 I '$P(GMRC(0),U,8) D  Q MSG
"RTN","GMRCEDT2",71,0)
 . I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) D  Q
"RTN","GMRCEDT2",72,0)
 .. S MSG="0^The service for this Consult is no longer orderable."
"RTN","GMRCEDT2",73,0)
 . S MSG=1
"RTN","GMRCEDT2",74,0)
 S MSG=1
"RTN","GMRCEDT2",75,0)
 I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) S MSG=0
"RTN","GMRCEDT2",76,0)
 I '$L($$GET1^DIQ(123.3,+$P(GMRC(0),U,8),.01)) S MSG=0
"RTN","GMRCEDT2",77,0)
 I +$$GET1^DIQ(123.3,+$P(GMRC(0),U,8),.02) S MSG=0
"RTN","GMRCEDT2",78,0)
 I '$D(^GMR(123.3,+$P(GMRC(0),U,8),2,"B",+$P(GMRC(0),U,5))) S MSG=0
"RTN","GMRCEDT2",79,0)
 I MSG=0 D
"RTN","GMRCEDT2",80,0)
 . S MSG=MSG_"^This procedure may no longer be ordered or the service "
"RTN","GMRCEDT2",81,0)
 . S MSG=MSG_"may no longer perform it."
"RTN","GMRCEDT2",82,0)
 Q MSG
"RTN","GMRCEDT3")
0^10^B13328286
"RTN","GMRCEDT3",1,0)
GMRCEDT3 ;SLC/DCM,JFR - For a Cancelled Consult - File edited data for tracking consult ;12/31/98 07:11
"RTN","GMRCEDT3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,15**;DEC 27, 1997
"RTN","GMRCEDT3",3,0)
EN(GMRCDA) ;File tracking Data from array
"RTN","GMRCEDT3",4,0)
 W:'$D(GMRCGUIF) !,"Filing Tracking Data..."
"RTN","GMRCEDT3",5,0)
 N GMRCOUNT
"RTN","GMRCEDT3",6,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCEDT3",7,0)
 S DIE="^GMR(123,",DA=GMRCDA,DR="8////^S X=5" D ^DIE K DIE,DA,DR
"RTN","GMRCEDT3",8,0)
 I '$D(^GMR(123,GMRCDA,40,0)) S ^GMR(123,GMRCDA,40,0)="123.02^^"
"RTN","GMRCEDT3",9,0)
 S DA=$S(+$P(^GMR(123,GMRCDA,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^(0),"^",3,4)=DA_"^"_DA D
"RTN","GMRCEDT3",10,0)
 .S ^GMR(123,GMRCDA,40,DA,0)=GMRCDT_"^"_$O(^GMR(123.1,"B","EDIT/RESUBMITTED",0))_"^"_GMRCDT_"^"_DUZ_"^"_DUZ D
"RTN","GMRCEDT3",11,0)
 .S ^GMR(123,GMRCDA,40,DA,1,0)="^^^^"_GMRCDT_"^" D
"RTN","GMRCEDT3",12,0)
 ..S GMRCOUNT=1,GMRCND=0,^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$$REPEAT^XLFSTR("-",21)_" PREVIOUS VALUES OF EDITED FIELDS  "_$$REPEAT^XLFSTR("-",21),GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",13,0)
 ..I '$D(GMRCFLD) S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="No Fields Were Edited Before Resubmission",GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",14,0)
 ..F  S GMRCND=$O(GMRCFLD(GMRCND)) Q:GMRCND=""  D  S GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",15,0)
 ...I GMRCND=.1 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="DISPLAY TEXT OF ITEM ORDERED: "_$P(GMRCFLD(GMRCND),"^",1),GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",16,0)
 ...I GMRCND=1 D  S GMRCOUNT=GMRCOUNT+1 Q
"RTN","GMRCEDT3",17,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="To Service: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value")
"RTN","GMRCEDT3",18,0)
 ....Q
"RTN","GMRCEDT3",19,0)
 ...I GMRCND=4 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Procedure: "_$$GET1^DIQ(123.3,+GMRCFLD(4),.01) Q
"RTN","GMRCEDT3",20,0)
 ...I GMRCND=14 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Performed as Inpt or Outpt: "_$S($L($P(GMRCFLD(GMRCND),"^")):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",21,0)
 ...I $S(GMRCND=5:1,GMRCND=6:1,GMRCND=13:1,1:0) D  Q
"RTN","GMRCEDT3",22,0)
 ....N CAPTION S CAPTION=$S(GMRCND=5:"Urgency: ",GMRCND=6:"Place of Consultation: ",1:"Type of Request: ")
"RTN","GMRCEDT3",23,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=CAPTION_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value")
"RTN","GMRCEDT3",24,0)
 ...I GMRCND=7 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Attention: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q
"RTN","GMRCEDT3",25,0)
 ...I GMRCND=20 N GMRCND1 S GMRCND1=0,GMRCOUNT=GMRCOUNT+1 D  Q
"RTN","GMRCEDT3",26,0)
 ....S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Reason for Request: "
"RTN","GMRCEDT3",27,0)
 ....S GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",28,0)
 ....F  S GMRCND1=$O(@GMRCFLD(20)@(GMRCND1)) Q:GMRCND1=""  S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=@GMRCFLD(20)@(GMRCND1,0),GMRCOUNT=GMRCOUNT+1
"RTN","GMRCEDT3",29,0)
 ...I GMRCND=30 S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)="Provisional Diagnosis: "_$S($L($P(GMRCFLD(GMRCND),U)):$P(GMRCFLD(GMRCND),U),1:"No Previous Value") Q 
"RTN","GMRCEDT3",30,0)
 ...I GMRCND=40 S ^GMR(123,+GMRCDA,40,DA,1,GMRCOUNT,0)=$P(GMRCFLD(GMRCND),"^",1) Q
"RTN","GMRCEDT3",31,0)
 ...Q
"RTN","GMRCEDT3",32,0)
 ..Q
"RTN","GMRCEDT3",33,0)
 .S ^GMR(123,GMRCDA,40,DA,1,GMRCOUNT,0)=$$REPEAT^XLFSTR("-",75),GMRCOUNT=GMRCOUNT-1,^GMR(123,+GMRCDA,40,"B",GMRCDT,DA)=""
"RTN","GMRCEDT3",34,0)
 .S $P(^GMR(123,GMRCDA,40,DA,1,0),"^",3)=GMRCOUNT-1,$P(^(0),"^",4)=GMRCOUNT-1,^GMR(123,+GMRCDA,40,"B",GMRCDT,DA)=""
"RTN","GMRCEDT3",35,0)
 .Q
"RTN","GMRCEDT3",36,0)
 K GMRCIND,GMRCND
"RTN","GMRCEDT3",37,0)
 Q
"RTN","GMRCEDT4")
0^11^B79732350
"RTN","GMRCEDT4",1,0)
GMRCEDT4 ;SLC/DCM,JFR - UTILITIES FOR EDITING FIELDS ;1/3/99 23:12
"RTN","GMRCEDT4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCEDT4",3,0)
ADDCM(GMRCO)    ;set up to add comment when none exists or to add a new comment
"RTN","GMRCEDT4",4,0)
 ;returns DA for the entry it sets up
"RTN","GMRCEDT4",5,0)
 N X
"RTN","GMRCEDT4",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^" S X=$S($P(^GMR(123,GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=X_"^"_X
"RTN","GMRCEDT4",7,0)
 Q X
"RTN","GMRCEDT4",8,0)
AUDIT0(DA,GMRCDA)       ;Add the necessary tracking information to word processing fields
"RTN","GMRCEDT4",9,0)
 N DIE,DR
"RTN","GMRCEDT4",10,0)
 S DIE="^GMR(123,"_GMRCDA_",40,",DA(1)=GMRCDA,DR=".01////^S X=DT;1////^S X=GMRCA;2////^S X=DT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCEDT4",11,0)
 D ^DIE
"RTN","GMRCEDT4",12,0)
 S @(DIE_"""B"","_DT_","_DA_")")=""
"RTN","GMRCEDT4",13,0)
 Q
"RTN","GMRCEDT4",14,0)
EDITFLD(GMRCO)    ;edit field in file 123.
"RTN","GMRCEDT4",15,0)
 ;GMRCO=IEN of consult record in file 123
"RTN","GMRCEDT4",16,0)
 N DIR,X,Y,GMRCSS,GMRCPROC,GMRCPROC,GMRCURG,GMRCPL,GMRCREND,GMRCY,GMRCX
"RTN","GMRCEDT4",17,0)
 N GMRCMSG,GMRCTAG
"RTN","GMRCEDT4",18,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT4",19,0)
 .S GMRCMSG="This consult is no longer editable." D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",20,0)
 S GMRCMSG=$$EDRESOK^GMRCEDT2(GMRCO)
"RTN","GMRCEDT4",21,0)
 I '+GMRCMSG D EXAC^GMRCADC($P(GMRCMSG,U,2)) Q
"RTN","GMRCEDT4",22,0)
 S DIR(0)="LAO^1:8",DIR("A")="Select the fields to edit: "
"RTN","GMRCEDT4",23,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCEDT4",24,0)
 I $P(Y,",")<1 Q
"RTN","GMRCEDT4",25,0)
 S GMRCY=Y
"RTN","GMRCEDT4",26,0)
 F GMRCX=1:1:8 S GMRCTAG=$P(GMRCY,",",GMRCX) Q:'GMRCTAG  D
"RTN","GMRCEDT4",27,0)
 . D SETUP
"RTN","GMRCEDT4",28,0)
 . D @GMRCTAG
"RTN","GMRCEDT4",29,0)
 . K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCEDT4",30,0)
 . D EN^GMRCEDT1(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT4",31,0)
 Q
"RTN","GMRCEDT4",32,0)
SETUP   ;get info needed for edit (save global reads)
"RTN","GMRCEDT4",33,0)
 S:$D(GMRCEDT(1)) GMRCSS=GMRCEDT(1)
"RTN","GMRCEDT4",34,0)
 I '$D(GMRCSS) S GMRCSS=$P(^GMR(123,+GMRCO,0),U,5),GMRCSS=GMRCSS_U_$P(^GMR(123.5,GMRCSS,0),U)
"RTN","GMRCEDT4",35,0)
 S:$D(GMRCED(1)) GMRCPROC=GMRCED(1)
"RTN","GMRCEDT4",36,0)
 I '$D(GMRCPROC) S GMRCPROC=+$P(^GMR(123,+GMRCO,0),U,8),GMRCPROC=GMRCPROC_U_$$GET1^DIQ(123.3,+GMRCPROC,.01)
"RTN","GMRCEDT4",37,0)
 S:$D(GMRCED(2)) GMRCREND=GMRCED(2)
"RTN","GMRCEDT4",38,0)
 I '$D(GMRCREND) S GMRCREND=$P(^GMR(123,GMRCO,0),U,18),GMRCREND=GMRCREND_U_$S(GMRCREND="I":"In",1:"Out")_"patient"
"RTN","GMRCEDT4",39,0)
 S:$D(GMRCED(3)) GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",40,0)
 I '$D(GMRCURG) S GMRCURG=$P(^GMR(123,+GMRCO,0),U,9),GMRCURG=GMRCURG_U_$$GET1^DIQ(101,+GMRCURG,1)
"RTN","GMRCEDT4",41,0)
 S:$D(GMRCED(4)) GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",42,0)
 I '$D(GMRCPL) S GMRCPL=$P(^GMR(123,+GMRCO,0),U,10),GMRCPL=GMRCPL_U_$$GET1^DIQ(101,+GMRCPL,1)
"RTN","GMRCEDT4",43,0)
 Q
"RTN","GMRCEDT4",44,0)
01       ;edit TO SERVICE
"RTN","GMRCEDT4",45,0)
 N I,PROCSERV,DIR,X,Y
"RTN","GMRCEDT4",46,0)
 I $G(GMRCPROC) D  Q:'PROCSERV
"RTN","GMRCEDT4",47,0)
 . N I S I=0,PROCSERV=0 F  S I=$O(^GMR(123.3,+GMRCPROC,2,"B",I)) Q:'I  D
"RTN","GMRCEDT4",48,0)
 .. S PROCSERV(I)="",PROCSERV=PROCSERV+1
"RTN","GMRCEDT4",49,0)
 . I PROCSERV=1 W !,"Only one SERVICE can perform this procedure.",!
"RTN","GMRCEDT4",50,0)
 S DIR(0)="PA^123.5:EMQ"
"RTN","GMRCEDT4",51,0)
 I $G(PROCSERV) D
"RTN","GMRCEDT4",52,0)
 . I $D(PROCSERV(+GMRCSS)) Q
"RTN","GMRCEDT4",53,0)
 . S DIR("B")=$$GET1^DIQ(123.5,$O(PROCSERV(0)),.01)
"RTN","GMRCEDT4",54,0)
 I '$D(DIR("B")) S DIR("B")=$P(GMRCSS,U,2)
"RTN","GMRCEDT4",55,0)
 S DIR("A")="Select the Service to perform this request: "
"RTN","GMRCEDT4",56,0)
 S DIR("S")="I $P(^(0),U,2)<1"
"RTN","GMRCEDT4",57,0)
 I +$G(GMRCPROC) S DIR("S")=DIR("S")_",$D(PROCSERV(+Y))"
"RTN","GMRCEDT4",58,0)
 S DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCEDT4",59,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",60,0)
 I Y<1!(+Y=+GMRCSS) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",61,0)
 S GMRCEDT(1)=Y,GMRCSS=Y
"RTN","GMRCEDT4",62,0)
 Q
"RTN","GMRCEDT4",63,0)
1 ;edit Procedure
"RTN","GMRCEDT4",64,0)
 W !,$C(7),"The procedure associated with a request may not be changed."
"RTN","GMRCEDT4",65,0)
 W !,"Place a new request if a different procedure is desired"
"RTN","GMRCEDT4",66,0)
 H 2 Q
"RTN","GMRCEDT4",67,0)
 I +$P(^GMR(123,+GMRCO,0),U,17)'="P" D  Q
"RTN","GMRCEDT4",68,0)
 . W !,"Procedures may only be selected for Procedure requests.",!
"RTN","GMRCEDT4",69,0)
 . H 2
"RTN","GMRCEDT4",70,0)
 N DIC,PROCED,X,Y,D
"RTN","GMRCEDT4",71,0)
 S DIC=101.43,DIC(0)="AEQZ",D="S.PROC",DIC("B")=$P(GMRCPROC,U,2)
"RTN","GMRCEDT4",72,0)
 S DIC("A")="Select Procedure: "
"RTN","GMRCEDT4",73,0)
 S DIC("S")="I $D(^GMR(123.3,+$P(^(0),U,2),2,""B"",+GMRCSS))"
"RTN","GMRCEDT4",74,0)
 D IX^DIC
"RTN","GMRCEDT4",75,0)
 I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",76,0)
 I Y<1!(+$P(Y(0),U,3)=$P(GMRCPROC,U,2)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",77,0)
 S PROCED=+$P(Y(0),U,2)_U_$$UP^XLFSTR($P(Y(0),U))
"RTN","GMRCEDT4",78,0)
 I '$D(^GMR(123.5,"APR",+PROCED,+GMRCSS)) D
"RTN","GMRCEDT4",79,0)
 . ;never executed; service non-editable
"RTN","GMRCEDT4",80,0)
 . N GMRCEDD1,GMRCSSV,GMRCPROC
"RTN","GMRCEDT4",81,0)
 . W !,"The service is no longer appropriate for this procedure.",!
"RTN","GMRCEDT4",82,0)
 . S GMRCSSV=GMRCSS,GMRCPROC=PROCED
"RTN","GMRCEDT4",83,0)
 . S:$D(GMRCEDT(1)) GMRCEDD1=GMRCEDT(1)
"RTN","GMRCEDT4",84,0)
 . D 01
"RTN","GMRCEDT4",85,0)
 . I '$D(^GMR(123.3,+PROCED,2,"B",+GMRCSS)) D
"RTN","GMRCEDT4",86,0)
 .. W !,$C(7),"Unable to change procedure.",!
"RTN","GMRCEDT4",87,0)
 .. K PROCED,GMRCEDT(1) S GMRCSS=GMRCSSV
"RTN","GMRCEDT4",88,0)
 .. I $D(GMRCEDD1) S GMRCEDT(1)=GMRCEDD1
"RTN","GMRCEDT4",89,0)
 I $D(PROCED) S (GMRCPROC,GMRCED(1))=PROCED
"RTN","GMRCEDT4",90,0)
 Q
"RTN","GMRCEDT4",91,0)
2       ;edit service rendered
"RTN","GMRCEDT4",92,0)
 N DIR,X,Y,GMRCURSV,GMRCPLSV,GMRCED4,GMRCED5,RENDED
"RTN","GMRCEDT4",93,0)
 S DIR(0)="S:A^I:Inpatient;O:Outpatient",DIR("B")=$P(GMRCREND,U,2)
"RTN","GMRCEDT4",94,0)
 S DIR("A")="Service to be performed Inpatient or Outpatient: "
"RTN","GMRCEDT4",95,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",96,0)
 I Y'=$P(GMRCREND,U) S RENDED=Y_U_Y(0)
"RTN","GMRCEDT4",97,0)
 I '$D(RENDED) Q
"RTN","GMRCEDT4",98,0)
 I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",99,0)
 . N GMRCREND,CHGIO S GMRCREND=RENDED
"RTN","GMRCEDT4",100,0)
 . W $C(7),!!,"The urgency of this request is no longer valid.",!
"RTN","GMRCEDT4",101,0)
 . S GMRCURSV=GMRCURG S:$D(GMRCED(3)) GMRCED3=GMRCED(3)
"RTN","GMRCEDT4",102,0)
 . S CHGREND="" D 3
"RTN","GMRCEDT4",103,0)
 . I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  Q
"RTN","GMRCEDT4",104,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",105,0)
 .. K RENDED S GMRCURG=GMRCURSV S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",106,0)
 I '$$VALIDPL(GMRCPL,RENDED) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",107,0)
 . N GMRCREND,CHGREND S GMRCREND=RENDED
"RTN","GMRCEDT4",108,0)
 . W $C(7),!!,"The Place of Consultation is no longer valid.",!
"RTN","GMRCEDT4",109,0)
 . S GMRCPLSV=GMRCPL S:$D(GMRCED(4)) GMRCED4=GMRCED(4) S CHGREND="" D 4
"RTN","GMRCEDT4",110,0)
 . I '$$VALIDPL(GMRCPL,RENDED) D  Q
"RTN","GMRCEDT4",111,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",112,0)
 .. K RENDED S GMRCPL=GMRCPLSV S:$D(GMRCED4) GMRCED(4)=GMRCED4
"RTN","GMRCEDT4",113,0)
 .. S:$D(GMRCURSV) GMRCURG=GMRCURSV
"RTN","GMRCEDT4",114,0)
 .. S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",115,0)
 S (GMRCREND,GMRCED(2))=RENDED
"RTN","GMRCEDT4",116,0)
 Q
"RTN","GMRCEDT4",117,0)
3 ;edit urgency
"RTN","GMRCEDT4",118,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",119,0)
 I $P(GMRCREND,U)="O" S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM - OUTPATIENT")
"RTN","GMRCEDT4",120,0)
 I '$D(Y) D  ;inpatient
"RTN","GMRCEDT4",121,0)
 .I '$G(GMRCPROC) S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM CSLT - INPATIENT") Q
"RTN","GMRCEDT4",122,0)
 .S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM REQ - INPATIENT")
"RTN","GMRCEDT4",123,0)
 I 'Y W !,$C(7),"Unable to change urgency." Q
"RTN","GMRCEDT4",124,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: "
"RTN","GMRCEDT4",125,0)
 S XQORM("^^NO")=0
"RTN","GMRCEDT4",126,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCURG),U,2)
"RTN","GMRCEDT4",127,0)
 D EN^XQORM
"RTN","GMRCEDT4",128,0)
 Q:Y'>0
"RTN","GMRCEDT4",129,0)
 I $P(Y(1),U,2)'=+GMRCURG D
"RTN","GMRCEDT4",130,0)
 . S GMRCED(3)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",131,0)
 Q
"RTN","GMRCEDT4",132,0)
4 ;edit place of CSLT
"RTN","GMRCEDT4",133,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",134,0)
 S Y=$$FIND1^DIC(101,,"QX","GMRCPLACEM - "_$$UP^XLFSTR($P(GMRCREND,U,2))) Q:'Y
"RTN","GMRCEDT4",135,0)
 S XQORM=Y_";ORD(101,"
"RTN","GMRCEDT4",136,0)
 S XQORM(0)="1AR\",XQORM("A")="Place of Consultation: ",XQORM("NO^^")=""
"RTN","GMRCEDT4",137,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCPL),U,2)
"RTN","GMRCEDT4",138,0)
 D EN^XQORM
"RTN","GMRCEDT4",139,0)
 Q:Y'>0
"RTN","GMRCEDT4",140,0)
 I $P(Y(1),U,2)'=+GMRCPL D
"RTN","GMRCEDT4",141,0)
 . S GMRCED(4)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",142,0)
 Q
"RTN","GMRCEDT4",143,0)
5 ;edit ATTN person
"RTN","GMRCEDT4",144,0)
 N X,Y,DIR
"RTN","GMRCEDT4",145,0)
 S DIR(0)="PAO^200:EQM",DIR("A")="Select ATTENTION person: "
"RTN","GMRCEDT4",146,0)
 S DIR("B")=$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),U,11),.01)
"RTN","GMRCEDT4",147,0)
 S:$D(GMRCED(5)) DIR("B")=$P($G(GMRCED(5)),U,2)
"RTN","GMRCEDT4",148,0)
 K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",149,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",150,0)
 I $G(DIR("B"))=$P(Y,U,2) Q
"RTN","GMRCEDT4",151,0)
 S GMRCED(5)=$S(Y=-1:"",1:Y)
"RTN","GMRCEDT4",152,0)
 I GMRCED(5)="" W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",153,0)
 Q
"RTN","GMRCEDT4",154,0)
6 ;edit prov. DX
"RTN","GMRCEDT4",155,0)
 N X,Y,DIC,DIR,PRMPT
"RTN","GMRCEDT4",156,0)
 S PRMPT=$$PROVDX^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCEDT4",157,0)
 I $P(PRMPT,U,2)="F" D
"RTN","GMRCEDT4",158,0)
 . S DIR(0)="FA^2:180",DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",159,0)
 . I $P(PRMPT,U)'="R" S $P(DIR(0),U)="FAO"
"RTN","GMRCEDT4",160,0)
 . S:$D(GMRCED(6)) DIR("B")=$P(GMRCED(6),U)
"RTN","GMRCEDT4",161,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT4",162,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",163,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))  Q:Y=$G(DIR("B"))
"RTN","GMRCEDT4",164,0)
 . I '$L(Y) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",165,0)
 . S GMRCED(6)=Y
"RTN","GMRCEDT4",166,0)
 I $P(PRMPT,U,2)="L" D
"RTN","GMRCEDT4",167,0)
 . D CONFIG^LEXSET("ICD","ICD")
"RTN","GMRCEDT4",168,0)
 . S DIR(0)="PA"_$S($P(PRMPT,U)'="R":"O",1:"")_"^757.01:EQM"
"RTN","GMRCEDT4",169,0)
 . S DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",170,0)
 . I $D(GMRCED(6)) S DIR("B")=$P(GMRCED(6),U)
"RTN","GMRCEDT4",171,0)
 . I '$D(DIR("B")),$D(^GMR(123,+GMRCO,30.1)) D
"RTN","GMRCEDT4",172,0)
 .. S DIR("B")=$P(^GMR(123,GMRCO,30),(" ("_^(30.1)_")"))
"RTN","GMRCEDT4",173,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMRCEDT4",174,0)
 . I $G(^GMR(123,GMRCO,30.1)),$D(Y(1)),^(30.1)=Y(1) Q
"RTN","GMRCEDT4",175,0)
 . S GMRCED(6)=$S(Y=-1:"",1:$P(Y,U,2)_U_$G(Y(1)))
"RTN","GMRCEDT4",176,0)
 . ;I $D(GMRCED(6)) S $P(GMRCED(6),U,2)=$G(Y(1))
"RTN","GMRCEDT4",177,0)
 . Q
"RTN","GMRCEDT4",178,0)
 Q
"RTN","GMRCEDT4",179,0)
7 ;edit Reason for Request
"RTN","GMRCEDT4",180,0)
 N DIC,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",181,0)
 I $D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCEDSV",$J,20)=^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",182,0)
 I '$D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCED",$J,20)=^GMR(123,+GMRCO,20)
"RTN","GMRCEDT4",183,0)
 S DIC="^TMP(""GMRCED"",$J,20,",DIWESUB="Reason for Request"
"RTN","GMRCEDT4",184,0)
 W !,"Editing Reason for Request:",!
"RTN","GMRCEDT4",185,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",186,0)
 I '$$DIFFRFR($D(^TMP("GMRCEDSV",$J,20))) D  Q
"RTN","GMRCEDT4",187,0)
 . I $D(^TMP("GMRCEDSV",$J,20)) K ^TMP("GMRCEDSV",$J,20) Q
"RTN","GMRCEDT4",188,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",189,0)
 K ^TMP("GMRCEDSV",$J,20)
"RTN","GMRCEDT4",190,0)
 I '$D(^TMP("GMRCED",$J,20))!('$O(^TMP("GMRCED",$J,20,0))) D
"RTN","GMRCEDT4",191,0)
 . N GMRCMSG
"RTN","GMRCEDT4",192,0)
 . S GMRCMSG="Unable to delete Reason for Request (REQUIRED)"
"RTN","GMRCEDT4",193,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",194,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",195,0)
 Q
"RTN","GMRCEDT4",196,0)
8 ;add comment
"RTN","GMRCEDT4",197,0)
 N DIC,DIWEPSE,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",198,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT4",199,0)
 . W !,"An unsaved comment exists. You may edit this comment.",!
"RTN","GMRCEDT4",200,0)
 . S DIWEPSE=1
"RTN","GMRCEDT4",201,0)
 S DIC="^TMP(""GMRCED"",$J,40,",DIWESUB="New Comment"
"RTN","GMRCEDT4",202,0)
 W !,"Adding new comment:",!
"RTN","GMRCEDT4",203,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",204,0)
 I '$O(^TMP("GMRCED",$J,40,0)) K ^TMP("GMRCED",$J,40)
"RTN","GMRCEDT4",205,0)
 Q
"RTN","GMRCEDT4",206,0)
DIFFRFR(SAVED) ;edited reason for req same as original?
"RTN","GMRCEDT4",207,0)
 N I,DIFF
"RTN","GMRCEDT4",208,0)
 I SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^TMP("GMRCEDSV",$J,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",209,0)
 I 'SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^GMR(123,+GMRCO,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",210,0)
 I SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",211,0)
 . I ^TMP("GMRCED",$J,20,I,0)=$G(^TMP("GMRCEDSV",$J,20,I,0)) Q
"RTN","GMRCEDT4",212,0)
 . S DIFF=1
"RTN","GMRCEDT4",213,0)
 . Q
"RTN","GMRCEDT4",214,0)
 I 'SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",215,0)
 . I ^TMP("GMRCED",$J,20,I,0)'=$G(^GMR(123,+GMRCO,20,I,0)) S DIFF=1
"RTN","GMRCEDT4",216,0)
 . Q
"RTN","GMRCEDT4",217,0)
 Q $G(DIFF)
"RTN","GMRCEDT4",218,0)
VALIDPL(PL,REND) ; place still valid?
"RTN","GMRCEDT4",219,0)
 N PLMENU
"RTN","GMRCEDT4",220,0)
 S PLMENU=$S($P(REND,U)="I":"IN",1:"OUT")
"RTN","GMRCEDT4",221,0)
 S PLMENU="GMRCPLACEM - "_PLMENU_"PATIENT"
"RTN","GMRCEDT4",222,0)
 S PLMENU=$$FIND1^DIC(101,,"QX",PLMENU) Q:PLMENU'>1 0
"RTN","GMRCEDT4",223,0)
 Q $D(^ORD(101,PLMENU,10,"B",+PL))
"RTN","GMRCEDT4",224,0)
VALIDUR(URG,REND,PROC) ;urgency still valid?
"RTN","GMRCEDT4",225,0)
 N URMENU
"RTN","GMRCEDT4",226,0)
 I $P(REND,U)="I" D
"RTN","GMRCEDT4",227,0)
 .I 'PROC S URMENU="GMRCURGENCYM CSLT - INPATIENT" Q
"RTN","GMRCEDT4",228,0)
 .S URMENU="GMRCURGENCYM REQ - INPATIENT" Q
"RTN","GMRCEDT4",229,0)
 I '$D(URMENU) S URMENU="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCEDT4",230,0)
 S URMENU=$$FIND1^DIC(101,,"QX",URMENU) Q:URMENU<0 0
"RTN","GMRCEDT4",231,0)
 Q $D(^ORD(101,URMENU,10,"B",+URG))
"RTN","GMRCEDT4",232,0)
 Q
"RTN","GMRCEDT4",233,0)
NOCHG() ;no changes made
"RTN","GMRCEDT4",234,0)
 Q "No Changes made!"
"RTN","GMRCGUIA")
0^32^B41403314
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM,JFR - File Consult actions from GUI  ;8/30/99  01:51
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15**;DEC 27, 1997
"RTN","GMRCGUIA",3,0)
 ;
"RTN","GMRCGUIA",4,0)
 ; This routine invokes IA #2638,#2926
"RTN","GMRCGUIA",5,0)
 ;
"RTN","GMRCGUIA",6,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",7,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",8,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",9,0)
 ;    an array
"RTN","GMRCGUIA",10,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",11,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",12,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",13,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",14,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",15,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",16,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",17,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",18,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",19,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",20,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",21,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",22,0)
 N DIC,DLAYGO,Y,DIE,GMRCADUZ,X,GMRCO,DR
"RTN","GMRCGUIA",23,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",24,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",25,0)
 L +^GMR(123,GMRC0)
"RTN","GMRCGUIA",26,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",27,0)
 D ^DIE
"RTN","GMRCGUIA",28,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",29,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",30,0)
 I $O(GMRCRFQ(0)) D REASON^GMRCGUIB(GMRCO,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",31,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYPE,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",32,0)
 D EXIT
"RTN","GMRCGUIA",33,0)
 Q
"RTN","GMRCGUIA",34,0)
 ;
"RTN","GMRCGUIA",35,0)
RC(GMRCO,GMRCORNP,GMRCAD,GMRCMT,GMRCDUZ) ;Receive consult into service
"RTN","GMRCGUIA",36,0)
 ;
"RTN","GMRCGUIA",37,0)
 ;Input variables:
"RTN","GMRCGUIA",38,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",39,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult 
"RTN","GMRCGUIA",40,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'.
"RTN","GMRCGUIA",41,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIA",42,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIA",43,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIA",44,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIA",45,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'
"RTN","GMRCGUIA",46,0)
 ;
"RTN","GMRCGUIA",47,0)
 ;Output:
"RTN","GMRCGUIA",48,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",49,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",50,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",51,0)
 ;
"RTN","GMRCGUIA",52,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIA",53,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",54,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",55,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIA",56,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",57,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",58,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",59,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIA",60,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIA",61,0)
 . S DA=$$SETDA^GMRCGUIB
"RTN","GMRCGUIA",62,0)
 . D SETCOM^GMRCGUIB(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIA",63,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",64,0)
 D EXIT
"RTN","GMRCGUIA",65,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",66,0)
 ;
"RTN","GMRCGUIA",67,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",68,0)
 ;
"RTN","GMRCGUIA",69,0)
 ;Input variables:
"RTN","GMRCGUIA",70,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",71,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",72,0)
 ;GMRCAD - FM date/time of actual activity.
"RTN","GMRCGUIA",73,0)
 ;GMRCACTM - set to "DY" if 'CANCELLED'(old DENY)
"RTN","GMRCGUIA",74,0)
 ;           set to "DC" if consult is Discontinued 
"RTN","GMRCGUIA",75,0)
 ;GMRCOM - Comment array containing explanation of action
"RTN","GMRCGUIA",76,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",77,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",78,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",79,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",80,0)
 ;  Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",81,0)
 ;
"RTN","GMRCGUIA",82,0)
 ;Output:
"RTN","GMRCGUIA",83,0)
 ;GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",84,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",85,0)
 ; returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",86,0)
 ;
"RTN","GMRCGUIA",87,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS,GMRCERR,GMRCERMS,GMRCADUZ,GMRCTRLC
"RTN","GMRCGUIA",88,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",89,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",90,0)
 K GMRCQUT
"RTN","GMRCGUIA",91,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",92,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",93,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",94,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",95,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",96,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",98,0)
 S GMRCA=$S(GMRCACTM="DC":6,1:19),GMRCSTS=$S(GMRCA=6:1,1:13)
"RTN","GMRCGUIA",99,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",100,0)
 I GMRCACTM="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D PRNT^GMRCUTL1("",GMRCO)
"RTN","GMRCGUIA",101,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",102,0)
 S GMRCOM(0)=DA
"RTN","GMRCGUIA",103,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",1:"OC")
"RTN","GMRCGUIA",104,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIA",105,0)
 S GMRCORTX=$S(GMRCACTM="DY":"Cancelled",1:"Discontinued")_" consult "
"RTN","GMRCGUIA",106,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIA",107,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCGUIA",108,0)
 I GMRCACTM="DC" D
"RTN","GMRCGUIA",109,0)
 . S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ) ;NOTIFY SERVICE ON DC ?
"RTN","GMRCGUIA",110,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),$P(^(0),"^",14)'=DUZ D
"RTN","GMRCGUIA",111,0)
 . S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCGUIA",112,0)
 ;send notification
"RTN","GMRCGUIA",113,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCGUIA",114,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCGUIA",115,0)
 D EXIT
"RTN","GMRCGUIA",116,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",117,0)
 ;
"RTN","GMRCGUIA",118,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCAD) ;FWD consult
"RTN","GMRCGUIA",119,0)
 ;to another service
"RTN","GMRCGUIA",120,0)
 ;
"RTN","GMRCGUIA",121,0)
 ;Input variables:
"RTN","GMRCGUIA",122,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIA",123,0)
 ;GMRCSS=service being forwarded to; ptr to REQUEST SERVICES (#123.5)
"RTN","GMRCGUIA",124,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIA",125,0)
 ;GMRCATTN=NEW PERSON to whose attention action should be directed
"RTN","GMRCGUIA",126,0)
 ;GMRCURGI=urgency from PROTOCOL(#101) file
"RTN","GMRCGUIA",127,0)
 ;GMRCOM=Comment array containing explanation of action
"RTN","GMRCGUIA",128,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",129,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",130,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",131,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",132,0)
 ;GMRCAD=FM date/time of actual activity
"RTN","GMRCGUIA",133,0)
 ;
"RTN","GMRCGUIA",134,0)
 ;Output:
"RTN","GMRCGUIA",135,0)
 ;  GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",136,0)
 ;  GMRCERMS - Error message or null
"RTN","GMRCGUIA",137,0)
 ;     returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",138,0)
 ;
"RTN","GMRCGUIA",139,0)
 N DR,GMRCDUZ,GMRCNOW,GMRCFF,GMRCFR,GMRCADUZ,GMRCURG
"RTN","GMRCGUIA",140,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIA",141,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",142,0)
 S DFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCGUIA",143,0)
 S GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",144,0)
 S:'$G(GMRCAD) GMRCAD=GMRCNOW  ;Actual FM date/time consult was FWD'd 
"RTN","GMRCGUIA",145,0)
 S:'$G(GMRCURGI) GMRCURGI=$P(^GMR(123,GMRCO,0),U,9)
"RTN","GMRCGUIA",146,0)
 S GMRCA=17,GMRCSTS=5
"RTN","GMRCGUIA",147,0)
 S GMRCFF=$P($G(^GMR(123.5,+GMRCSS,123)),U,9) ;printed to new serv
"RTN","GMRCGUIA",148,0)
 S GMRCFR=$P($G(^GMR(123,+GMRCO,0)),"^",5) ;Get current service 
"RTN","GMRCGUIA",149,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIA",150,0)
 S DR="1////^S X=$G(GMRCSS);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=$G(GMRCA);.1///@"_$S($L($G(GMRCATTN)):";7////^S X=GMRCATTN",1:"")
"RTN","GMRCGUIA",151,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",152,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",153,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",154,0)
 S GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCGUIA",155,0)
 D DEM^GMRCU ;sets GMRCRB and other variables
"RTN","GMRCGUIA",156,0)
 D TYPE^GMRCAFRD ;sets GMRCTYPE
"RTN","GMRCGUIA",157,0)
 D FRMSG^GMRCAFRD ;create XX HL7 message for OE/RR and send alert 
"RTN","GMRCGUIA",158,0)
 D EXIT
"RTN","GMRCGUIA",159,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",160,0)
 ;
"RTN","GMRCGUIA",161,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",162,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",163,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"MCAR", or ^TMP("GMRCR",$J,"RES", i.e., S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",164,0)
 Q:'$G(GMRCO)
"RTN","GMRCGUIA",165,0)
 K @TMPGLOB
"RTN","GMRCGUIA",166,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCGUIA",167,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",168,0)
 S GMRCRTFL=$S('+GMRCSR&('GMRCTUFN):1,1:0)
"RTN","GMRCGUIA",169,0)
 ;
"RTN","GMRCGUIA",170,0)
 D GETRSLT^GMRCART(TMPGLOB)
"RTN","GMRCGUIA",171,0)
 ;
"RTN","GMRCGUIA",172,0)
 D EXIT
"RTN","GMRCGUIA",173,0)
 Q
"RTN","GMRCGUIA",174,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",175,0)
 K GMRCA,GMRCDVL,GMRCSR,GMRCRTFL,GMRCFL,GMRCORNP,GMRCQUT,GMRCSTS,GMRCTUFN
"RTN","GMRCGUIA",176,0)
 K GMRCRTFL,GMRCADUZ,GMRCORTX
"RTN","GMRCGUIA",177,0)
 Q
"RTN","GMRCGUIC")
0^12^B49411950
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR - GUI actions for editing consults; 12/17/98 14:19
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,20,15**;DEC 27, 1997
"RTN","GMRCGUIC",3,0)
 ;
"RTN","GMRCGUIC",4,0)
 ; This routine invokes IA #2398,#2698,#2713,#2960
"RTN","GMRCGUIC",5,0)
 ;
"RTN","GMRCGUIC",6,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",7,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",8,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",9,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",10,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",11,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",12,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",13,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",14,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",15,0)
 Q
"RTN","GMRCGUIC",16,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",17,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",18,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",19,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",20,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",21,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",22,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",23,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",24,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",25,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",26,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",27,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",28,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",29,0)
 ;
"RTN","GMRCGUIC",30,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",31,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT
"RTN","GMRCGUIC",32,0)
 N GMRCION,GMRCDIAG,GMRCDXCD
"RTN","GMRCGUIC",33,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",34,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",35,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",36,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",37,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",38,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",39,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",40,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" Q  ;S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q ;ignore procedure, can't be changed currently
"RTN","GMRCGUIC",41,0)
 .; ..S GMRCPROC=$P(GMRCMSG,"^",2) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",42,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",43,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",44,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",45,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",46,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",47,0)
 ..Q
"RTN","GMRCGUIC",48,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^7" Q
"RTN","GMRCGUIC",49,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S($P(^GMR(123,+GMRCO,0),"^",17)="P":"Procedure",1:"Consult")_"^13" Q
"RTN","GMRCGUIC",50,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",51,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" D  Q
"RTN","GMRCGUIC",52,0)
 ..S GMRCDIAG=$P(GMRCMSG,"^",2)
"RTN","GMRCGUIC",53,0)
 ..S GMRCFLD(30)=$G(^GMR(123,+GMRCO,30))_"^30"
"RTN","GMRCGUIC",54,0)
 ..I $P(GMRCFLD(30),U)="" S $P(GMRCFLD(30),U)="No Previous Value"
"RTN","GMRCGUIC",55,0)
 ..I $L($P(GMRCMSG,U,3)) D
"RTN","GMRCGUIC",56,0)
 ...S GMRCDXCD=$P(GMRCMSG,"^",3)
"RTN","GMRCGUIC",57,0)
 ...S GMRCFLD(30.1)=$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",58,0)
 .Q
"RTN","GMRCGUIC",59,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",60,0)
 D EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",61,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCDIAG),$G(GMRCDXCD)) I $L(DR) D
"RTN","GMRCGUIC",62,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",63,0)
 .L +^GMR(123,GMRCO)
"RTN","GMRCGUIC",64,0)
 .D ^DIE
"RTN","GMRCGUIC",65,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",66,0)
 .D ^DIE
"RTN","GMRCGUIC",67,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",68,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",69,0)
 .Q
"RTN","GMRCGUIC",70,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX^RESUBMIT",VISIT="",RMBED=""
"RTN","GMRCGUIC",71,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,$G(DUZ),VISIT,.GMRCOM)
"RTN","GMRCGUIC",72,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",73,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",74,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",75,0)
 S GMRCFL=1
"RTN","GMRCGUIC",76,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",77,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",78,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",79,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",80,0)
 . N GMRCCORY
"RTN","GMRCGUIC",81,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",82,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",83,0)
 Q
"RTN","GMRCGUIC",84,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",85,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",86,0)
 K @GLOBAL
"RTN","GMRCGUIC",87,0)
 N ND,GMRCSX,TYPE,NDX
"RTN","GMRCGUIC",88,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",89,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",90,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:'$L(GMRC(0))
"RTN","GMRCGUIC",91,0)
 S GMRCSS=$P(GMRC(0),"^",5),GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCGUIC",92,0)
 S GMRCURG=$P(GMRC(0),"^",9),GMRCPL=$P(GMRC(0),"^",10)
"RTN","GMRCGUIC",93,0)
 S GMRCATN=$P(GMRC(0),"^",11),GMRCINO=$P(GMRC(0),"^",18)
"RTN","GMRCGUIC",94,0)
 S GMRCREQ=$P(GMRC(0),"^",17)
"RTN","GMRCGUIC",95,0)
 S GMRCDIAG=$G(^GMR(123,+GMRCO,30)) I $L($G(^(30.1))) D
"RTN","GMRCGUIC",96,0)
 . S GMRCDIAG=GMRCDIAG_U_$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",97,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),U,14):$$GET1^DIQ(200,+$P(^(0),U,14),.01),1:"")
"RTN","GMRCGUIC",98,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",99,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",100,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",101,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",102,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",103,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(123.3,+GMRCPROC,.01))
"RTN","GMRCGUIC",104,0)
 .S GMRCSY=$$FIND1^DIC(101.43,,"QX",+GMRCPROC_";99PRC","ID")
"RTN","GMRCGUIC",105,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",106,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX,ND=ND+1
"RTN","GMRCGUIC",107,0)
 ..Q
"RTN","GMRCGUIC",108,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",109,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",110,0)
 I $L(GMRCREQ) D  I '$L(GMRCREQ) S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",111,0)
 . S GMRCSX=$S(GMRCREQ="P":"PROCEDURE",1:"CONSULT")
"RTN","GMRCGUIC",112,0)
 . S @GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ
"RTN","GMRCGUIC",113,0)
 . S GMRCSX=""
"RTN","GMRCGUIC",114,0)
 S ND=ND+1
"RTN","GMRCGUIC",115,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",116,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",117,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",118,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",119,0)
 .Q
"RTN","GMRCGUIC",120,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",121,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",122,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",123,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",124,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",125,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",126,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",127,0)
 .Q
"RTN","GMRCGUIC",128,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",129,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",130,0)
 I +GMRCATN S GMRCSX=$P(^VA(200,GMRCATN,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",131,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",132,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",133,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",134,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",135,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",136,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",137,0)
 .Q
"RTN","GMRCGUIC",138,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",139,0)
 ;Get reason for request
"RTN","GMRCGUIC",140,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",141,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",142,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",143,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",144,0)
 D SENDCOMT^GMRCGUIU(GMRCO,.ND)
"RTN","GMRCGUIC",145,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",146,0)
 Q
"RTN","GMRCGUIU")
0^29^B26290875
"RTN","GMRCGUIU",1,0)
GMRCGUIU ;SLC/DCM - Kill off variables from GUI routines; 12/18/98 14:19
"RTN","GMRCGUIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15**;DEC 27, 1997
"RTN","GMRCGUIU",3,0)
 ;
"RTN","GMRCGUIU",4,0)
 ; This routine invokes IA #2757,#3042,#3122,#3171
"RTN","GMRCGUIU",5,0)
 ;
"RTN","GMRCGUIU",6,0)
GUIC ;Kill variables from GMRCGUIC
"RTN","GMRCGUIU",7,0)
 K GMRC(0),GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCDIAG,GMRCDT,GMRCED,GMRCEDCM
"RTN","GMRCGUIU",8,0)
 K GMRCFL,GMRCFLD,GMRCION,GMRCLNO,GMRCNATO,GMRCNT,GMRCORTX,GMRCPL
"RTN","GMRCGUIU",9,0)
 K GMRCPROC,GMRCRQT,GMRCS38,GMRCSS,GMRCSVC,GMRCTRLC,GMRCTYPE,GMRCURG
"RTN","GMRCGUIU",10,0)
 K GMRCX,LN,GMRCADUZ,ORDG,RMBED,VISIT
"RTN","GMRCGUIU",11,0)
 K GMRCITM,GMRCMSG,GMRCND1,GMRCNOD,GMRCPROV,GMRCOUNT,GMRCGUIF,GMRCREQ
"RTN","GMRCGUIU",12,0)
 K GMRCSS,GMRCPROC,GMRCURG,GMRCURGY,GMRCPL,GMRCATN,GMRCINO,GMRCREQ
"RTN","GMRCGUIU",13,0)
 K GMRCDIAG,GMRCDXCD,GMRCPROV,ND,NDX
"RTN","GMRCGUIU",14,0)
 K XQAKILL
"RTN","GMRCGUIU",15,0)
 Q
"RTN","GMRCGUIU",16,0)
SETDA(GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT,GMRCION,GMRCDIAG,GMRCDXCD)  ;Set DA in ^GMR(123,GMRCO,40
"RTN","GMRCGUIU",17,0)
 N X
"RTN","GMRCGUIU",18,0)
 S X=""
"RTN","GMRCGUIU",19,0)
 I +GMRCSS S X="1////^S X=+GMRCSS;.1///@;"
"RTN","GMRCGUIU",20,0)
 I +GMRCPROC S X=X_"4////^S X=GMRCPROC;.1///@;"
"RTN","GMRCGUIU",21,0)
 I +GMRCURG S X=X_"5////^S X=GMRCURG;"
"RTN","GMRCGUIU",22,0)
 I +GMRCPL S X=X_"6////^S X=GMRCPL;"
"RTN","GMRCGUIU",23,0)
 I +GMRCATN S X=X_"7////^S X=GMRCATN;"
"RTN","GMRCGUIU",24,0)
 I $G(GMRCATN)="@" S X=X_"7///@;"
"RTN","GMRCGUIU",25,0)
 I $L(GMRCION) S X=X_"14///^S X=GMRCION;"
"RTN","GMRCGUIU",26,0)
 I $L(GMRCDIAG) D 
"RTN","GMRCGUIU",27,0)
 . I GMRCDIAG="@" S X=X_"30///@;30.1///@;" Q
"RTN","GMRCGUIU",28,0)
 . S X=X_"30////^S X=GMRCDIAG;"
"RTN","GMRCGUIU",29,0)
 I $L(GMRCDXCD) S X=X_"30.1////^S X=GMRCDXCD;"
"RTN","GMRCGUIU",30,0)
 I $L(X) S X=$E(X,1,$L(X)-1)
"RTN","GMRCGUIU",31,0)
 Q X
"RTN","GMRCGUIU",32,0)
 ;
"RTN","GMRCGUIU",33,0)
COMMENT(GMRCO,MSG,ND,GMRCDA)    ;File comments from GUI edits
"RTN","GMRCGUIU",34,0)
 N Y,GMRCND
"RTN","GMRCGUIU",35,0)
 S GMRCDA=$$ADDCM^GMRCEDT4(GMRCO),GMRCA=20
"RTN","GMRCGUIU",36,0)
 D AUDIT0^GMRCEDT4(GMRCDA,GMRCO)
"RTN","GMRCGUIU",37,0)
 S Y=$$FMTE^XLFDT(DT,"1D"),GMRCFLD(40)="COMMENT ADDED: "_Y_"^"_GMRCDA
"RTN","GMRCGUIU",38,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,40,GMRCDA,1,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIU",39,0)
 S ^GMR(123,GMRCO,40,GMRCDA,1,0)="^^"_(GMRCNT-1)_"^"_(GMRCNT-1)_"^"_GMRCDT_"^"
"RTN","GMRCGUIU",40,0)
 Q
"RTN","GMRCGUIU",41,0)
 ;
"RTN","GMRCGUIU",42,0)
SENDCOMT(GMRCO,ND1)     ;Get comments
"RTN","GMRCGUIU",43,0)
 N NDX,NDY,CMTDT,SENDR,TYPE
"RTN","GMRCGUIU",44,0)
 S NDX=0,CMTDT="",SENDR=""
"RTN","GMRCGUIU",45,0)
 S NDX=0 F  S NDX=$O(^GMR(123,GMRCO,40,NDX)) Q:NDX?1A.E!(NDX="")  S TYPE=$P(^GMR(123,GMRCO,40,NDX,0),"^",2) I $S(TYPE=19:1,TYPE=20:1,1:0) S TYPE(TYPE,NDX)=""
"RTN","GMRCGUIU",46,0)
 I $O(TYPE(19,0)) S @GLOBAL@(ND1,0)="~DENY COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",47,0)
 .S NDX=0 F  S NDX=$O(TYPE(19,NDX)) Q:NDX=""   D
"RTN","GMRCGUIU",48,0)
 ..S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^(0),"^",4),0),"^",1),1:"Missing Data")
"RTN","GMRCGUIU",49,0)
 ..S @GLOBAL@(ND1,0)="t"_"CANCELLED: "_CMTDT_" BY: "_SENDR,ND1=ND1+1,NDY=0
"RTN","GMRCGUIU",50,0)
 ..S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND1,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",51,0)
 ..S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",52,0)
 ..Q
"RTN","GMRCGUIU",53,0)
 .Q
"RTN","GMRCGUIU",54,0)
 S NDX=0 F  S NDX=$O(TYPE(20,NDX)) Q:NDX=""  S @GLOBAL@(ND1,0)="~ADDED COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",55,0)
 .S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^GMR(123,GMRCO,40,NDX,0),"^",4),0),"^",1),1:"UNKNOWN")
"RTN","GMRCGUIU",56,0)
 .S @GLOBAL@(ND1,0)="t"_"COMMENT on "_CMTDT_" BY: "_SENDR,ND1=ND1+1
"RTN","GMRCGUIU",57,0)
 .S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",58,0)
 .S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",59,0)
 .Q
"RTN","GMRCGUIU",60,0)
 Q
"RTN","GMRCGUIU",61,0)
GETMED(GMRCIFN,GMRCRES) ;return available med results for proc request
"RTN","GMRCGUIU",62,0)
 ; input: 
"RTN","GMRCGUIU",63,0)
 ;    GMRCIFN - ien from file 123
"RTN","GMRCGUIU",64,0)
 ;    GMRCRES - variable passed in by reference used for output
"RTN","GMRCGUIU",65,0)
 ; output: 
"RTN","GMRCGUIU",66,0)
 ;     GMRCRES(x) = result_name^date^summary^result_ref
"RTN","GMRCGUIU",67,0)
 ;      example:
"RTN","GMRCGUIU",68,0)
 ;       GMRCRES(1)="19;MCAR(691.5,^EKG^JUN 30,1999@15:52^ABNORMAL"
"RTN","GMRCGUIU",69,0)
 N CNT,ROOT,PROC,S5,DFN,I
"RTN","GMRCGUIU",70,0)
 N MCARCODE,MCARDT,MCESKEY,MCKEYCAR,MCFILE
"RTN","GMRCGUIU",71,0)
 S PROC=+$P($G(^GMR(123,GMRCIFN,0)),U,8)
"RTN","GMRCGUIU",72,0)
 I 'PROC Q  ;no procedure there
"RTN","GMRCGUIU",73,0)
 S ROOT=$$GET1^DIQ(697.2,+$P(^GMR(123.3,PROC,0),U,5),1)
"RTN","GMRCGUIU",74,0)
 I '$L(ROOT) Q  ;proc not set up for med resulting
"RTN","GMRCGUIU",75,0)
 S S5=ROOT D EN^MCARPS2(+$P(^GMR(123,GMRCIFN,0),U,2))
"RTN","GMRCGUIU",76,0)
 I '$D(^TMP("OR",$J,"MCAR","OT")) Q  ;no results available
"RTN","GMRCGUIU",77,0)
 S CNT=0,I=0
"RTN","GMRCGUIU",78,0)
 F  S CNT=$O(^TMP("OR",$J,"MCAR","OT",CNT)) Q:'CNT  D
"RTN","GMRCGUIU",79,0)
 . N DATA S DATA=^TMP("OR",$J,"MCAR","OT",CNT)
"RTN","GMRCGUIU",80,0)
 . Q:$D(^GMR(123,"R",$P(DATA,U,2)_";"_ROOT_","))
"RTN","GMRCGUIU",81,0)
 . Q:$$SCRNDRFT^GMRCMED($P(DATA,U,2),$P(ROOT,"(",2))  ;screen draft rpts
"RTN","GMRCGUIU",82,0)
 . S I=I+1
"RTN","GMRCGUIU",83,0)
 . S GMRCRES(I)=$P(DATA,U,2)_";"_ROOT_","_U_$P(DATA,U)_U_$P(DATA,U,6,7)
"RTN","GMRCGUIU",84,0)
 . Q
"RTN","GMRCGUIU",85,0)
 K MCARCODE,MCARDT,MCESKEY,MCKEYCAR,MCFILE
"RTN","GMRCGUIU",86,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","GMRCGUIU",87,0)
 Q
"RTN","GMRCGUIU",88,0)
GETRES(GMRCO,GMRCAR) ;return array of associated med rslts
"RTN","GMRCGUIU",89,0)
 ; DBIA #: ?
"RTN","GMRCGUIU",90,0)
 ; Input:
"RTN","GMRCGUIU",91,0)
 ;   GMRCO - ien from file 123
"RTN","GMRCGUIU",92,0)
 ;   GMRCAR - variable passed by ref to return array in
"RTN","GMRCGUIU",93,0)
 ; Output:
"RTN","GMRCGUIU",94,0)
 ;   GMRCAR(x)=result_ref^result_name^date^impression
"RTN","GMRCGUIU",95,0)
 ;    Example:
"RTN","GMRCGUIU",96,0)
 ;      GMRCAR(1)="19;MCAR(691.5,^EKG^JUN 30,1999@15:52^ABNORMAL"
"RTN","GMRCGUIU",97,0)
 N RES,GMRCMCR,CNT,DATA
"RTN","GMRCGUIU",98,0)
 S RES=0,CNT=1
"RTN","GMRCGUIU",99,0)
 F  S RES=$O(^GMR(123,GMRCO,50,RES)) Q:'RES  D
"RTN","GMRCGUIU",100,0)
 . I $G(^GMR(123,GMRCO,50,RES,0))'["MCAR" Q
"RTN","GMRCGUIU",101,0)
 . S GMRCMCR=$$SINGLE^MCAPI(^GMR(123,GMRCO,50,RES,0))
"RTN","GMRCGUIU",102,0)
 . S GMRCAR(CNT)=^GMR(123,GMRCO,50,RES,0)_U
"RTN","GMRCGUIU",103,0)
 . S GMRCAR(CNT)=GMRCAR(CNT)_$P(GMRCMCR,U)_U_$P(GMRCMCR,U,6,7)
"RTN","GMRCGUIU",104,0)
 . S CNT=CNT+1
"RTN","GMRCGUIU",105,0)
 . Q
"RTN","GMRCGUIU",106,0)
 Q
"RTN","GMRCGUIU",107,0)
DISPMED(GMRCRES,GMRCAR) ; display a med result
"RTN","GMRCGUIU",108,0)
 ; Input:
"RTN","GMRCGUIU",109,0)
 ;  GMRCRES - med result var ptr  (e.g. "19;MCAR(691.5")
"RTN","GMRCGUIU",110,0)
 ;  GMRCAR  - array to return output from medicine API
"RTN","GMRCGUIU",111,0)
 ; Output:
"RTN","GMRCGUIU",112,0)
 ;  GMRCAR 
"RTN","GMRCGUIU",113,0)
 ;    - var passed by ref or as global ref to return text of 
"RTN","GMRCGUIU",114,0)
 ;      medicine pkg report
"RTN","GMRCGUIU",115,0)
 ;    Example:  GMRCAR(1)="      PROCEDURE DATE/TIME: 06/30/99 15:52"
"RTN","GMRCGUIU",116,0)
 ;              GMRCAR(2)="        CONFIDENTIAL ECG REPORT"
"RTN","GMRCGUIU",117,0)
 ;              GMRCAR(3...)=
"RTN","GMRCGUIU",118,0)
 D START^ORWRP(80,"EN^MCAPI(GMRCRES)")
"RTN","GMRCGUIU",119,0)
 I '$D(^TMP("ORDATA",$J,1)) D  Q
"RTN","GMRCGUIU",120,0)
 . I $D(GMRCAR) S @GMRCAR@(1)="Unable to locate result." Q
"RTN","GMRCGUIU",121,0)
 . I '$D(GMRCAR) S GMRCAR(1)="Unable to locate result."
"RTN","GMRCGUIU",122,0)
 I $D(GMRCAR) M @GMRCAR=^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",123,0)
 I '$D(GMRCAR) M GMRCAR=^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",124,0)
 K ^TMP("ORDATA",$J,1)
"RTN","GMRCGUIU",125,0)
 Q
"RTN","GMRCGUIU",126,0)
CANDOMED(GMRCIEN,USER) ;can person associate med results?
"RTN","GMRCGUIU",127,0)
 ; GMRCIEN - ien from file 123
"RTN","GMRCGUIU",128,0)
 N PROC
"RTN","GMRCGUIU",129,0)
 I '$D(^GMR(123,GMRCIEN,0)) Q 0  ;bad record
"RTN","GMRCGUIU",130,0)
 S PROC=+$P(^GMR(123,GMRCIEN,0),U,8) I 'PROC Q 0  ;no procedure
"RTN","GMRCGUIU",131,0)
 I '+$P(^GMR(123.3,PROC,0),U,5) Q 0  ;proc not set up
"RTN","GMRCGUIU",132,0)
 Q 1
"RTN","GMRCHL72")
0^13^B13779096
"RTN","GMRCHL72",1,0)
GMRCHL72 ;SLC/DCM - HL-7 formats OBX and NTE segments ;10/12/99  03:53
"RTN","GMRCHL72",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCHL72",3,0)
OBX(GMRCIFN) ;Build the OBX segment of the HL-7 message
"RTN","GMRCHL72",4,0)
 ;GMRCIFN=GMRCIEN - the internal file # of the record from file 123
"RTN","GMRCHL72",5,0)
 S OBXSEGNO=0
"RTN","GMRCHL72",6,0)
 I ORCTRL'="RT",$D(^GMR(123,GMRCIFN,20,0)) S GMRCND=0,GMRCND1=0 D
"RTN","GMRCHL72",7,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","GMRCHL72",8,0)
 . S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND))
"RTN","GMRCHL72",9,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",10,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_"|TX|2000.02^REASON FOR REQUEST^AS4||"
"RTN","GMRCHL72",11,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",12,0)
 . S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",13,0)
 . F  S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND)) Q:GMRCND=""  D
"RTN","GMRCHL72",14,0)
 .. S OBX(OBXSEGNO,GMRCND1)=^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",15,0)
 .. S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",16,0)
 .Q
"RTN","GMRCHL72",17,0)
 I $D(^GMR(123,GMRCIFN,30)) S OBXSEGNO=OBXSEGNO+1 D
"RTN","GMRCHL72",18,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",19,0)
 . N OBXSEG
"RTN","GMRCHL72",20,0)
 . I '$D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",21,0)
 .. S OBXSEG="|TX|^PROVISIONAL DIAGNOSIS^||"_$G(^GMR(123,GMRCIFN,30))
"RTN","GMRCHL72",22,0)
 . I $D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",23,0)
 .. S OBXSEG="|CE|^PROVISIONAL DIAGNOSIS^||"_^GMR(123,GMRCIFN,30.1)_U
"RTN","GMRCHL72",24,0)
 .. S OBXSEG=OBXSEG_$P(^GMR(123,GMRCIFN,30),(" ("_^(30.1)))_U_"I9C"
"RTN","GMRCHL72",25,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_OBXSEG
"RTN","GMRCHL72",26,0)
 Q
"RTN","GMRCHL72",27,0)
 ;
"RTN","GMRCHL72",28,0)
NTE(GMRCFN,GMRCND,GMRCTRL) ;Build the NTE segment of the HL7 message
"RTN","GMRCHL72",29,0)
 ;GMRCND=GMRCOM, an array. GMRCND = flag that a comment exists.
"RTN","GMRCHL72",30,0)
 ;GMRCND(0)= DA = the internal entry in node 40: ^GMR(123,IEN,40,DA
"RTN","GMRCHL72",31,0)
 ;GMRCTRL=HL7 control code from table 119
"RTN","GMRCHL72",32,0)
 Q:'$D(GMRCND(0))  S ND=GMRCND(0)
"RTN","GMRCHL72",33,0)
 S ND2=1,NTE(ND2)="NTE|16|L|"
"RTN","GMRCHL72",34,0)
 I $S($P(^GMR(123,GMRCFN,40,ND,0),"^",2)=6:1,$P(^(0),"^",2)=20:1,$P(^(0),"^",2)=7:1,$P(^(0),"^",2)=5:1,GMRCTRL="XX":1,1:0) D
"RTN","GMRCHL72",35,0)
 .S ND1=0,ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=NTE(ND2)_^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",36,0)
 .F  S ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",37,0)
 .Q
"RTN","GMRCHL72",38,0)
 ;I $P(NTE(1),"|",4)="",$S(GMRCTRL="OD":1,GMRCTRL="OC":1,1:0) S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_$S($P(^(0),"^",2)]"":" BY SERVICE",1:"")
"RTN","GMRCHL72",39,0)
 I GMRCTRL="OD"!(GMRCTRL="OC") D
"RTN","GMRCHL72",40,0)
 . N ACTION S ACTION=$P(^GMR(123,GMRCFN,40,ND,0),"^",2) Q:ACTION=""
"RTN","GMRCHL72",41,0)
 . S ACTION=$$GET1^DIQ(123.1,ACTION,.01)
"RTN","GMRCHL72",42,0)
 . S $P(NTE(1),"|",4)=ACTION_" BY SERVICE"
"RTN","GMRCHL72",43,0)
 I $P(NTE(1),"|",4)="",GMRCTRL="XX" S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_" "_$S($P(^GMR(123,GMRCFN,40,ND,0),"^",6)]"":$P(^GMR(123.5,$P(^GMR(123,GMRCFN,40,ND,0),"^",6),0),"^",1),1:GMRCSSNM)
"RTN","GMRCHL72",44,0)
 K N,ND1,ND2
"RTN","GMRCHL72",45,0)
 Q
"RTN","GMRCHL72",46,0)
OBR(GMRCIEN,RESBY,GMRCACDT) ;Build the OBR segment of the HL-7 message
"RTN","GMRCHL72",47,0)
 ;GMRCIEN=IEN of the consult from file 123
"RTN","GMRCHL72",48,0)
 ;NOTIFY=Person who is notified when consult is ordered/completed
"RTN","GMRCHL72",49,0)
 ;RESBY=Person entering/interpreting result & signing report- GMRCPROV
"RTN","GMRCHL72",50,0)
 K OBR
"RTN","GMRCHL72",51,0)
 N OI,PROCID,PROCNM,STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",52,0)
 ;I +$P(^GMR(123,GMRCIEN,0),"^",5)'>0,$S($D(GMRCSSNM):1,+GMRCGRP("ROOT"):1,1:0) S $P(^(0),"^",5)=$S(+GMRCGRP("ROOT"):GMRCGRP("ROOT"),1:$O(^GMR(123.5,"B",GMRCSSNM,0)))
"RTN","GMRCHL72",53,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12),RESTATUS=$S(STS=1:"X",STS=2:"F",STS=5:"O",STS=6:"I",STS=8:"S",STS=9:"R",1:"X")
"RTN","GMRCHL72",54,0)
 S SERVID=$P(^GMR(123,GMRCIEN,0),"^",5),ORCDT=$P(^(0),"^",7),CONLOC=$P(^(0),"^",10) I CONLOC]"" S CONLOC=$S($P(^ORD(101,CONLOC,0),"^",1)["BEDSIDE":"B",$P(^(0),"^",1)["EMERGENCY":"E",1:"OC")
"RTN","GMRCHL72",55,0)
 S NOTIFY=$P(^GMR(123,GMRCIEN,0),"^",11),CONSVC=$S(+SERVID]"":$P($G(^GMR(123.5,+SERVID,0)),"^",1),1:"")
"RTN","GMRCHL72",56,0)
 I +$P(^GMR(123,+GMRCIEN,0),U,8) D
"RTN","GMRCHL72",57,0)
 . S PROCID=+$P(^GMR(123,+GMRCIEN,0),U,8)
"RTN","GMRCHL72",58,0)
 . S PROCNM=$$GET1^DIQ(123.3,PROCID,.01)
"RTN","GMRCHL72",59,0)
 . S OI=PROCID_U_PROCNM_"^99PRC"
"RTN","GMRCHL72",60,0)
 I '$D(OI) S OI=SERVID_U_CONSVC_"^99CON"
"RTN","GMRCHL72",61,0)
 S HL7DT=$$HL7DT^GMRCHL7($S($G(GMRCACDT):GMRCACDT,1:$$NOW^XLFDT))
"RTN","GMRCHL72",62,0)
 S OBR="OBR||||^^^"_OI_"||||||||||||||"_CONLOC_"|"_NOTIFY_"|||"_HL7DT_"|||"_RESTATUS_$S(RESBY]"":"|||||||"_RESBY,1:"")
"RTN","GMRCHL72",63,0)
 K STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",64,0)
 Q
"RTN","GMRCHL7A")
0^14^B28780212
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM - Receive HL-7 Message form OERR and break it into its components and store it in File 123 ;3/5/99 15:25
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCHL7A",3,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",4,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",5,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",6,0)
 Q X
"RTN","GMRCHL7A",7,0)
 ;
"RTN","GMRCHL7A",8,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",9,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",10,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",11,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",12,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",13,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",14,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",15,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",16,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",17,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",18,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",19,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",20,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",21,0)
 Q
"RTN","GMRCHL7A",22,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",23,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",24,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",25,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",26,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",27,0)
 ;GMRCPRI=procedure from file ^ORD(101,  
"RTN","GMRCHL7A",28,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",29,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",30,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",31,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",32,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",33,0)
 S GMRCTYPE=$S(GMRCPR="99PRC":"P",1:"C")
"RTN","GMRCHL7A",34,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",35,0)
 I GMRCPR="99PRC" D
"RTN","GMRCHL7A",36,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",37,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";GMR(123.3,",1:"")
"RTN","GMRCHL7A",38,0)
 . Q
"RTN","GMRCHL7A",39,0)
 ;
"RTN","GMRCHL7A",40,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",41,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",42,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",43,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",44,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",45,0)
 Q
"RTN","GMRCHL7A",46,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",47,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",48,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",49,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",50,0)
 Q
"RTN","GMRCHL7A",51,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",52,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",53,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",54,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",55,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",56,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",57,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",58,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",59,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",60,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",61,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",62,0)
 .Q
"RTN","GMRCHL7A",63,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",64,0)
 . I GMRCVTYP="TX" S GMRCPRDG=$P(GMRCMSG,SEP1,6) Q
"RTN","GMRCHL7A",65,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",66,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",67,0)
 .. S GMRCPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","GMRCHL7A",68,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",69,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",70,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",71,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",72,0)
 .Q
"RTN","GMRCHL7A",73,0)
 K LN
"RTN","GMRCHL7A",74,0)
 Q
"RTN","GMRCHL7A",75,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",76,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",77,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",78,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",79,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",80,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",81,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT
"RTN","GMRCHL7A",82,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",83,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4),GMRCMTP=$P(GMRCMSG,SEP1,9)
"RTN","GMRCHL7A",84,0)
 .Q
"RTN","GMRCHL7A",85,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",86,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",87,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",88,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",89,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",90,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",91,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",92,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",93,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",94,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q 
"RTN","GMRCHL7A",95,0)
 .Q
"RTN","GMRCHL7A",96,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",97,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",98,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",99,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B D
"RTN","GMRCHL7A",100,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",101,0)
 . D REJECT^GMRCHL7U(.MSG,"unable to file order")
"RTN","GMRCHL7A",102,0)
 I $D(GMRCXMF) D
"RTN","GMRCHL7A",103,0)
 .;Set GMRCO=to the file number at this site for a new consult/request before sending HL-7 message to CPRS
"RTN","GMRCHL7A",104,0)
 .S GMRCNOD=0 F  S GMRCNOD=$O(@GMRCMSG(ND)) Q:GMRCNOD=""  I $P(@(GMRCMSG(GMRCNOD)),"|",1)="ORC" S $P(@(GMRCMSG(GMRCNOD)),"|",3)=$G(GMRCO) Q
"RTN","GMRCHL7A",105,0)
 .Q
"RTN","GMRCHL7A",106,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",107,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",108,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",109,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",110,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",111,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",112,0)
 Q
"RTN","GMRCHL7A",113,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123, 
"RTN","GMRCHL7A",114,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",115,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",116,0)
 K DIE,DR
"RTN","GMRCHL7A",117,0)
 Q
"RTN","GMRCMED")
0^15^B35624704
"RTN","GMRCMED",1,0)
GMRCMED ;SLC/JFR - MEDICINE INTERFACE ROUTINES; 2/20/01 13:32
"RTN","GMRCMED",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15**;DEC 27, 1997
"RTN","GMRCMED",3,0)
 ;
"RTN","GMRCMED",4,0)
 ; This routine invokes IA #147,#2757,#3160,#3171
"RTN","GMRCMED",5,0)
 ;
"RTN","GMRCMED",6,0)
SET(NUM) ; set selected med result into GMRCMEDR
"RTN","GMRCMED",7,0)
 I NUM<1!(NUM>VALMCNT) D  Q
"RTN","GMRCMED",8,0)
 . W !,$C(7),NUM_" is not a valid selection. "
"RTN","GMRCMED",9,0)
 . W !,"Choose a number between 1 and "_VALMCNT
"RTN","GMRCMED",10,0)
 I '$D(^TMP("GMRCR",$J,"DT",NUM,1)) D  Q
"RTN","GMRCMED",11,0)
 . D EXAC^GMRCADC("The displayed item is not selectable")
"RTN","GMRCMED",12,0)
 I $D(GMRCMEDR) D RESETIT(GMRCMEDR)
"RTN","GMRCMED",13,0)
 S GMRCMEDR=NUM
"RTN","GMRCMED",14,0)
 D CNTRL^VALM10(NUM,1,80,IORVON,IORVOFF)
"RTN","GMRCMED",15,0)
 D WRITE^VALM10(NUM)
"RTN","GMRCMED",16,0)
 S VALMBCK=""
"RTN","GMRCMED",17,0)
 Q
"RTN","GMRCMED",18,0)
RESETIT(NUM) ;return prev. selected number to normal video 
"RTN","GMRCMED",19,0)
 D CNTRL^VALM10(NUM,1,80,IOINORM,IOINORM)
"RTN","GMRCMED",20,0)
 D WRITE^VALM10(NUM)
"RTN","GMRCMED",21,0)
 S VALMBCK="" K GMRCSEL
"RTN","GMRCMED",22,0)
 Q
"RTN","GMRCMED",23,0)
RESULTS(ROOT,GMRCDFN) ;get list of results from Medicine
"RTN","GMRCMED",24,0)
 ; ROOT = "MCAR(691","MCAR(691.5" etc. (global root w/o comma)
"RTN","GMRCMED",25,0)
 ; return list formatted in ^TMP("GMRCMC",$J
"RTN","GMRCMED",26,0)
 N S5,CNT,REC
"RTN","GMRCMED",27,0)
 K ^TMP("GMRCMC",$J)
"RTN","GMRCMED",28,0)
 S S5=ROOT D EN^MCARPS2(GMRCDFN)
"RTN","GMRCMED",29,0)
 I '$D(^TMP("OR",$J,"MCAR")) D  Q
"RTN","GMRCMED",30,0)
 . ;D EXAC^GMRCADC("No results found for"_$P(ROOT,U,2))
"RTN","GMRCMED",31,0)
 S CNT=1,REC=0
"RTN","GMRCMED",32,0)
 F  S REC=$O(^TMP("OR",$J,"MCAR","OT",REC)) Q:'REC  D
"RTN","GMRCMED",33,0)
 . N MCDATA,DATA,ONEDATA
"RTN","GMRCMED",34,0)
 . S MCDATA=^TMP("OR",$J,"MCAR","OT",REC),DATA=""
"RTN","GMRCMED",35,0)
 . Q:$D(^GMR(123,"R",$P(MCDATA,U,2)_";"_ROOT_","))
"RTN","GMRCMED",36,0)
 . Q:$$SCRNDRFT($P(MCDATA,U,2),$P(ROOT,"(",2))
"RTN","GMRCMED",37,0)
 . S DATA=$$SETSTR^VALM1(CNT,DATA,2,$L(REC))
"RTN","GMRCMED",38,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U),DATA,6,23)
"RTN","GMRCMED",39,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U,6),DATA,30,$L($P(MCDATA,U,6)))
"RTN","GMRCMED",40,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U,7),DATA,50,$L($P(MCDATA,U,7)))
"RTN","GMRCMED",41,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,0)=DATA
"RTN","GMRCMED",42,0)
 . ;S ONEDATA=REC_U_$P(MCDATA,U,2)_";"_ROOT_","_U_$P(MCDATA,U,3,5)
"RTN","GMRCMED",43,0)
 . ;S ONEDATA=ONEDATA_U_$P(MCDATA,U,11)
"RTN","GMRCMED",44,0)
 . S ONEDATA=$P(MCDATA,U,2)_";"_ROOT_","
"RTN","GMRCMED",45,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,1)=ONEDATA
"RTN","GMRCMED",46,0)
 . S CNT=CNT+1
"RTN","GMRCMED",47,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","GMRCMED",48,0)
 Q 
"RTN","GMRCMED",49,0)
PHDR ;set protocols into actions
"RTN","GMRCMED",50,0)
 S VALMSG=$$CJ^XLFSTR("Select action or item number    ?? for help",80)
"RTN","GMRCMED",51,0)
 S XQORM("M")=3
"RTN","GMRCMED",52,0)
 D SHOW^VALM
"RTN","GMRCMED",53,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRCACT SELECT MED RESULT",0))_"^1:"_VALMCNT
"RTN","GMRCMED",54,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",55,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",56,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",57,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCMED",58,0)
 S XQORM("KEY","AR")=$O(^ORD(101,"B","GMRCACT ASSOCIATE RESULTS",0))_"^1"
"RTN","GMRCMED",59,0)
 S XQORM("KEY","DR")=$O(^ORD(101,"B","GMRCACT DISPLAY MED RESULT",0))_"^1"
"RTN","GMRCMED",60,0)
 Q
"RTN","GMRCMED",61,0)
 ;
"RTN","GMRCMED",62,0)
SELECT(CNT) ;grab an item from list
"RTN","GMRCMED",63,0)
 N DIR,DUOUT,DTOUT,DIRUT,X,Y
"RTN","GMRCMED",64,0)
 S DIR(0)="NO^1:"_CNT,DIR("A")="Select item"
"RTN","GMRCMED",65,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","GMRCMED",66,0)
 Q +Y
"RTN","GMRCMED",67,0)
 ;
"RTN","GMRCMED",68,0)
DISPRES(ITEM) ;
"RTN","GMRCMED",69,0)
 I '+$G(^TMP("GMRCR",$J,"DT",1,1)) D  Q  ; no result there
"RTN","GMRCMED",70,0)
 . D EXAC^GMRCADC("There are no results to display")
"RTN","GMRCMED",71,0)
 N GMRCDFN
"RTN","GMRCMED",72,0)
 I '$G(ITEM),'$G(GMRCMEDR) D  Q:'ITEM
"RTN","GMRCMED",73,0)
 . S ITEM=$$SELECT(VALMCNT)
"RTN","GMRCMED",74,0)
 . D SET(ITEM)
"RTN","GMRCMED",75,0)
 I $G(GMRCMEDR) S ITEM=GMRCMEDR
"RTN","GMRCMED",76,0)
 N I,GMRCRES,GMRCDFN,GMRCVTIT
"RTN","GMRCMED",77,0)
 S GMRCRES=$G(^TMP("GMRCR",$J,"DT",ITEM,1))
"RTN","GMRCMED",78,0)
 Q:'$L(GMRCRES)
"RTN","GMRCMED",79,0)
 M ^TMP("GMRCR",$J,"DTSV")=^TMP("GMRCR",$J,"DT")
"RTN","GMRCMED",80,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCMED",81,0)
 S GMRCDFN=$G(DFN)
"RTN","GMRCMED",82,0)
 D START^ORWRP(80,"EN^MCAPI(GMRCRES)")
"RTN","GMRCMED",83,0)
 I '$D(^TMP("ORDATA",$J,1)) D  Q
"RTN","GMRCMED",84,0)
 . S ^TMP("GMRCR",$J,"DTLIST",1,0)="Unable to locate result"
"RTN","GMRCMED",85,0)
 S I=0 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:'I  D
"RTN","GMRCMED",86,0)
 . S ^TMP("GMRCR",$J,"DTLIST",I,0)=^TMP("ORDATA",$J,1,I)
"RTN","GMRCMED",87,0)
 K ^TMP("ORDATA",$J) ; clean up from OR WORKSTATION
"RTN","GMRCMED",88,0)
 S DFN=$S(+GMRCDFN:GMRCDFN,$G(ORVP):+ORVP,1:0)
"RTN","GMRCMED",89,0)
 S GMRCVTIT="Medicine Result Display"
"RTN","GMRCMED",90,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DTLIST",999999),-1)
"RTN","GMRCMED",91,0)
 D EN^VALM("GMRC DETAILED DISPLAY")
"RTN","GMRCMED",92,0)
 M ^TMP("GMRCR",$J,"DT")=^TMP("GMRCR",$J,"DTSV")
"RTN","GMRCMED",93,0)
 K ^TMP("GMRCR",$J,"DTSV")
"RTN","GMRCMED",94,0)
 S VALMBCK="R",VALMCNT=$O(^TMP("GMRCR",$J,"DT",999999),-1)
"RTN","GMRCMED",95,0)
 Q
"RTN","GMRCMED",96,0)
 ;
"RTN","GMRCMED",97,0)
AR(ITEM) ;associate specific result and complete consult
"RTN","GMRCMED",98,0)
 I '+$G(^TMP("GMRCR",$J,"DT",1,1)) D  Q  ; no result there
"RTN","GMRCMED",99,0)
 . D EXAC^GMRCADC("There are no results to associate")
"RTN","GMRCMED",100,0)
 N DIR,X,Y,RESTXT,RESULT
"RTN","GMRCMED",101,0)
 I '$G(ITEM),'$G(GMRCMEDR) D  Q:'ITEM
"RTN","GMRCMED",102,0)
 . S ITEM=$$SELECT(VALMCNT)
"RTN","GMRCMED",103,0)
 . D SET(ITEM)
"RTN","GMRCMED",104,0)
 I $G(GMRCMEDR) S ITEM=GMRCMEDR
"RTN","GMRCMED",105,0)
 D FULL^VALM1
"RTN","GMRCMED",106,0)
 S RESTXT=$E(^TMP("GMRCR",$J,"DT",ITEM,0),6,80)
"RTN","GMRCMED",107,0)
 S RESULT=^TMP("GMRCR",$J,"DT",ITEM,1) Q:'+RESULT
"RTN","GMRCMED",108,0)
 I $D(^GMR(123,"R",RESULT)) D  Q
"RTN","GMRCMED",109,0)
 . D EXAC^GMRCADC("This result is already associated with a procedure.")
"RTN","GMRCMED",110,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","GMRCMED",111,0)
 S DIR("A",1)="",DIR("A",2)="   "_RESTXT,DIR("A",3)=""
"RTN","GMRCMED",112,0)
 S DIR("A")="Are you sure you want to associate this result? "
"RTN","GMRCMED",113,0)
 D ^DIR I Y<1 Q
"RTN","GMRCMED",114,0)
 D MEDCOMP(GMRCO,RESULT,$$NOW^XLFDT,DUZ)
"RTN","GMRCMED",115,0)
 Q
"RTN","GMRCMED",116,0)
MEDCOMP(GMRCDA,GMRCRSLT,GMRCAD,GMRCORNP,GMRCALRT) ;add medicine result
"RTN","GMRCMED",117,0)
 ; update status and send alerts
"RTN","GMRCMED",118,0)
 ;  Input:
"RTN","GMRCMED",119,0)
 ;   GMRCDA - ien from file 123
"RTN","GMRCMED",120,0)
 ;   GMRCRSLT - medicine result in var ptr form (e.g. "19;MCAR(691.5,")
"RTN","GMRCMED",121,0)
 ;   GMRCAD   - FM date/time of action (optional)
"RTN","GMRCMED",122,0)
 ;   GMRCORNP - DUZ of person taking action
"RTN","GMRCMED",123,0)
 ;   GMRCALRT - array of users to receive alert  (optional)
"RTN","GMRCMED",124,0)
 ;
"RTN","GMRCMED",125,0)
 I '$D(GMRCDA)!'$D(GMRCRSLT) Q
"RTN","GMRCMED",126,0)
 N GMRCO,GMRCSTS,GMRCA,GMRCDR,GMRCTYP,MSG
"RTN","GMRCMED",127,0)
 S GMRCO=GMRCDA,GMRCA=10,GMRCSTS=2
"RTN","GMRCMED",128,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;11////^S X=GMRCRSLT"
"RTN","GMRCMED",129,0)
 D STATUS^GMRCP
"RTN","GMRCMED",130,0)
 I $D(GMRCAD) D AUDIT^GMRCP
"RTN","GMRCMED",131,0)
 I '$D(GMRCAD) D AUDIT0^GMRCP
"RTN","GMRCMED",132,0)
 D ADDRSLT^GMRCTIUA(GMRCDA,GMRCRSLT)
"RTN","GMRCMED",133,0)
 S MSG="NEW RESULT ASSOCIATED",GMRCDFN=$P(^GMR(123,GMRCO,0),U,2)
"RTN","GMRCMED",134,0)
 D MSG^GMRCP(GMRCDFN,MSG,GMRCDA,23,.GMRCALRT,1)
"RTN","GMRCMED",135,0)
 S GMRCTYP=$P(^GMR(123,+GMRCDA,0),U,17)
"RTN","GMRCMED",136,0)
 D EN^GMRCHL7(GMRCDFN,GMRCDA,GMRCTYP,"","RE",$G(GMRCORNP),"")
"RTN","GMRCMED",137,0)
 Q
"RTN","GMRCMED",138,0)
REFRESH(GMRCIEN) ;update list of available results
"RTN","GMRCMED",139,0)
 N MCROOT,MCPROC,GMRCPROC
"RTN","GMRCMED",140,0)
 I $G(GMRCMEDR) D RESETIT(GMRCMEDR)
"RTN","GMRCMED",141,0)
 K ^TMP("GMRCR",$J,"DT"),GMRCMEDR
"RTN","GMRCMED",142,0)
 S GMRCPROC=$P(^GMR(123,GMRCIEN,0),"^",8)
"RTN","GMRCMED",143,0)
 S MCROOT=$$GET1^DIQ(697.2,+$P(^GMR(123.3,+GMRCPROC,0),U,5),1)
"RTN","GMRCMED",144,0)
 D RESULTS^GMRCMED(MCROOT,$P(^GMR(123,+GMRCIEN,0),U,2))
"RTN","GMRCMED",145,0)
 I '$O(^TMP("GMRCR",$J,"DT",0)) D
"RTN","GMRCMED",146,0)
 . S ^TMP("GMRCR",$J,"DT",1,0)="No further results to associate"
"RTN","GMRCMED",147,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",""),-1)
"RTN","GMRCMED",148,0)
 S VALMBCK="R"
"RTN","GMRCMED",149,0)
 Q
"RTN","GMRCMED",150,0)
 ;
"RTN","GMRCMED",151,0)
SCRNDRFT(GMRCMCDA,GMRCMCFL) ;screen out draft or marked for del med results
"RTN","GMRCMED",152,0)
 ; Input:
"RTN","GMRCMED",153,0)
 ;   GMRCDA   - ien from a MEDICINE file
"RTN","GMRCMED",154,0)
 ;   GMRCMCFL - file # from MEDICINE  (e.g. 691, 691.5, 699 etc.)
"RTN","GMRCMED",155,0)
 ; Output: Boolean 1=screen it out 0=include it
"RTN","GMRCMED",156,0)
 ;
"RTN","GMRCMED",157,0)
 N GMRCMCST,GMRCMFD
"RTN","GMRCMED",158,0)
 I '$D(GMRCMCDA)!('$D(GMRCMCFL)) Q 0
"RTN","GMRCMED",159,0)
 S GMRCMCST=$$GET1^DIQ(GMRCMCFL,GMRCMCDA,1506,"I") ;get release code
"RTN","GMRCMED",160,0)
 S GMRCMCST=$S(GMRCMCST="D":0,GMRCMCST="PD":0,1:1) ;no D or PD
"RTN","GMRCMED",161,0)
 S GMRCMFD=$$GET1^DIQ(GMRCMCFL,GMRCMCDA,1511,"I") ;marked for del?
"RTN","GMRCMED",162,0)
 I GMRCMFD=1 Q 1 ;marked for del
"RTN","GMRCMED",163,0)
 I GMRCMCST=0 Q 1 ;screen out draft or prob draft
"RTN","GMRCMED",164,0)
 Q 0
"RTN","GMRCMER")
0^16^B3351189
"RTN","GMRCMER",1,0)
GMRCMER ;SLC/DCM - Print Medicine Results in List Manager Format ;4/30/98  10:05
"RTN","GMRCMER",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,15**;DEC 27, 1997
"RTN","GMRCMER",3,0)
 ;
"RTN","GMRCMER",4,0)
EN ; -- main entry point for GMRC ASSOCIATE RESULTS
"RTN","GMRCMER",5,0)
 D EN^VALM("GMRC ASSOCIATE RESULTS")
"RTN","GMRCMER",6,0)
 Q
"RTN","GMRCMER",7,0)
 ;
"RTN","GMRCMER",8,0)
HDRAR ; -- header code uses Detailed Display header to format VALMHDR
"RTN","GMRCMER",9,0)
 N GMRCVTIT
"RTN","GMRCMER",10,0)
 S GMRCVTIT="Procedure/Medicine Resulting"
"RTN","GMRCMER",11,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP
"RTN","GMRCMER",12,0)
 D HDR^GMRCSLDT
"RTN","GMRCMER",13,0)
 S VALMHDR(2)=$$CJ^XLFSTR("Available Medicine Results",80)
"RTN","GMRCMER",14,0)
 Q
"RTN","GMRCMER",15,0)
 ;
"RTN","GMRCMER",16,0)
HDR ;header for results display
"RTN","GMRCMER",17,0)
 D HDR^GMRCSLDT
"RTN","GMRCMER",18,0)
 Q
"RTN","GMRCMER",19,0)
 ;
"RTN","GMRCMER",20,0)
INITAR ; -- init variables and list array for ASSOCIATE RESULTS
"RTN","GMRCMER",21,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",22,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",999999),-1)
"RTN","GMRCMER",23,0)
 Q
"RTN","GMRCMER",24,0)
INIT ; -- init variables and list array for RESULTS DISPLAY
"RTN","GMRCMER",25,0)
 K ^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",26,0)
 S DSPLINE=0,VARMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCMER",27,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCMER",28,0)
 S VALMCNT=LINE-1
"RTN","GMRCMER",29,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCMER",30,0)
 Q
"RTN","GMRCMER",31,0)
 ;
"RTN","GMRCMER",32,0)
HELP ; -- help code for display actions
"RTN","GMRCMER",33,0)
 D HELP^GMRCSLDT
"RTN","GMRCMER",34,0)
 Q
"RTN","GMRCMER",35,0)
 ;
"RTN","GMRCMER",36,0)
EXIT ; -- exit code
"RTN","GMRCMER",37,0)
 K ^TMP("GMRCR",$J,"DT"),^TMP("GMRCR",$J,"DTLIST")
"RTN","GMRCMER",38,0)
 S:$D(GMRCLCT) VALMCNT=GMRCLCT
"RTN","GMRCMER",39,0)
 K GLOBAL,GMRCMODE,GMRCND,GMRCSGAD,GMRCCSIG,GMRCCSDT,GMRCSIGT,GMRCSR,GMRCSIGM,GMRCCTIT,GMRCLCT,GMRCADD,GMRCADDT,GMRCSDT,GMRCSIG,GMRCTUFN,ND,ND1
"RTN","GMRCMER",40,0)
 Q
"RTN","GMRCMER",41,0)
 ;
"RTN","GMRCP5A")
0^28^B56916285
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - TIU Results) ;11/21/00 15:45
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15**;Dec 27, 1997
"RTN","GMRCP5A",3,0)
 ;
"RTN","GMRCP5A",4,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI) ;
"RTN","GMRCP5A",5,0)
 ;
"RTN","GMRCP5A",6,0)
 ; Input Arguments:
"RTN","GMRCP5A",7,0)
 ;
"RTN","GMRCP5A",8,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",9,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",10,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",12,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",13,0)
 ;
"RTN","GMRCP5A",14,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",15,0)
 ;
"RTN","GMRCP5A",16,0)
 I GMRCGUI D  Q
"RTN","GMRCP5A",17,0)
 . D FORMAT(80)
"RTN","GMRCP5A",18,0)
 . D ASSMBL^GMRCP5C(GMRCGUI,80)
"RTN","GMRCP5A",19,0)
 . F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",20,0)
 . K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5A",21,0)
 . Q
"RTN","GMRCP5A",22,0)
 ;
"RTN","GMRCP5A",23,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",24,0)
 ;
"RTN","GMRCP5A",25,0)
 U IO D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM),PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",26,0)
 ;
"RTN","GMRCP5A",27,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",28,0)
 ;
"RTN","GMRCP5A",29,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",30,0)
 ;
"RTN","GMRCP5A",31,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5A",32,0)
 F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",33,0)
 Q
"RTN","GMRCP5A",34,0)
 ;
"RTN","GMRCP5A",35,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",36,0)
 ;
"RTN","GMRCP5A",37,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",38,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",39,0)
 N GMRCFTR,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",40,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",41,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",42,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",43,0)
 ;
"RTN","GMRCP5A",44,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",45,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",46,0)
 Q:'(DFN)
"RTN","GMRCP5A",47,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",48,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",49,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",50,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",51,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",52,0)
 ;
"RTN","GMRCP5A",53,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",54,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",55,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",56,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",57,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",58,0)
 ;
"RTN","GMRCP5A",59,0)
 I $P(GMRCRD,U,12)=2!(TIUFLG) D
"RTN","GMRCP5A",60,0)
 . D PRINT^GMRCTIUP(GMRCIFN,0,0)
"RTN","GMRCP5A",61,0)
 ;
"RTN","GMRCP5A",62,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",63,0)
 .;
"RTN","GMRCP5A",64,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",65,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",66,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",67,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",68,0)
 ;
"RTN","GMRCP5A",69,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",70,0)
 ;
"RTN","GMRCP5A",71,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",72,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",73,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",74,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",75,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",76,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",77,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",78,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",79,0)
 ;
"RTN","GMRCP5A",80,0)
 I $P(GMRCRD,U,12)=1  D 
"RTN","GMRCP5A",81,0)
 . D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",82,0)
 I '$D(^TMP("GMRCR",$J,"RES")),'$D(^("MCAR")) D
"RTN","GMRCP5A",83,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",84,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",85,0)
 ;
"RTN","GMRCP5A",86,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",87,0)
 .;
"RTN","GMRCP5A",88,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",89,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT
"RTN","GMRCP5A",90,0)
 ..N GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV,GMRCENT,GMRCVIS,GMRCVLOC,GMRCNODT
"RTN","GMRCP5A",91,0)
 ..;
"RTN","GMRCP5A",92,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT","GMRCVIS","GMRCENT","GMRCVLOC","GMRCNODT" D
"RTN","GMRCP5A",93,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",94,0)
 ..;
"RTN","GMRCP5A",95,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",96,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",97,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" continued.")
"RTN","GMRCP5A",98,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",99,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",100,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",101,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",102,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",103,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",104,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",105,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",106,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",107,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",108,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",109,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",110,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",111,0)
 ..;extra signers
"RTN","GMRCP5A",112,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",113,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",114,0)
 ... D SUB("F","RES",GMRCNDX," Receipt acknowledged by: ")
"RTN","GMRCP5A",115,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",116,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",117,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",118,0)
 ..;
"RTN","GMRCP5A",119,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",120,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5A",121,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0))
"RTN","GMRCP5A",122,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",123,0)
 ..I $L($G(GMRCENT)) D
"RTN","GMRCP5A",124,0)
 ...S GMRCX="         Entry Date: "_$$EXDT($G(GMRCENT))
"RTN","GMRCP5A",125,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",126,0)
 ..I $L($G(GMRCNODT)) D
"RTN","GMRCP5A",127,0)
 ...Q:$$EXDT($G(GMRCNODT))=$$EXDT($G(GMRCENT)) 
"RTN","GMRCP5A",128,0)
 ...S GMRCX="Date/Time of result: "_$$EXDT($G(GMRCNODT))
"RTN","GMRCP5A",129,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",130,0)
 ..I $L($G(GMRCVIS)) D
"RTN","GMRCP5A",131,0)
 ...S GMRCX="              Visit: "_$$EXDT($G(GMRCVIS))
"RTN","GMRCP5A",132,0)
 ...I $L($G(GMRCVLOC)) S GMRCX=GMRCX_"   "_GMRCVLOC
"RTN","GMRCP5A",133,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",134,0)
 ..I $L($G(GMRCVLOC)) S GMRCX=GMRCVLOC
"RTN","GMRCP5A",135,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",136,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",137,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",138,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",139,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",140,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",141,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",142,0)
 ..;
"RTN","GMRCP5A",143,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",144,0)
 ..;
"RTN","GMRCP5A",145,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",146,0)
 ;
"RTN","GMRCP5A",147,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",148,0)
 ;
"RTN","GMRCP5A",149,0)
 Q
"RTN","GMRCP5A",150,0)
 ;
"RTN","GMRCP5A",151,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",152,0)
 ;
"RTN","GMRCP5A",153,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",154,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",155,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",156,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5A",157,0)
 ;
"RTN","GMRCP5A",158,0)
CENTER(X) ;
"RTN","GMRCP5A",159,0)
 ;
"RTN","GMRCP5A",160,0)
 N TEXT,COL
"RTN","GMRCP5A",161,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",162,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",163,0)
 Q TEXT
"RTN","GMRCP5A",164,0)
 ;
"RTN","GMRCP5A",165,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",166,0)
 ;
"RTN","GMRCP5A",167,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",168,0)
 N LINECNT
"RTN","GMRCP5A",169,0)
 ;
"RTN","GMRCP5A",170,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",171,0)
 ;
"RTN","GMRCP5A",172,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",173,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",174,0)
 ;
"RTN","GMRCP5A",175,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",176,0)
 Q
"RTN","GMRCP5A",177,0)
 ;
"RTN","GMRCP5A",178,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",179,0)
 ;
"RTN","GMRCP5A",180,0)
 N NEXT
"RTN","GMRCP5A",181,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",182,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",183,0)
 Q
"RTN","GMRCP5A",184,0)
 ;
"RTN","GMRCP5A",185,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",186,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",187,0)
 ;
"RTN","GMRCP5B")
0^37^B29816764
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;6/24/98  13:06
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 Q
"RTN","GMRCP5B",5,0)
 ;
"RTN","GMRCP5B",6,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",7,0)
 ;
"RTN","GMRCP5B",8,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",9,0)
 ;
"RTN","GMRCP5B",10,0)
REQUEST ;
"RTN","GMRCP5B",11,0)
 N GMRCX
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",14,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",15,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",16,0)
 ;
"RTN","GMRCP5B",17,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",18,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",19,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"            Care Team: "_GMRCX)
"RTN","GMRCP5B",20,0)
 ;
"RTN","GMRCP5B",21,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",22,0)
 ;
"RTN","GMRCP5B",23,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",24,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",25,0)
 ;
"RTN","GMRCP5B",26,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",27,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",28,0)
 E  D
"RTN","GMRCP5B",29,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",30,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",31,0)
 ;
"RTN","GMRCP5B",32,0)
 Q
"RTN","GMRCP5B",33,0)
PDIAG ;
"RTN","GMRCP5B",34,0)
 ;
"RTN","GMRCP5B",35,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",36,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",37,0)
 ;
"RTN","GMRCP5B",38,0)
 S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",39,0)
 S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",40,0)
 S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",41,0)
 S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",42,0)
 S:$L(GMRCPGR) GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",43,0)
 I '$L(GMRCPGR) S GMRCPGR=$P(GMRCX,U,2) S:$L(GMRCPGR) GMRCPGR="(Phone: "_GMRCPGR_")"
"RTN","GMRCP5B",44,0)
 ;
"RTN","GMRCP5B",45,0)
 S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",46,0)
 S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+GMRCQSTR,8)
"RTN","GMRCP5B",47,0)
 S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",48,0)
 ;
"RTN","GMRCP5B",49,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: ")
"RTN","GMRCP5B",50,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",51,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",54,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",58,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",59,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",60,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",61,0)
 D BLD("PDIAG",1,1,0,GMRCPGR)
"RTN","GMRCP5B",62,0)
 D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",63,0)
 D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",64,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",65,0)
 ;
"RTN","GMRCP5B",66,0)
 Q
"RTN","GMRCP5B",67,0)
 ;
"RTN","GMRCP5B",68,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",69,0)
 ;
"RTN","GMRCP5B",70,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,GMRCX,VAIN,VAPA,VAERR
"RTN","GMRCP5B",71,0)
 ;
"RTN","GMRCP5B",72,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",73,0)
 ;
"RTN","GMRCP5B",74,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",75,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",76,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",77,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",78,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",79,0)
 ;
"RTN","GMRCP5B",80,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",81,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",82,0)
 ;
"RTN","GMRCP5B",83,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",84,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",85,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",86,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",87,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",88,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",89,0)
 E  D
"RTN","GMRCP5B",90,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",91,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",92,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",93,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",94,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",95,0)
 ;
"RTN","GMRCP5B",96,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",97,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",98,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",99,0)
 ;
"RTN","GMRCP5B",100,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",101,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",102,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",103,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",104,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",105,0)
 ;
"RTN","GMRCP5B",106,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",107,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",108,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",109,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",110,0)
 ;
"RTN","GMRCP5B",111,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",112,0)
 ;
"RTN","GMRCP5B",113,0)
 F SUB=0,1 D
"RTN","GMRCP5B",114,0)
 .D BLD("FTR",SUB,1,0,$P($G(^DPT(GMRCDFN,0)),U,1)_"  "_GMRCELIG)
"RTN","GMRCP5B",115,0)
 .I 'SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5B",116,0)
 .I SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET  (Continued)")
"RTN","GMRCP5B",117,0)
 .D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",118,0)
 .D BLD("FTR",SUB,0,20,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",119,0)
 .D BLD("FTR",SUB,0,45,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",120,0)
 ;
"RTN","GMRCP5B",121,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",122,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX)) BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",123,0)
 ;
"RTN","GMRCP5B",124,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",125,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",126,0)
 ;
"RTN","GMRCP5B",127,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",128,0)
 ;
"RTN","GMRCP5B",129,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",130,0)
 ;
"RTN","GMRCP5B",131,0)
 Q
"RTN","GMRCP5B",132,0)
 ;
"RTN","GMRCP5B",133,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",134,0)
 ;
"RTN","GMRCP5B",135,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",136,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",137,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",138,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",139,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",140,0)
 ;
"RTN","GMRCP5B",141,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",142,0)
 ;
"RTN","GMRCP5B",143,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",144,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",145,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",146,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5B",147,0)
 ;
"RTN","GMRCP5B",148,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",149,0)
 ;
"RTN","GMRCP5B",150,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",151,0)
 ;
"RTN","GMRCP5B",152,0)
 ;
"RTN","GMRCP5B",153,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",154,0)
 ;
"RTN","GMRCP5B",155,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",156,0)
 N LINECNT
"RTN","GMRCP5B",157,0)
 ;
"RTN","GMRCP5B",158,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",159,0)
 ;
"RTN","GMRCP5B",160,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",161,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",162,0)
 ;
"RTN","GMRCP5B",163,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",164,0)
 Q
"RTN","GMRCP5B",165,0)
 ;
"RTN","GMRCP5B",166,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",167,0)
 ;
"RTN","GMRCP5B",168,0)
 N NEXT
"RTN","GMRCP5B",169,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",170,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",171,0)
 Q
"RTN","GMRCP5B",172,0)
 ;
"RTN","GMRCP5B",173,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",174,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",175,0)
 ;
"RTN","GMRCP5D")
0^17^B40989181
"RTN","GMRCP5D",1,0)
GMRCP5D ;SLC/DCM,RJS,JFR - Print Consult form 513 (Gather Data - Addendums, Headers, Service reports and Comments) ;11/21/00 15:00;
"RTN","GMRCP5D",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15**;Dec 27, 1997
"RTN","GMRCP5D",3,0)
 ;
"RTN","GMRCP5D",4,0)
FORMAT(GMRCIFN,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",5,0)
 ;
"RTN","GMRCP5D",6,0)
 I $L($P(GMRCRD,U,15)) D
"RTN","GMRCP5D",7,0)
 .I $O(^TMP("GMRCR",$J,"MCAR",0)) D
"RTN","GMRCP5D",8,0)
 ..N GMRCSVC
"RTN","GMRCP5D",9,0)
 ..S GMRCSVC=$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1)
"RTN","GMRCP5D",10,0)
 ..S:$L(GMRCSVC) GMRCSVC=GMRCSVC_" "
"RTN","GMRCP5D",11,0)
 ..;
"RTN","GMRCP5D",12,0)
 ..; Medicine Results?
"RTN","GMRCP5D",13,0)
 ..S GMRCR0=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",14,0)
 ...D SUB("H","SREP",GMRCR0,$$CENTER(GMRCSVC_"Service Report #"_GMRCR0_" continued."))
"RTN","GMRCP5D",15,0)
 ...D SUB("H","SREP",GMRCR0," ")
"RTN","GMRCP5D",16,0)
 ...D BLD("SREP",GMRCR0,1,0,$$CENTER("Medicine Package Report"))
"RTN","GMRCP5D",17,0)
 ...D BLD("SREP",GMRCR0,1,0,"")
"RTN","GMRCP5D",18,0)
 ...N LN
"RTN","GMRCP5D",19,0)
 ...S LN=0 F  S LN=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN)) Q:'LN  D
"RTN","GMRCP5D",20,0)
 ....D BLD("SREP",GMRCR0,1,0,$G(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN,0)))
"RTN","GMRCP5D",21,0)
 ;
"RTN","GMRCP5D",22,0)
 ; Build Processing Activities
"RTN","GMRCP5D",23,0)
 S GMRCR0=0 F  S GMRCR0=$O(^GMR(123,GMRCIFN,40,GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",24,0)
 .N GMRCR1,GMRC400,CMT,USER,GMRCDT,RPRV
"RTN","GMRCP5D",25,0)
 .S GMRCR1=+$O(^GMR(123,GMRCIFN,40,GMRCR0,0)) Q:'GMRCR1
"RTN","GMRCP5D",26,0)
 .S GMRC400=$G(^GMR(123,GMRCIFN,40,GMRCR0,0))
"RTN","GMRCP5D",27,0)
 .S CMT=$$PRCMT^GMRCP5B(+$P(GMRC400,U,2)) Q:'$L(CMT)
"RTN","GMRCP5D",28,0)
 .S GMRCDT=$P(GMRC400,U,3) S:'GMRCDT GMRCDT=$P(GMRC400,U,1)
"RTN","GMRCP5D",29,0)
 .S GMRCDT=$$EXDT(GMRCDT)
"RTN","GMRCP5D",30,0)
 .;
"RTN","GMRCP5D",31,0)
 .S RPRV=$$GET1^DIQ(200,+$P(GMRC400,U,4),.01)
"RTN","GMRCP5D",32,0)
 .S:($L(RPRV)) RPRV="Responsible Person: "_RPRV
"RTN","GMRCP5D",33,0)
 .S USER=$$GET1^DIQ(200,+$P(GMRC400,U,5),.01)
"RTN","GMRCP5D",34,0)
 .S USER="Entered by: "_USER_" - "_GMRCDT
"RTN","GMRCP5D",35,0)
 .D SUB("H","COM",GMRCR0,CMT_" Comment ("_USER_") continued.")
"RTN","GMRCP5D",36,0)
 .D SUB("H","COM",GMRCR0," ")
"RTN","GMRCP5D",37,0)
 .D BLD("COM",GMRCR0,1,0,"")
"RTN","GMRCP5D",38,0)
 .D BLD("COM",GMRCR0,1,0,$$CENTER("("_CMT_" Comment)"))
"RTN","GMRCP5D",39,0)
 .D BLD("COM",GMRCR0,1,5,USER)
"RTN","GMRCP5D",40,0)
 .D:($L(RPRV)) BLD("COM",GMRCR0,1,5,RPRV)
"RTN","GMRCP5D",41,0)
 .;
"RTN","GMRCP5D",42,0)
 .N GMRCR2 S GMRCR2=0
"RTN","GMRCP5D",43,0)
 .F  S GMRCR2=$O(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2)) Q:'GMRCR2  D
"RTN","GMRCP5D",44,0)
 ..D BLD("COM",GMRCR0,1,0,$G(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2,0)))
"RTN","GMRCP5D",45,0)
 ;
"RTN","GMRCP5D",46,0)
 Q
"RTN","GMRCP5D",47,0)
 ;
"RTN","GMRCP5D",48,0)
ADDEND(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",49,0)
 ;
"RTN","GMRCP5D",50,0)
 N GMRCADD,GMRCNDX,GMRCR1,GMRCV,TEXT,GMRCX
"RTN","GMRCP5D",51,0)
 ;
"RTN","GMRCP5D",52,0)
 S GMRCADD=0 F  S GMRCADD=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD)) Q:'GMRCADD  D
"RTN","GMRCP5D",53,0)
 .N GMRCSGNM,GMRCNMDT,GMRCTIT,GMRCMODE,GMRCCSDT,GMRCCTIT,GMRCCSGM
"RTN","GMRCP5D",54,0)
 .;
"RTN","GMRCP5D",55,0)
 .F GMRCV="GMRCSGNM","GMRCNMDT","GMRCTIT","GMRCMODE" D
"RTN","GMRCP5D",56,0)
 ..S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",57,0)
 .;
"RTN","GMRCP5D",58,0)
 . F GMRCV="GMRCCSDT","GMRCCTIT","GMRCCSGM","GMRCCSIG" D
"RTN","GMRCP5D",59,0)
 .. S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",60,0)
 .S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5D",61,0)
 .I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5D",62,0)
 .I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" continued.")
"RTN","GMRCP5D",63,0)
 .D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5D",64,0)
 .I $L($G(GMRCSGNM)) D
"RTN","GMRCP5D",65,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",66,0)
 ..I (GMRCMODE="electronic") S GMRCX=" Addendum Signature: "_GMRCSGNM_" /es/ "_$$EXDT($G(GMRCNMDT))
"RTN","GMRCP5D",67,0)
 ..I '(GMRCMODE="electronic") S GMRCX=" Addendum Author: "_GMRCSGNM S:$L($G(GMRCNMDT)) GMRCX=GMRCX_" Last edited: "_$$EXDT(GMRCNMDT)
"RTN","GMRCP5D",68,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",69,0)
 ..D:$L($G(GMRCTIT)) SUB("F","RES",GMRCNDX,"                     "_GMRCTIT)
"RTN","GMRCP5D",70,0)
 .I $L($G(GMRCCSDT)) D
"RTN","GMRCP5D",71,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",72,0)
 ..I (GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",73,0)
 ..I '(GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /chart/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",74,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",75,0)
 ..D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                       "_GMRCCTIT)
"RTN","GMRCP5D",76,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",77,0)
 .I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5D",78,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0))
"RTN","GMRCP5D",79,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",80,0)
 .S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5D",81,0)
 ..D BLD("RES",GMRCNDX,1,0,$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1,0)))
"RTN","GMRCP5D",82,0)
 Q
"RTN","GMRCP5D",83,0)
 ;
"RTN","GMRCP5D",84,0)
HDR ; Header code for form 513
"RTN","GMRCP5D",85,0)
 ;
"RTN","GMRCP5D",86,0)
 N PG,GMRCFROM
"RTN","GMRCP5D",87,0)
 ;
"RTN","GMRCP5D",88,0)
 F PG=0,1 D
"RTN","GMRCP5D",89,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",90,0)
 .D BLD("HDR",PG,1,6,"MEDICAL RECORD")
"RTN","GMRCP5D",91,0)
 .D BLD("HDR",PG,0,29,"|")
"RTN","GMRCP5D",92,0)
 .D BLD("HDR",PG,0,36,"CONSULTATION SHEET")
"RTN","GMRCP5D",93,0)
 .I PG D BLD("HDR",PG,0,60,"Page ","GMRCPG,65") I 1
"RTN","GMRCP5D",94,0)
 .E  I '$G(GMRCGUI) D BLD("HDR",PG,0,60,"Page ","GMRCPG,65")
"RTN","GMRCP5D",95,0)
 .;
"RTN","GMRCP5D",96,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",97,0)
 .D BLD("HDR",PG,1,0,"Consult Request: "_$$CONSRQ(GMRCIFN))
"RTN","GMRCP5D",98,0)
 .D BLD("HDR",PG,0,55,"|Consult No.: "_GMRCIFN)
"RTN","GMRCP5D",99,0)
 .;
"RTN","GMRCP5D",100,0)
 D BLD("HDR",1,1,0,GMRCEQL)
"RTN","GMRCP5D",101,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",102,0)
 ;
"RTN","GMRCP5D",103,0)
 I $G(CMT) D BLD("HDR",0,1,27,"("_$$PRCMT^GMRCP5B(CMT)_")") Q
"RTN","GMRCP5D",104,0)
 ;
"RTN","GMRCP5D",105,0)
 S GMRCFROM=$P($G(^SC(+$P(GMRCRD,U,6),0)),U,1)
"RTN","GMRCP5D",106,0)
 ;
"RTN","GMRCP5D",107,0)
 I '$L(GMRCFROM) D
"RTN","GMRCP5D",108,0)
 .N VAIN
"RTN","GMRCP5D",109,0)
 .D INP^VADPT
"RTN","GMRCP5D",110,0)
 .S GMRCFROM=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5D",111,0)
 .I $L($G(VAIN(5))) S GMRCFROM=GMRCFROM_" (Rm/Bd: "_$G(VAIN(5))_" )"
"RTN","GMRCP5D",112,0)
 ;
"RTN","GMRCP5D",113,0)
 D BLD("HDR",0,1,0,"To: "_$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",114,0)
 D BLD("HDR",0,1,5,"From: "_GMRCFROM)
"RTN","GMRCP5D",115,0)
 D BLD("HDR",0,0,49,"|Requested: "_$$EXDT($P(GMRCRD,U,7)))
"RTN","GMRCP5D",116,0)
 ;
"RTN","GMRCP5D",117,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",118,0)
 D BLD("HDR",0,1,0,"Requesting Facility: "_$E(GMRCFAC,1,22))
"RTN","GMRCP5D",119,0)
 I $P(GMRCRD,U,11) D BLD("HDR",0,0,45,"|ATTENTION: "_$E($P($G(^VA(200,+$P(GMRCRD,U,11),0)),U,1),1,21))
"RTN","GMRCP5D",120,0)
 D BLD("HDR",0,1,0,GMRCEQL)
"RTN","GMRCP5D",121,0)
 ;
"RTN","GMRCP5D",122,0)
 Q
"RTN","GMRCP5D",123,0)
 ;
"RTN","GMRCP5D",124,0)
CENTER(X) ;
"RTN","GMRCP5D",125,0)
 ;
"RTN","GMRCP5D",126,0)
 N TEXT,COL
"RTN","GMRCP5D",127,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5D",128,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5D",129,0)
 Q TEXT
"RTN","GMRCP5D",130,0)
 ;
"RTN","GMRCP5D",131,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5D",132,0)
 ;
"RTN","GMRCP5D",133,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5D",134,0)
 N LINECNT
"RTN","GMRCP5D",135,0)
 ;
"RTN","GMRCP5D",136,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5D",137,0)
 ;
"RTN","GMRCP5D",138,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5D",139,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5D",140,0)
 ;
"RTN","GMRCP5D",141,0)
 S GMRCLAST=SUB
"RTN","GMRCP5D",142,0)
 Q
"RTN","GMRCP5D",143,0)
 ;
"RTN","GMRCP5D",144,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5D",145,0)
 ;
"RTN","GMRCP5D",146,0)
 N NEXT
"RTN","GMRCP5D",147,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5D",148,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5D",149,0)
 Q
"RTN","GMRCP5D",150,0)
 ;
"RTN","GMRCP5D",151,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5D",152,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5D",153,0)
 ;
"RTN","GMRCP5D",154,0)
CONSRQ(IFN) ;
"RTN","GMRCP5D",155,0)
 ;
"RTN","GMRCP5D",156,0)
 N PTR,LINK,REF,GMRCRQ
"RTN","GMRCP5D",157,0)
 I +$P(^GMR(123,+IFN,0),U,8) D
"RTN","GMRCP5D",158,0)
 . S GMRCRQ=$P(^GMR(123,+IFN,0),U,8)
"RTN","GMRCP5D",159,0)
 . S GMRCRQ=$$GET1^DIQ(123.3,+GMRCRQ,.01)
"RTN","GMRCP5D",160,0)
 . I '$L(GMRCRQ) S GMRCRQ="Procedure"
"RTN","GMRCP5D",161,0)
 I $L($G(GMRCRQ)) Q GMRCRQ
"RTN","GMRCP5D",162,0)
 I $L($G(^GMR(123,IFN,1.11))) D
"RTN","GMRCP5D",163,0)
 . N SERV,TYPE
"RTN","GMRCP5D",164,0)
 . S SERV=$$UP^XLFSTR($$GET1^DIQ(123.5,$P(^GMR(123,IFN,0),U,5),.01))
"RTN","GMRCP5D",165,0)
 . S TYPE=$$UP^XLFSTR(^GMR(123,IFN,1.11)) I TYPE'=SERV D
"RTN","GMRCP5D",166,0)
 . I TYPE'=SERV S GMRCRQ=$E(^GMR(123,IFN,1.11),1,36)
"RTN","GMRCP5D",167,0)
 Q:$L($G(GMRCRQ)) GMRCRQ Q "Consult"
"RTN","GMRCP5D",168,0)
 ;
"RTN","GMRCP5D",169,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5D",170,0)
 ;
"RTN","GMRCP5D",171,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5D",172,0)
 Q:'$L(X) ""
"RTN","GMRCP5D",173,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5D",174,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5D",175,0)
 ;
"RTN","GMRCPR0")
0^18^B17021041
"RTN","GMRCPR0",1,0)
GMRCPR0 ; SLC/DLT - Data Entry Promptint actions ;9/8/98  03:59
"RTN","GMRCPR0",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15**;DEC 27, 1997
"RTN","GMRCPR0",3,0)
 ;
"RTN","GMRCPR0",4,0)
 ; This routine invokes IA #2982
"RTN","GMRCPR0",5,0)
 ;
"RTN","GMRCPR0",6,0)
ASK ;ASK FOR TO, PROCEDURE,URGENCY, AND PLACE OF CONSULT
"RTN","GMRCPR0",7,0)
 I $D(GMRCPR),'$D(GMRCPRI) S GMRCPRI=+GMRCPR_";ORD(101,",GMRCORSV=$S(+^ORD(101,+GMRCPR,5):+^(5),1:GMRCSS),GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",8,0)
 I $S('$D(GMRCPR):1,GMRCPR="":1,1:0) D PROC Q:GMRCEND  S GMRCORSV=^ORD(101,+GMRCPRI,5),GMRCORSV=+GMRCORSV,GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",9,0)
 I '$D(GMRCSRVC) S GMRCSRVC=GMRCSSNM
"RTN","GMRCPR0",10,0)
ASK1 I $L(GMRCWARD) S GMRCIOPT="I"
"RTN","GMRCPR0",11,0)
 E  S GMRCIOPT="O"
"RTN","GMRCPR0",12,0)
 S DIR(0)="123,14",DIR("A")="Service rendered on (I)npatient or (O)utpatient basis?",DIR("B")=GMRCIOPT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) S GMRCEND=1 K DTOUT,DUOUT,DIROUT Q
"RTN","GMRCPR0",13,0)
 S GMRCIOPT=Y
"RTN","GMRCPR0",14,0)
 I GMRCIOPT="I" S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCPR0",15,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCPR0",16,0)
 S DIC=101,DIC(0)="X" D ^DIC K DIC Q:Y<0
"RTN","GMRCPR0",17,0)
 S XQORM("??")="D URGHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",18,0)
 S XQORM("A")="URGENCY: ",XQORM("NO^^")=""
"RTN","GMRCPR0",19,0)
 S GMRCURG1=$G(^DISV(DUZ,"XQORM",XQORM,1)) I '$L(GMRCURG1) K GMRCURG1
"RTN","GMRCPR0",20,0)
 I $D(GMRCURG1) S GMRCURG1=$$UP^XLFSTR(GMRCURG1) I $O(^XUTL("XQORM",XQORM,"B",GMRCURG1,0)) S XQORM("B")=^DISV(DUZ,"XQORM",XQORM,1)
"RTN","GMRCPR0",21,0)
 F  D  Q:Y  I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",22,0)
 .K GMRCURG1
"RTN","GMRCPR0",23,0)
 .D EN^XQORM I X="^"!($D(DIROUT)) S GMRCEND=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",24,0)
 .I Y<0 S GMRCMSG="The URGENCY is a required response." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCPR0",25,0)
 .Q
"RTN","GMRCPR0",26,0)
 I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",27,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCPR0",28,0)
 I GMRCIOPT="I" S X="GMRCPLACEM - INPATIENT"
"RTN","GMRCPR0",29,0)
 E  S X="GMRCPLACEM - OUTPATIENT"
"RTN","GMRCPR0",30,0)
 S DIC=101,DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",31,0)
 K XQORM S XQORM("??")="D PLHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",32,0)
 S XQORM("A")="PLACE OF CONSULTATION: "
"RTN","GMRCPR0",33,0)
 S XQORM("B")=$P($G(^XUTL("XQORM",XQORM,1.1,0)),U,3),XQORM("NO^^")=""
"RTN","GMRCPR0",34,0)
 D EN^XQORM I X="^"!($D(DIROUT)) K XQORM,DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",35,0)
 I Y<0 D  Q:+$G(GMRCEND)
"RTN","GMRCPR0",36,0)
 .W $C(7),!!,"  The PLACE OF CONSULTATION is a required response!",!
"RTN","GMRCPR0",37,0)
 .D EN^XQORM K XQORM I X="^"!($D(DIROUT))!(Y<1) K DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",38,0)
 K XQORM I $D(Y(1)) S GMRCPL=$P(Y(1),"^",3),GMRCPLI=$P(Y(1),"^",2)
"RTN","GMRCPR0",39,0)
 Q
"RTN","GMRCPR0",40,0)
TO ;Get Service from File Link field
"RTN","GMRCPR0",41,0)
 S GMRCSS=$P($G(^ORD(101,+GMRCPRI,5)),"^")
"RTN","GMRCPR0",42,0)
 I '+GMRCSS D ASKTO Q:GMRCEND
"RTN","GMRCPR0",43,0)
 I +GMRCSS S GMRCSS=+GMRCSS,GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,.1)),"^") I '$L(GMRCSSNM) S GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,0)),"^",1)
"RTN","GMRCPR0",44,0)
 S ORTO=$O(^ORD(100.98,"B","CONSULTS",""))
"RTN","GMRCPR0",45,0)
 Q
"RTN","GMRCPR0",46,0)
ASKTO ;Ask for service when file link not defined in protocol file
"RTN","GMRCPR0",47,0)
 D SERV^GMRCPS I 'GMRCDG S GMRCEND=1 Q
"RTN","GMRCPR0",48,0)
 S GMRCSS=GMRCDG
"RTN","GMRCPR0",49,0)
 Q
"RTN","GMRCPR0",50,0)
PROC ;Use XQORM to select procedure
"RTN","GMRCPR0",51,0)
 S GMRCEND=0 N XQORM
"RTN","GMRCPR0",52,0)
 S DIC=101,X="GMRCRM REQUEST TYPES",DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",53,0)
 S XQORM("??")="D PROCHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Select PROCEDURE: ",XQORM("NO^^")="" I $D(GMRCPR),$L(GMRCPR) S XQORM("B")=GMRCPR
"RTN","GMRCPR0",54,0)
 D EN^XQORM K XQORM I X="^"!('$L(X))!($D(DIROUT)) S (GMRCQUT,GMRCEND)=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",55,0)
 I $D(Y(1)) S (GMRCVP,GMRCPRI)=$P(Y(1),"^",2)_";ORD(101,",GMRCPR=$S($D(^ORD(101,$P(Y(1),"^",2),.1)):$P(^(.1),"^"),1:"") I '$L(GMRCPR) S GMRCPR=$P(Y(1),"^",3)
"RTN","GMRCPR0",56,0)
 S X=$S($D(^ORD(101,+GMRCPRI,20)):$P(^(20)," D ",1),1:"") X:X]"" X S GMRCEN=$S($G(GMRCEN)]"":GMRCEN,1:""),GMRCTYPE=$S(GMRCEN="R":"GMRCOR REQUEST",1:"GMRCOR CONSULT")
"RTN","GMRCPR0",57,0)
 Q
"RTN","GMRCPR0",58,0)
 ;
"RTN","GMRCPR0",59,0)
GETSVC(SLIST,PROC) ;Get the services that process a procedure type
"RTN","GMRCPR0",60,0)
 N SVC,SCNT
"RTN","GMRCPR0",61,0)
 I '+$G(PROC) Q
"RTN","GMRCPR0",62,0)
 S SCNT=0,SLIST=SCNT
"RTN","GMRCPR0",63,0)
 S SVC=0
"RTN","GMRCPR0",64,0)
 F  S SVC=$O(^GMR(123.3,+PROC,2,"B",SVC)) Q:'SVC  D
"RTN","GMRCPR0",65,0)
 . Q:'$D(^GMR(123.5,+SVC,0))
"RTN","GMRCPR0",66,0)
 . Q:$P(^GMR(123.5,+SVC,0),U,2)=1  ;no groupers
"RTN","GMRCPR0",67,0)
 . Q:$P(^GMR(123.5,+SVC,0),U,2)=9  ;no disabled services
"RTN","GMRCPR0",68,0)
 . S SCNT=SCNT+1
"RTN","GMRCPR0",69,0)
 . S SLIST(SCNT)=SVC_"^"_$P($G(^GMR(123.5,SVC,0)),U,1)
"RTN","GMRCPR0",70,0)
 . Q
"RTN","GMRCPR0",71,0)
 S SLIST=SCNT
"RTN","GMRCPR0",72,0)
 Q
"RTN","GMRCSLDT")
0^19^B10503696
"RTN","GMRCSLDT",1,0)
GMRCSLDT ;SLC/DCM - Get a consults detailed tracking history formated for List Manager ;9/8/98  03:29
"RTN","GMRCSLDT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,15**;DEC 27, 1997
"RTN","GMRCSLDT",3,0)
 ;
"RTN","GMRCSLDT",4,0)
HDR ;Header code for detailed display.(also used for results display)
"RTN","GMRCSLDT",5,0)
 I '$D(DFN) N DFN D  Q:'$D(DFN)
"RTN","GMRCSLDT",6,0)
 . I $D(ORVP) S DFN=+ORVP
"RTN","GMRCSLDT",7,0)
 D HDR1^GMRCSLM
"RTN","GMRCSLDT",8,0)
 I '$D(GMRCVTIT) S GMRCX="Consult No.: "_GMRCO D HDR2^GMRCSLM(GMRCX)
"RTN","GMRCSLDT",9,0)
 D TITLE
"RTN","GMRCSLDT",10,0)
 Q
"RTN","GMRCSLDT",11,0)
 ;
"RTN","GMRCSLDT",12,0)
EN ;Select a consult for detailed display of information.
"RTN","GMRCSLDT",13,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCSLDT",14,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCSLDT",15,0)
 I '+$G(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCSLDT",16,0)
 ;
"RTN","GMRCSLDT",17,0)
 S GMRCND=GMRCO
"RTN","GMRCSLDT",18,0)
 ;S GMRCDT=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,0))
"RTN","GMRCSLDT",19,0)
 ;S GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCNO,GMRCDT,0))
"RTN","GMRCSLDT",20,0)
 W !!,"Compiling Detailed Display..."
"RTN","GMRCSLDT",21,0)
 D LMFMT(GMRCND)
"RTN","GMRCSLDT",22,0)
 D EN^VALM("GMRC DETAILED DISPLAY")
"RTN","GMRCSLDT",23,0)
 Q
"RTN","GMRCSLDT",24,0)
 ;
"RTN","GMRCSLDT",25,0)
TITLE ;override title if medicine resulting
"RTN","GMRCSLDT",26,0)
 I $D(GMRCVTIT) S VALM("TITLE")=GMRCVTIT
"RTN","GMRCSLDT",27,0)
 Q
"RTN","GMRCSLDT",28,0)
LMFMT(GMRCND) ;Build the ^TMP("GMRCR",$J,"DT", global and format the header variables and set the data into List Manager for display of detailed data.
"RTN","GMRCSLDT",29,0)
 N DFN,GMRCAGE,GMRCDOB,GMRCPNM,GMRCSSN,GMRCSS,GMRCSSN,VALMHDR
"RTN","GMRCSLDT",30,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLDT",31,0)
 S DFN=$P(^GMR(123,GMRCND,0),"^",2) D DEM^GMRCU
"RTN","GMRCSLDT",32,0)
 S GMRCSS=$P(^GMR(123,GMRCND,0),"^",5) S GMRCSSN=$S(GMRCSS]"":$P($G(^GMR(123.5,GMRCSS,0)),"^",1),1:"Unknown Location")
"RTN","GMRCSLDT",33,0)
 D DT^GMRCSLM2(+GMRCND)
"RTN","GMRCSLDT",34,0)
 I $D(GMRCQUT) Q
"RTN","GMRCSLDT",35,0)
 K ^TMP("GMRCR",$J,"DTLIST") S DSPLINE=0,VALMAR="^TMP(""GMRCR"",$J,""DTLIST"")"
"RTN","GMRCSLDT",36,0)
 F LINE=1:1:GMRCCT S DSPLINE=$O(^TMP("GMRCR",$J,"DT",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLDT",37,0)
 S VALMCNT=LINE-1,XQORM("A")="Select Action: "
"RTN","GMRCSLDT",38,0)
 K DSPLINE,LINE,DATA
"RTN","GMRCSLDT",39,0)
 Q
"RTN","GMRCSLDT",40,0)
 ;
"RTN","GMRCSLDT",41,0)
PHDR ; -- protocol header code called from the display action protocol menus
"RTN","GMRCSLDT",42,0)
 ;S VALMSG=$$MSG
"RTN","GMRCSLDT",43,0)
 D SHOW^VALM
"RTN","GMRCSLDT",44,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT
"RTN","GMRCSLDT",45,0)
 S XQORM("A")="Select Action: "
"RTN","GMRCSLDT",46,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",47,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",48,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLDT",49,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLDT",50,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLDT",51,0)
 K GMRCNMBR
"RTN","GMRCSLDT",52,0)
 Q
"RTN","GMRCSLDT",53,0)
HELP ; -- display help code
"RTN","GMRCSLDT",54,0)
 N X S VALMBCK="" D FULL^VALM1 S VALMBCK="R"
"RTN","GMRCSLDT",55,0)
 W !!,"Use the actions listed to scroll up and down, to view the data; if you want",!,"to search the data for a particular string, enter SL.  You may print the"
"RTN","GMRCSLDT",56,0)
 W !,"data, either the entire list or just the current screen, by entering PT or PS",!,"respectively.  Enter Q when finished to return to the chart."
"RTN","GMRCSLDT",57,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMRCSLDT",58,0)
 Q
"RTN","GMRCSLDT",59,0)
 ;
"RTN","GMRCSLDT",60,0)
EXIT K ^TMP("GMRCR",$J,"DT"),^TMP("GMRCR",$J,"DTLIST"),GMRCCT
"RTN","GMRCSLDT",61,0)
 ;D KILL^VALM10(GMRCO)
"RTN","GMRCSLDT",62,0)
 K GMRCWT
"RTN","GMRCSLDT",63,0)
 Q
"RTN","GMRCSLM1")
0^20^B46308886
"RTN","GMRCSLM1",1,0)
GMRCSLM1 ;SLC/DCM - Gather data and format ^TMP global for consult tracking Silent call for use by List Manager and GUI ;12/28/00  15:37
"RTN","GMRCSLM1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,15**;DEC 27, 1997
"RTN","GMRCSLM1",3,0)
 ;USING LIST MANAGER.
"RTN","GMRCSLM1",4,0)
 ;
"RTN","GMRCSLM1",5,0)
 ; This routine invokes IA #2638,#2740
"RTN","GMRCSLM1",6,0)
 ;
"RTN","GMRCSLM1",7,0)
 G AD
"RTN","GMRCSLM1",8,0)
SVC(NODE) ;Check for a valid service
"RTN","GMRCSLM1",9,0)
 K GMRCDEAV
"RTN","GMRCSLM1",10,0)
 I '$D(^GMR(123,NODE,0)) Q 0
"RTN","GMRCSLM1",11,0)
 I '+$P(^GMR(123,NODE,0),"^",5) Q 0
"RTN","GMRCSLM1",12,0)
 I '$D(^TMP("GMRCS",$J,$P(^GMR(123,NODE,0),"^",5))) Q 0
"RTN","GMRCSLM1",13,0)
 Q 1
"RTN","GMRCSLM1",14,0)
AD ;Main entry point. Loop through AD x-ref in file 123; Find consults that have been released to requested service
"RTN","GMRCSLM1",15,0)
 ;;DFN and GMRCSSNM must be defined when this entry point is called
"RTN","GMRCSLM1",16,0)
 ;;DFN=Internal File Number of Patient in ^DPT
"RTN","GMRCSLM1",17,0)
 ;;GMRCSSNM=Service Name of a Hospital Service from file ^GMR(123.5
"RTN","GMRCSLM1",18,0)
 ;;If GMRCSSNM is not defined or is null, then no records will be found.
"RTN","GMRCSLM1",19,0)
 ;;GMRCOER must be passed so that proper formatting for GUI or List Manager can be performed.  GMRCOER is passed as 0 for List Manager, 1 for GUI.
"RTN","GMRCSLM1",20,0)
 ;;GMRCDT1 and GMRCDT2 are passed in as start and stop dates for the lookup. If GMRCDT1="" or GMRCDT1="ALL", then all dates are searched.
"RTN","GMRCSLM1",21,0)
 ;;  ***********************************************************
"RTN","GMRCSLM1",22,0)
 K ^TMP("GMRCR",$J,"CS"),GMRCNUL
"RTN","GMRCSLM1",23,0)
 I $D(GMRCSSS) S (GMRCDG,GMRCSS)=GMRCSSS,GMRCSSNM=($P($G(^GMR(123.5,+GMRCSS,0)),"^",1)) D SERV1^GMRCASV K GMRCSSS ;reset after forward
"RTN","GMRCSLM1",24,0)
 S TAB="",$P(TAB," ",41)="",BLK=0,LNCT=1 S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCSLM1",25,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA  I $$SVC(GMRCDA) D SET
"RTN","GMRCSLM1",26,0)
 D END Q
"RTN","GMRCSLM1",27,0)
SET ;;Format entries into a word processing 'TMP("GMRCR",$J,"CS",' global that List Manager can display
"RTN","GMRCSLM1",28,0)
 ;;GMRCOER is a variable that signals that data is being formatted for the OE/RR GUI; this data is formatted differently than the data for List Manager.
"RTN","GMRCSLM1",29,0)
 ;;GMRCOER=0 : Data is List Manager formatted.
"RTN","GMRCSLM1",30,0)
 ;;GMRCOER=1 : Data is OE/RR GUI formatted.
"RTN","GMRCSLM1",31,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLM1",32,0)
 S GMRCIFN=$G(GMRCDA) I '$L(GMRCIFN),$D(XQADATA) S (GMRCDA,GMRCIFN)=+XQADATA
"RTN","GMRCSLM1",33,0)
 S GMRCSEX=$S($P(^DPT(DFN,0),"^",2)="M":"MALE",1:"FEMALE")
"RTN","GMRCSLM1",34,0)
 I '$D(^GMR(123,+GMRCIFN,0)) S GMRCQUT=1 Q
"RTN","GMRCSLM1",35,0)
 S PROC="",GMRC(0)=^GMR(123,GMRCIFN,0)
"RTN","GMRCSLM1",36,0)
 I $D(GMRCSTCK),GMRCSTCK'="" N STATUS,TITLE D  Q:'STATUS
"RTN","GMRCSLM1",37,0)
 . N I
"RTN","GMRCSLM1",38,0)
 . F I=1:1 S STATUS=$P(GMRCSTCK,",",I) Q:STATUS=$P(GMRC(0),"^",12)  Q:'STATUS
"RTN","GMRCSLM1",39,0)
 . Q
"RTN","GMRCSLM1",40,0)
 I $D(GMRCVP),GMRCVP'=$P(GMRC(0),"^",8) Q
"RTN","GMRCSLM1",41,0)
 S (GMRCFMDT,X)=$P(GMRC(0),"^",7) I GMRCDT1'="ALL",$P(X,".",1)<GMRCDT1!($P(X,".",1)>GMRCDT2) Q
"RTN","GMRCSLM1",42,0)
 S BLK=BLK+1,^TMP("GMRCR",$J,"CS","AD",BLK,LNCT,GMRCDA)=""
"RTN","GMRCSLM1",43,0)
 D REGDTM^GMRCU S CDT=$P(X," ")
"RTN","GMRCSLM1",44,0)
 S PROC=$S($P(GMRC(0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCSLM1",45,0)
 I PROC'="Consult" S PROC=$$GET1^DIQ(123.3,+$P(GMRC(0),"^",8),.01)
"RTN","GMRCSLM1",46,0)
 S:PROC="" PROC="Consult"
"RTN","GMRCSLM1",47,0)
 S TO=+$P(GMRC(0),"^",5)
"RTN","GMRCSLM1",48,0)
 I +TO S TOD=$S($P($G(^GMR(123.5,+TO,0)),"^",2)=9:1,1:0)
"RTN","GMRCSLM1",49,0)
 I '$D(TOD) S TOD=0
"RTN","GMRCSLM1",50,0)
 S TO=$S(+TO:$P($G(^GMR(123.5,+TO,0)),"^",1),1:"")
"RTN","GMRCSLM1",51,0)
 S TO=$S(TOD:"<",1:"")_TO
"RTN","GMRCSLM1",52,0)
 S TO=$S(GMRCOER:TO,1:$E(TO,1,40))_$S(TOD:">",1:"")
"RTN","GMRCSLM1",53,0)
 I '$L(TO) S TO="**Unknown Service**"
"RTN","GMRCSLM1",54,0)
 S STS=$P(GMRC(0),"^",12) I +STS,$D(^ORD(100.01,+STS,0)) S:'+GMRCOER STS=$P(^ORD(100.01,+STS,.1),"^",1) I +GMRCOER S STS=$S(GMRCOER=1:$P(^ORD(100.01,+STS,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",55,0)
 I $S(STS="":1,'$D(^ORD(100.01,+$P(GMRC(0),"^",12),0)):1,1:0) S STS=99,$P(GMRC(0),"^",12)=STS,STS=$S(GMRCOER=1:$P(^ORD(100.01,5,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",56,0)
 D SERVPROC
"RTN","GMRCSLM1",57,0)
 I 'GMRCOER D  Q
"RTN","GMRCSLM1",58,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=BLK_$E(TAB,1,(4-$L(BLK)))_CDT_"  "_$E(STS,1,3)_$S(STS?1A:"  ",STS?2A:" ",1:"")_" "_$J(GMRCDA,7)_" "_$S($P(GMRC(0),"^",19)="Y":"*",1:" ")_TITLE
"RTN","GMRCSLM1",59,0)
 . S LNCT=LNCT+1
"RTN","GMRCSLM1",60,0)
 I GMRCOER D
"RTN","GMRCSLM1",61,0)
 . N DATA
"RTN","GMRCSLM1",62,0)
 . S DATA=GMRCDA_U_GMRCFMDT_U_STS_U_TO_U_PROC_U
"RTN","GMRCSLM1",63,0)
 . S DATA=DATA_$S($P(GMRC(0),U,19)="Y":"*",1:"")_U
"RTN","GMRCSLM1",64,0)
 . S DATA=DATA_TITLE_U_$P(GMRC(0),U,3)
"RTN","GMRCSLM1",65,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=DATA
"RTN","GMRCSLM1",66,0)
 . S LNCT=LNCT+1
"RTN","GMRCSLM1",67,0)
 . K STSOER Q
"RTN","GMRCSLM1",68,0)
 Q
"RTN","GMRCSLM1",69,0)
END I LNCT<2 S (BLK,LNCT,GMRCNUL)=1,GMRCNPM="< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS "_$S($D(GMRCPRNM):"FOR "_GMRCPRNM,1:"")_" ON FILE. >",GMRCNPM=$E(TAB,1,(80-$L(GMRCNPM))\80)_GMRCNPM,^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCNPM D
"RTN","GMRCSLM1",70,0)
 .I GMRCDT1'="ALL",$D(GMRCDT1)&($D(GMRCDT2)) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="Between Dates: "_$$FMTE^XLFDT(GMRCDT1)_" and "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSLM1",71,0)
 .I $D(GMRCSTCK),$L(GMRCSTCK) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="With Status: " S STS="" F I=1:1 S STS=$P(GMRCSTCK,",",I) Q:STS=""  S ^TMP("GMRCR",$J,"CS",LNCT,0)=^(0)_$P($G(^ORD(100.01,+STS,0)),"^",1)_" "
"RTN","GMRCSLM1",72,0)
 .Q
"RTN","GMRCSLM1",73,0)
 E  S (BLK,LNCT)=LNCT-1,^TMP("GMRCR",$J,"CS",0)="^^^"_LNCT
"RTN","GMRCSLM1",74,0)
 I $D(GMRCALFL) S (BLK,LNCT)=1
"RTN","GMRCSLM1",75,0)
 K TO,TOD,END,FLG,GMRC(0),GMRCD,GMRCDG,GMRCIFN,GMRCFMDT,GMRCNPM,GMRCWARD
"RTN","GMRCSLM1",76,0)
 K I,PROC,STS,URG
"RTN","GMRCSLM1",77,0)
 Q
"RTN","GMRCSLM1",78,0)
OER(DFN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTCK,GMRCOER) ;;GUI interface for CPRS
"RTN","GMRCSLM1",79,0)
 ;;DFN=Patient internal file number
"RTN","GMRCSLM1",80,0)
 ;;GMRCDG:  Internal file number of consult service from file 123.5
"RTN","GMRCSLM1",81,0)
 ;;GMRCDT1:  Beginning date for lookup
"RTN","GMRCSLM1",82,0)
 ;;GMRCDT2:  Ending date for lookup
"RTN","GMRCSLM1",83,0)
 ;;GMRCSTCK: IEN from OER Status File [^OER(100.01)] to screen results
"RTN","GMRCSLM1",84,0)
 ;;     so that only consults with a desired status are displayed
"RTN","GMRCSLM1",85,0)
 ;;     Can be sent as a set of statuses: i.e., 6,5,2
"RTN","GMRCSLM1",86,0)
 ;;      (GMRCSTCK=GMRC STATUS CHECK)
"RTN","GMRCSLM1",87,0)
 ;;GMRCOER=0 if request is from CONSULTS
"RTN","GMRCSLM1",88,0)
 ;;       =1 if request is for CPRS List Manager
"RTN","GMRCSLM1",89,0)
 ;;       =2 if for CPRS GUI
"RTN","GMRCSLM1",90,0)
 I GMRCDT1="" S GMRCDT1="ALL"
"RTN","GMRCSLM1",91,0)
 I GMRCDG="" S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0))
"RTN","GMRCSLM1",92,0)
 S:'$D(GMRCOER) GMRCOER=1
"RTN","GMRCSLM1",93,0)
 D SERV1^GMRCASV,AD
"RTN","GMRCSLM1",94,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSLM1",95,0)
 Q
"RTN","GMRCSLM1",96,0)
SERVPROC ; Build contents of SERV/PROC field for List Manager
"RTN","GMRCSLM1",97,0)
 N TYPE,OTXT
"RTN","GMRCSLM1",98,0)
 S TITLE=""
"RTN","GMRCSLM1",99,0)
 S TYPE=""
"RTN","GMRCSLM1",100,0)
 S OTXT=$P($G(^GMR(123,GMRCDA,1.11)),"^")
"RTN","GMRCSLM1",101,0)
 I OTXT="" D BUILD2
"RTN","GMRCSLM1",102,0)
 I OTXT'="" D BUILD1
"RTN","GMRCSLM1",103,0)
 Q
"RTN","GMRCSLM1",104,0)
BUILD1 ;OTXT does contain information
"RTN","GMRCSLM1",105,0)
 N FLG,BADFLG,TPROC,TTO,LEN
"RTN","GMRCSLM1",106,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",107,0)
 S TITLE=OTXT,OTXT=$$UP^XLFSTR(OTXT)
"RTN","GMRCSLM1",108,0)
 S BADFLG=0
"RTN","GMRCSLM1",109,0)
 I PROC="Consult" S FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",110,0)
 I PROC'="Consult" S FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",111,0)
 S LEN=$L(TITLE)
"RTN","GMRCSLM1",112,0)
 I TO="" S TO="No Service"
"RTN","GMRCSLM1",113,0)
 I LEN<30,FLG=1,OTXT'=TTO S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",114,0)
 I LEN<30,FLG=1,OTXT=TTO S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",115,0)
 I TO["<" S BADFLG=1
"RTN","GMRCSLM1",116,0)
 S ABBRS=$$SVC^GMRCAU(GMRCDA),ABBRP=$$PROC^GMRCAU(GMRCDA)
"RTN","GMRCSLM1",117,0)
 I LEN<30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_PROC_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",118,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",119,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",120,0)
 I LEN>30,FLG=1,TTO'=OTXT S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",121,0)
 I LEN>30,FLG=1,TTO=OTXT S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",122,0)
 I LEN>30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_ABBRP_" "_TYPE Q
"RTN","GMRCSLM1",123,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=0 S TITLE=TITLE_" "_ABBRS_" "_TYPE Q
"RTN","GMRCSLM1",124,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=1 S TITLE=TITLE_" "_"<"_ABBRS_">"_TYPE Q
"RTN","GMRCSLM1",125,0)
 Q
"RTN","GMRCSLM1",126,0)
BUILD2 ;OTXT contains no information
"RTN","GMRCSLM1",127,0)
 N FLG,TPROC,TTO,LEN
"RTN","GMRCSLM1",128,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",129,0)
 I PROC="Consult" S TITLE=TO,LEN=$L(TITLE),FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",130,0)
 I PROC'="Consult" S TITLE=PROC,LEN=$L(TITLE),FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",131,0)
 I FLG=1 S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",132,0)
 I FLG=0,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",133,0)
 I FLG=0,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",134,0)
 Q
"RTN","GMRCSLM2")
0^21^B41842756
"RTN","GMRCSLM2",1,0)
GMRCSLM2 ;SLC/DCM - List Manager routine - Detailed consult display and printing ;11/21/00 13:40
"RTN","GMRCSLM2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,18,15**;DEC 27,1997
"RTN","GMRCSLM2",3,0)
 ;
"RTN","GMRCSLM2",4,0)
 ; This routine invokes IA #616,#872,#875,#2467,#2638,#2693,#2925,#3138
"RTN","GMRCSLM2",5,0)
 ;
"RTN","GMRCSLM2",6,0)
DT(GMRCO) ;;Entry point to set-up detailed display.
"RTN","GMRCSLM2",7,0)
 ;;Pass in GMRCO as +GMRCO - a number only. GMRCO=IEN from of consult from file 123
"RTN","GMRCSLM2",8,0)
 ;;Results are placed in ^TMP("GMRCR",$J,"DT",
"RTN","GMRCSLM2",9,0)
 ;;Pass in variable GMRCOER=2 if calling from the GUI, GMRCOER=1 if call is from CPRS consults tab
"RTN","GMRCSLM2",10,0)
 ;;Pass in variable GMRCOER=0 (or as <UNDEFINED>) if call is from consults routines
"RTN","GMRCSLM2",11,0)
 K GMRCQUT
"RTN","GMRCSLM2",12,0)
 N DFN,GMRCD,GMRCDA,ORIFN,GMRCSF S GMRCDVDL="",$P(GMRCDVDL,"-",80)=""
"RTN","GMRCSLM2",13,0)
 I $S('GMRCO:1,'$D(^GMR(123,+GMRCO,0)):1,1:0) D:$S('$D(GMRCOER):1,'GMRCOER:1,1:0)  S GMRCQUT=1 Q
"RTN","GMRCSLM2",14,0)
 .S GMRCMSG="The consult entry selected for the Detailed Display is unknown." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCSLM2",15,0)
 .Q
"RTN","GMRCSLM2",16,0)
 K ^TMP("GMRCR",$J,"DT") S TAB="",$P(TAB," ",30)="",GMRCCT=1
"RTN","GMRCSLM2",17,0)
 S GMRCO(0)=^GMR(123,+GMRCO,0),ORIFN=$P(GMRCO(0),"^",3),DFN=$P(GMRCO(0),"^",2)
"RTN","GMRCSLM2",18,0)
 S X="SDUTL3" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",19,0)
 .N PR S PR=$$OUTPTPR^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Provider:   "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",20,0)
 .S PR=$$OUTPTTM^SDUTL3(DFN) I $L(PR) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current PC Team:       "_$P(PR,"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",21,0)
 .Q
"RTN","GMRCSLM2",22,0)
 N VAIN,VAEL
"RTN","GMRCSLM2",23,0)
 D INP^VADPT S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Current Pat. Status:   "_$S(+VAIN(8):"Inpatient",1:"Outpatient"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",24,0)
 I $D(VAIN(4)),$L($P(VAIN(4),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Ward:"_$E(TAB,1,18)_$P(VAIN(4),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",25,0)
 D ELIG^VADPT
"RTN","GMRCSLM2",26,0)
 I $L($P(VAEL(1),"^",2)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Primary Eligibility:"_$E(TAB,1,11)_$P(VAEL(1),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",27,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",28,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Order Information",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",29,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="To Service:"_$E(TAB,1,12)_$P($G(^GMR(123.5,+$P(GMRCO(0),"^",5),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",30,0)
 I $P(GMRCO(0),"^",11) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Attention:"_$E(TAB,1,13)_$P($G(^VA(200,$P(GMRCO(0),"^",11),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",31,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="From Service:"_$E(TAB,1,10)_$P($G(^SC(+$P(GMRCO(0),"^",6),0)),"^"),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",32,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Requesting Provider: "_$E(TAB,1,2)_$S($P(GMRCO(0),"^",14)]"":$P($G(^VA(200,$P(GMRCO(0),"^",14),0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",33,0)
 I $L($P(GMRCO(0),"^",18)) D
"RTN","GMRCSLM2",34,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Service is to be rendered on an "_$S($P(GMRCO(0),"^",18)="I":"INPATIENT",1:"OUTPATIENT")_" basis",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",35,0)
 .Q
"RTN","GMRCSLM2",36,0)
 I $P(GMRCO(0),"^",10) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Place:"_$E(TAB,1,17)_$P($G(^ORD(101,+$P(GMRCO(0),"^",10),0)),"^",2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",37,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Urgency:"_$E(TAB,1,15)_$S($L($P(GMRCO(0),"^",9)):$P($G(^ORD(101,+$P(GMRCO(0),"^",9),0)),"^",2),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",38,0)
 S X="ORX8" X ^%ZOSF("TEST") I  D
"RTN","GMRCSLM2",39,0)
 .N GMRCOITM S GMRCOITM=$$OI^ORX8(ORIFN)
"RTN","GMRCSLM2",40,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Orderable Item:"_$E(TAB,1,8)_$P(GMRCOITM,U,2),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",41,0)
 .Q
"RTN","GMRCSLM2",42,0)
 S GMRCPRNM=$P(GMRCO(0),"^",8),GMRCPROC=$S(+GMRCPRNM:$P($G(^GMR(123.3,+GMRCPRNM,0)),"^"),1:"Consult Request")
"RTN","GMRCSLM2",43,0)
 I $L(GMRCPROC) D
"RTN","GMRCSLM2",44,0)
 .S GMRCTYPE=$S($P(GMRCO(0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCSLM2",45,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCTYPE_":"_$E(TAB,1,22-$L(GMRCTYPE))_GMRCPROC,GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",46,0)
 .Q
"RTN","GMRCSLM2",47,0)
 S GMRCD=$G(^GMR(123,+GMRCO,30)) I $L(GMRCD) D
"RTN","GMRCSLM2",48,0)
 . I $L(GMRCD)>54 D
"RTN","GMRCSLM2",49,0)
 .. N SEG,I S I=2
"RTN","GMRCSLM2",50,0)
 .. F  S SEG=$P(GMRCD," ",1,I) Q:$L(SEG)>54  S I=I+1
"RTN","GMRCSLM2",51,0)
 .. S SEG=$P(GMRCD," ",1,(I-1))
"RTN","GMRCSLM2",52,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_SEG
"RTN","GMRCSLM2",53,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",54,0)
 .. S SEG=$$REPEAT^XLFSTR(" ",22)_$E(GMRCD,$L(SEG)+1,80)
"RTN","GMRCSLM2",55,0)
 .. S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=SEG S GMRCD=""
"RTN","GMRCSLM2",56,0)
 .. S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",57,0)
 I GMRCD'="" D
"RTN","GMRCSLM2",58,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Provisional Diagnosis: "_GMRCD
"RTN","GMRCSLM2",59,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",60,0)
 I $D(^GMR(123,+GMRCO,20,0)) D
"RTN","GMRCSLM2",61,0)
 .I $O(^GMR(123,+GMRCO,20,0)) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Reason For Request:",GMRCCT=GMRCCT+1 D  Q
"RTN","GMRCSLM2",62,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,20,LN)) Q:LN=""  S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^(LN,0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",63,0)
 ..Q
"RTN","GMRCSLM2",64,0)
 .Q
"RTN","GMRCSLM2",65,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" ",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",66,0)
 ;get status, last action, and significant findings
"RTN","GMRCSLM2",67,0)
 S STS=$P(GMRCO(0),"^",12),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Status:  "_$E(TAB,1,14)_$S($D(^ORD(100.01,+STS,0)):$P(^(0),"^",1),1:$P(^ORD(100.01,6,0),"^",1)),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",68,0)
 S GMRCA=$P(^GMR(123,+GMRCO,0),"^",13),^TMP("GMRCR",$J,"DT",GMRCCT,0)="Last Action:"_$E(TAB,1,11)_$S(+GMRCA:$P($G(^GMR(123.1,GMRCA,0)),"^",1),1:""),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",69,0)
 I $L($P(GMRCO(0),"^",19)) D
"RTN","GMRCSLM2",70,0)
 .S GMRCSF=$P(GMRCO(0),"^",19)
"RTN","GMRCSLM2",71,0)
 .S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Significant Findings:  "_$S(GMRCSF="Y":"YES",GMRCSF="N":"NO",1:"Unknown")
"RTN","GMRCSLM2",72,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",73,0)
 .Q
"RTN","GMRCSLM2",74,0)
 D ACTLOG^GMRCSLM4(+GMRCO)
"RTN","GMRCSLM2",75,0)
 D GETRSLTS^GMRCTIUP(GMRCO,.GMRCAR) ;GMRCAR=Array results from TIU and Medicine Package is returned in
"RTN","GMRCSLM2",76,0)
 I $O(GMRCAR(0)) S GMRCND=0 F  S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  D
"RTN","GMRCSLM2",77,0)
 .I $E($P(GMRCND,";",2),1,4)="MCAR" S GMRCSR=GMRCND D  Q
"RTN","GMRCSLM2",78,0)
 ..S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8)
"RTN","GMRCSLM2",79,0)
 ..D EN^GMRCSLM3(+GMRCO,GMRCSR,.GMRCCT)
"RTN","GMRCSLM2",80,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",81,0)
 ..Q
"RTN","GMRCSLM2",82,0)
 .I $E($P(GMRCND,";",2),1,3)="TIU" S DR=".01;.05;.09;1201;1202;1204;1208;1302;1501",GMRCTUFN=$P(GMRCND,";",1) D
"RTN","GMRCSLM2",83,0)
 ..S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",84,0)
 ..D EXTRACT^TIULQ(GMRCTUFN,"LOCAL",.GMRCERR,DR)
"RTN","GMRCSLM2",85,0)
 ..I '$O(LOCAL("")) S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="No TIU results exist for Note # "_GMRCTUFN_".",GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="The Note has been DELETED from TIU!!",GMRCCT=GMRCCT+1 Q
"RTN","GMRCSLM2",86,0)
 ..; I '$L($G(LOCAL(GMRCTUFN,1501,"E"))) D TIU^GMRCSLMU(GMRCTUFN,.GMRCCT,.LOCAL) K LOCAL Q
"RTN","GMRCSLM2",87,0)
 ..K GMRCCNM
"RTN","GMRCSLM2",88,0)
 ..S GMRCTUFN=$P(GMRCND,";",1)
"RTN","GMRCSLM2",89,0)
 ..S:$L(LOCAL(GMRCTUFN,.01,"E")) GMRCCNM=LOCAL(GMRCTUFN,.01,"E"),^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80-$L(GMRCCNM)\2)="",^(0)=^(0)_" "_GMRCCNM_" "_^(0),GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",90,0)
 ..K LOCAL
"RTN","GMRCSLM2",91,0)
 ..D DSPLAY^GMRCTIU(GMRCTUFN,.GMRCCT)
"RTN","GMRCSLM2",92,0)
 ..S GMRCCT=GMRCCT+1,^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM2",93,0)
 ..K DR
"RTN","GMRCSLM2",94,0)
 ..Q
"RTN","GMRCSLM2",95,0)
 .Q
"RTN","GMRCSLM2",96,0)
 I $S('$D(GMRCOER):1,'GMRCOER:1,1:0),$D(VALMAR) D CLEAN^VALM10
"RTN","GMRCSLM2",97,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"=",80)="",^(0)=$E(^(0),1,36)_" END "_$E(^(0),43,80)
"RTN","GMRCSLM2",98,0)
DTQ K X,LN,PL,TO,WP,FLG,SEX,STS,URG,WRD,BKLN,DATA,WRD,PROC,LINE,GMRC(0),GMRC(40),GMRCD,GMRCDVDL,GMRCO,GMRCAR,GMRCRB,GMRCLA,GMRCSR,GMRCTO,MCFILE,MCPROC,DSPLINE,GMRCLA1,GMRCPRNM,GMRCPROC,GMRCTYPE,GMRCWARD
"RTN","GMRCSLM2",99,0)
 I $D(GMRCOER),'GMRCOER D:$D(VALMEVL) KILL^VALM10() D:$D(VALMAR) CLEAN^VALM10
"RTN","GMRCSLM2",100,0)
 Q
"RTN","GMRCSLM3")
0^22^B19201390
"RTN","GMRCSLM3",1,0)
GMRCSLM3 ;SLC/DCM - Extract medicine results for consult tracking ;7/16/98  02:01
"RTN","GMRCSLM3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,15**;DEC 27, 1997
"RTN","GMRCSLM3",3,0)
 ;
"RTN","GMRCSLM3",4,0)
 ; This routine invokes IA #615,#3042
"RTN","GMRCSLM3",5,0)
 ;
"RTN","GMRCSLM3",6,0)
EN(GMRCSEL,GMRCSR,COUNT) ;;This entry point is used to collect consult data from the Medicine Package.
"RTN","GMRCSLM3",7,0)
 ;GMRCSR="^MCAR(x," file IEN where result to associate is stored 
"RTN","GMRCSLM3",8,0)
 ;in $P(^GMR(123,IEN,0),"^",15)
"RTN","GMRCSLM3",9,0)
 ;                1=Called from RT^GMRCA1 or DT^GMRCSLM2 routine
"RTN","GMRCSLM3",10,0)
 ;Consult/Request Tracking
"RTN","GMRCSLM3",11,0)
 ;GMRCSEL: The IEN of the consult from file 123.
"RTN","GMRCSLM3",12,0)
 ;COUNT:   The current position in ^TMP where data is to be placed.
"RTN","GMRCSLM3",13,0)
 D ENDT,EXIT Q
"RTN","GMRCSLM3",14,0)
 ;
"RTN","GMRCSLM3",15,0)
ENDT Q:'$D(GMRCSEL)  Q:'$D(GMRCSEL)
"RTN","GMRCSLM3",16,0)
 S ORIFN=$P(^GMR(123,GMRCSEL,0),"^",3),ORACTION=8
"RTN","GMRCSLM3",17,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",18,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine package not installed.  Online results are not available.",COUNT=COUNT+1
"RTN","GMRCSLM3",19,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review",COUNT=COUNT+1 Q
"RTN","GMRCSLM3",20,0)
 N SINGLE
"RTN","GMRCSLM3",21,0)
 S SINGLE=$$SINGLE^MCAPI(GMRCSR)
"RTN","GMRCSLM3",22,0)
 S GMRCRTIT=$P(SINGLE,U)_" SUMMARY REPORT "_$P(SINGLE,U,6)
"RTN","GMRCSLM3",23,0)
 S GMRCH="",$P(GMRCH,"-",(77-$L(GMRCRTIT))\2)=""
"RTN","GMRCSLM3",24,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCH_" "_GMRCRTIT_" "_GMRCH
"RTN","GMRCSLM3",25,0)
 S COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",26,0)
 D PRINT^MCOR I '$D(^TMP("MC",$J)) D
"RTN","GMRCSLM3",27,0)
 . S ^TMP("GMRCR",$J,"DT",COUNT,0)="No results are available for review."
"RTN","GMRCSLM3",28,0)
 . S COUNT=COUNT+1
"RTN","GMRCSLM3",29,0)
 ;GMRCFT=Field Type of D (Diagnosis, I (Indications), S (Summary)
"RTN","GMRCSLM3",30,0)
SET S GMRCFT="D" I $D(^TMP("MC",$J,"D")) D
"RTN","GMRCSLM3",31,0)
 . S ^TMP("GMRCR",$J,"DT",COUNT,0)=$E(TAB,1,34)_"DIAGNOSIS"
"RTN","GMRCSLM3",32,0)
 . S COUNT=COUNT+1
"RTN","GMRCSLM3",33,0)
 . D SETFLD
"RTN","GMRCSLM3",34,0)
 S GMRCFT="I" I $D(^TMP("MC",$J,"I")) D
"RTN","GMRCSLM3",35,0)
 . S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",36,0)
 . S ^TMP("GMRCR",$J,"DT",COUNT,0)="INDICATIONS:",COUNT=COUNT+1
"RTN","GMRCSLM3",37,0)
 . D SETFLD
"RTN","GMRCSLM3",38,0)
 I $D(^TMP("MC",$J,"S")) D SUM
"RTN","GMRCSLM3",39,0)
 Q
"RTN","GMRCSLM3",40,0)
EXIT K GMRCH,GMRCX,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT
"RTN","GMRCSLM3",41,0)
 K GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",42,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",43,0)
 Q
"RTN","GMRCSLM3",44,0)
SETFLD S GMRCFLD=0,GMRCFLDP=""
"RTN","GMRCSLM3",45,0)
 F  S GMRCFLD=$O(^TMP("MC",$J,GMRCFT,GMRCFLD)) Q:GMRCFLD=""  D
"RTN","GMRCSLM3",46,0)
 . S GMRCFLD(0)=^TMP("MC",$J,GMRCFT,GMRCFLD) D
"RTN","GMRCSLM3",47,0)
 .. S GMRCFLDN=$P(GMRCFLD(0),"^",2) Q:GMRCFLDN[";W"
"RTN","GMRCSLM3",48,0)
 .. I GMRCFLDP=GMRCFLDN S COUNT=COUNT-1,^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_", "
"RTN","GMRCSLM3",49,0)
 .. E  S GMRCFLDP=GMRCFLDN,^TMP("GMRCR",$J,"DT",COUNT,0)=GMRCFLDP_":"_$E(TAB,1,18-$L(GMRCFLDP))
"RTN","GMRCSLM3",50,0)
 .. I $L($P(GMRCFLD(0),"^",1))>45 D  Q
"RTN","GMRCSLM3",51,0)
 ... S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),U)
"RTN","GMRCSLM3",52,0)
 ... S COUNT=COUNT+1
"RTN","GMRCSLM3",53,0)
 .. I $L($P(GMRCFLD(0),"^",1))'>77 S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$P(GMRCFLD(0),"^",1)
"RTN","GMRCSLM3",54,0)
 .. S COUNT=COUNT+1 Q
"RTN","GMRCSLM3",55,0)
 Q
"RTN","GMRCSLM3",56,0)
SUM ;
"RTN","GMRCSLM3",57,0)
 S GMRCSUM=$P(^TMP("MC",$J,"S"),"^",1)
"RTN","GMRCSLM3",58,0)
 S GMRCSUMP=$P(^TMP("MC",$J,"S"),"^",2)
"RTN","GMRCSLM3",59,0)
 I $L(GMRCSUM)!($L(GMRCSUMP)) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY:"
"RTN","GMRCSLM3",60,0)
 I $L(GMRCSUM) S ^TMP("GMRCR",$J,"DT",COUNT,0)=^TMP("GMRCR",$J,"DT",COUNT,0)_$E(TAB,1,11)_GMRCSUM,COUNT=COUNT+1
"RTN","GMRCSLM3",61,0)
 I $L(GMRCSUMP) S ^TMP("GMRCR",$J,"DT",COUNT,0)="SUMMARY PROCEDURE: "_GMRCSUMP,COUNT=COUNT+1
"RTN","GMRCSLM3",62,0)
 Q
"RTN","GMRCSLM3",63,0)
AREN(GMRCSEL,GMRCSR,GMRCPROC) ;Entry point for display of Medicine Results when associating a result with a consult - List Manager display set-up.
"RTN","GMRCSLM3",64,0)
 ;GMRCSR=^MCAR(191, file IEN where result to associate is stored
"RTN","GMRCSLM3",65,0)
 ;GMRCSEL=File ^GMR(123, IEN of consult to associate with medicine result
"RTN","GMRCSLM3",66,0)
 ;GMRCPROC=pointer to GMRC PROCEDURE (#123.3) file
"RTN","GMRCSLM3",67,0)
 S COUNT=1,TAB="",TAB=$P(TAB," ",30)
"RTN","GMRCSLM3",68,0)
 S X="MCOR" X ^%ZOSF("TEST") I '$T S ^TMP("GMRCR",$J,"DT",COUNT,0)="Medicine Package is not installed. Online results are not available.",COUNT=COUNT+1 G END
"RTN","GMRCSLM3",69,0)
 I 'GMRCSR S ^TMP("GMRCR",$J,"DT",COUNT,0)="No Medicine results are available for review.",COUNT=COUNT+1
"RTN","GMRCSLM3",70,0)
 S ORIFN=$S($G(GMRCSEL):$P(^GMR(123,+GMRCSEL,0),"^",3),1:0),ORACTION=8
"RTN","GMRCSLM3",71,0)
 S:+GMRCPROC GMRCPRNM=$$GET1^DIQ(697.2,$P(^GMR(123.3,+GMRCPROC,0),U,5),7)
"RTN","GMRCSLM3",72,0)
 S GMRCPRNM=$S($L($G(GMRCPRNM)):GMRCPRNM,1:"ELECTROCARDIOGRAM")
"RTN","GMRCSLM3",73,0)
 I +GMRCSR D PRINT^MCOR I $D(^TMP("MC",$J)) S ^TMP("GMRCR",$J,"DT",COUNT,0)=TAB_"MEDICINE RESULTS",COUNT=COUNT+1,^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1 D SET
"RTN","GMRCSLM3",74,0)
 S ^TMP("GMRCR",$J,"DT",COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCSLM3",75,0)
END S GMRCCT=COUNT-1
"RTN","GMRCSLM3",76,0)
 K COUNT,GMRCH,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCSLM3",77,0)
 K ^TMP("MC",$J)
"RTN","GMRCSLM3",78,0)
 Q
"RTN","GMRCSLM4")
0^23^B23194760
"RTN","GMRCSLM4",1,0)
GMRCSLM4 ;SLC/DCM - List Manager routine - Activity Log Detailed Display ;1/28/99 10:30
"RTN","GMRCSLM4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15**;DEC 27,1997
"RTN","GMRCSLM4",3,0)
 ;
"RTN","GMRCSLM4",4,0)
 ; This routine invokes IA #3138
"RTN","GMRCSLM4",5,0)
 ;
"RTN","GMRCSLM4",6,0)
ACTLOG(GMRCO) ;Print activity log
"RTN","GMRCSLM4",7,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",8,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Activity"_$E(TAB,1,17)_"Date/Time"_$E(TAB,1,6)_"Responsible Person"_$E(TAB,1,2)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",9,0)
 N GMRCD,GMRCDA
"RTN","GMRCSLM4",10,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D BLDALN(GMRCO,GMRCDA)
"RTN","GMRCSLM4",11,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",12,0)
 Q
"RTN","GMRCSLM4",13,0)
 ;
"RTN","GMRCSLM4",14,0)
BLDALN(GMRCO,GMRCDA) ;Build Activity Log Lines for an activity
"RTN","GMRCSLM4",15,0)
 ; GMRCO=  consult internal entry number
"RTN","GMRCSLM4",16,0)
 ; GMRCDA= activity internal entry number
"RTN","GMRCSLM4",17,0)
 N GMRCACT,GMRCSLN,XDT1,XDT2,FLG,LN,LINE,DASH,X,GMRCX,GMRCDEV
"RTN","GMRCSLM4",18,0)
 S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM4",19,0)
 S GMRCACT=$P(GMRCDA(0),"^",2)
"RTN","GMRCSLM4",20,0)
 D BLDLN1
"RTN","GMRCSLM4",21,0)
 D BLDLN2
"RTN","GMRCSLM4",22,0)
 D BLDCMTS
"RTN","GMRCSLM4",23,0)
 Q
"RTN","GMRCSLM4",24,0)
 ;
"RTN","GMRCSLM4",25,0)
BLDLN1 ;Build the first line for the activity
"RTN","GMRCSLM4",26,0)
 ;GMRCX is scratch pad variable
"RTN","GMRCSLM4",27,0)
 S GMRCX=$P($G(^GMR(123.1,+GMRCACT,0)),"^",1)
"RTN","GMRCSLM4",28,0)
 S:'$L(GMRCX) GMRCX=GMRCACT_" action?"
"RTN","GMRCSLM4",29,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCX
"RTN","GMRCSLM4",30,0)
 ;
"RTN","GMRCSLM4",31,0)
 ;Add to line for Printed to (action 22) when device name <13 characters
"RTN","GMRCSLM4",32,0)
 I GMRCACT=22 D
"RTN","GMRCSLM4",33,0)
 . S GMRCDEV=$$GET1^DIQ(3.5,+$P(GMRCDA(0),"^",8),.01)
"RTN","GMRCSLM4",34,0)
 . I '$L(GMRCDEV) S GMRCDEV=$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",35,0)
 . I $L(GMRCDEV)<13 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_" "_GMRCDEV K GMRCDEV
"RTN","GMRCSLM4",36,0)
 ;
"RTN","GMRCSLM4",37,0)
 ;Add on generic fields that apply to every activity
"RTN","GMRCSLM4",38,0)
 ;Date/time of Actual Activity, Who's Responsible for Activity,
"RTN","GMRCSLM4",39,0)
 ;and Who entered activity
"RTN","GMRCSLM4",40,0)
 S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,25-$L(^(0)))_X,1:X)
"RTN","GMRCSLM4",41,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,40-$L(^(0)))_$S($P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,18),1:$E(TAB,1,19))
"RTN","GMRCSLM4",42,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,60-$L(^(0)))_$S($P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,19),1:$E(TAB,1,19))
"RTN","GMRCSLM4",43,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",44,0)
 Q
"RTN","GMRCSLM4",45,0)
 ;
"RTN","GMRCSLM4",46,0)
BLDLN2 ;SECOND line for activity
"RTN","GMRCSLM4",47,0)
 N GMRCSLN S GMRCSLN="" ;saved SECOND line
"RTN","GMRCSLM4",48,0)
 ;
"RTN","GMRCSLM4",49,0)
 ; Check if the entry date and specified actual date are different
"RTN","GMRCSLM4",50,0)
 S XDT1=$P(GMRCDA(0),"^",1),XDT2=$P(GMRCDA(0),"^",3),GMRCX=0
"RTN","GMRCSLM4",51,0)
 S:XDT2>XDT1 X=XDT1,XDT1=XDT2,XDT2=X
"RTN","GMRCSLM4",52,0)
 S GMRCDIF=$$FMDIFF^XLFDT(XDT1,XDT2,3)
"RTN","GMRCSLM4",53,0)
 I $L(GMRCDIF) D
"RTN","GMRCSLM4",54,0)
 . I +$P(GMRCDIF," ",1)>0 S GMRCX=1 Q  ;Check Days
"RTN","GMRCSLM4",55,0)
 . S GMRCDIF=$P(GMRCDIF," ",2)
"RTN","GMRCSLM4",56,0)
 . I +$P(GMRCDIF,":",1)>0 S GMRCX=1 Q  ;Check Hours
"RTN","GMRCSLM4",57,0)
 . I +$P(GMRCDIF,":",2)>1 S GMRCX=1 Q  ;Check Minutes
"RTN","GMRCSLM4",58,0)
 . Q
"RTN","GMRCSLM4",59,0)
 I GMRCX D
"RTN","GMRCSLM4",60,0)
 . S X=$P(GMRCDA(0),"^",1) D REGDTM^GMRCU
"RTN","GMRCSLM4",61,0)
 . S GMRCSLN=$E(GMRCSLN_TAB,1,25)_X_" (entered)"
"RTN","GMRCSLM4",62,0)
 . Q
"RTN","GMRCSLM4",63,0)
 ;
"RTN","GMRCSLM4",64,0)
 I $L(GMRCSLN) D  S GMRCSLN=""
"RTN","GMRCSLM4",65,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",66,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",67,0)
 . Q
"RTN","GMRCSLM4",68,0)
 ;
"RTN","GMRCSLM4",69,0)
 ;Get Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",70,0)
 I +$P(GMRCDA(0),"^",9) D
"RTN","GMRCSLM4",71,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["TIU" D  Q
"RTN","GMRCSLM4",72,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Note# "_+$P(GMRCDA(0),"^",9)
"RTN","GMRCSLM4",73,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["MCAR" D  Q
"RTN","GMRCSLM4",74,0)
 .. N MCFILE S MCFILE=+$P($P(GMRCDA(0),"^",9),"MCAR(",2) Q:'MCFILE
"RTN","GMRCSLM4",75,0)
 .. N MCPRDT S MCPRDT=$$GET1^DIQ(MCFILE,+$P(GMRCDA(0),"^",9),.01)
"RTN","GMRCSLM4",76,0)
 .. Q:'$L(MCPRDT)
"RTN","GMRCSLM4",77,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Medicine Procedure performed: "_MCPRDT
"RTN","GMRCSLM4",78,0)
 ;
"RTN","GMRCSLM4",79,0)
 ;If GMRCDEV is defined, then print the device name on the second line
"RTN","GMRCSLM4",80,0)
 I GMRCACT=22,$D(GMRCDEV) D
"RTN","GMRCSLM4",81,0)
 . S GMRCSLN=$E(TAB,1,5)_$E(GMRCDEV,1,17) K GMRCDEV
"RTN","GMRCSLM4",82,0)
 ;
"RTN","GMRCSLM4",83,0)
 ;Build line for forwarded to (action 17)
"RTN","GMRCSLM4",84,0)
 I GMRCACT=17 D
"RTN","GMRCSLM4",85,0)
 . S GMRCX=$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^")
"RTN","GMRCSLM4",86,0)
 . S:'$L(GMRCX) GMRCX=$P(GMRCDA(0),"^",6)_" ??"
"RTN","GMRCSLM4",87,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",88,0)
 I $L(GMRCSLN) D
"RTN","GMRCSLM4",89,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",90,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",91,0)
 . Q
"RTN","GMRCSLM4",92,0)
 ;
"RTN","GMRCSLM4",93,0)
 Q
"RTN","GMRCSLM4",94,0)
 ;
"RTN","GMRCSLM4",95,0)
BLDCMTS ;Build lines for Comment activity.
"RTN","GMRCSLM4",96,0)
 I GMRCACT=11 D BLDCMT Q
"RTN","GMRCSLM4",97,0)
 ;
"RTN","GMRCSLM4",98,0)
 ;Build lines for general comments on any activity
"RTN","GMRCSLM4",99,0)
 I $D(^GMR(123,+GMRCO,40,+GMRCDA,1)) D  Q
"RTN","GMRCSLM4",100,0)
 . S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,0)) Q:'+LN
"RTN","GMRCSLM4",101,0)
 . ;Check for edited fields generated text with lines <75 characters
"RTN","GMRCSLM4",102,0)
 . I $G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0))["EDITED FIELDS" D BLDCMT Q
"RTN","GMRCSLM4",103,0)
 . D BLDCMT
"RTN","GMRCSLM4",104,0)
 . Q
"RTN","GMRCSLM4",105,0)
 . I $L($G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0)))'>75 D BLDCMT Q
"RTN","GMRCSLM4",106,0)
 . ;Use utilities for long line formating
"RTN","GMRCSLM4",107,0)
 . S FLG=1,LINE="     "
"RTN","GMRCSLM4",108,0)
 . D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM4",109,0)
 . D BLDASH
"RTN","GMRCSLM4",110,0)
 . Q
"RTN","GMRCSLM4",111,0)
 Q
"RTN","GMRCSLM4",112,0)
 ;
"RTN","GMRCSLM4",113,0)
BLDCMT ;Build comment lines
"RTN","GMRCSLM4",114,0)
 ;DASH is 1 or "" for print dash line after comment
"RTN","GMRCSLM4",115,0)
 S LN=0
"RTN","GMRCSLM4",116,0)
 F  S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,LN)) Q:'+LN  D
"RTN","GMRCSLM4",117,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,40,GMRCDA,1,LN,0) ;$P(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0),"^",1)
"RTN","GMRCSLM4",118,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",119,0)
 . Q
"RTN","GMRCSLM4",120,0)
 ;D BLDASH
"RTN","GMRCSLM4",121,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",122,0)
 Q
"RTN","GMRCSLM4",123,0)
 ;
"RTN","GMRCSLM4",124,0)
BLDASH ;Build separater line with dashes
"RTN","GMRCSLM4",125,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",126,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",127,0)
 Q
"RTN","GMRCTIU")
0^24^B13862450
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - TIU utilities for exchanging info with Consults ;11/21/00
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,18,15**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
 ;
"RTN","GMRCTIU",4,0)
 ; This routine invokes IA #2427,#2638,#2832
"RTN","GMRCTIU",5,0)
 ;
"RTN","GMRCTIU",6,0)
GET(GMRCO,GMRCTUFN,GMRCTUST,GMRCAUTH) ;update Consult from TIU 
"RTN","GMRCTIU",7,0)
 ;GMRCO=IFN from file 123
"RTN","GMRCTIU",8,0)
 ;GMRCTUFN=TIU IFN
"RTN","GMRCTIU",9,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",10,0)
 ;GMRCAUTH=Author of Document
"RTN","GMRCTIU",11,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCAD
"RTN","GMRCTIU",12,0)
 S GMRCA=$S($G(GMRCTUST)["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9)
"RTN","GMRCTIU",13,0)
 I '+$G(GMRCA) S GMRCA=99,GMRCSTS=99
"RTN","GMRCTIU",14,0)
 D:+$G(GMRCA) STATUS^GMRCTIU1
"RTN","GMRCTIU",15,0)
 K GMRCOM,GMRCND,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS
"RTN","GMRCTIU",16,0)
 Q
"RTN","GMRCTIU",17,0)
 ;
"RTN","GMRCTIU",18,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",19,0)
 ;GMRCTUFN=TIU IEN of results record
"RTN","GMRCTIU",20,0)
 ;LINECT=line count for list manager
"RTN","GMRCTIU",21,0)
 N ND,GMRCARR
"RTN","GMRCTIU",22,0)
 D RPC^TIUSRV(.GMRCARR,GMRCTUFN)
"RTN","GMRCTIU",23,0)
 S ND=0
"RTN","GMRCTIU",24,0)
 F  S ND=$O(@GMRCARR@(ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=@GMRCARR@(ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",25,0)
 ;D CLEAN^VALM10
"RTN","GMRCTIU",26,0)
 K @GMRCARR,RESFL,GMRCTIUY
"RTN","GMRCTIU",27,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",28,0)
 Q
"RTN","GMRCTIU",29,0)
ENTER(GMRCO) ; Complete a consult with TIU note
"RTN","GMRCTIU",30,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",31,0)
 D ENTER^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",32,0)
 Q
"RTN","GMRCTIU",33,0)
 ;
"RTN","GMRCTIU",34,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",35,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",36,0)
 D ADDEND^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",37,0)
 Q
"RTN","GMRCTIU",38,0)
 ;
"RTN","GMRCTIU",39,0)
SEND(DFN,OVRRIDE) ;Get consult list and return in ^TMP for TIU
"RTN","GMRCTIU",40,0)
 ;DFN=Patient's Internal file number from file 2
"RTN","GMRCTIU",41,0)
 ;OVRRIDE=BOOLEAN flag to override user validation
"RTN","GMRCTIU",42,0)
 N GMRCI,TAB
"RTN","GMRCTIU",43,0)
 Q:DFN=""!(DFN<1)
"RTN","GMRCTIU",44,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",45,0)
 K ^TMP("GMRCR",$J,"TIU")
"RTN","GMRCTIU",46,0)
 D GETCONSL(DFN,2,$G(OVRRIDE)) ;2=returns TIU format in ^TMP array
"RTN","GMRCTIU",47,0)
 Q
"RTN","GMRCTIU",48,0)
 ;
"RTN","GMRCTIU",49,0)
RPCLIST(GMRCY,DFN) ;Get consult list and return in GMRCY for GUI
"RTN","GMRCTIU",50,0)
 N GMRCI
"RTN","GMRCTIU",51,0)
 I '+$G(DFN) S GMRCY(0)=0
"RTN","GMRCTIU",52,0)
 D GETCONSL(DFN,1) ;1=returns GUI format in GMRCY array
"RTN","GMRCTIU",53,0)
 ; The consults will be returned from GETCONSL in the GMRCY array.
"RTN","GMRCTIU",54,0)
 S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",55,0)
 Q
"RTN","GMRCTIU",56,0)
GETCONSL(DFN,ORIGIN,OVRRIDE) ;Get the patients consults
"RTN","GMRCTIU",57,0)
 ;ORIGIN is whether the request is for GUI=1 or LM=2.
"RTN","GMRCTIU",58,0)
 ;The logic loops through the "AD" cross-reference to find consults
"RTN","GMRCTIU",59,0)
 ;The output will be formatted in GMRCY for the GUI if ORIGIN is 1.
"RTN","GMRCTIU",60,0)
 ;The output will be formatted in ^TMP("GMRCR",$J,"TIU" if ORIGIN is 2.
"RTN","GMRCTIU",61,0)
 ;
"RTN","GMRCTIU",62,0)
 N GMRCQIT,GMRC,GMRCDA,GMRCDT,GMRCEDT,GMRCYR,GMRCSP,GMRCST,GMRCSTS
"RTN","GMRCTIU",63,0)
 N GMRCTIU,GMRCTIUC,GMRCSS,GMRCSVC,GMRCPROC,GMRCNOTE,Y,GMRCDAT
"RTN","GMRCTIU",64,0)
 ;
"RTN","GMRCTIU",65,0)
 ; Aug 2000 - MA changed routine to use Parameter global to set the
"RTN","GMRCTIU",66,0)
 ; number of days to look backward when getting a list of consults.
"RTN","GMRCTIU",67,0)
 S GMRCYR=$$FMADD^XLFDT(DT,-$$GET^XPAR("ALL","GMRC CONSULT LIST DAYS"))
"RTN","GMRCTIU",68,0)
 S GMRCYR=9999999-GMRCYR,GMRCDAT=0
"RTN","GMRCTIU",69,0)
 F  S GMRCDAT=$O(^GMR(123,"AD",DFN,GMRCDAT)) Q:'GMRCDAT!(GMRCDAT>GMRCYR)  D
"RTN","GMRCTIU",70,0)
 . S GMRCDA=0
"RTN","GMRCTIU",71,0)
 . F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCDAT,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCTIU",72,0)
 .. S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",73,0)
 .. S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",74,0)
 .. I "25689"'[GMRCST Q  ;only return statuses c,p,a,s,pr
"RTN","GMRCTIU",75,0)
 .. S GMRCDT=+GMRC(0)
"RTN","GMRCTIU",76,0)
 .. S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",77,0)
 .. I '+$G(OVRRIDE) Q:'$$VALID^GMRCAU(GMRCSS,GMRCDA) 
"RTN","GMRCTIU",78,0)
 .. S GMRCTIUC=0
"RTN","GMRCTIU",79,0)
 .. D GETLIST^GMRCTIUL(GMRCDA,0,1,.GMRCTIUC)
"RTN","GMRCTIU",80,0)
 .. I ORIGIN=1 D BLDGMRCY Q
"RTN","GMRCTIU",81,0)
 .. I ORIGIN=2 D BLDTMP Q
"RTN","GMRCTIU",82,0)
 .. Q
"RTN","GMRCTIU",83,0)
 . Q
"RTN","GMRCTIU",84,0)
 Q
"RTN","GMRCTIU",85,0)
 ;
"RTN","GMRCTIU",86,0)
BLDGMRCY ;Build the GMRCY array of existing consults
"RTN","GMRCTIU",87,0)
 S GMRCSTS=$P($G(^ORD(100.01,+GMRCST,0)),"^",1)
"RTN","GMRCTIU",88,0)
 S GMRCSS=$P(GMRC(0),U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U)
"RTN","GMRCTIU",89,0)
 S GMRCPROC=$P($G(^GMR(123.3,+$P(GMRC(0),U,8),0)),U)
"RTN","GMRCTIU",90,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",91,0)
 S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC_U_GMRCSTS_U_+GMRCTIUC(0)
"RTN","GMRCTIU",92,0)
 Q
"RTN","GMRCTIU",93,0)
BLDTMP ;Build TMP global for TIU
"RTN","GMRCTIU",94,0)
 S GMRCSTS=$G(^ORD(100.01,+GMRCST,.1))
"RTN","GMRCTIU",95,0)
 S GMRCSP=$$ORTX^GMRCAU(GMRCDA)
"RTN","GMRCTIU",96,0)
 S GMRCNOTE=$S(GMRCTIUC(0)=1:" note",1:" notes")
"RTN","GMRCTIU",97,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCDT,"D")
"RTN","GMRCTIU",98,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",99,0)
 S ^TMP("GMRCR",$J,"TIU",GMRCI,0)=$J(GMRCI,3)_"> "_$E(GMRCEDT_TAB,1,12)_" C#"_$E(GMRCDA_TAB,1,9)_$E(GMRCSP_TAB,1,21)_$E(GMRCSTS_TAB,1,4)_$E(+GMRCTIUC(0)_GMRCNOTE_TAB,1,10)
"RTN","GMRCTIU",100,0)
 S ^TMP("GMRCR",$J,"TIU","B",GMRCI,GMRCDA)=""
"RTN","GMRCTIU",101,0)
 Q
"RTN","GMRCTIU3")
0^25^B7873536
"RTN","GMRCTIU3",1,0)
GMRCTIU3 ;SLC/DCM,JFR - Extract medicine results for consults tracking ;7/1/00 09:30
"RTN","GMRCTIU3",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,15**;DEC 27, 1997
"RTN","GMRCTIU3",3,0)
 ;
"RTN","GMRCTIU3",4,0)
 ; This routine invokes IA #3171
"RTN","GMRCTIU3",5,0)
 ;
"RTN","GMRCTIU3",6,0)
EN(GMRCO,ORIFN,GLOBAL,COUNT) ;;This entry point is used to collect consult data from the Medicine Package.
"RTN","GMRCTIU3",7,0)
 ;Consult/Request Tracking
"RTN","GMRCTIU3",8,0)
 ;GMRCSEL: The IEN of the consult from file 123.
"RTN","GMRCTIU3",9,0)
 ;COUNT:   The current position in ^TMP where data is to be placed.
"RTN","GMRCTIU3",10,0)
 D ENDT,EXIT Q
"RTN","GMRCTIU3",11,0)
 ;
"RTN","GMRCTIU3",12,0)
ENDT ;Get Medicine Results for display
"RTN","GMRCTIU3",13,0)
 S @GLOBAL@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIU3",14,0)
 S @GLOBAL@(COUNT,0)=$$CJ^XLFSTR("Medicine Report",80),COUNT=COUNT+1
"RTN","GMRCTIU3",15,0)
 D MCRPT(GMRCSR,GLOBAL,.COUNT)
"RTN","GMRCTIU3",16,0)
 S @GLOBAL@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIU3",17,0)
 Q
"RTN","GMRCTIU3",18,0)
MCRPT(RESULT,GBL,CNT) ; call MCAPI with OR WORKSTATION and format global  
"RTN","GMRCTIU3",19,0)
 N GMRCDFN
"RTN","GMRCTIU3",20,0)
 S GMRCDFN=$G(DFN)
"RTN","GMRCTIU3",21,0)
 N DFN
"RTN","GMRCTIU3",22,0)
 D START^ORWRP(80,"EN^MCAPI(RESULT,1)")
"RTN","GMRCTIU3",23,0)
 I '$D(^TMP("ORDATA",$J)) D  Q
"RTN","GMRCTIU3",24,0)
 . S @GBL@(CNT,0)="No Medicine Result"
"RTN","GMRCTIU3",25,0)
 . S CNT=CNT+1
"RTN","GMRCTIU3",26,0)
 N I S I=0
"RTN","GMRCTIU3",27,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:'I  D
"RTN","GMRCTIU3",28,0)
 . S @GBL@(CNT,0)=^TMP("ORDATA",$J,1,I)
"RTN","GMRCTIU3",29,0)
 . S CNT=CNT+1
"RTN","GMRCTIU3",30,0)
 K ^TMP("ORDATA",$J)
"RTN","GMRCTIU3",31,0)
 Q
"RTN","GMRCTIU3",32,0)
EXIT K GMRCH,GMRCX,GMRCSR,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCTIU3",33,0)
 K ^TMP("MC",$J)
"RTN","GMRCTIU3",34,0)
 Q
"RTN","GMRCTIU3",35,0)
SETFLD S GMRCFLD=0,GMRCFLDP="" F  S GMRCFLD=$O(^TMP("MC",$J,GMRCFT,GMRCFLD)) Q:GMRCFLD=""  S GMRCFLD(0)=^(GMRCFLD) D
"RTN","GMRCTIU3",36,0)
 .S GMRCFLDN=$P(GMRCFLD(0),"^",2) Q:GMRCFLDN[";W"
"RTN","GMRCTIU3",37,0)
 .I GMRCFLDP=GMRCFLDN S COUNT=COUNT-1,@GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_", "
"RTN","GMRCTIU3",38,0)
 .E  S GMRCFLDP=GMRCFLDN,@GLOBAL@(COUNT,0)=GMRCFLDP_":"_$E(TAB,1,18-$L(GMRCFLDP))
"RTN","GMRCTIU3",39,0)
 .I $L($P(GMRCFLD(0),"^",1))>45 S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$P(GMRCFLD(0),"^",1),COUNT=COUNT+1 Q
"RTN","GMRCTIU3",40,0)
 .I $L($P(GMRCFLD(0),"^",1))'>77 S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$P(GMRCFLD(0),"^",1)
"RTN","GMRCTIU3",41,0)
 .S COUNT=COUNT+1 Q
"RTN","GMRCTIU3",42,0)
 Q
"RTN","GMRCTIU3",43,0)
SUM ;
"RTN","GMRCTIU3",44,0)
 S GMRCSUM=$P(^TMP("MC",$J,"S"),"^",1),GMRCSUMP=$P(^TMP("MC",$J,"S"),"^",2)
"RTN","GMRCTIU3",45,0)
 I $L(GMRCSUM)!($L(GMRCSUMP)) S @GLOBAL@(COUNT,0)="SUMMARY:"
"RTN","GMRCTIU3",46,0)
 I $L(GMRCSUM) S @GLOBAL@(COUNT,0)=@GLOBAL@(COUNT,0)_$E(TAB,1,11)_GMRCSUM,COUNT=COUNT+1
"RTN","GMRCTIU3",47,0)
 I $L(GMRCSUMP) S @GLOBAL@(COUNT,0)="SUMMARY PROCEDURE: "_GMRCSUMP,COUNT=COUNT+1
"RTN","GMRCTIU3",48,0)
 Q
"RTN","GMRCTIU3",49,0)
END S GMRCCT=COUNT-1
"RTN","GMRCTIU3",50,0)
 K COUNT,GMRCH,GMRCFT,GMRCFLD,GMRCSUM,GMRCFLDN,GMRCSUMP,GMRCRTIT,GMRCPRNM,GMRCFLDP,MCC,MCK,MCMFLD,MCMUP
"RTN","GMRCTIU3",51,0)
 Q
"RTN","GMRCTIUE")
0^26^B43714179
"RTN","GMRCTIUE",1,0)
GMRCTIUE ;SLC/DCM,DLT - Complete/Update TIU notes ;7/16/98  02:10
"RTN","GMRCTIUE",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,10,14,12,15**;DEC 27, 1997
"RTN","GMRCTIUE",3,0)
 ;
"RTN","GMRCTIUE",4,0)
 ; This routine invokes IA #2410,#2694,#2833,#2699,#2700
"RTN","GMRCTIUE",5,0)
 ;
"RTN","GMRCTIUE",6,0)
ENTER(GMRCO) ; Enter a note in TIU for the consult result
"RTN","GMRCTIUE",7,0)
 ;If consult from list is defined in GMRCO, then use it.
"RTN","GMRCTIUE",8,0)
 K GMRCQUT N TIUDA,TIUCLASS,GMRCLCK
"RTN","GMRCTIUE",9,0)
 N GMRCMC
"RTN","GMRCTIUE",10,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",11,0)
 Q:$D(GMRCQUT)!'$L($G(GMRCO))
"RTN","GMRCTIUE",12,0)
 I '$$LOCK^GMRCA1(GMRCO) D EDEX Q
"RTN","GMRCTIUE",13,0)
 S GMRCLCK=1
"RTN","GMRCTIUE",14,0)
 D CHKSTS I $G(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",15,0)
 I $D(VALM) D FULL^VALM1
"RTN","GMRCTIUE",16,0)
 ;
"RTN","GMRCTIUE",17,0)
 ;If service administrative user, then use administrative complete logic
"RTN","GMRCTIUE",18,0)
 I $$VALID^GMRCAU($P(^GMR(123,GMRCO,0),U,5))=3 D  Q
"RTN","GMRCTIUE",19,0)
 . I $P(^GMR(123,+GMRCO,0),U,12)'=2 S GMRCMC=$$MED(GMRCO)
"RTN","GMRCTIUE",20,0)
 . I $G(GMRCMC),$P(^GMR(123,+GMRCO,0),U,12)=2 D EDEX Q
"RTN","GMRCTIUE",21,0)
 . W !,$$CJ^XLFSTR("- Proceeding with Administrative Complete -",80)
"RTN","GMRCTIUE",22,0)
 . D COMP^GMRCAAC(+GMRCO)
"RTN","GMRCTIUE",23,0)
 . D EDEX
"RTN","GMRCTIUE",24,0)
 ;
"RTN","GMRCTIUE",25,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",26,0)
 S GMRCMC=$$MED(GMRCO)
"RTN","GMRCTIUE",27,0)
 ;If a Procedure, allow Medicine or fall through to a note
"RTN","GMRCTIUE",28,0)
 I $G(GMRCMC) D  I $G(GMRCQIT)=1 D EDEX Q
"RTN","GMRCTIUE",29,0)
 . N DUOUT,DTOUT,X,Y,DIR
"RTN","GMRCTIUE",30,0)
 . W !
"RTN","GMRCTIUE",31,0)
 . S DIR(0)="YA",DIR("B")="Y",DIR("A")="Continue with Note Entry? "
"RTN","GMRCTIUE",32,0)
 . D ^DIR I Y<1 S GMRCQIT=1
"RTN","GMRCTIUE",33,0)
 . W !
"RTN","GMRCTIUE",34,0)
 ;Get list of notes If no new notes, add new then quit
"RTN","GMRCTIUE",35,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",36,0)
 I $D(VALM) D FULL^VALM1
"RTN","GMRCTIUE",37,0)
 I '$$GETLIST(GMRCDFN,GMRCO,.GMRCTIUC) D NEW,EDEX Q
"RTN","GMRCTIUE",38,0)
 ;
"RTN","GMRCTIUE",39,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIUE",40,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",41,0)
 I GMRCTIUC(GMRCVF)=1 D  Q
"RTN","GMRCTIUE",42,0)
 . N DIR,X,Y,DTOUT,DUOUT
"RTN","GMRCTIUE",43,0)
 . D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",44,0)
 . S DIR(0)="YA",DIR("B")="Yes",DIR("A")="Edit/Review this note? "
"RTN","GMRCTIUE",45,0)
 . D ^DIR I Y>0 D
"RTN","GMRCTIUE",46,0)
 .. S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",47,0)
 .. I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",48,0)
 . S DIR(0)="YA"
"RTN","GMRCTIUE",49,0)
 . S DIR("B")="No",DIR("A")="Would you like to enter a new note? "
"RTN","GMRCTIUE",50,0)
 . W ! D ^DIR I Y>0 D NEW
"RTN","GMRCTIUE",51,0)
 . D EDEX
"RTN","GMRCTIUE",52,0)
 . Q
"RTN","GMRCTIUE",53,0)
 ;
"RTN","GMRCTIUE",54,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",55,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",56,0)
 ;
"RTN","GMRCTIUE",57,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",58,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",59,0)
 I $D(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",60,0)
 I '+(GMRCSELR) D  D EDEX Q
"RTN","GMRCTIUE",61,0)
 . ;didn't select existing note, allow a new entry
"RTN","GMRCTIUE",62,0)
 . N DIR,X,Y
"RTN","GMRCTIUE",63,0)
 . S DIR(0)="Y",DIR("A")="Would you like to enter a new note"
"RTN","GMRCTIUE",64,0)
 . S DIR("B")="N" D ^DIR
"RTN","GMRCTIUE",65,0)
 . I Y<1 K DTOUT,DUOUT,X,Y Q
"RTN","GMRCTIUE",66,0)
 . D NEW
"RTN","GMRCTIUE",67,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",68,0)
 ;
"RTN","GMRCTIUE",69,0)
 I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",70,0)
 ;
"RTN","GMRCTIUE",71,0)
 D EDEX
"RTN","GMRCTIUE",72,0)
 Q
"RTN","GMRCTIUE",73,0)
 ;
"RTN","GMRCTIUE",74,0)
MED(GMRCO) ;allow med results if appropriate
"RTN","GMRCTIUE",75,0)
 ;If a Procedure and setu properly, allow Medicine
"RTN","GMRCTIUE",76,0)
 N GMRCMED,GMRCQIT S GMRCMED=0
"RTN","GMRCTIUE",77,0)
 I $P(^GMR(123,+GMRCO,0),U,17)="P" D
"RTN","GMRCTIUE",78,0)
 . Q:'$P(^GMR(123.3,+$P(^GMR(123,+GMRCO,0),U,8),0),U,5)
"RTN","GMRCTIUE",79,0)
 . D FULL^VALM1
"RTN","GMRCTIUE",80,0)
 . N DIR,DIROUT,DTOUT,DUOUT,X,Y
"RTN","GMRCTIUE",81,0)
 . S DIR(0)="YA",DIR("B")="Y"
"RTN","GMRCTIUE",82,0)
 . S DIR("A",1)="  ",DIR("A")="Attach Medicine Results? "
"RTN","GMRCTIUE",83,0)
 . D ^DIR Q:Y<1
"RTN","GMRCTIUE",84,0)
 . K DIR
"RTN","GMRCTIUE",85,0)
 . S GMRCMED=1
"RTN","GMRCTIUE",86,0)
 . D ARMED^GMRCAR
"RTN","GMRCTIUE",87,0)
 Q GMRCMED
"RTN","GMRCTIUE",88,0)
 ;
"RTN","GMRCTIUE",89,0)
SAUSER() ; admin user?
"RTN","GMRCTIUE",90,0)
 N GMRCSS,GMRCADUS
"RTN","GMRCTIUE",91,0)
 S GMRCSS=+$P($G(^GMR(123,+GMRCO,0)),"^",5) Q:'+GMRCSS 0
"RTN","GMRCTIUE",92,0)
 I $D(^GMR(123.5,+$P($G(^GMR(123,+GMRCO,0)),"^",5),123.33,"B",DUZ)) Q 1
"RTN","GMRCTIUE",93,0)
 I '$L($TEXT(VALIDU^GMRCAU)) Q 0
"RTN","GMRCTIUE",94,0)
 S GMRCADUS=0
"RTN","GMRCTIUE",95,0)
 I $L($TEXT(VALIDU^GMRCAU)) D TEAM^GMRCAU(.GMRCADUS,123.34,DUZ)
"RTN","GMRCTIUE",96,0)
 Q +GMRCADUS
"RTN","GMRCTIUE",97,0)
 ;
"RTN","GMRCTIUE",98,0)
CHKSTS ;Check the order status before allowing entry of a note
"RTN","GMRCTIUE",99,0)
 N STATUS S STATUS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCTIUE",100,0)
 I $S(STATUS=1:1,STATUS=13:1,1:0) D
"RTN","GMRCTIUE",101,0)
 . W !,"This order has been "
"RTN","GMRCTIUE",102,0)
 . W $S(STATUS=1:"DISCONTINUED",1:"CANCELLED")
"RTN","GMRCTIUE",103,0)
 . W ".  A note cannot be entered."
"RTN","GMRCTIUE",104,0)
 . D PAUSE S GMRCQUT=1
"RTN","GMRCTIUE",105,0)
 Q
"RTN","GMRCTIUE",106,0)
 ;
"RTN","GMRCTIUE",107,0)
EDITNOTE(GMRCTUFN) ;use TIU LM for an existing note
"RTN","GMRCTIUE",108,0)
 I +$D(^TIU(8925,+GMRCTUFN,0)) D  Q
"RTN","GMRCTIUE",109,0)
 . D EXSTNOTE^TIUBR1(+GMRCDFN,+GMRCTUFN)
"RTN","GMRCTIUE",110,0)
 ;
"RTN","GMRCTIUE",111,0)
 ; link is missing
"RTN","GMRCTIUE",112,0)
 W !,"A note #"_+GMRCTUFN_" is linked to the consult,"
"RTN","GMRCTIUE",113,0)
 W !,"  but the note is no longer in TIU!"
"RTN","GMRCTIUE",114,0)
 D PAUSE
"RTN","GMRCTIUE",115,0)
 Q
"RTN","GMRCTIUE",116,0)
 ;
"RTN","GMRCTIUE",117,0)
SINGLE(GMRCVF) ;Get the single result entry from the list for the file type
"RTN","GMRCTIUE",118,0)
 N RSLT,GMRCVP
"RTN","GMRCTIUE",119,0)
 S RSLT="",GMRCVP=0
"RTN","GMRCTIUE",120,0)
 F  S RSLT=$O(^TMP("GMRC50",$J,RSLT)) Q:RSLT=""  D  Q:+GMRCVP
"RTN","GMRCTIUE",121,0)
 . I $P(RSLT,";",2)=GMRCVF S GMRCVP=RSLT
"RTN","GMRCTIUE",122,0)
 Q +GMRCVP
"RTN","GMRCTIUE",123,0)
 ;
"RTN","GMRCTIUE",124,0)
GETTUFN(GMRCSELR) ;Get the result entry from the selected entry
"RTN","GMRCTIUE",125,0)
 N RSLT
"RTN","GMRCTIUE",126,0)
 S RSLT=$O(^TMP("GMRC50R",$J,GMRCSELR,""))
"RTN","GMRCTIUE",127,0)
 Q RSLT
"RTN","GMRCTIUE",128,0)
 ;
"RTN","GMRCTIUE",129,0)
NEW ;Enter a new result through TIU if implemented or old Completion logic
"RTN","GMRCTIUE",130,0)
 S TIUCLASS=+$$CLASS
"RTN","GMRCTIUE",131,0)
 I TIUCLASS'>0 D  Q
"RTN","GMRCTIUE",132,0)
 . W !!,$C(7),"Consult Resulting through TIU is not yet implemented."
"RTN","GMRCTIUE",133,0)
 . W !,"Proceeding with Administrative Complete."
"RTN","GMRCTIUE",134,0)
 . D COMP^GMRCAAC(+GMRCO)
"RTN","GMRCTIUE",135,0)
 ;
"RTN","GMRCTIUE",136,0)
 N GMRCTIDA
"RTN","GMRCTIUE",137,0)
 D MAIN^TIUEDIT(TIUCLASS,.GMRCTIDA,GMRCDFN,"","","","",1)
"RTN","GMRCTIUE",138,0)
 ;
"RTN","GMRCTIUE",139,0)
 Q
"RTN","GMRCTIUE",140,0)
 ;
"RTN","GMRCTIUE",141,0)
CLASS() ; What is the TIU Class (or Document Class) for CONSULTS
"RTN","GMRCTIUE",142,0)
 N GMRCY,GMRCDTYP,ERR
"RTN","GMRCTIUE",143,0)
 S GMRCY=+$$FIND1^DIC(8925.1,,"X","CONSULTS","B",,"ERR")
"RTN","GMRCTIUE",144,0)
 S GMRCDTYP=$$GET1^DIQ(8925.1,+GMRCY,.04,"I")
"RTN","GMRCTIUE",145,0)
 I +GMRCY>0,$S(GMRCDTYP="CL":0,GMRCDTYP="DC":0,1:1) S GMRCY=0
"RTN","GMRCTIUE",146,0)
 Q GMRCY
"RTN","GMRCTIUE",147,0)
 ;
"RTN","GMRCTIUE",148,0)
GETLIST(GMRCDFN,GMRCO,GMRCLIST) ;
"RTN","GMRCTIUE",149,0)
 ;
"RTN","GMRCTIUE",150,0)
 N GMRCVF
"RTN","GMRCTIUE",151,0)
 ;
"RTN","GMRCTIUE",152,0)
 D GETLIST^GMRCTIUL(GMRCO,2,1,.GMRCTIUC)
"RTN","GMRCTIUE",153,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",154,0)
 Q +$G(GMRCTIUC(GMRCVF))
"RTN","GMRCTIUE",155,0)
 ;
"RTN","GMRCTIUE",156,0)
ADDEND(GMRCO) ; Make an addendum action for a selected consult
"RTN","GMRCTIUE",157,0)
 N TIUDA,GMRCTX,GMRCDFN,GMRCADUZ,RSLTINFO,GMRCACT,GMRCTIUC
"RTN","GMRCTIUE",158,0)
 N GMRCLCK,RSLTIEN
"RTN","GMRCTIUE",159,0)
 K GMRCQUT
"RTN","GMRCTIUE",160,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",161,0)
 Q:$D(GMRCQUT)!'+($G(GMRCO))
"RTN","GMRCTIUE",162,0)
 ;
"RTN","GMRCTIUE",163,0)
 ;If service administrative user, then QUIT.
"RTN","GMRCTIUE",164,0)
 I $$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5))=3 D  Q
"RTN","GMRCTIUE",165,0)
 . D EXAC^GMRCADC("You do not have the ability to edit this note.")
"RTN","GMRCTIUE",166,0)
 ;
"RTN","GMRCTIUE",167,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",168,0)
 ;
"RTN","GMRCTIUE",169,0)
 ;Get list of notes for this consult. if no notes, then quit.
"RTN","GMRCTIUE",170,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",171,0)
 I '$$GETLIST(GMRCDFN,+GMRCO,.GMRCTIUC) D  Q
"RTN","GMRCTIUE",172,0)
 . W !,"This consult does not yet have an associated note."
"RTN","GMRCTIUE",173,0)
 . W !,"  Use the Complete action to enter a new note."
"RTN","GMRCTIUE",174,0)
 . D PAUSE,EDEX
"RTN","GMRCTIUE",175,0)
 ;
"RTN","GMRCTIUE",176,0)
 I '$$LOCK^GMRCA1(GMRCO) D EDEX Q
"RTN","GMRCTIUE",177,0)
 S GMRCLCK=1
"RTN","GMRCTIUE",178,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIUE",179,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",180,0)
 I GMRCTIUC(GMRCVF)=1 D  D EDEX Q
"RTN","GMRCTIUE",181,0)
 . S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",182,0)
 . Q:'+GMRCTUFN
"RTN","GMRCTIUE",183,0)
 . D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",184,0)
 . N GMRCVP,RSLTINFO,AUTHOR
"RTN","GMRCTIUE",185,0)
 . S GMRCVP=+GMRCTUFN_";"_GMRCVF
"RTN","GMRCTIUE",186,0)
 . S RSLTIEN=$O(^TMP("GMRC50",$J,GMRCVP,0))
"RTN","GMRCTIUE",187,0)
 . S RSLTINFO=$G(^TMP("GMRC50",$J,GMRCVP,RSLTIEN))
"RTN","GMRCTIUE",188,0)
 . I $P(RSLTINFO,"^",6)="completed" D ADDEND1(+GMRCTUFN) Q
"RTN","GMRCTIUE",189,0)
 . I (DUZ=+$P(RSLTINFO,"^",4)) D EDITNOTE(+GMRCTUFN) Q
"RTN","GMRCTIUE",190,0)
 . W !,"You may not addend to the incomplete associated note."
"RTN","GMRCTIUE",191,0)
 . W !,"You are not the author of the existing note."
"RTN","GMRCTIUE",192,0)
 . I $$READ^GMRCACMT("Y","Do you want to add a new note ","YES") D NEW
"RTN","GMRCTIUE",193,0)
 . Q
"RTN","GMRCTIUE",194,0)
 ;
"RTN","GMRCTIUE",195,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",196,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",197,0)
 ;
"RTN","GMRCTIUE",198,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",199,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",200,0)
 I $D(GMRCQUT)!'+(GMRCSELR) D EDEX Q
"RTN","GMRCTIUE",201,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",202,0)
 ;
"RTN","GMRCTIUE",203,0)
 I +GMRCTUFN D ADDEND1(+GMRCTUFN),EDEX Q
"RTN","GMRCTIUE",204,0)
 ;
"RTN","GMRCTIUE",205,0)
 D EDEX
"RTN","GMRCTIUE",206,0)
 Q
"RTN","GMRCTIUE",207,0)
ADDEND1(TIUDA) ;Add an addendum
"RTN","GMRCTIUE",208,0)
 ;
"RTN","GMRCTIUE",209,0)
 D FULL^VALM1,ADDEND1^TIURA1
"RTN","GMRCTIUE",210,0)
 Q
"RTN","GMRCTIUE",211,0)
 ;
"RTN","GMRCTIUE",212,0)
EDEX ;
"RTN","GMRCTIUE",213,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCTIUE",214,0)
 K GMRCDFN,GMRCO,GMRCQUT,GMRCTUFN,GMRCSEL
"RTN","GMRCTIUE",215,0)
 Q
"RTN","GMRCTIUE",216,0)
 ;
"RTN","GMRCTIUE",217,0)
PAUSE ; Pause for user
"RTN","GMRCTIUE",218,0)
 ;
"RTN","GMRCTIUE",219,0)
 N X W !,"Press <RETURN> to continue: " R X:DTIME E  W " (timeout)"
"RTN","GMRCTIUE",220,0)
 Q
"RTN","GMRCTIUE",221,0)
 ;
"RTN","GMRCTIUL")
0^27^B15774660
"RTN","GMRCTIUL",1,0)
GMRCTIUL ;SLC/DCM,DLT - Get list of existing results for consults ;5/01/98  10:09
"RTN","GMRCTIUL",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,14,15**;DEC 27, 1997
"RTN","GMRCTIUL",3,0)
 ;
"RTN","GMRCTIUL",4,0)
 ; This routine invokes IA #2834
"RTN","GMRCTIUL",5,0)
 ;
"RTN","GMRCTIUL",6,0)
GETLIST(GMRCO,GETWHAT,TYPE,GMRCNT) ;Get the count and list of results
"RTN","GMRCTIUL",7,0)
 ;Input variables:
"RTN","GMRCTIUL",8,0)
 ;GMRCO=consult entry from 123
"RTN","GMRCTIUL",9,0)
 ;GETWHAT=how much to return
"RTN","GMRCTIUL",10,0)
 ;       0 = count only returned
"RTN","GMRCTIUL",11,0)
 ;       1 = count + ^TMP internal values from TIU
"RTN","GMRCTIUL",12,0)
 ;       2 = count + ^TMP internal values from TIU
"RTN","GMRCTIUL",13,0)
 ;                 + ^TMP display format array
"RTN","GMRCTIUL",14,0)
 ;TYPE=what type of results to return
"RTN","GMRCTIUL",15,0)
 ;       0=all types
"RTN","GMRCTIUL",16,0)
 ;       1=TIU only
"RTN","GMRCTIUL",17,0)
 ;       2=Medicine results only
"RTN","GMRCTIUL",18,0)
 ;returns GMRCNT() = result count
"RTN","GMRCTIUL",19,0)
 ;        ^TMP("GMRC50",$J,GMRCRVP,GMRCRIEN)=summary data from source
"RTN","GMRCTIUL",20,0)
 ;             where GMRCRVP is the variable pointer value
"RTN","GMRCTIUL",21,0)
 ;             where GMRCRIEN is the entry in the 50th node
"RTN","GMRCTIUL",22,0)
 ;        ^TMP("GMRC50R",$J,GMRCRIEN)= external list for review
"RTN","GMRCTIUL",23,0)
 N COUNT,GMRCRIEN,TAB
"RTN","GMRCTIUL",24,0)
 K ^TMP("GMRC50",$J),^TMP("GMRC50R",$J),GMRCNT
"RTN","GMRCTIUL",25,0)
 S (COUNT,GMRCRIEN)=0,GMRCNT(0)=COUNT
"RTN","GMRCTIUL",26,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIUL",27,0)
 ;Get results from the result multiple
"RTN","GMRCTIUL",28,0)
 F  S GMRCRIEN=$O(^GMR(123,+GMRCO,50,GMRCRIEN)) Q:'GMRCRIEN  D  I $G(GMRCQUT) K GMRCQUT Q
"RTN","GMRCTIUL",29,0)
 . S GMRCRVP=$P($G(^GMR(123,+GMRCO,50,+GMRCRIEN,0)),"^",1) I GMRCRVP="" S GMRCQUT=1 Q
"RTN","GMRCTIUL",30,0)
 . D UPDCNT
"RTN","GMRCTIUL",31,0)
 . Q
"RTN","GMRCTIUL",32,0)
 ;Get TIU NARRATIVE RESULT if the result multiple is not loaded yet
"RTN","GMRCTIUL",33,0)
 I COUNT=0,'$D(^GMR(123,+GMRCO,50)),+$P(^GMR(123,+GMRCO,0),"^",20) D
"RTN","GMRCTIUL",34,0)
 . S GMRCRVP=$P($G(^GMR(123,+GMRCO,0)),"^",20)_";TIU(8925,"
"RTN","GMRCTIUL",35,0)
 . D UPDCNT
"RTN","GMRCTIUL",36,0)
 . Q
"RTN","GMRCTIUL",37,0)
 S GMRCNT(0)=COUNT
"RTN","GMRCTIUL",38,0)
 Q
"RTN","GMRCTIUL",39,0)
 ;
"RTN","GMRCTIUL",40,0)
UPDCNT ;Update count of existing results for the consult and build array
"RTN","GMRCTIUL",41,0)
 S GMRCVF=$P(GMRCRVP,";",2)
"RTN","GMRCTIUL",42,0)
 I '$G(GMRCNT(GMRCVF)) S GMRCNT(GMRCVF)=0
"RTN","GMRCTIUL",43,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUL",44,0)
 S GMRCNT(GMRCVF)=GMRCNT(GMRCVF)+1
"RTN","GMRCTIUL",45,0)
 I +GETWHAT,TYPE=1 D TIUTMP(+GETWHAT)
"RTN","GMRCTIUL",46,0)
 Q
"RTN","GMRCTIUL",47,0)
 ;
"RTN","GMRCTIUL",48,0)
TIUTMP(GETWHAT) ;build ^TMP array for results based on TIU when type=1
"RTN","GMRCTIUL",49,0)
 I $G(GMRCRVP)["MCAR" D  Q
"RTN","GMRCTIUL",50,0)
 .S COUNT=COUNT-1
"RTN","GMRCTIUL",51,0)
 .S GMRCNT(GMRCVF)=GMRCNT(GMRCVF)-1
"RTN","GMRCTIUL",52,0)
 S ^TMP("GMRC50",$J,GMRCRVP,COUNT)=$$RESOLVE^TIUSRVLO(+GMRCRVP)
"RTN","GMRCTIUL",53,0)
 Q:GETWHAT=1  ;get internal value global
"RTN","GMRCTIUL",54,0)
 N GMRCRDAT,GMRCDOCT,GMRCEDT,GMRCAUTH,GMRCSTS,GMRCTX
"RTN","GMRCTIUL",55,0)
 S GMRCRDAT=^TMP("GMRC50",$J,GMRCRVP,COUNT)
"RTN","GMRCTIUL",56,0)
 S GMRCDOCT=$E($P(GMRCRDAT,"^",1),1,19)
"RTN","GMRCTIUL",57,0)
 S GMRCEDT=$$FMTE^XLFDT($P(GMRCRDAT,U,2),"D")
"RTN","GMRCTIUL",58,0)
 S GMRCAUTH=$E($P($G(^VA(200,+$P(GMRCRDAT,"^",4),0)),U,1),1,12)
"RTN","GMRCTIUL",59,0)
 S GMRCSTS=$E($P(GMRCRDAT,"^",6),1,5)
"RTN","GMRCTIUL",60,0)
 S GMRCTX=$J(COUNT,3)_"> "_$E(GMRCDOCT_TAB,1,20)_$E("#"_+GMRCRVP_TAB,1,9)_$E(GMRCEDT_TAB,1,13)_$E(GMRCAUTH_TAB,1,14)_$E(GMRCSTS_TAB,1,6)_$E("#"_+$P(GMRCRDAT,"^",9)_TAB,1,10)
"RTN","GMRCTIUL",61,0)
 S ^TMP("GMRC50R",$J,COUNT,GMRCRVP)=GMRCTX
"RTN","GMRCTIUL",62,0)
 Q
"RTN","GMRCTIUL",63,0)
 ;
"RTN","GMRCTIUL",64,0)
PROCTMP ;build ^TMP array for procedure results when type note=1
"RTN","GMRCTIUL",65,0)
 Q:TYPE=1
"RTN","GMRCTIUL",66,0)
 Q
"RTN","GMRCTIUL",67,0)
 ;
"RTN","GMRCTIUL",68,0)
SHOWTIU ;Display the current TIU results available
"RTN","GMRCTIUL",69,0)
 N GMRCRVP,GMRCRCT
"RTN","GMRCTIUL",70,0)
 W !,"Notes associated with this consult:",!
"RTN","GMRCTIUL",71,0)
 W !," No.  Document Title       TIU    Entered      Author        Sts  Consult"
"RTN","GMRCTIUL",72,0)
 S GMRCRCT=0
"RTN","GMRCTIUL",73,0)
 F  S GMRCRCT=$O(^TMP("GMRC50R",$J,GMRCRCT)) Q:'+GMRCRCT  D
"RTN","GMRCTIUL",74,0)
 . S GMRCRVP=$O(^TMP("GMRC50R",$J,GMRCRCT,""))
"RTN","GMRCTIUL",75,0)
 . W !,^TMP("GMRC50R",$J,GMRCRCT,GMRCRVP)
"RTN","GMRCTIUL",76,0)
 Q
"RTN","GMRCTIUL",77,0)
SELR(GMRCRCT) ;Select a note from the list
"RTN","GMRCTIUL",78,0)
 ;Input GMRCNT=array with the count of TIU notes
"RTN","GMRCTIUL",79,0)
 I '+$G(GMRCRCT("TIU(8925,")),'+$O(^TMP("GMRC50R",$J,0)) S GMRCMSG="No results available" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q 0
"RTN","GMRCTIUL",80,0)
 ;Select a note
"RTN","GMRCTIUL",81,0)
 N DIR,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCTIUL",82,0)
 S DIR("A")="Select an existing note"
"RTN","GMRCTIUL",83,0)
 S DIR(0)="NO^1:"_GMRCRCT("TIU(8925,")
"RTN","GMRCTIUL",84,0)
 D ^DIR
"RTN","GMRCTIUL",85,0)
 Q +Y
"RTN","GMRCTIUL",86,0)
LN1 ;Used by filemanager print template to format line
"RTN","GMRCTIUL",87,0)
 S:'$G(COUNT) COUNT=1
"RTN","GMRCTIUL",88,0)
 S GMRCVF="TIU(8925,",GMRCNT(GMRCVF)=1,TAB=" "
"RTN","GMRCTIUL",89,0)
 S GMRCRVP=+($G(^GMR(123,D0,50,D1,0)))
"RTN","GMRCTIUL",90,0)
 Q:'GMRCRVP
"RTN","GMRCTIUL",91,0)
 N GMRCDOCT,GMRCEDT
"RTN","GMRCTIUL",92,0)
 S GMRCRDAT=$$RESOLVE^TIUSRVLO(+GMRCRVP)
"RTN","GMRCTIUL",93,0)
 S GMRCDOCT=$E($P(GMRCRDAT,"^",1),1,19)
"RTN","GMRCTIUL",94,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCRDAT,"D")
"RTN","GMRCTIUL",95,0)
 S GMRCTX=$E("#"_+GMRCRVP_TAB,1,9)_$E(GMRCDOCT_TAB,1,22)_$E(GMRCEDT_TAB,1,13)_$P(GMRCRDAT,U,3)
"RTN","GMRCTIUL",96,0)
 W GMRCTX
"RTN","GMRCTIUL",97,0)
 Q
"RTN","GMRCTIUL",98,0)
LN2 ;Used by Fileman to write second line
"RTN","GMRCTIUL",99,0)
 N GMRCAUTH,GMRCSTS
"RTN","GMRCTIUL",100,0)
 S GMRCAUTH=$E($P($G(^VA(200,+$P(GMRCRDAT,"^",4),0)),U,1),1,12)
"RTN","GMRCTIUL",101,0)
 S GMRCSTS=$E($P(GMRCRDAT,"^",6),1,5)
"RTN","GMRCTIUL",102,0)
 S GMRCTX=$E(TAB,1,5)_$E("Author: "_GMRCAUTH_TAB,1,16)_$E(GMRCSTS_TAB,1,8)_$E("#"_+$P(GMRCRDAT,"^",9)_TAB,1,10)
"RTN","GMRCTIUL",103,0)
 W GMRCTX
"RTN","GMRCTIUL",104,0)
 Q
"RTN","GMRCTIUL",105,0)
 ;
"RTN","GMRCTIUP")
0^33^B59164447
"RTN","GMRCTIUP",1,0)
GMRCTIUP ;SLC/DCM,JFR - TIU/Consults UTILITIES; 12/12/00 20:00
"RTN","GMRCTIUP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,15**;DEC 27, 1997
"RTN","GMRCTIUP",3,0)
 ;
"RTN","GMRCTIUP",4,0)
 ; This routine invokes IA #616,#2693
"RTN","GMRCTIUP",5,0)
 ;
"RTN","GMRCTIUP",6,0)
HDR(GMRCTUPR,GMRCGLB,COUNT,FROM) ;Get Source info for header of display
"RTN","GMRCTIUP",7,0)
 ;and place data in ^TMP( global. Do Not Show Any Results
"RTN","GMRCTIUP",8,0)
 ;GMRCTUPR=TIU record being sought
"RTN","GMRCTIUP",9,0)
 ;GMRCGLOB=Global where data goes - i.e., ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,LINECT,0)
"RTN","GMRCTIUP",10,0)
 ;COUNT=Count of where current line is to go in ^TMP( global
"RTN","GMRCTIUP",11,0)
 ;FROM=flag to tell whether to add Addendum TIU # or not 0=NO, Otherwise addendum number
"RTN","GMRCTIUP",12,0)
 N DR,GMRCTMP
"RTN","GMRCTIUP",13,0)
 S:'$D(FROM) FROM=""
"RTN","GMRCTIUP",14,0)
 S DR=".01;.05;.07;.09;1201;1202;1204;1205;1208;1301;1302",GMRCERR=""
"RTN","GMRCTIUP",15,0)
 D EXTRACT^TIULQ(GMRCPTR,"LOCAL",.GMRCERR,DR)
"RTN","GMRCTIUP",16,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",17,0)
 S @GMRCGLB@(COUNT,0)="Source Information",COUNT=COUNT+1,@GMRCGLB@(COUNT,0)=""
"RTN","GMRCTIUP",18,0)
 S @GMRCGLB@(COUNT,0)="  Document Status: "_LOCAL(GMRCPTR,.05,"E"),COUNT=COUNT+1
"RTN","GMRCTIUP",19,0)
 S @GMRCGLB@(COUNT,0)="       Entry Date: "_$P($G(LOCAL(GMRCPTR,1201,"E")),":",1,2),COUNT=COUNT+1
"RTN","GMRCTIUP",20,0)
 S @GMRCGLB@(COUNT,0)="            Visit: "_$G(LOCAL(GMRCPTR,.07,"E"))_"  "_$G(LOCAL(GMRCPTR,1205,"E"))
"RTN","GMRCTIUP",21,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUP",22,0)
 S @GMRCGLB@(COUNT,0)="           Author: "_LOCAL(GMRCPTR,1202,"E")
"RTN","GMRCTIUP",23,0)
 S COUNT=COUNT+1
"RTN","GMRCTIUP",24,0)
 S @GMRCGLB@(COUNT,0)="  Expected Signer: "_$E(LOCAL(GMRCPTR,1204,"E")_TAB,1,22)_$E(TAB,1,5)_"Expected Cosigner: "_$S($L($G(LOCAL(GMRCPTR,1208,"E"))):LOCAL(GMRCPTR,1208,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",25,0)
 S @GMRCGLB@(COUNT,0)="       Entered By: "_$E(LOCAL(GMRCPTR,1302,"E")_TAB,1,30)_"TIU Document #: "_GMRCTUPR,COUNT=COUNT+1
"RTN","GMRCTIUP",26,0)
 S @GMRCGLB@(COUNT,0)=$S(+FROM:"  TIU Addendum Document #: "_FROM,1:"")_$S(+FROM:$E(TAB,1,10),1:"     ")_"     Urgency: "_$S($L($G(LOCAL(GMRCPTR,.09,"E"))):LOCAL(GMRCPTR,.09,"E"),1:"None"),COUNT=COUNT+1
"RTN","GMRCTIUP",27,0)
 S @GMRCGLB@(COUNT,0)="",COUNT=COUNT+1
"RTN","GMRCTIUP",28,0)
 K LOCAL
"RTN","GMRCTIUP",29,0)
 Q
"RTN","GMRCTIUP",30,0)
PRINT(GMRCO,LINECT,GMRCRT) ;get TIU results and prepare them for printing on the 513
"RTN","GMRCTIUP",31,0)
 ;GMRCRT=Flag from RT^GMRCA1 indicating that result request is from there: GMRCRT=0 means 'NO', GRMRCRT=1 means 'YES" (and ES is appended to TIU main result); also, 
"RTN","GMRCTIUP",32,0)
 ;    No result is passed back to print on the 513 if GMRCRT=0.
"RTN","GMRCTIUP",33,0)
 ;GMRCTUFN=IEN of the TIU result from file 8925
"RTN","GMRCTIUP",34,0)
 ;GMRCSIG=signature block name of signer : GMRCSDT=date result was signed
"RTN","GMRCTIUP",35,0)
 ;GMRCSIGT=signers block title : GMRCTUFN=TIU IEN of the result record
"RTN","GMRCTIUP",36,0)
 ;GMRCCSIG=cosigners block name : GMRCCSDT=date cosigner signed
"RTN","GMRCTIUP",37,0)
 ;GMRCCTIT=cosigners block title : GMRCSIGM=Signature mode (E:ELECTRONIC/C:CHART)
"RTN","GMRCTIUP",38,0)
 N GMRCTUFN,TAB,GLOBAL
"RTN","GMRCTIUP",39,0)
 S:'$D(GMRCRT) GMRCRT=0
"RTN","GMRCTIUP",40,0)
 D GETRSLTS(GMRCO,.GMRCAR) ;I $D(GMRCQUT) D:$D(GMRCMSG) EXAC^GMRCADC(GMRCMSG) K GMRCMSG,GMRCRT Q
"RTN","GMRCTIUP",41,0)
 S GLOBAL="^TMP(""GMRCR"",$J,""GMRCTIU"")",TAB="",$P(TAB," ",31)=""
"RTN","GMRCTIUP",42,0)
 K ^TMP("GMRCR",$J,"RES"),^TMP("GMRCR",$J,"MCAR")
"RTN","GMRCTIUP",43,0)
 S (GMRCND,GMRCPTR)="" F  K @GLOBAL S GMRCND=$O(GMRCAR(GMRCND)) Q:GMRCND=""  S GMRCPKG=$P(GMRCND,";",2),GMRCPTR=$P(GMRCND,";",1) D
"RTN","GMRCTIUP",44,0)
 .I $E(GMRCPKG,1,3)="TIU" D
"RTN","GMRCTIUP",45,0)
 ..S DR=".01;.03;.07;1201;1204;1205;1301;1501:1511;1601:1605"
"RTN","GMRCTIUP",46,0)
 ..D EXTRACT^TIULQ(GMRCPTR,GLOBAL,.GMRCERR,DR,"",1,"")
"RTN","GMRCTIUP",47,0)
 ..I '$O(@GLOBAL@(GMRCPTR,"TEXT",0)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="No Results Exist For TIU Record # "_GMRCPTR_"." Q
"RTN","GMRCTIUP",48,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCVIS")=$G(@GLOBAL@(GMRCPTR,.07))
"RTN","GMRCTIUP",49,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCENT")=$G(@GLOBAL@(GMRCPTR,1201))
"RTN","GMRCTIUP",50,0)
 .. S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCVLOC")=$G(@GLOBAL@(GMRCPTR,1205))
"RTN","GMRCTIUP",51,0)
 ..S GMRCSIG=$G(@GLOBAL@(GMRCPTR,1503)),GMRCCSIG=$G(@GLOBAL@(GMRCPTR,1509))
"RTN","GMRCTIUP",52,0)
 ..S:$L(GMRCCSIG)&(GMRCRT) GMRCCSIG=$S($G(@GLOBAL@(GMRCPTR,1511))="electronic":"Signature: /es/",1:"")_GMRCCSIG
"RTN","GMRCTIUP",53,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIG")=$S($L(GMRCSIG):GMRCSIG,1:$G(@GLOBAL@(GMRCPTR,1204)))
"RTN","GMRCTIUP",54,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSDT")=$G(@GLOBAL@(GMRCPTR,1501))
"RTN","GMRCTIUP",55,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGT")=$G(@GLOBAL@(GMRCPTR,1504))
"RTN","GMRCTIUP",56,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCSIGM")=$G(@GLOBAL@(GMRCPTR,1505))
"RTN","GMRCTIUP",57,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCNODT")=$G(@GLOBAL@(GMRCPTR,1301))
"RTN","GMRCTIUP",58,0)
 ..;get xtra signers
"RTN","GMRCTIUP",59,0)
 ..N XTRA,LINE S (XTRA,LINE)=0 F  S XTRA=$O(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA)) Q:'XTRA  D
"RTN","GMRCTIUP",60,0)
 ...S LINE=LINE+1
"RTN","GMRCTIUP",61,0)
 ...I $L((@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"DATE"))) D
"RTN","GMRCTIUP",62,0)
 ....S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,0)=$$FMTE^XLFDT(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"DATE"))_"  /es/ "_^("NAME")
"RTN","GMRCTIUP",63,0)
 ....S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCXTRA",LINE,1)=$$REPEAT^XLFSTR(" ",28)_$G(@GLOBAL@(GMRCPTR,"EXTRASGNR",XTRA,"TITLE"))
"RTN","GMRCTIUP",64,0)
 ..;cosig info
"RTN","GMRCTIUP",65,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSIG")=GMRCCSIG
"RTN","GMRCTIUP",66,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",67,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,1510))
"RTN","GMRCTIUP",68,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,1511))
"RTN","GMRCTIUP",69,0)
 ..S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT","GMRCRPT")=$G(@GLOBAL@(GMRCPTR,.01))
"RTN","GMRCTIUP",70,0)
 ..I $O(@GLOBAL@(GMRCPTR,"TEXT",0)) D
"RTN","GMRCTIUP",71,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"TEXT",ND)) Q:ND=""  S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=@GLOBAL@(GMRCPTR,"TEXT",ND,0),LINECT=LINECT+1
"RTN","GMRCTIUP",72,0)
 ...I GMRCRT S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="",LINECT=LINECT+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Signature: /es/"_GMRCSIG_"         Date: "_$G(@GLOBAL@(GMRCPTR,1501)),LINECT=LINECT+1 K NDS
"RTN","GMRCTIUP",73,0)
 ...I GMRCRT,$D(@GLOBAL@(GMRCPTR,1509)),$L(^(1509)) S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Co-signature: /es/ "_@GLOBAL@(GMRCPTR,1509)_"    Date:  "_$G(@GLOBAL@(GMRCPTR,1507))
"RTN","GMRCTIUP",74,0)
 ... I $L($G(@GLOBAL@(GMRCPTR,1601))) D
"RTN","GMRCTIUP",75,0)
 .... S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=""
"RTN","GMRCTIUP",76,0)
 .... S LINECT=LINECT+1
"RTN","GMRCTIUP",77,0)
 .... S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)="Amendment Filed: "_@GLOBAL@(GMRCPTR,1601),LINECT=LINECT+1
"RTN","GMRCTIUP",78,0)
 .... S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=@GLOBAL@(GMRCPTR,1604),LINECT=LINECT+1
"RTN","GMRCTIUP",79,0)
 .... S ^TMP("GMRCR",$J,"RES",GMRCPTR,"TEXT",LINECT,0)=@GLOBAL@(GMRCPTR,1605),LINECT=LINECT+1
"RTN","GMRCTIUP",80,0)
 ...Q
"RTN","GMRCTIUP",81,0)
 ..I $O(@GLOBAL@(GMRCPTR,"ZADD",0)) S GMRCADD=0 F  S GMRCADD=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD)) Q:GMRCADD=""  D
"RTN","GMRCTIUP",82,0)
 ...S ND1=1
"RTN","GMRCTIUP",83,0)
 ...I '$L(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E"))
"RTN","GMRCTIUP",84,0)
 ...S ND=0 F  S ND=$O(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND)) Q:ND=""  S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,"TEXT",ND,0)
"RTN","GMRCTIUP",85,0)
 ...S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=""
"RTN","GMRCTIUP",86,0)
 ...I +GMRCRT D
"RTN","GMRCTIUP",87,0)
 ....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Signature: "_$S(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E")="electronic":"/es/ ",1:"")_@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1503,"E")
"RTN","GMRCTIUP",88,0)
 ....S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)=^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)_$S(GMRCRT=1:"    Date:  "_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E")),1:"")
"RTN","GMRCTIUP",89,0)
 ....I $L($G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))) D
"RTN","GMRCTIUP",90,0)
 .....S ND1=ND1+1,^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,ND1,0)="Co-signature: /es/ "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1508,"E"))_"    Date:  "_(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"E"))
"RTN","GMRCTIUP",91,0)
 ....Q
"RTN","GMRCTIUP",92,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCSGNM")=$S(GMRCRT=1:"/es/",1:"")_$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1502,"E"))
"RTN","GMRCTIUP",93,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1504,"E"))
"RTN","GMRCTIUP",94,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCNMDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1501,"E"))
"RTN","GMRCTIUP",95,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCMODE")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1505,"E"))
"RTN","GMRCTIUP",96,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSIG")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1509,"E"))
"RTN","GMRCTIUP",97,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSDT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1507,"I"))
"RTN","GMRCTIUP",98,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCTIT")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1510,"E"))
"RTN","GMRCTIUP",99,0)
 ...S ^TMP("GMRCR",$J,"RES",GMRCPTR,"ADD",GMRCADD,"GMRCCSGM")=$G(@GLOBAL@(GMRCPTR,"ZADD",GMRCADD,1511,"E"))
"RTN","GMRCTIUP",100,0)
 ...Q
"RTN","GMRCTIUP",101,0)
 ..I +$G(GMRCRT) D HDR(GMRCPTR,"^TMP(""GMRCR"",$J,""RES"",GMRCPTR,""TEXT"")",.LINECT,0)
"RTN","GMRCTIUP",102,0)
 ..Q
"RTN","GMRCTIUP",103,0)
 .I $E(GMRCPKG,1,4)="MCAR" S GMRCSR=GMRCND,MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,","),MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC  D
"RTN","GMRCTIUP",104,0)
 ..S GMRCPRNM=$P(^MCAR(697.2,MCPROC,0),"^",8),ORIFN=$P(^GMR(123,GMRCO,0),"^",3),ORACTION=8,MCGLOBAL="^TMP(""GMRCR"",$J,""MCAR"","_GMRCPTR_")"
"RTN","GMRCTIUP",105,0)
 ..D EN^GMRCTIU3(GMRCO,ORIFN,MCGLOBAL,LINECT) K ^TMP("MC",$J)
"RTN","GMRCTIUP",106,0)
 ..Q
"RTN","GMRCTIUP",107,0)
 .Q
"RTN","GMRCTIUP",108,0)
 K DR,GLOBAL,GMRCSR,GMRCAR,GMRCPKG,GMRCPRNM,MCFILE,MCPROC,ORACTION,ORIFN,MCGLOBAL,ND,ND1
"RTN","GMRCTIUP",109,0)
 Q
"RTN","GMRCTIUP",110,0)
GETNOTE(GMRCO,FILE) ;Get the last result added to the record - this is found in $P(^(0),"^",20)
"RTN","GMRCTIUP",111,0)
 ;Function returns last note added to record.
"RTN","GMRCTIUP",112,0)
 ;If it does not contain the file pointer, it is assumed that
"RTN","GMRCTIUP",113,0)
 ;it pointed to the TIU file 8925
"RTN","GMRCTIUP",114,0)
 ;GMRCO=file 123 IEN
"RTN","GMRCTIUP",115,0)
 ;FILE='MCAR' to get last medicine result pointer
"RTN","GMRCTIUP",116,0)
 ;FILE='TIU' to get last TIU result pointer
"RTN","GMRCTIUP",117,0)
 N X,RSLT
"RTN","GMRCTIUP",118,0)
 S RSLT=999999,X=""
"RTN","GMRCTIUP",119,0)
 F  S RSLT=$O(^GMR(123,+GMRCO,50,RSLT),-1) Q:'RSLT  D  Q:+X
"RTN","GMRCTIUP",120,0)
 . I $G(^GMR(123,+GMRCO,50,RSLT,0))[FILE S X=^GMR(123,+GMRCO,50,RSLT,0)
"RTN","GMRCTIUP",121,0)
 Q X
"RTN","GMRCTIUP",122,0)
GETRSLTS(GMRCO,ARRAY) ;Get the results from record and return it in array 'ARRAY')
"RTN","GMRCTIUP",123,0)
 ;Looks for results in $P(^(0),"^",20),$P(^(0),"^",15) and Field 50 multiple
"RTN","GMRCTIUP",124,0)
 ;GMRCO=File 123 IEN
"RTN","GMRCTIUP",125,0)
 ;ARRAY=array to return results pointers in
"RTN","GMRCTIUP",126,0)
 ;ARRAY will be returned as ARRAY("IEN;FILE"), as e.g., "1289;^TIU(8925,"
"RTN","GMRCTIUP",127,0)
 N X
"RTN","GMRCTIUP",128,0)
 S X=$$GETNOTE(GMRCO,"TIU") I $L(X) S:$P(X,";",2)="" X=X_";TIU(8925," S ARRAY(X)=""
"RTN","GMRCTIUP",129,0)
 S X=$$GETNOTE(GMRCO,"MCAR") I $L(X) S ARRAY(X)=""
"RTN","GMRCTIUP",130,0)
 S X="" F  S X=$O(^GMR(123,GMRCO,50,"B",X)) Q:X?1A.E!(X="")  S ARRAY(X)=""
"RTN","GMRCUTL1")
0^35^B10653002
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM,JFR - General Utilities ;12/12/00 20:02
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15**;DEC 27, 1997
"RTN","GMRCUTL1",3,0)
 ;
"RTN","GMRCUTL1",4,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCUTL1",5,0)
 ;
"RTN","GMRCUTL1",6,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",7,0)
 K GMRCQUT
"RTN","GMRCUTL1",8,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",9,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",10,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",11,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",12,0)
 Q
"RTN","GMRCUTL1",13,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",14,0)
 N ORVP,GMRCDEV,GMRCQUED,IOP,%ZIS,POP,ZTDTH,ZTDESC,ZTIO,ZTRTN,ZTSK
"RTN","GMRCUTL1",15,0)
 I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL1",16,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",17,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",18,0)
 S %ZIS="N" D ^%ZIS I POP D HOME^%ZIS Q
"RTN","GMRCUTL1",19,0)
 S GMRCDEV=ION,GMRCQUED=1
"RTN","GMRCUTL1",20,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0)"
"RTN","GMRCUTL1",21,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL1",22,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL1",23,0)
 D ^%ZTLOAD
"RTN","GMRCUTL1",24,0)
 D PRNTAUDT
"RTN","GMRCUTL1",25,0)
 D HOME^%ZIS
"RTN","GMRCUTL1",26,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",27,0)
 Q
"RTN","GMRCUTL1",28,0)
PRNTAUDT ;Update the last activity field in 123 and Processing Activity multiple
"RTN","GMRCUTL1",29,0)
 ;Printed To activity updates last activity taken for consult
"RTN","GMRCUTL1",30,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD,GMRCA,DIE,DR,DA
"RTN","GMRCUTL1",31,0)
 S GMRCA=22
"RTN","GMRCUTL1",32,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCUTL1",33,0)
 L +^GMR(123,GMRCO):5
"RTN","GMRCUTL1",34,0)
 D ^DIE
"RTN","GMRCUTL1",35,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCUTL1",36,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCUTL1",37,0)
 D AUDIT^GMRCP
"RTN","GMRCUTL1",38,0)
 Q
"RTN","GMRCUTL1",39,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",40,0)
 Q
"RTN","GMRCUTL1",41,0)
PROVDX(OI) ;return PROV DX prompting info from 123.5
"RTN","GMRCUTL1",42,0)
 ;    Input:
"RTN","GMRCUTL1",43,0)
 ;       OI = ref to file 123.5("#;99CON") or file 123.3 (#;99PRC)
"RTN","GMRCUTL1",44,0)
 ;
"RTN","GMRCUTL1",45,0)
 ;    Returns:  string  A^B
"RTN","GMRCUTL1",46,0)
 ;       A = O (optional), R (required) or S (suppress)
"RTN","GMRCUTL1",47,0)
 ;       B = F (free-text) or L (lexicon)
"RTN","GMRCUTL1",48,0)
 ;
"RTN","GMRCUTL1",49,0)
 N GMRCFIL
"RTN","GMRCUTL1",50,0)
 Q:'+$G(OI) "^"
"RTN","GMRCUTL1",51,0)
 S GMRCFIL=$S(OI["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",52,0)
 Q:'$D(^GMR(GMRCFIL,+OI)) "^"
"RTN","GMRCUTL1",53,0)
 N STRING,NODE
"RTN","GMRCUTL1",54,0)
 I GMRCFIL=123.3 S NODE=$P(^GMR(123.3,+OI,0),U,7,8)
"RTN","GMRCUTL1",55,0)
 I GMRCFIL=123.5 S NODE=$P($G(^GMR(123.5,+OI,1)),U,1,2)
"RTN","GMRCUTL1",56,0)
 I NODE="" Q "O^F" ;values not set
"RTN","GMRCUTL1",57,0)
 S $P(STRING,U)=$S($L($P(NODE,U)):$P(NODE,U),1:"O")
"RTN","GMRCUTL1",58,0)
 S $P(STRING,U,2)=$S($L($P(NODE,U,2)):$P(NODE,U,2),1:"F")
"RTN","GMRCUTL1",59,0)
 Q STRING
"RTN","GMRCUTL1",60,0)
ORIFN(GMRC123) ;return ORIFN associated with give record in ^GMR(123,
"RTN","GMRCUTL1",61,0)
 ; GMRC123 = ien of consult record in file 123
"RTN","GMRCUTL1",62,0)
 Q $P($G(^GMR(123,GMRC123,0)),U,3)
"RTN","GMRCUTL1",63,0)
GETDT(PROMPT,DEFAULT) ;prompt and return FM date
"RTN","GMRCUTL1",64,0)
 ;Input:
"RTN","GMRCUTL1",65,0)
 ;  PROMPT  = text of prompt - DIR("A")          (optional)
"RTN","GMRCUTL1",66,0)
 ;  DEFAULT = default date to prompt - DIR("B")  (optional)
"RTN","GMRCUTL1",67,0)
 ; 
"RTN","GMRCUTL1",68,0)
 ;Output:
"RTN","GMRCUTL1",69,0)
 ; FM date/time if successfully answered, "^" if exit or timeout
"RTN","GMRCUTL1",70,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,X,Y
"RTN","GMRCUTL1",71,0)
 S DIR(0)="DA^::EPT"
"RTN","GMRCUTL1",72,0)
 S DIR("?")="Enter the date/time the activity took place."
"RTN","GMRCUTL1",73,0)
 S DIR("A")=$S($D(PROMPT):PROMPT_" ",1:"Actual Date/Time of Activity: ")
"RTN","GMRCUTL1",74,0)
 S DIR("B")=$S($D(DEFAULT):DEFAULT,1:"NOW")
"RTN","GMRCUTL1",75,0)
 D ^DIR
"RTN","GMRCUTL1",76,0)
 I $D(DUOUT)!($D(DTOUT)) S Y="^"
"RTN","GMRCUTL1",77,0)
 Q Y
"RTN","GMRCUTL1",78,0)
 ;
"RTN","GMRCUTL1",79,0)
DCPRNT(IEN,USER) ;reprint SF-513 on DC?
"RTN","GMRCUTL1",80,0)
 N SERV,REPR
"RTN","GMRCUTL1",81,0)
 S SERV=$P(^GMR(123,IEN,0),U,5) I 'SERV Q 0
"RTN","GMRCUTL1",82,0)
 S REPR=$P($G(^GMR(123.5,SERV,1)),U,5)
"RTN","GMRCUTL1",83,0)
 I 'REPR Q 1
"RTN","GMRCUTL1",84,0)
 I REPR=2 Q 0
"RTN","GMRCUTL1",85,0)
 I REPR=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCUTL1",86,0)
 Q 0
"RTN","GMRCUTL1",87,0)
 ;
"RTN","GMRCUTL1",88,0)
PREREQ(GMRCARR,GMRCSRV,GMRCDFN,UNRESOLV) ; return service pre-requisite
"RTN","GMRCUTL1",89,0)
 ; pre-requisite stored in 125 nodes in file 123.5 or 123.3
"RTN","GMRCUTL1",90,0)
 ; GMRCARR = array to return containing pre-requisite
"RTN","GMRCUTL1",91,0)
 ; GMRCSRV = ref to file 123.5 (ien;99CON) or 123.3 (ien;99PRC)
"RTN","GMRCUTL1",92,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCUTL1",93,0)
 ; UNRESOLV = 1 or 0 ; if UNRESOLV=1 GMRCARR will be returned unresolved
"RTN","GMRCUTL1",94,0)
 Q:'+GMRCSRV
"RTN","GMRCUTL1",95,0)
 N GMRCFIL
"RTN","GMRCUTL1",96,0)
 S GMRCFIL=$S(GMRCSRV["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",97,0)
 Q:'$D(^GMR(GMRCFIL,+GMRCSRV,125))
"RTN","GMRCUTL1",98,0)
 I '$D(GMRCDFN)!($G(UNRESOLV)) D  Q
"RTN","GMRCUTL1",99,0)
 . M @GMRCARR=^GMR(GMRCFIL,+GMRCSRV,125)
"RTN","GMRCUTL1",100,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(GMRCFIL,+GMRCSRV,125)))
"RTN","GMRCUTL1",101,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",102,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",103,0)
 Q
"RTN","GMRCYP15")
0^31^B37132960
"RTN","GMRCYP15",1,0)
GMRCYP15 ;SLC/JFR-- CONVERT PROCEDURES FROM 101 TO 123.3; 3/08/01 22:00
"RTN","GMRCYP15",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15**;DEC 27, 1997
"RTN","GMRCYP15",3,0)
 ;
"RTN","GMRCYP15",4,0)
 ; This routine invokes IA #3169,#3170
"RTN","GMRCYP15",5,0)
 ;
"RTN","GMRCYP15",6,0)
EN ;called from post-install of GMRC*3*15
"RTN","GMRCYP15",7,0)
 N GMRCPROG,XPDIDTOT
"RTN","GMRCYP15",8,0)
 S GMRCPROG=$$GET^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC PROCEDURE CONVERSION",1)
"RTN","GMRCYP15",9,0)
 I GMRCPROG=3 D BMES^XPDUTL("Procedure conversion complete") Q
"RTN","GMRCYP15",10,0)
 I GMRCPROG<2 D
"RTN","GMRCYP15",11,0)
 . D CVTOIS
"RTN","GMRCYP15",12,0)
 . D EN^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC PROCEDURE CONVERSION",1,2)
"RTN","GMRCYP15",13,0)
 D CVT123
"RTN","GMRCYP15",14,0)
 D EN^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC PROCEDURE CONVERSION",1,3)
"RTN","GMRCYP15",15,0)
 D MAIL
"RTN","GMRCYP15",16,0)
 Q
"RTN","GMRCYP15",17,0)
 ;
"RTN","GMRCYP15",18,0)
CVTOIS ;loop through ORD ITEMS  in S.PROC x-ref
"RTN","GMRCYP15",19,0)
 N ITMNM,ORDITM,PROC,PROTID,GMRCID
"RTN","GMRCYP15",20,0)
 D EN^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC PROCEDURE CONVERSION",1,1)
"RTN","GMRCYP15",21,0)
 D BMES^XPDUTL("Converting Orderable Items")
"RTN","GMRCYP15",22,0)
 S ITMNM="",^XTMP("GMRCCVPR",0)=$$FMADD^XLFDT($$NOW^XLFDT,14)
"RTN","GMRCYP15",23,0)
 S $P(^XTMP("GMRCCVPR",0),U,2)=$$NOW^XLFDT
"RTN","GMRCYP15",24,0)
 S $P(^XTMP("GMRCCVPR",0),U,3)="Conversion of GMRC Procedure ord. items"
"RTN","GMRCYP15",25,0)
 F  S ITMNM=$O(^ORD(101.43,"S.PROC",ITMNM)) Q:ITMNM=""  D
"RTN","GMRCYP15",26,0)
 . S ORDITM=0
"RTN","GMRCYP15",27,0)
 . F  S ORDITM=$O(^ORD(101.43,"S.PROC",ITMNM,ORDITM)) Q:'ORDITM  D
"RTN","GMRCYP15",28,0)
 .. I '$$OKTOGO(ITMNM,ORDITM) Q
"RTN","GMRCYP15",29,0)
 .. S PROC=$$CNVT(ORDITM) I '+PROC Q
"RTN","GMRCYP15",30,0)
 .. S PROTID=$P(^ORD(101.43,ORDITM,0),U,2)
"RTN","GMRCYP15",31,0)
 .. S GMRCID=$$ID^ORDD43(PROTID,PROC_";99PRC")
"RTN","GMRCYP15",32,0)
 .. S ^XTMP("GMRCCVPR",ORDITM)=PROC_U_$S($G(GMRCID):$G(PROTID),1:"ERROR")
"RTN","GMRCYP15",33,0)
 .. Q
"RTN","GMRCYP15",34,0)
 . Q
"RTN","GMRCYP15",35,0)
 Q
"RTN","GMRCYP15",36,0)
OKTOGO(NAME,NUM) ;OK to move from 101.43 to 123.3?
"RTN","GMRCYP15",37,0)
 I $D(^XTMP("GMRCCVPR",NUM)) Q 0 ;already converted
"RTN","GMRCYP15",38,0)
 I +$G(^ORD(101.43,"S.PROC",NAME,NUM)),$P(^ORD(101.43,NUM,0),U)'=NAME Q 0 ;synonym only
"RTN","GMRCYP15",39,0)
 I '+$P(^ORD(101.43,NUM,0),U,2) Q 0 ;no protocol
"RTN","GMRCYP15",40,0)
 I $P(^ORD(101.43,NUM,0),U,2)[";99PRC" Q 0 ;new ID already
"RTN","GMRCYP15",41,0)
 Q 1
"RTN","GMRCYP15",42,0)
CNVT(IEN) ;move it from 101.43 to 123.3
"RTN","GMRCYP15",43,0)
 N DIC,DIE,DR,DA,X,Y,DTOUT,DUOUT,DLAYGO,ORD0,GMRCPROC,NEW
"RTN","GMRCYP15",44,0)
 S DIC="^GMR(123.3,",DIC(0)="XL",DLAYGO=123.3
"RTN","GMRCYP15",45,0)
 S ORD0=^ORD(101.43,IEN,0)
"RTN","GMRCYP15",46,0)
 S X=$$UP^XLFSTR($P(ORD0,U))
"RTN","GMRCYP15",47,0)
 D ^DIC I Y'>0 Q 0
"RTN","GMRCYP15",48,0)
 S DIE=DIC,DA=+Y,GMRCPROC=+Y,NEW=$P(Y,U,3)
"RTN","GMRCYP15",49,0)
 I +NEW S DR=".06_////"_+$P(ORD0,U,2)
"RTN","GMRCYP15",50,0)
 I +$G(^ORD(101.43,IEN,.1)) S DR=$S($D(DR):DR_";",1:"")_".02///1"
"RTN","GMRCYP15",51,0)
 I $D(DR) D ^DIE
"RTN","GMRCYP15",52,0)
 D SYN(IEN,GMRCPROC)
"RTN","GMRCYP15",53,0)
 D SERVS(GMRCPROC,+$P(ORD0,U,2))
"RTN","GMRCYP15",54,0)
 Q +GMRCPROC
"RTN","GMRCYP15",55,0)
SYN(OITM,PROC) ;get any synonyms from 101.43 and update 123.3
"RTN","GMRCYP15",56,0)
 N DR,DIC,X,Y,DTOUT,SYN,DA
"RTN","GMRCYP15",57,0)
 S SYN=0
"RTN","GMRCYP15",58,0)
 F  S SYN=$O(^ORD(101.43,OITM,2,SYN)) Q:'SYN  I $L($G(^(SYN,0))) D
"RTN","GMRCYP15",59,0)
 . S DA(1)=PROC,DIC="^GMR(123.3,"_DA(1)_",1,"
"RTN","GMRCYP15",60,0)
 . S DIC(0)="XL",DIC("P")=$P(^DD(123.3,1,0),U,2)
"RTN","GMRCYP15",61,0)
 . S X=$P(^ORD(101.43,OITM,2,SYN,0),U)
"RTN","GMRCYP15",62,0)
 . D ^DIC
"RTN","GMRCYP15",63,0)
 Q
"RTN","GMRCYP15",64,0)
SERVS(PROC,PROT) ;get related servisces from 123.5 and move to 123.3
"RTN","GMRCYP15",65,0)
 N DR,DIC,X,Y,DTOUT,SERV,DA
"RTN","GMRCYP15",66,0)
 S SERV=0
"RTN","GMRCYP15",67,0)
 F  S SERV=$O(^GMR(123.5,"APR",PROT,SERV)) Q:'SERV  D
"RTN","GMRCYP15",68,0)
 . S DA(1)=PROC,DIC="^GMR(123.3,"_DA(1)_",2,",X=$P(^GMR(123.5,SERV,0),U)
"RTN","GMRCYP15",69,0)
 . S DIC(0)="XL",DIC("P")=$P(^DD(123.3,2,0),U,2)
"RTN","GMRCYP15",70,0)
 . D ^DIC
"RTN","GMRCYP15",71,0)
 Q
"RTN","GMRCYP15",72,0)
CVTPRO(PROT) ;move protocol entry to 123.3
"RTN","GMRCYP15",73,0)
 N DIC,DIE,DR,DA,X,Y,DLAYGO,NAME,PROC
"RTN","GMRCYP15",74,0)
 I '$D(^ORD(101,PROT,0)) Q 1 ;no protocol there
"RTN","GMRCYP15",75,0)
 S NAME=$P(^ORD(101,PROT,0),U,2) I '$L(NAME) Q 1 ;no name
"RTN","GMRCYP15",76,0)
 I $G(^ORD(101,PROT,20))'["GMRCEN=""R""" Q "" ;consult type
"RTN","GMRCYP15",77,0)
 S DIC="^GMR(123.3,",DIC(0)="LX",X=$$UP^XLFSTR(NAME)
"RTN","GMRCYP15",78,0)
 D ^DIC I +Y<0 Q 1
"RTN","GMRCYP15",79,0)
 I '$P(Y,U,3) Q +Y
"RTN","GMRCYP15",80,0)
 S (PROC,DA)=+Y
"RTN","GMRCYP15",81,0)
 S DIE=DIC,DR=".02///1;.06///^S X=PROT" D ^DIE
"RTN","GMRCYP15",82,0)
 Q +PROC
"RTN","GMRCYP15",83,0)
 ;
"RTN","GMRCYP15",84,0)
 ;
"RTN","GMRCYP15",85,0)
CVT123 ; loop through file 123 and convert field #4 and #13
"RTN","GMRCYP15",86,0)
 N IEN,PROC,GMRCCSLT,GMRCPRC,GMR0
"RTN","GMRCYP15",87,0)
 D EN^XPAR("PKG.CONSULT/REQUEST TRACKING","GMRC PROCEDURE CONVERSION",1,2)
"RTN","GMRCYP15",88,0)
 D BMES^XPDUTL("Converting REQUEST/CONSULTATION data")
"RTN","GMRCYP15",89,0)
 S XPDIDTOT=$P(^GMR(123,0),U,4) I XPDIDTOT<100 K XPDIDTOT
"RTN","GMRCYP15",90,0)
 S GMRCCSLT=$$FIND1^DIC(101,,"QX","GMRCOR CONSULT")
"RTN","GMRCYP15",91,0)
 S GMRCPRC=$$FIND1^DIC(101,,"QX","GMRCOR REQUEST")
"RTN","GMRCYP15",92,0)
 S IEN=0 F  S IEN=$O(^GMR(123,IEN)) Q:'IEN  D
"RTN","GMRCYP15",93,0)
 . I $D(XPDIDTOT) I '(IEN#(XPDIDTOT\20)) D UPDATE^XPDID(IEN)
"RTN","GMRCYP15",94,0)
 . Q:'$D(^GMR(123,IEN,0))
"RTN","GMRCYP15",95,0)
 . S GMR0=^GMR(123,IEN,0)
"RTN","GMRCYP15",96,0)
 . I $P(GMR0,U,17)'="C"&($P(GMR0,U,17)'="P") D  ;not converted yet
"RTN","GMRCYP15",97,0)
 .. I $P(GMR0,U,8)["ORD(101" D
"RTN","GMRCYP15",98,0)
 ... N NWPROC
"RTN","GMRCYP15",99,0)
 ... S NWPROC=$$CVT4(+$P(^GMR(123,IEN,0),U,8))
"RTN","GMRCYP15",100,0)
 ... I +NWPROC=1 S ^XTMP("GMRCCVPR","UNK",IEN)=$P(GMR0,U,8)
"RTN","GMRCYP15",101,0)
 ... S $P(^GMR(123,IEN,0),U,8)=NWPROC
"RTN","GMRCYP15",102,0)
 .. S $P(^GMR(123,IEN,0),U,17)=$S(+$P(^GMR(123,IEN,0),U,8):"P",1:"C")
"RTN","GMRCYP15",103,0)
 .. Q
"RTN","GMRCYP15",104,0)
 . Q
"RTN","GMRCYP15",105,0)
 Q
"RTN","GMRCYP15",106,0)
CVT4(PCL) ;convert field 4 from 101 to 123.3
"RTN","GMRCYP15",107,0)
 ; PCL = pointer to file 101
"RTN","GMRCYP15",108,0)
 N PROC
"RTN","GMRCYP15",109,0)
 S PROC=$O(^GMR(123.3,"AP",PCL,0))
"RTN","GMRCYP15",110,0)
 I 'PROC S PROC=$$CVTPRO(PCL)
"RTN","GMRCYP15",111,0)
 Q $S(+PROC:PROC_";GMR(123.3,",1:"")
"RTN","GMRCYP15",112,0)
 ;
"RTN","GMRCYP15",113,0)
 ;
"RTN","GMRCYP15",114,0)
MAIL ; check conversion and send mail to installer
"RTN","GMRCYP15",115,0)
 D CK10143
"RTN","GMRCYP15",116,0)
 D CHK123
"RTN","GMRCYP15",117,0)
 I '$D(^TMP("GMRCP15",$J)) D
"RTN","GMRCYP15",118,0)
 . S ^TMP("GMRCP15",$J,1,0)="No problems found with the conversion."
"RTN","GMRCYP15",119,0)
 S ^TMP("GMRCP15",$J,0)=""
"RTN","GMRCYP15",120,0)
 N GMRCSB,GMRCTO,GMRCTXT,GMRCMSG
"RTN","GMRCYP15",121,0)
 S GMRCSB="GMRC*3*15 Post-install conversion report"
"RTN","GMRCYP15",122,0)
 S GMRCTXT=$NA(^TMP("GMRCP15",$J))
"RTN","GMRCYP15",123,0)
 S GMRCTO(DUZ)=""
"RTN","GMRCYP15",124,0)
 D SENDMSG^XMXAPI(DUZ,GMRCSB,GMRCTXT,.GMRCTO,,.GMRCMSG)
"RTN","GMRCYP15",125,0)
 I $G(GMRCMSG) D 
"RTN","GMRCYP15",126,0)
 . D BMES^XPDUTL("Mail message "_GMRCMSG_" sent to installer")
"RTN","GMRCYP15",127,0)
 . N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,ZTIO,GMRCDUZ
"RTN","GMRCYP15",128,0)
 . S GMRCDUZ=DUZ
"RTN","GMRCYP15",129,0)
 . S ZTSAVE("GMRCMSG")="",ZTSAVE("GMRCDUZ")=""
"RTN","GMRCYP15",130,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,5),ZTRTN="NWMAL^GMRCYP15"
"RTN","GMRCYP15",131,0)
 . S ZTIO="",ZTDESC="New GMRC*3*15 post-install message"
"RTN","GMRCYP15",132,0)
 . D ^%ZTLOAD
"RTN","GMRCYP15",133,0)
 K ^TMP("GMRCP15",$J)
"RTN","GMRCYP15",134,0)
 Q
"RTN","GMRCYP15",135,0)
 ;
"RTN","GMRCYP15",136,0)
NWMAL ;make post-install message new
"RTN","GMRCYP15",137,0)
 S ZTREQ="@"
"RTN","GMRCYP15",138,0)
 I $G(GMRCMSG),$G(GMRCDUZ) D
"RTN","GMRCYP15",139,0)
 . D MAKENEW^XMXUTIL(DUZ,1,GMRCMSG,1)
"RTN","GMRCYP15",140,0)
 Q
"RTN","GMRCYP15",141,0)
 ;
"RTN","GMRCYP15",142,0)
CHK123 ;loop 123 and check field 4 to make sure it's converted
"RTN","GMRCYP15",143,0)
 N GMRCIEN,PROC,NEXT
"RTN","GMRCYP15",144,0)
 S GMRCIEN=0
"RTN","GMRCYP15",145,0)
 I $D(^TMP("GMRCP15",$J)) D
"RTN","GMRCYP15",146,0)
 . S ^TMP("GMRCP15",$J,$O(^TMP("GMRCP15",$J," "),-1)+1,0)=""
"RTN","GMRCYP15",147,0)
 F  S GMRCIEN=$O(^GMR(123,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCYP15",148,0)
 . I $D(XPDIDTOT) D:'(GMRCIEN#(XPDIDTOT\20)) UPDATE^XPDID(GMRCIEN)
"RTN","GMRCYP15",149,0)
 . I '$D(XPDNM) W:'(GMRCIEN#78000) !,"Working",!
"RTN","GMRCYP15",150,0)
 . I '$D(XPDNM) W:'(GMRCIEN#1000) "."
"RTN","GMRCYP15",151,0)
 . S PROC=$P($G(^GMR(123,GMRCIEN,0)),U,8) I '$L(PROC) Q
"RTN","GMRCYP15",152,0)
 . I PROC["ORD(101"!(PROC="1;GMR(123.3,") D
"RTN","GMRCYP15",153,0)
 .. S NEXT=$O(^TMP("GMRCP15",$J," "),-1)+1
"RTN","GMRCYP15",154,0)
 .. S ^TMP("GMRCP15",$J,NEXT,0)="File 123 ien "_GMRCIEN_" points to "_PROC
"RTN","GMRCYP15",155,0)
 . Q
"RTN","GMRCYP15",156,0)
 Q
"RTN","GMRCYP15",157,0)
CK10143 ;loop thru S.PROC x-ref in 101.43 and check for complete conv
"RTN","GMRCYP15",158,0)
 N OINAME,OINUM,NEXT
"RTN","GMRCYP15",159,0)
 D BMES^XPDUTL("Checking converted data")
"RTN","GMRCYP15",160,0)
 S OINAME=""
"RTN","GMRCYP15",161,0)
 F  S OINAME=$O(^ORD(101.43,"S.PROC",OINAME)) Q:OINAME=""  D
"RTN","GMRCYP15",162,0)
 . S OINUM=$O(^ORD(101.43,"S.PROC",OINAME,0)) Q:'OINUM
"RTN","GMRCYP15",163,0)
 . I +$G(^ORD(101.43,"S.PROC",OINAME,OINUM)) Q  ;syn only
"RTN","GMRCYP15",164,0)
 . I $P($G(^ORD(101.43,OINUM,0)),U,2)'["99PRC" D
"RTN","GMRCYP15",165,0)
 .. S NEXT=$O(^TMP("GMRCP15",$J," "),-1)+1
"RTN","GMRCYP15",166,0)
 .. S ^TMP("GMRCP15",$J,NEXT,0)="File 101.43 ien "_OINUM_" has a bad ID"
"RTN","GMRCYP15",167,0)
 . Q
"RTN","GMRCYP15",168,0)
 Q
"SEC","^DIC",123.3,123.3,0,"AUDIT")
@
"SEC","^DIC",123.3,123.3,0,"DD")
@
"SEC","^DIC",123.3,123.3,0,"DEL")
@
"SEC","^DIC",123.3,123.3,0,"LAYGO")

"SEC","^DIC",123.3,123.3,0,"RD")

"SEC","^DIC",123.3,123.3,0,"WR")

"UP",123,123.03,-1)
123^50
"UP",123,123.03,0)
123.03
"UP",123.5,123.5101,-1)
123.5^101
"UP",123.5,123.5101,0)
123.5101
"VER")
8.0^22.0
"^DD",123,123,4,0)
PROCEDURE/REQUEST TYPE^V^^0;8^Q
"^DD",123,123,4,1,0)
^.1^^0
"^DD",123,123,4,3)
Enter the type of procedure being requested (e.g., EKG, UGI, etc.).
"^DD",123,123,4,21,0)
^^1^1^3010110^
"^DD",123,123,4,21,1,0)
This is the procedure that was requested via CPRS while ordering.
"^DD",123,123,4,"DT")
2911216
"^DD",123,123,4,"V",0)
^.12P^2^2
"^DD",123,123,4,"V",1,0)
101^Enter Order Item^1^O^n^n
"^DD",123,123,4,"V",2,0)
123.3^Consult Procedure^2^PROC^n^n
"^DD",123,123,13,0)
REQUEST TYPE^RS^C:Consult;P:Procedure;^0;17^Q
"^DD",123,123,13,3)

"^DD",123,123,13,21,0)
^^3^3^3010110^
"^DD",123,123,13,21,1,0)
This field will indicate whether the order is a consult or procedure
"^DD",123,123,13,21,2,0)
request order.  Based on this fields value, the Consultation Body Header
"^DD",123,123,13,21,3,0)
alters to indicate "Consult Type: " or "Procedure Request: ".
"^DD",123,123,13,"DT")
2991214
"^DD",123,123,50,0)
ASSOCIATED RESULTS^123.03AV^^50;0
"^DD",123,123.03,0)
ASSOCIATED RESULTS SUB-FIELD^^.01^1
"^DD",123,123.03,0,"DT")
2980320
"^DD",123,123.03,0,"IX","B",123.03,.01)

"^DD",123,123.03,0,"NM","ASSOCIATED RESULTS")

"^DD",123,123.03,0,"UP")
123
"^DD",123,123.03,.01,0)
ASSOCIATED RESULTS^MV^^0;1^Q
"^DD",123,123.03,.01,1,0)
^.1
"^DD",123,123.03,.01,1,1,0)
123.03^B
"^DD",123,123.03,.01,1,1,1)
S ^GMR(123,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",123,123.03,.01,1,1,2)
K ^GMR(123,DA(1),50,"B",$E(X,1,30),DA)
"^DD",123,123.03,.01,1,1,3)
Required Index for Variable Pointer
"^DD",123,123.03,.01,1,2,0)
123^R
"^DD",123,123.03,.01,1,2,1)
S ^GMR(123,"R",$E(X,1,30),DA(1),DA)=""
"^DD",123,123.03,.01,1,2,2)
K ^GMR(123,"R",$E(X,1,30),DA(1),DA)
"^DD",123,123.03,.01,1,2,"DT")
2980622
"^DD",123,123.03,.01,3)
Enter the associated result.
"^DD",123,123.03,.01,21,0)
^^3^3^3000823^
"^DD",123,123.03,.01,21,1,0)
This multiple allows one or more results to be associated with a consult.
"^DD",123,123.03,.01,21,2,0)
 
"^DD",123,123.03,.01,21,3,0)
This field invokes IA #147
"^DD",123,123.03,.01,"DT")
2980622
"^DD",123,123.03,.01,"V",0)
^.12P^16^16
"^DD",123,123.03,.01,"V",1,0)
8925^Note^1^TIU^n^n
"^DD",123,123.03,.01,"V",2,0)
691^Select ECHO report^2^ECHO^n^n
"^DD",123,123.03,.01,"V",3,0)
691.1^Select CATH report^3^CATH^n^n
"^DD",123,123.03,.01,"V",4,0)
691.5^Select EKG report^4^EKG^n^n
"^DD",123,123.03,.01,"V",5,0)
691.6^Select HOLTER report^5^HOLTER^n^n
"^DD",123,123.03,.01,"V",6,0)
691.7^Select ETT report^6^ETT^n^n
"^DD",123,123.03,.01,"V",7,0)
691.8^Select EP report^7^EP^n^n
"^DD",123,123.03,.01,"V",8,0)
694^Select HEM report^8^HEM^n^n
"^DD",123,123.03,.01,"V",9,0)
698^Select GEN IMP report^9^GEN IMP^n^n
"^DD",123,123.03,.01,"V",10,0)
698.1^Select V LEAD IMPLANT report^10^V LEAD^n^n
"^DD",123,123.03,.01,"V",11,0)
698.2^Select A LEAD IMPLANT report^11^A LEAD^n^n
"^DD",123,123.03,.01,"V",12,0)
698.3^Select PACEMAKER report^12^PACE^n^n
"^DD",123,123.03,.01,"V",13,0)
699^Select ENDO report^13^ENDO^n^n
"^DD",123,123.03,.01,"V",14,0)
699.5^Select GEN PROCEDURE report^14^GEN PROC^n^n
"^DD",123,123.03,.01,"V",15,0)
700^Select PFT report^15^PFT^n^n
"^DD",123,123.03,.01,"V",16,0)
701^Select RHEUMATOLOGY report^16^RHEUM^n^n
"^DD",123.3,123.3,0)
FIELD^^.05^11
"^DD",123.3,123.3,0,"DDA")
N
"^DD",123.3,123.3,0,"DT")
3010201
"^DD",123.3,123.3,0,"IX","AP",123.3,.06)

"^DD",123.3,123.3,0,"IX","B",123.3,.01)

"^DD",123.3,123.3,0,"IX","C",123.31,.01)

"^DD",123.3,123.3,0,"NM","GMRC PROCEDURE")

"^DD",123.3,123.3,0,"PT",123,4)

"^DD",123.3,123.3,0,"VRPK")
GMRC
"^DD",123.3,123.3,.01,0)
NAME^RF^^0;1^K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",123.3,123.3,.01,1,0)
^.1^^-1
"^DD",123.3,123.3,.01,1,1,0)
123.3^B
"^DD",123.3,123.3,.01,1,1,1)
S ^GMR(123.3,"B",$E(X,1,30),DA)=""
"^DD",123.3,123.3,.01,1,1,2)
K ^GMR(123.3,"B",$E(X,1,30),DA)
"^DD",123.3,123.3,.01,3)
Answer must be 3-63 characters in length.
"^DD",123.3,123.3,.01,21,0)
^.001^1^1^3000621^^
"^DD",123.3,123.3,.01,21,1,0)
This is the name of the procedure that will be requested within CPRS.
"^DD",123.3,123.3,.01,"DT")
3000623
"^DD",123.3,123.3,.02,0)
INACTIVE^S^1:YES;0:NO;^0;2^Q
"^DD",123.3,123.3,.02,3)
Enter YES if this procedure is no longer used.
"^DD",123.3,123.3,.02,21,0)
^^4^4^2991208^^
"^DD",123.3,123.3,.02,21,1,0)
The INACTIVE field, if set to YES causes a procedure to no longer be
"^DD",123.3,123.3,.02,21,2,0)
selectable when ordering within CPRS.  Existing requests for this
"^DD",123.3,123.3,.02,21,3,0)
procedure may be processed to completion even if the procedure is
"^DD",123.3,123.3,.02,21,4,0)
inactive.
"^DD",123.3,123.3,.02,"DT")
2991208
"^DD",123.3,123.3,.05,0)
TYPE OF PROCEDURE^*P697.2'^MCAR(697.2,^0;5^S DIC("S")="I $$PATCH^XPDUTL(""MC*2.3*27"")" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",123.3,123.3,.05,3)
Select the appropriate type of procedure
"^DD",123.3,123.3,.05,12)
MC*2.3*27 is required to utilize the Medicine interface
"^DD",123.3,123.3,.05,12.1)
S DIC("S")="I $$PATCH^XPDUTL(""MC*2.3*27"")"
"^DD",123.3,123.3,.05,21,0)
^.001^11^11^3010201^^
"^DD",123.3,123.3,.05,21,1,0)
This field indicates which type of medicine procedure and thus which
"^DD",123.3,123.3,.05,21,2,0)
result file in the Medicine Package will hold results for this procedure.
"^DD",123.3,123.3,.05,21,3,0)
 
"^DD",123.3,123.3,.05,21,4,0)
Coordination may be necessary with the Medicine Adpac to determine the
"^DD",123.3,123.3,.05,21,5,0)
correct procedure mapping.
"^DD",123.3,123.3,.05,21,6,0)
 
"^DD",123.3,123.3,.05,21,7,0)
If this field is not entered, the procedure may still be resulted using a
"^DD",123.3,123.3,.05,21,8,0)
TIU document, but Medicine results may not be linked to requests for this
"^DD",123.3,123.3,.05,21,9,0)
procedure.
"^DD",123.3,123.3,.05,21,10,0)
 
"^DD",123.3,123.3,.05,21,11,0)
This field invokes IA# 616.
"^DD",123.3,123.3,.05,"DT")
3010201
"^DD",123.3,123.3,.06,0)
PROTOCOL^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",123.3,123.3,.06,1,0)
^.1
"^DD",123.3,123.3,.06,1,1,0)
123.3^AP
"^DD",123.3,123.3,.06,1,1,1)
S ^GMR(123.3,"AP",$E(X,1,30),DA)=""
"^DD",123.3,123.3,.06,1,1,2)
K ^GMR(123.3,"AP",$E(X,1,30),DA)
"^DD",123.3,123.3,.06,1,1,"DT")
2991210
"^DD",123.3,123.3,.06,3)
Answer must be 1-10 characters in length.
"^DD",123.3,123.3,.06,21,0)
^.001^3^3^3010110^^^
"^DD",123.3,123.3,.06,21,1,0)
 This field serves as a placeholder for a conversion value. The field
"^DD",123.3,123.3,.06,21,2,0)
 contains the pointer value of the PROTOCOL that represented this
"^DD",123.3,123.3,.06,21,3,0)
 procedure before conversion.
"^DD",123.3,123.3,.06,"DT")
3000601
"^DD",123.3,123.3,.07,0)
PROVISIONAL DX PROMPT^S^O:OPTIONAL;R:REQUIRED;S:SUPPRESS;^0;7^Q
"^DD",123.3,123.3,.07,3)
Enter a code to indicate the type of input allowed by CPRS when entering a provisional diagnosis
"^DD",123.3,123.3,.07,21,0)
^^7^7^3010110^
"^DD",123.3,123.3,.07,21,1,0)
This field will be used by CPRS to determine how to prompt for the
"^DD",123.3,123.3,.07,21,2,0)
provisional diagnosis when ordering this procedure. If this field is 
"^DD",123.3,123.3,.07,21,3,0)
set to OPTIONAL, the user will be prompted for the provisional 
"^DD",123.3,123.3,.07,21,4,0)
diagnosis but may bypass answering the prompt. If the field is set to
"^DD",123.3,123.3,.07,21,5,0)
SUPPRESS, the user will not be presented with the provisional diagnosis
"^DD",123.3,123.3,.07,21,6,0)
prompt. If set to REQUIRED, the user must answer the prompt to continue
"^DD",123.3,123.3,.07,21,7,0)
placing the order.
"^DD",123.3,123.3,.07,"DT")
3001201
"^DD",123.3,123.3,.08,0)
PROVISIONAL DX INPUT^S^F:FREE TEXT;L:LEXICON;^0;8^Q
"^DD",123.3,123.3,.08,3)
Enter a code to indicate the type of input allowed by CPRS when entering a provisional diagnosis
"^DD",123.3,123.3,.08,21,0)
^^5^5^3010110^
"^DD",123.3,123.3,.08,21,1,0)
This field will determine the method that CPRS will use to prompt the 
"^DD",123.3,123.3,.08,21,2,0)
user for input of the provisional diagnosis when ordering. If set to 
"^DD",123.3,123.3,.08,21,3,0)
FREE TEXT, the user may type any text from 2-80 characters in length. 
"^DD",123.3,123.3,.08,21,4,0)
If set to LEXICON, the user will be required to select a coded 
"^DD",123.3,123.3,.08,21,5,0)
diagnosis from the Clinical Lexicon.
"^DD",123.3,123.3,.08,"DT")
3001201
"^DD",123.3,123.3,.09,0)
RESTRICT DEFAULT REASON EDIT^S^0:UNRESTRICTED;1:ASK ON EDIT ONLY;2:NO EDITING;^0;9^Q
"^DD",123.3,123.3,.09,3)
Choose 0, 1 or 2
"^DD",123.3,123.3,.09,21,0)
^^17^17^3001213^
"^DD",123.3,123.3,.09,21,1,0)
If a DEFAULT REASON FOR REQUEST exists for this procedure this field
"^DD",123.3,123.3,.09,21,2,0)
affects the ordering person's ability to edit the default reason while
"^DD",123.3,123.3,.09,21,3,0)
placing an order.
"^DD",123.3,123.3,.09,21,4,0)
 
"^DD",123.3,123.3,.09,21,5,0)
        0 - UNRESTRICTED
"^DD",123.3,123.3,.09,21,6,0)
            User will be able to edit the default text at any time.
"^DD",123.3,123.3,.09,21,7,0)
 
"^DD",123.3,123.3,.09,21,8,0)
        1 - ASK ON EDIT ONLY
"^DD",123.3,123.3,.09,21,9,0)
            User will only be allowed to edit the default reason if the
"^DD",123.3,123.3,.09,21,10,0)
            order is edited before releasing to the service.
"^DD",123.3,123.3,.09,21,11,0)
 
"^DD",123.3,123.3,.09,21,12,0)
        2 - NO EDITING
"^DD",123.3,123.3,.09,21,13,0)
            User will not be allowed to edit the default reason at any
"^DD",123.3,123.3,.09,21,14,0)
            time.
"^DD",123.3,123.3,.09,21,15,0)
 
"^DD",123.3,123.3,.09,21,16,0)
The value of this field will be ignored if no DEFAULT REASON FOR REQUEST
"^DD",123.3,123.3,.09,21,17,0)
exists for this procedure.
"^DD",123.3,123.3,.09,"DT")
3001017
"^DD",123.3,123.3,1,0)
SYNONYM^123.31^^1;0
"^DD",123.3,123.3,2,0)
RELATED SERVICES^123.32P^^2;0
"^DD",123.3,123.3,124,0)
DEFAULT REASON FOR REQUEST^123.3124A^^124;0
"^DD",123.3,123.3,124,21,0)
^^7^7^3001201^
"^DD",123.3,123.3,124,21,1,0)
This field will allow a boilerplate of text to be imported into the reason
"^DD",123.3,123.3,124,21,2,0)
for request when placing orders for this procedure. If the user places an
"^DD",123.3,123.3,124,21,3,0)
order using a quick order having boilerplate text, that text will
"^DD",123.3,123.3,124,21,4,0)
supersede any default text stored in this field.
"^DD",123.3,123.3,124,21,5,0)
 
"^DD",123.3,123.3,124,21,6,0)
This field may contain any text including TIU objects. TIU Objects must be
"^DD",123.3,123.3,124,21,7,0)
enclosed in vertical bars (e.g. |PATIENT NAME| ).
"^DD",123.3,123.3,124,"DT")
3001201
"^DD",123.3,123.3,125,0)
PREREQUISITE^123.3125^^125;0
"^DD",123.3,123.31,0)
SYNONYM SUB-FIELD^^.01^1
"^DD",123.3,123.31,0,"DT")
2991208
"^DD",123.3,123.31,0,"IX","B",123.31,.01)

"^DD",123.3,123.31,0,"NM","SYNONYM")

"^DD",123.3,123.31,0,"UP")
123.3
"^DD",123.3,123.31,.01,0)
SYNONYM^MF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",123.3,123.31,.01,1,0)
^.1
"^DD",123.3,123.31,.01,1,1,0)
123.31^B
"^DD",123.3,123.31,.01,1,1,1)
S ^GMR(123.3,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",123.3,123.31,.01,1,1,2)
K ^GMR(123.3,DA(1),1,"B",$E(X,1,30),DA)
"^DD",123.3,123.31,.01,1,2,0)
123.3^C
"^DD",123.3,123.31,.01,1,2,1)
S ^GMR(123.3,"C",$E(X,1,30),DA(1),DA)=""
"^DD",123.3,123.31,.01,1,2,2)
K ^GMR(123.3,"C",$E(X,1,30),DA(1),DA)
"^DD",123.3,123.31,.01,1,2,"%D",0)
^^2^2^3001127^
"^DD",123.3,123.31,.01,1,2,"%D",1,0)
The "C" cross reference allows look-up of a procedure by the associated
"^DD",123.3,123.31,.01,1,2,"%D",2,0)
synonyms.
"^DD",123.3,123.31,.01,1,2,"DT")
3001127
"^DD",123.3,123.31,.01,3)
Answer must be 3-30 characters in length.
"^DD",123.3,123.31,.01,21,0)
^^1^1^3000517^
"^DD",123.3,123.31,.01,21,1,0)
This field contains other names commonly used to refer to this procedure.
"^DD",123.3,123.31,.01,"DT")
3001127
"^DD",123.3,123.3124,0)
DEFAULT REASON FOR REQUEST SUB-FIELD^^.01^1
"^DD",123.3,123.3124,0,"DT")
3001201
"^DD",123.3,123.3124,0,"NM","DEFAULT REASON FOR REQUEST")

"^DD",123.3,123.3124,0,"UP")
123.3
"^DD",123.3,123.3124,.01,0)
DEFAULT REASON FOR REQUEST^W^^0;1
"^DD",123.3,123.3124,.01,3)
Enter the default text to be used as the reason for request when ordering this procedure.
"^DD",123.3,123.3124,.01,21,0)
^^7^7^3001201^
"^DD",123.3,123.3124,.01,21,1,0)
This field will allow a boilerplate of text to be imported into the reason
"^DD",123.3,123.3124,.01,21,2,0)
for request when placing orders for this procedure. If the user places an
"^DD",123.3,123.3124,.01,21,3,0)
order using a quick order having boilerplate text, that text will
"^DD",123.3,123.3124,.01,21,4,0)
supersede any default text stored in this field.
"^DD",123.3,123.3124,.01,21,5,0)
 
"^DD",123.3,123.3124,.01,21,6,0)
This field may contain any text including TIU objects. TIU Objects must be
"^DD",123.3,123.3124,.01,21,7,0)
enclosed in vertical bars (e.g. |PATIENT NAME| ).
"^DD",123.3,123.3124,.01,"DT")
3001201
"^DD",123.3,123.3125,0)
PREREQUISITE SUB-FIELD^^.01^1
"^DD",123.3,123.3125,0,"DT")
3001018
"^DD",123.3,123.3125,0,"NM","PREREQUISITE")

"^DD",123.3,123.3125,0,"UP")
123.3
"^DD",123.3,123.3125,.01,0)
PREREQUISITE^W^^0;1
"^DD",123.3,123.3125,.01,3)
Enter any pre-requisite information for ordering this procedure.
"^DD",123.3,123.3125,.01,21,0)
^^10^10^3001201^
"^DD",123.3,123.3125,.01,21,1,0)
This word-processing field is utilized to communicate pre-requisite
"^DD",123.3,123.3125,.01,21,2,0)
information to the ordering person prior to ordering this procedure.
"^DD",123.3,123.3125,.01,21,3,0)
 
"^DD",123.3,123.3125,.01,21,4,0)
This field will be presented to the ordering person upon selecting a
"^DD",123.3,123.3125,.01,21,5,0)
procedure and will allow them to abort the ordering at that time if they
"^DD",123.3,123.3125,.01,21,6,0)
choose.
"^DD",123.3,123.3125,.01,21,7,0)
 
"^DD",123.3,123.3125,.01,21,8,0)
TIU objects may be embedded within this field which will be resolved for
"^DD",123.3,123.3125,.01,21,9,0)
the current patient during ordering. Any TIU objects must be contained
"^DD",123.3,123.3125,.01,21,10,0)
within vertical bars (e.g. |BLOOD PRESSURE| ). 
"^DD",123.3,123.3125,.01,"DT")
3001201
"^DD",123.3,123.32,0)
RELATED SERVICES SUB-FIELD^^.01^1
"^DD",123.3,123.32,0,"DT")
2991210
"^DD",123.3,123.32,0,"IX","B",123.32,.01)

"^DD",123.3,123.32,0,"NM","RELATED SERVICES")

"^DD",123.3,123.32,0,"UP")
123.3
"^DD",123.3,123.32,.01,0)
RELATED SERVICES^MP123.5'X^GMR(123.5,^0;1^I $P($G(^GMR(123.5,+X,0)),"^",2)=9!($P($G(^GMR(123.5,+X,0)),"^",2)=1) D EN^DDIOL("This service is not orderable. Try again.") K X
"^DD",123.3,123.32,.01,1,0)
^.1^^-1
"^DD",123.3,123.32,.01,1,1,0)
123.32^B
"^DD",123.3,123.32,.01,1,1,1)
S ^GMR(123.3,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",123.3,123.32,.01,1,1,2)
K ^GMR(123.3,DA(1),2,"B",$E(X,1,30),DA)
"^DD",123.3,123.32,.01,3)
Enter the service that will perform this procedure
"^DD",123.3,123.32,.01,21,0)
^.001^3^3^3010316^^^
"^DD",123.3,123.32,.01,21,1,0)
This field will indicate which Consult services from the REQUEST
"^DD",123.3,123.32,.01,21,2,0)
SERVICES (#123.5) file are responsible for the processing of requests for
"^DD",123.3,123.32,.01,21,3,0)
this procedure.
"^DD",123.3,123.32,.01,"DT")
3010316
"^DD",123.5,123.5,1.06,0)
RESULT MGMT USER CLASS^*P8930'^USR(8930,^1;6^S DIC("S")="I $P(^(0),U,3)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.5,1.06,3)
Enter the User Class that may disassociate Medicine Results from a Consult Request
"^DD",123.5,123.5,1.06,12)
Only an active User Class may be selected
"^DD",123.5,123.5,1.06,12.1)
S DIC("S")="I $P(^(0),U,3)"
"^DD",123.5,123.5,1.06,21,0)
^^6^6^3000823^
"^DD",123.5,123.5,1.06,21,1,0)
This field defines the Authorization/Subscription User Class that is
"^DD",123.5,123.5,1.06,21,2,0)
permitted to disassociate a Medicine result from a Consult request. It is
"^DD",123.5,123.5,1.06,21,3,0)
recommended that this function be restricted to a very select group of
"^DD",123.5,123.5,1.06,21,4,0)
individuals.
"^DD",123.5,123.5,1.06,21,5,0)
 
"^DD",123.5,123.5,1.06,21,6,0)
This field invokes IA #3008
"^DD",123.5,123.5,1.06,"DT")
3000404
"^DD",123.5,123.5,101,0)
PROCEDURE TYPE^123.5101P^^101;0
"^DD",123.5,123.5,101,"DT")
3000628
"^DD",123.5,123.5,101,"V",0)
^.12P
"^DD",123.5,123.5101,0)
PROCEDURE TYPE SUB-FIELD^^.01^1
"^DD",123.5,123.5101,0,"NM","PROCEDURE TYPE")

"^DD",123.5,123.5101,.01,0)
PROCEDURE TYPE^M*P101'^ORD(101,^0;1^S DIC("S")="I $E(^(0),1,5)=""GMRCR""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",123.5,123.5101,.01,1,0)
^.1
"^DD",123.5,123.5101,.01,1,1,0)
123.5101^B
"^DD",123.5,123.5101,.01,1,1,1)
S ^GMR(123.5,DA(1),101,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.5101,.01,1,1,2)
K ^GMR(123.5,DA(1),101,"B",$E(X,1,30),DA)
"^DD",123.5,123.5101,.01,1,2,0)
123.5^APR
"^DD",123.5,123.5101,.01,1,2,1)
S ^GMR(123.5,"APR",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.5101,.01,1,2,2)
K ^GMR(123.5,"APR",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.5101,.01,1,2,"%D",0)
^^2^2^2980907^
"^DD",123.5,123.5101,.01,1,2,"%D",1,0)
This cross reference is used to find all services which process a procedure
"^DD",123.5,123.5101,.01,1,2,"%D",2,0)
type.
"^DD",123.5,123.5101,.01,1,2,"DT")
2980907
"^DD",123.5,123.5101,.01,3)
Select the procedure that can be processed by this service.
"^DD",123.5,123.5101,.01,12)
Only Procedures may be chosen.
"^DD",123.5,123.5101,.01,12.1)
S DIC("S")="I $E(^(0),1,5)=""GMRCR"""
"^DD",123.5,123.5101,.01,21,0)
^.001^5^5^3000628^^^^
"^DD",123.5,123.5101,.01,21,1,0)
This field is no longer used for associating a prcedure with a particular 
"^DD",123.5,123.5101,.01,21,2,0)
Consult service.  Use the RELATED SERVICES field in the GMRC PROCEDURE 
"^DD",123.5,123.5101,.01,21,3,0)
(#123.3) file for this purpose.
"^DD",123.5,123.5101,.01,21,4,0)
 
"^DD",123.5,123.5101,.01,21,5,0)
This field will be deleted in the future.
"^DD",123.5,123.5101,.01,"DT")
3000628
"^DD",8989.51,8989.51,0)
FIELD^^30^18
"^DD",8989.51,8989.51,0,"DDA")
N
"^DD",8989.51,8989.51,0,"DT")
2970621
"^DD",8989.51,8989.51,0,"ID","WRITE")
N X S X=^(0) D EN^DDIOL($P(X,U,2),"","?36")
"^DD",8989.51,8989.51,0,"IX","AG",8989.513,.02)

"^DD",8989.51,8989.51,0,"IX","B",8989.51,.01)

"^DD",8989.51,8989.51,0,"IX","C",8989.51,.02)

"^DD",8989.51,8989.51,0,"IX","D",8989.51,.01)

"^DD",8989.51,8989.51,0,"NM","PARAMETER DEFINITION")

"^DD",8989.51,8989.51,0,"PT",8989.5,.02)

"^DD",8989.51,8989.51,0,"PT",8989.52,.04)

"^DD",8989.51,8989.51,0,"PT",8989.521,.02)

"^DD",8989.51,8989.51,0,"VRPK")
XT
"^DD",8989.51,8989.51,.01,0)
NAME^RFX^^0;1^D VALID01^XPARDD1
"^DD",8989.51,8989.51,.01,1,0)
^.1
"^DD",8989.51,8989.51,.01,1,1,0)
8989.51^B
"^DD",8989.51,8989.51,.01,1,1,1)
S ^XTV(8989.51,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.51,.01,1,1,2)
K ^XTV(8989.51,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.51,.01,1,2,0)
8989.51^D^KWIC
"^DD",8989.51,8989.51,.01,1,2,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^XTV(8989.51,"D",I,DA)=""
"^DD",8989.51,8989.51,.01,1,2,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^XTV(8989.51,"D",I,DA)
"^DD",8989.51,8989.51,.01,1,2,"DT")
3000225
"^DD",8989.51,8989.51,.01,3)
Answer must be 3-30 characters in length.  Name must be unique.
"^DD",8989.51,8989.51,.01,21,0)
^.001^2^2^3000701^^
"^DD",8989.51,8989.51,.01,21,1,0)
This is the name of the parameter.  It should be namespaced according to the 
"^DD",8989.51,8989.51,.01,21,2,0)
package from which the parameter originated.
"^DD",8989.51,8989.51,.01,"DT")
3000225
"^DD",8989.51,8989.51,.02,0)
DISPLAY TEXT^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.02,1,0)
^.1
"^DD",8989.51,8989.51,.02,1,1,0)
8989.51^C^MUMPS
"^DD",8989.51,8989.51,.02,1,1,1)
S ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)=""
"^DD",8989.51,8989.51,.02,1,1,2)
K ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)
"^DD",8989.51,8989.51,.02,1,1,"%D",0)
^^2^2^2970606^
"^DD",8989.51,8989.51,.02,1,1,"%D",1,0)
Cross references display text for lookup.  Display text is put in upper
"^DD",8989.51,8989.51,.02,1,1,"%D",2,0)
case so lookup will be case insensitive.
"^DD",8989.51,8989.51,.02,1,1,"DT")
2960409
"^DD",8989.51,8989.51,.02,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.02,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.02,21,1,0)
This is the displayable name for the parameter (allows mixed case, 
"^DD",8989.51,8989.51,.02,21,2,0)
non-namespaced names).
"^DD",8989.51,8989.51,.02,"DT")
2960409
"^DD",8989.51,8989.51,.03,0)
MULTIPLE VALUED^S^1:Yes;0:No;^0;3^Q
"^DD",8989.51,8989.51,.03,3)
Enter 'Yes' if multiple instances of the parameter are allowed for any single entity.
"^DD",8989.51,8989.51,.03,21,0)
^^3^3^2980705^
"^DD",8989.51,8989.51,.03,21,1,0)
If this field is set to 'Yes', multiple instances of the parameter will be 
"^DD",8989.51,8989.51,.03,21,2,0)
allowed for a single entity.  Otherwise, the value of the instance field
"^DD",8989.51,8989.51,.03,21,3,0)
for a given Entity-Parameter combination will always be '1'.
"^DD",8989.51,8989.51,.03,"DT")
2960207
"^DD",8989.51,8989.51,.04,0)
INSTANCE TERM^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.04,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.04,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,.04,21,1,0)
This is a free text term that can be used when prompting for a new instance of 
"^DD",8989.51,8989.51,.04,21,2,0)
the parameter (in the case where the parameter in multiple valued).  If not 
"^DD",8989.51,8989.51,.04,21,3,0)
entered, the word "Instance" will be used.
"^DD",8989.51,8989.51,.04,"DT")
2960207
"^DD",8989.51,8989.51,.05,0)
VALUE TERM^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.05,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.05,21,0)
^^2^2^2970626^
"^DD",8989.51,8989.51,.05,21,1,0)
This contains text that is issued as a prompt for the value.  If nothing
"^DD",8989.51,8989.51,.05,21,2,0)
is here, the prompt will be the word 'Value:'.
"^DD",8989.51,8989.51,.05,"DT")
2960612
"^DD",8989.51,8989.51,.06,0)
PROHIBIT EDITING^S^1:Yes;0:No;^0;6^Q
"^DD",8989.51,8989.51,.06,3)
Choose 'Disallow Editing' if editing of this field should not be allowed.
"^DD",8989.51,8989.51,.06,21,0)
^^2^2^2970306^
"^DD",8989.51,8989.51,.06,21,1,0)
This field prevents the parameter value from being edited with Fileman or
"^DD",8989.51,8989.51,.06,21,2,0)
any Parameters tools.
"^DD",8989.51,8989.51,.06,"DT")
2970317
"^DD",8989.51,8989.51,1.1,0)
VALUE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;M:M code;C:constant;^1;1^Q
"^DD",8989.51,8989.51,1.1,3)
Enter the type of data this parameter will contain.
"^DD",8989.51,8989.51,1.1,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,1.1,21,1,0)
This is the type of data this parameter will contain.  This field is used to 
"^DD",8989.51,8989.51,1.1,21,2,0)
define a call to the reader (^DIR) in most cases.
"^DD",8989.51,8989.51,1.1,"DT")
2960528
"^DD",8989.51,8989.51,1.2,0)
VALUE DOMAIN^F^^1;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,1.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,1.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.2,21,1,0)
This is a string that may be used to further specify the data type.  The 
"^DD",8989.51,8989.51,1.2,21,2,0)
string stored here should be appropriate for the second ^-piece of DIR(0) 
"^DD",8989.51,8989.51,1.2,21,3,0)
when used with the data type field.
"^DD",8989.51,8989.51,1.2,"DT")
2960207
"^DD",8989.51,8989.51,1.3,0)
VALUE HELP^F^^1;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,1.3,3)
Enter a line of help text to be displayed when entering a parameter value.
"^DD",8989.51,8989.51,1.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,1.3,21,2,0)
requests help or encounters an error while entering the VALUE field in the 
"^DD",8989.51,8989.51,1.3,21,3,0)
PARAMETERS file.
"^DD",8989.51,8989.51,1.3,"DT")
2960207
"^DD",8989.51,8989.51,2,0)
VALUE VALIDATION CODE^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,2,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,2,9)
@
"^DD",8989.51,8989.51,2,21,0)
^^2^2^2980705^
"^DD",8989.51,8989.51,2,21,1,0)
This field contains the M code that is placed in the third piece of DIR(0)
"^DD",8989.51,8989.51,2,21,2,0)
when validating a value in the PARAMETERS file.
"^DD",8989.51,8989.51,2,"DT")
2960207
"^DD",8989.51,8989.51,3,0)
VALUE SCREEN CODE^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,3,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,3,9)
@
"^DD",8989.51,8989.51,3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,3,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,3,21,2,0)
VALUE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,3,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,3,"DT")
2960207
"^DD",8989.51,8989.51,6.1,0)
INSTANCE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;^6;1^Q
"^DD",8989.51,8989.51,6.1,3)
Enter the type of data allowed for the INSTANCE field of the parameter.
"^DD",8989.51,8989.51,6.1,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.1,21,1,0)
This is the type of data that is contained in the INSTANCE field of the 
"^DD",8989.51,8989.51,6.1,21,2,0)
PARAMETERS file, if multiple parameter instances per entity are allowed.  
"^DD",8989.51,8989.51,6.1,21,3,0)
This field is used to define a call to the reader.
"^DD",8989.51,8989.51,6.1,"DT")
2960207
"^DD",8989.51,8989.51,6.2,0)
INSTANCE DOMAIN^F^^6;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,6.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,6.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.2,21,1,0)
This may be used to further define the data type for the INSTANCE field of 
"^DD",8989.51,8989.51,6.2,21,2,0)
the parameter.  The string stored here should be appropriate for the second 
"^DD",8989.51,8989.51,6.2,21,3,0)
^-piece of DIR(0) when used with the data type field.
"^DD",8989.51,8989.51,6.2,"DT")
2960207
"^DD",8989.51,8989.51,6.3,0)
INSTANCE HELP^F^^6;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,6.3,3)
Enter a line of help text to be displayed when entering the parameter instance.
"^DD",8989.51,8989.51,6.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,6.3,21,2,0)
requests help or encounters an error while entering the INSTANCE field of 
"^DD",8989.51,8989.51,6.3,21,3,0)
the PARAMETERS file.
"^DD",8989.51,8989.51,6.3,"DT")
2960207
"^DD",8989.51,8989.51,7,0)
INSTANCE VALIDATION CODE^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,7,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,7,9)
@
"^DD",8989.51,8989.51,7,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,7,21,1,0)
This field contains M code that is placed in the third piece of DIR(0) when 
"^DD",8989.51,8989.51,7,21,2,0)
validating the INSTANCE field in the PARAMETERS file.
"^DD",8989.51,8989.51,7,"DT")
2960207
"^DD",8989.51,8989.51,8,0)
INSTANCE SCREEN CODE^K^^8;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,8,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,8,9)
@
"^DD",8989.51,8989.51,8,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,8,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,8,21,2,0)
INSTANCE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,8,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,8,"DT")
2960207
"^DD",8989.51,8989.51,20,0)
DESCRIPTION^8989.512^^20;0
"^DD",8989.51,8989.51,20,21,0)
^^1^1^2970626^
"^DD",8989.51,8989.51,20,21,1,0)
A description of the parameter may be entered here.
"^DD",8989.51,8989.51,30,0)
ALLOWABLE ENTITIES^8989.513I^^30;0
"^DD",8989.51,8989.51,30,21,0)
^^2^2^2960213^^
"^DD",8989.51,8989.51,30,21,1,0)
This multiple contains a list of entities (pointers to files) for which the 
"^DD",8989.51,8989.51,30,21,2,0)
parameter may be validly set.
"^DD",8989.51,8989.512,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8989.51,8989.512,0,"DT")
2960207
"^DD",8989.51,8989.512,0,"NM","DESCRIPTION")

"^DD",8989.51,8989.512,0,"UP")
8989.51
"^DD",8989.51,8989.512,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",8989.51,8989.512,.01,3)
Enter a description of the parameter and how it is used.
"^DD",8989.51,8989.512,.01,21,0)
^^1^1^2960207^
"^DD",8989.51,8989.512,.01,21,1,0)
This is text that describes the purpose and use of the parameter.
"^DD",8989.51,8989.512,.01,"DT")
2960207
"^DD",8989.51,8989.513,0)
ALLOWABLE ENTITIES SUB-FIELD^^.02^2
"^DD",8989.51,8989.513,0,"DT")
2970621
"^DD",8989.51,8989.513,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8989.51,8989.513,0,"IX","B",8989.513,.01)

"^DD",8989.51,8989.513,0,"NM","ALLOWABLE ENTITIES")

"^DD",8989.51,8989.513,0,"UP")
8989.51
"^DD",8989.51,8989.513,.01,0)
PRECEDENCE^MRNJ6,2^^0;1^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",8989.51,8989.513,.01,1,0)
^.1
"^DD",8989.51,8989.513,.01,1,1,0)
8989.513^B
"^DD",8989.51,8989.513,.01,1,1,1)
S ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.513,.01,1,1,2)
K ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.513,.01,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",8989.51,8989.513,.01,21,0)
^^6^6^2960213^^^
"^DD",8989.51,8989.513,.01,21,1,0)
A single parameter may be set for several different types of entities.  This 
"^DD",8989.51,8989.513,.01,21,2,0)
lists the order in which entities are searched for a defined value.  For 
"^DD",8989.51,8989.513,.01,21,3,0)
example, if a parameter may be set for a package, a location, and a user, 
"^DD",8989.51,8989.513,.01,21,4,0)
and the respective precedents are 3, 2, 1, the value of the user parameter 
"^DD",8989.51,8989.513,.01,21,5,0)
would be returned.  If it did not exist, the value of the location 
"^DD",8989.51,8989.513,.01,21,6,0)
parameter.  If that did not exist, then the value of the package parameter.
"^DD",8989.51,8989.513,.01,"DT")
2960213
"^DD",8989.51,8989.513,.02,0)
ENTITY FILE^RP8989.518'^XTV(8989.518,^0;2^Q
"^DD",8989.51,8989.513,.02,1,0)
^.1
"^DD",8989.51,8989.513,.02,1,1,0)
8989.51^AG^MUMPS
"^DD",8989.51,8989.513,.02,1,1,1)
D AGS^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,2)
D AGK^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,"%D",0)
^^5^5^2980422^
"^DD",8989.51,8989.513,.02,1,1,"%D",1,0)
The AG x-ref has the format ^XTV(8989.51,PARAM,30,"AG",GLOBAL REF,DA)="".
"^DD",8989.51,8989.513,.02,1,1,"%D",2,0)
 
"^DD",8989.51,8989.513,.02,1,1,"%D",3,0)
It is used to screen the parameters that may be selected for a given entity 
"^DD",8989.51,8989.513,.02,1,1,"%D",4,0)
in the PARAMETERS file.  The global root is used because the entity is a 
"^DD",8989.51,8989.513,.02,1,1,"%D",5,0)
variable pointer.
"^DD",8989.51,8989.513,.02,1,1,"DT")
2960207
"^DD",8989.51,8989.513,.02,3)
Choose a file from which entities for this parameter are identified.
"^DD",8989.51,8989.513,.02,21,0)
^^3^3^2980422^
"^DD",8989.51,8989.513,.02,21,1,0)
This identifies an entity for which the parameter can be legally entered.  
"^DD",8989.51,8989.513,.02,21,2,0)
Entities are simply variable pointers.  The files which are eligible to be
"^DD",8989.51,8989.513,.02,21,3,0)
entities are listed in the PARAMETER ENTITY file.
"^DD",8989.51,8989.513,.02,"DT")
2970621
"^DIC",123.3,123.3,0)
GMRC PROCEDURE^123.3
"^DIC",123.3,123.3,0,"GL")
^GMR(123.3,
"^DIC",123.3,123.3,"%",0)
^1.005^^0
"^DIC",123.3,123.3,"%D",0)
^^3^3^3001213^
"^DIC",123.3,123.3,"%D",1,0)
This file is used for the maintenance of procedures used in the
"^DIC",123.3,123.3,"%D",2,0)
CONSULT/REQUEST TRACKING package. The procedures contained in this file
"^DIC",123.3,123.3,"%D",3,0)
are orderable in CPRS if not inactive.
"^DIC",123.3,"B","GMRC PROCEDURE",123.3)

"^DIC",8989.51,8989.51,0)
PARAMETER DEFINITION^8989.51
"^DIC",8989.51,8989.51,0,"GL")
^XTV(8989.51,
"^DIC",8989.51,8989.51,"%D",0)
^^3^3^2980920^
"^DIC",8989.51,8989.51,"%D",1,0)
This file contains the characteristics of parameters.  Entries in this
"^DIC",8989.51,8989.51,"%D",2,0)
file must be namespaced and they are exported by the package which owns
"^DIC",8989.51,8989.51,"%D",3,0)
them.
"^DIC",8989.51,"B","PARAMETER DEFINITION",8989.51)

**END**
**END**
