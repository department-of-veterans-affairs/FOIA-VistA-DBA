Released PSN*4*109 SEQ #96
Extracted from mail message
**KIDS**:PSN*4.0*109^

**INSTALL NAME**
PSN*4.0*109
"BLD",5845,0)
PSN*4.0*109^NATIONAL DRUG FILE^0^3060118^y
"BLD",5845,1,0)
^^16^16^3060109^
"BLD",5845,1,1,0)
This patch will contain enhancements to the cycle 1 encapsulation APIs.
"BLD",5845,1,2,0)
  
"BLD",5845,1,3,0)
A new API is added with this patch that returns information from the
"BLD",5845,1,4,0)
NDC/UPN file (#50.67). See DBIA 4829 for complete information.
"BLD",5845,1,5,0)
 
"BLD",5845,1,6,0)
A new field has been added to the return data of DATA^PSN50P68 component 
"BLD",5845,1,7,0)
of DBIA 4545. It is the SERVICE CODE field (#2000) of the VA PRODUCT file
"BLD",5845,1,8,0)
(#50.68). The field is being sent out in National Drug File patch
"BLD",5845,1,9,0)
PSN*4*103.
"BLD",5845,1,10,0)
 
"BLD",5845,1,11,0)
A change has been made to the DIC^PSNDI and IX^PSNDI components of DBIA 
"BLD",5845,1,12,0)
4554. DIC("S") will be killed within these components. If the file you 
"BLD",5845,1,13,0)
are passing in has an Inactivation Date field, and you want to screen on 
"BLD",5845,1,14,0)
that field, a new date input parameter is being added to the components, 
"BLD",5845,1,15,0)
and if a date is passed in, a screen will be set for the calling 
"BLD",5845,1,16,0)
application.
"BLD",5845,4,0)
^9.64PA^^
"BLD",5845,"KRN",0)
^9.67PA^8989.52^19
"BLD",5845,"KRN",.4,0)
.4
"BLD",5845,"KRN",.401,0)
.401
"BLD",5845,"KRN",.402,0)
.402
"BLD",5845,"KRN",.403,0)
.403
"BLD",5845,"KRN",.5,0)
.5
"BLD",5845,"KRN",.84,0)
.84
"BLD",5845,"KRN",3.6,0)
3.6
"BLD",5845,"KRN",3.8,0)
3.8
"BLD",5845,"KRN",9.2,0)
9.2
"BLD",5845,"KRN",9.8,0)
9.8
"BLD",5845,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5845,"KRN",9.8,"NM",1,0)
PSN5067^^0^B21247745
"BLD",5845,"KRN",9.8,"NM",2,0)
PSNDI^^0^B7794023
"BLD",5845,"KRN",9.8,"NM",3,0)
PSN50P68^^0^B17364727
"BLD",5845,"KRN",9.8,"NM","B","PSN5067",1)

"BLD",5845,"KRN",9.8,"NM","B","PSN50P68",3)

"BLD",5845,"KRN",9.8,"NM","B","PSNDI",2)

"BLD",5845,"KRN",19,0)
19
"BLD",5845,"KRN",19,"NM",0)
^9.68A^^
"BLD",5845,"KRN",19.1,0)
19.1
"BLD",5845,"KRN",101,0)
101
"BLD",5845,"KRN",409.61,0)
409.61
"BLD",5845,"KRN",771,0)
771
"BLD",5845,"KRN",870,0)
870
"BLD",5845,"KRN",8989.51,0)
8989.51
"BLD",5845,"KRN",8989.52,0)
8989.52
"BLD",5845,"KRN",8994,0)
8994
"BLD",5845,"KRN","B",.4,.4)

"BLD",5845,"KRN","B",.401,.401)

"BLD",5845,"KRN","B",.402,.402)

"BLD",5845,"KRN","B",.403,.403)

"BLD",5845,"KRN","B",.5,.5)

"BLD",5845,"KRN","B",.84,.84)

"BLD",5845,"KRN","B",3.6,3.6)

"BLD",5845,"KRN","B",3.8,3.8)

"BLD",5845,"KRN","B",9.2,9.2)

"BLD",5845,"KRN","B",9.8,9.8)

"BLD",5845,"KRN","B",19,19)

"BLD",5845,"KRN","B",19.1,19.1)

"BLD",5845,"KRN","B",101,101)

"BLD",5845,"KRN","B",409.61,409.61)

"BLD",5845,"KRN","B",771,771)

"BLD",5845,"KRN","B",870,870)

"BLD",5845,"KRN","B",8989.51,8989.51)

"BLD",5845,"KRN","B",8989.52,8989.52)

"BLD",5845,"KRN","B",8994,8994)

"BLD",5845,"QUES",0)
^9.62^^
"BLD",5845,"REQB",0)
^9.611^1^1
"BLD",5845,"REQB",1,0)
PSN*4.0*104^2
"BLD",5845,"REQB","B","PSN*4.0*104",1)

"MBREQ")
0
"PKG",136,-1)
1^1
"PKG",136,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.14
"PKG",136,20,0)
^9.402P^^
"PKG",136,22,0)
^9.49I^1^1
"PKG",136,22,1,0)
4.0^2981030^2981223^11595
"PKG",136,22,1,"PAH",1,0)
109^3060118
"PKG",136,22,1,"PAH",1,1,0)
^^16^16^3060118
"PKG",136,22,1,"PAH",1,1,1,0)
This patch will contain enhancements to the cycle 1 encapsulation APIs.
"PKG",136,22,1,"PAH",1,1,2,0)
  
"PKG",136,22,1,"PAH",1,1,3,0)
A new API is added with this patch that returns information from the
"PKG",136,22,1,"PAH",1,1,4,0)
NDC/UPN file (#50.67). See DBIA 4829 for complete information.
"PKG",136,22,1,"PAH",1,1,5,0)
 
"PKG",136,22,1,"PAH",1,1,6,0)
A new field has been added to the return data of DATA^PSN50P68 component 
"PKG",136,22,1,"PAH",1,1,7,0)
of DBIA 4545. It is the SERVICE CODE field (#2000) of the VA PRODUCT file
"PKG",136,22,1,"PAH",1,1,8,0)
(#50.68). The field is being sent out in National Drug File patch
"PKG",136,22,1,"PAH",1,1,9,0)
PSN*4*103.
"PKG",136,22,1,"PAH",1,1,10,0)
 
"PKG",136,22,1,"PAH",1,1,11,0)
A change has been made to the DIC^PSNDI and IX^PSNDI components of DBIA 
"PKG",136,22,1,"PAH",1,1,12,0)
4554. DIC("S") will be killed within these components. If the file you 
"PKG",136,22,1,"PAH",1,1,13,0)
are passing in has an Inactivation Date field, and you want to screen on 
"PKG",136,22,1,"PAH",1,1,14,0)
that field, a new date input parameter is being added to the components, 
"PKG",136,22,1,"PAH",1,1,15,0)
and if a date is passed in, a screen will be set for the calling 
"PKG",136,22,1,"PAH",1,1,16,0)
application.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSN5067")
0^1^B21247745
"RTN","PSN5067",1,0)
PSN5067 ;BIR/LDT - API FOR INFORMATION FROM FILE 50.67; 5 Sep 03
"RTN","PSN5067",2,0)
 ;;4.0; NATIONAL DRUG FILE;**109**; 30 Oct 98
"RTN","PSN5067",3,0)
 ;
"RTN","PSN5067",4,0)
ALL(PSNIEN,PSNFT,PSNFL,LIST) ;
"RTN","PSN5067",5,0)
 ;PSNIEN - IEN of entry in NDC/UPN file (#50.67).
"RTN","PSN5067",6,0)
 ;PSNFT - Free Text TRADE NAME in NDC/UPN file (#50.67).
"RTN","PSN5067",7,0)
 ;PSNFL - Inactive flag - "" - All entries.
"RTN","PSN5067",8,0)
 ;        FileMan Date - Only entries with no Inactive Date or an Inactive Date greater than this date.
"RTN","PSN5067",9,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where
"RTN","PSN5067",10,0)
 ;       Field Number is the Field Number of the data piece being returned.
"RTN","PSN5067",11,0)
 ;Returns SEQUENCE NUMBER field (#.01), NDC field (#1), UPN field (#2), MANUFACTURER field (#3), TRADE NAME field (#4),
"RTN","PSN5067",12,0)
 ;VA PRODUCT NAME field (#5), INACTIVATION DATE field (#7), PACKAGE SIZE field (#8), PACKAGE TYPE field (#9), and
"RTN","PSN5067",13,0)
 ;OTX/RX INDICATOR field (#10) of the NDC/UPN file (#50.67).
"RTN","PSN5067",14,0)
 N DIERR,ZZERR,PSN5067,PSN,SCR
"RTN","PSN5067",15,0)
 I $G(LIST)']"" Q
"RTN","PSN5067",16,0)
 K ^TMP($J,LIST)
"RTN","PSN5067",17,0)
 I $G(PSNIEN)']"",($G(PSNFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN5067",18,0)
 I $G(PSNIEN)]"",(+$G(PSNIEN)'>0) S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN5067",19,0)
 S SCR("S")=""
"RTN","PSN5067",20,0)
 I +$G(PSNFL)>0 N ND D SETSCRN
"RTN","PSN5067",21,0)
 I $G(PSNIEN)]"" N PSNIEN2 S PSNIEN2=$$FIND1^DIC(50.67,"","B","`"_PSNIEN,,SCR("S"),"") D
"RTN","PSN5067",22,0)
 .I +PSNIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN5067",23,0)
 .S ^TMP($J,LIST,0)=1
"RTN","PSN5067",24,0)
 .D GETS^DIQ(50.67,+PSNIEN2,".01:10","IE","PSN5067") S PSN(1)=0
"RTN","PSN5067",25,0)
 .F  S PSN(1)=$O(PSN5067(50.67,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN5067",26,0)
 I $G(PSNIEN)="",$G(PSNFT)]"" D
"RTN","PSN5067",27,0)
 .I PSNFT["??" D LOOP Q
"RTN","PSN5067",28,0)
 .D FIND^DIC(50.67,,"@;.01;1","QP",PSNFT,,"T",SCR("S"),,"")
"RTN","PSN5067",29,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN5067",30,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSNXX S PSNXX=0 F  S PSNXX=$O(^TMP("DILIST",$J,PSNXX)) Q:'PSNXX  D
"RTN","PSN5067",31,0)
 ..S PSNIEN=+^TMP("DILIST",$J,PSNXX,0) K PSN5067 D GETS^DIQ(50.67,+PSNIEN,".01:10","IE","PSN5067") S PSN(1)=0
"RTN","PSN5067",32,0)
 ..F  S PSN(1)=$O(PSN5067(50.67,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN5067",33,0)
 K ^TMP("DILIST",$J)
"RTN","PSN5067",34,0)
 Q
"RTN","PSN5067",35,0)
 ;
"RTN","PSN5067",36,0)
SETZRO ;
"RTN","PSN5067",37,0)
 S ^TMP($J,LIST,+PSN(1),.01)=$G(PSN5067(50.67,PSN(1),.01,"I"))
"RTN","PSN5067",38,0)
 S ^TMP($J,LIST,+PSN(1),1)=$G(PSN5067(50.67,PSN(1),1,"I"))
"RTN","PSN5067",39,0)
 S ^TMP($J,LIST,+PSN(1),2)=$G(PSN5067(50.67,PSN(1),2,"I"))
"RTN","PSN5067",40,0)
 S ^TMP($J,LIST,+PSN(1),3)=$S($G(PSN5067(50.67,PSN(1),3,"I"))="":"",1:PSN5067(50.67,PSN(1),3,"I")_"^"_PSN5067(50.67,PSN(1),3,"E"))
"RTN","PSN5067",41,0)
 S ^TMP($J,LIST,+PSN(1),4)=$G(PSN5067(50.67,PSN(1),4,"I"))
"RTN","PSN5067",42,0)
 I $G(PSN5067(50.67,PSN(1),4,"I"))'="" S ^TMP($J,LIST,"B",$G(PSN5067(50.67,PSN(1),4,"I")),+PSN(1))=""
"RTN","PSN5067",43,0)
 S ^TMP($J,LIST,+PSN(1),5)=$S($G(PSN5067(50.67,PSN(1),5,"I"))="":"",1:PSN5067(50.67,PSN(1),5,"I")_"^"_PSN5067(50.67,PSN(1),5,"E"))
"RTN","PSN5067",44,0)
 S ^TMP($J,LIST,+PSN(1),7)=$S($G(PSN5067(50.67,PSN(1),7,"I"))="":"",1:PSN5067(50.67,PSN(1),7,"I")_"^"_PSN5067(50.67,PSN(1),7,"E"))
"RTN","PSN5067",45,0)
 S ^TMP($J,LIST,+PSN(1),8)=$S($G(PSN5067(50.67,PSN(1),8,"I"))="":"",1:PSN5067(50.67,PSN(1),8,"I")_"^"_PSN5067(50.67,PSN(1),8,"E"))
"RTN","PSN5067",46,0)
 S ^TMP($J,LIST,+PSN(1),9)=$S($G(PSN5067(50.67,PSN(1),9,"I"))="":"",1:PSN5067(50.67,PSN(1),9,"I")_"^"_PSN5067(50.67,PSN(1),9,"E"))
"RTN","PSN5067",47,0)
 S ^TMP($J,LIST,+PSN(1),10)=$S($G(PSN5067(50.67,PSN(1),10,"I"))="":"",1:PSN5067(50.67,PSN(1),10,"I")_"^"_PSN5067(50.67,PSN(1),10,"E"))
"RTN","PSN5067",48,0)
 Q
"RTN","PSN5067",49,0)
 ;
"RTN","PSN5067",50,0)
LOOP ;
"RTN","PSN5067",51,0)
 N PSN567D,PSN567E,PSN567RX,PSN567ND,PSNVAL
"RTN","PSN5067",52,0)
 D FIELD^DID(50.67,10,"Z","POINTER","PSN567D","PSN567E") S PSN567RX=$G(PSN567D("POINTER"))
"RTN","PSN5067",53,0)
 N PSNENCT
"RTN","PSN5067",54,0)
 S PSNENCT=0
"RTN","PSN5067",55,0)
 S PSNVAL=0 F  S PSNVAL=$O(^PSNDF(50.67,PSNVAL)) Q:'PSNVAL  D
"RTN","PSN5067",56,0)
 .I $P($G(^PSNDF(50.67,PSNVAL,0)),"^")="" Q
"RTN","PSN5067",57,0)
 .I $G(PSNFL),$P($G(^PSNDF(50.67,PSNVAL,0)),"^",7),$P($G(^(0)),"^",7)'>PSNFL Q
"RTN","PSN5067",58,0)
 .S PSN567ND=$G(^PSNDF(50.67,PSNVAL,0))
"RTN","PSN5067",59,0)
 .S ^TMP($J,LIST,+PSNVAL,.01)=$P(PSN567ND,"^")
"RTN","PSN5067",60,0)
 .I $P(PSN567ND,"^",5)'="" S ^TMP($J,LIST,"B",$P(PSN567ND,"^",5),+PSNVAL)=""
"RTN","PSN5067",61,0)
 .S ^TMP($J,LIST,+PSNVAL,1)=$P(PSN567ND,"^",2)
"RTN","PSN5067",62,0)
 .S ^TMP($J,LIST,+PSNVAL,2)=$P(PSN567ND,"^",3)
"RTN","PSN5067",63,0)
 .S ^TMP($J,LIST,+PSNVAL,3)=$S($P(PSN567ND,"^",4):$P(PSN567ND,"^",4)_"^"_$P($G(^PS(55.95,+$P(PSN567ND,"^",4),0)),"^"),1:"")
"RTN","PSN5067",64,0)
 .S ^TMP($J,LIST,+PSNVAL,4)=$P(PSN567ND,"^",5)
"RTN","PSN5067",65,0)
 .S ^TMP($J,LIST,+PSNVAL,5)=$S($P(PSN567ND,"^",6):$P(PSN567ND,"^",6)_"^"_$P($G(^PSNDF(50.68,+$P(PSN567ND,"^",6),0)),"^"),1:"")
"RTN","PSN5067",66,0)
 .N Y S Y=$P(PSN567ND,"^",7) D
"RTN","PSN5067",67,0)
 ..I Y S ^TMP($J,LIST,+PSNVAL,7)=$G(Y) X ^DD("DD") S ^TMP($J,LIST,+PSNVAL,7)=^TMP($J,LIST,+PSNVAL,7)_"^"_$G(Y) Q
"RTN","PSN5067",68,0)
 ..S ^TMP($J,LIST,+PSNVAL,7)=""
"RTN","PSN5067",69,0)
 .S ^TMP($J,LIST,+PSNVAL,8)=$S($P(PSN567ND,"^",8):$P(PSN567ND,"^",8)_"^"_$P($G(^PS(50.609,+$P(PSN567ND,"^",8),0)),"^"),1:"")
"RTN","PSN5067",70,0)
 .S ^TMP($J,LIST,+PSNVAL,9)=$S($P(PSN567ND,"^",9):$P(PSN567ND,"^",9)_"^"_$P($G(^PS(50.608,+$P(PSN567ND,"^",9),0)),"^"),1:"")
"RTN","PSN5067",71,0)
 .N PSN567NR S PSN567NR=$P(PSN567ND,"^",10)  D
"RTN","PSN5067",72,0)
 ..I PSN567NR'="",PSN567RX'="",PSN567RX[(PSN567NR_":") S ^TMP($J,LIST,+PSNVAL,10)=PSN567NR_"^"_$P($E(PSN567RX,$F(PSN567RX,(PSN567NR_":")),999),";") Q
"RTN","PSN5067",73,0)
 ..S ^TMP($J,LIST,+PSNVAL,10)=""
"RTN","PSN5067",74,0)
 .S PSNENCT=PSNENCT+1
"RTN","PSN5067",75,0)
 S ^TMP($J,LIST,0)=$S($G(PSNENCT):$G(PSNENCT),1:"-1^NO DATA FOUND")
"RTN","PSN5067",76,0)
 Q
"RTN","PSN5067",77,0)
 ;
"RTN","PSN5067",78,0)
SETSCRN ;
"RTN","PSN5067",79,0)
 S SCR("S")="S ND=$P($G(^PSNDF(50.67,+Y,0)),""^"",7) I ND=""""!(ND>PSNFL)"
"RTN","PSN5067",80,0)
 Q
"RTN","PSN50P68")
0^3^B17364727
"RTN","PSN50P68",1,0)
PSN50P68 ;BIR/LDT - API FOR INFORMATION FROM FILE 50.68; 5 Sep 03
"RTN","PSN50P68",2,0)
 ;;4.0; NATIONAL DRUG FILE;**80,94,104,109**; 30 Oct 98
"RTN","PSN50P68",3,0)
 ;
"RTN","PSN50P68",4,0)
FORM(PSNIEN) ;
"RTN","PSN50P68",5,0)
 ;PSNIEN - IEN of entry in VA PRODUCT file (#50.68).
"RTN","PSN50P68",6,0)
 ;Returns NATIONAL FORMULARY NAME field (#4) of the VA PRODUCT file (#50.68).
"RTN","PSN50P68",7,0)
 I +$G(PSNIEN)'>0 Q ""
"RTN","PSN50P68",8,0)
 Q $P($G(^PSNDF(50.68,+PSNIEN,0)),"^",6)
"RTN","PSN50P68",9,0)
 ;
"RTN","PSN50P68",10,0)
DATA(PSNIEN,PSNFT,LIST) ;
"RTN","PSN50P68",11,0)
 ;PSNIEN - IEN of entry in VA PRODUCT file (#50.68).
"RTN","PSN50P68",12,0)
 ;PSNFT - Free Text name in  VA PRODUCT file (#50.68).
"RTN","PSN50P68",13,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSN50P68",14,0)
 ;       Field Number of the data piece beingreturned.
"RTN","PSN50P68",15,0)
 N DIERR,ZZERR,PSN50P68,PSN,PSNSERVP
"RTN","PSN50P68",16,0)
 S PSNSERVP=$$PATCH^XPDUTL("PSN*4.0*103")
"RTN","PSN50P68",17,0)
 I $G(LIST)']"" Q
"RTN","PSN50P68",18,0)
 K ^TMP($J,LIST)
"RTN","PSN50P68",19,0)
 I +$G(PSNIEN)'>0,($G(PSNFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",20,0)
 I $G(PSNIEN)]"",+$G(PSNIEN)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",21,0)
 I $G(PSNIEN)]"" N PSNIEN2 S PSNIEN2=$$FIND1^DIC(50.68,"","B","`"_PSNIEN,,,"") D
"RTN","PSN50P68",22,0)
 .I +PSNIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",23,0)
 .S ^TMP($J,LIST,0)=1
"RTN","PSN50P68",24,0)
 .D GETS^DIQ(50.68,+PSNIEN2,".01;.05;3;4;11;12;13;19;2000","IE","PSN50P68") S PSN(1)=0
"RTN","PSN50P68",25,0)
 .F  S PSN(1)=$O(PSN50P68(50.68,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN50P68",26,0)
 I $G(PSNIEN)="",$G(PSNFT)]"" D
"RTN","PSN50P68",27,0)
 .I PSNFT["??" D LOOP Q
"RTN","PSN50P68",28,0)
 .D FIND^DIC(50.68,,"@;.01","QP",PSNFT,,"B",,,"")
"RTN","PSN50P68",29,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSN50P68",30,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSNXX S PSNXX=0 F  S PSNXX=$O(^TMP("DILIST",$J,PSNXX)) Q:'PSNXX  D
"RTN","PSN50P68",31,0)
 ..S PSNIEN=+^TMP("DILIST",$J,PSNXX,0) K PSN50P68 D GETS^DIQ(50.68,+PSNIEN,".01;.05;3;4;11;12;13;19;2000","IE","PSN50P68") S PSN(1)=0
"RTN","PSN50P68",32,0)
 ..F  S PSN(1)=$O(PSN50P68(50.68,PSN(1))) Q:'PSN(1)  D SETZRO
"RTN","PSN50P68",33,0)
 K ^TMP("DILIST",$J)
"RTN","PSN50P68",34,0)
 Q
"RTN","PSN50P68",35,0)
SETZRO ;
"RTN","PSN50P68",36,0)
 S ^TMP($J,LIST,+PSN(1),.01)=$G(PSN50P68(50.68,PSN(1),.01,"I"))
"RTN","PSN50P68",37,0)
 S ^TMP($J,LIST,"B",$G(PSN50P68(50.68,PSN(1),.01,"I")),+PSN(1))=""
"RTN","PSN50P68",38,0)
 S ^TMP($J,LIST,+PSN(1),.05)=$S($G(PSN50P68(50.68,PSN(1),.05,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),.05,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),.05,"E")))
"RTN","PSN50P68",39,0)
 S ^TMP($J,LIST,+PSN(1),3)=$S($G(PSN50P68(50.68,PSN(1),3,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),3,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),3,"E")))
"RTN","PSN50P68",40,0)
 S ^TMP($J,LIST,+PSN(1),4)=$G(PSN50P68(50.68,PSN(1),4,"I"))
"RTN","PSN50P68",41,0)
 S ^TMP($J,LIST,+PSN(1),11)=$G(PSN50P68(50.68,PSN(1),11,"I"))
"RTN","PSN50P68",42,0)
 S ^TMP($J,LIST,+PSN(1),12)=$G(PSN50P68(50.68,PSN(1),12,"I"))
"RTN","PSN50P68",43,0)
 S ^TMP($J,LIST,+PSN(1),13)=$G(PSN50P68(50.68,PSN(1),13,"I"))
"RTN","PSN50P68",44,0)
 S ^TMP($J,LIST,+PSN(1),19)=$S($G(PSN50P68(50.68,PSN(1),19,"I"))="":"",1:$G(PSN50P68(50.68,PSN(1),19,"I"))_"^"_$G(PSN50P68(50.68,PSN(1),19,"E")))
"RTN","PSN50P68",45,0)
 I $G(PSNSERVP) S ^TMP($J,LIST,+PSN(1),2000)=$S($G(PSN50P68(50.68,PSN(1),2000,"I"))'="":$G(PSN50P68(50.68,PSN(1),2000,"I")),1:600000)
"RTN","PSN50P68",46,0)
 Q
"RTN","PSN50P68",47,0)
 ;
"RTN","PSN50P68",48,0)
LOOP ;
"RTN","PSN50P68",49,0)
 N PSNIEN,CNT,PSN50DD1,PSN50DD2,PSN50DD3,PSN1NOD,PSNZNOD,PSN1NOD,PSN7FED
"RTN","PSN50P68",50,0)
 D FIELD^DID(50.68,19,"Z","POINTER","PSN50DD1","PSN50DD2") S PSN50DD3=$G(PSN50DD1("POINTER"))
"RTN","PSN50P68",51,0)
 S CNT=0
"RTN","PSN50P68",52,0)
 S PSNIEN=0 F  S PSNIEN=$O(^PSNDF(50.68,PSNIEN)) Q:'PSNIEN  D
"RTN","PSN50P68",53,0)
 .S PSNZNOD=$G(^PSNDF(50.68,PSNIEN,0)),PSN1NOD=$G(^(1)),PSN7FED=$P($G(^(7)),"^")
"RTN","PSN50P68",54,0)
 .I $P(PSNZNOD,"^")="" Q
"RTN","PSN50P68",55,0)
 .S CNT=CNT+1
"RTN","PSN50P68",56,0)
 .S ^TMP($J,LIST,PSNIEN,.01)=$P(PSNZNOD,"^")
"RTN","PSN50P68",57,0)
 .S ^TMP($J,LIST,"B",$P(PSNZNOD,"^"),PSNIEN)=""
"RTN","PSN50P68",58,0)
 .S ^TMP($J,LIST,PSNIEN,.05)=$S($P(PSNZNOD,"^",2)="":"",1:$P(PSNZNOD,"^",2)_"^"_$P($G(^PSNDF(50.6,+$P(PSNZNOD,"^",2),0)),"^"))
"RTN","PSN50P68",59,0)
 .S ^TMP($J,LIST,PSNIEN,3)=$S($P(PSNZNOD,"^",5)="":"",1:$P(PSNZNOD,"^",5)_"^"_$P($G(^PS(50.607,+$P(PSNZNOD,"^",5),0)),"^"))
"RTN","PSN50P68",60,0)
 .S ^TMP($J,LIST,PSNIEN,4)=$P(PSNZNOD,"^",6)
"RTN","PSN50P68",61,0)
 .S ^TMP($J,LIST,PSNIEN,11)=$P(PSN1NOD,"^",5)
"RTN","PSN50P68",62,0)
 .S ^TMP($J,LIST,PSNIEN,12)=$P(PSN1NOD,"^",6)
"RTN","PSN50P68",63,0)
 .S ^TMP($J,LIST,PSNIEN,13)=$P(PSN1NOD,"^",7)
"RTN","PSN50P68",64,0)
 .I PSN50DD3'="",PSN7FED'="",PSN50DD3[(PSN7FED_":") S ^TMP($J,LIST,PSNIEN,19)=PSN7FED_"^"_$P($E(PSN50DD3,$F(PSN50DD3,(PSN7FED_":")),999),";")
"RTN","PSN50P68",65,0)
 .I '$D(^TMP($J,LIST,PSNIEN,19)) S ^TMP($J,LIST,PSNIEN,19)=""
"RTN","PSN50P68",66,0)
 .I $G(PSNSERVP) S ^TMP($J,LIST,PSNIEN,2000)=$S($P($G(^PSNDF(50.68,PSNIEN,"PFS")),"^")'="":$P($G(^PSNDF(50.68,PSNIEN,"PFS")),"^"),1:600000)
"RTN","PSN50P68",67,0)
 S ^TMP($J,LIST,0)=$S(+CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSN50P68",68,0)
 Q
"RTN","PSNDI")
0^2^B7794023
"RTN","PSNDI",1,0)
PSNDI ;BIR/LDT - API FOR FILEMAN CALLS; 5 Sep 03
"RTN","PSNDI",2,0)
 ;;4.0; NATIONAL DRUG FILE;**80,109**; 30 Oct 98
"RTN","PSNDI",3,0)
 ;
"RTN","PSNDI",4,0)
DIC(PSNFILE,PSNPACK,DIC,X,DLAYGO,PSNSCRDT) ;
"RTN","PSNDI",5,0)
 S PSNDIY=""
"RTN","PSNDI",6,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",7,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",8,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",9,0)
 K DIC("S")
"RTN","PSNDI",10,0)
 I +$G(PSNSCRDT)>0 N PSNSUBSC,PSNPIECE D SCREEN
"RTN","PSNDI",11,0)
 I '$P(PSNRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSNDIY=-1
"RTN","PSNDI",12,0)
 D ^DIC
"RTN","PSNDI",13,0)
 Q
"RTN","PSNDI",14,0)
IX(PSNFILE,PSNPACK,DIC,D,X,DLAYGO,PSNSCRDT) ;
"RTN","PSNDI",15,0)
 S PSNDIY=""
"RTN","PSNDI",16,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",17,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",18,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",19,0)
 K DIC("S")
"RTN","PSNDI",20,0)
 I +$G(PSNSCRDT)>0 N PSNSUBSC,PSNPIECE D SCREEN
"RTN","PSNDI",21,0)
 I '$P(PSNRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSNDIY=-1
"RTN","PSNDI",22,0)
 D IX^DIC
"RTN","PSNDI",23,0)
 Q
"RTN","PSNDI",24,0)
DIE(PSNFILE,PSNPACK,DIE,DA,DR,DIDEL) ;
"RTN","PSNDI",25,0)
 S PSNDIY=""
"RTN","PSNDI",26,0)
 I +$G(PSNFILE)'>0 S PSNDIY=-1 Q
"RTN","PSNDI",27,0)
 N PSNRTEST S PSNRTEST=$$TEST(PSNFILE)
"RTN","PSNDI",28,0)
 I 'PSNRTEST S PSNDIY=-1 Q
"RTN","PSNDI",29,0)
 I '$P(PSNRTEST,"^",2) S PSNDIY=-1 Q
"RTN","PSNDI",30,0)
 D ^DIE
"RTN","PSNDI",31,0)
 Q
"RTN","PSNDI",32,0)
TEST(PSNTFILE) ;
"RTN","PSNDI",33,0)
 N CNT,PSNAPP2,PSNFFLAG,PSNFLOOP,PSNFTEST,PSNLNODE,PSNRSLT S PSNRSLT="0^0",PSNFFLAG=0
"RTN","PSNDI",34,0)
 F PSNFLOOP=1:1 S PSNFTEST=$P($T(FILE+PSNFLOOP),";;",2) Q:+$G(PSNFTEST)'>0!PSNFFLAG  I +PSNFTEST=PSNTFILE S $P(PSNRSLT,"^")=1 S PSNLNODE=$T(FILE+PSNFLOOP) D
"RTN","PSNDI",35,0)
 .F CNT=2:1:$L(PSNLNODE,";;") S PSNAPP2=$P(PSNLNODE,";;",CNT) Q:$P(PSNRSLT,"^",2)=1  I PSNAPP2=$G(PSNPACK) S PSNFFLAG=1,$P(PSNRSLT,"^",2)=1
"RTN","PSNDI",36,0)
 Q PSNRSLT
"RTN","PSNDI",37,0)
FILE ;Package listed if Write access (DLAYGO) is allowed
"RTN","PSNDI",38,0)
 ;;50.416;;PSN
"RTN","PSNDI",39,0)
 ;;50.605;;PSN
"RTN","PSNDI",40,0)
 ;;56;;PSO;;PSN
"RTN","PSNDI",41,0)
 ;;
"RTN","PSNDI",42,0)
 Q
"RTN","PSNDI",43,0)
 ;
"RTN","PSNDI",44,0)
FILE3 ;For Lookup calls, check for Inactive Date Screen
"RTN","PSNDI",45,0)
 ;;50.416;;2;;1
"RTN","PSNDI",46,0)
 ;;56;;0;;7
"RTN","PSNDI",47,0)
 ;;
"RTN","PSNDI",48,0)
 Q
"RTN","PSNDI",49,0)
SCREEN ;Set screen if Inactive Date is passed in, and for File 50, addition screen if Application Packages Use is passed in
"RTN","PSNDI",50,0)
 N PSNILOOP,PSNILOC,PSNINFLG,PSNINODE S PSNINFLG=0
"RTN","PSNDI",51,0)
 F PSNILOOP=1:1 S PSNILOC=$P($T(FILE3+PSNILOOP),";;",2) Q:+$G(PSNILOC)'>0!PSNINFLG  I +PSNILOC=PSNFILE S PSNINFLG=1 S PSNINODE=$T(FILE3+PSNILOOP) D
"RTN","PSNDI",52,0)
 .S PSNSUBSC=$P(PSNINODE,";;",3),PSNPIECE=$P(PSNINODE,";;",4)
"RTN","PSNDI",53,0)
 .I PSNSUBSC'="",PSNPIECE'="" S DIC("S")="I $P($G(^(PSNSUBSC)),""^"",PSNPIECE)=""""!(+$P($G(^(PSNSUBSC)),""^"",PSNPIECE)>+$G(PSNSCRDT))"
"RTN","PSNDI",54,0)
 Q
"VER")
8.0^22.0
"BLD",5845,6)
^96
**END**
**END**
