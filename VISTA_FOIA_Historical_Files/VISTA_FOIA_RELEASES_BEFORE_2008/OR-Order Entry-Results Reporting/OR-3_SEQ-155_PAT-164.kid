Released OR*3*164 SEQ #155
Extracted from mail message
**KIDS**:OR*3.0*164^

**INSTALL NAME**
OR*3.0*164
"BLD",4057,0)
OR*3.0*164^ORDER ENTRY/RESULTS REPORTING^0^3030121^y
"BLD",4057,4,0)
^9.64PA^101.43^1
"BLD",4057,4,101.43,0)
101.43
"BLD",4057,4,101.43,2,0)
^9.641^101.439^1
"BLD",4057,4,101.43,2,101.439,0)
SET MEMBERSHIP  (sub-file)
"BLD",4057,4,101.43,2,101.439,1,0)
^9.6411^2^1
"BLD",4057,4,101.43,2,101.439,1,2,0)
QO ONLY
"BLD",4057,4,101.43,222)
y^n^p^^^^n
"BLD",4057,4,"APDD",101.43,101.439)

"BLD",4057,4,"APDD",101.43,101.439,2)

"BLD",4057,4,"B",101.43,101.43)

"BLD",4057,"INI")
PRE^ORY164
"BLD",4057,"INIT")
POST^ORY164
"BLD",4057,"KRN",0)
^9.67PA^8989.52^19
"BLD",4057,"KRN",.4,0)
.4
"BLD",4057,"KRN",.401,0)
.401
"BLD",4057,"KRN",.402,0)
.402
"BLD",4057,"KRN",.403,0)
.403
"BLD",4057,"KRN",.5,0)
.5
"BLD",4057,"KRN",.84,0)
.84
"BLD",4057,"KRN",3.6,0)
3.6
"BLD",4057,"KRN",3.8,0)
3.8
"BLD",4057,"KRN",9.2,0)
9.2
"BLD",4057,"KRN",9.8,0)
9.8
"BLD",4057,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4057,"KRN",9.8,"NM",1,0)
ORDD43^^0^B34960268
"BLD",4057,"KRN",9.8,"NM",2,0)
ORWDX^^0^B71523789
"BLD",4057,"KRN",9.8,"NM",3,0)
ORWDOR^^0^B7232254
"BLD",4057,"KRN",9.8,"NM",4,0)
ORWUL^^0^B45218331
"BLD",4057,"KRN",9.8,"NM",5,0)
ORCMEDT6^^0^B25635065
"BLD",4057,"KRN",9.8,"NM","B","ORCMEDT6",5)

"BLD",4057,"KRN",9.8,"NM","B","ORDD43",1)

"BLD",4057,"KRN",9.8,"NM","B","ORWDOR",3)

"BLD",4057,"KRN",9.8,"NM","B","ORWDX",2)

"BLD",4057,"KRN",9.8,"NM","B","ORWUL",4)

"BLD",4057,"KRN",19,0)
19
"BLD",4057,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",4057,"KRN",19,"NM",1,0)
ORCM ORDERABLES^^0
"BLD",4057,"KRN",19,"NM",2,0)
ORCM QO ITEMS^^0
"BLD",4057,"KRN",19,"NM",3,0)
ORCM SEARCH/REPLACE ORDERABLES^^0
"BLD",4057,"KRN",19,"NM",4,0)
ORCM ORDERABLES MENU^^0
"BLD",4057,"KRN",19,"NM","B","ORCM ORDERABLES",1)

"BLD",4057,"KRN",19,"NM","B","ORCM ORDERABLES MENU",4)

"BLD",4057,"KRN",19,"NM","B","ORCM QO ITEMS",2)

"BLD",4057,"KRN",19,"NM","B","ORCM SEARCH/REPLACE ORDERABLES",3)

"BLD",4057,"KRN",19.1,0)
19.1
"BLD",4057,"KRN",101,0)
101
"BLD",4057,"KRN",409.61,0)
409.61
"BLD",4057,"KRN",771,0)
771
"BLD",4057,"KRN",870,0)
870
"BLD",4057,"KRN",8989.51,0)
8989.51
"BLD",4057,"KRN",8989.52,0)
8989.52
"BLD",4057,"KRN",8994,0)
8994
"BLD",4057,"KRN","B",.4,.4)

"BLD",4057,"KRN","B",.401,.401)

"BLD",4057,"KRN","B",.402,.402)

"BLD",4057,"KRN","B",.403,.403)

"BLD",4057,"KRN","B",.5,.5)

"BLD",4057,"KRN","B",.84,.84)

"BLD",4057,"KRN","B",3.6,3.6)

"BLD",4057,"KRN","B",3.8,3.8)

"BLD",4057,"KRN","B",9.2,9.2)

"BLD",4057,"KRN","B",9.8,9.8)

"BLD",4057,"KRN","B",19,19)

"BLD",4057,"KRN","B",19.1,19.1)

"BLD",4057,"KRN","B",101,101)

"BLD",4057,"KRN","B",409.61,409.61)

"BLD",4057,"KRN","B",771,771)

"BLD",4057,"KRN","B",870,870)

"BLD",4057,"KRN","B",8989.51,8989.51)

"BLD",4057,"KRN","B",8989.52,8989.52)

"BLD",4057,"KRN","B",8994,8994)

"BLD",4057,"QUES",0)
^9.62^^
"BLD",4057,"REQB",0)
^9.611^1^1
"BLD",4057,"REQB",1,0)
OR*3.0*141^2
"BLD",4057,"REQB","B","OR*3.0*141",1)

"FIA",101.43)
ORDERABLE ITEMS
"FIA",101.43,0)
^ORD(101.43,
"FIA",101.43,0,0)
101.43
"FIA",101.43,0,1)
y^n^p^^^^n
"FIA",101.43,0,10)

"FIA",101.43,0,11)

"FIA",101.43,0,"RLRO")

"FIA",101.43,0,"VR")
3.0^OR
"FIA",101.43,101.43)
1
"FIA",101.43,101.439)
1
"FIA",101.43,101.439,2)

"INI")
PRE^ORY164
"INIT")
POST^ORY164
"KRN",19,5469,-1)
0^1
"KRN",19,5469,0)
ORCM ORDERABLES^Enter/edit orderable items^^R^^^^^^^^^^
"KRN",19,5469,1,0)
^^2^2^2981104^^^^
"KRN",19,5469,1,1,0)
This option lets you create or change the things that are orderable via
"KRN",19,5469,1,2,0)
generic text orders at your site.
"KRN",19,5469,20)

"KRN",19,5469,25)
OI^ORCMEDT1
"KRN",19,5469,"U")
ENTER/EDIT ORDERABLE ITEMS
"KRN",19,9089,-1)
0^2
"KRN",19,9089,0)
ORCM QO ITEMS^Enter/edit QO restriction^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING^^
"KRN",19,9089,1,0)
^19.06^3^3^3021122^^
"KRN",19,9089,1,1,0)
This option allows a site to mark orderable items for use within pre-
"KRN",19,9089,1,2,0)
defined quick orders only; these items will not be selectable when
"KRN",19,9089,1,3,0)
ordering via standard package order dialogs.
"KRN",19,9089,20)

"KRN",19,9089,25)
QO^ORCMEDT6
"KRN",19,9089,"U")
ENTER/EDIT QO RESTRICTION
"KRN",19,9090,-1)
0^3
"KRN",19,9090,0)
ORCM SEARCH/REPLACE ORDERABLES^Search/replace orderables^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,9090,1,0)
^19.06^3^3^3021211^^
"KRN",19,9090,1,1,0)
This option lets you search for specific orderable items saved as
"KRN",19,9090,1,2,0)
responses within quick orders; a new orderable item may be selected
"KRN",19,9090,1,3,0)
to automatically replace it, as well.
"KRN",19,9090,25)
SEARCH^ORCMEDT6
"KRN",19,9090,"U")
SEARCH/REPLACE ORDERABLES
"KRN",19,9091,-1)
0^4
"KRN",19,9091,0)
ORCM ORDERABLES MENU^Manage orderable items^^M^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,9091,1,0)
^19.06^2^2^3021122^^
"KRN",19,9091,1,1,0)
This menu contains the options that facilitate entry and edit of
"KRN",19,9091,1,2,0)
orderable items for use in order dialogs and quick orders.
"KRN",19,9091,10,0)
^19.01IP^3^3
"KRN",19,9091,10,1,0)
5469^OI^1
"KRN",19,9091,10,1,"^")
ORCM ORDERABLES
"KRN",19,9091,10,2,0)
9089^QO^2
"KRN",19,9091,10,2,"^")
ORCM QO ITEMS
"KRN",19,9091,10,3,0)
9090^SR^3
"KRN",19,9091,10,3,"^")
ORCM SEARCH/REPLACE ORDERABLES
"KRN",19,9091,99)
59149,47534
"KRN",19,9091,"U")
MANAGE ORDERABLE ITEMS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
164^3030121^10
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","ORCMEDT6")
0^5^B25635065
"RTN","ORCMEDT6",1,0)
ORCMEDT6 ;SLC/MKB-QO editor utilities ;12/18/02  13:33
"RTN","ORCMEDT6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**164**;Dec 17, 1997
"RTN","ORCMEDT6",3,0)
 ;
"RTN","ORCMEDT6",4,0)
QO ; -- Enter/edit QO restriction on orderable items
"RTN","ORCMEDT6",5,0)
 N X,Y,DA,DR,DIE,ORIT,OLDVAL,OREBLD
"RTN","ORCMEDT6",6,0)
 F  S ORIT=$$OI("S.RX^S.LAB","Select an ORDERABLE ITEM (meds or labs only): ") Q:ORIT'>0  D  W !!
"RTN","ORCMEDT6",7,0)
 . W !!,"Select the type of usage for which you wish to restrict ordering of this item."
"RTN","ORCMEDT6",8,0)
 . F  S ORDG=$$SET(+ORIT) Q:"^"[ORDG  D
"RTN","ORCMEDT6",9,0)
 .. S DA(1)=+ORIT,DA=+$O(^ORD(101.43,+ORIT,9,"B",ORDG,0))
"RTN","ORCMEDT6",10,0)
 .. S OLDVAL=$G(^ORD(101.43,+ORIT,9,DA,0))
"RTN","ORCMEDT6",11,0)
 .. S DR=2,DIE="^ORD(101.43,"_DA(1)_",9," D ^DIE W !
"RTN","ORCMEDT6",12,0)
 .. I ORDG="O RX"!(ORDG="UD RX"),OLDVAL'=$G(^ORD(101.43,+ORIT,9,DA,0)) S OREBLD(ORDG)=1
"RTN","ORCMEDT6",13,0)
 F ORDG="O RX","UD RX" I $G(OREBLD(ORDG)) D FVBLDQ^ORWUL(ORDG)
"RTN","ORCMEDT6",14,0)
 Q
"RTN","ORCMEDT6",15,0)
 ;
"RTN","ORCMEDT6",16,0)
SET(OI) ; -- Returns Set Membership for OI
"RTN","ORCMEDT6",17,0)
 N X,Y,I,DOMAIN,NAME,HELP,DONE
"RTN","ORCMEDT6",18,0)
 S X="",I=0 F  S X=$O(^ORD(101.43,+OI,9,"B",X)) Q:X=""  S NAME=$$NAME(X),I=I+1,DOMAIN(I)=X_U_NAME,DOMAIN("B",NAME)=I
"RTN","ORCMEDT6",19,0)
 S DOMAIN(0)=I,HELP="Select the type of usage for which you wish to restrict ordering of this item."
"RTN","ORCMEDT6",20,0)
 S DONE=0,Y="" F  D  Q:DONE
"RTN","ORCMEDT6",21,0)
 . W !,"Usage: "
"RTN","ORCMEDT6",22,0)
 . R X:DTIME S:'$T X="^" I X["^" S Y="^",DONE=1 Q
"RTN","ORCMEDT6",23,0)
 . I X="" S Y="^",DONE=1 Q
"RTN","ORCMEDT6",24,0)
 . I X["?" W !!,HELP D LIST Q
"RTN","ORCMEDT6",25,0)
 . D  I 'Y W $C(7),!,HELP Q
"RTN","ORCMEDT6",26,0)
 . . N XP,XY,CNT,MATCH,DIR,I
"RTN","ORCMEDT6",27,0)
 . . S X=$$UP^XLFSTR(X),Y=+$G(DOMAIN("B",X)) Q:Y  ; done
"RTN","ORCMEDT6",28,0)
 . . S CNT=0,XP=X F  S XP=$O(DOMAIN("B",XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  S CNT=CNT+1,XY=+DOMAIN("B",XP),MATCH(CNT)=XY_U_$P(DOMAIN(XY),U,2)
"RTN","ORCMEDT6",29,0)
 . . Q:'CNT
"RTN","ORCMEDT6",30,0)
 . . I CNT=1 S Y=+MATCH(1),XP=$P(MATCH(1),U,2) W $E(XP,$L(X)+1,$L(XP)) Q
"RTN","ORCMEDT6",31,0)
 . . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCMEDT6",32,0)
 . . F I=1:1:CNT S DIR("A",I)=$J(I,3)_" "_$P(MATCH(I),U,2)
"RTN","ORCMEDT6",33,0)
 . . S DIR("?")="Select the desired value, by number"
"RTN","ORCMEDT6",34,0)
 . . D ^DIR I $D(DIRUT) S Y="" Q
"RTN","ORCMEDT6",35,0)
 . . S Y=+MATCH(Y) W "  "_$P(DOMAIN(Y),U,2)
"RTN","ORCMEDT6",36,0)
 . S Y=$P(DOMAIN(Y),U),DONE=1
"RTN","ORCMEDT6",37,0)
 Q Y
"RTN","ORCMEDT6",38,0)
 ;
"RTN","ORCMEDT6",39,0)
LIST ; -- List order statuses in DOMAIN
"RTN","ORCMEDT6",40,0)
 N I,Z,CNT,DONE
"RTN","ORCMEDT6",41,0)
 S CNT=0 W !,"Choose from:"
"RTN","ORCMEDT6",42,0)
 F I=1:1:DOMAIN(0) D  Q:$G(DONE)
"RTN","ORCMEDT6",43,0)
 . S CNT=CNT+1 W ! I CNT>(IOSL-3) D  Q:$G(DONE)
"RTN","ORCMEDT6",44,0)
 .. W ?3,"'^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1 S CNT=1
"RTN","ORCMEDT6",45,0)
 . W $C(13),"  "_$P(DOMAIN(I),U,2)
"RTN","ORCMEDT6",46,0)
 Q
"RTN","ORCMEDT6",47,0)
 ;
"RTN","ORCMEDT6",48,0)
NAME(X) ; -- Returns full name of set X
"RTN","ORCMEDT6",49,0)
 N Y,I S Y=$S(X="IVA RX":"IV ADDITIVES",X="IVB RX":"IV SOLUTIONS",X="IVM RX":"IV MEDICATIONS",1:"")
"RTN","ORCMEDT6",50,0)
 I Y="" S I=+$O(^ORD(100.98,"B",X,0)),Y=$S(I:$P($G(^ORD(100.98,I,0)),U),1:X)
"RTN","ORCMEDT6",51,0)
 Q Y
"RTN","ORCMEDT6",52,0)
 ;
"RTN","ORCMEDT6",53,0)
OI(IDX,CAPTION) ; -- Returns selected OI from file #101.43 using IDX xrefs
"RTN","ORCMEDT6",54,0)
 N X,Y,D,DIC,DTOUT,DUOUT,DIRUT,DIROUT,ORDIC
"RTN","ORCMEDT6",55,0)
 S DIC="^ORD(101.43,",DIC(0)="AEQS" S:$L($G(CAPTION)) DIC("A")=CAPTION
"RTN","ORCMEDT6",56,0)
 S DIC("W")="W:$S('$D(%):0,'$D(DIY):0,%=DIY:0,1:1) $G(DIY)"
"RTN","ORCMEDT6",57,0)
 S D=IDX,ORDIC="IX^DIC" S:$L(D,U)>1 ORDIC="MIX^DIC1",DIC(0)=DIC(0)_"M"
"RTN","ORCMEDT6",58,0)
 D @ORDIC
"RTN","ORCMEDT6",59,0)
 Q Y
"RTN","ORCMEDT6",60,0)
 ;
"RTN","ORCMEDT6",61,0)
OIB(CAPTION) ; -- Returns selected OI from file #101.43 using B xref
"RTN","ORCMEDT6",62,0)
 N X,Y,DIC,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORCMEDT6",63,0)
 S DIC="^ORD(101.43,",DIC(0)="AEQ"
"RTN","ORCMEDT6",64,0)
 S:$L($G(CAPTION)) DIC("A")=CAPTION
"RTN","ORCMEDT6",65,0)
 D ^DIC
"RTN","ORCMEDT6",66,0)
 Q Y
"RTN","ORCMEDT6",67,0)
 ;
"RTN","ORCMEDT6",68,0)
SEARCH ; -- Search/replace orderables in QO responses
"RTN","ORCMEDT6",69,0)
 N I,ORP,ORIT
"RTN","ORCMEDT6",70,0)
 S I=0 F  S I=$O(^ORD(101.41,I)) Q:I<1  I $P($G(^(I,0)),U,4)="P",$P($G(^(1)),U)="P",+$P($G(^(1)),U,2)=101.43 S ORP(I)="" ;OI prompts
"RTN","ORCMEDT6",71,0)
 F  S ORIT=$$OIB("Search for: ") Q:ORIT<1  D SR1 W !!
"RTN","ORCMEDT6",72,0)
 Q
"RTN","ORCMEDT6",73,0)
 ;
"RTN","ORCMEDT6",74,0)
SR1 ; -- list QO's & Dlgs where ORIT is used, get replacement
"RTN","ORCMEDT6",75,0)
 N I,X,ORDAD,ORDG,ORY,ORNMBR,NUM,DA,ORNM,TYPE,SET
"RTN","ORCMEDT6",76,0)
 D FIND(ORIT,.ORDAD) I ORDAD<1 W !,$P(ORIT,U,2)_" is not used by any quick orders or dialogs." Q
"RTN","ORCMEDT6",77,0)
 W @IOF,"Quick Orders and Dialogs containing "_$P(ORIT,U,2),!,$$REPEAT^XLFSTR("-",79)
"RTN","ORCMEDT6",78,0)
 S I=0 F  S I=$O(ORDAD(I)) Q:I'>0  D
"RTN","ORCMEDT6",79,0)
 . S X=+ORDAD(I) W !,I,?4,$P(^ORD(101.41,X,0),U)
"RTN","ORCMEDT6",80,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","ORCMEDT6",81,0)
 S ORDG=+$P($G(^ORD(101.43,+ORIT,0)),U,5),ORDG=$P($G(^ORD(100.98,ORDG,0)),U,3)
"RTN","ORCMEDT6",82,0)
 S ORY=$$OI("S."_ORDG,"Replace with: ") Q:ORY<1
"RTN","ORCMEDT6",83,0)
 D SELECT(ORDAD,.ORNMBR) Q:ORNMBR="^"
"RTN","ORCMEDT6",84,0)
 Q:'$$OK  W !!,"Replacing "_$P(ORIT,U,2)_" with "_$P(ORY,U,2)_" in:"
"RTN","ORCMEDT6",85,0)
 F I=1:1:$L(ORNMBR,",") S NUM=$P(ORNMBR,",",I) I NUM D
"RTN","ORCMEDT6",86,0)
 . S DA(1)=+ORDAD(NUM),DA=$P(ORDAD(NUM),U,2),SET=$P(ORDAD(NUM),U,3)
"RTN","ORCMEDT6",87,0)
 . S ORNM=$P(^ORD(101.41,DA(1),0),U),TYPE=$P($G(^(0)),U,4)
"RTN","ORCMEDT6",88,0)
 . I '$O(^ORD(101.43,+ORY,9,"B",SET,0)) W !?3,ORNM_" canceled: item invalid for this dialog." Q
"RTN","ORCMEDT6",89,0)
 . I TYPE="Q" S ^ORD(101.41,DA(1),6,DA,1)=+ORY
"RTN","ORCMEDT6",90,0)
 . I TYPE="D" S ^ORD(101.41,DA(1),10,DA,7)="S Y="_+ORY
"RTN","ORCMEDT6",91,0)
 . W !?3,ORNM_" ...done."
"RTN","ORCMEDT6",92,0)
 Q
"RTN","ORCMEDT6",93,0)
 ;
"RTN","ORCMEDT6",94,0)
FIND(X,QO) ; -- Find QO's, Dlg's that use ord item X
"RTN","ORCMEDT6",95,0)
 N IFN,P,TYPE,NODE,DEF,DA,DLG,PRMT,SET S IFN=0,QO=0
"RTN","ORCMEDT6",96,0)
 F  S IFN=+$O(^ORD(101.41,IFN)) Q:IFN<1  S TYPE=$P($G(^(IFN,0)),U,4) D
"RTN","ORCMEDT6",97,0)
 . S NODE=$S(TYPE="Q":6,TYPE="D":10,1:0) Q:'NODE
"RTN","ORCMEDT6",98,0)
 . S P=0 F  S P=$O(ORP(P)) Q:P<1  S DA=$O(^ORD(101.41,IFN,NODE,"D",P,0)) I DA D
"RTN","ORCMEDT6",99,0)
 .. I TYPE="Q" Q:+$G(^ORD(101.41,IFN,6,DA,1))'=+X  S DLG=$$DEFDLG^ORCD(IFN),PRMT=+$O(^ORD(101.41,DLG,10,"D",P,0))
"RTN","ORCMEDT6",100,0)
 .. I TYPE="D" S DEF=$G(^ORD(101.41,IFN,10,DA,7)) Q:DEF'?1"S Y=".E  S DEF=$P(DEF,"=",2) S:$E(DEF)="""" DEF=$P(DEF,"""",2) Q:+DEF'=+X  S DLG=IFN,PRMT=DA
"RTN","ORCMEDT6",101,0)
 .. S SET=$P($G(^ORD(101.41,DLG,10,PRMT,0)),U,10),SET=$P($P(SET,";"),".",2)
"RTN","ORCMEDT6",102,0)
 .. S QO=QO+1,QO(QO)=IFN_U_DA_U_SET
"RTN","ORCMEDT6",103,0)
 Q
"RTN","ORCMEDT6",104,0)
 ;
"RTN","ORCMEDT6",105,0)
SELECT(MAX,Y) ; -- Select which QOs to replace Ord Item
"RTN","ORCMEDT6",106,0)
 N X,DIR
"RTN","ORCMEDT6",107,0)
 S DIR(0)="LA^1:"_MAX,DIR("A")="Replace in: ",DIR("B")=$S(MAX>1:"1-"_MAX,1:"1")
"RTN","ORCMEDT6",108,0)
 ; S DIR("?")
"RTN","ORCMEDT6",109,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMEDT6",110,0)
 Q
"RTN","ORCMEDT6",111,0)
 ;
"RTN","ORCMEDT6",112,0)
OK() ; -- Are you ready?
"RTN","ORCMEDT6",113,0)
 N X,Y,DIR
"RTN","ORCMEDT6",114,0)
 S DIR(0)="YA",DIR("A")="Are you ready? ",DIR("B")="NO"
"RTN","ORCMEDT6",115,0)
 W ! D ^DIR
"RTN","ORCMEDT6",116,0)
 Q +Y
"RTN","ORDD43")
0^1^B34960268
"RTN","ORDD43",1,0)
ORDD43 ; SLC/MKB - Build xrefs for file 101.43 ;7/2/97  10:52
"RTN","ORDD43",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,68,94,164**;Dec 17, 1997
"RTN","ORDD43",3,0)
 ;
"RTN","ORDD43",4,0)
SET(X,IFN) ; Create new entry X in SET multiple
"RTN","ORDD43",5,0)
 N DIC,DA,Y Q:$D(^ORD(101.43,IFN,9,"B",X))  ; already exists
"RTN","ORDD43",6,0)
 S DIC="^ORD(101.43,"_IFN_",9,",DIC(0)="L",DA(1)=IFN
"RTN","ORDD43",7,0)
 S DIC("P")=$P(^DD(101.43,9,0),U,2) K DD,DO
"RTN","ORDD43",8,0)
 S ^ORD(101.43,"AH",X)=$H
"RTN","ORDD43",9,0)
 D FILE^DICN
"RTN","ORDD43",10,0)
 Q
"RTN","ORDD43",11,0)
 ;
"RTN","ORDD43",12,0)
KILL(X,IFN) ; Remove entry X from SET multiple
"RTN","ORDD43",13,0)
 N DIK,DA
"RTN","ORDD43",14,0)
 S DIK="^ORD(101.43,"_IFN_",9,",DA(1)=IFN
"RTN","ORDD43",15,0)
 S ^ORD(101.43,"AH",X)=$H
"RTN","ORDD43",16,0)
 S DA=$O(^ORD(101.43,IFN,9,"B",X,0)) I DA D ^DIK
"RTN","ORDD43",17,0)
 Q
"RTN","ORDD43",18,0)
 ;
"RTN","ORDD43",19,0)
SETRA(NAME,ITYPE,CPROC) ; Set COMMON xref
"RTN","ORDD43",20,0)
 Q:'CPROC  Q:'$L(ITYPE)  ; not common, no IType
"RTN","ORDD43",21,0)
 S ^ORD(101.43,"COMMON",ITYPE,NAME,DA)=""
"RTN","ORDD43",22,0)
 Q
"RTN","ORDD43",23,0)
 ;
"RTN","ORDD43",24,0)
KILLRA(NAME,ITYPE,CPROC) ; Kill COMMON xref
"RTN","ORDD43",25,0)
 Q:'CPROC  Q:'$L(ITYPE)  ; not common, no IType
"RTN","ORDD43",26,0)
 K ^ORD(101.43,"COMMON",ITYPE,NAME,DA)
"RTN","ORDD43",27,0)
 Q
"RTN","ORDD43",28,0)
 ;
"RTN","ORDD43",29,0)
SS(NAME,DATE,LABTYP) ; -- Set S.SET xref by Name, Set multiple
"RTN","ORDD43",30,0)
 Q:'$L($G(NAME))  I ($G(LABTYP)="O")!($G(LABTYP)="N") D SK(NAME) Q
"RTN","ORDD43",31,0)
 N SET,SET0,SETNM,SETLST,QO
"RTN","ORDD43",32,0)
 S SET=0 F  S SET=$O(^ORD(101.43,DA,9,SET)) Q:SET'>0  S SET0=$G(^(SET,0)) D
"RTN","ORDD43",33,0)
 . S SETNM=$P(SET0,U),QO=$P(SET0,U,2)
"RTN","ORDD43",34,0)
 . S ^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(NAME),DA)=U_NAME_U_$G(DATE)_U_U_QO
"RTN","ORDD43",35,0)
 . S ^ORD(101.43,"AH","S."_SETNM)=$H,SETLST("S."_SETNM)=""
"RTN","ORDD43",36,0)
 I $G(DATE),(DATE>$$NOW^XLFDT) D
"RTN","ORDD43",37,0)
 . N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","ORDD43",38,0)
 . S ZTRTN="DQAH^ORDD43",ZTDESC="CPRS AH Update",ZTDTH=DATE,ZTIO=""
"RTN","ORDD43",39,0)
 . S ZTSAVE("SETLST(")="" D ^%ZTLOAD
"RTN","ORDD43",40,0)
 Q
"RTN","ORDD43",41,0)
DQAH ; -- set new timestamps for sets where items are becoming inactive
"RTN","ORDD43",42,0)
 S ZTREQ="@"
"RTN","ORDD43",43,0)
 N X
"RTN","ORDD43",44,0)
 S X="" F  S X=$O(SETLST(X)) Q:X=""  S ^ORD(101.43,"AH",X)=$H
"RTN","ORDD43",45,0)
 Q
"RTN","ORDD43",46,0)
 ;
"RTN","ORDD43",47,0)
SK(NAME) ; -- Kill S.SET xref by Name, Set multiple
"RTN","ORDD43",48,0)
 Q:'$L($G(NAME))  N SET,SETNM
"RTN","ORDD43",49,0)
 S SET=0 F  S SET=$O(^ORD(101.43,DA,9,SET)) Q:SET'>0  S SETNM=$P(^(SET,0),U) D
"RTN","ORDD43",50,0)
 . K ^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(NAME),DA)
"RTN","ORDD43",51,0)
 . S ^ORD(101.43,"AH","S."_SETNM)=$H
"RTN","ORDD43",52,0)
 Q
"RTN","ORDD43",53,0)
 ;
"RTN","ORDD43",54,0)
SS1(NAME,DATE,LABTYP) ; -- Set S.SET mnemonic xref by Synonym, Name, Set
"RTN","ORDD43",55,0)
 Q:'$L($G(NAME))  I ($G(LABTYP)="O")!($G(LABTYP)="N") D SK1(NAME) Q
"RTN","ORDD43",56,0)
 N SYN,SYNM,SET,SET0,SETNM,QO
"RTN","ORDD43",57,0)
 S SET=0 F  S SET=$O(^ORD(101.43,DA,9,SET)) Q:SET'>0  S SET0=$G(^(SET,0)) D
"RTN","ORDD43",58,0)
 . S SETNM=$P(SET0,U),QO=$P(SET0,U,2)
"RTN","ORDD43",59,0)
 . S SYN=0 F  S SYN=$O(^ORD(101.43,DA,2,SYN)) Q:SYN'>0  S SYNM=$P(^(SYN,0),U) D
"RTN","ORDD43",60,0)
 . . S:SYNM'=NAME ^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(SYNM),DA)="1^"_SYNM_U_$G(DATE)_U_NAME_U_QO
"RTN","ORDD43",61,0)
 . . S ^ORD(101.43,"AH","S."_SETNM)=$H
"RTN","ORDD43",62,0)
 Q
"RTN","ORDD43",63,0)
 ;
"RTN","ORDD43",64,0)
SK1(NAME) ; -- Kill S.SET mnemonic xref by Synonym, Name, Set
"RTN","ORDD43",65,0)
 N SYN,SYNM,SET,SETNM
"RTN","ORDD43",66,0)
 S SET=0 F  S SET=$O(^ORD(101.43,DA,9,SET)) Q:SET'>0  S SETNM=$P(^(SET,0),U) D
"RTN","ORDD43",67,0)
 . S SYN=0 F  S SYN=$O(^ORD(101.43,DA,2,SYN)) Q:SYN'>0  S SYNM=$P(^(SYN,0),U) D
"RTN","ORDD43",68,0)
 . . I $G(^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(SYNM),DA)) K ^(DA)
"RTN","ORDD43",69,0)
 . . S ^ORD(101.43,"AH","S."_SETNM)=$H
"RTN","ORDD43",70,0)
 Q
"RTN","ORDD43",71,0)
 ;
"RTN","ORDD43",72,0)
SS2 ; -- Set S.SET mnemonic xref from SET multiple
"RTN","ORDD43",73,0)
 N TYP,NAME,DATE,SYN,SYNM,I,QO
"RTN","ORDD43",74,0)
 S TYP=$P($G(^ORD(101.43,DA(1),"LR")),U,7) I (TYP="O")!(TYP="N") D SK2 Q
"RTN","ORDD43",75,0)
 S I=+$O(^ORD(101.43,DA(1),9,"B",X,0))
"RTN","ORDD43",76,0)
 S QO=$P($G(^ORD(101.43,DA(1),9,I,0)),U,2)
"RTN","ORDD43",77,0)
 S SYN=0,NAME=$P(^ORD(101.43,DA(1),0),U),DATE=$G(^(.1))
"RTN","ORDD43",78,0)
 F  S SYN=$O(^ORD(101.43,DA(1),2,SYN)) Q:SYN'>0  S SYNM=$P(^(SYN,0),U) D
"RTN","ORDD43",79,0)
 . S:SYNM'=NAME ^ORD(101.43,"S."_X,$$UP^XLFSTR(SYNM),DA(1))="1^"_SYNM_U_DATE_U_NAME_U_QO
"RTN","ORDD43",80,0)
 . S ^ORD(101.43,"AH","S."_X)=$H
"RTN","ORDD43",81,0)
 Q
"RTN","ORDD43",82,0)
 ;
"RTN","ORDD43",83,0)
SK2 ; -- Kill S.SET mnemonic xref from SET multiple
"RTN","ORDD43",84,0)
 N SYN,SYNM
"RTN","ORDD43",85,0)
 S SYN=0 F  S SYN=$O(^ORD(101.43,DA(1),2,SYN)) Q:SYN'>0  S SYNM=$P(^(SYN,0),U) D
"RTN","ORDD43",86,0)
 . I $G(^ORD(101.43,"S."_X,$$UP^XLFSTR(SYNM),DA(1))) K ^(DA(1))
"RTN","ORDD43",87,0)
 . S ^ORD(101.43,"AH","S."_X)=$H
"RTN","ORDD43",88,0)
 Q
"RTN","ORDD43",89,0)
 ;
"RTN","ORDD43",90,0)
SS3 ; -- Set S.SET mnemonic xref from SYN multiple
"RTN","ORDD43",91,0)
 N TYP,NAME,DATE,SET,SET0,SETNM,QO
"RTN","ORDD43",92,0)
 S TYP=$P($G(^ORD(101.43,DA(1),"LR")),U,7) I (TYP="O")!(TYP="N") D SK3 Q
"RTN","ORDD43",93,0)
 S NAME=$P(^ORD(101.43,DA(1),0),U),DATE=$G(^(.1)),SET=0 Q:X=NAME
"RTN","ORDD43",94,0)
 F  S SET=$O(^ORD(101.43,DA(1),9,SET)) Q:SET'>0  S SET0=$G(^(SET,0)) D
"RTN","ORDD43",95,0)
 . S SETNM=$P(SET0,U),QO=$P(SET0,U,2)
"RTN","ORDD43",96,0)
 . S ^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(X),DA(1))="1^"_X_U_DATE_U_NAME_U_QO
"RTN","ORDD43",97,0)
 . S ^ORD(101.43,"AH","S."_SETNM)=$H
"RTN","ORDD43",98,0)
 Q
"RTN","ORDD43",99,0)
 ;
"RTN","ORDD43",100,0)
SK3 ; -- Kill S.SET mnemonic xref from SYN multiple
"RTN","ORDD43",101,0)
 N SET,SETNM
"RTN","ORDD43",102,0)
 S SET=0 F  S SET=$O(^ORD(101.43,DA(1),9,SET)) Q:SET'>0  S SETNM=$P(^(SET,0),U) D
"RTN","ORDD43",103,0)
 . I $G(^ORD(101.43,"S."_SETNM,$$UP^XLFSTR(X),DA(1))) K ^(DA(1))
"RTN","ORDD43",104,0)
 . S ^ORD(101.43,"AH","S."_SETNM)=$H
"RTN","ORDD43",105,0)
 Q
"RTN","ORDD43",106,0)
 ;
"RTN","ORDD43",107,0)
CS(NAME,CODE,DATE) ; -- Set C.SET xref by 'Code Name', Set
"RTN","ORDD43",108,0)
 Q:'$L($G(NAME))  Q:'$L($G(CODE))
"RTN","ORDD43",109,0)
 N X,XP,ORS,SET0,SETNM,QO
"RTN","ORDD43",110,0)
 S X=CODE_" "_NAME,XP=$$UP^XLFSTR(X)
"RTN","ORDD43",111,0)
 S ORS=0 F  S ORS=$O(^ORD(101.43,DA,9,ORS)) Q:ORS'>0  S SET0=$G(^(ORS,0)) D
"RTN","ORDD43",112,0)
 . S SETNM=$P(SET0,U),QO=$P(SET0,U,2)
"RTN","ORDD43",113,0)
 . S ^ORD(101.43,"C."_SETNM,XP,DA)=U_X_U_$G(DATE)_U_U_QO
"RTN","ORDD43",114,0)
 Q
"RTN","ORDD43",115,0)
 ;
"RTN","ORDD43",116,0)
CK(NAME,CODE) ; -- Kill C.SET xref
"RTN","ORDD43",117,0)
 Q:'$L($G(NAME))  Q:'$L($G(CODE))
"RTN","ORDD43",118,0)
 N XP,ORS,ORSET S XP=$$UP^XLFSTR(CODE_" "_NAME)
"RTN","ORDD43",119,0)
 S ORS=0 F  S ORS=$O(^ORD(101.43,DA,9,ORS)) Q:ORS'>0  S ORSET=$P(^(ORS,0),U) K ^ORD(101.43,"C."_ORSET,XP,DA)
"RTN","ORDD43",120,0)
 Q
"RTN","ORDD43",121,0)
 ;
"RTN","ORDD43",122,0)
QO(X) ; -- Add data to SET xrefs, set/kill AQO xref
"RTN","ORDD43",123,0)
 N NAME,XREF,SYN,SYNM S X=$G(X)
"RTN","ORDD43",124,0)
 S NAME=$$UP^XLFSTR($P($G(^ORD(101.43,DA(1),0)),U)),XREF="S."_$P($G(^(9,DA,0)),U)
"RTN","ORDD43",125,0)
 S:X ^ORD(101.43,DA(1),9,"AQO",XREF)=""
"RTN","ORDD43",126,0)
 K:'X ^ORD(101.43,DA(1),9,"AQO",XREF)
"RTN","ORDD43",127,0)
 Q:'$D(^ORD(101.43,XREF,NAME,DA(1)))  S $P(^(DA(1)),U,5)=X
"RTN","ORDD43",128,0)
 S SYN=0 F  S SYN=+$O(^ORD(101.43,DA(1),2,SYN)) Q:SYN<1  S SYNM=$P($G(^(SYN,0)),U),$P(^ORD(101.43,XREF,$$UP^XLFSTR(SYNM),DA(1)),U,5)=X
"RTN","ORDD43",129,0)
 S ^ORD(101.43,"AH",XREF)=$H
"RTN","ORDD43",130,0)
 Q
"RTN","ORDD43",131,0)
 ;
"RTN","ORDD43",132,0)
XHELP(INDEX,SCREEN) ; -- ??Help
"RTN","ORDD43",133,0)
 N X,Y,Y0,Z,SYN,CNT,D,DONE
"RTN","ORDD43",134,0)
 S:'$L($G(INDEX)) INDEX="B" W !!,"Choose from:" S CNT=1,D=INDEX
"RTN","ORDD43",135,0)
 S X="" F  S X=$O(^ORD(101.43,INDEX,X)) Q:X=""  S Y=0 D  Q:$G(DONE)
"RTN","ORDD43",136,0)
 . F  S Y=$O(^ORD(101.43,INDEX,X,Y)) Q:Y'>0  S SYN=$G(^(Y)) I 'SYN D  Q:$G(DONE)
"RTN","ORDD43",137,0)
 . . S Y0=$G(^ORD(101.43,Y,0)) X:$L($G(SCREEN)) SCREEN Q:'$T
"RTN","ORDD43",138,0)
 . . W !,"   "_X ;W:SYN "     "_$P(SYN,U,4) ; echo .01 if synonym
"RTN","ORDD43",139,0)
 . . S CNT=CNT+1 Q:CNT'>(IOSL-5)  S CNT=0
"RTN","ORDD43",140,0)
 . . W !,"   '^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1
"RTN","ORDD43",141,0)
 W !
"RTN","ORDD43",142,0)
 Q
"RTN","ORDD43",143,0)
 ;
"RTN","ORDD43",144,0)
ACTIVE(ITM) ; -- Screen, if inactive or restricted to QO use only
"RTN","ORDD43",145,0)
 ;        Use in DIC("S") when searching #101.43
"RTN","ORDD43",146,0)
 N Y S Y=1
"RTN","ORDD43",147,0)
 I $G(ORTYPE)="D",$L($G(D)),$D(^ORD(101.43,+ITM,9,"AQO",$P(D,U))) S Y=0
"RTN","ORDD43",148,0)
 I $G(^ORD(101.43,+ITM,.1)),^(.1)'>$$NOW^XLFDT S Y=0  ;inactive
"RTN","ORDD43",149,0)
 Q Y
"RTN","ORDD43",150,0)
 ;
"RTN","ORDD43",151,0)
ID(OLD,NEW) ; -- API for package to update ID field [ code;99XXX ]
"RTN","ORDD43",152,0)
 ;    Returns 1 or 0, if successful or not
"RTN","ORDD43",153,0)
 N IFN,Y S Y=0
"RTN","ORDD43",154,0)
 G:'$G(OLD) IDQ G:$G(NEW)'?1.N1";99"3U IDQ ;invalid
"RTN","ORDD43",155,0)
 S IFN=+$O(^ORD(101.43,"ID",OLD,0)) G:IFN'>0 IDQ
"RTN","ORDD43",156,0)
 K ^ORD(101.43,"ID",OLD,IFN)
"RTN","ORDD43",157,0)
 S $P(^ORD(101.43,IFN,0),U,2)=NEW,^ORD(101.43,"ID",NEW,IFN)="",Y=1
"RTN","ORDD43",158,0)
IDQ Q Y
"RTN","ORWDOR")
0^3^B7232254
"RTN","ORWDOR",1,0)
ORWDOR ; SLC/KCM - Generic Orders calls for Windows Dialogs [ 08/05/96  8:21 AM ];03:50 PM  17 Jun 1998
"RTN","ORWDOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,164**;Dec 17, 1997
"RTN","ORWDOR",3,0)
NXT() ; -- returns next available index in return data array
"RTN","ORWDOR",4,0)
 S ILST=ILST+1
"RTN","ORWDOR",5,0)
 Q ILST
"RTN","ORWDOR",6,0)
 ;
"RTN","ORWDOR",7,0)
VMSLCT(LST) ; return default lists for vitals dialog
"RTN","ORWDOR",8,0)
 N ILST S ILST=0
"RTN","ORWDOR",9,0)
 S LST($$NXT)="~Measurements" D MEAS
"RTN","ORWDOR",10,0)
 S LST($$NXT)="~Schedules"    D SCHED
"RTN","ORWDOR",11,0)
 Q
"RTN","ORWDOR",12,0)
MEAS ; called from VMSLCT
"RTN","ORWDOR",13,0)
 N I,X
"RTN","ORWDOR",14,0)
 S X="" F  S X=$O(^ORD(101.43,"S.V/M",X)) Q:X=""  D
"RTN","ORWDOR",15,0)
 . S I=$O(^ORD(101.43,"S.V/M",X,0))
"RTN","ORWDOR",16,0)
 . S LST($$NXT)="i"_I_U_$P(^ORD(101.43,"S.V/M",X,I),U,2)
"RTN","ORWDOR",17,0)
 Q
"RTN","ORWDOR",18,0)
SCHED ; called from VMSLCT
"RTN","ORWDOR",19,0)
 N I,X
"RTN","ORWDOR",20,0)
 S X="" F  S X=$O(^PS(51.1,"APGMRV",X)) Q:X=""  D
"RTN","ORWDOR",21,0)
 . S I=$O(^PS(51.1,"APGMRV",X,0)),LST($$NXT)="i"_I_U_X
"RTN","ORWDOR",22,0)
 Q
"RTN","ORWDOR",23,0)
VALNUM(ERR,X,DOM)       ; return error if invalid number
"RTN","ORWDOR",24,0)
 N LOW,HIGH,DEC
"RTN","ORWDOR",25,0)
 S LOW=$P(DOM,":"),HIGH=$P(DOM,":",2),DEC=$P(DOM,":",3),ERR=0
"RTN","ORWDOR",26,0)
 I $L($P(X,"."))>24 S ERR="1^Exceeded maximum number of characters" Q
"RTN","ORWDOR",27,0)
 I X'?.1"-".N.1".".N S ERR="1^Entry must be numeric" Q
"RTN","ORWDOR",28,0)
 I X>HIGH!(X<LOW) S ERR="1^Out of Range" Q
"RTN","ORWDOR",29,0)
 I $L($P(+X,".",2))>DEC S ERR="1^Too many decimal places" Q
"RTN","ORWDOR",30,0)
 Q
"RTN","ORWDOR",31,0)
LKSCRN(ORLST,FROM,DIR,REF,GBL,SCR) ; Return a set of entries from xref in REF
"RTN","ORWDOR",32,0)
 ; .Y=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWDOR",33,0)
 ; REF=subscript indirection global ref including xref,
"RTN","ORWDOR",34,0)
 ; GBL=standard FM global ref, SCR=reference to screen in 101.41
"RTN","ORWDOR",35,0)
 N I,IEN,CNT,X,Y,D,ORTYPE
"RTN","ORWDOR",36,0)
 S I=0,CNT=44,SCR=$G(SCR)
"RTN","ORWDOR",37,0)
 I $L(SCR) S SCR=$G(^ORD(101.41,+SCR,10,+$P(SCR,":",2),4))
"RTN","ORWDOR",38,0)
 S D=$P(REF,"""",2),ORTYPE="D" ;for OI screen
"RTN","ORWDOR",39,0)
 F  Q:I'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWDOR",40,0)
 . S IEN=0 F  S IEN=$O(@REF@(FROM,IEN)) Q:'IEN  D
"RTN","ORWDOR",41,0)
 . . ; if screen, set naked ref & Y, then execute screen
"RTN","ORWDOR",42,0)
 . . I $L(SCR) S Y=IEN,X=$P($G(@(GBL_"Y,0)")),U) X SCR Q:'$T
"RTN","ORWDOR",43,0)
 . . S I=I+1,ORLST(I)=IEN_"^"_FROM
"RTN","ORWDOR",44,0)
 Q
"RTN","ORWDOR",45,0)
MNUTREE(LST,ROOT)        ; return menu tree for a menu type dialog
"RTN","ORWDOR",46,0)
 N ILST S ILST=0
"RTN","ORWDOR",47,0)
 S ILST=ILST+1,LST(ILST)=ROOT_U_$P(^ORD(101.41,ROOT,0),U,2)_"^0^+"
"RTN","ORWDOR",48,0)
 D LSTCHLD(ROOT)
"RTN","ORWDOR",49,0)
 Q
"RTN","ORWDOR",50,0)
LSTCHLD(PARENT) ; list descendends of this node (recursive)
"RTN","ORWDOR",51,0)
 N CHILD,I
"RTN","ORWDOR",52,0)
 S I=0 F  S I=$O(^ORD(101.41,PARENT,10,"B",I)) Q:'I  D
"RTN","ORWDOR",53,0)
 . S J=0 F  S J=$O(^ORD(101.41,PARENT,10,"B",I,J)) Q:'J  D
"RTN","ORWDOR",54,0)
 . . S CHILD=+$P(^ORD(101.41,PARENT,10,J,0),U,2) Q:'CHILD
"RTN","ORWDOR",55,0)
 . . ; also quit if child is not a generic order
"RTN","ORWDOR",56,0)
 . . S ILST=ILST+1,LST(ILST)=CHILD_U_$P(^ORD(101.41,CHILD,0),U,2)_U_PARENT
"RTN","ORWDOR",57,0)
 . . I $P(^ORD(101.41,CHILD,0),U,4)="M",$D(^ORD(101.41,CHILD,10))>1 D
"RTN","ORWDOR",58,0)
 . . . S LST(ILST)=LST(ILST)_"^+"
"RTN","ORWDOR",59,0)
 . . . D LSTCHLD(CHILD)
"RTN","ORWDOR",60,0)
 Q
"RTN","ORWDX")
0^2^B71523789
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dailog utilities ;10/31/02  10:51 [11/4/02 1:52pm]
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164**;Dec 17, 1997
"RTN","ORWDX",3,0)
NXT() ; -- Gets index in array
"RTN","ORWDX",4,0)
 S ILST=ILST+1
"RTN","ORWDX",5,0)
 Q ILST
"RTN","ORWDX",6,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",7,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",8,0)
 N I,IEN,CNT,X,DTXT,CURTM
"RTN","ORWDX",9,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",10,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",11,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",12,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",13,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",14,0)
 . . Q:$P(X,U,5)  S I=I+1
"RTN","ORWDX",15,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",16,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",17,0)
 Q
"RTN","ORWDX",18,0)
ODITMBC(Y,XREF,ODLST) ; --Info based on Orderable ItemIen
"RTN","ORWDX",19,0)
 N CNT,NM,XRF
"RTN","ORWDX",20,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",21,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",22,0)
 Q
"RTN","ORWDX",23,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",24,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX",25,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX",26,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX",27,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX",28,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORWDX",29,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX",30,0)
 .. I ODI=ODIEN D
"RTN","ORWDX",31,0)
 ... S NM=NM+1
"RTN","ORWDX",32,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX",33,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX",34,0)
 Q
"RTN","ORWDX",35,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",36,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX",37,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",38,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",39,0)
 Q:'DLG
"RTN","ORWDX",40,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX",41,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX",42,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX",43,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX",44,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX",45,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX",46,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX",47,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX",48,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX",49,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX",50,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX",51,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX",52,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX",53,0)
 Q
"RTN","ORWDX",54,0)
DLGQUIK(LST,QO) ; Responses for quick order  (NOT USED)
"RTN","ORWDX",55,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",56,0)
 Q
"RTN","ORWDX",57,0)
LOADRSP(LST,RSPID)      ; Load responses from 101.41 or 100
"RTN","ORWDX",58,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",59,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",60,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT S ROOT=""
"RTN","ORWDX",61,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT
"RTN","ORWDX",62,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT
"RTN","ORWDX",63,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT
"RTN","ORWDX",64,0)
 Q:ROOT=""
"RTN","ORWDX",65,0)
XROOT S (ILST,I)=0 F  S I=$O(@ROOT@(I)) Q:I'>0  D
"RTN","ORWDX",66,0)
 . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDX",67,0)
 . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)
"RTN","ORWDX",68,0)
 . I '$L(ID) S ID="ID"_DLG
"RTN","ORWDX",69,0)
 . S VAL=$G(@ROOT@(I,1))
"RTN","ORWDX",70,0)
 . I $P($G(^ORD(101.41,DLG,0)),U)="OR GTX ADDITIVE" S ID="ADDITIVE"
"RTN","ORWDX",71,0)
 . I $E(RSPID)="C",(ID="START"),VAL Q  ; skip literal start time on copy
"RTN","ORWDX",72,0)
 . S LST($$NXT)="~"_DLG_U_INST_U_ID
"RTN","ORWDX",73,0)
 . I $L(VAL) D
"RTN","ORWDX",74,0)
 .. S LST($$NXT)="i"_VAL,LST($$NXT)="e"_$$EXTVAL(VAL,DLG)
"RTN","ORWDX",75,0)
 . I $D(@ROOT@(I,2))>1 D
"RTN","ORWDX",76,0)
 .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D
"RTN","ORWDX",77,0)
 ... S LST($$NXT)="t"_$G(@ROOT@(I,2,J,0))
"RTN","ORWDX",78,0)
 I $E(ROOT,1,4)="^TMP" K ^TMP("ORWDXMQ",$J)
"RTN","ORWDX",79,0)
 Q
"RTN","ORWDX",80,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA) ;
"RTN","ORWDX",81,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",82,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog,
"RTN","ORWDX",83,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",84,0)
 S ORCATFN=""
"RTN","ORWDX",85,0)
 I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",86,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",87,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",88,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",89,0)
 I $L($G(OREVENT)) D
"RTN","ORWDX",90,0)
 . S ONPASS=0
"RTN","ORWDX",91,0)
 . S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",92,0)
 . I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",93,0)
 . S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",94,0)
 E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",95,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",96,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",97,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",98,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",99,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",100,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",101,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",102,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",103,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",104,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",105,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",106,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",107,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",108,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",109,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",110,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",111,0)
 I $G(ORWP94) D
"RTN","ORWDX",112,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",113,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",114,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",115,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",116,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",117,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",118,0)
 . D EN^ORCSAVE
"RTN","ORWDX",119,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",120,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",121,0)
 E  D
"RTN","ORWDX",122,0)
 . N OR0
"RTN","ORWDX",123,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",124,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",125,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",126,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",127,0)
 Q
"RTN","ORWDX",128,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",129,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN
"RTN","ORWDX",130,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",131,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D
"RTN","ORWDX",132,0)
 . S ORIFN=ORIENS(ORIX)
"RTN","ORWDX",133,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",134,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",135,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",136,0)
 .. S ORSIGST=$P($G(^(0)),U,4)
"RTN","ORWDX",137,0)
 .. S ORNATURE=$P($G(^(0)),U,12)
"RTN","ORWDX",138,0)
 . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",139,0)
 . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",140,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",141,0)
 . I OK D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX))
"RTN","ORWDX",142,0)
 . S ORWLST(ORIX)=ORIENS(ORIX)
"RTN","ORWDX",143,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",144,0)
 . E  D
"RTN","ORWDX",145,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",146,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",147,0)
 . S X="RS"
"RTN","ORWDX",148,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",149,0)
 Q
"RTN","ORWDX",150,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",151,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",152,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",153,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X
"RTN","ORWDX",154,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",155,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0))
"RTN","ORWDX",156,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",157,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",158,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",159,0)
 . S ORBEF=0
"RTN","ORWDX",160,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",161,0)
 . S ORWNATR=$S($P(^(0),"^",4)=3:"",1:ORWNATR) ;If order doesn't require signature leave nature at electronic --added with patch 110
"RTN","ORWDX",162,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",163,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",164,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",165,0)
 .. I $P(^OR(100,+ORDERID,0),U,14)=ORLR,'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",166,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",167,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",168,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",169,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",170,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",171,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",172,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",173,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",174,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",175,0)
 Q
"RTN","ORWDX",176,0)
EXTVAL(IVAL,DLG) ; External value given a dlg ptr
"RTN","ORWDX",177,0)
 N ORDIALOG
"RTN","ORWDX",178,0)
 S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)
"RTN","ORWDX",179,0)
 S ORDIALOG(DLG,1)=IVAL
"RTN","ORWDX",180,0)
 I $E(ORDIALOG(DLG,0))="R",(+IVAL'=IVAL) Q IVAL  ; free text date/time
"RTN","ORWDX",181,0)
 Q $$EXT^ORCD(DLG,1)  ; all others
"RTN","ORWDX",182,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",183,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",184,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",185,0)
 Q
"RTN","ORWDX",186,0)
FORMID(VAL,ORIFN)  ; Base dlg FormID for an order
"RTN","ORWDX",187,0)
 N DLG
"RTN","ORWDX",188,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",189,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",190,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",191,0)
 Q
"RTN","ORWDX",192,0)
AGAIN(VAL,DLG)  ; return true to keep dlg for another order
"RTN","ORWDX",193,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",194,0)
 Q
"RTN","ORWDX",195,0)
DGRP(VAL,DLG)   ; Display grp pointer for a dlg
"RTN","ORWDX",196,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",197,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",198,0)
 Q
"RTN","ORWDX",199,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",200,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",201,0)
 Q
"RTN","ORWDX",202,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",203,0)
 G WRLST1^ORWDX1 ;moved to new routine
"RTN","ORWDX",204,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",205,0)
 N I
"RTN","ORWDX",206,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",207,0)
 Q
"RTN","ORWDX",208,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",209,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",210,0)
 Q
"RTN","ORWDX",211,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",212,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",213,0)
 Q
"RTN","ORWDX",214,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",215,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",216,0)
 Q
"RTN","ORWDX",217,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",218,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",219,0)
 Q
"RTN","ORWDX",220,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",221,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",222,0)
 Q
"RTN","ORWUL")
0^4^B45218331
"RTN","ORWUL",1,0)
ORWUL ; SLC/KCM/JLI - Listview Selection ;1/25/02  14:09 [2/4/02 12:23pm] 4/9/02 4:15PM
"RTN","ORWUL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,117,131,132,164**;Dec 17, 1997
"RTN","ORWUL",3,0)
 ;
"RTN","ORWUL",4,0)
QV4DG(VAL,DGRP) ; return the quick order list, given a display group name
"RTN","ORWUL",5,0)
 N NM
"RTN","ORWUL",6,0)
 S VAL="0^0"
"RTN","ORWUL",7,0)
 I 'DGRP S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWUL",8,0)
 S NM=$$GET^XPAR("ALL","ORWDQ QUICK VIEW",DGRP,"I")
"RTN","ORWUL",9,0)
 Q:'$L(NM)
"RTN","ORWUL",10,0)
 D QV4NM(.VAL,NM)
"RTN","ORWUL",11,0)
 Q
"RTN","ORWUL",12,0)
QV4NM(VAL,QVNAM)       ; return the current quick list and item count
"RTN","ORWUL",13,0)
 ; VAL: ListIEN^ItemCount
"RTN","ORWUL",14,0)
 N J,CNT ;117
"RTN","ORWUL",15,0)
 S VAL=+$O(^ORD(101.44,"B",QVNAM,0))
"RTN","ORWUL",16,0)
 S (J,CNT)=0 F  S J=$O(^ORD(101.44,VAL,10,J)) Q:'+J  I '$$QODIS(VAL,J) S CNT=CNT+1 ;117
"RTN","ORWUL",17,0)
 S $P(VAL,U,2)=CNT ;117
"RTN","ORWUL",18,0)
 Q
"RTN","ORWUL",19,0)
QVSUB(LST,IEN,FIRST,LAST)       ; return subset of orders in view
"RTN","ORWUL",20,0)
 N I,J,ID ;117
"RTN","ORWUL",21,0)
 I $L(FIRST),$L(LAST) D
"RTN","ORWUL",22,0)
 . F I=+FIRST:1:+LAST D
"RTN","ORWUL",23,0)
 .. I $D(^ORD(101.44,IEN,10,I,0))>0 D
"RTN","ORWUL",24,0)
 ... I '$$QODIS(IEN,I) S LST(I)=^ORD(101.44,IEN,10,I,0)
"RTN","ORWUL",25,0)
 E  D
"RTN","ORWUL",26,0)
 . S (I,J)=0 F  S I=$O(^ORD(101.44,IEN,10,I)) Q:'+I  I '$$QODIS(IEN,I) S J=J+1,LST(J)=^ORD(101.44,IEN,10,I,0) ;117
"RTN","ORWUL",27,0)
 Q
"RTN","ORWUL",28,0)
QODIS(IEN,SUB) ;Determines if personal quick order is disabled
"RTN","ORWUL",29,0)
 ;returns 1 if it is else 0.  This section added with patch 117
"RTN","ORWUL",30,0)
 I $P($G(^ORD(101.41,+$P($G(^ORD(101.44,IEN,10,SUB,0)),"^"),0)),"^",3)'="" Q 1
"RTN","ORWUL",31,0)
 Q 0
"RTN","ORWUL",32,0)
QVIDX(VAL,IEN,FROM)     ; return index of item beginning with FROM
"RTN","ORWUL",33,0)
 N I,X
"RTN","ORWUL",34,0)
 S VAL=0
"RTN","ORWUL",35,0)
 S X=$O(^ORD(101.44,IEN,10,"C",FROM))
"RTN","ORWUL",36,0)
 I '$L(X) Q
"RTN","ORWUL",37,0)
 S I=$O(^ORD(101.44,IEN,10,"C",X,0))
"RTN","ORWUL",38,0)
 Q:'I
"RTN","ORWUL",39,0)
 S:'$$QODIS(IEN,I) VAL=+I_U_X
"RTN","ORWUL",40,0)
 Q
"RTN","ORWUL",41,0)
FV4DG(VAL,DGNM)       ; return the current full list & item count
"RTN","ORWUL",42,0)
 S VAL=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",43,0)
 I 'VAL D
"RTN","ORWUL",44,0)
 . N UPDTIME,ATTEMPT
"RTN","ORWUL",45,0)
 . S UPDTIME=$G(^ORD(101.43,"AH","S."_DGNM)),ATTEMPT=0
"RTN","ORWUL",46,0)
 . I UPDTIME="" S UPDTIME=$H,^ORD(101.43,"AH","S."_DGNM)=UPDTIME
"RTN","ORWUL",47,0)
 . D FVBLD
"RTN","ORWUL",48,0)
 . S VAL=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",49,0)
 I ($P(^ORD(101.44,+VAL,0),U,6)'=$G(^ORD(101.43,"AH","S."_DGNM))) D
"RTN","ORWUL",50,0)
 . ; -- see if a task is already queued to rebuild this
"RTN","ORWUL",51,0)
 . L +^XTMP("ORWDSET "_DGNM):2 E  Q
"RTN","ORWUL",52,0)
 . N ZTSK S ZTSK=+$G(^XTMP("ORWDSET "_DGNM,"TASK"))
"RTN","ORWUL",53,0)
 . I ZTSK D ISQED^%ZTLOAD S ZTSK=+ZTSK(0)
"RTN","ORWUL",54,0)
 . I ZTSK L -^XTMP("ORWDSET "_DGNM) Q
"RTN","ORWUL",55,0)
 . ; -- create a task to rebuild the list
"RTN","ORWUL",56,0)
 . D FVBLDQ(DGNM)
"RTN","ORWUL",57,0)
 . L -^TMP("ORWDSET "_DGNM)
"RTN","ORWUL",58,0)
 S $P(VAL,U,2)=$P($G(^ORD(101.44,+VAL,20,0)),U,4)
"RTN","ORWUL",59,0)
 Q
"RTN","ORWUL",60,0)
FVSUB(LST,IEN,FIRST,LAST)       ; return subset of orders in view
"RTN","ORWUL",61,0)
 N I
"RTN","ORWUL",62,0)
 F I=FIRST:1:LAST S LST(I)=^ORD(101.44,IEN,20,I,0)
"RTN","ORWUL",63,0)
 Q
"RTN","ORWUL",64,0)
FVIDX(VAL,IEN,FROM)     ; return index of item beginning with FROM
"RTN","ORWUL",65,0)
 N I,X
"RTN","ORWUL",66,0)
 S VAL=0
"RTN","ORWUL",67,0)
 S X=$O(^ORD(101.44,IEN,20,"C",FROM))
"RTN","ORWUL",68,0)
 I '$L(X) Q
"RTN","ORWUL",69,0)
 S I=$O(^ORD(101.44,IEN,20,"C",X,0))
"RTN","ORWUL",70,0)
 Q:'I
"RTN","ORWUL",71,0)
 S VAL=+I_U_X
"RTN","ORWUL",72,0)
 Q
"RTN","ORWUL",73,0)
FVBLDQ(DGNM,ATTEMPT)    ; queue rebuild of set
"RTN","ORWUL",74,0)
 N ZTRTN,ZTIO,ZTDTH,ZTSAVE,ZTDESC,ZTUCI,ZTCPU,ZTPRI,ZTKIL,ZTSYNC,ZTSK
"RTN","ORWUL",75,0)
 N UPDTIME S UPDTIME=$G(^ORD(101.43,"AH","S."_DGNM))
"RTN","ORWUL",76,0)
 I '$G(UPDTIME) S UPDTIME=$H,^ORD(101.43,"AH","S."_DGNM)=UPDTIME
"RTN","ORWUL",77,0)
 S ATTEMPT=$G(ATTEMPT)+1
"RTN","ORWUL",78,0)
 S ZTRTN="FVBLD^ORWUL",ZTIO="",ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,0,0,2)
"RTN","ORWUL",79,0)
 S ZTSAVE("ATTEMPT")="",ZTSAVE("UPDTIME")="",ZTSAVE("DGNM")=""
"RTN","ORWUL",80,0)
 S ZTDESC="Rebuild quick view for "_DGNM
"RTN","ORWUL",81,0)
 D ^%ZTLOAD
"RTN","ORWUL",82,0)
 S ^XTMP("ORWDSET "_DGNM,0)=$$FMADD^XLFDT($$NOW^XLFDT,2)
"RTN","ORWUL",83,0)
 S ^XTMP("ORWDSET "_DGNM,"TASK")=ZTSK
"RTN","ORWUL",84,0)
 Q
"RTN","ORWUL",85,0)
FVBLD ; rebuild an ORWSET entry
"RTN","ORWUL",86,0)
 ; ATTEMPT, UPDTIME, DGNM expected in environment
"RTN","ORWUL",87,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWUL",88,0)
 I $D(ZTQUEUED),(ATTEMPT<20),(UPDTIME'=$G(^ORD(101.43,"AH","S."_DGNM))) D FVBLDQ(DGNM,ATTEMPT) Q 
"RTN","ORWUL",89,0)
 ; -- create new entry in 101.44 for the set
"RTN","ORWUL",90,0)
 N FDA,FDAIEN,LVW,ADDL
"RTN","ORWUL",91,0)
 S FDA(101.44,"+1,",.01)="ORWDNEW "_DGNM
"RTN","ORWUL",92,0)
 S FDA(101.44,"+1,",6)=UPDTIME
"RTN","ORWUL",93,0)
 D UPDATE^DIE("","FDA","FDAIEN")
"RTN","ORWUL",94,0)
 S LVW=+FDAIEN(1) I 'LVW G FVBLDX
"RTN","ORWUL",95,0)
 ; -- copy all the active items into the list multiple
"RTN","ORWUL",96,0)
 N ASET,SEQ,NM,OI,INACT,CURTM,NMLST,X,Y
"RTN","ORWUL",97,0)
 S ASET="S."_DGNM,SEQ=0,CURTM=$$NOW^XLFDT
"RTN","ORWUL",98,0)
 K ^ORD(101.44,LVW,20)
"RTN","ORWUL",99,0)
 S ^ORD(101.44,LVW,20,0)="^101.442PA"
"RTN","ORWUL",100,0)
 S NM="" F  S NM=$O(^ORD(101.43,ASET,NM)) Q:NM=""  D
"RTN","ORWUL",101,0)
 . K NMLST
"RTN","ORWUL",102,0)
 . S OI=0 F  S OI=$O(^ORD(101.43,ASET,NM,OI)) Q:'OI  D
"RTN","ORWUL",103,0)
 . . S X=^ORD(101.43,ASET,NM,OI),INACT=$P(X,U,3)
"RTN","ORWUL",104,0)
 . . Q:$P(X,U,5)  I INACT,CURTM>INACT Q
"RTN","ORWUL",105,0)
 . . I 'X S ADDL=""
"RTN","ORWUL",106,0)
 . . E    S ADDL="     <"_$P(X,U,4)_">"
"RTN","ORWUL",107,0)
 . . I $P($G(^ORD(101.43,OI,"PS")),U,6) S ADDL=ADDL_"     NF"
"RTN","ORWUL",108,0)
 . . S NMLST($P(X,U,2)_ADDL,OI)=""
"RTN","ORWUL",109,0)
 . I '$D(NMLST) Q
"RTN","ORWUL",110,0)
 . S X="" F  S X=$O(NMLST(X)) Q:X=""  D
"RTN","ORWUL",111,0)
 . . S Y=0 F  S Y=$O(NMLST(X,Y)) Q:'Y  D
"RTN","ORWUL",112,0)
 . . . S SEQ=SEQ+1
"RTN","ORWUL",113,0)
 . . . S ^ORD(101.44,LVW,20,SEQ,0)=Y_U_X
"RTN","ORWUL",114,0)
 . . . S ^ORD(101.44,LVW,20,"C",$$UP^XLFSTR(X),SEQ)=""
"RTN","ORWUL",115,0)
 S ^ORD(101.44,LVW,20,0)="^101.442PA^"_SEQ_U_SEQ
"RTN","ORWUL",116,0)
 ; -- switch the names of the entries (SET->OLD, NEW->SET)
"RTN","ORWUL",117,0)
 L +^ORD(101.44,"ORWDSET "_DGNM):60
"RTN","ORWUL",118,0)
 S IEN=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",119,0)
 I IEN K FDA S FDA(101.44,IEN_",",.01)="ORWDOLD "_$H
"RTN","ORWUL",120,0)
 D FILE^DIE("","FDA")
"RTN","ORWUL",121,0)
 K FDA S FDA(101.44,LVW_",",.01)="ORWDSET "_DGNM
"RTN","ORWUL",122,0)
 D FILE^DIE("","FDA")
"RTN","ORWUL",123,0)
 L -^ORD(101.44,"ORWDSET "_DGNM)
"RTN","ORWUL",124,0)
FVBLDX ; -- clean up ^XTMP node
"RTN","ORWUL",125,0)
 K ^XTMP("ORWDSET "_DGNM)
"RTN","ORWUL",126,0)
 D FVCLN
"RTN","ORWUL",127,0)
 Q
"RTN","ORWUL",128,0)
FVCLN ; clean up old set-type entries in the 101.44
"RTN","ORWUL",129,0)
 N LNM,DIK,DA
"RTN","ORWUL",130,0)
 S LNM="ORWDOLD",DIK="^ORD(101.44,"
"RTN","ORWUL",131,0)
 F  S LNM=$O(^ORD(101.44,"B",LNM)) Q:$E(LNM,1,7)'="ORWDOLD"  D
"RTN","ORWUL",132,0)
 . I ($H-$P(LNM," ",2))<2 Q  ; wait until entry is 2 days old
"RTN","ORWUL",133,0)
 . S DA=0 F  S DA=$O(^ORD(101.44,"B",LNM,DA)) Q:'DA  D ^DIK
"RTN","ORWUL",134,0)
 Q
"RTN","ORWUL",135,0)
QVSAVE(LVW,X,QLST)       ; Save a quick order list
"RTN","ORWUL",136,0)
 ;    X:  Name of List
"RTN","ORWUL",137,0)
 ; QLST: Ptr101.41^DisplayName
"RTN","ORWUL",138,0)
 N DIC,DA,DLAYGO,Y,LVW,SEQ,I
"RTN","ORWUL",139,0)
 S DIC="^ORD(101.44,",DIC(0)="L",DLAYGO=101.44,LVW=0
"RTN","ORWUL",140,0)
 D ^DIC Q:'Y
"RTN","ORWUL",141,0)
 S LVW=+Y,SEQ=0
"RTN","ORWUL",142,0)
 K ^ORD(101.44,LVW,10)
"RTN","ORWUL",143,0)
 S ^ORD(101.44,LVW,10,0)="^101.441PA"
"RTN","ORWUL",144,0)
 S I=0  F  S I=$O(QLST(I)) Q:'I  D
"RTN","ORWUL",145,0)
 . S SEQ=SEQ+1,^ORD(101.44,LVW,10,SEQ,0)=QLST(I)
"RTN","ORWUL",146,0)
 . S ^ORD(101.44,LVW,10,"C",$$UP^XLFSTR($P(QLST(I),U,2)),SEQ)=""
"RTN","ORWUL",147,0)
 S ^ORD(101.44,LVW,10,0)="^101.441PA^"_SEQ_U_SEQ
"RTN","ORWUL",148,0)
 Q
"RTN","ORWUL",149,0)
MVRX ; move pharmacy quick orders into 101.44
"RTN","ORWUL",150,0)
 D MVQO("O RX")
"RTN","ORWUL",151,0)
 D MVQO("UD RX")
"RTN","ORWUL",152,0)
 Q
"RTN","ORWUL",153,0)
MVALL ; move all quick order lists into 101.44
"RTN","ORWUL",154,0)
 Q:$E($O(^ORD(101.44,"B","ORWDQ")),1,5)="ORWDQ"
"RTN","ORWUL",155,0)
 N SNM
"RTN","ORWUL",156,0)
 D BMES^XPDUTL("Moving personal quick orders into 101.44")
"RTN","ORWUL",157,0)
 F SNM="ANI","CARD","CSLT","CT","DO","IV RX","LAB","MAM","MRI","NM","O RX","PROC","RAD","TF","UD RX","US","VAS","XRAY" D
"RTN","ORWUL",158,0)
 . D MES^XPDUTL("-- moving: "_SNM)
"RTN","ORWUL",159,0)
 . D MVQO(SNM)
"RTN","ORWUL",160,0)
 Q
"RTN","ORWUL",161,0)
MVQO(DGNM)      ; move quick orders
"RTN","ORWUL",162,0)
 N ENT,PAR,TLST,QLST,DLG,X,X0,I,NOP,DNM
"RTN","ORWUL",163,0)
 S PAR=$O(^XTV(8989.51,"B","ORWDQ "_DGNM,0))
"RTN","ORWUL",164,0)
 S ENT="" F  S ENT=$O(^XTV(8989.5,"AC",PAR,ENT)) Q:'ENT  D
"RTN","ORWUL",165,0)
 . K TLST,QLST D GETLST^XPAR(.TLST,ENT,PAR,"I")
"RTN","ORWUL",166,0)
 . S I=0 F  S I=$O(TLST(I)) Q:'I  D
"RTN","ORWUL",167,0)
 . . S DLG=+TLST(I) Q:'DLG
"RTN","ORWUL",168,0)
 . . S X0=$G(^ORD(101.41,DLG,0)) Q:'$L(X0)
"RTN","ORWUL",169,0)
 . . S DNM=$$GET^XPAR(ENT,"ORWDQ DISPLAY NAME",DLG,"I")
"RTN","ORWUL",170,0)
 . . I '$L(DNM) S DNM=$P(^ORD(101.41,DLG,0),U,2)
"RTN","ORWUL",171,0)
 . . S QLST(I)=DLG_U_DNM
"RTN","ORWUL",172,0)
 . S X=$O(^XTV(8989.51,PAR,30,"AG",$P(ENT,";",2),0))
"RTN","ORWUL",173,0)
 . S X=$P(^XTV(8989.51,PAR,30,X,0),U,2)
"RTN","ORWUL",174,0)
 . S X=$P(^XTV(8989.518,X,0),U,2)
"RTN","ORWUL",175,0)
 . S X="ORWDQ "_X_$P(ENT,";")_" "_DGNM
"RTN","ORWUL",176,0)
 . D QVSAVE(.NOP,X,.QLST)
"RTN","ORWUL",177,0)
 . D EN^XPAR(ENT,"ORWDQ QUICK VIEW",DGNM,X)
"RTN","ORWUL",178,0)
 . ; D NDEL^XPAR(ENT,PAR) ; -- add later, after sure about conversion
"RTN","ORWUL",179,0)
 Q
"RTN","ORWUL",180,0)
ZCLEAN ; cleanup ORWDQ entries in Quick View file
"RTN","ORWUL",181,0)
 N ANAM,ANIEN,DIK,DA
"RTN","ORWUL",182,0)
 S ANAM="ORWDQ",DIK="^ORD(101.44,"
"RTN","ORWUL",183,0)
 F  S ANAM=$O(^ORD(101.44,"B",ANAM)) Q:$E(ANAM,1,5)'="ORWDQ"  D
"RTN","ORWUL",184,0)
 . W !,"deleting "_ANAM
"RTN","ORWUL",185,0)
 . S ANIEN=$O(^ORD(101.44,"B",ANAM,0))
"RTN","ORWUL",186,0)
 . S DA=ANIEN D ^DIK
"RTN","ORWUL",187,0)
 W !,"rebuilding entries"
"RTN","ORWUL",188,0)
 D MVALL
"RTN","ORWUL",189,0)
 Q
"RTN","ORY164")
0^^B3517171
"RTN","ORY164",1,0)
ORY164 ;SLC/MKB - Postinit for OR*3*164
"RTN","ORY164",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**164**;Dec 17, 1997
"RTN","ORY164",3,0)
 ;
"RTN","ORY164",4,0)
PRE ; -- preinit
"RTN","ORY164",5,0)
 N ORY,ORERR D FIELD^DID(101.439,2,,"LABEL","ORY","ORERR")
"RTN","ORY164",6,0)
 I '$L($G(ORY("LABEL"))) S ^TMP("OR164",$J)=1 ;first install
"RTN","ORY164",7,0)
 Q
"RTN","ORY164",8,0)
 ;
"RTN","ORY164",9,0)
POST ; -- postinit
"RTN","ORY164",10,0)
 N X,Y,DIC,DIE,DR,DA,ORCM
"RTN","ORY164",11,0)
 S DIC="^DIC(19,",DIC(0)="",X="ORCM MGMT" D ^DIC I Y S ORCM=+Y D
"RTN","ORY164",12,0)
 . S DIC="^DIC(19,"_ORCM_",10,",DIC(0)="",X="ORCM ORDERABLES"
"RTN","ORY164",13,0)
 . D ^DIC Q:Y<1
"RTN","ORY164",14,0)
 . S DR=".01///^S X=""ORCM ORDERABLES MENU"""
"RTN","ORY164",15,0)
 . S DA(1)=ORCM,DA=+Y,DIE=DIC D ^DIE
"RTN","ORY164",16,0)
 Q:'$G(^TMP("OR164",$J))
"RTN","ORY164",17,0)
P1 ;convert OI Screens on first install only
"RTN","ORY164",18,0)
 N I,ORDLG,ORP,ORDA,ORS,Z,NEWSCR
"RTN","ORY164",19,0)
 S I=0 F  S I=$O(^ORD(101.41,I)) Q:I<1  I $P($G(^(I,0)),U,4)="P",$P($G(^(1)),U)="P",+$P(^(1),U,2)=101.43 S ORP(I)=""
"RTN","ORY164",20,0)
 S ORDLG=0 F  S ORDLG=+$O(^ORD(101.41,ORDLG)) Q:ORDLG<1  I $P($G(^(ORDLG,0)),U,4)="D" D
"RTN","ORY164",21,0)
 . S I=0 F  S I=$O(ORP(I)) Q:I<1  S ORDA=+$O(^ORD(101.41,ORDLG,10,"D",I,0)) I ORDA D
"RTN","ORY164",22,0)
 .. S ORS=$G(^ORD(101.41,ORDLG,10,ORDA,4))
"RTN","ORY164",23,0)
 .. I '$L(ORS) S ^ORD(101.41,ORDLG,10,ORDA,4)="I $$ACTIVE^ORDD43(Y)" Q
"RTN","ORY164",24,0)
 .. S Z=$F(ORS,"'$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)") ;$L=34
"RTN","ORY164",25,0)
 .. I Z S NEWSCR=$E(ORS,1,(Z-35))_"$$ACTIVE^ORDD43(Y)"_$E(ORS,Z,999),^ORD(101.41,ORDLG,10,ORDA,4)=NEWSCR Q
"RTN","ORY164",26,0)
 .. I ORS?1"I ".E S ^ORD(101.41,ORDLG,10,ORDA,4)="I $$ACTIVE^ORDD43(Y),"_$E(ORS,3,999) Q
"RTN","ORY164",27,0)
 K ^TMP("OR164",$J)
"RTN","ORY164",28,0)
 Q
"UP",101.43,101.439,-1)
101.43^9
"UP",101.43,101.439,0)
101.439
"VER")
8.0^22.0
"^DD",101.43,101.439,2,0)
QO ONLY^S^1:YES;^0;2^Q
"^DD",101.43,101.439,2,1,0)
^.1
"^DD",101.43,101.439,2,1,1,0)
101.43^AQO^MUMPS
"^DD",101.43,101.439,2,1,1,1)
D QO^ORDD43(X)
"^DD",101.43,101.439,2,1,1,2)
D QO^ORDD43("")
"^DD",101.43,101.439,2,1,1,"%D",0)
^^3^3^3021106^
"^DD",101.43,101.439,2,1,1,"%D",1,0)
This index adds data to the 5th piece of the "S.xxx" xrefs to tell CPRS
"^DD",101.43,101.439,2,1,1,"%D",2,0)
GUI whether or not to allow this item to be selectable in the regular
"^DD",101.43,101.439,2,1,1,"%D",3,0)
order dialog for the set, or if it should be orderable via quick orders.
"^DD",101.43,101.439,2,1,1,"DT")
3021106
"^DD",101.43,101.439,2,3)
Enter YES if this item should only be orderable via quick orders.
"^DD",101.43,101.439,2,21,0)
^^2^2^3021106^
"^DD",101.43,101.439,2,21,1,0)
This field determines if the item may be ordered via the regular order
"^DD",101.43,101.439,2,21,2,0)
dialog for this Set, or only via predefined quick orders.
"^DD",101.43,101.439,2,"DT")
3021106
**END**
**END**
