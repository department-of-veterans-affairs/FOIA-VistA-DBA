Released PSB*3*19 SEQ #12
Extracted from mail message
**KIDS**:PSB*3.0*19^

**INSTALL NAME**
PSB*3.0*19
"BLD",6303,0)
PSB*3.0*19^BAR CODE MED ADMIN^0^3051115^y
"BLD",6303,1,0)
^^1^1^3051115^
"BLD",6303,1,1,0)
Unable to mark a patch as removed
"BLD",6303,4,0)
^9.64PA^^
"BLD",6303,"KRN",0)
^9.67PA^8989.52^19
"BLD",6303,"KRN",.4,0)
.4
"BLD",6303,"KRN",.401,0)
.401
"BLD",6303,"KRN",.402,0)
.402
"BLD",6303,"KRN",.403,0)
.403
"BLD",6303,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",6303,"KRN",.403,"NM",1,0)
PSB NEW UD ENTRY    FILE #53.79^53.79^0
"BLD",6303,"KRN",.403,"NM","B","PSB NEW UD ENTRY    FILE #53.79",1)

"BLD",6303,"KRN",.5,0)
.5
"BLD",6303,"KRN",.84,0)
.84
"BLD",6303,"KRN",3.6,0)
3.6
"BLD",6303,"KRN",3.8,0)
3.8
"BLD",6303,"KRN",9.2,0)
9.2
"BLD",6303,"KRN",9.8,0)
9.8
"BLD",6303,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6303,"KRN",9.8,"NM",1,0)
PSBMLEN^^0^71915409
"BLD",6303,"KRN",9.8,"NM","B","PSBMLEN",1)

"BLD",6303,"KRN",19,0)
19
"BLD",6303,"KRN",19.1,0)
19.1
"BLD",6303,"KRN",101,0)
101
"BLD",6303,"KRN",409.61,0)
409.61
"BLD",6303,"KRN",771,0)
771
"BLD",6303,"KRN",870,0)
870
"BLD",6303,"KRN",8989.51,0)
8989.51
"BLD",6303,"KRN",8989.52,0)
8989.52
"BLD",6303,"KRN",8994,0)
8994
"BLD",6303,"KRN","B",.4,.4)

"BLD",6303,"KRN","B",.401,.401)

"BLD",6303,"KRN","B",.402,.402)

"BLD",6303,"KRN","B",.403,.403)

"BLD",6303,"KRN","B",.5,.5)

"BLD",6303,"KRN","B",.84,.84)

"BLD",6303,"KRN","B",3.6,3.6)

"BLD",6303,"KRN","B",3.8,3.8)

"BLD",6303,"KRN","B",9.2,9.2)

"BLD",6303,"KRN","B",9.8,9.8)

"BLD",6303,"KRN","B",19,19)

"BLD",6303,"KRN","B",19.1,19.1)

"BLD",6303,"KRN","B",101,101)

"BLD",6303,"KRN","B",409.61,409.61)

"BLD",6303,"KRN","B",771,771)

"BLD",6303,"KRN","B",870,870)

"BLD",6303,"KRN","B",8989.51,8989.51)

"BLD",6303,"KRN","B",8989.52,8989.52)

"BLD",6303,"KRN","B",8994,8994)

"BLD",6303,"QUES",0)
^9.62^^
"BLD",6303,"REQB",0)
^9.611^1^1
"BLD",6303,"REQB",1,0)
PSB*3.0*9^2
"BLD",6303,"REQB","B","PSB*3.0*9",1)

"KRN",.403,105,-1)
0^1
"KRN",.403,105,0)
PSB NEW UD ENTRY^^@^^2990323.1252^^^53.79^0^0^1
"KRN",.403,105,11)
S PSBSAVE=0
"KRN",.403,105,12)

"KRN",.403,105,14)
S PSBSAVE=1
"KRN",.403,105,20)

"KRN",.403,105,40,0)
^.4031I^2^2
"KRN",.403,105,40,1,0)
1^^1,1
"KRN",.403,105,40,1,1)
Page 1
"KRN",.403,105,40,1,40,0)
^.4032IP^369^1
"KRN",.403,105,40,1,40,369,0)
PSB NEW UD ENTRY^1^1,1^e
"KRN",.403,105,40,2,0)
2^^5,5^^^1^15,75
"KRN",.403,105,40,2,1)
Page 2
"KRN",.403,105,40,2,40,0)
^.4032IP^371^2
"KRN",.403,105,40,2,40,370,0)
PSB NEW UD ENTRY DD HDR^1^1,1^d
"KRN",.403,105,40,2,40,371,0)
PSB NEW UD ENTRY DD^2^4,3^e
"KRN",.403,105,40,2,40,371,2)
3^B^f^1
"KRN",.403,105,40,2,40,371,11)
I $G(PSBDOSEF)="PATCH" D UNED^DDSUTL(4,,,1,DDSDA)
"KRN",.403,105,40,2,40,371,12)

"KRN",.404,369,0)
PSB NEW UD ENTRY^53.79
"KRN",.404,369,40,0)
^.4044I^13^13
"KRN",.404,369,40,1,0)
4^^3
"KRN",.404,369,40,1,1)
.01
"KRN",.404,369,40,1,2)
4,16^30
"KRN",.404,369,40,1,4)
0^^^1
"KRN",.404,369,40,2,0)
1^Medication Log Manual Entry - Unit Dose Order^1
"KRN",.404,369,40,2,2)
^^1,1
"KRN",.404,369,40,3,0)
2^!M^1
"KRN",.404,369,40,3,.1)
S Y=$TR($J("",IOM)," ","-")
"KRN",.404,369,40,3,2)
^^2,1
"KRN",.404,369,40,4,0)
5^!M^1
"KRN",.404,369,40,4,.1)
S Y="SSN: "_$$GET1^DIQ(2,$P(^PSB(53.79,DA,0),U)_",",.09)
"KRN",.404,369,40,4,2)
^^4,47
"KRN",.404,369,40,5,0)
7^Admin Status^3
"KRN",.404,369,40,5,1)
.09
"KRN",.404,369,40,5,2)
7,18^7^7,2
"KRN",.404,369,40,5,14)
D VALID^PSBMLEN
"KRN",.404,369,40,6,0)
8^Admin Date/Time^3
"KRN",.404,369,40,6,1)
.06
"KRN",.404,369,40,6,2)
7,44^20^7,27
"KRN",.404,369,40,6,4)
1^^^0
"KRN",.404,369,40,6,14)
D FDATE^PSBMLEN1
"KRN",.404,369,40,7,0)
10^PRN Reason^3
"KRN",.404,369,40,7,1)
.21
"KRN",.404,369,40,7,2)
10,22^58^10,2
"KRN",.404,369,40,8,0)
11^PRN Effectiveness^3
"KRN",.404,369,40,8,1)
.22
"KRN",.404,369,40,8,2)
11,22^58^11,2
"KRN",.404,369,40,9,0)
13^Comment (Required)^2
"KRN",.404,369,40,9,2)
16,2^78^15,2
"KRN",.404,369,40,9,4)
1
"KRN",.404,369,40,9,20)
F^^1:150
"KRN",.404,369,40,9,23)
D COMMENT^PSBML(DA,X)
"KRN",.404,369,40,10,0)
6^Medication^3
"KRN",.404,369,40,10,1)
.08
"KRN",.404,369,40,10,2)
5,16^40^5,2
"KRN",.404,369,40,10,4)
^^^1
"KRN",.404,369,40,11,0)
3^Patient:^1
"KRN",.404,369,40,11,2)
^^4,2
"KRN",.404,369,40,12,0)
9^Injection Site^3
"KRN",.404,369,40,12,1)
.16
"KRN",.404,369,40,12,2)
8,18^30^8,2
"KRN",.404,369,40,13,0)
12^Dispense Drugs...^2
"KRN",.404,369,40,13,2)
13,22^1^13,2^1
"KRN",.404,369,40,13,7)
^2
"KRN",.404,369,40,13,20)
F^^1:1
"KRN",.404,370,0)
PSB NEW UD ENTRY DD HDR^53.79^
"KRN",.404,370,40,0)
^.4044I^3^3
"KRN",.404,370,40,1,0)
1^ Dispense Drugs ^1
"KRN",.404,370,40,1,2)
^^1,2
"KRN",.404,370,40,2,0)
2^Drug Name                        Order   Given  Units^1
"KRN",.404,370,40,2,2)
^^3,3
"KRN",.404,370,40,3,0)
3^Units   Units^1
"KRN",.404,370,40,3,2)
^^2,36
"KRN",.404,371,0)
PSB NEW UD ENTRY DD^53.795
"KRN",.404,371,11)

"KRN",.404,371,12)

"KRN",.404,371,40,0)
^.4044I^4^4
"KRN",.404,371,40,1,0)
1^^3
"KRN",.404,371,40,1,1)
.01
"KRN",.404,371,40,1,2)
1,1^30
"KRN",.404,371,40,1,4)
^^^1
"KRN",.404,371,40,2,0)
2^^3
"KRN",.404,371,40,2,1)
.02
"KRN",.404,371,40,2,2)
1,33^6
"KRN",.404,371,40,2,4)
^^1^1
"KRN",.404,371,40,3,0)
3^^3
"KRN",.404,371,40,3,1)
.03
"KRN",.404,371,40,3,2)
1,41^6
"KRN",.404,371,40,3,4)
1^^1
"KRN",.404,371,40,4,0)
4^^3
"KRN",.404,371,40,4,1)
.04
"KRN",.404,371,40,4,2)
1,49^10
"KRN",.404,371,40,4,4)
1^^^0
"KRN",.404,371,40,4,13)
D UNITS^PSBMLEN
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"PKG",537,-1)
1^1
"PKG",537,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",537,20,0)
^9.402P^^
"PKG",537,22,0)
^9.49I^1^1
"PKG",537,22,1,0)
3.0^3040224^3040504^22979
"PKG",537,22,1,"PAH",1,0)
19^3051115
"PKG",537,22,1,"PAH",1,1,0)
^^1^1^3051115
"PKG",537,22,1,"PAH",1,1,1,0)
Unable to mark a patch as removed
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSBMLEN")
0^1^B71915409
"RTN","PSBMLEN",1,0)
PSBMLEN ;BIRMINGHAM/EFC-BCMA MEDICATION LOG FUNCTIONS ;Mar 2004
"RTN","PSBMLEN",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,9,19**;Mar 2004
"RTN","PSBMLEN",3,0)
 ;
"RTN","PSBMLEN",4,0)
 ; Reference/IA
"RTN","PSBMLEN",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBMLEN",6,0)
 ; ENE^PSJBCMA4/3416
"RTN","PSBMLEN",7,0)
 ; ENR^PSJBCMA4/3416
"RTN","PSBMLEN",8,0)
 ; ^XUSEC/10076
"RTN","PSBMLEN",9,0)
 ; ^DPT/10035
"RTN","PSBMLEN",10,0)
 ; $$GET^XPAR/2263
"RTN","PSBMLEN",11,0)
 ; HLP^DDSUTL/10150
"RTN","PSBMLEN",12,0)
 ;
"RTN","PSBMLEN",13,0)
EN ;
"RTN","PSBMLEN",14,0)
 N PSBCNT,PSBDT,PSBERR,PSBFORM,PSBMED,PSBNOW,PSBSCHT,PSBVARD,PSBX,PSBFREQ,PSBFLAG
"RTN","PSBMLEN",15,0)
 K ^TMP("PSB",$J),^TMP("PSJ",$J),PSBREC
"RTN","PSBMLEN",16,0)
 W @IOF,!,"Manual Medication Entry",!
"RTN","PSBMLEN",17,0)
 I $D(^XUSEC("PSB READ ONLY",DUZ)) W !,"This option is NOT AVAILABLE in PSB READ ONLY mode.",! Q
"RTN","PSBMLEN",18,0)
 W !,"Notice: No validation of medications is done with this option."
"RTN","PSBMLEN",19,0)
 W !,"Entries in the Med Log created with this option will reflect this"
"RTN","PSBMLEN",20,0)
 W !,"in the comments.",!!
"RTN","PSBMLEN",21,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select PATIENT: "
"RTN","PSBMLEN",22,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBMLEN",23,0)
 S DFN=+Y
"RTN","PSBMLEN",24,0)
 D EN1
"RTN","PSBMLEN",25,0)
 K ^TMP("PSBO",$J)
"RTN","PSBMLEN",26,0)
 Q
"RTN","PSBMLEN",27,0)
 ;
"RTN","PSBMLEN",28,0)
EN1 ;
"RTN","PSBMLEN",29,0)
 S %DT="AEQ",%DT("B")="Today",%DT("A")="Select Orders From Date: "
"RTN","PSBMLEN",30,0)
 D ^%DT Q:+Y<1  S PSBDT=+Y
"RTN","PSBMLEN",31,0)
 W !,"Searching for Orders..."
"RTN","PSBMLEN",32,0)
 K ^TMP("PSJ",$J)
"RTN","PSBMLEN",33,0)
 D EN^PSJBCMA(DFN,PSBDT,"")
"RTN","PSBMLEN",34,0)
 Q:$G(^TMP("PSJ",$J,1,0))=-1
"RTN","PSBMLEN",35,0)
 S PSBERR=0
"RTN","PSBMLEN",36,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBMLEN",37,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBMLEN",38,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBMLEN",39,0)
 .Q:PSBONX?.N1"P"  ; No Pending Yet
"RTN","PSBMLEN",40,0)
 .I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBMLEN",41,0)
 .I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBMLEN",42,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBMLEN",43,0)
 .I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBMLEN",44,0)
 .K ^TMP("PSBO",$J)
"RTN","PSBMLEN",45,0)
 .S PSBOUT=0
"RTN","PSBMLEN",46,0)
 .D:PSBSCHT="C"
"RTN","PSBMLEN",47,0)
 ..;Calculate admin times based on Frequency from IPM
"RTN","PSBMLEN",48,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBMLEN",49,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBMLEN",50,0)
 ..I PSBYES,PSBADST="" S PSBOUT=1 Q
"RTN","PSBMLEN",51,0)
 ..I PSBSCH?2.4N.E S PSBYES=1
"RTN","PSBMLEN",52,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBMLEN",53,0)
 ..I PSBFREQ="O" S PSBYES=1
"RTN","PSBMLEN",54,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 S PSBOUT=1 Q
"RTN","PSBMLEN",55,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBMLEN",56,0)
 ..I PSBODD,PSBADST'="" S PSBOUT=1 Q
"RTN","PSBMLEN",57,0)
 ..I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBDT)
"RTN","PSBMLEN",58,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBMLEN",59,0)
 ..F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) S PSBOUT=1 Q  ; Validate time(s)
"RTN","PSBMLEN",60,0)
 .Q:PSBOUT
"RTN","PSBMLEN",61,0)
 .Q:PSBOST>PSBNOW  ; Future Start Date
"RTN","PSBMLEN",62,0)
 .I PSBSCHT="O" S (PSBGVN,X,Y)="" D  I (PSBGVN)!(PSBNGF) K PSBGVN,X,Y Q
"RTN","PSBMLEN",63,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBMLEN",64,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)'="N") PSBGVN=1,(X,Y)=0
"RTN","PSBMLEN",65,0)
 .I PSBSCHT="OC" S (PSBGVN,X,Y)="" D  I PSBGVN K PSBGVN,X,Y Q
"RTN","PSBMLEN",66,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBMLEN",67,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)'="N") PSBGVN=1,(X,Y)=0
"RTN","PSBMLEN",68,0)
 ..S PSBGVN=PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) Q:PSBGVN
"RTN","PSBMLEN",69,0)
 ..I PSBOSTS'="A"&(PSBOSTS'="R") S PSBGVN=1 Q
"RTN","PSBMLEN",70,0)
 ..I PSBNGF S PSBGVN=1 Q
"RTN","PSBMLEN",71,0)
 .S ^TMP("PSB",$J,PSBSCHT,PSBOITX,PSBX)=PSBONX_U_PSBADST_U_PSBOST_U_PSBOSP_U_PSBOSTS
"RTN","PSBMLEN",72,0)
 I PSBERR W ! K DIR S DIR(0)="E" D ^DIR Q:Y="^"
"RTN","PSBMLEN",73,0)
 ;
"RTN","PSBMLEN",74,0)
EN2 ;
"RTN","PSBMLEN",75,0)
 W $$HDR() I '$D(^TMP("PSB",$J)) W !!?5,"No Med Orders Found!",!  Q
"RTN","PSBMLEN",76,0)
 S PSBSCHT="",PSBCNT=0
"RTN","PSBMLEN",77,0)
 F  S PSBSCHT=$O(^TMP("PSB",$J,PSBSCHT)) Q:PSBSCHT=""  D
"RTN","PSBMLEN",78,0)
 .W !  ; Line between order types
"RTN","PSBMLEN",79,0)
 .S PSBMED=""
"RTN","PSBMLEN",80,0)
 .F  S PSBMED=$O(^TMP("PSB",$J,PSBSCHT,PSBMED)) Q:PSBMED=""  D
"RTN","PSBMLEN",81,0)
 ..F PSBX=0:0 S PSBX=$O(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX)) Q:'PSBX  D
"RTN","PSBMLEN",82,0)
 ...I $Y>(IOSL-6) W ! K DIR S DIR(0)="E" D ^DIR W:Y $$HDR() I 'Y S PSBSCHT="Z" Q
"RTN","PSBMLEN",83,0)
 ...S PSBCNT=PSBCNT+1
"RTN","PSBMLEN",84,0)
 ...W !,$J(PSBCNT,2),". ",PSBSCHT,?7,PSBMED
"RTN","PSBMLEN",85,0)
 ...W ?40," (",$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,5),")"
"RTN","PSBMLEN",86,0)
 ...S Y=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,3)
"RTN","PSBMLEN",87,0)
 ...W:$X>44 !
"RTN","PSBMLEN",88,0)
 ...W ?45,"Start: ",$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))_" "
"RTN","PSBMLEN",89,0)
 ...W $E($P(Y,".",2)_"0000",1,4)
"RTN","PSBMLEN",90,0)
 ...S Y=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,4)
"RTN","PSBMLEN",91,0)
 ...W !?45," Stop: ",$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_(1700+$E(Y,1,3))_" "
"RTN","PSBMLEN",92,0)
 ...W $E($P(Y,".",2)_"0000",1,4)
"RTN","PSBMLEN",93,0)
 ...I $P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,2)]"" W !?7,"Admin Times: ",$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,2)
"RTN","PSBMLEN",94,0)
 ...W !
"RTN","PSBMLEN",95,0)
 ...S ^TMP("PSBO",$J,PSBCNT)=$P(^TMP("PSB",$J,PSBSCHT,PSBMED,PSBX),U,1)
"RTN","PSBMLEN",96,0)
 F  Q:$Y>(IOSL-5)  W !
"RTN","PSBMLEN",97,0)
 K DIR S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR
"RTN","PSBMLEN",98,0)
 I Y S Y=^TMP("PSBO",$J,Y) D NEW^PSBMLEN1(Y) G EN2
"RTN","PSBMLEN",99,0)
 Q
"RTN","PSBMLEN",100,0)
 ;
"RTN","PSBMLEN",101,0)
 ;
"RTN","PSBMLEN",102,0)
HDR() ;
"RTN","PSBMLEN",103,0)
 W @IOF,"Manual Medication Entry",!," #",?4,"Sc",?7,"Medication",?41,"St"
"RTN","PSBMLEN",104,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",105,0)
 Q ""
"RTN","PSBMLEN",106,0)
 ;
"RTN","PSBMLEN",107,0)
EDIT    ; Edit Medication Log
"RTN","PSBMLEN",108,0)
 N PSBAUDIT
"RTN","PSBMLEN",109,0)
 S PSBAUDIT=1
"RTN","PSBMLEN",110,0)
 W:'$D(^XUSEC("PSB MANAGER",DUZ)) !!?5,"Notice: You are restricted from editing any entries other than",!,"        those that you have created.",!
"RTN","PSBMLEN",111,0)
 S DA=""
"RTN","PSBMLEN",112,0)
 S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient Name: "
"RTN","PSBMLEN",113,0)
 D ^DIC K DIC Q:+Y<1
"RTN","PSBMLEN",114,0)
 S DFN=+Y
"RTN","PSBMLEN",115,0)
 D EDIT1
"RTN","PSBMLEN",116,0)
 K PSBCNT,PSBDT,PSBIEN,PSBSRCH,PSBTMP,DA,DFN,DR,DDSFILE
"RTN","PSBMLEN",117,0)
 G EDIT
"RTN","PSBMLEN",118,0)
 ;
"RTN","PSBMLEN",119,0)
EDIT1   ; 
"RTN","PSBMLEN",120,0)
 S %DT="AEQ",%DT("A")="Select Date to Begin Searching Back From: "
"RTN","PSBMLEN",121,0)
 W !! S %DT("B")="TODAY" D ^%DT Q:+Y<1  S PSBDT=Y
"RTN","PSBMLEN",122,0)
 F  D  Q:'PSBDT
"RTN","PSBMLEN",123,0)
 .W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBMLEN",124,0)
 .W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBMLEN",125,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",126,0)
 .S PSBSRCH=PSBDT+.9,PSBCNT=0
"RTN","PSBMLEN",127,0)
 .K PSBTMP
"RTN","PSBMLEN",128,0)
 .F  S PSBSRCH=$O(^PSB(53.79,"AEDT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLEN",129,0)
 ..S PSBIEN=""
"RTN","PSBMLEN",130,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AEDT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:$P(^PSB(53.79,PSBIEN,0),U,7)=DUZ!($D(^XUSEC("PSB MANAGER",DUZ)))
"RTN","PSBMLEN",131,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBMLEN",132,0)
 ...S PSBCNT=PSBCNT+1,PSBTMP(PSBCNT)=PSBIEN
"RTN","PSBMLEN",133,0)
 ...D:$Y>19
"RTN","PSBMLEN",134,0)
 ....W ! S DIR(0)="E" D ^DIR
"RTN","PSBMLEN",135,0)
 ....W @IOF,!,"Searching Date " S Y=PSBDT D D^DIQ W Y
"RTN","PSBMLEN",136,0)
 ....W !," #  Medication",?45,"St",?50,"D/T Given",?75,"Int"
"RTN","PSBMLEN",137,0)
 ....W !,$TR($J("",IOM)," ","-")
"RTN","PSBMLEN",138,0)
 ...W !,$J(PSBCNT,2),". "
"RTN","PSBMLEN",139,0)
 ...W ?5,$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLEN",140,0)
 ...I $$GET1^DIQ(53.79,PSBIEN_",",.26) W ?5," ("_$$GET1^DIQ(53.79,PSBIEN_",",.26)_")"
"RTN","PSBMLEN",141,0)
 ...W ?45,$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBMLEN",142,0)
 ...W ?50,$$GET1^DIQ(53.79,PSBIEN_",",.06)
"RTN","PSBMLEN",143,0)
 ...W ?75,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLEN",144,0)
 .I PSBCNT D  Q:Y
"RTN","PSBMLEN",145,0)
 ..W ! S DIR(0)="NO^1:"_PSBCNT_":0" D ^DIR
"RTN","PSBMLEN",146,0)
 ..I Y S DA=PSBTMP(Y),PSBDT=""
"RTN","PSBMLEN",147,0)
 .I 'PSBCNT W !!?5,"No Meds Found!"
"RTN","PSBMLEN",148,0)
 .S X1=PSBDT,X2=-1 D C^%DTC S (PSBDT,Y)=X D D^DIQ
"RTN","PSBMLEN",149,0)
 .W !!,"Continue With ",Y
"RTN","PSBMLEN",150,0)
 .S %=1 D YN^DICN I %'=1 S PSBDT=0
"RTN","PSBMLEN",151,0)
 I DA D
"RTN","PSBMLEN",152,0)
 .S PSBCOMP="",PSBDFN=$$GET1^DIQ(53.79,DA_",",.01,"I"),PSBONX=$$GET1^DIQ(53.79,DA_",",.11),PSBSTUS=$$GET1^DIQ(53.79,DA_",",.09,"I")
"RTN","PSBMLEN",153,0)
 .I PSBONX["V",PSBSTUS'="G" D  Q:PSBCOMP=1
"RTN","PSBMLEN",154,0)
 ..S PSBBAGN=$$GET1^DIQ(53.79,DA_",",.26) D INFUSING^PSBVDLU2 Q:PSBCOMP=0
"RTN","PSBMLEN",155,0)
 ..I $D(PSBPORA(PSBONX)) S X="" F  S X=$O(PSBPORA(PSBONX,X)),PSBBAG2=$P(PSBPORA(PSBONX,X),U,1),PSBBAGST=$P(PSBPORA(PSBONX,X),U,2) Q:PSBBAG2]""
"RTN","PSBMLEN",156,0)
 ..I PSBBAGN=PSBBAG2 S PSBCOMP=0 Q
"RTN","PSBMLEN",157,0)
 ..I (PSBBAGN'=PSBBAG2),PSBBAGST'="C" D 
"RTN","PSBMLEN",158,0)
 ...W !!,"Bag "_PSBBAG2_" is marked as ",$S(PSBBAGST="I":"Infusing",PSBBAGST="S":"Stopped",1:"unk")
"RTN","PSBMLEN",159,0)
 ...W !,"This bag must be completed before bag "_PSBBAGN_" can be edited.",!!
"RTN","PSBMLEN",160,0)
 ...K PSBORA,PSBBAGN,PSBBAG2,PSBBAGST
"RTN","PSBMLEN",161,0)
 .I PSBONX["V" D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBMLEN",162,0)
 .S DDSFILE=53.79 D
"RTN","PSBMLEN",163,0)
 ..I PSBONX["U" S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",164,0)
 ..I PSBIVT["P" S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",165,0)
 ..I PSBIVT["S",PSBISYR=1  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",166,0)
 ..I PSBIVT["C",PSBISYR=1  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",167,0)
 ..I PSBIVT["C",PSBCHEMT="P"  S DR="[PSB MED LOG EDIT]" Q
"RTN","PSBMLEN",168,0)
 ..S DR="[PSB MED LOG EDIT IV]" Q
"RTN","PSBMLEN",169,0)
 .D ^DDS
"RTN","PSBMLEN",170,0)
 .;One time order reinstated if not given
"RTN","PSBMLEN",171,0)
 .D:($P(^PSB(53.79,DA,.1),U,2)="O")&($P(^PSB(53.79,DA,0),U,9)="N") ENR^PSJBCMA4(DFN,$P(^PSB(53.79,DA,.1),U,1))
"RTN","PSBMLEN",172,0)
 .D:($P(^PSB(53.79,DA,.1),U,2)="O")&($P(^PSB(53.79,DA,0),U,9)="G") ENE^PSJBCMA4(DFN,$P(^PSB(53.79,DA,.1),U,1))
"RTN","PSBMLEN",173,0)
 Q
"RTN","PSBMLEN",174,0)
 ;
"RTN","PSBMLEN",175,0)
VALID ;
"RTN","PSBMLEN",176,0)
 I $G(PSBSTUS)="RM","^RM^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Status of Removed cannot be changed.") Q
"RTN","PSBMLEN",177,0)
 I $G(PSBREC(7))'="Entry created with 'Manual Medication Entry' option." D  Q
"RTN","PSBMLEN",178,0)
 .I ($D(^PSB(53.79,DA,.5,1,0))),($P($G(^PSB(53.79,DA,.5,1,0)),U,4)="PATCH") D  Q
"RTN","PSBMLEN",179,0)
 ..I "^G^N^H^R^RM^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Not Given, Held, Refused and Removed.")
"RTN","PSBMLEN",180,0)
 .I "^G^N^H^R^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Not Given, Held, and Refused.")
"RTN","PSBMLEN",181,0)
 I "^G^H^R^"'[("^"_X_"^") W $C(7) S DDSERROR=1 D HLP^DDSUTL("Allowed status codes are Given, Held, and Refused.") Q
"RTN","PSBMLEN",182,0)
 ;
"RTN","PSBMLEN",183,0)
UNITS ;Check UNITS field for entry of PATCH
"RTN","PSBMLEN",184,0)
 I Y'="PATCH" Q
"RTN","PSBMLEN",185,0)
 S (DDSERROR,DDSBR)=1
"RTN","PSBMLEN",186,0)
 S @DDSREFT@("F"_DDP,DDSDA,DDSFLD,"D")=DDSOLD
"RTN","PSBMLEN",187,0)
 W $C(7)
"RTN","PSBMLEN",188,0)
 D HLP^DDSUTL("Field cannot be changed to PATCH")
"RTN","PSBMLEN",189,0)
 D REFRESH^DDSUTL
"RTN","PSBMLEN",190,0)
 Q
"RTN","PSBMLEN",191,0)
 ;
"VER")
8.0^22.0
"BLD",6303,6)
^SEQ #12
**END**
**END**
