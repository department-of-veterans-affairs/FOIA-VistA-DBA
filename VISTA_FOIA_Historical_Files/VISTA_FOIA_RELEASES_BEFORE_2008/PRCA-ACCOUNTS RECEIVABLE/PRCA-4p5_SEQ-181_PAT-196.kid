Released PRCA*4.5*196 SEQ #181
Extracted from mail message
**KIDS**:PRCA*4.5*196^

**INSTALL NAME**
PRCA*4.5*196
"BLD",5120,0)
PRCA*4.5*196^ACCOUNTS RECEIVABLE^0^3031211^y
"BLD",5120,1,0)
^^7^7^3031211^
"BLD",5120,1,1,0)
 
"BLD",5120,1,2,0)
This patch addresses two issues. The first issue is regarding two
"BLD",5120,1,3,0)
users who were able to exempt interest/admin. charges on the same bill
"BLD",5120,1,4,0)
at the same time through the Administrative Cost Adjustment [PRCAF ADJ
"BLD",5120,1,5,0)
ADMIN] option. The second issue is about the receipt profile that
"BLD",5120,1,6,0)
didn't show the last person's initials when he/she edited the receipt
"BLD",5120,1,7,0)
by using EP Edit Payment under the Receipt Processing.
"BLD",5120,4,0)
^9.64PA^344^1
"BLD",5120,4,344,0)
344
"BLD",5120,4,344,2,0)
^9.641^344.01^1
"BLD",5120,4,344,2,344.01,0)
TRANSACTION  (sub-file)
"BLD",5120,4,344,2,344.01,1,0)
^9.6411^.14^1
"BLD",5120,4,344,2,344.01,1,.14,0)
EDITED BY
"BLD",5120,4,344,222)
y^n^p^^^^n^^n
"BLD",5120,4,344,224)

"BLD",5120,4,"APDD",344,344.01)

"BLD",5120,4,"APDD",344,344.01,.14)

"BLD",5120,4,"B",344,344)

"BLD",5120,"ABPKG")

"BLD",5120,"KRN",0)
^9.67PA^8989.52^19
"BLD",5120,"KRN",.4,0)
.4
"BLD",5120,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5120,"KRN",.401,0)
.401
"BLD",5120,"KRN",.402,0)
.402
"BLD",5120,"KRN",.403,0)
.403
"BLD",5120,"KRN",.5,0)
.5
"BLD",5120,"KRN",.84,0)
.84
"BLD",5120,"KRN",3.6,0)
3.6
"BLD",5120,"KRN",3.8,0)
3.8
"BLD",5120,"KRN",9.2,0)
9.2
"BLD",5120,"KRN",9.8,0)
9.8
"BLD",5120,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5120,"KRN",9.8,"NM",1,0)
PRCAEXM^^0^B12096933
"BLD",5120,"KRN",9.8,"NM",2,0)
RCDPRPLM^^0^B83218605
"BLD",5120,"KRN",9.8,"NM",3,0)
RCDPURED^^0^B31310164
"BLD",5120,"KRN",9.8,"NM",4,0)
RCDPURET^^0^B48328076
"BLD",5120,"KRN",9.8,"NM","B","PRCAEXM",1)

"BLD",5120,"KRN",9.8,"NM","B","RCDPRPLM",2)

"BLD",5120,"KRN",9.8,"NM","B","RCDPURED",3)

"BLD",5120,"KRN",9.8,"NM","B","RCDPURET",4)

"BLD",5120,"KRN",19,0)
19
"BLD",5120,"KRN",19,"NM",0)
^9.68A^^
"BLD",5120,"KRN",19.1,0)
19.1
"BLD",5120,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5120,"KRN",101,0)
101
"BLD",5120,"KRN",101,"NM",0)
^9.68A^^
"BLD",5120,"KRN",409.61,0)
409.61
"BLD",5120,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",5120,"KRN",409.61,"NM",1,0)
RCDP RECEIPT PROFILE^^0
"BLD",5120,"KRN",409.61,"NM","B","RCDP RECEIPT PROFILE",1)

"BLD",5120,"KRN",771,0)
771
"BLD",5120,"KRN",771,"NM",0)
^9.68A^^
"BLD",5120,"KRN",870,0)
870
"BLD",5120,"KRN",870,"NM",0)
^9.68A^^
"BLD",5120,"KRN",8989.51,0)
8989.51
"BLD",5120,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5120,"KRN",8989.52,0)
8989.52
"BLD",5120,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5120,"KRN",8994,0)
8994
"BLD",5120,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5120,"KRN","B",.4,.4)

"BLD",5120,"KRN","B",.401,.401)

"BLD",5120,"KRN","B",.402,.402)

"BLD",5120,"KRN","B",.403,.403)

"BLD",5120,"KRN","B",.5,.5)

"BLD",5120,"KRN","B",.84,.84)

"BLD",5120,"KRN","B",3.6,3.6)

"BLD",5120,"KRN","B",3.8,3.8)

"BLD",5120,"KRN","B",9.2,9.2)

"BLD",5120,"KRN","B",9.8,9.8)

"BLD",5120,"KRN","B",19,19)

"BLD",5120,"KRN","B",19.1,19.1)

"BLD",5120,"KRN","B",101,101)

"BLD",5120,"KRN","B",409.61,409.61)

"BLD",5120,"KRN","B",771,771)

"BLD",5120,"KRN","B",870,870)

"BLD",5120,"KRN","B",8989.51,8989.51)

"BLD",5120,"KRN","B",8989.52,8989.52)

"BLD",5120,"KRN","B",8994,8994)

"BLD",5120,"PRE")
PRCAP211
"BLD",5120,"QUES",0)
^9.62^^
"BLD",5120,"REQB",0)
^9.611^3^3
"BLD",5120,"REQB",1,0)
PRCA*4.5*103^2
"BLD",5120,"REQB",2,0)
PRCA*4.5*174^2
"BLD",5120,"REQB",3,0)
PRCA*4.5*173^2
"BLD",5120,"REQB","B","PRCA*4.5*103",1)

"BLD",5120,"REQB","B","PRCA*4.5*173",3)

"BLD",5120,"REQB","B","PRCA*4.5*174",2)

"FIA",344)
AR BATCH PAYMENT
"FIA",344,0)
^RCY(344,
"FIA",344,0,0)
344I
"FIA",344,0,1)
y^n^p^^^^n^^n
"FIA",344,0,10)

"FIA",344,0,11)

"FIA",344,0,"RLRO")

"FIA",344,0,"VR")
4.5^PRCA
"FIA",344,344)
1
"FIA",344,344.01)
1
"FIA",344,344.01,.14)

"KRN",409.61,524,-1)
0^1
"KRN",409.61,524,0)
RCDP RECEIPT PROFILE^1^^80^6^16^1^1^Transaction^RCDP RECEIPT PROFILE MENU^Receipt Profile^1^^1
"KRN",409.61,524,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,524,"ARRAY")
 ^TMP("RCDPRPLM",$J)
"KRN",409.61,524,"COL",0)
^409.621^8^7
"KRN",409.61,524,"COL",2,0)
ACCOUNT^7^26^Account
"KRN",409.61,524,"COL",3,0)
PAY DATE^35^8^Pay Date
"KRN",409.61,524,"COL",4,0)
PAY AMOUNT^63^7^Pay Amt
"KRN",409.61,524,"COL",5,0)
PROC AMOUNT^72^8^Proc Amt
"KRN",409.61,524,"COL",6,0)
OPEN BY^45^7^Open By
"KRN",409.61,524,"COL",7,0)
TRANS NUMBER^2^1^#
"KRN",409.61,524,"COL",8,0)
EDIT BY^54^7^Edit By
"KRN",409.61,524,"COL","B","ACCOUNT",2)

"KRN",409.61,524,"COL","B","BY",6)

"KRN",409.61,524,"COL","B","EDIT BY",8)

"KRN",409.61,524,"COL","B","OPEN BY",6)

"KRN",409.61,524,"COL","B","PAY AMOUNT",4)

"KRN",409.61,524,"COL","B","PAY DATE",3)

"KRN",409.61,524,"COL","B","PROC AMOUNT",5)

"KRN",409.61,524,"COL","B","TRANS NUMBER",7)

"KRN",409.61,524,"FNL")
D EXIT^RCDPRPLM
"KRN",409.61,524,"HDR")
D HDR^RCDPRPLM
"KRN",409.61,524,"INIT")
D INIT^RCDPRPLM
"MBREQ")
0
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
196^3031211^2447
"PKG",142,22,1,"PAH",1,1,0)
^^7^7^3031211
"PKG",142,22,1,"PAH",1,1,1,0)
 
"PKG",142,22,1,"PAH",1,1,2,0)
This patch addresses two issues. The first issue is regarding two
"PKG",142,22,1,"PAH",1,1,3,0)
users who were able to exempt interest/admin. charges on the same bill
"PKG",142,22,1,"PAH",1,1,4,0)
at the same time through the Administrative Cost Adjustment [PRCAF ADJ
"PKG",142,22,1,"PAH",1,1,5,0)
ADMIN] option. The second issue is about the receipt profile that
"PKG",142,22,1,"PAH",1,1,6,0)
didn't show the last person's initials when he/she edited the receipt
"PKG",142,22,1,"PAH",1,1,7,0)
by using EP Edit Payment under the Receipt Processing.
"PRE")
PRCAP211
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PRCAEXM")
0^1^B12096933
"RTN","PRCAEXM",1,0)
PRCAEXM ;SF-ISC/YJK-ADMIN.COST CHARGE TRANSACTION ;3/30/94  11:19 AM
"RTN","PRCAEXM",2,0)
V ;;4.5;Accounts Receivable;**67,103,196**;Mar 20, 1995
"RTN","PRCAEXM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAEXM",4,0)
 ;Update Int/adm.balance
"RTN","PRCAEXM",5,0)
 ;and Administrative cost charge transaction, is called by ^PRCAWO.
"RTN","PRCAEXM",6,0)
 ;
"RTN","PRCAEXM",7,0)
EN1 ;Adjustment Interest/admin.cost from an AR - this makes the int/adm.balance
"RTN","PRCAEXM",8,0)
 ;,marshal fee and court cost zero,0.
"RTN","PRCAEXM",9,0)
 N PRCAIND,ADMINTOT,PRCAERR,PRCABN0
"RTN","PRCAEXM",10,0)
 D BEGIN^PRCAWO G:('$D(PRCABN))!('$D(PRCAEN)) END G:'$D(^PRCA(430,PRCABN,7)) END
"RTN","PRCAEXM",11,0)
 L +^PRCA(430,PRCABN):1 I '$T W !!,*7,"ANOTHER USER IS EDITING THIS BILL" G EN1
"RTN","PRCAEXM",12,0)
 S PRCABN0=PRCABN
"RTN","PRCAEXM",13,0)
 S PRCAIND=$G(^PRCA(430,PRCABN,7))
"RTN","PRCAEXM",14,0)
 S PRCAMT=$P(PRCAIND,U,2)+$P(PRCAIND,U,3)+$P(PRCAIND,U,4)+$P(PRCAIND,U,5)
"RTN","PRCAEXM",15,0)
 S %=$P(^PRCA(430,PRCABN,0),U,2) I "PC"'[$P(^PRCA(430.2,%,0),U,6) W *7,!,"This AR may not be appropriate to charge Interest/Administrative cost.",!,"Please check the category of this AR.",! H 3
"RTN","PRCAEXM",16,0)
 K % W !!,"You may exempt the account from all the interest and administrative cost balances - making those balances zero (0),",!,"or adjust them."
"RTN","PRCAEXM",17,0)
EN011 S %=2 W !!,"Do you want to exempt the account from all the Int/Adm. costs" D YN^DICN I %<0 S PRCACOMM="User Canceled" D DELETE^PRCAWO1 K PRCACOMM G EN1
"RTN","PRCAEXM",18,0)
 I %=1 D EN11,END G EN1
"RTN","PRCAEXM",19,0)
 I %=0 W !,"ANSWER 'YES' OR 'NO' " G EN011
"RTN","PRCAEXM",20,0)
 W !,"Adjusting the administrative/Interest charge ...",! D DIEEN^PRCAWO1,END G EN1
"RTN","PRCAEXM",21,0)
 ;
"RTN","PRCAEXM",22,0)
 ;  exempt interest and admin charges
"RTN","PRCAEXM",23,0)
EN11 S PRCATYPE=14,DIE="^PRCA(433,",DA=PRCAEN
"RTN","PRCAEXM",24,0)
 S DR=".03////^S X="_PRCABN_";11////^S X="_DT_";12////^S X="_PRCATYPE_";15////^S X="_PRCAMT_";"
"RTN","PRCAEXM",25,0)
 S DR=DR_"27////^S X="_+$P(PRCAIND,U,2)_";"  ;interest
"RTN","PRCAEXM",26,0)
 S DR=DR_"28////^S X="_+$P(PRCAIND,U,3)_";"  ;admin charge
"RTN","PRCAEXM",27,0)
 S DR=DR_"25////^S X="_+$P(PRCAIND,U,4)_";"  ;marshal fee
"RTN","PRCAEXM",28,0)
 S DR=DR_"26////^S X="_+$P(PRCAIND,U,5)_";"  ;court cost
"RTN","PRCAEXM",29,0)
 S DIC=DIE,PRCA("LOCK")=0 D LOCKF^PRCAWO1 Q:PRCA("LOCK")=1  D ^DIE
"RTN","PRCAEXM",30,0)
 S $P(^PRCA(430,PRCABN,7),U,2,5)="0^0^0^0" D TRANST^PRCAWO1 Q
"RTN","PRCAEXM",31,0)
 ;
"RTN","PRCAEXM",32,0)
 ;
"RTN","PRCAEXM",33,0)
EN2 Q:'$D(PRCAEN)  Q:($P(^PRCA(433,PRCAEN,2),U,8)="")&($P(^PRCA(433,PRCAEN,2),U,7)="")
"RTN","PRCAEXM",34,0)
 W !,"MONTHLY ADMIN. CHARGE: ",?25,+$P(^PRCA(433,PRCAEN,2),U,8),?40,"INTEREST CHARGE: ",+$P(^PRCA(433,PRCAEN,2),U,7) Q
"RTN","PRCAEXM",35,0)
 ;
"RTN","PRCAEXM",36,0)
END L -^PRCA(433,+$G(PRCAEN)),-^PRCA(430,+$G(PRCABN))
"RTN","PRCAEXM",37,0)
 S X(1)=0,X=$G(^PRCA(430,+$G(PRCABN0),7)),X(1)=+X,X(1)=$P(X,"^",2)+X(1),X(1)=$P(X,"^",3)+X(1),X(1)=$P(X,"^",4)+X(1),X(1)=$P(X,"^",5)+X(1)
"RTN","PRCAEXM",38,0)
 K PRCA("STATUS")
"RTN","PRCAEXM",39,0)
 I X(1)=0,$G(PRCABN0) D
"RTN","PRCAEXM",40,0)
 .;Check for payment transactions
"RTN","PRCAEXM",41,0)
 .F X=0:0 S X=$O(^PRCA(433,"C",PRCABN0,X)) Q:'X  I ",2,7,20,"[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(433,X,1)),"^",2),0)),"^",3)_",") S PRCA("STATUS")=$O(^PRCA(430.3,"AC",108,0))
"RTN","PRCAEXM",42,0)
 .S:'$D(PRCA("STATUS")) PRCA("STATUS")=$O(^PRCA(430.3,"AC",111,0))
"RTN","PRCAEXM",43,0)
 .S DA=PRCABN0,DIE="^PRCA(430,",DR="8////"_PRCA("STATUS") D ^DIE
"RTN","PRCAEXM",44,0)
 K PRCATY,PRCA,PRCA2,PRCAD,PRCABN,PRCAEN,PRCATYPE,DA,DIE,DIC,PRCAMT,DR,X,% Q
"RTN","PRCAP211")
0^^B4000932
"RTN","PRCAP211",1,0)
PRCAP211 ;ALB/CXW - PATCH PRCA*4.5*211 ENVIRONMENT CHECK
"RTN","PRCAP211",2,0)
 ;;4.5;Accounts Receivable;**211,196**;Mar 20, 1995
"RTN","PRCAP211",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAP211",4,0)
ENV ;
"RTN","PRCAP211",5,0)
 ;this is the environment check routine
"RTN","PRCAP211",6,0)
 I $$PATCH^XPDUTL("PRCA*4.5*175") D
"RTN","PRCAP211",7,0)
 . W "You are a test site for a CoreFLS version (patch PRCA*4.5*175) of Accounts",!
"RTN","PRCAP211",8,0)
 . W "Receivable. This patch has a conflict with the AR-CoreFLS test software.",!
"RTN","PRCAP211",9,0)
 . W "It must NOT be installed unless an accompanying update is made to the",!
"RTN","PRCAP211",10,0)
 . W "AR-CoreFLS software immediately after installation of this patch.",!!
"RTN","PRCAP211",11,0)
 . N DIR,DTOUT,DUOUT,Y
"RTN","PRCAP211",12,0)
 . S DIR(0)="YA"
"RTN","PRCAP211",13,0)
 . S DIR("A")="Do you have the corresponding update to the AR-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","PRCAP211",14,0)
 . D ^DIR
"RTN","PRCAP211",15,0)
 . I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=1 Q
"RTN","PRCAP211",16,0)
 . W !,"OK to install!"
"RTN","PRCAP211",17,0)
 Q
"RTN","RCDPRPLM")
0^2^B83218605
"RTN","RCDPRPLM",1,0)
RCDPRPLM ;WISC/RFJ-receipt profile listmanager top routine ;1 Jun 99
"RTN","RCDPRPLM",2,0)
 ;;4.5;Accounts Receivable;**114,148,149,173,196**;Mar 20, 1995
"RTN","RCDPRPLM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRPLM",4,0)
 ;
"RTN","RCDPRPLM",5,0)
 N RCDPFXIT
"RTN","RCDPRPLM",6,0)
 ;
"RTN","RCDPRPLM",7,0)
RECTPROF ;  entry point called by link payment to prevent newing
"RTN","RCDPRPLM",8,0)
 ; fast exit var RCDPFXIT
"RTN","RCDPRPLM",9,0)
 N RCRECTDA
"RTN","RCDPRPLM",10,0)
 ;
"RTN","RCDPRPLM",11,0)
 F  D  Q:'RCRECTDA
"RTN","RCDPRPLM",12,0)
 .   W !! S RCRECTDA=$$SELRECT^RCDPUREC(1)  ;  allow adding new receipt
"RTN","RCDPRPLM",13,0)
 .   I RCRECTDA<1 S RCRECTDA=0 Q
"RTN","RCDPRPLM",14,0)
 .   D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPRPLM",15,0)
 .   ; fast exit
"RTN","RCDPRPLM",16,0)
 .   I $G(RCDPFXIT) S RCRECTDA=0
"RTN","RCDPRPLM",17,0)
 Q
"RTN","RCDPRPLM",18,0)
 ;
"RTN","RCDPRPLM",19,0)
 ;
"RTN","RCDPRPLM",20,0)
INIT ; init for list manager
"RTN","RCDPRPLM",21,0)
 N DATE,FMSDOC,GECSDA1,GECSDATA,RCCANCEL,RCDPDATA,RCDPFCAN,RCLINE,RCTOTAL,RCTRDA,SPACE,RCEFT,X,Z,Z0,RCZ,RCZ0,RCZ1,RCZ2
"RTN","RCDPRPLM",22,0)
 K ^TMP("RCDPRPLM",$J),^TMP("VALM VIDEO",$J)
"RTN","RCDPRPLM",23,0)
 ;
"RTN","RCDPRPLM",24,0)
 ; fast exit
"RTN","RCDPRPLM",25,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPRPLM",26,0)
 ;
"RTN","RCDPRPLM",27,0)
 D DIQ344(RCRECTDA,".02:200")
"RTN","RCDPRPLM",28,0)
 ;
"RTN","RCDPRPLM",29,0)
 ; set listmanager line #
"RTN","RCDPRPLM",30,0)
 S RCLINE=0
"RTN","RCDPRPLM",31,0)
 ;
"RTN","RCDPRPLM",32,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",33,0)
 S RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",34,0)
 I RCEFT D
"RTN","RCDPRPLM",35,0)
 .   S Z=0 F  S Z=$O(^RCY(344.31,"B",RCEFT,Z)) Q:'Z  S Z0=$G(^RCY(344.31,+Z,0)) I $P(Z0,U,14) S ^TMP($J,"RCEFT",$P(Z0,U,14))=Z_U_$E($P(Z0,U,2),1,12)
"RTN","RCDPRPLM",36,0)
 S RCTRDA=0 F  S RCTRDA=$O(^RCY(344,RCRECTDA,1,RCTRDA)) Q:'RCTRDA  D
"RTN","RCDPRPLM",37,0)
 .   D DIQ34401(RCRECTDA,RCTRDA)
"RTN","RCDPRPLM",38,0)
 .   S RCLINE=RCLINE+1 D SET("",RCLINE,1,80,.01)
"RTN","RCDPRPLM",39,0)
 .   ; check for payment cancelled
"RTN","RCDPRPLM",40,0)
 .   S RCCANCEL=0
"RTN","RCDPRPLM",41,0)
 .   I $P($G(^RCY(344,RCRECTDA,1,RCTRDA,0)),"^",4)=0,$P($G(^(1)),"^")'="" D
"RTN","RCDPRPLM",42,0)
 .   .   S RCCANCEL=1,RCDPFCAN=1
"RTN","RCDPRPLM",43,0)
 .   .   D SET("**",RCLINE,5,6)
"RTN","RCDPRPLM",44,0)
 .   ; account
"RTN","RCDPRPLM",45,0)
 .   I $G(RCDPDATA(344.01,RCTRDA,.03,"E"))="" D
"RTN","RCDPRPLM",46,0)
 .   .   S RCDPDATA(344.01,RCTRDA,.03,"E")="[ "_$S(RCEFT:"5287.4/8NZZ "_$P($G(^TMP($J,"RCEFT",RCTRDA)),U,2),1:"suspense"_$$GETUNAPP^RCXFMSCR(RCRECTDA,RCTRDA,0))_" ]"
"RTN","RCDPRPLM",47,0)
 .   D SET("",RCLINE,7,33,.03)
"RTN","RCDPRPLM",48,0)
 .   ; date of payment
"RTN","RCDPRPLM",49,0)
 .   I RCDPDATA(344.01,RCTRDA,.06,"I") D
"RTN","RCDPRPLM",50,0)
 .   .   D SET($E(RCDPDATA(344.01,RCTRDA,.06,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),2,3),RCLINE,35,42)
"RTN","RCDPRPLM",51,0)
 .   ; entered by
"RTN","RCDPRPLM",52,0)
 .   I RCDPDATA(344.01,RCTRDA,.12,"E")'="" D
"RTN","RCDPRPLM",53,0)
 .   .   S X=$E($P(RCDPDATA(344.01,RCTRDA,.12,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.12,"E"))
"RTN","RCDPRPLM",54,0)
 .   .   I RCDPDATA(344.01,RCTRDA,.12,"I")=.5 S X="ar"
"RTN","RCDPRPLM",55,0)
 .   .   D SET(X,RCLINE,45,46)
"RTN","RCDPRPLM",56,0)
 .   I RCDPDATA(344.01,RCTRDA,.14,"E")'="" D
"RTN","RCDPRPLM",57,0)
 .   . S X=$E($P(RCDPDATA(344.01,RCTRDA,.14,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.14,"E"))
"RTN","RCDPRPLM",58,0)
 .   . D SET(X,RCLINE,54,55)
"RTN","RCDPRPLM",59,0)
 .   D SET($J(RCDPDATA(344.01,RCTRDA,.04,"E"),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",60,0)
 .   D SET($J(RCDPDATA(344.01,RCTRDA,.05,"E"),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",61,0)
 .   ;
"RTN","RCDPRPLM",62,0)
 .   ; if not processed, show if amount > bill
"RTN","RCDPRPLM",63,0)
 .   S X=$$CHECKPAY^RCDPRPL3(RCRECTDA,RCTRDA) I X D
"RTN","RCDPRPLM",64,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",65,0)
 .   .   D SET("  WARNING: Pending Payments ($ "_$J($P(X,"^",3),0,2)_") exceed amount billed ($ "_$J($P(X,"^",2),0,2)_")",RCLINE,1,80)
"RTN","RCDPRPLM",66,0)
 .   ;
"RTN","RCDPRPLM",67,0)
 .   ; show line 2 for check/credit payment
"RTN","RCDPRPLM",68,0)
 .   I $G(^DISV(DUZ,"RCDPRPLM","SHOWCHECK")) D
"RTN","RCDPRPLM",69,0)
 .   .   ;  receipt type of payment is check
"RTN","RCDPRPLM",70,0)
 .   .   I RCDPDATA(344,RCRECTDA,.04,"I")=4!(RCDPDATA(344,RCRECTDA,.04,"I")=12) D  Q
"RTN","RCDPRPLM",71,0)
 .   .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",72,0)
 .   .   .   D SET("      Check #",RCLINE,1,80,.07)
"RTN","RCDPRPLM",73,0)
 .   .   .   I 'RCDPDATA(344.01,RCTRDA,.1,"I") S RCDPDATA(344.01,RCTRDA,.1,"I")="???????"
"RTN","RCDPRPLM",74,0)
 .   .   .   D SET("Date: "_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),2,3),RCLINE,32,80)
"RTN","RCDPRPLM",75,0)
 .   .   .   D SET("Bank #",RCLINE,47,80,.08)
"RTN","RCDPRPLM",76,0)
 .   .   ; receipt type of payment is credit
"RTN","RCDPRPLM",77,0)
 .   .   I RCDPDATA(344,RCRECTDA,.04,"I")=7 D
"RTN","RCDPRPLM",78,0)
 .   .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",79,0)
 .   .   .   D SET("      Card #",RCLINE,1,80,.11)
"RTN","RCDPRPLM",80,0)
 .   .   .   D SET("Confirmation #",RCLINE,35,80,.02)
"RTN","RCDPRPLM",81,0)
 .   ;
"RTN","RCDPRPLM",82,0)
 .   ; show line 3 for acct lookup, batch and seq #
"RTN","RCDPRPLM",83,0)
 .   I $G(^DISV(DUZ,"RCDPRPLM","SHOWACCT")) D
"RTN","RCDPRPLM",84,0)
 .   .   I RCDPDATA(344.01,RCTRDA,.21,"E")="",RCDPDATA(344.01,RCTRDA,.22,"E")="",RCDPDATA(344.01,RCTRDA,.23,"E")="" Q
"RTN","RCDPRPLM",85,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",86,0)
 .   .   D SET("      AcctLU",RCLINE,1,80,.21)
"RTN","RCDPRPLM",87,0)
 .   .   D SET("Batch/Sequence: "_RCDPDATA(344.01,RCTRDA,.22,"E")_"/"_RCDPDATA(344.01,RCTRDA,.23,"E"),RCLINE,37,80)
"RTN","RCDPRPLM",88,0)
 .   ;
"RTN","RCDPRPLM",89,0)
 .   ; show if posting error
"RTN","RCDPRPLM",90,0)
 .   I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),RCDPDATA(344.01,RCTRDA,1.01,"E")'="" D
"RTN","RCDPRPLM",91,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",92,0)
 .   .   S X="Posting Error"
"RTN","RCDPRPLM",93,0)
 .   .   I RCCANCEL S X="Cancel Data"
"RTN","RCDPRPLM",94,0)
 .   .   D SET("      "_X,RCLINE,1,80,1.01)
"RTN","RCDPRPLM",95,0)
 .   ;
"RTN","RCDPRPLM",96,0)
 .   ; show if comment
"RTN","RCDPRPLM",97,0)
 .   I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),RCDPDATA(344.01,RCTRDA,1.02,"E")'="" D
"RTN","RCDPRPLM",98,0)
 .   .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",99,0)
 .   .   D SET("      Comment",RCLINE,1,80,1.02)
"RTN","RCDPRPLM",100,0)
 .   ;
"RTN","RCDPRPLM",101,0)
 .   ; if EDI Lockbox pending adjustments, show it
"RTN","RCDPRPLM",102,0)
 .   I $P($G(^RCY(344,RCRECTDA,0)),U,18),$G(RCDPDATA(344.01,RCTRDA,.27,"E")) D
"RTN","RCDPRPLM",103,0)
 .   .   S RCZ=$P(^RCY(344,RCRECTDA,0),U,18),RCZ0=RCDPDATA(344.01,RCTRDA,.27,"E")
"RTN","RCDPRPLM",104,0)
 .   .   S RCZ1=0 F  S RCZ1=$O(^RCY(344.49,RCZ,1,RCZ0,1,RCZ1)) Q:'RCZ1  S RCZ2=$G(^(RCZ1,0)) I $P(RCZ2,U,5)'="","12"[$P(RCZ2,U,5),'$P(RCZ2,U,8) D
"RTN","RCDPRPLM",105,0)
 .   .   .   I $P(RCZ2,U,5)=1 S RCLINE=RCLINE+1 D SET("      Pending decrease adjustment for "_$J($P(RCZ2,U,3),"",2),RCLINE,1,80) Q
"RTN","RCDPRPLM",106,0)
 .   .   .   I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),$P(RCZ2,U,5)=2 S RCLINE=RCLINE+1 D SET("      Comment: "_$P(RCZ2,U,9),RCLINE,1,80) Q
"RTN","RCDPRPLM",107,0)
 .   ;
"RTN","RCDPRPLM",108,0)
 .   ; calculate totals
"RTN","RCDPRPLM",109,0)
 .   S RCTOTAL(1)=$G(RCTOTAL(1))+RCDPDATA(344.01,RCTRDA,.04,"E")
"RTN","RCDPRPLM",110,0)
 .   S RCTOTAL(2)=$G(RCTOTAL(2))+RCDPDATA(344.01,RCTRDA,.05,"E")
"RTN","RCDPRPLM",111,0)
 .   ;
"RTN","RCDPRPLM",112,0)
 .   ; kill local variable to prevent store errors
"RTN","RCDPRPLM",113,0)
 .   K RCDPDATA(344.01,RCTRDA)
"RTN","RCDPRPLM",114,0)
 ;
"RTN","RCDPRPLM",115,0)
 ; show totals
"RTN","RCDPRPLM",116,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",117,0)
 S RCLINE=RCLINE+1 D SET("",RCLINE,1,80)
"RTN","RCDPRPLM",118,0)
 D SET("--------  --------",RCLINE,62,80)
"RTN","RCDPRPLM",119,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",120,0)
 D SET("      TOTAL DOLLARS FOR RECEIPT",RCLINE,1,80)
"RTN","RCDPRPLM",121,0)
 D SET($J($G(RCTOTAL(1)),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",122,0)
 D SET($J($G(RCTOTAL(2)),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",123,0)
 ; show cancelled
"RTN","RCDPRPLM",124,0)
 I $G(RCDPFCAN) D
"RTN","RCDPRPLM",125,0)
 .   S RCLINE=RCLINE+1
"RTN","RCDPRPLM",126,0)
 .   D SET("**indicates payment is CANCELLED",RCLINE,5,80)
"RTN","RCDPRPLM",127,0)
 ;
"RTN","RCDPRPLM",128,0)
 ; show history
"RTN","RCDPRPLM",129,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",130,0)
 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",131,0)
 ; start history on first line of a screen if it does not fit on
"RTN","RCDPRPLM",132,0)
 ; current screen
"RTN","RCDPRPLM",133,0)
 I (RCLINE#12)>8 F SPACE=(RCLINE#12):1:12 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",134,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",135,0)
 D SET("Receipt History",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",136,0)
 S DATE=RCDPDATA(344,RCRECTDA,.03,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",137,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",138,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",139,0)
 I RCDPDATA(344,RCRECTDA,.02,"I")=.5 S RCDPDATA(344,RCRECTDA,.02,"E")="accounts receivable"
"RTN","RCDPRPLM",140,0)
 D SET($E("   Opened By: "_RCDPDATA(344,RCRECTDA,.02,"E")_SPACE,1,39)_"Date/Time    Opened: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",141,0)
 S DATE=RCDPDATA(344,RCRECTDA,.12,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",142,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",143,0)
 I RCDPDATA(344,RCRECTDA,.11,"I")=.5 S RCDPDATA(344,RCRECTDA,.11,"E")="accounts receivable"
"RTN","RCDPRPLM",144,0)
 D SET($E("Last Edit By: "_RCDPDATA(344,RCRECTDA,.11,"E")_SPACE,1,39)_"Date/Time Last Edit: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",145,0)
 S DATE=RCDPDATA(344,RCRECTDA,.08,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",146,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",147,0)
 I RCDPDATA(344,RCRECTDA,.07,"I")=.5 S RCDPDATA(344,RCRECTDA,.07,"E")="accounts receivable"
"RTN","RCDPRPLM",148,0)
 D SET($E("Processed By: "_RCDPDATA(344,RCRECTDA,.07,"E")_SPACE,1,39)_"Date/Time Processed: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",149,0)
 ;
"RTN","RCDPRPLM",150,0)
 ; show fms code sheets if switch on
"RTN","RCDPRPLM",151,0)
 I $G(^DISV(DUZ,"RCDPRPLM","SHOWFMS")) D
"RTN","RCDPRPLM",152,0)
 .   S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",153,0)
 .   S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",154,0)
 .   S RCLINE=RCLINE+1 D SET("FMS Cash Receipt Document:",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",155,0)
 .   D SET($P(FMSDOC,"^")_$S($P(FMSDOC,"^",3):"(on deposit)",1:""),RCLINE,28,80)
"RTN","RCDPRPLM",156,0)
 .   D SET("Status: "_$P(FMSDOC,"^",2),RCLINE,55,80)
"RTN","RCDPRPLM",157,0)
 .   N DIQ2 D DATA^GECSSGET($P(FMSDOC,"^"),1)
"RTN","RCDPRPLM",158,0)
 .   I '$G(GECSDATA) Q
"RTN","RCDPRPLM",159,0)
 .   S GECSDA1=0 F  S GECSDA1=$O(GECSDATA(2100.1,GECSDATA,10,GECSDA1)) Q:'GECSDA1  D
"RTN","RCDPRPLM",160,0)
 .   .   S RCLINE=RCLINE+1 D SET(GECSDATA(2100.1,GECSDATA,10,GECSDA1),RCLINE,1,80)
"RTN","RCDPRPLM",161,0)
 ;
"RTN","RCDPRPLM",162,0)
 ; show EEOB detail if switch on
"RTN","RCDPRPLM",163,0)
 D SHEOB^RCDPRPL2
"RTN","RCDPRPLM",164,0)
 ;
"RTN","RCDPRPLM",165,0)
 ; set valmcnt to # of lines in list
"RTN","RCDPRPLM",166,0)
 S VALMCNT=RCLINE
"RTN","RCDPRPLM",167,0)
 D HDR
"RTN","RCDPRPLM",168,0)
 Q
"RTN","RCDPRPLM",169,0)
 ;
"RTN","RCDPRPLM",170,0)
 ;
"RTN","RCDPRPLM",171,0)
SET(STRING,LINE,COLBEG,COLEND,FIELD,ON,OFF) ;  set array
"RTN","RCDPRPLM",172,0)
 I $G(FIELD) S STRING=STRING_$S(STRING="":"",1:": ")_$G(RCDPDATA(344.01,RCTRDA,FIELD,"E"))
"RTN","RCDPRPLM",173,0)
 I STRING="",'$G(FIELD) D SET^VALM10(LINE,$J("",80)) Q
"RTN","RCDPRPLM",174,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RCDPRPLM",175,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLBEG,COLEND-COLBEG+1))
"RTN","RCDPRPLM",176,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLBEG,$L(STRING),ON,OFF)
"RTN","RCDPRPLM",177,0)
 Q
"RTN","RCDPRPLM",178,0)
 ;
"RTN","RCDPRPLM",179,0)
 ;
"RTN","RCDPRPLM",180,0)
DIQ344(DA,DR) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",181,0)
 N %I,D0,DIC,DIQ,DIQ2,YY
"RTN","RCDPRPLM",182,0)
 K RCDPDATA(344,DA)
"RTN","RCDPRPLM",183,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",184,0)
 Q
"RTN","RCDPRPLM",185,0)
 ;
"RTN","RCDPRPLM",186,0)
 ;
"RTN","RCDPRPLM",187,0)
DIQ34401(DA,SUBDA) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",188,0)
 ; da = receipt da
"RTN","RCDPRPLM",189,0)
 N %I,D0,DIC,DIQ,DIQ2,DR
"RTN","RCDPRPLM",190,0)
 K RCDPDATA(344.01,SUBDA)
"RTN","RCDPRPLM",191,0)
 S DR=1,DR(344.01)=".01:1.02",DA(344.01)=SUBDA
"RTN","RCDPRPLM",192,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",193,0)
 Q
"RTN","RCDPRPLM",194,0)
 ;
"RTN","RCDPRPLM",195,0)
 ;
"RTN","RCDPRPLM",196,0)
HDR ; header code for list manager display
"RTN","RCDPRPLM",197,0)
 N DATE,FMSDOC,RCDPDATA,SPACE,RCEFT,Z
"RTN","RCDPRPLM",198,0)
 D DIQ344(RCRECTDA,".01;.04;.06;.08;.14;.17;.18;")
"RTN","RCDPRPLM",199,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",200,0)
 S VALMHDR(1)=$E("   Receipt #: "_RCDPDATA(344,RCRECTDA,.01,"E")_SPACE,1,39)_"Type of Payment: "_RCDPDATA(344,RCRECTDA,.04,"E")
"RTN","RCDPRPLM",201,0)
 S Z=RCDPDATA(344,RCRECTDA,.06,"E"),RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",202,0)
 S VALMHDR(2)=$E($S('RCEFT&'RCDPDATA(344,RCRECTDA,.17,"I"):"   Deposit #: "_Z,RCEFT:" EFT Deposit: "_Z,1:"EFT Detail #: "_RCDPDATA(344,RCRECTDA,.17,"E"))_" "_$P($G(^RCY(344.31,+RCDPDATA(344,RCRECTDA,.17,"I"),0)),U,2)_SPACE,1,23)
"RTN","RCDPRPLM",203,0)
 S VALMHDR(2)=VALMHDR(2)_$E($S(RCDPDATA(344,RCRECTDA,.18,"E")'="":"   ERA #: "_RCDPDATA(344,RCRECTDA,.18,"E"),1:"")_SPACE,1,16)_" Receipt Status: "_RCDPDATA(344,RCRECTDA,.14,"E")
"RTN","RCDPRPLM",204,0)
 ;  get fms document and status
"RTN","RCDPRPLM",205,0)
 S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",206,0)
 S VALMHDR(3)=$E("FMS Document: "_$TR($P(FMSDOC,"^")," ")_$S($P(FMSDOC,"^",3):"(on deposit)",1:"")_SPACE,1,39)_" FMS Doc Status: "_$P(FMSDOC,"^",2)
"RTN","RCDPRPLM",207,0)
 ;
"RTN","RCDPRPLM",208,0)
 I RCDPDATA(344,RCRECTDA,.08,"I") S VALMSG="Receipt processed on "_RCDPDATA(344,RCRECTDA,.08,"E")
"RTN","RCDPRPLM",209,0)
 Q
"RTN","RCDPRPLM",210,0)
 ;
"RTN","RCDPRPLM",211,0)
 ;
"RTN","RCDPRPLM",212,0)
EXIT ; exit option/clean up
"RTN","RCDPRPLM",213,0)
 K ^TMP("RCDPRPLM",$J)
"RTN","RCDPRPLM",214,0)
 Q
"RTN","RCDPURED")
0^3^B31310164
"RTN","RCDPURED",1,0)
RCDPURED ;WISC/RFJ-file 344 receipt/payment dd calls ;1 Jun 99
"RTN","RCDPURED",2,0)
 ;;4.5;Accounts Receivable;**114,169,174,196**;Mar 20, 1995
"RTN","RCDPURED",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURED",4,0)
 Q
"RTN","RCDPURED",5,0)
 ;
"RTN","RCDPURED",6,0)
 ;
"RTN","RCDPURED",7,0)
 ;  ***** dd references from file 344 (receipts) *****
"RTN","RCDPURED",8,0)
 ;
"RTN","RCDPURED",9,0)
 ;
"RTN","RCDPURED",10,0)
DUPLCATE ;  called by input transform receipt number (.01)
"RTN","RCDPURED",11,0)
 ;  make sure no duplicate receipt numbers
"RTN","RCDPURED",12,0)
 I $O(^RCY(344,"B",X,"")) K X W !,"This is a duplicate receipt number." Q
"RTN","RCDPURED",13,0)
 I $O(^PRCA(433,"AF",X,"")) K X W !,"This receipt number has already been used and has been purged from the system. " K X
"RTN","RCDPURED",14,0)
 Q
"RTN","RCDPURED",15,0)
 ;
"RTN","RCDPURED",16,0)
 ;
"RTN","RCDPURED",17,0)
PAYCOUNT(RCRECTDA) ;  called by computed field number of transactions (101)
"RTN","RCDPURED",18,0)
 ;  return the count of payments for the receipt
"RTN","RCDPURED",19,0)
 N COUNT,X
"RTN","RCDPURED",20,0)
 S COUNT=0
"RTN","RCDPURED",21,0)
 S X=0 F  S X=$O(^RCY(344,+$G(RCRECTDA),1,X)) Q:'X  S COUNT=COUNT+1
"RTN","RCDPURED",22,0)
 Q COUNT
"RTN","RCDPURED",23,0)
 ;
"RTN","RCDPURED",24,0)
 ;
"RTN","RCDPURED",25,0)
PAYTOTAL(RCRECTDA) ;  called by computed field total amount of receipts (.15)
"RTN","RCDPURED",26,0)
 ;  return the total dollars for payments entered for the receipt
"RTN","RCDPURED",27,0)
 N TOTAL,X
"RTN","RCDPURED",28,0)
 S TOTAL=0
"RTN","RCDPURED",29,0)
 S X=0 F  S X=$O(^RCY(344,+$G(RCRECTDA),1,X)) Q:'X  S TOTAL=TOTAL+$P($G(^(X,0)),"^",4)
"RTN","RCDPURED",30,0)
 Q TOTAL
"RTN","RCDPURED",31,0)
 ;
"RTN","RCDPURED",32,0)
 ;
"RTN","RCDPURED",33,0)
 ;  ***** dd references from sub-file 344.01 (transactions) *****
"RTN","RCDPURED",34,0)
 ;
"RTN","RCDPURED",35,0)
 ;
"RTN","RCDPURED",36,0)
CHGAMT ;  called from the input transform on the transaction amount (.04)
"RTN","RCDPURED",37,0)
 ;  field.  if the amount is changed, this will create a new cancelled
"RTN","RCDPURED",38,0)
 ;  transaction showing the original amount before the change.
"RTN","RCDPURED",39,0)
 N ORIGDATA,TRANDA
"RTN","RCDPURED",40,0)
 S ORIGDATA=^RCY(344,DA(1),1,DA,0)
"RTN","RCDPURED",41,0)
 ;  no original payment amount
"RTN","RCDPURED",42,0)
 I '$P(ORIGDATA,"^",4) Q
"RTN","RCDPURED",43,0)
 ;  payment amount did not change
"RTN","RCDPURED",44,0)
 I +$P(ORIGDATA,"^",4)=+X Q
"RTN","RCDPURED",45,0)
 ;  payment amount increased
"RTN","RCDPURED",46,0)
 I $P(ORIGDATA,"^",4)<X Q
"RTN","RCDPURED",47,0)
 ;  amount was changed
"RTN","RCDPURED",48,0)
 ;  enter a new transaction
"RTN","RCDPURED",49,0)
 S TRANDA=$$ADDTRAN^RCDPURET(DA(1))
"RTN","RCDPURED",50,0)
 I 'TRANDA W !,"  Unable to edit amount." K X Q
"RTN","RCDPURED",51,0)
 ;  copy the current data for the transaction
"RTN","RCDPURED",52,0)
 ;  do not use fileman, will overwrite variables
"RTN","RCDPURED",53,0)
 ;  set the cancel comment (field 1.01)
"RTN","RCDPURED",54,0)
 S $P(^RCY(344,DA(1),1,TRANDA,1),"^")="Amount $"_$P(ORIGDATA,"^",4)_" decreased in original trans#"_DA
"RTN","RCDPURED",55,0)
 ;  set the payment amount to zero (for cancelled)
"RTN","RCDPURED",56,0)
 S $P(ORIGDATA,"^",4)=0
"RTN","RCDPURED",57,0)
 S $P(ORIGDATA,"^",14)=DUZ
"RTN","RCDPURED",58,0)
 S $P(^RCY(344,DA(1),1,TRANDA,0),"^",2,99)=$P(ORIGDATA,"^",2,99)
"RTN","RCDPURED",59,0)
 Q
"RTN","RCDPURED",60,0)
 ;
"RTN","RCDPURED",61,0)
 ;
"RTN","RCDPURED",62,0)
PAYCHK ;  called from the input transform on the transaction amount (.04)
"RTN","RCDPURED",63,0)
 ;  field.  This will compare the amount paid with the amount owed
"RTN","RCDPURED",64,0)
 ;  for a bill.
"RTN","RCDPURED",65,0)
 N ACCOUNT,AMOUNT,OWED
"RTN","RCDPURED",66,0)
 S ACCOUNT=$P($G(^RCY(344,DA(1),1,DA,0)),"^",3)
"RTN","RCDPURED",67,0)
 ;  quit, account not a bill
"RTN","RCDPURED",68,0)
 I ACCOUNT'["PRCA(430," Q
"RTN","RCDPURED",69,0)
 ;  quit, account is a patient
"RTN","RCDPURED",70,0)
 I $P($G(^RCD(340,+$P($G(^PRCA(430,+ACCOUNT,0)),"^",9),0)),"^")[";DPT(" Q
"RTN","RCDPURED",71,0)
 ;  calculate amount owed for a bill
"RTN","RCDPURED",72,0)
 S OWED=$G(^PRCA(430,+ACCOUNT,7))
"RTN","RCDPURED",73,0)
 S OWED=$P(OWED,"^")+$P(OWED,"^",2)+$P(OWED,"^",3)+$P(OWED,"^",4)+$P(OWED,"^",5)
"RTN","RCDPURED",74,0)
 ;  compare amount paid (in x) with amount owed (if not processed 0;7)
"RTN","RCDPURED",75,0)
 I X>OWED,'$P($G(^RCY(344,DA(1),0)),"^",7) W "  WARNING: Payment amount greater than amount of bill!"
"RTN","RCDPURED",76,0)
 ;  check for other bills
"RTN","RCDPURED",77,0)
 S AMOUNT=$$EOB^IBCNSBL2(+ACCOUNT,+$P($G(^PRCA(430,+ACCOUNT,0)),"^",3),$$PAID^PRCAFN1(+ACCOUNT))
"RTN","RCDPURED",78,0)
 I AMOUNT W !!,$P(AMOUNT,"^",2)," may also be billable.",!
"RTN","RCDPURED",79,0)
 Q
"RTN","RCDPURED",80,0)
 ;
"RTN","RCDPURED",81,0)
 ;
"RTN","RCDPURED",82,0)
PNORBILL ;  called by the input transform in receipt file 344, transaction
"RTN","RCDPURED",83,0)
 ;  multiple (field 1), patient name or bill number (sub field .09)
"RTN","RCDPURED",84,0)
 I $L(X)>20!($L(X)<1) K X Q
"RTN","RCDPURED",85,0)
 ;
"RTN","RCDPURED",86,0)
 N DFN,RCBILL,RCINPUT,RCOUTPUT,Y
"RTN","RCDPURED",87,0)
 ;
"RTN","RCDPURED",88,0)
 S RCINPUT=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCDPURED",89,0)
 ;  try and lookup on bill number
"RTN","RCDPURED",90,0)
 S X=$S($O(^PRCA(430,"B",RCINPUT,0)):$O(^(0))_";PRCA(430,",$O(^PRCA(430,"D",RCINPUT,0)):$O(^(0))_";PRCA(430,",1:RCINPUT)
"RTN","RCDPURED",91,0)
 I X[";PRCA(430," D DISPLAY(X)
"RTN","RCDPURED",92,0)
 ;  bill not found, try and lookup on patient
"RTN","RCDPURED",93,0)
 I X=RCINPUT S DIC="^DPT(",DIC(0)="EM" D ^DIC S X=+Y_";DPT("
"RTN","RCDPURED",94,0)
 ;  new value in variable X (output in X)
"RTN","RCDPURED",95,0)
 ;
"RTN","RCDPURED",96,0)
 ;  patient not found, type of payment = check/mo
"RTN","RCDPURED",97,0)
 I +$G(Y)<0,($P($G(^RCY(344,DA(1),0)),"^",4)=4) D
"RTN","RCDPURED",98,0)
 .   S (X,Y)=$$REC^IBRFN(RCINPUT),(RCBILL,X)=X_";PRCA(430,"
"RTN","RCDPURED",99,0)
 .   I Y>0 D
"RTN","RCDPURED",100,0)
 .   .   N DIR,DIQ2,DIRUT,DTOUT,DUOUT
"RTN","RCDPURED",101,0)
 .   .   S DIR("A")="Is this TRICARE reference number - "_RCINPUT
"RTN","RCDPURED",102,0)
 .   .   S DIR("B")="No",DIR("A",1)=" "
"RTN","RCDPURED",103,0)
 .   .   S DIR(0)="Y^O" D ^DIR S:'Y Y=-1
"RTN","RCDPURED",104,0)
 .   .   I Y'>0 Q
"RTN","RCDPURED",105,0)
 .   .   W !!,$P($G(^PRCA(430,+RCBILL,0)),"^")," "
"RTN","RCDPURED",106,0)
 .   .   D DISPLAY(RCBILL)
"RTN","RCDPURED",107,0)
 .   .   S X=RCBILL
"RTN","RCDPURED",108,0)
 ;  output in variable X
"RTN","RCDPURED",109,0)
 ;
"RTN","RCDPURED",110,0)
 I +$G(Y)<0 K X Q
"RTN","RCDPURED",111,0)
 ;
"RTN","RCDPURED",112,0)
 S RCOUTPUT=X
"RTN","RCDPURED",113,0)
 ;
"RTN","RCDPURED",114,0)
 ;  patient account, show messages and quit (output still in variable X)
"RTN","RCDPURED",115,0)
 I RCOUTPUT[";DPT(" D CHECKPAT(+RCOUTPUT) Q
"RTN","RCDPURED",116,0)
 ;
"RTN","RCDPURED",117,0)
 ;  bill account
"RTN","RCDPURED",118,0)
 I $$IB^IBRUTL(+RCOUTPUT) W " ... This bill appears to have other patient bills on 'hold'."
"RTN","RCDPURED",119,0)
 S X=$P($G(^RCD(340,+$P(^PRCA(430,+RCOUTPUT,0),"^",9),0)),"^")
"RTN","RCDPURED",120,0)
 I X[";DPT(" D CHECKPAT(+X)
"RTN","RCDPURED",121,0)
 S X=RCOUTPUT
"RTN","RCDPURED",122,0)
 Q
"RTN","RCDPURED",123,0)
 ;
"RTN","RCDPURED",124,0)
 ;
"RTN","RCDPURED",125,0)
CHECKPAT(DFN) ;  check patient for other charges, etc., show message
"RTN","RCDPURED",126,0)
 N X
"RTN","RCDPURED",127,0)
 S X="IBARXEU" X ^%ZOSF("TEST")
"RTN","RCDPURED",128,0)
 I $T S X=$$RXST^IBARXEU(DFN,DT) I X D
"RTN","RCDPURED",129,0)
 .   W !?2,"* Patient is exempt from RX Copay: ",$P(X,"^",4)," *"
"RTN","RCDPURED",130,0)
 S X="PSOCOPAY" X ^%ZOSF("TEST")
"RTN","RCDPURED",131,0)
 I $T S X=$$POT^PSOCOPAY(DFN) I X D
"RTN","RCDPURED",132,0)
 .   W !?2,"* This patient has ",X,"-30 day RX's totaling $",(X*7),".00 that are potentially *"
"RTN","RCDPURED",133,0)
 .   W !?2,"* billable.  This represents any Window Rx's issued today. *"
"RTN","RCDPURED",134,0)
 Q
"RTN","RCDPURED",135,0)
 ;
"RTN","RCDPURED",136,0)
 ;
"RTN","RCDPURED",137,0)
DISPLAY(RCBILLDA) ;  display bill
"RTN","RCDPURED",138,0)
 N DATA
"RTN","RCDPURED",139,0)
 S DATA=$P(^PRCA(430,+RCBILLDA,0),"^",9) W:DATA "  ",$$NAM^RCFN01(DATA)
"RTN","RCDPURED",140,0)
 S DATA=$P(^PRCA(430,+RCBILLDA,0),"^",8) I DATA D
"RTN","RCDPURED",141,0)
 .   W "   ",$P(^PRCA(430.3,DATA,0),"^")
"RTN","RCDPURED",142,0)
 .   I $P(^PRCA(430.3,DATA,0),"^",3)'=102,$P($G(^RCD(340,+$P(^PRCA(430,+RCBILLDA,0),"^",9),0)),"^")'[";DPT(" W !,"This bill is not in 'active' status."
"RTN","RCDPURED",143,0)
 S DATA=$G(^PRCA(430,+RCBILLDA,7)) W "   $",$J($P(DATA,"^")+$P(DATA,"^",2)+$P(DATA,"^",3)+$P(DATA,"^",4)+$P(DATA,"^",5),1,2)
"RTN","RCDPURED",144,0)
 Q
"RTN","RCDPURED",145,0)
 ;
"RTN","RCDPURED",146,0)
 ;
"RTN","RCDPURED",147,0)
PAYDATE ;  called by the input transform in receipt file 344, transaction
"RTN","RCDPURED",148,0)
 ;  multiple (field 1), date of payment (sub field .06)
"RTN","RCDPURED",149,0)
 ;  date of payment not in future or more than one month ago
"RTN","RCDPURED",150,0)
 N DAYSDIFF
"RTN","RCDPURED",151,0)
 S DAYSDIFF=$$FMDIFF^XLFDT(X,DT)
"RTN","RCDPURED",152,0)
 I DAYSDIFF<-31!(DAYSDIFF>0) K X
"RTN","RCDPURED",153,0)
 Q
"RTN","RCDPURED",154,0)
 ;
"RTN","RCDPURED",155,0)
 ;
"RTN","RCDPURED",156,0)
 ;  ***** dd references from file 344.1 (deposits) *****
"RTN","RCDPURED",157,0)
 ;
"RTN","RCDPURED",158,0)
 ;
"RTN","RCDPURED",159,0)
RECTOTAL(RCDEPTDA) ;  called from computed field TOTAL AMT OF RECEIPTS (.18) in
"RTN","RCDPURED",160,0)
 ;  deposit file (344.1)
"RTN","RCDPURED",161,0)
 ;  this returns the total dollars paid for all receipts on deposit ticket
"RTN","RCDPURED",162,0)
 N RCRECTDA,TOTAL
"RTN","RCDPURED",163,0)
 S TOTAL=0
"RTN","RCDPURED",164,0)
 S RCRECTDA=0 F  S RCRECTDA=$O(^RCY(344,"AD",+RCDEPTDA,RCRECTDA)) Q:'RCRECTDA  D
"RTN","RCDPURED",165,0)
 .   S TOTAL=TOTAL+$$PAYTOTAL(RCRECTDA)
"RTN","RCDPURED",166,0)
 Q TOTAL
"RTN","RCDPURED",167,0)
 ;
"RTN","RCDPURED",168,0)
 ;
"RTN","RCDPURED",169,0)
RECCOUNT(RCDEPTDA) ;  called from computed field TOTAL RECEIPTS (100) in deposit file (344.1)
"RTN","RCDPURED",170,0)
 ;  this returns a count of the number of receipts on a deposit ticket
"RTN","RCDPURED",171,0)
 N RCRECTDA,COUNT
"RTN","RCDPURED",172,0)
 S COUNT=0
"RTN","RCDPURED",173,0)
 S RCRECTDA=0 F  S RCRECTDA=$O(^RCY(344,"AD",+RCDEPTDA,RCRECTDA)) Q:'RCRECTDA  D
"RTN","RCDPURED",174,0)
 .   S COUNT=COUNT+1
"RTN","RCDPURED",175,0)
 Q COUNT
"RTN","RCDPURET")
0^4^B48328076
"RTN","RCDPURET",1,0)
RCDPURET ;WISC/RFJ-receipt utilities (transactions) ;1 Jun 99
"RTN","RCDPURET",2,0)
 ;;4.5;Accounts Receivable;**114,141,169,173,196**;Mar 20, 1995
"RTN","RCDPURET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURET",4,0)
 Q
"RTN","RCDPURET",5,0)
 ;
"RTN","RCDPURET",6,0)
 ;
"RTN","RCDPURET",7,0)
SELTRAN(DA) ;  select a transaction for a receipt
"RTN","RCDPURET",8,0)
 ;  returns -1 for timeout or ^, 0 for no selection, or ien of trans
"RTN","RCDPURET",9,0)
 N %,DIC,DTOUT,DUOUT,RCDATA,X,Y
"RTN","RCDPURET",10,0)
 S DIC="^RCY(344,"_DA_",1,",DIC(0)="QEAM",DIC("A")="Select Receipt TRANSACTION #: "
"RTN","RCDPURET",11,0)
 S DIC("W")="S RCDATA=@(DIC_Y_"",0)"") W:$P(RCDATA,U,3) ?8,""  "",$P(@(U_$P($P(RCDATA,U,3),"";"",2)_+$P(RCDATA,U,3)_"",0)""),U) W ?40,""  $ "",$J($P(RCDATA,U,4),0,2)"
"RTN","RCDPURET",12,0)
 D ^DIC
"RTN","RCDPURET",13,0)
 I Y<0,'$G(DTOUT),'$G(DUOUT) S Y=0
"RTN","RCDPURET",14,0)
 Q +Y
"RTN","RCDPURET",15,0)
 ;
"RTN","RCDPURET",16,0)
 ;
"RTN","RCDPURET",17,0)
ADDTRAN(RECTDA) ;  add transaction for receipt (in da)
"RTN","RCDPURET",18,0)
 N %DT,%T,D0,DA,DD,DI,DIC,DIE,DINUM,DLAYGO,DO,DQ,DR,X,Y
"RTN","RCDPURET",19,0)
 I '$D(^RCY(344,RECTDA,1,0)) S ^(0)="^344.01A^"
"RTN","RCDPURET",20,0)
 ;
"RTN","RCDPURET",21,0)
 ;  find next transaction number
"RTN","RCDPURET",22,0)
 S X=$O(^RCY(344,RECTDA,1,9999999),-1)
"RTN","RCDPURET",23,0)
 F X=X+1:1 Q:'$D(^RCY(344,RECTDA,1,X,0))
"RTN","RCDPURET",24,0)
 S DINUM=X
"RTN","RCDPURET",25,0)
 ;
"RTN","RCDPURET",26,0)
 S DA(1)=RECTDA
"RTN","RCDPURET",27,0)
 S DIC="^RCY(344,"_RECTDA_",1,",DIC(0)="L",DLAYGO=344.01
"RTN","RCDPURET",28,0)
 S DIC("DR")=".12////"_DUZ_";.06///TODAY;"
"RTN","RCDPURET",29,0)
 D FILE^DICN
"RTN","RCDPURET",30,0)
 Q +Y
"RTN","RCDPURET",31,0)
 ;
"RTN","RCDPURET",32,0)
 ;
"RTN","RCDPURET",33,0)
EDITTRAN(RECTDA,TRANDA) ;  edit a receipt transaction
"RTN","RCDPURET",34,0)
 ;  returns 1 for success, or 0 (error message)
"RTN","RCDPURET",35,0)
 I '$D(^RCY(344,RECTDA,1,TRANDA,0)) Q 0
"RTN","RCDPURET",36,0)
 ;
"RTN","RCDPURET",37,0)
 N %,%DT,%T,%Y,C,D,D0,D1,DA,DATA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DIU,DIV,DIW,DG,DQ,DR,DZ,RCAMOUNT,RCTYPE,RESULT,X,Y
"RTN","RCDPURET",38,0)
 N RCXAMONT,RCXSUSP,RCXADJ,RCERA,RCADJ
"RTN","RCDPURET",39,0)
 ;
"RTN","RCDPURET",40,0)
 ;  build dr string based on type of payment on receipt
"RTN","RCDPURET",41,0)
 S RCTYPE=$P($G(^RC(341.1,+$P(^RCY(344,RECTDA,0),"^",4),0)),"^",2)
"RTN","RCDPURET",42,0)
 S RCADJ=0,RCERA=+$O(^RCY(344.4,"AREC",RECTDA,0))
"RTN","RCDPURET",43,0)
 S DR=""
"RTN","RCDPURET",44,0)
 I RCERA,$D(^RCY(344.49,+RCERA,0)),$P(^RCY(344,RECTDA,1,TRANDA,0),"^",28) D  ; Worklist has a dec adj associated with it
"RTN","RCDPURET",45,0)
 . N Z,RCXERA
"RTN","RCDPURET",46,0)
 . S Z=$$EXTERNAL^DILFD(344.01,.09,,$P($G(^RCY(344,RECTDA,1,TRANDA,0)),U,9))
"RTN","RCDPURET",47,0)
 . S RCADJ=1,RCXERA="W !,""NOTE: This payment has an EEOB Worklist dec adj associated with it."",!,""BILL NUMBER: "_Z_" (uneditable)""",DR="X RCXERA;"
"RTN","RCDPURET",48,0)
 E  D
"RTN","RCDPURET",49,0)
 . ;  patient name or bill number
"RTN","RCDPURET",50,0)
 . S DR=".09;"
"RTN","RCDPURET",51,0)
 S DR=DR_"S Y=$S('$P(^RCY(344,DA(1),1,DA,0),U,9):""@1"",1:""@2"");"
"RTN","RCDPURET",52,0)
 ;  ask comment if no acct (unapplied)
"RTN","RCDPURET",53,0)
 S RCXSUSP="W !?5,""NOTE: This payment will be posted to the station's suspense fund."""
"RTN","RCDPURET",54,0)
 S DR=DR_"@1;X RCXSUSP;1.02;S Y=""@3"";"
"RTN","RCDPURET",55,0)
 ;  payment amount
"RTN","RCDPURET",56,0)
 S RCXAMONT="W !,""  Amount Owed: $"",$J($$PAYDEF^RCDPURET($P(^RCY(344,DA(1),1,DA,0),U,9)),0,2)"
"RTN","RCDPURET",57,0)
 S DR=DR_"@2;X RCXAMONT;@3;.04;"
"RTN","RCDPURET",58,0)
 ;  date of payment
"RTN","RCDPURET",59,0)
 S DR=DR_".06;"
"RTN","RCDPURET",60,0)
 ;  type of payment = district counsel (3), check (4),
"RTN","RCDPURET",61,0)
 ;                    dept of justice  (5), irs (11),
"RTN","RCDPURET",62,0)
 ;                    lockbox (12)
"RTN","RCDPURET",63,0)
 I RCTYPE=3!(RCTYPE=4)!(RCTYPE=5)!(RCTYPE=11)!(RCTYPE=12)!(RCTYPE=13) D
"RTN","RCDPURET",64,0)
 .   S DR=DR_".07d;"     ; check number
"RTN","RCDPURET",65,0)
 .   S DR=DR_".08d;"     ; bank number
"RTN","RCDPURET",66,0)
 .   S DR=DR_".1d;"      ; date of check
"RTN","RCDPURET",67,0)
 ;  type of payment = credit card (7)
"RTN","RCDPURET",68,0)
 I RCTYPE=7 D
"RTN","RCDPURET",69,0)
 .   S DR=DR_".11d;"     ; credit card number
"RTN","RCDPURET",70,0)
 .   S DR=DR_".02d;"     ; confirmation number
"RTN","RCDPURET",71,0)
 ;
"RTN","RCDPURET",72,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",73,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",74,0)
 ;  edited by
"RTN","RCDPURET",75,0)
 S DR=DR_".14////"_DUZ
"RTN","RCDPURET",76,0)
 D ^DIE
"RTN","RCDPURET",77,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",78,0)
 ;
"RTN","RCDPURET",79,0)
 ;  check for missing fields
"RTN","RCDPURET",80,0)
 S DATA=^RCY(344,RECTDA,1,TRANDA,0)
"RTN","RCDPURET",81,0)
 S RESULT=1
"RTN","RCDPURET",82,0)
 I RESULT,'$P(DATA,"^",4) S RESULT="Payment Amount is ZERO."
"RTN","RCDPURET",83,0)
 I RESULT,'$P(DATA,"^",6) S RESULT="Date of Payment NOT entered."
"RTN","RCDPURET",84,0)
 I RESULT,RCTYPE=13,$$TRACE($P(DATA,"^",3))="" S RESULT="TOP TRACE NUMBER NOT ENTERED"
"RTN","RCDPURET",85,0)
 I RESULT,RCTYPE=7,$P(DATA,"^",11)="" W !,"WARNING: Credit Card Number NOT entered."
"RTN","RCDPURET",86,0)
 I RESULT,$P(DATA,"^",6)<$P(DATA,"^",10) W !,"WARNING: Date of check is greater than the date of payment."
"RTN","RCDPURET",87,0)
 ;
"RTN","RCDPURET",88,0)
 ;  if field is missing, delete the transaction
"RTN","RCDPURET",89,0)
 I 'RESULT D DELETRAN(RECTDA,TRANDA)
"RTN","RCDPURET",90,0)
 ;
"RTN","RCDPURET",91,0)
 ;  if transaction okay, print receipt
"RTN","RCDPURET",92,0)
 I RESULT D RECEIPT^RCDPRECT(RECTDA,TRANDA)
"RTN","RCDPURET",93,0)
 ;
"RTN","RCDPURET",94,0)
 Q RESULT
"RTN","RCDPURET",95,0)
 ;
"RTN","RCDPURET",96,0)
 ;
"RTN","RCDPURET",97,0)
EDITACCT(RECTDA,TRANDA) ;  edit the account on a receipt
"RTN","RCDPURET",98,0)
 N C,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DISYS,DIU,DIV,DIW,DQ,DR,DZ,X
"RTN","RCDPURET",99,0)
 S DR=".09;"
"RTN","RCDPURET",100,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",101,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",102,0)
 D ^DIE
"RTN","RCDPURET",103,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",104,0)
 Q
"RTN","RCDPURET",105,0)
 ;
"RTN","RCDPURET",106,0)
 ;
"RTN","RCDPURET",107,0)
DELEACCT(RECTDA,TRANDA) ;  delete the account on a receipt
"RTN","RCDPURET",108,0)
 N D,D0,D1,DA,DI,DIC,DICR,DIE,DIG,DIH,DIU,DIV,DIW,DQ,DR,X
"RTN","RCDPURET",109,0)
 S DR=".09///@;.03///@;"
"RTN","RCDPURET",110,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",111,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",112,0)
 D ^DIE
"RTN","RCDPURET",113,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",114,0)
 Q
"RTN","RCDPURET",115,0)
 ;
"RTN","RCDPURET",116,0)
 ;
"RTN","RCDPURET",117,0)
EDITFMS(RECTDA,TRANDA,DEFAULT) ;  edit fms document number for clearing suspense
"RTN","RCDPURET",118,0)
 N C,D,D0,D1,DA,DDH,DI,DIC,DICR,DIE,DIG,DIH,DIPGM,DISYS,DIU,DIV,DIW,DQ,DR,DZ,X
"RTN","RCDPURET",119,0)
 S DR=".26;"
"RTN","RCDPURET",120,0)
 I $G(DEFAULT)'="" S DR=".26////"_DEFAULT_";"
"RTN","RCDPURET",121,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",122,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",123,0)
 D ^DIE
"RTN","RCDPURET",124,0)
 Q
"RTN","RCDPURET",125,0)
 ;
"RTN","RCDPURET",126,0)
 ;
"RTN","RCDPURET",127,0)
MOVETRAN(RCOLDREC,RCOLDTRA,RCNEWREC) ;  move a transactions data
"RTN","RCDPURET",128,0)
 N %DT,%T,D0,D1,DA,DG,DIC,DICR,DIK,DIU,RCNEWTRA,RESULT,X,Y
"RTN","RCDPURET",129,0)
 ;
"RTN","RCDPURET",130,0)
 ;  add new transaction to 2nd receipt
"RTN","RCDPURET",131,0)
 W !,"Adding a NEW payment transaction to receipt "_$P(^RCY(344,RCNEWREC,0),"^")_": "
"RTN","RCDPURET",132,0)
 S RCNEWTRA=$$ADDTRAN(RCNEWREC)
"RTN","RCDPURET",133,0)
 I 'RCNEWTRA Q "Unable to ADD a new payment transaction."
"RTN","RCDPURET",134,0)
 ;
"RTN","RCDPURET",135,0)
 W "# ",RCNEWTRA
"RTN","RCDPURET",136,0)
 ;
"RTN","RCDPURET",137,0)
 ;  move data to selected receipt and re-index entry
"RTN","RCDPURET",138,0)
 S ^RCY(344,RCNEWREC,1,RCNEWTRA,0)=RCNEWTRA_"^"_$P(^RCY(344,RCOLDREC,1,RCOLDTRA,0),"^",2,99)
"RTN","RCDPURET",139,0)
 S DIK="^RCY(344,"_RCNEWREC_",1,",DA(1)=RCNEWREC,DA=RCNEWTRA
"RTN","RCDPURET",140,0)
 D IX^DIK
"RTN","RCDPURET",141,0)
 ;
"RTN","RCDPURET",142,0)
 S RESULT=$$EDITTRAN(RCNEWREC,RCNEWTRA)
"RTN","RCDPURET",143,0)
 Q RESULT
"RTN","RCDPURET",144,0)
 ;
"RTN","RCDPURET",145,0)
 ;
"RTN","RCDPURET",146,0)
CANCTRAN(RECTDA,RECTRAN) ;  cancel a transaction
"RTN","RCDPURET",147,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,RCDATA,X,Y
"RTN","RCDPURET",148,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",149,0)
 S RCDATA="Cancelled by: "_$P(^VA(200,DUZ,0),"^")_"    Amount: $ "_$J($P(^RCY(344,RECTDA,1,RECTRAN,0),"^",4),0,2)
"RTN","RCDPURET",150,0)
 S DR="1.01////^S X=RCDATA;.04////^S X=0;.05////^S X=0;1.02;"
"RTN","RCDPURET",151,0)
 S DA=RECTRAN,DA(1)=RECTDA
"RTN","RCDPURET",152,0)
 D ^DIE
"RTN","RCDPURET",153,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",154,0)
 Q
"RTN","RCDPURET",155,0)
 ;
"RTN","RCDPURET",156,0)
 ;
"RTN","RCDPURET",157,0)
DELETRAN(RECTDA,TRANDA) ;  delete a transaction
"RTN","RCDPURET",158,0)
 N %,D0,D1,DA,DIC,DICR,DIG,DIH,DIK,DIU,DIV,DIW,X,Y
"RTN","RCDPURET",159,0)
 S DIK="^RCY(344,"_RECTDA_",1,",DA(1)=RECTDA,DA=TRANDA
"RTN","RCDPURET",160,0)
 D ^DIK
"RTN","RCDPURET",161,0)
 D LASTEDIT^RCDPUREC(RECTDA)
"RTN","RCDPURET",162,0)
 Q
"RTN","RCDPURET",163,0)
 ;
"RTN","RCDPURET",164,0)
 ;
"RTN","RCDPURET",165,0)
SETUNAPP(RECTDA,TRANDA,UNAPPNUM) ;  store the unapplied deposit number
"RTN","RCDPURET",166,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCDPURET",167,0)
 S (DIC,DIE)="^RCY(344,"_RECTDA_",1,"
"RTN","RCDPURET",168,0)
 S DR=".25////"_UNAPPNUM_";"
"RTN","RCDPURET",169,0)
 S DA=TRANDA,DA(1)=RECTDA
"RTN","RCDPURET",170,0)
 D ^DIE
"RTN","RCDPURET",171,0)
 Q
"RTN","RCDPURET",172,0)
 ;
"RTN","RCDPURET",173,0)
 ;
"RTN","RCDPURET",174,0)
PAYDEF(DEBTOR) ;  get default for payment amount (used in input templates for payments)
"RTN","RCDPURET",175,0)
 N X
"RTN","RCDPURET",176,0)
 I 'DEBTOR Q 0
"RTN","RCDPURET",177,0)
 I DEBTOR[";DPT(" S X=$$BAL^PRCAFN(DEBTOR)
"RTN","RCDPURET",178,0)
 I DEBTOR[";PRCA(430,",",112,107,102,"[(","_$P($G(^PRCA(430.3,+$P($G(^PRCA(430,+DEBTOR,0)),"^",8),0)),"^",3)_",") S X=$G(^PRCA(430,+DEBTOR,7)),X=$P(X,"^")+$P(X,"^",2)+$P(X,"^",3)+$P(X,"^",4)+$P(X,"^",5)
"RTN","RCDPURET",179,0)
 Q +$G(X)
"RTN","RCDPURET",180,0)
 ;
"RTN","RCDPURET",181,0)
 ;
"RTN","RCDPURET",182,0)
PENDPAY(DEBTOR) ;  return pending payments for a debtor
"RTN","RCDPURET",183,0)
 ;  returns ^tmp($j,"rcdpurec","pp",rectda,tranda)=data in 344.01
"RTN","RCDPURET",184,0)
 ;  and the total pending payment dollars
"RTN","RCDPURET",185,0)
 N DATA,RECTDA,TOTAL,TRANDA
"RTN","RCDPURET",186,0)
 K ^TMP($J,"RCDPUREC","PP")
"RTN","RCDPURET",187,0)
 ;  look at open receipts
"RTN","RCDPURET",188,0)
 S RECTDA=0 F  S RECTDA=$O(^RCY(344,"ASTAT",1,RECTDA)) Q:'RECTDA  D
"RTN","RCDPURET",189,0)
 .   S TRANDA=0 F  S TRANDA=$O(^RCY(344,"AACCT",DEBTOR,RECTDA,TRANDA)) Q:'TRANDA  D
"RTN","RCDPURET",190,0)
 .   .   S DATA=$G(^RCY(344,RECTDA,1,TRANDA,0)) I DATA="" Q
"RTN","RCDPURET",191,0)
 .   .   ;  total paid = total processed
"RTN","RCDPURET",192,0)
 .   .   I +$P(DATA,"^",4)=+$P(DATA,"^",5) Q
"RTN","RCDPURET",193,0)
 .   .   S ^TMP($J,"RCDPUREC","PP",RECTDA,TRANDA)=DATA
"RTN","RCDPURET",194,0)
 .   .   S TOTAL=$G(TOTAL)+$P(DATA,"^",4)
"RTN","RCDPURET",195,0)
 Q +$G(TOTAL)
"RTN","RCDPURET",196,0)
TRACE(DEBTOR) ;ENTER TOP TRACE NUMBER FOR TOP RECEIPTS
"RTN","RCDPURET",197,0)
 N TRACE,DIC,DIE,DR,DA
"RTN","RCDPURET",198,0)
 S TRACE="" G TRACEQ:'DEBTOR
"RTN","RCDPURET",199,0)
 S DA=$S(DEBTOR["DPT(":$O(^RCD(340,"B",DEBTOR,0)),1:$P($G(^PRCA(430,+DEBTOR,0)),U,9))
"RTN","RCDPURET",200,0)
 G TRACEQ:'DA
"RTN","RCDPURET",201,0)
 S (DIC,DIE)="^RCD(340,",DR=6.07 D ^DIE
"RTN","RCDPURET",202,0)
 S TRACE=$P($G(^RCD(340,DA,6)),"^",7)
"RTN","RCDPURET",203,0)
TRACEQ Q TRACE
"UP",344,344.01,-1)
344^1
"UP",344,344.01,0)
344.01
"VER")
8.0^22
"^DD",344,344.01,.14,0)
EDITED BY^P200'^VA(200,^0;14^Q
"^DD",344,344.01,.14,21,0)
^^2^2^3031016^
"^DD",344,344.01,.14,21,1,0)
This field contains the person who edited the payment entry into
"^DD",344,344.01,.14,21,2,0)
the AR system.
"^DD",344,344.01,.14,"DT")
3031016
**END**
**END**
