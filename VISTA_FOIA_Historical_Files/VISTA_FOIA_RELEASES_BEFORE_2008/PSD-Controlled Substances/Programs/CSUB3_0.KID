KIDS Distribution saved on Feb 24, 1997@09:23:20
CONTROLLED SUBSTANCES VERSION 3.0
**KIDS**:CONTROLLED SUBSTANCES 3.0^

**INSTALL NAME**
CONTROLLED SUBSTANCES 3.0
"BLD",253,0)
CONTROLLED SUBSTANCES 3.0^CONTROLLED SUBSTANCES^0^2970213^y
"BLD",253,1,0)
^^22^22^2960930^^^
"BLD",253,1,1,0)
     The Controlled Substances software will monitor and track the receipt,
"BLD",253,1,2,0)
inventory, and dispensing of controlled substances.  Automation of the
"BLD",253,1,3,0)
narcotic inventory process will permit pharmacists and inspectors to
"BLD",253,1,4,0)
perform vault inventories utilizing portable bar code readers.  Monthly (or
"BLD",253,1,5,0)
more frequent) inspections can be conducted by management, with
"BLD",253,1,6,0)
discrepancies in stock levels automatically identified.  This software
"BLD",253,1,7,0)
package addresses a Congressional material weakness for Drug
"BLD",253,1,8,0)
Accountability.
"BLD",253,1,9,0)
 
"BLD",253,1,10,0)
NEW FUNCTIONS
"BLD",253,1,11,0)
 
"BLD",253,1,12,0)
o Batch Order Entry process
"BLD",253,1,13,0)
 
"BLD",253,1,14,0)
o Electronic Signature
"BLD",253,1,15,0)
 
"BLD",253,1,16,0)
o Nurse Dispensing with a Radio Frequency Device
"BLD",253,1,17,0)
 
"BLD",253,1,18,0)
o HL7 Interface to Narcotic Dispensing Equipment
"BLD",253,1,19,0)
 
"BLD",253,1,20,0)
o Electronic Error & Enhancement Requests (E3Rs)
"BLD",253,1,21,0)
 
"BLD",253,1,22,0)
o Other Enhancements
"BLD",253,4,0)
^9.64PA^58.89^14
"BLD",253,4,50,0)
50
"BLD",253,4,50,2,0)
^9.641^50^2
"BLD",253,4,50,2,50,0)
DRUG  (File-top level)
"BLD",253,4,50,2,50,1,0)
^9.6411^63^1
"BLD",253,4,50,2,50,1,63,0)
APPLICATION PACKAGES' USE
"BLD",253,4,50,2,50.0441,0)
IFCAP ITEM NUMBER  (sub-file)
"BLD",253,4,50,2,50.0441,1,0)
^9.6411^.01^1
"BLD",253,4,50,2,50.0441,1,.01,0)
ITEM NUMBER
"BLD",253,4,50,222)
y^y^p^^^^n
"BLD",253,4,58.2,0)
58.2
"BLD",253,4,58.2,2,0)
^9.641^58.29^2
"BLD",253,4,58.2,2,58.2,0)
AOU INVENTORY GROUP  (File-top level)
"BLD",253,4,58.2,2,58.2,1,0)
^9.6411^2^1
"BLD",253,4,58.2,2,58.2,1,2,0)
GROUP DESCRIPTION
"BLD",253,4,58.2,2,58.29,0)
NARCOTIC AREA OF USE (NAOU)  (sub-file)
"BLD",253,4,58.2,2,58.29,1,0)
^9.6411^2^2
"BLD",253,4,58.2,2,58.29,1,.01,0)
NARCOTIC AREA OF USE (NAOU)
"BLD",253,4,58.2,2,58.29,1,2,0)
SORT KEY
"BLD",253,4,58.2,222)
y^y^p^^^^n
"BLD",253,4,58.8,0)
58.8
"BLD",253,4,58.8,222)
y^y^f^^^^n
"BLD",253,4,58.81,0)
58.81
"BLD",253,4,58.81,222)
y^y^f^^^^n
"BLD",253,4,58.82,0)
58.82
"BLD",253,4,58.82,222)
y^y^f^^n^^y^m^n
"BLD",253,4,58.83,0)
58.83
"BLD",253,4,58.83,222)
y^y^f^^n^^y^m^n
"BLD",253,4,58.84,0)
58.84
"BLD",253,4,58.84,222)
y^y^f^^n^^y^o^n
"BLD",253,4,58.85,0)
58.85
"BLD",253,4,58.85,222)
y^y^f^^^^n
"BLD",253,4,58.86,0)
58.86
"BLD",253,4,58.86,222)
y^y^f^^^^n
"BLD",253,4,58.87,0)
58.87
"BLD",253,4,58.87,222)
y^y^f^^^^n
"BLD",253,4,58.88,0)
58.88
"BLD",253,4,58.88,222)
y^y^f^^n^^y^o^n
"BLD",253,4,58.89,0)
58.89
"BLD",253,4,58.89,222)
y^y^f^^^^n
"BLD",253,4,59.4,0)
59.4
"BLD",253,4,59.4,2,0)
^9.641^59.4^1
"BLD",253,4,59.4,2,59.4,0)
INPATIENT SITE  (File-top level)
"BLD",253,4,59.4,2,59.4,1,0)
^9.6411^31^1
"BLD",253,4,59.4,2,59.4,1,31,0)
IS SITE SELECTABLE FOR CS?
"BLD",253,4,59.4,222)
y^y^p^^^^n
"BLD",253,4,59.7,0)
59.7
"BLD",253,4,59.7,2,0)
^9.641^59.7^1
"BLD",253,4,59.7,2,59.7,0)
PHARMACY SYSTEM  (File-top level)
"BLD",253,4,59.7,2,59.7,1,0)
^9.6411^71^1
"BLD",253,4,59.7,2,59.7,1,71,0)
DATE V2 CS/DA CONVERSION
"BLD",253,4,59.7,222)
y^y^p^^^^n
"BLD",253,4,"APDD",50,50)

"BLD",253,4,"APDD",50,50,63)

"BLD",253,4,"APDD",50,50.0441)

"BLD",253,4,"APDD",50,50.0441,.01)

"BLD",253,4,"APDD",58.2,58.2)

"BLD",253,4,"APDD",58.2,58.2,2)

"BLD",253,4,"APDD",58.2,58.29)

"BLD",253,4,"APDD",58.2,58.29,.01)

"BLD",253,4,"APDD",58.2,58.29,2)

"BLD",253,4,"APDD",59.4,59.4)

"BLD",253,4,"APDD",59.4,59.4,31)

"BLD",253,4,"APDD",59.7,59.7)

"BLD",253,4,"APDD",59.7,59.7,71)

"BLD",253,4,"B",50,50)

"BLD",253,4,"B",58.2,58.2)

"BLD",253,4,"B",58.8,58.8)

"BLD",253,4,"B",58.81,58.81)

"BLD",253,4,"B",58.82,58.82)

"BLD",253,4,"B",58.83,58.83)

"BLD",253,4,"B",58.84,58.84)

"BLD",253,4,"B",58.85,58.85)

"BLD",253,4,"B",58.86,58.86)

"BLD",253,4,"B",58.87,58.87)

"BLD",253,4,"B",58.88,58.88)

"BLD",253,4,"B",58.89,58.89)

"BLD",253,4,"B",59.4,59.4)

"BLD",253,4,"B",59.7,59.7)

"BLD",253,"ABNS",0)
^9.66A^1^1
"BLD",253,"ABNS",1,0)
PSD
"BLD",253,"ABNS",1,1,0)
^9.661A^^
"BLD",253,"ABNS","B","PSD",1)

"BLD",253,"ABPKG")
n^y^G.CONTROLLED SUBSTANCES TEAM@ISC-BIRM.VA.GOV
"BLD",253,"INIT")
PSDIPOST
"BLD",253,"KRN",0)
^9.67PA^8994^18
"BLD",253,"KRN",.4,0)
.4
"BLD",253,"KRN",.4,"NM",0)
^9.68A^^
"BLD",253,"KRN",.401,0)
.401
"BLD",253,"KRN",.402,0)
.402
"BLD",253,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",253,"KRN",.402,"NM",1,0)
PSD INV GROUP    FILE #58.2^58.2^0
"BLD",253,"KRN",.402,"NM","B","PSD INV GROUP    FILE #58.2",1)

"BLD",253,"KRN",.403,0)
.403
"BLD",253,"KRN",.5,0)
.5
"BLD",253,"KRN",.84,0)
.84
"BLD",253,"KRN",3.6,0)
3.6
"BLD",253,"KRN",3.8,0)
3.8
"BLD",253,"KRN",9.2,0)
9.2
"BLD",253,"KRN",9.2,"NM",0)
^9.68A^16^16
"BLD",253,"KRN",9.2,"NM",1,0)
PSD BALANCE ADJUSTMENT REPORT^^0
"BLD",253,"KRN",9.2,"NM",2,0)
PSD ESIG^^0
"BLD",253,"KRN",9.2,"NM",3,0)
PSD Green Sheets^^0
"BLD",253,"KRN",9.2,"NM",4,0)
PSD HL7^^0
"BLD",253,"KRN",9.2,"NM",5,0)
PSD HL7 ADT^^0
"BLD",253,"KRN",9.2,"NM",6,0)
PSD NURSE^^0
"BLD",253,"KRN",9.2,"NM",7,0)
PSD NURSE FILLED NOT DEL^^0
"BLD",253,"KRN",9.2,"NM",8,0)
PSD NURSE RECEIVE^^0
"BLD",253,"KRN",9.2,"NM",9,0)
PSD NURSE TRANSFER^^0
"BLD",253,"KRN",9.2,"NM",10,0)
PSD ORDER ENTRY^^0
"BLD",253,"KRN",9.2,"NM",11,0)
PSD ORDER ENTRY BANNER^^0
"BLD",253,"KRN",9.2,"NM",12,0)
PSD ORDER ENTRY BATCH^^0
"BLD",253,"KRN",9.2,"NM",13,0)
PSD ORDER ENTRY ONE TIME^^0
"BLD",253,"KRN",9.2,"NM",14,0)
PSD ORDER ENTRY PRIORITY^^0
"BLD",253,"KRN",9.2,"NM",15,0)
PSD ORDER ENTRY REG^^0
"BLD",253,"KRN",9.2,"NM",16,0)
PSD NURSE DISPENSING^^0
"BLD",253,"KRN",9.2,"NM","B","PSD BALANCE ADJUSTMENT REPORT",1)

"BLD",253,"KRN",9.2,"NM","B","PSD ESIG",2)

"BLD",253,"KRN",9.2,"NM","B","PSD Green Sheets",3)

"BLD",253,"KRN",9.2,"NM","B","PSD HL7",4)

"BLD",253,"KRN",9.2,"NM","B","PSD HL7 ADT",5)

"BLD",253,"KRN",9.2,"NM","B","PSD NURSE",6)

"BLD",253,"KRN",9.2,"NM","B","PSD NURSE DISPENSING",16)

"BLD",253,"KRN",9.2,"NM","B","PSD NURSE FILLED NOT DEL",7)

"BLD",253,"KRN",9.2,"NM","B","PSD NURSE RECEIVE",8)

"BLD",253,"KRN",9.2,"NM","B","PSD NURSE TRANSFER",9)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY",10)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY BANNER",11)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY BATCH",12)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY ONE TIME",13)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY PRIORITY",14)

"BLD",253,"KRN",9.2,"NM","B","PSD ORDER ENTRY REG",15)

"BLD",253,"KRN",9.8,0)
9.8
"BLD",253,"KRN",9.8,"NM",0)
^9.68A^500^286
"BLD",253,"KRN",9.8,"NM",1,0)
PSDACT^^0^B13617205
"BLD",253,"KRN",9.8,"NM",2,0)
PSDACT1^^0^B21498088
"BLD",253,"KRN",9.8,"NM",3,0)
PSDACT2^^0^B8308425
"BLD",253,"KRN",9.8,"NM",4,0)
PSDADJ^^0^B19414634
"BLD",253,"KRN",9.8,"NM",5,0)
PSDADJB^^0^B3953559
"BLD",253,"KRN",9.8,"NM",6,0)
PSDADJD^^0^B19183845
"BLD",253,"KRN",9.8,"NM",7,0)
PSDADJI^^0^B13021753
"BLD",253,"KRN",9.8,"NM",8,0)
PSDADJIN^^0^B15788264
"BLD",253,"KRN",9.8,"NM",9,0)
PSDADJN^^0^B17013339
"BLD",253,"KRN",9.8,"NM",10,0)
PSDADJN1^^0^B11486204
"BLD",253,"KRN",9.8,"NM",11,0)
PSDADJR^^0^B12471430
"BLD",253,"KRN",9.8,"NM",12,0)
PSDADJW^^0^B4035384
"BLD",253,"KRN",9.8,"NM",13,0)
PSDADT^^0^B2473275
"BLD",253,"KRN",9.8,"NM",14,0)
PSDADT1^^0^B3870320
"BLD",253,"KRN",9.8,"NM",15,0)
PSDAMIS^^0^B17966068
"BLD",253,"KRN",9.8,"NM",16,0)
PSDAMIS0^^0^B18254052
"BLD",253,"KRN",9.8,"NM",17,0)
PSDAMIS1^^0^B14814729
"BLD",253,"KRN",9.8,"NM",18,0)
PSDAMIS2^^0^B11411474
"BLD",253,"KRN",9.8,"NM",19,0)
PSDAMIS3^^0^B17303379
"BLD",253,"KRN",9.8,"NM",20,0)
PSDAMIS4^^0^B9598560
"BLD",253,"KRN",9.8,"NM",21,0)
PSDAPU^^0^B502049
"BLD",253,"KRN",9.8,"NM",22,0)
PSDBAL^^0^B16952502
"BLD",253,"KRN",9.8,"NM",23,0)
PSDBALI^^0^B22304429
"BLD",253,"KRN",9.8,"NM",24,0)
PSDBALI1^^0^B4606716
"BLD",253,"KRN",9.8,"NM",25,0)
PSDCODE^^0^B1340519
"BLD",253,"KRN",9.8,"NM",26,0)
PSDCOR^^0^B19035165
"BLD",253,"KRN",9.8,"NM",27,0)
PSDCOR1^^0^B18800981
"BLD",253,"KRN",9.8,"NM",28,0)
PSDCOR2^^0^B19079222
"BLD",253,"KRN",9.8,"NM",29,0)
PSDCOR3^^0^B2229614
"BLD",253,"KRN",9.8,"NM",30,0)
PSDCORP^^0^B14173297
"BLD",253,"KRN",9.8,"NM",31,0)
PSDCORP1^^0^B10566121
"BLD",253,"KRN",9.8,"NM",32,0)
PSDCORP2^^0^B10733083
"BLD",253,"KRN",9.8,"NM",33,0)
PSDCORP3^^0^B12257778
"BLD",253,"KRN",9.8,"NM",34,0)
PSDCOSD^^0^B23630436
"BLD",253,"KRN",9.8,"NM",35,0)
PSDCOSH^^0^B14547074
"BLD",253,"KRN",9.8,"NM",36,0)
PSDCOSM^^0^B1880551
"BLD",253,"KRN",9.8,"NM",37,0)
PSDCOSN^^0^B23348931
"BLD",253,"KRN",9.8,"NM",38,0)
PSDCOST^^0^B25005159
"BLD",253,"KRN",9.8,"NM",39,0)
PSDCOSV^^0^B14579143
"BLD",253,"KRN",9.8,"NM",40,0)
PSDCPO^^0^B23741541
"BLD",253,"KRN",9.8,"NM",41,0)
PSDCRP^^0^B23834500
"BLD",253,"KRN",9.8,"NM",42,0)
PSDCSI^^0^B11445386
"BLD",253,"KRN",9.8,"NM",43,0)
PSDCSL^^0^B13279521
"BLD",253,"KRN",9.8,"NM",44,0)
PSDDFP^^0^B19730853
"BLD",253,"KRN",9.8,"NM",45,0)
PSDDFP1^^0^B6209533
"BLD",253,"KRN",9.8,"NM",46,0)
PSDDWK^^0^B22797507
"BLD",253,"KRN",9.8,"NM",47,0)
PSDDWK1^^0^B12826908
"BLD",253,"KRN",9.8,"NM",48,0)
PSDDWK2^^0^B11518632
"BLD",253,"KRN",9.8,"NM",49,0)
PSDDWK3^^0^B10126951
"BLD",253,"KRN",9.8,"NM",50,0)
PSDDWK4^^0^B6150283
"BLD",253,"KRN",9.8,"NM",51,0)
PSDDWKE^^0^B14400956
"BLD",253,"KRN",9.8,"NM",52,0)
PSDEA^^0^B9487363
"BLD",253,"KRN",9.8,"NM",53,0)
PSDEA41^^0^B20089989
"BLD",253,"KRN",9.8,"NM",54,0)
PSDEM^^0^B16894945
"BLD",253,"KRN",9.8,"NM",55,0)
PSDEM1^^0^B20776137
"BLD",253,"KRN",9.8,"NM",56,0)
PSDEM2^^0^B16680372
"BLD",253,"KRN",9.8,"NM",57,0)
PSDEM3^^0^B3790780
"BLD",253,"KRN",9.8,"NM",58,0)
PSDEM4^^0^B9423621
"BLD",253,"KRN",9.8,"NM",59,0)
PSDEN^^0^B13693307
"BLD",253,"KRN",9.8,"NM",60,0)
PSDERCP^^0^B24275506
"BLD",253,"KRN",9.8,"NM",61,0)
PSDERD^^0^B10381061
"BLD",253,"KRN",9.8,"NM",62,0)
PSDERP^^0^B23168392
"BLD",253,"KRN",9.8,"NM",63,0)
PSDEST^^0^B23898580
"BLD",253,"KRN",9.8,"NM",64,0)
PSDESTF^^0^B18152234
"BLD",253,"KRN",9.8,"NM",65,0)
PSDESTO^^0^B20258651
"BLD",253,"KRN",9.8,"NM",66,0)
PSDESTP^^0^B45750361
"BLD",253,"KRN",9.8,"NM",67,0)
PSDEVO^^0^B20418185
"BLD",253,"KRN",9.8,"NM",68,0)
PSDEVO1^^0^B15030044
"BLD",253,"KRN",9.8,"NM",69,0)
PSDEVOR^^0^B22501006
"BLD",253,"KRN",9.8,"NM",70,0)
PSDEXGS^^0^B20092409
"BLD",253,"KRN",9.8,"NM",71,0)
PSDEXGS1^^0^B7890355
"BLD",253,"KRN",9.8,"NM",72,0)
PSDEXP^^0^B22025227
"BLD",253,"KRN",9.8,"NM",73,0)
PSDEXP1^^0^B6286088
"BLD",253,"KRN",9.8,"NM",74,0)
PSDFIL2^^0^B22803738
"BLD",253,"KRN",9.8,"NM",75,0)
PSDFIL3^^0^B22562536
"BLD",253,"KRN",9.8,"NM",76,0)
PSDFILM^^0^B3366310
"BLD",253,"KRN",9.8,"NM",77,0)
PSDFND^^0^B24395301
"BLD",253,"KRN",9.8,"NM",78,0)
PSDFND1^^0^B2479612
"BLD",253,"KRN",9.8,"NM",79,0)
PSDFT^^0^B24149359
"BLD",253,"KRN",9.8,"NM",80,0)
PSDFT1^^0^B30254991
"BLD",253,"KRN",9.8,"NM",81,0)
PSDGEN^^0^B1534371
"BLD",253,"KRN",9.8,"NM",82,0)
PSDGPR^^0^B15883795
"BLD",253,"KRN",9.8,"NM",83,0)
PSDGSH^^0^B4921089
"BLD",253,"KRN",9.8,"NM",84,0)
PSDGSH1^^0^B8266094
"BLD",253,"KRN",9.8,"NM",85,0)
PSDGSH11^^0^B12652900
"BLD",253,"KRN",9.8,"NM",86,0)
PSDGSH2^^0^B19938937
"BLD",253,"KRN",9.8,"NM",87,0)
PSDGSK^^0^B9099516
"BLD",253,"KRN",9.8,"NM",88,0)
PSDGSL^^0^B13103325
"BLD",253,"KRN",9.8,"NM",89,0)
PSDGSL1^^0^B11693912
"BLD",253,"KRN",9.8,"NM",90,0)
PSDGSPU^^0^B11955889
"BLD",253,"KRN",9.8,"NM",91,0)
PSDGSRV^^0^B21185314
"BLD",253,"KRN",9.8,"NM",92,0)
PSDGSRV1^^0^B27359779
"BLD",253,"KRN",9.8,"NM",93,0)
PSDGSRV2^^0^B21258816
"BLD",253,"KRN",9.8,"NM",94,0)
PSDHELP^^0^B220355
"BLD",253,"KRN",9.8,"NM",95,0)
PSDHL7^^0^B11040623
"BLD",253,"KRN",9.8,"NM",96,0)
PSDHLX^^0^B1493655
"BLD",253,"KRN",9.8,"NM",97,0)
PSDHRPT^^0^B24035727
"BLD",253,"KRN",9.8,"NM",98,0)
PSDLBL^^0^B21663167
"BLD",253,"KRN",9.8,"NM",99,0)
PSDLBL0^^0^B12452931
"BLD",253,"KRN",9.8,"NM",100,0)
PSDLBL1^^0^B19288718
"BLD",253,"KRN",9.8,"NM",101,0)
PSDLBL2^^0^B15352423
"BLD",253,"KRN",9.8,"NM",102,0)
PSDLBL3^^0^B15239484
"BLD",253,"KRN",9.8,"NM",103,0)
PSDLBLI^^0^B12951200
"BLD",253,"KRN",9.8,"NM",104,0)
PSDLBLP^^0^B20818342
"BLD",253,"KRN",9.8,"NM",105,0)
PSDLBLR^^0^B12912842
"BLD",253,"KRN",9.8,"NM",106,0)
PSDLBLR0^^0^B8845426
"BLD",253,"KRN",9.8,"NM",107,0)
PSDLSTK^^0^B9473155
"BLD",253,"KRN",9.8,"NM",108,0)
PSDLSTK1^^0^B12195708
"BLD",253,"KRN",9.8,"NM",109,0)
PSDLSTK2^^0^B10052755
"BLD",253,"KRN",9.8,"NM",110,0)
PSDMAPU^^0^B9064398
"BLD",253,"KRN",9.8,"NM",111,0)
PSDMFG^^0^B4791872
"BLD",253,"KRN",9.8,"NM",112,0)
PSDNACT^^0^B7699848
"BLD",253,"KRN",9.8,"NM",113,0)
PSDNARC^^0^B4743748
"BLD",253,"KRN",9.8,"NM",114,0)
PSDNBT^^0^B15488158
"BLD",253,"KRN",9.8,"NM",115,0)
PSDNCGS^^0^B13436903
"BLD",253,"KRN",9.8,"NM",117,0)
PSDNDES^^0^B20150900
"BLD",253,"KRN",9.8,"NM",118,0)
PSDNRGS^^0^B21670844
"BLD",253,"KRN",9.8,"NM",119,0)
PSDNSCL^^0^B14451928
"BLD",253,"KRN",9.8,"NM",120,0)
PSDNSTK^^0^B22221930
"BLD",253,"KRN",9.8,"NM",121,0)
PSDNTEG^^0^B19457876
"BLD",253,"KRN",9.8,"NM",122,0)
PSDNTEG0^^0^B13053136
"BLD",253,"KRN",9.8,"NM",123,0)
PSDNTF^^0^B31086621
"BLD",253,"KRN",9.8,"NM",124,0)
PSDNTR^^0^B22251404
"BLD",253,"KRN",9.8,"NM",125,0)
PSDNTT^^0^B14284752
"BLD",253,"KRN",9.8,"NM",126,0)
PSDNTT1^^0^B14095691
"BLD",253,"KRN",9.8,"NM",127,0)
PSDNU^^0^B17960955
"BLD",253,"KRN",9.8,"NM",128,0)
PSDNU1^^0^B24081140
"BLD",253,"KRN",9.8,"NM",129,0)
PSDNU2^^0^B19397437
"BLD",253,"KRN",9.8,"NM",130,0)
PSDNU3^^0^B3705047
"BLD",253,"KRN",9.8,"NM",131,0)
PSDNVT^^0^B1547220
"BLD",253,"KRN",9.8,"NM",132)
^^^
"BLD",253,"KRN",9.8,"NM",132,0)
PSDON001^^1^B29909482
"BLD",253,"KRN",9.8,"NM",133)
^^^
"BLD",253,"KRN",9.8,"NM",133,0)
PSDONIT^^1^B1193489
"BLD",253,"KRN",9.8,"NM",134)
^^^
"BLD",253,"KRN",9.8,"NM",134,0)
PSDONIT1^^1^B1952484
"BLD",253,"KRN",9.8,"NM",135)
^^^
"BLD",253,"KRN",9.8,"NM",135,0)
PSDONIT2^^1^B133139
"BLD",253,"KRN",9.8,"NM",136)
^^^
"BLD",253,"KRN",9.8,"NM",136,0)
PSDONIT3^^1^B17325223
"BLD",253,"KRN",9.8,"NM",137,0)
PSDOPT^^0^B22140879
"BLD",253,"KRN",9.8,"NM",138,0)
PSDOPT0^^0^B16009026
"BLD",253,"KRN",9.8,"NM",139,0)
PSDOPT1^^0^B9292680
"BLD",253,"KRN",9.8,"NM",140,0)
PSDOPT2^^0^B3029215
"BLD",253,"KRN",9.8,"NM",141,0)
PSDOPTI^^0^B25983890
"BLD",253,"KRN",9.8,"NM",142,0)
PSDOPTN^^0^B17545688
"BLD",253,"KRN",9.8,"NM",143,0)
PSDOPTR^^0^B2802824
"BLD",253,"KRN",9.8,"NM",144,0)
PSDOPTS^^0^B23312561
"BLD",253,"KRN",9.8,"NM",145,0)
PSDOPTX^^0^B15455667
"BLD",253,"KRN",9.8,"NM",146,0)
PSDOPTY^^0^B7975847
"BLD",253,"KRN",9.8,"NM",147,0)
PSDOPTZ^^0^B9200202
"BLD",253,"KRN",9.8,"NM",148,0)
PSDOR2^^0^B10866213
"BLD",253,"KRN",9.8,"NM",149,0)
PSDOR21^^0^B14070880
"BLD",253,"KRN",9.8,"NM",150,0)
PSDORD^^0^B20585761
"BLD",253,"KRN",9.8,"NM",151,0)
PSDORD1^^0^B7811612
"BLD",253,"KRN",9.8,"NM",152,0)
PSDORD2^^0^B14074750
"BLD",253,"KRN",9.8,"NM",153,0)
PSDORD3^^0^B16404681
"BLD",253,"KRN",9.8,"NM",154,0)
PSDORD4^^0^B9037751
"BLD",253,"KRN",9.8,"NM",155,0)
PSDORL^^0^B12339427
"BLD",253,"KRN",9.8,"NM",156,0)
PSDORM^^0^B1008754
"BLD",253,"KRN",9.8,"NM",157,0)
PSDORN^^0^B30216870
"BLD",253,"KRN",9.8,"NM",158,0)
PSDORN0^^0^B3755003
"BLD",253,"KRN",9.8,"NM",159,0)
PSDORN1^^0^B16015048
"BLD",253,"KRN",9.8,"NM",160,0)
PSDORNO^^0^B11690529
"BLD",253,"KRN",9.8,"NM",161,0)
PSDORNP^^0^B3303494
"BLD",253,"KRN",9.8,"NM",162,0)
PSDORP^^0^B22890772
"BLD",253,"KRN",9.8,"NM",163,0)
PSDORP1^^0^B15178147
"BLD",253,"KRN",9.8,"NM",164,0)
PSDORP2^^0^B16047567
"BLD",253,"KRN",9.8,"NM",165,0)
PSDORSN^^0^B19429676
"BLD",253,"KRN",9.8,"NM",166,0)
PSDORST^^0^B17319849
"BLD",253,"KRN",9.8,"NM",167,0)
PSDORV^^0^B16936413
"BLD",253,"KRN",9.8,"NM",168,0)
PSDORV1^^0^B13220403
"BLD",253,"KRN",9.8,"NM",169,0)
PSDPAT^^0^B13997882
"BLD",253,"KRN",9.8,"NM",170,0)
PSDPAT1^^0^B26977789
"BLD",253,"KRN",9.8,"NM",171,0)
PSDPAT2^^0^B2198141
"BLD",253,"KRN",9.8,"NM",172,0)
PSDPATI^^0^B3029340
"BLD",253,"KRN",9.8,"NM",173,0)
PSDPDR^^0^B17629765
"BLD",253,"KRN",9.8,"NM",174,0)
PSDPDR1^^0^B12120883
"BLD",253,"KRN",9.8,"NM",175,0)
PSDPDR2^^0^B16552223
"BLD",253,"KRN",9.8,"NM",176,0)
PSDPDU^^0^B7009260
"BLD",253,"KRN",9.8,"NM",177,0)
PSDPDU1^^0^B10477770
"BLD",253,"KRN",9.8,"NM",178,0)
PSDPGS^^0^B21156981
"BLD",253,"KRN",9.8,"NM",179,0)
PSDPGS1^^0^B25630481
"BLD",253,"KRN",9.8,"NM",180,0)
PSDPLOG^^0^B17070442
"BLD",253,"KRN",9.8,"NM",181,0)
PSDPLOG1^^0^B19281186
"BLD",253,"KRN",9.8,"NM",182,0)
PSDPLOG2^^0^B16699847
"BLD",253,"KRN",9.8,"NM",183,0)
PSDPLOG3^^0^B19498393
"BLD",253,"KRN",9.8,"NM",184,0)
PSDPMFG^^0^B17709092
"BLD",253,"KRN",9.8,"NM",185,0)
PSDPMFG1^^0^B6793120
"BLD",253,"KRN",9.8,"NM",186,0)
PSDPND^^0^B20543522
"BLD",253,"KRN",9.8,"NM",187,0)
PSDPND1^^0^B8758594
"BLD",253,"KRN",9.8,"NM",188,0)
PSDPRG^^0^B2077020
"BLD",253,"KRN",9.8,"NM",189,0)
PSDPRT^^0^B2823025
"BLD",253,"KRN",9.8,"NM",190,0)
PSDPSI^^0^B23713234
"BLD",253,"KRN",9.8,"NM",191,0)
PSDPSTK^^0^B11031635
"BLD",253,"KRN",9.8,"NM",192,0)
PSDPSTK1^^0^B10175288
"BLD",253,"KRN",9.8,"NM",193,0)
PSDPUGS^^0^B24812757
"BLD",253,"KRN",9.8,"NM",194,0)
PSDPWK^^0^B22501092
"BLD",253,"KRN",9.8,"NM",195,0)
PSDPWK1^^0^B9766078
"BLD",253,"KRN",9.8,"NM",196,0)
PSDPWK2^^0^B9753100
"BLD",253,"KRN",9.8,"NM",197,0)
PSDPWK3^^0^B3030236
"BLD",253,"KRN",9.8,"NM",198,0)
PSDRDR^^0^B22926262
"BLD",253,"KRN",9.8,"NM",199,0)
PSDRDR1^^0^B10986671
"BLD",253,"KRN",9.8,"NM",200,0)
PSDRDR2^^0^B11545864
"BLD",253,"KRN",9.8,"NM",201,0)
PSDREC^^0^B18294703
"BLD",253,"KRN",9.8,"NM",202,0)
PSDREC1^^0^B18469784
"BLD",253,"KRN",9.8,"NM",203,0)
PSDREC2^^0^B19149867
"BLD",253,"KRN",9.8,"NM",204,0)
PSDREC3^^0^B21225124
"BLD",253,"KRN",9.8,"NM",205,0)
PSDREC4^^0^B25188789
"BLD",253,"KRN",9.8,"NM",206,0)
PSDREPD^^0^B21938573
"BLD",253,"KRN",9.8,"NM",207,0)
PSDREPV^^0^B10465287
"BLD",253,"KRN",9.8,"NM",208,0)
PSDREV^^0^B9113997
"BLD",253,"KRN",9.8,"NM",209,0)
PSDREVC^^0^B12924217
"BLD",253,"KRN",9.8,"NM",210,0)
PSDREVD^^0^B16186105
"BLD",253,"KRN",9.8,"NM",211,0)
PSDRF^^0^B20180450
"BLD",253,"KRN",9.8,"NM",212,0)
PSDRF1^^0^B6498777
"BLD",253,"KRN",9.8,"NM",213,0)
PSDRF2^^0^B2483597
"BLD",253,"KRN",9.8,"NM",214)
^^^
"BLD",253,"KRN",9.8,"NM",214,0)
PSDRF3^^1^B11711354
"BLD",253,"KRN",9.8,"NM",215,0)
PSDRFD^^0^B6887259
"BLD",253,"KRN",9.8,"NM",216,0)
PSDRFM^^0^B4735710
"BLD",253,"KRN",9.8,"NM",217,0)
PSDRLOG^^0^B18309161
"BLD",253,"KRN",9.8,"NM",218,0)
PSDRLOG1^^0^B17919515
"BLD",253,"KRN",9.8,"NM",219,0)
PSDRLOG2^^0^B17243309
"BLD",253,"KRN",9.8,"NM",220,0)
PSDRLOG3^^0^B19919761
"BLD",253,"KRN",9.8,"NM",221,0)
PSDRPGS^^0^B11947150
"BLD",253,"KRN",9.8,"NM",222,0)
PSDRPGS1^^0^B11631175
"BLD",253,"KRN",9.8,"NM",223,0)
PSDRPGS2^^0^B20238927
"BLD",253,"KRN",9.8,"NM",224,0)
PSDRPT^^0^B21629642
"BLD",253,"KRN",9.8,"NM",225,0)
PSDRSI^^0^B11533233
"BLD",253,"KRN",9.8,"NM",226,0)
PSDRWK^^0^B19279076
"BLD",253,"KRN",9.8,"NM",227,0)
PSDSET^^0^B7164276
"BLD",253,"KRN",9.8,"NM",228,0)
PSDSITE^^0^B8382033
"BLD",253,"KRN",9.8,"NM",229,0)
PSDSP^^0^B1316387
"BLD",253,"KRN",9.8,"NM",230,0)
PSDSTK^^0^B18401652
"BLD",253,"KRN",9.8,"NM",231,0)
PSDTER^^0^B23417786
"BLD",253,"KRN",9.8,"NM",232,0)
PSDTER1^^0^B2990848
"BLD",253,"KRN",9.8,"NM",233,0)
PSDTRA^^0^B18224157
"BLD",253,"KRN",9.8,"NM",234,0)
PSDTRA1^^0^B6750678
"BLD",253,"KRN",9.8,"NM",235,0)
PSDTRAK^^0^B16147747
"BLD",253,"KRN",9.8,"NM",236,0)
PSDTRN^^0^B19444622
"BLD",253,"KRN",9.8,"NM",237,0)
PSDTRN1^^0^B5977161
"BLD",253,"KRN",9.8,"NM",238,0)
PSDTRV^^0^B16960376
"BLD",253,"KRN",9.8,"NM",239,0)
PSDTRV1^^0^B12908934
"BLD",253,"KRN",9.8,"NM",240,0)
PSDTRVR^^0^B12885307
"BLD",253,"KRN",9.8,"NM",241,0)
PSDTRVR1^^0^B10855633
"BLD",253,"KRN",9.8,"NM",242,0)
PSDUP2^^0^B10638755
"BLD",253,"KRN",9.8,"NM",243,0)
PSDUP3^^0^B8827324
"BLD",253,"KRN",9.8,"NM",244,0)
PSDUSER^^0^B7784204
"BLD",253,"KRN",9.8,"NM",245,0)
PSDUTL^^0^B15937132
"BLD",253,"KRN",9.8,"NM",246,0)
PSDUTL1^^0^B17512555
"BLD",253,"KRN",9.8,"NM",247,0)
PSDUTL2^^0^B4494693
"BLD",253,"KRN",9.8,"NM",248,0)
PSDUTL3^^0^B10003466
"BLD",253,"KRN",9.8,"NM",249,0)
PSDUTL4^^0^B3775971
"BLD",253,"KRN",9.8,"NM",250,0)
PSDUTL5^^0^B6088397
"BLD",253,"KRN",9.8,"NM",251,0)
PSDWADD^^0^B24356010
"BLD",253,"KRN",9.8,"NM",252,0)
PSDWCHG^^0^B25154156
"BLD",253,"KRN",9.8,"NM",253,0)
PSDWL^^0^B2601418
"BLD",253,"KRN",9.8,"NM",255,0)
PSDIPOS1^^0^B5709001
"BLD",253,"KRN",9.8,"NM",256,0)
PSDIPOST^^0^B8595292
"BLD",253,"KRN",9.8,"NM",257,0)
PSDHLK^^0^B1490477
"BLD",253,"KRN",9.8,"NM",258,0)
PSDHLP^^0^B2229203
"BLD",253,"KRN",9.8,"NM",259,0)
PSDHLY^^0^B1134817
"BLD",253,"KRN",9.8,"NM",263,0)
PSDBAN^^0^B16651142
"BLD",253,"KRN",9.8,"NM",264,0)
PSDRFV^^0^B3244967
"BLD",253,"KRN",9.8,"NM",265,0)
PSDRFL^^0^B5249171
"BLD",253,"KRN",9.8,"NM",266,0)
PSDRFW^^0^B22581277
"BLD",253,"KRN",9.8,"NM",267,0)
PSDRFX^^0^B7219196
"BLD",253,"KRN",9.8,"NM",268,0)
PSDBAN1^^0^B8172896
"BLD",253,"KRN",9.8,"NM",269,0)
PSDRFR^^0^B21078152
"BLD",253,"KRN",9.8,"NM",270,0)
PSDRPGS3^^0^B878286
"BLD",253,"KRN",9.8,"NM",271,0)
PSDTER2^^0^B17639482
"BLD",253,"KRN",9.8,"NM",374,0)
PSDLBL4^^0^B4848952
"BLD",253,"KRN",9.8,"NM",375,0)
PSDLBL5^^0^B11165305
"BLD",253,"KRN",9.8,"NM",376,0)
PSDORN2^^0^B14389778
"BLD",253,"KRN",9.8,"NM",377,0)
PSDORN3^^0^B3396739
"BLD",253,"KRN",9.8,"NM",378,0)
PSDORNC^^0^B17540217
"BLD",253,"KRN",9.8,"NM",379,0)
PSDORNV^^0^B42380281
"BLD",253,"KRN",9.8,"NM",380,0)
PSDRF4^^0^B16231710
"BLD",253,"KRN",9.8,"NM",381,0)
PSDRF5^^0^B4475969
"BLD",253,"KRN",9.8,"NM",485,0)
PSDLBLB^^0^B10784930
"BLD",253,"KRN",9.8,"NM",486,0)
PSDADJC^^0^B20537546
"BLD",253,"KRN",9.8,"NM",491,0)
PSDINPRE^^0^B4106644
"BLD",253,"KRN",9.8,"NM",492,0)
PSDLBLR1^^0^B3021767
"BLD",253,"KRN",9.8,"NM",493,0)
PSDLBLR2^^0^B7565288
"BLD",253,"KRN",9.8,"NM",494,0)
PSDNRGO^^0^B14945935
"BLD",253,"KRN",9.8,"NM",495,0)
PSDNSCG^^0^B15651940
"BLD",253,"KRN",9.8,"NM",496,0)
PSDORSU^^0^B1990201
"BLD",253,"KRN",9.8,"NM",497,0)
PSDRFS^^0^B20279415
"BLD",253,"KRN",9.8,"NM",498,0)
PSDRFT^^0^B8515082
"BLD",253,"KRN",9.8,"NM",499,0)
PSDRFU^^0^B6085633
"BLD",253,"KRN",9.8,"NM",500,0)
PSDRFZ^^0^B3069199
"BLD",253,"KRN",9.8,"NM","B","PSDACT",1)

"BLD",253,"KRN",9.8,"NM","B","PSDACT1",2)

"BLD",253,"KRN",9.8,"NM","B","PSDACT2",3)

"BLD",253,"KRN",9.8,"NM","B","PSDADJ",4)

"BLD",253,"KRN",9.8,"NM","B","PSDADJB",5)

"BLD",253,"KRN",9.8,"NM","B","PSDADJC",486)

"BLD",253,"KRN",9.8,"NM","B","PSDADJD",6)

"BLD",253,"KRN",9.8,"NM","B","PSDADJI",7)

"BLD",253,"KRN",9.8,"NM","B","PSDADJIN",8)

"BLD",253,"KRN",9.8,"NM","B","PSDADJN",9)

"BLD",253,"KRN",9.8,"NM","B","PSDADJN1",10)

"BLD",253,"KRN",9.8,"NM","B","PSDADJR",11)

"BLD",253,"KRN",9.8,"NM","B","PSDADJW",12)

"BLD",253,"KRN",9.8,"NM","B","PSDADT",13)

"BLD",253,"KRN",9.8,"NM","B","PSDADT1",14)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS",15)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS0",16)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS1",17)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS2",18)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS3",19)

"BLD",253,"KRN",9.8,"NM","B","PSDAMIS4",20)

"BLD",253,"KRN",9.8,"NM","B","PSDAPU",21)

"BLD",253,"KRN",9.8,"NM","B","PSDBAL",22)

"BLD",253,"KRN",9.8,"NM","B","PSDBALI",23)

"BLD",253,"KRN",9.8,"NM","B","PSDBALI1",24)

"BLD",253,"KRN",9.8,"NM","B","PSDBAN",263)

"BLD",253,"KRN",9.8,"NM","B","PSDBAN1",268)

"BLD",253,"KRN",9.8,"NM","B","PSDCODE",25)

"BLD",253,"KRN",9.8,"NM","B","PSDCOR",26)

"BLD",253,"KRN",9.8,"NM","B","PSDCOR1",27)

"BLD",253,"KRN",9.8,"NM","B","PSDCOR2",28)

"BLD",253,"KRN",9.8,"NM","B","PSDCOR3",29)

"BLD",253,"KRN",9.8,"NM","B","PSDCORP",30)

"BLD",253,"KRN",9.8,"NM","B","PSDCORP1",31)

"BLD",253,"KRN",9.8,"NM","B","PSDCORP2",32)

"BLD",253,"KRN",9.8,"NM","B","PSDCORP3",33)

"BLD",253,"KRN",9.8,"NM","B","PSDCOSD",34)

"BLD",253,"KRN",9.8,"NM","B","PSDCOSH",35)

"BLD",253,"KRN",9.8,"NM","B","PSDCOSM",36)

"BLD",253,"KRN",9.8,"NM","B","PSDCOSN",37)

"BLD",253,"KRN",9.8,"NM","B","PSDCOST",38)

"BLD",253,"KRN",9.8,"NM","B","PSDCOSV",39)

"BLD",253,"KRN",9.8,"NM","B","PSDCPO",40)

"BLD",253,"KRN",9.8,"NM","B","PSDCRP",41)

"BLD",253,"KRN",9.8,"NM","B","PSDCSI",42)

"BLD",253,"KRN",9.8,"NM","B","PSDCSL",43)

"BLD",253,"KRN",9.8,"NM","B","PSDDFP",44)

"BLD",253,"KRN",9.8,"NM","B","PSDDFP1",45)

"BLD",253,"KRN",9.8,"NM","B","PSDDWK",46)

"BLD",253,"KRN",9.8,"NM","B","PSDDWK1",47)

"BLD",253,"KRN",9.8,"NM","B","PSDDWK2",48)

"BLD",253,"KRN",9.8,"NM","B","PSDDWK3",49)

"BLD",253,"KRN",9.8,"NM","B","PSDDWK4",50)

"BLD",253,"KRN",9.8,"NM","B","PSDDWKE",51)

"BLD",253,"KRN",9.8,"NM","B","PSDEA",52)

"BLD",253,"KRN",9.8,"NM","B","PSDEA41",53)

"BLD",253,"KRN",9.8,"NM","B","PSDEM",54)

"BLD",253,"KRN",9.8,"NM","B","PSDEM1",55)

"BLD",253,"KRN",9.8,"NM","B","PSDEM2",56)

"BLD",253,"KRN",9.8,"NM","B","PSDEM3",57)

"BLD",253,"KRN",9.8,"NM","B","PSDEM4",58)

"BLD",253,"KRN",9.8,"NM","B","PSDEN",59)

"BLD",253,"KRN",9.8,"NM","B","PSDERCP",60)

"BLD",253,"KRN",9.8,"NM","B","PSDERD",61)

"BLD",253,"KRN",9.8,"NM","B","PSDERP",62)

"BLD",253,"KRN",9.8,"NM","B","PSDEST",63)

"BLD",253,"KRN",9.8,"NM","B","PSDESTF",64)

"BLD",253,"KRN",9.8,"NM","B","PSDESTO",65)

"BLD",253,"KRN",9.8,"NM","B","PSDESTP",66)

"BLD",253,"KRN",9.8,"NM","B","PSDEVO",67)

"BLD",253,"KRN",9.8,"NM","B","PSDEVO1",68)

"BLD",253,"KRN",9.8,"NM","B","PSDEVOR",69)

"BLD",253,"KRN",9.8,"NM","B","PSDEXGS",70)

"BLD",253,"KRN",9.8,"NM","B","PSDEXGS1",71)

"BLD",253,"KRN",9.8,"NM","B","PSDEXP",72)

"BLD",253,"KRN",9.8,"NM","B","PSDEXP1",73)

"BLD",253,"KRN",9.8,"NM","B","PSDFIL2",74)

"BLD",253,"KRN",9.8,"NM","B","PSDFIL3",75)

"BLD",253,"KRN",9.8,"NM","B","PSDFILM",76)

"BLD",253,"KRN",9.8,"NM","B","PSDFND",77)

"BLD",253,"KRN",9.8,"NM","B","PSDFND1",78)

"BLD",253,"KRN",9.8,"NM","B","PSDFT",79)

"BLD",253,"KRN",9.8,"NM","B","PSDFT1",80)

"BLD",253,"KRN",9.8,"NM","B","PSDGEN",81)

"BLD",253,"KRN",9.8,"NM","B","PSDGPR",82)

"BLD",253,"KRN",9.8,"NM","B","PSDGSH",83)

"BLD",253,"KRN",9.8,"NM","B","PSDGSH1",84)

"BLD",253,"KRN",9.8,"NM","B","PSDGSH11",85)

"BLD",253,"KRN",9.8,"NM","B","PSDGSH2",86)

"BLD",253,"KRN",9.8,"NM","B","PSDGSK",87)

"BLD",253,"KRN",9.8,"NM","B","PSDGSL",88)

"BLD",253,"KRN",9.8,"NM","B","PSDGSL1",89)

"BLD",253,"KRN",9.8,"NM","B","PSDGSPU",90)

"BLD",253,"KRN",9.8,"NM","B","PSDGSRV",91)

"BLD",253,"KRN",9.8,"NM","B","PSDGSRV1",92)

"BLD",253,"KRN",9.8,"NM","B","PSDGSRV2",93)

"BLD",253,"KRN",9.8,"NM","B","PSDHELP",94)

"BLD",253,"KRN",9.8,"NM","B","PSDHL7",95)

"BLD",253,"KRN",9.8,"NM","B","PSDHLK",257)

"BLD",253,"KRN",9.8,"NM","B","PSDHLP",258)

"BLD",253,"KRN",9.8,"NM","B","PSDHLX",96)

"BLD",253,"KRN",9.8,"NM","B","PSDHLY",259)

"BLD",253,"KRN",9.8,"NM","B","PSDHRPT",97)

"BLD",253,"KRN",9.8,"NM","B","PSDINPRE",491)

"BLD",253,"KRN",9.8,"NM","B","PSDIPOS1",255)

"BLD",253,"KRN",9.8,"NM","B","PSDIPOST",256)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL",98)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL0",99)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL1",100)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL2",101)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL3",102)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL4",374)

"BLD",253,"KRN",9.8,"NM","B","PSDLBL5",375)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLB",485)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLI",103)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLP",104)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLR",105)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLR0",106)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLR1",492)

"BLD",253,"KRN",9.8,"NM","B","PSDLBLR2",493)

"BLD",253,"KRN",9.8,"NM","B","PSDLSTK",107)

"BLD",253,"KRN",9.8,"NM","B","PSDLSTK1",108)

"BLD",253,"KRN",9.8,"NM","B","PSDLSTK2",109)

"BLD",253,"KRN",9.8,"NM","B","PSDMAPU",110)

"BLD",253,"KRN",9.8,"NM","B","PSDMFG",111)

"BLD",253,"KRN",9.8,"NM","B","PSDNACT",112)

"BLD",253,"KRN",9.8,"NM","B","PSDNARC",113)

"BLD",253,"KRN",9.8,"NM","B","PSDNBT",114)

"BLD",253,"KRN",9.8,"NM","B","PSDNCGS",115)

"BLD",253,"KRN",9.8,"NM","B","PSDNDES",117)

"BLD",253,"KRN",9.8,"NM","B","PSDNRGO",494)

"BLD",253,"KRN",9.8,"NM","B","PSDNRGS",118)

"BLD",253,"KRN",9.8,"NM","B","PSDNSCG",495)

"BLD",253,"KRN",9.8,"NM","B","PSDNSCL",119)

"BLD",253,"KRN",9.8,"NM","B","PSDNSTK",120)

"BLD",253,"KRN",9.8,"NM","B","PSDNTEG",121)

"BLD",253,"KRN",9.8,"NM","B","PSDNTEG0",122)

"BLD",253,"KRN",9.8,"NM","B","PSDNTF",123)

"BLD",253,"KRN",9.8,"NM","B","PSDNTR",124)

"BLD",253,"KRN",9.8,"NM","B","PSDNTT",125)

"BLD",253,"KRN",9.8,"NM","B","PSDNTT1",126)

"BLD",253,"KRN",9.8,"NM","B","PSDNU",127)

"BLD",253,"KRN",9.8,"NM","B","PSDNU1",128)

"BLD",253,"KRN",9.8,"NM","B","PSDNU2",129)

"BLD",253,"KRN",9.8,"NM","B","PSDNU3",130)

"BLD",253,"KRN",9.8,"NM","B","PSDNVT",131)

"BLD",253,"KRN",9.8,"NM","B","PSDON001",132)

"BLD",253,"KRN",9.8,"NM","B","PSDONIT",133)

"BLD",253,"KRN",9.8,"NM","B","PSDONIT1",134)

"BLD",253,"KRN",9.8,"NM","B","PSDONIT2",135)

"BLD",253,"KRN",9.8,"NM","B","PSDONIT3",136)

"BLD",253,"KRN",9.8,"NM","B","PSDOPT",137)

"BLD",253,"KRN",9.8,"NM","B","PSDOPT0",138)

"BLD",253,"KRN",9.8,"NM","B","PSDOPT1",139)

"BLD",253,"KRN",9.8,"NM","B","PSDOPT2",140)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTI",141)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTN",142)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTR",143)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTS",144)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTX",145)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTY",146)

"BLD",253,"KRN",9.8,"NM","B","PSDOPTZ",147)

"BLD",253,"KRN",9.8,"NM","B","PSDOR2",148)

"BLD",253,"KRN",9.8,"NM","B","PSDOR21",149)

"BLD",253,"KRN",9.8,"NM","B","PSDORD",150)

"BLD",253,"KRN",9.8,"NM","B","PSDORD1",151)

"BLD",253,"KRN",9.8,"NM","B","PSDORD2",152)

"BLD",253,"KRN",9.8,"NM","B","PSDORD3",153)

"BLD",253,"KRN",9.8,"NM","B","PSDORD4",154)

"BLD",253,"KRN",9.8,"NM","B","PSDORL",155)

"BLD",253,"KRN",9.8,"NM","B","PSDORM",156)

"BLD",253,"KRN",9.8,"NM","B","PSDORN",157)

"BLD",253,"KRN",9.8,"NM","B","PSDORN0",158)

"BLD",253,"KRN",9.8,"NM","B","PSDORN1",159)

"BLD",253,"KRN",9.8,"NM","B","PSDORN2",376)

"BLD",253,"KRN",9.8,"NM","B","PSDORN3",377)

"BLD",253,"KRN",9.8,"NM","B","PSDORNC",378)

"BLD",253,"KRN",9.8,"NM","B","PSDORNO",160)

"BLD",253,"KRN",9.8,"NM","B","PSDORNP",161)

"BLD",253,"KRN",9.8,"NM","B","PSDORNV",379)

"BLD",253,"KRN",9.8,"NM","B","PSDORP",162)

"BLD",253,"KRN",9.8,"NM","B","PSDORP1",163)

"BLD",253,"KRN",9.8,"NM","B","PSDORP2",164)

"BLD",253,"KRN",9.8,"NM","B","PSDORSN",165)

"BLD",253,"KRN",9.8,"NM","B","PSDORST",166)

"BLD",253,"KRN",9.8,"NM","B","PSDORSU",496)

"BLD",253,"KRN",9.8,"NM","B","PSDORV",167)

"BLD",253,"KRN",9.8,"NM","B","PSDORV1",168)

"BLD",253,"KRN",9.8,"NM","B","PSDPAT",169)

"BLD",253,"KRN",9.8,"NM","B","PSDPAT1",170)

"BLD",253,"KRN",9.8,"NM","B","PSDPAT2",171)

"BLD",253,"KRN",9.8,"NM","B","PSDPATI",172)

"BLD",253,"KRN",9.8,"NM","B","PSDPDR",173)

"BLD",253,"KRN",9.8,"NM","B","PSDPDR1",174)

"BLD",253,"KRN",9.8,"NM","B","PSDPDR2",175)

"BLD",253,"KRN",9.8,"NM","B","PSDPDU",176)

"BLD",253,"KRN",9.8,"NM","B","PSDPDU1",177)

"BLD",253,"KRN",9.8,"NM","B","PSDPGS",178)

"BLD",253,"KRN",9.8,"NM","B","PSDPGS1",179)

"BLD",253,"KRN",9.8,"NM","B","PSDPLOG",180)

"BLD",253,"KRN",9.8,"NM","B","PSDPLOG1",181)

"BLD",253,"KRN",9.8,"NM","B","PSDPLOG2",182)

"BLD",253,"KRN",9.8,"NM","B","PSDPLOG3",183)

"BLD",253,"KRN",9.8,"NM","B","PSDPMFG",184)

"BLD",253,"KRN",9.8,"NM","B","PSDPMFG1",185)

"BLD",253,"KRN",9.8,"NM","B","PSDPND",186)

"BLD",253,"KRN",9.8,"NM","B","PSDPND1",187)

"BLD",253,"KRN",9.8,"NM","B","PSDPRG",188)

"BLD",253,"KRN",9.8,"NM","B","PSDPRT",189)

"BLD",253,"KRN",9.8,"NM","B","PSDPSI",190)

"BLD",253,"KRN",9.8,"NM","B","PSDPSTK",191)

"BLD",253,"KRN",9.8,"NM","B","PSDPSTK1",192)

"BLD",253,"KRN",9.8,"NM","B","PSDPUGS",193)

"BLD",253,"KRN",9.8,"NM","B","PSDPWK",194)

"BLD",253,"KRN",9.8,"NM","B","PSDPWK1",195)

"BLD",253,"KRN",9.8,"NM","B","PSDPWK2",196)

"BLD",253,"KRN",9.8,"NM","B","PSDPWK3",197)

"BLD",253,"KRN",9.8,"NM","B","PSDRDR",198)

"BLD",253,"KRN",9.8,"NM","B","PSDRDR1",199)

"BLD",253,"KRN",9.8,"NM","B","PSDRDR2",200)

"BLD",253,"KRN",9.8,"NM","B","PSDREC",201)

"BLD",253,"KRN",9.8,"NM","B","PSDREC1",202)

"BLD",253,"KRN",9.8,"NM","B","PSDREC2",203)

"BLD",253,"KRN",9.8,"NM","B","PSDREC3",204)

"BLD",253,"KRN",9.8,"NM","B","PSDREC4",205)

"BLD",253,"KRN",9.8,"NM","B","PSDREPD",206)

"BLD",253,"KRN",9.8,"NM","B","PSDREPV",207)

"BLD",253,"KRN",9.8,"NM","B","PSDREV",208)

"BLD",253,"KRN",9.8,"NM","B","PSDREVC",209)

"BLD",253,"KRN",9.8,"NM","B","PSDREVD",210)

"BLD",253,"KRN",9.8,"NM","B","PSDRF",211)

"BLD",253,"KRN",9.8,"NM","B","PSDRF1",212)

"BLD",253,"KRN",9.8,"NM","B","PSDRF2",213)

"BLD",253,"KRN",9.8,"NM","B","PSDRF3",214)

"BLD",253,"KRN",9.8,"NM","B","PSDRF4",380)

"BLD",253,"KRN",9.8,"NM","B","PSDRF5",381)

"BLD",253,"KRN",9.8,"NM","B","PSDRFD",215)

"BLD",253,"KRN",9.8,"NM","B","PSDRFL",265)

"BLD",253,"KRN",9.8,"NM","B","PSDRFM",216)

"BLD",253,"KRN",9.8,"NM","B","PSDRFR",269)

"BLD",253,"KRN",9.8,"NM","B","PSDRFS",497)

"BLD",253,"KRN",9.8,"NM","B","PSDRFT",498)

"BLD",253,"KRN",9.8,"NM","B","PSDRFU",499)

"BLD",253,"KRN",9.8,"NM","B","PSDRFV",264)

"BLD",253,"KRN",9.8,"NM","B","PSDRFW",266)

"BLD",253,"KRN",9.8,"NM","B","PSDRFX",267)

"BLD",253,"KRN",9.8,"NM","B","PSDRFZ",500)

"BLD",253,"KRN",9.8,"NM","B","PSDRLOG",217)

"BLD",253,"KRN",9.8,"NM","B","PSDRLOG1",218)

"BLD",253,"KRN",9.8,"NM","B","PSDRLOG2",219)

"BLD",253,"KRN",9.8,"NM","B","PSDRLOG3",220)

"BLD",253,"KRN",9.8,"NM","B","PSDRPGS",221)

"BLD",253,"KRN",9.8,"NM","B","PSDRPGS1",222)

"BLD",253,"KRN",9.8,"NM","B","PSDRPGS2",223)

"BLD",253,"KRN",9.8,"NM","B","PSDRPGS3",270)

"BLD",253,"KRN",9.8,"NM","B","PSDRPT",224)

"BLD",253,"KRN",9.8,"NM","B","PSDRSI",225)

"BLD",253,"KRN",9.8,"NM","B","PSDRWK",226)

"BLD",253,"KRN",9.8,"NM","B","PSDSET",227)

"BLD",253,"KRN",9.8,"NM","B","PSDSITE",228)

"BLD",253,"KRN",9.8,"NM","B","PSDSP",229)

"BLD",253,"KRN",9.8,"NM","B","PSDSTK",230)

"BLD",253,"KRN",9.8,"NM","B","PSDTER",231)

"BLD",253,"KRN",9.8,"NM","B","PSDTER1",232)

"BLD",253,"KRN",9.8,"NM","B","PSDTER2",271)

"BLD",253,"KRN",9.8,"NM","B","PSDTRA",233)

"BLD",253,"KRN",9.8,"NM","B","PSDTRA1",234)

"BLD",253,"KRN",9.8,"NM","B","PSDTRAK",235)

"BLD",253,"KRN",9.8,"NM","B","PSDTRN",236)

"BLD",253,"KRN",9.8,"NM","B","PSDTRN1",237)

"BLD",253,"KRN",9.8,"NM","B","PSDTRV",238)

"BLD",253,"KRN",9.8,"NM","B","PSDTRV1",239)

"BLD",253,"KRN",9.8,"NM","B","PSDTRVR",240)

"BLD",253,"KRN",9.8,"NM","B","PSDTRVR1",241)

"BLD",253,"KRN",9.8,"NM","B","PSDUP2",242)

"BLD",253,"KRN",9.8,"NM","B","PSDUP3",243)

"BLD",253,"KRN",9.8,"NM","B","PSDUSER",244)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL",245)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL1",246)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL2",247)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL3",248)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL4",249)

"BLD",253,"KRN",9.8,"NM","B","PSDUTL5",250)

"BLD",253,"KRN",9.8,"NM","B","PSDWADD",251)

"BLD",253,"KRN",9.8,"NM","B","PSDWCHG",252)

"BLD",253,"KRN",9.8,"NM","B","PSDWL",253)

"BLD",253,"KRN",19,0)
19
"BLD",253,"KRN",19,"NM",0)
^9.68A^153^152
"BLD",253,"KRN",19,"NM",1,0)
PSD AMIS^^0
"BLD",253,"KRN",19,"NM",2,0)
PSD BALANCE ADJUSTMENT REVIEW^^0
"BLD",253,"KRN",19,"NM",3,0)
PSD BALANCE ADJUSTMENTS^^0
"BLD",253,"KRN",19,"NM",4,0)
PSD BALANCE INITIALIZE^^0
"BLD",253,"KRN",19,"NM",5,0)
PSD COMPLETE GS^^0
"BLD",253,"KRN",19,"NM",6,0)
PSD CORRECT EXISTING GS^^0
"BLD",253,"KRN",19,"NM",7,0)
PSD CORRECT GS STATUS^^0
"BLD",253,"KRN",19,"NM",8,0)
PSD CORRECT STATUS^^0
"BLD",253,"KRN",19,"NM",9,0)
PSD CORRECTION LOG^^0
"BLD",253,"KRN",19,"NM",10,0)
PSD CORRECTION LOG REPORT^^0
"BLD",253,"KRN",19,"NM",11,0)
PSD COST REPORTS^^0
"BLD",253,"KRN",19,"NM",12,0)
PSD CP TRANSACTION REVIEW^^0
"BLD",253,"KRN",19,"NM",13,0)
PSD DAILY LOG^^0
"BLD",253,"KRN",19,"NM",14,0)
PSD DAILY LOG TECH^^0
"BLD",253,"KRN",19,"NM",15,0)
PSD DEA LIST^^0
"BLD",253,"KRN",19,"NM",16,0)
PSD DEST DRUGS REPORT^^0
"BLD",253,"KRN",19,"NM",17,0)
PSD DEST NON-CS DRUG^^0
"BLD",253,"KRN",19,"NM",18,0)
PSD DEST TEXT DRUG^^0
"BLD",253,"KRN",19,"NM",19,0)
PSD DESTROY DEA41^^0
"BLD",253,"KRN",19,"NM",20,0)
PSD DESTROY DRUGS^^0
"BLD",253,"KRN",19,"NM",21,0)
PSD DESTROY MENU^^0
"BLD",253,"KRN",19,"NM",22,0)
PSD DESTRUCTION HOLDING^^0
"BLD",253,"KRN",19,"NM",23,0)
PSD DISPENSE W/O GS^^0
"BLD",253,"KRN",19,"NM",24,0)
PSD DISPENSING MENU^^0
"BLD",253,"KRN",19,"NM",25,0)
PSD DRUG CHECK^^0
"BLD",253,"KRN",19,"NM",26,0)
PSD DRUG FILE DATA^^0
"BLD",253,"KRN",19,"NM",27,0)
PSD DRUG LOC EDIT^^0
"BLD",253,"KRN",19,"NM",28,0)
PSD DRUG LOC PRINT^^0
"BLD",253,"KRN",19,"NM",29,0)
PSD DRUG RECEIPT HISTORY^^0
"BLD",253,"KRN",19,"NM",30,0)
PSD EDIT/CANC VER ORD^^0
"BLD",253,"KRN",19,"NM",31,0)
PSD EDIT/CANC VER ORD RPT^^0
"BLD",253,"KRN",19,"NM",32,0)
PSD EMERGENCY ORDER REPORT^^0
"BLD",253,"KRN",19,"NM",33,0)
PSD ENTER/EDIT MENU^^0
"BLD",253,"KRN",19,"NM",34,0)
PSD ERR/ADJ EDIT^^0
"BLD",253,"KRN",19,"NM",35,0)
PSD ERR/ADJ PENDING REPORT^^0
"BLD",253,"KRN",19,"NM",36,0)
PSD ERR/ADJ RESOLVED REPORT^^0
"BLD",253,"KRN",19,"NM",37,0)
PSD EXISTING GS^^0
"BLD",253,"KRN",19,"NM",38,0)
PSD EXP REPORT^^0
"BLD",253,"KRN",19,"NM",39,0)
PSD GS DISCREPANCY REPORT^^0
"BLD",253,"KRN",19,"NM",40,0)
PSD GS HISTORY^^0
"BLD",253,"KRN",19,"NM",41,0)
PSD GS LISTING^^0
"BLD",253,"KRN",19,"NM",42,0)
PSD GS TRANS NOT RECD (NAOU)^^0
"BLD",253,"KRN",19,"NM",43,0)
PSD GS TRANSFER (NAOU) REPORT^^0
"BLD",253,"KRN",19,"NM",44,0)
PSD INACTIVATE NAOU^^0
"BLD",253,"KRN",19,"NM",45,0)
PSD INACTIVATE NAOU STOCK DRUG^^0
"BLD",253,"KRN",19,"NM",46,0)
PSD INFUSION MENU^^0
"BLD",253,"KRN",19,"NM",47,0)
PSD INFUSION O/E^^0
"BLD",253,"KRN",19,"NM",48,0)
PSD INSP LOG BY RECD DATE^^0
"BLD",253,"KRN",19,"NM",49,0)
PSD INSP PLACE HOLD^^0
"BLD",253,"KRN",19,"NM",50,0)
PSD INSP REMOVE HOLD^^0
"BLD",253,"KRN",19,"NM",51,0)
PSD INSPECTOR MENU^^0
"BLD",253,"KRN",19,"NM",52,0)
PSD INVEN SHEET PRT^^0
"BLD",253,"KRN",19,"NM",53,0)
PSD INVEN TYPE EDIT^^0
"BLD",253,"KRN",19,"NM",54,0)
PSD INVEN TYPE PRINT^^0
"BLD",253,"KRN",19,"NM",55,0)
PSD IRL INSP DATA^^0
"BLD",253,"KRN",19,"NM",56,0)
PSD IRL INSP MENU^^0
"BLD",253,"KRN",19,"NM",57,0)
PSD IRL INSPECTOR INV^^0
"BLD",253,"KRN",19,"NM",58,0)
PSD IRL INV DATA^^0
"BLD",253,"KRN",19,"NM",59,0)
PSD IRL INV MENU^^0
"BLD",253,"KRN",19,"NM",60,0)
PSD IRL VAULT INV^^0
"BLD",253,"KRN",19,"NM",61,0)
PSD LABEL DRUG/NUMBER^^0
"BLD",253,"KRN",19,"NM",62,0)
PSD LABEL INSP^^0
"BLD",253,"KRN",19,"NM",63,0)
PSD LABEL PHARM^^0
"BLD",253,"KRN",19,"NM",64,0)
PSD LABEL VAULT^^0
"BLD",253,"KRN",19,"NM",65,0)
PSD MARK^^0
"BLD",253,"KRN",19,"NM",66,0)
PSD MENU^^0
"BLD",253,"KRN",19,"NM",67,0)
PSD MFG REPORT PRINT^^0
"BLD",253,"KRN",19,"NM",68,0)
PSD MFG/LOT/EXP DATE EDIT^^0
"BLD",253,"KRN",19,"NM",69,0)
PSD MGR^^0
"BLD",253,"KRN",19,"NM",70,0)
PSD MGR REPORTS^^0
"BLD",253,"KRN",19,"NM",71,0)
PSD NAOU EDIT^^0
"BLD",253,"KRN",19,"NM",72,0)
PSD NAOU INV GROUP EDIT^^0
"BLD",253,"KRN",19,"NM",73,0)
PSD NAOU INV GROUP PRINT^^0
"BLD",253,"KRN",19,"NM",74,0)
PSD NAOU INV GROUP SORT^^0
"BLD",253,"KRN",19,"NM",75,0)
PSD NAOU PRINT^^0
"BLD",253,"KRN",19,"NM",76,0)
PSD NAOU USAGE^^0
"BLD",253,"KRN",19,"NM",77,0)
PSD NARC EDIT^^0
"BLD",253,"KRN",19,"NM",78,0)
PSD NOT DELIVERED^^0
"BLD",253,"KRN",19,"NM",79,0)
PSD NOT DELIVERED NURSE^^0
"BLD",253,"KRN",19,"NM",80,0)
PSD NURSE DISPENSING^^0
"BLD",253,"KRN",19,"NM",81,0)
PSD NURSE HELP^^0
"BLD",253,"KRN",19,"NM",82,0)
PSD NURSE MENU^^0
"BLD",253,"KRN",19,"NM",83,0)
PSD NURSE PRIORITY ORDER CHECK^^0
"BLD",253,"KRN",19,"NM",84,0)
PSD NURSE REC TRANSFER GS^^0
"BLD",253,"KRN",19,"NM",85,0)
PSD NURSE REPRINT 2321^^0
"BLD",253,"KRN",19,"NM",86,0)
PSD NURSE SHIFT LOG^^0
"BLD",253,"KRN",19,"NM",87,0)
PSD NURSE TRANS GS MENU^^0
"BLD",253,"KRN",19,"NM",88,0)
PSD NURSE TRANSFER GS^^0
"BLD",253,"KRN",19,"NM",89,0)
PSD ON-HAND^^0
"BLD",253,"KRN",19,"NM",90,0)
PSD ON-HAND TECH^^0
"BLD",253,"KRN",19,"NM",91,0)
PSD ORDER ENTRY^^0
"BLD",253,"KRN",19,"NM",92,0)
PSD OUTPATIENT^^0
"BLD",253,"KRN",19,"NM",93,0)
PSD PEND NAOU ORDERS^^0
"BLD",253,"KRN",19,"NM",94,0)
PSD PEND VAULT ORDERS^^0
"BLD",253,"KRN",19,"NM",95,0)
PSD PHARM TECH^^0
"BLD",253,"KRN",19,"NM",96,0)
PSD PICKUP GS^^0
"BLD",253,"KRN",19,"NM",97,0)
PSD PRINT 2321^^0
"BLD",253,"KRN",19,"NM",98,0)
PSD PRINT 2638^^0
"BLD",253,"KRN",19,"NM",99,0)
PSD PRINT GS PICKUP^^0
"BLD",253,"KRN",19,"NM",100,0)
PSD PRINT INSPECTOR LOG^^0
"BLD",253,"KRN",19,"NM",101,0)
PSD PRINT PHARM DISP^^0
"BLD",253,"KRN",19,"NM",102,0)
PSD PRINT SETUP LISTS^^0
"BLD",253,"KRN",19,"NM",103,0)
PSD PRINT VAULT TRANSFERS^^0
"BLD",253,"KRN",19,"NM",104,0)
PSD PRINT VAULT TRANSFERS TECH^^0
"BLD",253,"KRN",19,"NM",105,0)
PSD PRODUCTION REPORTS^^0
"BLD",253,"KRN",19,"NM",106,0)
PSD PRT GS INSP HOLD^^0
"BLD",253,"KRN",19,"NM",107,0)
PSD PRT GS PICKED UP^^0
"BLD",253,"KRN",19,"NM",108,0)
PSD PURCHASE ORDER REVIEW^^0
"BLD",253,"KRN",19,"NM",109,0)
PSD PURGE^^0
"BLD",253,"KRN",19,"NM",110,0)
PSD PV INVOICE REVIEW^^0
"BLD",253,"KRN",19,"NM",111,0)
PSD READY GS FOR PICKUP^^0
"BLD",253,"KRN",19,"NM",112,0)
PSD REC GS^^0
"BLD",253,"KRN",19,"NM",113,0)
PSD RECEIPTS MENU^^0
"BLD",253,"KRN",19,"NM",114,0)
PSD RECEIVING^^0
"BLD",253,"KRN",19,"NM",115,0)
PSD REPRINT 2321^^0
"BLD",253,"KRN",19,"NM",116,0)
PSD REPRINT 2638^^0
"BLD",253,"KRN",19,"NM",117,0)
PSD REPRINT LABEL^^0
"BLD",253,"KRN",19,"NM",118,0)
PSD REPRINT MENU^^0
"BLD",253,"KRN",19,"NM",119,0)
PSD REPRINT WORKSHEET^^0
"BLD",253,"KRN",19,"NM",120,0)
PSD RX DISPENSING REPORT^^0
"BLD",253,"KRN",19,"NM",121,0)
PSD SETUP^^0
"BLD",253,"KRN",19,"NM",122,0)
PSD SITE^^0
"BLD",253,"KRN",19,"NM",123,0)
PSD STOCK DRUG EDIT^^0
"BLD",253,"KRN",19,"NM",124,0)
PSD STOCK LIST^^0
"BLD",253,"KRN",19,"NM",125,0)
PSD STOCK PRINT^^0
"BLD",253,"KRN",19,"NM",126,0)
PSD STOCK UNIT LIST^^0
"BLD",253,"KRN",19,"NM",127,0)
PSD TRANSACTION MENU^^0
"BLD",253,"KRN",19,"NM",128,0)
PSD TRANSFER AOU^^0
"BLD",253,"KRN",19,"NM",129,0)
PSD TRANSFER MENU^^0
"BLD",253,"KRN",19,"NM",130,0)
PSD TRANSFER NAOU^^0
"BLD",253,"KRN",19,"NM",131,0)
PSD TRANSFER VAULT DRUGS^^0
"BLD",253,"KRN",19,"NM",132,0)
PSD WARD ADD/DEL^^0
"BLD",253,"KRN",19,"NM",133,0)
PSD WARD CONVERSION^^0
"BLD",253,"KRN",19,"NM",134,0)
PSD WORKSHEET DISPENSING^^0
"BLD",253,"KRN",19,"NM",135,0)
PSD WORKSHEET PRINT^^0
"BLD",253,"KRN",19,"NM",136,0)
PSD DISPENSE TO NDES^^0
"BLD",253,"KRN",19,"NM",137,0)
PSD NAOU ADJ^^0
"BLD",253,"KRN",19,"NM",138,0)
PSD NAOU BAL INITIAL^^0
"BLD",253,"KRN",19,"NM",139,0)
PSD NURSE DISP MENU^^0
"BLD",253,"KRN",19,"NM",140,0)
PSD NURSE DISP REPORT^^0
"BLD",253,"KRN",19,"NM",141,0)
PSD NURSE GS MENU^^0
"BLD",253,"KRN",19,"NM",142,0)
PSD NURSE ORDER MENU^^0
"BLD",253,"KRN",19,"NM",143,0)
PSD NURSE SUPR MENU^^0
"BLD",253,"KRN",19,"NM",144,0)
PSD PAT ID LIST^^0
"BLD",253,"KRN",19,"NM",145,0)
PSD PAT INQUIRY^^0
"BLD",253,"KRN",19,"NM",147,0)
PSD NAOU BALANCE REPORT^^0
"BLD",253,"KRN",19,"NM",148,0)
PSD NURSE WASTE^^0
"BLD",253,"KRN",19,"NM",149,0)
PSD NURSE NOT GIVEN^^0
"BLD",253,"KRN",19,"NM",150,0)
PSD NURSE DEFECTIVE DOSE^^0
"BLD",253,"KRN",19,"NM",151,0)
PSD NURSE INFUSION^^0
"BLD",253,"KRN",19,"NM",152,0)
PSD NURSE ONLINE COUNT^^0
"BLD",253,"KRN",19,"NM",153,0)
PSD NURSE DELAYED DISPENSE^^0
"BLD",253,"KRN",19,"NM","B","PSD AMIS",1)

"BLD",253,"KRN",19,"NM","B","PSD BALANCE ADJUSTMENT REVIEW",2)

"BLD",253,"KRN",19,"NM","B","PSD BALANCE ADJUSTMENTS",3)

"BLD",253,"KRN",19,"NM","B","PSD BALANCE INITIALIZE",4)

"BLD",253,"KRN",19,"NM","B","PSD COMPLETE GS",5)

"BLD",253,"KRN",19,"NM","B","PSD CORRECT EXISTING GS",6)

"BLD",253,"KRN",19,"NM","B","PSD CORRECT GS STATUS",7)

"BLD",253,"KRN",19,"NM","B","PSD CORRECT STATUS",8)

"BLD",253,"KRN",19,"NM","B","PSD CORRECTION LOG",9)

"BLD",253,"KRN",19,"NM","B","PSD CORRECTION LOG REPORT",10)

"BLD",253,"KRN",19,"NM","B","PSD COST REPORTS",11)

"BLD",253,"KRN",19,"NM","B","PSD CP TRANSACTION REVIEW",12)

"BLD",253,"KRN",19,"NM","B","PSD DAILY LOG",13)

"BLD",253,"KRN",19,"NM","B","PSD DAILY LOG TECH",14)

"BLD",253,"KRN",19,"NM","B","PSD DEA LIST",15)

"BLD",253,"KRN",19,"NM","B","PSD DEST DRUGS REPORT",16)

"BLD",253,"KRN",19,"NM","B","PSD DEST NON-CS DRUG",17)

"BLD",253,"KRN",19,"NM","B","PSD DEST TEXT DRUG",18)

"BLD",253,"KRN",19,"NM","B","PSD DESTROY DEA41",19)

"BLD",253,"KRN",19,"NM","B","PSD DESTROY DRUGS",20)

"BLD",253,"KRN",19,"NM","B","PSD DESTROY MENU",21)

"BLD",253,"KRN",19,"NM","B","PSD DESTRUCTION HOLDING",22)

"BLD",253,"KRN",19,"NM","B","PSD DISPENSE TO NDES",136)

"BLD",253,"KRN",19,"NM","B","PSD DISPENSE W/O GS",23)

"BLD",253,"KRN",19,"NM","B","PSD DISPENSING MENU",24)

"BLD",253,"KRN",19,"NM","B","PSD DRUG CHECK",25)

"BLD",253,"KRN",19,"NM","B","PSD DRUG FILE DATA",26)

"BLD",253,"KRN",19,"NM","B","PSD DRUG LOC EDIT",27)

"BLD",253,"KRN",19,"NM","B","PSD DRUG LOC PRINT",28)

"BLD",253,"KRN",19,"NM","B","PSD DRUG RECEIPT HISTORY",29)

"BLD",253,"KRN",19,"NM","B","PSD EDIT/CANC VER ORD",30)

"BLD",253,"KRN",19,"NM","B","PSD EDIT/CANC VER ORD RPT",31)

"BLD",253,"KRN",19,"NM","B","PSD EMERGENCY ORDER REPORT",32)

"BLD",253,"KRN",19,"NM","B","PSD ENTER/EDIT MENU",33)

"BLD",253,"KRN",19,"NM","B","PSD ERR/ADJ EDIT",34)

"BLD",253,"KRN",19,"NM","B","PSD ERR/ADJ PENDING REPORT",35)

"BLD",253,"KRN",19,"NM","B","PSD ERR/ADJ RESOLVED REPORT",36)

"BLD",253,"KRN",19,"NM","B","PSD EXISTING GS",37)

"BLD",253,"KRN",19,"NM","B","PSD EXP REPORT",38)

"BLD",253,"KRN",19,"NM","B","PSD GS DISCREPANCY REPORT",39)

"BLD",253,"KRN",19,"NM","B","PSD GS HISTORY",40)

"BLD",253,"KRN",19,"NM","B","PSD GS LISTING",41)

"BLD",253,"KRN",19,"NM","B","PSD GS TRANS NOT RECD (NAOU)",42)

"BLD",253,"KRN",19,"NM","B","PSD GS TRANSFER (NAOU) REPORT",43)

"BLD",253,"KRN",19,"NM","B","PSD INACTIVATE NAOU",44)

"BLD",253,"KRN",19,"NM","B","PSD INACTIVATE NAOU STOCK DRUG",45)

"BLD",253,"KRN",19,"NM","B","PSD INFUSION MENU",46)

"BLD",253,"KRN",19,"NM","B","PSD INFUSION O/E",47)

"BLD",253,"KRN",19,"NM","B","PSD INSP LOG BY RECD DATE",48)

"BLD",253,"KRN",19,"NM","B","PSD INSP PLACE HOLD",49)

"BLD",253,"KRN",19,"NM","B","PSD INSP REMOVE HOLD",50)

"BLD",253,"KRN",19,"NM","B","PSD INSPECTOR MENU",51)

"BLD",253,"KRN",19,"NM","B","PSD INVEN SHEET PRT",52)

"BLD",253,"KRN",19,"NM","B","PSD INVEN TYPE EDIT",53)

"BLD",253,"KRN",19,"NM","B","PSD INVEN TYPE PRINT",54)

"BLD",253,"KRN",19,"NM","B","PSD IRL INSP DATA",55)

"BLD",253,"KRN",19,"NM","B","PSD IRL INSP MENU",56)

"BLD",253,"KRN",19,"NM","B","PSD IRL INSPECTOR INV",57)

"BLD",253,"KRN",19,"NM","B","PSD IRL INV DATA",58)

"BLD",253,"KRN",19,"NM","B","PSD IRL INV MENU",59)

"BLD",253,"KRN",19,"NM","B","PSD IRL VAULT INV",60)

"BLD",253,"KRN",19,"NM","B","PSD LABEL DRUG/NUMBER",61)

"BLD",253,"KRN",19,"NM","B","PSD LABEL INSP",62)

"BLD",253,"KRN",19,"NM","B","PSD LABEL PHARM",63)

"BLD",253,"KRN",19,"NM","B","PSD LABEL VAULT",64)

"BLD",253,"KRN",19,"NM","B","PSD MARK",65)

"BLD",253,"KRN",19,"NM","B","PSD MENU",66)

"BLD",253,"KRN",19,"NM","B","PSD MFG REPORT PRINT",67)

"BLD",253,"KRN",19,"NM","B","PSD MFG/LOT/EXP DATE EDIT",68)

"BLD",253,"KRN",19,"NM","B","PSD MGR",69)

"BLD",253,"KRN",19,"NM","B","PSD MGR REPORTS",70)

"BLD",253,"KRN",19,"NM","B","PSD NAOU ADJ",137)

"BLD",253,"KRN",19,"NM","B","PSD NAOU BAL INITIAL",138)

"BLD",253,"KRN",19,"NM","B","PSD NAOU BALANCE REPORT",147)

"BLD",253,"KRN",19,"NM","B","PSD NAOU EDIT",71)

"BLD",253,"KRN",19,"NM","B","PSD NAOU INV GROUP EDIT",72)

"BLD",253,"KRN",19,"NM","B","PSD NAOU INV GROUP PRINT",73)

"BLD",253,"KRN",19,"NM","B","PSD NAOU INV GROUP SORT",74)

"BLD",253,"KRN",19,"NM","B","PSD NAOU PRINT",75)

"BLD",253,"KRN",19,"NM","B","PSD NAOU USAGE",76)

"BLD",253,"KRN",19,"NM","B","PSD NARC EDIT",77)

"BLD",253,"KRN",19,"NM","B","PSD NOT DELIVERED",78)

"BLD",253,"KRN",19,"NM","B","PSD NOT DELIVERED NURSE",79)

"BLD",253,"KRN",19,"NM","B","PSD NURSE DEFECTIVE DOSE",150)

"BLD",253,"KRN",19,"NM","B","PSD NURSE DELAYED DISPENSE",153)

"BLD",253,"KRN",19,"NM","B","PSD NURSE DISP MENU",139)

"BLD",253,"KRN",19,"NM","B","PSD NURSE DISP REPORT",140)

"BLD",253,"KRN",19,"NM","B","PSD NURSE DISPENSING",80)

"BLD",253,"KRN",19,"NM","B","PSD NURSE GS MENU",141)

"BLD",253,"KRN",19,"NM","B","PSD NURSE HELP",81)

"BLD",253,"KRN",19,"NM","B","PSD NURSE INFUSION",151)

"BLD",253,"KRN",19,"NM","B","PSD NURSE MENU",82)

"BLD",253,"KRN",19,"NM","B","PSD NURSE NOT GIVEN",149)

"BLD",253,"KRN",19,"NM","B","PSD NURSE ONLINE COUNT",152)

"BLD",253,"KRN",19,"NM","B","PSD NURSE ORDER MENU",142)

"BLD",253,"KRN",19,"NM","B","PSD NURSE PRIORITY ORDER CHECK",83)

"BLD",253,"KRN",19,"NM","B","PSD NURSE REC TRANSFER GS",84)

"BLD",253,"KRN",19,"NM","B","PSD NURSE REPRINT 2321",85)

"BLD",253,"KRN",19,"NM","B","PSD NURSE SHIFT LOG",86)

"BLD",253,"KRN",19,"NM","B","PSD NURSE SUPR MENU",143)

"BLD",253,"KRN",19,"NM","B","PSD NURSE TRANS GS MENU",87)

"BLD",253,"KRN",19,"NM","B","PSD NURSE TRANSFER GS",88)

"BLD",253,"KRN",19,"NM","B","PSD NURSE WASTE",148)

"BLD",253,"KRN",19,"NM","B","PSD ON-HAND",89)

"BLD",253,"KRN",19,"NM","B","PSD ON-HAND TECH",90)

"BLD",253,"KRN",19,"NM","B","PSD ORDER ENTRY",91)

"BLD",253,"KRN",19,"NM","B","PSD OUTPATIENT",92)

"BLD",253,"KRN",19,"NM","B","PSD PAT ID LIST",144)

"BLD",253,"KRN",19,"NM","B","PSD PAT INQUIRY",145)

"BLD",253,"KRN",19,"NM","B","PSD PEND NAOU ORDERS",93)

"BLD",253,"KRN",19,"NM","B","PSD PEND VAULT ORDERS",94)

"BLD",253,"KRN",19,"NM","B","PSD PHARM TECH",95)

"BLD",253,"KRN",19,"NM","B","PSD PICKUP GS",96)

"BLD",253,"KRN",19,"NM","B","PSD PRINT 2321",97)

"BLD",253,"KRN",19,"NM","B","PSD PRINT 2638",98)

"BLD",253,"KRN",19,"NM","B","PSD PRINT GS PICKUP",99)

"BLD",253,"KRN",19,"NM","B","PSD PRINT INSPECTOR LOG",100)

"BLD",253,"KRN",19,"NM","B","PSD PRINT PHARM DISP",101)

"BLD",253,"KRN",19,"NM","B","PSD PRINT SETUP LISTS",102)

"BLD",253,"KRN",19,"NM","B","PSD PRINT VAULT TRANSFERS",103)

"BLD",253,"KRN",19,"NM","B","PSD PRINT VAULT TRANSFERS TECH",104)

"BLD",253,"KRN",19,"NM","B","PSD PRODUCTION REPORTS",105)

"BLD",253,"KRN",19,"NM","B","PSD PRT GS INSP HOLD",106)

"BLD",253,"KRN",19,"NM","B","PSD PRT GS PICKED UP",107)

"BLD",253,"KRN",19,"NM","B","PSD PURCHASE ORDER REVIEW",108)

"BLD",253,"KRN",19,"NM","B","PSD PURGE",109)

"BLD",253,"KRN",19,"NM","B","PSD PV INVOICE REVIEW",110)

"BLD",253,"KRN",19,"NM","B","PSD READY GS FOR PICKUP",111)

"BLD",253,"KRN",19,"NM","B","PSD REC GS",112)

"BLD",253,"KRN",19,"NM","B","PSD RECEIPTS MENU",113)

"BLD",253,"KRN",19,"NM","B","PSD RECEIVING",114)

"BLD",253,"KRN",19,"NM","B","PSD REPRINT 2321",115)

"BLD",253,"KRN",19,"NM","B","PSD REPRINT 2638",116)

"BLD",253,"KRN",19,"NM","B","PSD REPRINT LABEL",117)

"BLD",253,"KRN",19,"NM","B","PSD REPRINT MENU",118)

"BLD",253,"KRN",19,"NM","B","PSD REPRINT WORKSHEET",119)

"BLD",253,"KRN",19,"NM","B","PSD RX DISPENSING REPORT",120)

"BLD",253,"KRN",19,"NM","B","PSD SETUP",121)

"BLD",253,"KRN",19,"NM","B","PSD SITE",122)

"BLD",253,"KRN",19,"NM","B","PSD STOCK DRUG EDIT",123)

"BLD",253,"KRN",19,"NM","B","PSD STOCK LIST",124)

"BLD",253,"KRN",19,"NM","B","PSD STOCK PRINT",125)

"BLD",253,"KRN",19,"NM","B","PSD STOCK UNIT LIST",126)

"BLD",253,"KRN",19,"NM","B","PSD TRANSACTION MENU",127)

"BLD",253,"KRN",19,"NM","B","PSD TRANSFER AOU",128)

"BLD",253,"KRN",19,"NM","B","PSD TRANSFER MENU",129)

"BLD",253,"KRN",19,"NM","B","PSD TRANSFER NAOU",130)

"BLD",253,"KRN",19,"NM","B","PSD TRANSFER VAULT DRUGS",131)

"BLD",253,"KRN",19,"NM","B","PSD WARD ADD/DEL",132)

"BLD",253,"KRN",19,"NM","B","PSD WARD CONVERSION",133)

"BLD",253,"KRN",19,"NM","B","PSD WORKSHEET DISPENSING",134)

"BLD",253,"KRN",19,"NM","B","PSD WORKSHEET PRINT",135)

"BLD",253,"KRN",19.1,0)
19.1
"BLD",253,"KRN",19.1,"NM",0)
^9.68A^6^6
"BLD",253,"KRN",19.1,"NM",1,0)
PSD ERROR^^0
"BLD",253,"KRN",19.1,"NM",2,0)
PSD NURSE^^0
"BLD",253,"KRN",19.1,"NM",3,0)
PSD PARAM^^0
"BLD",253,"KRN",19.1,"NM",4,0)
PSD TECH^^0
"BLD",253,"KRN",19.1,"NM",5,0)
PSD TRAN^^0
"BLD",253,"KRN",19.1,"NM",6,0)
PSDMGR^^0
"BLD",253,"KRN",19.1,"NM","B","PSD ERROR",1)

"BLD",253,"KRN",19.1,"NM","B","PSD NURSE",2)

"BLD",253,"KRN",19.1,"NM","B","PSD PARAM",3)

"BLD",253,"KRN",19.1,"NM","B","PSD TECH",4)

"BLD",253,"KRN",19.1,"NM","B","PSD TRAN",5)

"BLD",253,"KRN",19.1,"NM","B","PSDMGR",6)

"BLD",253,"KRN",101,0)
101
"BLD",253,"KRN",101,"NM",0)
^9.68A^10^10
"BLD",253,"KRN",101,"NM",1,0)
PSD A01 CLIENT^^0
"BLD",253,"KRN",101,"NM",2,0)
PSD A01 SERVER^^3
"BLD",253,"KRN",101,"NM",3,0)
PSD A02 CLIENT^^0
"BLD",253,"KRN",101,"NM",4,0)
PSD A02 SERVER^^3
"BLD",253,"KRN",101,"NM",5,0)
PSD A03 CLIENT^^0
"BLD",253,"KRN",101,"NM",6,0)
PSD A03 SERVER^^3
"BLD",253,"KRN",101,"NM",7,0)
PSD DFT CLIENT^^0
"BLD",253,"KRN",101,"NM",8,0)
PSD DFT SERVER^^3
"BLD",253,"KRN",101,"NM",9,0)
DGPM MOVEMENT EVENTS^^2
"BLD",253,"KRN",101,"NM",10,0)
PSD PAT ADT^^0
"BLD",253,"KRN",101,"NM","B","DGPM MOVEMENT EVENTS",9)

"BLD",253,"KRN",101,"NM","B","PSD A01 CLIENT",1)

"BLD",253,"KRN",101,"NM","B","PSD A01 SERVER",2)

"BLD",253,"KRN",101,"NM","B","PSD A02 CLIENT",3)

"BLD",253,"KRN",101,"NM","B","PSD A02 SERVER",4)

"BLD",253,"KRN",101,"NM","B","PSD A03 CLIENT",5)

"BLD",253,"KRN",101,"NM","B","PSD A03 SERVER",6)

"BLD",253,"KRN",101,"NM","B","PSD DFT CLIENT",7)

"BLD",253,"KRN",101,"NM","B","PSD DFT SERVER",8)

"BLD",253,"KRN",101,"NM","B","PSD PAT ADT",10)

"BLD",253,"KRN",409.61,0)
409.61
"BLD",253,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",253,"KRN",409.61,"NM",1)
^^^
"BLD",253,"KRN",409.61,"NM",1,0)
PSD ORDER ENTRY^^1
"BLD",253,"KRN",409.61,"NM","B","PSD ORDER ENTRY",1)

"BLD",253,"KRN",771,0)
771
"BLD",253,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",253,"KRN",771,"NM",1,0)
PSD-CS^^0
"BLD",253,"KRN",771,"NM",2,0)
PSD-NDES^^0
"BLD",253,"KRN",771,"NM","B","PSD-CS",1)

"BLD",253,"KRN",771,"NM","B","PSD-NDES",2)

"BLD",253,"KRN",869.2,0)
869.2
"BLD",253,"KRN",869.2,"NM",0)
^9.68A^3^3
"BLD",253,"KRN",869.2,"NM",1,0)
PSD-NDES HLLP^^0
"BLD",253,"KRN",869.2,"NM",2,0)
PSD-NDES MAILMAN^^0
"BLD",253,"KRN",869.2,"NM",3,0)
PSD-NDES X3.28^^0
"BLD",253,"KRN",869.2,"NM","B","PSD-NDES HLLP",1)

"BLD",253,"KRN",869.2,"NM","B","PSD-NDES MAILMAN",2)

"BLD",253,"KRN",869.2,"NM","B","PSD-NDES X3.28",3)

"BLD",253,"KRN",870,0)
870
"BLD",253,"KRN",870,"NM",0)
^9.68A^3^3
"BLD",253,"KRN",870,"NM",1,0)
PSD HLLP^^0
"BLD",253,"KRN",870,"NM",2,0)
PSD MM^^0
"BLD",253,"KRN",870,"NM",3,0)
PSD X3.28^^0
"BLD",253,"KRN",870,"NM","B","PSD HLLP",1)

"BLD",253,"KRN",870,"NM","B","PSD MM",2)

"BLD",253,"KRN",870,"NM","B","PSD X3.28",3)

"BLD",253,"KRN",8994,0)
8994
"BLD",253,"KRN","B",.4,.4)

"BLD",253,"KRN","B",.401,.401)

"BLD",253,"KRN","B",.402,.402)

"BLD",253,"KRN","B",.403,.403)

"BLD",253,"KRN","B",.5,.5)

"BLD",253,"KRN","B",.84,.84)

"BLD",253,"KRN","B",3.6,3.6)

"BLD",253,"KRN","B",3.8,3.8)

"BLD",253,"KRN","B",9.2,9.2)

"BLD",253,"KRN","B",9.8,9.8)

"BLD",253,"KRN","B",19,19)

"BLD",253,"KRN","B",19.1,19.1)

"BLD",253,"KRN","B",101,101)

"BLD",253,"KRN","B",409.61,409.61)

"BLD",253,"KRN","B",771,771)

"BLD",253,"KRN","B",869.2,869.2)

"BLD",253,"KRN","B",870,870)

"BLD",253,"KRN","B",8994,8994)

"BLD",253,"PRE")
PSDINPRE
"BLD",253,"QUES",0)
^9.62^4^4
"BLD",253,"QUES",1,0)
POS1
"BLD",253,"QUES",1,1)
Y
"BLD",253,"QUES",1,"A")
for Narcotic Dispensing Equipment Systems
"BLD",253,"QUES",1,"A1",0)
^^1^1^2961220^^
"BLD",253,"QUES",1,"A1",1,0)
Do you want to enter edit your interface setup
"BLD",253,"QUES",1,"B")
No
"BLD",253,"QUES",1,"Q")
you can simply D ^PSDHL7 when you're ready.
"BLD",253,"QUES",1,"Q1",0)
^^19^19^2960329^^
"BLD",253,"QUES",1,"Q1",1,0)
          Interface to Narcotic Dispensing Equipment Systems
"BLD",253,"QUES",1,"Q1",2,0)
 
"BLD",253,"QUES",1,"Q1",3,0)
     Version 3.0 of the Controlled Substances package uses the HL7 package
"BLD",253,"QUES",1,"Q1",4,0)
to provide a generic interface to Narcotic Dispensing Equipment Systems
"BLD",253,"QUES",1,"Q1",5,0)
(NDES).  HL7 or Health Level Seven is a standard protocol which specifies
"BLD",253,"QUES",1,"Q1",6,0)
the implementation of interfaces between two computer applications (sender
"BLD",253,"QUES",1,"Q1",7,0)
and receiver) from different vendors for electronic data exchange in
"BLD",253,"QUES",1,"Q1",8,0)
health care environments.  If your Pharmacy service is using an NDES such
"BLD",253,"QUES",1,"Q1",9,0)
as Access, Meditrol, Pyxis, or Suremed you may wish to set up the
"BLD",253,"QUES",1,"Q1",10,0)
interface.  This will be accomplished by adding entries to the HL7
"BLD",253,"QUES",1,"Q1",11,0)
APPLICATION PARAMETER (#771), HL LOWER LEVEL PROTOCOL PARAMETER (#869.2),
"BLD",253,"QUES",1,"Q1",12,0)
and HL LOGICAL LINK (#870) files.  You will be asked to identify an HL7
"BLD",253,"QUES",1,"Q1",13,0)
device which must exist as entry in your DEVICE file (#3.5).
"BLD",253,"QUES",1,"Q1",14,0)
 
"BLD",253,"QUES",1,"Q1",15,0)
     The PSDHLK routine is invoked by the Controlled Substances post-init.
"BLD",253,"QUES",1,"Q1",16,0)
The routine, PSDHL7 is also independantly invokable at any time that a site
"BLD",253,"QUES",1,"Q1",17,0)
needs to set up their interface for narcotic dispensing equipment systems.
"BLD",253,"QUES",1,"Q1",18,0)
 
"BLD",253,"QUES",1,"Q1",19,0)
     If you do NOT want to perform this step at the time of the post-init,
"BLD",253,"QUES",2,0)
POS2
"BLD",253,"QUES",2,1)
S^H:Hybrid Lower Layer Protocol;X:X3.28 Protocol
"BLD",253,"QUES",2,"A")
Select a communications protocol
"BLD",253,"QUES",2,"B")
H
"BLD",253,"QUES",2,"M")
K:$G(XPDQUES("POS1"))'=1 DIR
"BLD",253,"QUES",2,"Q")
Select the protocol that your Pharmacy's narcotic dispensing equipment system vendor will use for communication.
"BLD",253,"QUES",3,0)
POS3
"BLD",253,"QUES",3,1)
869.2,300.01
"BLD",253,"QUES",3,"M")
K:$G(XPDQUES("POS2"))'="X"!($G(XPDQUES("POS1"))'=1) DIR
"BLD",253,"QUES",4,0)
POS4
"BLD",253,"QUES",4,1)
869.2,200.01
"BLD",253,"QUES",4,"M")
K:$G(XPDQUES("POS2"))'="H"!($G(XPDQUES("POS1"))'=1) DIR
"BLD",253,"QUES","B","POS1",1)

"BLD",253,"QUES","B","POS2",2)

"BLD",253,"QUES","B","POS3",3)

"BLD",253,"QUES","B","POS4",4)

"BLD",253,"REQB",0)
^9.611^3^2
"BLD",253,"REQB",2,0)
XU*8.0*26^2
"BLD",253,"REQB",3,0)
XU*8.0*44^2
"BLD",253,"REQB","B","XU*8.0*26",2)

"BLD",253,"REQB","B","XU*8.0*44",3)

"DATA",58.82,.5,0)
REQUESTED - NOT ORDERED
"DATA",58.82,1,0)
ORDERED - NOT PROCESSED
"DATA",58.82,2,0)
PROCESSED - NOT DISPENSED
"DATA",58.82,3,0)
FILLED - NOT DELIVERED
"DATA",58.82,4,0)
DELIVERED - ACTIVELY ON NAOU
"DATA",58.82,5,0)
COMPLETED - GREEN SHEET READY FOR PICKUP
"DATA",58.82,6,0)
COMPLETED - GREEN SHEET PICKED UP
"DATA",58.82,7,0)
COMPLETED - REVIEWED
"DATA",58.82,8,0)
COMPLETED - PENDING PROBLEM RESOLUTION
"DATA",58.82,9,0)
CANCELLED
"DATA",58.82,10,0)
TRANSFERRED TO ANOTHER NAOU
"DATA",58.82,11,0)
UNDER REVIEW BY INSPECTOR
"DATA",58.82,12,0)
LOGGED BY TRAKKER
"DATA",58.82,13,0)
DELIVERED - PERPETUAL INVENTORY
"DATA",58.83,1,0)
NO DISCREPANCY
"DATA",58.83,2,0)
TURN IN FOR DESTRUCTION
"DATA",58.83,3,0)
RETURNED TO STOCK
"DATA",58.83,4,0)
MATH ERROR
"DATA",58.83,5,0)
GREEN SHEET NOT SIGNED BY NURSE
"DATA",58.83,6,0)
OTHER - REFERRED TO PHARMACY SUPERVISOR
"DATA",58.84,1,0)
RECEIPT INTO PHARMACY
"DATA",58.84,2,0)
DISPENSED FROM PHARMACY
"DATA",58.84,3,0)
RETURNED TO STOCK
"DATA",58.84,4,0)
DESTROYED
"DATA",58.84,5,0)
TRANSFER BETWEEN NAOUS
"DATA",58.84,6,0)
OUTPATIENT RX
"DATA",58.84,7,0)
CANCEL AN ORDER
"DATA",58.84,8,0)
COMPLETE A GREEN SHEET
"DATA",58.84,9,0)
BALANCE ADJUSTMENT
"DATA",58.84,10,0)
RETURNED TO MANUFACTURER
"DATA",58.84,11,0)
BALANCE INITIALIZATION
"DATA",58.84,12,0)
INITIALIZE EXISTING GS
"DATA",58.84,13,0)
CANCEL VERIFIED ORDER
"DATA",58.84,14,0)
EDIT VERIFIED ORDER
"DATA",58.84,15,0)
IV DISPENSING
"DATA",58.84,16,0)
TRANSFER BETWEEN VAULTS
"DATA",58.84,17,0)
LOGGED FOR PATIENT
"DATA",58.84,18,0)
WASTED
"DATA",58.84,19,0)
START INVENTORY (PHARMACY)
"DATA",58.84,20,0)
COMPLETE INVENTORY (PHARMACY)
"DATA",58.84,21,0)
START INVENTORY (INSPECTOR)
"DATA",58.84,22,0)
COMPLETE INVENTORY (INSPECTOR)
"DATA",58.84,23,0)
COUNT VERIFICATION
"DATA",58.88,1,0)
INSPECTOR
"DATA",58.88,1,1,0)
^^284^284^2970113^^^^
"DATA",58.88,1,1,1,0)
OA(300,10)                  ::File "A" to store record number
"DATA",58.88,1,1,2,0)
OB(300,60)                  ::File "B" to store drug name
"DATA",58.88,1,1,3,0)
OC(300,10)                  ::File "C" to store drug count
"DATA",58.88,1,1,4,0)
OD(300,128)                 ::File "D" to store inventory data
"DATA",58.88,1,1,5,0)
ON(9,20)                    ::
"DATA",58.88,1,1,6,0)
OV(100,75)                  ::File "V" to be Variable file
"DATA",58.88,1,1,7,0)
OE(5,20)                    ::Store location internal entry number
"DATA",58.88,1,1,8,0)
OF(2,40)                    ::Store program variable
"DATA",58.88,1,1,9,0)
HA=0                        ::
"DATA",58.88,1,1,10,0)
HB=0                        ::
"DATA",58.88,1,1,11,0)
HC=0                        ::
"DATA",58.88,1,1,12,0)
HD=0                        ::
"DATA",58.88,1,1,13,0)
HE=0                        ::
"DATA",58.88,1,1,14,0)
DV(0)="*"                   ::
"DATA",58.88,1,1,15,0)
D$0=""                      ::
"DATA",58.88,1,1,16,0)
B1111                       ::
"DATA",58.88,1,1,17,0)
P"Press F1 on the"          ::
"DATA",58.88,1,1,18,0)
P"TRAKKER, to accept"       ::
"DATA",58.88,1,1,19,0)
P"the data"                 ::
"DATA",58.88,1,1,20,0)
P"=>"                       ::
"DATA",58.88,1,1,21,0)
D$0=""                      ::
"DATA",58.88,1,1,22,0)
A;6000                      ::
"DATA",58.88,1,1,23,0)
G#0=1.QUIT                  ::
"DATA",58.88,1,1,24,0)
G$0="F1".RECEIVE            ::
"DATA",58.88,1,1,25,0)
B10                         ::
"DATA",58.88,1,1,26,0)
P"No data received"         ::
"DATA",58.88,1,1,27,0)
W2                          ::
"DATA",58.88,1,1,28,0)
G.QUIT                      ::
"DATA",58.88,1,1,29,0)
.RECEIVE                    ::
"DATA",58.88,1,1,30,0)
XMP,V                       ::
"DATA",58.88,1,1,31,0)
D$0=""                      ::
"DATA",58.88,1,1,32,0)
VDMP;100                    ::
"DATA",58.88,1,1,33,0)
RE                          ::
"DATA",58.88,1,1,34,0)
D$0=""                      ::
"DATA",58.88,1,1,35,0)
.R1                         ::  R  1
"DATA",58.88,1,1,36,0)
VDMP;100                    ::
"DATA",58.88,1,1,37,0)
G#0=0.1                     ::
"DATA",58.88,1,1,38,0)
RA                          ::
"DATA",58.88,1,1,39,0)
VDMP;100                    ::
"DATA",58.88,1,1,40,0)
RB                          ::
"DATA",58.88,1,1,41,0)
VDMP;100                    ::
"DATA",58.88,1,1,42,0)
RC                          ::
"DATA",58.88,1,1,43,0)
G.R1                        ::
"DATA",58.88,1,1,44,0)
.1                          ::
"DATA",58.88,1,1,45,0)
P"\e[2JInventory Menu"      ::
"DATA",58.88,1,1,46,0)
P"1.Perform Inventory"      ::
"DATA",58.88,1,1,47,0)
P"2.Send Data to DHCP"      ::
"DATA",58.88,1,1,48,0)
P"=>"                       ::
"DATA",58.88,1,1,49,0)
D$0=""                      ::
"DATA",58.88,1,1,50,0)
A                           ::
"DATA",58.88,1,1,51,0)
G$0="2".XMIT                ::
"DATA",58.88,1,1,52,0)
G$0="1".BGN3                ::
"DATA",58.88,1,1,53,0)
B11                         ::
"DATA",58.88,1,1,54,0)
P"Improper Answer"          ::
"DATA",58.88,1,1,55,0)
W2                          ::
"DATA",58.88,1,1,56,0)
G.1                         ::
"DATA",58.88,1,1,57,0)
HV=0                        ::
"DATA",58.88,1,1,58,0)
.BGN2                       ::begin inventory procedure
"DATA",58.88,1,1,59,0)
H#1=A                       ::Check to see if proper data stored in A
"DATA",58.88,1,1,60,0)
G#1<2.ERR2                  ::If no records in file A, data was not downloaded.
"DATA",58.88,1,1,61,0)
.BGN3                       ::Ask nurse to scan his/her ID
"DATA",58.88,1,1,62,0)
S.CLR                       ::Clear screen
"DATA",58.88,1,1,63,0)
P"Please Identify"          ::
"DATA",58.88,1,1,64,0)
P"your self. "              ::
"DATA",58.88,1,1,65,0)
P"=>"                       ::Show prompt
"DATA",58.88,1,1,66,0)
D$0=""                      ::Initialize $0
"DATA",58.88,1,1,67,0)
A;6000                      ::ask for input
"DATA",58.88,1,1,68,0)
DN(1)=$0                    ::
"DATA",58.88,1,1,69,0)
G$0="".1                    ::Nothing entered go back to begin
"DATA",58.88,1,1,70,0)
G$0="@###?##?####".OK       ::If input matches specs goto OK
"DATA",58.88,1,1,71,0)
B11                         ::Beep
"DATA",58.88,1,1,72,0)
P"Improper Entry"           ::Show error message
"DATA",58.88,1,1,73,0)
W3                          ::wait 3 seconds
"DATA",58.88,1,1,74,0)
G.BGN3                      ::Ask for nurse ID again
"DATA",58.88,1,1,75,0)
.OK                         ::Nurse ID is correct
"DATA",58.88,1,1,76,0)
D$0=$0+"^"                  ::
"DATA",58.88,1,1,77,0)
TA                          ::
"DATA",58.88,1,1,78,0)
DF(1)=$0                    ::
"DATA",58.88,1,1,79,0)
.BGN4                       ::Scan drug label
"DATA",58.88,1,1,80,0)
P"Scan Drug Barcode"        ::Display prompt for drug
"DATA",58.88,1,1,81,0)
P"=>"                       ::Show prompt
"DATA",58.88,1,1,82,0)
D$0=""                      ::Initialize $0
"DATA",58.88,1,1,83,0)
A;6000                      ::ask for input
"DATA",58.88,1,1,84,0)
G#0=1.1                     ::
"DATA",58.88,1,1,85,0)
G$0="".1                    ::
"DATA",58.88,1,1,86,0)
D#1=0                       ::Set #1 equal to zero for beginning of file search
"DATA",58.88,1,1,87,0)
LA(#1)$0#2                  ::look in file "A" for a match to data stored in
"DATA",58.88,1,1,88,0)
:                           ::$0, and store that data in #2
"DATA",58.88,1,1,89,0)
G#2=300.NOTFND             ::If entry not found inform user of no match
"DATA",58.88,1,1,90,0)
DV(2)=A(#2)                 ::Set var. V(2) equal to transaction number
"DATA",58.88,1,1,91,0)
DV(3)=B(#2)                 ::Set var. V(3) equal to drug name
"DATA",58.88,1,1,92,0)
.QNTY                       ::
"DATA",58.88,1,1,93,0)
DV(4)=C(#2)                 ::Set var. V(4) equal to count
"DATA",58.88,1,1,94,0)
.SHOW                       ::  S  H  O  W
"DATA",58.88,1,1,95,0)
S.CLR                       ::
"DATA",58.88,1,1,96,0)
PV(3)                       ::Display drug name
"DATA",58.88,1,1,97,0)
W2                          ::
"DATA",58.88,1,1,98,0)
D$2="Quantity: "+V(4)       ::Set $2 equal to quantity prompt
"DATA",58.88,1,1,99,0)
P$2                         ::Display quantity prompt and quantity
"DATA",58.88,1,1,100,0)
D$3=""                      ::
"DATA",58.88,1,1,101,0)
D$3=V(4)                    ::
"DATA",58.88,1,1,102,0)
C#8=$3                      ::
"DATA",58.88,1,1,103,0)
.ASK                        ::Ask is correct
"DATA",58.88,1,1,104,0)
P"Correct count ? "         ::
"DATA",58.88,1,1,105,0)
P"YES // "                  ::
"DATA",58.88,1,1,106,0)
D$0=""                      ::Initialize $0
"DATA",58.88,1,1,107,0)
A;6000                      ::Ask for input
"DATA",58.88,1,1,108,0)
G#0=1.1                     ::
"DATA",58.88,1,1,109,0)
G$0="".UP4                  ::
"DATA",58.88,1,1,110,0)
:GV(4)="0".EMPTY             ::
"DATA",58.88,1,1,111,0)
G$0="Y".UP4                 ::  ''
"DATA",58.88,1,1,112,0)
G$0="N".NOTOK               ::Go make adjustments if answer is "N"
"DATA",58.88,1,1,113,0)
B11                         ::Display error message
"DATA",58.88,1,1,114,0)
S.CLR                       ::clear screen
"DATA",58.88,1,1,115,0)
P"Answer with a Y,N,"       ::
"DATA",58.88,1,1,116,0)
P"or <RET>"                 ::
"DATA",58.88,1,1,117,0)
W3                          ::Wait three seconds
"DATA",58.88,1,1,118,0)
G.SHOW                      ::
"DATA",58.88,1,1,119,0)
.SUM                        ::
"DATA",58.88,1,1,120,0)
D$0=""                      ::
"DATA",58.88,1,1,121,0)
S.SUM1                      ::
"DATA",58.88,1,1,122,0)
DV(6)=""                    ::
"DATA",58.88,1,1,123,0)
DV(8)=""                    ::
"DATA",58.88,1,1,124,0)
DV(9)=""                    ::
"DATA",58.88,1,1,125,0)
DV(10)=""                   ::
"DATA",58.88,1,1,126,0)
DV(11)=""                   ::
"DATA",58.88,1,1,127,0)
DV(12)=""                   ::
"DATA",58.88,1,1,128,0)
G.BGN4                      ::
"DATA",58.88,1,1,129,0)
.SUM1                       ::
"DATA",58.88,1,1,130,0)
P"Updating Files"     :
"DATA",58.88,1,1,131,0)
P"Please wait"              ::
"DATA",58.88,1,1,132,0)
D$0=$0+N(1)                 ::1st nurse id
"DATA",58.88,1,1,133,0)
I"^"                        ::
"DATA",58.88,1,1,134,0)
D$0=$0+V(2)                 ::transaction number
"DATA",58.88,1,1,135,0)
I"^"                        ::
"DATA",58.88,1,1,136,0)
D$0=$0+V(3)                 ::drug name
"DATA",58.88,1,1,137,0)
I"^"                        ::
"DATA",58.88,1,1,138,0)
D$0=$0+C(#2)                ::original count
"DATA",58.88,1,1,139,0)
I"^"                        ::
"DATA",58.88,1,1,140,0)
D$0=$0+V(5)                 ::patient id
"DATA",58.88,1,1,141,0)
I"^"                        ::
"DATA",58.88,1,1,142,0)
D$0=$0+V(6)                 ::dispensed amount
"DATA",58.88,1,1,143,0)
I"^"                        ::
"DATA",58.88,1,1,144,0)
D$0=$0+V(7)                 ::2nd nurse
"DATA",58.88,1,1,145,0)
I"^"                        ::
"DATA",58.88,1,1,146,0)
D$0=$0+V(8)                 ::Correct Count
"DATA",58.88,1,1,147,0)
I"^"                        ::
"DATA",58.88,1,1,148,0)
D$0=$0+V(9)                 ::Wasted Amount
"DATA",58.88,1,1,149,0)
I"^"                        ::
"DATA",58.88,1,1,150,0)
D$0=$0+V(10)                ::Liquid dispensed
"DATA",58.88,1,1,151,0)
I"^"                        ::
"DATA",58.88,1,1,152,0)
D$0=$0+V(11)                ::Wasted comments
"DATA",58.88,1,1,153,0)
I"^"                        ::
"DATA",58.88,1,1,154,0)
D$0=$0+V(12)                ::Liquid Dispensed Comments
"DATA",58.88,1,1,155,0)
TA                          ::Append time to data
"DATA",58.88,1,1,156,0)
R$0D                        ::Record string $0 into file D
"DATA",58.88,1,1,157,0)
DV(8)=""                    ::
"DATA",58.88,1,1,158,0)
DV(9)=""                    ::
"DATA",58.88,1,1,159,0)
DV(10)=""                   ::
"DATA",58.88,1,1,160,0)
DV(11)=""                   ::
"DATA",58.88,1,1,161,0)
DV(12)=""                   ::
"DATA",58.88,1,1,162,0)
C$3=#5                      ::
"DATA",58.88,1,1,163,0)
DV(4)=$3                    ::Set variable drug count to adjusted count
"DATA",58.88,1,1,164,0)
DC(#2)=$3                   ::
"DATA",58.88,1,1,165,0)
.UP1                        ::   U  P  1
"DATA",58.88,1,1,166,0)
D#4=0                       ::
"DATA",58.88,1,1,167,0)
D$3=""                      ::
"DATA",58.88,1,1,168,0)
D$3=V(3)                    ::
"DATA",58.88,1,1,169,0)
G.UP3                       ::
"DATA",58.88,1,1,170,0)
.UP2                        ::   U  P  2
"DATA",58.88,1,1,171,0)
D#4=#4+1                    ::
"DATA",58.88,1,1,172,0)
.UP3                        ::   U  P  3
"DATA",58.88,1,1,173,0)
G#4=#2.UP2                  ::
"DATA",58.88,1,1,174,0)
G#4=300.DONEUP              ::
"DATA",58.88,1,1,175,0)
D$2=""                      ::
"DATA",58.88,1,1,176,0)
D$2=B(#4)                   ::
"DATA",58.88,1,1,177,0)
G$2=$3.ADJUST               ::
"DATA",58.88,1,1,178,0)
G.UP2                       ::
"DATA",58.88,1,1,179,0)
.ADJUST                     ::   A  D  J  U  S  T
"DATA",58.88,1,1,180,0)
DC(#4)=V(4)                 ::
"DATA",58.88,1,1,181,0)
G.UP2                       ::
"DATA",58.88,1,1,182,0)
.DONEUP                     ::   D  O  N  E  U  P
"DATA",58.88,1,1,183,0)
B11                         ::
"DATA",58.88,1,1,184,0)
P"Adjustments"              ::
"DATA",58.88,1,1,185,0)
P"completed"                ::
"DATA",58.88,1,1,186,0)
W3                          ::
"DATA",58.88,1,1,187,0)
Q                           ::
"DATA",58.88,1,1,188,0)
.NOTOK                      ::  N O T O K
"DATA",58.88,1,1,189,0)
S.CLR                       ::
"DATA",58.88,1,1,190,0)
P"Enter correct count"      ::
"DATA",58.88,1,1,191,0)
P"=>"                       ::
"DATA",58.88,1,1,192,0)
D$0=""                      ::
"DATA",58.88,1,1,193,0)
N;6000                      ::
"DATA",58.88,1,1,194,0)
G$0="".SHOW                 ::
"DATA",58.88,1,1,195,0)
C#5=$0                      ::
"DATA",58.88,1,1,196,0)
DV(8)=$0                    ::
"DATA",58.88,1,1,197,0)
D$0=""                      ::
"DATA",58.88,1,1,198,0)
S.SUM1                      ::
"DATA",58.88,1,1,199,0)
G.SHOW                      ::
"DATA",58.88,1,1,200,0)
.XMIT                       ::  X  M  I  T
"DATA",58.88,1,1,201,0)
P"Execute the data"         ::
"DATA",58.88,1,1,202,0)
P"upload option in"         ::
"DATA",58.88,1,1,203,0)
P"DHCP"                     ::
"DATA",58.88,1,1,204,0)
W3                          ::
"DATA",58.88,1,1,205,0)
P"Press F1 to send"         ::
"DATA",58.88,1,1,206,0)
D$0=""                      ::
"DATA",58.88,1,1,207,0)
A;6000                      ::
"DATA",58.88,1,1,208,0)
G#0=1.1                     ::
"DATA",58.88,1,1,209,0)
G$0="F1".SEND               ::
"DATA",58.88,1,1,210,0)
B11                         ::
"DATA",58.88,1,1,211,0)
P"NO DATA SENT"             ::
"DATA",58.88,1,1,212,0)
G.1                         ::
"DATA",58.88,1,1,213,0)
.SEND                       ::  S  E  N  D
"DATA",58.88,1,1,214,0)
D$0=""                      ::
"DATA",58.88,1,1,215,0)
XMP,F                       ::
"DATA",58.88,1,1,216,0)
XMP,E                       ::
"DATA",58.88,1,1,217,0)
XMP,D                       ::
"DATA",58.88,1,1,218,0)
B111                        ::
"DATA",58.88,1,1,219,0)
P"Data sent"                ::
"DATA",58.88,1,1,220,0)
W1                          ::
"DATA",58.88,1,1,221,0)
G.1                         ::
"DATA",58.88,1,1,222,0)
.ERR2                       ::   E  R  R  2
"DATA",58.88,1,1,223,0)
S.CLR                       ::
"DATA",58.88,1,1,224,0)
P"No data exists in"        ::
"DATA",58.88,1,1,225,0)
P"the files where the"      ::
"DATA",58.88,1,1,226,0)
P"downloaded data"          ::
"DATA",58.88,1,1,227,0)
P"should be."               ::
"DATA",58.88,1,1,228,0)
W4                          ::
"DATA",58.88,1,1,229,0)
S.CLR                       ::
"DATA",58.88,1,1,230,0)
P"Execute the down-"        ::
"DATA",58.88,1,1,231,0)
P"load procedure"           ::
"DATA",58.88,1,1,232,0)
P"once again."              ::
"DATA",58.88,1,1,233,0)
W3                          ::
"DATA",58.88,1,1,234,0)
G.1                         ::
"DATA",58.88,1,1,235,0)
.CLR                        ::  C  L  R
"DATA",58.88,1,1,236,0)
P"\e[2J"                    ::
"DATA",58.88,1,1,237,0)
Q                           ::
"DATA",58.88,1,1,238,0)
.EMPTY                      ::  E  M  P  T  Y
"DATA",58.88,1,1,239,0)
B11                         ::
"DATA",58.88,1,1,240,0)
S.CLR                       ::
"DATA",58.88,1,1,241,0)
PV(3)                       ::
"DATA",58.88,1,1,242,0)
P"is showing a zero"        ::
"DATA",58.88,1,1,243,0)
P"count. No more can"       ::
"DATA",58.88,1,1,244,0)
P"be dispensed."            ::
"DATA",58.88,1,1,245,0)
W4                          ::
"DATA",58.88,1,1,246,0)
G.BGN4                      ::
"DATA",58.88,1,1,247,0)
.NOTFND                     ::  N  O  T  F  N  D  1
"DATA",58.88,1,1,248,0)
B111                        ::
"DATA",58.88,1,1,249,0)
S.CLR                       ::
"DATA",58.88,1,1,250,0)
P"Drug not found in"        ::
"DATA",58.88,1,1,251,0)
P"the data that was"        ::
"DATA",58.88,1,1,252,0)
P"downloaded."              ::
"DATA",58.88,1,1,253,0)
W5                          ::
"DATA",58.88,1,1,254,0)
G.BGN4                      ::
"DATA",58.88,1,1,255,0)
.QUIT                       ::  Q  U  I  T
"DATA",58.88,1,1,256,0)
ER                          ::
"DATA",58.88,1,1,257,0)
.UP4                        ::
"DATA",58.88,1,1,258,0)
D$0=""                      ::
"DATA",58.88,1,1,259,0)
D$0=$0+N(1)                 ::1st nurse id
"DATA",58.88,1,1,260,0)
I"^"                        ::
"DATA",58.88,1,1,261,0)
D$0=$0+V(2)                 ::transaction number
"DATA",58.88,1,1,262,0)
I"^"                        ::
"DATA",58.88,1,1,263,0)
D$0=$0+V(3)                 ::drug name
"DATA",58.88,1,1,264,0)
I"^"                        ::
"DATA",58.88,1,1,265,0)
D$0=$0+C(#2)                ::original count
"DATA",58.88,1,1,266,0)
I"^"                        ::
"DATA",58.88,1,1,267,0)
D$0=$0+V(5)                 ::patient id
"DATA",58.88,1,1,268,0)
I"^"                        ::
"DATA",58.88,1,1,269,0)
D$0=$0+V(6)                 ::dispensed amount
"DATA",58.88,1,1,270,0)
I"^"                        ::
"DATA",58.88,1,1,271,0)
D$0=$0+V(7)                 ::2nd nurse
"DATA",58.88,1,1,272,0)
I"^"                        ::
"DATA",58.88,1,1,273,0)
D$0=$0+V(8)                 ::Correct Count
"DATA",58.88,1,1,274,0)
I"^"                        ::
"DATA",58.88,1,1,275,0)
D$0=$0+V(9)                 ::Wasted Amount
"DATA",58.88,1,1,276,0)
I"^"                        ::
"DATA",58.88,1,1,277,0)
D$0=$0+V(10)                ::Liquid dispensed
"DATA",58.88,1,1,278,0)
I"^"                        ::
"DATA",58.88,1,1,279,0)
D$0=$0+V(11)                ::Wasted comments
"DATA",58.88,1,1,280,0)
I"^"                        ::
"DATA",58.88,1,1,281,0)
D$0=$0+V(12)                ::Liquid Dispensed Comments
"DATA",58.88,1,1,282,0)
TA                          ::Append time to data
"DATA",58.88,1,1,283,0)
R$0D                        ::Record string $0 into file D
"DATA",58.88,1,1,284,0)
G.BGN4                      ::
"FIA",50)
DRUG
"FIA",50,0)
^PSDRUG(
"FIA",50,0,0)
50I
"FIA",50,0,1)
y^y^p^^^^n
"FIA",50,0,10)

"FIA",50,0,11)

"FIA",50,0,"RLRO")

"FIA",50,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",50,50)
1
"FIA",50,50,63)

"FIA",50,50,441)

"FIA",50,50.0441)
1
"FIA",50,50.0441,.01)

"FIA",58.2)
AOU INVENTORY GROUP
"FIA",58.2,0)
^PSI(58.2,
"FIA",58.2,0,0)
58.2
"FIA",58.2,0,1)
y^y^p^^^^n
"FIA",58.2,0,10)

"FIA",58.2,0,11)

"FIA",58.2,0,"RLRO")

"FIA",58.2,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.2,58.2)
1
"FIA",58.2,58.2,2)

"FIA",58.2,58.2,3)

"FIA",58.2,58.23)
0
"FIA",58.2,58.29)
1
"FIA",58.2,58.29,.01)

"FIA",58.2,58.29,2)

"FIA",58.8)
DRUG ACCOUNTABILITY STATS
"FIA",58.8,0)
^PSD(58.8,
"FIA",58.8,0,0)
58.8I
"FIA",58.8,0,1)
y^y^f^^^^n
"FIA",58.8,0,10)

"FIA",58.8,0,11)

"FIA",58.8,0,"RLRO")

"FIA",58.8,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.8,58.8)
0
"FIA",58.8,58.8001)
0
"FIA",58.8,58.800115)
0
"FIA",58.8,58.800116)
0
"FIA",58.8,58.800118)
0
"FIA",58.8,58.80011813)
0
"FIA",58.8,58.800119)
0
"FIA",58.8,58.801)
0
"FIA",58.8,58.828)
0
"FIA",58.8,58.831)
0
"FIA",58.8,58.842)
0
"FIA",58.8,58.8445)
0
"FIA",58.81)
DRUG ACCOUNTABILITY TRANSACTION
"FIA",58.81,0)
^PSD(58.81,
"FIA",58.81,0,0)
58.81I
"FIA",58.81,0,1)
y^y^f^^^^n
"FIA",58.81,0,10)

"FIA",58.81,0,11)

"FIA",58.81,0,"RLRO")

"FIA",58.81,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.81,58.81)
0
"FIA",58.81,58.8126)
0
"FIA",58.82)
CS ORDER STATUS
"FIA",58.82,0)
^PSD(58.82,
"FIA",58.82,0,0)
58.82
"FIA",58.82,0,1)
y^y^f^^n^^y^m^n
"FIA",58.82,0,10)

"FIA",58.82,0,11)

"FIA",58.82,0,"RLRO")

"FIA",58.82,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.82,58.82)
0
"FIA",58.83)
CS COMPLETION STATUS
"FIA",58.83,0)
^PSD(58.83,
"FIA",58.83,0,0)
58.83
"FIA",58.83,0,1)
y^y^f^^n^^y^m^n
"FIA",58.83,0,10)

"FIA",58.83,0,11)

"FIA",58.83,0,"RLRO")

"FIA",58.83,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.83,58.83)
0
"FIA",58.84)
DRUG ACCOUNTABILITY TRANSACTION TYPE
"FIA",58.84,0)
^PSD(58.84,
"FIA",58.84,0,0)
58.84
"FIA",58.84,0,1)
y^y^f^^n^^y^o^n
"FIA",58.84,0,10)

"FIA",58.84,0,11)

"FIA",58.84,0,"RLRO")

"FIA",58.84,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.84,58.84)
0
"FIA",58.85)
CS WORKSHEET
"FIA",58.85,0)
^PSD(58.85,
"FIA",58.85,0,0)
58.85I
"FIA",58.85,0,1)
y^y^f^^^^n
"FIA",58.85,0,10)

"FIA",58.85,0,11)

"FIA",58.85,0,"RLRO")

"FIA",58.85,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.85,58.85)
0
"FIA",58.85,58.858)
0
"FIA",58.86)
CS DESTRUCTION
"FIA",58.86,0)
^PSD(58.86,
"FIA",58.86,0,0)
58.86I
"FIA",58.86,0,1)
y^y^f^^^^n
"FIA",58.86,0,10)

"FIA",58.86,0,11)

"FIA",58.86,0,"RLRO")

"FIA",58.86,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.86,58.86)
0
"FIA",58.87)
CS CORRECTION LOG
"FIA",58.87,0)
^PSD(58.87,
"FIA",58.87,0,0)
58.87
"FIA",58.87,0,1)
y^y^f^^^^n
"FIA",58.87,0,10)

"FIA",58.87,0,11)

"FIA",58.87,0,"RLRO")

"FIA",58.87,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.87,58.87)
0
"FIA",58.88)
CS IRL PROGRAM
"FIA",58.88,0)
^PSD(58.88,
"FIA",58.88,0,0)
58.88
"FIA",58.88,0,1)
y^y^f^^n^^y^o^n
"FIA",58.88,0,10)

"FIA",58.88,0,11)

"FIA",58.88,0,"RLRO")

"FIA",58.88,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.88,58.88)
0
"FIA",58.88,58.881)
0
"FIA",58.89)
CS ERROR LOG
"FIA",58.89,0)
^PSD(58.89,
"FIA",58.89,0,0)
58.89I
"FIA",58.89,0,1)
y^y^f^^^^n
"FIA",58.89,0,10)

"FIA",58.89,0,11)

"FIA",58.89,0,"RLRO")

"FIA",58.89,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",58.89,58.89)
0
"FIA",58.89,58.895)
0
"FIA",59.4)
INPATIENT SITE
"FIA",59.4,0)
^PS(59.4,
"FIA",59.4,0,0)
59.4
"FIA",59.4,0,1)
y^y^p^^^^n
"FIA",59.4,0,10)

"FIA",59.4,0,11)

"FIA",59.4,0,"RLRO")

"FIA",59.4,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",59.4,59.4)
1
"FIA",59.4,59.4,31)

"FIA",59.7)
PHARMACY SYSTEM
"FIA",59.7,0)
^PS(59.7,
"FIA",59.7,0,0)
59.7
"FIA",59.7,0,1)
y^y^p^^^^n
"FIA",59.7,0,10)

"FIA",59.7,0,11)

"FIA",59.7,0,"RLRO")

"FIA",59.7,0,"VR")
3.0^CONTROLLED SUBSTANCES
"FIA",59.7,59.7)
1
"FIA",59.7,59.7,71)

"INIT")
PSDIPOST
"KRN",.402,685,-1)
0^1
"KRN",.402,685,0)
PSD INV GROUP^2940615.0935^^58.2^^^2950525
"KRN",.402,685,"DIAB",1,0,58.2,0)
.01;"NAOU INVENTORY GROUP NAME"
"KRN",.402,685,"DIAB",1,2,58.291,0)
ALL
"KRN",.402,685,"DR",1,58.2)
.01NAOU INVENTORY GROUP NAME~;2;S (PSDSK,PSDSKP)=0;@1;S PSDSK=$O(^PSI(58.2,DA,3,"D",PSDSK));I 'PSDSK S PSDS=$S(PSDSKP>0:(PSDSKP+100),1:100),Y="@2";S PSDSKP=PSDSK;S Y="@1";@2;3;K PSDS,PSDSK,PSDSKP;K X,Y,%X,%Y,W;
"KRN",.402,685,"DR",2,58.29)
.01;1;I $P(^PSI(58.2,D0,3,D1,0),"^",2)'="" S Y="@3";2///^S X=PSDS;S PSDS=PSDS+100;@3;
"KRN",.402,685,"DR",3,58.291)
.01
"KRN",9.2,513,-1)
0^15
"KRN",9.2,513,0)
PSD ORDER ENTRY REG^^2950515.1513^^
"KRN",9.2,514,-1)
0^12
"KRN",9.2,514,0)
PSD ORDER ENTRY BATCH^^2950515.1512^^
"KRN",9.2,515,-1)
0^10
"KRN",9.2,515,0)
PSD ORDER ENTRY^Scheduled/Unscheduled^2950525.073^^
"KRN",9.2,515,1,0)
^^19^19^2950525^^^^
"KRN",9.2,515,1,1,0)
 
"KRN",9.2,515,1,2,0)
Scheduled Delivery
"KRN",9.2,515,1,3,0)
     Orders for drugs which are input during the scheduled delivery time. 
"KRN",9.2,515,1,4,0)
 
"KRN",9.2,515,1,5,0)
Unscheduled Pick Up
"KRN",9.2,515,1,6,0)
     Orders that are being requested at an unscheduled time.
"KRN",9.2,515,1,7,0)
 
"KRN",9.2,515,1,8,0)
 
"KRN",9.2,515,1,9,0)
One-Time Request
"KRN",9.2,515,1,10,0)
     Orders for drugs that are not normally stocked on an NAOU.
"KRN",9.2,515,1,11,0)
     Your orders will be limited to the package amount specified for
"KRN",9.2,515,1,12,0)
     that drug. These can be entered through the Scheduled or
"KRN",9.2,515,1,13,0)
     Unscheduled route.
"KRN",9.2,515,1,14,0)
 
"KRN",9.2,515,1,15,0)
 
"KRN",9.2,515,1,16,0)
 
"KRN",9.2,515,1,17,0)
 
"KRN",9.2,515,1,18,0)
 
"KRN",9.2,515,1,19,0)
 
"KRN",9.2,515,2,0)
^9.22^^0
"KRN",9.2,534,-1)
0^2
"KRN",9.2,534,0)
PSD ESIG^Electronic Signature Code^2950608.0713^^
"KRN",9.2,534,1,0)
^^9^9^2950608^^^^
"KRN",9.2,534,1,1,0)
 
"KRN",9.2,534,1,2,0)
A new feature in CS V. 3.0 is you MUST have an Electronic Signature code.
"KRN",9.2,534,1,3,0)
 
"KRN",9.2,534,1,4,0)
At any menu option enter "EDIT E and follow the prompts or type  
"KRN",9.2,534,1,5,0)
in TBOX and chose Edit Electronic Signature Code.   
"KRN",9.2,534,1,6,0)
 
"KRN",9.2,534,1,7,0)
Hint:  Use your access code as your Electronic Signature Code, this      
"KRN",9.2,534,1,8,0)
       will make it easier to remember. 
"KRN",9.2,534,1,9,0)
 
"KRN",9.2,535,-1)
0^4
"KRN",9.2,535,0)
PSD HL7^Interface to Narcotic Dispensing Equipment Systems^2961220.0906^^
"KRN",9.2,535,1,0)
^^19^19^2961220^^^^
"KRN",9.2,535,1,1,0)
 
"KRN",9.2,535,1,2,0)
     Version 3.0 of the Controlled Substances package uses the HL7 package
"KRN",9.2,535,1,3,0)
to provide a generic interface to Narcotic Dispensing Equipment Systems
"KRN",9.2,535,1,4,0)
(NDES).  HL7 or Health Level Seven is a standard protocol which specifies
"KRN",9.2,535,1,5,0)
the implementation of interfaces between two computer applications (sender
"KRN",9.2,535,1,6,0)
and receiver) from different vendors for electronic data exchange in
"KRN",9.2,535,1,7,0)
health care environments.  If your Pharmacy Service is using an NDES such
"KRN",9.2,535,1,8,0)
as Access, Meditrol, Pyxis, or Suremed you may wish to set up the
"KRN",9.2,535,1,9,0)
interface.  This will be accomplished by adding entries to the HL7
"KRN",9.2,535,1,10,0)
APPLICATION PARAMETER (#771), HL LOWER LEVEL PROTOCOL PARAMETER (#869.2),
"KRN",9.2,535,1,11,0)
and HL LOGICAL LINK (#870) files.  You will be asked to identify an HL7
"KRN",9.2,535,1,12,0)
device which must exist as entry in your DEVICE file (#3.5).
"KRN",9.2,535,1,13,0)
 
"KRN",9.2,535,1,14,0)
     The PSDHLK routine is invoked by the Controlled Substances post-init.
"KRN",9.2,535,1,15,0)
The routine, PSDHL7 is also independantly invokable at any time that a site
"KRN",9.2,535,1,16,0)
needs to set up their interface for Narcotic Dispensing Equipment Systems.
"KRN",9.2,535,1,17,0)
 
"KRN",9.2,535,1,18,0)
     If you do NOT want to perform this step at the time of the post-init,
"KRN",9.2,535,1,19,0)
you can simply D ^PSDHL7 when you're ready.
"KRN",9.2,536,-1)
0^5
"KRN",9.2,536,0)
PSD HL7 ADT^PSD PAT ADT PROTOCOL^2960329.0856^
"KRN",9.2,536,1,0)
^^10^10^2960329^^^
"KRN",9.2,536,1,1,0)
     The PSDHL7 routine is invoked by the Controlled Substances post-init.
"KRN",9.2,536,1,2,0)
This routine is also independantly invokable at any time that a site needs
"KRN",9.2,536,1,3,0)
to set up their interface for narcotic dispensing equipment systems.  One
"KRN",9.2,536,1,4,0)
of the steps this routine performs is to add the PSD PAT ADT Protocol to
"KRN",9.2,536,1,5,0)
the DGPM MOVEMENT EVENTS driver.  When this is done, any admits, transfers,
"KRN",9.2,536,1,6,0)
or discharges will invoke the PSDADT1 routine to build and transmit an ADT
"KRN",9.2,536,1,7,0)
message using the HL7 package.
"KRN",9.2,536,1,8,0)
 
"KRN",9.2,536,1,9,0)
     If you do NOT want to perform this step at the time of the post-init,
"KRN",9.2,536,1,10,0)
you can simply D ^PSDHL7 when you're ready.
"KRN",9.2,537,-1)
0^14
"KRN",9.2,537,0)
PSD ORDER ENTRY PRIORITY^Priority Orders^2950515.1552^
"KRN",9.2,537,1,0)
^^2^2^2950515^
"KRN",9.2,537,1,1,0)
 
"KRN",9.2,537,1,2,0)
Orders that are being requested at an unscheduled time.
"KRN",9.2,538,-1)
0^13
"KRN",9.2,538,0)
PSD ORDER ENTRY ONE TIME^One-Time Requests^2950518.0753^
"KRN",9.2,538,1,0)
^^2^2^2950518^^^^
"KRN",9.2,538,1,1,0)
 
"KRN",9.2,538,1,2,0)
Orders for drugs that are not normally stocked on an NAOU.
"KRN",9.2,539,-1)
0^8
"KRN",9.2,539,0)
PSD NURSE RECEIVE^RECEIVING^2950524.1435^
"KRN",9.2,539,1,0)
^^5^5^2950524^^^^
"KRN",9.2,539,1,1,0)
 
"KRN",9.2,539,1,2,0)
After physically receiving the GS (VA FORM 10-2638), it is important to
"KRN",9.2,539,1,3,0)
update the status on your computer so that your account is correct.
"KRN",9.2,539,1,4,0)
 
"KRN",9.2,539,1,5,0)
 
"KRN",9.2,540,-1)
0^9
"KRN",9.2,540,0)
PSD NURSE TRANSFER^TRANSFERRING^2950524.1443^
"KRN",9.2,540,1,0)
^^13^13^2950524^^^^
"KRN",9.2,540,1,1,0)
 
"KRN",9.2,540,1,2,0)
Transferring drugs between NAOUs requires the completion of a 2 step 
"KRN",9.2,540,1,3,0)
process!
"KRN",9.2,540,1,4,0)
 
"KRN",9.2,540,1,5,0)
 (1) Transferring the Green Sheet to another NAOU
"KRN",9.2,540,1,6,0)
     -Transfer Green Sheet and Drug to another NAOU option
"KRN",9.2,540,1,7,0)
 
"KRN",9.2,540,1,8,0)
 (2) The Green Sheet being received onto the other NAOU 
"KRN",9.2,540,1,9,0)
     -Receive Green Sheet & Drug from another NAOU
"KRN",9.2,540,1,10,0)
 
"KRN",9.2,540,1,11,0)
Reprint any Green Sheet transferred from your NAOU in place of using
"KRN",9.2,540,1,12,0)
the VA FORM 2321.
"KRN",9.2,540,1,13,0)
     -Reprint Transfer Between NAOUs VA FORM 2321 option
"KRN",9.2,541,-1)
0^6
"KRN",9.2,541,0)
PSD NURSE^ONLINE HELP FOR NURSES^2960318.1609^^
"KRN",9.2,541,1,0)
^^19^19^2960318^^^^
"KRN",9.2,541,1,1,0)
 
"KRN",9.2,541,1,2,0)
     All about [Dispensing]
"KRN",9.2,541,1,3,0)
        Dispensing
"KRN",9.2,541,1,4,0)
        Report of Dispensing Activity
"KRN",9.2,541,1,5,0)
        Patient ID List Print
"KRN",9.2,541,1,6,0)
 
"KRN",9.2,541,1,7,0)
     All about [Ordering]
"KRN",9.2,541,1,8,0)
        Scheduled/Unscheduled
"KRN",9.2,541,1,9,0)
        One Time Request
"KRN",9.2,541,1,10,0)
        [Order Entry Banner]
"KRN",9.2,541,1,11,0)
        [Filled Not Delivered]
"KRN",9.2,541,1,12,0)
 
"KRN",9.2,541,1,13,0)
     All about Green Sheets
"KRN",9.2,541,1,14,0)
        [Receiving]
"KRN",9.2,541,1,15,0)
        [Completing]
"KRN",9.2,541,1,16,0)
        [GS History]
"KRN",9.2,541,1,17,0)
        [Transfer]
"KRN",9.2,541,1,18,0)
 
"KRN",9.2,541,1,19,0)
     [Electronic Signature Code]
"KRN",9.2,541,2,0)
^9.22^13^9
"KRN",9.2,541,2,1,0)
ORDERING^PSD ORDER ENTRY
"KRN",9.2,541,2,2,0)
RECEIVING^PSD NURSE RECEIVE
"KRN",9.2,541,2,7,0)
COMPLETING^psd
"KRN",9.2,541,2,8,0)
GS HISTORY^PSD Green Sheets
"KRN",9.2,541,2,9,0)
TRANSFER^PSD NURSE TRANSFER
"KRN",9.2,541,2,10,0)
ELECTRONIC SIGNATURE CODE^PSD ESIG
"KRN",9.2,541,2,11,0)
ORDER ENTRY BANNER^PSD ORDER ENTRY BANNER
"KRN",9.2,541,2,12,0)
FILLED NOT DELIVERED^PSD NURSE FILLED NOT DEL
"KRN",9.2,541,2,13,0)
DISPENSING^PSD NURSE DISPENSING
"KRN",9.2,542,-1)
0^11
"KRN",9.2,542,0)
PSD ORDER ENTRY BANNER^Order Entry Banner^2950516.0714^^
"KRN",9.2,542,1,0)
^^2^2^2950516^^^^
"KRN",9.2,542,1,1,0)
 
"KRN",9.2,542,1,2,0)
Used for messages/reminders such as the scheduled pharmacy fill times.
"KRN",9.2,542,2,0)
^9.22A^^0
"KRN",9.2,543,-1)
0^3
"KRN",9.2,543,0)
PSD Green Sheets^Green Sheet History^2950515.151^
"KRN",9.2,543,1,0)
^^3^3^2950515^^
"KRN",9.2,543,1,1,0)
 
"KRN",9.2,543,1,2,0)
Provides a detailed account of every transaction affecting a
"KRN",9.2,543,1,3,0)
VA Form 10-2638.
"KRN",9.2,545,-1)
0^1
"KRN",9.2,545,0)
PSD BALANCE ADJUSTMENT REPORT^Balance Adjustment Report^2950525.1212^
"KRN",9.2,545,1,0)
^^10^10^2950525^^^
"KRN",9.2,545,1,1,0)
 
"KRN",9.2,545,1,2,0)
Allows for the selection of drug(s) and a date range for which
"KRN",9.2,545,1,3,0)
you wish to review the balance adjustments.
"KRN",9.2,545,1,4,0)
 
"KRN",9.2,545,1,5,0)
The Browser:
"KRN",9.2,545,1,6,0)
    
"KRN",9.2,545,1,7,0)
  To view all of the Browser's funcitons press the <F1>H key
"KRN",9.2,545,1,8,0)
  sequence at any time in the browser. This will give you the
"KRN",9.2,545,1,9,0)
  help you need in utilizing the browser to cut, paste, copy,
"KRN",9.2,545,1,10,0)
  jump, split screen, etc. 
"KRN",9.2,550,-1)
0^7
"KRN",9.2,550,0)
PSD NURSE FILLED NOT DEL^Orders Filled but Not Delivered^2950608.071^
"KRN",9.2,550,1,0)
^^3^3^2950608^^
"KRN",9.2,550,1,1,0)
This will list all of the Controlled Substances orders that have been
"KRN",9.2,550,1,2,0)
filled but not yet delivered. A summary total sorted by drug is also
"KRN",9.2,550,1,3,0)
printed.
"KRN",9.2,590,-1)
0^16
"KRN",9.2,590,0)
PSD NURSE DISPENSING^Dispensing to Patients^2960216.130344^
"KRN",19,3815,-1)
0^121
"KRN",19,3815,0)
PSD SETUP^Set Up CS (Build Files) Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3815,1,0)
^^2^2^2931215^^^^
"KRN",19,3815,1,1,0)
Options that support management of files typically created and edited
"KRN",19,3815,1,2,0)
during initial set up of the Controlled Substances module.
"KRN",19,3815,10,0)
^19.01PI^19^19
"KRN",19,3815,10,4,0)
3819^^16
"KRN",19,3815,10,4,"^")
PSD PRINT SETUP LISTS
"KRN",19,3815,10,5,0)
3822^^1
"KRN",19,3815,10,5,"^")
PSD SITE
"KRN",19,3815,10,8,0)
3932^^11
"KRN",19,3815,10,8,"^")
PSD INACTIVATE NAOU
"KRN",19,3815,10,10,0)
4069^^12
"KRN",19,3815,10,10,"^")
PSD INACTIVATE NAOU STOCK DRUG
"KRN",19,3815,10,11,0)
4070^^9
"KRN",19,3815,10,11,"^")
PSD WARD CONVERSION
"KRN",19,3815,10,12,0)
4074^^10
"KRN",19,3815,10,12,"^")
PSD WARD ADD/DEL
"KRN",19,3815,10,14,0)
4089^^15
"KRN",19,3815,10,14,"^")
PSD NAOU INV GROUP SORT
"KRN",19,3815,10,16,0)
4093^^13
"KRN",19,3815,10,16,"^")
PSD TRANSFER MENU
"KRN",19,3815,10,17,0)
4177^^17
"KRN",19,3815,10,17,"^")
PSD DRUG CHECK
"KRN",19,3815,10,18,0)
4231^^18
"KRN",19,3815,10,18,"^")
PSD BALANCE INITIALIZE
"KRN",19,3815,10,19,0)
4865^^6
"KRN",19,3815,10,19,"^")
PSD ENTER/EDIT MENU
"KRN",19,3815,99)
56749,40572
"KRN",19,3815,"U")
SET UP CS (BUILD FILES) MENU
"KRN",19,3816,-1)
0^27
"KRN",19,3816,0)
PSD DRUG LOC EDIT^Enter/Edit CS Drug Location Codes^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3816,1,0)
^^2^2^2930224^^
"KRN",19,3816,1,1,0)
This option allows editing of the codes used to define the locations of
"KRN",19,3816,1,2,0)
stocked drugs in Narcotic Areas of Use or in the pharmacy.
"KRN",19,3816,25)
PSDCODE
"KRN",19,3816,"U")
ENTER/EDIT CS DRUG LOCATION CO
"KRN",19,3817,-1)
0^71
"KRN",19,3817,0)
PSD NAOU EDIT^Create/Edit the Narcotic Area of Use^^R^^PSD PARAM^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3817,1,0)
^^1^1^2930224^^
"KRN",19,3817,1,1,0)
This option allows the user to initially define the Narcotic Areas of Use.
"KRN",19,3817,25)
PSDEN
"KRN",19,3817,99)
55232,47281
"KRN",19,3817,"U")
CREATE/EDIT THE NARCOTIC AREA 
"KRN",19,3818,-1)
0^123
"KRN",19,3818,0)
PSD STOCK DRUG EDIT^Stock CS Drugs - Enter/Edit^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3818,1,0)
^^3^3^2940914^^^^
"KRN",19,3818,1,1,0)
Provides access to enter or edit drugs stocked in the Narcotic Area of Use.
"KRN",19,3818,1,2,0)
This is how stocked drugs within an NAOU are added or changed.
"KRN",19,3818,1,3,0)
Duplicate entries are not allowed.
"KRN",19,3818,25)
PSDSTK
"KRN",19,3818,"U")
STOCK CS DRUGS - ENTER/EDIT
"KRN",19,3819,-1)
0^102
"KRN",19,3819,0)
PSD PRINT SETUP LISTS^Print CS Set Up Lists^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3819,1,0)
^^2^2^2920912^^
"KRN",19,3819,1,1,0)
This option contains all reports or lists associated with setting up the
"KRN",19,3819,1,2,0)
files for the Controlled Substances module.
"KRN",19,3819,10,0)
^19.01PI^10^10
"KRN",19,3819,10,1,0)
3820^^4
"KRN",19,3819,10,1,"^")
PSD DRUG LOC PRINT
"KRN",19,3819,10,2,0)
3930^^3
"KRN",19,3819,10,2,"^")
PSD INVEN TYPE PRINT
"KRN",19,3819,10,3,0)
4073^^5
"KRN",19,3819,10,3,"^")
PSD NAOU PRINT
"KRN",19,3819,10,4,0)
4081^^1
"KRN",19,3819,10,4,"^")
PSD DRUG FILE DATA
"KRN",19,3819,10,5,0)
4080^^2
"KRN",19,3819,10,5,"^")
PSD DEA LIST
"KRN",19,3819,10,6,0)
4082^^6
"KRN",19,3819,10,6,"^")
PSD STOCK PRINT
"KRN",19,3819,10,7,0)
4083^^7
"KRN",19,3819,10,7,"^")
PSD STOCK LIST
"KRN",19,3819,10,8,0)
4090^^9
"KRN",19,3819,10,8,"^")
PSD NAOU INV GROUP PRINT
"KRN",19,3819,10,9,0)
4176^^10
"KRN",19,3819,10,9,"^")
PSD MFG REPORT PRINT
"KRN",19,3819,10,10,0)
4866^^8
"KRN",19,3819,10,10,"^")
PSD STOCK UNIT LIST
"KRN",19,3819,99)
56749,40572
"KRN",19,3819,"U")
PRINT CS SET UP LISTS
"KRN",19,3820,-1)
0^28
"KRN",19,3820,0)
PSD DRUG LOC PRINT^List CS Drug Location Codes^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3820,1,0)
^^2^2^2930224^^
"KRN",19,3820,1,1,0)
This report will list the codes used to define the location of drugs stocked
"KRN",19,3820,1,2,0)
in Narcotic Areas of Use or in the pharmacy.
"KRN",19,3820,25)
CODE^PSDPRT
"KRN",19,3820,"U")
LIST CS DRUG LOCATION CODES
"KRN",19,3822,-1)
0^122
"KRN",19,3822,0)
PSD SITE^Site Parameters^^R^^PSD PARAM^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3822,1,0)
^^3^3^2920912^^^^
"KRN",19,3822,1,1,0)
Site parameters for the Controlled Substances module.  This includes
"KRN",19,3822,1,2,0)
selecting an inpatient site for Controlled Substances use and answering
"KRN",19,3822,1,3,0)
package specific questions concerning this site.  
"KRN",19,3822,25)
PSDSITE
"KRN",19,3822,"U")
SITE PARAMETERS
"KRN",19,3823,-1)
0^68
"KRN",19,3823,0)
PSD MFG/LOT/EXP DATE EDIT^Manufacturer, Lot #, and Exp. Date - Enter/Edit^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3823,1,0)
^^2^2^2930727^^^^
"KRN",19,3823,1,1,0)
This option allows the user to enter or edit manufacturer, lot #, and
"KRN",19,3823,1,2,0)
expiration dates for stocked drugs in an NAOU.
"KRN",19,3823,25)
PSDMFG
"KRN",19,3823,"U")
MANUFACTURER, LOT #, AND EXP. 
"KRN",19,3832,-1)
0^53
"KRN",19,3832,0)
PSD INVEN TYPE EDIT^Inventory Types - Enter/Edit^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3832,1,0)
^^2^2^2940908^^^^
"KRN",19,3832,1,1,0)
This option will edit the entries in the AOU INVENTORY TYPE file (#58.16)
"KRN",19,3832,1,2,0)
used to classify Narcotic Area of Use drugs.
"KRN",19,3832,25)
PSDNVT
"KRN",19,3832,"U")
INVENTORY TYPES - ENTER/EDIT
"KRN",19,3930,-1)
0^54
"KRN",19,3930,0)
PSD INVEN TYPE PRINT^Print Inventory Types^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3930,1,0)
^^2^2^2940908^^^
"KRN",19,3930,1,1,0)
Use this option to print the entries in the AOU INVENTORY TYPE file (#58.16)
"KRN",19,3930,1,2,0)
used to classify Narcotic Area of Use stocked drugs.
"KRN",19,3930,25)
INVEN^PSDPRT
"KRN",19,3930,"U")
PRINT INVENTORY TYPES
"KRN",19,3932,-1)
0^44
"KRN",19,3932,0)
PSD INACTIVATE NAOU^Inactivate NAOU^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,3932,1,0)
^^2^2^2940908^^^^
"KRN",19,3932,1,1,0)
This option will allow a user to inactivate an NAOU.  An inactivation date 
"KRN",19,3932,1,2,0)
may be entered for a future time.
"KRN",19,3932,25)
PSDNACT
"KRN",19,3932,"U")
INACTIVATE NAOU
"KRN",19,4014,-1)
0^66
"KRN",19,4014,0)
PSD MENU^Controlled Substances Menu^^M^^^^^^^^CONTROLLED SUBSTANCES^^1^1
"KRN",19,4014,1,0)
^^2^2^2940223^^^^
"KRN",19,4014,1,1,0)
This menu contains access to all options associated with the Controlled
"KRN",19,4014,1,2,0)
Substances module of the Pharmacy software.
"KRN",19,4014,10,0)
^19.01PI^8^8
"KRN",19,4014,10,1,0)
4175^^1
"KRN",19,4014,10,1,"^")
PSD MGR
"KRN",19,4014,10,2,0)
4179^^3
"KRN",19,4014,10,2,"^")
PSD TRANSACTION MENU
"KRN",19,4014,10,6,0)
4183^^7
"KRN",19,4014,10,6,"^")
PSD PRODUCTION REPORTS
"KRN",19,4014,10,7,0)
4187^^2
"KRN",19,4014,10,7,"^")
PSD PHARM TECH
"KRN",19,4014,10,8,0)
5726^^10
"KRN",19,4014,10,8,"^")
PSD LABEL VAULT
"KRN",19,4014,15)
K PSDSITE
"KRN",19,4014,20)
I '$D(PSDSITE) D ^PSDSET
"KRN",19,4014,99)
56749,40572
"KRN",19,4014,99.1)
56313,29479
"KRN",19,4014,"U")
CONTROLLED SUBSTANCES MENU
"KRN",19,4019,-1)
0^65
"KRN",19,4019,0)
PSD MARK^Mark/Unmark Drugs for Controlled Substances Use^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4019,1,0)
^^2^2^2940908^^^^
"KRN",19,4019,1,1,0)
This option provides the ability to mark/unmark entries in the
"KRN",19,4019,1,2,0)
DRUG file (#50) for use with the Controlled Substances package.
"KRN",19,4019,25)
PSDAPU
"KRN",19,4019,"U")
MARK/UNMARK DRUGS FOR CONTROLL
"KRN",19,4069,-1)
0^45
"KRN",19,4069,0)
PSD INACTIVATE NAOU STOCK DRUG^Inactivate NAOU Stock Drug^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4069,1,0)
^^2^2^2940908^^^^
"KRN",19,4069,1,1,0)
This option is used to inactivate a drug that is currently on an NAOUs
"KRN",19,4069,1,2,0)
stock list.  Drugs should not be deleted, but simply inactivated.
"KRN",19,4069,25)
PSDNSTK
"KRN",19,4069,"U")
INACTIVATE NAOU STOCK DRUG
"KRN",19,4070,-1)
0^133
"KRN",19,4070,0)
PSD WARD CONVERSION^Ward (for Drug) Transfer^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4070,1,0)
^^6^6^2940929^^^^
"KRN",19,4070,1,1,0)
This option will enable a user to change a ward (for drug) designation
"KRN",19,4070,1,2,0)
from the old ward to a new ward for all drugs in all NAOUs or in a 
"KRN",19,4070,1,3,0)
single NAOU.  This can be used, for example, when a ward is closed down
"KRN",19,4070,1,4,0)
for construction.  A background job can be queued for a later time
"KRN",19,4070,1,5,0)
to do the conversion and a MailMan message will be sent to the person
"KRN",19,4070,1,6,0)
who queued the job when it has run to completion.
"KRN",19,4070,25)
PSDWCHG
"KRN",19,4070,"U")
WARD (FOR DRUG) TRANSFER
"KRN",19,4073,-1)
0^75
"KRN",19,4073,0)
PSD NAOU PRINT^Show Narcotic Area of Use^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4073,1,0)
^^2^2^2941027^^^^
"KRN",19,4073,1,1,0)
This option allows the user to print the NAOUs/Location Type/Primary
"KRN",19,4073,1,2,0)
Dispensing Site created in the Create/Edit the Narcotic Area of Use option.
"KRN",19,4073,25)
NAOU^PSDPRT
"KRN",19,4073,"U")
SHOW NARCOTIC AREA OF USE
"KRN",19,4074,-1)
0^132
"KRN",19,4074,0)
PSD WARD ADD/DEL^Add/Delete Ward (for Drug)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4074,1,0)
^^2^2^2940929^^^
"KRN",19,4074,1,1,0)
This option will allow a user to add or delete a ward (for drug)
"KRN",19,4074,1,2,0)
assignment for all stock drugs in one or more active NAOUs.
"KRN",19,4074,25)
PSDWADD
"KRN",19,4074,"U")
ADD/DELETE WARD (FOR DRUG)
"KRN",19,4075,-1)
0^72
"KRN",19,4075,0)
PSD NAOU INV GROUP EDIT^NAOU Inventory Group - Enter/Edit^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4075,1,0)
^^5^5^2920915^^
"KRN",19,4075,1,1,0)
This option allows the user to enter and edit inventory groups.  These
"KRN",19,4075,1,2,0)
groups define a cluster of NAOUs.  For each of these NAOUs, one or more
"KRN",19,4075,1,3,0)
inventory types may be defined.  This lets pharmacy detail a list of
"KRN",19,4075,1,4,0)
standard NAOUs and inventory types that can be easily selected when
"KRN",19,4075,1,5,0)
doing inventory.
"KRN",19,4075,25)
PSDGEN
"KRN",19,4075,"U")
NAOU INVENTORY GROUP - ENTER/E
"KRN",19,4080,-1)
0^15
"KRN",19,4080,0)
PSD DEA LIST^DEA Special Handling List^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4080,1,0)
^^4^4^2950821^^^^
"KRN",19,4080,1,1,0)
This report alphabetically lists the drug name, DEA Special Handling,
"KRN",19,4080,1,2,0)
and NDC data for all drugs within the DRUG file (#50) marked for
"KRN",19,4080,1,3,0)
Controlled Substances package use.  This report will be helpful in
"KRN",19,4080,1,4,0)
researching drugs incorrectly marked for CS package use.
"KRN",19,4080,25)
PSDEA
"KRN",19,4080,"U")
DEA SPECIAL HANDLING LIST
"KRN",19,4081,-1)
0^26
"KRN",19,4081,0)
PSD DRUG FILE DATA^Drug File Stats for CS Drugs^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4081,1,0)
^^5^5^2940908^^^^
"KRN",19,4081,1,1,0)
This report lists the drug name, order unit, price per order unit, dispense
"KRN",19,4081,1,2,0)
unit, dispense units per order unit, and price per dispense unit.  These
"KRN",19,4081,1,3,0)
statistics are compiled from the DRUG file (#50) and may be used when
"KRN",19,4081,1,4,0)
loading stock drugs into a Narcotic Area of Use. All drugs marked for
"KRN",19,4081,1,5,0)
CS package use will print on this report.
"KRN",19,4081,25)
PSDCSL
"KRN",19,4081,99)
55601,32123
"KRN",19,4081,"U")
DRUG FILE STATS FOR CS DRUGS
"KRN",19,4082,-1)
0^125
"KRN",19,4082,0)
PSD STOCK PRINT^Stock Drug Print (Stock Level and Location)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4082,1,0)
^^4^4^2940913^^^^
"KRN",19,4082,1,1,0)
This report prints an alphabetic listing of all active drugs you have
"KRN",19,4082,1,2,0)
defined in the DRUG ACCOUNTABILITY STATS file (#58.8).  This report
"KRN",19,4082,1,3,0)
lists NAOU, drug name, location, stock levels, all ward (for drug)
"KRN",19,4082,1,4,0)
assignments, and all inventory types.
"KRN",19,4082,25)
PSDPSTK
"KRN",19,4082,99)
56349,57044
"KRN",19,4082,"U")
STOCK DRUG PRINT (STOCK LEVEL 
"KRN",19,4083,-1)
0^124
"KRN",19,4083,0)
PSD STOCK LIST^Stock Drug List (Inventory Type and Location)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4083,1,0)
^^6^6^2940913^^^^
"KRN",19,4083,1,1,0)
This report lists all active stocked drugs you have defined in the
"KRN",19,4083,1,2,0)
DRUG ACCOUNTABILITY STATS file (#58.8).  This report can be
"KRN",19,4083,1,3,0)
sorted alphabetically or by inventory type/location/drug.  The data
"KRN",19,4083,1,4,0)
includes NAOU, location, drug name, stock level, and reorder level.
"KRN",19,4083,1,5,0)
The report sorted by inventory type/location/drug will include the
"KRN",19,4083,1,6,0)
type as printed data.
"KRN",19,4083,25)
PSDLSTK
"KRN",19,4083,"U")
STOCK DRUG LIST (INVENTORY TYP
"KRN",19,4089,-1)
0^74
"KRN",19,4089,0)
PSD NAOU INV GROUP SORT^Sort NAOUs in Inventory Group^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4089,1,0)
^^3^3^2930224^^
"KRN",19,4089,1,1,0)
This option allows the user to change the order in which the NAOUs
"KRN",19,4089,1,2,0)
will sort within an inventory group.  NAOUs should sort in the order
"KRN",19,4089,1,3,0)
that they will be visited.
"KRN",19,4089,25)
PSDGSK
"KRN",19,4089,"U")
SORT NAOUS IN INVENTORY GROUP
"KRN",19,4090,-1)
0^73
"KRN",19,4090,0)
PSD NAOU INV GROUP PRINT^Inventory Group List (80 column)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4090,1,0)
^^2^2^2920227^
"KRN",19,4090,1,1,0)
This option prints a list of the currently defined NAOU inventory
"KRN",19,4090,1,2,0)
groups with their associated inventory types.
"KRN",19,4090,25)
PSDGPR
"KRN",19,4090,"U")
INVENTORY GROUP LIST (80 COLUM
"KRN",19,4091,-1)
0^77
"KRN",19,4091,0)
PSD NARC EDIT^Narcotic Breakdown Unit/Package Size - Enter/Edit^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4091,1,0)
^^2^2^2930224^^^^
"KRN",19,4091,1,1,0)
This option allows the user to enter or edit narcotic breakdown unit
"KRN",19,4091,1,2,0)
and narcotic package size for stocked drugs in an active NAOU.
"KRN",19,4091,25)
PSDNARC
"KRN",19,4091,"U")
NARCOTIC BREAKDOWN UNIT/PACKAG
"KRN",19,4093,-1)
0^129
"KRN",19,4093,0)
PSD TRANSFER MENU^Transfer Stock Entries^^M^^PSD TRAN^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4093,1,0)
^^5^5^2940919^^^^
"KRN",19,4093,1,1,0)
This menu option supports two distinct methods of transferring active
"KRN",19,4093,1,2,0)
stock.  The first "copies" active stock from a Narcotic Area of Use
"KRN",19,4093,1,3,0)
into another Narcotic Area of Use.  The second "copies" active stock
"KRN",19,4093,1,4,0)
from a AR/WS Area of Use into a Controlled Substances Narcotic Area
"KRN",19,4093,1,5,0)
of Use.
"KRN",19,4093,10,0)
^19.01PI^2^2
"KRN",19,4093,10,1,0)
4094^^1
"KRN",19,4093,10,1,"^")
PSD TRANSFER NAOU
"KRN",19,4093,10,2,0)
4095^^2
"KRN",19,4093,10,2,"^")
PSD TRANSFER AOU
"KRN",19,4093,99)
56749,40572
"KRN",19,4093,"U")
TRANSFER STOCK ENTRIES
"KRN",19,4094,-1)
0^130
"KRN",19,4094,0)
PSD TRANSFER NAOU^NAOU to NAOU Transfer Stock Entries^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4094,1,0)
^^8^8^2940926^^^^
"KRN",19,4094,1,1,0)
This option will "copy" the active stock entries from a selected Narcotic
"KRN",19,4094,1,2,0)
Area of Use into one or more selected NAOUs.  As many as 10 NAOUs may be
"KRN",19,4094,1,3,0)
chosen for transfer at one time.  You may transfer either drug name only,
"KRN",19,4094,1,4,0)
or drug name, stock level, and location code, or drug name, stock level,
"KRN",19,4094,1,5,0)
location code, and inventory types.  The "copy" process will not copy
"KRN",19,4094,1,6,0)
inactive drugs.  The actual transfer takes place in a background job
"KRN",19,4094,1,7,0)
which is automatically queued.  When the transfer is complete, you will
"KRN",19,4094,1,8,0)
be notified by a MailMan message.
"KRN",19,4094,25)
PSDTRN
"KRN",19,4094,"U")
NAOU TO NAOU TRANSFER STOCK EN
"KRN",19,4095,-1)
0^128
"KRN",19,4095,0)
PSD TRANSFER AOU^AOU to NAOU Transfer Entries^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4095,1,0)
^^9^9^2941027^^^^
"KRN",19,4095,1,1,0)
This option will "copy" the active stock entries from a selected AR/WS
"KRN",19,4095,1,2,0)
Area of Use into one or more selected Controlled Substances Narcotic
"KRN",19,4095,1,3,0)
Areas of Use.  As many as 10 NAOUs may be chosen for transfer at one
"KRN",19,4095,1,4,0)
time.  You may transfer either the drug name only, or the drug name, stock
"KRN",19,4095,1,5,0)
level, and location code, or drug name, stock level, location code, and
"KRN",19,4095,1,6,0)
inventory types.  The "copy" process will not copy inactive drugs.
"KRN",19,4095,1,7,0)
The actual transfer takes place in a background job which is queued
"KRN",19,4095,1,8,0)
automatically.  When the transfer is complete, you will be notified by
"KRN",19,4095,1,9,0)
a MailMan message.
"KRN",19,4095,25)
PSDTRA
"KRN",19,4095,"U")
AOU TO NAOU TRANSFER ENTRIES
"KRN",19,4175,-1)
0^69
"KRN",19,4175,0)
PSD MGR^Supervisor (CS) Menu^^M^^PSDMGR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4175,1,0)
^^2^2^2950228^^^^
"KRN",19,4175,1,1,0)
This menu contains the options used for the NAOU set-up and
"KRN",19,4175,1,2,0)
maintenance.  The PSDMGR key locks this menu.
"KRN",19,4175,10,0)
^19.01PI^12^12
"KRN",19,4175,10,1,0)
3815^^1
"KRN",19,4175,10,1,"^")
PSD SETUP
"KRN",19,4175,10,2,0)
4178^^5
"KRN",19,4175,10,2,"^")
PSD MGR REPORTS
"KRN",19,4175,10,3,0)
4199^^10
"KRN",19,4175,10,3,"^")
PSD BALANCE ADJUSTMENTS
"KRN",19,4175,10,6,0)
4279^^60
"KRN",19,4175,10,6,"^")
PSD CORRECTION LOG
"KRN",19,4175,10,7,0)
4221^^50
"KRN",19,4175,10,7,"^")
PSD EXISTING GS
"KRN",19,4175,10,9,0)
5733^^75
"KRN",19,4175,10,9,"^")
PSD LABEL PHARM
"KRN",19,4175,10,10,0)
5736^^30
"KRN",19,4175,10,10,"^")
PSD DESTROY MENU
"KRN",19,4175,10,11,0)
5805^^80
"KRN",19,4175,10,11,"^")
PSD LABEL INSP
"KRN",19,4175,10,12,0)
6864^^90
"KRN",19,4175,10,12,"^")
PSD EMERGENCY ORDER REPORT
"KRN",19,4175,15)

"KRN",19,4175,20)

"KRN",19,4175,99)
56749,40572
"KRN",19,4175,"U")
SUPERVISOR (CS) MENU
"KRN",19,4176,-1)
0^67
"KRN",19,4176,0)
PSD MFG REPORT PRINT^Manufacturer and Narcotic Information Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4176,1,0)
^^6^6^2941027^^^^
"KRN",19,4176,1,1,0)
This report prints an alphabetical listing of all ACTIVE drugs within an
"KRN",19,4176,1,2,0)
ACTIVE NAOU that have been defined in the DRUG ACCOUNTABILITY STATS file
"KRN",19,4176,1,3,0)
(#58.8). This report lists NAOU, drug name, manufacturer, lot #, expiration
"KRN",19,4176,1,4,0)
date, narcotic breakdown unit, and narcotic package size.  This report may
"KRN",19,4176,1,5,0)
be sorted alphabetically by NAOU, then drug name or drug name, then NAOU.
"KRN",19,4176,1,6,0)
The user may select one NAOU, several NAOUs, or all NAOUs to print.
"KRN",19,4176,25)
PSDPMFG
"KRN",19,4176,"U")
MANUFACTURER AND NARCOTIC INFO
"KRN",19,4177,-1)
0^25
"KRN",19,4177,0)
PSD DRUG CHECK^Check Stocked Drugs for CS Use^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4177,1,0)
^^5^5^2930224^^^
"KRN",19,4177,1,1,0)
This option queues a background job to check all ACTIVE drugs stocked,
"KRN",19,4177,1,2,0)
within an ACTIVE NAOU, for use with the Controlled Substances package.
"KRN",19,4177,1,3,0)
If a stocked drug has been unmarked for CS use the drug will then be
"KRN",19,4177,1,4,0)
inactivated.  At job completion a MailMan message will be sent listing
"KRN",19,4177,1,5,0)
any drug discrepancies.
"KRN",19,4177,25)
PSDMAPU
"KRN",19,4177,"U")
CHECK STOCKED DRUGS FOR CS USE
"KRN",19,4178,-1)
0^70
"KRN",19,4178,0)
PSD MGR REPORTS^Management Reports^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4178,1,0)
^^2^2^2940908^^^^
"KRN",19,4178,1,1,0)
This option contains all reports or lists associated with drug
"KRN",19,4178,1,2,0)
accountability for narcotics.
"KRN",19,4178,10,0)
^19.01PI^16^16
"KRN",19,4178,10,1,0)
4212^^10
"KRN",19,4178,10,1,"^")
PSD NOT DELIVERED
"KRN",19,4178,10,2,0)
4205^^15
"KRN",19,4178,10,2,"^")
PSD PEND VAULT ORDERS
"KRN",19,4178,10,3,0)
4222^^20
"KRN",19,4178,10,3,"^")
PSD DESTRUCTION HOLDING
"KRN",19,4178,10,4,0)
4224^^40
"KRN",19,4178,10,4,"^")
PSD EDIT/CANC VER ORD RPT
"KRN",19,4178,10,5,0)
4236^^45
"KRN",19,4178,10,5,"^")
PSD GS TRANSFER (NAOU) REPORT
"KRN",19,4178,10,6,0)
4237^^50
"KRN",19,4178,10,6,"^")
PSD GS TRANS NOT RECD (NAOU)
"KRN",19,4178,10,7,0)
4278^^55
"KRN",19,4178,10,7,"^")
PSD GS DISCREPANCY REPORT
"KRN",19,4178,10,8,0)
4280^^60
"KRN",19,4178,10,8,"^")
PSD CORRECTION LOG REPORT
"KRN",19,4178,10,9,0)
4282^^65
"KRN",19,4178,10,9,"^")
PSD NAOU USAGE
"KRN",19,4178,10,10,0)
5127^^21
"KRN",19,4178,10,10,"^")
PSD DESTROY DEA41
"KRN",19,4178,10,11,0)
5128^^22
"KRN",19,4178,10,11,"^")
PSD DEST DRUGS REPORT
"KRN",19,4178,10,12,0)
5716^^70
"KRN",19,4178,10,12,"^")
PSD AMIS
"KRN",19,4178,10,13,0)
5721^^75
"KRN",19,4178,10,13,"^")
PSD GS LISTING
"KRN",19,4178,10,14,0)
5800^^72
"KRN",19,4178,10,14,"^")
PSD COST REPORTS
"KRN",19,4178,10,15,0)
5804^^78
"KRN",19,4178,10,15,"^")
PSD PRT GS INSP HOLD
"KRN",19,4178,10,16,0)
5810^
"KRN",19,4178,10,16,"^")
PSD BALANCE ADJUSTMENT REVIEW
"KRN",19,4178,99)
56749,40572
"KRN",19,4178,"U")
MANAGEMENT REPORTS
"KRN",19,4179,-1)
0^127
"KRN",19,4179,0)
PSD TRANSACTION MENU^Pharmacist Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4179,1,0)
^^7^7^2940913^^^^
"KRN",19,4179,1,1,0)
This option provides pharmacy the access to process all Controlled
"KRN",19,4179,1,2,0)
Substances transactions.  This includes receipts into pharmacy, all
"KRN",19,4179,1,3,0)
orders dispensed from pharmacy, and outpatient prescriptions.
"KRN",19,4179,1,4,0)
Completing Green Sheets allows pharmacy to complete those Green Sheets
"KRN",19,4179,1,5,0)
with no discrepancies, math errors, drugs returned to stock, and drugs being
"KRN",19,4179,1,6,0)
held for destruction.  Returns to stock and holding for destruction must be
"KRN",19,4179,1,7,0)
drugs associated with the Green Sheet when using this option.
"KRN",19,4179,10,0)
^19.01PI^14^14
"KRN",19,4179,10,1,0)
4194^^1
"KRN",19,4179,10,1,"^")
PSD RECEIPTS MENU
"KRN",19,4179,10,2,0)
4190^^2
"KRN",19,4179,10,2,"^")
PSD DISPENSING MENU
"KRN",19,4179,10,3,0)
4217^^3
"KRN",19,4179,10,3,"^")
PSD COMPLETE GS
"KRN",19,4179,10,4,0)
4219^^4
"KRN",19,4179,10,4,"^")
PSD OUTPATIENT
"KRN",19,4179,10,5,0)
5123^^5
"KRN",19,4179,10,5,"^")
PSD TRANSFER VAULT DRUGS
"KRN",19,4179,10,9,0)
5735^^10
"KRN",19,4179,10,9,"^")
PSD INFUSION MENU
"KRN",19,4179,10,10,0)
5736^^15
"KRN",19,4179,10,10,"^")
PSD DESTROY MENU
"KRN",19,4179,10,11,0)
4185^^20
"KRN",19,4179,10,11,"^")
PSD ORDER ENTRY
"KRN",19,4179,10,12,0)
4186^^25
"KRN",19,4179,10,12,"^")
PSD REC GS
"KRN",19,4179,10,13,0)
6344^^90
"KRN",19,4179,10,13,"^")
PSD IRL INV MENU
"KRN",19,4179,10,14,0)
3823^^95
"KRN",19,4179,10,14,"^")
PSD MFG/LOT/EXP DATE EDIT
"KRN",19,4179,99)
56866,62209
"KRN",19,4179,"U")
PHARMACIST MENU
"KRN",19,4180,-1)
0^52
"KRN",19,4180,0)
PSD INVEN SHEET PRT^Inventory Sheet Print^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4180,1,0)
^^6^6^2940411^^^^
"KRN",19,4180,1,1,0)
This option prints an Inspector's Sheet which is used to inventory on-hand
"KRN",19,4180,1,2,0)
amounts within a pharmacy dispensing site (vault).  This form lists
"KRN",19,4180,1,3,0)
current on-hand amounts and provides a blank space for the inspector to
"KRN",19,4180,1,4,0)
list actual on-hand counts.  A signature line is included on each page.
"KRN",19,4180,1,5,0)
This sheet may be generated for one drug, some drugs, or ALL drugs.
"KRN",19,4180,1,6,0)
The drugs are listed alphabetically.
"KRN",19,4180,25)
PSDBALI
"KRN",19,4180,99)
55774,57084
"KRN",19,4180,"U")
INVENTORY SHEET PRINT
"KRN",19,4181,-1)
0^89
"KRN",19,4181,0)
PSD ON-HAND^List On-Hand Amounts^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4181,1,0)
^^4^4^2940411^^^
"KRN",19,4181,1,1,0)
This option lists current on-hand amounts for drugs stocked in a pharmacy
"KRN",19,4181,1,2,0)
dispensing site (vault).  The drugs may be selected by one, some, or ALL.
"KRN",19,4181,1,3,0)
The drugs are listed alphabetically to the user's screen or a selected
"KRN",19,4181,1,4,0)
printer.
"KRN",19,4181,25)
PSDBAL
"KRN",19,4181,"U")
LIST ON-HAND AMOUNTS
"KRN",19,4183,-1)
0^105
"KRN",19,4183,0)
PSD PRODUCTION REPORTS^Production Reports^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4183,1,0)
^^4^4^2940913^^^^
"KRN",19,4183,1,1,0)
Pharmacy uses the production reports to maintain Controlled Substances
"KRN",19,4183,1,2,0)
drug accountability and proper inventory controls.  Reports generated
"KRN",19,4183,1,3,0)
in lieu of VA FORM 10-2321 and VA FORM 10-2638 may be generated
"KRN",19,4183,1,4,0)
from this menu.
"KRN",19,4183,10,0)
^19.01PI^20^20
"KRN",19,4183,10,2,0)
4193^^5
"KRN",19,4183,10,2,"^")
PSD PRINT INSPECTOR LOG
"KRN",19,4183,10,3,0)
4082^^7
"KRN",19,4183,10,3,"^")
PSD STOCK PRINT
"KRN",19,4183,10,4,0)
4192^^12
"KRN",19,4183,10,4,"^")
PSD PRINT PHARM DISP
"KRN",19,4183,10,6,0)
4203^^9
"KRN",19,4183,10,6,"^")
PSD PRINT GS PICKUP
"KRN",19,4183,10,10,0)
4205^^3
"KRN",19,4183,10,10,"^")
PSD PEND VAULT ORDERS
"KRN",19,4183,10,11,0)
4212^^4
"KRN",19,4183,10,11,"^")
PSD NOT DELIVERED
"KRN",19,4183,10,12,0)
4226^^25
"KRN",19,4183,10,12,"^")
PSD GS HISTORY
"KRN",19,4183,10,13,0)
4225^^20
"KRN",19,4183,10,13,"^")
PSD DAILY LOG
"KRN",19,4183,10,14,0)
4180^^50
"KRN",19,4183,10,14,"^")
PSD INVEN SHEET PRT
"KRN",19,4183,10,15,0)
4181^^55
"KRN",19,4183,10,15,"^")
PSD ON-HAND
"KRN",19,4183,10,16,0)
4235^^30
"KRN",19,4183,10,16,"^")
PSD EXP REPORT
"KRN",19,4183,10,17,0)
5124^^22
"KRN",19,4183,10,17,"^")
PSD PRINT VAULT TRANSFERS
"KRN",19,4183,10,18,0)
5734^^10
"KRN",19,4183,10,18,"^")
PSD PRT GS PICKED UP
"KRN",19,4183,10,19,0)
6343^^6
"KRN",19,4183,10,19,"^")
PSD INSP LOG BY RECD DATE
"KRN",19,4183,10,20,0)
6348^
"KRN",19,4183,10,20,"^")
PSD RX DISPENSING REPORT
"KRN",19,4183,99)
56749,40572
"KRN",19,4183,"U")
PRODUCTION REPORTS
"KRN",19,4184,-1)
0^82
"KRN",19,4184,0)
PSD NURSE MENU^Controlled Substances Nurses' (CS) Menu^^M^^^PSD NURSE^^^^^CONTROLLED SUBSTANCES^^1^1
"KRN",19,4184,1,0)
^^2^2^2960930^^^^
"KRN",19,4184,1,1,0)
This menu provides nurses access to all options associated with
"KRN",19,4184,1,2,0)
requesting and receiving Controlled Substances drugs from pharmacy.
"KRN",19,4184,10,0)
^19.01PI^27^27
"KRN",19,4184,10,5,0)
4214^^12
"KRN",19,4184,10,5,"^")
PSD NURSE SHIFT LOG
"KRN",19,4184,10,20,0)
6905^^30
"KRN",19,4184,10,20,"^")
PSD NURSE HELP
"KRN",19,4184,10,22,0)
7270^^3
"KRN",19,4184,10,22,"^")
PSD NURSE DISP MENU
"KRN",19,4184,10,23,0)
7277^^4
"KRN",19,4184,10,23,"^")
PSD NURSE ORDER MENU
"KRN",19,4184,10,24,0)
7278^^6
"KRN",19,4184,10,24,"^")
PSD NURSE GS MENU
"KRN",19,4184,10,25,0)
7346^^15
"KRN",19,4184,10,25,"^")
PSD NAOU BALANCE REPORT
"KRN",19,4184,10,26,0)
4186^^5
"KRN",19,4184,10,26,"^")
PSD REC GS
"KRN",19,4184,10,27,0)
8239^^4
"KRN",19,4184,10,27,"^")
PSD NURSE ONLINE COUNT
"KRN",19,4184,15)
K PSDSITE
"KRN",19,4184,20)
I '$D(PSDSITE) D ^PSDSET
"KRN",19,4184,99)
56958,50349
"KRN",19,4184,99.1)
56321,36874
"KRN",19,4184,"U")
CONTROLLED SUBSTANCES NURSES' 
"KRN",19,4185,-1)
0^91
"KRN",19,4185,0)
PSD ORDER ENTRY^CS Order Entry For Ward^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4185,1,0)
^^2^2^2950426^^^^
"KRN",19,4185,1,1,0)
Use this option to electronically request Controlled Substances
"KRN",19,4185,1,2,0)
drugs from pharmacy requiring the VA FORM 10-2638.
"KRN",19,4185,25)
PSDORN
"KRN",19,4185,99)
56783,51164
"KRN",19,4185,"U")
CS ORDER ENTRY FOR WARD
"KRN",19,4186,-1)
0^112
"KRN",19,4186,0)
PSD REC GS^Receipt of Controlled Substance from Pharmacy^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4186,1,0)
^^2^2^2950426^^^^
"KRN",19,4186,1,1,0)
Use this option to receive Controlled Substances orders with
"KRN",19,4186,1,2,0)
a Green Sheet (VA FORM 10-2638).
"KRN",19,4186,25)
PSDNRGS
"KRN",19,4186,"U")
RECEIPT OF CONTROLLED SUBSTANC
"KRN",19,4187,-1)
0^95
"KRN",19,4187,0)
PSD PHARM TECH^Technician (CS Pharmacy) Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4187,1,0)
^^4^4^2950524^^^^
"KRN",19,4187,1,1,0)
This menu provides the pharmacy technicians access to options
"KRN",19,4187,1,2,0)
associated with requesting, receiving, and processing Controlled Substances
"KRN",19,4187,1,3,0)
orders handled by pharmacy and nursing.  This menu is a combination of
"KRN",19,4187,1,4,0)
Controlled Substances options used by both pharmacy technicians and RPhs.
"KRN",19,4187,10,0)
^19.01PI^13^13
"KRN",19,4187,10,1,0)
4188^^1
"KRN",19,4187,10,1,"^")
PSD WORKSHEET PRINT
"KRN",19,4187,10,2,0)
4189^^2
"KRN",19,4187,10,2,"^")
PSD WORKSHEET DISPENSING
"KRN",19,4187,10,5,0)
4203^^5
"KRN",19,4187,10,5,"^")
PSD PRINT GS PICKUP
"KRN",19,4187,10,6,0)
4211^^6
"KRN",19,4187,10,6,"^")
PSD PICKUP GS
"KRN",19,4187,10,7,0)
4185^^7
"KRN",19,4187,10,7,"^")
PSD ORDER ENTRY
"KRN",19,4187,10,8,0)
4186^^8
"KRN",19,4187,10,8,"^")
PSD REC GS
"KRN",19,4187,10,9,0)
4217^^6.5
"KRN",19,4187,10,9,"^")
PSD COMPLETE GS
"KRN",19,4187,10,10,0)
4226^^6.6
"KRN",19,4187,10,10,"^")
PSD GS HISTORY
"KRN",19,4187,10,11,0)
6913^^15
"KRN",19,4187,10,11,"^")
PSD ON-HAND TECH
"KRN",19,4187,10,12,0)
6914^^10
"KRN",19,4187,10,12,"^")
PSD DAILY LOG TECH
"KRN",19,4187,10,13,0)
6915^^20
"KRN",19,4187,10,13,"^")
PSD PRINT VAULT TRANSFERS TECH
"KRN",19,4187,99)
56866,62209
"KRN",19,4187,"U")
TECHNICIAN (CS PHARMACY) MENU
"KRN",19,4188,-1)
0^135
"KRN",19,4188,0)
PSD WORKSHEET PRINT^Print CS Dispensing Worksheet^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4188,1,0)
^^16^16^2941006^^^^
"KRN",19,4188,1,1,0)
Pharmacy personnel use this option to print a dispensing worksheet.
"KRN",19,4188,1,2,0)
This worksheet MUST be printed prior to pharmacy dispensing
"KRN",19,4188,1,3,0)
Controlled Substances orders.  Pharmacy may sort this report within
"KRN",19,4188,1,4,0)
a dispensing site, by NAOU (one, some, or ALL), or by inventory group.
"KRN",19,4188,1,5,0)
Next, the orders are sorted by either (1) drug, then all NAOUs, or
"KRN",19,4188,1,6,0)
(2) NAOU, then all drugs.  The worksheet lists a worksheet number assigned
"KRN",19,4188,1,7,0)
to this order, drug, quantity ordered, dispense to location,
"KRN",19,4188,1,8,0)
ordered by, comments, and blanks for manufacturer, lot #, and
"KRN",19,4188,1,9,0)
expiration date.  When using the Fill/Dispense CS Orders from Worksheet
"KRN",19,4188,1,10,0)
option, pharmacy may process orders by individual request number
"KRN",19,4188,1,11,0)
(the assigned worksheet number) or by worksheet.  If the worksheet
"KRN",19,4188,1,12,0)
method of dispensing is selected, the software will display each
"KRN",19,4188,1,13,0)
order to the pharmacist in the sequence the order was printed.
"KRN",19,4188,1,14,0)
Each time this report is run, a new worksheet will be built and
"KRN",19,4188,1,15,0)
all new CS orders will be included.  The printed sequence of CS orders
"KRN",19,4188,1,16,0)
will change with each new worksheet.
"KRN",19,4188,25)
PSDPWK
"KRN",19,4188,"U")
PRINT CS DISPENSING WORKSHEET
"KRN",19,4189,-1)
0^134
"KRN",19,4189,0)
PSD WORKSHEET DISPENSING^Fill/Dispense CS Orders from Worksheet^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4189,1,0)
^^10^10^2941006^^^^
"KRN",19,4189,1,1,0)
Pharmacy personnel use this option to process and verify Controlled
"KRN",19,4189,1,2,0)
Substances orders.  The Pharmacy Dispensing Worksheet should be printed
"KRN",19,4189,1,3,0)
first using the Print CS Dispensing Worksheet option. Controlled
"KRN",19,4189,1,4,0)
Substances orders may be dispensed by selecting an individual worksheet
"KRN",19,4189,1,5,0)
number or by sort order on the worksheet.  The pharmacist will be prompted
"KRN",19,4189,1,6,0)
for dispensing pharmacist, dispensing site, quantity dispensed,
"KRN",19,4189,1,7,0)
manufacturer, lot #, and expiration date.  The prompt for pharmacy
"KRN",19,4189,1,8,0)
dispensing number will only appear if your site has elected to
"KRN",19,4189,1,9,0)
enter these control numbers manually.  Otherwise, the software
"KRN",19,4189,1,10,0)
will automatically generate the next available dispensing number.
"KRN",19,4189,25)
PSDDWK
"KRN",19,4189,"U")
FILL/DISPENSE CS ORDERS FROM W
"KRN",19,4190,-1)
0^24
"KRN",19,4190,0)
PSD DISPENSING MENU^Dispensing Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4190,1,0)
^^2^2^2961001^^^^
"KRN",19,4190,1,1,0)
This menu contains access to all options associated with the dispensing
"KRN",19,4190,1,2,0)
of Controlled Substances.
"KRN",19,4190,10,0)
^19.01PI^8^8
"KRN",19,4190,10,1,0)
4188^^1
"KRN",19,4190,10,1,"^")
PSD WORKSHEET PRINT
"KRN",19,4190,10,2,0)
4189^^2
"KRN",19,4190,10,2,"^")
PSD WORKSHEET DISPENSING
"KRN",19,4190,10,3,0)
4191^^3
"KRN",19,4190,10,3,"^")
PSD PRINT 2321
"KRN",19,4190,10,4,0)
4206^^4
"KRN",19,4190,10,4,"^")
PSD PRINT 2638
"KRN",19,4190,10,5,0)
4209^^6
"KRN",19,4190,10,5,"^")
PSD DISPENSE W/O GS
"KRN",19,4190,10,6,0)
4201^^5
"KRN",19,4190,10,6,"^")
PSD REPRINT MENU
"KRN",19,4190,10,7,0)
5727^^10
"KRN",19,4190,10,7,"^")
PSD LABEL DRUG/NUMBER
"KRN",19,4190,10,8,0)
7279^^90
"KRN",19,4190,10,8,"^")
PSD DISPENSE TO NDES
"KRN",19,4190,99)
56749,40572
"KRN",19,4190,"U")
DISPENSING MENU
"KRN",19,4191,-1)
0^97
"KRN",19,4191,0)
PSD PRINT 2321^Dispensing/Receiving Report (VA FORM 10-2321)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4191,1,0)
^^7^7^2940926^^^^
"KRN",19,4191,1,1,0)
This report lists all CS orders dispensed to a Narcotic Area
"KRN",19,4191,1,2,0)
of Use.  This report requires the Dispensing Pharmacist signature
"KRN",19,4191,1,3,0)
and the signature of the nurse receiving the CS drugs.  This report
"KRN",19,4191,1,4,0)
will be retained within pharmacy after the controlled substances are
"KRN",19,4191,1,5,0)
delivered to the ward.
"KRN",19,4191,1,6,0)
  
"KRN",19,4191,1,7,0)
This report replaces the VA FORM 10-2321.
"KRN",19,4191,25)
PSDPDR
"KRN",19,4191,"U")
DISPENSING/RECEIVING REPORT (V
"KRN",19,4192,-1)
0^101
"KRN",19,4192,0)
PSD PRINT PHARM DISP^Pharmacy Dispensing Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4192,1,0)
^^5^5^2930727^^^
"KRN",19,4192,1,1,0)
This report lists by dispensing site and date range the drug name,
"KRN",19,4192,1,2,0)
pharmacy dispensing number (Green Sheet #), quantity dispensed, date
"KRN",19,4192,1,3,0)
dispensed, and dispensing pharmacist.  Also there's a summary by
"KRN",19,4192,1,4,0)
drug of total number dispensed.  The summary may be generated without the
"KRN",19,4192,1,5,0)
individual dispensing data.
"KRN",19,4192,25)
PSDPND
"KRN",19,4192,"U")
PHARMACY DISPENSING REPORT
"KRN",19,4193,-1)
0^100
"KRN",19,4193,0)
PSD PRINT INSPECTOR LOG^Inspector's Log for Controlled Substances^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4193,1,0)
^^4^4^2930224^^^
"KRN",19,4193,1,1,0)
This report lists all active Green Sheets by Narcotic Area of Use.  The
"KRN",19,4193,1,2,0)
data includes Green Sheet number, drug name, date dispensed, quantity
"KRN",19,4193,1,3,0)
dispensed, expiration date (if available), blanks for quantity on hand,
"KRN",19,4193,1,4,0)
and a signature blank for verification.
"KRN",19,4193,25)
PSDPLOG
"KRN",19,4193,99)
55707,39068
"KRN",19,4193,"U")
INSPECTOR'S LOG FOR CONTROLLED
"KRN",19,4194,-1)
0^113
"KRN",19,4194,0)
PSD RECEIPTS MENU^Receipts Into Pharmacy^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4194,1,0)
^^2^2^2940913^^^^
"KRN",19,4194,1,1,0)
Use this option to process receipts for purchase orders, control point
"KRN",19,4194,1,2,0)
transactions, and Prime Vendors.
"KRN",19,4194,10,0)
^19.01PI^5^5
"KRN",19,4194,10,1,0)
4195^^10
"KRN",19,4194,10,1,"^")
PSD RECEIVING
"KRN",19,4194,10,2,0)
4196^^20
"KRN",19,4194,10,2,"^")
PSD PURCHASE ORDER REVIEW
"KRN",19,4194,10,3,0)
4197^^30
"KRN",19,4194,10,3,"^")
PSD CP TRANSACTION REVIEW
"KRN",19,4194,10,4,0)
4198^^40
"KRN",19,4194,10,4,"^")
PSD DRUG RECEIPT HISTORY
"KRN",19,4194,10,5,0)
4241^^50
"KRN",19,4194,10,5,"^")
PSD PV INVOICE REVIEW
"KRN",19,4194,25)

"KRN",19,4194,99)
56749,40572
"KRN",19,4194,"U")
RECEIPTS INTO PHARMACY
"KRN",19,4195,-1)
0^114
"KRN",19,4195,0)
PSD RECEIVING^Receiving^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4195,1,0)
^^3^3^2940913^^^^
"KRN",19,4195,1,1,0)
Use this option to process receipts from a purchase order, control point
"KRN",19,4195,1,2,0)
transaction, or Prime Vendor, updating the balance, transaction file, and
"KRN",19,4195,1,3,0)
monthly activity.
"KRN",19,4195,25)
PSDREC
"KRN",19,4195,99)
56078,53106
"KRN",19,4195,"U")
RECEIVING
"KRN",19,4196,-1)
0^108
"KRN",19,4196,0)
PSD PURCHASE ORDER REVIEW^Purchase Order Review^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4196,1,0)
^^2^2^2941121^^^^
"KRN",19,4196,1,1,0)
Use this option to review all receipt transactions for a selected
"KRN",19,4196,1,2,0)
purchase order.
"KRN",19,4196,25)
PSDREV
"KRN",19,4196,"U")
PURCHASE ORDER REVIEW
"KRN",19,4197,-1)
0^12
"KRN",19,4197,0)
PSD CP TRANSACTION REVIEW^Control Point Transaction Review^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4197,1,0)
^^2^2^2940913^^^
"KRN",19,4197,1,1,0)
Use this option to review the receipt transactions processed for a
"KRN",19,4197,1,2,0)
selected control point transaction number.
"KRN",19,4197,25)
PSDREVC
"KRN",19,4197,"U")
CONTROL POINT TRANSACTION REVI
"KRN",19,4198,-1)
0^29
"KRN",19,4198,0)
PSD DRUG RECEIPT HISTORY^Drug Receipt History^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4198,1,0)
^^2^2^2930224^^^
"KRN",19,4198,1,1,0)
This option is used to review all receipts processed over a selected time
"KRN",19,4198,1,2,0)
range for a selected drug.
"KRN",19,4198,25)
PSDREVD
"KRN",19,4198,"U")
DRUG RECEIPT HISTORY
"KRN",19,4199,-1)
0^3
"KRN",19,4199,0)
PSD BALANCE ADJUSTMENTS^Balance Adjustments^^R^^PSDMGR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4199,1,0)
^^5^5^2940914^^^^
"KRN",19,4199,1,1,0)
This option is used to review or enter adjustments needed to correct
"KRN",19,4199,1,2,0)
the balance of a drug.  Controlled Substances drugs not dispensed with
"KRN",19,4199,1,3,0)
a VA FORM 10-2638 returned to stock, or returned to manufacturer and held
"KRN",19,4199,1,4,0)
for destruction are deducted from the vault on-hand amount using this
"KRN",19,4199,1,5,0)
option.
"KRN",19,4199,25)
PSDADJ
"KRN",19,4199,99)
56019,52906
"KRN",19,4199,"U")
BALANCE ADJUSTMENTS
"KRN",19,4200,-1)
0^115
"KRN",19,4200,0)
PSD REPRINT 2321^Reprint Disp/Receiving Report (VA FORM 10-2321)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4200,1,0)
^^3^3^2941027^^^^
"KRN",19,4200,1,1,0)
The Dispensing/Receiving Report (in lieu of the VA FORM 10-2321) may be
"KRN",19,4200,1,2,0)
reprinted.  This report may be generated for a single Green Sheet or for
"KRN",19,4200,1,3,0)
a single NAOU within a specified date and time frame.
"KRN",19,4200,25)
PSDRDR
"KRN",19,4200,99)
55297,68588
"KRN",19,4200,"U")
REPRINT DISP/RECEIVING REPORT 
"KRN",19,4201,-1)
0^118
"KRN",19,4201,0)
PSD REPRINT MENU^Reprint Reports Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4201,1,0)
^^4^4^2940913^^^^
"KRN",19,4201,1,1,0)
This menu allows various narcotic reports and forms to be reprinted.
"KRN",19,4201,1,2,0)
To ensure drug accountability, certain Controlled Substances documents
"KRN",19,4201,1,3,0)
should only be printed once.  This option allows the reprinting of
"KRN",19,4201,1,4,0)
these controlled records.
"KRN",19,4201,10,0)
^19.01PI^5^5
"KRN",19,4201,10,1,0)
4200^^10
"KRN",19,4201,10,1,"^")
PSD REPRINT 2321
"KRN",19,4201,10,2,0)
4207^^20
"KRN",19,4201,10,2,"^")
PSD REPRINT 2638
"KRN",19,4201,10,3,0)
4681^^30
"KRN",19,4201,10,3,"^")
PSD REPRINT WORKSHEET
"KRN",19,4201,10,4,0)
5811^^40
"KRN",19,4201,10,4,"^")
PSD REPRINT LABEL
"KRN",19,4201,10,5,0)
4281^^50
"KRN",19,4201,10,5,"^")
PSD NURSE REPRINT 2321
"KRN",19,4201,99)
56749,40572
"KRN",19,4201,"U")
REPRINT REPORTS MENU
"KRN",19,4202,-1)
0^111
"KRN",19,4202,0)
PSD READY GS FOR PICKUP^Complete a Green Sheet - Ready for Pickup^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4202,1,0)
^^2^2^2950426^^^^
"KRN",19,4202,1,1,0)
Use this option to complete a Controlled Substance Administration
"KRN",19,4202,1,2,0)
Record (VA FORM 10-2638).  
"KRN",19,4202,25)
PSDNCGS
"KRN",19,4202,"U")
COMPLETE A GREEN SHEET - READY
"KRN",19,4203,-1)
0^99
"KRN",19,4203,0)
PSD PRINT GS PICKUP^Green Sheet Ready for Pickup Log^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4203,1,0)
^^5^5^2920525^
"KRN",19,4203,1,1,0)
This report lists all Green Sheets ready on the wards to be picked up
"KRN",19,4203,1,2,0)
by pharmacy.  This report requires a signature of the pharmacy employee
"KRN",19,4203,1,3,0)
picking up the Green Sheet and a signature of the nurse releasing
"KRN",19,4203,1,4,0)
the Green Sheet.  This document will be retained on the ward for nursing's
"KRN",19,4203,1,5,0)
records.
"KRN",19,4203,25)
PSDPUGS
"KRN",19,4203,"U")
GREEN SHEET READY FOR PICKUP L
"KRN",19,4204,-1)
0^93
"KRN",19,4204,0)
PSD PEND NAOU ORDERS^Pending CS Orders Report for an NAOU^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4204,1,0)
^^2^2^2950426^^^^
"KRN",19,4204,1,1,0)
Use this option to list all pending CS orders.  This report may
"KRN",19,4204,1,2,0)
be generated for a single drug or ALL drugs within the NAOU.
"KRN",19,4204,25)
PSDORSN
"KRN",19,4204,"U")
PENDING CS ORDERS REPORT FOR A
"KRN",19,4205,-1)
0^94
"KRN",19,4205,0)
PSD PEND VAULT ORDERS^Pending CS Orders by Dispensing Site^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4205,1,0)
^^2^2^2940913^^^^
"KRN",19,4205,1,1,0)
Pharmacy uses this option to list all pending Controlled Substances orders
"KRN",19,4205,1,2,0)
for a specific dispensing site.
"KRN",19,4205,25)
PSDORST
"KRN",19,4205,"U")
PENDING CS ORDERS BY DISPENSIN
"KRN",19,4206,-1)
0^98
"KRN",19,4206,0)
PSD PRINT 2638^Green Sheet - Print (VA FORM 10-2638)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4206,1,0)
^^3^3^2930224^^^
"KRN",19,4206,1,1,0)
Pharmacy prints Green Sheets using this option.  All Green Sheets, not
"KRN",19,4206,1,2,0)
previously printed for a specific NAOU, will be generated.  A single
"KRN",19,4206,1,3,0)
Green Sheet print may also be selected.
"KRN",19,4206,25)
PSDPGS
"KRN",19,4206,"U")
GREEN SHEET - PRINT (VA FORM 1
"KRN",19,4207,-1)
0^116
"KRN",19,4207,0)
PSD REPRINT 2638^Green Sheet Reprint (VA FORM 10-2638)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4207,1,0)
^^1^1^2920912^^^
"KRN",19,4207,1,1,0)
Pharmacy uses this option to reprint a single Green Sheet.
"KRN",19,4207,25)
PSDRPGS
"KRN",19,4207,"U")
GREEN SHEET REPRINT (VA FORM 1
"KRN",19,4209,-1)
0^23
"KRN",19,4209,0)
PSD DISPENSE W/O GS^Pharmacy Dispense without (VA FORM 10-2638)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4209,1,0)
^^5^5^2960221^^^^
"KRN",19,4209,1,1,0)
This option provides pharmacy the ability to dispense Controlled Substances
"KRN",19,4209,1,2,0)
drugs from a dispensing site without generating the VA FORM 10-2638.
"KRN",19,4209,1,3,0)
Drugs dispensed using this option will not be displayed on the Inspector's
"KRN",19,4209,1,4,0)
Log for Controlled Substances for the NAOUs.  These drugs will be included
"KRN",19,4209,1,5,0)
on the Pharmacy Dispensing Report and the Daily Activity Log.
"KRN",19,4209,25)
PSDDFP
"KRN",19,4209,"U")
PHARMACY DISPENSE WITHOUT (VA 
"KRN",19,4211,-1)
0^96
"KRN",19,4211,0)
PSD PICKUP GS^Pick Up Green Sheet^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4211,1,0)
^^2^2^2930727^^^
"KRN",19,4211,1,1,0)
This option provides pharmacy the ability to receive a Green Sheet into
"KRN",19,4211,1,2,0)
pharmacy that has been marked as Ready for Pickup by Nursing.
"KRN",19,4211,25)
PSDGSPU
"KRN",19,4211,"U")
PICK UP GREEN SHEET
"KRN",19,4212,-1)
0^78
"KRN",19,4212,0)
PSD NOT DELIVERED^Orders Filled Not Delivered^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4212,1,0)
^^4^4^2930224^^^^
"KRN",19,4212,1,1,0)
This option generates a list of all Controlled Substances orders
"KRN",19,4212,1,2,0)
filled from the pharmacy dispensing site (vault) but not yet
"KRN",19,4212,1,3,0)
delivered to the NAOUs.  A summary total sorted by drug is also
"KRN",19,4212,1,4,0)
generated.
"KRN",19,4212,25)
PSDFND
"KRN",19,4212,"U")
ORDERS FILLED NOT DELIVERED
"KRN",19,4214,-1)
0^86
"KRN",19,4214,0)
PSD NURSE SHIFT LOG^Ward (NAOU) Drug History^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4214,1,0)
^^2^2^2950426^^^^
"KRN",19,4214,1,1,0)
Use this report to list all ACTIVE Controlled Substances
"KRN",19,4214,1,2,0)
orders currently on a specific NAOU.
"KRN",19,4214,25)
PSDNSCL
"KRN",19,4214,"U")
WARD (NAOU) DRUG HISTORY
"KRN",19,4215,-1)
0^109
"KRN",19,4215,0)
PSD PURGE^Purge CS WORKSHEET File^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4215,1,0)
^^8^8^2940914^^^^
"KRN",19,4215,1,1,0)
This option purges the CS WORKSHEET file (#58.85) nightly.
"KRN",19,4215,1,2,0)
The CS WORKSHEET file (#58.85) is the holding area for CS order requests
"KRN",19,4215,1,3,0)
pending pharmacy processing. The data should remain in the file until
"KRN",19,4215,1,4,0)
orders have been received on an NAOU or cancelled. Once the order is
"KRN",19,4215,1,5,0)
received on an NAOU or cancelled, the data is purged from the file using
"KRN",19,4215,1,6,0)
this background job. This routine should run nightly, therefore the
"KRN",19,4215,1,7,0)
rescheduling frequency is 1D. The time to queue this option to run should
"KRN",19,4215,1,8,0)
not conflict with system backup.
"KRN",19,4215,25)
PSDPRG
"KRN",19,4215,200.9)
y
"KRN",19,4215,"U")
PURGE CS WORKSHEET FILE
"KRN",19,4217,-1)
0^5
"KRN",19,4217,0)
PSD COMPLETE GS^Complete Green Sheet^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4217,1,0)
^^4^4^2961219^^^^
"KRN",19,4217,1,1,0)
Pharmacy uses this option to complete a reviewed Green Sheet.  Green
"KRN",19,4217,1,2,0)
Sheets with no discrepancies, math errors, drugs returned to stock, and
"KRN",19,4217,1,3,0)
drugs holding for destruction, associated with this Green Sheet, are
"KRN",19,4217,1,4,0)
processed utilizing this option.
"KRN",19,4217,25)
PSDGSRV
"KRN",19,4217,"U")
COMPLETE GREEN SHEET
"KRN",19,4219,-1)
0^92
"KRN",19,4219,0)
PSD OUTPATIENT^Outpatient Rx's^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4219,1,0)
^^5^5^2940913^^^^
"KRN",19,4219,1,1,0)
This option provides pharmacy the ability to log outpatient prescriptions
"KRN",19,4219,1,2,0)
from their Controlled Substances dispensing vault.  The pharmacist will
"KRN",19,4219,1,3,0)
select an outpatient prescription and the software will display the most
"KRN",19,4219,1,4,0)
recently filled Rx.  It will display new, refill, and partial
"KRN",19,4219,1,5,0)
prescriptions.
"KRN",19,4219,25)
PSDOPT
"KRN",19,4219,"U")
OUTPATIENT RX'S
"KRN",19,4220,-1)
0^30
"KRN",19,4220,0)
PSD EDIT/CANC VER ORD^Edit/Cancel Verified Orders^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4220,1,0)
6
"KRN",19,4220,1,1,0)
This option allows the pharmacy supervisor access to edit or cancel a
"KRN",19,4220,1,2,0)
verified order.  The order must be edited or cancelled prior to being
"KRN",19,4220,1,3,0)
delivered to the NAOU.  A verified order may be edited only once.  It
"KRN",19,4220,1,4,0)
must be cancelled and re-entered if a second edit is required.  Quantity,
"KRN",19,4220,1,5,0)
manufacturer, lot number, and expiration date are the only fields in which
"KRN",19,4220,1,6,0)
edits can be made.
"KRN",19,4220,25)
PSDEVO
"KRN",19,4220,"U")
EDIT/CANCEL VERIFIED ORDERS
"KRN",19,4221,-1)
0^37
"KRN",19,4221,0)
PSD EXISTING GS^Add Existing Green Sheets at Setup^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4221,1,0)
^^3^3^2930727^^^^
"KRN",19,4221,1,1,0)
This option provides pharmacy the ability to enter existing Green Sheets
"KRN",19,4221,1,2,0)
and active orders on an NAOU, at package setup.  These orders may be tracked
"KRN",19,4221,1,3,0)
through the Controlled Substances software.
"KRN",19,4221,25)
PSDEXGS
"KRN",19,4221,"U")
ADD EXISTING GREEN SHEETS AT S
"KRN",19,4222,-1)
0^22
"KRN",19,4222,0)
PSD DESTRUCTION HOLDING^Destructions Holding Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4222,1,0)
^^2^2^2920912^^^
"KRN",19,4222,1,1,0)
This report lists all Controlled Substances drugs being held for
"KRN",19,4222,1,2,0)
destruction.
"KRN",19,4222,25)
PSDHRPT
"KRN",19,4222,"U")
DESTRUCTIONS HOLDING REPORT
"KRN",19,4223,-1)
0^20
"KRN",19,4223,0)
PSD DESTROY DRUGS^Destroy a Controlled Substances Drug^^R^^PSDMGR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4223,1,0)
^^2^2^2931024^^^^
"KRN",19,4223,1,1,0)
This option provides the supervisor ability to enter the destruction
"KRN",19,4223,1,2,0)
information for any Controlled Substances drug being destroyed.
"KRN",19,4223,25)
PSDEST
"KRN",19,4223,"U")
DESTROY A CONTROLLED SUBSTANCE
"KRN",19,4224,-1)
0^31
"KRN",19,4224,0)
PSD EDIT/CANC VER ORD RPT^Edited Verified Orders Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4224,1,0)
^^6^6^2940908^^^^
"KRN",19,4224,1,1,0)
This report lists all verified orders that have been edited or
"KRN",19,4224,1,2,0)
cancelled within a specified date range.  Data listed includes pharmacy
"KRN",19,4224,1,3,0)
dispensing # (Green Sheet #), date edited, drug, type of action (edited
"KRN",19,4224,1,4,0)
or cancelled), original quantity, new quantity, and name of the pharmacist.
"KRN",19,4224,1,5,0)
The manufacturer, lot #, or expiration date fields will also be listed
"KRN",19,4224,1,6,0)
if edited.
"KRN",19,4224,25)
PSDEVOR
"KRN",19,4224,"U")
EDITED VERIFIED ORDERS REPORT
"KRN",19,4225,-1)
0^13
"KRN",19,4225,0)
PSD DAILY LOG^Daily Activity Log (in lieu of VA FORM 10-2320)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4225,1,0)
^^5^5^2940908^^^^
"KRN",19,4225,1,1,0)
The Daily Activity Log lists all transactions for a Controlled
"KRN",19,4225,1,2,0)
Substances dispensing site (vault).  It includes a forwarding
"KRN",19,4225,1,3,0)
balance on each transaction.  This document may be generated for
"KRN",19,4225,1,4,0)
a single drug, some drugs, or ALL drugs within a specified date
"KRN",19,4225,1,5,0)
range.
"KRN",19,4225,25)
PSDACT
"KRN",19,4225,"U")
DAILY ACTIVITY LOG (IN LIEU OF
"KRN",19,4226,-1)
0^40
"KRN",19,4226,0)
PSD GS HISTORY^Green Sheet History^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4226,1,0)
^^3^3^2950426^^^^
"KRN",19,4226,1,1,0)
The Green Sheet history provides pharmacy with a detailed account
"KRN",19,4226,1,2,0)
of every transaction affecting this VA FORM 10-2638.  This history
"KRN",19,4226,1,3,0)
may be displayed to the user's screen or directed to a printer.
"KRN",19,4226,25)
PSDGSH
"KRN",19,4226,"U")
GREEN SHEET HISTORY
"KRN",19,4231,-1)
0^4
"KRN",19,4231,0)
PSD BALANCE INITIALIZE^Initialize Balance at Setup^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4231,1,0)
^^6^6^2940908^^^^
"KRN",19,4231,1,1,0)
This option will be used at package initialization only.  It provides
"KRN",19,4231,1,2,0)
pharmacy a method of entering on-hand balances for Controlled Substances
"KRN",19,4231,1,3,0)
drugs stocked within their dispensing vaults.  The drugs will be listed
"KRN",19,4231,1,4,0)
alphabetically, displaying narcotic breakdown and package size for each.
"KRN",19,4231,1,5,0)
This option should be used only when the Controlled Substances package
"KRN",19,4231,1,6,0)
is ready to be "turned on" for production use.
"KRN",19,4231,25)
PSDADJI
"KRN",19,4231,"U")
INITIALIZE BALANCE AT SETUP
"KRN",19,4233,-1)
0^88
"KRN",19,4233,0)
PSD NURSE TRANSFER GS^Transfer Green Sheet and Drug to another NAOU^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4233,1,0)
^^7^7^2920916^^^^
"KRN",19,4233,1,1,0)
This option provides nurses the ability to transfer Controlled
"KRN",19,4233,1,2,0)
Substances drugs and their associated Green Sheet to another
"KRN",19,4233,1,3,0)
NAOU.  The transferring of Controlled Substances drugs between
"KRN",19,4233,1,4,0)
NAOUs requires two processing steps.
"KRN",19,4233,1,5,0)
  
"KRN",19,4233,1,6,0)
 Step 1 - Transfer Green Sheet and Drug to another NAOU
"KRN",19,4233,1,7,0)
 Step 2 - From an NAOU - Receive Green Sheet Transfer & Drug
"KRN",19,4233,25)
PSDNTF
"KRN",19,4233,"U")
TRANSFER GREEN SHEET AND DRUG 
"KRN",19,4234,-1)
0^84
"KRN",19,4234,0)
PSD NURSE REC TRANSFER GS^Receive Green Sheet & Drug from another NAOU^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4234,1,0)
^^6^6^2920916^^^^
"KRN",19,4234,1,1,0)
This option provides nurses the ability to receive Controlled Substances
"KRN",19,4234,1,2,0)
drugs and their associated Green Sheet from another NAOU.  The transferring
"KRN",19,4234,1,3,0)
of Controlled Substances drugs between NAOUs requires two processing steps.
"KRN",19,4234,1,4,0)
  
"KRN",19,4234,1,5,0)
 Step 1 - Transfer Green Sheet and Drug to another NAOU
"KRN",19,4234,1,6,0)
 Step 2 - From an NAOU - Receive Green Sheet Transfer & Drug
"KRN",19,4234,25)
PSDNTT
"KRN",19,4234,"U")
RECEIVE GREEN SHEET & DRUG FRO
"KRN",19,4235,-1)
0^38
"KRN",19,4235,0)
PSD EXP REPORT^Expiration Date Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4235,1,0)
^^3^3^2930224^^^^
"KRN",19,4235,1,1,0)
This option will print a Controlled Substances Expiration Date Report
"KRN",19,4235,1,2,0)
for a single NAOU, several NAOUs, or ALL NAOUs.  This report may be
"KRN",19,4235,1,3,0)
sorted by DATE/DRUG/NAOU or by DATE/NAOU/DRUG.
"KRN",19,4235,25)
PSDEXP
"KRN",19,4235,99)
56867,31265
"KRN",19,4235,"U")
EXPIRATION DATE REPORT
"KRN",19,4236,-1)
0^43
"KRN",19,4236,0)
PSD GS TRANSFER (NAOU) REPORT^Green Sheet Transfer Between NAOUs Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4236,1,0)
^^3^3^2930224^^
"KRN",19,4236,1,1,0)
This report lists all Green Sheets transferred and received between
"KRN",19,4236,1,2,0)
NAOUs for a given date range.  This report may be printed for a single
"KRN",19,4236,1,3,0)
NAOU, several NAOUs, or ALL NAOUs.
"KRN",19,4236,25)
PSDNTR
"KRN",19,4236,99)
55373,69034
"KRN",19,4236,"U")
GREEN SHEET TRANSFER BETWEEN N
"KRN",19,4237,-1)
0^42
"KRN",19,4237,0)
PSD GS TRANS NOT RECD (NAOU)^Transferred Green Sheets - Pending NAOU Receipt^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4237,1,0)
^^2^2^2920809^
"KRN",19,4237,1,1,0)
This report lists all Green Sheets that have been transferred from an
"KRN",19,4237,1,2,0)
NAOU and are pending receipt in another NAOU.
"KRN",19,4237,25)
PSDNBT
"KRN",19,4237,"U")
TRANSFERRED GREEN SHEETS - PEN
"KRN",19,4241,-1)
0^110
"KRN",19,4241,0)
PSD PV INVOICE REVIEW^Invoice Review (Prime Vendor)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4241,1,0)
^^2^2^2920817^
"KRN",19,4241,1,1,0)
To list all receipts that have been posted for a selected Prime Vendor
"KRN",19,4241,1,2,0)
invoice number.
"KRN",19,4241,25)
PSDREPV
"KRN",19,4241,"U")
INVOICE REVIEW (PRIME VENDOR)
"KRN",19,4278,-1)
0^39
"KRN",19,4278,0)
PSD GS DISCREPANCY REPORT^Completed Green Sheet Discrepancy Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4278,1,0)
^^4^4^2940908^^^^
"KRN",19,4278,1,1,0)
This report lists all Green Sheets with a completion status of MATH
"KRN",19,4278,1,2,0)
ERROR, GREEN SHEET NOT SIGNED BY NURSE, or OTHER - REFERRED TO
"KRN",19,4278,1,3,0)
SUPERVISOR.  This report may be printed for a single NAOU, several
"KRN",19,4278,1,4,0)
NAOUs, or ALL NAOUs.
"KRN",19,4278,25)
PSDCRP
"KRN",19,4278,"U")
COMPLETED GREEN SHEET DISCREPA
"KRN",19,4279,-1)
0^9
"KRN",19,4279,0)
PSD CORRECTION LOG^Correction Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4279,1,0)
^^17^17^2931110^^^^
"KRN",19,4279,1,1,0)
This menu option allows the pharmacy supervisor access to make corrective
"KRN",19,4279,1,2,0)
actions on Controlled Substances orders.
"KRN",19,4279,1,3,0)
 
"KRN",19,4279,1,4,0)
Sometimes nursing may erroneously flag a Green Sheet ready for pharmacy
"KRN",19,4279,1,5,0)
pickup.  Using this option, the pharmacy supervisor may change the
"KRN",19,4279,1,6,0)
Green Sheet order status from COMPLETED - GREEN SHEET READY FOR PICKUP
"KRN",19,4279,1,7,0)
to DELIVERED - ACTIVELY ON NAOU to correct this problem.
"KRN",19,4279,1,8,0)
  
"KRN",19,4279,1,9,0)
The CS software allows pharmacy to add existing Green Sheets, active
"KRN",19,4279,1,10,0)
orders on an NAOU, at package setup.  These orders may be tracked
"KRN",19,4279,1,11,0)
using the CS software.  Sometimes one of these existing Green Sheets
"KRN",19,4279,1,12,0)
may be incorrectly entered in the software.  Using this option,
"KRN",19,4279,1,13,0)
the pharmacy supervisor may delete this erroneous existing Green
"KRN",19,4279,1,14,0)
Sheet.
"KRN",19,4279,1,15,0)
   
"KRN",19,4279,1,16,0)
An entry in the CS CORRECTION LOG file (#58.87) will be created
"KRN",19,4279,1,17,0)
to log a history of all corrective actions.
"KRN",19,4279,10,0)
^19.01PI^7^7
"KRN",19,4279,10,1,0)
5125^^2
"KRN",19,4279,10,1,"^")
PSD CORRECT STATUS
"KRN",19,4279,10,2,0)
5126^^3
"KRN",19,4279,10,2,"^")
PSD CORRECT EXISTING GS
"KRN",19,4279,10,3,0)
4220^^1
"KRN",19,4279,10,3,"^")
PSD EDIT/CANC VER ORD
"KRN",19,4279,10,4,0)
5229^^4
"KRN",19,4279,10,4,"^")
PSD CORRECT GS STATUS
"KRN",19,4279,10,5,0)
5798^^20
"KRN",19,4279,10,5,"^")
PSD ERR/ADJ PENDING REPORT
"KRN",19,4279,10,6,0)
5799^^40
"KRN",19,4279,10,6,"^")
PSD ERR/ADJ RESOLVED REPORT
"KRN",19,4279,10,7,0)
5806^^30
"KRN",19,4279,10,7,"^")
PSD ERR/ADJ EDIT
"KRN",19,4279,99)
56749,40572
"KRN",19,4279,"U")
CORRECTION MENU
"KRN",19,4280,-1)
0^10
"KRN",19,4280,0)
PSD CORRECTION LOG REPORT^Correction Log Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4280,1,0)
^^3^3^2920911^^
"KRN",19,4280,1,1,0)
This report lists all corrective actions logged for a selected date
"KRN",19,4280,1,2,0)
range.  This report may be generated by order status changes or
"KRN",19,4280,1,3,0)
by Green Sheet deletions.
"KRN",19,4280,25)
PSDCORP
"KRN",19,4280,"U")
CORRECTION LOG REPORT
"KRN",19,4281,-1)
0^85
"KRN",19,4281,0)
PSD NURSE REPRINT 2321^Reprint Transfer Between NAOUs (VA FORM 10-2321)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4281,1,0)
^^5^5^2940926^^^^
"KRN",19,4281,1,1,0)
Nurses may reprint the transfer between NAOUs form (in lieu of
"KRN",19,4281,1,2,0)
VA FORM 10-2321) for any Green Sheet and drug transferred from their
"KRN",19,4281,1,3,0)
NAOU.  The form may be reprinted only if the transferred Green
"KRN",19,4281,1,4,0)
Sheet and drug has not been received into the NAOU receiving
"KRN",19,4281,1,5,0)
the transfer.
"KRN",19,4281,25)
PSDRPT
"KRN",19,4281,"U")
REPRINT TRANSFER BETWEEN NAOUS
"KRN",19,4282,-1)
0^76
"KRN",19,4282,0)
PSD NAOU USAGE^NAOU Usage Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4282,1,0)
^^6^6^2941027^^^^
"KRN",19,4282,1,1,0)
This report will print an NAOU drug usage report for a selected date
"KRN",19,4282,1,2,0)
range.  The report may be sorted by drug (one, some, or ALL) or by
"KRN",19,4282,1,3,0)
NAOU (one, some, or ALL).  A detailed list of orders, including the
"KRN",19,4282,1,4,0)
pharmacy dispensing # (Green Sheet #), date filled, quantity, and who
"KRN",19,4282,1,5,0)
ordered the drug will be printed.  Summary totals by order and quantity
"KRN",19,4282,1,6,0)
are also generated.
"KRN",19,4282,25)
PSDNU
"KRN",19,4282,"U")
NAOU USAGE REPORT
"KRN",19,4681,-1)
0^119
"KRN",19,4681,0)
PSD REPRINT WORKSHEET^Dispensing Worksheet Reprint^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4681,1,0)
^^10^10^2940913^^^^
"KRN",19,4681,1,1,0)
Pharmacy personnel use this option to reprint a dispensing worksheet.
"KRN",19,4681,1,2,0)
The previously printed dispensing worksheet, for a given dispensing
"KRN",19,4681,1,3,0)
site, is utilized in reprinting this listing.  These orders are
"KRN",19,4681,1,4,0)
sequenced by the sort selected during the original printing of the
"KRN",19,4681,1,5,0)
worksheet.  The reprinted worksheet lists a worksheet number assigned
"KRN",19,4681,1,6,0)
to this order, drug, quantity ordered, dispense to location, ordered
"KRN",19,4681,1,7,0)
by, comments and blanks for manufacturer, lot #, and expiration date.
"KRN",19,4681,1,8,0)
If this order has been processed by pharmacy since the original printing,
"KRN",19,4681,1,9,0)
the worksheet number will display as asterisk (*).  A new worksheet will
"KRN",19,4681,1,10,0)
not be generated during the reprinting process.
"KRN",19,4681,25)
PSDRWK
"KRN",19,4681,"U")
DISPENSING WORKSHEET REPRINT
"KRN",19,4865,-1)
0^33
"KRN",19,4865,0)
PSD ENTER/EDIT MENU^Enter/Edit Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4865,1,0)
^^2^2^2940518^^^^
"KRN",19,4865,1,1,0)
This menu contains the enter/edit options associated with setting up
"KRN",19,4865,1,2,0)
the files for the Controlled Substances module.
"KRN",19,4865,10,0)
^19.01PI^9^8
"KRN",19,4865,10,1,0)
3832^^10
"KRN",19,4865,10,1,"^")
PSD INVEN TYPE EDIT
"KRN",19,4865,10,2,0)
3816^^20
"KRN",19,4865,10,2,"^")
PSD DRUG LOC EDIT
"KRN",19,4865,10,3,0)
3817^^30
"KRN",19,4865,10,3,"^")
PSD NAOU EDIT
"KRN",19,4865,10,4,0)
3818^^40
"KRN",19,4865,10,4,"^")
PSD STOCK DRUG EDIT
"KRN",19,4865,10,5,0)
3823^^50
"KRN",19,4865,10,5,"^")
PSD MFG/LOT/EXP DATE EDIT
"KRN",19,4865,10,6,0)
4091^^60
"KRN",19,4865,10,6,"^")
PSD NARC EDIT
"KRN",19,4865,10,7,0)
4075^^70
"KRN",19,4865,10,7,"^")
PSD NAOU INV GROUP EDIT
"KRN",19,4865,10,9,0)
4019^^5
"KRN",19,4865,10,9,"^")
PSD MARK
"KRN",19,4865,99)
56749,40572
"KRN",19,4865,"U")
ENTER/EDIT MENU
"KRN",19,4866,-1)
0^126
"KRN",19,4866,0)
PSD STOCK UNIT LIST^Breakdown/Dispensing Unit Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,4866,1,0)
^^5^5^2930309^
"KRN",19,4866,1,1,0)
This report provides an alphabetic listing of all active drugs you have
"KRN",19,4866,1,2,0)
defined in the DRUG ACCOUNTABILITY STATS file (#58.8).  This listing
"KRN",19,4866,1,3,0)
includes breakdown unit and package size from the DRUG ACCOUNTABILITY
"KRN",19,4866,1,4,0)
STATS file (#58.8) and dispense unit and price per dispense unit from
"KRN",19,4866,1,5,0)
the DRUG file (#50).
"KRN",19,4866,25)
PSDPDU
"KRN",19,4866,"U")
BREAKDOWN/DISPENSING UNIT REPO
"KRN",19,5123,-1)
0^131
"KRN",19,5123,0)
PSD TRANSFER VAULT DRUGS^Transfer Drugs between Dispensing Sites^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5123,1,0)
^^8^8^2940908^^^^
"KRN",19,5123,1,1,0)
This option is utilized by RPh's to transfer controlled substances
"KRN",19,5123,1,2,0)
between dispensing sites.  The inventory balances are updated within
"KRN",19,5123,1,3,0)
each dispensing site.
"KRN",19,5123,1,4,0)
  
"KRN",19,5123,1,5,0)
When drugs are being transferred from one dispensing site into
"KRN",19,5123,1,6,0)
another, a MailMan message will be generated to the pharmacy
"KRN",19,5123,1,7,0)
supervisor holding the PSDMGR security key, if the receiving dispensing
"KRN",19,5123,1,8,0)
site does not normally stock that particular drug.
"KRN",19,5123,25)
PSDTRV
"KRN",19,5123,"U")
TRANSFER DRUGS BETWEEN DISPENS
"KRN",19,5124,-1)
0^103
"KRN",19,5124,0)
PSD PRINT VAULT TRANSFERS^Transfer Drugs between Dispensing Sites Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5124,1,0)
^^4^4^2950524^^^^
"KRN",19,5124,1,1,0)
This report displays all transactions which transferred Controlled
"KRN",19,5124,1,2,0)
Substances between dispensing sites, for a given period of time. The
"KRN",19,5124,1,3,0)
transactions list within dispensing site, by drug, the date/time transferred,
"KRN",19,5124,1,4,0)
quantity transferred, and pharmacist transferring the drug.
"KRN",19,5124,25)
PSDTRVR
"KRN",19,5124,"U")
TRANSFER DRUGS BETWEEN DISPENS
"KRN",19,5125,-1)
0^8
"KRN",19,5125,0)
PSD CORRECT STATUS^Correct Order Status - GS Ready for Pickup^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5125,1,0)
^^8^8^2930524^^
"KRN",19,5125,1,1,0)
This option allows the pharmacy supervisor access to correct the
"KRN",19,5125,1,2,0)
order status of certain CS orders.  Sometimes nursing may erroneously
"KRN",19,5125,1,3,0)
flag a Green Sheet ready for pharmacy pickup.  Using this option, the
"KRN",19,5125,1,4,0)
pharmacy supervisor may change the Green Sheet order status from
"KRN",19,5125,1,5,0)
COMPLETED - GREEN SHEET READY FOR PICKUP to DELIVERED - ACTIVELY ON
"KRN",19,5125,1,6,0)
NAOU to correct this problem.  An entry in the CS CORRECTION LOG
"KRN",19,5125,1,7,0)
file (#58.87) will be created to log a history of all corrective
"KRN",19,5125,1,8,0)
actions.
"KRN",19,5125,25)
EN1^PSDCOR
"KRN",19,5125,"U")
CORRECT ORDER STATUS - GS READ
"KRN",19,5126,-1)
0^6
"KRN",19,5126,0)
PSD CORRECT EXISTING GS^Existing Green Sheets Correction^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5126,1,0)
^^9^9^2930727^^^
"KRN",19,5126,1,1,0)
This option allows the pharmacy supervisor access to make corrective
"KRN",19,5126,1,2,0)
actions on Controlled Substances orders.  The CS software allows
"KRN",19,5126,1,3,0)
pharmacy to add existing Green Sheets active orders on an NAOU at
"KRN",19,5126,1,4,0)
package setup.  These orders may be tracked using the CS software.
"KRN",19,5126,1,5,0)
Sometimes one of these existing Green Sheets may be incorrectly
"KRN",19,5126,1,6,0)
entered in the software.  Using this option, the pharmacy supervisor
"KRN",19,5126,1,7,0)
may delete this erroneous existing Green Sheet.  An entry in the
"KRN",19,5126,1,8,0)
CS CORRECTION LOG file (#58.87) will be created to log a history
"KRN",19,5126,1,9,0)
of all corrective actions.
"KRN",19,5126,25)
EN2^PSDCOR
"KRN",19,5126,"U")
EXISTING GREEN SHEETS CORRECTI
"KRN",19,5127,-1)
0^19
"KRN",19,5127,0)
PSD DESTROY DEA41^DEA Form 41 Destroyed Drugs Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5127,1,0)
^^2^2^2930727^^
"KRN",19,5127,1,1,0)
This report lists information on destroyed Controlled Substances that
"KRN",19,5127,1,2,0)
is required in completing the DEA Form 41.
"KRN",19,5127,25)
PSDEA41
"KRN",19,5127,"U")
DEA FORM 41 DESTROYED DRUGS RE
"KRN",19,5128,-1)
0^16
"KRN",19,5128,0)
PSD DEST DRUGS REPORT^Destroyed Drugs Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5128,1,0)
^^6^6^2940908^^
"KRN",19,5128,1,1,0)
This report lists, alphabetically by drug, all destroyed controlled
"KRN",19,5128,1,2,0)
substances, within a narcotic dispensing site, for a given period of time.
"KRN",19,5128,1,3,0)
Pharmacy supervisor certifying the destruction, quantity destroyed, and
"KRN",19,5128,1,4,0)
date destroyed are also included on this report. The report may be
"KRN",19,5128,1,5,0)
generated for a single drug, several drugs, or ALL drugs stocked within
"KRN",19,5128,1,6,0)
a specific dispensing site.
"KRN",19,5128,25)
PSDESTP
"KRN",19,5128,99)
56917,58509
"KRN",19,5128,"U")
DESTROYED DRUGS REPORT
"KRN",19,5229,-1)
0^7
"KRN",19,5229,0)
PSD CORRECT GS STATUS^Error on Completed Green Sheets^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5229,1,0)
^^4^4^2930522^
"KRN",19,5229,1,1,0)
This option allows the Pharmacy Supervisor to correct the completed
"KRN",19,5229,1,2,0)
status of a Green Sheet from COMPLETED - REVIEWED to COMPLETED -
"KRN",19,5229,1,3,0)
PENDING PROBLEM RESOLUTION.  An entry in the CS CORRECTION LOG
"KRN",19,5229,1,4,0)
file (#58.87) will be created to track this error.
"KRN",19,5229,25)
EN3^PSDCOR
"KRN",19,5229,"U")
ERROR ON COMPLETED GREEN SHEET
"KRN",19,5685,-1)
0^47
"KRN",19,5685,0)
PSD INFUSION O/E^Infusion Order Entry^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5685,1,0)
^^4^4^2940913^^^
"KRN",19,5685,1,1,0)
The IV pharmacist uses this option to electronically request Controlled
"KRN",19,5685,1,2,0)
Substances drugs used in IV orders. Only infusion orders requiring the VA
"KRN",19,5685,1,3,0)
FORM 10-2638 should be requested using this
"KRN",19,5685,1,4,0)
option.
"KRN",19,5685,25)
PSDORV
"KRN",19,5685,"U")
INFUSION ORDER ENTRY
"KRN",19,5716,-1)
0^1
"KRN",19,5716,0)
PSD AMIS^AMIS Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5716,1,0)
^^2^2^2950516^^^
"KRN",19,5716,1,1,0)
This option provides the pharmacy with AMIS report information by
"KRN",19,5716,1,2,0)
NAOU.
"KRN",19,5716,25)
PSDAMIS
"KRN",19,5716,"U")
AMIS REPORT
"KRN",19,5721,-1)
0^41
"KRN",19,5721,0)
PSD GS LISTING^Listing of Green Sheet Log^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5721,1,0)
^^3^3^2940411^^
"KRN",19,5721,1,1,0)
This option numerically lists all Green Sheets for a given date range or
"KRN",19,5721,1,2,0)
for a given Green Sheet number range.  The logs list Green Sheet number,
"KRN",19,5721,1,3,0)
date dispensed, and current status.
"KRN",19,5721,25)
PSDGSL
"KRN",19,5721,"U")
LISTING OF GREEN SHEET LOG
"KRN",19,5726,-1)
0^64
"KRN",19,5726,0)
PSD LABEL VAULT^Barcode Drug Labels for Vault^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5726,1,0)
^^2^2^2940223^^
"KRN",19,5726,1,1,0)
This option allows pharmacy to print the barcode labels for dispensing
"KRN",19,5726,1,2,0)
site (vault) stocked drugs.
"KRN",19,5726,25)
PSDLBL1
"KRN",19,5726,"U")
BARCODE DRUG LABELS FOR VAULT
"KRN",19,5727,-1)
0^61
"KRN",19,5727,0)
PSD LABEL DRUG/NUMBER^Label for Dispensing (Barcode)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5727,1,0)
^^2^2^2940908^^^
"KRN",19,5727,1,1,0)
This option allows pharmacy to print the dispensing number/drug barcode
"KRN",19,5727,1,2,0)
label that is attached to the drug delivered to the NAOUs.
"KRN",19,5727,25)
PSDLBL
"KRN",19,5727,"U")
LABEL FOR DISPENSING (BARCODE)
"KRN",19,5731,-1)
0^57
"KRN",19,5731,0)
PSD IRL INSPECTOR INV^Load Software and Insp. Inventory into TRAKKER^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5731,1,0)
^^3^3^2940727^^^
"KRN",19,5731,1,1,0)
This option contains the access to download an IRL program to the
"KRN",19,5731,1,2,0)
TRAKKER and download the narcotic inspections inventory to the TRAKKER.
"KRN",19,5731,1,3,0)
This option is used for the narcotic inspectors only.
"KRN",19,5731,25)
PSDUP3
"KRN",19,5731,"U")
LOAD SOFTWARE AND INSP. INVENT
"KRN",19,5732,-1)
0^60
"KRN",19,5732,0)
PSD IRL VAULT INV^Load Software and Inventory into TRAKKER^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5732,1,0)
^^3^3^2940727^^^^
"KRN",19,5732,1,1,0)
This option contains the access to download an IRL program to the
"KRN",19,5732,1,2,0)
TRAKKER and download the vault inventory to the TRAKKER, in one step.
"KRN",19,5732,1,3,0)
This option is used for pharmacy service only.
"KRN",19,5732,25)
PSDUP2
"KRN",19,5732,"U")
LOAD SOFTWARE AND INVENTORY IN
"KRN",19,5733,-1)
0^63
"KRN",19,5733,0)
PSD LABEL PHARM^Print Pharmacist ID Labels^^R^^PSDMGR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5733,1,0)
^^4^4^2930928^
"KRN",19,5733,1,1,0)
This option is restricted to the holders of the PSDMGR security key.
"KRN",19,5733,1,2,0)
This option allows pharmacy supervisors to print the pharmacists
"KRN",19,5733,1,3,0)
barcoded ID label. This label is scanned when pharmacists inventory
"KRN",19,5733,1,4,0)
CS drugs in the dispensing vault.
"KRN",19,5733,25)
PSDLBL3
"KRN",19,5733,"U")
PRINT PHARMACIST ID LABELS
"KRN",19,5734,-1)
0^107
"KRN",19,5734,0)
PSD PRT GS PICKED UP^GS Picked Up Awaiting Pharmacy Review^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5734,1,0)
^^2^2^2931013^
"KRN",19,5734,1,1,0)
This report lists all Green Sheets picked up by pharmacy but still
"KRN",19,5734,1,2,0)
awaiting a pharmacy review.
"KRN",19,5734,25)
PSDCPO
"KRN",19,5734,"U")
GS PICKED UP AWAITING PHARMACY
"KRN",19,5735,-1)
0^46
"KRN",19,5735,0)
PSD INFUSION MENU^Infusion Order Processing Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5735,1,0)
^^3^3^2931014^
"KRN",19,5735,1,1,0)
This menu contains the infusion order/entry and transferring a Green
"KRN",19,5735,1,2,0)
Sheet options associated with the IV pharmacist processing a Controlled
"KRN",19,5735,1,3,0)
Substances infusion order.
"KRN",19,5735,10,0)
^19.01PI^2^2
"KRN",19,5735,10,1,0)
5685^^10
"KRN",19,5735,10,1,"^")
PSD INFUSION O/E
"KRN",19,5735,10,2,0)
4233^^20
"KRN",19,5735,10,2,"^")
PSD NURSE TRANSFER GS
"KRN",19,5735,99)
56749,40572
"KRN",19,5735,"U")
INFUSION ORDER PROCESSING MENU
"KRN",19,5736,-1)
0^21
"KRN",19,5736,0)
PSD DESTROY MENU^Destructions Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5736,1,0)
^^2^2^2931024^^
"KRN",19,5736,1,1,0)
This menu allows pharmacy supervisors to maintain the necessary records
"KRN",19,5736,1,2,0)
when destroying a Controlled Substances drug.
"KRN",19,5736,10,0)
^19.01PI^3^3
"KRN",19,5736,10,1,0)
4223^^30
"KRN",19,5736,10,1,"^")
PSD DESTROY DRUGS
"KRN",19,5736,10,2,0)
5737^^10
"KRN",19,5736,10,2,"^")
PSD DEST NON-CS DRUG
"KRN",19,5736,10,3,0)
5738^^20
"KRN",19,5736,10,3,"^")
PSD DEST TEXT DRUG
"KRN",19,5736,99)
56749,40572
"KRN",19,5736,"U")
DESTRUCTIONS MENU
"KRN",19,5737,-1)
0^17
"KRN",19,5737,0)
PSD DEST NON-CS DRUG^Hold a CS Drug (No Inventory Update)^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5737,1,0)
^^5^5^2940913^^^^
"KRN",19,5737,1,1,0)
This option allows pharmacy supervisors to place a Controlled
"KRN",19,5737,1,2,0)
Substances VA drug, from the DRUG file (#50), on hold for destruction.
"KRN",19,5737,1,3,0)
When using this option, the Controlled Substances inventory balance
"KRN",19,5737,1,4,0)
will not be updated. A CS DESTRUCTION file (#58.86) entry is made and
"KRN",19,5737,1,5,0)
trackable now through the CS software.
"KRN",19,5737,25)
PSDESTO
"KRN",19,5737,"U")
HOLD A CS DRUG (NO INVENTORY U
"KRN",19,5738,-1)
0^18
"KRN",19,5738,0)
PSD DEST TEXT DRUG^Non-VA Drug Placed on Hold for Destruction^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5738,1,0)
^^3^3^2940913^^^
"KRN",19,5738,1,1,0)
This option allows the pharmacy supervisors to place a non-VA drug, not
"KRN",19,5738,1,2,0)
existing in the DRUG file (#50), on hold for destruction.  A CS DESTRUCTION
"KRN",19,5738,1,3,0)
file (#58.86) entry is made and trackable through the CS software.
"KRN",19,5738,25)
PSDESTF
"KRN",19,5738,"U")
NON-VA DRUG PLACED ON HOLD FOR
"KRN",19,5740,-1)
0^87
"KRN",19,5740,0)
PSD NURSE TRANS GS MENU^Transfer Green Sheet Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5740,1,0)
^^2^2^2950524^^^^
"KRN",19,5740,1,1,0)
Use this menu to transfer and receive Green Sheets between
"KRN",19,5740,1,2,0)
NAOUs.
"KRN",19,5740,10,0)
^19.01PI^4^4
"KRN",19,5740,10,1,0)
4233^^5
"KRN",19,5740,10,1,"^")
PSD NURSE TRANSFER GS
"KRN",19,5740,10,2,0)
4234^^10
"KRN",19,5740,10,2,"^")
PSD NURSE REC TRANSFER GS
"KRN",19,5740,10,3,0)
4281^^15
"KRN",19,5740,10,3,"^")
PSD NURSE REPRINT 2321
"KRN",19,5740,10,4,0)
4237^^20
"KRN",19,5740,10,4,"^")
PSD GS TRANS NOT RECD (NAOU)
"KRN",19,5740,99)
56749,40572
"KRN",19,5740,"U")
TRANSFER GREEN SHEET MENU
"KRN",19,5798,-1)
0^35
"KRN",19,5798,0)
PSD ERR/ADJ PENDING REPORT^List Pending Errors/Adjustments Logged by TRAKKER^^R^^PSD ERROR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5798,1,0)
^^2^2^2940819^^^
"KRN",19,5798,1,1,0)
This option lists all pending errors/adjustments logged from the barcode
"KRN",19,5798,1,2,0)
TRAKKER for a specific Dispensing Site within a given time frame.
"KRN",19,5798,25)
PSDERP
"KRN",19,5798,"U")
LIST PENDING ERRORS/ADJUSTMENT
"KRN",19,5799,-1)
0^36
"KRN",19,5799,0)
PSD ERR/ADJ RESOLVED REPORT^Print Resolved Errors/Adjustments Log^^R^^PSD ERROR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5799,1,0)
^^3^3^2940819^^^^
"KRN",19,5799,1,1,0)
This report prints a listing of all resolved errors/adjustments logged
"KRN",19,5799,1,2,0)
by the barcode TRAKKER for a specific Dispensing Site within a
"KRN",19,5799,1,3,0)
given time frame.
"KRN",19,5799,25)
PSDERCP
"KRN",19,5799,"U")
PRINT RESOLVED ERRORS/ADJUSTME
"KRN",19,5800,-1)
0^11
"KRN",19,5800,0)
PSD COST REPORTS^Cost Reports^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5800,1,0)
^^2^2^2931109^
"KRN",19,5800,1,1,0)
This option provides pharmacy cost reporting data for Controlled Substances
"KRN",19,5800,1,2,0)
drugs, by NAOU, for a specified date range.
"KRN",19,5800,25)
PSDCOST
"KRN",19,5800,"U")
COST REPORTS
"KRN",19,5801,-1)
0^51
"KRN",19,5801,0)
PSD INSPECTOR MENU^Controlled Substances Inspector Menu^^M^^^^^^^^CONTROLLED SUBSTANCES^^1^1
"KRN",19,5801,1,0)
^^2^2^2970114^^^^
"KRN",19,5801,1,1,0)
This menu contains all options associated with a Controlled
"KRN",19,5801,1,2,0)
Substances inspection.
"KRN",19,5801,10,0)
^19.01PI^11^11
"KRN",19,5801,10,2,0)
5802^^20
"KRN",19,5801,10,2,"^")
PSD INSP PLACE HOLD
"KRN",19,5801,10,3,0)
5803^^30
"KRN",19,5801,10,3,"^")
PSD INSP REMOVE HOLD
"KRN",19,5801,10,4,0)
4193^^5
"KRN",19,5801,10,4,"^")
PSD PRINT INSPECTOR LOG
"KRN",19,5801,10,6,0)
5804^^45
"KRN",19,5801,10,6,"^")
PSD PRT GS INSP HOLD
"KRN",19,5801,10,7,0)
4180^^7
"KRN",19,5801,10,7,"^")
PSD INVEN SHEET PRT
"KRN",19,5801,10,8,0)
6343^^6
"KRN",19,5801,10,8,"^")
PSD INSP LOG BY RECD DATE
"KRN",19,5801,10,9,0)
6347^^10
"KRN",19,5801,10,9,"^")
PSD IRL INSP MENU
"KRN",19,5801,10,10,0)
4226^^50
"KRN",19,5801,10,10,"^")
PSD GS HISTORY
"KRN",19,5801,10,11,0)
7346^^5
"KRN",19,5801,10,11,"^")
PSD NAOU BALANCE REPORT
"KRN",19,5801,15)
K PSDSITE
"KRN",19,5801,20)
I '$D(PSDSITE) D ^PSDSET
"KRN",19,5801,99)
56796,54354
"KRN",19,5801,99.1)
56321,36874
"KRN",19,5801,"U")
CONTROLLED SUBSTANCES INSPECTO
"KRN",19,5802,-1)
0^49
"KRN",19,5802,0)
PSD INSP PLACE HOLD^Place Green Sheet on Hold^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5802,1,0)
^^2^2^2931110^
"KRN",19,5802,1,1,0)
This option allows the Controlled Substances Inspector to place a
"KRN",19,5802,1,2,0)
Green Sheet on hold for review.
"KRN",19,5802,25)
PSDCSI
"KRN",19,5802,"U")
PLACE GREEN SHEET ON HOLD
"KRN",19,5803,-1)
0^50
"KRN",19,5803,0)
PSD INSP REMOVE HOLD^Remove Green Sheet from Hold^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5803,1,0)
^^2^2^2931110^
"KRN",19,5803,1,1,0)
This option allows the Controlled Substances Inspector to remove
"KRN",19,5803,1,2,0)
a Green Sheet from hold.
"KRN",19,5803,25)
PSDRSI
"KRN",19,5803,"U")
REMOVE GREEN SHEET FROM HOLD
"KRN",19,5804,-1)
0^106
"KRN",19,5804,0)
PSD PRT GS INSP HOLD^Under Inspector's Review - Green Sheets^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5804,1,0)
^^2^2^2931110^
"KRN",19,5804,1,1,0)
This report lists all Green Sheets placed on hold for review by
"KRN",19,5804,1,2,0)
a Controlled Substances Inspector.
"KRN",19,5804,25)
PSDPSI
"KRN",19,5804,"U")
UNDER INSPECTOR'S REVIEW - GRE
"KRN",19,5805,-1)
0^62
"KRN",19,5805,0)
PSD LABEL INSP^Inspectors Label Print^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5805,1,0)
^^2^2^2940113^^^^
"KRN",19,5805,1,1,0)
This option allows the inspector or pharmacy supervisor to print the CS
"KRN",19,5805,1,2,0)
Inspector's barcode labels.
"KRN",19,5805,25)
PSDLBLI
"KRN",19,5805,"U")
INSPECTORS LABEL PRINT
"KRN",19,5806,-1)
0^34
"KRN",19,5806,0)
PSD ERR/ADJ EDIT^Enter Error/Adjustment Resolution^^R^^PSD ERROR^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5806,1,0)
^^3^3^2940819^^^
"KRN",19,5806,1,1,0)
This option allows designated pharmacy supervisors the ability to
"KRN",19,5806,1,2,0)
enter a resolution comment for each error or adjustment created
"KRN",19,5806,1,3,0)
when using the barcode TRAKKER.
"KRN",19,5806,25)
PSDERD
"KRN",19,5806,"U")
ENTER ERROR/ADJUSTMENT RESOLUT
"KRN",19,5810,-1)
0^2
"KRN",19,5810,0)
PSD BALANCE ADJUSTMENT REVIEW^Balance Adjustment Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5810,1,0)
^^2^2^2931215^
"KRN",19,5810,1,1,0)
This report allows the selection of drugs and a date range for which
"KRN",19,5810,1,2,0)
to review all balance adjustments.
"KRN",19,5810,25)
PSDADJD
"KRN",19,5810,"U")
BALANCE ADJUSTMENT REPORT
"KRN",19,5811,-1)
0^117
"KRN",19,5811,0)
PSD REPRINT LABEL^Label Reprint for Dispensing Drug^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,5811,1,0)
^^2^2^2931216^
"KRN",19,5811,1,1,0)
This option provides pharmacy the tools to reprint Controlled
"KRN",19,5811,1,2,0)
Substances dispensing drug labels.
"KRN",19,5811,25)
PSDLBLR
"KRN",19,5811,"U")
LABEL REPRINT FOR DISPENSING D
"KRN",19,6343,-1)
0^48
"KRN",19,6343,0)
PSD INSP LOG BY RECD DATE^Inspector's Log by Rec'd Date^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6343,1,0)
^^5^5^2940630^
"KRN",19,6343,1,1,0)
This report lists all dispensing transactions for Narcotic Area of
"KRN",19,6343,1,2,0)
Use received within a given date range.  The data includes dispensing
"KRN",19,6343,1,3,0)
number, drug name, date received, quantity received, expiration date
"KRN",19,6343,1,4,0)
(if available), blanks for quantity on hand, and a signature blank for
"KRN",19,6343,1,5,0)
verification.
"KRN",19,6343,25)
PSDRLOG
"KRN",19,6343,"U")
INSPECTOR'S LOG BY REC'D DATE
"KRN",19,6344,-1)
0^59
"KRN",19,6344,0)
PSD IRL INV MENU^Barcode TRAKKER for Inventory^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6344,1,0)
^^2^2^2940727^^^
"KRN",19,6344,1,1,0)
This menu contains the options associated with performing narcotic
"KRN",19,6344,1,2,0)
vault inventories using the barcode TRAKKER device.
"KRN",19,6344,10,0)
^19.01PI^2^2
"KRN",19,6344,10,1,0)
5732^^10
"KRN",19,6344,10,1,"^")
PSD IRL VAULT INV
"KRN",19,6344,10,2,0)
6345^^20
"KRN",19,6344,10,2,"^")
PSD IRL INV DATA
"KRN",19,6344,99)
56749,40572
"KRN",19,6344,"U")
BARCODE TRAKKER FOR INVENTORY
"KRN",19,6345,-1)
0^58
"KRN",19,6345,0)
PSD IRL INV DATA^Send Vault TRAKKER Inventory Data to DHCP^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6345,1,0)
^^2^2^2940727^^
"KRN",19,6345,1,1,0)
This option contains the access to upload or send vault inventory from
"KRN",19,6345,1,2,0)
the barcode TRAKKER to DHCP.
"KRN",19,6345,25)
UPLOAD^PSDUP2
"KRN",19,6345,"U")
SEND VAULT TRAKKER INVENTORY D
"KRN",19,6346,-1)
0^55
"KRN",19,6346,0)
PSD IRL INSP DATA^Send Inspections Inventory TRAKKER Data to DHCP^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6346,1,0)
^^2^2^2940727^^
"KRN",19,6346,1,1,0)
This option contains the access to upload or send narcotic vault
"KRN",19,6346,1,2,0)
inspections inventory from the barcode TRAKKER to DHCP.
"KRN",19,6346,25)
UPLOAD^PSDUP3
"KRN",19,6346,"U")
SEND INSPECTIONS INVENTORY TRA
"KRN",19,6347,-1)
0^56
"KRN",19,6347,0)
PSD IRL INSP MENU^Barcode TRAKKER for CS Inspections^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6347,1,0)
^^2^2^2940727^
"KRN",19,6347,1,1,0)
This menu contains the options associated with performing narcotic
"KRN",19,6347,1,2,0)
vault inspections using the barcode TRAKKER device.
"KRN",19,6347,10,0)
^19.01PI^2^2
"KRN",19,6347,10,1,0)
5731^^10
"KRN",19,6347,10,1,"^")
PSD IRL INSPECTOR INV
"KRN",19,6347,10,2,0)
6346^^20
"KRN",19,6347,10,2,"^")
PSD IRL INSP DATA
"KRN",19,6347,99)
56749,40572
"KRN",19,6347,"U")
BARCODE TRAKKER FOR CS INSPECT
"KRN",19,6348,-1)
0^120
"KRN",19,6348,0)
PSD RX DISPENSING REPORT^Rx (Prescription) Outpatient Dispensing Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6348,1,0)
^^2^2^2940727^
"KRN",19,6348,1,1,0)
A report sorted by drug, prescription number, or inventory type for a
"KRN",19,6348,1,2,0)
date range of outpatient dispensing.
"KRN",19,6348,25)
PSDOPTR
"KRN",19,6348,"U")
RX (PRESCRIPTION) OUTPATIENT D
"KRN",19,6864,-1)
0^32
"KRN",19,6864,0)
PSD EMERGENCY ORDER REPORT^Unscheduled Order Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6864,1,0)
^^1^1^2950522^^
"KRN",19,6864,1,1,0)
A report to show by drug or by NAOU a list of unscheduled orders.
"KRN",19,6864,25)
PSDEM
"KRN",19,6864,99)
56867,31236
"KRN",19,6864,"U")
UNSCHEDULED ORDER REPORT
"KRN",19,6904,-1)
0^83
"KRN",19,6904,0)
PSD NURSE PRIORITY ORDER CHECK^Check on Priority Orders^^R^^^PSD ORDER ENTRY PRIORITY^^^^^CONTROLLED SUBSTANCES
"KRN",19,6904,1,0)
^^2^2^2950426^
"KRN",19,6904,1,1,0)
This option will check the status of Priority Orders that Pharmacy
"KRN",19,6904,1,2,0)
has filled today for a selected NAOU.
"KRN",19,6904,25)
PSDEM4
"KRN",19,6904,"U")
CHECK ON PRIORITY ORDERS
"KRN",19,6905,-1)
0^81
"KRN",19,6905,0)
PSD NURSE HELP^Help Online^^R^^^PSD NURSE^^^^^CONTROLLED SUBSTANCES
"KRN",19,6905,1,0)
^^1^1^2950510^
"KRN",19,6905,1,1,0)
Use this option to view or print online help.
"KRN",19,6905,25)
PSDHELP
"KRN",19,6905,"U")
HELP ONLINE
"KRN",19,6913,-1)
0^90
"KRN",19,6913,0)
PSD ON-HAND TECH^List On-Hand Amounts^^R^^PSD TECH^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6913,1,0)
^^3^3^2950523^
"KRN",19,6913,1,1,0)
This option lists current on-hand amounts for drugs stocked in
"KRN",19,6913,1,2,0)
a pharmacy dispensing site (vault).  The drugs may be selected by one,
"KRN",19,6913,1,3,0)
some or ALL.  The drugs are listed alphabetically.
"KRN",19,6913,25)
PSDBAL
"KRN",19,6913,"U")
LIST ON-HAND AMOUNTS
"KRN",19,6914,-1)
0^14
"KRN",19,6914,0)
PSD DAILY LOG TECH^Daily Activity Log (in lieu of VA FORM 10-2320)^^R^^PSD TECH^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6914,1,0)
^^4^4^2950524^
"KRN",19,6914,1,1,0)
The Daily Activity Log lists all transactions for a Controlled
"KRN",19,6914,1,2,0)
Substances dispensing site (vault).  It includes a forwarding balance
"KRN",19,6914,1,3,0)
on each transaction.  This document may be generated for a single drug,
"KRN",19,6914,1,4,0)
some drugs, or ALL drugs with a specified date range.
"KRN",19,6914,25)
PSDACT
"KRN",19,6914,"U")
DAILY ACTIVITY LOG (IN LIEU OF
"KRN",19,6915,-1)
0^104
"KRN",19,6915,0)
PSD PRINT VAULT TRANSFERS TECH^Transfer Drugs between Dispensing Sites Report^^R^^PSD TECH^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6915,1,0)
^^4^4^2950524^^
"KRN",19,6915,1,1,0)
This report displays all transactions which transferred Controlled
"KRN",19,6915,1,2,0)
Substances between dispensing sites, for a given period of time.
"KRN",19,6915,1,3,0)
The transactions list within dispensing site, by drug, the date/time
"KRN",19,6915,1,4,0)
transferred, quantity transferred, and pharmacist transferring.
"KRN",19,6915,25)
PSDTRVR
"KRN",19,6915,"U")
TRANSFER DRUGS BETWEEN DISPENS
"KRN",19,6916,-1)
0^79
"KRN",19,6916,0)
PSD NOT DELIVERED NURSE^Orders Filled Not Delivered^^R^^PSJ RNURSE^^^^^^CONTROLLED SUBSTANCES
"KRN",19,6916,1,0)
^^4^4^2950606^
"KRN",19,6916,1,1,0)
This option generates a list of all Controlled Substances
"KRN",19,6916,1,2,0)
orders filled from the pharmacy dispensing site (vault) but not yet
"KRN",19,6916,1,3,0)
delivered to the NAOUs.  A summary total sorted by drug is also
"KRN",19,6916,1,4,0)
generated.
"KRN",19,6916,25)
PSDFND
"KRN",19,6916,"U")
ORDERS FILLED NOT DELIVERED
"KRN",19,7245,-1)
0^80
"KRN",19,7245,0)
PSD NURSE DISPENSING^Sign Out Dose for Patient^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7245,1,0)
^^1^1^2961001^^^
"KRN",19,7245,1,1,0)
This option is designed for signing out doses via a radio frequency device.
"KRN",19,7245,25)
PSDRF
"KRN",19,7245,99)
56588,37689
"KRN",19,7245,"U")
SIGN OUT DOSE FOR PATIENT
"KRN",19,7270,-1)
0^139
"KRN",19,7270,0)
PSD NURSE DISP MENU^Sign Out Menu^^M^^^PSD NURSE DISPENSING^^^^^CONTROLLED SUBSTANCES^^1^1
"KRN",19,7270,1,0)
^^1^1^2961001^^^^
"KRN",19,7270,1,1,0)
This is a menu to assist nurses in tracking doses signed out for patients.
"KRN",19,7270,10,0)
^19.01IP^9^8
"KRN",19,7270,10,1,0)
7245^^10
"KRN",19,7270,10,1,"^")
PSD NURSE DISPENSING
"KRN",19,7270,10,2,0)
7271^^30
"KRN",19,7270,10,2,"^")
PSD PAT ID LIST
"KRN",19,7270,10,4,0)
7273^^20
"KRN",19,7270,10,4,"^")
PSD NURSE DISP REPORT
"KRN",19,7270,10,7,0)
7347^^50
"KRN",19,7270,10,7,"^")
PSD NURSE WASTE
"KRN",19,7270,10,8,0)
7351^^60
"KRN",19,7270,10,8,"^")
PSD NURSE NOT GIVEN
"KRN",19,7270,10,9,0)
7998^^60
"KRN",19,7270,10,9,"^")
PSD NURSE DEFECTIVE DOSE
"KRN",19,7270,15)
K NAOU,NAOUN
"KRN",19,7270,20)
D ^PSDRFD
"KRN",19,7270,99)
56887,41868
"KRN",19,7270,"U")
SIGN OUT MENU
"KRN",19,7271,-1)
0^144
"KRN",19,7271,0)
PSD PAT ID LIST^Patient ID List Print^^R^^^^^^^^
"KRN",19,7271,1,0)
^^1^1^2960216^
"KRN",19,7271,1,1,0)
This option supports the printing of barcode labels for patient ID.
"KRN",19,7271,25)
PSDLBLP
"KRN",19,7271,"U")
PATIENT ID LIST PRINT
"KRN",19,7272,-1)
0^138
"KRN",19,7272,0)
PSD NAOU BAL INITIAL^Initialize NAOU Drug Balance^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7272,1,0)
^^1^1^2960216^
"KRN",19,7272,1,1,0)
This option may be used to establish beginning balances for drugs.
"KRN",19,7272,25)
PSDADJIN
"KRN",19,7272,"U")
INITIALIZE NAOU DRUG BALANCE
"KRN",19,7273,-1)
0^140
"KRN",19,7273,0)
PSD NURSE DISP REPORT^Activity Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7273,1,0)
^^1^1^2960328^^
"KRN",19,7273,1,1,0)
This option provides a detailed and summary listing of activity.
"KRN",19,7273,25)
PSDPAT
"KRN",19,7273,99)
56665,54245
"KRN",19,7273,"U")
ACTIVITY REPORT
"KRN",19,7274,-1)
0^143
"KRN",19,7274,0)
PSD NURSE SUPR MENU^Nursing Supervisor Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7274,1,0)
^^2^2^2961007^^^^
"KRN",19,7274,1,1,0)
This is a menu with special options to support the signing out of
"KRN",19,7274,1,2,0)
Controlled Substances.
"KRN",19,7274,10,0)
^19.01IP^7^7
"KRN",19,7274,10,1,0)
7272^^10
"KRN",19,7274,10,1,"^")
PSD NAOU BAL INITIAL
"KRN",19,7274,10,2,0)
7275^^20
"KRN",19,7274,10,2,"^")
PSD NAOU ADJ
"KRN",19,7274,10,3,0)
7276^^30
"KRN",19,7274,10,3,"^")
PSD PAT INQUIRY
"KRN",19,7274,10,4,0)
6864^^40
"KRN",19,7274,10,4,"^")
PSD EMERGENCY ORDER REPORT
"KRN",19,7274,10,5,0)
4235^^50
"KRN",19,7274,10,5,"^")
PSD EXP REPORT
"KRN",19,7274,10,6,0)
7271^^5
"KRN",19,7274,10,6,"^")
PSD PAT ID LIST
"KRN",19,7274,10,7,0)
8240^^15
"KRN",19,7274,10,7,"^")
PSD NURSE DELAYED DISPENSE
"KRN",19,7274,99)
56893,47611
"KRN",19,7274,"U")
NURSING SUPERVISOR MENU
"KRN",19,7275,-1)
0^137
"KRN",19,7275,0)
PSD NAOU ADJ^Balance Adjustments - NAOU^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7275,1,0)
^^1^1^2960220^
"KRN",19,7275,1,1,0)
This option may be used to adjust the balance of controlled substances.
"KRN",19,7275,25)
PSDADJN
"KRN",19,7275,"U")
BALANCE ADJUSTMENTS - NAOU
"KRN",19,7276,-1)
0^145
"KRN",19,7276,0)
PSD PAT INQUIRY^Patient/Location Inquiry^^R^^^^^^^^
"KRN",19,7276,1,0)
^^1^1^2960220^
"KRN",19,7276,1,1,0)
This option may be used to verify the location of a patient.
"KRN",19,7276,25)
PSDPATI
"KRN",19,7276,"U")
PATIENT/LOCATION INQUIRY
"KRN",19,7277,-1)
0^142
"KRN",19,7277,0)
PSD NURSE ORDER MENU^Ordering Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7277,1,0)
^^1^1^2960822^^^
"KRN",19,7277,1,1,0)
This menu contains options for ordering and checking on orders.
"KRN",19,7277,10,0)
^19.01IP^5^5
"KRN",19,7277,10,1,0)
4185^^10
"KRN",19,7277,10,1,"^")
PSD ORDER ENTRY
"KRN",19,7277,10,2,0)
4204^^20
"KRN",19,7277,10,2,"^")
PSD PEND NAOU ORDERS
"KRN",19,7277,10,3,0)
6916^^30
"KRN",19,7277,10,3,"^")
PSD NOT DELIVERED NURSE
"KRN",19,7277,10,4,0)
6904^^40
"KRN",19,7277,10,4,"^")
PSD NURSE PRIORITY ORDER CHECK
"KRN",19,7277,10,5,0)
7997^^15
"KRN",19,7277,10,5,"^")
PSD NURSE INFUSION
"KRN",19,7277,99)
56866,62230
"KRN",19,7277,"U")
ORDERING MENU
"KRN",19,7278,-1)
0^141
"KRN",19,7278,0)
PSD NURSE GS MENU^Green Sheet Menu^^M^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7278,1,0)
^^1^1^2960221^
"KRN",19,7278,1,1,0)
This menu contains options for handling green sheets.
"KRN",19,7278,10,0)
^19.01IP^4^4
"KRN",19,7278,10,1,0)
4186^^10
"KRN",19,7278,10,1,"^")
PSD REC GS
"KRN",19,7278,10,2,0)
4202^^20
"KRN",19,7278,10,2,"^")
PSD READY GS FOR PICKUP
"KRN",19,7278,10,3,0)
4226^^30
"KRN",19,7278,10,3,"^")
PSD GS HISTORY
"KRN",19,7278,10,4,0)
5740^^40
"KRN",19,7278,10,4,"^")
PSD NURSE TRANS GS MENU
"KRN",19,7278,99)
56749,40572
"KRN",19,7278,"U")
GREEN SHEET MENU
"KRN",19,7279,-1)
0^136
"KRN",19,7279,0)
PSD DISPENSE TO NDES^Narcotic Dispensing Equipment Orders^^R^^^^^^^^
"KRN",19,7279,1,0)
^^2^2^2960221^
"KRN",19,7279,1,1,0)
This option is for dispensing from Pharmacy to narcotic dispensing
"KRN",19,7279,1,2,0)
equipment systems.
"KRN",19,7279,25)
PSDNDES
"KRN",19,7279,99)
56669,34076
"KRN",19,7279,"U")
NARCOTIC DISPENSING EQUIPMENT 
"KRN",19,7346,-1)
0^147
"KRN",19,7346,0)
PSD NAOU BALANCE REPORT^Narcotic Count - Shift Report^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7346,1,0)
^^1^1^2960327^
"KRN",19,7346,1,1,0)
This report will show the balance for one or all drugs on a ward.
"KRN",19,7346,25)
PSDBAN
"KRN",19,7346,"U")
NARCOTIC COUNT - SHIFT REPORT
"KRN",19,7347,-1)
0^148
"KRN",19,7347,0)
PSD NURSE WASTE^Record Delayed Wastage^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7347,1,0)
^^1^1^2960423^
"KRN",19,7347,1,1,0)
This option can be used when a dispensed dose needs to be wasted.
"KRN",19,7347,25)
PSDRFW
"KRN",19,7347,"U")
RECORD DELAYED WASTAGE
"KRN",19,7351,-1)
0^149
"KRN",19,7351,0)
PSD NURSE NOT GIVEN^Not Given, Return to Stock^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7351,1,0)
^^3^3^2960516^
"KRN",19,7351,1,1,0)
This option may be used when a dose is not given to a patient and must
"KRN",19,7351,1,2,0)
be returned to stock.  This option must be used within one hour of the
"KRN",19,7351,1,3,0)
last dispensed dose by the nurse that dispensed that dose.
"KRN",19,7351,25)
PSDRFR
"KRN",19,7351,"U")
NOT GIVEN, RETURN TO STOCK
"KRN",19,7997,-1)
0^151
"KRN",19,7997,0)
PSD NURSE INFUSION^Infusion or PCA Syringe Order Entry For Patient^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,7997,1,0)
^^2^2^2960822^
"KRN",19,7997,1,1,0)
This option is for ordering an infusion or PCA syringe for a
"KRN",19,7997,1,2,0)
specific patient.
"KRN",19,7997,25)
PSDORNV
"KRN",19,7997,"U")
INFUSION OR PCA SYRINGE ORDER 
"KRN",19,7998,-1)
0^150
"KRN",19,7998,0)
PSD NURSE DEFECTIVE DOSE^Record Defective Dose^^R^^^^^^^^PHARMACY
"KRN",19,7998,1,0)
^^2^2^2960822^
"KRN",19,7998,1,1,0)
When a nurse discovers a damaged drug that cannot be dispensed to a
"KRN",19,7998,1,2,0)
patient, this option may be used to record the wasting.
"KRN",19,7998,25)
PSDRF4
"KRN",19,7998,"U")
RECORD DEFECTIVE DOSE
"KRN",19,8239,-1)
0^152
"KRN",19,8239,0)
PSD NURSE ONLINE COUNT^Verify Count^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,8239,1,0)
^^1^1^2960930^
"KRN",19,8239,1,1,0)
This option may be used to verify and correct balances.
"KRN",19,8239,25)
PSDADJC
"KRN",19,8239,"U")
VERIFY COUNT
"KRN",19,8240,-1)
0^153
"KRN",19,8240,0)
PSD NURSE DELAYED DISPENSE^Delayed Sign Out Dose for Patient^^R^^^^^^^^CONTROLLED SUBSTANCES
"KRN",19,8240,1,0)
^^2^2^2961007^
"KRN",19,8240,1,1,0)
This option may be used when there is computer down time and it
"KRN",19,8240,1,2,0)
is necessary to sign out doses that were already given to patients.
"KRN",19,8240,25)
PSDRFS
"KRN",19,8240,"U")
DELAYED SIGN OUT DOSE FOR PATI
"KRN",19.1,141,-1)
0^6
"KRN",19.1,141,0)
PSDMGR
"KRN",19.1,141,1,0)
^^4^4^2940926^^^^
"KRN",19.1,141,1,1,0)
This key locks the supervisor portion of the Controlled Substances
"KRN",19.1,141,1,2,0)
package.  This key should be given to the Pharmacy Package Coordinator
"KRN",19.1,141,1,3,0)
or his/her designees.  Also, any pharmacist who is allowed to build,
"KRN",19.1,141,1,4,0)
enter, or edit CS files should be given this key.
"KRN",19.1,153,-1)
0^5
"KRN",19.1,153,0)
PSD TRAN
"KRN",19.1,153,1,0)
^^3^3^2941027^^^
"KRN",19.1,153,1,1,0)
This key controls the menu option to TRANSFER STOCK ENTRIES.  This
"KRN",19.1,153,1,2,0)
key should only be allocated to the pharmacy supervisors who maintain
"KRN",19.1,153,1,3,0)
the narcotic vaults.
"KRN",19.1,154,-1)
0^3
"KRN",19.1,154,0)
PSD PARAM
"KRN",19.1,154,1,0)
^^4^4^2940926^^
"KRN",19.1,154,1,1,0)
This key should be allocated to the Inpatient Pharmacy Package Coordinator.
"KRN",19.1,154,1,2,0)
The key locks the Controlled Substance Site Parameters.  One of these
"KRN",19.1,154,1,3,0)
parameters controls the range of Pharmacy Dispensing numbers for
"KRN",19.1,154,1,4,0)
narcotics - thus the need for security.
"KRN",19.1,167,-1)
0^2
"KRN",19.1,167,0)
PSD NURSE
"KRN",19.1,167,1,0)
^^3^3^2950523^^^^
"KRN",19.1,167,1,1,0)
This key will allow nurses to receive Controlled Substances drugs,
"KRN",19.1,167,1,2,0)
transfer Controlled Substances drugs, and mark the Controlled
"KRN",19.1,167,1,3,0)
Substance Administration Record, VA FORM 10-2638, as complete.
"KRN",19.1,183,-1)
0^1
"KRN",19.1,183,0)
PSD ERROR
"KRN",19.1,183,1,0)
^^7^7^2940820^^^^
"KRN",19.1,183,1,1,0)
This security key controls options used in the Controlled Substances
"KRN",19.1,183,1,2,0)
software.  Pharmacy personnel holders, usually supervisors, utilize these
"KRN",19.1,183,1,3,0)
options to view reports listing various error and exception conditions
"KRN",19.1,183,1,4,0)
generated by using the barcode TRAKKER.  This barcode TRAKKER is used by
"KRN",19.1,183,1,5,0)
pharmacy to maintain a perpetual inventory within the narcotic vault.
"KRN",19.1,183,1,6,0)
Narcotic inspectors also utilize the TRAKKER for inspection inventories
"KRN",19.1,183,1,7,0)
performed within the pharmacy vault.
"KRN",19.1,183,3,0)
^19.13P
"KRN",19.1,211,-1)
0^4
"KRN",19.1,211,0)
PSD TECH^Pharmacy Technician
"KRN",19.1,211,1,0)
^^3^3^2960227^^
"KRN",19.1,211,1,1,0)
This key will give access to the List On-Hand Amounts, Transfer Drugs
"KRN",19.1,211,1,2,0)
between Dispensing Sites Report, and the Daily Activity Log options
"KRN",19.1,211,1,3,0)
on the Pharmacy Technician Menu.
"KRN",101,46,-1)
2^9
"KRN",101,46,0)
DGPM MOVEMENT EVENTS^MOVEMENT EVENTS v 5.0^^X^^^^^^^^REGISTRATION
"KRN",101,46,1,0)
32^^32^32^2950227^^
"KRN",101,46,1,1,0)
 At the completion of a patient movement the following events
"KRN",101,46,1,2,0)
 take place through this option:
"KRN",101,46,1,3,0)
 
"KRN",101,46,1,4,0)
 1. The PTF record is updated when a patient is admitted,
"KRN",101,46,1,5,0)
    discharged or transfered.
"KRN",101,46,1,6,0)
 
"KRN",101,46,1,7,0)
 2. The appointment status for a patient is updated to 'inpatient'
"KRN",101,46,1,8,0)
    for admissions and 'outpatient' for discharges.  Admissions
"KRN",101,46,1,9,0)
    to the domicilliary have an 'outpatient' appointment status.
"KRN",101,46,1,10,0)
 
"KRN",101,46,1,11,0)
 3. When a patient is admitted, dietetics creates a dietetic
"KRN",101,46,1,12,0)
    patient file entry and creates an admission diet order.
"KRN",101,46,1,13,0)
    When a patient is discharged, all active diet
"KRN",101,46,1,14,0)
    orders are discontinued.  If a patient is absent or on
"KRN",101,46,1,15,0)
    pass, the diet orders are suspended.
"KRN",101,46,1,16,0)
 
"KRN",101,46,1,17,0)
 4. Inpatient Pharmacy cancels all active orders when a
"KRN",101,46,1,18,0)
    patient is admitted, discharged or on unauthorized absence.
"KRN",101,46,1,19,0)
    A patient can not be given Unit Dose meds unless s/he is
"KRN",101,46,1,20,0)
    admitted to a ward.  The patient can receive IV meds; however.
"KRN",101,46,1,21,0)
    When a patient is transferred, an inpatient system parameter
"KRN",101,46,1,22,0)
    is used to determine whether or not the orders should be
"KRN",101,46,1,23,0)
    cancelled.  When a patient goes on authorized absence, the
"KRN",101,46,1,24,0)
    inpatient system parameter is used to determine whether the
"KRN",101,46,1,25,0)
    orders should be cancelled, placed on hold or no action taken.
"KRN",101,46,1,26,0)
    When a patient returns from authorized absence any orders
"KRN",101,46,1,27,0)
    placed on hold will no longer be on hold.
"KRN",101,46,1,28,0)
 
"KRN",101,46,1,29,0)
 5. With ORDER ENTRY/RESULTS REPORTING v2.2, 
"KRN",101,46,1,30,0)
    MAS OE/RR NOTIFICATIONS may be displayed to
"KRN",101,46,1,31,0)
    USERS defined in an OE/RR LIST for the patient. These notifications are
"KRN",101,46,1,32,0)
    displayed for admissions and death discharges.
"KRN",101,46,5)
1697;DIC(19,
"KRN",101,46,10,0)
^101.01PA^19^19
"KRN",101,46,10,13,0)
988^^^
"KRN",101,46,10,13,"^")
PSD PAT ADT
"KRN",101,46,99)
56944,36129
"KRN",101,988,-1)
0^10
"KRN",101,988,0)
PSD PAT ADT^^^A^^^^^^^^
"KRN",101,988,20)
D ^PSDADT1
"KRN",101,1071,-1)
3^2
"KRN",101,1071,0)
PSD A01 SERVER^Controlled Substances admit (A01) server^^E^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1071,1,0)
^^1^1^2960329^^^^
"KRN",101,1071,1,1,0)
Triggered by the DGPM MOVEMENT DRIVER, this protocol serves admissions.
"KRN",101,1071,10,0)
^101.01PA^1^1
"KRN",101,1071,10,1,0)
1072^^^
"KRN",101,1071,10,1,"^")
PSD A01 CLIENT
"KRN",101,1071,99)
56749,40524
"KRN",101,1071,770)
PSD-CS^^ADT^A01^^P^^^^2.1^
"KRN",101,1071,772)
Q
"KRN",101,1072,-1)
0^1
"KRN",101,1072,0)
PSD A01 CLIENT^Controlled Substances admit client^^S^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1072,1,0)
^^1^1^2961231^^^^
"KRN",101,1072,1,1,0)
Delivers admit (A01) messages to narcotic dispensing equipment systems.
"KRN",101,1072,99)
56749,40524
"KRN",101,1072,770)
^PSD-NDES^ACK^A01^^P^PSD HLLP^^^2.1^ADT
"KRN",101,1072,773)
^^^
"KRN",101,1073,-1)
3^4
"KRN",101,1073,0)
PSD A02 SERVER^Controlled Substances transfer (A02) server^^E^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1073,1,0)
^^1^1^2960329^^^
"KRN",101,1073,1,1,0)
Triggered by the DGPM MOVEMENT DRIVER, it serves admissions.
"KRN",101,1073,10,0)
^101.01PA^1^1
"KRN",101,1073,10,1,0)
1074^^^
"KRN",101,1073,10,1,"^")
PSD A02 CLIENT
"KRN",101,1073,99)
56749,40524
"KRN",101,1073,770)
PSD-CS^^ADT^A02^^P^^^^2.1^
"KRN",101,1073,772)
Q
"KRN",101,1074,-1)
0^3
"KRN",101,1074,0)
PSD A02 CLIENT^Controlled Substances transfer (A02) client^^S^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1074,1,0)
^^1^1^2960329^^^^
"KRN",101,1074,1,1,0)
Delivers transfers (A02) to narcotic dispensing equipment systems.
"KRN",101,1074,99)
56749,40524
"KRN",101,1074,770)
^PSD-NDES^ACK^A02^^P^PSD HLLP^^^2.1^ADT
"KRN",101,1074,773)
^^^
"KRN",101,1075,-1)
3^6
"KRN",101,1075,0)
PSD A03 SERVER^Controlled Substances discharge (A03) server^^E^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1075,1,0)
^^1^1^2960329^^^
"KRN",101,1075,1,1,0)
Triggered by the DGPM MOVEMENT DRIVER, it serves discharges.
"KRN",101,1075,10,0)
^101.01PA^1^1
"KRN",101,1075,10,1,0)
1076^^^
"KRN",101,1075,10,1,"^")
PSD A03 CLIENT
"KRN",101,1075,99)
56749,40524
"KRN",101,1075,770)
PSD-CS^^ADT^A03^^P^^^^2.1^
"KRN",101,1075,772)
Q
"KRN",101,1076,-1)
0^5
"KRN",101,1076,0)
PSD A03 CLIENT^Controlled Substances discharge (A03) client^^S^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1076,1,0)
^^1^1^2960329^^^^
"KRN",101,1076,1,1,0)
Delivers discharges to narcotic dispensing equipment systems
"KRN",101,1076,99)
56749,40524
"KRN",101,1076,770)
^PSD-NDES^ACK^A03^^P^PSD HLLP^^^2.1^ADT
"KRN",101,1076,773)
^^^
"KRN",101,1077,-1)
3^8
"KRN",101,1077,0)
PSD DFT SERVER^DFT messages record dispensing activity.^^E^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1077,1,0)
^^2^2^2960329^^
"KRN",101,1077,1,1,0)
These messages record dispensing activity as it occurs at narcotic
"KRN",101,1077,1,2,0)
dispensing equipment systems.
"KRN",101,1077,10,0)
^101.01PA^1^1
"KRN",101,1077,10,1,0)
1078^^^
"KRN",101,1077,10,1,"^")
PSD DFT CLIENT
"KRN",101,1077,99)
56749,40524
"KRN",101,1077,770)
PSD-NDES^^DFT^P03^^P^^^^2.1^
"KRN",101,1078,-1)
0^7
"KRN",101,1078,0)
PSD DFT CLIENT^Receives DFT messages from narcotic dispensing equipment.^^S^^^^^^^^CONTROLLED SUBSTANCES
"KRN",101,1078,1,0)
^^2^2^2960329^^^^
"KRN",101,1078,1,1,0)
Records dispensing activity when it occurs at narcotic dispensing
"KRN",101,1078,1,2,0)
equipment systems.
"KRN",101,1078,99)
56749,40524
"KRN",101,1078,770)
^PSD-CS^DFT^P03^i^P^PSD HLLP^^^2.1^ACK
"KRN",101,1078,771)
D ^PSDFT1
"KRN",101,1078,773)
1^1^^1
"KRN",409.61,147,-1)
1^1
"KRN",409.61,147,0)
PSD ORDER ENTRY
"KRN",771,2,-1)
0^1
"KRN",771,2,0)
PSD-CS^a^^
"KRN",771,2,"EC")
^~\&
"KRN",771,2,"FS")
|
"KRN",771,2,"MSG",0)
^771.06P^1^1
"KRN",771,2,"MSG",1,0)
ADD
"KRN",771,2,"MSG",1,"R")
PSDFT
"KRN",771,4,-1)
0^2
"KRN",771,4,0)
PSD-NDES^a^PSD-NDES^
"KRN",869.2,1,-1)
0^3
"KRN",869.2,1,0)
PSD-NDES X3.28^X3.28
"KRN",869.2,1,300)
^^^^^^^13^01^02^23^03^04^05^60^16^21^48^49^50^51^52^53^54^55
"KRN",869.2,2,-1)
0^2
"KRN",869.2,2,0)
PSD-NDES MAILMAN^MAILMAN
"KRN",869.2,2,100)
LTL HL7
"KRN",869.2,3,-1)
0^1
"KRN",869.2,3,0)
PSD-NDES HLLP^HLLP
"KRN",869.2,3,200)
^^^^^^^21
"KRN",870,1,-1)
0^3
"KRN",870,1,0)
PSD X3.28^^PSD-NDES X3.28^^^^^^^^^^^^^^^^^^
"KRN",870,2,-1)
0^2
"KRN",870,2,0)
PSD MM^^PSD-NDES MAILMAN^^^^^^^^^^^^^^^^^^
"KRN",870,3,-1)
0^1
"KRN",870,3,0)
PSD HLLP^^PSD-NDES HLLP^^^^^^^^^^^^^^^^^^
"OER",155,0)
155^PSD
"OER",155,1,0)
^100.9951PA^1^1
"OER",155,1,1,0)
988
"OER",155,1,1,1,0)
^100.99511PA^1^1
"OER",155,1,1,1,1,0)
46
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",1,9.2)
9.2;1;;;HELP^XPDTA1;HLPF1^XPDIA1;HLPE1^XPDIA1;HLPF2^XPDIA1;;HLPDEL^XPDIA1
"ORD",1,9.2,0)
HELP FRAME
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",12,869.2)
869.2;12;1;;HLLLP^XPDTA1;;HLLLPE^XPDIA1
"ORD",12,869.2,0)
HL LOWER LEVEL PROTOCOL PARAMETER
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",155,-1)
1^1
"PKG",155,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",155,1,0)
^^3^3^2960306^^^^
"PKG",155,1,1,0)
The Controlled Substances module provides functionality to monitor
"PKG",155,1,2,0)
and track the receipt, inventory, and dispensing of all controlled
"PKG",155,1,3,0)
substances.
"PKG",155,5)
BIRMINGHAM
"PKG",155,7)
BIRMINGHAM
"PKG",155,20,0)
^9.402P^^
"PKG",155,22,0)
^9.49I^1^1
"PKG",155,22,1,0)
3.0^2970213
"PKG",155,22,1,1,0)
^^22^22^2970224
"PKG",155,22,1,1,1,0)
     The Controlled Substances software will monitor and track the receipt,
"PKG",155,22,1,1,2,0)
inventory, and dispensing of controlled substances.  Automation of the
"PKG",155,22,1,1,3,0)
narcotic inventory process will permit pharmacists and inspectors to
"PKG",155,22,1,1,4,0)
perform vault inventories utilizing portable bar code readers.  Monthly (or
"PKG",155,22,1,1,5,0)
more frequent) inspections can be conducted by management, with
"PKG",155,22,1,1,6,0)
discrepancies in stock levels automatically identified.  This software
"PKG",155,22,1,1,7,0)
package addresses a Congressional material weakness for Drug
"PKG",155,22,1,1,8,0)
Accountability.
"PKG",155,22,1,1,9,0)
 
"PKG",155,22,1,1,10,0)
NEW FUNCTIONS
"PKG",155,22,1,1,11,0)
 
"PKG",155,22,1,1,12,0)
o Batch Order Entry process
"PKG",155,22,1,1,13,0)
 
"PKG",155,22,1,1,14,0)
o Electronic Signature
"PKG",155,22,1,1,15,0)
 
"PKG",155,22,1,1,16,0)
o Nurse Dispensing with a Radio Frequency Device
"PKG",155,22,1,1,17,0)
 
"PKG",155,22,1,1,18,0)
o HL7 Interface to Narcotic Dispensing Equipment
"PKG",155,22,1,1,19,0)
 
"PKG",155,22,1,1,20,0)
o Electronic Error & Enhancement Requests (E3Rs)
"PKG",155,22,1,1,21,0)
 
"PKG",155,22,1,1,22,0)
o Other Enhancements
"PKG",155,"DEV")
JANET WASHINGTON/B'HAM ISC
"PKG",155,"VERSION")
3.0
"PRE")
PSDINPRE
"QUES","POS1",0)
Y
"QUES","POS1","?")
you can simply D ^PSDHL7 when you're ready.
"QUES","POS1","?",1)
          Interface to Narcotic Dispensing Equipment Systems
"QUES","POS1","?",2)
 
"QUES","POS1","?",3)
     Version 3.0 of the Controlled Substances package uses the HL7 package
"QUES","POS1","?",4)
to provide a generic interface to Narcotic Dispensing Equipment Systems
"QUES","POS1","?",5)
(NDES).  HL7 or Health Level Seven is a standard protocol which specifies
"QUES","POS1","?",6)
the implementation of interfaces between two computer applications (sender
"QUES","POS1","?",7)
and receiver) from different vendors for electronic data exchange in
"QUES","POS1","?",8)
health care environments.  If your Pharmacy service is using an NDES such
"QUES","POS1","?",9)
as Access, Meditrol, Pyxis, or Suremed you may wish to set up the
"QUES","POS1","?",10)
interface.  This will be accomplished by adding entries to the HL7
"QUES","POS1","?",11)
APPLICATION PARAMETER (#771), HL LOWER LEVEL PROTOCOL PARAMETER (#869.2),
"QUES","POS1","?",12)
and HL LOGICAL LINK (#870) files.  You will be asked to identify an HL7
"QUES","POS1","?",13)
device which must exist as entry in your DEVICE file (#3.5).
"QUES","POS1","?",14)
 
"QUES","POS1","?",15)
     The PSDHLK routine is invoked by the Controlled Substances post-init.
"QUES","POS1","?",16)
The routine, PSDHL7 is also independantly invokable at any time that a site
"QUES","POS1","?",17)
needs to set up their interface for narcotic dispensing equipment systems.
"QUES","POS1","?",18)
 
"QUES","POS1","?",19)
     If you do NOT want to perform this step at the time of the post-init,
"QUES","POS1","A")
for Narcotic Dispensing Equipment Systems
"QUES","POS1","A",1)
Do you want to enter edit your interface setup
"QUES","POS1","B")
No
"QUES","POS2",0)
S^H:Hybrid Lower Layer Protocol;X:X3.28 Protocol
"QUES","POS2","?")
Select the protocol that your Pharmacy's narcotic dispensing equipment system vendor will use for communication.
"QUES","POS2","A")
Select a communications protocol
"QUES","POS2","B")
H
"QUES","POS2","M")
K:$G(XPDQUES("POS1"))'=1 DIR
"QUES","POS3",0)
869.2,300.01
"QUES","POS3","M")
K:$G(XPDQUES("POS2"))'="X"!($G(XPDQUES("POS1"))'=1) DIR
"QUES","POS4",0)
869.2,200.01
"QUES","POS4","M")
K:$G(XPDQUES("POS2"))'="H"!($G(XPDQUES("POS1"))'=1) DIR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
286
"RTN","PSDACT")
0^1^B13617205
"RTN","PSDACT",1,0)
PSDACT ;BIR/JPW-Print Daily Activity Log ; 8 Aug 94
"RTN","PSDACT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDACT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDACT",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ))&('$D(^XUSEC("PSD TECH",DUZ))) W !!,"Contact your Pharmacy Coordinator for access to display the daily CS activity.",!!,"PSJ RPHARM or PSD TECH security key required.",! Q
"RTN","PSDACT",5,0)
ASKD ;ask disp location
"RTN","PSDACT",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDACT",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDACT",8,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDACT",9,0)
 S DIC("A")="Select Primary Dispensing Site: "
"RTN","PSDACT",10,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDACT",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDACT",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDACT",13,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDACT",14,0)
DRUG ;ask drug
"RTN","PSDACT",15,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDACT",16,0)
 W ! K DA,DIC
"RTN","PSDACT",17,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDACT",18,0)
 .S PSDRG(+Y)=""
"RTN","PSDACT",19,0)
 I '$D(PSDRG)&(X'="^ALL") G END
"RTN","PSDACT",20,0)
 I X="^ALL" S ALL=1
"RTN","PSDACT",21,0)
DATE W ! K %DT S %DT="AETX",%DT("A")="Start with Date: " D ^%DT I Y<0 G END
"RTN","PSDACT",22,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 G END
"RTN","PSDACT",23,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDACT",24,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.00001
"RTN","PSDACT",25,0)
 S:'$P(PSDED,".",2) PSDED=PSDED+.99999
"RTN","PSDACT",26,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDACT",27,0)
DEV ;sel device
"RTN","PSDACT",28,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDACT",29,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !!,"NO DEVICE SELECTED OR REPORT PRINTED!!",! G END
"RTN","PSDACT",30,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S PSDIO=ION,ZTIO="",ZTRTN="START^PSDACT1",ZTDESC="CS PHARM Compile Daily Activity Log" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDACT",31,0)
 U IO G START^PSDACT1
"RTN","PSDACT",32,0)
END ;
"RTN","PSDACT",33,0)
 D KVAR^VADPT
"RTN","PSDACT",34,0)
 K %,%DT,%H,%I,%ZIS,ACT,ALL,BFWD,C,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,MFG,NAOU,NODE,NQTY,NUM
"RTN","PSDACT",35,0)
 K PAT,PG,PHARM,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDIO,PSDOUT,PSDPN,PSDR,PSDRG,PSDRGN,PSDS,PSDSD,PSDSN,PSDUZ,PSDUZN,RX,TEXT,TYP,QTY,TYPE,X,Y,VA("BID"),VA("PID")
"RTN","PSDACT",36,0)
 K ^TMP("PSDACT",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDACT",37,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDACT",38,0)
 Q
"RTN","PSDACT",39,0)
SAVE ;sets variables for queueing
"RTN","PSDACT",40,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDIO"))=""
"RTN","PSDACT",41,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDRG) ZTSAVE("PSDRG(")=""
"RTN","PSDACT",42,0)
 Q
"RTN","PSDACT1")
0^2^B21498088
"RTN","PSDACT1",1,0)
PSDACT1 ;BIR/JPW-Print Daily Activity Log (cont'd) ; 29 Aug 94
"RTN","PSDACT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDACT1",3,0)
START ;entry for compile
"RTN","PSDACT1",4,0)
 K ^TMP("PSDACT",$J)
"RTN","PSDACT1",5,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^PSD(58.8,+PSDS,1,PSDR)) Q:'PSDR  I $D(^PSD(58.8,+PSDS,1,PSDR,0)) S PSDRG(+PSDR)=""
"RTN","PSDACT1",6,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD!(PSD>PSDED)  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR)) Q:'PSDR  D
"RTN","PSDACT1",7,0)
 .Q:'$D(PSDRG(PSDR))
"RTN","PSDACT1",8,0)
 .F TYP=0:0 S TYP=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR,TYP)) Q:'TYP!(TYP=12)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR,TYP,PSDA)) Q:'PSDA  D SET
"RTN","PSDACT1",9,0)
 G:$D(ZTQUEUED) PRTQUE G PRINT^PSDACT2
"RTN","PSDACT1",10,0)
END ;
"RTN","PSDACT1",11,0)
 D KVAR^VADPT
"RTN","PSDACT1",12,0)
 K %,%DT,%H,%I,%ZIS,ACT,ALL,BFWD,C,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,MFG,NAOU,NODE,NQTY,NUM
"RTN","PSDACT1",13,0)
 K PAT,PG,PHARM,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDIO,PSDOUT,PSDPN,PSDR,PSDRG,PSDRGN,PSDS,PSDSD,PSDSN,PSDUZ,PSDUZN,RX,TEXT,TYP,QTY,TYPE,X,Y,VA("BID"),VA("PID")
"RTN","PSDACT1",14,0)
 K ^TMP("PSDACT",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDACT1",15,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDACT1",16,0)
 Q
"RTN","PSDACT1",17,0)
SET ;sets data
"RTN","PSDACT1",18,0)
 Q:'$D(^PSD(58.81,PSDA,0))  Q:TYP=5  S NODE=^(0),QTY=$P(NODE,"^",6),BFWD=$P(NODE,"^",10)
"RTN","PSDACT1",19,0)
 S PSDRGN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR_" NAME MISSING")
"RTN","PSDACT1",20,0)
 S PSDUZ=$S(TYP=3:+$P($G(^PSD(58.81,PSDA,1)),"^",14),TYP=4:+$P($G(^PSD(58.81,PSDA,1)),"^",14),TYP=13:+$P($G(^PSD(58.81,PSDA,5)),"^",2),TYP=14:+$P($G(^PSD(58.81,PSDA,4)),"^",2),1:+$P(NODE,"^",7))
"RTN","PSDACT1",21,0)
 S:TYP=2 PSDUZ=$S(+$P($G(^PSD(58.81,PSDA,1)),"^"):+$P($G(^(1)),"^"),1:+$P(NODE,"^",7))
"RTN","PSDACT1",22,0)
 S PSDUZN=$P($G(^VA(200,+PSDUZ,0)),"^"),PSDUZN=$S(PSDUZN]"":$E($P(PSDUZN,",",2))_$E(PSDUZN),1:"**")
"RTN","PSDACT1",23,0)
 I TYP=1 D T1 G TMP
"RTN","PSDACT1",24,0)
 I TYP=2 D T2 G TMP
"RTN","PSDACT1",25,0)
 I TYP=3 Q:'$D(^PSD(58.81,PSDA,3))  D T3 G TMP
"RTN","PSDACT1",26,0)
 Q:TYP=4
"RTN","PSDACT1",27,0)
 I TYP=6 Q:'$D(^PSD(58.81,PSDA,6))  D T6 G TMP
"RTN","PSDACT1",28,0)
 I TYP=7 D T7 G TMP
"RTN","PSDACT1",29,0)
 I TYP=9 D T9 G TMP
"RTN","PSDACT1",30,0)
 I TYP=11 D T11 G TMP
"RTN","PSDACT1",31,0)
 I TYP=13 Q:'$D(^PSD(58.81,PSDA,5))  D T13 G TMP
"RTN","PSDACT1",32,0)
 I TYP=14 Q:'$D(^PSD(58.81,PSDA,4))  D T14 G TMP
"RTN","PSDACT1",33,0)
 I TYP=16 D T16 G TMP
"RTN","PSDACT1",34,0)
 I TYP>18 D TOTH
"RTN","PSDACT1",35,0)
TMP ;
"RTN","PSDACT1",36,0)
 S PSDUZN=$P($G(^VA(200,+PSDUZ,0)),"^"),PSDUZN=$S(PSDUZN]"":$E($P(PSDUZN,",",2))_$E(PSDUZN),1:"**")
"RTN","PSDACT1",37,0)
 S ^TMP("PSDACT",$J,PSDRGN,PSD,TYP,PSDA)=BFWD_"^"_NUM_"^"_TEXT_"^"_QTY_"^"_PSDUZN
"RTN","PSDACT1",38,0)
 Q
"RTN","PSDACT1",39,0)
T1 S NUM="***",TEXT="RECEIPT INTO PHARMACY"
"RTN","PSDACT1",40,0)
 I $P($G(^PSD(58.81,PSDA,8)),"^")]"" S NUM=$P($G(^PSD(58.81,PSDA,8)),"^") Q
"RTN","PSDACT1",41,0)
 I +$P(NODE,"^",9) S NUM=+$P(NODE,"^",9),NUM=$P($G(^PRC(442,NUM,0)),"^") Q
"RTN","PSDACT1",42,0)
 I +$P(NODE,"^",8) S NUM=+$P(NODE,"^",8),NUM=$P($G(^PRCS(410,NUM,0)),"^") Q
"RTN","PSDACT1",43,0)
 Q
"RTN","PSDACT1",44,0)
T2 S QTY=-QTY,NUM="DISP",NAOU=+$P(NODE,"^",18) S:NAOU NAOU=$P($G(^PSD(58.8,+NAOU,0)),"^") S TEXT=$S(NAOU]"":NAOU,1:"DISPENSED FROM PHARMACY")
"RTN","PSDACT1",45,0)
 I +$P(NODE,"^",17) S NUM="GS # "_$P(NODE,"^",17)
"RTN","PSDACT1",46,0)
 Q
"RTN","PSDACT1",47,0)
T3 S NUM="GS # ",TEXT="RETURNED TO STOCK"
"RTN","PSDACT1",48,0)
 I +$P(NODE,"^",17) S NUM=NUM_$P(NODE,"^",17)
"RTN","PSDACT1",49,0)
 S QTY=$P(^PSD(58.81,PSDA,3),"^",2),BFWD=$P(^(3),"^",7)
"RTN","PSDACT1",50,0)
 Q
"RTN","PSDACT1",51,0)
T6 S QTY=-QTY,NUM="RX # ",TEXT="OUTPATIENT RX" N RXNUM
"RTN","PSDACT1",52,0)
 S RX=+$P(^PSD(58.81,PSDA,6),"^"),RXNUM=$S($P(^(6),"^",5)]"":$P(^(6),"^",5),$P($G(^PSRX(RX,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),NUM=NUM_RXNUM
"RTN","PSDACT1",53,0)
 S NUM=NUM_" ("_$S($P($G(^PSD(58.81,PSDA,6)),U,2):"R"_$P($G(^(6)),U,2),$P($G(^(6)),U,4):"P"_$P($G(^(6)),U,4),1:"O")_")"
"RTN","PSDACT1",54,0)
 S PAT=+$P($G(^PSRX(RX,0)),"^",2)
"RTN","PSDACT1",55,0)
 S TEXT=$S('$O(^PSRX("B",RXNUM,0)):"RX DELETED",$P($G(^PSRX(RX,0)),"^",15)=13:"RX DELETED",1:"UNKNOWN")
"RTN","PSDACT1",56,0)
 I PAT S DFN=PAT D PID^VADPT6 D
"RTN","PSDACT1",57,0)
 .K C S Y=PAT,C=$P(^DD(58.81,73,0),"^",2) D Y^DIQ S TEXT=Y_" ("_VA("BID")_")" K DFN,VA("BID"),VA("PID")
"RTN","PSDACT1",58,0)
 Q
"RTN","PSDACT1",59,0)
T7 S NUM="GS # ",TEXT="CANCEL UNVERIFIED ORDER",QTY=0
"RTN","PSDACT1",60,0)
 I +$P(NODE,"^",17) S NUM=NUM_$P(NODE,"^",17)
"RTN","PSDACT1",61,0)
 Q
"RTN","PSDACT1",62,0)
T9 S NUM="ADJ",TEXT=$S($D(^PSD(58.81,+PSDA,9)):$P(NODE,"^",16),1:"ADJUSTMENT")
"RTN","PSDACT1",63,0)
 I $P(NODE,"^",16)]"" S TEXT=$P(NODE,"^",16)
"RTN","PSDACT1",64,0)
 I $D(^PSD(58.81,PSDA,3)) S NUM="DEST # "_$P(^(3),"^",8),TEXT="HOLDING FOR DESTRUCTION"
"RTN","PSDACT1",65,0)
 Q
"RTN","PSDACT1",66,0)
T11 S NUM="***",TEXT="INITIALIZE BALANCE AT SETUP"
"RTN","PSDACT1",67,0)
 Q
"RTN","PSDACT1",68,0)
T13 S NUM="GS # ",TEXT="CANCEL VERIFIED ORDER"
"RTN","PSDACT1",69,0)
 I +$P(NODE,"^",17) S NUM=NUM_$P(NODE,"^",17)
"RTN","PSDACT1",70,0)
 S QTY=$P(^PSD(58.81,PSDA,5),"^",3),BFWD=$P(^(5),"^",5)
"RTN","PSDACT1",71,0)
 Q
"RTN","PSDACT1",72,0)
T14 S NUM="GS # ",TEXT="EDIT VERIFIED ORDER"
"RTN","PSDACT1",73,0)
 I +$P(NODE,"^",17) S NUM=NUM_$P(NODE,"^",17)
"RTN","PSDACT1",74,0)
 S QTY=$P(^PSD(58.81,PSDA,4),"^",4),BFWD=$P(^(4),"^",7)
"RTN","PSDACT1",75,0)
 Q
"RTN","PSDACT1",76,0)
T16 S NUM="TRV",TEXT="TRANSFER TO VAULT"
"RTN","PSDACT1",77,0)
 Q
"RTN","PSDACT1",78,0)
TOTH ;Type = 19,20,21,22
"RTN","PSDACT1",79,0)
 S NUM="INV",TEXT=$G(^PSD(58.84,+TYP,0)),QTY=""
"RTN","PSDACT1",80,0)
 Q
"RTN","PSDACT1",81,0)
PRTQUE ;queues print after compile
"RTN","PSDACT1",82,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDACT2",ZTDESC="CS PHARM Print Daily Activity Log",ZTDTH=$H,ZTSAVE("^TMP(""PSDACT"",$J,")="",ZTSAVE("PSDSN")="",ZTSAVE("PSDATE")=""
"RTN","PSDACT1",83,0)
 D ^%ZTLOAD K ZTSK G END
"RTN","PSDACT2")
0^3^B8308425
"RTN","PSDACT2",1,0)
PSDACT2 ;BIR/JPW-Print Daily Activity Log (cont'd) ; 2 Aug 94
"RTN","PSDACT2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDACT2",3,0)
PRINT ;prints data
"RTN","PSDACT2",4,0)
 K LN S (CNT,FLAG,PG,PSDOUT)=0,$P(LN,"-",132)=""
"RTN","PSDACT2",5,0)
 I '$D(^TMP("PSDACT",$J)) D HDR W !!,?15,"**** NO DAILY ACTIVITY ****",!! G DONE
"RTN","PSDACT2",6,0)
 S PSDRG="" F  S PSDRG=$O(^TMP("PSDACT",$J,PSDRG)) Q:PSDRG=""!(PSDOUT)  S PG=0 D PAGE Q:PSDOUT  D HDR Q:PSDOUT  S CNT=1 W !,?5,"=> ",PSDRG F PSD=0:0 S PSD=$O(^TMP("PSDACT",$J,PSDRG,PSD)) Q:'PSD!(PSDOUT)  D
"RTN","PSDACT2",7,0)
 .F TYP=0:0 S TYP=$O(^TMP("PSDACT",$J,PSDRG,PSD,TYP)) Q:'TYP!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^TMP("PSDACT",$J,PSDRG,PSD,TYP,PSDA)) Q:'PSDA!(PSDOUT)  S NODE=^TMP("PSDACT",$J,PSDRG,PSD,TYP,PSDA) D
"RTN","PSDACT2",8,0)
 ..W:CNT ?115,$P(NODE,"^"),!! S CNT=0,FLAG=1
"RTN","PSDACT2",9,0)
 ..I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSDRG,?115,$P(NODE,"^")
"RTN","PSDACT2",10,0)
 ..S Y=PSD X ^DD("DD") S DATE=Y
"RTN","PSDACT2",11,0)
 ..W !,DATE,?22,$P(NODE,"^",2),?45,$P(NODE,"^",3),?95,$J($P(NODE,"^",4),6),?115,$P(NODE,"^")+$P(NODE,"^",4),?128,$P(NODE,"^",5)
"RTN","PSDACT2",12,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDACT2",13,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDACT2",14,0)
END ;
"RTN","PSDACT2",15,0)
 D KVAR^VADPT
"RTN","PSDACT2",16,0)
 K %,%DT,%H,%I,%ZIS,ACT,ALL,BFWD,C,CNT,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,FLAG,LN,MFG,NAOU,NODE,NQTY,NUM
"RTN","PSDACT2",17,0)
 K PAT,PG,PHARM,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDIO,PSDOUT,PSDPN,PSDR,PSDRG,PSDRGN,PSDS,PSDSD,PSDSN,PSDUZ,PSDUZN,RX,TEXT,TYP,QTY,TYP,TYPE,X,Y,VA("BID"),VA("PID")
"RTN","PSDACT2",18,0)
 K ^TMP("PSDACT",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDACT2",19,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDACT2",20,0)
 Q
"RTN","PSDACT2",21,0)
HDR ;header
"RTN","PSDACT2",22,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDACT2",23,0)
 S PG=PG+1 W:$Y @IOF W !,?20,"Daily Activity Log for ",PSDSN,?115,"Page: ",PG,!,?20,"Date: ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDACT2",24,0)
 W "DATE/TIME",?22,"NUMBER",?45,"TYPE OF ACTIVITY",?95,"QUANTITY",?115,"BALANCE",?128,"BY",!,LN,!!
"RTN","PSDACT2",25,0)
 Q
"RTN","PSDACT2",26,0)
PAGE ;page stop after each drug
"RTN","PSDACT2",27,0)
 I $E(IOST,1,2)="C-",FLAG W !! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDACT2",28,0)
 Q
"RTN","PSDADJ")
0^4^B19414634
"RTN","PSDADJ",1,0)
PSDADJ ;BIR/LTL-Adjustments ; 8 Aug 94
"RTN","PSDADJ",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJ",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDADJ",4,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W !!,"Sorry, you need the PSDMGR Security key to do adjustments.",!! G QUIT
"RTN","PSDADJ",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G QUIT
"RTN","PSDADJ",6,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSDAT,PSDB,PSDEX,PSDLOC,PSDLOCN,DA,PSDRUG,PSDRUGN,PSDOK,PSDS,PSAQ,PSDR,PSDREC,PSDT,X,Y,%,%H,%I
"RTN","PSDADJ",7,0)
 S DIR(0)="Y",DIR("A")="Review",DIR("B")="No",DIR("?")="If you answer yes, you will be shown all adjustments performed within               a selected time range." D ^DIR K DIR G:$D(DIRUT) QUIT G:Y=1 ^PSDADJR
"RTN","PSDADJ",8,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDADJ",9,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDADJ",10,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDADJ",11,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDADJ",12,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDADJ",13,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT
"RTN","PSDADJ",14,0)
 S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJ",15,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDADJ",16,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDADJ",17,0)
 N X,X1 D SIG^XUSESIG I X1="" G QUIT
"RTN","PSDADJ",18,0)
 F  S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC W ! D ^DIC K DIC G:Y<1 QUIT D  G:$D(DIRUT) QUIT D:$D(PSDEX) DEST^PSDGSRV1 K PSDEX
"RTN","PSDADJ",19,0)
 .S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U)
"RTN","PSDADJ",20,0)
 .S PSAQ=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDADJ",21,0)
 .W !!,"Current Balance: ",PSAQ,?40
"RTN","PSDADJ",22,0)
 .W "Breakdown Unit: ",$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,8),!
"RTN","PSDADJ",23,0)
 .S DIR(0)="N^"_-PSAQ_":999999:2" S DIR("A")="Enter adjustment quantity (with '-' if negative)" D ^DIR K DIR Q:$D(DIRUT)
"RTN","PSDADJ",24,0)
 .S PSDREC=Y
"RTN","PSDADJ",25,0)
 .S DIR(0)="F^1:45",DIR("A")="Please enter reason for adjustment" W ! D ^DIR K DIR Q:$D(DIRUT)  S PSDR=Y
"RTN","PSDADJ",26,0)
POST .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="Answer 'YES' to adjust your inventory balance, 'NO' or '^' to quit." W ! D ^DIR K DIR D:Y=1  K PSDRUG Q
"RTN","PSDADJ",27,0)
 ..W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDADJ",28,0)
 ..F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDADJ",29,0)
 ..D NOW^%DTC S PSDAT=+%
"RTN","PSDADJ",30,0)
 ..S PSAQ=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDADJ",31,0)
 ..S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSAQ
"RTN","PSDADJ",32,0)
 ..L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDADJ",33,0)
MON ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDADJ",34,0)
 ..I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDADJ",35,0)
 ..S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="7////^S X=$P($G(^(0)),U,5)+PSDREC" D ^DIE
"RTN","PSDADJ",36,0)
 ..W !,"Updating monthly adjustments and transaction history.",!
"RTN","PSDADJ",37,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDADJ",38,0)
FIND ..S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDADJ",39,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDADJ",40,0)
 ..S DIE="^PSD(58.81,",DA=PSDT,DR="1////9;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;9////^S X=PSAQ;15////^S X=PSDR;100////1" D ^DIE K DIE
"RTN","PSDADJ",41,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDADJ",42,0)
 ..S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDADJ",43,0)
 ..S (X,DINUM)=PSDT
"RTN","PSDADJ",44,0)
 ..S DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,PSDRUG S Y=1
"RTN","PSDADJ",45,0)
 ..I PSDREC<0 S DIR(0)="Y",DIR("A")="To be destroyed",DIR("B")="No" D ^DIR K DIR I Y=1 S PSDEX=1,PSDA=PSDT,PSDOK=1
"RTN","PSDADJ",46,0)
QUIT Q
"RTN","PSDADJB")
0^5^B3953559
"RTN","PSDADJB",1,0)
PSDADJB ;BIR/LTL-Review Adjustment Transactions for a Drug; 2 Nov 94 [ 05/01/95  3:11 PM ]
"RTN","PSDADJB",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJB",3,0)
START ;compiles and prints output
"RTN","PSDADJB",4,0)
 S PSDTI="Adjustments from "_PSDTB(2)_" to "_PSDTB(3)
"RTN","PSDADJB",5,0)
 N PSDR,PG S PSDT=PSDTB,CNT=0 S $P(LN,"-",81)=""
"RTN","PSDADJB",6,0)
LOOP F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) Q:'PSDT!(PSDT>PSDTB(1))  I $O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC S PSDT(1)=$O(^PSD(58.81,"ACT",PSDT,PSDLOC,0)) I $D(PSDA(+PSDT(1))),$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDT(1),9,0)) D
"RTN","PSDADJB",7,0)
 .S PSDR(2)=$G(^PSD(58.81,+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDT(1),9,0)),0))
"RTN","PSDADJB",8,0)
 .S CNT=$G(CNT)+1,^TMP("PSD",$J,CNT)=LN
"RTN","PSDADJB",9,0)
 .S CNT=$G(CNT)+1,^TMP("PSD",$J,CNT)=PSDA(+PSDT(1))
"RTN","PSDADJB",10,0)
 .S Y=$E($P(PSDR(2),U,4),1,12),CNT=$G(CNT)+1 X ^DD("DD") S ^TMP("PSD",$J,CNT)=Y_"  "_" -> "_$P(PSDR(2),U,6)_" adjusted by "_$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U)
"RTN","PSDADJB",11,0)
 .S CNT=$G(CNT)+1,^TMP("PSD",$J,CNT)="Reason:  "_$P(PSDR(2),U,16)
"RTN","PSDADJB",12,0)
 D BROWSE^DDBR("^TMP(""PSD"",$J)","NR",PSDTI)
"RTN","PSDADJB",13,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJB",14,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJB",15,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJB",16,0)
 K ^TMP("PSD",$J) Q
"RTN","PSDADJC")
0^486^B20537546
"RTN","PSDADJC",1,0)
PSDADJC ;B'ham ISC/LTL,JPW - Balance Shift Checker for NAOU ; 16 Feb 94
"RTN","PSDADJC",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJC",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDADJC",4,0)
 N D1,D2,DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,NODE,PSAC,PSDAT,PSDLOC,PSDOUT,PSDLOCN,DA,PSDRUG,PSDRUGN,PSDS,PSDPKG,PSDBKU,PSAQ,PSDR,PSDREC,PSDT,X,Y,%,%H,%I
"RTN","PSDADJC",5,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEMQZ",DIC("A")="Select NAOU: ",DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""N"",'$P(^(0),""^"",7),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDADJC",6,0)
 W ! D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT
"RTN","PSDADJC",7,0)
 S PSDLOC=+Y,(NAOUN,PSDLOCN)=$P(Y,U,2),PSDS=+$P(Y(0),"^",4)
"RTN","PSDADJC",8,0)
 I '+$P($G(^PSD(58.8,PSDLOC,2)),"^",5) W !!,"This NAOU does not maintain a perpetual inventory balance to check.",!! K PSDLOC,PSDLOCN,PSDS G LOOK
"RTN","PSDADJC",9,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDADJC",10,0)
WIT W ! S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDADJC",11,0)
 I NUR2=DUZ W !!,"Wait a second, you can't witness yourself!",$C(7) G WIT
"RTN","PSDADJC",12,0)
 G:NUR2'>0 QUIT
"RTN","PSDADJC",13,0)
 W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDADJC",14,0)
 W !!,"Give me a second to alphabetize.",!
"RTN","PSDADJC",15,0)
 S PSDRUG=0,PSDRUGN=""
"RTN","PSDADJC",16,0)
 F  S PSDRUG=$O(^PSD(58.8,PSDLOC,1,PSDRUG)) Q:'PSDRUG  D
"RTN","PSDADJC",17,0)
 .Q:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,0))!($P($G(^PSDRUG(+PSDRUG,0)),"^")']"")!('$P($G(^PSD(58.8,+PSDLOC,1,PSDRUG,0)),U,4))
"RTN","PSDADJC",18,0)
 .S PSDPKG=$P($G(^PSD(58.8,+PSDS,1,+PSDRUG,0)),"^",9),PSDBKU=$P($G(^(0)),"^",8)
"RTN","PSDADJC",19,0)
 .S ^TMP("PSDB",$J,$P($G(^PSDRUG(+PSDRUG,0)),U),PSDRUG)=PSDPKG_"^"_PSDBKU K Y
"RTN","PSDADJC",20,0)
 W @IOF S (PSDRUG,PSDRUGN)=0
"RTN","PSDADJC",21,0)
 F  S PSDRUGN=$O(^TMP("PSDB",$J,PSDRUGN)) Q:PSDRUGN']""  F  S PSDRUG=$O(^TMP("PSDB",$J,PSDRUGN,PSDRUG)) Q:'PSDRUG  D  G:$D(DIRUT)!($G(PSDOUT)) QUIT
"RTN","PSDADJC",22,0)
 .Q:'$G(^PSD(58.8,PSDLOC,1,PSDRUG,0))
"RTN","PSDADJC",23,0)
 .S NODE=$G(^TMP("PSDB",$J,PSDRUGN,PSDRUG))
"RTN","PSDADJC",24,0)
BAL .W !!,PSDRUGN,!!,"Balance:  "
"RTN","PSDADJC",25,0)
 .S (PSDREC,PSDREC(1),PSDREC(2))=$P($G(^PSD(58.8,PSDLOC,1,PSDRUG,0)),U,4)
"RTN","PSDADJC",26,0)
 .W PSDREC," ",$P(NODE,U,2)
"RTN","PSDADJC",27,0)
 .S DIR(0)="Y",DIR("A")="Count Correct",DIR("B")="Yes"
"RTN","PSDADJC",28,0)
 .W ! D ^DIR K DIR Q:$D(DIRUT)
"RTN","PSDADJC",29,0)
 .G:Y=1 INV
"RTN","PSDADJC",30,0)
 .F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDADJC",31,0)
 .S PSDREC(1)=$P($G(^PSD(58.8,PSDLOC,1,PSDRUG,0)),U,4)
"RTN","PSDADJC",32,0)
 .D NOW^%DTC S PSDAT=+%
"RTN","PSDADJC",33,0)
 .W !!,"Package Size: ",$P($G(NODE),"^"),"  Breakdown Unit: ",$P($G(NODE),"^",2),!
"RTN","PSDADJC",34,0)
 .S DIR(0)="NA^0:999999:2",DIR("A")="Correct Count: "
"RTN","PSDADJC",35,0)
 .S DIR("B")=PSDREC D ^DIR K DIR Q:$D(DIRUT)  S PSDREC(1)=Y
"RTN","PSDADJC",36,0)
 .I Y=PSDREC W !!,"That's no change." G INV
"RTN","PSDADJC",37,0)
 .I Y>PSDREC S NAOU(1)=0 D ^PSDORSU G:$G(NAOU(1)) BAL I $G(PSDOUT) L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0) Q
"RTN","PSDADJC",38,0)
 .S DIR(0)="58.81,15" W ! D ^DIR K DIR Q:$D(DIRUT)  S PSDRE=Y
"RTN","PSDADJC",39,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,",DA(1)=PSDLOC,DA=PSDRUG
"RTN","PSDADJC",40,0)
 .S DR="3////"_$G(PSDREC(1)) D ^DIE
"RTN","PSDADJC",41,0)
 .S $P(^PSD(58.8,PSDLOC,1,PSDRUG,0),"^",17)=1
"RTN","PSDADJC",42,0)
 .L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDADJC",43,0)
INV .I '$G(PSDAT) D NOW^%DTC S PSDAT=%
"RTN","PSDADJC",44,0)
 .S PSDREC=$G(PSDREC(1))-PSDREC G:'PSDREC TRA
"RTN","PSDADJC",45,0)
MON .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDADJC",46,0)
 .I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDADJC",47,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="1////0;7////^S X=PSDREC" D ^DIE
"RTN","PSDADJC",48,0)
TRA .W !!,"Recording ",$S(PSDREC:"adjustment",1:"inventory")," in transaction history.",!
"RTN","PSDADJC",49,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDADJC",50,0)
FIND .S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDADJC",51,0)
 .S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDADJC",52,0)
 .S DIE="^PSD(58.81,",DA=PSDT,DR="1////"_$S(PSDREC:9,1:23)_";2////"_PSDLOC_";3////"_PSDAT_";4////"_PSDRUG_";5////"_PSDREC_";6////"_DUZ_";9////"_PSDREC(2)_";15////"_$G(PSDRE)_";74////"_DUZ_";78////"_NUR2_";100////1" D ^DIE K DIE
"RTN","PSDADJC",53,0)
 .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDADJC",54,0)
 .S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDADJC",55,0)
 .S (X,DINUM)=PSDT,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,Y
"RTN","PSDADJC",56,0)
 .S NAOU=PSDLOC,NAOUN=PSDLOCN
"RTN","PSDADJC",57,0)
MM .I PSDREC S PHARM1=DUZ,PSDT=PSDAT,PSDR=PSDRUG,PSDRE=$G(PSDRE),QTY=-PSDREC D ^PSDRFM
"RTN","PSDADJC",58,0)
REP S DIR(0)="Y",DIR("A")="Would you like a report of current balances"
"RTN","PSDADJC",59,0)
 S DIR("B")="No" D ^DIR K DIR D:Y=1 DEV^PSDBAN
"RTN","PSDADJC",60,0)
QUIT K ^TMP("PSDB",$J) Q
"RTN","PSDADJD")
0^6^B19183845
"RTN","PSDADJD",1,0)
PSDADJD ;BIR/LTL-Review Adjustment Transactions for a Drug; 2 Nov 94 [ 11/02/94  3:53 PM ]
"RTN","PSDADJD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJD",3,0)
 N PSDOUT I '$D(PSDSITE) D ^PSDSET I '$D(PSDSITE) S PSDOUT=1 G END
"RTN","PSDADJD",4,0)
 N C,CNT,DIC,DIR,DTOUT,DUOUT,PSD,PSDA,PSDC,PSDEV,PSDR,PSDU,PSDLOC,PSDLOCN,PSDT,PSDTB,X,Y S PSDOUT=1,(CNT,PSDU)=0,PSDCHO=2
"RTN","PSDADJD",5,0)
 D DT^DICRW
"RTN","PSDADJD",6,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDADJD",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDADJD",8,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDADJD",9,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))"
"RTN","PSDADJD",10,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDADJD",11,0)
 W ! D ^DIC K DIC G:Y<0 END S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJD",12,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDADJD",13,0)
 W !!,"You may select one, several, or ^ALL drugs."
"RTN","PSDADJD",14,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  S PSD(Y(0,0))=+Y,PSDA(+Y)=Y(0,0),CNT=CNT+1
"RTN","PSDADJD",15,0)
 I CNT=1,'$O(^PSD(58.81,"F",+PSD($O(PSD(0))),"")) W !!,"There have been no adjustments for this drug.",!! G END
"RTN","PSDADJD",16,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  S:$P($G(^PSDRUG(PSDU,0)),U)]"" PSD($P(^(0),U))=PSDU,PSDA(PSDU)=$P(^(0),U)
"RTN","PSDADJD",17,0)
 S DIR(0)="D^::AEPT",DIR("A")="Beginning date",DIR("?")="Adjustments will be listed for the selected drug(s) within the selected date range" W ! D ^DIR G:Y<1 END
"RTN","PSDADJD",18,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0),DIR(0)="DA^"_PSDT_":NOW:AEPT"
"RTN","PSDADJD",19,0)
 S DIR("A")="Ending date:  ",DIR("B")="Now"
"RTN","PSDADJD",20,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDADJD",21,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDADJD",22,0)
 D  G:Y<1 END
"RTN","PSDADJD",23,0)
 .S DIR(0)="S^1:DATE/DRUG (132 column;2:DRUG/DATE (80 column, browser)"
"RTN","PSDADJD",24,0)
 .S DIR("B")=1,DIR("?")="^S XQH=""PSD BALANCE ADJUSTMENT REPORT"" D EN^XQH" D ^DIR K DIR S PSDCHO=Y
"RTN","PSDADJD",25,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDADJD",26,0)
DEV ;asks device and queueing info
"RTN","PSDADJD",27,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDADJD",28,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(PSDCHO=2:"START^PSDADJD",1:"START^PSDADJW"),ZTDESC="Drug adjustment transaction review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDADJD",29,0)
 G:PSDCHO=1 ^PSDADJW
"RTN","PSDADJD",30,0)
 I $E(IOST)="C",(+$G(^DIC(9.4,+$O(^DIC(9.4,"B","VA FILEMAN",0)),"VERSION"))'<21),$$TEST^DDBRT W !!,"Getting ready to browse...",!! G ^PSDADJB
"RTN","PSDADJD",31,0)
START ;compiles and prints output
"RTN","PSDADJD",32,0)
 N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER S PSDU=0
"RTN","PSDADJD",33,0)
 F  S PSDU=$O(PSD(PSDU)) Q:PSDU']""  D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDADJD",34,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  D:$O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))=PSD(PSDU))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,PSD(PSDU),9,0)))  Q:PSDOUT
"RTN","PSDADJD",35,0)
 ..S PSDR(2)=$G(^PSD(58.81,+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,PSD(PSDU),9,0)),0))
"RTN","PSDADJD",36,0)
 ..D:$Y+7>IOSL HEADER Q:PSDOUT
"RTN","PSDADJD",37,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU,!
"RTN","PSDADJD",38,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,"  "," -> "
"RTN","PSDADJD",39,0)
 ..W $P(PSDR(2),U,6)," adjusted by ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),!!
"RTN","PSDADJD",40,0)
 ..W "Reason:  ",$P(PSDR(2),U,16),!
"RTN","PSDADJD",41,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJD",42,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJD",43,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJD",44,0)
 Q
"RTN","PSDADJD",45,0)
HEADER ;prints header info
"RTN","PSDADJD",46,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDADJD",47,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDADJD",48,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1 W !,"Adjustments from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDADJI")
0^7^B13021753
"RTN","PSDADJI",1,0)
PSDADJI ;B'ham ISC/LTL - Balance Initializer ; 3 June 92
"RTN","PSDADJI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJI",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDADJI",4,0)
 N D1,D2,DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAC,PSDAT,PSDLOC,PSDLOCN,DA,PSDRUG,PSDRUGN,PSDS,PSAQ,PSDR,PSDREC,PSDT,X,Y,%,%H,%I
"RTN","PSDADJI",5,0)
 D ^PSDSP I $D(PSDS),$D(^PSD(58.8,+PSDS,0)) S PSDLOC=PSDS,PSDLOCN=$P($G(^PSD(58.8,+PSDS,0)),U) G CHKD
"RTN","PSDADJI",6,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEMQ",DIC("A")="Select Dispensing Site: ",DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDADJI",7,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJI",8,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDADJI",9,0)
 W !!,"Give me a second to alphabetize.",!
"RTN","PSDADJI",10,0)
 S PSDRUG=0,PSDRUGN=""
"RTN","PSDADJI",11,0)
 F  S PSDRUG=$O(^PSD(58.8,PSDLOC,1,PSDRUG)) Q:'PSDRUG!($P($G(^PSDRUG(+PSDRUG,0)),U)']"")  D
"RTN","PSDADJI",12,0)
 .S ^TMP("PSDB",$J,$P($G(^PSDRUG(+PSDRUG,0)),U),PSDRUG)="" K Y
"RTN","PSDADJI",13,0)
 W @IOF
"RTN","PSDADJI",14,0)
 F PSAC=1:1 S PSDRUGN=$O(^TMP("PSDB",$J,PSDRUGN)) Q:PSDRUGN']""  S PSDRUG=$O(^TMP("PSDB",$J,PSDRUGN,0)) D  G:$D(Y) QUIT
"RTN","PSDADJI",15,0)
 .I $P($G(^PSD(58.8,PSDLOC,1,PSDRUG,0)),U,4)]"" D:$Y+9>IOSL  Q:$D(DUOUT)!($D(DTOUT))  W !!,PSDRUGN," may have to be adjusted.",!!,"There's already ",$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)," on hand." Q
"RTN","PSDADJI",16,0)
 ..S DIR(0)="E" D ^DIR K DIR K:Y Y W @IOF
"RTN","PSDADJI",17,0)
 .W !!,PSDRUGN,!!,"Package Size: "
"RTN","PSDADJI",18,0)
 .W $P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,9),"  Breakdown Unit: ",$P($G(^(0)),U,8),!
"RTN","PSDADJI",19,0)
 .F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDADJI",20,0)
 .S DIR(0)="N^0:999999:0",DIR("A")="Initial Balance" D ^DIR K DIR
"RTN","PSDADJI",21,0)
 .I $D(DIRUT) L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0) S Y=1 Q
"RTN","PSDADJI",22,0)
 .S PSDREC=Y D NOW^%DTC S PSDAT=+%
"RTN","PSDADJI",23,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,",DA(1)=PSDLOC,DA=PSDRUG,DR="3////"_PSDREC
"RTN","PSDADJI",24,0)
 .D ^DIE
"RTN","PSDADJI",25,0)
 .L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDADJI",26,0)
 .Q:$G(PSDREC)']""
"RTN","PSDADJI",27,0)
MON .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDADJI",28,0)
 .I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDADJI",29,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="1////0;7////^S X=PSDREC" D ^DIE
"RTN","PSDADJI",30,0)
 .W !!,"Updating beginning balance and transaction history.",!
"RTN","PSDADJI",31,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDADJI",32,0)
FIND .S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDADJI",33,0)
 .S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDADJI",34,0)
 .S DIE="^PSD(58.81,",DA=PSDT,DR="1////11;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;9////0;100////1" D ^DIE K DIE
"RTN","PSDADJI",35,0)
 .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDADJI",36,0)
 .S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDADJI",37,0)
 .S (X,DINUM)=PSDT,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,Y
"RTN","PSDADJI",38,0)
QUIT K ^TMP("PSDB",$J) Q
"RTN","PSDADJIN")
0^8^B15788264
"RTN","PSDADJIN",1,0)
PSDADJIN ;B'ham ISC/LTL,JPW - Balance Initializer for NAOU ; 16 Feb 94
"RTN","PSDADJIN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJIN",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDADJIN",4,0)
 N D1,D2,DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,NODE,PSAC,PSDAT,PSDLOC,PSDLOCN,DA,PSDRUG,PSDRUGN,PSDS,PSDPKG,PSDBKU,PSAQ,PSDR,PSDREC,PSDT,X,Y,%,%H,%I
"RTN","PSDADJIN",5,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEMQZ",DIC("A")="Select NAOU: ",DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""N"",'$P(^(0),""^"",7),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDADJIN",6,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT S PSDLOC=+Y,PSDLOCN=$P(Y,U,2),PSDS=+$P(Y(0),"^",4)
"RTN","PSDADJIN",7,0)
 I '+$P($G(^PSD(58.8,PSDLOC,2)),"^",5) W !!,"This NAOU does not maintain a perpetual inventory balance to initialize.",!! K PSDLOC,PSDLOCN,PSDS G LOOK
"RTN","PSDADJIN",8,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDADJIN",9,0)
 S DIR(0)="Y",DIR("A",1)="This option will set all balances to zero before initializing.",DIR("A")="Are you sure you want to proceed"
"RTN","PSDADJIN",10,0)
 D ^DIR K DIR G:Y'=1 QUIT
"RTN","PSDADJIN",11,0)
 W !!,"Give me a second to alphabetize.",!
"RTN","PSDADJIN",12,0)
 S PSDRUG=0,PSDRUGN=""
"RTN","PSDADJIN",13,0)
 F  S PSDRUG=$O(^PSD(58.8,PSDLOC,1,PSDRUG)) Q:'PSDRUG  D
"RTN","PSDADJIN",14,0)
 .Q:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,0))!($P($G(^PSDRUG(+PSDRUG,0)),"^")']"")
"RTN","PSDADJIN",15,0)
 .S PSDPKG=$P($G(^PSD(58.8,+PSDS,1,+PSDRUG,0)),"^",9),PSDBKU=$P($G(^(0)),"^",8)
"RTN","PSDADJIN",16,0)
 .S ^TMP("PSDB",$J,$P($G(^PSDRUG(+PSDRUG,0)),U),PSDRUG)=PSDPKG_"^"_PSDBKU,$P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=0 K Y
"RTN","PSDADJIN",17,0)
 W @IOF
"RTN","PSDADJIN",18,0)
 F PSAC=1:1 S PSDRUGN=$O(^TMP("PSDB",$J,PSDRUGN)) Q:PSDRUGN']""  S PSDRUG=$O(^TMP("PSDB",$J,PSDRUGN,0)) D  G:$D(DIRUT) QUIT
"RTN","PSDADJIN",19,0)
 .Q:'$G(^PSD(58.8,PSDLOC,1,PSDRUG,0))
"RTN","PSDADJIN",20,0)
 .;S (PSD,PSD(1))=0
"RTN","PSDADJIN",21,0)
 .;F  S PSD=$O(^PSD(58.81,"AD",4,+PSDLOC,PSD)) S:$P($G(^PSD(58.81,+PSD,0)),U,5)=PSDRUG PSD(1)=1 Q:$G(PSD(1))!('PSD)
"RTN","PSDADJIN",22,0)
 .;Q:'$G(PSD(1))
"RTN","PSDADJIN",23,0)
 .S NODE=$G(^TMP("PSDB",$J,PSDRUGN,PSDRUG))
"RTN","PSDADJIN",24,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,",DA(1)=PSDLOC,DA=PSDRUG
"RTN","PSDADJIN",25,0)
 .F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDADJIN",26,0)
 .D NOW^%DTC S PSDAT=+%
"RTN","PSDADJIN",27,0)
 .W !!,PSDRUGN,!!,"Package Size: ",$P($G(NODE),"^"),"  Breakdown Unit: ",$P($G(NODE),"^",2),!
"RTN","PSDADJIN",28,0)
 .S DIR(0)="NA^0:999999:2",DIR("A")="Initial Balance: " D ^DIR K DIR
"RTN","PSDADJIN",29,0)
 .Q:$D(DIRUT)  S PSDREC=Y
"RTN","PSDADJIN",30,0)
 .S DR="3////"_PSDREC D ^DIE
"RTN","PSDADJIN",31,0)
 .S $P(^PSD(58.8,PSDLOC,1,PSDRUG,0),"^",17)=1
"RTN","PSDADJIN",32,0)
 .L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDADJIN",33,0)
 .Q:$G(PSDREC)']""
"RTN","PSDADJIN",34,0)
MON .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDADJIN",35,0)
 .I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDADJIN",36,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="1////0;7////^S X=PSDREC" D ^DIE
"RTN","PSDADJIN",37,0)
 .W !!,"Updating beginning balance and transaction history.",!
"RTN","PSDADJIN",38,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDADJIN",39,0)
FIND .S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDADJIN",40,0)
 .S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDADJIN",41,0)
 .S DIE="^PSD(58.81,",DA=PSDT,DR="1////11;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;9////0;100////1" D ^DIE K DIE
"RTN","PSDADJIN",42,0)
 .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDADJIN",43,0)
 .S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDADJIN",44,0)
 .S (X,DINUM)=PSDT,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,Y
"RTN","PSDADJIN",45,0)
REP S DIR(0)="Y",DIR("A")="Would you like a report of current balances"
"RTN","PSDADJIN",46,0)
 S DIR("B")="Yes" D ^DIR K DIR D:Y=1
"RTN","PSDADJIN",47,0)
 .S NAOU=PSDLOC,NAOUN=PSDLOCN D DEV^PSDBAN
"RTN","PSDADJIN",48,0)
QUIT K ^TMP("PSDB",$J) Q
"RTN","PSDADJN")
0^9^B17013339
"RTN","PSDADJN",1,0)
PSDADJN ;B'ham ISC/LTL,JPW - Adjustments for NAOU ; 16 Feb 94
"RTN","PSDADJN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJN",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDADJN",4,0)
 ;I '$D(^XUSEC("PSD ERROR",DUZ)) W !!,"Sorry, you need the PSD ERROR Security key to do adjustments.",!! G QUIT
"RTN","PSDADJN",5,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSDAT,PSDB,PSDEX,PSDLOC,PSDLOCN,DA,PSDOUT,PSDRUG,PSDRUGN,PSDS,PSAQ,PSDR,PSDREC,PSDT,X,Y,%,%H,%I
"RTN","PSDADJN",6,0)
 G LOOK
"RTN","PSDADJN",7,0)
REV S DIR(0)="Y",DIR("A")="Review",DIR("B")="No",DIR("?")="If you answer yes, I'll show you all adjustments performed within               a selected time range." D ^DIR K DIR G:$D(DIRUT) QUIT G:Y=1 ^PSDADJN1
"RTN","PSDADJN",8,0)
 Q
"RTN","PSDADJN",9,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEMQ",DIC("A")="Select NAOU: ",DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""N"",'$P(^(0),""^"",7),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDADJN",10,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJN",11,0)
 I '+$P($G(^PSD(58.8,PSDLOC,2)),"^",5) W !!,"This NAOU does not maintain a perpetual inventory balance to be adjusted.",!! K PSDLOC,PSDLOCN G LOOK
"RTN","PSDADJN",12,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDADJN",13,0)
 S PSDOUT=0
"RTN","PSDADJN",14,0)
 F  S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DA(1)=PSDLOC D  G:$D(DTOUT)!($D(DUOUT))!(PSDOUT) QUIT
"RTN","PSDADJN",15,0)
 .W ! D ^DIC K DIC I $D(DTOUT)!($D(DUOUT))!(Y<1) S PSDOUT=1 Q
"RTN","PSDADJN",16,0)
 .S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U)
"RTN","PSDADJN",17,0)
 .S PSAQ=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDADJN",18,0)
 .W !!,"Current Balance: ",PSAQ,?40
"RTN","PSDADJN",19,0)
 .W "Breakdown Unit: ",$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,8),!
"RTN","PSDADJN",20,0)
 .S DIR(0)="NOA^"_-PSAQ_":999999:2" S DIR("A")="Enter adjustment quantity (with '-' if negative):" D ^DIR K DIR
"RTN","PSDADJN",21,0)
 .I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDADJN",22,0)
 .Q:$D(DIRUT)
"RTN","PSDADJN",23,0)
 .S PSDREC=Y
"RTN","PSDADJN",24,0)
 .S DIR(0)="F^1:45",DIR("A")="Please enter reason for adjustment" W ! D ^DIR K DIR Q:$D(DIRUT)  S PSDR=Y
"RTN","PSDADJN",25,0)
POST .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes" W ! D ^DIR K DIR D:Y=1  K PSDRUG Q
"RTN","PSDADJN",26,0)
 ..W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDADJN",27,0)
 ..F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDADJN",28,0)
 ..D NOW^%DTC S PSDAT=+%
"RTN","PSDADJN",29,0)
 ..S PSAQ=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDADJN",30,0)
 ..S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSAQ
"RTN","PSDADJN",31,0)
 ..L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDADJN",32,0)
MON ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDADJN",33,0)
 ..I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDADJN",34,0)
 ..S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="7////^S X=$P($G(^(0)),U,5)+PSDREC" D ^DIE
"RTN","PSDADJN",35,0)
 ..W !,"Updating monthly adjustments and transaction history.",!
"RTN","PSDADJN",36,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDADJN",37,0)
FIND ..S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDADJN",38,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDADJN",39,0)
 ..S DIE="^PSD(58.81,",DA=PSDT,DR="1////9;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;9////^S X=PSAQ;15////^S X=PSDR;17////^S X=PSDLOC;100////1" D ^DIE K DIE
"RTN","PSDADJN",40,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDADJN",41,0)
 ..S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDADJN",42,0)
 ..S (X,DINUM)=PSDT
"RTN","PSDADJN",43,0)
 ..S DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,PSDRUG S Y=1
"RTN","PSDADJN",44,0)
QUIT D:'$G(PSDOUT)!('$D(DIRUT)) REV Q
"RTN","PSDADJN1")
0^10^B11486204
"RTN","PSDADJN1",1,0)
PSDADJN1 ;B'ham ISC/LTL - Review NAOU adj transactions for a drug ; 2 Sept 93
"RTN","PSDADJN1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJN1",3,0)
 N DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDEV,PSDLOC,PSDLOCN,PSDOUT,PSDR,PSDT,PSDS,X,Y
"RTN","PSDADJN1",4,0)
 D DT^DICRW
"RTN","PSDADJN1",5,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEMQ",DIC("A")="Select NAOU: ",DIC("S")="I $P($G(^(0)),U,2)[""N"",'$P(^(0),""^"",7),($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))",PSDOUT=1
"RTN","PSDADJN1",6,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJN1",7,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G END
"RTN","PSDADJN1",8,0)
 S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC G:$D(DTOUT)!($D(DUOUT)) END
"RTN","PSDADJN1",9,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSD=+Y
"RTN","PSDADJN1",10,0)
 I '$O(^PSD(58.81,"F",+Y,"")) W !!,"There have been no adjustments for this drug.",!! G END
"RTN","PSDADJN1",11,0)
 S DIR(0)="D:AEP",DIR("A")="How far back in time do you want to go: ",DIR("B")="T-6M" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 G END
"RTN","PSDADJN1",12,0)
 S PSDT=Y
"RTN","PSDADJN1",13,0)
DEV ;asks device and queueing info
"RTN","PSDADJN1",14,0)
 S PSDEV=$P($G(^%ZIS(1,+$P($G(^PSD(58.8,+PSDLOC,2)),U,9),0)),U)
"RTN","PSDADJN1",15,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSDOUT=1 G END
"RTN","PSDADJN1",16,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDADJR",ZTDESC="Drug adjustment transaction review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDADJN1",17,0)
START ;compiles and prints output
"RTN","PSDADJN1",18,0)
 N %DT,LN,PG,RPDT S (PG,PSDOUT)=0,Y=DT D DD^%DT S RPDT=Y,PSDR="" D HEADER
"RTN","PSDADJN1",19,0)
LOOP F  S PSDR=$O(^PSD(58.81,"F",PSD,PSDR)) G:'PSDR END D:$Y+5>IOSL HEADER G:PSDOUT END I $P($G(^PSD(58.81,+PSDR,0)),U,4)'<PSDT,$P($G(^(0)),U,2)=9,$P($G(^(0)),U,3)=PSDLOC D
"RTN","PSDADJN1",20,0)
 .S Y=$P($G(^PSD(58.81,+PSDR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSDR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSDADJN1",21,0)
 .W $P($G(^PSD(58.81,+PSDR,0)),U,6)," adjusted by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSDR,0)),U,7),0)),U),1,20),!,"Reason: ",$P($G(^PSD(58.81,+PSDR,0)),U,16),!!
"RTN","PSDADJN1",22,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJN1",23,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJN1",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJN1",25,0)
 Q
"RTN","PSDADJN1",26,0)
HEADER ;prints header info
"RTN","PSDADJN1",27,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDADJN1",28,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDADJN1",29,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !?2,"History of adjustments for ",$E($P($G(^PSDRUG(+PSD,0)),U),1,20),?50,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDADJR")
0^11^B12471430
"RTN","PSDADJR",1,0)
PSDADJR ;BIR/LTL-Review Adjustment Transactions for a Drug ; 29 Aug 94
"RTN","PSDADJR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJR",3,0)
 N PSDOUT I '$D(PSDSITE) D ^PSDSET I '$D(PSDSITE) S PSDOUT=1 G END
"RTN","PSDADJR",4,0)
 N C,DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDEV,PSDLOC,PSDLOCN,PSDR,PSDT,PSDS,X,Y
"RTN","PSDADJR",5,0)
 D DT^DICRW
"RTN","PSDADJR",6,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDADJR",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDADJR",8,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDADJR",9,0)
 S DIC("S")="I ""MS""[$P($G(^(0)),U,2)&($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))",PSDOUT=1
"RTN","PSDADJR",10,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDADJR",11,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END
"RTN","PSDADJR",12,0)
 S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJR",13,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDADJR",14,0)
CHKD I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G END
"RTN","PSDADJR",15,0)
 S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC G:$D(DTOUT)!($D(DUOUT)) END
"RTN","PSDADJR",16,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSD=+Y
"RTN","PSDADJR",17,0)
 I '$O(^PSD(58.81,"F",+Y,"")) W !!,"There have been no adjustments for this drug.",!! G END
"RTN","PSDADJR",18,0)
 S DIR(0)="D:AEP",DIR("A")="How far back in time do you want to go: ",DIR("B")="T-6M" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 G END
"RTN","PSDADJR",19,0)
 S PSDT=Y
"RTN","PSDADJR",20,0)
DEV ;asks device and queueing info
"RTN","PSDADJR",21,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDADJR",22,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSDOUT=1 G END
"RTN","PSDADJR",23,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDADJR",ZTDESC="Drug adjustment transaction review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDADJR",24,0)
START ;compiles and prints output
"RTN","PSDADJR",25,0)
 N %DT,LN,PG,RPDT S (PG,PSDOUT)=0,Y=DT D DD^%DT S RPDT=Y,PSDR="" D HEADER
"RTN","PSDADJR",26,0)
LOOP F  S PSDR=$O(^PSD(58.81,"F",PSD,PSDR)) G:'PSDR END D:$Y+5>IOSL HEADER G:PSDOUT END I $P($G(^PSD(58.81,+PSDR,0)),U,4)'<PSDT,$P($G(^(0)),U,2)=9,$P($G(^(0)),U,3)=PSDLOC D
"RTN","PSDADJR",27,0)
 .S Y=$P($G(^PSD(58.81,+PSDR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSDR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSDADJR",28,0)
 .W $P($G(^PSD(58.81,+PSDR,0)),U,6)," adjusted by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSDR,0)),U,7),0)),U),1,20),!,"Reason: ",$P($G(^PSD(58.81,+PSDR,0)),U,16),!!
"RTN","PSDADJR",29,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJR",30,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJR",31,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJR",32,0)
 Q
"RTN","PSDADJR",33,0)
HEADER ;prints header info
"RTN","PSDADJR",34,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDADJR",35,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDADJR",36,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !?2,"History of adjustments for ",$E($P($G(^PSDRUG(+PSD,0)),U),1,20),?50,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDADJW")
0^12^B4035384
"RTN","PSDADJW",1,0)
PSDADJW ;BIR/LTL-Review Adjustment Transactions for a Drug; 2 Nov 94 [ 11/02/94  12:19 PM ]
"RTN","PSDADJW",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADJW",3,0)
START ;compiles and prints output
"RTN","PSDADJW",4,0)
 N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER
"RTN","PSDADJW",5,0)
LOOP F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) Q:'PSDT!(PSDT>PSDTB(1))  D:$O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC  G:PSDOUT END
"RTN","PSDADJW",6,0)
 .S PSDR=$O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))
"RTN","PSDADJW",7,0)
 .Q:'$D(PSDA(+PSDR))
"RTN","PSDADJW",8,0)
 .S PSDR(1)=$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDR,9,0)) Q:'PSDR(1)
"RTN","PSDADJW",9,0)
 .S PSDR(2)=$G(^PSD(58.81,PSDR(1),0))
"RTN","PSDADJW",10,0)
 .D:$Y+7>IOSL HEADER Q:PSDOUT
"RTN","PSDADJW",11,0)
 .W !,$$FMTE^XLFDT($E($P(PSDR(2),U,4),1,12),"2P"),?18,PSDA(PSDR)
"RTN","PSDADJW",12,0)
 .W ?61,$J($P(PSDR(2),U,6),6),?69,$P(PSDR(2),U,16),?116
"RTN","PSDADJW",13,0)
 .W $E($P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),1,16),!
"RTN","PSDADJW",14,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJW",15,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJW",16,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJW",17,0)
 Q
"RTN","PSDADJW",18,0)
HEADER ;prints header info
"RTN","PSDADJW",19,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDADJW",20,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDADJW",21,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1 W !,"Adjustments from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!?2,"Date",?18,"Drug",?64,"QTY",?69,"Reason",?116,"Pharmacist",!,LN,!
"RTN","PSDADT")
0^13^B2473275
"RTN","PSDADT",1,0)
PSDADT ;BIR/LTL- ADT Message builder for HL7 ; 13 Feb 95
"RTN","PSDADT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADT",3,0)
 Q:("123"'[$P(DGPMA,U,2))
"RTN","PSDADT",4,0)
 N HLERR,HLEVN,HLNDAP,HLMTN,HLFS,HLECH,HLSDATA,HLSDT,HLSEC,HLCHAR,HLDA,HLDAN,HLDAP,HLDT,HLDT1,HLNDAP0,HLPID,HLQ,HLVER
"RTN","PSDADT",5,0)
 S HLNDAP="PSD-NDES" D INIT^HLTRANS I $D(HLERR) D KILL^HLTRANS Q
"RTN","PSDADT",6,0)
 D EVN($P(DGPMA,U,2),$P(DGPMA,U))
"RTN","PSDADT",7,0)
 S HLMTN="ADT",HLEVN=1
"RTN","PSDADT",8,0)
PID S HLSDATA(2)=$$EN^VAFHLPID(DFN,"1,2,3,5")
"RTN","PSDADT",9,0)
PV1 N VAROOT,VAINDT S VAROOT="PSD",VAINDT=$P(DGPMA,U) D INP^VADPT
"RTN","PSDADT",10,0)
 S $P(HLSDATA(3),HLFS,8)=""
"RTN","PSDADT",11,0)
 S $P(HLSDATA(3),HLFS)="PV1"
"RTN","PSDADT",12,0)
 S $P(HLSDATA(3),HLFS,4)=$P(PSD(4),U,2)_$E(HLECH)_$P(PSD(5),"-")_$E(HLECH)_$P(PSD(5),"-",2)
"RTN","PSDADT",13,0)
 S $P(HLSDATA(3),HLFS,7)=$E(HLECH)_$E(HLECH)
"RTN","PSDADT",14,0)
 S $P(HLSDATA(3),HLFS,8)=$P(PSD(2),U)_$E(HLECH)_$$HLNAME^HLFNC($P(PSD(2),U,2))
"RTN","PSDADT",15,0)
 D:$P(DGPMA,U,2)=2
"RTN","PSDADT",16,0)
 .N VAROOT,VAINDT S VAROOT="PSD",VAINDT=$P(DGPMA,U) D IN5^VADPT
"RTN","PSDADT",17,0)
 .S $P(HLSDATA(3),HLFS,7)=$P(PSD(15,4),U,2)_$E(HLECH)_$E(HLECH)
"RTN","PSDADT",18,0)
SEND D EN^HLTRANS K PSD Q
"RTN","PSDADT",19,0)
EVN(EVENT,DATE) ;EVN Segment builder
"RTN","PSDADT",20,0)
 S HLSDATA(1)="EVN"_HLFS_"A0"_EVENT_HLFS_$$HLDATE^HLFNC(DATE) Q
"RTN","PSDADT1")
0^14^B3870320
"RTN","PSDADT1",1,0)
PSDADT1 ;BIR/LTL- ADT Admit Message builder for HL7 V 1.6; 24 Nov 95
"RTN","PSDADT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDADT1",3,0)
 Q:'$P(DGPMA,U,2)!(("123")'[$P(DGPMA,U,2))
"RTN","PSDADT1",4,0)
 Q:'$P($G(^HLCS(869.2,+$O(^HLCS(869.2,"B","PSD-NDES HLLP",0)),200)),U)&('$P($G(^HLCS(869.2,+$O(^HLCS(869.2,"B","PSD-NDES X3.28",0)),300)),U))
"RTN","PSDADT1",5,0)
 N HLMTN,HLEVN,HLFS,HLA,HL,HLQ,HLECH,PSDHL
"RTN","PSDADT1",6,0)
SERVER S EID=$O(^ORD(101,"B",$S($P(DGPMA,U,2)=1:"PSD A01 SERVER",$P(DGPMA,U,2)=2:"PSD A02 SERVER",1:"PSD A03 SERVER"),0)),INT=0
"RTN","PSDADT1",7,0)
 D INIT^HLFNC2(EID,.HL,INT)
"RTN","PSDADT1",8,0)
 Q:$O(HL(""))']""
"RTN","PSDADT1",9,0)
 D EVN($P(DGPMA,U,2),$P(DGPMA,U))
"RTN","PSDADT1",10,0)
 S HLMTN="ADT",HLEVN=1,HLFS=HL("FS"),HLECH=HL("ECH"),HLQ=""
"RTN","PSDADT1",11,0)
PID S HLA("HLS",2)=$$EN^VAFHLPID(DFN,"1,2,3,5")
"RTN","PSDADT1",12,0)
PV1 N VAROOT,VAINDT S VAROOT="PSD",VAINDT=$P(DGPMA,U) D INP^VADPT
"RTN","PSDADT1",13,0)
 S $P(HLA("HLS",3),HL("FS"),3)="I"
"RTN","PSDADT1",14,0)
 S $P(HLA("HLS",3),HL("FS"),8)=""
"RTN","PSDADT1",15,0)
 S $P(HLA("HLS",3),HL("FS"))="PV1"
"RTN","PSDADT1",16,0)
 S $P(HLA("HLS",3),HL("FS"),4)=$P(PSD(4),U,2)_$E(HL("ECH"))_$P(PSD(5),"-")_$E(HL("ECH"))_$P(PSD(5),"-",2)
"RTN","PSDADT1",17,0)
 S $P(HLA("HLS",3),HL("FS"),7)=$E(HL("ECH"))_$E(HL("ECH"))
"RTN","PSDADT1",18,0)
 S $P(HLA("HLS",3),HL("FS"),8)=$P(PSD(2),U)_$E(HL("ECH"))_$$HLNAME^HLFNC($P(PSD(2),U,2))
"RTN","PSDADT1",19,0)
 D:$P(DGPMA,U,2)=2
"RTN","PSDADT1",20,0)
 .N VAROOT,VAINDT S VAROOT="PSD",VAINDT=$P(DGPMA,U) D IN5^VADPT
"RTN","PSDADT1",21,0)
 .S $P(HLA("HLS",3),HL("FS"),7)=$P(PSD(15,4),U,2)_$E(HL("ECH"))_$E(HL("ECH"))
"RTN","PSDADT1",22,0)
SEND S HLEID=EID D GENERATE^HLMA(HLEID,"LM",1,.HLRST,"",.HL) K PSD Q
"RTN","PSDADT1",23,0)
EVN(EVENT,DATE) ;EVN Segment builder
"RTN","PSDADT1",24,0)
 S HLA("HLS",1)="EVN"_HL("FS")_"A0"_EVENT_HL("FS")_$$HLDATE^HLFNC(DATE) Q
"RTN","PSDAMIS")
0^15^B17966068
"RTN","PSDAMIS",1,0)
PSDAMIS ;BIR/JPW-AMIS Report for NAOUs ; 8 Aug 94
"RTN","PSDAMIS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDAMIS",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"the narcotic NAOU AMIS Report.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDAMIS",5,0)
 W !!,"Select Date Range for NAOU AMIS Report",!
"RTN","PSDAMIS",6,0)
DATE ;ask date range
"RTN","PSDAMIS",7,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDAMIS",8,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDAMIS",9,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDAMIS",10,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDAMIS",11,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDAMIS",12,0)
SUM ;if summary only
"RTN","PSDAMIS",13,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDAMIS",14,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the detail report including summary totals."
"RTN","PSDAMIS",15,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDAMIS",16,0)
SORT ;sel sort order
"RTN","PSDAMIS",17,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/ALL NAOUS;N:NAOU/ALL DRUGS",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDAMIS",18,0)
 S DIR("?",1)="Enter 'D' if you wish to print the NAOU AMIS Report sorted by DRUG",DIR("?",2)="  and within DRUG by each NAOU."
"RTN","PSDAMIS",19,0)
 S DIR("?",3)="Enter 'N' to print the NAOU AMIS Report by NAOU",DIR("?")="  and within NAOU by each DRUG."
"RTN","PSDAMIS",20,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDAMIS",21,0)
 G:ANS="D" DRUG
"RTN","PSDAMIS",22,0)
ASKN ;ask NAOU(s)
"RTN","PSDAMIS",23,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDAMIS",24,0)
 K DA,DIC
"RTN","PSDAMIS",25,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDAMIS",26,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDAMIS",27,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S LOC(PSD)=""
"RTN","PSDAMIS",28,0)
 G DEV
"RTN","PSDAMIS",29,0)
DRUG ;ask drug(s)
"RTN","PSDAMIS",30,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDAMIS",31,0)
 K DA,DIC F  S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEAM",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDAMIS",32,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDAMIS",33,0)
 I X="^ALL" S ALL=1
"RTN","PSDAMIS",34,0)
DEV ;asks device and queueing information
"RTN","PSDAMIS",35,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDAMIS",36,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDAMIS",37,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(ANS="D":"START^PSDAMIS1",1:"START^PSDAMIS2"),ZTDESC="CS PHARM NAOU AMIS Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDAMIS",38,0)
 U IO G:ANS="D" START^PSDAMIS1 G:ANS="N" START^PSDAMIS2
"RTN","PSDAMIS",39,0)
END ;
"RTN","PSDAMIS",40,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),LOC
"RTN","PSDAMIS",41,0)
 K POP,PSD,PSDATE,PSDED,PSDOUT,PSDSD,PSDT,SUM,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE
"RTN","PSDAMIS",42,0)
 D ^%ZISC
"RTN","PSDAMIS",43,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDAMIS",44,0)
 Q
"RTN","PSDAMIS",45,0)
SAVE ;save variables for queueing
"RTN","PSDAMIS",46,0)
 S ZTSAVE("ANS")="",ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(LOC) ZTSAVE("LOC(")=""
"RTN","PSDAMIS",47,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDAMIS",48,0)
 S (ZTSAVE("PSDATE"),ZTSAVE("PSDED"),ZTSAVE("PSDSD"))=""
"RTN","PSDAMIS",49,0)
 S ZTSAVE("DUZ")=""
"RTN","PSDAMIS",50,0)
 Q
"RTN","PSDAMIS0")
0^16^B18254052
"RTN","PSDAMIS0",1,0)
PSDAMIS0 ;BIR/JPW-Print NAOU AMIS Report by Drug ; 1 Sept 94
"RTN","PSDAMIS0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS0",3,0)
EN ;entry to print report
"RTN","PSDAMIS0",4,0)
 I SUM D ^PSDAMIS4 G DONE
"RTN","PSDAMIS0",5,0)
PRINT ;prints data for stock drugs
"RTN","PSDAMIS0",6,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDAMIS0",7,0)
 I '$D(^TMP("PSDAMIS",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDAMIS0",8,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDAMIS",$J,PSDR)) D:PSDR="" GTOT Q:PSDR=""!(PSDOUT)  D HDR S NAOU="" F  S NAOU=$O(^TMP("PSDAMIS",$J,PSDR,NAOU)) D:NAOU="" NTOT Q:NAOU=""!(PSDOUT)  W !,?2,"=> ",NAOU,! D  G:PSDOUT DONE
"RTN","PSDAMIS0",9,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDAMIS",$J,PSDR,NAOU,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDAMIS",$J,PSDR,NAOU,NUM,JJ)) Q:'JJ!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDAMIS0",10,0)
 ..S NODE=^TMP("PSDAMIS",$J,PSDR,NAOU,NUM,JJ),DATE=$E(JJ,4,5)_"/"_$E(JJ,6,7)_"/"_$E(JJ,2,3)
"RTN","PSDAMIS0",11,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",NAOU,!
"RTN","PSDAMIS0",12,0)
 ..W !,NUM,?16,DATE,?25,$J($P(NODE,"^"),6),?44,$J($P(NODE,"^",2),8,2)
"RTN","PSDAMIS0",13,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDAMIS0",14,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDAMIS0",15,0)
END ;
"RTN","PSDAMIS0",16,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,COST,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,FLAG,IO("Q"),JJ,JJ1,KK,LOC,LN
"RTN","PSDAMIS0",17,0)
 K NAOU,NAOUN,NODE,NUM,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDT,RPDT,SUM,X,Y
"RTN","PSDAMIS0",18,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDAMIS0",19,0)
 K ^TMP("PSDAMIS",$J),^TMP("PSDAMIST",$J),^TMP("PSDAMISG",$J),^TMP("PSDAMISQ",$J),^TMP("PSDAMISS",$J),^TMP("PSDAMISQT",$J),^TMP("PSDAMISC",$J),^TMP("PSDAMISCN",$J),^TMP("PSDAMISCG",$J)
"RTN","PSDAMIS0",20,0)
 K ^TMP("PSDAMISVG",$J),^TMP("PSDAMISCVG",$J)
"RTN","PSDAMIS0",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDAMIS0",22,0)
 Q
"RTN","PSDAMIS0",23,0)
HDR ;lists header information
"RTN","PSDAMIS0",24,0)
 Q:PSDOUT
"RTN","PSDAMIS0",25,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDAMIS0",26,0)
 W:$Y @IOF S PG=PG+1 W !,"DRUG/NAOU AMIS REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDAMIS0",27,0)
 W:$G(PSDR)]"" "DRUG: ",PSDR,!
"RTN","PSDAMIS0",28,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDAMIS0",29,0)
 W !,?2,"=> NAOU",!,?16,"DATE",!,"DISP #",?15,"FILLED",?25,"QUANTITY",?40,"COST PER ORDER",!,LN,!
"RTN","PSDAMIS0",30,0)
 Q
"RTN","PSDAMIS0",31,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDAMISS",$J,PSDR,NAOU),?25,$J(^TMP("PSDAMISQ",$J,PSDR,NAOU),6),?44,$J(^TMP("PSDAMISC",$J,PSDR,NAOU),8,2),?60,"** NAOU Totals **",!
"RTN","PSDAMIS0",32,0)
 W "=========",?25,"=========",?40,"=============",!
"RTN","PSDAMIS0",33,0)
 Q
"RTN","PSDAMIS0",34,0)
NTOT ;print drug subtotals
"RTN","PSDAMIS0",35,0)
 Q:PSDOUT  I $Y+8>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS0",36,0)
 W:$D(FLAG) !,?5,"** ",PSDR," **",!
"RTN","PSDAMIS0",37,0)
 W:'$D(FLAG) !,"Drug Subtotals: " W !,"Number of Orders: ",?25,$J(^TMP("PSDAMIST",$J,PSDR),7)
"RTN","PSDAMIS0",38,0)
 W !,"Total Quantity of Orders: ",?25,$J(^TMP("PSDAMISQT",$J,PSDR),6)
"RTN","PSDAMIS0",39,0)
 W !,"Total Cost of Orders: ",?44,$J(^TMP("PSDAMISCN",$J,PSDR),8,2)
"RTN","PSDAMIS0",40,0)
 W !,"Average Cost Per Order: ",?44,$S(+^TMP("PSDAMIST",$J,PSDR):$J((^TMP("PSDAMISCN",$J,PSDR)/^TMP("PSDAMIST",$J,PSDR)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS0",41,0)
 Q
"RTN","PSDAMIS0",42,0)
GTOT ;grand total
"RTN","PSDAMIS0",43,0)
 Q:PSDOUT
"RTN","PSDAMIS0",44,0)
 D HDR Q:PSDOUT  S FLAG=1 W !!,?35,"Drug Subtotals Summary",!!
"RTN","PSDAMIS0",45,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDAMIST",$J,PSDR)) Q:PSDR=""  D NTOT Q:PSDOUT
"RTN","PSDAMIS0",46,0)
 D HDR Q:PSDOUT
"RTN","PSDAMIS0",47,0)
 W !,"Grand Totals by Dispensing Site: ",PSDSN,!
"RTN","PSDAMIS0",48,0)
 S PSDSN="" F  S PSDSN=$O(^TMP("PSDAMISVG",$J,PSDSN)) Q:PSDSN=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDAMIS0",49,0)
 .I $Y+6>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS0",50,0)
 .W !,"Number of Orders: ",?25,$J(^TMP("PSDAMISVG",$J,PSDSN),6),!,"Cost of Orders: ",?44,$J(^TMP("PSDAMISCVG",$J,PSDSN),8,2),!
"RTN","PSDAMIS0",51,0)
 .W "Average Cost Per Order: ",?44,$S(+^TMP("PSDAMISVG",$J,PSDSN):$J((^TMP("PSDAMISCVG",$J,PSDSN)/^TMP("PSDAMISVG",$J,PSDSN)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS0",52,0)
 D HDR
"RTN","PSDAMIS0",53,0)
 W !,"Grand Totals: ",!,"Number of Orders: ",?25,$J(^TMP("PSDAMISG",$J),6),!,"Cost of Orders: ",?44,$J(^TMP("PSDAMISCG",$J),8,2),!
"RTN","PSDAMIS0",54,0)
 W "Average Cost Per Order: ",?44,$S(+^TMP("PSDAMISG",$J):$J((^TMP("PSDAMISCG",$J)/^TMP("PSDAMISG",$J)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS0",55,0)
 Q
"RTN","PSDAMIS1")
0^17^B14814729
"RTN","PSDAMIS1",1,0)
PSDAMIS1 ;BIR/JPW-Print NAOU AMIS Report by Drug ; 1 Sept 94
"RTN","PSDAMIS1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS1",3,0)
START ;entry point for report
"RTN","PSDAMIS1",4,0)
 K ^TMP("PSDAMIS",$J),^TMP("PSDAMISS",$J),^TMP("PSDAMIST",$J),^TMP("PSDAMISG",$J),^TMP("PSDAMISQT",$J),^TMP("PSDAMISQ",$J),^TMP("PSDAMISC",$J),^TMP("PSDAMISCN",$J),^TMP("PSDAMISCG",$J)
"RTN","PSDAMIS1",5,0)
 K ^TMP("PSDM",$J),^TMP("PSDAMISVG",$J),^TMP("PSDAMISCVG",$J)
"RTN","PSDAMIS1",6,0)
 I $D(ALL) D ALL G CHK
"RTN","PSDAMIS1",7,0)
 F PSDR=0:0 S PSDR=$O(LOC(PSDR)) Q:'PSDR  F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,2,KK)) Q:'KK  D SET
"RTN","PSDAMIS1",8,0)
CHK ;checks for zero cost data & sends e-mail from ^PSDCOSM
"RTN","PSDAMIS1",9,0)
 I $D(^TMP("PSDM",$J)) S PSDCHO(1)="AMIS Report by DRUG",Y=PSDT X ^DD("DD") S PSDT(1)=Y D ^PSDCOSM K PSDCHO,^TMP("PSDM",$J)
"RTN","PSDAMIS1",10,0)
 G ^PSDAMIS0
"RTN","PSDAMIS1",11,0)
ALL ;loops for all drugs
"RTN","PSDAMIS1",12,0)
 Q:'$D(ALL)
"RTN","PSDAMIS1",13,0)
 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDAMIS1",14,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,2,KK)) Q:'KK  D SET
"RTN","PSDAMIS1",15,0)
 Q
"RTN","PSDAMIS1",16,0)
SET ;sets data
"RTN","PSDAMIS1",17,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18),PSDS=+$P(NODE,"^",3)
"RTN","PSDAMIS1",18,0)
 Q:$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  Q:$D(^PSD(58.81,KK,5))
"RTN","PSDAMIS1",19,0)
 S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDAMIS1",20,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDAMIS1",21,0)
 S PSDSN=$S($P($G(^PSD(58.8,PSDS,0)),"^")]"":$P(^(0),"^"),1:"DISP. SITE NAME MISSING")
"RTN","PSDAMIS1",22,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDAMIS1",23,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P(^(4),"^",3)
"RTN","PSDAMIS1",24,0)
 S COST=+$P($G(^PSDRUG(PSDR,660)),"^",6),COST=COST*QTY
"RTN","PSDAMIS1",25,0)
 S:'COST ^TMP("PSDM",$J,PSDRN)=""
"RTN","PSDAMIS1",26,0)
 S ^TMP("PSDAMIS",$J,PSDRN,NAOUN,PSDPN,JJ)=QTY_"^"_COST
"RTN","PSDAMIS1",27,0)
 S:'$D(^TMP("PSDAMIST",$J,PSDRN)) ^TMP("PSDAMIST",$J,PSDRN)=0 S ^TMP("PSDAMIST",$J,PSDRN)=+^TMP("PSDAMIST",$J,PSDRN)+1
"RTN","PSDAMIS1",28,0)
 S:'$D(^TMP("PSDAMISQT",$J,PSDRN)) ^TMP("PSDAMISQT",$J,PSDRN)=0 S ^TMP("PSDAMISQT",$J,PSDRN)=+^TMP("PSDAMISQT",$J,PSDRN)+QTY
"RTN","PSDAMIS1",29,0)
 S:'$D(^TMP("PSDAMISS",$J,PSDRN,NAOUN)) ^TMP("PSDAMISS",$J,PSDRN,NAOUN)=0 S ^TMP("PSDAMISS",$J,PSDRN,NAOUN)=+^TMP("PSDAMISS",$J,PSDRN,NAOUN)+1
"RTN","PSDAMIS1",30,0)
 S:'$D(^TMP("PSDAMISQ",$J,PSDRN,NAOUN)) ^TMP("PSDAMISQ",$J,PSDRN,NAOUN)=0 S ^TMP("PSDAMISQ",$J,PSDRN,NAOUN)=+^TMP("PSDAMISQ",$J,PSDRN,NAOUN)+QTY
"RTN","PSDAMIS1",31,0)
 S:'$D(^TMP("PSDAMISG",$J)) ^TMP("PSDAMISG",$J)=0 S ^TMP("PSDAMISG",$J)=+^TMP("PSDAMISG",$J)+1
"RTN","PSDAMIS1",32,0)
 S:'$D(^TMP("PSDAMISVG",$J,PSDSN)) ^TMP("PSDAMISVG",$J,PSDSN)=0 S ^TMP("PSDAMISVG",$J,PSDSN)=+^TMP("PSDAMISVG",$J,PSDSN)+1
"RTN","PSDAMIS1",33,0)
 S:'$D(^TMP("PSDAMISC",$J,PSDRN,NAOUN)) ^TMP("PSDAMISC",$J,PSDRN,NAOUN)=0 S ^TMP("PSDAMISC",$J,PSDRN,NAOUN)=+^TMP("PSDAMISC",$J,PSDRN,NAOUN)+COST
"RTN","PSDAMIS1",34,0)
 S:'$D(^TMP("PSDAMISCN",$J,PSDRN)) ^TMP("PSDAMISCN",$J,PSDRN)=0 S ^TMP("PSDAMISCN",$J,PSDRN)=+^TMP("PSDAMISCN",$J,PSDRN)+COST
"RTN","PSDAMIS1",35,0)
 S:'$D(^TMP("PSDAMISCG",$J)) ^TMP("PSDAMISCG",$J)=0 S ^TMP("PSDAMISCG",$J)=+^TMP("PSDAMISCG",$J)+COST
"RTN","PSDAMIS1",36,0)
 S:'$D(^TMP("PSDAMISCVG",$J,PSDSN)) ^TMP("PSDAMISCVG",$J,PSDSN)=0 S ^TMP("PSDAMISCVG",$J,PSDSN)=+^TMP("PSDAMISCVG",$J,PSDSN)+COST
"RTN","PSDAMIS1",37,0)
 Q
"RTN","PSDAMIS2")
0^18^B11411474
"RTN","PSDAMIS2",1,0)
PSDAMIS2 ;BIR/JPW-Print NAOU AMIS Report by NAOU ; 1 Sept 94
"RTN","PSDAMIS2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS2",3,0)
START ;entry point for report
"RTN","PSDAMIS2",4,0)
 K ^TMP("PSDAMIS",$J),^TMP("PSDAMISS",$J),^TMP("PSDAMIST",$J),^TMP("PSDAMISG",$J),^TMP("PSDAMISQ",$J),^TMP("PSDAMISC",$J),^TMP("PSDAMISCG",$J),^TMP("PSDAMISCN",$J)
"RTN","PSDAMIS2",5,0)
 K ^TMP("PSDM",$J),^TMP("PSDAMISCVG",$J),^TMP("PSDAMISVG",$J)
"RTN","PSDAMIS2",6,0)
 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDAMIS2",7,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,2,KK)) Q:'KK  D SET
"RTN","PSDAMIS2",8,0)
CHK ;checks for zero cost data & sends e-mail from ^PSDCOSM
"RTN","PSDAMIS2",9,0)
 I $D(^TMP("PSDM",$J)) S PSDCHO(1)="AMIS Report by NAOU",Y=PSDT X ^DD("DD") S PSDT(1)=Y D ^PSDCOSM K PSDCHO,^TMP("PSDM",$J)
"RTN","PSDAMIS2",10,0)
 G ^PSDAMIS3
"RTN","PSDAMIS2",11,0)
SET ;sets data
"RTN","PSDAMIS2",12,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18),PSDS=+$P(NODE,"^",3)
"RTN","PSDAMIS2",13,0)
 Q:'$D(LOC(PSD))  Q:$D(^PSD(58.81,KK,5))
"RTN","PSDAMIS2",14,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDAMIS2",15,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDAMIS2",16,0)
 S PSDSN=$S($P($G(^PSD(58.8,PSDS,0)),"^")]"":$P(^(0),"^"),1:"DISP. SITE NAME MISSING")
"RTN","PSDAMIS2",17,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDAMIS2",18,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P(^(4),"^",3)
"RTN","PSDAMIS2",19,0)
 S COST=+$P($G(^PSDRUG(PSDR,660)),"^",6),COST=COST*QTY
"RTN","PSDAMIS2",20,0)
 S:'COST ^TMP("PSDM",$J,PSDRN)=""
"RTN","PSDAMIS2",21,0)
 S ^TMP("PSDAMIS",$J,NAOUN,PSDRN,PSDPN,JJ)=QTY_"^"_COST
"RTN","PSDAMIS2",22,0)
 S:'$D(^TMP("PSDAMIST",$J,NAOUN)) ^TMP("PSDAMIST",$J,NAOUN)=0 S ^TMP("PSDAMIST",$J,NAOUN)=+^TMP("PSDAMIST",$J,NAOUN)+1
"RTN","PSDAMIS2",23,0)
 S:'$D(^TMP("PSDAMISS",$J,NAOUN,PSDRN)) ^TMP("PSDAMISS",$J,NAOUN,PSDRN)=0 S ^TMP("PSDAMISS",$J,NAOUN,PSDRN)=+^TMP("PSDAMISS",$J,NAOUN,PSDRN)+1
"RTN","PSDAMIS2",24,0)
 S:'$D(^TMP("PSDAMISQ",$J,NAOUN,PSDRN)) ^TMP("PSDAMISQ",$J,NAOUN,PSDRN)=0 S ^TMP("PSDAMISQ",$J,NAOUN,PSDRN)=+^TMP("PSDAMISQ",$J,NAOUN,PSDRN)+QTY
"RTN","PSDAMIS2",25,0)
 S:'$D(^TMP("PSDAMISG",$J)) ^TMP("PSDAMISG",$J)=0 S ^TMP("PSDAMISG",$J)=+^TMP("PSDAMISG",$J)+1
"RTN","PSDAMIS2",26,0)
 S:'$D(^TMP("PSDAMISVG",$J,PSDSN)) ^TMP("PSDAMISVG",$J,PSDSN)=0 S ^TMP("PSDAMISVG",$J,PSDSN)=+^TMP("PSDAMISVG",$J,PSDSN)+1
"RTN","PSDAMIS2",27,0)
 S:'$D(^TMP("PSDAMISC",$J,NAOUN,PSDRN)) ^TMP("PSDAMISC",$J,NAOUN,PSDRN)=0 S ^TMP("PSDAMISC",$J,NAOUN,PSDRN)=+^TMP("PSDAMISC",$J,NAOUN,PSDRN)+COST
"RTN","PSDAMIS2",28,0)
 S:'$D(^TMP("PSDAMISCN",$J,NAOUN)) ^TMP("PSDAMISCN",$J,NAOUN)=0 S ^TMP("PSDAMISCN",$J,NAOUN)=+^TMP("PSDAMISCN",$J,NAOUN)+COST
"RTN","PSDAMIS2",29,0)
 S:'$D(^TMP("PSDAMISCG",$J)) ^TMP("PSDAMISCG",$J)=0 S ^TMP("PSDAMISCG",$J)=+^TMP("PSDAMISCG",$J)+COST
"RTN","PSDAMIS2",30,0)
 S:'$D(^TMP("PSDAMISCVG",$J,PSDSN)) ^TMP("PSDAMISCVG",$J,PSDSN)=0 S ^TMP("PSDAMISCVG",$J,PSDSN)=+^TMP("PSDAMISCVG",$J,PSDSN)+COST
"RTN","PSDAMIS2",31,0)
 Q
"RTN","PSDAMIS3")
0^19^B17303379
"RTN","PSDAMIS3",1,0)
PSDAMIS3 ;BIR/JPW-Print NAOU AMIS Report by NAOU ; 1 Sept 94
"RTN","PSDAMIS3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS3",3,0)
EN ;entry for printing data
"RTN","PSDAMIS3",4,0)
 I SUM D ^PSDAMIS4 G DONE
"RTN","PSDAMIS3",5,0)
PRINT ;prints data for stock drugs
"RTN","PSDAMIS3",6,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDAMIS3",7,0)
 I '$D(^TMP("PSDAMIS",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDAMIS3",8,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDAMIS",$J,NAOU)) D:NAOU="" GTOT Q:NAOU=""!(PSDOUT)  D HDR S PSDR="" F  S PSDR=$O(^TMP("PSDAMIS",$J,NAOU,PSDR)) D:PSDR="" NTOT Q:PSDR=""!(PSDOUT)  W !,?2,"=> ",PSDR,!! D  G:PSDOUT DONE
"RTN","PSDAMIS3",9,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDAMIS",$J,NAOU,PSDR,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDAMIS",$J,NAOU,PSDR,NUM,JJ)) Q:'JJ!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDAMIS3",10,0)
 ..S NODE=^TMP("PSDAMIS",$J,NAOU,PSDR,NUM,JJ),DATE=$E(JJ,4,5)_"/"_$E(JJ,6,7)_"/"_$E(JJ,2,3)
"RTN","PSDAMIS3",11,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDR,!!
"RTN","PSDAMIS3",12,0)
 ..W NUM,?15,DATE,?25,$J($P(NODE,"^"),6),?44,$J($P(NODE,"^",2),8,2),!
"RTN","PSDAMIS3",13,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDAMIS3",14,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDAMIS3",15,0)
END ;
"RTN","PSDAMIS3",16,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,COST,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,FLAG,IO("Q"),JJ,JJ1,KK,LOC,LN
"RTN","PSDAMIS3",17,0)
 K NAOU,NAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDT,RPDT,SUM,X,Y
"RTN","PSDAMIS3",18,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDAMIS3",19,0)
 K ^TMP("PSDAMIS",$J),^TMP("PSDAMIST",$J),^TMP("PSDAMISG",$J),^TMP("PSDAMISQ",$J),^TMP("PSDAMISS",$J),^TMP("PSDAMISC",$J),^TMP("PSDAMISCN",$J),^TMP("PSDAMISCG",$J)
"RTN","PSDAMIS3",20,0)
 K ^TMP("PSDAMISVG",$J),^TMP("PSDAMISCVG",$J)
"RTN","PSDAMIS3",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDAMIS3",22,0)
 Q
"RTN","PSDAMIS3",23,0)
HDR ;lists header information
"RTN","PSDAMIS3",24,0)
 Q:PSDOUT
"RTN","PSDAMIS3",25,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDAMIS3",26,0)
 W:$Y @IOF S PG=PG+1 W !,"NAOU/DRUG AMIS REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDAMIS3",27,0)
 W:$G(NAOU)]"" "NAOU: ",NAOU,!
"RTN","PSDAMIS3",28,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDAMIS3",29,0)
 W !,?2,"=> DRUG",!,?16,"DATE",!,"DISP #",?15,"FILLED",?25,"QUANTITY",?40,"COST PER ORDER",!,LN,!
"RTN","PSDAMIS3",30,0)
 Q
"RTN","PSDAMIS3",31,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDAMISS",$J,NAOU,PSDR),?25,$J(^TMP("PSDAMISQ",$J,NAOU,PSDR),6),?44,$J(^TMP("PSDAMISC",$J,NAOU,PSDR),8,2),?60,"** Drug Totals **",!
"RTN","PSDAMIS3",32,0)
 W "=========",?25,"=========",?40,"=============",!
"RTN","PSDAMIS3",33,0)
 Q
"RTN","PSDAMIS3",34,0)
NTOT ;print naou subtotals
"RTN","PSDAMIS3",35,0)
 Q:PSDOUT  I $Y+8>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS3",36,0)
 W:$D(FLAG) !,?5,"** ",NAOU,"  **",!
"RTN","PSDAMIS3",37,0)
 W:'$D(FLAG) !,"NAOU Subtotals: " W !,"Number of Orders: ",?25,$J(^TMP("PSDAMIST",$J,NAOU),6)
"RTN","PSDAMIS3",38,0)
 W !,"Total Cost of Orders: ",?44,$J(^TMP("PSDAMISCN",$J,NAOU),8,2)
"RTN","PSDAMIS3",39,0)
 W !,"Average Cost Per Order: ",?44,$S(+^TMP("PSDAMIST",$J,NAOU):$J((^TMP("PSDAMISCN",$J,NAOU)/^TMP("PSDAMIST",$J,NAOU)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS3",40,0)
 Q
"RTN","PSDAMIS3",41,0)
GTOT ;grand total
"RTN","PSDAMIS3",42,0)
 Q:PSDOUT
"RTN","PSDAMIS3",43,0)
 D HDR Q:PSDOUT  S FLAG=1 W !!,?35,"NAOU Subtotals Summary",!!
"RTN","PSDAMIS3",44,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDAMIST",$J,NAOU)) Q:NAOU=""  D NTOT Q:PSDOUT
"RTN","PSDAMIS3",45,0)
 D HDR Q:PSDOUT
"RTN","PSDAMIS3",46,0)
 W !,"Grand Totals by Dispensing Site: ",PSDSN,!
"RTN","PSDAMIS3",47,0)
 S PSDSN="" F  S PSDSN=$O(^TMP("PSDAMISVG",$J,PSDSN)) Q:PSDSN=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDAMIS3",48,0)
 .I $Y+6>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS3",49,0)
 .W !,"Number of Orders: ",?25,$J(^TMP("PSDAMISVG",$J,PSDSN),6),!,"Cost of Orders: ",?44,$J(^TMP("PSDAMISCVG",$J,PSDSN),8,2),!
"RTN","PSDAMIS3",50,0)
 .W "Average Cost Per Order: ",?44,$S(+^TMP("PSDAMISVG",$J,PSDSN):$J((^TMP("PSDAMISCVG",$J,PSDSN)/^TMP("PSDAMISVG",$J,PSDSN)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS3",51,0)
 D HDR Q:PSDOUT
"RTN","PSDAMIS3",52,0)
 W !,"Grand Totals: ",!,"Number of Orders: ",?25,$J(^TMP("PSDAMISG",$J),6),!,"Cost of Orders: ",?44,$J(^TMP("PSDAMISCG",$J),8,2),!
"RTN","PSDAMIS3",53,0)
 W "Average Cost Per Order: ",?44,$J((^TMP("PSDAMISCG",$J)/^TMP("PSDAMISG",$J)),8,2),!
"RTN","PSDAMIS3",54,0)
 Q
"RTN","PSDAMIS4")
0^20^B9598560
"RTN","PSDAMIS4",1,0)
PSDAMIS4 ;BIR/JPW-Print NAOU AMIS Summary Totals ; 1 Sept 94
"RTN","PSDAMIS4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAMIS4",3,0)
PRINT ;prints data for stock drugs
"RTN","PSDAMIS4",4,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDAMIS4",5,0)
 I '$D(^TMP("PSDAMIS",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" Q
"RTN","PSDAMIS4",6,0)
 S JJ="" F  S JJ=$O(^TMP("PSDAMISS",$J,JJ)) D:JJ="" GTOT Q:JJ=""!(PSDOUT)  D HDR Q:PSDOUT  S KK="" F  S KK=$O(^TMP("PSDAMISS",$J,JJ,KK)) D:KK="" NTOT Q:KK=""!(PSDOUT)  D TOT
"RTN","PSDAMIS4",7,0)
 Q
"RTN","PSDAMIS4",8,0)
HDR ;lists header information
"RTN","PSDAMIS4",9,0)
 Q:PSDOUT
"RTN","PSDAMIS4",10,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDAMIS4",11,0)
 W:$Y @IOF S PG=PG+1 W !,"SUMMARY NAOU/DRUG USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDAMIS4",12,0)
 I ANS="N",$D(JJ) W "NAOU: ",JJ,!
"RTN","PSDAMIS4",13,0)
 I ANS="D",$D(JJ) W "DRUG: ",JJ,!
"RTN","PSDAMIS4",14,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDAMIS4",15,0)
 W !,?2,"=> ",$S(ANS="D":"NAOU",1:"DRUG"),!,"TOTAL # OF ORDERS",?30,"TOTAL QUANTITY",?60,"TOTAL COST",!,LN,!
"RTN","PSDAMIS4",16,0)
 Q
"RTN","PSDAMIS4",17,0)
TOT Q:PSDOUT  I $Y+8>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS4",18,0)
 W !!,?2,"=> ",KK,!,$J(^TMP("PSDAMISS",$J,JJ,KK),8),?30,$J(^TMP("PSDAMISQ",$J,JJ,KK),8),?60,$J(^TMP("PSDAMISC",$J,JJ,KK),8,2)
"RTN","PSDAMIS4",19,0)
 Q
"RTN","PSDAMIS4",20,0)
NTOT Q:PSDOUT  I $Y+8>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS4",21,0)
 W !!,?2,"=> ",KK
"RTN","PSDAMIS4",22,0)
 W !!,$S(ANS="D":"DRUG",1:"NAOU")," Subtotals: ",!,"Number of Orders: ",?30,$J(^TMP("PSDAMIST",$J,JJ),8),! W:ANS="D" "Total Quantity: ",?30,$J(^TMP("PSDAMISQT",$J,JJ),8),!
"RTN","PSDAMIS4",23,0)
 W "Total Cost of Orders: ",?60,$J(^TMP("PSDAMISCN",$J,JJ),8,2)
"RTN","PSDAMIS4",24,0)
 W !,"Average Cost of Orders: ",?60,$S(+^TMP("PSDAMIST",$J,JJ):$J((^TMP("PSDAMISCN",$J,JJ)/^TMP("PSDAMIST",$J,JJ)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS4",25,0)
 Q
"RTN","PSDAMIS4",26,0)
GTOT ;grand totals
"RTN","PSDAMIS4",27,0)
 Q:PSDOUT  D HDR Q:PSDOUT
"RTN","PSDAMIS4",28,0)
 W !,"Grand Totals by Dispensing Site: ",PSDSN,!
"RTN","PSDAMIS4",29,0)
 S PSDSN="" F  S PSDSN=$O(^TMP("PSDAMISVG",$J,PSDSN)) Q:PSDSN=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDAMIS4",30,0)
 .I $Y+6>IOSL D HDR Q:PSDOUT
"RTN","PSDAMIS4",31,0)
 .W !,"Number of Orders: ",?30,$J(^TMP("PSDAMISVG",$J,PSDSN),6),!,"Cost of Orders: ",?60,$J(^TMP("PSDAMISCVG",$J,PSDSN),8,2),!
"RTN","PSDAMIS4",32,0)
 .W "Average Cost Per Order: ",?60,$S(+^TMP("PSDAMISVG",$J,PSDSN):$J((^TMP("PSDAMISCVG",$J,PSDSN)/^TMP("PSDAMISVG",$J,PSDSN)),8,2),1:$J("0.00",8,2)),!
"RTN","PSDAMIS4",33,0)
 D HDR Q:PSDOUT
"RTN","PSDAMIS4",34,0)
 W !!,"Grand Totals: ",!,"Number of Orders: ",?30,$J(^TMP("PSDAMISG",$J),8),!,"Cost of Orders: ",?60,$J(^TMP("PSDAMISCG",$J),8,2),!
"RTN","PSDAMIS4",35,0)
 W "Average Cost Per Order: ",?60,$J((^TMP("PSDAMISCG",$J)/^TMP("PSDAMISG",$J)),8,2),!
"RTN","PSDAMIS4",36,0)
 Q
"RTN","PSDAPU")
0^21^B502049
"RTN","PSDAPU",1,0)
PSDAPU ;BIR/JPW-Mark/Unmark Drugs for CS Appl. Pkg. Use ; 8 Aug 94
"RTN","PSDAPU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDAPU",3,0)
 S PSIUX="N^CONTROLLED SUBSTANCES"
"RTN","PSDAPU",4,0)
 K DIC F  W ! S DIC=50,DIC("A")="Select DRUG: ",DIC(0)="QEAMZ" D ^DIC K DIC Q:Y<0  S PSIUDA=+Y D ^PSGIU
"RTN","PSDAPU",5,0)
END K DIC,DTOUT,DUOUT,PSIUA,PSIUDA,PSIUX,X,Y
"RTN","PSDBAL")
0^22^B16952502
"RTN","PSDBAL",1,0)
PSDBAL ;BIR/JPW-Display/Print Current Drug Balance ; 29 Aug 94
"RTN","PSDBAL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDBAL",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDBAL",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ))&('$D(^XUSEC("PSD TECH",DUZ))) W !!,"Contact your Pharmacy Coordinator for access to display current CS drug",!,"balances.",!!,"PSJ RPHARM or PSD TECH security key required.",! Q
"RTN","PSDBAL",5,0)
ASKD ;ask disp location
"RTN","PSDBAL",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDBAL",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDBAL",8,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDBAL",9,0)
 S DIC("A")="Select Primary Dispensing Site: "
"RTN","PSDBAL",10,0)
 S DIC("B")=PSDSN
"RTN","PSDBAL",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDBAL",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDBAL",13,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDBAL",14,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDBAL",15,0)
DRUG ;ask drug
"RTN","PSDBAL",16,0)
 W ! K DA,DIC
"RTN","PSDBAL",17,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDBAL",18,0)
 .S PSDR(+Y)=""
"RTN","PSDBAL",19,0)
 I '$D(PSDR)&(X'="^ALL") G END
"RTN","PSDBAL",20,0)
 I X="^ALL" S ALL=1
"RTN","PSDBAL",21,0)
DEV ;sel device
"RTN","PSDBAL",22,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDBAL",23,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !!,"NO DEVICE SELECTED OR REPORT PRINTED!!",! G END
"RTN","PSDBAL",24,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDBAL",ZTDESC="CS PHARM List Stock Balances" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDBAL",25,0)
 U IO
"RTN","PSDBAL",26,0)
START ;entry for compile
"RTN","PSDBAL",27,0)
 K ^TMP("PSDBAL",$J)
"RTN","PSDBAL",28,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,+PSDS,1,PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S PSDR(+PSD)=""
"RTN","PSDBAL",29,0)
 F PSD=0:0 S PSD=$O(PSDR(PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S NODE=^(0) D
"RTN","PSDBAL",30,0)
 .S PSDOK="" I +$P(NODE,"^",14),+$P(NODE,"^",14)'>DT Q:'+$P(NODE,"^",4)  S PSDOK="*"
"RTN","PSDBAL",31,0)
 .S BAL=+$P(NODE,"^",4),PSDRN=$S($P($G(^PSDRUG(+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD_" NAME MISSING"),EXP=$S(+$P(NODE,"^",12):+$P(NODE,"^",12),1:"")
"RTN","PSDBAL",32,0)
 .I EXP S Y=EXP X ^DD("DD") S EXP=Y
"RTN","PSDBAL",33,0)
 .S ^TMP("PSDBAL",$J,PSDRN,PSD)=BAL_"^"_PSDOK_"^"_EXP
"RTN","PSDBAL",34,0)
PRINT ;prints data
"RTN","PSDBAL",35,0)
 S (PG,PSDOUT)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDBAL",36,0)
 K LN S $P(LN,"-",80)="" D HDR
"RTN","PSDBAL",37,0)
 I '$D(^TMP("PSDBAL",$J)) W !!,?15,"**** NO STOCK BALANCE DATA AVAILABLE ****",!! G DONE
"RTN","PSDBAL",38,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDBAL",$J,PSDR)) Q:PSDR=""!(PSDOUT)  F PSD=0:0 S PSD=$O(^TMP("PSDBAL",$J,PSDR,PSD)) Q:'PSD  D
"RTN","PSDBAL",39,0)
 .D:$Y+4>IOSL HDR Q:PSDOUT
"RTN","PSDBAL",40,0)
 .S NODE=^TMP("PSDBAL",$J,PSDR,PSD),BAL=+NODE,PSDOK=$P(NODE,"^",2),EXP=$P(NODE,"^",3)
"RTN","PSDBAL",41,0)
 .W !,PSDOK,?2,PSDR,?63,$J(BAL,6),! W:EXP]"" ?5,"Expiration Date: ",EXP,!
"RTN","PSDBAL",42,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDBAL",43,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDBAL",44,0)
END ;
"RTN","PSDBAL",45,0)
 K %,%H,%I,%ZIS,ALL,BAL,C,DA,DIC,DTOUT,DUOUT,EXP,LN,NODE,PG,POP,PSD,PSDEV,PSDOK,PSDOUT,PSDR,PSDRN,PSDS,PSDSN,RPDT,X,Y
"RTN","PSDBAL",46,0)
 K ^TMP("PSDBAL",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDBAL",47,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDBAL",48,0)
 Q
"RTN","PSDBAL",49,0)
SAVE S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDSITE"))=""
"RTN","PSDBAL",50,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDR) ZTSAVE("PSDR(")=""
"RTN","PSDBAL",51,0)
 Q
"RTN","PSDBAL",52,0)
HDR ;header
"RTN","PSDBAL",53,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDBAL",54,0)
 S PG=PG+1 W:$Y @IOF W !,?12,"Current Stock Balances for ",PSDSN,?72,"Page: ",PG,!,?20,RPDT,!!
"RTN","PSDBAL",55,0)
 W ?5,"DRUG",?60,"CURRENT BALANCE",!,LN,!!
"RTN","PSDBAL",56,0)
 Q
"RTN","PSDBALI")
0^23^B22304429
"RTN","PSDBALI",1,0)
PSDBALI ;BIR/JPW-Display/Print Drug Inv Sheet & Balance ; 29 Aug 94
"RTN","PSDBALI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDBALI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDBALI",4,0)
ASKD ;ask disp location
"RTN","PSDBALI",5,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDBALI",6,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDBALI",7,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDBALI",8,0)
 S DIC("A")="Select Primary Dispensing Site: "
"RTN","PSDBALI",9,0)
 S DIC("B")=PSDSN
"RTN","PSDBALI",10,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDBALI",11,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDBALI",12,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDBALI",13,0)
SORT ;asks sort
"RTN","PSDBALI",14,0)
 W ! K DA,DIR,DIRUT S DIR(0)="YO",DIR("A")="Do you wish to sort by Inventory Type",DIR("B")="NO"
"RTN","PSDBALI",15,0)
 S DIR("?")="Answer YES to sort drugs by Inventory Type, NO or <RET> to sort by drug."
"RTN","PSDBALI",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASKN=Y
"RTN","PSDBALI",17,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDBALI",18,0)
DRUG ;ask drug
"RTN","PSDBALI",19,0)
 W ! K DA,DIC
"RTN","PSDBALI",20,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDBALI",21,0)
 .S PSDR(+Y)=""
"RTN","PSDBALI",22,0)
 I '$D(PSDR)&(X'="^ALL") G END
"RTN","PSDBALI",23,0)
 I X="^ALL" S ALL=1
"RTN","PSDBALI",24,0)
DEV ;sel device
"RTN","PSDBALI",25,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDBALI",26,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !!,"NO DEVICE SELECTED OR REPORT PRINTED!!",! G END
"RTN","PSDBALI",27,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDBALI",ZTDESC="CS PHARM Print Inv Sheet " D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDBALI",28,0)
 U IO
"RTN","PSDBALI",29,0)
START ;entry for compile
"RTN","PSDBALI",30,0)
 K ^TMP("PSDBALI",$J)
"RTN","PSDBALI",31,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,+PSDS,1,PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S PSDR(+PSD)=""
"RTN","PSDBALI",32,0)
 F PSD=0:0 S PSD=$O(PSDR(PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S NODE=^(0) D
"RTN","PSDBALI",33,0)
 .S PSDOK="" I +$P(NODE,"^",14),+$P(NODE,"^",14)'>DT Q:'+$P(NODE,"^",4)  S PSDOK="*"
"RTN","PSDBALI",34,0)
 .S BAL=+$P(NODE,"^",4),DRUGN=$S($P($G(^PSDRUG(+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD_" NAME MISSING"),SLVL=+$P(NODE,"^",3),EXP=$S(+$P(NODE,"^",12):+$P(NODE,"^",12),1:"")
"RTN","PSDBALI",35,0)
 .I EXP S Y=EXP X ^DD("DD") S EXP=Y
"RTN","PSDBALI",36,0)
 .I ASKN D LOOP Q
"RTN","PSDBALI",37,0)
 .S ^TMP("PSDBALI",$J,DRUGN,PSD)=BAL_"^"_PSDOK_"^"_SLVL_"^"_EXP
"RTN","PSDBALI",38,0)
PRINT ;prints data
"RTN","PSDBALI",39,0)
 S (PG,PSDOUT)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDBALI",40,0)
 K LN S $P(LN,"-",80)="" D HDR
"RTN","PSDBALI",41,0)
 I '$D(^TMP("PSDBALI",$J)) W !!,?15,"**** NO STOCK BALANCE DATA AVAILABLE ****",!! G DONE
"RTN","PSDBALI",42,0)
 I ASKN D PRINT^PSDBALI1 G DONE
"RTN","PSDBALI",43,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDBALI",$J,PSDR)) Q:PSDR=""!(PSDOUT)  F PSD=0:0 S PSD=$O(^TMP("PSDBALI",$J,PSDR,PSD)) Q:'PSD  D  Q:PSDOUT
"RTN","PSDBALI",44,0)
 .I $Y+6>IOSL W !,?10,"Inspector's Signature: ______________________________",! D HDR Q:PSDOUT
"RTN","PSDBALI",45,0)
 .S NODE=^TMP("PSDBALI",$J,PSDR,PSD),BAL=+NODE,PSDOK=$P(NODE,"^",2),SLVL=$P(NODE,"^",3),EXP=$P(NODE,"^",4)
"RTN","PSDBALI",46,0)
 .W !,PSDOK,?2,PSDR,?50,$J(BAL,6),?66,"___________",! W:SLVL ?5,"Stock Level: ",SLVL W:EXP]"" ?30,"Exp. Date: ",EXP W ! S LNUM=$Y
"RTN","PSDBALI",47,0)
PRT ;
"RTN","PSDBALI",48,0)
 I LNUM<IOSL-5 F JJ=LNUM:1:IOSL-5 W !
"RTN","PSDBALI",49,0)
 W:'PSDOUT ?10,"Inspector's Signature: ______________________________",!
"RTN","PSDBALI",50,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDBALI",51,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDBALI",52,0)
END ;
"RTN","PSDBALI",53,0)
 K %,%H,%I,%ZIS,ALL,ASKN,BAL,C,DA,DIC,DRUGN,DTOUT,DUOUT,EXP,JJ,LN,LNUM,NODE,PG,POP,PSD,PSDEV,PSDOK,PSDOUT,PSDR,PSDRN,PSDS,PSDSN,RPDT,SLVL,TYP,TYPN,X,Y
"RTN","PSDBALI",54,0)
 K ^TMP("PSDBALI",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDBALI",55,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDBALI",56,0)
 Q
"RTN","PSDBALI",57,0)
SAVE S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDSITE"),ZTSAVE("ASKN"))=""
"RTN","PSDBALI",58,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDR) ZTSAVE("PSDR(")=""
"RTN","PSDBALI",59,0)
 Q
"RTN","PSDBALI",60,0)
HDR ;header
"RTN","PSDBALI",61,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDBALI",62,0)
 S PG=PG+1 W:$Y @IOF W !,?12,"Inventory Sheet for ",PSDSN,?72,"Page: ",PG,!,?20,RPDT,!!
"RTN","PSDBALI",63,0)
 W ?5,"DRUG",?46,"CURRENT BALANCE",?68,"ON-HAND",!,LN,!!
"RTN","PSDBALI",64,0)
 Q
"RTN","PSDBALI",65,0)
LOOP ;sets inv type
"RTN","PSDBALI",66,0)
 I '$O(^PSD(58.8,+PSDS,1,+PSD,2,0)) S TYPN="ZZ** NO INVENTORY TYPE DATA **" D LOOP1
"RTN","PSDBALI",67,0)
 F TYP=0:0 S TYP=$O(^PSD(58.8,+PSDS,1,+PSD,2,TYP)) Q:'TYP  S TYPN=$S($P($G(^PSI(58.16,+TYP,0)),"^")]"":$P(^(0),"^"),1:"TYPE NAME MISSING") D LOOP1
"RTN","PSDBALI",68,0)
 Q
"RTN","PSDBALI",69,0)
LOOP1 S ^TMP("PSDBALI",$J,TYPN,DRUGN,PSD)=BAL_"^"_PSDOK_"^"_SLVL_"^"_EXP
"RTN","PSDBALI",70,0)
 Q
"RTN","PSDBALI1")
0^24^B4606716
"RTN","PSDBALI1",1,0)
PSDBALI1 ;BIR/JPW-Display/Prt Drug Inv Sheet & Bal (cont'd) ; 12 Apr 94
"RTN","PSDBALI1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDBALI1",3,0)
PRINT ;prints data
"RTN","PSDBALI1",4,0)
 S TYPN="" F  S TYPN=$O(^TMP("PSDBALI",$J,TYPN)) Q:TYPN=""!(PSDOUT)  W !,?2,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! D
"RTN","PSDBALI1",5,0)
 .S PSDR="" F  S PSDR=$O(^TMP("PSDBALI",$J,TYPN,PSDR)) Q:PSDR=""!(PSDOUT)  F PSD=0:0 S PSD=$O(^TMP("PSDBALI",$J,TYPN,PSDR,PSD)) Q:'PSD  D  Q:PSDOUT
"RTN","PSDBALI1",6,0)
 ..I $Y+6>IOSL W !,?10,"Inspector's Signature: ______________________________",! D HDR Q:PSDOUT  W !,?2,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),!
"RTN","PSDBALI1",7,0)
 ..S NODE=^TMP("PSDBALI",$J,TYPN,PSDR,PSD),BAL=+NODE,PSDOK=$P(NODE,"^",2),SLVL=$P(NODE,"^",3),EXP=$P(NODE,"^",4)
"RTN","PSDBALI1",8,0)
 ..W !,PSDOK,?2,PSDR,?50,$J(BAL,6),?66,"___________",! W:SLVL ?5,"Stock Level: ",SLVL W:EXP]"" ?30,"Exp. Date: ",EXP W ! S LNUM=$Y
"RTN","PSDBALI1",9,0)
PRT ;
"RTN","PSDBALI1",10,0)
 I LNUM<IOSL-5 F JJ=LNUM:1:IOSL-5 W !
"RTN","PSDBALI1",11,0)
 W:'PSDOUT ?10,"Inspector's Signature: ______________________________",!
"RTN","PSDBALI1",12,0)
 Q
"RTN","PSDBALI1",13,0)
HDR ;header
"RTN","PSDBALI1",14,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDBALI1",15,0)
 S PG=PG+1 W:$Y @IOF W !,?12,"Inventory Sheet for ",PSDSN,?72,"Page: ",PG,!,?20,RPDT,!!
"RTN","PSDBALI1",16,0)
 W ?5,"DRUG",?46,"CURRENT BALANCE",?68,"ON-HAND",!,LN,!!
"RTN","PSDBALI1",17,0)
 Q
"RTN","PSDBAN")
0^263^B16651142
"RTN","PSDBAN",1,0)
PSDBAN ;BIR/JPW,LTL-Nurse BAL Report ; 8 Aug 94
"RTN","PSDBAN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDBAN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDBAN",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,$D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDBAN",5,0)
 ;I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print this report.",! K OK Q
"RTN","PSDBAN",6,0)
 ;G:$G(NAOU)&($G(NAOUN)]"") ALL
"RTN","PSDBAN",7,0)
ASKN ;ask naou
"RTN","PSDBAN",8,0)
 K DA,DIC
"RTN","PSDBAN",9,0)
 S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: ",DIC("B")=$G(NAOUN)
"RTN","PSDBAN",10,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)" D ^DIC K DIC G:Y<0 END
"RTN","PSDBAN",11,0)
 S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDBAN",12,0)
ALL ;asks for all orders
"RTN","PSDBAN",13,0)
 ;W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print this report for all drugs",DIR("B")="YES"
"RTN","PSDBAN",14,0)
 W ! K DA,DIR,DIRUT
"RTN","PSDBAN",15,0)
 S DIR(0)="S^A:All Drugs;S:Single Drug;C:Contingency Report;G:All drugs (including green sheets)"
"RTN","PSDBAN",16,0)
 S DIR("A")="Please select type of report",DIR("B")="All Drugs"
"RTN","PSDBAN",17,0)
 S DIR("?",1)="Answer 'A' to list all balances for this NAOU,",DIR("?")="answer 'S' to show the balance for a specific drug or '^' to quit."
"RTN","PSDBAN",18,0)
 D ^DIR K DIR G:$D(DIRUT) END S ALL=Y
"RTN","PSDBAN",19,0)
 G:ALL="A"!(ALL="G") DEV G:ALL="C" DEV^PSDBAN1
"RTN","PSDBAN",20,0)
DRUG ;select drugs
"RTN","PSDBAN",21,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDBAN",22,0)
 S DA(1)=+NAOU,DIC(0)="QEAM",DIC="^PSD(58.8,"_NAOU_",1," D ^DIC K DIC G:Y<0 END W !!,"Balance:  ",$P($G(^PSD(58.8,NAOU,1,+Y,0)),U,4)," ",$S($P($G(^PSD(58.8,NAOU,1,+Y,0)),U,8)]"":$P($G(^(0)),U,8),1:$P($G(^PSDRUG(+Y,660)),U,8)),!! Q
"RTN","PSDBAN",23,0)
DEV ;ask device and queue info
"RTN","PSDBAN",24,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDBAN",25,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="HOME" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDBAN",26,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDBAN",ZTDESC="Balance of NAOU drugs" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDBAN",27,0)
 U IO
"RTN","PSDBAN",28,0)
START ;loops thru DRUGS
"RTN","PSDBAN",29,0)
 W !!,"Give me a second or two to alphabetize.",!
"RTN","PSDBAN",30,0)
 N PSDRUG,PSDRUGN S PSDRUG=0,PSDRUGN="" K ^TMP("PSDNST",$J)
"RTN","PSDBAN",31,0)
 F  S PSDRUG=$O(^PSD(58.8,NAOU,1,PSDRUG)) Q:'PSDRUG  D:$P($G(^PSD(58.8,NAOU,1,PSDRUG,0)),U,4)
"RTN","PSDBAN",32,0)
 .S ^TMP("PSDNST",$J,$P($G(^PSDRUG(+PSDRUG,0)),U))=$P($G(^PSD(58.8,NAOU,1,PSDRUG,0)),U,4)_" "_$S($P($G(^(0)),U,8)]"":$P($G(^(0)),U,8),1:$P($G(^PSDRUG(PSDRUG,660)),U,8))
"RTN","PSDBAN",33,0)
PRINT ;prints the report
"RTN","PSDBAN",34,0)
 S (PG,PSDOUT)=0,RPDT=$$HTE^XLFDT($H)
"RTN","PSDBAN",35,0)
 K LN S $P(LN,"-",80)="" D HDR I '$D(^TMP("PSDNST",$J)) W !!,?10,"****  NO BALANCES TO REPORT  ****" G END
"RTN","PSDBAN",36,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDNST",$J,PSDR)) Q:PSDR=""!(PSDOUT)  W !,?2,"=>  ",PSDR,?62,$G(^TMP("PSDNST",$J,PSDR)),! Q:PSDOUT
"RTN","PSDBAN",37,0)
 G:PSDOUT END
"RTN","PSDBAN",38,0)
 ;W:$O(^TMP("PSDNSU",$J,0))]"" !!,"The following drugs have Green Sheets:",!!
"RTN","PSDBAN",39,0)
 ;F  S PSDR=$O(^TMP("PSDNSU",$J,PSDR)) Q:PSDR=""!(PSDOUT)  W ?2,"=>  ",PSDR,?62,$G(^TMP("PSDNSU",$J,PSDR)),! Q:PSDOUT
"RTN","PSDBAN",40,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDBAN",41,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDBAN",42,0)
END D:$G(ALL)="G"&($D(ZTQUEUED)) START^PSDNSCG K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,OK,ORD
"RTN","PSDBAN",43,0)
 K PG,POP,PSDOUT,PSDPN,PSDR,PSDRN,PSDST,PSDT,QTY,REQ,RPDT,STAT,STATN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDNST",$J),^TMP("PSDNSU",$J)
"RTN","PSDBAN",44,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDBAN",45,0)
 Q
"RTN","PSDBAN",46,0)
HDR ;header for log
"RTN","PSDBAN",47,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDBAN",48,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"Controlled Substance Balances",?70,"Page: ",PG,!,?35,NAOUN,!,?25,RPDT,!
"RTN","PSDBAN",49,0)
 W !,?2,"=> DRUG",?62,"QUANTITY",!
"RTN","PSDBAN",50,0)
 W !,LN,!
"RTN","PSDBAN",51,0)
 Q
"RTN","PSDBAN",52,0)
SAVE S (ZTSAVE("ALL"),ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" S:$D(PSDR) ZTSAVE("PSDR")=""
"RTN","PSDBAN",53,0)
 Q
"RTN","PSDBAN1")
0^268^B8172896
"RTN","PSDBAN1",1,0)
PSDBAN1 ;BIR/JPW,LTL-Nurse BAL Report ; 8 Aug 94
"RTN","PSDBAN1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDBAN1",3,0)
DEV ;ask device and queue info
"RTN","PSDBAN1",4,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDBAN1",5,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="HOME" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDBAN1",6,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDBAN1",ZTDESC="Balance of NAOU drugs, Contingency Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDBAN1",7,0)
 U IO
"RTN","PSDBAN1",8,0)
START ;loops thru DRUGS
"RTN","PSDBAN1",9,0)
 W !!,"Give me a second or two to alphabetize.",!
"RTN","PSDBAN1",10,0)
 N PSDRUG,PSDRUGN S PSDRUG=0,PSDRUGN="" K ^TMP("PSDNST",$J)
"RTN","PSDBAN1",11,0)
 F  S PSDRUG=$O(^PSD(58.8,NAOU,1,PSDRUG)) Q:'PSDRUG  D:$P($G(^PSD(58.8,NAOU,1,PSDRUG,0)),U,4)
"RTN","PSDBAN1",12,0)
 .S ^TMP("PSDNST",$J,$P($G(^PSDRUG(+PSDRUG,0)),U))=$P($G(^PSD(58.8,NAOU,1,PSDRUG,0)),U,4)_" "_$S($P($G(^(0)),U,8)]"":$P($G(^(0)),U,8),1:$P($G(^PSDRUG(PSDRUG,660)),U,8))
"RTN","PSDBAN1",13,0)
PRINT ;prints the report
"RTN","PSDBAN1",14,0)
 S (PG,PSDOUT)=0,RPDT=$$HTE^XLFDT($H)
"RTN","PSDBAN1",15,0)
 K LN S $P(LN,"-",80)="" D HDR I '$D(^TMP("PSDNST",$J)) W !!,?10,"****  NO BALANCES TO REPORT  ****" G END
"RTN","PSDBAN1",16,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDNST",$J,PSDR)) Q:PSDR=""!(PSDOUT)  D:$Y+16>IOSL HDR Q:$G(PSDOUT)  W !,?2,"=>  ",PSDR,?62,$G(^TMP("PSDNST",$J,PSDR)),! D ^PSDRPGS3 Q:PSDOUT
"RTN","PSDBAN1",17,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDBAN1",18,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDBAN1",19,0)
END K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,OK,ORD
"RTN","PSDBAN1",20,0)
 K PG,POP,PSDOUT,PSDPN,PSDR,PSDRN,PSDST,PSDT,QTY,REQ,RPDT,STAT,STATN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDBAN1",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDBAN1",22,0)
 Q
"RTN","PSDBAN1",23,0)
HDR ;header for log
"RTN","PSDBAN1",24,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDBAN1",25,0)
 S PG=PG+1 W:$Y @IOF W !,?5,"Controlled Substance Balances, Contingency Report",?70,"Page: ",PG,!,?35,NAOUN,!,?25,RPDT,!
"RTN","PSDBAN1",26,0)
 W !,?2,"=> DRUG",?62,"QUANTITY",!
"RTN","PSDBAN1",27,0)
 W !,LN,!
"RTN","PSDBAN1",28,0)
 Q
"RTN","PSDBAN1",29,0)
SAVE S (ZTSAVE("ALL"),ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" S:$D(PSDR) ZTSAVE("PSDR")=""
"RTN","PSDBAN1",30,0)
 Q
"RTN","PSDCODE")
0^25^B1340519
"RTN","PSDCODE",1,0)
PSDCODE ;BIR/JPW-Enter/Edit Drug Location Codes ; 6 July 94
"RTN","PSDCODE",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCODE",3,0)
CODE ;entry for drug location codes into file 58.17
"RTN","PSDCODE",4,0)
 K DA,DIC,DLAYGO F  W ! S (DIC,DLAYGO)=58.17,DIC(0)="QEAL",DIC("A")="Select DRUG ADDRESS CODE: " D ^DIC K DIC,DLAYGO Q:Y<0  K DA,DIE,DR S DIE=58.17,DA=+Y,DR=".01DRUG ADDRESS CODE;.5" D ^DIE K DIE,DR
"RTN","PSDCODE",5,0)
END K DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","PSDCOR")
0^26^B19035165
"RTN","PSDCOR",1,0)
PSDCOR ;BIR/JPW-CS Correction Action ; 6 July 94
"RTN","PSDCOR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOR",3,0)
EN1 ;sets type=1
"RTN","PSDCOR",4,0)
 S TYPE=1 G START
"RTN","PSDCOR",5,0)
EN2 ;sets type=2
"RTN","PSDCOR",6,0)
 S TYPE=2 G START
"RTN","PSDCOR",7,0)
EN3 ;sets type=3
"RTN","PSDCOR",8,0)
 S TYPE=3
"RTN","PSDCOR",9,0)
START ;start proc
"RTN","PSDCOR",10,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCOR",11,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to correct",!,?12,"narcotic orders.",!!,"PSDMGR security key required.",! K TYPE Q
"RTN","PSDCOR",12,0)
 W !!,"Controlled Substances Correction Action" S PSDUZ=DUZ
"RTN","PSDCOR",13,0)
 G:TYPE=2 ^PSDCOR1 G:TYPE=3 ^PSDCOR2
"RTN","PSDCOR",14,0)
ASKN ;ask naou
"RTN","PSDCOR",15,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: "
"RTN","PSDCOR",16,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDCOR",17,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDCOR",18,0)
GS ;select green sheet #
"RTN","PSDCOR",19,0)
 W $C(7),!!,?15,"** NOTE **",!,"Your Green Sheet selection is limited to those Green Sheets flagged as",!,"'COMPLETED - GREEN SHEET READY FOR PICKUP' on the selected NAOU.",!
"RTN","PSDCOR",20,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDCOR",21,0)
 S DIC("S")="I $P(^(0),""^"",11)=5,$P(^(0),""^"",18)=AOU"
"RTN","PSDCOR",22,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDCOR",23,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDCOR",24,0)
 S PSDS=+$P(Y(0),"^",3)
"RTN","PSDCOR",25,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5)
"RTN","PSDCOR",26,0)
 S NURS=$P($G(^PSD(58.81,PSDA,1)),"^",10)
"RTN","PSDCOR",27,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCOR",28,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDCOR",29,0)
 I STAT'=5 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCOR",30,0)
ASK W !!,"This action will update Green Sheet #",PSDPN," as ",!,?5,"** DELIVERED - ACTIVELY ON NAOU **",!
"RTN","PSDCOR",31,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDCOR",32,0)
 S DIR("?",1)="Answer 'YES' to update the status to 'DELIVERED - ACTIVELY ON NAOU' or",DIR("?")="answer 'NO' to quit and the status will remain 'COMPLETED - GREEN SHEET READY FOR PICKUP'."
"RTN","PSDCOR",33,0)
 D ^DIR K DIR I 'Y W !!,"No action taken.",!! G END
"RTN","PSDCOR",34,0)
COM ;complete correction
"RTN","PSDCOR",35,0)
 D NOW^%DTC S RECDT=+$E(%,1,12)
"RTN","PSDCOR",36,0)
 W !!,"Accessing Green Sheet #",PSDPN," information...",!!
"RTN","PSDCOR",37,0)
 F  L +^PSD(58.87,0):0 I  Q
"RTN","PSDCOR",38,0)
FIND S PSDCOR=$P(^PSD(58.87,0),"^",3)+1 I $D(^PSD(58.87,PSDCOR)) S $P(^PSD(58.87,0),"^",3)=PSDCOR G FIND
"RTN","PSDCOR",39,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.87,DIC(0)="L",X=PSDCOR D ^DIC K DIC,DLAYGO
"RTN","PSDCOR",40,0)
 L -^PSD(58.87,0)
"RTN","PSDCOR",41,0)
 K DA,DIE,DR S DIE=58.87,DA=PSDCOR,DR="1////"_RECDT_";2////"_PSDUZ_";3////"_PSDPN_";4////"_PSDR_";5////"_NAOU_";6////"_NURS_";8////"_ORD_";11////"_TYPE_";12////"_PSDS
"RTN","PSDCOR",42,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDCOR",43,0)
 W !!,"Updating your records now..."
"RTN","PSDCOR",44,0)
 ;update transaction file (58.81)
"RTN","PSDCOR",45,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="10////4" D ^DIE K DA,DIE,DR
"RTN","PSDCOR",46,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN CORRECTED **",!!,"The status remains "_STATN,! G END
"RTN","PSDCOR",47,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////4" D ^DIE K DA,DIE,DR
"RTN","PSDCOR",48,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,!,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDCOR",49,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT
"RTN","PSDCOR",50,0)
 K NAOU,NAOUN,NURS,OK,ORD,PSDA,PSDCOR,PSDPN,PSDR,PSDS,PSDUZ,RECDT,STAT,STATN,TYPE,X,Y
"RTN","PSDCOR",51,0)
 Q
"RTN","PSDCOR1")
0^27^B18800981
"RTN","PSDCOR1",1,0)
PSDCOR1 ;BIR/JPW-CS Correction Action (cont'd) ; 6 July 94
"RTN","PSDCOR1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOR1",3,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) GS
"RTN","PSDCOR1",4,0)
ASKD ;ask disp site
"RTN","PSDCOR1",5,0)
 K DA,DIC W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDCOR1",6,0)
 S DIC("B")=PSDSN
"RTN","PSDCOR1",7,0)
 D ^DIC K DIC G:Y<0 END S PSDS=+Y,PSDSN=$P(Y,"^",2)
"RTN","PSDCOR1",8,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDCOR1",9,0)
GS ;select green sheet #
"RTN","PSDCOR1",10,0)
 W $C(7),!!,?15,"** NOTE **"
"RTN","PSDCOR1",11,0)
 W !,"Your Green Sheet selection is limited to those Green Sheets added using the"
"RTN","PSDCOR1",12,0)
 W !,"Add Existing Green Sheets option.  The Green Sheet status must still be",!,"DELIVERED - ACTIVELY ON NAOU for you to make this correction.",!!
"RTN","PSDCOR1",13,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDCOR1",14,0)
 S DIC("S")="I $P(^(0),""^"",2)=12,$P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",11)=4"
"RTN","PSDCOR1",15,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDCOR1",16,0)
 I $D(^PSD(58.81,PSDA,7)) W $C(7),!!,"This Green Sheet has been transferred between NAOUs.",!,"You may not delete this Green Sheet.",! G END
"RTN","PSDCOR1",17,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDCOR1",18,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5)
"RTN","PSDCOR1",19,0)
 S PHARM=$P($G(^PSD(58.81,PSDA,1)),"^"),PSDT=$P(Y(0),"^",4),QTY=$P(Y(0),"^",6) I $D(^PSD(58.81,PSDA,4)),$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDCOR1",20,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDCOR1",21,0)
 I STAT'=4 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCOR1",22,0)
ASK W !!,"This action will delete Green Sheet #",PSDPN,"."
"RTN","PSDCOR1",23,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDCOR1",24,0)
 S DIR("?",1)="Answer 'YES' to delete the Green Sheet or",DIR("?")="answer 'NO' to quit and the Green Sheet data will not be deleted."
"RTN","PSDCOR1",25,0)
 D ^DIR K DIR I 'Y W !!,"No action taken.  The Green Sheet data still exists.",!! G END
"RTN","PSDCOR1",26,0)
COM ;complete correction
"RTN","PSDCOR1",27,0)
 D NOW^%DTC S RECDT=+$E(%,1,12)
"RTN","PSDCOR1",28,0)
 W !!,"Accessing Green Sheet #",PSDPN," information...",!!
"RTN","PSDCOR1",29,0)
 F  L +^PSD(58.87,0):0 I  Q
"RTN","PSDCOR1",30,0)
FIND S PSDCOR=$P(^PSD(58.87,0),"^",3)+1 I $D(^PSD(58.87,PSDCOR)) S $P(^PSD(58.87,0),"^",3)=PSDCOR G FIND
"RTN","PSDCOR1",31,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.87,DIC(0)="L",X=PSDCOR D ^DIC K DIC,DLAYGO
"RTN","PSDCOR1",32,0)
 L -^PSD(58.87,0)
"RTN","PSDCOR1",33,0)
 K DA,DIE,DR S DIE=58.87,DA=PSDCOR,DR="1////"_RECDT_";2////"_PSDUZ_";3////"_PSDPN_";4////"_PSDR_";5////"_NAOU_";7////"_PSDT_";8////"_ORD_";9////"_PHARM_";10////"_QTY_";11////"_TYPE_";12////"_PSDS
"RTN","PSDCOR1",34,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDCOR1",35,0)
 W !!,"Updating your records now..."
"RTN","PSDCOR1",36,0)
 ;update transaction file (58.81)
"RTN","PSDCOR1",37,0)
 K DA,DIE,DR S DIDEL=58.81,DA=PSDA,DIE=58.81,DR=".01////@" D ^DIE K DA,DIE,DR,DIDEL
"RTN","PSDCOR1",38,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN CORRECTED **",!!,"The status remains "_STATN,! G END
"RTN","PSDCOR1",39,0)
 K DA,DIE,DR S DIDEL=58.800119,DA=PSDA,DA(1)=PSDR,DA(2)=+PSDS,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",4,",DR=".01////@" D ^DIE K DA,DIE,DR,DIDEL
"RTN","PSDCOR1",40,0)
 K DA,DIE,DR S DIDEL=58.800118,DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR=".01////@" D ^DIE K DA,DIE,DR,DIDEL
"RTN","PSDCOR1",41,0)
 W ?2,!,"*** Your Green Sheet #"_PSDPN_" has been deleted. ***",!,"If you wish to add this Green Sheet again,",!,"please use the 'Add Existing Green Sheets' option.",!
"RTN","PSDCOR1",42,0)
END K %,%DT,%H,%I,D,DA,DIC,DIDEL,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT
"RTN","PSDCOR1",43,0)
 K NAOU,NAOUN,OK,ORD,PHARM,PSDA,PSDCOR,PSDPN,PSDR,PSDS,PSDSN,PSDT,PSDUZ,QTY,RECDT,STAT,STATN,TYPE,X,Y
"RTN","PSDCOR1",44,0)
 Q
"RTN","PSDCOR2")
0^28^B19079222
"RTN","PSDCOR2",1,0)
PSDCOR2 ;BIR/JPW-CS Correction Action (cont'd) ; 6 July 94
"RTN","PSDCOR2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOR2",3,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) GS
"RTN","PSDCOR2",4,0)
ASKD ;ask disp site
"RTN","PSDCOR2",5,0)
 K DA,DIC W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)",DIC("B")=PSDSN
"RTN","PSDCOR2",6,0)
 D ^DIC K DIC G:Y<0 END S PSDS=+Y,PSDSN=$P(Y,"^",2)
"RTN","PSDCOR2",7,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDCOR2",8,0)
GS ;select green sheet #
"RTN","PSDCOR2",9,0)
 W $C(7),!!,?15,"** NOTE **",!,"Your Green Sheet selection is limited to those Green Sheets marked as",!,"COMPLETED - REVIEWED NO DISCREPANCY.",!
"RTN","PSDCOR2",10,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDCOR2",11,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",11)=7,$P(^(0),""^"",12)=1"
"RTN","PSDCOR2",12,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDCOR2",13,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDCOR2",14,0)
 S COMP=+$P(Y(0),"^",12),COMPN=$P($G(^PSD(58.83,COMP,0)),"^")
"RTN","PSDCOR2",15,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5)
"RTN","PSDCOR2",16,0)
 S CPBY=+$P($G(^PSD(58.81,PSDA,1)),"^",14),CPBYD=+$P(Y(0),"^",19)
"RTN","PSDCOR2",17,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDCOR2",18,0)
 I STAT'=7 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCOR2",19,0)
ASKS ;ask new stat
"RTN","PSDCOR2",20,0)
 K DA,DIC S DIC=58.83,DIC(0)="QEA",DIC("A")="Select Completion Status: ",DIC("S")="I $S(Y<4:0,1:1)"
"RTN","PSDCOR2",21,0)
 D ^DIC K DIC I Y<0 G END
"RTN","PSDCOR2",22,0)
 S NCOMP=+Y,NCOMPN=$P($G(^PSD(58.83,NCOMP,0)),"^")
"RTN","PSDCOR2",23,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to update the status",DIR("?")="or 'NO' to select another status."
"RTN","PSDCOR2",24,0)
 S DIR("B")="YES" D ^DIR K DIR G:$D(DIRUT) END I 'Y G ASKS
"RTN","PSDCOR2",25,0)
ASK W !!,"This action will update Green Sheet #",PSDPN," as ",!,?5,"** COMPLETED - PENDING PROBLEM RESOLUTION",!,?8,NCOMPN," **",!
"RTN","PSDCOR2",26,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDCOR2",27,0)
 S DIR("?",1)="Answer 'YES' to update the status to COMPLETED - PENDING PROBLEM",DIR("?",2)="RESOLUTION "_NCOMPN_" or answer 'NO' to quit",DIR("?")="and the status will remain COMPLETED - REVIEWED NO DISCREPANCY."
"RTN","PSDCOR2",28,0)
 D ^DIR K DIR I 'Y W !!,"No action taken.",!! G END
"RTN","PSDCOR2",29,0)
COM ;complete correction
"RTN","PSDCOR2",30,0)
 D NOW^%DTC S RECDT=+$E(%,1,12)
"RTN","PSDCOR2",31,0)
 W !!,"Accessing Green Sheet #",PSDPN," information...",!!
"RTN","PSDCOR2",32,0)
 F  L +^PSD(58.87,0):0 I  Q
"RTN","PSDCOR2",33,0)
FIND S PSDCOR=$P(^PSD(58.87,0),"^",3)+1 I $D(^PSD(58.87,PSDCOR)) S $P(^PSD(58.87,0),"^",3)=PSDCOR G FIND
"RTN","PSDCOR2",34,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.87,DIC(0)="L",X=PSDCOR D ^DIC K DIC,DLAYGO
"RTN","PSDCOR2",35,0)
 L -^PSD(58.87,0)
"RTN","PSDCOR2",36,0)
 K DA,DIE,DR S DIE=58.87,DA=PSDCOR,DR="1////"_RECDT_";2////"_PSDUZ_";3////"_PSDPN_";4////"_PSDR_";5////"_NAOU_";7////"_CPBYD_";8////"_ORD_";9////"_CPBY_";11////"_TYPE_";12////"_PSDS_";13////"_COMP_";14////"_NCOMP
"RTN","PSDCOR2",37,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDCOR2",38,0)
 W !!,"Updating your records now..."
"RTN","PSDCOR2",39,0)
 ;update transaction file (58.81)
"RTN","PSDCOR2",40,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="10////8;11////"_NCOMP D ^DIE K DA,DIE,DR
"RTN","PSDCOR2",41,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN CORRECTED **",!!,"The status remains "_STATN,! G END
"RTN","PSDCOR2",42,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////8;11////"_NCOMP D ^DIE K DA,DIE,DR
"RTN","PSDCOR2",43,0)
 S STAT=+$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,!,"*** Your Green Sheet #"_PSDPN_" is now ",!
"RTN","PSDCOR2",44,0)
 S COMP=+$P($G(^PSD(58.81,PSDA,0)),"^",12) W ?2,$S($P($G(^PSD(58.83,COMP,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDCOR2",45,0)
END K %,%DT,%H,%I,COMP,COMPN,CPBY,CPBYD,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT
"RTN","PSDCOR2",46,0)
 K NAOU,NAOUN,NCOMP,NCOMPN,OK,ORD,PSDA,PSDCOR,PSDPN,PSDR,PSDS,PSDSN,PSDUZ,RECDT,STAT,STATN,TYPE,X,Y
"RTN","PSDCOR2",47,0)
 Q
"RTN","PSDCOR3")
0^29^B2229614
"RTN","PSDCOR3",1,0)
PSDCOR3 ;BIR/JPW-CS Correction Action (cont'd) ; 22 May 93
"RTN","PSDCOR3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOR3",3,0)
COM ;complete correction
"RTN","PSDCOR3",4,0)
 S CPBYD=+$P(NODE,"^",19)
"RTN","PSDCOR3",5,0)
 F  L +^PSD(58.87,0):0 I  Q
"RTN","PSDCOR3",6,0)
FIND S PSDCOR=$P(^PSD(58.87,0),"^",3)+1 I $D(^PSD(58.87,PSDCOR)) S $P(^PSD(58.87,0),"^",3)=PSDCOR G FIND
"RTN","PSDCOR3",7,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.87,DIC(0)="L",X=PSDCOR D ^DIC K DIC,DLAYGO
"RTN","PSDCOR3",8,0)
 L -^PSD(58.87,0)
"RTN","PSDCOR3",9,0)
 K DA,DIE,DR S DIE=58.87,DA=PSDCOR,DR="1////"_RECDT_";2////"_PSDUZ_";3////"_PSDPN_";4////"_PSDR_";5////"_NAOU_";7////"_CPBYD_";8////"_ORD_";9////"_CPBY_";11////"_TYPE_";12////"_PSDS_";13////"_OCOMP_";14////"_COMP
"RTN","PSDCOR3",10,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDCOR3",11,0)
END K CPBY,CPBYD,PSDCOR
"RTN","PSDCOR3",12,0)
 Q
"RTN","PSDCORP")
0^30^B14173297
"RTN","PSDCORP",1,0)
PSDCORP ;BIR/JPW-CS Correction Log Report ; 29 Aug 94
"RTN","PSDCORP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCORP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCORP",4,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"the narcotic corrections log.",!!,"PSDMGR security key required.",! Q
"RTN","PSDCORP",5,0)
ASKD ;ask disp site
"RTN","PSDCORP",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDCORP",7,0)
 G:$P(PSDSITE,U,5) TYPE
"RTN","PSDCORP",8,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDCORP",9,0)
 S DIC("A")="Select Primary Dispensing Site: "
"RTN","PSDCORP",10,0)
 S DIC("B")=PSDSN
"RTN","PSDCORP",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDCORP",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDCORP",13,0)
TYPE ;ask correction type
"RTN","PSDCORP",14,0)
 K DA,DIR,DIRUT S DIR(0)="SO^1:GREEN SHEET READY FOR PICKUP CORRECTION;2:DELETE EXISTING GREEN SHEET CORRECTION;3:ERROR FOUND ON COMPLETED GS;4:RESOLVED ERROR ON GREEN SHEET"
"RTN","PSDCORP",15,0)
 S DIR("A")="Select Type of Correction Log"
"RTN","PSDCORP",16,0)
 S DIR("?",1)="Answer '1' to print Green Sheets flagged ready for pickup corrections,"
"RTN","PSDCORP",17,0)
 S DIR("?",2)="answer '2' to print existing Green Sheets deleted,",DIR("?",3)="answer '3' to print Green Sheets with an error found after initial completion,"
"RTN","PSDCORP",18,0)
 S DIR("?",4)="answer '4' to print Green Sheets with errors resolved  or",DIR("?")="answer '^' to quit without printing the report."
"RTN","PSDCORP",19,0)
 D ^DIR K DIR G:$D(DIRUT) END S TYPE=Y
"RTN","PSDCORP",20,0)
DATE ;ask date range
"RTN","PSDCORP",21,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDCORP",22,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDCORP",23,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDCORP",24,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDCORP",25,0)
DEV ;asks device and queueing information
"RTN","PSDCORP",26,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDCORP",27,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDCORP",28,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDCORP",29,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(TYPE=1:"^PSDCORP1",TYPE=2:"^PSDCORP2",1:"^PSDCORP3"),ZTDESC="CS PHARM Correction Log" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDCORP",30,0)
 U IO
"RTN","PSDCORP",31,0)
 G:TYPE=1 ^PSDCORP1 G:TYPE=2 ^PSDCORP2 G:TYPE=3 ^PSDCORP3 G:TYPE=4 ^PSDCORP3
"RTN","PSDCORP",32,0)
END K %,%DT,%H,%I,AOU,AOUN,C,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,IO("Q"),JJ,NODE,NUM,PG,POP,PSD,PSDATE,PSDED,PSDEV,PSDOUT,PSDS,PSDSD,PSDSN,PSDT,TYPE,X,Y
"RTN","PSDCORP",33,0)
 K ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDCORP",34,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCORP",35,0)
 Q
"RTN","PSDCORP",36,0)
SAVE S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("TYPE"))=""
"RTN","PSDCORP",37,0)
 Q
"RTN","PSDCORP1")
0^31^B10566121
"RTN","PSDCORP1",1,0)
PSDCORP1 ;BIR/JPW-CS Correction Log Status Changes ; 2 Aug 94
"RTN","PSDCORP1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCORP1",3,0)
START ;
"RTN","PSDCORP1",4,0)
 K ^TMP("PSDCOR",$J)
"RTN","PSDCORP1",5,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.87,PSDA,0)) D
"RTN","PSDCORP1",6,0)
 .S NODE=^PSD(58.87,PSDA,0),PSDPN=$S($P(NODE,"^",4)]"":$P(NODE,"^",4),1:"UNKNOWN")
"RTN","PSDCORP1",7,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDCORP1",8,0)
 .S NAOU=+$P(NODE,"^",6),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDCORP1",9,0)
 .S NURS=+$P(NODE,"^",7),NURSN=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDCORP1",10,0)
 .S PHARM=+$P(NODE,"^",3),PHARMN=$S($P($G(^VA(200,PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDCORP1",11,0)
 .S Y=PSD X ^DD("DD") S PSDT=Y
"RTN","PSDCORP1",12,0)
 .S ^TMP("PSDCOR",$J,NAOUN,PSDPN,PSDA)=DRUGN_"^"_PSDT_"^"_PHARMN_"^"_NURSN
"RTN","PSDCORP1",13,0)
PRINT ;prints log
"RTN","PSDCORP1",14,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDCORP1",15,0)
 I '$D(^TMP("PSDCOR",$J)) D HDR W !!,?20,"** NO ORDER STATUS CHANGES REPORTED FROM ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)," **",!! G DONE
"RTN","PSDCORP1",16,0)
 D HDR S PSD="" F  S PSD=$O(^TMP("PSDCOR",$J,PSD)) Q:PSD=""!(PSDOUT)  W !,?5,"=> ",PSD,! D
"RTN","PSDCORP1",17,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDCOR",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDCOR",$J,PSD,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDCORP1",18,0)
 ..S NODE=^TMP("PSDCOR",$J,PSD,NUM,JJ)
"RTN","PSDCORP1",19,0)
 ..I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSD,!!
"RTN","PSDCORP1",20,0)
 ..W NUM,?12,$P(NODE,"^"),?54,$P(NODE,"^",2),?76,$P(NODE,"^",3),?100,$P(NODE,"^",4),!
"RTN","PSDCORP1",21,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCORP1",22,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCORP1",23,0)
END K %,%DT,%H,%I,C,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),JJ,LN
"RTN","PSDCORP1",24,0)
 K NAOU,NAOUN,NODE,NUM,NURS,NURSN,PG,PHARM,PHARMN,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDPN,PSDOUT,PSDS,PSDSD,PSDSN,PSDT,RPDT,TYPE,X,Y
"RTN","PSDCORP1",25,0)
 K ^TMP("PSDCOR",$J),ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDCORP1",26,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCORP1",27,0)
 Q
"RTN","PSDCORP1",28,0)
HDR ;header for log
"RTN","PSDCORP1",29,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCORP1",30,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"CS CORRECTION LOG - ORDER STATUS CHANGES",?115,"Page: ",PG,!,?25,"Report Range ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!,?25,"Report Printed: ",RPDT,!
"RTN","PSDCORP1",31,0)
 W !!,?5,"=> NAOU",!,?57,"DATE",?74,"CORRECTED BY"
"RTN","PSDCORP1",32,0)
 W !,"DISP #",?12,"DRUG",?54,"CORRECTED",?75,"PHARMACIST",?100,"ENTERED BY NURSE",!,LN,!
"RTN","PSDCORP1",33,0)
 Q
"RTN","PSDCORP2")
0^32^B10733083
"RTN","PSDCORP2",1,0)
PSDCORP2 ;BIR/JPW-CS Correction Log Deleted Green Sheets ; 2 Aug 94
"RTN","PSDCORP2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCORP2",3,0)
START ;
"RTN","PSDCORP2",4,0)
 K ^TMP("PSDCOR2",$J)
"RTN","PSDCORP2",5,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.87,PSDA,0)) D
"RTN","PSDCORP2",6,0)
 .S NODE=^PSD(58.87,PSDA,0),PSDPN=$S($P(NODE,"^",4)]"":$P(NODE,"^",4),1:"UNKNOWN")
"RTN","PSDCORP2",7,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDCORP2",8,0)
 .S NAOU=+$P(NODE,"^",6),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDCORP2",9,0)
 .S TECH=+$P(NODE,"^",10),TECHN=$S($P($G(^VA(200,TECH,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDCORP2",10,0)
 .S PHARM=+$P(NODE,"^",3),PHARMN=$S($P($G(^VA(200,PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDCORP2",11,0)
 .S Y=PSD X ^DD("DD") S PSDT=Y
"RTN","PSDCORP2",12,0)
 .S ^TMP("PSDCOR2",$J,NAOUN,PSDPN,PSDA)=DRUGN_"^"_PSDT_"^"_PHARMN_"^"_TECHN
"RTN","PSDCORP2",13,0)
PRINT ;prints log
"RTN","PSDCORP2",14,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDCORP2",15,0)
 I '$D(^TMP("PSDCOR2",$J)) D HDR W !!,?20,"** NO GREEN SHEET DELETIONS REPORTED FROM ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)," **",!! G DONE
"RTN","PSDCORP2",16,0)
 D HDR S PSD="" F  S PSD=$O(^TMP("PSDCOR2",$J,PSD)) Q:PSD=""!(PSDOUT)  W !,?5,"=> ",PSD,! D
"RTN","PSDCORP2",17,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDCOR2",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDCOR2",$J,PSD,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDCORP2",18,0)
 ..S NODE=^TMP("PSDCOR2",$J,PSD,NUM,JJ)
"RTN","PSDCORP2",19,0)
 ..I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSD,!!
"RTN","PSDCORP2",20,0)
 ..W NUM,?12,$P(NODE,"^"),?54,$P(NODE,"^",2),?76,$P(NODE,"^",3),?100,$P(NODE,"^",4),!
"RTN","PSDCORP2",21,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCORP2",22,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCORP2",23,0)
END K %,%DT,%H,%I,C,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),JJ,LN
"RTN","PSDCORP2",24,0)
 K NAOU,NAOUN,NODE,NUM,PHARM,PHARMN,PG,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDPN,PSDOUT,PSDOUT,PSDS,PSDSD,PSDSN,PSDT,RPDT,TECH,TECHN,TYPE,X,Y
"RTN","PSDCORP2",25,0)
 K ^TMP("PSDCOR2",$J),ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDCORP2",26,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCORP2",27,0)
 Q
"RTN","PSDCORP2",28,0)
HDR ;header for log
"RTN","PSDCORP2",29,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCORP2",30,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"CS CORRECTION LOG - DELETED GREEN SHEETS",?115,"Page: ",PG,!,?25,"Report Range ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!,?25,"Report Printed: ",RPDT,!
"RTN","PSDCORP2",31,0)
 W !!,?5,"=> NAOU",!,?57,"DATE",?74,"CORRECTED BY"
"RTN","PSDCORP2",32,0)
 W !,"DISP #",?12,"DRUG",?54,"CORRECTED",?75,"PHARMACIST",?100,"ENTERED BY PHARMACIST",!,LN,!
"RTN","PSDCORP2",33,0)
 Q
"RTN","PSDCORP3")
0^33^B12257778
"RTN","PSDCORP3",1,0)
PSDCORP3 ;BIR/JPW-CS Correction Log Deleted Green Sheets ; 2 Aug 94
"RTN","PSDCORP3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCORP3",3,0)
START ;
"RTN","PSDCORP3",4,0)
 K ^TMP("PSDCOR3",$J)
"RTN","PSDCORP3",5,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.87,"AC",TYPE,PSDS,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.87,PSDA,0)) D
"RTN","PSDCORP3",6,0)
 .S NODE=^PSD(58.87,PSDA,0),PSDPN=$S($P(NODE,"^",4)]"":$P(NODE,"^",4),1:"UNKNOWN")
"RTN","PSDCORP3",7,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDCORP3",8,0)
 .S CURR=+$P(NODE,"^",15),PREV=+$P(NODE,"^",14),CURR=$P($G(^PSD(58.83,CURR,0)),"^"),PREV=$P($G(^PSD(58.83,PREV,0)),"^")
"RTN","PSDCORP3",9,0)
 .S NAOU=+$P(NODE,"^",6),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDCORP3",10,0)
 .S TECH=+$P(NODE,"^",10),TECHN=$S($P($G(^VA(200,TECH,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDCORP3",11,0)
 .S PHARM=+$P(NODE,"^",3),PHARMN=$S($P($G(^VA(200,PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDCORP3",12,0)
 .S Y=PSD X ^DD("DD") S PSDT=Y
"RTN","PSDCORP3",13,0)
 .S ^TMP("PSDCOR3",$J,NAOUN,PSDPN,PSDA)=DRUGN_"^"_PSDT_"^"_PHARMN_"^"_TECHN_"^"_CURR_"^"_PREV
"RTN","PSDCORP3",14,0)
PRINT ;prints log
"RTN","PSDCORP3",15,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDCORP3",16,0)
 I '$D(^TMP("PSDCOR3",$J)) D HDR W !!,?20,"** NO GREEN SHEET DELETIONS REPORTED FROM ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)," **",!! G DONE
"RTN","PSDCORP3",17,0)
 D HDR S PSD="" F  S PSD=$O(^TMP("PSDCOR3",$J,PSD)) Q:PSD=""!(PSDOUT)  W !,?5,"=> ",PSD,! D
"RTN","PSDCORP3",18,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDCOR3",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDCOR3",$J,PSD,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDCORP3",19,0)
 ..S NODE=^TMP("PSDCOR3",$J,PSD,NUM,JJ)
"RTN","PSDCORP3",20,0)
 ..I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSD,!!
"RTN","PSDCORP3",21,0)
 ..W NUM,?12,$P(NODE,"^"),?54,$P(NODE,"^",2),?76,$P(NODE,"^",3),?100,$P(NODE,"^",4),!,?15,"*",CURR,?65,"*",PREV,!
"RTN","PSDCORP3",22,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCORP3",23,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCORP3",24,0)
END K %,%DT,%H,%I,C,CURR,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),JJ,LN
"RTN","PSDCORP3",25,0)
 K NAOU,NAOUN,NODE,NUM,PHARM,PHARMN,PG,POP,PREV,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDPN,PSDOUT,PSDOUT,PSDS,PSDSD,PSDSN,PSDT,RPDT,TECH,TECHN,TYPE,X,Y
"RTN","PSDCORP3",26,0)
 K ^TMP("PSDCOR3",$J),ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDCORP3",27,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCORP3",28,0)
 Q
"RTN","PSDCORP3",29,0)
HDR ;header for log
"RTN","PSDCORP3",30,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCORP3",31,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"CS CORRECTION LOG - COMPLETED STATUS CHANGES",?115,"Page: ",PG,!,?25,"Report Range ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!,?25,"Report Printed: ",RPDT,!
"RTN","PSDCORP3",32,0)
 W !!,?5,"=> NAOU",!,?57,"DATE",?74,"CORRECTED BY"
"RTN","PSDCORP3",33,0)
 W !,"DISP #",?12,"DRUG",?54,"CORRECTED",?75,"PHARMACIST",?100,"ENTERED BY PHARMACIST",!,?15,"*CURRENT STATUS",?65,"*PREVIOUS STATUS",!,LN,!
"RTN","PSDCORP3",34,0)
 Q
"RTN","PSDCOSD")
0^34^B23630436
"RTN","PSDCOSD",1,0)
PSDCOSD ;BIR/LTL-Cost Report by Drugs, PSDCOST (cont'd) ; 2 Aug 94
"RTN","PSDCOSD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOSD",3,0)
 N PSDN,LN,PG,X2 S PSDSD(1)=PSDSD S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSD",4,0)
 F  S PSDSD=$O(^PSD(58.81,"ACT",PSDSD)) W:$E(IOST)="C" "." Q:'PSDSD!(PSDSD>PSDED)  S PSDN=$O(^PSD(58.81,"ACT",PSDSD,0)) D:$P($G(^PSD(58.8,+PSDN,0)),U,3)=+PSDSITE
"RTN","PSDCOSD",5,0)
 .S PSDN(1)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,0))
"RTN","PSDCOSD",6,0)
 .Q:'$D(LOC(+PSDN(1)))&('$G(ALL))
"RTN","PSDCOSD",7,0)
 .S PSDN(2)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),0))
"RTN","PSDCOSD",8,0)
 .Q:PSDN(2)<2!(PSDN(2)>5)&(PSDN(2)'=9)
"RTN","PSDCOSD",9,0)
 .S PSDN(3)=$S($P($G(^PSDRUG(+PSDN(1),0)),U)]"":$P($G(^(0)),U),1:"UNKNOWN DRUG #"_PSDN(1))
"RTN","PSDCOSD",10,0)
 .S PSDN(4)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),PSDN(2),0))
"RTN","PSDCOSD",11,0)
 .S PSDN(8)=$G(^PSD(58.81,+PSDN(4),0))
"RTN","PSDCOSD",12,0)
 .;get NAOU for everything including adjustments
"RTN","PSDCOSD",13,0)
 .S PSDN(9)=$S(PSDN(2)=9:PSDN,1:$P(PSDN(8),U,18))
"RTN","PSDCOSD",14,0)
 .Q:$P($G(^PSD(58.8,+PSDN(9),0)),U,2)'="N"
"RTN","PSDCOSD",15,0)
 .;qty rec'd by NAOU w/green sheet
"RTN","PSDCOSD",16,0)
 .S PSDN(5)=$P($G(^PSD(58.81,+PSDN(4),1)),U,8)
"RTN","PSDCOSD",17,0)
 .;qty dispensed by Master Vault w/o green sheet
"RTN","PSDCOSD",18,0)
 .S:$P(PSDN(8),U,17)']"" PSDN(5)=$P(PSDN(8),U,6)
"RTN","PSDCOSD",19,0)
 .;Returned to Stock
"RTN","PSDCOSD",20,0)
 .S:PSDN(2)=3 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,2)
"RTN","PSDCOSD",21,0)
 .;Destroyed
"RTN","PSDCOSD",22,0)
 .S:PSDN(2)=4 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,5)
"RTN","PSDCOSD",23,0)
 .;include transfer ins with dispensed
"RTN","PSDCOSD",24,0)
 .S:PSDN(2)=5 PSDN(2)=2
"RTN","PSDCOSD",25,0)
 .;Check for transfers
"RTN","PSDCOSD",26,0)
 .S PSDN(6)=$G(^PSD(58.81,+PSDN(4),7))
"RTN","PSDCOSD",27,0)
 .D:$P(PSDN(6),U)>PSDSD(1)&($P(PSDN(6),U)<PSDED)
"RTN","PSDCOSD",28,0)
 ..S PSDN(5)=PSDN(5)-$P(PSDN(6),U,7),PSDN(2)=5
"RTN","PSDCOSD",29,0)
 .S PSDN(7)=$G(^TMP("PSD",$J,PSDN(3),PSDN(9)))
"RTN","PSDCOSD",30,0)
 .;total dispensed
"RTN","PSDCOSD",31,0)
 .S $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U)=$P(PSDN(7),U)+PSDN(5)
"RTN","PSDCOSD",32,0)
 .;DA for drug
"RTN","PSDCOSD",33,0)
 .S:'$P(PSDN(7),U,2) $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U,2)=PSDN(1)
"RTN","PSDCOSD",34,0)
 .;total returned to stock
"RTN","PSDCOSD",35,0)
 .S:PSDN(2)=3 $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U,3)=PSDN(5)+$P(PSDN(7),U,3)
"RTN","PSDCOSD",36,0)
 .;total destroyed
"RTN","PSDCOSD",37,0)
 .S:PSDN(2)=4 $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U,4)=PSDN(5)+$P(PSDN(7),U,4)
"RTN","PSDCOSD",38,0)
 .;total transferred
"RTN","PSDCOSD",39,0)
 .S:PSDN(2)=5 $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U,5)=-$P(PSDN(6),U,7)+$P(PSDN(7),U,5)
"RTN","PSDCOSD",40,0)
 .;total adjusted by NAOU
"RTN","PSDCOSD",41,0)
 .S:PSDN(2)=9 $P(^TMP("PSD",$J,PSDN(3),PSDN(9)),U,6)=PSDN(5)+$P(PSDN(7),U,6)
"RTN","PSDCOSD",42,0)
 .K PSDN
"RTN","PSDCOSD",43,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDCOSD",44,0)
 I $D(ZTQUEUED) K ZTSAVE,ZTSK S ZTIO=PSDIO,ZTDESC="CS Drug Cost Report",ZTRTN="START^PSDCOSD",ZTDTH=$H,ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSD"",$J,")="",ZTSAVE("SUM")="" D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSDCOSD",45,0)
START S (PG,PSDN)=0 D HEADER
"RTN","PSDCOSD",46,0)
 F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:PSDN']""  D:$Y+6>IOSL HEADER G:$G(PSDOUT) END S PSDN(8)=$G(PSDN(8))+1 K PG(PSDN) D  G:$G(PSDOUT) END
"RTN","PSDCOSD",47,0)
 .W ?8,"DRUG ==> ",PSDN,!! S PSDN(1)=0
"RTN","PSDCOSD",48,0)
 .F  S PSDN(1)=$O(^TMP("PSD",$J,PSDN,PSDN(1))) Q:'PSDN(1)  D:$Y+6>IOSL HEADER Q:$G(PSDOUT)  S PSDN(9)=$G(PSDN(9))+1 D
"RTN","PSDCOSD",49,0)
 ..I $D(PG(PSDN)) W ?8,"DRUG ==> ",PSDN," (continued)",!! K PG(PSDN)
"RTN","PSDCOSD",50,0)
 ..W:'$G(SUM) $P($G(^PSD(58.8,+PSDN(1),0)),U),?36
"RTN","PSDCOSD",51,0)
 ..S PSDN(2)=$G(^TMP("PSD",$J,PSDN,PSDN(1))),PSDN(3)=$G(PSDN(3))+PSDN(2)
"RTN","PSDCOSD",52,0)
 ..W:'$G(SUM) $J($P(PSDN(2),U),10),?62
"RTN","PSDCOSD",53,0)
 ..S PSDN(11)=$P($G(^PSDRUG(+$P(PSDN(2),U,2),660)),U,6)
"RTN","PSDCOSD",54,0)
 ..S (X,PSDN(4))=$P(PSDN(2),U)*PSDN(11),X2="2$",PSDN(5)=$G(PSDN(5))+PSDN(4) D COMMA^%DTC W:'$G(SUM) X,!!
"RTN","PSDCOSD",55,0)
 ..S PSDN(10)=" (Subtracted from total)"
"RTN","PSDCOSD",56,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,3)) "Doses Returned to Stock: ",$P(PSDN(2),U,3),PSDN(10),!!
"RTN","PSDCOSD",57,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,4)) "Doses Destroyed: ",$P(PSDN(2),U,4),PSDN(10),!!
"RTN","PSDCOSD",58,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,5)) "Doses Transferred: ",$P(PSDN(2),U,5),PSDN(10),!!
"RTN","PSDCOSD",59,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,6)) "Doses Adjusted by NAOU: ",$P(PSDN(2),U,6)," (Not affecting total)",!!
"RTN","PSDCOSD",60,0)
 ..S:'PSDN(11) ^TMP("PSDM",$J,PSDN)=""
"RTN","PSDCOSD",61,0)
 .Q:$G(PSDOUT)  W LN,!?28,"Total:  ",$J($G(PSDN(3)),10),?62
"RTN","PSDCOSD",62,0)
 .S X=$G(PSDN(5)) D COMMA^%DTC W X,!! S PSDN(6)=$G(PSDN(6))+PSDN(3)
"RTN","PSDCOSD",63,0)
 .S PSDN(7)=$G(PSDN(7))+PSDN(5) K PSDN(3),PSDN(5),PSDN(9)
"RTN","PSDCOSD",64,0)
 I $G(PSDN(8))>1 W LN,!?14,"Total for all NAOUs:  ",$J($G(PSDN(6)),10) S X=$G(PSDN(7)) D COMMA^%DTC W ?62,X,!!
"RTN","PSDCOSD",65,0)
 I $D(^TMP("PSDM",$J)) S ZTRTN="^PSDCOSM",ZTIO="",ZTDTH=$H,ZTDESC="Mailman notification of 0 DRUG file cost",ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSDM"",$J,")="" D ^%ZTLOAD,HOME^%ZIS
"RTN","PSDCOSD",66,0)
 W:'$O(^TMP("PSD",$J,0)) !!,"Sorry, nothing to report for selected drug(s).",!!
"RTN","PSDCOSD",67,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDCOSD",68,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDCOSD",69,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSD",70,0)
QUIT K ^TMP("PSD",$J),^TMP("PSDM",$J),IO("Q") Q
"RTN","PSDCOSD",71,0)
HEADER ;prints header info
"RTN","PSDCOSD",72,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCOSD",73,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDCOSD",74,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1,PG(PSDN)="" W !?2,PSDCHO(1)," From "
"RTN","PSDCOSD",75,0)
 W $P(PSDATE,U)," To ",$P(PSDATE,U,2),?72,"Page ",PG,!!
"RTN","PSDCOSD",76,0)
 W ?45,"Report Date:  ",PSDT(1),!!?40,"Quantity",!,"NAOU",?40,"Dispensed"
"RTN","PSDCOSD",77,0)
 W ?70,"Cost",!,LN,!!
"RTN","PSDCOSH")
0^35^B14547074
"RTN","PSDCOSH",1,0)
PSDCOSH ;BIR/LTL-Cost Report by High Cost, PSDCOST (cont'd) ; 2 Aug 94
"RTN","PSDCOSH",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOSH",3,0)
 N PSDN,LN,PG,X2 S PSDSD(1)=PSDSD S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSH",4,0)
 F  S PSDSD=$O(^PSD(58.81,"ACT",PSDSD)) W:$E(IOST)="C" "." Q:'PSDSD!(PSDSD>PSDED)  S PSDN=$O(^PSD(58.81,"ACT",PSDSD,0)) D:$P($G(^PSD(58.8,+PSDN,0)),U,3)=+PSDSITE
"RTN","PSDCOSH",5,0)
 .S PSDN(1)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,0))
"RTN","PSDCOSH",6,0)
 .S PSDN(2)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),0))
"RTN","PSDCOSH",7,0)
 .Q:PSDN(2)<2!(PSDN(2)>5)&(PSDN(2)'=9)
"RTN","PSDCOSH",8,0)
 .S PSDN(3)=$P($G(^PSDRUG(+PSDN(1),0)),U)
"RTN","PSDCOSH",9,0)
 .S PSDN(4)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),PSDN(2),0))
"RTN","PSDCOSH",10,0)
 .S PSDN(8)=$G(^PSD(58.81,+PSDN(4),0))
"RTN","PSDCOSH",11,0)
 .Q:'$D(LOC(+$P(PSDN(8),U,18)))&(PSDN(2)'=9)!('$D(LOC(+PSDN))&(PSDN(2)=9))
"RTN","PSDCOSH",12,0)
 .;get NAOU for everything including adjustments
"RTN","PSDCOSH",13,0)
 .S PSDN(9)=$S(PSDN(2)=9:PSDN,1:$P(PSDN(8),U,18))
"RTN","PSDCOSH",14,0)
 .;qty rec'd by NAOU w/green sheet
"RTN","PSDCOSH",15,0)
 .S PSDN(5)=$P($G(^PSD(58.81,+PSDN(4),1)),U,8)
"RTN","PSDCOSH",16,0)
 .;qty dispensed by Master Vault w/o green sheet
"RTN","PSDCOSH",17,0)
 .S:$P(PSDN(8),U,17)']"" PSDN(5)=$P(PSDN(8),U,6)
"RTN","PSDCOSH",18,0)
 .;Returned to Stock
"RTN","PSDCOSH",19,0)
 .S:PSDN(2)=3 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,2)
"RTN","PSDCOSH",20,0)
 .;Destroyed
"RTN","PSDCOSH",21,0)
 .S:PSDN(2)=4 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,5)
"RTN","PSDCOSH",22,0)
 .;include transfer ins with dispensed
"RTN","PSDCOSH",23,0)
 .S:PSDN(2)=5 PSDN(2)=2
"RTN","PSDCOSH",24,0)
 .;Check for transfers
"RTN","PSDCOSH",25,0)
 .S PSDN(6)=$G(^PSD(58.81,+PSDN(4),7))
"RTN","PSDCOSH",26,0)
 .D:$P(PSDN(6),U)>PSDSD(1)&($P(PSDN(6),U)<PSDED)
"RTN","PSDCOSH",27,0)
 ..S PSDN(5)=PSDN(5)-$P(PSDN(6),U,7),PSDN(2)=5
"RTN","PSDCOSH",28,0)
 .S PSDN(7)=$G(^TMP("PSD",$J,PSDN(3)))
"RTN","PSDCOSH",29,0)
 .;total dispensed
"RTN","PSDCOSH",30,0)
 .S $P(^TMP("PSD",$J,PSDN(3)),U)=$P(PSDN(7),U)+PSDN(5)
"RTN","PSDCOSH",31,0)
 .;total cost
"RTN","PSDCOSH",32,0)
 .S $P(^TMP("PSD",$J,PSDN(3)),U,2)=$P(^TMP("PSD",$J,PSDN(3)),U,2)+($P($G(^PSDRUG(+PSDN(1),660)),U,6)*PSDN(5))
"RTN","PSDCOSH",33,0)
 .K PSDN
"RTN","PSDCOSH",34,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDCOSH",35,0)
 I $D(ZTQUEUED) K ZTSAVE,ZTSK S ZTIO=PSDIO,ZTDESC="CS High Cost Report",ZTRTN="START^PSDCOSH",ZTDTH=$H,ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSD"",$J,")="",ZTSAVE("ALL")="",ZTSAVE("LOC(")="" D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSDCOSH",36,0)
START S (PG,PSDN)=0 D HEADER
"RTN","PSDCOSH",37,0)
 D:PSD(1)=1
"RTN","PSDCOSH",38,0)
 .F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:PSDN!(PSDN']"")  S PSDN(1)=$G(^TMP("PSD",$J,PSDN)) D:$P(PSDN(1),U,2)>PSD
"RTN","PSDCOSH",39,0)
 ..S ^TMP("PSD",$J,999999999-$P(PSDN(1),U,2))=$P(PSDN(1),U)_U_$P(PSDN(1),U,2)_U_PSDN
"RTN","PSDCOSH",40,0)
 F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:(PSD(1)=1&('PSDN))!(PSDN']"")  D:$Y+6>IOSL HEADER G:$G(PSDOUT) END D  G:$G(PSDOUT) END
"RTN","PSDCOSH",41,0)
 .S PSDN(1)=$G(^TMP("PSD",$J,PSDN))
"RTN","PSDCOSH",42,0)
 .Q:PSD(1)=2&($P(PSDN(1),U,2)'>PSD)
"RTN","PSDCOSH",43,0)
 .W $E($S(PSDN:$P(PSDN(1),U,3),1:PSDN),1,34),?36
"RTN","PSDCOSH",44,0)
 .W $J($P(PSDN(1),U),10),?62
"RTN","PSDCOSH",45,0)
 .S X=$P(PSDN(1),U,2),X2="2$" D COMMA^%DTC W X,!!
"RTN","PSDCOSH",46,0)
 W:'$O(^TMP("PSD",$J,0)) !!,"Sorry, nothing to report for selected NAOU(s).",!!
"RTN","PSDCOSH",47,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDCOSH",48,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDCOSH",49,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSH",50,0)
QUIT K ^TMP("PSD",$J),IO("Q") Q
"RTN","PSDCOSH",51,0)
HEADER ;prints header info
"RTN","PSDCOSH",52,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCOSH",53,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDCOSH",54,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1 W !?2,PSDCHO(1)," From "
"RTN","PSDCOSH",55,0)
 W $P(PSDATE,U)," To ",$P(PSDATE,U,2),?72,"Page ",PG,!!
"RTN","PSDCOSH",56,0)
 S PSD(2)=$O(LOC(0)) W "For " W:$G(ALL) "ALL NAOU(s)"
"RTN","PSDCOSH",57,0)
 W:'$O(LOC(PSD(2)))&('$G(ALL)) $P($G(^PSD(58.8,+$O(LOC(0)),0)),U)
"RTN","PSDCOSH",58,0)
 I $O(LOC(PSD(2))),'$G(ALL) W "The Following NAOU(s):  " D
"RTN","PSDCOSH",59,0)
 .S PSD(2)=0 F  S PSD(2)=$O(LOC(PSD(2))) Q:'PSD(2)  W $P($G(^PSD(58.8,+PSD(2),0)),U),!?28
"RTN","PSDCOSH",60,0)
 W ?45,"Report Date:  ",PSDT(1),!!?40,"Quantity",!,"Drug",?40,"Dispensed"
"RTN","PSDCOSH",61,0)
 W ?70,"Cost",!,LN,!!
"RTN","PSDCOSM")
0^36^B1880551
"RTN","PSDCOSM",1,0)
PSDCOSM ;BIR/LTL-Send MM about 0$ in DRUG file (#50), PSDCOST (cont'd) ; 9 Nov 93
"RTN","PSDCOSM",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOSM",3,0)
 N PSD,PSDM,PSDN D KILL^XM
"RTN","PSDCOSM",4,0)
 S XMSUB="DRUG file cost missing",XMDUZ=PSDCHO(1)_" messenger" D XMZ^XMA2
"RTN","PSDCOSM",5,0)
 I XMZ<1 D KILL^XM Q
"RTN","PSDCOSM",6,0)
 S XMY(DUZ)=""
"RTN","PSDCOSM",7,0)
 S PSD(1)=$S($P($G(^VA(200,DUZ,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($P($G(^VA(200,DUZ,0)),U),",",2))_", when you ran the "_PSDCHO(1)_" on"
"RTN","PSDCOSM",8,0)
 S PSD(2)=PSDT(1)_", the following DRUG file entries had zero as a value"
"RTN","PSDCOSM",9,0)
 S PSD(3)="for the PRICE PER DISPENSING UNIT field:"
"RTN","PSDCOSM",10,0)
 S PSD(4)="",PSDM=0,PSDN=5
"RTN","PSDCOSM",11,0)
 F  S PSDM=$O(^TMP("PSDM",$J,PSDM)) Q:PSDM']""  S PSD(PSDN)=PSDM,PSDN=PSDN+1,PSD(PSDN)="",PSDN=PSDN+1
"RTN","PSDCOSM",12,0)
 S XMTEXT="PSD(" D ^XMD,KILL^XM Q
"RTN","PSDCOSN")
0^37^B23348931
"RTN","PSDCOSN",1,0)
PSDCOSN ;BIR/LTL-Cost Report by NAOUs, PSDCOST (cont'd) ; 2 Aug 94
"RTN","PSDCOSN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOSN",3,0)
 N PSDN,LN,PG,X2 S PSDSD(1)=PSDSD S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSN",4,0)
 F  S PSDSD=$O(^PSD(58.81,"ACT",PSDSD)) W:$E(IOST)="C" "." Q:'PSDSD!(PSDSD>PSDED)  S PSDN=$O(^PSD(58.81,"ACT",PSDSD,0)) D:$P($G(^PSD(58.8,+PSDN,0)),U,3)=+PSDSITE
"RTN","PSDCOSN",5,0)
 .S PSDN(1)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,0))
"RTN","PSDCOSN",6,0)
 .S PSDN(2)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),0))
"RTN","PSDCOSN",7,0)
 .Q:PSDN(2)<2!(PSDN(2)>5)&(PSDN(2)'=9)
"RTN","PSDCOSN",8,0)
 .S PSDN(3)=$P($G(^PSDRUG(+PSDN(1),0)),U)
"RTN","PSDCOSN",9,0)
 .S PSDN(4)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),PSDN(2),0))
"RTN","PSDCOSN",10,0)
 .S PSDN(8)=$G(^PSD(58.81,+PSDN(4),0))
"RTN","PSDCOSN",11,0)
 .Q:'$D(LOC(+$P(PSDN(8),U,18)))&(PSDN(2)'=9)!('$D(LOC(+PSDN))&(PSDN(2)=9))
"RTN","PSDCOSN",12,0)
 .;get NAOU for everything including adjustments
"RTN","PSDCOSN",13,0)
 .S PSDN(9)=$S(PSDN(2)=9:PSDN,1:$P(PSDN(8),U,18))
"RTN","PSDCOSN",14,0)
 .;qty rec'd by NAOU w/green sheet
"RTN","PSDCOSN",15,0)
 .S PSDN(5)=$P($G(^PSD(58.81,+PSDN(4),1)),U,8)
"RTN","PSDCOSN",16,0)
 .;qty dispensed by Master Vault w/o green sheet
"RTN","PSDCOSN",17,0)
 .S:$P(PSDN(8),U,17)']"" PSDN(5)=$P(PSDN(8),U,6)
"RTN","PSDCOSN",18,0)
 .;Returned to Stock
"RTN","PSDCOSN",19,0)
 .S:PSDN(2)=3 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,2)
"RTN","PSDCOSN",20,0)
 .;Destroyed
"RTN","PSDCOSN",21,0)
 .S:PSDN(2)=4 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,5)
"RTN","PSDCOSN",22,0)
 .;include transfer ins with dispensed
"RTN","PSDCOSN",23,0)
 .S:PSDN(2)=5 PSDN(2)=2
"RTN","PSDCOSN",24,0)
 .;Check for transfers
"RTN","PSDCOSN",25,0)
 .S PSDN(6)=$G(^PSD(58.81,+PSDN(4),7))
"RTN","PSDCOSN",26,0)
 .D:$P(PSDN(6),U)>PSDSD(1)&($P(PSDN(6),U)<PSDED)
"RTN","PSDCOSN",27,0)
 ..S PSDN(5)=PSDN(5)-$P(PSDN(6),U,7),PSDN(2)=5
"RTN","PSDCOSN",28,0)
 .S PSDN(7)=$G(^TMP("PSD",$J,PSDN(9),PSDN(3)))
"RTN","PSDCOSN",29,0)
 .;total dispensed
"RTN","PSDCOSN",30,0)
 .S $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U)=$P(PSDN(7),U)+PSDN(5)
"RTN","PSDCOSN",31,0)
 .;DA for drug
"RTN","PSDCOSN",32,0)
 .S:'$P(PSDN(7),U,2) $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U,2)=PSDN(1)
"RTN","PSDCOSN",33,0)
 .;total returned to stock
"RTN","PSDCOSN",34,0)
 .S:PSDN(2)=3 $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U,3)=PSDN(5)+$P(PSDN(7),U,3)
"RTN","PSDCOSN",35,0)
 .;total destroyed
"RTN","PSDCOSN",36,0)
 .S:PSDN(2)=4 $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U,4)=PSDN(5)+$P(PSDN(7),U,4)
"RTN","PSDCOSN",37,0)
 .;total transferred
"RTN","PSDCOSN",38,0)
 .S:PSDN(2)=5 $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U,5)=-$P(PSDN(6),U,7)+$P(PSDN(7),U,5)
"RTN","PSDCOSN",39,0)
 .;total adjusted by NAOU
"RTN","PSDCOSN",40,0)
 .S:PSDN(2)=9 $P(^TMP("PSD",$J,PSDN(9),PSDN(3)),U,6)=PSDN(5)+$P(PSDN(7),U,6)
"RTN","PSDCOSN",41,0)
 .K PSDN
"RTN","PSDCOSN",42,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDCOSN",43,0)
 I $D(ZTQUEUED) K ZTSAVE,ZTSK S ZTIO=PSDIO,ZTDESC="CS Cost Report by NAOU",ZTRTN="START^PSDCOSN",ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSD"",$J,")="",ZTSAVE("SUM")="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSDCOSN",44,0)
START S (PG,PSDN)=0 D HEADER
"RTN","PSDCOSN",45,0)
 F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:'PSDN  D:$Y+6>IOSL HEADER G:$G(PSDOUT) END S PSDN(8)=$G(PSDN(8))+1 K PG(PSDN) D  G:$G(PSDOUT) END
"RTN","PSDCOSN",46,0)
 .W ?8,"NAOU ==> ",$P($G(^PSD(58.8,+PSDN,0)),U),!! S PSDN(1)=0
"RTN","PSDCOSN",47,0)
 .F  S PSDN(1)=$O(^TMP("PSD",$J,PSDN,PSDN(1))) Q:PSDN(1)']""  D:$Y+6>IOSL HEADER Q:$G(PSDOUT)  S PSDN(9)=$G(PSDN(9))+1 D
"RTN","PSDCOSN",48,0)
 ..I $D(PG(PSDN)) W ?8,"NAOU ==> ",$P($G(^PSD(58.8,+PSDN,0)),U)," (continued)",!! K PG(PSDN)
"RTN","PSDCOSN",49,0)
 ..W:'$G(SUM) $E(PSDN(1),1,34),?36
"RTN","PSDCOSN",50,0)
 ..S PSDN(2)=$G(^TMP("PSD",$J,PSDN,PSDN(1))),PSDN(3)=$G(PSDN(3))+PSDN(2)
"RTN","PSDCOSN",51,0)
 ..W:'$G(SUM) $J($P(PSDN(2),U),10),?62
"RTN","PSDCOSN",52,0)
 ..S PSDN(11)=$P($G(^PSDRUG(+$P(PSDN(2),U,2),660)),U,6)
"RTN","PSDCOSN",53,0)
 ..S (X,PSDN(4))=$P(PSDN(2),U)*PSDN(11),X2="2$",PSDN(5)=$G(PSDN(5))+PSDN(4) D COMMA^%DTC W:'$G(SUM) X,!!
"RTN","PSDCOSN",54,0)
 ..S PSDN(10)=" (Subtracted from total)"
"RTN","PSDCOSN",55,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,3)) "Doses Returned to Stock: ",$P(PSDN(2),U,3),PSDN(10),!!
"RTN","PSDCOSN",56,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,4)) "Doses Destroyed: ",$P(PSDN(2),U,4),PSDN(10),!!
"RTN","PSDCOSN",57,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,5)) "Doses Transferred: ",$P(PSDN(2),U,5),PSDN(10),!!
"RTN","PSDCOSN",58,0)
 ..W:'$G(SUM)&($P(PSDN(2),U,6)) "Doses Adjusted by NAOU: ",$P(PSDN(2),U,6)," (Not affecting total)",!!
"RTN","PSDCOSN",59,0)
 ..S:'PSDN(11) ^TMP("PSDM",$J,PSDN(1))=""
"RTN","PSDCOSN",60,0)
 .Q:$G(PSDOUT)  W LN,!?28,"Total:  ",$J($G(PSDN(3)),10),?62
"RTN","PSDCOSN",61,0)
 .S X=$G(PSDN(5)) D COMMA^%DTC W X,!! S PSDN(6)=$G(PSDN(6))+PSDN(3)
"RTN","PSDCOSN",62,0)
 .S PSDN(7)=$G(PSDN(7))+PSDN(5) K PSDN(3),PSDN(5),PSDN(9)
"RTN","PSDCOSN",63,0)
 I $G(PSDN(8))>1 W LN,!?14,"Total for all NAOUs:  ",$J($G(PSDN(6)),10) S X=$G(PSDN(7)) D COMMA^%DTC W ?62,X,!!
"RTN","PSDCOSN",64,0)
 I $D(^TMP("PSDM",$J)) S ZTRTN="^PSDCOSM",ZTIO="",ZTDTH=$H,ZTDESC="Mailman notification of 0 DRUG file cost",ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSDM"",$J,")="" D ^%ZTLOAD
"RTN","PSDCOSN",65,0)
 W:'$O(^TMP("PSD",$J,0)) !!,"Sorry, nothing to report for selected NAOU(s).",!!
"RTN","PSDCOSN",66,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDCOSN",67,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDCOSN",68,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSN",69,0)
QUIT K ^TMP("PSD",$J),^TMP("PSDM",$J),IO("Q") Q
"RTN","PSDCOSN",70,0)
HEADER ;prints header info
"RTN","PSDCOSN",71,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCOSN",72,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDCOSN",73,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1,PG(PSDN)="" W !?2,PSDCHO(1)," From "
"RTN","PSDCOSN",74,0)
 W $P(PSDATE,U)," To ",$P(PSDATE,U,2),?72,"Page ",PG,!!
"RTN","PSDCOSN",75,0)
 W ?45,"Report Date:  ",PSDT(1),!!?40,"Quantity",!,"Drug",?40,"Dispensed"
"RTN","PSDCOSN",76,0)
 W ?70,"Cost",!,LN,!!
"RTN","PSDCOST")
0^38^B25005159
"RTN","PSDCOST",1,0)
PSDCOST ;BIR/JPW,LTL-Cost Report for NAOUs ; 8 Aug 94
"RTN","PSDCOST",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOST",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCOST",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"the narcotic NAOU Cost Report.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDCOST",5,0)
 W !!,"Before printing a Cost Report, be sure accurate data exists in the",!!,"PRICE PER ORDER UNIT & DISPENSE UNITS PER ORDER UNIT fields in the DRUG file."
"RTN","PSDCOST",6,0)
 N %,%H,%I,DIR,DIRUT,DUOUT,DTOUT,LOC,X,Y,POP,PSDATE,PSDED,PSDSD,PSDCHO,PSDEV,PSDIO,PSDOUT,ZTSK
"RTN","PSDCOST",7,0)
CHOICE S DIR(0)="S^1:Cost Report By NAOU(s);2:Cost Report By Drug(s);3:High Cost Report;4:High Volume Report",DIR("A")="Please select Report"
"RTN","PSDCOST",8,0)
 S DIR("?")="These reports may be printed for a date range which you select, and you may choose to print the report for a single NAOU, several NAOUs, or for ALL NAOUs." D ^DIR K DIR G:Y<1 END S PSDCHO=Y,PSDCHO(1)=Y(0)
"RTN","PSDCOST",9,0)
 W !!,"Select Date Range for ",PSDCHO(1),!
"RTN","PSDCOST",10,0)
DATE ;ask date range
"RTN","PSDCOST",11,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDCOST",12,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " W ! D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDCOST",13,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDCOST",14,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDCOST",15,0)
 G:PSDCHO>2 ASKN
"RTN","PSDCOST",16,0)
SUM ;if summary only
"RTN","PSDCOST",17,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDCOST",18,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the detail report including summary totals."
"RTN","PSDCOST",19,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y G:PSDCHO=2 DRUG
"RTN","PSDCOST",20,0)
ASKN ;ask NAOU(s)
"RTN","PSDCOST",21,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDCOST",22,0)
 D NOW^%DTC S PSDT=X,Y=% X ^DD("DD") S PSDT(1)=Y K DA,DIC
"RTN","PSDCOST",23,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDCOST",24,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDCOST",25,0)
 I X="^ALL" S ALL=1 F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S LOC(PSD)=""
"RTN","PSDCOST",26,0)
 D:PSDCHO>2  G:$D(DIRUT) END
"RTN","PSDCOST",27,0)
 .S DIR(0)="N",DIR("A")="Please enter CUT OFF "_$S(PSDCHO=3:"amount",1:"quantity")
"RTN","PSDCOST",28,0)
 .S DIR("A",1)="The High Cost Report will show all drugs with a total dispensed "_$S(PSDCHO=3:"cost",1:"quantity"),DIR("A",2)=""
"RTN","PSDCOST",29,0)
 .S DIR("A",3)="greater than your specified cut off amount.",DIR("A",4)=""
"RTN","PSDCOST",30,0)
 .W ! D ^DIR K DIR Q:$D(DIRUT)  S PSD=Y Q:PSDCHO=4
"RTN","PSDCOST",31,0)
 .S DIR(0)="S^1:By COST (Highest to Lowest);2:Alphabetical by DRUG"
"RTN","PSDCOST",32,0)
 .S DIR("A",1)="You may print by either of these sorting methods"
"RTN","PSDCOST",33,0)
 .S DIR("A",2)="",DIR("A")="Please select SORT ORDER",DIR("B")=1
"RTN","PSDCOST",34,0)
 .D ^DIR K DIR Q:Y<1  S PSD(1)=Y,PSD(2)=Y(0)
"RTN","PSDCOST",35,0)
 G DEV
"RTN","PSDCOST",36,0)
DRUG ;ask drug(s)
"RTN","PSDCOST",37,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDCOST",38,0)
 D NOW^%DTC S PSDT=X,Y=% X ^DD("DD") S PSDT(1)=Y
"RTN","PSDCOST",39,0)
 K DA,DIC F  S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEAM",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDCOST",40,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDCOST",41,0)
 I X="^ALL" S ALL=1
"RTN","PSDCOST",42,0)
DEV ;asks device and queueing information
"RTN","PSDCOST",43,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDCOST",44,0)
 S Y=$P($G(^PSD(58.8,+PSDSITE,2)),U,9),C=$P(^DD(58.8,24,0),U,2) D Y^DIQ S PSDEV=Y
"RTN","PSDCOST",45,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS
"RTN","PSDCOST",46,0)
 I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDCOST",47,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(PSDCHO=1:"^PSDCOSN",PSDCHO=2:"^PSDCOSD",PSDCHO=3:"^PSDCOSH",1:"^PSDCOSV"),ZTDESC="Compile CS Cost Report data" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDCOST",48,0)
 W !,"Compiling ",PSDCHO(1)," data." U IO
"RTN","PSDCOST",49,0)
 D @$S(PSDCHO=1:"^PSDCOSN",PSDCHO=2:"^PSDCOSD",PSDCHO=3:"^PSDCOSH",1:"^PSDCOSV")
"RTN","PSDCOST",50,0)
END ;
"RTN","PSDCOST",51,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),POP,PSD,PSDT,SUM,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDCOST",52,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOST",53,0)
 Q
"RTN","PSDCOST",54,0)
SAVE ;save variables for queueing
"RTN","PSDCOST",55,0)
 S ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD*")="" S:$D(LOC) ZTSAVE("LOC(")=""
"RTN","PSDCOST",56,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDCOST",57,0)
 Q
"RTN","PSDCOSV")
0^39^B14579143
"RTN","PSDCOSV",1,0)
PSDCOSV ;BIR/LTL-Cost Report by High Volume, PSDCOST (cont'd) ; 2 Aug 94
"RTN","PSDCOSV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCOSV",3,0)
 N PSDN,LN,PG,X2 S PSDSD(1)=PSDSD S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSV",4,0)
 F  S PSDSD=$O(^PSD(58.81,"ACT",PSDSD)) W:$E(IOST)="C" "." Q:'PSDSD!(PSDSD>PSDED)  S PSDN=$O(^PSD(58.81,"ACT",PSDSD,0)) D:$P($G(^PSD(58.8,+PSDN,0)),U,3)=+PSDSITE
"RTN","PSDCOSV",5,0)
 .S PSDN(1)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,0))
"RTN","PSDCOSV",6,0)
 .S PSDN(2)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),0))
"RTN","PSDCOSV",7,0)
 .Q:PSDN(2)<2!(PSDN(2)>5)&(PSDN(2)'=9)
"RTN","PSDCOSV",8,0)
 .S PSDN(3)=$P($G(^PSDRUG(+PSDN(1),0)),U)
"RTN","PSDCOSV",9,0)
 .S PSDN(4)=$O(^PSD(58.81,"ACT",PSDSD,PSDN,PSDN(1),PSDN(2),0))
"RTN","PSDCOSV",10,0)
 .S PSDN(8)=$G(^PSD(58.81,+PSDN(4),0))
"RTN","PSDCOSV",11,0)
 .Q:'$D(LOC(+$P(PSDN(8),U,18)))&(PSDN(2)'=9)!('$D(LOC(+PSDN))&(PSDN(2)=9))
"RTN","PSDCOSV",12,0)
 .;get NAOU for everything including adjustments
"RTN","PSDCOSV",13,0)
 .S PSDN(9)=$S(PSDN(2)=9:PSDN,1:$P(PSDN(8),U,18))
"RTN","PSDCOSV",14,0)
 .;qty rec'd by NAOU w/green sheet
"RTN","PSDCOSV",15,0)
 .S PSDN(5)=$P($G(^PSD(58.81,+PSDN(4),1)),U,8)
"RTN","PSDCOSV",16,0)
 .;qty dispensed by Master vault w/o greensheet
"RTN","PSDCOSV",17,0)
 .S:$P(PSDN(8),U,17)']"" PSDN(5)=$P(PSDN(8),U,6)
"RTN","PSDCOSV",18,0)
 .;Returned to Stock
"RTN","PSDCOSV",19,0)
 .S:PSDN(2)=3 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,2)
"RTN","PSDCOSV",20,0)
 .;Destroyed
"RTN","PSDCOSV",21,0)
 .S:PSDN(2)=4 PSDN(5)=-$P($G(^PSD(58.81,+PSDN(4),3)),U,5)
"RTN","PSDCOSV",22,0)
 .;include transfer ins with dispensed
"RTN","PSDCOSV",23,0)
 .S:PSDN(2)=5 PSDN(2)=2
"RTN","PSDCOSV",24,0)
 .;Check for transfers
"RTN","PSDCOSV",25,0)
 .S PSDN(6)=$G(^PSD(58.81,+PSDN(4),7))
"RTN","PSDCOSV",26,0)
 .D:$P(PSDN(6),U)>PSDSD(1)&($P(PSDN(6),U)<PSDED)
"RTN","PSDCOSV",27,0)
 ..S PSDN(5)=PSDN(5)-$P(PSDN(6),U,7),PSDN(2)=5
"RTN","PSDCOSV",28,0)
 .S PSDN(7)=$G(^TMP("PSD",$J,PSDN(3)))
"RTN","PSDCOSV",29,0)
 .;total dispensed
"RTN","PSDCOSV",30,0)
 .S $P(^TMP("PSD",$J,PSDN(3)),U)=$P(PSDN(7),U)+PSDN(5)
"RTN","PSDCOSV",31,0)
 .;total cost
"RTN","PSDCOSV",32,0)
 .S $P(^TMP("PSD",$J,PSDN(3)),U,2)=$P(^TMP("PSD",$J,PSDN(3)),U,2)+($P($G(^PSDRUG(+PSDN(1),660)),U,6)*PSDN(5))
"RTN","PSDCOSV",33,0)
 .K PSDN
"RTN","PSDCOSV",34,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDCOSV",35,0)
 I $D(ZTQUEUED) K ZTSAVE,ZTSK S ZTIO=PSDIO,ZTDESC="CS High Volume Drug Report",ZTRTN="START^PSDCOSV",ZTSAVE("PSD*")="",ZTSAVE("^TMP(""PSD"",$J,")="",ZTSAVE("LOC(")="",ZTSAVE("ALL")="" D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSDCOSV",36,0)
START S (PG,PSDN)=0 D HEADER
"RTN","PSDCOSV",37,0)
 F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:PSDN']""  S PSDN(1)=$G(^TMP("PSD",$J,PSDN)) D:$P(PSDN(1),U)>PSD
"RTN","PSDCOSV",38,0)
 .S ^TMP("PSD",$J,999999999-$P(PSDN(1),U),PSDN)=$P(PSDN(1),U)_U_$P(PSDN(1),U,2)
"RTN","PSDCOSV",39,0)
 F  S PSDN=$O(^TMP("PSD",$J,PSDN)) Q:'PSDN  S PSDN(1)=0 F  S PSDN(1)=$O(^TMP("PSD",$J,PSDN,PSDN(1))) Q:PSDN(1)']""  D:$Y+6>IOSL HEADER G:$G(PSDOUT) END D  G:$G(PSDOUT) END
"RTN","PSDCOSV",40,0)
 .S PSDN(2)=$G(^TMP("PSD",$J,PSDN,PSDN(1)))
"RTN","PSDCOSV",41,0)
 .W $E(PSDN(1),1,34),?36
"RTN","PSDCOSV",42,0)
 .W $J($P(PSDN(2),U),10),?62
"RTN","PSDCOSV",43,0)
 .S X=$P(PSDN(2),U,2),X2="2$" D COMMA^%DTC W X,!!
"RTN","PSDCOSV",44,0)
 W:'$O(^TMP("PSD",$J,0)) !!,"Sorry, nothing to report for selected NAOU(s).",!!
"RTN","PSDCOSV",45,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDCOSV",46,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDCOSV",47,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCOSV",48,0)
QUIT K ^TMP("PSD",$J),IO("Q") Q
"RTN","PSDCOSV",49,0)
HEADER ;prints header info
"RTN","PSDCOSV",50,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCOSV",51,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDCOSV",52,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1 W !?2,PSDCHO(1)," From "
"RTN","PSDCOSV",53,0)
 W $P(PSDATE,U)," To ",$P(PSDATE,U,2),?72,"Page ",PG,!!
"RTN","PSDCOSV",54,0)
 S PSD(2)=$O(LOC(0)) W "For " W:$G(ALL) "ALL NAOU(s)"
"RTN","PSDCOSV",55,0)
 W:'$O(LOC(PSD(2)))&('$G(ALL)) $P($G(^PSD(58.8,+$O(LOC(0)),0)),U)
"RTN","PSDCOSV",56,0)
 I $O(LOC(PSD(2))),'$G(ALL) W "The Following NAOU(s):  " D
"RTN","PSDCOSV",57,0)
 .S PSD(2)=0 F  S PSD(2)=$O(LOC(PSD(2))) Q:'PSD(2)  W $P($G(^PSD(58.8,+PSD(2),0)),U),!?28
"RTN","PSDCOSV",58,0)
 W ?45,"Report Date:  ",PSDT(1),!!?40,"Quantity",!,"Drug",?40,"Dispensed"
"RTN","PSDCOSV",59,0)
 W ?70,"Cost",!,LN,!!
"RTN","PSDCPO")
0^40^B23741541
"RTN","PSDCPO",1,0)
PSDCPO ;BIR/JPW-Green Sheets Picked-Up Log ; 29 Aug 94
"RTN","PSDCPO",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCPO",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCPO",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDCPO",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print the Green Sheets Ready for Pickup Log.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDCPO",6,0)
ASKD ;ask disp loccation
"RTN","PSDCPO",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDCPO",8,0)
 I $P(PSDSITE,U,5) S PSDS=PSDS_"^"_+$P($G(^PSD(58.8,+PSDS,0)),"^",5) G ASKN
"RTN","PSDCPO",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDCPO",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDCPO",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDCPO",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PSDS=PSDS_"^"_+$P(Y(0),"^",5)
"RTN","PSDCPO",13,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDCPO",14,0)
ASKN ;ask naou or group
"RTN","PSDCPO",15,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDCPO",16,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDCPO",17,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDCPO",18,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X,PSDPT=+$E(%,1,12) K DA,DIC S CNT=0
"RTN","PSDCPO",19,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDCPO",20,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7),$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  D
"RTN","PSDCPO",21,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDCPO",22,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDCPO",23,0)
 S:X="^ALL" ALL=1
"RTN","PSDCPO",24,0)
DEV ;ask device and queue info
"RTN","PSDCPO",25,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDCPO",26,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDCPO",27,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDCPO",28,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDCPO",ZTDESC="CS Green Sheets Picked Up By Pharm Log" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDCPO",29,0)
 U IO
"RTN","PSDCPO",30,0)
START ;compile data
"RTN","PSDCPO",31,0)
 K ^TMP("PSDCPO",$J)
"RTN","PSDCPO",32,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",4)=+PSDS S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDCPO",33,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",4)=+PSDS,'$P(^(0),"^",7) S NAOU(+PSD)=""
"RTN","PSDCPO",34,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) Q:'PSD  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",6,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)) S NODE=^PSD(58.81,PSDA,0) D
"RTN","PSDCPO",35,0)
 .S PSDNA=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDCPO",36,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDCPO",37,0)
 .S PSDBY=+$P($G(^PSD(58.81,PSDA,1)),"^",13),PSDBY=$P($G(^VA(200,+PSDBY,0)),"^")
"RTN","PSDCPO",38,0)
 .S NUM=$P(NODE,"^",17),^TMP("PSDCPO",$J,PSDNA,NUM,DRUGN)=PSDBY
"RTN","PSDCPO",39,0)
PRINT ;print green sheets picked up naou, green sheet #
"RTN","PSDCPO",40,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDCPO",41,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDCPO",$J)) D HDR W !!,?10,"****  NO PENDING GREEN SHEETS PICKED UP - NOT COMPLETED  ****" G END
"RTN","PSDCPO",42,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDCPO",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: "_NAOU,! D  Q:PSDOUT
"RTN","PSDCPO",43,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDCPO",$J,NAOU,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  S DRUG=$O(^TMP("PSDCPO",$J,NAOU,NUM,0)) Q:DRUG=""  D
"RTN","PSDCPO",44,0)
 ..W !,NUM,?12,DRUG,?55,$P(^TMP("PSDCPO",$J,NAOU,NUM,DRUG),"^"),!
"RTN","PSDCPO",45,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCPO",46,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCPO",47,0)
END K %,%H,%I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NODE,NUM
"RTN","PSDCPO",48,0)
 K OK,PG,POP,PSD,PSDBY,PSDA,PSDEV,PSDG,PSDN,PSDNA,PSDS,PSDSN,PSDOUT,PSDPT,PSDT,RPDT,SEL,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDCPO",49,0)
 K ^TMP("PSDCPO",$J) D ^%ZISC
"RTN","PSDCPO",50,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCPO",51,0)
 Q
"RTN","PSDCPO",52,0)
GROUP ;select group of naous
"RTN","PSDCPO",53,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDCPO",54,0)
 Q
"RTN","PSDCPO",55,0)
SAVE S (ZTSAVE("PSDT"),ZTSAVE("CNT"),ZTSAVE("PSDS"))="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDCPO",56,0)
 Q
"RTN","PSDCPO",57,0)
HDR ;header for log
"RTN","PSDCPO",58,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCPO",59,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"Green Sheets Picked Up Awaiting Pharmacy Review",?70,"Page: ",PG,!,?30,RPDT,!
"RTN","PSDCPO",60,0)
 W !,"DISP #",?12,"DRUG",?57,"PICKED UP BY"
"RTN","PSDCPO",61,0)
 W !,LN,!
"RTN","PSDCPO",62,0)
 Q
"RTN","PSDCRP")
0^41^B23834500
"RTN","PSDCRP",1,0)
PSDCRP ;BIR/JPW-Green Sheet Discrepancy Report ; 29 Aug 94
"RTN","PSDCRP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCRP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCRP",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDCRP",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"review this narcotics report.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDCRP",6,0)
ASKD ;ask dispensing location
"RTN","PSDCRP",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDCRP",8,0)
 G:$P(PSDSITE,U,5) ASKN
"RTN","PSDCRP",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDCRP",10,0)
 S DIC("A")="Select Primary Dispensing Site: "
"RTN","PSDCRP",11,0)
 S DIC("B")=PSDSN
"RTN","PSDCRP",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDCRP",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDCRP",14,0)
ASKN ;ask NAOU(s)
"RTN","PSDCRP",15,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDCRP",16,0)
 K DA,DIC
"RTN","PSDCRP",17,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDCRP",18,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDCRP",19,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $P($G(^PSD(58.8,PSD,0)),"^",2)="N",$P($G(^(0)),"^",4)=+PSDS S NAOU(PSD)=""
"RTN","PSDCRP",20,0)
DEV ;ask device and queue info
"RTN","PSDCRP",21,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDCRP",22,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDCRP",23,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDCRP",24,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDCRP",ZTDESC="CS Green Sheet Discrep Report" S ZTSAVE("PSDS")="" S:$D(NAOU) ZTSAVE("NAOU(")="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDCRP",25,0)
 U IO
"RTN","PSDCRP",26,0)
START ;compile data
"RTN","PSDCRP",27,0)
 K ^TMP("PSDCRP",$J)
"RTN","PSDCRP",28,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) Q:'PSD  F STAT=3.99:0 S STAT=$O(^PSD(58.81,"AG",STAT)) Q:'STAT!(STAT>6)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AG",STAT,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)),$P(^(0),"^",3)=+PSDS D
"RTN","PSDCRP",29,0)
 .S NODE=^PSD(58.81,PSDA,0),PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN"),STATN=$P($G(^PSD(58.83,+STAT,0)),"^")
"RTN","PSDCRP",30,0)
 .S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD) I NAOUN'="UNKNOWN" S NAOUN=$E(NAOUN,1,10)
"RTN","PSDCRP",31,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDCRP",32,0)
 .S PHARM=$P($G(^PSD(58.81,PSDA,1)),"^",14),PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDCRP",33,0)
 .S NURS=$P($G(^PSD(58.81,PSDA,1)),"^",10),NURSN=$S($P($G(^VA(200,+NURS,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I NURSN'="UNKNOWN" S NURSN=$P(NURSN,",")_","_$E($P(NURSN,",",2))
"RTN","PSDCRP",34,0)
 .S REAS=$P($G(^PSD(58.81,PSDA,1)),"^",15)
"RTN","PSDCRP",35,0)
 .S PSDST=$P(NODE,"^",19) I PSDST S Y=PSDST X ^DD("DD") S PSDST=Y
"RTN","PSDCRP",36,0)
 .S ^TMP("PSDCRP",$J,NAOUN,PSDPN,PSDA)=DRUGN_"^"_STATN_"^"_PHARMN_"^"_NURSN_"^"_PSDST_"^"_REAS
"RTN","PSDCRP",37,0)
PRINT ;print comp stat discrep report
"RTN","PSDCRP",38,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDCRP",39,0)
 S (PG,PSDOUT)=0
"RTN","PSDCRP",40,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDCRP",$J)) D HDR W !!,?40,"****  NO PENDING GREEN SHEET DISCREPANCIES  ****",! G DONE
"RTN","PSDCRP",41,0)
 S PSD="" F  S PSD=$O(^TMP("PSDCRP",$J,PSD)) Q:PSD=""!(PSDOUT)  D HDR W !,?2,"=> ",PSD,! S NUM="" F  S NUM=$O(^TMP("PSDCRP",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  D
"RTN","PSDCRP",42,0)
 .F PSDA=0:0 S PSDA=$O(^TMP("PSDCRP",$J,PSD,NUM,PSDA)) Q:'PSDA!(PSDOUT)  D
"RTN","PSDCRP",43,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSD,!
"RTN","PSDCRP",44,0)
 ..S NODE=^TMP("PSDCRP",$J,PSD,NUM,PSDA) W !,NUM,?15,$P(NODE,"^"),?58,$P(NODE,"^",5),?80,$P(NODE,"^",2)
"RTN","PSDCRP",45,0)
 ..W !!,?15,"*RPh: ",$P(NODE,"^",3),?58,"*Comp. by Nurse: ",$P(NODE,"^",4),!
"RTN","PSDCRP",46,0)
 ..I $P(NODE,"^",6)]"" W ?25,"**Reason Referred: ",$P(NODE,"^",6),!
"RTN","PSDCRP",47,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCRP",48,0)
 I $E(IOST,1,2)="C-",'PSDOUT K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCRP",49,0)
END ;
"RTN","PSDCRP",50,0)
 K %,%DT,%H,%I,%ZIS,C,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,LN,NAOU,NAOUN,NODE,NUM,NURS,NURSN
"RTN","PSDCRP",51,0)
 K OK,PG,PHARM,PHARMN,POP,PSD,PSDA,PSDEV,PSDOUT,PSDPN,PSDS,PSDSN,PSDST,REAS,RPDT,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDCRP",52,0)
 K ^TMP("PSDCRP",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCRP",53,0)
 Q
"RTN","PSDCRP",54,0)
HDR ;header for log
"RTN","PSDCRP",55,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCRP",56,0)
 S PG=PG+1 W:$Y @IOF W !,?45,"Green Sheet Discrepancies Report",?115,"Page: ",PG,!,?48,"Date Printed: ",RPDT,!
"RTN","PSDCRP",57,0)
 W !,?2,"=> NAOU",!,"DISP #",?15,"DRUG",?58,"DATE POSTED",?80,"COMPLETION STATUS"
"RTN","PSDCRP",58,0)
 W !,LN,!
"RTN","PSDCRP",59,0)
 Q
"RTN","PSDCSI")
0^42^B11445386
"RTN","PSDCSI",1,0)
PSDCSI ;BIR/JPW-Inspector Place Hold on Green Sheet ; 10 Nov 93
"RTN","PSDCSI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCSI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDCSI",4,0)
 W !!,"Inspector Place a Green Sheet on Hold" S PSDUZ=DUZ,PSDUZN=$S($P($G(^VA(200,PSDUZ,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDCSI",5,0)
ASKN ;if nurse ask naou
"RTN","PSDCSI",6,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: "
"RTN","PSDCSI",7,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDCSI",8,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDCSI",9,0)
GS ;select green sheet #
"RTN","PSDCSI",10,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDCSI",11,0)
 S DIC("S")="I $P(^(0),""^"",11),$P(^(0),""^"",11)<10"
"RTN","PSDCSI",12,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDCSI",13,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDCSI",14,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDCSI",15,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCSI",16,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDCSI",17,0)
 I STAT'=4 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDCSI",18,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDCSI",19,0)
 S DIR("?",1)="Answer 'YES' to to place this Green Sheet on hold for the Inspector or",DIR("?")="answer 'NO' to leave the Green Sheet status active on the NAOU."
"RTN","PSDCSI",20,0)
 D ^DIR K DIR G:$D(DIRUT) END G:'Y GS
"RTN","PSDCSI",21,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDCSI",22,0)
COM ;complete at order level in 58.8
"RTN","PSDCSI",23,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDCSI",24,0)
 W !!,"Updating your records now..."
"RTN","PSDCSI",25,0)
 ;update transaction file (58.81)
"RTN","PSDCSI",26,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="29.8;6////"_PSDUZ_";29.6////"_RECD_";10////11" D ^DIE K DA,DIE,DR
"RTN","PSDCSI",27,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN PLACED ON HOLD **",!!,"The status remains "_STATN,! G END
"RTN","PSDCSI",28,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////11" D ^DIE K DA,DIE,DR
"RTN","PSDCSI",29,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,!,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDCSI",30,0)
 G GS
"RTN","PSDCSI",31,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDCSI",32,0)
 K NAOU,NAOUN,OK,ORD,PSDA,PSDPN,PSDR,PSDRN,PSDUZ,PSDUZN,RECD,RECDT,STAT,STATN,SUB,TRANS,X,Y
"RTN","PSDCSI",33,0)
 Q
"RTN","PSDCSL")
0^43^B13279521
"RTN","PSDCSL",1,0)
PSDCSL ;BIR/JPW-List Drug Name & Stats from DRUG file (#50) ; 29 Aug 94
"RTN","PSDCSL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDCSL",3,0)
 W !!,"This report lists Drug name, order unit, price per order unit, dispense unit,",!,"dispense units per order unit, and price per dispense unit.",!
"RTN","PSDCSL",4,0)
 W !,"This report is designed for a 132 column format.",!!
"RTN","PSDCSL",5,0)
DEV ;asks device and queueing information
"RTN","PSDCSL",6,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDCSL",7,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDCSL",ZTDESC="CS PHARM LIST DATA FOR DRUG STATS" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDCSL",8,0)
 U IO
"RTN","PSDCSL",9,0)
START ;compiles and prints data for report
"RTN","PSDCSL",10,0)
 K ^TMP("PSDCSL",$J)
"RTN","PSDCSL",11,0)
 S (PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDCSL",12,0)
 S PSD="" F  S PSD=$O(^PSDRUG("AIUN",PSD)) Q:PSD=""  F NUM=0:0 S NUM=$O(^PSDRUG("AIUN",PSD,NUM)) Q:'NUM  I $D(^PSDRUG(NUM,0)) D
"RTN","PSDCSL",13,0)
 .S OK=$S('$D(^PSDRUG(PSD,"I")):1,'+^("I"):1,+^("I")>DT:1,1:0) Q:'OK
"RTN","PSDCSL",14,0)
 .S PSDRN=$S($P(^PSDRUG(NUM,0),"^")]"":$P(^(0),"^"),1:"ZZ #"_NUM_" DRUG NAME MISSING")
"RTN","PSDCSL",15,0)
 .I '$D(^PSDRUG(NUM,660)) S (ORU,ORUP,ORD,ORDP,ORDU)="NO DATA"
"RTN","PSDCSL",16,0)
 .I $D(^PSDRUG(NUM,660)) S NODE=^PSDRUG(NUM,660),ORU=+$P(NODE,"^",2),ORU=$S(ORU:$P($G(^DIC(51.5,ORU,0)),"^"),1:"NO DATA"),ORUP=$S($P(NODE,"^",3)]"":$P(NODE,"^",3),1:"NO DATA") D
"RTN","PSDCSL",17,0)
 ..S ORD=$S($P(NODE,"^",5)]"":$P(NODE,"^",5),1:"NO DATA"),ORDP=$S($P(NODE,"^",6)]"":$P(NODE,"^",6),1:"NO DATA"),ORDU=$S($P(NODE,"^",8)]"":$P(NODE,"^",8),1:"NO DATA")
"RTN","PSDCSL",18,0)
 .S ^TMP("PSDCSL",$J,PSDRN,NUM)=ORU_"^"_ORUP_"^"_ORDU_"^"_ORD_"^"_ORDP
"RTN","PSDCSL",19,0)
PRINT ;prints data from ^tmp
"RTN","PSDCSL",20,0)
 K LN S $P(LN,"-",132)="" D HEADER
"RTN","PSDCSL",21,0)
 I '$D(^TMP("PSDCSL",$J)) W !!,?30,"NO DATA FOR THE DRUG FILE STATS REPORT!!",!! G DONE
"RTN","PSDCSL",22,0)
 S PSD="" F  S PSD=$O(^TMP("PSDCSL",$J,PSD))  Q:PSD=""!(PSDOUT)  D:$Y+5>IOSL HEADER F NUM=0:0 S NUM=$O(^TMP("PSDCSL",$J,PSD,NUM)) Q:'NUM!(PSDOUT)  D
"RTN","PSDCSL",23,0)
 .W !,?2,PSD
"RTN","PSDCSL",24,0)
 .S NODE=$G(^TMP("PSDCSL",$J,PSD,NUM)),ORU=$P(NODE,"^"),ORUP=$P(NODE,"^",2),ORDU=$P(NODE,"^",3),ORD=$P(NODE,"^",4),ORDP=$P(NODE,"^",5)
"RTN","PSDCSL",25,0)
 .W ?47,$S(ORU="NO DATA":ORU,1:$J(ORU,4)),?61,$S(ORUP="NO DATA":ORUP,1:$J(ORUP,7)),?80,$S(ORDU="NO DATA":ORDU,1:$J(ORDU,6))
"RTN","PSDCSL",26,0)
 .W ?100,$S(ORD="NO DATA":ORD,1:$J(ORD,6)),?120,$S(ORDP="NO DATA":ORDP,1:$J(ORDP,6))
"RTN","PSDCSL",27,0)
 W !
"RTN","PSDCSL",28,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDCSL",29,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDCSL",30,0)
END ;
"RTN","PSDCSL",31,0)
 K %DT,%ZIS,DA,DEA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,NUM,OK,ORD,ORDP,ORDU,ORU,ORUP,PG,POP,PSD,PSDRN,PSDOUT,RPDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSK
"RTN","PSDCSL",32,0)
 K ^TMP("PSDCSL",$J)
"RTN","PSDCSL",33,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDCSL",34,0)
 Q
"RTN","PSDCSL",35,0)
HEADER ;prints header information
"RTN","PSDCSL",36,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDCSL",37,0)
 W:$Y @IOF S PG=PG+1 W !,?45,"DRUG FILE STATS FOR CS PHARM DRUGS",!,?55,RPDT,?120,"PAGE: "_PG,!!
"RTN","PSDCSL",38,0)
 W ?47,"ORDER",?59,"PRICE PER",?80,"DISPENSE",?97,"DISPENSE UNITS",?118,"PRICE PER"
"RTN","PSDCSL",39,0)
 W !,"DRUG NAME",?47,"UNIT",?59,"ORDER UNIT",?82,"UNIT",?97,"PER ORDER UNIT",?118,"DISPENSE UNIT",!,LN,!
"RTN","PSDCSL",40,0)
 Q
"RTN","PSDDFP")
0^44^B19730853
"RTN","PSDDFP",1,0)
PSDDFP ;BIR/JPW-Dispense from Pharmacy w/o Green Sheet ; 8 Aug 94
"RTN","PSDDFP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDFP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDDFP",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"dispense narcotic supplies.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDDFP",5,0)
 S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDDFP",6,0)
ASKD ;ask disp loc
"RTN","PSDDFP",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDDFP",8,0)
 I $P(PSDSITE,U,5) S ASK=$P($G(^PSD(58.8,+PSDS,0)),U,5) G CHKD
"RTN","PSDDFP",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDDFP",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDDFP",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDDFP",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),ASK=$P(Y(0),"^",5)
"RTN","PSDDFP",13,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDDFP",14,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no stocked drugs for this Pharmacy Vault!!",!! G END
"RTN","PSDDFP",15,0)
DRUG ;select drug
"RTN","PSDDFP",16,0)
 S PSDOUT=0 W !
"RTN","PSDDFP",17,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDDFP",18,0)
 S DIC("S")="I '$P($G(^(7)),U,2)"
"RTN","PSDDFP",19,0)
 S DA(1)=+PSDS,DIC(0)="QEAMZ",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC G:Y<0 END S PSDR=+Y,PSDRN=$P($G(^PSDRUG(+PSDR,0)),"^")
"RTN","PSDDFP",20,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,0)) W $C(7),!!,?10,"** Your Dispensing Site is missing stock drug data.",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDDFP",21,0)
 S (MFG,LOT,EXP,EXPD,NBKU,NPKG)="",MFG=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",10),LOT=$P(^(0),"^",11),EXP=$P(^(0),"^",12),NBKU=$P(^(0),"^",8),NPKG=$P(^(0),"^",9)
"RTN","PSDDFP",22,0)
 I 'NPKG!(NBKU']"") W $C(7),!!,PSDRN," is missing breakdown unit or",!,"package size data in ",PSDSN,"." D MSG G END
"RTN","PSDDFP",23,0)
 I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDDFP",24,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDDFP",25,0)
 I NBKU']"" W !!,PSDSN,"is missing narcotic breakdown unit",!,"for ",PSDRN,"." G END
"RTN","PSDDFP",26,0)
 I 'NPKG W !!,PSDSN,"is missing narcotic package size",!,"for ",PSDRN,"." G END
"RTN","PSDDFP",27,0)
NAOU ;select NAOU
"RTN","PSDDFP",28,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDDFP",29,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"""
"RTN","PSDDFP",30,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDDFP",31,0)
QTY K DA,DIR,DIRUT S DIR(0)="58.85,18O",DIR("B")=NPKG,DIR("A")="QUANTITY DISPENSED ("_NBKU_"/"_NPKG_")" D ^DIR K DIR I 'Y!$D(DIRUT) D MSG G END
"RTN","PSDDFP",32,0)
 S QTY=+Y I QTY>+$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4) W !!,"The drug balance for this drug is ",+$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4),".",!,"You cannot dispense ",QTY," for this drug.",!! G END
"RTN","PSDDFP",33,0)
ASKM I ASK D MFG I PSDOUT D MSG G END
"RTN","PSDDFP",34,0)
OK W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK? ",DIR("?",1)="Answer 'YES' to record dispensing this drug,"
"RTN","PSDDFP",35,0)
 S DIR("?")="NO to select another drug or '^' to quit." D ^DIR K DIR
"RTN","PSDDFP",36,0)
 I $D(DIRUT) D MSG G END
"RTN","PSDDFP",37,0)
 I 'Y D MSG G DRUG
"RTN","PSDDFP",38,0)
 D ^PSDDFP1 G:'PSDOUT DRUG
"RTN","PSDDFP",39,0)
END K %,%DT,%H,%I,ASK,BAL,DA,DIC,DIE,DIK,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EDIT,EXP,EXPD,LOT,MFG,NAOU,NAOUN,NBKU,NPKG,OK
"RTN","PSDDFP",40,0)
 K PSDDT,PSDLES,PSDOUT,PSDR,PSDREC,PSDRN,PSDS,PSDSN,PSDUZ,PSDUZN,QTY,TEXP,TLOT,TMFG,X,Y
"RTN","PSDDFP",41,0)
 Q
"RTN","PSDDFP",42,0)
MFG K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,12O",DIR("B")=MFG D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDDFP",43,0)
 I Y]"",Y'=MFG S MFG=Y S $P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",10)=MFG
"RTN","PSDDFP",44,0)
 K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,13O",DIR("B")=LOT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDDFP",45,0)
 I Y]"",Y'=LOT S LOT=Y S $P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",11)=LOT
"RTN","PSDDFP",46,0)
 K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,14O",DIR("B")=EXPD D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDDFP",47,0)
 I Y,Y'=EXP S EXP=Y W !!,"Updating Expiration Date data..." K DA,DIE,DR S DA=+PSDR,DA(1)=+PSDS,DIE="^PSD(58.8,"_DA(1)_",1,",DR="11///"_EXP D ^DIE K DA,DIE,DR W "done.",!!
"RTN","PSDDFP",48,0)
 Q
"RTN","PSDDFP",49,0)
MSG W !!,"** No action taken. **",!!
"RTN","PSDDFP",50,0)
 Q
"RTN","PSDDFP1")
0^45^B6209533
"RTN","PSDDFP1",1,0)
PSDDFP1 ;BIR/JPW-Disp from Pharm w/o Green Sheet (cont'd) ; 2 Aug 93
"RTN","PSDDFP1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDFP1",3,0)
TRANS ;create a disp transaction
"RTN","PSDDFP1",4,0)
 W !!,"Creating a dispensing transaction..."
"RTN","PSDDFP1",5,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDDFP1",6,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDDFP1",7,0)
 K DA,DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDDFP1",8,0)
 L -^PSD(58.81,0)
"RTN","PSDDFP1",9,0)
ADD ;add info to your vault (58.8)
"RTN","PSDDFP1",10,0)
 W "vault activity" S:'$D(^PSD(58.8,PSDS,1,PSDR,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDDFP1",11,0)
 K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_PSDS_",1,"_PSDR_",4,",DA(2)=PSDS,DA(1)=PSDR,(X,DINUM)=PSDREC D FILE^DICN K DIC
"RTN","PSDDFP1",12,0)
 ;monthly activity
"RTN","PSDDFP1",13,0)
 I '$D(^PSD(58.8,PSDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDDFP1",14,0)
 I '$D(^PSD(58.8,PSDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DIC S DIC="^PSD(58.8,"_PSDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDS,DA(1)=PSDR D ^DIC K DIC,DA,DINUM,DLAYGO
"RTN","PSDDFP1",15,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_PSDS_",1,"_PSDR_",5,",DA(2)=PSDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR="9////^S X=$P($G(^(0)),""^"",6)+QTY" D ^DIE K DA,DIE,DR
"RTN","PSDDFP1",16,0)
UPDATE ;update transaction with activity # from 58.8
"RTN","PSDDFP1",17,0)
 W !!,?5,"Updating on-hand quantity..."
"RTN","PSDDFP1",18,0)
 F  L +^PSD(58.8,PSDS,1,PSDR,0):0 I  Q
"RTN","PSDDFP1",19,0)
 D NOW^%DTC S PSDDT=+%
"RTN","PSDDFP1",20,0)
 S BAL=$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-QTY
"RTN","PSDDFP1",21,0)
 L -^PSD(58.8,PSDS,1,PSDR,0) S $P(^PSD(58.81,PSDREC,0),"^",10)=BAL W "done.",!
"RTN","PSDDFP1",22,0)
 W !!,"Old Balance : ",BAL,?35,"New Balance: ",BAL-QTY
"RTN","PSDDFP1",23,0)
 W !!,"Updating your transaction history..."
"RTN","PSDDFP1",24,0)
 K DA,DIE,DR S DA=PSDREC,DIE=58.81
"RTN","PSDDFP1",25,0)
 S DR="1////2;2////"_PSDS_";4////"_PSDR_";3////"_PSDDT_";5////"_QTY_";9////"_BAL_";6////"_PSDUZ_";17////"_NAOU_";100////1" D ^DIE
"RTN","PSDDFP1",26,0)
 I ASK W "still updating..." K DR S DR="12///"_MFG_";13///"_LOT_";14///"_EXP D ^DIE
"RTN","PSDDFP1",27,0)
 K DA,DIE,DR W "done.",!!
"RTN","PSDDFP1",28,0)
END Q
"RTN","PSDDWK")
0^46^B22797507
"RTN","PSDDWK",1,0)
PSDDWK ;BIR/JPW-Pharm Dispensing Worksheet ; 6 July 94
"RTN","PSDDWK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDDWK",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDDWK",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"process/dispense narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDDWK",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH Q
"RTN","PSDDWK",7,0)
 I '$O(^PSD(58.85,0)) W $C(7),!!,"There are no pending request orders.",!! Q
"RTN","PSDDWK",8,0)
 S (PSDNO,NOFLAG)=0
"RTN","PSDDWK",9,0)
ASKD ;ask dispensing location
"RTN","PSDDWK",10,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDDWK",11,0)
 I $P(PSDSITE,U,5) S OKD=1,NODED=^PSD(58.8,+PSDS,0) G SETD
"RTN","PSDDWK",12,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDDWK",13,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDDWK",14,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDDWK",15,0)
 ;set PSDS=disp.site,PSDM=ask mfg/lot#/exp.date,SITE=inpat.site,PSDAG=auto gen.disp.#s,PSDRG=using form 10-179,PSDGS=print green sheet
"RTN","PSDDWK",16,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),NODED=Y(0)
"RTN","PSDDWK",17,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDDWK",18,0)
SETD S PSDM=+$P(NODED,"^",5),PSDAG=+$P($G(^PSD(58.8,+PSDS,2)),"^")
"RTN","PSDDWK",19,0)
 S PSDRG=+$P($G(^PSD(58.8,+PSDS,2)),"^",5),PSDGS=+$P($G(^PSD(58.8,+PSDS,2)),"^",6)
"RTN","PSDDWK",20,0)
 I '$D(^PSD(58.85,"AW",+PSDS)) D MSG G END
"RTN","PSDDWK",21,0)
ASKM ;ask method of dispensing - by worksheet or individual request
"RTN","PSDDWK",22,0)
 K DA,DIR,DIRUT S DIR(0)="SOB^W:Worksheet;R:Individual Request",DIR("A")="Dispensing Method"
"RTN","PSDDWK",23,0)
 S DIR("?",1)="Enter 'W' to dispense by last worksheet printed, enter 'R' to",DIR("?")="dispense by individual request, or '^' to quit"
"RTN","PSDDWK",24,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDDWK",25,0)
 S PSDOUT=0 N X,X1 D SIG^XUSESIG G:X1="" END D:ANS="R" REQ D:ANS="W" WK
"RTN","PSDDWK",26,0)
 I 'NOFLAG D MSG
"RTN","PSDDWK",27,0)
END K %,%H,%I,%ZIS,ACT,ALL,ANS,BAL,CNT,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,FLAG
"RTN","PSDDWK",28,0)
 K LN,LOOP,LOT,MFG,MSG,NAOU,NAOUN,NBKU,NEW,NODE,NODED,NOFLAG,NPKG,NSITE,OK,OKD,ORD,ORDN,ORDS,ORDSN,PAT
"RTN","PSDDWK",29,0)
 K PRT,PSD,PSDAG,PSDAGN,PSDBY,PSDBYN,PSDDT,PSDG,PSDGS,PSDGSN,PSDIO,PSDLES,PSDM,PSDMN,PSDN,PSDNA,PSDNO,PSDOUT,PSDPN
"RTN","PSDDWK",30,0)
 K PSDR,PSDRN,PSDREC,PSDRG,PSDRGN,PSDRN,PSDS,PSDSN,PSDT,PSDUZA,QTY,REQ,REQD,REQDT,SITE,STAT,TECH,TEXT,WORD,X,Y
"RTN","PSDDWK",31,0)
 Q
"RTN","PSDDWK",32,0)
WK ;compile worksheet dispensing data
"RTN","PSDDWK",33,0)
 W !!,"Accessing worksheet information..."
"RTN","PSDDWK",34,0)
 F PSD=0:0 S PSD=$O(^PSD(58.85,"AW",+PSDS,PSD)) Q:('PSD)!(PSDOUT)  F PSDN=0:0 S PSDN=$O(^PSD(58.85,"AW",+PSDS,PSD,PSDN)) Q:('PSDN)!(PSDOUT)  I $D(^PSD(58.85,PSDN,0)) D SET D:STAT<3&($D(^PSD(58.8,+$G(ORDS),1,+$G(PSDR)))) ^PSDDWK1 Q:PSDOUT
"RTN","PSDDWK",35,0)
 Q
"RTN","PSDDWK",36,0)
REQ ;dispense by individual request
"RTN","PSDDWK",37,0)
 W !!,"Accessing worksheet information..."
"RTN","PSDDWK",38,0)
 F PSD=0:0 S PSD=$O(^PSD(58.85,"AW",+PSDS,PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSD(58.85,"AW",+PSDS,PSD,PSDN)) Q:'PSDN  I $D(^PSD(58.85,PSDN,0)),$P(^(0),"^",7)<3 S NOFLAG=1
"RTN","PSDDWK",39,0)
 Q:'NOFLAG
"RTN","PSDDWK",40,0)
 K DA,DIC W ! S DIC=58.85,DIC(0)="QEA",DIC("A")="Select Request #: ",DIC("S")="I $P(^(0),""^"",2)=+PSDS,$P(^(0),""^"",7)<3" D ^DIC K DIC Q:Y<0  S PSDN=+Y D SET
"RTN","PSDDWK",41,0)
 I STAT>2 W !!,"The status of this request is "_$P($G(^PSD(58.82,STAT,0)),"^")_".",!,"You cannot edit this request using this option.",! G REQ
"RTN","PSDDWK",42,0)
 D ^PSDDWK1 Q:PSDOUT
"RTN","PSDDWK",43,0)
 G REQ
"RTN","PSDDWK",44,0)
SET ;sets data for display/editing
"RTN","PSDDWK",45,0)
 Q:'$D(^PSD(58.85,PSDN,0))  S NODE=^(0),(NSITE,PSDMN,PSDAGN,PSDRGN,PSDGSN)=0
"RTN","PSDDWK",46,0)
 S STAT=+$P(NODE,"^",7) Q:STAT>2  S PSDRN=+$P(NODE,"^",5)
"RTN","PSDDWK",47,0)
 S NAOU=+$P(NODE,"^",3),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_NAOU)
"RTN","PSDDWK",48,0)
 S PSDR=+$P(NODE,"^",4),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR)
"RTN","PSDDWK",49,0)
 S ORDS=+$P(NODE,"^",2),ORDSN=$P($G(^PSD(58.8,+ORDS,0)),"^")
"RTN","PSDDWK",50,0)
 S PSDUZA=+$P(NODE,"^",19)
"RTN","PSDDWK",51,0)
 S REQ=+$P(NODE,"^",5),REQDT=$P(NODE,"^",18) I REQDT S Y=$E(REQDT,1,7) X ^DD("DD") S REQD=Y
"RTN","PSDDWK",52,0)
 S QTY=$S($P(NODE,"^",17):$P(NODE,"^",17),1:$P(NODE,"^",6)),PSDPN=$P(NODE,"^",15),PSDT=$P(NODE,"^",14) I PSDT S Y=$E(PSDT,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDDWK",53,0)
 S ORD=+$P(NODE,"^",12),ORDN=$P($G(^VA(200,+ORD,0)),"^"),PSDBY=+$P(NODE,"^",13),PSDBYN="" I PSDBY S PSDBYN=$P($G(^VA(200,PSDBY,0)),"^")
"RTN","PSDDWK",54,0)
 S PAT=$P($G(^PSD(58.85,PSDN,2)),U,3)
"RTN","PSDDWK",55,0)
 I $D(^XUSEC("PSJ RPHARM",DUZ)),'PSDBY S PSDBY=DUZ,PSDBYN=$P($G(^VA(200,PSDBY,0)),"^")
"RTN","PSDDWK",56,0)
 S (MFG,LOT,EXP,EXPD,NBKU,NPKG)=""
"RTN","PSDDWK",57,0)
 I $D(^PSD(58.8,+ORDS,1,PSDR,0)) S MFG=$P(^(0),"^",10),LOT=$P(^(0),"^",11),EXP=$P(^(0),"^",12),NBKU=$P(^(0),"^",8),NPKG=+$P(^(0),"^",9) I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDDWK",58,0)
 Q
"RTN","PSDDWK",59,0)
MSG W $C(7),!!,"There are no pending CS requests for ",PSDSN,".",!
"RTN","PSDDWK",60,0)
 W !,"Press <RET> to return to the menu" R X:DTIME W !!
"RTN","PSDDWK",61,0)
 Q
"RTN","PSDDWK1")
0^47^B12826908
"RTN","PSDDWK1",1,0)
PSDDWK1 ;BIR/JPW-Pharm Dispensing Worksheet (cont'd) ; 25 Aug 94
"RTN","PSDDWK1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWK1",3,0)
START ;entry point for dispensing options
"RTN","PSDDWK1",4,0)
 S (NEW,PSDNO)=0,NOFLAG=1,ACT="" D DISPLAY Q:(PSDOUT)!(PSDNO)
"RTN","PSDDWK1",5,0)
 S ORDS=$S(NEW:ORDS,1:+PSDS)
"RTN","PSDDWK1",6,0)
CHK ;
"RTN","PSDDWK1",7,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) D TECH Q:PSDOUT  G ACT
"RTN","PSDDWK1",8,0)
 S BAL=+$P(^PSD(58.8,ORDS,1,PSDR,0),"^",4)
"RTN","PSDDWK1",9,0)
 I QTY>BAL W $C(7),!!,"=>  The drug balance is "_BAL_".  You cannot dispense "_QTY_" for this drug.",! G PHARM
"RTN","PSDDWK1",10,0)
 W !!,"Old Balance: ",BAL,?35,"New Balance: ",BAL-QTY,!
"RTN","PSDDWK1",11,0)
PHARM ;by dispensing pharmacist
"RTN","PSDDWK1",12,0)
 W ! K DA,DIR,DTOUT,DUOUT S DIR(0)="SOBA^V:VERIFY;DC:CANCEL;E:EDIT;B:BYPASS;S:SHOW",DIR("?",1)="Enter 'V' to verify or dispense this order, 'DC' to cancel this order,"
"RTN","PSDDWK1",13,0)
 S DIR("?",2)="'E' to edit, 'B' to bypass without verifying,",DIR("?")="'S' to show this order again or '^' to quit.",DIR("A")="ACTION (V DC E B S): "
"RTN","PSDDWK1",14,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSDOUT=1 D MSG Q
"RTN","PSDDWK1",15,0)
 S ACT=$S(Y="":"B",1:Y)
"RTN","PSDDWK1",16,0)
ACT ;decides disp action
"RTN","PSDDWK1",17,0)
 I ACT="V" D ^PSDDWK2 Q
"RTN","PSDDWK1",18,0)
 I ACT="P" D ^PSDDWK2 Q
"RTN","PSDDWK1",19,0)
 I ACT="DC" D ^PSDDWK4 Q:STAT=9  Q:PSDOUT  G CHK
"RTN","PSDDWK1",20,0)
 I ACT="E" D EDIT^PSDDWKE Q:(PSDOUT)!(PSDNO)  G CHK
"RTN","PSDDWK1",21,0)
 I ACT="S" D DISPLAY G CHK
"RTN","PSDDWK1",22,0)
 I ACT="B" D MSG
"RTN","PSDDWK1",23,0)
END Q
"RTN","PSDDWK1",24,0)
TECH ;by tech or non-disp pharmacist
"RTN","PSDDWK1",25,0)
 W ! K DA,DIR,DTOUT,DUOUT S DIR("A")="ACTION",DIR(0)="SOBA^P:PROCESS;DC:CANCEL;E:EDIT;B:BYPASS;S:SHOW",DIR("?",1)="Enter 'P' to process this order, 'C' to cancel this order,"
"RTN","PSDDWK1",26,0)
 S DIR("?",2)="'E' to edit, 'B' to bypass without processing,",DIR("?")="'S' to show this order again or '^' to quit.",DIR("A")="ACTION (P DC E B S): "
"RTN","PSDDWK1",27,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSDOUT=1 D MSG Q
"RTN","PSDDWK1",28,0)
 S ACT=$S(Y="":"B",1:Y)
"RTN","PSDDWK1",29,0)
 Q
"RTN","PSDDWK1",30,0)
MSG W !!,"Press <RET> to continue" R X:DTIME W !!
"RTN","PSDDWK1",31,0)
 I '$T!(X["^") S PSDOUT=1
"RTN","PSDDWK1",32,0)
 Q
"RTN","PSDDWK1",33,0)
DISPLAY ;displays order request
"RTN","PSDDWK1",34,0)
 Q:PSDOUT  W @IOF,!,?23,"Controlled Substance Order Request"
"RTN","PSDDWK1",35,0)
 I $P($G(^PSD(58.85,PSDN,2)),U,2) W !,?27,"*** EMERGENCY" W:$G(PAT) " INFUSION" W " ORDER ***"
"RTN","PSDDWK1",36,0)
 W !! K LN S $P(LN,"-",80)=""
"RTN","PSDDWK1",37,0)
 W "Pharmacy Dispensing #: ",$S(PSDPN:PSDPN,1:""),!,"Requested by",?16,": ",ORDN,?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDDWK1",38,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,QTY
"RTN","PSDDWK1",39,0)
 W:$G(PAT) !,"Patient",?16,": ",$P($G(^DPT(+$G(PAT),0)),U)
"RTN","PSDDWK1",40,0)
 W !,"Dispensed by",?16,": ",$S(PSDBY:PSDBYN,1:""),?50,"Dispensed Date: ",$S(PSDT:PSDDT,1:""),!,"Disp. Location",?16,": ",$S($D(ORDSN):ORDSN,1:"")
"RTN","PSDDWK1",41,0)
 W !,"Manufacturer",?16,": ",MFG,!,"Lot #",?16,": ",LOT,!,"Exp. Date",?16,": ",EXPD
"RTN","PSDDWK1",42,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,STAT,0)),"^"),!,"Comments:" S COMM=0
"RTN","PSDDWK1",43,0)
 I $D(^PSD(58.85,PSDN,1,0)) S COMM=1 K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.85,PSDN,1,TEXT)) Q:'TEXT  S X=$G(^PSD(58.85,PSDN,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDDWK1",44,0)
 I COMM D ^DIWW S COMM=0
"RTN","PSDDWK1",45,0)
 Q
"RTN","PSDDWK2")
0^48^B11518632
"RTN","PSDDWK2",1,0)
PSDDWK2 ;BIR/JPW-Pharm Dispensing Worksheet (cont'd) ; 21 Jun 93
"RTN","PSDDWK2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWK2",3,0)
PROC ;ver/proc req ord
"RTN","PSDDWK2",4,0)
 D CHK Q:PSDLES
"RTN","PSDDWK2",5,0)
 S TECH=$S($P($G(^PSD(58.85,PSDN,0)),"^",16):$P(^(0),"^",16),ACT="P":DUZ,1:"") I PSDT="" D NOW^%DTC S PSDT=+%
"RTN","PSDDWK2",6,0)
DISPN ;assign dsp #s
"RTN","PSDDWK2",7,0)
 G:$P($G(^PSD(58.85,PSDN,0)),"^",15) EDIT S FLAG=0,ORDS=$S(NEW:ORDS,1:PSDS),PSDAGN=$S(NEW:PSDAGN,1:PSDAG)
"RTN","PSDDWK2",8,0)
 I PSDAGN W !!,"Assigning Pharmacy Dispensing #...",! D AUTO Q:PSDOUT  G EDIT
"RTN","PSDDWK2",9,0)
ASKN K DIR,DIRUT S DIR(0)="N^1:999999999:0",DIR("A")="PHARMACY DISPENSING #",DIR("?")="Enter your narcotic control number for this order." D ^DIR K DIR
"RTN","PSDDWK2",10,0)
 I $D(DIRUT) W !!,"This order cannot be processed without a dispensing number.",!!,"Press <RET> to continue" R X:DTIME Q
"RTN","PSDDWK2",11,0)
 I +$O(^PSD(58.81,"D",Y,0)) W !!,"The number "_Y_" has previously been used as a dispensing number.",!,"Please select another number.",!! G ASKN
"RTN","PSDDWK2",12,0)
 S PSDPN=Y
"RTN","PSDDWK2",13,0)
EDIT ;edit/add ord
"RTN","PSDDWK2",14,0)
 S BAL=0 W !!,"PHARMACY DISPENSING # ",PSDPN,!
"RTN","PSDDWK2",15,0)
 K PSDREC I +$P($G(^PSD(58.85,PSDN,0)),"^",8) S PSDREC=$P(^(0),"^",8)
"RTN","PSDDWK2",16,0)
 W !!,"Accessing the order...",! D:'$D(PSDREC) ADD D:ACT="V" SUB
"RTN","PSDDWK2",17,0)
 W !,"Updating the transaction..."
"RTN","PSDDWK2",18,0)
 D UPDATE^PSDDWK3,MSG1
"RTN","PSDDWK2",19,0)
 Q
"RTN","PSDDWK2",20,0)
ADD ;find entry number
"RTN","PSDDWK2",21,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDDWK2",22,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDDWK2",23,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSDDWK2",24,0)
 L -^PSD(58.81,0)
"RTN","PSDDWK2",25,0)
 Q
"RTN","PSDDWK2",26,0)
AUTO ;select next available disp #
"RTN","PSDDWK2",27,0)
 K MSG I '$P($G(^PSD(58.8,+ORDS,2)),"^",4) S MSG=1 D MSG Q
"RTN","PSDDWK2",28,0)
 I $P($G(^PSD(58.8,+ORDS,2)),"^",3)'>$P($G(^PSD(58.8,+ORDS,2)),"^",4) S MSG=0 D MSG Q
"RTN","PSDDWK2",29,0)
 F  L +^PSD(58.8,+ORDS,2):0 I  Q
"RTN","PSDDWK2",30,0)
ADDN S PSDPN=$P($G(^PSD(58.8,+ORDS,2)),"^",4)
"RTN","PSDDWK2",31,0)
 I +$O(^PSD(58.81,"D",PSDPN,0)) S $P(^PSD(58.8,+ORDS,2),"^",4)=PSDPN+1 G ADDN
"RTN","PSDDWK2",32,0)
 S $P(^PSD(58.8,+ORDS,2),"^",4)=PSDPN+1
"RTN","PSDDWK2",33,0)
 L -^PSD(58.8,+ORDS,2)
"RTN","PSDDWK2",34,0)
 Q
"RTN","PSDDWK2",35,0)
MSG ;prints message
"RTN","PSDDWK2",36,0)
 W $C(7),!!,"  Contact your Pharmacy Co-ordinator.",!,"  Your ""Dispensing #'s"" range has "_$S(MSG:"not been defined.",1:"been exceeded.") S PSDOUT=1
"RTN","PSDDWK2",37,0)
MSG1 W !!,"Press <RET> to continue" R X:DTIME
"RTN","PSDDWK2",38,0)
 I '$T!(X["^") S PSDOUT=1
"RTN","PSDDWK2",39,0)
 Q
"RTN","PSDDWK2",40,0)
SUB ;sub qty from dsp site
"RTN","PSDDWK2",41,0)
 F  L +^PSD(58.8,ORDS,1,PSDR,0):0 I  Q
"RTN","PSDDWK2",42,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDDWK2",43,0)
 S BAL=$P(^PSD(58.8,ORDS,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-QTY
"RTN","PSDDWK2",44,0)
 L -^PSD(58.8,ORDS,1,PSDR,0)
"RTN","PSDDWK2",45,0)
 W !!,"Old Balance : ",BAL,?35,"New Balance :",BAL-QTY,!!
"RTN","PSDDWK2",46,0)
 Q
"RTN","PSDDWK2",47,0)
CHK ;check for valid bal
"RTN","PSDDWK2",48,0)
 S PSDLES=0 D:QTY>$P(^PSD(58.8,ORDS,1,PSDR,0),"^",4)  Q:PSDLES
"RTN","PSDDWK2",49,0)
 .W $C(7),!!,"=>   The drug balance is "_+$P(^PSD(58.8,ORDS,1,PSDR,0),"^",4)_".  You cannot dispense "_QTY_" for this drug.",!,?5,"This order remains "_$P($G(^PSD(58.82,STAT,0)),"^")_".",! S PSDLES=1
"RTN","PSDDWK2",50,0)
 .D MSG1
"RTN","PSDDWK3")
0^49^B10126951
"RTN","PSDDWK3",1,0)
PSDDWK3 ;BIR/JPW-Pharm Dispensing Worksheet (cont'd) ; 24 Aug 93
"RTN","PSDDWK3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWK3",3,0)
UPDATE ;set zero node in 58.81 - ien^type^disp^disp date^drug^qty^^^^bal.fwd^stat^^mfg^lot#^exp.date^^disp#^naou^^req#
"RTN","PSDDWK3",4,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","PSDDWK3",5,0)
 S STAT=$S(ACT="V":3,1:2) I DUZ'=PSDBY,$D(^XUSEC("PSJ RPHARM",DUZ)),ACT="V" S TECH=PSDBY,PSDBY=DUZ
"RTN","PSDDWK3",6,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^2^"_ORDS_"^"_$S(ACT="V":PSDT,1:"")_"^"_PSDR_"^"_QTY_"^^^^"_BAL_"^"_STAT_"^^"_MFG_"^"_LOT_"^"_EXP_"^^"_PSDPN_"^"_NAOU_"^^"_REQ
"RTN","PSDDWK3",7,0)
 ;set the 1, 2 and CS nodes in 58.81 and update xrefs - (1) proc.by^disp.date^^^tech^req.date^ordered by, (1.5) ordered by pharm, (2) comments, (CS) cs.trans
"RTN","PSDDWK3",8,0)
 S ^PSD(58.81,PSDREC,1)=PSDBY_"^^^^"_TECH_"^"_REQDT_"^"_ORD
"RTN","PSDDWK3",9,0)
 S $P(^PSD(58.81,PSDREC,"CS"),"^",1)=1
"RTN","PSDDWK3",10,0)
 S:$P($G(^PSD(58.85,PSDN,2)),U,2) $P(^PSD(58.81,PSDREC,"CS"),U,6)=1
"RTN","PSDDWK3",11,0)
 S:ACT="P" $P(^PSD(58.81,PSDREC,1),"^",2)=PSDT
"RTN","PSDDWK3",12,0)
 S:PSDUZA ^PSD(58.81,PSDREC,1.5)=PSDUZA
"RTN","PSDDWK3",13,0)
 S $P(^PSD(58.81,PSDREC,9),U)=$P($G(^PSD(58.85,PSDN,2)),U,3)
"RTN","PSDDWK3",14,0)
 I $D(^PSD(58.85,PSDN,1,0)) S ^PSD(58.81,PSDREC,2,0)=^PSD(58.85,PSDN,1,0) D
"RTN","PSDDWK3",15,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.85,PSDN,1,WORD)) Q:'WORD  S ^PSD(58.81,PSDREC,2,WORD,0)=^PSD(58.85,PSDN,1,WORD,0)
"RTN","PSDDWK3",16,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDDWK3",17,0)
 ;update vault
"RTN","PSDDWK3",18,0)
 W "vault activity..."
"RTN","PSDDWK3",19,0)
 I '$D(^PSD(58.8,ORDS,1,PSDR,4,0)) S ^(0)="^58.800119PA^^"
"RTN","PSDDWK3",20,0)
 I '$D(^PSD(58.8,ORDS,1,PSDR,4,PSDREC,0)) K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_ORDS_",1,"_PSDR_",4,",DA(2)=ORDS,DA(1)=PSDR,(X,DINUM)=PSDREC D FILE^DICN K DA,DIC,DINUM
"RTN","PSDDWK3",21,0)
MON ;monthly summary data
"RTN","PSDDWK3",22,0)
 I '$D(^PSD(58.8,ORDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDDWK3",23,0)
 I '$D(^PSD(58.8,ORDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DIC S DIC="^PSD(58.8,"_ORDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=ORDS,DA(1)=PSDR D ^DIC K DIC,DA,DINUM,DLAYGO
"RTN","PSDDWK3",24,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_ORDS_",1,"_PSDR_",5,",DA(2)=ORDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR="9////^S X=$P($G(^(0)),""^"",6)+QTY" D ^DIE K DA,DIE,DR
"RTN","PSDDWK3",25,0)
 ;update the entry in 58.85
"RTN","PSDDWK3",26,0)
 W "worksheet..."
"RTN","PSDDWK3",27,0)
 K DA,DIE,DR S DA=PSDN,DIE=58.85,DR="18////"_QTY_";16////"_PSDPN_";6////"_STAT_";Q;I X'=3 S Y=7;15////"_PSDT_";7////"_PSDREC_";17////"_TECH D ^DIE K DA,DIE,DR
"RTN","PSDDWK3",28,0)
 ;update the order in 58.8
"RTN","PSDDWK3",29,0)
 W "order..."
"RTN","PSDDWK3",30,0)
 K DA,DIE,DR S DA=REQ,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,"
"RTN","PSDDWK3",31,0)
 S DR="2////"_ORDS_";4////"_PSDBY_";10////"_STAT_";Q;I X'=3 S Y=7;14////"_PSDT_";7////"_MFG_";8////"_LOT_";9////"_EXP_";16////"_PSDPN_";17////"_PSDREC_";19////"_QTY D ^DIE K DA,DIE,DR
"RTN","PSDDWK3",32,0)
 W "done.",!!,"This order is now "_$P($G(^PSD(58.82,+STAT,0)),"^")_".",!
"RTN","PSDDWK3",33,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","PSDDWK3",34,0)
 Q
"RTN","PSDDWK4")
0^50^B6150283
"RTN","PSDDWK4",1,0)
PSDDWK4 ;BIR/JPW-Pharm Dispensing Worksheet (cont'd) ; 24 Aug 93
"RTN","PSDDWK4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWK4",3,0)
CANC ;canc req ord
"RTN","PSDDWK4",4,0)
 I STAT>2 W !!,"This order is ",$P($G(^PSD(58.82,+STAT,0)),"^"),!,"and should be cancelled using the 'Edit Verified Order' option.",!!
"RTN","PSDDWK4",5,0)
 W ! S PSDOUT=0 K DIR,DIRUT,DUOUT S DIR(0)="YO",DIR("A")="Do you want to cancel this request order",DIR("B")="NO"
"RTN","PSDDWK4",6,0)
 S DIR("?",1)="Answer 'YES' to cancel this request order,",DIR("?")="answer 'NO' to leave this request active or '^' to quit." D ^DIR K DIR I $D(DUOUT) S PSDOUT=1 Q
"RTN","PSDDWK4",7,0)
 Q:PSDOUT  I 'Y W $C(7),!!,"No action taken.  This request order remains active.",!!,"Press <RET> to continue.",! R X:DTIME Q
"RTN","PSDDWK4",8,0)
 W !!,"Accessing your order information..."
"RTN","PSDDWK4",9,0)
 F  L +^PSD(58.8,+PSDS,1,PSDR,0):0 I  Q
"RTN","PSDDWK4",10,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDDWK4",11,0)
 S BAL=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)
"RTN","PSDDWK4",12,0)
 L -^PSD(58.8,+PSDS,1,PSDR,0)
"RTN","PSDDWK4",13,0)
 K DA,DIE,DR S DIE=58.85,DA=PSDN,DR="6////9" D ^DIE K DA,DIE,DR
"RTN","PSDDWK4",14,0)
 K DA,DIE,DR S DA=+$P($G(^PSD(58.85,PSDN,0)),"^",5),DA(1)=+$P($G(^(0)),"^",4),DA(2)=+$P($G(^(0)),"^",3),DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////9;19////@" D ^DIE K DA,DIE,DR
"RTN","PSDDWK4",15,0)
 I +$P($G(^PSD(58.85,PSDN,0)),"^",8) K DA,DIE,DR S DA=$P(^(0),"^",8),DIE=58.81,DR="1////7;3////"_PSDT_";10////9;9////"_BAL D ^DIE K DA,DIE,DR W !!,?10,"Balance: ",BAL,!!
"RTN","PSDDWK4",16,0)
 S STAT=9 W !!,?10,"CANCELLED...",! I ANS="W" W !!,"Press <RET> to continue" R X:DTIME I '$T!(X["^") S PSDOUT=1
"RTN","PSDDWK4",17,0)
 Q
"RTN","PSDDWKE")
0^51^B14400956
"RTN","PSDDWKE",1,0)
PSDDWKE ;BIR/JPW-Pharm Dispensing Worksheet (cont'd) ; 24 Aug 93
"RTN","PSDDWKE",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDDWKE",3,0)
EDIT ;ask/edit dispensing info
"RTN","PSDDWKE",4,0)
 W ! S (PSDOUT,MSG)=0
"RTN","PSDDWKE",5,0)
 K DA,DIE,DR,DTOUT,Y S DA=PSDN,DIE=58.85,DR="14T//^S X=PSDBYN;I $D(OKD) S Y=""@1"";1//^S X=ORDSN;@1" D ^DIE K DIE I $D(DTOUT) S PSDOUT=1 D MSG Q
"RTN","PSDDWKE",6,0)
 I $D(Y),ACT'="E" S PSDOUT=1 D MSG Q
"RTN","PSDDWKE",7,0)
 S ORDS=+$P($G(^PSD(58.85,PSDN,0)),"^",2),ORDSN=$P($G(^PSD(58.8,+ORDS,0)),"^"),NEW=$S(ORDS'=+PSDS:1,1:0)
"RTN","PSDDWKE",8,0)
 S QTY=$S($P($G(^PSD(58.85,PSDN,0)),"^",17):+$P($G(^(0)),"^",17),1:+$P($G(^(0)),"^",6))
"RTN","PSDDWKE",9,0)
 D:NEW SET I '$D(^PSD(58.8,+ORDS,1,+PSDR,0)) D MSG1 Q
"RTN","PSDDWKE",10,0)
 I 'NPKG!(NBKU']"") S MSG=1 D MSG1 Q
"RTN","PSDDWKE",11,0)
 I $D(Y),ACT="E" S PSDOUT=0 Q
"RTN","PSDDWKE",12,0)
 K DA,DIR,DIRUT,DTOUT,DUOUT,Y S DIR("B")=QTY,DIR(0)="58.85,18",DIR("A")="QUANTITY DISPENSED ("_NBKU_"/"_NPKG_")" D ^DIR K DIR I $D(DTOUT) S PSDOUT=1 D MSG Q
"RTN","PSDDWKE",13,0)
 I ACT'="E",$D(DIRUT) S PSDOUT=1 D MSG Q
"RTN","PSDDWKE",14,0)
 I 'Y!$D(DUOUT) S PSDOUT=0 Q
"RTN","PSDDWKE",15,0)
 S $P(^PSD(58.85,PSDN,0),"^",17)=Y
"RTN","PSDDWKE",16,0)
 I ACT="E" D DIE G EDIT1
"RTN","PSDDWKE",17,0)
 I 'NEW,PSDM D DIE
"RTN","PSDDWKE",18,0)
 I NEW,PSDMN D DIE
"RTN","PSDDWKE",19,0)
EDIT1 S QTY=+$P($G(^PSD(58.85,PSDN,0)),"^",17),STAT=+$P($G(^(0)),"^",7),PSDBY=+$P($G(^(0)),"^",13),PSDBYN="" S:PSDBY PSDBYN=$P($G(^VA(200,PSDBY,0)),"^")
"RTN","PSDDWKE",20,0)
 Q:ACT=""
"RTN","PSDDWKE",21,0)
 W !!,"Updating your order..."
"RTN","PSDDWKE",22,0)
 I $P($G(^PSD(58.85,PSDN,0)),"^",8) K DA,DIE,DR S DA=+$P(^(0),"^",8),DIE=58.81,DR="2////"_+ORDS_";5////"_QTY_";10////"_STAT_";12////"_MFG_";13////"_LOT_";14////"_EXP_";17////"_NAOU_";18////"_PSDBY D ^DIE K DA,DIE,DR
"RTN","PSDDWKE",23,0)
 W "still updating..."
"RTN","PSDDWKE",24,0)
 K DA,DIE,DR S DA=REQ,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,"
"RTN","PSDDWKE",25,0)
 S DR="2////"_ORDS_";10////"_STAT_";19////"_QTY D ^DIE K DA,DIE,DR
"RTN","PSDDWKE",26,0)
 W "done.",!
"RTN","PSDDWKE",27,0)
 Q
"RTN","PSDDWKE",28,0)
DIE ;edit mfg/lot #/exp
"RTN","PSDDWKE",29,0)
 S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDDWKE",30,0)
 K DA,DIE,DR S DA=PSDN,DIE=58.85,DR="9//^S X=MFG;10//^S X=LOT;11//^S X=EXPD" D ^DIE K DA,DIE,DR
"RTN","PSDDWKE",31,0)
 K TMFG,TLOT,TEXP S:$P(^PSD(58.85,PSDN,0),"^",9)'=MFG TMFG=$P(^PSD(58.85,PSDN,0),"^",9) S:$P(^(0),"^",10)'=LOT TLOT=$P(^(0),"^",10) S:$P(^(0),"^",11)'=EXP TEXP=$P(^(0),"^",11)
"RTN","PSDDWKE",32,0)
 I $D(TMFG)!($D(TLOT))!($D(TEXP)) K DA,DIE,DR S DA=+PSDR,DA(1)=+ORDS,DIE="^PSD(58.8,"_DA(1)_",1,",DR="9////"_$S($D(TMFG):TMFG,1:MFG)_";10////"_$S($D(TLOT):TLOT,1:LOT)_";11////"_$S($D(TEXP):TEXP,1:EXP) D ^DIE K DA,DIE,DR,TEXP,TLOT,TMFG
"RTN","PSDDWKE",33,0)
 S MFG=$P(^PSD(58.85,PSDN,0),"^",9),LOT=$P(^(0),"^",10),EXP=$P(^(0),"^",11) S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDDWKE",34,0)
 Q
"RTN","PSDDWKE",35,0)
SET ;sets disp data if disp site changes
"RTN","PSDDWKE",36,0)
 S (MFG,LOT,EXP,NBKU,NPKG)=""
"RTN","PSDDWKE",37,0)
 S PSDMN=+$P($G(^PSD(58.8,+ORDS,0)),"^",5)
"RTN","PSDDWKE",38,0)
 S PSDAGN=+$P($G(^PSD(58.8,+ORDS,2)),"^"),PSDRGN=+$P($G(^(2)),"^",5),PSDGSN=+$P($G(^(2)),"^",6)
"RTN","PSDDWKE",39,0)
 I $D(^PSD(58.8,+ORDS,1,+PSDR,0)) S NBKU=$P(^(0),"^",8),NPKG=+$P(^(0),"^",9) S:PSDMN MFG=$P(^(0),"^",10),LOT=$P(^(0),"^",11),EXP=$P(^(0),"^",12)
"RTN","PSDDWKE",40,0)
 S PRT=$P($G(^PSD(58.85,PSDN,2)),"^") K ^PSD(58.85,"AW",+ORDS,+PRT,PSDN) S ^PSD(58.85,PSDN,2)=""
"RTN","PSDDWKE",41,0)
 Q
"RTN","PSDDWKE",42,0)
MSG1 W $C(7),!!,"This order cannot be processed.  ",PSDRN," is ",!,$S(MSG:"missing breakdown unit or package size",1:"not stocked")," in ",ORDSN,".",! S PSDNO=1
"RTN","PSDDWKE",43,0)
MSG W !!,"Press <RET> to continue" R X:DTIME W !!
"RTN","PSDDWKE",44,0)
 I '$T!(X["^") S PSDOUT=1
"RTN","PSDDWKE",45,0)
 Q
"RTN","PSDEA")
0^52^B9487363
"RTN","PSDEA",1,0)
PSDEA ;BIR/JPW-List Drug Name & DEA Special Handling ; 2 Aug 94
"RTN","PSDEA",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEA",3,0)
 W !!,"This report lists Drug name, DEA Special Handling, and NDC information",!,"for all drugs marked for Controlled Substances use.",!
"RTN","PSDEA",4,0)
DEV ;asks device and queueing information
"RTN","PSDEA",5,0)
 W !,"This report is designed for an 80 column format.",!
"RTN","PSDEA",6,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDEA",7,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDEA",ZTDESC="CS PHARM List DEA SPECIAL HANDLING" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDEA",8,0)
 U IO
"RTN","PSDEA",9,0)
START ;compiles and prints data for report
"RTN","PSDEA",10,0)
 K ^TMP("PSDEA",$J)
"RTN","PSDEA",11,0)
 S (PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDEA",12,0)
 S PSD="" F  S PSD=$O(^PSDRUG("AIUN",PSD)) Q:PSD=""  F NUM=0:0 S NUM=$O(^PSDRUG("AIUN",PSD,NUM)) Q:'NUM  I $D(^PSDRUG(NUM,0)) D
"RTN","PSDEA",13,0)
 .S NODE=^PSDRUG(NUM,0),PSDN=$S($P(NODE,"^")]"":$P(NODE,"^"),1:"ZZ #"_NUM_" DRUG NAME MISSING"),PSDEA=$S($P(NODE,"^",3)]"":$P(NODE,"^",3),1:"NOT LISTED")
"RTN","PSDEA",14,0)
 .S PSDNDC=$S($P($G(^PSDRUG(NUM,2)),"^",4)]"":$P(^(2),"^",4),1:"NOT LISTED")
"RTN","PSDEA",15,0)
 .S ^TMP("PSDEA",$J,PSDN,NUM)=PSDEA_"^"_PSDNDC
"RTN","PSDEA",16,0)
PRINT ;print from ^tmp
"RTN","PSDEA",17,0)
 K LN S $P(LN,"-",80)="" D HEADER
"RTN","PSDEA",18,0)
 I '$D(^TMP("PSDEA",$J)) W !!,?10,"NO DATA FOR THE DEA SPECIAL HANDLING REPORT!!",!! G DONE
"RTN","PSDEA",19,0)
 S PSDN="" F  S PSDN=$O(^TMP("PSDEA",$J,PSDN)) Q:PSDN=""!(PSDOUT)  D:$Y+5>IOSL HEADER  Q:PSDOUT  F NUM=0:0 S NUM=$O(^TMP("PSDEA",$J,PSDN,NUM)) Q:'NUM!(PSDOUT)  D
"RTN","PSDEA",20,0)
 .S NODE=$G(^TMP("PSDEA",$J,PSDN,NUM))
"RTN","PSDEA",21,0)
 .W !,?2,PSDN,?51,$P(NODE,"^"),?65,$P(NODE,"^",2)
"RTN","PSDEA",22,0)
 W !
"RTN","PSDEA",23,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEA",24,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEA",25,0)
END ;
"RTN","PSDEA",26,0)
 K %DT,%ZIS,DA,DEA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,NUM,PG,PSD,PSDEA,PSDN,PSDNDC,PSDOUT,RPDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSK
"RTN","PSDEA",27,0)
 K ^TMP("PSDEA",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEA",28,0)
 Q
"RTN","PSDEA",29,0)
HEADER ;prints header information
"RTN","PSDEA",30,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEA",31,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1 Q
"RTN","PSDEA",32,0)
 W:$Y @IOF S PG=PG+1 W !,?15,"DEA SPECIAL HANDLING FOR CS PHARM DRUGS",!,?29,RPDT,?70,"PAGE: "_PG
"RTN","PSDEA",33,0)
 W !!,?48,"DEA SPECIAL",!,"DRUG NAME",?49,"HANDLING",?70,"NDC",!,LN,!
"RTN","PSDEA",34,0)
 Q
"RTN","PSDEA41")
0^53^B20089989
"RTN","PSDEA41",1,0)
PSDEA41 ;BIR/BJW-Destroyed CS Drugs DEA 41 Report ; 12 JAN 96
"RTN","PSDEA41",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEA41",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEA41",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"the pending Controlled Substances destruction data.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDEA41",5,0)
ASKD ;ask disp location
"RTN","PSDEA41",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDEA41",7,0)
ASKV ;ask vault(s),added 8/9/95
"RTN","PSDEA41",8,0)
 W !!,?5,"You may select a single VAULT, several VAULT(s),",!,?5,"or enter ^ALL to select all VAULT(s).",!
"RTN","PSDEA41",9,0)
 K DA,DIC D NOW^%DTC S (PSDT,Y)=X X ^DD("DD") S RPDT=Y
"RTN","PSDEA41",10,0)
 F  S DIC=58.8,DIC("A")="Select VAULT: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC S PSDVAU(+Y)="" Q:Y<0
"RTN","PSDEA41",11,0)
 I '$D(PSDVAU)&(X'="^ALL") G END
"RTN","PSDEA41",12,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="N",$P($G(^(0)),"^",3)=+PSDSITE S PSDVAU(PSD)=""
"RTN","PSDEA41",13,0)
 S JJ=$O(PSDVAU(0)),JJ=$S($O(PSDVAU(JJ)):1,1:2)
"RTN","PSDEA41",14,0)
 S DIC="^DIC(4,",DR=.01,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDEA41",15,0)
 D EN^DIQ1 S PSD=PSD(4,DA,.01) K DIC,DR,DA,DIQ
"RTN","PSDEA41",16,0)
 S PSDSN=$S(JJ=1:PSD,1:$P($G(^PSD(58.8,+$O(PSDVAU(0)),0)),U)) K PSD
"RTN","PSDEA41",17,0)
DEV ;select device
"RTN","PSDEA41",18,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDEA41",19,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDEA41",20,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDEA41",21,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDEA41",ZTDESC="Destroyed CS Drug Report for DEA Form 41" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDEA41",22,0)
 U IO
"RTN","PSDEA41",23,0)
START ;start looping
"RTN","PSDEA41",24,0)
 K ^TMP("PSDEA41",$J)
"RTN","PSDEA41",25,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDEA41",26,0)
 K LN S (CNT,PG,PSDOUT)=0,$P(LN,"-",80)="" D HDR
"RTN","PSDEA41",27,0)
 F PSDA=0:0 S PSDA=$O(^PSD(58.86,PSDA))  Q:'PSDA  I $D(^PSD(58.86,PSDA,0)),$D(PSDVAU(+$P(^(0),"^",7))),'$P(^(0),"^",11),'$D(^PSD(58.86,PSDA,3)) D SET
"RTN","PSDEA41",28,0)
 I CNT=0 W !!,?10,"*** NO CONTROLLED SUBSTANCE DESTRUCTIONS ***",!! G DONE
"RTN","PSDEA41",29,0)
PRINT ;prints data
"RTN","PSDEA41",30,0)
 D SIG G:PSDOUT DONE
"RTN","PSDEA41",31,0)
 F PSDA=0:0 S PSDA=$O(^TMP("PSDEA41",$J,PSDA)) Q:'PSDA  D  Q:PSDOUT
"RTN","PSDEA41",32,0)
 .D:$Y+4>IOSL HDR Q:PSDOUT
"RTN","PSDEA41",33,0)
 .S NODE=^TMP("PSDEA41",$J,PSDA) W !,PSDA,?10,$P(NODE,"^"),?55,$J($P(NODE,"^",2),3),?60,$J($P(NODE,"^",3),6),?69,$P(NODE,"^",4)
"RTN","PSDEA41",34,0)
 I 'PSDOUT D:$Y+4>IOSL HDR W !!,?25,"END OF REPORT!!",!
"RTN","PSDEA41",35,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEA41",36,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEA41",37,0)
END ;
"RTN","PSDEA41",38,0)
 K %,%DT,%H,%I,%ZIS,ALL,C,CNT,CONT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,KK,LN,NODE
"RTN","PSDEA41",39,0)
 K PG,POP,PSD,PSDA,PSDT,PSDATE,PSDED,PSDEV,PSDN,PSDOUT,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDVAU,QTY,RPDT,UNIT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEA41",40,0)
 K ^TMP("PSDEA41",$J)
"RTN","PSDEA41",41,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEA41",42,0)
 Q
"RTN","PSDEA41",43,0)
HDR ;prints header information
"RTN","PSDEA41",44,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEA41",45,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"DESTROYED CS DRUGS REPORT for DEA FORM 41",?70,"PAGE: ",PG
"RTN","PSDEA41",46,0)
 W !,?15,"Dispensing Site: ",PSDSN,!,?15,"Printed: ",RPDT
"RTN","PSDEA41",47,0)
 W !,?55,"# OF",!,"HOLD #",?10,"DRUG",?55,"CONT",?63,"QTY",?69,"UNIT",!,LN,!
"RTN","PSDEA41",48,0)
 Q
"RTN","PSDEA41",49,0)
SAVE ;saves variables for queueing
"RTN","PSDEA41",50,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("JJ"))=""
"RTN","PSDEA41",51,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDVAU) ZTSAVE("PSDVAU(")=""
"RTN","PSDEA41",52,0)
 Q
"RTN","PSDEA41",53,0)
SIG ;print signature lines
"RTN","PSDEA41",54,0)
 W !!!,?23,"Date: _____________________________________",!!!,?15,"Destroyed By: _____________________________________",!
"RTN","PSDEA41",55,0)
 F KK=1:1:2 W !!,?15,"Witnessed By: _____________________________________",!
"RTN","PSDEA41",56,0)
 W !
"RTN","PSDEA41",57,0)
 Q
"RTN","PSDEA41",58,0)
SET ;sets data
"RTN","PSDEA41",59,0)
 S CNT=CNT+1
"RTN","PSDEA41",60,0)
 S NODE=^PSD(58.86,PSDA,0),PSDR=+$P(NODE,"^",2)
"RTN","PSDEA41",61,0)
 S PSDRN=$S($G(^PSD(58.86,PSDA,1))]"":$G(^PSD(58.86,PSDA,1))_"*",$P($G(^PSDRUG(+PSDR,0)),"^")]"":$P($G(^PSDRUG(+PSDR,0)),"^"),1:"#"_PSDA_" DRUG NAME MISSING")
"RTN","PSDEA41",62,0)
 S QTY=$P(NODE,"^",3),CONT=$P(NODE,"^",8),UNIT=$P(NODE,"^",12)
"RTN","PSDEA41",63,0)
 S ^TMP("PSDEA41",$J,PSDA)=PSDRN_"^"_CONT_"^"_QTY_"^"_UNIT
"RTN","PSDEA41",64,0)
 Q
"RTN","PSDEM")
0^54^B16894945
"RTN","PSDEM",1,0)
PSDEM ;BIR/LTL-Emergency Order Report for NAOUs ; 2 28 95
"RTN","PSDEM",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEM",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEM",4,0)
 W !!,"Select Date Range for NAOU Unscheduled Order Report",!
"RTN","PSDEM",5,0)
DATE ;ask date range
"RTN","PSDEM",6,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDEM",7,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDEM",8,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDEM",9,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDEM",10,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDEM",11,0)
SUM ;if summary only
"RTN","PSDEM",12,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print a summary  only",DIR("B")="NO"
"RTN","PSDEM",13,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the detail report including summary totals."
"RTN","PSDEM",14,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDEM",15,0)
SUM2 ;D:Y  G:$D(DIRUT) END
"RTN","PSDEM",16,0)
 ;.S DIR(0)="SO^T:Totals Only;S:Sub-totals for DRUG or NAOU;W:Within DRUG or NAOU, list each DRUG or NAOU",DIR("B")="S" D ^DIR K DIR S SUM(1)=Y
"RTN","PSDEM",17,0)
SORT ;sel sort order
"RTN","PSDEM",18,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/ALL NAOUS;N:NAOU/ALL DRUGS",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDEM",19,0)
 S DIR("?",1)="Enter 'D' if you wish to print the NAOU Unscheduled Order Report sorted by DRUG",DIR("?",2)="  and within DRUG by each NAOU."
"RTN","PSDEM",20,0)
 S DIR("?",3)="Enter 'N' to print the NAOU Unscheduled Order Report by NAOU",DIR("?")="  and within NAOU by each DRUG."
"RTN","PSDEM",21,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDEM",22,0)
 G:ANS="D" DRUG
"RTN","PSDEM",23,0)
ASKN ;ask NAOU(s)
"RTN","PSDEM",24,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDEM",25,0)
 K DA,DIC
"RTN","PSDEM",26,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDEM",27,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDEM",28,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S LOC(PSD)=""
"RTN","PSDEM",29,0)
 G DEV
"RTN","PSDEM",30,0)
DRUG ;ask drug(s)
"RTN","PSDEM",31,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDEM",32,0)
 K DA,DIC F  S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDEM",33,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDEM",34,0)
 I X="^ALL" S ALL=1
"RTN","PSDEM",35,0)
DEV ;asks device and queueing information
"RTN","PSDEM",36,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDEM",37,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDEM",38,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(ANS="D":"START^PSDEM1",1:"START^PSDEM2"),ZTDESC="CS PHARM NAOU Emergency Order Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDEM",39,0)
 U IO G:ANS="D" START^PSDEM1 G:ANS="N" START^PSDEM2
"RTN","PSDEM",40,0)
END ;
"RTN","PSDEM",41,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),LOC
"RTN","PSDEM",42,0)
 K POP,PSD,PSDATE,PSDED,PSDOUT,PSDSD,PSDT,SUM,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDEM",43,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEM",44,0)
 Q
"RTN","PSDEM",45,0)
SAVE ;save variables for queueing
"RTN","PSDEM",46,0)
 S ZTSAVE("ANS")="",ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(LOC) ZTSAVE("LOC(")=""
"RTN","PSDEM",47,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDEM",48,0)
 S (ZTSAVE("PSDATE"),ZTSAVE("PSDED"),ZTSAVE("PSDSD"))=""
"RTN","PSDEM",49,0)
 Q
"RTN","PSDEM1")
0^55^B20776137
"RTN","PSDEM1",1,0)
PSDEM1 ;BIR/LTL-Print NAOU Emergency Order Report by Drug ; 28 Feb 95
"RTN","PSDEM1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEM1",3,0)
START ;entry point for report
"RTN","PSDEM1",4,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUS",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQT",$J),^TMP("PSDNUQ",$J)
"RTN","PSDEM1",5,0)
 I $D(ALL) D ALL G PRINT
"RTN","PSDEM1",6,0)
 F PSDR=0:0 S PSDR=$O(LOC(PSDR)) Q:'PSDR  F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"AEM",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"AEM",JJ,JJ1)) Q:'JJ1  D
"RTN","PSDEM1",7,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"AEM",JJ,JJ1,PSDR,KK)) Q:'KK  D SET
"RTN","PSDEM1",8,0)
PRINT ;prints data for stock drugs
"RTN","PSDEM1",9,0)
 I SUM D ^PSDEM3 G DONE
"RTN","PSDEM1",10,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDEM1",11,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDEM1",12,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDNU",$J,PSDR)) D:PSDR="" GTOT Q:PSDR=""!(PSDOUT)  D HDR S NAOU="" F  S NAOU=$O(^TMP("PSDNU",$J,PSDR,NAOU)) D:NAOU="" NTOT Q:NAOU=""!(PSDOUT)  W !,?2,"=> ",NAOU,!! D
"RTN","PSDEM1",13,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDNU",$J,PSDR,NAOU,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDNU",$J,PSDR,NAOU,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDEM1",14,0)
 ..S NODE=^TMP("PSDNU",$J,PSDR,NAOU,NUM,JJ),DATE=$$FMTE^XLFDT(JJ,2)
"RTN","PSDEM1",15,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",NAOU,!!
"RTN","PSDEM1",16,0)
 ..W NUM,?16,DATE,?35,$J($P(NODE,"^"),6),?47,$P(NODE,"^",2),?70,$P(NODE,"^",3),!
"RTN","PSDEM1",17,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEM1",18,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEM1",19,0)
END ;
"RTN","PSDEM1",20,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJ2,KK,LOC,LN
"RTN","PSDEM1",21,0)
 K NAOU,NAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDSD,PSDT,PSDTR,RPDT,SUM,X,Y
"RTN","PSDEM1",22,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEM1",23,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J),^TMP("PSDNUS",$J),^TMP("PSDNUQT",$J)
"RTN","PSDEM1",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEM1",25,0)
 Q
"RTN","PSDEM1",26,0)
ALL ;loops for all drugs
"RTN","PSDEM1",27,0)
 Q:'$D(ALL)
"RTN","PSDEM1",28,0)
 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"AEM",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"AEM",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"AEM",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDEM1",29,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"AEM",JJ,JJ1,PSDR,KK)) Q:'KK  D SET
"RTN","PSDEM1",30,0)
 Q
"RTN","PSDEM1",31,0)
HDR ;lists header information
"RTN","PSDEM1",32,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEM1",33,0)
 W:$Y @IOF S PG=PG+1 W !,"DRUG/NAOU UNSCHEDULED ORDER REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDEM1",34,0)
 I $D(PSDR),PSDR]"" W "DRUG: ",PSDR,!
"RTN","PSDEM1",35,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDEM1",36,0)
 W !,?2,"=> NAOU",!,?16,"DATE/TIME",!,"DISP #",?16,"FILLED",?35,"QUANTITY",?47,"ORDERED BY",!,LN,!
"RTN","PSDEM1",37,0)
 Q
"RTN","PSDEM1",38,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDNUS",$J,PSDR,NAOU),?25,$J(^TMP("PSDNUQ",$J,PSDR,NAOU),6),?37,"Totals",!
"RTN","PSDEM1",39,0)
 Q
"RTN","PSDEM1",40,0)
NTOT Q:PSDOUT  W !,"DRUG Subtotal # of Orders: ",^TMP("PSDNUT",$J,PSDR),"   Total Quantity: ",^TMP("PSDNUQT",$J,PSDR),!
"RTN","PSDEM1",41,0)
 Q
"RTN","PSDEM1",42,0)
GTOT ;grand total
"RTN","PSDEM1",43,0)
 Q:PSDOUT
"RTN","PSDEM1",44,0)
 W !,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDEM1",45,0)
 Q
"RTN","PSDEM1",46,0)
SET ;sets data
"RTN","PSDEM1",47,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18)
"RTN","PSDEM1",48,0)
 Q:$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  S PSDOK=0
"RTN","PSDEM1",49,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDEM1",50,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDEM1",51,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDEM1",52,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P($G(^(4)),"^",3)
"RTN","PSDEM1",53,0)
 S NURS=$S(+$P($G(^PSD(58.81,KK,1)),"^",7):+$P($G(^(1)),"^",7),1:+$P($G(^PSD(58.81,KK,1)),"^",3))
"RTN","PSDEM1",54,0)
 S NURS=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),PSDPN="DISP W/O GS":"N/A",1:"UNKNOWN")
"RTN","PSDEM1",55,0)
 S ^TMP("PSDNU",$J,PSDRN,NAOUN,PSDPN,JJ)=QTY_"^"_NURS
"RTN","PSDEM1",56,0)
 S:'$D(^TMP("PSDNUT",$J,PSDRN)) ^TMP("PSDNUT",$J,PSDRN)=0 S:'PSDOK ^TMP("PSDNUT",$J,PSDRN)=+^TMP("PSDNUT",$J,PSDRN)+1
"RTN","PSDEM1",57,0)
 S:'$D(^TMP("PSDNUQT",$J,PSDRN)) ^TMP("PSDNUQT",$J,PSDRN)=0 S ^TMP("PSDNUQT",$J,PSDRN)=+^TMP("PSDNUQT",$J,PSDRN)+QTY
"RTN","PSDEM1",58,0)
 S:'$D(^TMP("PSDNUS",$J,PSDRN,NAOUN)) ^TMP("PSDNUS",$J,PSDRN,NAOUN)=0 S:'PSDOK ^TMP("PSDNUS",$J,PSDRN,NAOUN)=+^TMP("PSDNUS",$J,PSDRN,NAOUN)+1
"RTN","PSDEM1",59,0)
 S:'$D(^TMP("PSDNUQ",$J,PSDRN,NAOUN)) ^TMP("PSDNUQ",$J,PSDRN,NAOUN)=0 S ^TMP("PSDNUQ",$J,PSDRN,NAOUN)=+^TMP("PSDNUQ",$J,PSDRN,NAOUN)+QTY
"RTN","PSDEM1",60,0)
 S:'$D(^TMP("PSDNUG",$J)) ^TMP("PSDNUG",$J)=0 S:'PSDOK ^TMP("PSDNUG",$J)=+^TMP("PSDNUG",$J)+1
"RTN","PSDEM1",61,0)
 S PSDOK=0
"RTN","PSDEM1",62,0)
 Q
"RTN","PSDEM2")
0^56^B16680372
"RTN","PSDEM2",1,0)
PSDEM2 ;BIR/LTL-Print NAOU Emergency Order Report by NAOU ; 28 Feb 95
"RTN","PSDEM2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEM2",3,0)
START ;entry point for report
"RTN","PSDEM2",4,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUS",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J)
"RTN","PSDEM2",5,0)
 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"AEM",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"AEM",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"AEM",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDEM2",6,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"AEM",JJ,JJ1,PSDR,KK)) Q:'KK  D SET
"RTN","PSDEM2",7,0)
PRINT ;prints data for stock drugs
"RTN","PSDEM2",8,0)
 I SUM D ^PSDEM3 G DONE
"RTN","PSDEM2",9,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDEM2",10,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDEM2",11,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDNU",$J,NAOU)) D:NAOU="" GTOT Q:NAOU=""!(PSDOUT)  D HDR S PSDR="" F  S PSDR=$O(^TMP("PSDNU",$J,NAOU,PSDR)) D:PSDR="" NTOT Q:PSDR=""!(PSDOUT)  W !,?2,"=> ",PSDR,!! D
"RTN","PSDEM2",12,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDNU",$J,NAOU,PSDR,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDNU",$J,NAOU,PSDR,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDEM2",13,0)
 ..S NODE=^TMP("PSDNU",$J,NAOU,PSDR,NUM,JJ),DATE=$$FMTE^XLFDT(JJ,2)
"RTN","PSDEM2",14,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDR,!!
"RTN","PSDEM2",15,0)
 ..W NUM,?16,DATE,?35,$J($P(NODE,"^"),6),?47,$P(NODE,"^",2),?70,$P(NODE,"^",3),!
"RTN","PSDEM2",16,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEM2",17,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEM2",18,0)
END ;
"RTN","PSDEM2",19,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJ2,KK,LOC,LN
"RTN","PSDEM2",20,0)
 K NAOU,NAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDSD,PSDT,PSDTR,RPDT,SUM,X,Y
"RTN","PSDEM2",21,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEM2",22,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J),^TMP("PSDNUS",$J)
"RTN","PSDEM2",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEM2",24,0)
 Q
"RTN","PSDEM2",25,0)
SET ;sets data
"RTN","PSDEM2",26,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18)
"RTN","PSDEM2",27,0)
 Q:'$D(LOC(PSD))  Q:+$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  S PSDOK=0
"RTN","PSDEM2",28,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDEM2",29,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDEM2",30,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDEM2",31,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P($G(^(4)),"^",3)
"RTN","PSDEM2",32,0)
 S NURS=$S(+$P($G(^PSD(58.81,KK,1)),"^",7):+$P($G(^(1)),"^",7),1:+$P($G(^PSD(58.81,KK,1)),"^",3))
"RTN","PSDEM2",33,0)
 S NURS=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),PSDPN="DISP W/O GS":"N/A",1:"UNKNOWN")
"RTN","PSDEM2",34,0)
 S ^TMP("PSDNU",$J,NAOUN,PSDRN,PSDPN,JJ)=QTY_"^"_NURS
"RTN","PSDEM2",35,0)
 S:'$D(^TMP("PSDNUT",$J,NAOUN)) ^TMP("PSDNUT",$J,NAOUN)=0 S:'PSDOK ^TMP("PSDNUT",$J,NAOUN)=+^TMP("PSDNUT",$J,NAOUN)+1
"RTN","PSDEM2",36,0)
 S:'$D(^TMP("PSDNUS",$J,NAOUN,PSDRN)) ^TMP("PSDNUS",$J,NAOUN,PSDRN)=0 S:'PSDOK ^TMP("PSDNUS",$J,NAOUN,PSDRN)=+^TMP("PSDNUS",$J,NAOUN,PSDRN)+1
"RTN","PSDEM2",37,0)
 S:'$D(^TMP("PSDNUQ",$J,NAOUN,PSDRN)) ^TMP("PSDNUQ",$J,NAOUN,PSDRN)=0 S ^TMP("PSDNUQ",$J,NAOUN,PSDRN)=+^TMP("PSDNUQ",$J,NAOUN,PSDRN)+QTY
"RTN","PSDEM2",38,0)
 S:'$D(^TMP("PSDNUG",$J)) ^TMP("PSDNUG",$J)=0 S:'PSDOK ^TMP("PSDNUG",$J)=+^TMP("PSDNUG",$J)+1
"RTN","PSDEM2",39,0)
 S PSDOK=0
"RTN","PSDEM2",40,0)
 Q
"RTN","PSDEM2",41,0)
HDR ;lists header information
"RTN","PSDEM2",42,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEM2",43,0)
 W:$Y @IOF S PG=PG+1 W !,"NAOU/DRUG UNSCHEDULED ORDER REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDEM2",44,0)
 W:$D(NAOU) "NAOU: ",NAOU,!
"RTN","PSDEM2",45,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDEM2",46,0)
 W !,?2,"=> DRUG",!,?16,"DATE/TIME",!,"DISP #",?17,"FILLED",?35,"QUANTITY",?47,"ORDERED BY",!,LN,!
"RTN","PSDEM2",47,0)
 Q
"RTN","PSDEM2",48,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDNUS",$J,NAOU,PSDR),?25,$J(^TMP("PSDNUQ",$J,NAOU,PSDR),6),?37,"Totals",!
"RTN","PSDEM2",49,0)
 Q
"RTN","PSDEM2",50,0)
NTOT Q:PSDOUT  W !,"NAOU Subtotal # of Orders: ",^TMP("PSDNUT",$J,NAOU),!
"RTN","PSDEM2",51,0)
 Q
"RTN","PSDEM2",52,0)
GTOT ;grand total
"RTN","PSDEM2",53,0)
 Q:PSDOUT
"RTN","PSDEM2",54,0)
 W !,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDEM2",55,0)
 Q
"RTN","PSDEM3")
0^57^B3790780
"RTN","PSDEM3",1,0)
PSDEM3 ;BIR/LTL-Print NAOU Emergency Order Report Summary Totals ; 28 Feg 95
"RTN","PSDEM3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEM3",3,0)
PRINT ;prints data for stock drugs
"RTN","PSDEM3",4,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDEM3",5,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" Q
"RTN","PSDEM3",6,0)
 S JJ="" F  S JJ=$O(^TMP("PSDNUS",$J,JJ)) Q:JJ=""!(PSDOUT)  D HDR S KK="" F  S KK=$O(^TMP("PSDNUS",$J,JJ,KK)) D:KK="" NTOT Q:KK=""!(PSDOUT)  D TOT
"RTN","PSDEM3",7,0)
 Q
"RTN","PSDEM3",8,0)
HDR ;lists header information
"RTN","PSDEM3",9,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEM3",10,0)
 W:$Y @IOF S PG=PG+1 W !,"SUMMARY NAOU/DRUG UNSCHEDULED ORDER REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDEM3",11,0)
 I ANS="N",$D(JJ) W "NAOU: ",JJ,!
"RTN","PSDEM3",12,0)
 I ANS="D",$D(JJ) W "DRUG: ",JJ,!
"RTN","PSDEM3",13,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDEM3",14,0)
 W !,?2,"=> ",$S(ANS="D":"NAOU",1:"DRUG"),!,"TOTAL # OF ORDERS",?30,"TOTAL QUANTITY",!,LN,!
"RTN","PSDEM3",15,0)
 Q
"RTN","PSDEM3",16,0)
TOT Q:PSDOUT  I $Y+8>IOSL D HDR
"RTN","PSDEM3",17,0)
 W !!,?2,"=> ",KK,!,$J(^TMP("PSDNUS",$J,JJ,KK),8),?34,$J(^TMP("PSDNUQ",$J,JJ,KK),6)
"RTN","PSDEM3",18,0)
 Q
"RTN","PSDEM3",19,0)
NTOT Q:PSDOUT  I $Y+6>IOSL D HDR
"RTN","PSDEM3",20,0)
 W !!,?2,"=> ",KK
"RTN","PSDEM3",21,0)
 W !!,$S(ANS="D":"DRUG",1:"NAOU")," Subtotal # of Orders: ",^TMP("PSDNUT",$J,JJ) W:ANS="D" "    Total Quantity: ",^TMP("PSDNUQT",$J,JJ)
"RTN","PSDEM3",22,0)
 W !!,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDEM3",23,0)
 Q
"RTN","PSDEM4")
0^58^B9423621
"RTN","PSDEM4",1,0)
PSDEM4 ;BIR/JPW,LTL-Nurse CS Priority Order Status; 25 Apr 95
"RTN","PSDEM4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEM4",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEM4",4,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDEM4",5,0)
NAOU ;select NAOU to check priority orders for
"RTN","PSDEM4",6,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ordering NAOU: "
"RTN","PSDEM4",7,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDEM4",8,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDEM4",9,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDEM4",10,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDEM4",11,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDEM4",12,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDEM4",13,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDEM4",14,0)
 S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDEM4",15,0)
LOOP S PSDT=DT
"RTN","PSDEM4",16,0)
 W:$O(^PSD(58.81,"AEM",DT)) !!,"Today's Priority Orders:"
"RTN","PSDEM4",17,0)
 F  S PSDT=$O(^PSD(58.81,"AEM",PSDT)) Q:'PSDT  S PSDT(1)=0 F  S PSDT(1)=$O(^PSD(58.81,"AEM",PSDT,+PSDS,PSDT(1))) Q:'PSDT(1)  S PSDT(2)=0 F  S PSDT(2)=$O(^PSD(58.81,"AEM",PSDT,+PSDS,PSDT(1),PSDT(2))) Q:'PSDT(2)  D
"RTN","PSDEM4",18,0)
 .S PSDT(3)=$G(^PSD(58.81,PSDT(2),0)) Q:$P(PSDT(3),U,18)'=NAOU
"RTN","PSDEM4",19,0)
 .S PSDT(4)=PSDT(2)
"RTN","PSDEM4",20,0)
 .W !!,$P($G(^PSDRUG(PSDT(1),0)),U),"  ",$P(PSDT(3),U,6)," "
"RTN","PSDEM4",21,0)
 .W $P($G(^PSD(58.8,+PSDS,1,PSDT(1),0)),U,8)
"RTN","PSDEM4",22,0)
 .W !,$P($G(^PSD(58.82,$P(PSDT(3),U,11),0)),U)
"RTN","PSDEM4",23,0)
 W:'$G(PSDT(4)) !!,"No Priority Orders ready for ",NAOUN,"."
"RTN","PSDEM4",24,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDEM4",25,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDEM4",26,0)
 Q
"RTN","PSDEM4",27,0)
MSG ;display error message
"RTN","PSDEM4",28,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDEM4",29,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDEM4",30,0)
 Q
"RTN","PSDEN")
0^59^B13693307
"RTN","PSDEN",1,0)
PSDEN ;BIR/JPW-Enter NAOUs ; 6 July 94
"RTN","PSDEN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEN",4,0)
 I '$D(^XUSEC("PSD PARAM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to enter/edit",!,?12,"NAOUs.  PSD PARAM security key required.",! Q
"RTN","PSDEN",5,0)
 S SITEN=$P($G(^PS(59.4,+PSDSITE,0)),"^"),MULTI=$S($P(PSDSITE,"^",2)="M":1,1:0)
"RTN","PSDEN",6,0)
NAOU ;entry for NAOUs into file 58.8
"RTN","PSDEN",7,0)
 K DIC,DLAYGO W ! S (DIC,DLAYGO)=58.8,DIC(0)="QEAL",DIC("A")="Select NAOU: ",DIC("DR")="2////"_+PSDSITE,DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P"""
"RTN","PSDEN",8,0)
 D ^DIC K DIC,DLAYGO G:Y<0 END S PSDA=+Y,NEW=+$P(Y,"^",3) D TYPE
"RTN","PSDEN",9,0)
 G NAOU
"RTN","PSDEN",10,0)
END K ANS,DA,DIC,DIE,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,MULTI,NEW,PSDA,SITEN,X,Y
"RTN","PSDEN",11,0)
 Q
"RTN","PSDEN",12,0)
TYPE ;selects location type
"RTN","PSDEN",13,0)
 W !!,"CONTROLLED SUBSTANCES SITE : "_SITEN
"RTN","PSDEN",14,0)
 I $P(^PSD(58.8,PSDA,0),"^",2)]"",+$O(^PSD(58.8,PSDA,1,0)) S ANS=$P(^PSD(58.8,PSDA,0),"^",2) G DIE
"RTN","PSDEN",15,0)
 K ANS,DIR,DIRUT S DIR(0)="S^M:MASTER VAULT;S:SATELLITE VAULT;N:NARCOTIC LOCATION",DIR("A")="LOCATION TYPE"
"RTN","PSDEN",16,0)
 S DIR("?")="'S' for Satellite Vault or 'N' for Narcotic location.",DIR("?",1)="Enter this NAOU's type.  Select 'M' for Master Vault,"
"RTN","PSDEN",17,0)
 S:$P(^PSD(58.8,PSDA,0),"^",2)]"" DIR("B")=$P(^(0),"^",2) D ^DIR K DIR
"RTN","PSDEN",18,0)
 I $D(DIRUT),NEW K DIK S DIK="^PSD(58.8,",DA=+PSDA D ^DIK K DIK W $C(7),!!,"No location type entered.  Entry has been deleted!",!! Q
"RTN","PSDEN",19,0)
 Q:$D(DIRUT)  S ANS=Y
"RTN","PSDEN",20,0)
DIE ;edit
"RTN","PSDEN",21,0)
 S PSDJLP=1
"RTN","PSDEN",22,0)
 K DA,DIE,DR S DIE=58.8,DA=PSDA
"RTN","PSDEN",23,0)
 S:ANS="M" DR=".01T;1////"_ANS_";Q;5;3///@;14;I 'X S Y=19;15;Q;16;Q;17;Q;19;19.5;23;24;25;26;29;28;30;12;S:'$P(^(0),U,8) Y=0;13"
"RTN","PSDEN",24,0)
 S:ANS="S" DR=".01T;1////"_ANS_";Q;3;5;14;I 'X S Y=19;15;Q;16;Q;17;Q;19;19.5;23;24;25;26;29;28;30"
"RTN","PSDEN",25,0)
 S:ANS="N" DR=".01T;1////"_ANS_";Q;3;18;6T;32;33"
"RTN","PSDEN",26,0)
 D ^DIE K DIE,DR,DA,PSDJLP
"RTN","PSDEN",27,0)
 ;link ward for dispensing equipment interface
"RTN","PSDEN",28,0)
 D:$O(^HL(770,"B","PSD-NDES",0))&(ANS="N")
"RTN","PSDEN",29,0)
WARD .I $O(^PSD(58.8,+PSDA,3,0)) W !!,"Current Ward(s):  " S PSDA(1)=0 F  S PSDA(1)=$O(^PSD(58.8,+PSDA,3,PSDA(1))) Q:'PSDA(1)  W ?20,$P($G(^DIC(42,+PSDA(1),0)),U),!
"RTN","PSDEN",30,0)
 .S DIR(0)="PO^42:AEMQ"
"RTN","PSDEN",31,0)
 .S DIR("A")="Select Ward for dispensing equipment interface"
"RTN","PSDEN",32,0)
 .S DIR("?")="When doses are dispensed the ward will be used as a path to this NAOU."
"RTN","PSDEN",33,0)
 .W ! D ^DIR K DIR Q:Y<1  S PSDA(1)=0,PSDA(2)=+Y,PSDA(3)=$P(Y,U,2)
"RTN","PSDEN",34,0)
 .I $D(^PSD(58.8,"AB",PSDA(2),PSDA)) D  Q:$D(DIRUT)  G WARD
"RTN","PSDEN",35,0)
 ..S DIR(0)="Y",DIR("A")="Remove "_PSDA(3)_"'s link to "_$P($G(^PSD(58.8,+PSDA,0)),U) D ^DIR K DIR
"RTN","PSDEN",36,0)
 ..I Y=1 W !!,PSDA(3)," removed.",! S DIK="^PSD(58.8,+PSDA,3,",DA(1)=PSDA,DA=PSDA(2) D ^DIK K DIK,DA
"RTN","PSDEN",37,0)
 .F  S PSDA(1)=$O(^PSD(58.8,"AB",PSDA(2),PSDA(1))) Q:'PSDA(1)  S:$P($G(^PSD(58.8,PSDA(1),0)),U,2)="N"&(PSDA'=PSDA(1)) PSDA(4)=$P($G(^(0)),U)
"RTN","PSDEN",38,0)
 .I $G(PSDA(4))]"" W !!,PSDA(3)," is already linked to ",PSDA(4),"." K PSDA(4) G WARD
"RTN","PSDEN",39,0)
 .S DIC="^PSD(58.8,"_+PSDA_",3,",DIC(0)="LM",DLAYGO=58.8,DA(1)=PSDA
"RTN","PSDEN",40,0)
 .S X=PSDA(3),DA=PSDA(2),DIC("P")=$P(^DD(58.8,21,0),U,2),DINUM=PSDA(2)
"RTN","PSDEN",41,0)
 .D ^DIC K DIC,DA,DLAYGO G WARD
"RTN","PSDEN",42,0)
 ;Set up Default Dispensing Site
"RTN","PSDEN",43,0)
 I "MS"[ANS S $P(PSDSITE,U,3)=PSDA,$P(PSDSITE,U,4)=$P($G(^PSD(58.8,+PSDA,0)),U),$P(PSDSITE,U,5)=0 D EN^PSDSP S:$G(PSDS) $P(PSDSITE,U,5)=1
"RTN","PSDEN",44,0)
 K PSDA,PSDS,PSDSN Q
"RTN","PSDERCP")
0^60^B24275506
"RTN","PSDERCP",1,0)
PSDERCP ;BIR/JPW-CS Resolved Error Log Report ; 29 Aug 94
"RTN","PSDERCP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDERCP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDERCP",4,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSD ERROR",DUZ)):2,1:0)
"RTN","PSDERCP",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"the pending Controlled Substances error log.",!!,"PSDMGR or PSD ERROR security key required.",! K OK Q
"RTN","PSDERCP",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) DATE
"RTN","PSDERCP",7,0)
ASKD ;ask disp location
"RTN","PSDERCP",8,0)
 W !!,"You may select a Dispensing Site at the prompt.",!
"RTN","PSDERCP",9,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ"
"RTN","PSDERCP",10,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDERCP",11,0)
 S DIC("A")="Select Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDERCP",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDERCP",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDERCP",14,0)
DATE ;ask date range
"RTN","PSDERCP",15,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDERCP",16,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDERCP",17,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDERCP",18,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDERCP",19,0)
DEV ;select device
"RTN","PSDERCP",20,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDERCP",21,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDERCP",22,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDERCP",23,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDERCP",ZTDESC="CS Resolved Error Log Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDERCP",24,0)
 U IO
"RTN","PSDERCP",25,0)
START ;start looping
"RTN","PSDERCP",26,0)
 K ^TMP("PSDERCP",$J)
"RTN","PSDERCP",27,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDERCP",28,0)
 K LN S (COMM,CNT,PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDERCP",29,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.89,"AE",PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.89,"AE",PSD,PSDS,PSDA)) Q:'PSDA  D
"RTN","PSDERCP",30,0)
 .Q:'$D(^PSD(58.89,+PSDA,0))  S NODE=^PSD(58.89,+PSDA,0)
"RTN","PSDERCP",31,0)
 .S PSDN=+$P(NODE,"^",2)  Q:'$D(^PSD(58.81,+PSDN,0))  S NODE1=^PSD(58.81,+PSDN,0),PSDR=+$P(NODE1,"^",5)
"RTN","PSDERCP",32,0)
 .S NODE9=$G(^PSD(58.81,+PSDN,9)),PHARM=$S(+$P(NODE9,"^",2):+$P(NODE9,"^",2),+$P(NODE9,"^",8):+$P(NODE9,"^",8),1:"")
"RTN","PSDERCP",33,0)
 .S PHARM2=+$P(NODE,"^",4)
"RTN","PSDERCP",34,0)
 .S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P($G(^PSDRUG(+PSDR,0)),"^"),1:"#"_+PSDR_" DRUG NAME MISSING")
"RTN","PSDERCP",35,0)
 .S QTY=$P(NODE1,"^",6),PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),PHARMN2=$S($P($G(^VA(200,+PHARM2,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDERCP",36,0)
 .S PSDT=$E(PSD,4,5)_"/"_$E(PSD,6,7)_"/"_$E(PSD,2,3),TYP=+$P(NODE1,"^",2),TYP=$P($G(^PSD(58.84,+TYP,0)),"^")
"RTN","PSDERCP",37,0)
 .S COMM=$S($D(^PSD(58.89,PSDA,1,0)):1,1:0)
"RTN","PSDERCP",38,0)
 .S ^TMP("PSDERCP",$J,PSDRN,PSDA)=QTY_"^"_PHARMN_"^"_PHARMN2_"^"_PSDT_"^"_TYP_"^"_COMM,CNT=CNT+1
"RTN","PSDERCP",39,0)
 I CNT=0 D HDR W !!,?10,"*** NO CONTROLLED SUBSTANCES RESOLVED ERRORS/ADJUSTMENTS ***",!! G DONE
"RTN","PSDERCP",40,0)
PRINT ;prints data
"RTN","PSDERCP",41,0)
 S COMM=0 D HDR Q:PSDOUT
"RTN","PSDERCP",42,0)
 S PSDRN="" F  S PSDRN=$O(^TMP("PSDERCP",$J,PSDRN)) Q:PSDRN=""  D:$Y+4>IOSL HDR Q:PSDOUT  W !,?2,"=> ",PSDRN,! F PSDA=0:0 S PSDA=$O(^TMP("PSDERCP",$J,PSDRN,PSDA)) Q:'PSDA  D  Q:PSDOUT
"RTN","PSDERCP",43,0)
 .I $Y+4>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDRN,!
"RTN","PSDERCP",44,0)
 .S NODE=^TMP("PSDERCP",$J,PSDRN,PSDA) W !,PSDA,?10,$J($P(NODE,"^"),6),?20,$P(NODE,"^",4),?35,$P(NODE,"^",5),!,?5,$P(NODE,"^",2),?45,$P(NODE,"^",3),!
"RTN","PSDERCP",45,0)
 .I $P(NODE,"^",6) W ?5,"Resolution: " S COMM=1 K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.89,PSDA,1,TEXT)) Q:'TEXT  D:$Y+4>IOSL HDR Q:PSDOUT  S X=$G(^PSD(58.89,PSDA,1,TEXT,0)),DIWL=10,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDERCP",46,0)
 .I COMM D ^DIWW S COMM=0 W !
"RTN","PSDERCP",47,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDERCP",48,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDERCP",49,0)
END ;
"RTN","PSDERCP",50,0)
 K %,%DT,%H,%I,%ZIS,C,COMM,CNT,DA,DIC,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DTOUT,DUOUT,LN,NODE,NODE1,NODE9,OK
"RTN","PSDERCP",51,0)
 K PG,PHARM,PHARM2,PHARMN,PHARMN2,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDN,PSDOUT,PSDR,PSDRG,PSDRN,PSDS,PSDSD,PSDSN,PSDT
"RTN","PSDERCP",52,0)
 K QTY,RPDT,TEXT,TYP,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDERCP",53,0)
 K ^TMP("PSDERCP",$J)
"RTN","PSDERCP",54,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDERCP",55,0)
 Q
"RTN","PSDERCP",56,0)
HDR ;prints header information
"RTN","PSDERCP",57,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDERCP",58,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"CS RESOLVED ERROR/ADJ LOG REPORT",?70,"PAGE: ",PG
"RTN","PSDERCP",59,0)
 W !,?15,"NAOU: ",PSDSN,!,?15,"Period From: ",$P(PSDATE,"^")," to: ",$P(PSDATE,"^",2),!,?15,"Run Date: ",RPDT
"RTN","PSDERCP",60,0)
 W !!,"LOG #",?10,"QUANTITY",?22,"DATE",?35,"ERR/ADJ TYPE",!,?5,"LOGGED BY",?45,"RESOLVED BY",!,LN,!
"RTN","PSDERCP",61,0)
 Q
"RTN","PSDERCP",62,0)
SAVE ;saves variables for queueing
"RTN","PSDERCP",63,0)
 S (ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDERCP",64,0)
 Q
"RTN","PSDERD")
0^61^B10381061
"RTN","PSDERD",1,0)
PSDERD ;BIR/JPW-CS Error Log Edit ; 20 Aug 94
"RTN","PSDERD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDERD",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDERD",4,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSD ERROR",DUZ)):2,1:0)
"RTN","PSDERD",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"the pending Controlled Substances error log.",!!,"PSDMGR or PSD ERROR security key required.",! K OK Q
"RTN","PSDERD",6,0)
 S PSDUZ=DUZ
"RTN","PSDERD",7,0)
 K LN S $P(LN,"-",30)=""
"RTN","PSDERD",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) EDIT
"RTN","PSDERD",9,0)
ASKD ;ask disp location
"RTN","PSDERD",10,0)
 W !!!,"You may select a Dispensing Site at the prompt.",!
"RTN","PSDERD",11,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ"
"RTN","PSDERD",12,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDERD",13,0)
 S DIC("A")="Select Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDERD",14,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDERD",15,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDERD",16,0)
EDIT ;edit entry
"RTN","PSDERD",17,0)
 K DA,DIC S DIC=58.89,DIC("S")="I $P(^(0),""^"",6)=PSDS",DIC("A")="Select Error Log Number: ",DIC(0)="QEAZ"
"RTN","PSDERD",18,0)
 D ^DIC K DIC G:Y<0 END  S PSD=+Y,NODE=Y(0)
"RTN","PSDERD",19,0)
 S PSDA=+$P(NODE,"^",2),PSDATE=$P(NODE,"^",3) I PSDATE S Y=PSDATE X ^DD("DD") S PSDATE=Y
"RTN","PSDERD",20,0)
 ;transaction to edit
"RTN","PSDERD",21,0)
 I '$D(^PSD(58.81,PSDA,0)) W !!,"Transaction unavailable for editing.",!! G END
"RTN","PSDERD",22,0)
 W !!,"Accessing transaction now..."
"RTN","PSDERD",23,0)
 S NODE1=^PSD(58.81,PSDA,0),NODE9=$G(^PSD(58.81,PSDA,9))
"RTN","PSDERD",24,0)
 S PSDR=+$P(NODE1,"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),PSDQTY=+$P(NODE1,"^",6)
"RTN","PSDERD",25,0)
 S PSDTYP=+$P(NODE1,"^",2),PSDTYP=$P($G(^PSD(58.84,PSDTYP,0)),"^")
"RTN","PSDERD",26,0)
 S PSD1=$S(+$P(NODE9,"^",2):+$P(NODE9,"^",2),+$P(NODE9,"^",8):+$P(NODE9,"^",8),+$P(NODE9,"^",11):+$P(NODE9,"^",11),1:"UNKNOWN")
"RTN","PSDERD",27,0)
 S:PSD1 PSD1=$P($G(^VA(200,PSD1,0)),"^")
"RTN","PSDERD",28,0)
 S PSD2=$S(+$P(NODE9,"^",6):+$P(NODE9,"^",6),+$P(NODE9,"^",9):+$P(NODE9,"^",9),+$P(NODE9,"^",12):+$P(NODE9,"^",12),1:"")
"RTN","PSDERD",29,0)
 S:PSD2 PSD2=$P($G(^VA(200,PSD2,0)),"^")
"RTN","PSDERD",30,0)
 D DISPLAY
"RTN","PSDERD",31,0)
DIE ;
"RTN","PSDERD",32,0)
 D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDERD",33,0)
 W !!,"Enter your resolution.",!
"RTN","PSDERD",34,0)
 K DA,DIE,DR S DIE=58.89,DA=PSD,DR="5;4////"_PSDT_";3////"_PSDUZ D ^DIE K DA,DIE,DR
"RTN","PSDERD",35,0)
END ;
"RTN","PSDERD",36,0)
 K %,%DT,%H,%I,%ZIS,ALL,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,NODE1,NODE9
"RTN","PSDERD",37,0)
 K PG,PHARM,PHARMN,POP,PSD,PSD1,PSD2,PSDA,PSDATE,PSDED,PSDEV,PSDN,PSDOUT,PSDQTY,PSDR,PSDRG,PSDRN,PSDS,PSDSD,PSDSN,PSDT,PSDTYP,PSDUZ
"RTN","PSDERD",38,0)
 K QTY,RPDT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDERD",39,0)
 Q
"RTN","PSDERD",40,0)
DISPLAY ;display info
"RTN","PSDERD",41,0)
 W !!,"Transaction Information",!,LN,!
"RTN","PSDERD",42,0)
 W !,PSDRN,!,"Transaction Type: ",PSDTYP,!,"Date Entered: ",PSDATE,?50,"Quantity: ",PSDQTY,!,"Entered By: ",PSD1,! W:PSD2]"" "Witnessed By: ",PSD2,!
"RTN","PSDERD",43,0)
 Q
"RTN","PSDERP")
0^62^B23168392
"RTN","PSDERP",1,0)
PSDERP ;BIR/JPW-CS Error Log Report ; 29 Aug 94
"RTN","PSDERP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDERP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDERP",4,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSD ERROR",DUZ)):2,1:0)
"RTN","PSDERP",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"the pending Controlled Substances error log.",!!,"PSDMGR or PSD ERROR security key required.",! K OK Q
"RTN","PSDERP",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) DATE
"RTN","PSDERP",7,0)
ASKD ;ask disp location
"RTN","PSDERP",8,0)
 W !!,"You may select a Dispensing Site at the prompt.",!
"RTN","PSDERP",9,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ"
"RTN","PSDERP",10,0)
 I OK=1 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDERP",11,0)
 S DIC("A")="Select Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDERP",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDERP",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDERP",14,0)
DATE ;ask date range
"RTN","PSDERP",15,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDERP",16,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDERP",17,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDERP",18,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDERP",19,0)
DEV ;select device
"RTN","PSDERP",20,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDERP",21,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDERP",22,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDERP",23,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDERP",ZTDESC="CS Pending Error Log Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDERP",24,0)
 U IO
"RTN","PSDERP",25,0)
START ;start looping
"RTN","PSDERP",26,0)
 K ^TMP("PSDERP",$J)
"RTN","PSDERP",27,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDERP",28,0)
 K LN S (CNT,PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDERP",29,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.89,"AD",PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.89,"AD",PSD,PSDS,PSDA)) Q:'PSDA  D
"RTN","PSDERP",30,0)
 .Q:'$D(^PSD(58.89,+PSDA,0))  S NODE=^PSD(58.89,+PSDA,0) Q:+$P(NODE,"^",5)
"RTN","PSDERP",31,0)
 .S PSDN=+$P(NODE,"^",2)  Q:'$D(^PSD(58.81,+PSDN,0))  S NODE1=^PSD(58.81,+PSDN,0),PSDR=+$P(NODE1,"^",5)
"RTN","PSDERP",32,0)
 .S NODE9=$G(^PSD(58.81,+PSDN,9)),PHARM=$S(+$P(NODE9,"^",2):+$P(NODE9,"^",2),+$P(NODE9,"^",8):+$P(NODE9,"^",8),+$P(NODE9,"^",11):+$P(NODE9,"^",11),1:"")
"RTN","PSDERP",33,0)
 .S PHARM2=$S(+$P(NODE9,"^",6):+$P(NODE9,"^",6),+$P(NODE9,"^",9):+$P(NODE9,"^",9),+$P(NODE9,"^",12):+$P(NODE9,"^",12),1:""),PHARMN2=""
"RTN","PSDERP",34,0)
 .S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P($G(^PSDRUG(+PSDR,0)),"^"),1:"#"_+PSDR_" DRUG NAME MISSING")
"RTN","PSDERP",35,0)
 .S QTY=$P(NODE1,"^",6),PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") S:PHARM2 PHARMN2=$S($P($G(^VA(200,+PHARM2,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDERP",36,0)
 .S PSDT=$E(PSD,4,5)_"/"_$E(PSD,6,7)_"/"_$E(PSD,2,3),TYP=+$P(NODE1,"^",2),TYP=$P($G(^PSD(58.84,+TYP,0)),"^")
"RTN","PSDERP",37,0)
 .S ^TMP("PSDERP",$J,PSDRN,PSDA)=QTY_"^"_PHARMN_"^"_PHARMN2_"^"_PSDT_"^"_TYP,CNT=CNT+1
"RTN","PSDERP",38,0)
 I CNT=0 D HDR W !!,?10,"*** NO CONTROLLED SUBSTANCES PENDING ERRORS/ADJUSTMENTS ***",!! G DONE
"RTN","PSDERP",39,0)
PRINT ;prints data
"RTN","PSDERP",40,0)
 D HDR Q:PSDOUT
"RTN","PSDERP",41,0)
 S PSDRN="" F  S PSDRN=$O(^TMP("PSDERP",$J,PSDRN)) Q:PSDRN=""  D:$Y+4>IOSL HDR Q:PSDOUT  W !,?2,"=> ",PSDRN,! F PSDA=0:0 S PSDA=$O(^TMP("PSDERP",$J,PSDRN,PSDA)) Q:'PSDA  D  Q:PSDOUT
"RTN","PSDERP",42,0)
 .I $Y+4>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDRN,!
"RTN","PSDERP",43,0)
 .S NODE=^TMP("PSDERP",$J,PSDRN,PSDA) W !,PSDA,?10,$J($P(NODE,"^"),6),?20,$P(NODE,"^",4),?35,$P(NODE,"^",5),!,?5,$P(NODE,"^",2) W:$P(NODE,"^",3)]"" ?45,$P(NODE,"^",3) W !
"RTN","PSDERP",44,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDERP",45,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDERP",46,0)
END ;
"RTN","PSDERP",47,0)
 K %,%DT,%H,%I,%ZIS,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE,NODE1,NODE9,OK
"RTN","PSDERP",48,0)
 K PG,PHARM,PHARM2,PHARMN,PHARMN2,POP,PSD,PSDA,PSDATE,PSDED,PSDEV,PSDN,PSDOUT,PSDR,PSDRG,PSDRN,PSDS,PSDSD,PSDSN,PSDT,QTY,RPDT,TYP,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDERP",49,0)
 K ^TMP("PSDERP",$J)
"RTN","PSDERP",50,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDERP",51,0)
 Q
"RTN","PSDERP",52,0)
HDR ;prints header information
"RTN","PSDERP",53,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDERP",54,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"CS PENDING ERROR/ADJ LOG REPORT",?70,"PAGE: ",PG
"RTN","PSDERP",55,0)
 W !,?15,"NAOU: ",PSDSN,!,?15,"Period From: ",$P(PSDATE,"^")," to: ",$P(PSDATE,"^",2),!,?15,"Run Date: ",RPDT
"RTN","PSDERP",56,0)
 W !!,"LOG #",?10,"QUANTITY",?22,"DATE",?35,"ERR/ADJ TYPE",!,?5,"LOGGED BY",?45,"WITNESSED BY",!,LN,!
"RTN","PSDERP",57,0)
 Q
"RTN","PSDERP",58,0)
SAVE ;saves variables for queueing
"RTN","PSDERP",59,0)
 S (ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDERP",60,0)
 Q
"RTN","PSDEST")
0^63^B23898580
"RTN","PSDEST",1,0)
PSDEST ;BIR/BJW-Destroy a Drug from the Holding file ; 22 Oct 96
"RTN","PSDEST",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEST",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEST",4,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"destroy Controlled Substances.",!!,"PSDMGR security key required.",! G END
"RTN","PSDEST",5,0)
 S PSDUZ=DUZ
"RTN","PSDEST",6,0)
 I PSDUZ S PSDUZAN=$P($G(^VA(200,+PSDUZ,0)),"^")
"RTN","PSDEST",7,0)
SETDATE ;7/17/96,inital set to current date
"RTN","PSDEST",8,0)
 S PSDT=DT
"RTN","PSDEST",9,0)
ASKD ;ask disp location
"RTN","PSDEST",10,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDEST",11,0)
 G:$P(PSDSITE,U,5) ASKN
"RTN","PSDEST",12,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDEST",13,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDEST",14,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDEST",15,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDEST",16,0)
ASKN ;ask holding number
"RTN","PSDEST",17,0)
 W !!,?3,"**Searching for the next available drug awaiting destruction**",!
"RTN","PSDEST",18,0)
 K DIC,DA S DIC=58.86,DIC("A")="Select Destructions #: ",DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",7)=PSDS"
"RTN","PSDEST",19,0)
 F PSD=0:0 S PSD=$O(^PSD(58.86,PSD)) Q:'PSD!($D(DIC("B")))  I $D(^PSD(58.86,PSD,0)),'+$P(^(0),"^",10),+$P(^(0),"^",7)=+PSDS S DIC("B")=PSD
"RTN","PSDEST",20,0)
 D ^DIC K DA,DIC G:Y<0 END S PSDA=+Y
"RTN","PSDEST",21,0)
 W !!,?3,"**You Must enter a DATE to destroy or cancel this Holding Num**"
"RTN","PSDEST",22,0)
DISPLAY ;
"RTN","PSDEST",23,0)
 K LN S $P(LN,"-",30)="",PSDR=$P(Y(0),"^",2),PSDRN=$S($P($G(^PSD(58.86,PSDA,1)),"^")]"":$P($G(^PSD(58.86,PSDA,1)),"^"),1:$P($G(^PSDRUG(+PSDR,0)),"^")),NUM=$P(Y(0),"^"),QTY=$P(Y(0),"^",3)
"RTN","PSDEST",24,0)
 S PSDCT=$S($P(Y(0),"^",8)]"":$P(Y(0),"^",8),1:1),NBKU=$S($P(Y(0),"^",12)]"":$P(Y(0),"^",12),1:$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),"^",8))
"RTN","PSDEST",25,0)
 S PSDCAN=$P($G(^PSD(58.86,PSDA,3)),"^") I PSDCAN S Y=PSDCAN X ^DD("DD") S PSDCAN=Y D MSG2 G ASKN
"RTN","PSDEST",26,0)
 S PSDST=$P(Y(0),"^",11) I PSDST S Y=PSDST X ^DD("DD") S PSDST=Y D MSG1 G ASKN
"RTN","PSDEST",27,0)
 W @IOF,!,"HOLDING FOR DESTRUCTION",!,LN,!!,"Holding Number: ",NUM
"RTN","PSDEST",28,0)
 W !,"Drug: ",PSDRN,!,"Quantity "_$S($D(^PSD(58.8,+PSDR,0)):"("_NBKU_")",1:"")_": ",QTY,!
"RTN","PSDEST",29,0)
OK ;ask ok
"RTN","PSDEST",30,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you want to destroy this Controlled Substances"
"RTN","PSDEST",31,0)
 S DIR("?",1)="Answer 'YES' if you are destroying this drug,",DIR("?")="answer 'NO' and this drug will remain pending destruction."
"RTN","PSDEST",32,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDEST",33,0)
 S ANS=Y(0) I ANS="YES" D DATE G:'$D(PSDT) END G DIE
"RTN","PSDEST",34,0)
 I ANS="NO" G OK1 G:'$D(PSDT) END
"RTN","PSDEST",35,0)
DATE ; ask date,7/17/96 added %DT("B")default date or user can enter new date
"RTN","PSDEST",36,0)
 K %DT W !
"RTN","PSDEST",37,0)
 S %DT="AETX",%DT(0)="-NOW",%DT("A")="DATE DESTROYED/CANCELLED: ",%DT("B")=$$FMTE^XLFDT(PSDT) D ^%DT G:Y<0 END S PSDT=Y W !
"RTN","PSDEST",38,0)
 Q
"RTN","PSDEST",39,0)
OK1 ;ask if entry error
"RTN","PSDEST",40,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="NO",DIR("A")="Was this a destruction holding number entry error"
"RTN","PSDEST",41,0)
 S DIR("?",1)="Answer 'NO' drug will be destroyed,",DIR("?")="answer 'YES' and this drug will not be destroyed."
"RTN","PSDEST",42,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDEST",43,0)
OK2 ;ask do you want to cancel holding #,E3R# 4990
"RTN","PSDEST",44,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to cancel this destruction holding number"
"RTN","PSDEST",45,0)
 S DIR("?",1)="Answer 'NO' if you do not want to cancel this destruction holding number,",DIR("?")="answer 'YES' and the destruction holding number will be cancelled."
"RTN","PSDEST",46,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDEST",47,0)
 I 'Y DO MSG G ASKN
"RTN","PSDEST",48,0)
DIRC ;enter reason,date and pharmacist cancelling holding #,E3R# 4990
"RTN","PSDEST",49,0)
 W !! D DATE G:'$D(PSDT) END
"RTN","PSDEST",50,0)
 K DA,DIR,DIRUT S DIR(0)="58.86,17" D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDEST",51,0)
 S PSDCOM3=Y
"RTN","PSDEST",52,0)
 K DIRUT,DTOUT,DUOUT
"RTN","PSDEST",53,0)
 I PSDT S (Y,YYY)=PSDT X ^DD("DD") S PSDT=Y
"RTN","PSDEST",54,0)
 W !,"DATE/TIME CANCELLED: ",PSDT
"RTN","PSDEST",55,0)
 W !,"CANCELLED BY: ",PSDUZAN
"RTN","PSDEST",56,0)
DIE1 ;update 58.86 for cancelling holding #,E3R# 4990
"RTN","PSDEST",57,0)
 ;The AC,AD X-ref's entries are built on the condition that data is in
"RTN","PSDEST",58,0)
 ;Field 10(date/time destroyed),11/29/95 added I $D(Y) 
"RTN","PSDEST",59,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.86,DR="9////"_PSDUZ_";10///"_PSDT_";15///"_PSDT_";16////"_PSDUZ_";17////"_PSDCOM3_";11///^S X=PSDCT;12///^S X=NBKU" D ^DIE K DA,DIE,DR I $D(Y) D MSG G END
"RTN","PSDEST",60,0)
 W !!,"Holding Number: ",NUM,?19," flagged as entry error"
"RTN","PSDEST",61,0)
 S PSDT=YYY G ASKN
"RTN","PSDEST",62,0)
DIE ;update 58.86
"RTN","PSDEST",63,0)
 ;10/22/96 added / to fld#11,12 to remove prompt;11/29/95 added I $D(Y)
"RTN","PSDEST",64,0)
 W !,?3,"** Updating the record **",! K DA,DIE,DR S DA=PSDA,DIE=58.86,DR="9////"_PSDUZ_";10///"_PSDT_";11///^S X=PSDCT;12///^S X=NBKU" D ^DIE K DA,DIE,DR
"RTN","PSDEST",65,0)
 I $D(Y) D MSG G END
"RTN","PSDEST",66,0)
 W !!,?3,"=> Holding Number: ",NUM," has been destroyed.",!!
"RTN","PSDEST",67,0)
 G ASKN
"RTN","PSDEST",68,0)
END K %,%DT,%H,%I,ANS,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,LN,NBKU,NUM
"RTN","PSDEST",69,0)
 K PSD,PSDA,PSDCAN,PSDCOM3,PSDR,PSDRN,PSDCT,PSDS,PSDSN,PSDT,PSDST,PSDUZ,PSDUZAN,QTY,X,Y,YYY
"RTN","PSDEST",70,0)
 Q
"RTN","PSDEST",71,0)
MSG W !!,"No action taken",!!
"RTN","PSDEST",72,0)
 Q
"RTN","PSDEST",73,0)
MSG1 ;msg when already destroyed
"RTN","PSDEST",74,0)
 W $C(7),!!,"Drug: ",PSDRN,!,"=> Destruction #: ",NUM," was destroyed on ",PSDST,".",!!
"RTN","PSDEST",75,0)
 Q
"RTN","PSDEST",76,0)
MSG2 ;msg when cancelled,E3R# 4990
"RTN","PSDEST",77,0)
 W $C(7),!!,"Drug: ",PSDRN,!,"=> Destruction #: ",NUM," was cancelled on ",PSDCAN,".",!!
"RTN","PSDEST",78,0)
 Q
"RTN","PSDESTF")
0^64^B18152234
"RTN","PSDESTF",1,0)
PSDESTF ;BIR/BJW-Add Non-CS Drug to Holding file ; 28 July 95
"RTN","PSDESTF",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDESTF",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDESTF",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"destroy Controlled Substances.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDESTF",5,0)
 S PSDUZ=DUZ,PSDOUT=0 D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDESTF",6,0)
 W !!,?5,"NOTE: This Holding for Destruction transaction WILL NOT update your",!,?5,"Controlled Substances inventory balance.",!!
"RTN","PSDESTF",7,0)
ASKD ;ask disp location
"RTN","PSDESTF",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) DEST
"RTN","PSDESTF",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDESTF",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDESTF",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDESTF",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDESTF",13,0)
DEST ;set up file 58.86
"RTN","PSDESTF",14,0)
 S PSDOUT=0,PSDCT=1
"RTN","PSDESTF",15,0)
 S (MFG,LOT,EXP)=""
"RTN","PSDESTF",16,0)
DIR ;ask free-text drug name
"RTN","PSDESTF",17,0)
 W !!,"You may create a free-text CS drug to place on hold for destruction.",!,"Your Dispensing Site inventory balance WILL NOT be updated.",!!
"RTN","PSDESTF",18,0)
 K DA,DIR,DIRUT S DIR(0)="58.86,13" D ^DIR K DA,DIR
"RTN","PSDESTF",19,0)
 I $D(DIRUT) D MSG G END
"RTN","PSDESTF",20,0)
 I Y']"" D MSG G END
"RTN","PSDESTF",21,0)
 S PSDRN=Y
"RTN","PSDESTF",22,0)
DIR2 K DA,DIR,DIRUT,DTOUT,DUOUT F PSDANS=2,4,11,12,18 S DIR(0)="58.86,"_PSDANS D ^DIR K DA,DIR D  I PSDOUT D MSG G END
"RTN","PSDESTF",23,0)
 .I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDESTF",24,0)
 .I PSDANS'=4,PSDANS'=18,Y']"" S PSDOUT=1 Q
"RTN","PSDESTF",25,0)
 .S PSD(PSDANS)=Y
"RTN","PSDESTF",26,0)
 .K DIRUT,DTOUT,DUOUT
"RTN","PSDESTF",27,0)
 ;DIR3 added 5/7/95 to add comments field
"RTN","PSDESTF",28,0)
DIR3 ;enter free-text information(comments)
"RTN","PSDESTF",29,0)
 W !!,"You may enter free-text info regarding drug placed on hold for destruction."
"RTN","PSDESTF",30,0)
 K DA,DIR,DIRUT S DIR(0)="58.86,14" D ^DIR K DA,DIR
"RTN","PSDESTF",31,0)
 I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDESTF",32,0)
 S PSDCOMS=Y
"RTN","PSDESTF",33,0)
ASKY ;ask ok to continue
"RTN","PSDESTF",34,0)
 W !!,PSDRN," has been selected.",!
"RTN","PSDESTF",35,0)
 K DA,DIR,DIRUT S DIR(0)="YA",DIR("B")="NO",DIR("A")="Is this OK to create Holding for Destructions number? "
"RTN","PSDESTF",36,0)
 S DIR("?",1)="Answer 'YES' to create a Holding for Destruction number for this drug,",DIR("?")="answer 'NO' to create a different free-text CS drug, or '^' to quit."
"RTN","PSDESTF",37,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDESTF",38,0)
 I 'Y G DIR
"RTN","PSDESTF",39,0)
 W !!,"Creating an entry in the Destructions file..."
"RTN","PSDESTF",40,0)
 F  L +^PSD(58.86,0):0 I  Q
"RTN","PSDESTF",41,0)
 ;5/7/95 Fld 14 added, 7/28/95 Fld 18 added
"RTN","PSDESTF",42,0)
FIND S PSDHLD=$P(^PSD(58.86,0),"^",3)+1 I $D(^PSD(58.86,PSDHLD)) S $P(^PSD(58.86,0),"^",3)=PSDHLD G FIND
"RTN","PSDESTF",43,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.86,DIC(0)="L",(X,DINUM)=PSDHLD D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSDESTF",44,0)
 L -^PSD(58.86,0)
"RTN","PSDESTF",45,0)
 W !!,"Your Destructions Holding number is ",PSDHLD
"RTN","PSDESTF",46,0)
 K DA,DIE,DR S DIE=58.86,DA=PSDHLD,DR="13////"_PSDRN_";2////"_PSD(2)_";3////"_PSDUZ_";5////"_PSDT_";6////"_PSDS_";4////"_$S(+PSD(4):+PSD(4),1:"")_";11////"_+PSD(11)_";12////"_PSD(12)_";14////"_PSDCOMS_";18////"_+PSD(18)
"RTN","PSDESTF",47,0)
 D ^DIE K DIE,DA,DR
"RTN","PSDESTF",48,0)
 S RQTY=$P($G(^PSD(58.86,PSDHLD,0)),"^",3),PSDRN=$P($G(^(1)),"^")
"RTN","PSDESTF",49,0)
 S PSDOK=1
"RTN","PSDESTF",50,0)
PRINT ;print 2321
"RTN","PSDESTF",51,0)
 W !!,"Number of copies of VA FORM 10-2321? " R NUM:DTIME I '$T!(NUM="^")!(NUM="") W !!,"No copies printed!!",!! Q
"RTN","PSDESTF",52,0)
 I NUM'?1N!(NUM=0)  W !!,"Enter a whole number between 1 and 9",! G PRINT
"RTN","PSDESTF",53,0)
 S PG=0,RECDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3) S:EXP EXP=$E(EXP,4,5)_"/"_$E(EXP,2,3) D ^PSDGSRV2
"RTN","PSDESTF",54,0)
END ;kill variables
"RTN","PSDESTF",55,0)
 K %,%DT,%H,%I,ALL,CNT,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EXP,LN,LOT,MFG,NUM
"RTN","PSDESTF",56,0)
 K PG,PSD,PSDANS,PSDCT,PSDCOMS,PSDHLD,PSDOK,PSDOUT,PSDRN,PSDS,PSDSN,PSDT,PSDUZ,RECDT,RPDT,RQTY,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDESTF",57,0)
 Q
"RTN","PSDESTF",58,0)
MSG W $C(7),!!,"WARNING: Holding for Destructions entry HAS NOT been created.",!!
"RTN","PSDESTF",59,0)
 Q
"RTN","PSDESTO")
0^65^B20258651
"RTN","PSDESTO",1,0)
PSDESTO ;BIR/BJW-Add CS Non-Inv Drug to Holding file ; 01 NOV 96
"RTN","PSDESTO",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDESTO",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDESTO",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"destroy Controlled Substances.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDESTO",5,0)
 S PSDUZ=DUZ D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDESTO",6,0)
 W !!,?5,"NOTE: This Holding for Destruction transaction WILL NOT update your",!,?5,"Controlled Substances inventory balance.",!!
"RTN","PSDESTO",7,0)
ASKD ;ask disp location
"RTN","PSDESTO",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4) G:$P(PSDSITE,U,5) DRUG
"RTN","PSDESTO",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDESTO",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDESTO",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDESTO",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDESTO",13,0)
DRUG ;ask non-inv CS drug
"RTN","PSDESTO",14,0)
 W !!,"You may select a Controlled Substances drug to place on hold for destruction.",!,"Your Dispensing Site inventory balance WILL NOT be updated.",!!
"RTN","PSDESTO",15,0)
 K DA,DIC S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEAM",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END I Y<0 G RPTCPY
"RTN","PSDESTO",16,0)
 S PSDR=+Y,PSDRN=$P(Y,"^",2)
"RTN","PSDESTO",17,0)
DEST ;set up file 58.86
"RTN","PSDESTO",18,0)
 S PSDOUT=0,PSDCT=1
"RTN","PSDESTO",19,0)
 S (MFG,LOT,EXP)=""
"RTN","PSDESTO",20,0)
 ;7/27/95 Field 18 added, to prompt for patient name returning drugs.
"RTN","PSDESTO",21,0)
DIR2 K DA,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDANS F PSDANS=2,4,11,12,18 S DIR(0)="58.86,"_PSDANS D ^DIR K DA,DIR D  I PSDOUT D MSG G END
"RTN","PSDESTO",22,0)
 .I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDESTO",23,0)
 .I PSDANS'=4,PSDANS'=18,Y']"" S PSDOUT=1 Q
"RTN","PSDESTO",24,0)
 .S PSD(PSDANS)=Y
"RTN","PSDESTO",25,0)
 .K DIRUT,DTOUT,DUOUT
"RTN","PSDESTO",26,0)
 ;DIR was added for E3R# 3771
"RTN","PSDESTO",27,0)
DIR ;enter free-text information 
"RTN","PSDESTO",28,0)
 W !!,"You may enter free-text info regarding drug placed on hold for destruction."
"RTN","PSDESTO",29,0)
 K DA,DIR,DIRUT S DIR(0)="58.86,14" D ^DIR K DA,DIR
"RTN","PSDESTO",30,0)
 I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDESTO",31,0)
 S PSDCOMS=Y
"RTN","PSDESTO",32,0)
ASKY ;ask ok to continue
"RTN","PSDESTO",33,0)
 W !!,PSDRN," has been selected.",!
"RTN","PSDESTO",34,0)
 K DA,DIR,DIRUT S DIR(0)="YA",DIR("B")="NO",DIR("A")="Is this OK to create Holding for Destructions number? "
"RTN","PSDESTO",35,0)
 S DIR("?",1)="Answer 'YES' to create a Holding for Destruction number for this drug,",DIR("?")="answer 'NO' to select a different CS drug or '^' to quit."
"RTN","PSDESTO",36,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDESTO",37,0)
 I 'Y W !!,"Select a new CS drug to place on hold for destruction",!! G DRUG
"RTN","PSDESTO",38,0)
 W !!,"Creating an entry in the Destructions file..."
"RTN","PSDESTO",39,0)
 F  L +^PSD(58.86,0):0 I  Q
"RTN","PSDESTO",40,0)
 ;Field 14 added for E3R# 3771,Fld 18 added 7/27/95
"RTN","PSDESTO",41,0)
FIND S PSDHLD=$P(^PSD(58.86,0),"^",3)+1 I $D(^PSD(58.86,PSDHLD)) S $P(^PSD(58.86,0),"^",3)=PSDHLD G FIND
"RTN","PSDESTO",42,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.86,DIC(0)="L",(X,DINUM)=PSDHLD D ^DIC K DIC,DLAYGO
"RTN","PSDESTO",43,0)
 L -^PSD(58.86,0)
"RTN","PSDESTO",44,0)
 W !!,"Your Destructions Holding number is ",PSDHLD
"RTN","PSDESTO",45,0)
 K DA,DIE,DR S DIE=58.86,DA=PSDHLD,DR="1////"_PSDR_";2////"_PSD(2)_";3////"_PSDUZ_";5////"_PSDT_";6////"_PSDS_";4////"_$S(+PSD(4):+PSD(4),1:"")_";11////"_+PSD(11)_";12////"_PSD(12)_";14////"_PSDCOMS_";18////"_+PSD(18)
"RTN","PSDESTO",46,0)
 D ^DIE K DIE,DA,DR
"RTN","PSDESTO",47,0)
 S RQTY=+$P($G(^PSD(58.86,PSDHLD,0)),"^",3)
"RTN","PSDESTO",48,0)
 S PSDOK=1
"RTN","PSDESTO",49,0)
TEMPX ;build temp file added june 96
"RTN","PSDESTO",50,0)
 S PG=0,RECDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3) S:EXP EXP=$E(EXP,4,5)_"/"_$E(EXP,2,3)
"RTN","PSDESTO",51,0)
 S ^TMP("PSDESTO",$J,PSDHLD)=PSDHLD_"^"_RECDT_"^"_PSDRN_"^"_RQTY_"^"_PSDCOMS G DRUG
"RTN","PSDESTO",52,0)
RPTCPY ;ask # of report copies
"RTN","PSDESTO",53,0)
 I '$G(PSDHLD) G END
"RTN","PSDESTO",54,0)
 W !!,"Number of copies of VA FORM 10-2321? " R NUM:DTIME I '$T!(NUM="^")!(NUM="") W !!,"No copies printed!!",!! G END
"RTN","PSDESTO",55,0)
 I $G(NUM) D ^PSDGSRV2 G END
"RTN","PSDESTO",56,0)
 I NUM'?1N!(NUM=0)  W !!,"Enter a whole number between 1 and 9",! G RPTCPY
"RTN","PSDESTO",57,0)
END ;kill variables
"RTN","PSDESTO",58,0)
 K %,%DT,%H,%I,ALL,CNT,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EXP,LN,LOT,MFG,NUM
"RTN","PSDESTO",59,0)
 K PG,PSD,PSDANS,PSDCOMS,PSDCT,PSDHLD,PSDOK,PSDOUT,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDUZ,RECDT,RPDT,RQTY,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDESTO",60,0)
 K ^TMP("PSDESTO",$J)
"RTN","PSDESTO",61,0)
 Q
"RTN","PSDESTO",62,0)
MSG W $C(7),!!,"WARNING: Holding for Destructions entry HAS NOT been created.",!!
"RTN","PSDESTO",63,0)
 Q
"RTN","PSDESTP")
0^66^B45750361
"RTN","PSDESTP",1,0)
PSDESTP ;BIR/BJW-Destroyed CS Drugs Report ; 31 JAN 96
"RTN","PSDESTP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDESTP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDESTP",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"the pending Controlled Substances destruction data.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDESTP",5,0)
ASKD ;ask disp location
"RTN","PSDESTP",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDESTP",7,0)
ASKV ;ask vault(s)
"RTN","PSDESTP",8,0)
 W !!,?5,"You may select a single VAULT, several VAULT(s),",!,?5,"or enter ^ALL to select all VAULT(s).",!
"RTN","PSDESTP",9,0)
 K DA,DIC D NOW^%DTC S (PSDT,Y)=X X ^DD("DD") S RPDT=Y
"RTN","PSDESTP",10,0)
 F  S DIC=58.8,DIC("A")="Select VAULT: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S PSDVAU(+Y)=""
"RTN","PSDESTP",11,0)
ASKV2 ;
"RTN","PSDESTP",12,0)
 I '$O(PSDVAU(0))&(X'="^ALL") G END
"RTN","PSDESTP",13,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="N",$P($G(^(0)),"^",3)=+PSDSITE S PSDVAU(PSD)=""
"RTN","PSDESTP",14,0)
 S JJ=$O(PSDVAU(0)),JJ=$S($O(PSDVAU(JJ)):1,1:2)
"RTN","PSDESTP",15,0)
 S DIC="^DIC(4,",DR=.01,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDESTP",16,0)
 D EN^DIQ1 S PSD=PSD(4,DA,.01) K DIC,DR,DA,DIQ
"RTN","PSDESTP",17,0)
 S PSDSN=$S(JJ=1:PSD,1:$P($G(^PSD(58.8,+$O(PSDVAU(0)),0)),U)) K PSD
"RTN","PSDESTP",18,0)
DRUG ;ask drug
"RTN","PSDESTP",19,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDESTP",20,0)
 W ! K DA,DIC
"RTN","PSDESTP",21,0)
 S PSDS=$O(PSDVAU(0))
"RTN","PSDESTP",22,0)
 I $O(PSDVAU(PSDS)) D  G SKIP
"RTN","PSDESTP",23,0)
 .F  S DIC=50,DIC(0)="QEAM",DIC("A")="SELECT DRUG: " D ^DIC K DIC Q:Y<0  S PSDRG(+Y)=""
"RTN","PSDESTP",24,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDESTP",25,0)
 .S PSDRG(+Y)=""
"RTN","PSDESTP",26,0)
SKIP I '$D(PSDRG)&(X'="^ALL") G END
"RTN","PSDESTP",27,0)
 I X="^ALL" S ALL=1
"RTN","PSDESTP",28,0)
DATE ;ask date range
"RTN","PSDESTP",29,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDESTP",30,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDESTP",31,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDESTP",32,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDESTP",33,0)
DEV ;select device
"RTN","PSDESTP",34,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDESTP",35,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDESTP",36,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDESTP",37,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDESTP",ZTDESC="Destroyed CS Drug Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDESTP",38,0)
 U IO
"RTN","PSDESTP",39,0)
START ;start looping
"RTN","PSDESTP",40,0)
 K ^TMP("PSDESTP",$J)
"RTN","PSDESTP",41,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDESTP",42,0)
 K LN S (CNT,PG,PSDOUT,PSDTOT)=0,$P(LN,"-",80)=""
"RTN","PSDESTP",43,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.86,"AC",PSD)) Q:'PSD!(PSD>PSDED)   S PSDS=0 F  S PSDS=$O(^PSD(58.86,"AC",PSD,PSDS)) Q:'PSDS  D:$D(PSDVAU(PSDS))
"RTN","PSDESTP",44,0)
 .F PSDR=0:0 S PSDR=$O(^PSD(58.86,"AC",PSD,PSDS,PSDR)) Q:'PSDR  D
"RTN","PSDESTP",45,0)
 ..F PSDA=0:0 S PSDA=$O(^PSD(58.86,"AC",PSD,PSDS,PSDR,PSDA)) Q:'PSDA  I $D(ALL)!($D(PSDRG(+PSDR))) D SET
"RTN","PSDESTP",46,0)
 I $D(ALL) F PSD=PSDSD:0 S PSD=$O(^PSD(58.86,"AD",PSD)) Q:'PSD!(PSD>PSDED)  F  S PSDS=$O(^PSD(58.86,"AD",PSD,PSDS)) Q:'PSDS  D:$D(PSDVAU(PSDS))
"RTN","PSDESTP",47,0)
 .S PSDN="" F  S PSDN=$O(^PSD(58.86,"AD",PSD,PSDS,PSDN)) Q:PSDN=""  F PSDA=0:0 S PSDA=$O(^PSD(58.86,"AD",PSD,PSDS,PSDN,PSDA)) Q:'PSDA  D SET
"RTN","PSDESTP",48,0)
 I CNT=0 D HDR W !!,?10,"*** NO CONTROLLED SUBSTANCE DESTRUCTIONS ***",!! G DONE
"RTN","PSDESTP",49,0)
PRINT ;prints data,L-6 added 8/24/95 accum summ.total,10/20/95 chgs made
"RTN","PSDESTP",50,0)
 D HDR
"RTN","PSDESTP",51,0)
 F PSDA=0:0 S PSDA=$O(^TMP("PSDESTP",$J,PSDA)) D:'PSDA GTOT Q:'PSDA!(PSDOUT)  D:$Y+12>IOSL HDR Q:PSDOUT  S PSDRN="" F  S PSDRN=$O(^TMP("PSDESTP",$J,PSDA,PSDRN)) Q:PSDRN=""  D 
"RTN","PSDESTP",52,0)
 .I $Y+12>IOSL D HDR Q:PSDOUT
"RTN","PSDESTP",53,0)
 .S NODE=^TMP("PSDESTP",$J,PSDA,PSDRN)
"RTN","PSDESTP",54,0)
 .W !,"HOLDING #: ",PSDA,! S PVAULT=$P(NODE,U,9) W:JJ=1 "=> ",$P($G(^PSD(58.8,+PVAULT,0)),U),! W "Drug: ",PSDRN W ?60 W:$P(NODE,"^",8) "GS #: ",$P(NODE,U,8) W !,"Quantity: ",$P(NODE,"^"),!,"Cost of above Qty: ",$P(NODE,U,11)
"RTN","PSDESTP",55,0)
 .I $P(NODE,U,10)']"" S PSDTOT=$P(NODE,U,11)+PSDTOT
"RTN","PSDESTP",56,0)
 .I $P(NODE,U,6)']"" D
"RTN","PSDESTP",57,0)
 ..W !,"Date Destroyed: ",$P(NODE,U,3),!,"Destroyed By: ",$P(NODE,U,2),!,"Patient Returning Drug: ",$P(NODE,U,10),!
"RTN","PSDESTP",58,0)
 ..W:$P(NODE,U,4) "Comments: ",$P(NODE,U,4),!!
"RTN","PSDESTP",59,0)
 ..W:'$P(NODE,U,4) "Comments: ",$P(NODE,U,12),!!
"RTN","PSDESTP",60,0)
 .I $P(NODE,U,6)]"" D
"RTN","PSDESTP",61,0)
 ..W !,"Date/Time Cancelled: ",$P(NODE,U,5),!,"Cancelled By: ",$P(NODE,U,6),!,"Patient Returning Drug: ",$P(NODE,U,10),!,"Comments: ",$P(NODE,U,7),!!
"RTN","PSDESTP",62,0)
DONE ;
"RTN","PSDESTP",63,0)
 I $E(IOST)'="C" W @IOF
"RTN","PSDESTP",64,0)
 I $E(IOST,1,2)="C-",'PSDOUT W !! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDESTP",65,0)
END ;
"RTN","PSDESTP",66,0)
 K %,%DT,%H,%I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NODE
"RTN","PSDESTP",67,0)
 K JJ,PG,PBACOM,PHARM,PHARMC,PHARMN,PHARMNC,POP,PPDU,PSD,PSDA,PSDATE,PSDCD,PSDCOMS,PSDCOM3,PSDED,PSDEV,PSDGS,PSDN,PSDPAT,PSDPATR,PSDPDU,PSDOUT,PSDR,PSDRG,PSDRN,PSDS,PSDTOT,PSDSD,PSDSN,PSDT,PSDTR,PSDVAU,PVAULT
"RTN","PSDESTP",68,0)
 K QTY,RPDT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDESTP",69,0)
 K ^TMP("PSDESTP",$J)
"RTN","PSDESTP",70,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDESTP",71,0)
 Q
"RTN","PSDESTP",72,0)
HDR ;prints header information
"RTN","PSDESTP",73,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDESTP",74,0)
 S PG=PG+1 W:$Y @IOF W !,?70,"PAGE: ",PG,!,?15,"DESTROYED CS DRUGS REPORT for ",PSDSN
"RTN","PSDESTP",75,0)
 W !,?15,"Period From: ",$P(PSDATE,"^")," to: ",$P(PSDATE,"^",2),!,?15,"Run Date: ",RPDT,!!,"=> VAULT",!,LN,!
"RTN","PSDESTP",76,0)
 Q
"RTN","PSDESTP",77,0)
GTOT ;10/20/95 msg added,grand total,inserted 8/24/95
"RTN","PSDESTP",78,0)
 Q:PSDOUT
"RTN","PSDESTP",79,0)
 W !!!!?50,"Summary Total: ",PSDTOT
"RTN","PSDESTP",80,0)
 W !!!?15,"*** Drugs returned by a patient ARE NOT ADDED to Summary Total***"
"RTN","PSDESTP",81,0)
 Q
"RTN","PSDESTP",82,0)
SAVE ;saves variables for queueing
"RTN","PSDESTP",83,0)
 S (ZTSAVE("JJ"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDTOT"))=""
"RTN","PSDESTP",84,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDRG) ZTSAVE("PSDRG(")=""
"RTN","PSDESTP",85,0)
 S:$D(PSDVAU) ZTSAVE("PSDVAU(")=""
"RTN","PSDESTP",86,0)
 Q
"RTN","PSDESTP",87,0)
SET ;sets data;10/20/95 added bal.adj comms. PBACOM
"RTN","PSDESTP",88,0)
 S CNT=CNT+1
"RTN","PSDESTP",89,0)
 S (PSDGS,PBACOM)=""
"RTN","PSDESTP",90,0)
 S NODE=^PSD(58.86,PSDA,0),PSDRN=$S($G(^PSD(58.86,PSDA,1))]"":$G(^PSD(58.86,PSDA,1))_"*",$P($G(^PSDRUG(+PSDR,0)),"^")]"":$P($G(^PSDRUG(+PSDR,0)),"^"),1:"#"_PSDA_" DRUG NAME MISSING")
"RTN","PSDESTP",91,0)
 S PSDTR=$P(NODE,"^",9) I +PSDTR S PSDGS=$P($G(^PSD(58.81,PSDTR,0)),U,17),PBACOM=$P($G(^PSD(58.81,PSDTR,0)),U,16)
"RTN","PSDESTP",92,0)
 S QTY=$P(NODE,"^",3),PHARM=+$P(NODE,"^",10),PHARMN=$S($P($G(^VA(200,PHARM,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",93,0)
 S PPDU=$P($G(^PSDRUG(+PSDR,660)),U,6),PSDPDU=$J(PPDU*QTY,1,3)
"RTN","PSDESTP",94,0)
 S PSDT=$E(PSD,4,5)_"/"_$E(PSD,6,7)_"/"_$E(PSD,2,3)
"RTN","PSDESTP",95,0)
 S PVAULT=+$P($G(^PSD(58.86,PSDA,0)),"^",7)
"RTN","PSDESTP",96,0)
 S PSDCOMS=$P($G(^PSD(58.86,PSDA,2)),"^")
"RTN","PSDESTP",97,0)
 S PSDCD=$P($G(^PSD(58.86,PSDA,3)),"^") I PSDCD S PSDCD=$E(PSDCD,4,5)_"/"_$E(PSDCD,6,7)_"/"_$E(PSDCD,2,3)
"RTN","PSDESTP",98,0)
 S PHARMC=+$P($G(^PSD(58.86,PSDA,3)),"^",2),PHARMNC=$S($P($G(^VA(200,PHARMC,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",99,0)
 S PSDCOM3=$P($G(^PSD(58.86,PSDA,3)),"^",3)
"RTN","PSDESTP",100,0)
 S PSDPAT=+$P(NODE,"^",13),PSDPATR=$S($P($G(^DPT(PSDPAT,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDESTP",101,0)
 S ^TMP("PSDESTP",$J,PSDA,PSDRN)=QTY_"^"_PHARMN_"^"_PSDT_"^"_PSDCOMS_"^"_PSDCD_"^"_PHARMNC_"^"_PSDCOM3_"^"_PSDGS_"^"_PVAULT_"^"_PSDPATR_"^"_PSDPDU_"^"_PBACOM
"RTN","PSDESTP",102,0)
 Q
"RTN","PSDEVO")
0^67^B20418185
"RTN","PSDEVO",1,0)
PSDEVO ;BIR/JPW-Edit/Cancel a Verified Order ; 6 July 94
"RTN","PSDEVO",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEVO",3,0)
EN ;entry for edit/cancel verified order
"RTN","PSDEVO",4,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEVO",5,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Contact your Pharmacy Coordinator for access to edit or cancel",!,"a verified Controlled Substances order.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDEVO",6,0)
 S PSDUZ=DUZ
"RTN","PSDEVO",7,0)
 W $C(7),!!,?18,"*** NOTE ***",!,?5,"Only Verified Orders with a status of FILLED - NOT DELIVERED",!,?5,"may be edited or verified.",!!
"RTN","PSDEVO",8,0)
ASKD ;ask disp site
"RTN","PSDEVO",9,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDEVO",10,0)
 G:$P(PSDSITE,U,5) GS
"RTN","PSDEVO",11,0)
 K DA,DIC S DIC=58.8,DIC("A")="Select Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDEVO",12,0)
 S DIC(0)="QEA",DIC("B")=PSDSN
"RTN","PSDEVO",13,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDEVO",14,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDEVO",15,0)
GS ;ask gs #
"RTN","PSDEVO",16,0)
 K DA,DIC,NQTY S DIC=58.81,DIC("A")="Select Green Sheet #: ",DIC(0)="QEASZ",D="D"
"RTN","PSDEVO",17,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",11)=3"
"RTN","PSDEVO",18,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y,QTY=$P(Y(0),"^",6),PSDPN=$P(Y(0),"^",17),PSDR=$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),ORD=$P(Y(0),"^",20),NAOU=$P(Y(0),"^",18)
"RTN","PSDEVO",19,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) W !!,PSDRN," is not stocked in ",PSDSN,!! D MSG G END
"RTN","PSDEVO",20,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",8),NPKG=$P(^(0),"^",9)
"RTN","PSDEVO",21,0)
 I 'NPKG!(NBKU']"") W !!,PSDRN," is missing breakdown unit or ",!,"package size data in ",PSDSN,".",!! D MSG G END
"RTN","PSDEVO",22,0)
 I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S NQTY=$P(^(4),"^",3)
"RTN","PSDEVO",23,0)
 W !!,"Drug: ",PSDRN,!,"     Quantity: ",$S($D(NQTY):NQTY,1:QTY),"    Breakdown Unit: ",NBKU,!!
"RTN","PSDEVO",24,0)
ASK ;edit or cancel
"RTN","PSDEVO",25,0)
 K DA,DIR,DIRUT S DIR("A")="ACTION (DC E): ",DIR(0)="SOBA^E:EDIT;DC:CANCEL"
"RTN","PSDEVO",26,0)
 S DIR("?",1)="Select 'E' to Edit this verified order, 'DC' to cancel",DIR("?")="or '^' to quit."
"RTN","PSDEVO",27,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDEVO",28,0)
 S ANS=Y I ANS="DC" D CANC G END
"RTN","PSDEVO",29,0)
 I ANS="E" D ^PSDEVO1
"RTN","PSDEVO",30,0)
END K %,%DT,%H,%I,ANS,AQTY,BAL,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,FIELD,LOT,MFG,NAOU,NAOUN,NBKU,NPKG,NQTY,OK,ORD,OREC
"RTN","PSDEVO",31,0)
 K PSDA,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDUZ,QTY,RECD,RECDT,RQTY,STAT,STATN,SUB,WK,X,Y
"RTN","PSDEVO",32,0)
 Q
"RTN","PSDEVO",33,0)
CANC ;canc ver ord
"RTN","PSDEVO",34,0)
 W !!,"Green Sheet # ",PSDPN,"  Quantity Dispensed: ",$S($D(NQTY):NQTY,1:QTY),"   Breakdown Unit: ",NBKU,!
"RTN","PSDEVO",35,0)
 K DA,DIR,DIRUT S DIR(0)="YOA",DIR("?",1)="Answer 'YES' to cancel this order and add the quantity",DIR("?")="back to your vault balance or '^' to quit."
"RTN","PSDEVO",36,0)
 S DIR("A")="Are you sure? " D ^DIR K DIR I $D(DIRUT) D MSG S PSDOUT=1 Q
"RTN","PSDEVO",37,0)
 I 'Y D MSG S PSDOUT=1 Q
"RTN","PSDEVO",38,0)
 S AQTY=$S($D(NQTY):NQTY,1:QTY)
"RTN","PSDEVO",39,0)
 W !!,"Accessing your transaction history..."
"RTN","PSDEVO",40,0)
 F  L +^PSD(58.8,+PSDS,1,+PSDR,0):0 I  Q
"RTN","PSDEVO",41,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDEVO",42,0)
 S BAL=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+AQTY
"RTN","PSDEVO",43,0)
 L -^PSD(58.8,+PSDS,1,+PSDR,0) W !!,"Old Balance: ",BAL,?35,"New Balance :",BAL+AQTY,!!
"RTN","PSDEVO",44,0)
 W !!,"Updating your transaction history now..."
"RTN","PSDEVO",45,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="10////9;55////"_PSDT_";56////"_PSDUZ_";57///"_AQTY_";59////"_BAL_";58" D ^DIE K DA,DIE,DR
"RTN","PSDEVO",46,0)
 W !!,"Order record..." K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////9;19////@" D ^DIE K DA,DIE,DR
"RTN","PSDEVO",47,0)
 I +$O(^PSD(58.85,"AD",NAOU,PSDR,ORD,0)) W "worksheet..." S DA=+$O(^PSD(58.85,"AD",NAOU,PSDR,ORD,0)),DIE=58.85,DR="6////9" D ^DIE K DIE,DA,DR
"RTN","PSDEVO",48,0)
 ;Betty I'm commenting out the following line like we discussed
"RTN","PSDEVO",49,0)
 ;I $D(^PSD(58.8,NAOU,1,PSDR,0)) S $P(^(0),"^",4)=$P(^(0),"^",4)-AQTY
"RTN","PSDEVO",50,0)
MON ;monthly activity
"RTN","PSDEVO",51,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDEVO",52,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DIC S DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=+PSDS,DA(1)=PSDR D ^DIC K DIC,DA,DINUM,DLAYGO
"RTN","PSDEVO",53,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DA(2)=+PSDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR="11////^S X=$P($G(^(0)),""^"",7)+QTY" D ^DIE K DA,DIE,DR
"RTN","PSDEVO",54,0)
 W !!,"Finished.  Your Green Sheet # ",PSDPN," has been cancelled.",!!
"RTN","PSDEVO",55,0)
 Q
"RTN","PSDEVO",56,0)
MSG W !!,"** No action taken. **",!!
"RTN","PSDEVO",57,0)
 Q
"RTN","PSDEVO1")
0^68^B15030044
"RTN","PSDEVO1",1,0)
PSDEVO1 ;BIR/JPW-Edit/Cancel a Verified Order (cont'd) ; 22 Jun 93
"RTN","PSDEVO1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEVO1",3,0)
EN ;entry for edit verified order
"RTN","PSDEVO1",4,0)
 W !!,?5,"You may edit quantity, manufacturer, lot # and expiration date.",!,?5,"If you wish to edit drug or NAOU, you must cancel this order",!,?5,"and enter a new order.",!!
"RTN","PSDEVO1",5,0)
 I $D(NQTY) W !!,"This verified order has been previously edited.",!,"You must cancel this order and re-enter a new one.",!! D MSG S PSDOUT=1 Q
"RTN","PSDEVO1",6,0)
 K DA,DIR,DIRUT S DIR(0)="SO^Q:QUANTITY ONLY;M:MFG/LOT#/EXP.DATE ONLY;B:BOTH SETS OF FIELDS"
"RTN","PSDEVO1",7,0)
 S DIR("?",1)="Enter 'Q' to edit quantity only,",DIR("?",2)="Enter 'M' to edit mfg/lot #/exp.date only"
"RTN","PSDEVO1",8,0)
 S DIR("?")="Enter 'B' to edit both sets of fields or '^' to quit.",DIR("A")="Select fields to edit" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 D MSG Q
"RTN","PSDEVO1",9,0)
 S FIELD=Y
"RTN","PSDEVO1",10,0)
UPDATE ;
"RTN","PSDEVO1",11,0)
 I FIELD="M" D NOW^%DTC S PSDT=+%,NQTY=QTY,AQTY=0,BAL=+$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4) G DIE
"RTN","PSDEVO1",12,0)
NQ K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,50O",DIR("A")="NEW QUANTITY DISPENSED ("_NBKU_"/"_NPKG_")"
"RTN","PSDEVO1",13,0)
 S DIR("?",1)="Enter new quantity being dispensed or",DIR("?")="or '^' to quit" D ^DIR K DIR
"RTN","PSDEVO1",14,0)
 I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 D MSG Q
"RTN","PSDEVO1",15,0)
 S NQTY=+Y I +Y=0 W !!,"Sorry.  You've selected ZERO as the new dispensing balance.",!,"If the new balance is ZERO, please CANCEL this order." S PSDOUT=1 D MSG Q
"RTN","PSDEVO1",16,0)
 W !!,"Old Dispensed Quantity: ",QTY,"     New Dispensed Quantity: ",NQTY,! S AQTY=QTY-NQTY
"RTN","PSDEVO1",17,0)
 I ($P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4)+AQTY)<0 W !!,"This transaction cannot be processed.",!,"Your vault balance is ",$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4),"." D MSG Q
"RTN","PSDEVO1",18,0)
 K DA,DIR,DIRUT S DIR(0)="YOA",DIR("?",1)="Answer 'YES' to edit this order and adjust",DIR("?")="your vault balance, answer 'NO' or '^' to quit."
"RTN","PSDEVO1",19,0)
 S DIR("A")="Are you sure? ",DIR("B")="NO"
"RTN","PSDEVO1",20,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG Q
"RTN","PSDEVO1",21,0)
 W !!,"Accessing your transaction information..."
"RTN","PSDEVO1",22,0)
 F  L +^PSD(58.8,+PSDS,1,+PSDR,0):0 I  Q
"RTN","PSDEVO1",23,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDEVO1",24,0)
 S BAL=+$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+AQTY
"RTN","PSDEVO1",25,0)
 L -^PSD(58.8,+PSDS,1,+PSDR,0)
"RTN","PSDEVO1",26,0)
 W !!,"Old Balance: ",BAL,?35,"New Balance: ",BAL+AQTY,!!
"RTN","PSDEVO1",27,0)
DIE W !,"Updating transaction history..."
"RTN","PSDEVO1",28,0)
 ;K DA,DIE,DR S DA=+PSDA,DIE=58.81,DR="48////"_PSDT_";49////"_PSDUZ_";50///"_NQTY_";51///"_AQTY_";54///"_BAL_";53;I FIELD=""Q"" S Y=""@1"";52////1;12;13;14;@1"
"RTN","PSDEVO1",29,0)
 K DA,DIE,DR S DA=+PSDA,DIE=58.81,DR="53;I FIELD=""Q"" S Y=48;52////1;12;13;14;48////"_PSDT_";49////"_PSDUZ_";50////"_NQTY_";51////"_AQTY_";54////"_BAL
"RTN","PSDEVO1",30,0)
 D ^DIE K DA,DIE,DR I $D(Y) S PSDOUT=1 D MSG Q
"RTN","PSDEVO1",31,0)
 S MFG=$P($G(^PSD(58.81,PSDA,0)),"^",13),LOT=$P($G(^(0)),"^",14),EXP=$P($G(^(0)),"^",15)
"RTN","PSDEVO1",32,0)
 W !,"Updating Order..."
"RTN","PSDEVO1",33,0)
ORDER K DA,DIE,DR S DA(1)=PSDR,DA(2)=NAOU,DA=ORD,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,"
"RTN","PSDEVO1",34,0)
 S DR="7///"_MFG_";8///"_LOT_";9///"_EXP_";19////"_NQTY D ^DIE K DA,DIE,DR
"RTN","PSDEVO1",35,0)
 I +$O(^PSD(58.85,"AC",3,NAOU,PSDR,ORD,0)) S WK=+$O(^PSD(58.85,"AC",3,NAOU,PSDR,ORD,0)) I $D(^PSD(58.85,WK,0)) S $P(^(0),"^",17)=NQTY
"RTN","PSDEVO1",36,0)
 W "done."
"RTN","PSDEVO1",37,0)
REPRT ;
"RTN","PSDEVO1",38,0)
 I $D(^PSD(58.81,PSDA,"CS")),+$P(^("CS"),"^",3) W !!,"The VA FORM 10-2321 has been previously printed for this order.",!,"Please use the 'Reprint VA FORM 10-2321' .",!!
"RTN","PSDEVO1",39,0)
 Q
"RTN","PSDEVO1",40,0)
MSG W !!,"** No action taken. **",!!
"RTN","PSDEVO1",41,0)
 Q
"RTN","PSDEVOR")
0^69^B22501006
"RTN","PSDEVOR",1,0)
PSDEVOR ;BIR/JPW-Print Edit/Canc Ver Orders Report ; 29 Aug 94
"RTN","PSDEVOR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEVOR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEVOR",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Contact your Pharmacy Coordinator for access to print the Edit Verified",!,"Orders data.  PSJ RPHARM security key required.",!! Q
"RTN","PSDEVOR",5,0)
ASKD ;ask disp location
"RTN","PSDEVOR",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDEVOR",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDEVOR",8,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDEVOR",9,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDEVOR",10,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDEVOR",11,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDEVOR",12,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDEVOR",13,0)
DATE W ! K %DT S %DT="AEX",%DT("A")="Start with Date: " D ^%DT I Y<0 G END
"RTN","PSDEVOR",14,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 G END
"RTN","PSDEVOR",15,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDEVOR",16,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDEVOR",17,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDEVOR",18,0)
DEV ;sel device
"RTN","PSDEVOR",19,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDEVOR",20,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !!,"NO DEVICE SELECTED OR REPORT PRINTED!!",! G END
"RTN","PSDEVOR",21,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDEVOR",ZTDESC="CS PHARM Edit/Canc Ver Ord" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDEVOR",22,0)
 U IO
"RTN","PSDEVOR",23,0)
START ;entry for compile
"RTN","PSDEVOR",24,0)
 K ^TMP("PSDEVOR",$J) S PSD1=12.99,PSD2=14.99
"RTN","PSDEVOR",25,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD!(PSD>PSDED)  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR)) Q:'PSDR  D
"RTN","PSDEVOR",26,0)
 .F PSDTYP=PSD1:0 S PSDTYP=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR,PSDTYP)) Q:'PSDTYP!(PSDTYP>PSD2)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR,PSDTYP,PSDA)) Q:'PSDA  D
"RTN","PSDEVOR",27,0)
 ..Q:'$D(^PSD(58.81,PSDA,0))  S NODE=^(0),PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN"),QTY=$P(NODE,"^",6)
"RTN","PSDEVOR",28,0)
 ..S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR_" NAME MISSING")
"RTN","PSDEVOR",29,0)
 ..I $D(^PSD(58.81,PSDA,4)),PSDTYP=14 S NQTY=$P(^(4),"^",3),MFG=+$P(^(4),"^",5),PHARM=$P(^(4),"^",2),PHARM=$P($G(^VA(200,+PHARM,0)),"^"),PHARM=$P(PHARM,",")_","_$E($P(PHARM,",",2)),ACT="EDIT"
"RTN","PSDEVOR",30,0)
 ..I $D(^PSD(58.81,PSDA,5)),PSDTYP=13 S PHARM=$P(^(5),"^",2),PHARM=$P($G(^VA(200,+PHARM,0)),"^"),PHARM=$P(PHARM,",")_","_$E($P(PHARM,",",2)),NQTY=0,MFG=0,ACT="CANC"
"RTN","PSDEVOR",31,0)
 ..S ^TMP("PSDEVOR",$J,PSD,PSDPN,PSDTYP)=PSDRN_"^"_ACT_"^"_PHARM_"^"_QTY_"^"_NQTY_"^"_MFG
"RTN","PSDEVOR",32,0)
PRINT ;prints data
"RTN","PSDEVOR",33,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="" D HDR
"RTN","PSDEVOR",34,0)
 I '$D(^TMP("PSDEVOR",$J)) W !!,?15,"**** NO VERIFIED ORDERS EDITED OR CANCELLED ****",!! G DONE
"RTN","PSDEVOR",35,0)
 F PSD=0:0 S PSD=$O(^TMP("PSDEVOR",$J,PSD)) Q:'PSD!(PSDOUT)  S NUM="" F  S NUM=$O(^TMP("PSDEVOR",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  F TYPE=0:0 S TYPE=$O(^TMP("PSDEVOR",$J,PSD,NUM,TYPE)) Q:'TYPE!(PSDOUT)  D
"RTN","PSDEVOR",36,0)
 .S DATE=$E(PSD,4,5)_"/"_$E(PSD,6,7)_"/"_$E(PSD,2,3),NODE=^TMP("PSDEVOR",$J,PSD,NUM,TYPE)
"RTN","PSDEVOR",37,0)
 .S MFG=$P(NODE,"^",6)
"RTN","PSDEVOR",38,0)
 .D:$Y+4>IOSL HDR Q:PSDOUT
"RTN","PSDEVOR",39,0)
 .W !,NUM,?10,$P(NODE,"^"),?53,$P(NODE,"^",2),?60,DATE,?70,$P(NODE,"^",4),?78,$P(NODE,"^",5),?90,$S(MFG:"FIELDS EDITED",1:"NOT EDITED"),?110,$P(NODE,"^",3)
"RTN","PSDEVOR",40,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEVOR",41,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEVOR",42,0)
END ;
"RTN","PSDEVOR",43,0)
 K %,%DT,%H,%I,%ZIS,ACT,C,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,MFG,NODE,NQTY,NUM
"RTN","PSDEVOR",44,0)
 K PG,PHARM,POP,PSD,PSD1,PSD2,PSDA,PSDATE,PSDED,PSDEV,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDTYP,QTY,TYPE,X,Y
"RTN","PSDEVOR",45,0)
 K ^TMP("PSDEVOR",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEVOR",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEVOR",47,0)
 Q
"RTN","PSDEVOR",48,0)
SAVE S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDEVOR",49,0)
 S (ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"))=""
"RTN","PSDEVOR",50,0)
 Q
"RTN","PSDEVOR",51,0)
HDR ;header
"RTN","PSDEVOR",52,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEVOR",53,0)
 S PG=PG+1 W:$Y @IOF W !,?20,"Edited or Verified Orders for ",PSDSN,?115,"Page: ",PG,!,?20,"Date: ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDEVOR",54,0)
 W ?70,"ORIG",?78,"NEW",!
"RTN","PSDEVOR",55,0)
 W "DISP #",?10,"DRUG",?52,"ACTION",?62,"DATE",?70,"QTY",?78,"QTY",?86,"MFG/LOT #/EXP.DATE",?110,"PHARMACIST",!,LN,!!
"RTN","PSDEVOR",56,0)
 Q
"RTN","PSDEXGS")
0^70^B20092409
"RTN","PSDEXGS",1,0)
PSDEXGS ;BIR/JPW-Enter Existing Green Sheets at Startup ; 8 Aug 94
"RTN","PSDEXGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEXGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEXGS",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Contact your Pharmacy Coordinator for access to enter existing Green Sheets",!,"into the Controlled Substances package.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDEXGS",5,0)
 S PSDUZ=DUZ
"RTN","PSDEXGS",6,0)
 W !!,?5,"The Order Status of all Green Sheets entered as existing before",!,?5,"the Controlled Substances package initialization will be",!,?10,"  *** DELIVERED - ACTIVELY ON NAOU ***",!!
"RTN","PSDEXGS",7,0)
ASKD ;ask disp site
"RTN","PSDEXGS",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDEXGS",9,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDEXGS",10,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDEXGS",11,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDEXGS",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDEXGS",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDEXGS",14,0)
CHKD I '$D(^PSD(58.8,+PSDS,0)) W !!,"The ",PSDSN," vault is missing data.",!! G END
"RTN","PSDEXGS",15,0)
NAOU ;select NAOU 
"RTN","PSDEXGS",16,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDEXGS",17,0)
 S DIC("S")="I $P(^(0),""^"",4)=+PSDS,$P(^(0),""^"",2)=""N"""
"RTN","PSDEXGS",18,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDEXGS",19,0)
 I '$D(^PSD(58.8,NAOU,0)) W !!,"This NAOU is missing data.",!! G END
"RTN","PSDEXGS",20,0)
DRUG ;ask drug
"RTN","PSDEXGS",21,0)
 I '$O(^PSD(58.8,NAOU,1,0)) W !!,"There are no stocked drugs for this NAOU.",!! G END
"RTN","PSDEXGS",22,0)
 W !!,?15,"=> NAOU: ",NAOUN,!
"RTN","PSDEXGS",23,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDEXGS",24,0)
 S DIC("S")="I $S('$P(^(0),""^"",14):1,+$P(^(0),""^"",14)>DT:1,1:0)"
"RTN","PSDEXGS",25,0)
 S DA(1)=+NAOU,DIC(0)="QEAM",DIC="^PSD(58.8,"_+NAOU_",1," D ^DIC K DIC G:Y<0 END S PSDRG=+Y,PSDRGN=$S($P($G(^PSDRUG(PSDRG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDEXGS",26,0)
 I '$D(^PSD(58.8,NAOU,1,PSDRG,0)) W !!,PSDRGN," is missing",!,"data in ",NAOUN G END
"RTN","PSDEXGS",27,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDRG,0)) W !!,PSDRGN," is not stocked",!,"in ",PSDSN,!! G END
"RTN","PSDEXGS",28,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDRG,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDEXGS",29,0)
 I 'NPKG!(NBKU']"") W $C(7),!!,PSDRGN," is missing breakdown unit or",!,"package size in ",PSDSN,".",! G END
"RTN","PSDEXGS",30,0)
GS W !!,"Enter Green Sheet #: " R X:DTIME I '$T!(X="")!(X["^") W !!,"** No action taken. **" G END
"RTN","PSDEXGS",31,0)
 I X'?1.9N D MSG1 G GS
"RTN","PSDEXGS",32,0)
 I 'X D MSG1 G GS
"RTN","PSDEXGS",33,0)
 I +$O(^PSD(58.81,"D",X,0)) W !!,"This number has already been used.",!! G GS
"RTN","PSDEXGS",34,0)
 S PSDPN=X K X
"RTN","PSDEXGS",35,0)
QTY W !!,"Enter Quantity ("_NBKU_"/"_NPKG_"): " R X:DTIME I '$T!(X="")!(X["^") D MSG G END
"RTN","PSDEXGS",36,0)
 I X'?1.6N D MSG2 G QTY
"RTN","PSDEXGS",37,0)
 I 'X D MSG2 G QTY
"RTN","PSDEXGS",38,0)
 S QTY=X K X
"RTN","PSDEXGS",39,0)
PHARM K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,18O" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",40,0)
 S PHARM=$P(Y,"^")
"RTN","PSDEXGS",41,0)
RDATE K DA,DIR,DTOUT,DUOUT S DIR("A")="DISPENSED DATE: ",DIR(0)="58.81,19OA" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",42,0)
 S RDATE=$P(Y,"^")
"RTN","PSDEXGS",43,0)
NURSE K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,20O" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",44,0)
 S NURS=$P(Y,"^")
"RTN","PSDEXGS",45,0)
MFG K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,12O" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",46,0)
 S MFG=Y
"RTN","PSDEXGS",47,0)
LOT K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,13O" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",48,0)
 S LOT=Y
"RTN","PSDEXGS",49,0)
EXP K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,14O" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDEXGS",50,0)
 S EXP=Y
"RTN","PSDEXGS",51,0)
OK W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK"
"RTN","PSDEXGS",52,0)
 S DIR("?",1)="Answer 'YES' to post this Green Sheet information,",DIR("?")="answer 'NO' to erase this information and try again."
"RTN","PSDEXGS",53,0)
 D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDEXGS",54,0)
 I 'Y G QTY
"RTN","PSDEXGS",55,0)
 D ^PSDEXGS1 G DRUG
"RTN","PSDEXGS",56,0)
END K %,%DT,%H,%I,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EXP,LOT,MFG
"RTN","PSDEXGS",57,0)
 K NAOU,NAOUN,NBKU,NPKG,NURS,PHARM,PSDA,PSDPN,PSDRG,PSDRGN,PSDRN,PSDS,PSDSN,PSDT,PSDUZ,RDATE,QTY,X,Y
"RTN","PSDEXGS",58,0)
 Q
"RTN","PSDEXGS",59,0)
MSG W !!,"No action taken.  The Green Sheet # ",PSDPN," has not been added to your CS files.",!
"RTN","PSDEXGS",60,0)
 Q
"RTN","PSDEXGS",61,0)
MSG1 W !!,"You must enter a whole number between 1 and 999999999",!
"RTN","PSDEXGS",62,0)
 Q
"RTN","PSDEXGS",63,0)
MSG2 W !!,"You must enter a whole number between 1 and 999999",!
"RTN","PSDEXGS",64,0)
 Q
"RTN","PSDEXGS1")
0^71^B7890355
"RTN","PSDEXGS1",1,0)
PSDEXGS1 ;BIR/JPW-Enter Existing GS (cont'd) ; 22 Jun 93
"RTN","PSDEXGS1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEXGS1",3,0)
EN ;create order,transaction
"RTN","PSDEXGS1",4,0)
 W !!,"Creating entries in the CS files..."
"RTN","PSDEXGS1",5,0)
DIE ;create the order request
"RTN","PSDEXGS1",6,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDRG,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDEXGS1",7,0)
 S PSDRN=$P(^PSD(58.8,NAOU,1,PSDRG,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDRG,3,PSDRN)) S $P(^PSD(58.8,NAOU,1,PSDRG,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDRG,3,0),"^",3)+1 G DIE
"RTN","PSDEXGS1",8,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDRG_",3,",DA(2)=NAOU,DA(1)=PSDRG,(X,DINUM)=PSDRN D FILE^DICN K DIC
"RTN","PSDEXGS1",9,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W "processing now..."
"RTN","PSDEXGS1",10,0)
 S DA=PSDRN,DA(1)=PSDRG,DA(2)=NAOU
"RTN","PSDEXGS1",11,0)
 S DR="2////"_+PSDS_";4////"_PHARM_";5///"_QTY_";6////"_NURS_";7///"_MFG_";8///"_LOT_";9///"_EXP_";14///"_RDATE_";16///"_PSDPN_";19///"_QTY_";20///"_QTY_";10////4" D ^DIE K DIE,DR
"RTN","PSDEXGS1",12,0)
 W "transaction history..."
"RTN","PSDEXGS1",13,0)
ADD ;find entry number
"RTN","PSDEXGS1",14,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDEXGS1",15,0)
FIND S PSDA=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDA)) S $P(^PSD(58.81,0),"^",3)=PSDA G FIND
"RTN","PSDEXGS1",16,0)
 K DA,DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDA D ^DIC K DIC,DLAYGO
"RTN","PSDEXGS1",17,0)
 L -^PSD(58.81,0)
"RTN","PSDEXGS1",18,0)
TRANS ;add trans fields
"RTN","PSDEXGS1",19,0)
 W !!,"Still updating..."
"RTN","PSDEXGS1",20,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81
"RTN","PSDEXGS1",21,0)
 S DR="1////12;2////"_+PSDS_";4////"_PSDRG_";3///"_PSDT_";Q;5////"_QTY_";12///"_MFG_";13///"_LOT_";14///"_EXP_";16///"_PSDPN_";17////"_NAOU_";18////"_PHARM_";20////"_NURS_";19///"_RDATE_";27////"_QTY_";40////"_PSDRN_";10////4;100////1"
"RTN","PSDEXGS1",22,0)
 D ^DIE K DA,DIE,DR W "vault activity..."
"RTN","PSDEXGS1",23,0)
VAULT ;
"RTN","PSDEXGS1",24,0)
 S:'$D(^PSD(58.8,+PSDS,1,PSDRG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDEXGS1",25,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDRG,4,PSDA,0)) K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+PSDS_",1,"_PSDRG_",4,",DA(2)=+PSDS,DA(1)=PSDRG,(X,DINUM)=PSDA D FILE^DICN K DA,DIC
"RTN","PSDEXGS1",26,0)
 W "done.",!!
"RTN","PSDEXGS1",27,0)
 S $P(^PSD(58.8,NAOU,1,PSDRG,3,PSDRN,0),"^",17)=PSDA
"RTN","PSDEXGS1",28,0)
 W !!,"Press <RET> to continue" R X:DTIME W @IOF
"RTN","PSDEXGS1",29,0)
 Q
"RTN","PSDEXP")
0^72^B22025227
"RTN","PSDEXP",1,0)
PSDEXP ;BIR/JPW-CS Drug Expiration Date Report ; 6 July 94
"RTN","PSDEXP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEXP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDEXP",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDEXP",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"CS reports.  PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDEXP",6,0)
 W !!,"Controlled Substances Expiration Date Report",!!
"RTN","PSDEXP",7,0)
DATE ;ask date range
"RTN","PSDEXP",8,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDEXP",9,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDEXP",10,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDEXP",11,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=$E(PSDSD,1,5)_"00"-.1,PSDED=$E(PSDED,1,5)_"31"+.9999
"RTN","PSDEXP",12,0)
ASKN ;ask NAOU(s)
"RTN","PSDEXP",13,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!
"RTN","PSDEXP",14,0)
 D NOW^%DTC S PSDT=X K DA,DIC
"RTN","PSDEXP",15,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDEXP",16,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDEXP",17,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="P",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDEXP",18,0)
 F JJ="" F CNT=0:1 S JJ=$O(NAOU(JJ)) Q:'JJ
"RTN","PSDEXP",19,0)
 I CNT=1 S ANS="D" G DEV
"RTN","PSDEXP",20,0)
SORT ;asks sort
"RTN","PSDEXP",21,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DATE/DRUG/NAOU;N:DATE/NAOU/DRUG",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDEXP",22,0)
 S DIR("?",1)="Enter 'D' if you wish to print the Expiration date list sorted by DATE",DIR("?",2)="  and within DATE by DRUG then NAOU."
"RTN","PSDEXP",23,0)
 S DIR("?")="Enter 'N' to print by DATE and within DATE by NAOU then DRUG."
"RTN","PSDEXP",24,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDEXP",25,0)
DEV ;dev & queue info
"RTN","PSDEXP",26,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDEXP",27,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDEXP",28,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S PSDIO=ION,ZTIO="",ZTRTN="START^PSDEXP",ZTDESC="CS Drug Expiration Date Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDEXP",29,0)
 U IO
"RTN","PSDEXP",30,0)
START ;compile data
"RTN","PSDEXP",31,0)
 K ^TMP("PSDEXP",$J) S PSDOUT=0
"RTN","PSDEXP",32,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.8,"AEXP",PSD)) Q:'PSD!(PSD>PSDED)  F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AEXP",PSD,DRUG)) Q:'DRUG  F NAOU=0:0 S NAOU=$O(^PSD(58.8,"AEXP",PSD,DRUG,NAOU)) Q:'NAOU  I $D(NAOU(NAOU)) D SET
"RTN","PSDEXP",33,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.8,"AEXPO",PSD)) Q:'PSD!(PSD>PSDED)  F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AEXPO",PSD,DRUG)) Q:'DRUG  F NAOU=0:0 S NAOU=$O(^PSD(58.8,"AEXPO",PSD,DRUG,NAOU)) Q:'NAOU  I $D(NAOU(NAOU)) D
"RTN","PSDEXP",34,0)
 .F ORD=0:0 S ORD=$O(^PSD(58.8,"AEXPO",PSD,DRUG,NAOU,ORD)) Q:'ORD  D SET
"RTN","PSDEXP",35,0)
 G:'$D(ZTQUEUED) PRINT^PSDEXP1
"RTN","PSDEXP",36,0)
PRTQUE ;que print after compile
"RTN","PSDEXP",37,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="Print CS Drug Expiration Date Report",ZTRTN="PRINT^PSDEXP1",ZTDTH=$H
"RTN","PSDEXP",38,0)
 S ZTSAVE("^TMP(""PSDEXP"",$J,")="",ZTSAVE("PSDATE")="",ZTSAVE("CNT")="",ZTSAVE("ANS")=""
"RTN","PSDEXP",39,0)
 D ^%ZTLOAD K ^TMP("PSDEXP",$J)
"RTN","PSDEXP",40,0)
END ;
"RTN","PSDEXP",41,0)
 K %,%DT,%H,%I,%ZIS,ANS,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,JJ,LN,NAOU,NAOUN,NODE,OK,ORD
"RTN","PSDEXP",42,0)
 K PG,POP,PSD,PSDT,PSDATE,PSDED,PSDIO,PSDOUT,PSDPN,PSDSD,RPDT,TYPE,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEXP",43,0)
 K ^TMP("PSDEXP",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEXP",44,0)
 Q
"RTN","PSDEXP",45,0)
SAVE S (ZTSAVE("PSDSITE"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDIO"),ZTSAVE("ANS"),ZTSAVE("CNT"))=""
"RTN","PSDEXP",46,0)
 S:$D(NAOU) ZTSAVE("NAOU(")=""
"RTN","PSDEXP",47,0)
 Q
"RTN","PSDEXP",48,0)
SET ;set data for printing
"RTN","PSDEXP",49,0)
 S PSDPN="N/A"
"RTN","PSDEXP",50,0)
 S DRUGN=$S($D(^PSDRUG(DRUG,0)):$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDEXP",51,0)
 S NAOUN=$S($D(^PSD(58.8,NAOU,0)):$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDEXP",52,0)
 S TYPE=$P($G(^PSD(58.8,NAOU,0)),"^",2) I TYPE'="N"!(TYPE="N"&'$D(ORD)) D TMP Q
"RTN","PSDEXP",53,0)
 Q:'$D(^PSD(58.8,NAOU,1,DRUG,3,ORD,0))  S NODE=^(0)
"RTN","PSDEXP",54,0)
 Q:+$P(NODE,"^",11)'=4&(+$P(NODE,U,11)'=13)  S PSDPN=$S($P(NODE,"^",16)]"":$P(NODE,"^",16),1:"N/A") D TMP
"RTN","PSDEXP",55,0)
 Q
"RTN","PSDEXP",56,0)
TMP ;set ^TMP
"RTN","PSDEXP",57,0)
 I ANS="D"!(CNT<2) S ^TMP("PSDEXP",$J,PSD,DRUGN,NAOUN,PSDPN)="" Q
"RTN","PSDEXP",58,0)
 S:ANS="N" ^TMP("PSDEXP",$J,PSD,NAOUN,DRUGN,PSDPN)=""
"RTN","PSDEXP",59,0)
 Q
"RTN","PSDEXP1")
0^73^B6286088
"RTN","PSDEXP1",1,0)
PSDEXP1 ;BIR/JPW-CS Drug Expiration Date Report (cont'd) ; 2 Aug 94
"RTN","PSDEXP1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDEXP1",3,0)
 U IO
"RTN","PSDEXP1",4,0)
PRINT ;print cs exp date report
"RTN","PSDEXP1",5,0)
 S (PG,PSDOUT)=0
"RTN","PSDEXP1",6,0)
 K LN S $P(LN,"-",80)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDEXP1",7,0)
 D HDR
"RTN","PSDEXP1",8,0)
 I '$D(^TMP("PSDEXP",$J)) W !!,?15,"****  NO DRUG EXPIRATION DATA FOR THIS REPORT  ****" G END
"RTN","PSDEXP1",9,0)
 F PSD=0:0 S PSD=$O(^TMP("PSDEXP",$J,PSD)) Q:'PSD!(PSDOUT)  D:$Y+5>IOSL HDR Q:PSDOUT  S Y=PSD X ^DD("DD") W !!,"=> ",Y D
"RTN","PSDEXP1",10,0)
 .S PSD1="" F  S PSD1=$O(^TMP("PSDEXP",$J,PSD,PSD1)) Q:PSD1=""!(PSDOUT)  D:$Y+5>IOSL HDR Q:PSDOUT  W !,?12,PSD1 D
"RTN","PSDEXP1",11,0)
 ..S PSD2="" F  S PSD2=$O(^TMP("PSDEXP",$J,PSD,PSD1,PSD2)) Q:PSD2=""!(PSDOUT)  S PSD3="" F  S PSD3=$O(^TMP("PSDEXP",$J,PSD,PSD1,PSD2,PSD3)) Q:PSD3=""!(PSDOUT)  D:$Y+5>IOSL HDR Q:PSDOUT  W !,?14,$S(PSD3'="N/A":PSD3,1:""),?25,PSD2
"RTN","PSDEXP1",12,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDEXP1",13,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDEXP1",14,0)
END ;
"RTN","PSDEXP1",15,0)
 K %,%DT,%H,%I,%ZIS,ANS,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,JJ,LN,NAOU,NAOUN,NODE,OK,ORD
"RTN","PSDEXP1",16,0)
 K PG,POP,PSD,PSDT,PSD1,PSD2,PSD3,PSDATE,PSDED,PSDIO,PSDOUT,PSDSD,RPDT,TYPE,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDEXP1",17,0)
 K ^TMP("PSDEXP",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDEXP1",18,0)
 Q
"RTN","PSDEXP1",19,0)
HDR ;header for log
"RTN","PSDEXP1",20,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDEXP1",21,0)
 S PG=PG+1 W:$Y @IOF W !,?27,"CS DRUG EXPIRATION DATE REPORT",?70,"Page: ",PG
"RTN","PSDEXP1",22,0)
 W !,?22,"FOR PERIOD ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)
"RTN","PSDEXP1",23,0)
 W !,?27,"PRINTED ",RPDT,!!,"=> DATE",!,?12
"RTN","PSDEXP1",24,0)
 I ANS="D" W "DRUG",!,?14,"DISP #",?25,"NAOU",!,LN Q
"RTN","PSDEXP1",25,0)
 W "NAOU",!,?14,"DISP #",?25,"ITEM",!,LN
"RTN","PSDEXP1",26,0)
 Q
"RTN","PSDFIL2")
0^74^B22803738
"RTN","PSDFIL2",1,0)
PSDFIL2 ;BIR/JPW-File TRAKKER Info - Vault Inv Adj ; 5 Oct 94
"RTN","PSDFIL2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFIL2",3,0)
EN1 ;entry for filing vault inventory adjustments trakker info
"RTN","PSDFIL2",4,0)
 K CNT,DA,DATA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,PSDS,PSDSN,X,X1,Y
"RTN","PSDFIL2",5,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDFIL2",6,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):1,1:0)
"RTN","PSDFIL2",7,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"upload this data to the trakker.",!!,"PSDMGR or PSJ RPHARM security key required.",! K OK Q
"RTN","PSDFIL2",8,0)
LOOP ;loop thru ^tmp
"RTN","PSDFIL2",9,0)
 K CNT S CNT=1
"RTN","PSDFIL2",10,0)
 W !!,"Updating DHCP now..."
"RTN","PSDFIL2",11,0)
 F PSD=0:0 S PSD=$O(^TMP("PSDWN2",$J,PSD)) Q:'PSD  S NODE=^TMP("PSDWN2",$J,PSD,0) D
"RTN","PSDFIL2",12,0)
 .I $L(NODE)<32,NODE'["*" S PHARM=$P(NODE,"^") S:$E(PHARM)="P" PHARM=$P(PHARM,"P",2) S PHARM=$P(PHARM,"-")_$P(PHARM,"-",2)_$P(PHARM,"-",3) D  Q
"RTN","PSDFIL2",13,0)
 ..S PHARM=$S(PHARM]"":+$O(^VA(200,"SSN",PHARM,0)),1:"")
"RTN","PSDFIL2",14,0)
 ..S PSDTS=$P(NODE,"^",2),PSDTS=+2_+$E(PSDTS,2,3)_$E(PSDTS,5,6)_$E(PSDTS,8,9)_"."_$E(PSDTS,11,12)_$E(PSDTS,14,15)_$E(PSDTS,17,18),PSDTS=+PSDTS
"RTN","PSDFIL2",15,0)
 .I $L(NODE)<32,NODE["*" S PSDS=+$P(NODE,"*",2),PSDSN=$S($P($G(^PSD(58.8,PSDS,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN") Q
"RTN","PSDFIL2",16,0)
 .S PHARM1=$P(NODE,"^"),PSDRN=$P(NODE,"^",3),OQTY=+$P(NODE,"^",4),QTY=+$P(NODE,"^",6),PHARM2=$P(NODE,"^",7)
"RTN","PSDFIL2",17,0)
 .S CQTY=+$P(NODE,"^",8),PSDTA=$P(NODE,"^",12)
"RTN","PSDFIL2",18,0)
 .S:$E(PHARM1)="P" PHARM1=$P(PHARM1,"P",2) S PHARM1=$P(PHARM1,"-")_$P(PHARM1,"-",2)_$P(PHARM1,"-",3),PHARM1=$S(PHARM1]"":+$O(^VA(200,"SSN",PHARM1,0)),1:"")
"RTN","PSDFIL2",19,0)
 .I PHARM2]"" S:$E(PHARM2)="P" PHARM2=$P(PHARM2,"P",2) S PHARM2=$P(PHARM2,"-")_$P(PHARM2,"-",2)_$P(PHARM2,"-",3),PHARM2=$S(PHARM2]"":+$O(^VA(200,"SSN",PHARM2,0)),1:"")
"RTN","PSDFIL2",20,0)
 .S PSDR=+$P(NODE,"^",2)
"RTN","PSDFIL2",21,0)
 .S PSDTA=+2_$E(PSDTA,2,3)_$E(PSDTA,5,6)_$E(PSDTA,8,9)_"."_$E(PSDTA,11,12)_$E(PSDTA,14,15)_$E(PSDTA,17,18),PSDTA=+PSDTA
"RTN","PSDFIL2",22,0)
 .S PSDTYP=$S('CQTY:20,1:9)
"RTN","PSDFIL2",23,0)
 .;I PSDTYP=9,CQTY=OQTY Q
"RTN","PSDFIL2",24,0)
 .I '$D(^TMP("PSDOK2",$J,19,+PSDR)) S ^TMP("PSDOK2",$J,19,+PSDR,+PSDTS,1)=19_"^"_PHARM_"^^^"
"RTN","PSDFIL2",25,0)
 .S ^TMP("PSDOK2",$J,+PSDTYP,+PSDR,+PSDTA,CNT)=PSDTYP_"^"_PHARM1_"^"_PHARM2_"^"_OQTY_"^"_CQTY
"RTN","PSDFIL2",26,0)
 .S CNT=CNT+1
"RTN","PSDFIL2",27,0)
 I '$G(PSDS) W !!,"No Vault identified",!! G END
"RTN","PSDFIL2",28,0)
FIL ;file data
"RTN","PSDFIL2",29,0)
 S PSD="" F PSD=19,9,20 D
"RTN","PSDFIL2",30,0)
 .S PSDR="" F  S PSDR=$O(^TMP("PSDOK2",$J,PSD,PSDR)) Q:PSDR=""  S PSDTA="" F  S PSDTA=$O(^TMP("PSDOK2",$J,PSD,PSDR,PSDTA)) Q:PSDTA=""  S CNT="" F  S CNT=$O(^TMP("PSDOK2",$J,PSD,PSDR,PSDTA,CNT)) Q:CNT=""  D
"RTN","PSDFIL2",31,0)
 ..S NODE=^TMP("PSDOK2",$J,PSD,+PSDR,+PSDTA,CNT),PSDTYP=+$P(NODE,"^"),PHARM1=$P(NODE,"^",2),PHARM2=$P(NODE,"^",3),OQTY=$P(NODE,"^",4),CQTY=$P(NODE,"^",5),QTY=$S(PSDTYP=9:CQTY-OQTY,1:0)
"RTN","PSDFIL2",32,0)
 ..S PHARMN1=$S($P($G(^VA(200,+PHARM1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDFIL2",33,0)
 ..D UPDATE
"RTN","PSDFIL2",34,0)
 W "done.",!
"RTN","PSDFIL2",35,0)
END ;kill variables
"RTN","PSDFIL2",36,0)
 K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,NAOU,NODE,OK,OQTY
"RTN","PSDFIL2",37,0)
 K PHARM,PHARM1,PHARM2,PHARMN1,PAT,PSD,PSDER,PSDR,PSDREC,PSDRN,PSDS,PSDSN,PSDT,PSDTA,PSDTS,PSDTYP,QTY,X,Y
"RTN","PSDFIL2",38,0)
 K ^TMP("PSDWN2",$J)
"RTN","PSDFIL2",39,0)
 K ^TMP("PSDOK2",$J)
"RTN","PSDFIL2",40,0)
 Q
"RTN","PSDFIL2",41,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDFIL2",42,0)
 ;vault balance
"RTN","PSDFIL2",43,0)
 F  L +^PSD(58.8,+PSDS,1,+PSDR,0):0 I  Q
"RTN","PSDFIL2",44,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDFIL2",45,0)
 S BAL=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+QTY
"RTN","PSDFIL2",46,0)
 L -^PSD(58.8,+PSDS,1,+PSDR,0)
"RTN","PSDFIL2",47,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDFIL2",48,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDFIL2",49,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDFIL2",50,0)
 L -^PSD(58.81,0)
"RTN","PSDFIL2",51,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDFIL2",52,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP_"^"_+PSDS_"^"_$S(PSDTYP=19:PSDTS,1:PSDT)_"^"_PSDR_"^"_QTY_"^"_$S(PSDTYP=9:PHARM1,1:PHARM)_"^^^"_BAL_"^^^^^^"_$S(PSDTYP=9:"TRAKKER ADJUSTMENT",1:"TRAKKER INVENTORY")
"RTN","PSDFIL2",53,0)
 S:PSDTYP=9 ^PSD(58.81,PSDREC,9)="^^"_$S(PSDTYP=19:BAL,1:OQTY)_"^^^^"_CQTY_"^"_PHARM1_"^"_PHARM2_"^"_PSDTA
"RTN","PSDFIL2",54,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDFIL2",55,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDFIL2",56,0)
 ;update vault
"RTN","PSDFIL2",57,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,4,0)) S ^(0)="^58.800119PA^^"
"RTN","PSDFIL2",58,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,4,+PSDREC,0)) K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+PSDS_",1,"_+PSDR_",4,",DA(2)=+PSDS,DA(1)=+PSDR,(X,DINUM)=PSDREC D FILE^DICN K DA,DIC
"RTN","PSDFIL2",59,0)
 I PSDTYP'=9 W "." Q
"RTN","PSDFIL2",60,0)
ERR ;err log update
"RTN","PSDFIL2",61,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDFIL2",62,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDFIL2",63,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDFIL2",64,0)
 L -^PSD(58.89,0)
"RTN","PSDFIL2",65,0)
EDIT9 ;edit error log
"RTN","PSDFIL2",66,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_+PSDS D ^DIE K DA,DIE,DR
"RTN","PSDFIL2",67,0)
 D ^PSDFILM
"RTN","PSDFIL2",68,0)
 W "."
"RTN","PSDFIL2",69,0)
 Q
"RTN","PSDFIL3")
0^75^B22562536
"RTN","PSDFIL3",1,0)
PSDFIL3 ;BIR/JPW-File TRAKKER Info - Insp Inv Adj ; 5 Oct 94
"RTN","PSDFIL3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFIL3",3,0)
EN1 ;entry for filing vault inventory adjustments trakker info
"RTN","PSDFIL3",4,0)
 K CNT,DA,DATA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,PSDS,PSDSN,X,X1,Y
"RTN","PSDFIL3",5,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDFIL3",6,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):1,1:0)
"RTN","PSDFIL3",7,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"upload this data to the trakker.",!!,"PSDMGR or PSJ RPHARM security key required.",! K OK Q
"RTN","PSDFIL3",8,0)
LOOP ;loop thru ^tmp
"RTN","PSDFIL3",9,0)
 K CNT S CNT=1
"RTN","PSDFIL3",10,0)
 W !!,"Updating DHCP now..."
"RTN","PSDFIL3",11,0)
 F PSD=0:0 S PSD=$O(^TMP("PSDWN3",$J,PSD)) Q:'PSD  S NODE=^TMP("PSDWN3",$J,PSD,0) D
"RTN","PSDFIL3",12,0)
 .I $L(NODE)<32,NODE'["*" S PHARM=$P(NODE,"^") S:$E(PHARM)="I" PHARM=$P(PHARM,"I",2) S PHARM=$P(PHARM,"-")_$P(PHARM,"-",2)_$P(PHARM,"-",3) D  Q
"RTN","PSDFIL3",13,0)
 ..S PHARM=$S(PHARM]"":+$O(^VA(200,"SSN",PHARM,0)),1:"")
"RTN","PSDFIL3",14,0)
 ..S PSDTS=$P(NODE,"^",2),PSDTS=+2_+$E(PSDTS,2,3)_$E(PSDTS,5,6)_$E(PSDTS,8,9)_"."_$E(PSDTS,11,12)_$E(PSDTS,14,15)_$E(PSDTS,17,18),PSDTS=+PSDTS
"RTN","PSDFIL3",15,0)
 .I $L(NODE)<32,NODE["*" S PSDS=+$P(NODE,"*",2),PSDSN=$S($P($G(^PSD(58.8,PSDS,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN") Q
"RTN","PSDFIL3",16,0)
 .S PHARM1=$P(NODE,"^"),PSDRN=$P(NODE,"^",3),OQTY=+$P(NODE,"^",4),QTY=+$P(NODE,"^",6),PHARM2=$P(NODE,"^",7)
"RTN","PSDFIL3",17,0)
 .S CQTY=+$P(NODE,"^",8),PSDTA=$P(NODE,"^",12)
"RTN","PSDFIL3",18,0)
 .S:$E(PHARM1)="I" PHARM1=$P(PHARM1,"I",2) S PHARM1=$P(PHARM1,"-")_$P(PHARM1,"-",2)_$P(PHARM1,"-",3),PHARM1=$S(PHARM1]"":+$O(^VA(200,"SSN",PHARM1,0)),1:"")
"RTN","PSDFIL3",19,0)
 .I PHARM2]"" S:$E(PHARM2)="P" PHARM2=$P(PHARM2,"P",2) S PHARM2=$P(PHARM2,"-")_$P(PHARM2,"-",2)_$P(PHARM2,"-",3),PHARM2=$S(PHARM2]"":+$O(^VA(200,"SSN",PHARM2,0)),1:"")
"RTN","PSDFIL3",20,0)
 .S PSDR=+$P(NODE,"^",2)
"RTN","PSDFIL3",21,0)
 .S PSDTA=+2_$E(PSDTA,2,3)_$E(PSDTA,5,6)_$E(PSDTA,8,9)_"."_$E(PSDTA,11,12)_$E(PSDTA,14,15)_$E(PSDTA,17,18),PSDTA=+PSDTA
"RTN","PSDFIL3",22,0)
 .S PSDTYP=$S('CQTY:22,1:9)
"RTN","PSDFIL3",23,0)
 .;I PSDTYP=9,CQTY=OQTY Q
"RTN","PSDFIL3",24,0)
 .I '$D(^TMP("PSDOK3",$J,21,+PSDR)) S ^TMP("PSDOK3",$J,21,+PSDR,+PSDTS,1)=21_"^"_PHARM_"^^^"
"RTN","PSDFIL3",25,0)
 .S ^TMP("PSDOK3",$J,+PSDTYP,+PSDR,+PSDTA,CNT)=PSDTYP_"^"_PHARM1_"^"_PHARM2_"^"_OQTY_"^"_CQTY
"RTN","PSDFIL3",26,0)
 .S CNT=CNT+1
"RTN","PSDFIL3",27,0)
FIL ;file data
"RTN","PSDFIL3",28,0)
 S PSD="" F PSD=21,9,22 D
"RTN","PSDFIL3",29,0)
 .S PSDR="" F  S PSDR=$O(^TMP("PSDOK3",$J,PSD,PSDR)) Q:PSDR=""  S PSDTA="" F  S PSDTA=$O(^TMP("PSDOK3",$J,PSD,PSDR,PSDTA)) Q:PSDTA=""  S CNT="" F  S CNT=$O(^TMP("PSDOK3",$J,PSD,PSDR,PSDTA,CNT)) Q:CNT=""  D
"RTN","PSDFIL3",30,0)
 ..S NODE=^TMP("PSDOK3",$J,PSD,+PSDR,+PSDTA,CNT),PSDTYP=+$P(NODE,"^"),PHARM1=$P(NODE,"^",2),PHARM2=$P(NODE,"^",3),OQTY=$P(NODE,"^",4),CQTY=$P(NODE,"^",5),QTY=$S(PSDTYP=9:CQTY-OQTY,1:0)
"RTN","PSDFIL3",31,0)
 ..S PHARMN1=$S($P($G(^VA(200,+PHARM1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDFIL3",32,0)
 ..D UPDATE
"RTN","PSDFIL3",33,0)
 W "done.",!
"RTN","PSDFIL3",34,0)
END ;kill variables
"RTN","PSDFIL3",35,0)
 K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,NAOU,NODE,OK,OQTY
"RTN","PSDFIL3",36,0)
 K PHARM,PHARM1,PHARM2,PHARMN1,PAT,PSD,PSDER,PSDR,PSDREC,PSDRN,PSDS,PSDSN,PSDT,PSDTA,PSDTS,PSDTYP,QTY,X,Y
"RTN","PSDFIL3",37,0)
 K ^TMP("PSDWN3",$J)
"RTN","PSDFIL3",38,0)
 K ^TMP("PSDOK3",$J)
"RTN","PSDFIL3",39,0)
 Q
"RTN","PSDFIL3",40,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDFIL3",41,0)
 ;vault balance
"RTN","PSDFIL3",42,0)
 F  L +^PSD(58.8,+PSDS,1,+PSDR,0):0 I  Q
"RTN","PSDFIL3",43,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDFIL3",44,0)
 S BAL=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+QTY
"RTN","PSDFIL3",45,0)
 L -^PSD(58.8,+PSDS,1,+PSDR,0)
"RTN","PSDFIL3",46,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDFIL3",47,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDFIL3",48,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDFIL3",49,0)
 L -^PSD(58.81,0)
"RTN","PSDFIL3",50,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDFIL3",51,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP_"^"_+PSDS_"^"_$S(PSDTYP=21:PSDTS,1:PSDT)_"^"_PSDR_"^"_QTY_"^"_$S(PSDTYP=9:PHARM1,1:PHARM)_"^^^"_BAL_"^^^^^^"_$S(PSDTYP=9:"TRAKKER ADJUSTMENT",1:"TRAKKER INVENTORY")
"RTN","PSDFIL3",52,0)
 S:PSDTYP=9 ^PSD(58.81,PSDREC,9)="^^"_$S(PSDTYP=21:BAL,1:OQTY)_"^^^^"_CQTY_"^^^"_"^"_PSDTA_"^"_PHARM1_"^"_PHARM2
"RTN","PSDFIL3",53,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDFIL3",54,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDFIL3",55,0)
 ;update vault
"RTN","PSDFIL3",56,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,4,0)) S ^(0)="^58.800119PA^^"
"RTN","PSDFIL3",57,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,4,+PSDREC,0)) K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+PSDS_",1,"_+PSDR_",4,",DA(2)=+PSDS,DA(1)=+PSDR,(X,DINUM)=PSDREC D FILE^DICN K DA,DIC
"RTN","PSDFIL3",58,0)
 I PSDTYP'=9 W "." Q
"RTN","PSDFIL3",59,0)
ERR ;err log update
"RTN","PSDFIL3",60,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDFIL3",61,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDFIL3",62,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDFIL3",63,0)
 L -^PSD(58.89,0)
"RTN","PSDFIL3",64,0)
EDIT9 ;edit error log
"RTN","PSDFIL3",65,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_+PSDS D ^DIE K DA,DIE,DR
"RTN","PSDFIL3",66,0)
 D ^PSDFILM
"RTN","PSDFIL3",67,0)
 W "."
"RTN","PSDFIL3",68,0)
 Q
"RTN","PSDFILM")
0^76^B3366310
"RTN","PSDFILM",1,0)
PSDFILM ;BIR/JPW-File/Adj TRAKKER Mail Msg ; 29 Aug 94
"RTN","PSDFILM",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFILM",3,0)
MSG ;send mailman message with trakker adj info
"RTN","PSDFILM",4,0)
 S PHARMN1=$S($P($G(^VA(200,+PHARM1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDFILM",5,0)
 K XMY,^TMP("PSDTAMSG",$J) S Y=PSDT X ^DD("DD") S RDT=Y S ^TMP("PSDTAMSG",$J,1,0)="CS PHARM TRAKKER adjustment/error has been filed."
"RTN","PSDFILM",6,0)
 S ^TMP("PSDTAMSG",$J,2,0)="Adjustment/Error Date/Time: "_RDT,^TMP("PSDTAMSG",$J,3,0)=""
"RTN","PSDFILM",7,0)
 S ^TMP("PSDTAMSG",$J,4,0)="Dispensing Site: "_$S($G(PSDSN)]"":PSDSN,1:"UNKNOWN"),^TMP("PSDTAMSG",$J,5,0)="Drug: "_PSDRN
"RTN","PSDFILM",8,0)
 S ^TMP("PSDTAMSG",$J,6,0)="Quantity Adjusted: "_QTY
"RTN","PSDFILM",9,0)
 S ^TMP("PSDTAMSG",$J,7,0)="Adjusted by: "_PHARMN1
"RTN","PSDFILM",10,0)
 S XMSUB="CS PHARM TRAKKER ADJUSTMENT",XMTEXT="^TMP(""PSDTAMSG"",$J,",XMDUZ="CONTROLLED SUBSTANCES PHARMACY"
"RTN","PSDFILM",11,0)
 F JJ=0:0 S JJ=$O(^XUSEC("PSD ERROR",JJ)) Q:'JJ  S XMY(JJ)=""
"RTN","PSDFILM",12,0)
 S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDTAMSG",$J)
"RTN","PSDFILM",13,0)
 K JJ,PHARMN1,PSDRN,RDT,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDFILM",14,0)
 Q
"RTN","PSDFND")
0^77^B24395301
"RTN","PSDFND",1,0)
PSDFND ;BIR/JPW-Pharm Filled Not Delivered Report ; 29 Aug 94
"RTN","PSDFND",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFND",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDFND",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ RNURSE",DUZ)):2,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDFND",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to",!,?12,"review this narcotics report.",!!,"PSJ RPHARM, PSJ RNURSE, or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDFND",6,0)
ASKD ;ask dispensing location
"RTN","PSDFND",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDFND",8,0)
 G:$P(PSDSITE,U,5) SUM
"RTN","PSDFND",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDFND",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDFND",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDFND",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDFND",13,0)
SUM ;if summary only
"RTN","PSDFND",14,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDFND",15,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the report and the summary totals."
"RTN","PSDFND",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDFND",17,0)
DEV ;ask device and queue info
"RTN","PSDFND",18,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDFND",19,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=$S($G(OK)=2:"",1:Y)
"RTN","PSDFND",20,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDFND",21,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDFND",ZTDESC="CS Filled Not Delivered Report" S (ZTSAVE("SUM"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"))="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDFND",22,0)
 U IO
"RTN","PSDFND",23,0)
START ;compile data
"RTN","PSDFND",24,0)
 K ^TMP("PSDFND",$J),^TMP("PSDFNDT",$J)
"RTN","PSDFND",25,0)
 F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",3,PSD)) Q:'PSD  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",3,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)),$P(^(0),"^",3)=+PSDS D
"RTN","PSDFND",26,0)
 .I $D(^PSD(58.81,PSDA,5)),+^(5) Q
"RTN","PSDFND",27,0)
 .S NODE=^PSD(58.81,PSDA,0),PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDFND",28,0)
 .S NAOU=+$P(NODE,"^",18),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_NAOU) I NAOUN'="UNKNOWN" S NAOUN=$E(NAOUN,1,10)
"RTN","PSDFND",29,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDFND",30,0)
 .S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDFND",31,0)
 .S:'$D(^TMP("PSDFNDT",$J,DRUGN)) ^TMP("PSDFNDT",$J,DRUGN)=0
"RTN","PSDFND",32,0)
 .S ^TMP("PSDFNDT",$J,DRUGN)=^TMP("PSDFNDT",$J,DRUGN)+QTY Q:SUM
"RTN","PSDFND",33,0)
 .S PHARM=$P($G(^PSD(58.81,PSDA,1)),"^"),PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDFND",34,0)
 .S PSDST=$P(NODE,"^",4),PSDDT="" I PSDST S Y=$E(PSDST,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDFND",35,0)
 .S ^TMP("PSDFND",$J,PSDPN,PSDA)=DRUGN_"^"_NAOUN_"^"_QTY_"^"_PSDDT_"^"_PHARMN
"RTN","PSDFND",36,0)
PRINT ;print filled not delivered log
"RTN","PSDFND",37,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDFND",38,0)
 I SUM D ^PSDFND1 G DONE
"RTN","PSDFND",39,0)
 S (PG,PSDOUT)=0
"RTN","PSDFND",40,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDFND",$J)) D HDR W !!,?40,"****  NO PENDING DELIVERIES FOR THIS DISPENSING LOCATION  ****",! G DONE
"RTN","PSDFND",41,0)
 D HDR S NUM="" F  S NUM=$O(^TMP("PSDFND",$J,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  D
"RTN","PSDFND",42,0)
 .F PSD=0:0 S PSD=$O(^TMP("PSDFND",$J,NUM,PSD)) Q:'PSD!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  S NODE=^TMP("PSDFND",$J,NUM,PSD) W !,NUM,?15,$P(NODE,"^"),?65,$J($P(NODE,"^",3),6),?80,$P(NODE,"^",4),?95,$P(NODE,"^",2),?112,$P(NODE,"^",5)
"RTN","PSDFND",43,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR S DIR(0)="EA",DIR("A")="Press <RET> to return to display the summary totals" D ^DIR K DIR I 'Y S PSDOUT=1 G DONE
"RTN","PSDFND",44,0)
 D:'PSDOUT ^PSDFND1
"RTN","PSDFND",45,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDFND",46,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDFND",47,0)
END ;
"RTN","PSDFND",48,0)
 K %,%DT,%H,%I,%ZIS,C,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,LN,NAOU,NAOUN,NODE,NUM
"RTN","PSDFND",49,0)
 K OK,PG,PHARM,PHARMN,POP,PSD,PSDA,PSDDT,PSDEV,PSDOUT,PSDPN,PSDS,PSDSN,PSDST,QTY,RPDT,SUM,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDFND",50,0)
 K ^TMP("PSDFND",$J),^TMP("PSDFNDT",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDFND",51,0)
 Q
"RTN","PSDFND",52,0)
HDR ;header for log
"RTN","PSDFND",53,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDFND",54,0)
 S PG=PG+1 W:$Y @IOF W !,?45,"Narcotics Filled Not Delivered Report",?115,"Page: ",PG,!,?45,"Dispensing Vault: "_PSDSN,!,?56,RPDT,!
"RTN","PSDFND",55,0)
 W !!,?65,"QUANTITY",?82,"DATE",?97,"NAOU"
"RTN","PSDFND",56,0)
 W !,"DISP #",?15,"DRUG",?65,"DISPENSED",?80,"DISPENSED",?94,"DISPENSED TO",?112,"DISPENSED BY"
"RTN","PSDFND",57,0)
 W !,LN,!
"RTN","PSDFND",58,0)
 Q
"RTN","PSDFND1")
0^78^B2479612
"RTN","PSDFND1",1,0)
PSDFND1 ;BIR/JPW-Pharm Filled Not Delivered Report ; 2 Aug 94
"RTN","PSDFND1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFND1",3,0)
SUMPRT ;prints summary
"RTN","PSDFND1",4,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDFND1",5,0)
 I '$D(^TMP("PSDFNDT",$J)) D SUMHDR W !!,?45,"****  NO PENDING DELIVERIES FOR THIS DISPENSING LOCATION  ****",! Q
"RTN","PSDFND1",6,0)
PRTSUM ;prints summary data for filled not delivered log
"RTN","PSDFND1",7,0)
 D SUMHDR Q:PSDOUT
"RTN","PSDFND1",8,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDFNDT",$J,DRUG)) Q:DRUG=""  D:$Y+4>IOSL SUMHDR Q:PSDOUT  W !,?2,DRUG,?60,$J(+^TMP("PSDFNDT",$J,DRUG),6),!
"RTN","PSDFND1",9,0)
 Q
"RTN","PSDFND1",10,0)
SUMHDR ;lists summary header information
"RTN","PSDFND1",11,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDFND1",12,0)
 W:$Y @IOF S PG=PG+1 W !,?25,"Narcotics Filled Not Delivered Report",?70,"Page "_PG,!,?36,RPDT,!,?35,"** SUMMARY **",!!,"Dispensing Vault: ",PSDSN,!!
"RTN","PSDFND1",13,0)
 W !,?58,"TOTAL FILLED",!,?5,"DRUG",?58,"NOT DISPENSED",!,LN,!
"RTN","PSDFND1",14,0)
 Q
"RTN","PSDFT")
0^79^B24149359
"RTN","PSDFT",1,0)
PSDFT ;B'ham ISC/JPW,LTL - File NDES Info ; 26 June 95
"RTN","PSDFT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFT",3,0)
LOOP ;loop thru data from DFT message
"RTN","PSDFT",4,0)
 N NAOU,PSD,PSDPID,PSDPV1,PSDFT1,PSDZPM,PSDM,PSDTYP,NUR1,NUR2,PAT
"RTN","PSDFT",5,0)
 S PSDPID=$G(^HL(772,HLDA,"IN",3,0)),PSDPV1=$G(^HL(772,HLDA,"IN",4,0))
"RTN","PSDFT",6,0)
 S PSDFT1=$G(^HL(772,HLDA,"IN",5,0)),PSDZPM=$G(^HL(772,HLDA,"IN",6,0))
"RTN","PSDFT",7,0)
 S NAOU=$P($P(PSDPV1,HLFS,4),$E(HLECH))
"RTN","PSDFT",8,0)
 S NAOU(1)=0 F  S NAOU(1)=$O(^PSD(58.8,"AB",+NAOU,NAOU(1)))  Q:$P($G(^PSD(58.8,+NAOU(1),0)),U,2)="N"!('NAOU(1))
"RTN","PSDFT",9,0)
 S:'NAOU(1) PSDM(1)="* "_$S(NAOU']"":"No Ward Location",'$D(^DIC(42,+NAOU)):NAOU_" is not a valid Ward Location (IEN).",1:$P($G(^DIC(42,+NAOU,0)),U)_" is not linked to an NAOU.")
"RTN","PSDFT",10,0)
 S PSDTYP=$E($P(PSDFT1,HLFS,7)),PSDTYP(1)=$S(PSDTYP="D":17,PSDTYP="W":18,PSDTYP="R":3,PSDTYP="V":17,1:"")
"RTN","PSDFT",11,0)
 S:'PSDTYP(1) PSDM(2)="* "_$S(PSDTYP']"":"No type",1:PSDTYP_" is not a valid action,")_" must be (D)ispensed, (W)asted, or (R)eturned."
"RTN","PSDFT",12,0)
 S NUR1=$P(PSDFT1,HLFS,21),NUR1(1)=+NUR1
"RTN","PSDFT",13,0)
 S:'$D(^VA(200,NUR1(1),0)) PSDM(3)="* "_$S(NUR1(1):NUR1(1)_" is invalid ID",1:"No Nurse ID")_" for "_$S($P(NUR1,$E(HLECH),2)]"":$P(NUR1,$E(HLECH),2),1:"Unknown Nurse")
"RTN","PSDFT",14,0)
 S NUR2=$P(PSDZPM,HLFS,15),NUR2(1)=+NUR2
"RTN","PSDFT",15,0)
 S:PSDTYP="W"&('$D(^VA(200,NUR2(1),0))) PSDM(3.5)="* "_$S(NUR2(1):NUR2(1)_" is invalid witness ID",1:"No witness ID")_" for "_$S($P(NUR2,$E(HLECH),2)]"":$P(NUR2,$E(HLECH),2),1:"Unknown Witness")
"RTN","PSDFT",16,0)
 S PAT=+$P(PSDPID,HLFS,4)
"RTN","PSDFT",17,0)
 S:'$D(^DPT(PAT)) PSDM(4)="* "_$S(PAT:PAT_" is an invalid ID",1:"NO ID")_" for "_$S($P(PSDPID,HLFS,6)]"":$$FMNAME^HLFNC($P(PSDPID,HLFS,6)),1:"UNKNOWN PATIENT")
"RTN","PSDFT",18,0)
 S PSDR=$P(PSDFT1,HLFS,8)
"RTN","PSDFT",19,0)
 S:'$D(^PSD(58.8,+NAOU(1),1,+PSDR)) PSDM(5)="* Drug #"_$S($P(PSDR,$E(HLECH))]"":$P(PSDR,$E(HLECH))_" is not stocked,",1:"No drug ID")_" drug:  "_$S($P(PSDR,$E(HLECH),2)]"":$P(PSDR,$E(HLECH),2),1:"UNKNOWN DRUG")
"RTN","PSDFT",20,0)
 S QTY=+$P(PSDFT1,HLFS,11),NUR2="" S:PSDTYP(1)="R" QTY=-QTY
"RTN","PSDFT",21,0)
 S PSDT=$$FMDATE^HLFNC($P($G(^HL(772,HLDA,"IN",1,0)),HLFS,7))
"RTN","PSDFT",22,0)
 S Y=PSDT X ^DD("DD") S %DT="RX",(X,PSDT(1))=Y D ^%DT
"RTN","PSDFT",23,0)
 S:Y<1 PSDM(6)="* "_PSDT(1)_" is an not a valid date, exact date/time are required."
"RTN","PSDFT",24,0)
 D:$O(PSDM(0))
"RTN","PSDFT",25,0)
 .N PSD D KILL^XM
"RTN","PSDFT",26,0)
 .S XMSUB="Narcotic Dispensing Equipment System Error"
"RTN","PSDFT",27,0)
 .S XMDUZ="Interface Monitor"
"RTN","PSDFT",28,0)
 .D XMZ^XMA2 I XMZ<1 D KILL^XM Q
"RTN","PSDFT",29,0)
 .S XMY(DUZ)="",PSD=0
"RTN","PSDFT",30,0)
 .F  S PSD=$O(^XUSEC("PSD ERROR",PSD)) Q:'PSD  S XMY(PSD)=""
"RTN","PSDFT",31,0)
 .S PSDM(.1)="The following transmission did NOT update the Controlled Substances package:",PSDM(.2)=""
"RTN","PSDFT",32,0)
 .S:NAOU(1) PSDM(.3)="NAOU:  "_$P($G(^PSD(58.8,+NAOU(1),0)),U)
"RTN","PSDFT",33,0)
 .S:PSDTYP(1) PSDM(.4)="Transaction type:  "_$S("DV"[PSDTYP:"Dispensed",PSDTYP="R":"Returned",1:"Wasted")
"RTN","PSDFT",34,0)
 .S:'$D(PSDM(3)) PSDM(.5)="Nurse:  "_$P($G(^VA(200,+NUR1,0)),U)
"RTN","PSDFT",35,0)
 .S:PSDTYP="W"&('$D(PSDM(3.5))) PSDM(.51)="Witness:  "_$P($G(^VA(200,+NUR2,0)),U)
"RTN","PSDFT",36,0)
 .S:'$D(PSDM(4)) PSDM(.6)="Patient:  "_$P($G(^DPT(PAT,0)),U)
"RTN","PSDFT",37,0)
 .S:'$D(PSDM(5)) PSDM(.7)="Drug:  "_$P($G(^PSDRUG(+PSDR,0)),U)_"  QTY:  "_QTY
"RTN","PSDFT",38,0)
 .S:'$D(PSDM(6)) PSDM(.8)="Date/Time:  "_PSDT(1)
"RTN","PSDFT",39,0)
 .S PSDM(.9)="",PSDM(.91)="No update occurred to Controlled Substances",PSDM(.92)="because of the following discrepancy:",PSDM(.93)=""
"RTN","PSDFT",40,0)
 .S XMTEXT="PSDM(" D ^XMD,KILL^XM
"RTN","PSDFT",41,0)
 S QTY=-QTY
"RTN","PSDFT",42,0)
 D:QTY&('$D(PSDM)) UPDATE
"RTN","PSDFT",43,0)
 ;Send ack back
"RTN","PSDFT",44,0)
 S HLSDATA(2)="MSA"_HLFS_"AA"_HLFS_$P(HLSDATA(1),HLFS,10)_HLFS_"MESSAGE PROCESSED",HLEVN=1 D EN1^HLTRANS
"RTN","PSDFT",45,0)
END K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,LQTY,NAOUN,NODE,OK,OQTY,ORD
"RTN","PSDFT",46,0)
 K PAT,PATL,PSD,PSDER,PSDPN,PSDR,PSDREC,PSDRN,PSDT,PSDTN,QTY,WQTY,X,Y
"RTN","PSDFT",47,0)
OP Q
"RTN","PSDFT",48,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDFT",49,0)
 ;updating drug balance in 58.8
"RTN","PSDFT",50,0)
 F  L +^PSD(58.8,+NAOU(1),1,+PSDR,0):0 I  Q
"RTN","PSDFT",51,0)
 D NOW^%DTC S PSDTN=+%
"RTN","PSDFT",52,0)
 S BAL=$P(^PSD(58.8,+NAOU(1),1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+QTY
"RTN","PSDFT",53,0)
 L -^PSD(58.8,+NAOU(1),1,+PSDR,0)
"RTN","PSDFT",54,0)
ADD ;find entry number in 58.81
"RTN","PSDFT",55,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDFT",56,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDFT",57,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDFT",58,0)
 L -^PSD(58.81,0)
"RTN","PSDFT",59,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDFT",60,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP(1)_"^"_+NAOU(1)_"^"_PSDT_"^"_+PSDR_"^"_QTY_"^^^^"_BAL_"^^^^^^^^"_+NAOU(1)_"^^"
"RTN","PSDFT",61,0)
 ;get specialty for patient
"RTN","PSDFT",62,0)
 S DFN=PAT,VAROOT="PSD" D INP^VADPT
"RTN","PSDFT",63,0)
 S ^PSD(58.81,PSDREC,9)=PAT_"^"_+NUR1_"^^"_$S(PSDTYP(1)=18:-QTY,1:"")_"^^"_NUR2_"^^^^^^^"_$P($G(^DIC(45.7,+PSD(3),0)),U,2)
"RTN","PSDFT",64,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDFT",65,0)
 K DA,DIK,PSD,VAERR S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDFT",66,0)
 W "."
"RTN","PSDFT",67,0)
 Q
"RTN","PSDFT",68,0)
ERR ;err log update
"RTN","PSDFT",69,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDFT",70,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDFT",71,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDFT",72,0)
 L -^PSD(58.89,0)
"RTN","PSDFT",73,0)
EDIT9 ;edit error log
"RTN","PSDFT",74,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_NAOU D ^DIE K DA,DIE,DR
"RTN","PSDFT",75,0)
 D ^PSDFILM
"RTN","PSDFT",76,0)
 Q
"RTN","PSDFT1")
0^80^B30254991
"RTN","PSDFT1",1,0)
PSDFT1 ;B'ham ISC/JPW,LTL - File NDES Info ; 26 June 95
"RTN","PSDFT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDFT1",3,0)
DFT ;process the incoming message
"RTN","PSDFT1",4,0)
 N PSD,PSD1
"RTN","PSDFT1",5,0)
 F PSD=1:1 X HLNEXT Q:HLQUIT'>0  S PSD(PSD)=HLNODE,PSD1=0 F  S PSD1=$O(HLNODE(PSD1)) Q:'PSD1  S PSD1(PSD1)=HLNODE(PSD1)
"RTN","PSDFT1",6,0)
LOOP ;loop thru data from DFT message
"RTN","PSDFT1",7,0)
 N NAOU,PSDPID,PSDPV1,PSDFT1,PSDZPM,PSDM,PSDTYP,NUR1,NUR2,PAT
"RTN","PSDFT1",8,0)
 S PSDPID=$G(PSD(3)),PSDPV1=$G(PSD(4))
"RTN","PSDFT1",9,0)
 S PSDFT1=$G(PSD(5)),PSDZPM=$G(PSD(6))
"RTN","PSDFT1",10,0)
 I '$D(^PSDRUG(+$P(PSDFT1,HL("FS"),8),0)) G ACK
"RTN","PSDFT1",11,0)
 I $D(^PSDRUG(+$P(PSDFT1,HL("FS"),8),0)),$P($G(^PSDRUG(+$P(PSDFT1,HL("FS"),8),2)),U,3)'["N" G ACK
"RTN","PSDFT1",12,0)
 S (NAOU,NAOU(2))=$P($P(PSDPV1,HL("FS"),4),$E(HL("ECH")))
"RTN","PSDFT1",13,0)
 S:NAOU]"" NAOU=$O(^DIC(42,"B",NAOU,0))
"RTN","PSDFT1",14,0)
 I 'NAOU S DFN=+$P(PSDPID,HL("FS"),4) D INP^VADPT S NAOU=+VAIN(4) D KVA^VADPT
"RTN","PSDFT1",15,0)
 S NAOU(1)=0 F  S NAOU(1)=$O(^PSD(58.8,"AB",+NAOU,NAOU(1)))  Q:$P($G(^PSD(58.8,+NAOU(1),0)),U,2)="N"!('NAOU(1))
"RTN","PSDFT1",16,0)
 S:'NAOU(1) PSDM(1)="* "_$S(NAOU(2)']"":"No Ward Location",'NAOU!('$D(^DIC(42,+NAOU))):NAOU(2)_" is not a valid Ward Location.",1:$P($G(^DIC(42,+NAOU,0)),U)_" is not linked to an NAOU.")
"RTN","PSDFT1",17,0)
 S PSDTYP=$E($P(PSDFT1,HL("FS"),7)),PSDTYP(1)=$S(PSDTYP="D"!(PSDTYP="CHARGE"):17,PSDTYP="W":18,PSDTYP="R"!(PSDTYP="CREDIT"):3,PSDTYP="V":17,1:"")
"RTN","PSDFT1",18,0)
 S:'PSDTYP(1) PSDM(2)="* "_$S(PSDTYP']"":"No type",1:PSDTYP_" is not a valid action,")_" must be (D)ispensed, (W)asted, or (R)eturned."
"RTN","PSDFT1",19,0)
 S (X,NUR1)=$P($P(PSDFT1,HL("FS"),21),$E(HL("ECH")),2)
"RTN","PSDFT1",20,0)
NUR S DIC="^VA(200,",DIC(0)="M" D ^DIC S NUR1(1)=+Y
"RTN","PSDFT1",21,0)
 I Y<1 S X=$P(X,",") D ^DIC S NUR1(1)=+Y
"RTN","PSDFT1",22,0)
 K DIC
"RTN","PSDFT1",23,0)
 S:'$D(^VA(200,NUR1(1),0)) PSDM(3)="* No VA Nurse match for "_$S(NUR1]"":NUR1,1:"Unknown Nurse")
"RTN","PSDFT1",24,0)
 S (X,NUR2)=$P(PSDZPM,HL("FS"),16)
"RTN","PSDFT1",25,0)
 S DIC="^VA(200,",DIC(0)="M" D ^DIC S NUR2(1)=+Y
"RTN","PSDFT1",26,0)
 I Y<1 S X=$P(X,",") D ^DIC S NUR2(1)=+Y
"RTN","PSDFT1",27,0)
 K DIC
"RTN","PSDFT1",28,0)
 S:PSDTYP="W"&('$D(^VA(200,NUR2(1),0))) PSDM(3.5)="* No Va Witness match for "_$S(NUR2]"":NUR2,1:"Unknown Witness")
"RTN","PSDFT1",29,0)
 S PAT=+$P(PSDPID,HL("FS"),4)
"RTN","PSDFT1",30,0)
 S:'PAT!('$D(^DPT(PAT))) PSDM(4)="* "_$S(PAT:PAT_" is NOT a valid PATIENT ID",1:"NO PATIENT ID")_" for "_$S($P(PSDPID,HL("FS"),6)]"":$P(PSDPID,HL("FS"),6),1:"UNKNOWN PATIENT")
"RTN","PSDFT1",31,0)
 S:'$D(PSDM(4))&($P($G(^DPT(PAT,0)),U)'[$P($P(PSDPID,HL("FS"),6),U)) PSDM(4)="VA patient name: "_$P($G(^(0)),U)_" System name: "_$P(PSDPID,HL("FS"),6)
"RTN","PSDFT1",32,0)
 S PSDR=$P(PSDFT1,HL("FS"),8)
"RTN","PSDFT1",33,0)
 D:'+PSDR!('$D(^PSD(58.8,+NAOU(1),1,+PSDR)))&($G(PSDM(1))']"")
"RTN","PSDFT1",34,0)
 .S PSDM(5)="* Drug #"_$S($P(PSDR,$E(HL("ECH")))]"":$P(PSDR,$E(HL("ECH")))_" is not stocked,",1:"No drug ID")_" drug:  "_$S($P(PSDR,$E(HL("ECH")),2)]"":$P(PSDR,$E(HL("ECH")),2),1:"UNKNOWN DRUG")
"RTN","PSDFT1",35,0)
 S QTY=+$P(PSDFT1,HL("FS"),11),NUR2="" S:PSDTYP(1)="R" QTY=-QTY
"RTN","PSDFT1",36,0)
 S PSDT=$$FMDATE^HLFNC($G(HL("DTM")))
"RTN","PSDFT1",37,0)
 S Y=PSDT X ^DD("DD") S %DT="RX",(X,PSDT(1))=$P(Y,":",1,2) D ^%DT
"RTN","PSDFT1",38,0)
 S:Y=-1 PSDM(6)="* "_PSDT(1)_" is not a valid date, exact date/time are required."
"RTN","PSDFT1",39,0)
 D:$O(PSDM(0))
"RTN","PSDFT1",40,0)
 .N PSD D KILL^XM
"RTN","PSDFT1",41,0)
 .S XMSUB="Narcotic Dispensing Equipment System Error"
"RTN","PSDFT1",42,0)
 .S XMDUZ="Interface Monitor"
"RTN","PSDFT1",43,0)
 .D XMZ^XMA2 I XMZ<1 D KILL^XM Q
"RTN","PSDFT1",44,0)
 .S XMY(DUZ)="",PSD=0
"RTN","PSDFT1",45,0)
 .F  S PSD=$O(^XUSEC("PSD ERROR",PSD)) Q:'PSD  S XMY(PSD)=""
"RTN","PSDFT1",46,0)
 .S PSDM(.1)="The following transmission did NOT update the Controlled Substances package:",PSDM(.2)=""
"RTN","PSDFT1",47,0)
 .S:NAOU(1) PSDM(.3)="NAOU:  "_$P($G(^PSD(58.8,+NAOU(1),0)),U)
"RTN","PSDFT1",48,0)
 .S:PSDTYP(1) PSDM(.4)="Transaction type:  "_$S("DV"[PSDTYP:"Dispensed",PSDTYP="R":"Returned",1:"Wasted")
"RTN","PSDFT1",49,0)
 .S:'$D(PSDM(3)) PSDM(.5)="Nurse:  "_$P($G(^VA(200,+NUR1(1),0)),U)
"RTN","PSDFT1",50,0)
 .S:PSDTYP="W"&('$D(PSDM(3.5))) PSDM(.51)="Witness:  "_$P($G(^VA(200,+NUR2,0)),U)
"RTN","PSDFT1",51,0)
 .S:'$D(PSDM(4)) PSDM(.6)="Patient:  "_$P($G(^DPT(PAT,0)),U)
"RTN","PSDFT1",52,0)
 .S:'$D(PSDM(5)) PSDM(.7)="Drug:  "_$P($G(^PSDRUG(+PSDR,0)),U)_"  QTY:  "_QTY
"RTN","PSDFT1",53,0)
 .S:'$D(PSDM(6)) PSDM(.8)="Date/Time:  "_PSDT(1)
"RTN","PSDFT1",54,0)
 .S PSDM(.9)="",PSDM(.91)="No update occurred to Controlled Substances",PSDM(.92)="because of the following discrepancy:",PSDM(.93)=""
"RTN","PSDFT1",55,0)
 .S XMTEXT="PSDM(" D ^XMD,KILL^XM
"RTN","PSDFT1",56,0)
 S QTY=-QTY
"RTN","PSDFT1",57,0)
 ;D:QTY&('$D(PSDM)) UPDATE
"RTN","PSDFT1",58,0)
ACK ;Send ack back
"RTN","PSDFT1",59,0)
 S HLEID=HL("EID"),HLEIDS=HL("EIDS"),HLARYTYP="LM",HLFORMAT=1
"RTN","PSDFT1",60,0)
 S (HLRESLTA,HLMTIENA,HLP)=""
"RTN","PSDFT1",61,0)
 S HLA("HLA",1)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")_HL("FS")_"MESSAGE PROCESSED"
"RTN","PSDFT1",62,0)
 D GENACK^HLMA1(HLEID,HLMTIENS,HLEIDS,HLARYTYP,HLFORMAT,.HLRESLTA,HLMTIENA,.HLP)
"RTN","PSDFT1",63,0)
END K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,LQTY,NAOUN,NODE,OK,OQTY,ORD
"RTN","PSDFT1",64,0)
 K PAT,PATL,PSD,PSDER,PSDPN,PSDR,PSDREC,PSDRN,PSDT,PSDTN,QTY,WQTY,X,Y
"RTN","PSDFT1",65,0)
OP Q
"RTN","PSDFT1",66,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDFT1",67,0)
 ;updating drug balance in 58.8
"RTN","PSDFT1",68,0)
 F  L +^PSD(58.8,+NAOU(1),1,+PSDR,0):0 I  Q
"RTN","PSDFT1",69,0)
 D NOW^%DTC S PSDTN=+%
"RTN","PSDFT1",70,0)
 S BAL=$P(^PSD(58.8,+NAOU(1),1,+PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+QTY
"RTN","PSDFT1",71,0)
 L -^PSD(58.8,+NAOU(1),1,+PSDR,0)
"RTN","PSDFT1",72,0)
ADD ;find entry number in 58.81
"RTN","PSDFT1",73,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDFT1",74,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDFT1",75,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDFT1",76,0)
 L -^PSD(58.81,0)
"RTN","PSDFT1",77,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDFT1",78,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP(1)_"^"_+NAOU(1)_"^"_PSDT_"^"_+PSDR_"^"_QTY_"^^^^"_BAL_"^^^^^^^^"_+NAOU(1)_"^^"
"RTN","PSDFT1",79,0)
 ;get specialty for patient
"RTN","PSDFT1",80,0)
 S DFN=PAT,VAROOT="PSD" D INP^VADPT
"RTN","PSDFT1",81,0)
 S ^PSD(58.81,PSDREC,9)=PAT_"^"_+NUR1_"^^"_$S(PSDTYP(1)=18:-QTY,1:"")_"^^"_NUR2_"^^^^^^^"_$P($G(^DIC(45.7,+PSD(3),0)),U,2)
"RTN","PSDFT1",82,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDFT1",83,0)
 K DA,DIK,PSD,VAERR S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDFT1",84,0)
 W "."
"RTN","PSDFT1",85,0)
 Q
"RTN","PSDFT1",86,0)
ERR ;err log update
"RTN","PSDFT1",87,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDFT1",88,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDFT1",89,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDFT1",90,0)
 L -^PSD(58.89,0)
"RTN","PSDFT1",91,0)
EDIT9 ;edit error log
"RTN","PSDFT1",92,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_NAOU D ^DIE K DA,DIE,DR
"RTN","PSDFT1",93,0)
 D ^PSDFILM
"RTN","PSDFT1",94,0)
 Q
"RTN","PSDGEN")
0^81^B1534371
"RTN","PSDGEN",1,0)
PSDGEN ;BIR/JPW-Enter/Edit NAOU Inventory Groups ; 6 July 94
"RTN","PSDGEN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGEN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGEN",4,0)
GROUP ;entry for NAOU inventory groups into file 58.2
"RTN","PSDGEN",5,0)
 K DA,DIC,DLAYGO F  W ! S (DIC,DLAYGO)=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEAL" D ^DIC K DIC,DLAYGO Q:Y<0  K DA,DIE,DR S DIE=58.2,DA=+Y,DR="[PSD INV GROUP]" D ^DIE K DA,DIE,DR
"RTN","PSDGEN",6,0)
END K DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,PSDS,PSDSK,PSDSKP,X,Y
"RTN","PSDGPR")
0^82^B15883795
"RTN","PSDGPR",1,0)
PSDGPR ;BIR/CML,JPW-Print NAOU Inventory Group List ; 2 Aug 94
"RTN","PSDGPR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGPR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGPR",4,0)
 D NOW^%DTC S PSDT=$P(%,".")
"RTN","PSDGPR",5,0)
 W !!!,"This report shows data stored for NAOU Inventory Groups.",!!,"Right margin for this report is 80 columns.",!,"You may queue the report to print at a later time.",!!
"RTN","PSDGPR",6,0)
 I '$O(^PSI(58.2,0)) W !,"You MUST create Inventory Groups before running this report!" K %,%I,%H Q
"RTN","PSDGPR",7,0)
DEV K %ZIS,IOP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G QUIT
"RTN","PSDGPR",8,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="ENQ^PSDGPR",ZTDESC="Compile Data for NAOU Inventory Groups",ZTSAVE("PSDIO")="",ZTSAVE("PSDT")="",ZTSAVE("PSDSITE")=""
"RTN","PSDGPR",9,0)
 I  D ^%ZTLOAD K ZTSK G QUIT
"RTN","PSDGPR",10,0)
 U IO
"RTN","PSDGPR",11,0)
 ;
"RTN","PSDGPR",12,0)
ENQ ;ENTRY POINT WHEN QUEUED
"RTN","PSDGPR",13,0)
INVG K ^TMP("PSDGPR",$J) F INVG=0:0 S INVG=$O(^PSI(58.2,INVG)) G:('INVG)&($D(ZTQUEUED)) PRTQUE G:'INVG PRINT D BUILD
"RTN","PSDGPR",14,0)
 ;
"RTN","PSDGPR",15,0)
BUILD ;BUILD DATA ELEMENTS
"RTN","PSDGPR",16,0)
 I $S('$D(^PSI(58.2,INVG,0)):1,^(0)="":1,'$O(^(0)):1,1:0) S DIK="^PSI(58.2,",DA=INVG D ^DIK K DIK Q
"RTN","PSDGPR",17,0)
 F NAOU=0:0 S NAOU=$O(^PSI(58.2,INVG,3,NAOU)) Q:'NAOU  I $D(^(NAOU,0)) F TYPE=0:0 S TYPE=$O(^PSI(58.2,INVG,3,NAOU,1,TYPE)) Q:'TYPE  I $D(^(TYPE,0)) D SETGL
"RTN","PSDGPR",18,0)
 Q
"RTN","PSDGPR",19,0)
SETGL ;
"RTN","PSDGPR",20,0)
 Q:$P($G(^PSD(58.8,NAOU,0)),"^",3)'=+PSDSITE
"RTN","PSDGPR",21,0)
 S ANM=$S($D(^PSD(58.8,NAOU,0)):$P(^(0),"^"),1:"NAOU NAME MISSING"),TYPENM=$S($D(^PSI(58.16,TYPE,0)):$P(^(0),"^"),1:"TYPE NAME MISSING"),GNM=^PSI(58.2,INVG,0),INACT=""
"RTN","PSDGPR",22,0)
 I $D(^PSD(58.8,NAOU,"I")),^("I")]"",^("I")'>DT S INACT="I"
"RTN","PSDGPR",23,0)
 S ^TMP("PSDGPR",$J,GNM,ANM_"^"_INACT,TYPENM)=""
"RTN","PSDGPR",24,0)
 Q
"RTN","PSDGPR",25,0)
 ;
"RTN","PSDGPR",26,0)
PRTQUE ;AFTER DATA IS COMPILED, QUEUE THE PRINT
"RTN","PSDGPR",27,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDGPR",ZTDESC="Print Data for Inventory Group List",ZTDTH=$H,ZTSAVE("^TMP(""PSDGPR"",$J,")=""
"RTN","PSDGPR",28,0)
 D ^%ZTLOAD K ^TMP("PSDGPR",$J) G QUIT
"RTN","PSDGPR",29,0)
PRINT ;
"RTN","PSDGPR",30,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",(GNM,ANM,TYPENM)="",X="T" D ^%DT X ^DD("DD") S HDT=Y D HDR
"RTN","PSDGPR",31,0)
 I '$D(^TMP("PSDGPR",$J)) W !?17,"***** NO DATA AVAILABLE FOR THIS REPORT *****" G QUIT
"RTN","PSDGPR",32,0)
 F LL=0:0 S GNM=$O(^TMP("PSDGPR",$J,GNM)) Q:GNM=""!(PSDOUT)  D:$Y+4>IOSL PAGE Q:PSDOUT  W !!,"=> ",GNM F LL=0:0 S ANM=$O(^TMP("PSDGPR",$J,GNM,ANM)) Q:ANM=""!(PSDOUT)  D:$Y+4>IOSL PAGE Q:PSDOUT  W !?13,$P(ANM,"^") D WRTDATA Q:PSDOUT
"RTN","PSDGPR",33,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDGPR",34,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDGPR",35,0)
QUIT ;
"RTN","PSDGPR",36,0)
 K %DT,DTOUT,NAOU,ANM,HDT,INACT,INVG,GNM,LL,LN,PG,PSDT,TYPE,TYPENM,X,Y,PSDIO,ZTSK,ZTDESC,ZTRTN,ZTIO,DA,IO("Q"),%,%I,%H,ANS,PSDOUT,POP
"RTN","PSDGPR",37,0)
 K ^TMP("PSDGPR",$J) D ^%ZISC
"RTN","PSDGPR",38,0)
 S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSDGPR",39,0)
WRTDATA ;DATA LINES
"RTN","PSDGPR",40,0)
 I $P(ANM,"^",2)="I" W "          *** INACTIVE ***"
"RTN","PSDGPR",41,0)
 F LL=0:0 S TYPENM=$O(^TMP("PSDGPR",$J,GNM,ANM,TYPENM)) Q:TYPENM=""!(PSDOUT)  D:$Y+4>IOSL PAGE Q:PSDOUT  W !?18,TYPENM
"RTN","PSDGPR",42,0)
 Q
"RTN","PSDGPR",43,0)
HDR ;HEADER
"RTN","PSDGPR",44,0)
 W:$Y @IOF S PG=PG+1 W !?28,"NAOU INVENTORY GROUP LIST",?71,"PAGE: ",PG,!?31,"PRINTED: ",HDT,!!,"=> INVENTORY GROUP",!?13,"NARCOTIC AREA OF USE",!?18,"TYPE",!,LN
"RTN","PSDGPR",45,0)
 Q
"RTN","PSDGPR",46,0)
PAGE ;end of page check
"RTN","PSDGPR",47,0)
 I $E(IOST,1,2)="C-" W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDGPR",48,0)
 D HDR
"RTN","PSDGPR",49,0)
 Q
"RTN","PSDGSH")
0^83^B4921089
"RTN","PSDGSH",1,0)
PSDGSH ;BIR/JPW-Review Green Sheet History ; 29 Aug 94
"RTN","PSDGSH",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSH",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGSH",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDGSH",5,0)
 ;I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to view",!,?12,"Green Sheets.",! K OK Q
"RTN","PSDGSH",6,0)
ASKD ;ask disp location
"RTN","PSDGSH",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDGSH",8,0)
 G:$P(PSDSITE,U,5) GS
"RTN","PSDGSH",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDGSH",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDGSH",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDGSH",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDGSH",13,0)
GS ;select green sheet #
"RTN","PSDGSH",14,0)
 W @IOF,! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC("S")="I $P(^(0),""^"",3)=PSDS,$P(^(0),""^"",2)'=5",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDGSH",15,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y,NODE=Y(0)
"RTN","PSDGSH",16,0)
DEV ;asks device and queueing information
"RTN","PSDGSH",17,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDGSH",18,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM" S:$D(^XUSEC("PSJ RPHARM",DUZ)) %ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDGSH",19,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDGSH1",ZTDESC="CS PHARM GREEN SHEET HISTORY" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G GS
"RTN","PSDGSH",20,0)
 U IO D START^PSDGSH1 G GS
"RTN","PSDGSH",21,0)
END K %ZIS,C,D,DA,DIC,DTOUT,DUOUT,NODE,OK,OTR,POP,PSD,PSDA,PSDEV,PSDS,PSDSN,X,Y
"RTN","PSDGSH",22,0)
 K ZTDESC,ZTRTN,ZTSAVE,ZTSK D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDGSH",23,0)
 Q
"RTN","PSDGSH",24,0)
SAVE ;sets variables for queueing
"RTN","PSDGSH",25,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDA"),ZTSAVE("NODE"))=""
"RTN","PSDGSH",26,0)
 Q
"RTN","PSDGSH1")
0^84^B8266094
"RTN","PSDGSH1",1,0)
PSDGSH1 ;BIR/JPW-Review Green Sheet History (cont'd) ; 6 Jan 94
"RTN","PSDGSH1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSH1",3,0)
START ;
"RTN","PSDGSH1",4,0)
 S CNT=0,NODE15=$G(^PSD(58.81,PSDA,1.5)),NODE16=$G(^PSD(58.81,PSDA,1.6))
"RTN","PSDGSH1",5,0)
 S PSDDT=$P(NODE,"^",4) I PSDDT S PSDDT=$$FMTE^XLFDT(PSDDT,"2P")
"RTN","PSDGSH1",6,0)
 S MFG=$P(NODE,"^",13),LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15) I EXP S Y=EXP X ^DD("DD") S EXP=Y
"RTN","PSDGSH1",7,0)
 S STAT=+$P(NODE,"^",11),PSDPN=$P(NODE,"^",17),STAT=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDGSH1",8,0)
 S NAOU=+$P(NODE,"^",18),NAOU=$P($G(^PSD(58.8,+NAOU,0)),"^"),DRUG=+$P(NODE,"^",5),DRUG=$P($G(^PSDRUG(+DRUG,0)),"^")
"RTN","PSDGSH1",9,0)
 S COMP=+$P(NODE,"^",12),COMP=$P($G(^PSD(58.83,+COMP,0)),"^"),QTY=+$P(NODE,"^",6)
"RTN","PSDGSH1",10,0)
 S CDT=$P(NODE,"^",19) I CDT S CDT=$$FMTE^XLFDT(CDT,"2P")
"RTN","PSDGSH1",11,0)
 S REAS=$P(NODE,"^",16),PSDI=+$P(NODE,"^",7)
"RTN","PSDGSH1",12,0)
 S PSDTP=$P(NODE15,"^",2),PSDIP=$P(NODE15,"^",3),PSDIR=$P(NODE15,"^",4)
"RTN","PSDGSH1",13,0)
 S PSDUZA=$P(NODE15,"^",2)
"RTN","PSDGSH1",14,0)
 I PSDUZA S PSDUZAN=$P($G(^VA(200,+PSDUZA,0)),"^")
"RTN","PSDGSH1",15,0)
 I PSDTP S PSDTP=$$FMTE^XLFDT(PSDTP,"2P")
"RTN","PSDGSH1",16,0)
 I PSDIP S PSDIP=$$FMTE^XLFDT(PSDIP,"2P")
"RTN","PSDGSH1",17,0)
 I PSDIR S PSDIR=$$FMTE^XLFDT(PSDIR,"2P")
"RTN","PSDGSH1",18,0)
 I PSDI S PSDIN=$P($G(^VA(200,+PSDI,0)),"^")
"RTN","PSDGSH1",19,0)
 I $D(^PSD(58.81,PSDA,1)) S NODE1=^(1) D SET1^PSDGSH11
"RTN","PSDGSH1",20,0)
 I $D(^PSD(58.81,PSDA,3)) S NODE3=^(3) D SET3^PSDGSH11
"RTN","PSDGSH1",21,0)
 I $D(^PSD(58.81,PSDA,4)) S NODE4=^(4) D SET4^PSDGSH11
"RTN","PSDGSH1",22,0)
 I $D(^PSD(58.81,PSDA,5)) S NODE5=^(5) D SET5^PSDGSH11
"RTN","PSDGSH1",23,0)
 I $D(^PSD(58.81,PSDA,7)) S NODE7=^(7) D SET7^PSDGSH11
"RTN","PSDGSH1",24,0)
 I $D(^PSD(58.81,PSDA,1.5)) S NODE15=^(1.5) D SET15^PSDGSH11
"RTN","PSDGSH1",25,0)
 I $D(^PSD(58.81,PSDA,1.6)) S NODE16=^(1.6)
"RTN","PSDGSH1",26,0)
 D DISPLAY^PSDGSH2
"RTN","PSDGSH1",27,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDGSH1",28,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDGSH1",29,0)
END K %,%DT,%H,%I,%ZIS,C,CANCD,CANCPH,CANCQ,CBY,CDT,CNT,COMP,CREAS,COMM,D,DA,DESD,DESDP,DEST,DESTD,DESTH,DESTQ,DIC,DIW,DIWF,DIWL,DIWR,DIWT,DN,DREAS,DRUG,DTOUT,DUOUT
"RTN","PSDGSH1",30,0)
 K EDADJ,EDMFG,EDPH,EDQTY,EDT,EREAS,EXP,FILL,JJ,LN,LOT,MFG,NAOU,NEW,NODE,NODE1,NODE3,NODE4,NODE5,NODE7,NODE15,NODE16,NURSF,NURST,OK,ORC,ORCD,OTR
"RTN","PSDGSH1",31,0)
 K PG,PROC,POP,PSDA,PSDBY,PSDDT,PSDEV,PSDI,PSDIN,PSDIP,PSDIR,PSDOUT,PSDPN,PSDTP,PSDUZA,PSDUZAN,PUBY,PUDT
"RTN","PSDGSH1",32,0)
 K QTY,REAS,REQ,REQD,RETN,RTECH,SREAS,STAT,STATN,STKD,STKQ,TEXT,TFRD,TFRN,TFTD,TFTN,TQTY,TRANS,TRN,X,Y,Z
"RTN","PSDGSH1",33,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDGSH1",34,0)
 Q
"RTN","PSDGSH11")
0^85^B12652900
"RTN","PSDGSH11",1,0)
PSDGSH11 ;BIR/JPW-Review Green Sheet History (cont'd) ; 24 Aug 94
"RTN","PSDGSH11",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSH11",3,0)
SET1 ;
"RTN","PSDGSH11",4,0)
 I +$P(NODE,"^",2)=12 S PSDDT=$P(NODE1,"^",2) I PSDDT S PSDDT=$$FMTE^XLFDT(PSDDT,"2P")
"RTN","PSDGSH11",5,0)
 S PSDBY=$P(NODE1,"^") I PSDBY S PSDBY=$P($G(^VA(200,+PSDBY,0)),"^")
"RTN","PSDGSH11",6,0)
 S PROC=$P(NODE1,"^",2) I PROC S PROC=$$FMTE^XLFDT(PROC,"2P")
"RTN","PSDGSH11",7,0)
 S ORC=$P(NODE1,"^",3) I ORC S ORC=$P($G(^VA(200,+ORC,0)),"^")
"RTN","PSDGSH11",8,0)
 S ORCD=$P(NODE1,"^",4) I ORCD S ORCD=$$FMTE^XLFDT(ORCD,"2P")
"RTN","PSDGSH11",9,0)
 S FILL=$P(NODE1,"^",5) I FILL S FILL=$P($G(^VA(200,+FILL,0)),"^")
"RTN","PSDGSH11",10,0)
 S REQD=$P(NODE1,"^",6) I REQD S REQD=$$FMTE^XLFDT(REQD,"2P")
"RTN","PSDGSH11",11,0)
 S REQ=$P(NODE1,"^",7) I REQ S REQ=$P($G(^VA(200,+REQ,0)),"^")
"RTN","PSDGSH11",12,0)
 S RTECH=$P(NODE1,"^",11) I RTECH S RTECH=$P($G(^VA(200,+RTECH,0)),"^")
"RTN","PSDGSH11",13,0)
SET1N S RETN=$P(NODE1,"^",10) I RETN S RETN=$P($G(^VA(200,+RETN,0)),"^")
"RTN","PSDGSH11",14,0)
 S PUDT=$P(NODE1,"^",12) I PUDT S PUDT=$$FMTE^XLFDT(PUDT,"2P")
"RTN","PSDGSH11",15,0)
 S PUBY=$P(NODE1,"^",13) I PUBY S PUBY=$P($G(^VA(200,+PUBY,0)),"^")
"RTN","PSDGSH11",16,0)
 S CBY=$P(NODE1,"^",14) I CBY S CBY=$P($G(^VA(200,+CBY,0)),"^")
"RTN","PSDGSH11",17,0)
 S OTR=$P(NODE1,"^",15)
"RTN","PSDGSH11",18,0)
 Q
"RTN","PSDGSH11",19,0)
SET3 ;
"RTN","PSDGSH11",20,0)
 S STKD=$P(NODE3,"^") I STKD S STKD=$$FMTE^XLFDT(STKD,"2P")
"RTN","PSDGSH11",21,0)
 S STKQ=+$P(NODE3,"^",2),SREAS=$P(NODE3,"^",3)
"RTN","PSDGSH11",22,0)
 S DESTD=$P(NODE3,"^",4) I DESTD S DESTD=$$FMTE^XLFDT(DESTD,"2P")
"RTN","PSDGSH11",23,0)
 S DESTQ=+$P(NODE3,"^",5),DESTH=+$P(NODE3,"^",8),DREAS=$P(NODE3,"^",6)
"RTN","PSDGSH11",24,0)
 S DESD=$P($G(^PSD(58.86,+DESTH,0)),"^",11),DESDP=$P($G(^(0)),"^",10)
"RTN","PSDGSH11",25,0)
 I DESD S DESD=$$FMTE^XLFDT(DESD,"2P")
"RTN","PSDGSH11",26,0)
 I DESDP S DESDP=$P($G(^VA(200,+DESDP,0)),"^")
"RTN","PSDGSH11",27,0)
 Q
"RTN","PSDGSH11",28,0)
SET4 ;
"RTN","PSDGSH11",29,0)
 S EDT=$P(NODE4,"^") I EDT S EDT=$$FMTE^XLFDT(EDT,"2P")
"RTN","PSDGSH11",30,0)
 S EDPH=$P(NODE4,"^",2) I EDPH S EDPH=$P($G(^VA(200,+EDPH,0)),"^")
"RTN","PSDGSH11",31,0)
 S EDQTY=+$P(NODE4,"^",3),EDADJ=+$P(NODE4,"^",4),EDMFG=+$P(NODE4,"^",5),EREAS=$P(NODE4,"^",6)
"RTN","PSDGSH11",32,0)
 Q
"RTN","PSDGSH11",33,0)
SET5 ;
"RTN","PSDGSH11",34,0)
 S CANCD=$P(NODE5,"^") I CANCD S CANCD=$$FMTE^XLFDT(CANCD,"2P")
"RTN","PSDGSH11",35,0)
 S CANCPH=$P(NODE5,"^",2) I CANCPH S CANCPH=$P($G(^VA(200,+CANCPH,0)),"^")
"RTN","PSDGSH11",36,0)
 S CANCQ=+$P(NODE5,"^",3),CREAS=$P(NODE5,"^",4)
"RTN","PSDGSH11",37,0)
 Q
"RTN","PSDGSH11",38,0)
SET7 ;
"RTN","PSDGSH11",39,0)
 Q:'$D(^PSD(58.81,PSDA,7))  S TRANS=1
"RTN","PSDGSH11",40,0)
 S CNT=CNT+1
"RTN","PSDGSH11",41,0)
 S TFRD=+$P(NODE7,"^") I TFRD S TFRD=$$FMTE^XLFDT(TFRD,"2P")
"RTN","PSDGSH11",42,0)
 S NURSF=+$P(NODE7,"^",2) I NURSF S NURSF=$P($G(^VA(200,+NURSF,0)),"^")
"RTN","PSDGSH11",43,0)
 S TFRN=+$P(NODE,"^",18) I TFRN S TFRN=$P($G(^PSD(58.8,+TFRN,0)),"^")
"RTN","PSDGSH11",44,0)
 S TFTD=+$P(NODE7,"^",4) I TFTD S TFTD=$$FMTE^XLFDT(TFTD,"2P")
"RTN","PSDGSH11",45,0)
 S TFTN=+$P(NODE7,"^",3) I TFTN S TFTN=$P($G(^PSD(58.8,+TFTN,0)),"^")
"RTN","PSDGSH11",46,0)
 S NURST=+$P(NODE7,"^",5) I NURST S NURST=$P($G(^VA(200,+NURST,0)),"^")
"RTN","PSDGSH11",47,0)
 S TQTY=+$P(NODE7,"^",7),NEW=+$O(^PSD(58.81,"AE",PSDA,0))
"RTN","PSDGSH11",48,0)
 S TRN(CNT)=TFRN_"^"_TFRD_"^"_NURSF_"^"_TFTN_"^"_TFTD_"^"_NURST_"^"_TQTY
"RTN","PSDGSH11",49,0)
 I NEW S PSDA=NEW D SETN
"RTN","PSDGSH11",50,0)
 Q
"RTN","PSDGSH11",51,0)
SETN ;
"RTN","PSDGSH11",52,0)
 Q:'$D(^PSD(58.81,PSDA,0))  S NODE=^(0)
"RTN","PSDGSH11",53,0)
 S TFTN=+$P(NODE,"^",18) I TFTN S TFTN=$P($G(^PSD(58.8,+TFTN,0)),"^") S:$P(TRN(CNT),"^",4)'=TFTN $P(TRN(CNT),"^",4)=TFTN
"RTN","PSDGSH11",54,0)
 S STAT=+$P(NODE,"^",11),STAT=$P($G(^PSD(58.82,+STAT,0)),"^")
"RTN","PSDGSH11",55,0)
 S COMP=+$P(NODE,"^",12),COMP=$P($G(^PSD(58.83,+COMP,0)),"^")
"RTN","PSDGSH11",56,0)
 S CDT=+$P(NODE,"^",19) I CDT S CDT=$$FMTE^XLFDT(CDT,"2P")
"RTN","PSDGSH11",57,0)
 I $D(^PSD(58.81,PSDA,1)) S NODE1=^(1) D SET1N
"RTN","PSDGSH11",58,0)
 I $D(^PSD(58.81,PSDA,3)) S NODE3=^(3) D SET3
"RTN","PSDGSH11",59,0)
 I $D(^PSD(58.81,PSDA,1.5)) S NODE15=^(1.5) D SET15
"RTN","PSDGSH11",60,0)
 I $D(^PSD(58.81,PSDA,1.6)) S NODE16=^(1.6)
"RTN","PSDGSH11",61,0)
 ;Q:'$O(^PSD(58.81,"AE",PSDA,0))
"RTN","PSDGSH11",62,0)
 I $P($G(^PSD(58.81,PSDA,7)),U) S NODE7=^(7) D SET7
"RTN","PSDGSH11",63,0)
 Q
"RTN","PSDGSH11",64,0)
SET15 ;
"RTN","PSDGSH11",65,0)
 S PSDTP=$P(NODE15,"^",2),PSDIP=$P(NODE15,"^",3),PSDIR=$P(NODE15,"^",4)
"RTN","PSDGSH11",66,0)
 S PSDUZA=$P(NODE15,"^",2)
"RTN","PSDGSH11",67,0)
 I PSDUZA S PSDUZAN=$P($G(^VA(200,+PSDUZA,0)),"^")
"RTN","PSDGSH11",68,0)
 I PSDTP S PSDTP=$$FMTE^XLFDT(PSDTP,"2P")
"RTN","PSDGSH11",69,0)
 I PSDIP S PSDIP=$$FMTE^XLFDT(PSDIP,"2P")
"RTN","PSDGSH11",70,0)
 I PSDIR S PSDIR=$$FMTE^XLFDT(PSDIR,"2P")
"RTN","PSDGSH11",71,0)
 Q
"RTN","PSDGSH2")
0^86^B19938937
"RTN","PSDGSH2",1,0)
PSDGSH2 ;BIR/JPW-Review Green Sheet History (cont'd) ; 2 Aug 94
"RTN","PSDGSH2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSH2",3,0)
DISPLAY ;print data
"RTN","PSDGSH2",4,0)
 S (PG,PSDOUT)=0 D HDR
"RTN","PSDGSH2",5,0)
 W !,"Manufacturer",?16,": ",MFG,?61,"Lot:",?66,LOT,!,"Expiration Date : ",EXP
"RTN","PSDGSH2",6,0)
 W !,"Dispensed by",?16,": ",$S($D(PSDBY):PSDBY,1:""),?49,"Disp Date: ",PSDDT
"RTN","PSDGSH2",7,0)
 I $D(FILL),FILL]"" W !,"Filled by",?16,": ",FILL,?53,"Fill Date: ",$S($D(PROC):PROC,1:"")
"RTN","PSDGSH2",8,0)
 W !,"Ord. Location",?16,": ",NAOU,!,"Ordered by",?16,": ",$G(REQ),?52
"RTN","PSDGSH2",9,0)
 W "Order Date: ",$G(REQD)
"RTN","PSDGSH2",10,0)
 I $D(PSDUZAN) W !,"Ord. by Pharm",?16,": ",PSDUZAN
"RTN","PSDGSH2",11,0)
 S COMM=0
"RTN","PSDGSH2",12,0)
 I $D(^PSD(58.81,PSDA,2,0)) S COMM=1 W !,"Comments:" K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.81,PSDA,2,TEXT)) Q:'TEXT  S X=$G(^PSD(58.81,PSDA,2,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDGSH2",13,0)
 I COMM D ^DIWW S COMM=0
"RTN","PSDGSH2",14,0)
 I $D(ORC),ORC]"" D CHK Q:PSDOUT  W !,"Received by",?16,": ",ORC,?53,"Rec Date: ",$S($D(ORCD):ORCD,1:"")
"RTN","PSDGSH2",15,0)
 I $D(RTECH),RTECH]"" D CHK Q:PSDOUT  W !,"Rec'd by Tech",?16,": ",RTECH,?55,"Rec Date :",$S($D(ORCD):ORCD,1:"")
"RTN","PSDGSH2",16,0)
 I $D(REAS),REAS]"" D CHK Q:PSDOUT  W !,"REASON",?16,": ",REAS
"RTN","PSDGSH2",17,0)
 I $D(PSDIN),PSDIN]"" D CHK Q:PSDOUT  W !,"Insp Hold by:",?16,": ",PSDIN,?51,"Placed Date: ",PSDIP W:PSDIR]"" !,?50,"Removed Date: ",PSDIR
"RTN","PSDGSH2",18,0)
 I NODE16]"" W !,"Hold Reason:",?16,": ",NODE16
"RTN","PSDGSH2",19,0)
 I $D(RETN),RETN]"" D CHK Q:PSDOUT  W !,"Comp by Nurse",?16,": ",RETN,?53,"Comp Date: ",PSDTP
"RTN","PSDGSH2",20,0)
 I $D(PUBY),PUBY]"" D CHK Q:PSDOUT  W !,"Pickup by",?16,": ",$S($D(PUBY):PUBY,1:""),?51,"Pickup Date: ",PUDT
"RTN","PSDGSH2",21,0)
 I $D(CBY),CBY]"" D CHK Q:PSDOUT  W !,"Completed by",?16,": ",CBY,?53,"Comp Date: ",$S($D(CDT):CDT,1:"")
"RTN","PSDGSH2",22,0)
 I $D(OTR),OTR]"" D CHK Q:PSDOUT  W !,"Referred Reason",?16,": ",OTR
"RTN","PSDGSH2",23,0)
 I $D(NODE3)!($D(NODE4))!($D(NODE5))!($D(TRANS)) D MORE
"RTN","PSDGSH2",24,0)
 W !
"RTN","PSDGSH2",25,0)
 Q
"RTN","PSDGSH2",26,0)
HDR ;header
"RTN","PSDGSH2",27,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDGSH2",28,0)
 S PG=PG+1 W:$Y @IOF W !,?23,"Controlled Substance Order",!! K LN S $P(LN,"-",80)=""
"RTN","PSDGSH2",29,0)
 W "Pharmacy Dispensing #: ",PSDPN,!,"Order Status",?21,": ",STAT,!,?23,$S(COMP]"":COMP,1:"")
"RTN","PSDGSH2",30,0)
 W !,"Dispensing Location  : ",PSDSN,!,LN,!
"RTN","PSDGSH2",31,0)
 W:$P($G(^PSD(58.81,PSDA,9)),U) !,"Patient",?16,": ",$P($G(^DPT(+$P($G(^PSD(58.81,PSDA,9)),U),0)),U)
"RTN","PSDGSH2",32,0)
 W !,"Drug",?16,": ",DRUG,?56,"Quantity: ",?66,QTY
"RTN","PSDGSH2",33,0)
 Q
"RTN","PSDGSH2",34,0)
MORE ;additional display
"RTN","PSDGSH2",35,0)
 I $D(NODE4),$D(EDT),EDT]"" D:$Y+8>IOSL HDR Q:PSDOUT  W !!,?10,"*** EDITED AFTER VERIFICATION ***",!!,"Edit Date",?16,": ",EDT,?48,"New Adjusted Qty: ",?64,EDQTY,!,"Pharmacist",?16,": ",EDPH,!,"Reason",?16,": ",EREAS
"RTN","PSDGSH2",36,0)
 I $D(NODE5),$D(CANCD),CANCD]"" D:$Y+8>IOSL HDR Q:PSDOUT  W !!,?10,"*** CANCELLED AFTER VERIFICATION ***",!!,"Cancel Date",?16,": ",CANCD,!,"Pharmacist",?16,": ",CANCPH,!,"Reason",?16,": ",CREAS
"RTN","PSDGSH2",37,0)
 I $D(NODE3),$D(STKD),STKD]"" D:$Y+8>IOSL HDR Q:PSDOUT  W !!,?10,"*** RETURNED TO STOCK ***",!!,"Ret by Nurse",?16,": ",$S($D(RETN):RETN,1:""),?57,"Qty Ret: ",?66,STKQ,!,"Returned Date",?16,": ",STKD,!,"Reason",?16,": ",SREAS
"RTN","PSDGSH2",38,0)
 I $D(NODE3),$D(DESTD),DESTD]"" D:$Y+10>IOSL HDR Q:PSDOUT  W !!,?10,"*** TURNED IN FOR DESTRUCTION ***",!!,"Turned in by",?16,": ",$S($D(RETN):RETN,1:"") D
"RTN","PSDGSH2",39,0)
 .W ?56,"Qty Dest:",?66,DESTQ,!,"Turn in Date",?16,": ",DESTD,!,"Holding #",?16,": ",DESTH,!,"Reason",?16,": ",DREAS
"RTN","PSDGSH2",40,0)
 .W:DESDP]"" !,"Destroyed by",?16,": ",DESDP W:DESD]"" ?55,"Date Dest:",?66,DESD
"RTN","PSDGSH2",41,0)
 I $D(NODE7) D:$Y+10>IOSL HDR Q:PSDOUT  W !!,?10,"*** TRANSFER BETWEEN NAOUs ***",! D LOOP
"RTN","PSDGSH2",42,0)
 W !
"RTN","PSDGSH2",43,0)
 Q
"RTN","PSDGSH2",44,0)
LOOP ;loop thru transfer between naous
"RTN","PSDGSH2",45,0)
 F JJ=0:0 S JJ=$O(TRN(JJ)) Q:'JJ  D:$Y+8>IOSL HDR Q:PSDOUT  W !,"From NAOU",?16,": ",$P(TRN(JJ),"^"),?56,"Quantity:",?66,$P(TRN(JJ),"^",7),!,"Nurse From",?16,": ",$P(TRN(JJ),"^",3),?56,"Date:",?62,$P(TRN(JJ),"^",2),! D
"RTN","PSDGSH2",46,0)
 .W "To NAOU",?16,": ",$P(TRN(JJ),"^",4),!
"RTN","PSDGSH2",47,0)
 .W "Nurse to",?16,": "
"RTN","PSDGSH2",48,0)
 .W $S($P(TRN(JJ),"^",6)'=0:$P(TRN(JJ),U,6),1:"Not Received Yet"),?56
"RTN","PSDGSH2",49,0)
 .W "Date:",?62,$S($P(TRN(JJ),"^",5)'=0:$P(TRN(JJ),"^",5),1:"*****")
"RTN","PSDGSH2",50,0)
 Q
"RTN","PSDGSH2",51,0)
CHK ;check end of page
"RTN","PSDGSH2",52,0)
 D:$Y+6>IOSL HDR
"RTN","PSDGSH2",53,0)
 Q
"RTN","PSDGSK")
0^87^B9099516
"RTN","PSDGSK",1,0)
PSDGSK ;BIR/CML,JPW-Build Sort Key for NAOUs in Inven. Grp ; 2 Aug 94
"RTN","PSDGSK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGSK",4,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S PSDT=Y K LN S $P(LN,"-",80)=""
"RTN","PSDGSK",5,0)
DIC S DIC="^PSI(58.2,",DIC(0)="AEQ",DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC("S")="I $D(^PSI(58.2,""CS"",+Y))" D ^DIC K DIC G:Y<0 END S INVGRP=+Y D PRINT
"RTN","PSDGSK",6,0)
ASK1 R !!,"Make..... ",X:DTIME S:'$T X="^" G:"^"[X END I $E(X)="?" W !!,"Enter the name of the NAOU you wish to move to another location.",!,"Enter <RET> or ""^"" to EXIT." G ASK1
"RTN","PSDGSK",7,0)
 S DIC="^PSI(58.2,"_INVGRP_",3,",DIC(0)="QEZ" D ^DIC K DIC G:Y<0 ASK1 S NAOUM=Y(0,0),NAOUDA=+Y
"RTN","PSDGSK",8,0)
ASK2 R !,"Follow... ",X:DTIME S:'$T X="^" G:"^"[X END I $E(X)="?" W !!,"Enter the name of the NAOU you wish ",NAOUM," to follow.",!,"Enter <RET> or ""^"" to EXIT.",! G ASK2
"RTN","PSDGSK",9,0)
 S DIC="^PSI(58.2,"_INVGRP_",3,",DIC(0)="QEZ",DIC("S")="I $P(^(0),""^"")'=NAOUDA" D ^DIC K DIC G:Y<0 ASK2
"RTN","PSDGSK",10,0)
NEW S PSDSORT=$P(Y(0),"^",2),PSDSORTN=$O(^PSI(58.2,INVGRP,3,"D",PSDSORT)) I 'PSDSORTN S PSDNSORT=PSDSORT+50
"RTN","PSDGSK",11,0)
 E  S PSDNSORT=PSDSORT+((PSDSORTN-PSDSORT)/2)
"RTN","PSDGSK",12,0)
DIE S DIE="^PSI(58.2,",DA=INVGRP,DR="3///"_NAOUM,DR(2,58.29)="2///"_PSDNSORT D ^DIE I PSDNSORT["." D IGSET^PSDUTL
"RTN","PSDGSK",13,0)
BOTTOM W !!,"Do you wish to print the NAOU List again " S %=2 D YN^DICN I %=0 W !?5,"Enter 'YES' if you wish to see the current AOU sort order for ",!?5,$P(^PSI(58.2,INVGRP,0),"^") G BOTTOM
"RTN","PSDGSK",14,0)
 D:%=1 PRINT G ASK1
"RTN","PSDGSK",15,0)
END K %,%H,%I,%Y,INVGRP,PSDFGRP,PSDNSORT,PSDSORT,PSDSORTN,A,DIC,DIE,DA,DR,DTOUT,X,Y,L,FLDS,BY,FR,TO,DIJ,DP,NAOUM,B,C,D,D0,D1,DI,DISYS,DQ,LN,PSDT,NAOUDA,POP,DHD
"RTN","PSDGSK",16,0)
 Q
"RTN","PSDGSK",17,0)
 ;
"RTN","PSDGSK",18,0)
PRINT S L=0,DIC="^PSI(58.2,",FLDS="NARCOTIC,NARCOTIC",BY="'NUMBER@,NARCOTIC,SORT@",FR=INVGRP,TO=FR,DHD="W ?0 D HDR^PSDGSK" D EN1^DIP
"RTN","PSDGSK",19,0)
 Q
"RTN","PSDGSK",20,0)
HDR W !,"NAOU Inventory Group List",?60,PSDT,!!,"Current NAOU Sort Order for ",$P(^PSI(58.2,INVGRP,0),"^"),!,LN Q
"RTN","PSDGSL")
0^88^B13103325
"RTN","PSDGSL",1,0)
PSDGSL ;BIR/JPW-Review Green Sheet Log ; 29 Aug 94
"RTN","PSDGSL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSL",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGSL",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDGSL",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to view",!,?12,"Green Sheets.  PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDGSL",6,0)
ASKD ;ask disp location
"RTN","PSDGSL",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDGSL",8,0)
 G:$P(PSDSITE,U,5) SORT
"RTN","PSDGSL",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDGSL",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDGSL",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDGSL",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDGSL",13,0)
SORT ;sort gs number or date
"RTN","PSDGSL",14,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DATE RANGE;N:GREEN SHEET NUMBER"
"RTN","PSDGSL",15,0)
 S DIR("A")="Select Sort for Green Sheet Listing"
"RTN","PSDGSL",16,0)
 S DIR("?",1)="Answer 'D' to print for a specific date range or",DIR("?")="answer 'N' to print a range of Green Sheet numbers."
"RTN","PSDGSL",17,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASK=Y
"RTN","PSDGSL",18,0)
 I ASK="N" G GS
"RTN","PSDGSL",19,0)
DATE ;ask date range
"RTN","PSDGSL",20,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDGSL",21,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDGSL",22,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDGSL",23,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDGSL",24,0)
 G DEV
"RTN","PSDGSL",25,0)
GS ;ask gs num range
"RTN","PSDGSL",26,0)
 W !!,"Start with Green Sheet: " R X:DTIME I '$T!(X="")!(X["^") G END
"RTN","PSDGSL",27,0)
 I X'?1.9N W !!,"Please enter your starting Green Sheet number from 1 to 999999999.",! G GS
"RTN","PSDGSL",28,0)
 S PSD1=X
"RTN","PSDGSL",29,0)
GS2 W !!,"End with Green Sheet: " R X:DTIME I '$T!(X="")!(X["^") G END
"RTN","PSDGSL",30,0)
 I X'?1.9N W !!,"Please enter your ending Green Sheet number from 1 to 999999999.",! G GS2
"RTN","PSDGSL",31,0)
 I X'>PSD1 W !!,"Ending GS number must be larger that the starting GS number.",! G GS2
"RTN","PSDGSL",32,0)
 S PSD2=X
"RTN","PSDGSL",33,0)
DEV ;asks device and queueing information
"RTN","PSDGSL",34,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDGSL",35,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDGSL",36,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDGSL",37,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDGSL1",ZTDESC="CS PHARM GREEN SHEET HISTORY" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDGSL",38,0)
 U IO G START^PSDGSL1
"RTN","PSDGSL",39,0)
END K %,%DT,%H,%I,%ZIS,ASK,C,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,OK,POP,PSD1,PSD2,PSDATE,PSDED,PSDEV,PSDOUT,PSDS,PSDSD,PSDSN,X,Y
"RTN","PSDGSL",40,0)
 K ^TMP("PSDGSL",$J)
"RTN","PSDGSL",41,0)
 K ZTDESC,ZTRTN,ZTSAVE,ZTSK D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDGSL",42,0)
 Q
"RTN","PSDGSL",43,0)
SAVE ;sets variables for queueing
"RTN","PSDGSL",44,0)
 S (ZTSAVE("ASK"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDA"),ZTSAVE("NODE"))=""
"RTN","PSDGSL",45,0)
 S:$D(PSDATE) ZTSAVE("PSDATE")="" S:$D(PSDSD) ZTSAVE("PSDSD")=""
"RTN","PSDGSL",46,0)
 S:$D(PSDED) ZTSAVE("PSDED")=""
"RTN","PSDGSL",47,0)
 S:$D(PSD2) ZTSAVE("PSD2")="" S:$D(PSD1) ZTSAVE("PSD1")=""
"RTN","PSDGSL",48,0)
 Q
"RTN","PSDGSL1")
0^89^B11693912
"RTN","PSDGSL1",1,0)
PSDGSL1 ;BIR/JPW-Review Green Sheet Log (cont'd) ; 2 Aug 94
"RTN","PSDGSL1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSL1",3,0)
START ;entry for compile
"RTN","PSDGSL1",4,0)
 K ^TMP("PSDGSL",$J)
"RTN","PSDGSL1",5,0)
 D:ASK="N" GS
"RTN","PSDGSL1",6,0)
 D:ASK="D" DATE
"RTN","PSDGSL1",7,0)
PRINT ;prt data
"RTN","PSDGSL1",8,0)
 K LN S (PSDOUT,PG)=0,$P(LN,"-",132)="" D HDR Q:PSDOUT
"RTN","PSDGSL1",9,0)
 I '$D(^TMP("PSDGSL",$J)) W !!,?15,"*** NO GREEN SHEET DATA ***",!! G DONE
"RTN","PSDGSL1",10,0)
 S PSD="" F  S PSD=$O(^TMP("PSDGSL",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDT="" F  S PSDT=$O(^TMP("PSDGSL",$J,PSD,PSDT)) Q:PSDT=""!(PSDOUT)  F PSDJ=0:0 S PSDJ=$O(^TMP("PSDGSL",$J,PSD,PSDT,PSDJ)) Q:'PSDJ!(PSDOUT)  D
"RTN","PSDGSL1",11,0)
 .Q:PSDOUT
"RTN","PSDGSL1",12,0)
 .S NODE=^TMP("PSDGSL",$J,PSD,PSDT,PSDJ),STATN=$P(NODE,"^"),CSTATN=$P(NODE,"^",2),PSDRN=$P(NODE,"^",3),NAOUN=$P(NODE,"^",4)
"RTN","PSDGSL1",13,0)
 .D:$Y+4>IOSL HDR Q:PSDOUT
"RTN","PSDGSL1",14,0)
 .W !,PSD,?12,PSDRN,?45,PSDT,?78,NAOUN,?90,$E(STATN,1,38),!,?90,$E(CSTATN,1,38),!
"RTN","PSDGSL1",15,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDGSL1",16,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDGSL1",17,0)
END K %,%DT,%H,%I,%ZIS,ASK,CSTAT,CSTATN,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,LOC,NAOU,NAOUN,NODE,OK
"RTN","PSDGSL1",18,0)
 K PG,POP,PSD,PSD1,PSD2,PSDATE,PSDED,PSDEV,PSDJ,PSDL,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDT,STAT,STATN,TYPE,X,Y
"RTN","PSDGSL1",19,0)
 K ^TMP("PSDGSL",$J)
"RTN","PSDGSL1",20,0)
 K ZTDESC,ZTRTN,ZTSAVE,ZTSK D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDGSL1",21,0)
 Q
"RTN","PSDGSL1",22,0)
GS ;green sheet num sort
"RTN","PSDGSL1",23,0)
 S PSD=PSD1-.9999 F  S PSD=$O(^PSD(58.81,"D",PSD)) Q:PSD=""!(PSD>PSD2)  F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"D",PSD,PSDJ)) Q:'PSDJ  D SET
"RTN","PSDGSL1",24,0)
 Q
"RTN","PSDGSL1",25,0)
DATE ;date sort
"RTN","PSDGSL1",26,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"AF",PSD)) Q:'PSD!(PSD>PSDED)  F PSDL=1.99:0 S PSDL=$O(^PSD(58.81,"AF",PSD,+PSDS,PSDL)) Q:'PSDL!(PSDL>5)  F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"AF",PSD,+PSDS,PSDL,PSDJ)) Q:'PSDJ  D SET
"RTN","PSDGSL1",27,0)
 ;F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"AF",PSD)) Q:'PSD!(PSD>PSDED)  F PSDL=2,5 S PSDL=$O(^PSD(58.81,"AF",PSD,PSDS,PSDL)) W !,PSD,"  ",PSDS,"  ",PSDL
"RTN","PSDGSL1",28,0)
 Q
"RTN","PSDGSL1",29,0)
SET ;set data
"RTN","PSDGSL1",30,0)
 Q:'$D(^PSD(58.81,PSDJ,0))  S NODE=^PSD(58.81,PSDJ,0)
"RTN","PSDGSL1",31,0)
 S LOC=+$P(NODE,"^",3) Q:LOC'=+PSDS  S TYPE=+$P(NODE,"^",2) S OK=$S(TYPE=2:1,TYPE=5:1,1:0) Q:'OK
"RTN","PSDGSL1",32,0)
 S PSDPN=$P(NODE,"^",17) Q:PSDPN']""
"RTN","PSDGSL1",33,0)
 S (PSDT,Y)=+$E($P(NODE,"^",4),1,12) X ^DD("DD") S PSDT=Y
"RTN","PSDGSL1",34,0)
 S STAT=+$P(NODE,"^",11),STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDGSL1",35,0)
 Q:STAT=10
"RTN","PSDGSL1",36,0)
 S CSTAT=+$P(NODE,"^",12),CSTATN=$P($G(^PSD(58.83,CSTAT,0)),"^"),NAOU=+$P(NODE,"^",18),NAOUN=$P($G(^PSD(58.8,+NAOU,0)),"^")
"RTN","PSDGSL1",37,0)
 S PSDR=+$P(NODE,"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDGSL1",38,0)
 S ^TMP("PSDGSL",$J,PSDPN,PSDT,PSDJ)=STATN_"^"_CSTATN_"^"_PSDRN_"^"_$E(NAOUN,1,10)
"RTN","PSDGSL1",39,0)
 Q
"RTN","PSDGSL1",40,0)
HDR ;header
"RTN","PSDGSL1",41,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDGSL1",42,0)
 S PG=PG+1
"RTN","PSDGSL1",43,0)
 W:$Y @IOF W !,?20,"CS GREEN SHEET LISTING REPORT",?70,"PAGE: ",PG
"RTN","PSDGSL1",44,0)
 W:ASK="D" !,?20,$P(PSDATE,"^")," to ",$P(PSDATE,"^",2)
"RTN","PSDGSL1",45,0)
 W:ASK="N" !,?20,"GS # ",$G(PSD1)," through ",$G(PSD2)
"RTN","PSDGSL1",46,0)
 W !,?20,"Dispensing Site: ",PSDSN,!
"RTN","PSDGSL1",47,0)
 W !,"GS #",?12,"DRUG",?45,"DATE DISP",?78,"NAOU",?90,"STATUS",!,LN,!
"RTN","PSDGSL1",48,0)
 Q
"RTN","PSDGSPU")
0^90^B11955889
"RTN","PSDGSPU",1,0)
PSDGSPU ;BIR/JPW-Pickup Green Sheet ; 6 July 94
"RTN","PSDGSPU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSPU",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGSPU",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):2,1:0)
"RTN","PSDGSPU",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to return",!,?12,"Green Sheets.  PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDGSPU",6,0)
 W ?10,!!,"Return a Green Sheet to Pharmacy",! S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDGSPU",7,0)
ASKD ;ask disp location
"RTN","PSDGSPU",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDGSPU",9,0)
 G:$P(PSDSITE,U,5) GS
"RTN","PSDGSPU",10,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDGSPU",11,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDGSPU",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDGSPU",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDGSPU",14,0)
GS ;select green sheet #
"RTN","PSDGSPU",15,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDGSPU",16,0)
 S:OK=1 DIC("S")="I $P(^(0),""^"",3)=+PSDS,$S($P(^(0),""^"",11)=4:1,$P(^(0),""^"",11)=5:1,1:0)"
"RTN","PSDGSPU",17,0)
 S:OK=2 DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",11)=5" D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDGSPU",18,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDGSPU",19,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDGSPU",20,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDGSPU",21,0)
 I OK=2,STAT'=5 W !!,"This order has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDGSPU",22,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDGSPU",23,0)
RET ;return gs
"RTN","PSDGSPU",24,0)
 W !!,"Accessing ",PSDRN," information...",!
"RTN","PSDGSPU",25,0)
 ;update transaction file (58.81)
"RTN","PSDGSPU",26,0)
 S NURSE=+$P($G(^PSD(58.81,PSDA,1)),"^",10)
"RTN","PSDGSPU",27,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="31//^S X=RECDT;32//^S X=PSDUZN;I NURSE S Y=10;29;10////6" D ^DIE K DA,DIE,DR
"RTN","PSDGSPU",28,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN PICKED UP **",!!,"The status remains "_STATN,! G END
"RTN","PSDGSPU",29,0)
 ;update order info in 58.8
"RTN","PSDGSPU",30,0)
 W !!,"Updating your records now..."
"RTN","PSDGSPU",31,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////6" D ^DIE K DA,DIE,DR
"RTN","PSDGSPU",32,0)
 W "done.",!!
"RTN","PSDGSPU",33,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDGSPU",34,0)
 G GS
"RTN","PSDGSPU",35,0)
END K %,%DT,%H,%I,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDGSPU",36,0)
 K NAOU,NAOUN,NURSE,OK,ORD,PSDA,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDUZ,PSDUZN,RECDT,STAT,STATN,X,Y
"RTN","PSDGSPU",37,0)
 Q
"RTN","PSDGSRV")
0^91^B21185314
"RTN","PSDGSRV",1,0)
PSDGSRV ;BIR/JPW-Review and Complete Green Sheet ; 6 July 94
"RTN","PSDGSRV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSRV",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDGSRV",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDGSRV",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to complete",!,?12,"Green Sheets.  PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDGSRV",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH Q
"RTN","PSDGSRV",7,0)
 N X,X1 D SIG^XUSESIG Q:X1=""
"RTN","PSDGSRV",8,0)
ASKD ;ask disp location
"RTN","PSDGSRV",9,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDGSRV",10,0)
 G:$P(PSDSITE,U,5) GS
"RTN","PSDGSRV",11,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDGSRV",12,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDGSRV",13,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDGSRV",14,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDGSRV",15,0)
GS ;select green sheet #
"RTN","PSDGSRV",16,0)
 W !!,"Complete a Green Sheet" S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDGSRV",17,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",11)<10!($P(^(0),U,11)=13)!($P(^(0),U,11)=12)",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDGSRV",18,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y,NODE=Y(0)
"RTN","PSDGSRV",19,0)
 S STAT=+$P(NODE,"^",11),PSDPN=$P(NODE,"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDGSRV",20,0)
 I (STAT<4)!(STAT>8)!(STAT=7)&(STAT'=13)&(STAT'=12) W !!,"This order has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",! D MSG G END
"RTN","PSDGSRV",21,0)
 I STAT=4 D QUES G:NOK GS
"RTN","PSDGSRV",22,0)
 S ORD=+$P(NODE,"^",20),NAOU=+$P(NODE,"^",18),PSDR=+$P(NODE,"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),(COMP,OCOMP)=+$P(NODE,"^",12),QTY=+$P(NODE,"^",6)
"RTN","PSDGSRV",23,0)
 S CPBY=+$P($G(^PSD(58.81,PSDA,1)),"^",14)
"RTN","PSDGSRV",24,0)
 I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDGSRV",25,0)
 S NBKU=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),"^",8)
"RTN","PSDGSRV",26,0)
START ;start processing
"RTN","PSDGSRV",27,0)
 S PSDOUT=0
"RTN","PSDGSRV",28,0)
 W ! K DA,DIC S DIC=58.83,DIC(0)="QEA",DIC("A")="Select Completion Status: " S:COMP DIC("B")=COMP S:'$D(^XUSEC("PSJ RPHARM",PSDUZ)) DIC("S")="I $S(Y=2:0,Y=3:0,1:1)"
"RTN","PSDGSRV",29,0)
 D ^DIC K DIC I Y<0 G END
"RTN","PSDGSRV",30,0)
 S COMP=+Y,CSTAT=$S(COMP=1:7,COMP=2:7,COMP=3:7,1:8)
"RTN","PSDGSRV",31,0)
 ;perpetual inventory?
"RTN","PSDGSRV",32,0)
 S:$G(COMP)=1&($P($G(^PSD(58.8,$G(NAOU),2)),U,5))&('$P($G(^PSD(58.8,+PSDS,1,+PSDR,7)),U,3)) CSTAT=13
"RTN","PSDGSRV",33,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to update the status",DIR("?")="or 'NO' to select another status."
"RTN","PSDGSRV",34,0)
 S DIR("B")="YES" D ^DIR K DIR G:$D(DIRUT) END I 'Y G START
"RTN","PSDGSRV",35,0)
 I (COMP=3)!(COMP=2) G ^PSDGSRV1
"RTN","PSDGSRV",36,0)
UPDATE ;up 58.81
"RTN","PSDGSRV",37,0)
 W !!,"Accessing Green Sheet information...",!
"RTN","PSDGSRV",38,0)
 D NOW^%DTC S (RECDT,Y)=+%
"RTN","PSDGSRV",39,0)
 S NURSE=$P($G(^PSD(58.81,PSDA,1)),"^",10)
"RTN","PSDGSRV",40,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="I NURSE S Y=22;29;22////"_+$E(RECDT,1,12)_";33////"_PSDUZ_";10////"_CSTAT_";11////"_COMP_";I X'=6 S Y=""@1"";72;@1"
"RTN","PSDGSRV",41,0)
 D ^DIE K DA,DIE,DR S PSDDT=$P($G(^PSD(58.81,PSDA,0)),"^",19)
"RTN","PSDGSRV",42,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"*** THIS GREEN SHEET HAS NOT BEEN COMPLETED ***",!!,"The status remains "_STATN,! S PSDOUT=1 G END
"RTN","PSDGSRV",43,0)
ORDER ;update drug balance & order info in 58.8 
"RTN","PSDGSRV",44,0)
 W !!,"Updating your records now..."
"RTN","PSDGSRV",45,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////"_CSTAT_";11////"_COMP_";12////"_PSDDT D ^DIE K DA,DIE,DR
"RTN","PSDGSRV",46,0)
 I STAT=8 W "completion log..." S TYPE=4 D ^PSDCOR3
"RTN","PSDGSRV",47,0)
 W "done.",!!
"RTN","PSDGSRV",48,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,"*** The status of your Green Sheet #"_PSDPN_" *** ",!
"RTN","PSDGSRV",49,0)
 S CSTAT=$P($G(^PSD(58.81,PSDA,0)),"^",12) W ?6,$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),!,?6,$P($G(^PSD(58.83,CSTAT,0)),"^")
"RTN","PSDGSRV",50,0)
 G GS
"RTN","PSDGSRV",51,0)
END K %,%DT,%H,%I,C,COMP,CPBY,CSTAT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT
"RTN","PSDGSRV",52,0)
 K NAOU,NBKU,NODE,NOK,NURSE,OCOMP,OK,ORD,PSDA,PSDDT,PSDEV,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDUZ,PSDUZN,QTY,RECD,RECDT,STAT,STATN,SUB,TYPE,X,Y
"RTN","PSDGSRV",53,0)
 Q
"RTN","PSDGSRV",54,0)
QUES ;ask ok if still active
"RTN","PSDGSRV",55,0)
 S NOK=0
"RTN","PSDGSRV",56,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A",1)="This Green Sheet is still ACTIVE on the NAOU.",DIR("A")="Do you want to continue"
"RTN","PSDGSRV",57,0)
 S DIR("?",1)="Answer 'YES' to continue completing this Green Sheet",DIR("?")="or 'NO' to abort processing and select another Green Sheet."
"RTN","PSDGSRV",58,0)
 D ^DIR K DIR I $D(DIRUT) S NOK=1 G MSG
"RTN","PSDGSRV",59,0)
 Q:Y
"RTN","PSDGSRV",60,0)
 I 'Y S NOK=1
"RTN","PSDGSRV",61,0)
MSG W !!,"** No action taken. **",!
"RTN","PSDGSRV",62,0)
 Q
"RTN","PSDGSRV1")
0^92^B27359779
"RTN","PSDGSRV1",1,0)
PSDGSRV1 ;BIR/JPW-Complete GS for Ret Stk/Destroy ; 16 Aug 94
"RTN","PSDGSRV1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSRV1",3,0)
QTY ;
"RTN","PSDGSRV1",4,0)
 W ! K DIR,DIRUT S DIR(0)="NA^"_$S(COMP=3:1,1:.01)_":"_QTY_":"_$S(COMP=3:0,1:2)
"RTN","PSDGSRV1",5,0)
 S DIR("A")="Quantity of "_NBKU_" "_$S(COMP=3:"Returned to Stock",1:"Turned in for Destruction")_": "
"RTN","PSDGSRV1",6,0)
 S DIR("?")="Enter a quantity from "_$S(COMP=3:1,1:.01)_" to "_QTY
"RTN","PSDGSRV1",7,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG G END
"RTN","PSDGSRV1",8,0)
 S RQTY=+Y K DIRUT
"RTN","PSDGSRV1",9,0)
ASKN K DA,DIR,DTOUT,DUOUT S DIR("A")="RETURNED BY NURSE",DIR(0)="58.81,29O" D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MSG G END
"RTN","PSDGSRV1",10,0)
 S NURS=$P(Y,"^") I NURS S NURSN=$P($G(^VA(200,+NURS,0)),"^")
"RTN","PSDGSRV1",11,0)
REAS K DA,DIR,DTOUT,DUOUT S DIR(0)=$S(COMP=3:"58.81,36O",1:"58.81,39O") D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) D MSG G END
"RTN","PSDGSRV1",12,0)
 S REAS=Y
"RTN","PSDGSRV1",13,0)
OK K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Is this OK",DIR("B")="YES"
"RTN","PSDGSRV1",14,0)
 S DIR("?",1)="Answer 'YES' to post this completed Green Sheet data,",DIR("?")="answer 'NO' to edit or '^' to quit."
"RTN","PSDGSRV1",15,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDGSRV1",16,0)
 I 'Y G QTY
"RTN","PSDGSRV1",17,0)
UPDATE ;update 58.81
"RTN","PSDGSRV1",18,0)
 W !!,"Accessing Green Sheet information...",!
"RTN","PSDGSRV1",19,0)
 D NOW^%DTC S RECDT=+% D:COMP=3 SUB
"RTN","PSDGSRV1",20,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81
"RTN","PSDGSRV1",21,0)
 S:COMP=3 DR="34////"_RECDT_";35////"_RQTY_";41////"_BAL_";33////"_PSDUZ_";10////"_CSTAT_";11////"_COMP_";22////"_+$E(RECDT,1,12)_";29////"_NURS_";36///"_REAS
"RTN","PSDGSRV1",22,0)
 S:COMP=2 DR="37////"_RECDT_";38////"_RQTY_";33////"_PSDUZ_";10////"_CSTAT_";11////"_COMP_";22////"_+$E(RECDT,1,12)_";29////"_NURS_";39///"_REAS
"RTN","PSDGSRV1",23,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDGSRV1",24,0)
 W !!,"Updating your records..."
"RTN","PSDGSRV1",25,0)
ORDER ;update order info in 58.8
"RTN","PSDGSRV1",26,0)
 W "nursing records now..."
"RTN","PSDGSRV1",27,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////"_CSTAT_";11////"_COMP_";12////"_RECDT D ^DIE K DA,DIE,DR
"RTN","PSDGSRV1",28,0)
 ;monthly total
"RTN","PSDGSRV1",29,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDGSRV1",30,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DIC S DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=+PSDS,DA(1)=PSDR D ^DIC K DIC,DA,DINUM,DLAYGO
"RTN","PSDGSRV1",31,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DA(2)=+PSDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR=$S(COMP=3:"11////^S X=$P($G(^(0)),""^"",7)+RQTY",1:"12////^S X=$P($G(^(0)),""^"",8)+RQTY") D ^DIE K DA,DIE,DR
"RTN","PSDGSRV1",32,0)
 W "done.",!!
"RTN","PSDGSRV1",33,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,"*** The status of your Green Sheet #"_PSDPN_" *** ",!
"RTN","PSDGSRV1",34,0)
 S CSTAT=$P($G(^PSD(58.81,PSDA,0)),"^",12) W ?6,$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" "_$P($G(^PSD(58.83,CSTAT,0)),"^")
"RTN","PSDGSRV1",35,0)
 I COMP=3 S MFG=$P(^PSD(58.81,PSDA,0),"^",13),LOT=$P(^(0),"^",14),EXP=$P(^(0),"^",15) D PRINT G END
"RTN","PSDGSRV1",36,0)
 I COMP=2 D DEST
"RTN","PSDGSRV1",37,0)
END K %,%DT,%H,%I,BAL,C,COMP,CPBY,CSTAT,D,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT
"RTN","PSDGSRV1",38,0)
 K EXP,LOT,MFG,NAOU,NBKU,NODE,NOK,NUM,NURS,NURSN,OCOMP,OK,ORD,PG,POP,PSDA,PSDCT,PSDEV,PSDHLD,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDTYP,PSDUZ,PSDUZN
"RTN","PSDGSRV1",39,0)
 K QTY,REAS,RECD,RECDT,RQTY,STAT,STATN,SUB,X,Y
"RTN","PSDGSRV1",40,0)
 Q
"RTN","PSDGSRV1",41,0)
MSG ;
"RTN","PSDGSRV1",42,0)
 W $C(7),!!,"*** THIS GREEN SHEET HAS NOT BEEN COMPLETED ***",!,"The status remains "_STATN,! S PSDOUT=1 Q
"RTN","PSDGSRV1",43,0)
 Q
"RTN","PSDGSRV1",44,0)
SUB ;add balance
"RTN","PSDGSRV1",45,0)
 F  L +^PSD(58.8,+PSDS,1,PSDR,0):0 I  Q
"RTN","PSDGSRV1",46,0)
 D NOW^%DTC S RECDT=+%
"RTN","PSDGSRV1",47,0)
 S BAL=+$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)
"RTN","PSDGSRV1",48,0)
 S $P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4)+RQTY
"RTN","PSDGSRV1",49,0)
 L -^PSD(58.8,+PSDS,1,PSDR,0)
"RTN","PSDGSRV1",50,0)
 W !!,"Old Balance: ",BAL,?25,"New Balance: ",BAL+RQTY,!!
"RTN","PSDGSRV1",51,0)
 Q
"RTN","PSDGSRV1",52,0)
DEST ;set up file 58.86
"RTN","PSDGSRV1",53,0)
 S PSDOUT=0,PSDCT=1
"RTN","PSDGSRV1",54,0)
 W !!,"Accessing your transaction history...",!!
"RTN","PSDGSRV1",55,0)
 S NODE=^PSD(58.81,PSDA,0),PSDTYP=$P(NODE,"^",2),(MFG,LOT,EXP)=""
"RTN","PSDGSRV1",56,0)
 I PSDTYP=9 S COMP=2,REAS=$P(NODE,"^",16),RECDT=$E($P(NODE,"^",4),1,12),RQTY=$P(NODE,"^",6),RQTY=$E(RQTY,2,6),PSDS=$P(NODE,"^",3)
"RTN","PSDGSRV1",57,0)
 I  S PSDR=$P(NODE,"^",5),PSDRN=$P($G(^PSDRUG(+PSDR,0)),"^"),PSDUZ=DUZ,NBKU=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),"^",8)
"RTN","PSDGSRV1",58,0)
 I PSDTYP=2 S REAS=$P($G(^PSD(58.81,PSDA,3)),"^",6),MFG=$P(NODE,"^",13),LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15)
"RTN","PSDGSRV1",59,0)
 W !!,"Creating an entry in the Destruction file..."
"RTN","PSDGSRV1",60,0)
 F  L +^PSD(58.86,0):0 I  Q
"RTN","PSDGSRV1",61,0)
FIND S PSDHLD=$P(^PSD(58.86,0),"^",3)+1 I $D(^PSD(58.86,PSDHLD)) S $P(^PSD(58.86,0),"^",3)=PSDHLD G FIND
"RTN","PSDGSRV1",62,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.86,DIC(0)="L",(X,DINUM)=PSDHLD D ^DIC K DIC,DLAYGO
"RTN","PSDGSRV1",63,0)
 L -^PSD(58.86,0)
"RTN","PSDGSRV1",64,0)
 W !!,"Your Destruction Holding number is ",PSDHLD
"RTN","PSDGSRV1",65,0)
 K DA,DIE,DR S DIE=58.86,DA=PSDHLD,DR="1////"_PSDR_";2////"_RQTY_";3////"_PSDUZ_";5////"_RECDT_";6////"_PSDS_";8////"_PSDA_";"_$S($D(NURSN):"4//^S X=NURSN",1:"4")_";11//^S X=PSDCT;12//^S X=NBKU"
"RTN","PSDGSRV1",66,0)
 D ^DIE K DIE,DA,DR S $P(^PSD(58.81,PSDA,3),"^",8)=PSDHLD
"RTN","PSDGSRV1",67,0)
 I $D(DTOUT)!$D(Y) W !!,"Incomplete information.  You must use the Reprint Disp/Receiving Report",!,"for VA FORM 10-2321 to be printed.",! Q
"RTN","PSDGSRV1",68,0)
PRINT ;print 2321
"RTN","PSDGSRV1",69,0)
 W !!,"Number of copies of VA FORM 10-2321? " R NUM:DTIME I '$T!(NUM="^")!(NUM="") W !!,"No copies printed!!",!! Q
"RTN","PSDGSRV1",70,0)
 I NUM'?1N!(NUM=0)  W !!,"Enter a whole number between 1 and 9",! G PRINT
"RTN","PSDGSRV1",71,0)
 S PG=0,RECDT=$E(RECDT,4,5)_"/"_$E(RECDT,6,7)_"/"_$E(RECDT,2,3) S:EXP EXP=$E(EXP,4,5)_"/"_$E(EXP,2,3) D ^PSDGSRV2
"RTN","PSDGSRV1",72,0)
 Q
"RTN","PSDGSRV2")
0^93^B21258816
"RTN","PSDGSRV2",1,0)
PSDGSRV2 ;BIR/BJW-Print(VA FORM 10-2321) for Ret Stk/Destroy ; 20 SEP 96
"RTN","PSDGSRV2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDGSRV2",3,0)
DEV ;asks device and queueing information
"RTN","PSDGSRV2",4,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDGSRV2",5,0)
 I $G(OK)'=1 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDGSRV2",6,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=$G(PSDEV) D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" Q
"RTN","PSDGSRV2",7,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDGSRV2",ZTDESC="CS PHARM Print (VA FORM 10-2321) RET/DEST/TRANS" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDGSRV2",8,0)
 U IO
"RTN","PSDGSRV2",9,0)
 ;5/16/96 added test for temp. file created in psdesto
"RTN","PSDGSRV2",10,0)
START K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDESTO",$J)) F JJ=1:1:NUM D PRINT
"RTN","PSDGSRV2",11,0)
 I $D(^TMP("PSDESTO",$J)) D PRTMP
"RTN","PSDGSRV2",12,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDGSRV2",13,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDGSRV2",14,0)
END ;
"RTN","PSDGSRV2",15,0)
 K %ZIS,C,COMP,CPBY,EXP,JJ,LN,LOT,MFG,NBKU,NODE,NUM,OCOMP,PG,POP,PSDA,PSDCOMS,PSDCT,PSDEV,PSDHLD,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDTYP,PSDUZ,REAS,RECDT,RQTY,X,Y,ZTDESC,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSDGSRV2",16,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDGSRV2",17,0)
 Q
"RTN","PSDGSRV2",18,0)
PRINT ;print 2321 for ret/stk and destroys(psdcoms added for e3r# 3771)
"RTN","PSDGSRV2",19,0)
 S PG=PG+1 W:$Y @IOF W:$D(REPRINT) !,?55,"*** REPRINT ***" W !,?5,"VA FORM 10-2321",?42,"Narcotic Dispensing/Receiving Report for ",$P($G(^PSD(58.8,+PSDS,0)),"^")
"RTN","PSDGSRV2",20,0)
 W ?120,"Page: ",PG,!,?52,RECDT,!
"RTN","PSDGSRV2",21,0)
 W !,?14,"DATE",?78,"DATE"
"RTN","PSDGSRV2",22,0)
 W !,"DISP #",?12,"DISPENSED",?24,"QTY",?33,"DRUG",?78,"ORD",?90,"ORDERED BY"
"RTN","PSDGSRV2",23,0)
 W !,LN,!!
"RTN","PSDGSRV2",24,0)
 W:$D(PSDHLD) ?5,"Destruction # ",PSDHLD,!!
"RTN","PSDGSRV2",25,0)
 W:$D(PSDPN) PSDPN W ?12,RECDT,?24,RQTY,?33,PSDRN
"RTN","PSDGSRV2",26,0)
 I (MFG]"")!(LOT]"")!(EXP]"") W !,?33,"Mfg/Lot #/Exp Date:  ",MFG_"  "_LOT_"  "_EXP,!
"RTN","PSDGSRV2",27,0)
 W !!,?7,$S($D(PSDOK):"Witnessed",1:"Disp")," by:___________________________________",?61,$S($D(PSDOK):"Witnessed",1:"Rec'd")," by:___________________________________"
"RTN","PSDGSRV2",28,0)
 W !,?15,"(Full Name)",?69,"(Full Name)",!
"RTN","PSDGSRV2",29,0)
 W:$D(PSDCOMS) !,?16,"COMMENTS: ",PSDCOMS
"RTN","PSDGSRV2",30,0)
 I $D(COMP) W !!!,?15,"*** ",$S(COMP=999:"TRANSFERRED BETWEEN NAOUs",COMP=3:"RETURNED TO STOCK",1:"TURNED IN FOR DESTRUCTION")," ***  ",REAS I $D(AOUN),$D(NAOUTN) W " from "_AOUN_" to "_NAOUTN
"RTN","PSDGSRV2",31,0)
 W !
"RTN","PSDGSRV2",32,0)
 Q
"RTN","PSDGSRV2",33,0)
HDR ;5/16/96 added Hdr,Prtmp for ret/stk or destroys
"RTN","PSDGSRV2",34,0)
 S PG=PG+1 W:$Y @IOF W:$D(REPRINT) !,?55,"*** REPRINT ***" W !,?5,"VA FORM 10-2321",?42,"Narcotic Dispensing/Receiving Report for ",$P($G(^PSD(58.8,+PSDS,0)),"^")
"RTN","PSDGSRV2",35,0)
 W ?120,"Page: ",PG,!,?52,RECDT,!
"RTN","PSDGSRV2",36,0)
 W !,?14,"DATE",?78,"DATE"
"RTN","PSDGSRV2",37,0)
 W !,"DISP #",?12,"DISPENSED",?24,"QTY",?33,"DRUG",?78,"ORD",?90,"ORDERED BY"
"RTN","PSDGSRV2",38,0)
 W !,LN,!!
"RTN","PSDGSRV2",39,0)
 Q
"RTN","PSDGSRV2",40,0)
PRTMP ; print 2321 fr temp file
"RTN","PSDGSRV2",41,0)
 S PSDHLD=""
"RTN","PSDGSRV2",42,0)
 F JJ=1:1:NUM F  S PSDHLD=$O(^TMP("PSDESTO",$J,PSDHLD)) Q:PSDHLD=""  S NODE=^TMP("PSDESTO",$J,PSDHLD) D HDR D
"RTN","PSDGSRV2",43,0)
 .I PSDHLD="" Q
"RTN","PSDGSRV2",44,0)
 .W ?5,"Destruction # ",PSDHLD W !!,?12,$P(NODE,"^",2),?24,$P(NODE,"^",4),?33,$P(NODE,"^",3)
"RTN","PSDGSRV2",45,0)
 .I (MFG]"")!(LOT]"")!(EXP]"") W !,?33,"Mfg/Lot #/Exp Date:  ",MFG_"  "_LOT
"RTN","PSDGSRV2",46,0)
 .W !!,?7,$S($D(PSDOK):"Witnessed",1:"Disp")," by:_____________________________________",?61,$S($D(PSDOK):"Witnessed",1:"Rec'd")," by:____________________________________"
"RTN","PSDGSRV2",47,0)
 .W !,?15,"(Full Name)",?69,"(Full Name)",!
"RTN","PSDGSRV2",48,0)
 .W !,?16,"COMMENTS: ",$P(NODE,"^",5)
"RTN","PSDGSRV2",49,0)
 .I $D(COMP) W !!!,?15,"*** ",$S(COMP=999:"TRANSFERRED BETWEEN NAOUs",COMP=3:"RETURNED TO STOCK",1:"TURNED IN FOR DESTRUCTION")," ***  ",REAS I $D(AOUN),$D(NAOUTN) W " from "_AOUN_" to "_NAOUTN
"RTN","PSDGSRV2",50,0)
 Q
"RTN","PSDGSRV2",51,0)
SAVE ;
"RTN","PSDGSRV2",52,0)
 S (ZTSAVE("REAS"),ZTSAVE("PG"),ZTSAVE("MFG"),ZTSAVE("LOT"),ZTSAVE("EXP"),ZTSAVE("RECDT"),ZTSAVE("PSDCOMS"),ZTSAVE("PSDRN"),ZTSAVE("NUM"),ZTSAVE("RECDT"),ZTSAVE("RQTY"))=""
"RTN","PSDGSRV2",53,0)
 S:$D(PSDPN) ZTSAVE("PSDPN")="" S:$D(PSDHLD) ZTSAVE("PSDHLD")=""
"RTN","PSDGSRV2",54,0)
 S:$D(PSDS) ZTSAVE("PSDS")="" S:$D(COMP) ZTSAVE("COMP")=""
"RTN","PSDGSRV2",55,0)
 S:$D(AOUN) ZTSAVE("AOUN")="" S:$D(NAOUTN) ZTSAVE("NAOUTN")=""
"RTN","PSDGSRV2",56,0)
 S:$D(REPRINT) ZTSAVE("REPRINT")=""
"RTN","PSDGSRV2",57,0)
 S:$D(PSDOK) ZTSAVE("PSDOK")=""
"RTN","PSDGSRV2",58,0)
 S:$D(PSDCOMS) ZTSAVE("PSDCOMS")=""
"RTN","PSDGSRV2",59,0)
 S ZTSAVE("^TMP(""PSDESTO"",$J,")=""
"RTN","PSDGSRV2",60,0)
 Q
"RTN","PSDHELP")
0^94^B220355
"RTN","PSDHELP",1,0)
PSDHELP ;B'ham ISC/LTL - CS online documentation ; 10 May 95
"RTN","PSDHELP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHELP",3,0)
 N DIR,DIRUT,XQH,XQHFY,X,Y
"RTN","PSDHELP",4,0)
 S DIR(0)="S^1:VIEW HELP;2:PRINT HELP"
"RTN","PSDHELP",5,0)
 D ^DIR G:'Y QUIT
"RTN","PSDHELP",6,0)
 S XQH="PSD NURSE" I Y=1 D EN^XQH G QUIT
"RTN","PSDHELP",7,0)
 S XQHFY=XQH D ACTION^XQH4
"RTN","PSDHELP",8,0)
QUIT Q
"RTN","PSDHL7")
0^95^B11040623
"RTN","PSDHL7",1,0)
PSDHL7 ;BIR/LTL-HL7 inteface for Control Subs invoked by post init ; 21 Feb 95
"RTN","PSDHL7",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHL7",3,0)
CHECK ;check for Narcotic Dispensing Equipment System/HL7 interface
"RTN","PSDHL7",4,0)
 N DA,DIC,DIE,DIR,DIRUT,DLAYGO,DR,PSD,X,Y
"RTN","PSDHL7",5,0)
 S DIR(0)="Y"
"RTN","PSDHL7",6,0)
 S DIR("A",1)="Do you want to enter/edit your interface setup"
"RTN","PSDHL7",7,0)
 S DIR("A")="for Narcotic Dispensing Equipment Systems",DIR("B")="No"
"RTN","PSDHL7",8,0)
 S DIR("?")="^N XQH S XQH=""PSD HL7"" D EN^XQH"
"RTN","PSDHL7",9,0)
 D ^DIR K DIR G:Y'=1 END D:Y=1
"RTN","PSDHL7",10,0)
 .W !!,"First, I'll check for a PSD-CS entry in your",!
"RTN","PSDHL7",11,0)
 .W "HL7 DHCP APPLICATION PARAMETER file (#771)."
"RTN","PSDHL7",12,0)
 .S (DIC,DIE)="^HL(771,",DIC(0)="L",DLAYGO=771,X="PSD-CS"
"RTN","PSDHL7",13,0)
 .D ^DIC K DIC W:$P(Y,U,3) "  Added." I Y<0 W "Failed." G END
"RTN","PSDHL7",14,0)
 .W "  Updating." S PSDC=+Y
"RTN","PSDHL7",15,0)
 .S DIC="^DIC(4,",DR=99,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDHL7",16,0)
 .D EN^DIQ1 S PSD=PSD(4,DA,99) K DIC,DR,DA,DIQ
"RTN","PSDHL7",17,0)
 .S DA=PSDC,PSD(1)="^~\&"
"RTN","PSDHL7",18,0)
 .S DR="2////a;3////"_PSD_";100////|;101////^S X=PSD(1)"
"RTN","PSDHL7",19,0)
 .D ^DIE K DIE,DR
"RTN","PSDHL7",20,0)
 .;S DIC="^HL(771,"_PSD_",""MSG"",",DIC(0)="L",DA(1)=PSD,X="DFT"
"RTN","PSDHL7",21,0)
 .;S DIC("P")=$P(^DD(771,6,0),"^",2),DIC("DR")="1////PSDFT"
"RTN","PSDHL7",22,0)
 .;D ^DIC K DA,DIC
"RTN","PSDHL7",23,0)
 .W !!,"Now, let's check for a PSD-NDES entry in your",!
"RTN","PSDHL7",24,0)
 .W "HL7 DHCP APPLICATION PARAMETER file (#771)."
"RTN","PSDHL7",25,0)
 .S (DIC,DIE)="^HL(771,",DIC(0)="L",DLAYGO=771,X="PSD-NDES"
"RTN","PSDHL7",26,0)
 .D ^DIC K DIC W:$P(Y,U,3) " Added." I Y<0 W "Failed." G END
"RTN","PSDHL7",27,0)
 .W "  Updating.",!! S (DA,PSDN)=+Y
"RTN","PSDHL7",28,0)
 .;S DR="2////"_PSD_";3////PSD-NDES;4////245;5////3;7////1;8////"_PSD_";9////30;14////P;100///Narcotic Dispensing Equipment System" D ^DIE
"RTN","PSDHL7",29,0)
 .S DR="2////a;3////PSD-NDES" D ^DIE K DIE,DR,DLAYGO,DIC,PSD
"RTN","PSDHL7",30,0)
PROTO ;Pick HLLP or X3.28 protocol
"RTN","PSDHL7",31,0)
 S DIR(0)="S^H:Hybrid Lower Layer Protocol;X:X3.28 Protocol"
"RTN","PSDHL7",32,0)
 S DIR("A")="Select a communications protocol",DIR("B")="H"
"RTN","PSDHL7",33,0)
 S DIR("?")="Select the protocol that your Pharmacy's narcotic dispensing system vendor will use for communication." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDHL7",34,0)
 G:Y="X" ^PSDHLX
"RTN","PSDHL7",35,0)
 S PSD="PSD-NDES HLLP",PSD(1)="PSD HLLP"
"RTN","PSDHL7",36,0)
HLLP W !!,"Let's check for a ",PSD," entry in your",!
"RTN","PSDHL7",37,0)
 W "HL LOWER LEVEL PROTOCOL PARAMETER file (#869.2)."
"RTN","PSDHL7",38,0)
 S (DIC,DIE)="^HLCS(869.2,",DIC(0)="L",DLAYGO=869.2,X=PSD
"RTN","PSDHL7",39,0)
 D ^DIC K DIC W:$P(Y,U,3) "Added." I Y<0 W "Failed." G END
"RTN","PSDHL7",40,0)
 W "  Updating.",!! S (DA,PSDX)=+Y
"RTN","PSDHL7",41,0)
 S DR=".02////2;200.08////21;200.01//" D ^DIE
"RTN","PSDHL7",42,0)
 W !!,"Let's check for a ",PSD(1)," entry in your"
"RTN","PSDHL7",43,0)
 W !,"HL LOGICAL LINK file (#870)."
"RTN","PSDHL7",44,0)
 S (DIC,DIE)="^HLCS(870,",DIC(0)="L",DLAYGO=870,X=PSD(1)
"RTN","PSDHL7",45,0)
 D ^DIC K DIC W:$P(Y,U,3) "Added." I Y<0 W "Failed." Q
"RTN","PSDHL7",46,0)
 W "  Updating." S (DA,PSDL)=+Y
"RTN","PSDHL7",47,0)
 S DR="2////"_$G(PSDX) D ^DIE K DIC,DA,DIE,DR,DLAYGO D NONK^PSDHLP
"RTN","PSDHL7",48,0)
 S DIR(0)="Y",DIR("A")="Do you need to set up another LOGICAL LINK"
"RTN","PSDHL7",49,0)
 S DIR("B")="No",DIR("?")="Are you a consolidated site?  Do you have more than one host?" W ! D ^DIR K DIR I Y=1 S PSD(3)=$G(PSD(3))+1,PSD=PSD_PSD(3),PSD(1)=PSD(1)_PSD(3) G HLLP
"RTN","PSDHL7",50,0)
END Q
"RTN","PSDHLK")
0^257^B1490477
"RTN","PSDHLK",1,0)
PSDHLK ;BIR/LTL-HL7 inteface for Control Subs invoked by post init ; 21 Feb 95
"RTN","PSDHLK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHLK",3,0)
CHECK ;check for Narcotic Dispensing Equipment System/HL7 interface
"RTN","PSDHLK",4,0)
 N DA,DIC,DIE,DLAYGO,DR,PSD,PSDC,PSDN,X,Y
"RTN","PSDHLK",5,0)
 D:XPDQUES("POS1")=1  G:XPDQUES("POS1")'=1 END
"RTN","PSDHLK",6,0)
 .D MES^XPDUTL("  Updating FACILITY NAME for PSD-CS entry in file #771.")
"RTN","PSDHLK",7,0)
 .S DIC="^DIC(4,",DR=99,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDHLK",8,0)
 .D EN^DIQ1 S PSD=PSD(4,DA,99) K DIC,DR,DIQ,DA
"RTN","PSDHLK",9,0)
 .S DIE="^HL(771,",DA=$O(^HL(771,"B","PSD-CS",0))
"RTN","PSDHLK",10,0)
 .S DR="3////"_PSD
"RTN","PSDHLK",11,0)
 .D ^DIE K DIE,DR,DA,PSD
"RTN","PSDHLK",12,0)
PROTO ;Picked HLLP or X3.28 protocol
"RTN","PSDHLK",13,0)
 G:XPDQUES("POS2")="X" ^PSDHLY
"RTN","PSDHLK",14,0)
HLLP D:XPDQUES("POS2")="H"
"RTN","PSDHLK",15,0)
 .S DIE="^HLCS(869.2,",DA=$O(^HLCS(869.2,"B","PSD-NDES HLLP",0))
"RTN","PSDHLK",16,0)
 .D MES^XPDUTL("  Updating DEVICE for PSD-NDES HLLP entry in file #869.2.")
"RTN","PSDHLK",17,0)
 .S DR="200.01////"_+$G(XPDQUES("POS4")) D ^DIE
"RTN","PSDHLK",18,0)
 K DA,DIE,DR
"RTN","PSDHLK",19,0)
END Q
"RTN","PSDHLP")
0^258^B2229203
"RTN","PSDHLP",1,0)
PSDHLP ;BIR/LTL-HL7 inteface setup for logical links on protocols ; 21 Feb 95
"RTN","PSDHLP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHLP",3,0)
NONK ;non-kids type call by ^PSDHL7 & ^PSDHLX
"RTN","PSDHLP",4,0)
 W !!,"Updating Clients with your selected logical link:",!!
"RTN","PSDHLP",5,0)
 I $G(PSD(3)) D  Q
"RTN","PSDHLP",6,0)
 .S DIC="^ORD(101,",DIC(0)="ML",DLAYGO=101
"RTN","PSDHLP",7,0)
 .F PSD(4)=1:1:3 S X="PSD"_PSD(3)_" A0"_PSD(4)_" CLIENT" D ^DIC W $P(Y,U,2),!! M ^ORD(101,+Y)=^ORD(101,+$O(^ORD(101,"B","PSD A0"_PSD(4)_" CLIENT",0))) S $P(^ORD(101,+Y,0),U)=X,DIK=DIC,(DA,PSD(5))=+Y D IX1^DIK D
"RTN","PSDHLP",8,0)
 ..S DA=PSD(5),DIE=DIC,DR="770.7////"_$G(PSDL) D ^DIE
"RTN","PSDHLP",9,0)
 .K DIC,DLAYGO,DIK,DA,DR,DIE
"RTN","PSDHLP",10,0)
 N DIE,DA,DR,PSD S PSD="PSD",DIE="^ORD(101,"
"RTN","PSDHLP",11,0)
 F  S PSD=$O(^ORD(101,"B",PSD)) Q:PSD']""!($E(PSD,1,3)'="PSD")  D:PSD["C"
"RTN","PSDHLP",12,0)
 .S DR="770.7////"_$G(PSDL)
"RTN","PSDHLP",13,0)
 .W PSD,!! S DA=$O(^ORD(101,"B",PSD,0)) D ^DIE
"RTN","PSDHLP",14,0)
DG ;S DIR(0)="Y",DIR("A")="Would you like to add the PSD PAT ADT Protocol to the DGPM Event Driver now",DIR("?")="^N XQH S XQH =""PSD HL7 ADT"" D EN^XQH"
"RTN","PSDHLP",15,0)
 ;D ^DIR K DIR D:Y=1 ^PSDONIT
"RTN","PSDHLP",16,0)
 Q
"RTN","PSDHLX")
0^96^B1493655
"RTN","PSDHLX",1,0)
PSDHLX ;BIR/LTL-HL7 inteface setup invoked by PSDHL7 for X3.28 ; 21 Feb 95
"RTN","PSDHLX",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHLX",3,0)
X328 W !!,"Let's check for a PSD-NDES X3.28 entry in your",!
"RTN","PSDHLX",4,0)
 W "HL LOWER LEVEL PROTOCOL PARAMETER file (#829.2)."
"RTN","PSDHLX",5,0)
 S (DIC,DIE)="^HLCS(869.2,",DIC(0)="L",DLAYGO=869.2,X="PSD-NDES X3.28"
"RTN","PSDHLX",6,0)
 D ^DIC K DIC W:$P(Y,U,3) "Added." I Y<0 W "Failed." G END
"RTN","PSDHLX",7,0)
 W "  Updating.",!! N PSDX S (DA,PSDX)=+Y
"RTN","PSDHLX",8,0)
 S DR=".02////3;300.01//" D ^DIE K DIE,DR,DIC,DA
"RTN","PSDHLX",9,0)
 W !!,"Let's check for a PSD X3.28 entry in your"
"RTN","PSDHLX",10,0)
 W !,"HL LOGICAL LINK file (#870)."
"RTN","PSDHLX",11,0)
 S (DIC,DIE)="^HLCS(870,",DIC(0)="L",DLAYGO=870,X="PSD X3.28"
"RTN","PSDHLX",12,0)
 D ^DIC K DIC W:$P(Y,U,3) "Added." I Y<0 W "Failed." Q
"RTN","PSDHLX",13,0)
 W "  Updating." N PSDL S (DA,PSDL)=+Y
"RTN","PSDHLX",14,0)
 S DR="2////"_$G(PSDX) D ^DIE K DIC,DA,DIE,DLAYGO,DR D NONK^PSDHLP
"RTN","PSDHLX",15,0)
END Q
"RTN","PSDHLY")
0^259^B1134817
"RTN","PSDHLY",1,0)
PSDHLY ;BIR/LTL-HL7 inteface setup invoked by PSDHL7 for X3.28 ; 21 Feb 95
"RTN","PSDHLY",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHLY",3,0)
X328 N DIE,DA,DR,PSD
"RTN","PSDHLY",4,0)
 S DIE="^HLCS(869.2,",(DA,PSD(1))=$O(^HLCS(869.2,"B","PSD-NDES X3.28",0))
"RTN","PSDHLY",5,0)
 D MES^XPDUTL("  Updating device for PSD-NDES X3.28 entry in file #869.2.")
"RTN","PSDHLY",6,0)
 S DR="300.01////"_+$G(XPDQUES("POS3")) D ^DIE K DIE,DR,DA
"RTN","PSDHLY",7,0)
 D MES^XPDUTL("Updating Clients with your X3.28 logical link:")
"RTN","PSDHLY",8,0)
 S PSD="PSD",DIE="^ORD(101,"
"RTN","PSDHLY",9,0)
 F  S PSD=$O(^ORD(101,"B",PSD)) Q:PSD']""!($E(PSD,1,3)'="PSD")  D:PSD["C"
"RTN","PSDHLY",10,0)
 .S DR="770.7////"_PSD(1) D MES^XPDUTL(PSD)
"RTN","PSDHLY",11,0)
 .S DA=$O(^ORD(101,"B",PSD,0)) D ^DIE
"RTN","PSDHLY",12,0)
END Q
"RTN","PSDHRPT")
0^97^B24035727
"RTN","PSDHRPT",1,0)
PSDHRPT ;BIR/BJW-Destructions Holding file Report ; 12 JAN 96
"RTN","PSDHRPT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDHRPT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDHRPT",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access to",!,"the pending Controlled Substances destruction data.",!!,"PSJ RPHARM security key required.",! G END
"RTN","PSDHRPT",5,0)
ASKD ;ask disp location
"RTN","PSDHRPT",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDHRPT",7,0)
ASKV ;ask vault(s)
"RTN","PSDHRPT",8,0)
 W !!,?5,"You may select a single VAULT, several VAULT(s),",!,?5,"or enter ^ALL to select all VAULT(s).",!
"RTN","PSDHRPT",9,0)
 K DA,DIC D NOW^%DTC S (PSDT,Y)=X X ^DD("DD") S RPDT=Y
"RTN","PSDHRPT",10,0)
 F  S DIC=58.8,DIC("A")="Select VAULT: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC S PSDVAU(+Y)="" Q:Y<0
"RTN","PSDHRPT",11,0)
 I '$D(PSDVAU)&(X'="^ALL") G END
"RTN","PSDHRPT",12,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="N",$P($G(^(0)),"^",3)=+PSDSITE S PSDVAU(PSD)=""
"RTN","PSDHRPT",13,0)
 S JJ=$O(PSDVAU(0)),JJ=$S($O(PSDVAU(JJ)):1,1:2)
"RTN","PSDHRPT",14,0)
 S DIC="^DIC(4,",DR=.01,DA=+$P($G(^XMB(1,1,"XUS")),U,17),DIQ="PSD"
"RTN","PSDHRPT",15,0)
 D EN^DIQ1 K DIC,DR,DIQ
"RTN","PSDHRPT",16,0)
 S PSDSN=$S(JJ=1:PSD(4,DA,.01),1:$P($G(^PSD(58.8,+$O(PSDVAU(0)),0)),U))
"RTN","PSDHRPT",17,0)
 K DA,PSD
"RTN","PSDHRPT",18,0)
DEV ;select device
"RTN","PSDHRPT",19,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDHRPT",20,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDHRPT",21,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDHRPT",ZTDESC="CS PHARM HOLD for DESTROY" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDHRPT",22,0)
 U IO
"RTN","PSDHRPT",23,0)
START ;start looping
"RTN","PSDHRPT",24,0)
 ;1/26/96 CHG L3,added chk for 3-node;dte cancelld
"RTN","PSDHRPT",25,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDHRPT",26,0)
 K LN S (CNT,PG,PSDOUT)=0,$P(LN,"-",132)="" D HDR
"RTN","PSDHRPT",27,0)
 F PSD=0:0 S PSD=$O(^PSD(58.86,PSD)) Q:'PSD  I $D(^PSD(58.86,PSD,0)),$D(PSDVAU(+$P(^(0),"^",7))),'$P(^(0),"^",11)!$D(^PSD(58.86,PSD,3)) S CNT=CNT+1 D PRINT Q:PSDOUT
"RTN","PSDHRPT",28,0)
 I CNT=0 W !!,?10,"*** NO HOLDING FOR DESTRUCTIONS ***",!!
"RTN","PSDHRPT",29,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDHRPT",30,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDHRPT",31,0)
END ;
"RTN","PSDHRPT",32,0)
 K %I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,JJ,LN,NODE
"RTN","PSDHRPT",33,0)
 K PG,PHARM,PHARMN,POP,PSD,PSDCD,PSDCNL,PSDCONT,PSDCOMS,PSDGS,PSDEV,PSDOUT,PSDS,PSDSN,PSDT,PSDTR,PSDVAU,PVAULT,QTY,BAREAS,REAS,RPDT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDHRPT",34,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDHRPT",35,0)
 Q
"RTN","PSDHRPT",36,0)
PRINT ;print data
"RTN","PSDHRPT",37,0)
 ;58.86(2;1)"PSDCOMS" holds reason drug placed on hold,3/22/95
"RTN","PSDHRPT",38,0)
 ;58.86(3;3)"PSDCNL" " " HLD# was cancelled,12-11-95
"RTN","PSDHRPT",39,0)
 ;58.81(0;16)"BAREAS" " " reason for bal-adj,10-5-95
"RTN","PSDHRPT",40,0)
 ;58.81(3;6)" " " GS# placed on hold
"RTN","PSDHRPT",41,0)
 D:$Y+8>IOSL HDR Q:PSDOUT
"RTN","PSDHRPT",42,0)
 S (PSDCOMS,PSDCNL)=""
"RTN","PSDHRPT",43,0)
 S NODE=^PSD(58.86,PSD,0),DRUG=+$P(NODE,"^",2),PSDTR=$P(NODE,"^",9)
"RTN","PSDHRPT",44,0)
 S PVAULT=$P(NODE,"^",7) I JJ=1 W !,"=> ",$P($G(^PSD(58.8,+PVAULT,0)),U)
"RTN","PSDHRPT",45,0)
 S DRUGN=$S($G(^PSD(58.86,PSD,1))]"":$G(^PSD(58.86,PSD,1))_"*",$P($G(^PSDRUG(+DRUG,0)),"^")]"":$P($G(^PSDRUG(+DRUG,0)),"^"),1:"DRUG NAME MISSING")
"RTN","PSDHRPT",46,0)
 S QTY=$P(NODE,"^",3),PHARM=$P(NODE,"^",4),PHARMN=$P($G(^VA(200,+PHARM,0)),"^") I PHARMN]"" S PHARMN=$E($P(PHARMN,",",2))_$E(PHARMN)
"RTN","PSDHRPT",47,0)
 S PSDT=$P(NODE,"^",6) I PSDT S PSDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3)
"RTN","PSDHRPT",48,0)
 S PSDCD=$P($G(^PSD(58.86,PSD,3)),"^") I PSDCD S PSDCD=$E(PSDCD,4,5)_"/"_$E(PSDCD,6,7)_"/"_$E(PSDCD,2,3)
"RTN","PSDHRPT",49,0)
 S PSDCONT=$P(NODE,"^",8)
"RTN","PSDHRPT",50,0)
 ;The next 2 lines added for E3R# 3771 to print comments 
"RTN","PSDHRPT",51,0)
 S:$D(^PSD(58.86,PSD,2)) PSDCOMS=$P(^(2),"^",1)
"RTN","PSDHRPT",52,0)
 S:'$D(^PSD(58.86,PSD,2)) PSDCOMS=""
"RTN","PSDHRPT",53,0)
 S:$D(^PSD(58.86,PSD,3)) PSDCNL=$P(^(3),"^",3)
"RTN","PSDHRPT",54,0)
 S:'$D(^PSD(58.86,PSD,3)) PSDCNL=""
"RTN","PSDHRPT",55,0)
 S PSDGS="",REAS="",BAREAS=""
"RTN","PSDHRPT",56,0)
 I +PSDTR S PSDGS=$P($G(^PSD(58.81,PSDTR,0)),U,17),REAS=$P($G(^(3)),U,6),BAREAS=$P($G(^(0)),U,16)
"RTN","PSDHRPT",57,0)
 W:$D(^PSD(58.86,PSD,3)) !,PSD,"(C)",?13,DRUGN,?83,PSDCONT,?92,QTY,?102,PSDT,?115,PSDCD,?128,PHARMN,!,?15,"Comments: "
"RTN","PSDHRPT",58,0)
 W:'$D(^PSD(58.86,PSD,3)) !,PSD,?13,DRUGN,?83,PSDCONT,?92,QTY,?102,PSDT,?115,PSDCD,?128,PHARMN,!,?15,"Comments: "
"RTN","PSDHRPT",59,0)
 I $D(PSDCOMS) W ?24,PSDCOMS
"RTN","PSDHRPT",60,0)
 I $D(REAS) W ?24,REAS
"RTN","PSDHRPT",61,0)
 I $D(BAREAS) W ?24,BAREAS
"RTN","PSDHRPT",62,0)
 I $D(PSDCNL) W ?24,PSDCNL
"RTN","PSDHRPT",63,0)
 W ?85,PSDGS,!
"RTN","PSDHRPT",64,0)
 Q
"RTN","PSDHRPT",65,0)
HDR ;prints header information
"RTN","PSDHRPT",66,0)
 ;Modified for E3R# 3771 3/22/95,mod:1/12/96
"RTN","PSDHRPT",67,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDHRPT",68,0)
 S PG=PG+1 W:$Y @IOF W !,?125,"PAGE: ",PG,!,?42,"DESTRUCTION HOLDING FILE REPORT for ",PSDSN,!,?42,"Run Date: ",RPDT,!,"=> VAULT",!
"RTN","PSDHRPT",69,0)
 W !,"HOLD #",?13,"DRUG",?80,"# OF CONT",?92,"QTY",?102,"TURN IN",?115,"DATE HLD#",?127,"PHARM",!,?15,"COMMENTS",?85,"GS#",?104,"DATE",?115,"CANCELLED",!,LN,!
"RTN","PSDHRPT",70,0)
 Q
"RTN","PSDHRPT",71,0)
SAVE ;4/5/95 added by bjw
"RTN","PSDHRPT",72,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDGS"),ZTSAVE("PSDSN"),ZTSAVE("PSDTR"),ZTSAVE("REAS"),ZTSAVE("JJ"),ZTSAVE("BAREAS"),ZTSAVE("PSDCOMS"),ZTSAVE("PSDCNL"))=""
"RTN","PSDHRPT",73,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDVAU) ZTSAVE("PSDVAU(")=""
"RTN","PSDHRPT",74,0)
 Q
"RTN","PSDINPRE")
0^491^B4106644
"RTN","PSDINPRE",1,0)
PSDINPRE ;BIR/DMA-Pre Init for Controlled Substances ; 18 May 92
"RTN","PSDINPRE",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDINPRE",3,0)
 S XQABT1=$H
"RTN","PSDINPRE",4,0)
 I $D(DUZ),$D(DUZ)#2,$D(^VA(200,+DUZ,0)),$D(DUZ(0)),DUZ(0)="@" S (XQABT2,XQABT3)=$H G CHECK
"RTN","PSDINPRE",5,0)
 W !!,$C(7),"You must be a defined user with DUZ(0)=""@""",!
"RTN","PSDINPRE",6,0)
 S XPDQUIT=2 Q
"RTN","PSDINPRE",7,0)
CHECK ;check for required packages
"RTN","PSDINPRE",8,0)
 N PSD S PSD(1)=" is required"
"RTN","PSDINPRE",9,0)
 I $$VERSION^XPDUTL("XU")<8 W !,"KERNEL VERSION 3.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",10,0)
 I $$VERSION^XPDUTL("VA FILEMAN")<21 W !,"VA FILEMAN VERSION 21.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",11,0)
 I $$VERSION^XPDUTL("XM")<7.1 W !,"MAILMAN VERSION 7.1",PSD(1),!! S PSD=1
"RTN","PSDINPRE",12,0)
 I $$VERSION^XPDUTL("NURS")<2.5 W !,"NURSING VERSION 2.5",PSD(1),!! S PSD=1
"RTN","PSDINPRE",13,0)
 I $$VERSION^XPDUTL("PSO")<6 W !,"OUTPATIENT PHARMACY VERSION 6.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",14,0)
 I $$VERSION^XPDUTL("AUTO REPLENISHMENT/WARD STOCK")<2.2 W !,"AUTO REPLENISHMENT/WARD STOCK VERSION 2.2",PSD(1),!! S PSD=1
"RTN","PSDINPRE",15,0)
 I $$VERSION^XPDUTL("INPATIENT MEDICATIONS")<4 W !,"INPATIENT MEDICATIONS VERSION 4.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",16,0)
 I $$VERSION^XPDUTL("PSA")<2 W !,"DRUG ACCOUNTABILITY VERSION 2.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",17,0)
 I $$VERSION^XPDUTL("IB")<2 W !,"INTEGRATED BILLING VERSION 2.0",PSD(1),!! S PSD=1
"RTN","PSDINPRE",18,0)
 I $$VERSION^XPDUTL("HL")<1.6 W !,"HEALTH LEVEL 7 VERSION 1.6",PSD(1),!! S PSD=1
"RTN","PSDINPRE",19,0)
 I $G(PSD) W "for CONTROLLED SUBSTANCES VERSION 3.0.",!!,"Installation cannot proceed.",! S XPDQUIT=1
"RTN","PSDINPRE",20,0)
 Q
"RTN","PSDIPOS1")
0^255^B5709001
"RTN","PSDIPOS1",1,0)
PSDIPOS1 ;BIR/LTL-Post Init for Control Subs  (cont'd) ; 21 Feb 95
"RTN","PSDIPOS1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDIPOS1",3,0)
CHECK ;check pharmacy system file for conversion completion date
"RTN","PSDIPOS1",4,0)
 N PSDSYS S PSDSYS=$O(^PS(59.7,0)) G:$P($G(^PS(59.7,+PSDSYS,70)),U,4) QUIT
"RTN","PSDIPOS1",5,0)
INF D MES^XPDUTL("I need to convert and clean up data in the DRUG ACCOUNTABILITY STATS file.")
"RTN","PSDIPOS1",6,0)
CONV ;convert monthly activity entries to be FM compatible
"RTN","PSDIPOS1",7,0)
 D MES^XPDUTL("Now, I need to add 00 to the monthly activity multiple so its FM compatible.")
"RTN","PSDIPOS1",8,0)
 S PSDLOC=0 N PSDR,PSDMON
"RTN","PSDIPOS1",9,0)
 F  S PSDLOC=$O(^PSD(58.8,PSDLOC)) Q:'PSDLOC  D
"RTN","PSDIPOS1",10,0)
 .S PSDR=0 S PSD="Working on "_$P($G(^PSD(58.8,+PSDLOC,0)),U)
"RTN","PSDIPOS1",11,0)
 .D MES^XPDUTL(PSD) K PSD
"RTN","PSDIPOS1",12,0)
 .F  S PSDR=$O(^PSD(58.8,+PSDLOC,1,PSDR)) Q:'PSDR  D
"RTN","PSDIPOS1",13,0)
 ..S PSDMON=0 D MES^XPDUTL(".")
"RTN","PSDIPOS1",14,0)
 ..F  S PSDMON=$O(^PSD(58.8,+PSDLOC,1,+PSDR,5,PSDMON)) Q:'PSDMON!($L(PSDMON)>5)  D
"RTN","PSDIPOS1",15,0)
 ...;create the new node with data
"RTN","PSDIPOS1",16,0)
 ...S PSDMON(1)=PSDMON*100,^PSD(58.8,+PSDLOC,1,+PSDR,5,PSDMON(1),0)=$G(^PSD(58.8,+PSDLOC,1,+PSDR,5,PSDMON,0)),$P(^PSD(58.8,+PSDLOC,1,+PSDR,5,PSDMON(1),0),U)=PSDMON(1)
"RTN","PSDIPOS1",17,0)
 ...;kill the old one
"RTN","PSDIPOS1",18,0)
 ...S DIK="^PSD(58.8,+PSDLOC,1,+PSDR,5,",DA=PSDMON,DA(2)=PSDLOC
"RTN","PSDIPOS1",19,0)
 ...S DA(1)=PSDR D ^DIK K DIK,DA
"RTN","PSDIPOS1",20,0)
 ..;reindex the new multiple for this drug
"RTN","PSDIPOS1",21,0)
 ..S DIK="^PSD(58.8,+PSDLOC,1,+PSDR,5,",DA(2)=PSDLOC,DA(1)=PSDR
"RTN","PSDIPOS1",22,0)
 ..S DIK(1)=".01" D ENALL^DIK K DIK,DA
"RTN","PSDIPOS1",23,0)
COMP ;enter conversion completion date in pharmacy system file
"RTN","PSDIPOS1",24,0)
 S PSD(1)="I' done with the conversion.",PSD(2)="I'll now store a completion date in your PHARMACY SYSTEM (#59.7) file." D MES^XPDUTL(.PSD) K PSD
"RTN","PSDIPOS1",25,0)
 D DT^DICRW
"RTN","PSDIPOS1",26,0)
 S DIE="^PS(59.7,",DA=PSDSYS,DR="71///^S X=DT" D ^DIE
"RTN","PSDIPOS1",27,0)
 K DIE,DR
"RTN","PSDIPOS1",28,0)
QUIT D MES^XPDUTL("Finished.")
"RTN","PSDIPOS1",29,0)
 ;S XQABT5=$H,X="PSDINITY" X ^%ZOSF("TEST") I $T D @("^"_X)
"RTN","PSDIPOS1",30,0)
 D:+$G(^DIC(9.4,+$O(^DIC(9.4,"B","HEALTH LEVEL SEVEN",0)),"VERSION"))'<1.5 ^PSDHLK
"RTN","PSDIPOS1",31,0)
 K DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,PSD,PSDLOC,PSDSYS,X,Y
"RTN","PSDIPOS1",32,0)
 Q
"RTN","PSDIPOST")
0^256^B8595292
"RTN","PSDIPOST",1,0)
PSDIPOST ;BIR/JPW,LTL-Post-Init ; 7 Feb 95
"RTN","PSDIPOST",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDIPOST",3,0)
 S XQABT4=$H
"RTN","PSDIPOST",4,0)
CHECK ;check for Controlled Subs V2.0
"RTN","PSDIPOST",5,0)
 I $$VERSION^XPDUTL("PSD")'<2 S PSD(1)="CONTROLLED SUBSTANCES VERSION 2.0 has been previously installed,",PSD(2)="no post-init conversion required." D MES^XPDUTL(.PSD) K DIFQ,PSD G QUIT^PSDIPOS1
"RTN","PSDIPOST",6,0)
DEA ;marks ACTIVE drugs for CS use based on DEA special handling
"RTN","PSDIPOST",7,0)
 S PSD(1)="Using the DEA SPECIAL HANDLING data in your drug file I will now mark selected",PSD(2)="drugs for Controlled Substances use.",PSD(3)="Marking now..." D MES^XPDUTL(.PSD) K PSD
"RTN","PSDIPOST",8,0)
 S PSIUX="N",COUNT=0
"RTN","PSDIPOST",9,0)
 F PSD=0:0 S PSD=$O(^PSDRUG(PSD)) Q:'PSD  D
"RTN","PSDIPOST",10,0)
 .Q:'$D(^PSDRUG(PSD,0))  S OK=$S('$D(^PSDRUG(PSD,"I")):1,'+^("I"):1,+^("I")>DT:1,1:0) I 'OK Q
"RTN","PSDIPOST",11,0)
 .S PSDN=$P($G(^PSDRUG(PSD,0)),"^",3),OK=$S(PSDN[1:1,PSDN[2:1,PSDN[3:1,PSDN[4:1,PSDN[5:1,PSDN["A":1,PSDN["C":1,1:0) Q:'OK
"RTN","PSDIPOST",12,0)
 .Q:'$D(^PSDRUG(PSD,2))  S PSDN=$P($G(^PSDRUG(PSD,2)),"^",3),OK=$S(PSDN="":1,PSDN["O":1,PSDN["U":1,PSDN["I":1,1:0) Q:'OK
"RTN","PSDIPOST",13,0)
 .S PSIUDA=+PSD,COUNT=COUNT+1 D ENS^PSGIU
"RTN","PSDIPOST",14,0)
 S PSD="A total of "_COUNT_" drugs have been marked for CS package use."
"RTN","PSDIPOST",15,0)
 D MES^XPDUTL(PSD) K PSD
"RTN","PSDIPOST",16,0)
IND ;re-index 'ac' & 'ad' in 58.86
"RTN","PSDIPOST",17,0)
 D MES^XPDUTL("...Cleaning up 'AIU' cross reference in the DRUG file (#50)...") S X="AIU" F  S X=$O(^PSDRUG(X)) Q:X=""!($E(X,1,3)'="AIU")  K ^PSDRUG(X)
"RTN","PSDIPOST",18,0)
 K X
"RTN","PSDIPOST",19,0)
 D MES^XPDUTL("Re-indexing 'AIU' cross reference...") S DIK="^PSDRUG(",DIK(1)="63^AIU" D ENALL^DIK K DIK
"RTN","PSDIPOST",20,0)
 D MES^XPDUTL("Re-indexing the CS DESTRUCTION file...")
"RTN","PSDIPOST",21,0)
 K DA,DIK S DIK="^PSD(58.86,",DIK(1)=10 D ENALL^DIK K DIK,DA
"RTN","PSDIPOST",22,0)
 S PSD(1)="Re-indexing the DATE/TIME TURN IN DESTROY field in",PSD(2)="the DRUG ACCOUNTABILITY TRANSACTION file..." D MES^XPDUTL(.PSD) K PSD
"RTN","PSDIPOST",23,0)
 K DA,DIK S DIK="^PSD(58.81,",DIK(1)="37" D ENALL^DIK K DA,DIK
"RTN","PSDIPOST",24,0)
 D MES^XPDUTL("...the RECEIPT DATE/TIME...")
"RTN","PSDIPOST",25,0)
 K DA,DIK S DIK="^PSD(58.81,",DIK(1)="21" D ENALL^DIK K DA,DIK
"RTN","PSDIPOST",26,0)
 D MES^XPDUTL("ok.")
"RTN","PSDIPOST",27,0)
 K COUNT,DIC,DIK,DLAYGO,NODE,OK,PSD,PSD1,PSD2,PSDN,PSIUA,PSIUDA,PSIUX,X
"RTN","PSDIPOST",28,0)
 G ^PSDIPOS1
"RTN","PSDLBL")
0^98^B21663167
"RTN","PSDLBL",1,0)
PSDLBL ;BIR/JPW-CS Label Print for CS Disp Drug ; 5 Oct 94
"RTN","PSDLBL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBL",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDLBL",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS dispensing labels.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDLBL",6,0)
ASKD ;ask disp number range
"RTN","PSDLBL",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDLBL",8,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDLBL",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDLBL",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDLBL",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDLBL",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDLBL",13,0)
CHKD I '$O(^PSD(58.8,+PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDLBL",14,0)
ONE ;asks print type
"RTN","PSDLBL",15,0)
 K DA,DIR,DIRUT S DIR(0)="S^N:NAOU(s);R:Range of Green Sheet Numbers",DIR("A")="Printing Method"
"RTN","PSDLBL",16,0)
 S DIR("?",1)="Answer 'N' to select printing by NAOU(s), 'R' to select a number range",DIR("?")="to print ALL Green Sheets not previously printed, or '^' to quit."
"RTN","PSDLBL",17,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDLBL",18,0)
 G:ANS="N" SEL
"RTN","PSDLBL",19,0)
GS1 ;ask gs # range
"RTN","PSDLBL",20,0)
 W !!,"You may enter a Green Sheet # list and/or a Green Sheet # range.",!
"RTN","PSDLBL",21,0)
 W "NOTE: This response must be a list or range, e.g. 1,3,5 or 2-4,8.",!
"RTN","PSDLBL",22,0)
 K DA,DIR,DIRUT S DIR(0)="LOA^0:999999999",DIR("A")="Select Green Sheet #(s): "
"RTN","PSDLBL",23,0)
 D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDLBL",24,0)
 S PSD1="" F  S PSD1=$O(Y(PSD1)) Q:PSD1=""  S:$D(Y(PSD1)) PSD1(PSD1)=Y(PSD1) K Y(PSD1)
"RTN","PSDLBL",25,0)
 G DEV
"RTN","PSDLBL",26,0)
SEL ;sel naou or group
"RTN","PSDLBL",27,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDLBL",28,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDLBL",29,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDLBL",30,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X K DA,DIC S CNT=0
"RTN","PSDLBL",31,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDLBL",32,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N""" D ^DIC K DIC Q:Y<0  D
"RTN","PSDLBL",33,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDLBL",34,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDLBL",35,0)
 S:X="^ALL" ALL=1
"RTN","PSDLBL",36,0)
DEV ;ask device and queue info
"RTN","PSDLBL",37,0)
 S DIR(0)="Y",DIR("A")="Would you like to try printing these on PIN FED labels",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)  G:Y=1 ^PSDLBL4
"RTN","PSDLBL",38,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels requires the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBL",39,0)
 W !,?12,"*** Check printer for LABEL paper before printing! ***",!
"RTN","PSDLBL",40,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBL",41,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",10),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDLBL",42,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBL",43,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBL0",ZTDESC="Print Dispensing Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBL",44,0)
 U IO D ^PSDLBL0
"RTN","PSDLBL",45,0)
END ;kill variables and exit
"RTN","PSDLBL",46,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,C,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBL",47,0)
 K POP,PSD,PSD1,PSD2,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDG,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBL",48,0)
 K SEL,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL",49,0)
 K ^TMP("PSDLBL",$J)
"RTN","PSDLBL",50,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL",51,0)
 Q
"RTN","PSDLBL",52,0)
SAVE ;save queued variables
"RTN","PSDLBL",53,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBL",54,0)
 S:$D(PSDS) (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDLBL",55,0)
 S:$D(PSD1) ZTSAVE("PSD1(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(CNT) ZTSAVE("CNT")=""
"RTN","PSDLBL",56,0)
 S (ZTSAVE("ANS"),ZTSAVE("PSDSITE"))=""
"RTN","PSDLBL",57,0)
 Q
"RTN","PSDLBL",58,0)
GROUP ;select group of naous
"RTN","PSDLBL",59,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDLBL",60,0)
 Q
"RTN","PSDLBL0")
0^99^B12452931
"RTN","PSDLBL0",1,0)
PSDLBL0 ;BIR/JPW-CS Label Prt for CS Disp Drug (cont'd) ; 17 May 94
"RTN","PSDLBL0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL0",3,0)
START ;entry for compile and print labels
"RTN","PSDLBL0",4,0)
 K ^TMP("PSDLBL",$J),PSDPRT D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDLBL0",5,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBL0",6,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBL0",7,0)
 S PSDCNT=1
"RTN","PSDLBL0",8,0)
 I ANS="R" S PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDLBL0",9,0)
 I ANS="R" G PRINT
"RTN","PSDLBL0",10,0)
 I ANS="N",$D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",3)=+PSDSITE S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDLBL0",11,0)
 I ANS="N",$D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",3)=+PSDSITE S NAOU(+PSD)=""
"RTN","PSDLBL0",12,0)
 S STAT=3
"RTN","PSDLBL0",13,0)
 F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",STAT,PSD)) Q:'PSD  F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"AD",STAT,PSD,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBL0",14,0)
PRINT ;print labels
"RTN","PSDLBL0",15,0)
 S (PSDCNT,PSDOUT)=0,PSDX2=1
"RTN","PSDLBL0",16,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBL",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=$E($P(^TMP("PSDLBL",$J,PSD),"^",2),1,28),TEST(PSDCNT)=$P(^TMP("PSDLBL",$J,PSD),"^")_"  "_$P(^TMP("PSDLBL",$J,PSD),"^",3) D:PSDCNT=3 PRINT1
"RTN","PSDLBL0",17,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBL0",18,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBL0",19,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBL0",20,0)
END ;kill variables and exit
"RTN","PSDLBL0",21,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBL0",22,0)
 K POP,PSD,PSD1,PSD2,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDG,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBL0",23,0)
 K SEL,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL0",24,0)
 K ^TMP("PSDLBL",$J)
"RTN","PSDLBL0",25,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL0",26,0)
 Q
"RTN","PSDLBL0",27,0)
LOOP S PSDPN=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSDPN="" S PSDCNT=1 Q
"RTN","PSDLBL0",28,0)
 F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"D",PSDPN,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBL0",29,0)
 G LOOP
"RTN","PSDLBL0",30,0)
 Q
"RTN","PSDLBL0",31,0)
PRINT1 ;prints labels
"RTN","PSDLBL0",32,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,$E(TEMP(PSDX1+1),1,30)
"RTN","PSDLBL0",33,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,$P(TEST(PSDX1)," "),@PSDBAR0
"RTN","PSDLBL0",34,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBL0",35,0)
 W !!
"RTN","PSDLBL0",36,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBL0",37,0)
 Q
"RTN","PSDLBL0",38,0)
SET1 ;sets disp info
"RTN","PSDLBL0",39,0)
 Q:'$D(^PSD(58.81,+PSDJ,0))  Q:$P($G(^PSD(58.81,+PSDJ,"CS")),"^",5)  S NODE=^PSD(58.81,+PSDJ,0) Q:+$P(NODE,"^",3)'=+$G(PSDS)
"RTN","PSDLBL0",40,0)
 I ANS="N" Q:'$D(NAOU(+PSD))  S PSDPN=$P(NODE,"^",17) Q:PSDPN']""
"RTN","PSDLBL0",41,0)
 I ANS="R" S STAT=+$P(NODE,"^",11) Q:STAT'=3
"RTN","PSDLBL0",42,0)
 S NAOU=+$P(NODE,"^",18) Q:'NAOU  S NAOUN=$P($G(^PSD(58.8,+NAOU,0)),"^")
"RTN","PSDLBL0",43,0)
 S PSDR=+$P(NODE,"^",5) Q:'PSDR
"RTN","PSDLBL0",44,0)
 S PSDA=+$P(NODE,"^",20) Q:'PSDA
"RTN","PSDLBL0",45,0)
 S PSDN=$P($G(^PSDRUG(+PSDR,0)),"^")
"RTN","PSDLBL0",46,0)
 S TEXT(PSDR)=PSDN_"^"_NAOUN
"RTN","PSDLBL0",47,0)
SET ;sets ^tmp
"RTN","PSDLBL0",48,0)
 S ^TMP("PSDLBL",$J,PSDPN)=PSDPN_"^"_$P(TEXT(PSDR),"^")_"^"_$E($P(TEXT(PSDR),"^",2),1,12)
"RTN","PSDLBL0",49,0)
DIE ;update label printed
"RTN","PSDLBL0",50,0)
 Q:'PSDJ
"RTN","PSDLBL0",51,0)
 K DA,DIE,DR S DA=+PSDJ,DIE=58.81,DR="104////"_PSDT D ^DIE K DA,DIE,DR
"RTN","PSDLBL0",52,0)
 Q
"RTN","PSDLBL1")
0^100^B19288718
"RTN","PSDLBL1",1,0)
PSDLBL1 ;BIR/JPW-CS Label Print for Vault Drugs ; 29 Aug 94
"RTN","PSDLBL1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL1",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBL1",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDLBL1",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS dispensing labels.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDLBL1",6,0)
ASKD ;ask disp location
"RTN","PSDLBL1",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDLBL1",8,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDLBL1",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDLBL1",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDLBL1",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDLBL1",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDLBL1",13,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDLBL1",14,0)
DRUG ;ask drug
"RTN","PSDLBL1",15,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDLBL1",16,0)
 W ! K DA,DIC
"RTN","PSDLBL1",17,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDLBL1",18,0)
 .S PSDRG(+Y)=""
"RTN","PSDLBL1",19,0)
 I '$D(PSDRG)&(X'="^ALL") G END
"RTN","PSDLBL1",20,0)
 I X="^ALL" S ALL=1
"RTN","PSDLBL1",21,0)
DEV ;ask device and queue info
"RTN","PSDLBL1",22,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels requires the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBL1",23,0)
 W !,?12,"*** Check printer for LABEL paper before printing! ***",!
"RTN","PSDLBL1",24,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBL1",25,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",10),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDLBL1",26,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBL1",27,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBL1",ZTDESC="Print Vault Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBL1",28,0)
 U IO
"RTN","PSDLBL1",29,0)
START ;entry for compile and print labels
"RTN","PSDLBL1",30,0)
 K ^TMP("PSDLBL1",$J),PSDPRT
"RTN","PSDLBL1",31,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBL1",32,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBL1",33,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,+PSDS,1,PSD)) Q:'PSD  S:$S('$P($G(^PSD(58.8,+PSDS,1,PSD,0)),U,14):1,$P($G(^(0)),U,4):1,$P($G(^(0)),U,14)>DT:1,1:0) PSDRG(PSD)=""
"RTN","PSDLBL1",34,0)
 F PSD=0:0 S PSD=$O(PSDRG(PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) D
"RTN","PSDLBL1",35,0)
 .S PSDRN=$S($P($G(^PSDRUG(+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDLBL1",36,0)
 .S ^TMP("PSDLBL1",$J,PSDRN)=PSD
"RTN","PSDLBL1",37,0)
PRINT ;print labels
"RTN","PSDLBL1",38,0)
 S (PSDOUT,PSDCNT)=0,PSDX2=1
"RTN","PSDLBL1",39,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBL1",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=$E(PSD,1,28),TEST(PSDCNT)=$P(^TMP("PSDLBL1",$J,PSD),"^") D:PSDCNT=3 PRINT1
"RTN","PSDLBL1",40,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBL1",41,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBL1",42,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBL1",43,0)
END ;kill variables and exit
"RTN","PSDLBL1",44,0)
 K %ZIS,ALL,C,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DTOUT,DUOUT,JJ,JLP1,OK,POP,PSD,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDOUT,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDX1,PSDX2,TEMP,TEST,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL1",45,0)
 K ^TMP("PSDLBL1",$J)
"RTN","PSDLBL1",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL1",47,0)
 Q
"RTN","PSDLBL1",48,0)
SAVE ;save queued variables
"RTN","PSDLBL1",49,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBL1",50,0)
 S:$D(PSDRG) ZTSAVE("PSDRG(")=""
"RTN","PSDLBL1",51,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDLBL1",52,0)
 Q
"RTN","PSDLBL1",53,0)
PRINT1 ;prints labels
"RTN","PSDLBL1",54,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,$E(TEMP(PSDX1+1),1,30)
"RTN","PSDLBL1",55,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,TEST(PSDX1),@PSDBAR0
"RTN","PSDLBL1",56,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBL1",57,0)
 W !!
"RTN","PSDLBL1",58,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBL1",59,0)
 Q
"RTN","PSDLBL2")
0^101^B15352423
"RTN","PSDLBL2",1,0)
PSDLBL2 ;B'ham ISC/JPW - CS Label Print for CS Nurses Name ; 27 Dec 93
"RTN","PSDLBL2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL2",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBL2",4,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSD ERROR",DUZ)):2,1:0)
"RTN","PSDLBL2",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"the pending Controlled Substances error log.",! K OK Q
"RTN","PSDLBL2",6,0)
NUR ;ask nurse name
"RTN","PSDLBL2",7,0)
 W !!,?5,"You may select a single name, several names",!,?5,"or enter ""^ALL"" to select all names to be printed.",!!
"RTN","PSDLBL2",8,0)
 W ! S PSDCNT=0 K DA,DIC
"RTN","PSDLBL2",9,0)
 F  S DIC=200,DIC(0)="QEAM",DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)",DIC("A")="Select Nurses Name: " D ^DIC K DIC Q:Y<0  D
"RTN","PSDLBL2",10,0)
 .S PSDTMP(+Y)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL2",11,0)
 I '$D(PSDTMP)&(X'="^ALL") G END
"RTN","PSDLBL2",12,0)
 I X="^ALL" S ALL=1
"RTN","PSDLBL2",13,0)
DEV ;ask device and queue info
"RTN","PSDLBL2",14,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels require the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBL2",15,0)
 W !,?12,"*** Check Printer for LABEL paper before printing! ***",!
"RTN","PSDLBL2",16,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBL2",17,0)
 S PSDCPI=12
"RTN","PSDLBL2",18,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBL2",19,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBL2",ZTDESC="Print Nurses Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBL2",20,0)
 U IO
"RTN","PSDLBL2",21,0)
START ;entry for compile and print labels
"RTN","PSDLBL2",22,0)
 K ^TMP("PSDLBL2",$J),PSDPRT
"RTN","PSDLBL2",23,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,+$G(IOST(0)),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBL2",24,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBL2",25,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^XUSEC("PSJ RNURSE",PSDR)) Q:'PSDR  I $D(^VA(200,PSDR,0)) S PSDTMP(+PSDR)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL2",26,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^XUSEC("PSD NURSE",PSDR)) Q:'PSDR  I $D(^VA(200,PSDR,0)) S PSDTMP(+PSDR)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL2",27,0)
 F PSD=0:0 S PSD=$O(PSDTMP(PSD)) Q:'PSD  I $D(^VA(200,PSD,0)),$D(^VA(200,PSD,1)) D
"RTN","PSDLBL2",28,0)
 .S PSDN=$S($P($G(^VA(200,+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDLBL2",29,0)
 .S SSN=$P($G(^VA(200,+PSD,1)),"^",9) S:SSN SSN="N"_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PSDLBL2",30,0)
 .S ^TMP("PSDLBL2",$J,PSDN)=SSN
"RTN","PSDLBL2",31,0)
PRINT ;print labels
"RTN","PSDLBL2",32,0)
 S (PSDOUT,PSDCNT)=0,PSDX2=1
"RTN","PSDLBL2",33,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBL2",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=PSD,TEST(PSDCNT)=$P(^TMP("PSDLBL2",$J,PSD),"^") D:PSDCNT=3 PRINT1
"RTN","PSDLBL2",34,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBL2",35,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBL2",36,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBL2",37,0)
END ;kill variables and exit
"RTN","PSDLBL2",38,0)
 K %ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DTOUT,DUOUT,JJ,JLP1,OK,POP,PSD,PSDBAR0,PSDBAR1,PSDCNT,PSDN,PSDOUT,PSDCPI,PSDEV,PSDPRT
"RTN","PSDLBL2",39,0)
 K PSDR,PSDTMP,PSDX1,PSDX2,SSN,TEMP,TEST,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL2",40,0)
 K ^TMP("PSDLBL2",$J)
"RTN","PSDLBL2",41,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL2",42,0)
 Q
"RTN","PSDLBL2",43,0)
SAVE ;save queued variables
"RTN","PSDLBL2",44,0)
 S ZTSAVE("PSDCNT")="",ZTSAVE("PSDCPI")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBL2",45,0)
 S:$D(PSDTMP) ZTSAVE("PSDTMP(")=""
"RTN","PSDLBL2",46,0)
 Q
"RTN","PSDLBL2",47,0)
PRINT1 ;prints labels
"RTN","PSDLBL2",48,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,TEMP(PSDX1+1)
"RTN","PSDLBL2",49,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,TEST(PSDX1),@PSDBAR0
"RTN","PSDLBL2",50,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBL2",51,0)
 W !!
"RTN","PSDLBL2",52,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBL2",53,0)
 Q
"RTN","PSDLBL3")
0^102^B15239484
"RTN","PSDLBL3",1,0)
PSDLBL3 ;BIR/JPW-CS Label Print for CS Pharmacists Name ; 6 July 94
"RTN","PSDLBL3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL3",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBL3",4,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W !!,"Contact your Pharmacy Coordinator.  You do not have the Supervisor",!,"access required to print labels.",!! Q
"RTN","PSDLBL3",5,0)
PHARM ;ask pharmacist name
"RTN","PSDLBL3",6,0)
 W !!,?5,"You may select a single name, several names,",!,?5,"or enter ^ALL to select all names to be printed.",!!
"RTN","PSDLBL3",7,0)
 W ! S PSDCNT=0 K DA,DIC
"RTN","PSDLBL3",8,0)
 F  S DIC=200,DIC(0)="QEA",DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSDMGR"",+Y)):1,1:0)",DIC("A")="Select Pharmacists Name: " D ^DIC K DIC Q:Y<0  D
"RTN","PSDLBL3",9,0)
 .S PSDTMP(+Y)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL3",10,0)
 I '$D(PSDTMP)&(X'="^ALL") G END
"RTN","PSDLBL3",11,0)
 I X="^ALL" S ALL=1
"RTN","PSDLBL3",12,0)
DEV ;ask device and queue info
"RTN","PSDLBL3",13,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels requires the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBL3",14,0)
 W !,?12,"*** Check printer for LABEL paper before printing! ***",!
"RTN","PSDLBL3",15,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBL3",16,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBL3",17,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBL3",ZTDESC="Print Pharmacists Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBL3",18,0)
 U IO
"RTN","PSDLBL3",19,0)
START ;entry for compile and print labels
"RTN","PSDLBL3",20,0)
 K ^TMP("PSDLBL3",$J),PSDPRT
"RTN","PSDLBL3",21,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBL3",22,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBL3",23,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^XUSEC("PSJ RPHARM",PSDR)) Q:'PSDR  I $D(^VA(200,PSDR,0)) S PSDTMP(+PSDR)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL3",24,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^XUSEC("PSDMGR",PSDR)) Q:'PSDR  I $D(^VA(200,PSDR,0)) S PSDTMP(+PSDR)="",PSDCNT=PSDCNT+1
"RTN","PSDLBL3",25,0)
 F PSD=0:0 S PSD=$O(PSDTMP(PSD)) Q:'PSD  I $D(^VA(200,PSD,0)),$D(^VA(200,PSD,1)) D
"RTN","PSDLBL3",26,0)
 .S PSDN=$S($P($G(^VA(200,+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDLBL3",27,0)
 .S SSN=$P($G(^VA(200,+PSD,1)),"^",9) S:SSN SSN="P"_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PSDLBL3",28,0)
 .S ^TMP("PSDLBL3",$J,PSDN)=SSN
"RTN","PSDLBL3",29,0)
PRINT ;print labels
"RTN","PSDLBL3",30,0)
 S (PSDOUT,PSDCNT)=0,PSDX2=1
"RTN","PSDLBL3",31,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBL3",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=PSD,TEST(PSDCNT)=$P(^TMP("PSDLBL3",$J,PSD),"^") D:PSDCNT=3 PRINT1
"RTN","PSDLBL3",32,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBL3",33,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBL3",34,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBL3",35,0)
END ;kill variables and exit
"RTN","PSDLBL3",36,0)
 K %ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DTOUT,DUOUT,JJ,JLP1,POP,PSD,PSDBAR0,PSDBAR1,PSDCNT,PSDN,PSDOUT,PSDPRT,PSDR,PSDTMP,PSDX1,PSDX2,SSN,TEMP,TEST,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL3",37,0)
 K ^TMP("PSDLBL3",$J)
"RTN","PSDLBL3",38,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL3",39,0)
 Q
"RTN","PSDLBL3",40,0)
SAVE ;save queued variables
"RTN","PSDLBL3",41,0)
 S ZTSAVE("PSDCNT")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBL3",42,0)
 S:$D(PSDTMP) ZTSAVE("PSDTMP(")=""
"RTN","PSDLBL3",43,0)
 Q
"RTN","PSDLBL3",44,0)
PRINT1 ;
"RTN","PSDLBL3",45,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,TEMP(PSDX1+1)
"RTN","PSDLBL3",46,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,TEST(PSDX1),@PSDBAR0
"RTN","PSDLBL3",47,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,"RPh"
"RTN","PSDLBL3",48,0)
 W !!
"RTN","PSDLBL3",49,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBL3",50,0)
 Q
"RTN","PSDLBL4")
0^374^B4848952
"RTN","PSDLBL4",1,0)
PSDLBL4 ;BIR/JPW-CS Label Print for CS Disp Drug ; 5 Oct 94
"RTN","PSDLBL4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL4",3,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",10),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDLBL4",4,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBL4",5,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBL5",ZTDESC="Print Dispensing Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBL4",6,0)
 U IO D ^PSDLBL5
"RTN","PSDLBL4",7,0)
END ;kill variables and exit
"RTN","PSDLBL4",8,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,C,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBL4",9,0)
 K POP,PSD,PSD1,PSD2,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDG,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBL4",10,0)
 K SEL,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL4",11,0)
 K ^TMP("PSDLBL",$J)
"RTN","PSDLBL4",12,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL4",13,0)
 Q
"RTN","PSDLBL4",14,0)
SAVE ;save queued variables
"RTN","PSDLBL4",15,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBL4",16,0)
 S:$D(PSDS) (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDLBL4",17,0)
 S:$D(PSD1) ZTSAVE("PSD1(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(CNT) ZTSAVE("CNT")=""
"RTN","PSDLBL4",18,0)
 S (ZTSAVE("ANS"),ZTSAVE("PSDSITE"))=""
"RTN","PSDLBL4",19,0)
 Q
"RTN","PSDLBL4",20,0)
GROUP ;select group of naous
"RTN","PSDLBL4",21,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDLBL4",22,0)
 Q
"RTN","PSDLBL5")
0^375^B11165305
"RTN","PSDLBL5",1,0)
PSDLBL5 ;BIR/JPW-CS Label Prt for CS Disp Drug (cont'd) ; 17 May 94
"RTN","PSDLBL5",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBL5",3,0)
START ;entry for compile and print labels
"RTN","PSDLBL5",4,0)
 K ^TMP("PSDLBL",$J),PSDPRT D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDLBL5",5,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBL5",6,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBL5",7,0)
 S PSDCNT=1
"RTN","PSDLBL5",8,0)
 I ANS="R" S PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDLBL5",9,0)
 I ANS="R" G PRINT
"RTN","PSDLBL5",10,0)
 I ANS="N",$D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",3)=+PSDSITE S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDLBL5",11,0)
 I ANS="N",$D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",3)=+PSDSITE S NAOU(+PSD)=""
"RTN","PSDLBL5",12,0)
 S STAT=3
"RTN","PSDLBL5",13,0)
 F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",STAT,PSD)) Q:'PSD  F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"AD",STAT,PSD,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBL5",14,0)
PRINT ;print labels
"RTN","PSDLBL5",15,0)
 S (PSD,PSDOUT)="" F  S PSD=$O(^TMP("PSDLBL",$J,PSD)) Q:PSD=""!(PSDOUT)  D
"RTN","PSDLBL5",16,0)
 .S PSD(1)=$G(^TMP("PSDLBL",$J,PSD))
"RTN","PSDLBL5",17,0)
 .W !,$P(PSD(1),U,2)
"RTN","PSDLBL5",18,0)
 .I $D(PSDPRT) W !,@PSDBAR1,$P(PSD(1),U),@PSDBAR0
"RTN","PSDLBL5",19,0)
 .W $P(PSD(1),U),"  ",$P(PSD(1),U,3),!
"RTN","PSDLBL5",20,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBL5",21,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBL5",22,0)
END ;kill variables and exit
"RTN","PSDLBL5",23,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBL5",24,0)
 K POP,PSD,PSD1,PSD2,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDG,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBL5",25,0)
 K SEL,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBL5",26,0)
 K ^TMP("PSDLBL",$J)
"RTN","PSDLBL5",27,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBL5",28,0)
 Q
"RTN","PSDLBL5",29,0)
LOOP S PSDPN=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSDPN="" S PSDCNT=1 Q
"RTN","PSDLBL5",30,0)
 F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"D",PSDPN,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBL5",31,0)
 G LOOP
"RTN","PSDLBL5",32,0)
 Q
"RTN","PSDLBL5",33,0)
PRINT1 ;prints labels
"RTN","PSDLBL5",34,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,$E(TEMP(PSDX1+1),1,30)
"RTN","PSDLBL5",35,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,$P(TEST(PSDX1)," "),@PSDBAR0
"RTN","PSDLBL5",36,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBL5",37,0)
 W !!
"RTN","PSDLBL5",38,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBL5",39,0)
 Q
"RTN","PSDLBL5",40,0)
SET1 ;sets disp info
"RTN","PSDLBL5",41,0)
 Q:'$D(^PSD(58.81,+PSDJ,0))  Q:$P($G(^PSD(58.81,+PSDJ,"CS")),"^",5)  S NODE=^PSD(58.81,+PSDJ,0) Q:+$P(NODE,"^",3)'=+$G(PSDS)
"RTN","PSDLBL5",42,0)
 I ANS="N" Q:'$D(NAOU(+PSD))  S PSDPN=$P(NODE,"^",17) Q:PSDPN']""
"RTN","PSDLBL5",43,0)
 I ANS="R" S STAT=+$P(NODE,"^",11) Q:STAT'=3
"RTN","PSDLBL5",44,0)
 S NAOU=+$P(NODE,"^",18) Q:'NAOU  S NAOUN=$P($G(^PSD(58.8,+NAOU,0)),"^")
"RTN","PSDLBL5",45,0)
 S PSDR=+$P(NODE,"^",5) Q:'PSDR
"RTN","PSDLBL5",46,0)
 S PSDA=+$P(NODE,"^",20) Q:'PSDA
"RTN","PSDLBL5",47,0)
 S PSDN=$P($G(^PSDRUG(+PSDR,0)),"^")
"RTN","PSDLBL5",48,0)
 S TEXT(PSDR)=PSDN_"^"_NAOUN
"RTN","PSDLBL5",49,0)
SET ;sets ^tmp
"RTN","PSDLBL5",50,0)
 S ^TMP("PSDLBL",$J,PSDPN)=PSDPN_"^"_$P(TEXT(PSDR),"^")_"^"_$E($P(TEXT(PSDR),"^",2),1,12)
"RTN","PSDLBL5",51,0)
DIE ;update label printed
"RTN","PSDLBL5",52,0)
 Q:'PSDJ
"RTN","PSDLBL5",53,0)
 K DA,DIE,DR S DA=+PSDJ,DIE=58.81,DR="104////"_PSDT D ^DIE K DA,DIE,DR
"RTN","PSDLBL5",54,0)
 Q
"RTN","PSDLBLB")
0^485^B10784930
"RTN","PSDLBLB",1,0)
PSDLBLB ;B'ham ISC/JPW - CS Print for Patient ID List ; 2 Mar 94
"RTN","PSDLBLB",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLB",3,0)
 S PSDWN="" F  S PSDWN=$O(PSDW(PSDWN)) Q:PSDWN=""  F PSD1=0:0 S PSD1=$O(^DPT("ACN",PSDWN,PSD1)) Q:'PSD1  I $D(^DPT(PSD1,0)) D
"RTN","PSDLBLB",4,0)
 .S DFN=PSD1 D DEM^VADPT S PATN=$S('VAERR:VADM(1),1:"UNKNOWN"),SSN=$P(VADM(2),"^"),PATN=PATN_" ("_VA("BID")_")"
"RTN","PSDLBLB",5,0)
 .S VAINDT=PSDT D INP^VADPT S PSDRM=VAIN(5)
"RTN","PSDLBLB",6,0)
 .K DFN,VADM,VAIN,VAINDT
"RTN","PSDLBLB",7,0)
 .S PSDCNT=PSDCNT+1,^TMP("PSDLBLP",$J,PSDWN,$S(PSDRM]"":PSDRM,1:0),PSDCNT)=SSN_"^"_PATN
"RTN","PSDLBLB",8,0)
PRINT ;print labels
"RTN","PSDLBLB",9,0)
 S (PSDOUT,PG)=0,$P(LN,"-",80)="",(PSDX1,PSDCNT)=1
"RTN","PSDLBLB",10,0)
 I '$D(^TMP("PSDLBLP",$J)) D HDR W !!,?15,"**** NO PATIENT WARD INFO ****",!! G DONE
"RTN","PSDLBLB",11,0)
 D HDR
"RTN","PSDLBLB",12,0)
 S PSDN="" F  S PSDN=$O(^TMP("PSDLBLP",$J,PSDN)) Q:PSDN=""!(PSDOUT)  Q:PSDOUT  D  Q:PSDOUT
"RTN","PSDLBLB",13,0)
 .S PSD="" F  S PSD=$O(^TMP("PSDLBLP",$J,PSDN,PSD)) Q:PSD=""!(PSDOUT)  D:$Y+26>IOSL HDR Q:PSDOUT  F PSD1=0:0 S PSD1=$O(^TMP("PSDLBLP",$J,PSDN,PSD,PSD1)) Q:'PSD1!(PSDOUT)  S NODE=^(PSD1) D
"RTN","PSDLBLB",14,0)
 ..I $Y+26>IOSL D HDR Q:PSDOUT
"RTN","PSDLBLB",15,0)
 ..W !,$P(NODE,U,2),?45,$S(PSD=0:"NONE",1:PSD),"  ",$G(PSDN)
"RTN","PSDLBLB",16,0)
 ..W ! I $D(PSDPRT) W @PSDBAR1,$P(NODE,"^"),@PSDBAR0,!!
"RTN","PSDLBLB",17,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBLB",18,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBLB",19,0)
END ;kill variables and exit
"RTN","PSDLBLB",20,0)
 D KVAR^VADPT K VA
"RTN","PSDLBLB",21,0)
 K %,%H,%ZIS,ANS,DA,DFN,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,JJ1,JJ2,LN,NODE,POP,PATN,PG,PSD,PSD1,PSDBAR0,PSDBAR1,PSDCNT,PSDN,PSDOUT
"RTN","PSDLBLB",22,0)
 K PSDPRT,PSDR,PSDRM,PSDT,PSDW,PSDWN,PSDX1,PSDX2,SSN,VADM,VAERR,VAIN,VAINDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLB",23,0)
 K ^TMP("PSDLBLP",$J)
"RTN","PSDLBLB",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLB",25,0)
 Q
"RTN","PSDLBLB",26,0)
HDR ;prints header information
"RTN","PSDLBLB",27,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDLBLB",28,0)
 S PG=PG+1,PSD(1)=0 W:$Y @IOF W !,"Patient ID List for "
"RTN","PSDLBLB",29,0)
 ;F  S PSD(1)=$O(PSDW(PSD(1))) Q:PSD(1)']""  W PSD(1)
"RTN","PSDLBLB",30,0)
 W $S($G(PSD2)]"":PSD2,$G(PSDN)]"":PSDN,$G(NAOUN)]"":NAOUN,$O(PSDW(""))]"":$O(PSDW("")),1:"")
"RTN","PSDLBLB",31,0)
 W " Printed: ",$$HTE^XLFDT($H,"P"),?70,"Page: ",PG,!
"RTN","PSDLBLB",32,0)
 W "PATIENT",?45,"ROOM-BED",!,LN,!!
"RTN","PSDLBLB",33,0)
 Q
"RTN","PSDLBLB",34,0)
SAVE ;save queued variables
"RTN","PSDLBLB",35,0)
 S ZTSAVE("PSDW(")="",ZTSAVE("PSD2")=""
"RTN","PSDLBLB",36,0)
 S:$D(NAOUN) ZTSAVE("NAOUN")=""
"RTN","PSDLBLB",37,0)
 Q
"RTN","PSDLBLB",38,0)
ASKN ;ask nursing location
"RTN","PSDLBLB",39,0)
 K DA,DIC S DIC=211.4,DIC(0)="QEA",DIC("A")="Select Nursing Location: "
"RTN","PSDLBLB",40,0)
 W ! D ^DIC K DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDLBLB",41,0)
 N PSD S PSD2=$P($P($G(^SC(+$P(Y,U,2),0)),U)," ",2)
"RTN","PSDLBLB",42,0)
 D GETS^DIQ(211.4,+Y_",","2*","","PSD") S PSD(1)=0
"RTN","PSDLBLB",43,0)
 F  S PSD(1)=$O(PSD(211.41,PSD(1))) Q:PSD(1)']""  D:$G(PSD(211.41,PSD(1),.01))]""
"RTN","PSDLBLB",44,0)
 .S PSDW($G(PSD(211.41,PSD(1),.01)))=0
"RTN","PSDLBLB",45,0)
 Q
"RTN","PSDLBLB",46,0)
WARD2 W !!,"Compiling Ward data for ",NAOUN,"..."
"RTN","PSDLBLB",47,0)
 F JJ=0:0 S JJ=$O(^PSD(58.8,"D",JJ)) Q:'JJ  F JJ1=0:0 S JJ1=$O(^PSD(58.8,"D",JJ,JJ1)) Q:'JJ1  F JJ2=0:0 S JJ2=$O(^PSD(58.8,"D",JJ,JJ1,JJ2)) Q:('JJ2)!(JJ2'=NAOU)  D
"RTN","PSDLBLB",48,0)
 .Q:$P($G(^DIC(42,+JJ1,0)),"^")']""
"RTN","PSDLBLB",49,0)
 .S PSDW($P($G(^DIC(42,+JJ1,0)),"^"))=+JJ1_"^"_$P($G(^DIC(42,+JJ1,0)),"^")
"RTN","PSDLBLB",50,0)
 Q
"RTN","PSDLBLI")
0^103^B12951200
"RTN","PSDLBLI",1,0)
PSDLBLI ;BIR/JPW-CS Label Print for CS Inspectors Name ; 30 Aug 94
"RTN","PSDLBLI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBLI",4,0)
 I '$D(^XUSEC("PSDMGR",DUZ)) W !!,"Contact your Pharmacy Coordinator.  You do not have the Supervisor",!,"access required to print labels.",!!,"PSDMGR security key required.",! Q
"RTN","PSDLBLI",5,0)
INSP ;ask inspector name
"RTN","PSDLBLI",6,0)
 W !!,?5,"You may select a single name or several names.",!
"RTN","PSDLBLI",7,0)
 W ! S PSDCNT=0 K DA,DIC
"RTN","PSDLBLI",8,0)
 F  S DIC=200,DIC(0)="QEA",DIC("A")="Select CS Inspectors Name: " D ^DIC K DIC Q:Y<0  D
"RTN","PSDLBLI",9,0)
 .S PSDTMP(+Y)="",PSDCNT=PSDCNT+1
"RTN","PSDLBLI",10,0)
 G:'$D(PSDTMP) END
"RTN","PSDLBLI",11,0)
DEV ;ask device and queue info
"RTN","PSDLBLI",12,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels requires the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBLI",13,0)
 W !,?12,"*** Check printer for LABEL paper before printing! ***",!
"RTN","PSDLBLI",14,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBLI",15,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBLI",16,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBLI",ZTDESC="Print Inspector Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBLI",17,0)
 U IO
"RTN","PSDLBLI",18,0)
START ;entry for compile and print labels
"RTN","PSDLBLI",19,0)
 K ^TMP("PSDLBLI",$J),PSDPRT
"RTN","PSDLBLI",20,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBLI",21,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBLI",22,0)
 F PSD=0:0 S PSD=$O(PSDTMP(PSD)) Q:'PSD  I $D(^VA(200,PSD,0)),$D(^VA(200,PSD,1)) D
"RTN","PSDLBLI",23,0)
 .S PSDN=$S($P($G(^VA(200,+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDLBLI",24,0)
 .S SSN=$P($G(^VA(200,+PSD,1)),"^",9) S:SSN SSN="I"_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PSDLBLI",25,0)
 .S ^TMP("PSDLBLI",$J,PSDN)=SSN
"RTN","PSDLBLI",26,0)
PRINT ;print labels
"RTN","PSDLBLI",27,0)
 S (PSDOUT,PSDCNT)=0,PSDX2=1
"RTN","PSDLBLI",28,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBLI",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=PSD,TEST(PSDCNT)=$P(^TMP("PSDLBLI",$J,PSD),"^") D:PSDCNT=3 PRINT1
"RTN","PSDLBLI",29,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBLI",30,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBLI",31,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBLI",32,0)
END ;kill variables and exit
"RTN","PSDLBLI",33,0)
 K %ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DTOUT,DUOUT,JJ,JLP1,POP,PSD,PSDBAR0,PSDBAR1,PSDCNT,PSDN,PSDOUT,PSDPRT,PSDR,PSDTMP,PSDX1,PSDX2,SSN,TEMP,TEST,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLI",34,0)
 K ^TMP("PSDLBLI",$J)
"RTN","PSDLBLI",35,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLI",36,0)
 Q
"RTN","PSDLBLI",37,0)
SAVE ;save queued variables
"RTN","PSDLBLI",38,0)
 S ZTSAVE("PSDCNT")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDLBLI",39,0)
 S:$D(PSDTMP) ZTSAVE("PSDTMP(")=""
"RTN","PSDLBLI",40,0)
 Q
"RTN","PSDLBLI",41,0)
PRINT1 ;prints labels
"RTN","PSDLBLI",42,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,TEMP(PSDX1+1)
"RTN","PSDLBLI",43,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,TEST(PSDX1),@PSDBAR0
"RTN","PSDLBLI",44,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,"Ins"
"RTN","PSDLBLI",45,0)
 W !!
"RTN","PSDLBLI",46,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBLI",47,0)
 Q
"RTN","PSDLBLP")
0^104^B20818342
"RTN","PSDLBLP",1,0)
PSDLBLP ;B'ham ISC/JPW - CS Print for Patient ID List ; 2 Mar 94
"RTN","PSDLBLP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBLP",4,0)
 ;I '$D(^XUSEC("PSJ RNURSE",DUZ)) W !!,"Contact your Pharmacy Coordinator.  You do not have the Supervisor",!,"access required to print labels.",!!
"RTN","PSDLBLP",5,0)
ASK ;ask naou or ward
"RTN","PSDLBLP",6,0)
 S PSDOUT=0 N PSD2
"RTN","PSDLBLP",7,0)
 K DA,DIR,DIRUT S DIR(0)="SO^N:Nursing Location;W:Ward",DIR("A",1)="You may select Nursing Location or Ward to print the Patient ID List."
"RTN","PSDLBLP",8,0)
 S DIR("?",1)="Enter 'N' to select Nursing Location to print list",DIR("?")="Enter 'W' to select Ward to print list."
"RTN","PSDLBLP",9,0)
 S DIR("A")="Select Method" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDLBLP",10,0)
 I Y="N" D ASKN G:PSDOUT END G DEV
"RTN","PSDLBLP",11,0)
WARD ;ask ward name
"RTN","PSDLBLP",12,0)
 W ! K DA,DIC
"RTN","PSDLBLP",13,0)
 F  S DIC=42,DIC(0)="QEAM",DIC("A")="Select Ward to print Patient ID List: " D ^DIC G:$D(DTOUT)!($D(DUOUT))!((X="")&('$D(PSDW))) END Q:X=""  D
"RTN","PSDLBLP",14,0)
 .S PSDW($P(Y,"^",2))=+Y_"^"_$P(Y,"^",2),PSDWN=$P(Y,"^",2)
"RTN","PSDLBLP",15,0)
 K DIC
"RTN","PSDLBLP",16,0)
DEV S DIR(0)="SO^A:Alphabetical;R:Room-Bed",DIR("A")="Sort"
"RTN","PSDLBLP",17,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS(1)=Y
"RTN","PSDLBLP",18,0)
 ;ask device and queue info
"RTN","PSDLBLP",19,0)
 W !!,"This report is designed to print bar codes on a printer.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBLP",20,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBLP",21,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBLP",ZTDESC="Print Patient ID List for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBLP",22,0)
 U IO
"RTN","PSDLBLP",23,0)
START ;entry for compile and print labels
"RTN","PSDLBLP",24,0)
 K ^TMP("PSDLBLP",$J),PSDPRT S PSDCNT=0 D NOW^%DTC S PSDT=%
"RTN","PSDLBLP",25,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBLP",26,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBLP",27,0)
 G:ANS(1)="R" ^PSDLBLB
"RTN","PSDLBLP",28,0)
 S PSDWN="" F  S PSDWN=$O(PSDW(PSDWN)) Q:PSDWN=""  F PSD1=0:0 S PSD1=$O(^DPT("ACN",PSDWN,PSD1)) Q:'PSD1  I $D(^DPT(PSD1,0)) D
"RTN","PSDLBLP",29,0)
 .S DFN=PSD1 D DEM^VADPT S PATN=$S('VAERR:VADM(1),1:"UNKNOWN"),SSN=$P(VADM(2),"^"),PATN=PATN_" ("_VA("BID")_")"
"RTN","PSDLBLP",30,0)
 .S VAINDT=PSDT D INP^VADPT S PSDRM=VAIN(5)
"RTN","PSDLBLP",31,0)
 .K DFN,VADM,VAIN,VAINDT
"RTN","PSDLBLP",32,0)
 .S PSDCNT=PSDCNT+1,^TMP("PSDLBLP",$J,PSDWN,PATN,PSDCNT)=SSN_"^"_PSDRM
"RTN","PSDLBLP",33,0)
PRINT ;print labels
"RTN","PSDLBLP",34,0)
 S (PSDOUT,PG)=0,$P(LN,"-",80)="",(PSDX1,PSDCNT)=1
"RTN","PSDLBLP",35,0)
 I '$D(^TMP("PSDLBLP",$J)) D HDR W !!,?15,"**** NO PATIENT WARD INFO ****",!! G DONE
"RTN","PSDLBLP",36,0)
 S PSDN="" F  S PSDN=$O(^TMP("PSDLBLP",$J,PSDN)) Q:PSDN=""!(PSDOUT)  Q:PSDOUT  D HDR D  Q:PSDOUT
"RTN","PSDLBLP",37,0)
 .S PSD="" F  S PSD=$O(^TMP("PSDLBLP",$J,PSDN,PSD)) Q:PSD=""!(PSDOUT)  D:$Y+26>IOSL HDR Q:PSDOUT  F PSD1=0:0 S PSD1=$O(^TMP("PSDLBLP",$J,PSDN,PSD,PSD1)) Q:'PSD1!(PSDOUT)  S NODE=^(PSD1) D
"RTN","PSDLBLP",38,0)
 ..I $Y+26>IOSL D HDR Q:PSDOUT
"RTN","PSDLBLP",39,0)
 ..W !,PSD,?45,$P(NODE,"^",2),"  ",$G(PSDN)
"RTN","PSDLBLP",40,0)
 ..W ! I $D(PSDPRT) W @PSDBAR1,$P(NODE,"^"),@PSDBAR0,!!
"RTN","PSDLBLP",41,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBLP",42,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBLP",43,0)
END ;kill variables and exit
"RTN","PSDLBLP",44,0)
 D KVAR^VADPT K VA
"RTN","PSDLBLP",45,0)
 K %,%H,%ZIS,ANS,DA,DFN,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,JJ1,JJ2,LN,NODE,POP,PATN,PG,PSD,PSD1,PSDBAR0,PSDBAR1,PSDCNT,PSDN,PSDOUT
"RTN","PSDLBLP",46,0)
 K PSDPRT,PSDR,PSDRM,PSDT,PSDW,PSDWN,PSDX1,PSDX2,SSN,VADM,VAERR,VAIN,VAINDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLP",47,0)
 K ^TMP("PSDLBLP",$J)
"RTN","PSDLBLP",48,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLP",49,0)
 Q
"RTN","PSDLBLP",50,0)
HDR ;prints header information
"RTN","PSDLBLP",51,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDLBLP",52,0)
 S PG=PG+1,PSD(1)=0 W:$Y @IOF W !,"Patient ID List for "
"RTN","PSDLBLP",53,0)
 ;F  S PSD(1)=$O(PSDW(PSD(1))) Q:PSD(1)']""  W PSD(1)
"RTN","PSDLBLP",54,0)
 W $S($G(PSD2)]"":PSD2,$G(PSDN)]"":PSDN,$G(NAOUN)]"":NAOUN,$O(PSDW(""))]"":$O(PSDW("")),1:"")
"RTN","PSDLBLP",55,0)
 W " Printed: ",$$HTE^XLFDT($H,"P"),?70,"Page: ",PG,!
"RTN","PSDLBLP",56,0)
 W "PATIENT",?45,"ROOM-BED",!,LN,!!
"RTN","PSDLBLP",57,0)
 Q
"RTN","PSDLBLP",58,0)
SAVE ;save queued variables
"RTN","PSDLBLP",59,0)
 S ZTSAVE("PSDW(")="",ZTSAVE("PSD2")="",ZTSAVE("ANS(1)")=""
"RTN","PSDLBLP",60,0)
 S:$D(NAOUN) ZTSAVE("NAOUN")=""
"RTN","PSDLBLP",61,0)
 Q
"RTN","PSDLBLP",62,0)
ASKN ;ask nursing location
"RTN","PSDLBLP",63,0)
 K DA,DIC S DIC=211.4,DIC(0)="QEA",DIC("A")="Select Nursing Location: "
"RTN","PSDLBLP",64,0)
 W ! D ^DIC K DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDLBLP",65,0)
 N PSD S PSD2=$P($P($G(^SC(+$P(Y,U,2),0)),U)," ",2)
"RTN","PSDLBLP",66,0)
 D GETS^DIQ(211.4,+Y_",","2*","","PSD") S PSD(1)=0
"RTN","PSDLBLP",67,0)
 F  S PSD(1)=$O(PSD(211.41,PSD(1))) Q:PSD(1)']""  D:$G(PSD(211.41,PSD(1),.01))]""
"RTN","PSDLBLP",68,0)
 .S PSDW($G(PSD(211.41,PSD(1),.01)))=0
"RTN","PSDLBLP",69,0)
 Q
"RTN","PSDLBLP",70,0)
WARD2 W !!,"Compiling Ward data for ",NAOUN,"..."
"RTN","PSDLBLP",71,0)
 F JJ=0:0 S JJ=$O(^PSD(58.8,"D",JJ)) Q:'JJ  F JJ1=0:0 S JJ1=$O(^PSD(58.8,"D",JJ,JJ1)) Q:'JJ1  F JJ2=0:0 S JJ2=$O(^PSD(58.8,"D",JJ,JJ1,JJ2)) Q:('JJ2)!(JJ2'=NAOU)  D
"RTN","PSDLBLP",72,0)
 .Q:$P($G(^DIC(42,+JJ1,0)),"^")']""
"RTN","PSDLBLP",73,0)
 .S PSDW($P($G(^DIC(42,+JJ1,0)),"^"))=+JJ1_"^"_$P($G(^DIC(42,+JJ1,0)),"^")
"RTN","PSDLBLP",74,0)
 Q
"RTN","PSDLBLR")
0^105^B12912842
"RTN","PSDLBLR",1,0)
PSDLBLR ;BIR/JPW-CS Label Reprint for CS Disp Drug ; 29 Aug 94
"RTN","PSDLBLR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLBLR",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDLBLR",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS dispensing labels.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDLBLR",6,0)
 W !!,"Green Sheets/Transactions that have a status of FILLED - NOT DELIVERED",!,"or DELIVERED - ACTIVELY ON NAOU will be reprinted for a given number range.",!!
"RTN","PSDLBLR",7,0)
GS ;ask disp number range
"RTN","PSDLBLR",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDLBLR",9,0)
 G:$P(PSDSITE,U,5) GS1
"RTN","PSDLBLR",10,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDLBLR",11,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDLBLR",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDLBLR",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDLBLR",14,0)
GS1 ;
"RTN","PSDLBLR",15,0)
 W !!,"You may enter a Dispensing Number list and/or a Dispensing Number range.",!
"RTN","PSDLBLR",16,0)
 W "NOTE: This response must be a list or range, e.g., 1,3,5 or 2-4,8.",!
"RTN","PSDLBLR",17,0)
 K DA,DIR,DIRUT S DIR(0)="LOA^0:999999999",DIR("A")="Select Dispensing Number(s): "
"RTN","PSDLBLR",18,0)
 D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDLBLR",19,0)
 S PSD1="" F  S PSD1=$O(Y(PSD1)) Q:PSD1=""  S:$D(Y(PSD1)) PSD1(PSD1)=Y(PSD1) K Y(PSD1)
"RTN","PSDLBLR",20,0)
DEV ;ask device and queue info
"RTN","PSDLBLR",21,0)
 S DIR(0)="Y",DIR("A")="Would you like to try printing these on PIN FED labels",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)  G:Y=1 ^PSDLBLR1
"RTN","PSDLBLR",22,0)
 W $C(7),!!,?3,"WARNING: The printing of these labels requires the use of a sheet fed",!,?12,"laser printer setup to create Controlled Substances",!,?12,"barcodes.",!
"RTN","PSDLBLR",23,0)
 W !,?12,"*** Check printer for LABEL paper before printing! ***",!
"RTN","PSDLBLR",24,0)
 W !!,"This report is designed for a 3 column label format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLBLR",25,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",10),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDLBLR",26,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBLR",27,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBLR0",ZTDESC="Print Dispensing Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBLR",28,0)
 U IO D ^PSDLBLR0
"RTN","PSDLBLR",29,0)
END ;kill variables and exit
"RTN","PSDLBLR",30,0)
 K %,%DT,%H,%I,%ZIS,C,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBLR",31,0)
 K POP,PSD,PSD1,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBLR",32,0)
 K QTY,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLR",33,0)
 K ^TMP("PSDLBLR",$J)
"RTN","PSDLBLR",34,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLR",35,0)
 Q
"RTN","PSDLBLR",36,0)
SAVE ;save queued variables
"RTN","PSDLBLR",37,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDLBLR",38,0)
 S ZTSAVE("PSD1(")=""
"RTN","PSDLBLR",39,0)
 Q
"RTN","PSDLBLR0")
0^106^B8845426
"RTN","PSDLBLR0",1,0)
PSDLBLR0 ;BIR/JPW-CS Label Reprt for CS Disp Drug (cont'd) ; 17 May 94
"RTN","PSDLBLR0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLR0",3,0)
START ;entry for compile and print labels
"RTN","PSDLBLR0",4,0)
 K ^TMP("PSDLBLR",$J),PSDPRT D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDLBLR0",5,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBLR0",6,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBLR0",7,0)
 S PSDCNT=1,PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDLBLR0",8,0)
PRINT ;print labels
"RTN","PSDLBLR0",9,0)
 S (PSDCNT,PSDOUT)=0,PSDX2=1
"RTN","PSDLBLR0",10,0)
 S PSD="" F  S PSD=$O(^TMP("PSDLBLR",$J,PSD)) Q:PSD=""!(PSDOUT)  S PSDCNT=PSDCNT+1,TEMP(PSDCNT)=$E($P(^TMP("PSDLBLR",$J,PSD),"^",2),1,28),TEST(PSDCNT)=$P(^TMP("PSDLBLR",$J,PSD),"^")_"  "_$P(^TMP("PSDLBLR",$J,PSD),"^",3) D:PSDCNT=3 PRINT1
"RTN","PSDLBLR0",11,0)
 I PSDCNT,PSDCNT<3 D PRINT1
"RTN","PSDLBLR0",12,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBLR0",13,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBLR0",14,0)
END ;kill variables and exit
"RTN","PSDLBLR0",15,0)
 K %,%DT,%H,%I,%ZIS,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBLR0",16,0)
 K POP,PSD,PSD1,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBLR0",17,0)
 K QTY,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLR0",18,0)
 K ^TMP("PSDLBLR",$J)
"RTN","PSDLBLR0",19,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLR0",20,0)
 Q
"RTN","PSDLBLR0",21,0)
PRINT1 ;prints labels
"RTN","PSDLBLR0",22,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,$E(TEMP(PSDX1+1),1,30)
"RTN","PSDLBLR0",23,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,$P(TEST(PSDX1)," "),@PSDBAR0
"RTN","PSDLBLR0",24,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBLR0",25,0)
 W !!
"RTN","PSDLBLR0",26,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBLR0",27,0)
 Q
"RTN","PSDLBLR0",28,0)
LOOP S PSD=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSD="" S PSDCNT=1 Q
"RTN","PSDLBLR0",29,0)
 F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"D",PSD,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBLR0",30,0)
 G LOOP
"RTN","PSDLBLR0",31,0)
 Q
"RTN","PSDLBLR0",32,0)
SET1 ;sets disp info
"RTN","PSDLBLR0",33,0)
 Q:'$D(^PSD(58.81,PSDJ,0))  S NODE=^PSD(58.81,PSDJ,0) Q:+$P(NODE,"^",3)'=+PSDS
"RTN","PSDLBLR0",34,0)
 S STAT=+$P(NODE,"^",11) S OK=$S(STAT=3:1,STAT=4:1,1:0) Q:'OK
"RTN","PSDLBLR0",35,0)
 S PSDPN=$P(NODE,"^",17) Q:PSDPN']""
"RTN","PSDLBLR0",36,0)
 S NAOU=+$P(NODE,"^",18) Q:'NAOU  S NAOUN=$P($G(^PSD(58.8,+NAOU,0)),"^")
"RTN","PSDLBLR0",37,0)
 S PSDR=+$P(NODE,"^",5) Q:'PSDR
"RTN","PSDLBLR0",38,0)
 S PSDA=+$P(NODE,"^",20) Q:'PSDA
"RTN","PSDLBLR0",39,0)
 S PSDN=$P($G(^PSDRUG(+PSDR,0)),"^"),QTY=$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),"^",4)
"RTN","PSDLBLR0",40,0)
 S TEXT(PSDR)=PSDN_"^"_NAOUN
"RTN","PSDLBLR0",41,0)
SET ;sets ^tmp
"RTN","PSDLBLR0",42,0)
 ;K LIQ S:+$G(^PSD(58.8,+NAOU,1,+PSDR,7)) LIQ="L"
"RTN","PSDLBLR0",43,0)
 S ^TMP("PSDLBLR",$J,PSDPN)=PSDPN_"^"_$P(TEXT(PSDR),"^")_"^"_$E($P(TEXT(PSDR),"^",2),1,12)
"RTN","PSDLBLR0",44,0)
DIE ;update label printed
"RTN","PSDLBLR0",45,0)
 K DA,DIE,DR S DA=+PSDJ,DIE=58.81,DR="104////"_PSDT D ^DIE K DA,DIE,DR
"RTN","PSDLBLR0",46,0)
 Q
"RTN","PSDLBLR1")
0^492^B3021767
"RTN","PSDLBLR1",1,0)
PSDLBLR1 ;BIR/JPW-CS pin fed Label Reprint for CS Disp Drug ; 29 Aug 94
"RTN","PSDLBLR1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLR1",3,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",10),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDLBLR1",4,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLBLR1",5,0)
 I $D(IO("Q")) K IO("Q"),ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDLBLR2",ZTDESC="Print Dispensing Labels for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLBLR1",6,0)
 U IO D ^PSDLBLR2
"RTN","PSDLBLR1",7,0)
END ;kill variables and exit
"RTN","PSDLBLR1",8,0)
 K %,%DT,%H,%I,%ZIS,C,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBLR1",9,0)
 K POP,PSD,PSD1,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBLR1",10,0)
 K QTY,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLR1",11,0)
 K ^TMP("PSDLBLR",$J)
"RTN","PSDLBLR1",12,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLR1",13,0)
 Q
"RTN","PSDLBLR1",14,0)
SAVE ;save queued variables
"RTN","PSDLBLR1",15,0)
 S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"))=""
"RTN","PSDLBLR1",16,0)
 S ZTSAVE("PSD1(")=""
"RTN","PSDLBLR1",17,0)
 Q
"RTN","PSDLBLR2")
0^493^B7565288
"RTN","PSDLBLR2",1,0)
PSDLBLR2 ;BIR/JPW-CS PF Label Reprt for CS Disp Drug (cont'd) ; 17 May 94
"RTN","PSDLBLR2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLBLR2",3,0)
START ;entry for compile and print labels
"RTN","PSDLBLR2",4,0)
 K ^TMP("PSDLBLR",$J),PSDPRT D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDLBLR2",5,0)
 F JJ=0,1 S @("PSDBAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("PSDBAR"_JJ)=^("BAR"_JJ)
"RTN","PSDLBLR2",6,0)
 I PSDBAR1]"",PSDBAR0]"" S PSDPRT=1
"RTN","PSDLBLR2",7,0)
 S PSDCNT=1,PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDLBLR2",8,0)
PRINT ;print labels
"RTN","PSDLBLR2",9,0)
 S (PSD,PSDOUT)=0
"RTN","PSDLBLR2",10,0)
 F  S PSD=$O(^TMP("PSDLBLR",$J,PSD)) Q:PSD=""!(PSDOUT)  D
"RTN","PSDLBLR2",11,0)
 .S PSD(1)=$G(^TMP("PSDLBLR",$J,PSD))
"RTN","PSDLBLR2",12,0)
 .W !,$P(PSD(1),U,2)
"RTN","PSDLBLR2",13,0)
 .I $D(PSDPRT) W !,@PSDBAR1,$P(PSD(1),U),@PSDBAR0
"RTN","PSDLBLR2",14,0)
 .W $P(PSD(1),U),"  ",$P(PSD(1),U,3),!
"RTN","PSDLBLR2",15,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLBLR2",16,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLBLR2",17,0)
END ;kill variables and exit
"RTN","PSDLBLR2",18,0)
 K %,%DT,%H,%I,%ZIS,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DRUG,DTOUT,DUOUT,JJ,JLP1,LIQ,NAOU,NAOUN,NODE,OK
"RTN","PSDLBLR2",19,0)
 K POP,PSD,PSD1,PSDA,PSDBAR0,PSDBAR1,PSDCNT,PSDEV,PSDJ,PSDN,PSDPN,PSDOUT,PSDR,PSDRG,PSDPRT,PSDRN,PSDS,PSDSN,PSDT,PSDX1,PSDX2
"RTN","PSDLBLR2",20,0)
 K QTY,STAT,TEMP,TEST,TEXT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLBLR2",21,0)
 K ^TMP("PSDLBLR",$J)
"RTN","PSDLBLR2",22,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLBLR2",23,0)
 Q
"RTN","PSDLBLR2",24,0)
PRINT1 ;prints labels
"RTN","PSDLBLR2",25,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*33+1,$E(TEMP(PSDX1+1),1,30)
"RTN","PSDLBLR2",26,0)
 I $D(PSDPRT) W !! F PSDX1=1:1:PSDCNT W @PSDBAR1,$P(TEST(PSDX1)," "),@PSDBAR0
"RTN","PSDLBLR2",27,0)
 W ! F PSDX1=0:1:PSDCNT-1 W ?PSDX1*32+3,TEST(PSDX1+1)
"RTN","PSDLBLR2",28,0)
 W !!
"RTN","PSDLBLR2",29,0)
 S PSDCNT=0,PSDX2=PSDX2+1 S:PSDX2=11 PSDX2=1
"RTN","PSDLBLR2",30,0)
 Q
"RTN","PSDLBLR2",31,0)
LOOP S PSD=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSD="" S PSDCNT=1 Q
"RTN","PSDLBLR2",32,0)
 F PSDJ=0:0 S PSDJ=$O(^PSD(58.81,"D",PSD,PSDJ)) Q:'PSDJ  D SET1
"RTN","PSDLBLR2",33,0)
 G LOOP
"RTN","PSDLBLR2",34,0)
 Q
"RTN","PSDLBLR2",35,0)
SET1 ;sets disp info
"RTN","PSDLBLR2",36,0)
 Q:'$D(^PSD(58.81,PSDJ,0))  S NODE=^PSD(58.81,PSDJ,0) Q:+$P(NODE,"^",3)'=+PSDS
"RTN","PSDLBLR2",37,0)
 S STAT=+$P(NODE,"^",11) S OK=$S(STAT=3:1,STAT=4:1,1:0) Q:'OK
"RTN","PSDLBLR2",38,0)
 S PSDPN=$P(NODE,"^",17) Q:PSDPN']""
"RTN","PSDLBLR2",39,0)
 S NAOU=+$P(NODE,"^",18) Q:'NAOU  S NAOUN=$P($G(^PSD(58.8,+NAOU,0)),"^")
"RTN","PSDLBLR2",40,0)
 S PSDR=+$P(NODE,"^",5) Q:'PSDR
"RTN","PSDLBLR2",41,0)
 S PSDA=+$P(NODE,"^",20) Q:'PSDA
"RTN","PSDLBLR2",42,0)
 S PSDN=$P($G(^PSDRUG(+PSDR,0)),"^"),QTY=$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),"^",4)
"RTN","PSDLBLR2",43,0)
 S TEXT(PSDR)=PSDN_"^"_NAOUN
"RTN","PSDLBLR2",44,0)
SET ;sets ^tmp
"RTN","PSDLBLR2",45,0)
 ;K LIQ S:+$G(^PSD(58.8,+NAOU,1,+PSDR,7)) LIQ="L"
"RTN","PSDLBLR2",46,0)
 S ^TMP("PSDLBLR",$J,PSDPN)=PSDPN_"^"_$P(TEXT(PSDR),"^")_"^"_$E($P(TEXT(PSDR),"^",2),1,12)
"RTN","PSDLBLR2",47,0)
DIE ;update label printed
"RTN","PSDLBLR2",48,0)
 K DA,DIE,DR S DA=+PSDJ,DIE=58.81,DR="104////"_PSDT D ^DIE K DA,DIE,DR
"RTN","PSDLBLR2",49,0)
 Q
"RTN","PSDLSTK")
0^107^B9473155
"RTN","PSDLSTK",1,0)
PSDLSTK ;BIR/JPW-List Active Stock Items for NAOUs ; 6 July 94
"RTN","PSDLSTK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLSTK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDLSTK",4,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDLSTK",5,0)
ASKN ;ask NAOU(s)
"RTN","PSDLSTK",6,0)
 D NOW^%DTC S PSDT=X K DA,DIC
"RTN","PSDLSTK",7,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDLSTK",8,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDLSTK",9,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="P",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDLSTK",10,0)
 K DA,DIR,DIRUT S DIR(0)="SO^T:TYPE/LOCATION/DRUG;A:ALPHABETICALLY BY DRUG",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDLSTK",11,0)
 S DIR("?",1)="Enter 'T' if you wish to print the NAOU stock list sorted by TYPE",DIR("?",2)="  and within TYPE by LOCATION.",DIR("?")="Enter 'A' to print the NAOU stock list alphabetically."
"RTN","PSDLSTK",12,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDLSTK",13,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDLSTK",14,0)
DEV ;asks device and queueing information
"RTN","PSDLSTK",15,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDLSTK",16,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(ANS="T":"START^PSDLSTK1",1:"START^PSDLSTK2"),ZTDESC="CS PHARM List Stock Drugs" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDLSTK",17,0)
 U IO G:ANS="T" START^PSDLSTK1 G:ANS="A" START^PSDLSTK2
"RTN","PSDLSTK",18,0)
END ;
"RTN","PSDLSTK",19,0)
 K %,%H,%I,%ZIS,ANS,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),NAOU,POP,PSD,PSDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDLSTK",20,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLSTK",21,0)
 Q
"RTN","PSDLSTK",22,0)
SAVE ;save variables for queueing
"RTN","PSDLSTK",23,0)
 S ZTSAVE("ANS")="",ZTSAVE=("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(NAOU) ZTSAVE("NAOU(")=""
"RTN","PSDLSTK",24,0)
 Q
"RTN","PSDLSTK1")
0^108^B12195708
"RTN","PSDLSTK1",1,0)
PSDLSTK1 ;BIR/JPW-Print Stock Drugs by Type/Location ; 2 Aug 94
"RTN","PSDLSTK1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLSTK1",3,0)
START ;entry point for report
"RTN","PSDLSTK1",4,0)
 K ^TMP("PSDLSTK",$J)
"RTN","PSDLSTK1",5,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) G:'PSD PRINT I $D(^PSD(58.8,PSD,0)) F DRUG=0:0 S DRUG=$O(^PSD(58.8,PSD,1,DRUG)) Q:'DRUG  D
"RTN","PSDLSTK1",6,0)
 .Q:'$D(^PSD(58.8,PSD,1,DRUG,0))  I +$P(^PSD(58.8,PSD,1,DRUG,0),"^",14) D NOW^%DTC I $P(^PSD(58.8,PSD,1,DRUG,0),"^",14)'>X Q
"RTN","PSDLSTK1",7,0)
 .Q:'$D(^PSDRUG(DRUG,0))  I $D(^PSDRUG(DRUG,0)) S DRUGN=$S($P(^PSDRUG(DRUG,0),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDLSTK1",8,0)
 .I '$D(^PSD(58.8,PSD,1,DRUG,2,0)) S TYPE="9999" D SET Q
"RTN","PSDLSTK1",9,0)
 .F TYP=0:0 S TYP=$O(^PSD(58.8,PSD,1,DRUG,2,TYP)) Q:'TYP  S TYPE=TYP D SET
"RTN","PSDLSTK1",10,0)
PRINT ;print data for stock drugs
"RTN","PSDLSTK1",11,0)
 K LN S $P(LN,"-",132)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y D HDR Q:PSDOUT
"RTN","PSDLSTK1",12,0)
 I '$D(^TMP("PSDLSTK",$J)) W !!,?45,"*****  NO DATA FOR THIS REPORT  *****" G DONE
"RTN","PSDLSTK1",13,0)
 F NAOU=0:0 S NAOU=$O(^TMP("PSDLSTK",$J,NAOU)) Q:'NAOU!(PSDOUT)  D:$Y+5>IOSL HDR W !,"=>",$S($P(^PSD(58.8,NAOU,0),"^")]"":$P(^(0),"^"),1:"#"_NAOU_" NAME MISSING") D
"RTN","PSDLSTK1",14,0)
 .F TYP=0:0 S TYP=$O(^TMP("PSDLSTK",$J,NAOU,TYP)) Q:'TYP!(PSDOUT)  S TYPE=$S(TYP=9999:"UNCLASSIFIED BY TYPE",$D(^PSI(58.16,TYP,0)):$P(^(0),"^"),1:"TYPE NAME MISSING") D:$Y+5>IOSL HDR Q:PSDOUT  W !,?5,"TYPE: "_TYPE,! D
"RTN","PSDLSTK1",15,0)
 ..S LOC="" F  S LOC=$O(^TMP("PSDLSTK",$J,NAOU,TYP,LOC)) Q:LOC=""!(PSDOUT)  S LOCN=$S(LOC["Z":"NOT LISTED",1:LOC) S DRUG="" F  S DRUG=$O(^TMP("PSDLSTK",$J,NAOU,TYP,LOC,DRUG)) Q:DRUG=""!(PSDOUT)  D:$Y+5>IOSL HDR Q:PSDOUT  D
"RTN","PSDLSTK1",16,0)
 ...W ?8,LOCN,?30,$S(DRUG["ZZ/":"#"_$P(DRUG,"/",2)_" NAME MISSING",1:DRUG),?81,$J($P(^TMP("PSDLSTK",$J,NAOU,TYP,LOC,DRUG),"^"),6),?116,$J($P(^(DRUG),"^",2),6),!
"RTN","PSDLSTK1",17,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLSTK1",18,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLSTK1",19,0)
END ;
"RTN","PSDLSTK1",20,0)
 K %,%DT,%H,%I,%ZIS,ANS,DA,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),LN,LOC,LOCN,NAOU,NODE,PG,POP,PSD,PSDOUT,PSDT,RPDT,RSTK,STK,TYP,TYPE,X,Y,^TMP("PSDLSTK",$J)
"RTN","PSDLSTK1",21,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLSTK1",22,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLSTK1",23,0)
 Q
"RTN","PSDLSTK1",24,0)
HDR ;lists header information
"RTN","PSDLSTK1",25,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDLSTK1",26,0)
 W:$Y @IOF S PG=PG+1 W !,"NAOU STOCK LIST BY TYPE/LOCATION  -  DATE: "_RPDT,?121,"PAGE: "_PG,!!,?2,"NARCOTIC AREA OF USE"
"RTN","PSDLSTK1",27,0)
 W !,?5,"TYPE",!,?8,"LOCATION",?44,"DRUG",?80,"STOCK LEVEL",?115,"REORDER LEVEL",!,LN,!
"RTN","PSDLSTK1",28,0)
 Q
"RTN","PSDLSTK1",29,0)
SET ;sets data in ^TMP global
"RTN","PSDLSTK1",30,0)
 S NODE=^PSD(58.8,PSD,1,DRUG,0)
"RTN","PSDLSTK1",31,0)
 S LOC=$S($P(NODE,"^",2)]"":$P(NODE,"^",2),1:"Z"),STK=$S($P(NODE,"^",3)]"":$P(NODE,"^",3),1:"NOT LISTED")
"RTN","PSDLSTK1",32,0)
 S RSTK=$S($P(NODE,"^",5)]"":$P(NODE,"^",5),1:"NOT LISTED")
"RTN","PSDLSTK1",33,0)
 S ^TMP("PSDLSTK",$J,PSD,TYPE,LOC,DRUGN)=STK_"^"_RSTK
"RTN","PSDLSTK1",34,0)
 Q
"RTN","PSDLSTK2")
0^109^B10052755
"RTN","PSDLSTK2",1,0)
PSDLSTK2 ;BIR/JPW-Print Stock Drugs Alphabetically ; 2 Aug 94
"RTN","PSDLSTK2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDLSTK2",3,0)
START ;entry point for report
"RTN","PSDLSTK2",4,0)
 K ^TMP("PSDLSTK",$J)
"RTN","PSDLSTK2",5,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) G:'PSD PRINT S:$D(^PSD(58.8,PSD,0)) NAOUN=$S($P(^(0),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD) F DRUG=0:0 S DRUG=$O(^PSD(58.8,PSD,1,DRUG)) Q:'DRUG  I $D(^PSD(58.8,PSD,1,DRUG,0)) D
"RTN","PSDLSTK2",6,0)
 .Q:'$D(^PSD(58.8,PSD,1,DRUG,0))  I +$P(^PSD(58.8,PSD,1,DRUG,0),"^",14) D NOW^%DTC I $P(^PSD(58.8,PSD,1,DRUG,0),"^",14)'>X Q
"RTN","PSDLSTK2",7,0)
 .Q:'$D(^PSDRUG(DRUG,0))  I $D(^PSDRUG(DRUG,0)) S DRUGN=$S($P(^PSDRUG(DRUG,0),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDLSTK2",8,0)
 .S NODE=^PSD(58.8,PSD,1,DRUG,0),LOC=$S($P(NODE,"^",2)]"":$P(NODE,"^",2),1:"NOT LISTED"),STK=$S($P(NODE,"^",3)]"":$P(NODE,"^",3),1:"NOT LISTED"),RSTK=$S($P(NODE,"^",5)]"":$P(NODE,"^",5),1:"NOT LISTED")
"RTN","PSDLSTK2",9,0)
 .S ^TMP("PSDLSTK",$J,NAOUN,DRUGN)=LOC_"^"_STK_"^"_RSTK
"RTN","PSDLSTK2",10,0)
PRINT ;prints data for stock drugs
"RTN","PSDLSTK2",11,0)
 K LN S $P(LN,"-",132)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y D HEADER Q:PSDOUT
"RTN","PSDLSTK2",12,0)
 I '$D(^TMP("PSDLSTK",$J)) W !!,?45,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDLSTK2",13,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDLSTK",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D:$Y+5>IOSL HEADER Q:PSDOUT  W !!,"=> ",$S(NAOU["ZZ/":"#"_$P(NAOU,"/",2)_" NAME MISSING",1:NAOU) D
"RTN","PSDLSTK2",14,0)
 .S DRUG="" F  S DRUG=$O(^TMP("PSDLSTK",$J,NAOU,DRUG)) Q:DRUG=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDLSTK2",15,0)
 ..S NODE=^TMP("PSDLSTK",$J,NAOU,DRUG),LOC=$P(NODE,"^"),STK=$P(NODE,"^",2),RSTK=$P(NODE,"^",3)
"RTN","PSDLSTK2",16,0)
 ..I $Y+5>IOSL D HEADER Q:PSDOUT  W !!,"=> ",$S(NAOU["ZZ/":"#"_$P(NAOU,"/",2)_" NAME MISSING",1:NAOU)
"RTN","PSDLSTK2",17,0)
 ..W !,?4,DRUG,?58,LOC,?75,$J(STK,6),?93,$J(RSTK,6)
"RTN","PSDLSTK2",18,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDLSTK2",19,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDLSTK2",20,0)
END ;
"RTN","PSDLSTK2",21,0)
 K %,%DT,%H,%I,%ZIS,ANS,DA,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),LOC,LN,NAOU,NAOUN,NODE,PG,POP,PSD,PSDT,PSDOUT,RPDT,RSTK,STK,TYP,TYPE,X,Y,^TMP("PSDLSTK",$J)
"RTN","PSDLSTK2",22,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDLSTK2",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDLSTK2",24,0)
 Q
"RTN","PSDLSTK2",25,0)
HEADER ;lists header information
"RTN","PSDLSTK2",26,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDLSTK2",27,0)
 W:$Y @IOF S PG=PG+1 W !,"ALPHABETICAL LISTING OF NAOU STOCK  -  DATE: "_RPDT,?121,"PAGE: "_PG,!!,?2,"NARCOTIC AREA OF USE"
"RTN","PSDLSTK2",28,0)
 W !,?12,"DRUG",?57,"LOCATION",?74,"STOCK LEVEL",?92,"REORDER LEVEL",!,LN,!
"RTN","PSDLSTK2",29,0)
 Q
"RTN","PSDMAPU")
0^110^B9064398
"RTN","PSDMAPU",1,0)
PSDMAPU ;BIR/JPW-Stock Missing CS Appl. Pkg. Use ; 22 Jun 93
"RTN","PSDMAPU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDMAPU",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDMAPU",4,0)
 S PSDUZ=DUZ D NOW^%DTC S PSDT=X
"RTN","PSDMAPU",5,0)
DEV ;sets queueing information
"RTN","PSDMAPU",6,0)
 S ZTIO="",ZTRTN="START^PSDMAPU",ZTDESC="CS PHARM NON-CS DRUG BACKGROUND JOB" S (ZTSAVE("PSDUZ"),ZTSAVE("PSDT"),ZTSAVE("PSDSITE"))="" D ^%ZTLOAD K ZTSK G END
"RTN","PSDMAPU",7,0)
START ;queued entry point to check for non-CS entries in file 50
"RTN","PSDMAPU",8,0)
 K ^TMP("PSDAPU",$J)
"RTN","PSDMAPU",9,0)
 F PSDA=0:0 S PSDA=$O(^PSD(58.8,PSDA)) Q:'PSDA  I $D(^PSD(58.8,PSDA,0)),$S($P(^(0),"^",2)'="P":1,1:0),$S('$D(^("I")):1,'+^("I"):1,+^("I")>DT:1,1:0) D
"RTN","PSDMAPU",10,0)
 .Q:$P($G(^PSD(58.8,PSDA,0)),"^",3)'=+PSDSITE
"RTN","PSDMAPU",11,0)
 .F PSDR=0:0 S PSDR=$O(^PSD(58.8,PSDA,1,PSDR)) Q:'PSDR  Q:'$D(^PSD(58.8,PSDA,1,PSDR,0))  D
"RTN","PSDMAPU",12,0)
 ..S OK=$S($P($G(^PSDRUG(PSDR,2)),"^",3)["N":1,1:0) Q:OK
"RTN","PSDMAPU",13,0)
 ..I $P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)="" K DA,DIE,DR S DA(1)=PSDA,DA=PSDR,DIE="^PSD(58.8,"_PSDA_",1,",DR="13///"_PSDT_";14////O;14.5////NON-CS DRUG" D ^DIE K DIE D
"RTN","PSDMAPU",14,0)
 ...S NAOU=$S($P(^PSD(58.8,PSDA,0),"^")]"":$P(^(0),"^"),1:"NAME MISSING"),PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING"),^TMP("PSDAPU",$J,PSDRN,NAOU)=""
"RTN","PSDMAPU",15,0)
MSG ;send mailman message with completed info
"RTN","PSDMAPU",16,0)
 K XMY,^TMP("PSDMAPU",$J) S MLN=1
"RTN","PSDMAPU",17,0)
 I '$D(^TMP("PSDAPU",$J)) S ^TMP("PSDMAPU",$J,MLN,0)="   THERE ARE NO CS DRUGS STOCKED IN ANY NAOUS WHICH HAVE BEEN",MLN=MLN+1,^TMP("PSDMAPU",$J,MLN,0)="   UNMARKED FOR CS USE "
"RTN","PSDMAPU",18,0)
 I $D(^TMP("PSDAPU",$J)) S NN="" F  S NN=$O(^TMP("PSDAPU",$J,NN)) Q:NN=""  S ^TMP("PSDMAPU",$J,MLN,0)=NN_" was inactivated in the following NAOU(s):",JJ="" F  S JJ=$O(^TMP("PSDAPU",$J,NN,JJ)) Q:JJ=""  D
"RTN","PSDMAPU",19,0)
 .S MLN=MLN+1,^TMP("PSDMAPU",$J,MLN,0)="  "_JJ
"RTN","PSDMAPU",20,0)
 S XMSUB="CS PHARM NON-CS DRUG SUMMARY",XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMTEXT="^TMP(""PSDMAPU"",$J,",XMY(PSDUZ)="" S:'$D(XMY) XMY(.5)=""
"RTN","PSDMAPU",21,0)
 D ^XMD K XMY,^TMP("PSDMAPU",$J)
"RTN","PSDMAPU",22,0)
END K %,%DT,%H,%I,DA,DIE,DR,JJ,MLN,NAOU,NN,OK,PSDA,PSDR,PSDRN,PSDT,PSDUZ,X,XMSUB,XMDUZ,XMTEXT,XMY,Y,^TMP("PSDAPU",$J)
"RTN","PSDMAPU",23,0)
 K ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDMFG")
0^111^B4791872
"RTN","PSDMFG",1,0)
PSDMFG ;BIR/JPW-Enter/Edit Drug Mfg/Lot #/Exp. Dates ; 8 Aug 94
"RTN","PSDMFG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDMFG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDMFG",4,0)
 W !!,"Enter Manufacturer, Lot #, and/or Expiration Dates for Stock Drugs"
"RTN","PSDMFG",5,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDMFG",6,0)
 I $P(PSDSITE,U,5) S PSDOUT=0 W !!,"Dispensing Site: ",PSDSN,! D DIE G END
"RTN","PSDMFG",7,0)
MFG ;
"RTN","PSDMFG",8,0)
 S PSDOUT=0 K DA,DIC S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDMFG",9,0)
SEL ;select disp site
"RTN","PSDMFG",10,0)
 W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDMFG",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDMFG",12,0)
 S PSDS=+Y,$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDMFG",13,0)
 D DIE G:PSDOUT END
"RTN","PSDMFG",14,0)
 G SEL
"RTN","PSDMFG",15,0)
END K DA,DIC,DIE,DR,DTOUT,DUOUT,PSDOUT,PSDS,PSDSN,PSDR,SITE,X,Y
"RTN","PSDMFG",16,0)
 Q
"RTN","PSDMFG",17,0)
DIE ;edit mfg/lot#/exp. date
"RTN","PSDMFG",18,0)
 I '$D(^PSD(58.8,PSDS,1,0)) W !!,"There are no stocked drugs for this Dispensing Site!!",!! Q
"RTN","PSDMFG",19,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDMFG",20,0)
 S DA(1)=+PSDS,DIC(0)="QEAMZ",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDMFG",21,0)
 Q:Y<0
"RTN","PSDMFG",22,0)
 S PSDR=+Y W !!,"STOCKED DRUG: "_Y(0,0) I $P($G(^PSD(58.8,PSDS,1,PSDR,0)),"^",14)]"",$P(^(0),"^",14)'>DT W ?45,"   *** INACTIVE ***"
"RTN","PSDMFG",23,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_PSDS_",1,",DA(1)=+PSDS,DA=+PSDR,DR="9;10;11" D ^DIE K DA,DIE,DR
"RTN","PSDMFG",24,0)
 G DIE
"RTN","PSDNACT")
0^112^B7699848
"RTN","PSDNACT",1,0)
PSDNACT ;BIR/JPW-Inactivate NAOUs ; 6 July 94
"RTN","PSDNACT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNACT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNACT",4,0)
 W !!,?10,"Inactivate NAOUs" D NOW^%DTC S PSDT=X
"RTN","PSDNACT",5,0)
NAOU ;
"RTN","PSDNACT",6,0)
 K DIC F  W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC Q:Y<0  S PSDA=+Y,PSDN=$P(Y,"^",2) K DA,DIE,DR S DIE=58.8,DA=+PSDA,DR="4" D ^DIE K DIE,DR D LOOP
"RTN","PSDNACT",7,0)
END K %,%H,%I,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,PSDA,PSDN,PSDR,PSDT,X,Y
"RTN","PSDNACT",8,0)
 Q
"RTN","PSDNACT",9,0)
LOOP ;asks for inactivating drugs and loops to complete
"RTN","PSDNACT",10,0)
 I $S('$D(^PSD(58.8,PSDA,"I")):1,'^("I"):1,^("I")>DT:1,1:0) W !!,"This NAOU is now ACTIVE.  Use the Inactivate NAOU Stock Drug option",!,"to reactivate stocked drugs within "_PSDN_"." Q
"RTN","PSDNACT",11,0)
 W !! K DA,DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to inactivate ALL stocked drugs within this NAOU"
"RTN","PSDNACT",12,0)
 S DIR("?",1)="Answer 'YES' to inactivate all stocked drugs in this NAOU,",DIR("?")="answer 'NO' to leave all stocked drugs ACTIVE in this NAOU."
"RTN","PSDNACT",13,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG Q
"RTN","PSDNACT",14,0)
 I '$D(^PSD(58.8,PSDA,1,0)) W !!,"There are no stocked drugs for this NAOU!!",!! Q
"RTN","PSDNACT",15,0)
 W !!,"Inactivating all stocked drugs within "_PSDN_"..."
"RTN","PSDNACT",16,0)
 F PSDR=0:0 S PSDR=$O(^PSD(58.8,PSDA,1,PSDR)) Q:'PSDR  I $D(^PSD(58.8,PSDA,1,PSDR,0)) K DA,DIE,DR S DA=+PSDR,DA(1)=+PSDA,DIE="^PSD(58.8,"_PSDA_",1,",DR="13////"_PSDT_";14////O;14.5////NAOU INACTIVATED" D ^DIE K DIE,DR W "."
"RTN","PSDNACT",17,0)
MSG W !!,PSDN," has been inactivated.",!
"RTN","PSDNACT",18,0)
 Q
"RTN","PSDNARC")
0^113^B4743748
"RTN","PSDNARC",1,0)
PSDNARC ;BIR/JPW-Enter/Edit Narcotic Breakdown Info ; 8 Aug 94
"RTN","PSDNARC",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNARC",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNARC",4,0)
 W !!,"Enter Narcotic Breakdown Unit and Package Size for Stock Drugs"
"RTN","PSDNARC",5,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDNARC",6,0)
 I $P(PSDSITE,U,5) S PSDOUT=0 W !!,"Dispensing Site: ",PSDSN,! D DIE G END
"RTN","PSDNARC",7,0)
NARC ;
"RTN","PSDNARC",8,0)
 S PSDOUT=0 K DA,DIC S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDNARC",9,0)
SEL ;select disp. vault in file 58.8
"RTN","PSDNARC",10,0)
 W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDNARC",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDNARC",12,0)
 S PSDS=+Y,$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDNARC",13,0)
 D DIE G:PSDOUT END
"RTN","PSDNARC",14,0)
 G SEL
"RTN","PSDNARC",15,0)
END K DA,DIC,DIE,DR,DTOUT,DUOUT,PSDOUT,PSDS,PSDSN,PSDR,SITE,X,Y
"RTN","PSDNARC",16,0)
 Q
"RTN","PSDNARC",17,0)
DIE ;edit narcotic breakdown unit and package size
"RTN","PSDNARC",18,0)
 I '$D(^PSD(58.8,PSDS,1,0)) W !!,"There are no stocked drugs for this Dispensing Site!!",!! Q
"RTN","PSDNARC",19,0)
 K DA,DIC W ! S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDNARC",20,0)
 S DA(1)=+PSDS,DIC(0)="QEAMZ",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDNARC",21,0)
 Q:Y<0
"RTN","PSDNARC",22,0)
 S PSDR=+Y W !!,"STOCKED DRUG: "_Y(0,0) I $P($G(^PSD(58.8,PSDS,1,PSDR,0)),"^",14)]"",$P(^(0),"^",14)'>DT W ?45,"   *** INACTIVE ***"
"RTN","PSDNARC",23,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_PSDS_",1,",DA(1)=+PSDS,DA=+PSDR,DR="7;8" D ^DIE K DA,DIE,DR
"RTN","PSDNARC",24,0)
 G DIE
"RTN","PSDNBT")
0^114^B15488158
"RTN","PSDNBT",1,0)
PSDNBT ;BIR/JPW-GS Trans Between NAOUs Not Rec Report ; 2 Aug 94
"RTN","PSDNBT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNBT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNBT",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"review this narcotics report.",! K OK Q
"RTN","PSDNBT",5,0)
 W !!,"Green Sheets Transferred Between NAOUs Pending Receipt",!!
"RTN","PSDNBT",6,0)
DEV ;ask device and queue info
"RTN","PSDNBT",7,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDNBT",8,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNBT",9,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDNBT",ZTDESC="CS Transfer GS Not Recd Report" S ZTSAVE("PSDSITE")="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNBT",10,0)
 U IO
"RTN","PSDNBT",11,0)
START ;compile data
"RTN","PSDNBT",12,0)
 K ^TMP("PSDNBT",$J)
"RTN","PSDNBT",13,0)
 F JJ=0:0 S JJ=$O(^PSD(58.8,JJ)) Q:'JJ  I $D(^PSD(58.8,JJ,0)),$P(^(0),"^",3)=+PSDSITE S NAOU(JJ)=""
"RTN","PSDNBT",14,0)
 F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",10,PSD)) Q:'PSD  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",10,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)),$D(^PSD(58.81,PSDA,7)) D
"RTN","PSDNBT",15,0)
 .Q:$D(^PSD(58.81,"AE",PSDA))  S NODE=^PSD(58.81,PSDA,0),PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDNBT",16,0)
 .S NAOU=+$P(NODE,"^",18) Q:'$D(NAOU(NAOU))  S NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_NAOU) I NAOUN'="UNKNOWN"
"RTN","PSDNBT",17,0)
 .Q:'$D(NAOU(NAOU))
"RTN","PSDNBT",18,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDNBT",19,0)
 .S NODE7=^PSD(58.81,PSDA,7),QTY=+$P(NODE7,"^",7),NAOUT=$P(NODE7,"^",3),TRFD=+$P(NODE7,"^"),NURSF=+$P(NODE7,"^",2)
"RTN","PSDNBT",20,0)
 .S NAOUTN=$P($G(^PSD(58.8,NAOUT,0)),"^") I TRFD S Y=TRFD X ^DD("DD") S TRFD=Y
"RTN","PSDNBT",21,0)
 .I NURSF S NURSF=$P($G(^VA(200,NURSF,0)),"^"),NURSF=$P(NURSF,",")_","_$E($P(NURSF,",",2))
"RTN","PSDNBT",22,0)
 .S ^TMP("PSDNBT",$J,DRUGN,PSDPN,PSDA)=NAOUTN_"^"_NAOUN_"^"_QTY_"^"_TRFD_"^"_NURSF
"RTN","PSDNBT",23,0)
PRINT ;print 
"RTN","PSDNBT",24,0)
 D NOW^%DTC S Y=X X ^DD("DD") S RPDT=Y
"RTN","PSDNBT",25,0)
 S (PG,PSDOUT)=0
"RTN","PSDNBT",26,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDNBT",$J)) D HDR W !!,?30,"****  NO GREEN SHEETS TRANSFERRED BETWEEN NAOUs PENDING RECEIPT  ****",! G DONE
"RTN","PSDNBT",27,0)
 D HDR S DRUG="" F  S DRUG=$O(^TMP("PSDNBT",$J,DRUG)) Q:DRUG=""!(PSDOUT)  W !!,?5,"= > ",DRUG,! D
"RTN","PSDNBT",28,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDNBT",$J,DRUG,NUM)) Q:NUM=""!(PSDOUT)  F PSD=0:0 S PSD=$O(^TMP("PSDNBT",$J,DRUG,NUM,PSD)) Q:'PSD!(PSDOUT)  D
"RTN","PSDNBT",29,0)
 ..I $Y+5>IOSL D HDR Q:PSDOUT  W !!,?5,"=> ",DRUG,!
"RTN","PSDNBT",30,0)
 ..S NODE=^TMP("PSDNBT",$J,DRUG,NUM,PSD) W !,NUM,?12,$P(NODE,"^",4),?38,$E($P(NODE,"^",2),1,25),?60,$J($P(NODE,"^",3),6),?80,$P(NODE,"^",5),?100,$E($P(NODE,"^"),1,30)
"RTN","PSDNBT",31,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNBT",32,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNBT",33,0)
END ;
"RTN","PSDNBT",34,0)
 K %,%DT,%H,%I,%ZIS,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,IO("Q"),JJ,LN,NAOU,NAOUN,NAOUT,NAOUTN,NODE,NODE7,NUM,NURSF
"RTN","PSDNBT",35,0)
 K OK,POP,PG,PHARM,PHARMN,POP,PSD,PSDA,PSDDT,PSDOUT,PSDPN,PSDS,PSDSN,PSDST,QTY,RPDT,TRFD,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNBT",36,0)
 K ^TMP("PSDNBT",$J),^TMP("PSDFNDT",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNBT",37,0)
 Q
"RTN","PSDNBT",38,0)
HDR ;header for log
"RTN","PSDNBT",39,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNBT",40,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"GREEN SHEETS TRANSFERRED BETWEEN NAOUs PENDING RECEIPT",?115,"Page: ",PG,!,?40,RPDT,!
"RTN","PSDNBT",41,0)
 W !!,?5,"=> DRUG",!,?16,"DATE",?38,"NAOU",?82,"NURSE",?104,"NAOU"
"RTN","PSDNBT",42,0)
 W !,"DISP #",?11,"TRANSFERRED FROM",?32,"TRANSFERRED FROM",?62,"QUANTITY",?80,"TRANSFERRING",?100,"TRANSFERRED TO",!,LN
"RTN","PSDNBT",43,0)
 Q
"RTN","PSDNCGS")
0^115^B13436903
"RTN","PSDNCGS",1,0)
PSDNCGS ;BIR/JPW-Complete Green Sheet - Ready for Pickup ; 10 Jan 94
"RTN","PSDNCGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNCGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNCGS",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDNCGS",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to complete",!,?12,"narcotic orders.",!!,"PSJ RNURSE or PSD NURSE security key required.",! K OK Q
"RTN","PSDNCGS",6,0)
 W !!,"Complete a Green Sheet - Ready for Pick Up" S PSDUZ=DUZ,PSDUZN=$S($P($G(^VA(200,PSDUZ,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDNCGS",7,0)
ASKN ;if nurse ask naou
"RTN","PSDNCGS",8,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: "
"RTN","PSDNCGS",9,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNCGS",10,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDNCGS",11,0)
GS ;select green sheet #
"RTN","PSDNCGS",12,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDNCGS",13,0)
 S DIC("S")="I $P(^(0),""^"",11),$P(^(0),""^"",11)<10!($P(^(0),U,11)=12)!($P(^(0),U,11)=13)"
"RTN","PSDNCGS",14,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDNCGS",15,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDNCGS",16,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDNCGS",17,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDNCGS",18,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNCGS",19,0)
 I STAT'=4&(STAT'=12)&(STAT'=13) W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDNCGS",20,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDNCGS",21,0)
 S DIR("?",1)="Answer 'YES' to flag this Green Sheet ready for pharmacy pickup or",DIR("?")="answer 'NO' to leave the Green Sheet status active on the NAOU."
"RTN","PSDNCGS",22,0)
 D ^DIR K DIR G:$D(DIRUT) END G:'Y GS
"RTN","PSDNCGS",23,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDNCGS",24,0)
COM ;complete at order level in 58.8
"RTN","PSDNCGS",25,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDNCGS",26,0)
 W !!,"Updating your records now..."
"RTN","PSDNCGS",27,0)
 ;update transaction file (58.81)
"RTN","PSDNCGS",28,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="29////"_PSDUZ_";29.5////"_RECD_";10////5" D ^DIE K DA,DIE,DR
"RTN","PSDNCGS",29,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN COMPLETED **",!!,"The status remains "_STATN,! G END
"RTN","PSDNCGS",30,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////5" D ^DIE K DA,DIE,DR
"RTN","PSDNCGS",31,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,!,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDNCGS",32,0)
 G GS
"RTN","PSDNCGS",33,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDNCGS",34,0)
 K NAOU,NAOUN,OK,ORD,PSDA,PSDPN,PSDR,PSDRN,PSDUZ,PSDUZN,RECD,RECDT,STAT,STATN,SUB,TRANS,X,Y
"RTN","PSDNCGS",35,0)
 Q
"RTN","PSDNDES")
0^117^B20150900
"RTN","PSDNDES",1,0)
PSDNDES ;BIR/JPW-Dispense from Pharmacy w/o Green Sheet ; 8 Aug 94
"RTN","PSDNDES",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNDES",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNDES",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"dispense narcotic supplies.  PSJ RPHARM security key required.",! Q
"RTN","PSDNDES",5,0)
 S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDNDES",6,0)
TEST ;to be reworked for narcotic disp equipment
"RTN","PSDNDES",7,0)
 W !!,"For now this option is the same as dispense w/o green sheet.",!!
"RTN","PSDNDES",8,0)
ASKD ;ask disp loc
"RTN","PSDNDES",9,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDNDES",10,0)
 I $P(PSDSITE,U,5) S ASK=$P($G(^PSD(58.8,+PSDS,0)),U,5) G CHKD
"RTN","PSDNDES",11,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDNDES",12,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=PSDSN
"RTN","PSDNDES",13,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDNDES",14,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),ASK=$P(Y(0),"^",5)
"RTN","PSDNDES",15,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDNDES",16,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no stocked drugs for this Pharmacy Vault!!",!! G END
"RTN","PSDNDES",17,0)
DRUG ;select drug
"RTN","PSDNDES",18,0)
 S PSDOUT=0 W !
"RTN","PSDNDES",19,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDNDES",20,0)
 S DA(1)=+PSDS,DIC(0)="QEAMZ",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC G:Y<0 END S PSDR=+Y,PSDRN=$P($G(^PSDRUG(+PSDR,0)),"^")
"RTN","PSDNDES",21,0)
 I '$D(^PSD(58.8,+PSDS,1,+PSDR,0)) W $C(7),!!,?10,"** Your Dispensing Site is missing stock drug data.",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNDES",22,0)
 S (MFG,LOT,EXP,EXPD,NBKU,NPKG)="",MFG=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",10),LOT=$P(^(0),"^",11),EXP=$P(^(0),"^",12),NBKU=$P(^(0),"^",8),NPKG=$P(^(0),"^",9)
"RTN","PSDNDES",23,0)
 I 'NPKG!(NBKU']"") W $C(7),!!,PSDRN," is missing breakdown unit or",!,"package size data in ",PSDSN,"." D MSG G END
"RTN","PSDNDES",24,0)
 I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDNDES",25,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDNDES",26,0)
 I NBKU']"" W !!,PSDSN,"is missing narcotic breakdown unit",!,"for ",PSDRN,"." G END
"RTN","PSDNDES",27,0)
 I 'NPKG W !!,PSDSN,"is missing narcotic package size",!,"for ",PSDRN,"." G END
"RTN","PSDNDES",28,0)
NAOU ;select NAOU
"RTN","PSDNDES",29,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDNDES",30,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"""
"RTN","PSDNDES",31,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDNDES",32,0)
QTY K DA,DIR,DIRUT S DIR(0)="58.85,18O",DIR("B")=NPKG,DIR("A")="QUANTITY DISPENSED ("_NBKU_"/"_NPKG_")" D ^DIR K DIR I 'Y!$D(DIRUT) D MSG G END
"RTN","PSDNDES",33,0)
 S QTY=+Y I QTY>+$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4) W !!,"The drug balance for this drug is ",+$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4),".",!,"You cannot dispense ",QTY," for this drug.",!! G END
"RTN","PSDNDES",34,0)
ASKM I ASK D MFG I PSDOUT D MSG G END
"RTN","PSDNDES",35,0)
OK W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK? ",DIR("?",1)="Answer 'YES' to record dispensing this drug,"
"RTN","PSDNDES",36,0)
 S DIR("?")="NO to select another drug or '^' to quit." D ^DIR K DIR
"RTN","PSDNDES",37,0)
 I $D(DIRUT) D MSG G END
"RTN","PSDNDES",38,0)
 I 'Y D MSG G DRUG
"RTN","PSDNDES",39,0)
 D ^PSDDFP1 G:'PSDOUT DRUG
"RTN","PSDNDES",40,0)
END K %,%DT,%H,%I,ASK,BAL,DA,DIC,DIE,DIK,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EDIT,EXP,EXPD,LOT,MFG,NAOU,NAOUN,NBKU,NPKG,OK
"RTN","PSDNDES",41,0)
 K PSDDT,PSDLES,PSDOUT,PSDR,PSDREC,PSDRN,PSDS,PSDSN,PSDUZ,PSDUZN,QTY,TEXP,TLOT,TMFG,X,Y
"RTN","PSDNDES",42,0)
 Q
"RTN","PSDNDES",43,0)
MFG K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,12O",DIR("B")=MFG D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDNDES",44,0)
 I Y]"",Y'=MFG S MFG=Y S $P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",10)=MFG
"RTN","PSDNDES",45,0)
 K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,13O",DIR("B")=LOT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDNDES",46,0)
 I Y]"",Y'=LOT S LOT=Y S $P(^PSD(58.8,+PSDS,1,+PSDR,0),"^",11)=LOT
"RTN","PSDNDES",47,0)
 K DA,DIR,DTOUT,DUOUT S DIR(0)="58.81,14O",DIR("B")=EXPD D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSDOUT=1 Q
"RTN","PSDNDES",48,0)
 I Y,Y'=EXP S EXP=Y W !!,"Updating Expiration Date data..." K DA,DIE,DR S DA=+PSDR,DA(1)=+PSDS,DIE="^PSD(58.8,"_DA(1)_",1,",DR="11///"_EXP D ^DIE K DA,DIE,DR W "done.",!!
"RTN","PSDNDES",49,0)
 Q
"RTN","PSDNDES",50,0)
MSG W !!,"** No action taken. **",!!
"RTN","PSDNDES",51,0)
 Q
"RTN","PSDNRGO")
0^494^B14945935
"RTN","PSDNRGO",1,0)
PSDNRGO ;BIR/JPW-Receive Green Sheet for NAOU ; 6 Jan 94
"RTN","PSDNRGO",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNRGO",3,0)
ORD S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDNRGO",4,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),QTY=+$P(Y(0),"^",6),OK=1,PSDUZ=DUZ
"RTN","PSDNRGO",5,0)
 I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDNRGO",6,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! S PSDOUT=1 G END
"RTN","PSDNRGO",7,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! S PSDOUT=1 G END
"RTN","PSDNRGO",8,0)
 I STAT'=3 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! S PSDOUT=1 G END
"RTN","PSDNRGO",9,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDNRGO",10,0)
REC ;receive at order level in 58.8
"RTN","PSDNRGO",11,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDNRGO",12,0)
 K DA,DIR,DIRUT S DIR(0)="58.81,27",DIR("B")=QTY D ^DIR K DIR I $D(DIRUT) W !!,"Quantity not entered.  No action taken.",!,"This order remains ",STATN,!! S PSDOUT=1 G END
"RTN","PSDNRGO",13,0)
 S RQTY=Y I RQTY'=QTY W $C(7),!!,"The quantity received does not match the quantity dispensed.",!,"This order must be returned to pharmacy for investigation.",!! S PSDOUT=1 G END
"RTN","PSDNRGO",14,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU
"RTN","PSDNRGO",15,0)
 S DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,"
"RTN","PSDNRGO",16,0)
 S DR=$S(OK=1:"6////"_PSDUZ,1:"6RECEIVED BY NURSE")_";20////"_QTY_";15////"_RECD_";10////4;22////"_$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4)_";25////"_$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4) D ^DIE K DA,DIE,DR
"RTN","PSDNRGO",17,0)
 I ($D(Y))!($D(DTOUT)) W $C(7),!!,"*** THIS ORDER HAS NOT BEEN RECEIVED ***",!,"Receiving nurses name must be entered.",!!,"The status remains "_STATN,! S PSDOUT=1 G END
"RTN","PSDNRGO",18,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDNRGO",19,0)
 ;updating drug balance in 58.8
"RTN","PSDNRGO",20,0)
 ;F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDNRGO",21,0)
 S:'$P($G(^PSD(58.81,PSDA,9)),U) $P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)+QTY
"RTN","PSDNRGO",22,0)
 ;L -^PSD(58.8,NAOU,1,PSDR,0)
"RTN","PSDNRGO",23,0)
 ;update transaction file (58.81)
"RTN","PSDNRGO",24,0)
 S OREC=$P($G(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),"^",7)
"RTN","PSDNRGO",25,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81
"RTN","PSDNRGO",26,0)
 S DR="10////"_$S('$P($G(^PSD(58.8,NAOU,2)),U,5):4,$P($G(^PSD(58.81,PSDA,9)),U):4,1:13)_";20////"_OREC_";21////"_RECD_";27////"_QTY_";I OK=1 S Y=""@1"";15COMMENTS;@1"
"RTN","PSDNRGO",27,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDNRGO",28,0)
 I OK=2 S $P(^PSD(58.81,PSDA,1),"^",11)=PSDUZ
"RTN","PSDNRGO",29,0)
 W !!,"Updating your records now..."
"RTN","PSDNRGO",30,0)
 ;update worksheet file (58.85) to be purged
"RTN","PSDNRGO",31,0)
 S DA=+$O(^PSD(58.85,"AD",NAOU,PSDR,ORD,0)) I DA,$D(^PSD(58.85,DA,0)) K DIE,DR S DIE=58.85,DR="6////4" D ^DIE K DA,DIE,DR
"RTN","PSDNRGO",32,0)
 W "done.",!!
"RTN","PSDNRGO",33,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?5,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",! S NAOU(1)=1
"RTN","PSDNRGO",34,0)
END K %,%DT,%H,%I,AOUN,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDNRGO",35,0)
 K NAOUN,OK,OREC,PSDPN,PSDRN,PSDUZ,PSDUZN,QTY,RECD,RECDT,RQTY,STATN,SUB,PSDA,X,Y
"RTN","PSDNRGO",36,0)
 Q
"RTN","PSDNRGS")
0^118^B21670844
"RTN","PSDNRGS",1,0)
PSDNRGS ;BIR/JPW-Receive Green Sheet for NAOU ; 6 Jan 94
"RTN","PSDNRGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNRGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNRGS",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):2,$D(^XUSEC("PSJ PHARM TECH",DUZ)):2,1:0)
"RTN","PSDNRGS",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to complete",!,?12,"narcotic orders.",!!,"PSJ RNURSE, PSD NURSE, PSJ RPHARM, or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDNRGS",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH Q
"RTN","PSDNRGS",7,0)
 W !!,"Receive Controlled Substances Orders and Green Sheet" S PSDUZ=DUZ,PSDUZN=$S($P($G(^VA(200,PSDUZ,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDNRGS",8,0)
 N X,X1 D SIG^XUSESIG Q:X1=""
"RTN","PSDNRGS",9,0)
ASKN ;ask naou
"RTN","PSDNRGS",10,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: "
"RTN","PSDNRGS",11,0)
 S:OK=1 DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNRGS",12,0)
 S:OK=2 DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"""
"RTN","PSDNRGS",13,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDNRGS",14,0)
GS ;select green sheet #
"RTN","PSDNRGS",15,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDNRGS",16,0)
 S DIC("S")="I $P(^(0),""^"",11),$P(^(0),""^"",11)<12"
"RTN","PSDNRGS",17,0)
 D IX^DIC K DIC G:Y<0 ASKN S PSDA=+Y
"RTN","PSDNRGS",18,0)
ORD S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDNRGS",19,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),QTY=+$P(Y(0),"^",6)
"RTN","PSDNRGS",20,0)
 I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDNRGS",21,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDNRGS",22,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNRGS",23,0)
 I STAT'=3 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDNRGS",24,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDNRGS",25,0)
REC ;receive at order level in 58.8
"RTN","PSDNRGS",26,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDNRGS",27,0)
 K DA,DIR,DIRUT S DIR(0)="58.81,27",DIR("B")=QTY D ^DIR K DIR I $D(DIRUT) W !!,"Quantity not entered.  No action taken.",!,"This order remains ",STATN,!! G END
"RTN","PSDNRGS",28,0)
 S RQTY=Y I RQTY'=QTY W $C(7),!!,"The quantity received does not match the quantity dispensed.",!,"This order must be returned to pharmacy for investigation.",!! G GS
"RTN","PSDNRGS",29,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU
"RTN","PSDNRGS",30,0)
 S DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,"
"RTN","PSDNRGS",31,0)
 S DR=$S(OK=1:"6////"_PSDUZ,1:"6RECEIVED BY NURSE")_";20////"_QTY_";15////"_RECD_";10////4;22////"_$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4)_";25////"_$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4) D ^DIE K DA,DIE,DR
"RTN","PSDNRGS",32,0)
 I ($D(Y))!($D(DTOUT)) W $C(7),!!,"*** THIS ORDER HAS NOT BEEN RECEIVED ***",!,"Receiving nurses name must be entered.",!!,"The status remains "_STATN,! G END
"RTN","PSDNRGS",33,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDNRGS",34,0)
 ;updating drug balance in 58.8
"RTN","PSDNRGS",35,0)
 F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDNRGS",36,0)
 S:'$P($G(^PSD(58.81,PSDA,9)),U) $P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)+QTY
"RTN","PSDNRGS",37,0)
 L -^PSD(58.8,NAOU,1,PSDR,0)
"RTN","PSDNRGS",38,0)
 ;update transaction file (58.81)
"RTN","PSDNRGS",39,0)
 S OREC=$P($G(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),"^",7)
"RTN","PSDNRGS",40,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81
"RTN","PSDNRGS",41,0)
 S DR="10////"_$S('$P($G(^PSD(58.8,NAOU,2)),U,5):4,$P($G(^PSD(58.81,PSDA,9)),U):4,1:13)_";20////"_OREC_";21////"_RECD_";27////"_QTY_";I OK=1 S Y=""@1"";15COMMENTS;@1"
"RTN","PSDNRGS",42,0)
 D ^DIE K DA,DIE,DR
"RTN","PSDNRGS",43,0)
 I OK=2 S $P(^PSD(58.81,PSDA,1),"^",11)=PSDUZ
"RTN","PSDNRGS",44,0)
 W !!,"Updating your records now..."
"RTN","PSDNRGS",45,0)
 ;update worksheet file (58.85) to be purged
"RTN","PSDNRGS",46,0)
 S DA=+$O(^PSD(58.85,"AD",NAOU,PSDR,ORD,0)) I DA,$D(^PSD(58.85,DA,0)) K DIE,DR S DIE=58.85,DR="6////4" D ^DIE K DA,DIE,DR
"RTN","PSDNRGS",47,0)
 W "done.",!!
"RTN","PSDNRGS",48,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?5,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDNRGS",49,0)
 G GS
"RTN","PSDNRGS",50,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDNRGS",51,0)
 K NAOU,NAOUN,OK,ORD,OREC,PSDPN,PSDR,PSDRN,PSDUZ,PSDUZN,QTY,RECD,RECDT,RQTY,STAT,STATN,SUB,PSDA,X,Y
"RTN","PSDNRGS",52,0)
 Q
"RTN","PSDNSCG")
0^495^B15651940
"RTN","PSDNSCG",1,0)
PSDNSCG ;BIR/JPW-Nurse Shift Check Log GS perpetual; 2 Aug 94
"RTN","PSDNSCG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNSCG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNSCG",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDNSCG",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to",!,?12,"print this shift check log.",!!,"PSJ RNURSE or PSD NURSE security key required.",! K OK Q
"RTN","PSDNSCG",6,0)
ASKN ;ask naou
"RTN","PSDNSCG",7,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDNSCG",8,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNSCG",9,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDNSCG",10,0)
DEV ;ask device and queue info
"RTN","PSDNSCG",11,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDNSCG",12,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNSCG",13,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDNSCL",ZTDESC="CS Nursing Shift Check Log",(ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNSCG",14,0)
 U IO
"RTN","PSDNSCG",15,0)
START ;loops thru active orders 
"RTN","PSDNSCG",16,0)
 K ^TMP("PSDNSCL",$J) D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDNSCG",17,0)
 F STAT=2.99:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:('STAT)!(STAT>4)  D LOOP
"RTN","PSDNSCG",18,0)
 S STAT=10 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDNSCG",19,0)
PRINT ;prints the report
"RTN","PSDNSCG",20,0)
 S (PG,PSDOUT)=0
"RTN","PSDNSCG",21,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDNSCL",$J)) D HDR W !!,?10,"****  NO ACTIVE ORDERS TO REPORT  ****",! G DONE
"RTN","PSDNSCG",22,0)
 D HDR
"RTN","PSDNSCG",23,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDNSCL",$J,DRUG)) Q:DRUG=""!(PSDOUT)  W !!,?2,"=>  ",DRUG,! S NUM="" F  S NUM=$O(^TMP("PSDNSCL",$J,DRUG,NUM)) Q:NUM=""!(PSDOUT)  D
"RTN","PSDNSCG",24,0)
 .I $Y+8>IOSL D HDR Q:PSDOUT  W !!,?2,"=>  ",DRUG,!
"RTN","PSDNSCG",25,0)
 .S NODE=^TMP("PSDNSCL",$J,DRUG,NUM) W !,NUM,?12,$P(NODE,"^",3),?34,$J($P(NODE,"^",2),6),?45,$P(NODE,"^",4),?55,$P($P(NODE,"^")," ")
"RTN","PSDNSCG",26,0)
 .W ! W:$P($G(^DPT(+$P($G(^PSD(58.81,+$O(^PSD(58.81,"D",NUM,0)),9)),U),0)),U)]"" $P($G(^(0)),U)
"RTN","PSDNSCG",27,0)
 .W ?50,$S($P(NODE,"^",5)="*":$P($P(NODE,"^")," ",2,99),1:$P($P(NODE,"^"),"-",2)),!
"RTN","PSDNSCG",28,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNSCG",29,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNSCG",30,0)
END K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NAOUN,NODE,NUM,OK,ORD
"RTN","PSDNSCG",31,0)
 K PG,POP,PSD,PSDOUT,PSDPN,PSDST,PSDT,PSDTR,QTY,REC,REQ,RPDT,RQTY,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNSCG",32,0)
 K ^TMP("PSDNSCL",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNSCG",33,0)
 Q
"RTN","PSDNSCG",34,0)
LOOP ;drug loop
"RTN","PSDNSCG",35,0)
 F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG)) Q:'DRUG  F ORD=0:0 S ORD=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG,ORD)) Q:'ORD  D
"RTN","PSDNSCG",36,0)
 .Q:'$D(^PSD(58.8,NAOU,1,DRUG,3,ORD,0))  S NODE=^(0),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNSCG",37,0)
 .S PSDTR=$P(NODE,"^",17) I STAT=10 Q:$D(^PSD(58.81,"AE",PSDTR))
"RTN","PSDNSCG",38,0)
 .S STATN=$P($G(^PSD(58.82,STAT,0)),"^"),RQTY=$P(NODE,"^",20),PSDPN=$S($P(NODE,"^",16)]"":$P(NODE,"^",16),1:"UNKNOWN")
"RTN","PSDNSCG",39,0)
 .Q:'$P($G(^PSD(58.81,+$O(^PSD(58.81,"D",+PSDPN,0)),"CS")),U,4)
"RTN","PSDNSCG",40,0)
 .S REQ=$P(NODE,"^",15) I REQ S Y=REQ X ^DD("DD") S REQ=Y
"RTN","PSDNSCG",41,0)
 .S REC=$P(NODE,"^",7),REC=$P($G(^VA(200,+REC,0)),"^"),REC=$E($P(REC,",",2))_$E(REC)
"RTN","PSDNSCG",42,0)
 .S ^TMP("PSDNSCL",$J,DRUGN,PSDPN)=STATN_"^"_RQTY_"^"_REQ_"^"_REC_"^"_$S(STAT=10:"*",1:"")
"RTN","PSDNSCG",43,0)
 Q
"RTN","PSDNSCG",44,0)
HDR ;header for log
"RTN","PSDNSCG",45,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNSCG",46,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"Nursing Shift Check Log for ",NAOUN,?70,"Page: ",PG,!,?20,RPDT,!
"RTN","PSDNSCG",47,0)
 W !,?2,"=> DRUG",!,?18,"DATE",?44,"RECD"
"RTN","PSDNSCG",48,0)
 W !,"DISP #",?18,"RECD",?37,"QTY",?45,"BY",?54,"ORDER STATUS"
"RTN","PSDNSCG",49,0)
 W !,LN,!
"RTN","PSDNSCG",50,0)
 Q
"RTN","PSDNSCL")
0^119^B14451928
"RTN","PSDNSCL",1,0)
PSDNSCL ;BIR/JPW-Nurse Shift Check Log ; 2 Aug 94
"RTN","PSDNSCL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNSCL",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNSCL",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDNSCL",5,0)
 ;I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print this shift check log.",! K OK Q
"RTN","PSDNSCL",6,0)
ASKN ;ask naou
"RTN","PSDNSCL",7,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDNSCL",8,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNSCL",9,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDNSCL",10,0)
DEV ;ask device and queue info
"RTN","PSDNSCL",11,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDNSCL",12,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNSCL",13,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDNSCL",ZTDESC="CS Nursing Shift Check Log",(ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNSCL",14,0)
 U IO
"RTN","PSDNSCL",15,0)
START ;loops thru active orders 
"RTN","PSDNSCL",16,0)
 K ^TMP("PSDNSCL",$J) D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDNSCL",17,0)
 F STAT=2.99:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:('STAT)!(STAT>5)  D LOOP
"RTN","PSDNSCL",18,0)
 S STAT=10 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDNSCL",19,0)
PRINT ;prints the report
"RTN","PSDNSCL",20,0)
 S (PG,PSDOUT)=0
"RTN","PSDNSCL",21,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDNSCL",$J)) D HDR W !!,?10,"****  NO ACTIVE ORDERS TO REPORT  ****",! G DONE
"RTN","PSDNSCL",22,0)
 D HDR
"RTN","PSDNSCL",23,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDNSCL",$J,DRUG)) Q:DRUG=""!(PSDOUT)  W !!,?2,"=>  ",DRUG,! S NUM="" F  S NUM=$O(^TMP("PSDNSCL",$J,DRUG,NUM)) Q:NUM=""!(PSDOUT)  D
"RTN","PSDNSCL",24,0)
 .I $Y+8>IOSL D HDR Q:PSDOUT  W !!,?2,"=>  ",DRUG,!
"RTN","PSDNSCL",25,0)
 .S NODE=^TMP("PSDNSCL",$J,DRUG,NUM) W !,NUM,?12,$P(NODE,"^",3),?34,$J($P(NODE,"^",2),6),?45,$P(NODE,"^",4),?55,$P($P(NODE,"^")," ")
"RTN","PSDNSCL",26,0)
 .W ! W:$P($G(^DPT(+$P($G(^PSD(58.81,+$O(^PSD(58.81,"D",NUM,0)),9)),U),0)),U)]"" $P($G(^(0)),U)
"RTN","PSDNSCL",27,0)
 .W ?50,$S($P(NODE,"^",5)="*":$P($P(NODE,"^")," ",2,99),1:$P($P(NODE,"^"),"-",2)),!
"RTN","PSDNSCL",28,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNSCL",29,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNSCL",30,0)
END K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NAOUN,NODE,NUM,OK,ORD
"RTN","PSDNSCL",31,0)
 K PG,POP,PSD,PSDOUT,PSDPN,PSDST,PSDT,PSDTR,QTY,REC,REQ,RPDT,RQTY,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNSCL",32,0)
 K ^TMP("PSDNSCL",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNSCL",33,0)
 Q
"RTN","PSDNSCL",34,0)
LOOP ;drug loop
"RTN","PSDNSCL",35,0)
 F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG)) Q:'DRUG  F ORD=0:0 S ORD=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG,ORD)) Q:'ORD  D
"RTN","PSDNSCL",36,0)
 .Q:'$D(^PSD(58.8,NAOU,1,DRUG,3,ORD,0))  S NODE=^(0),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNSCL",37,0)
 .S PSDTR=$P(NODE,"^",17) I STAT=10 Q:$D(^PSD(58.81,"AE",PSDTR))
"RTN","PSDNSCL",38,0)
 .S STATN=$P($G(^PSD(58.82,STAT,0)),"^"),RQTY=$P(NODE,"^",20),PSDPN=$S($P(NODE,"^",16)]"":$P(NODE,"^",16),1:"UNKNOWN")
"RTN","PSDNSCL",39,0)
 .Q:'$P($G(^PSD(58.81,+$O(^PSD(58.81,"D",+PSDPN,0)),"CS")),U,4)
"RTN","PSDNSCL",40,0)
 .S REQ=$P(NODE,"^",15) I REQ S Y=REQ X ^DD("DD") S REQ=Y
"RTN","PSDNSCL",41,0)
 .S REC=$P(NODE,"^",7),REC=$P($G(^VA(200,+REC,0)),"^"),REC=$E($P(REC,",",2))_$E(REC)
"RTN","PSDNSCL",42,0)
 .S ^TMP("PSDNSCL",$J,DRUGN,PSDPN)=STATN_"^"_RQTY_"^"_REQ_"^"_REC_"^"_$S(STAT=10:"*",1:"")
"RTN","PSDNSCL",43,0)
 Q
"RTN","PSDNSCL",44,0)
HDR ;header for log
"RTN","PSDNSCL",45,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNSCL",46,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"Nursing Shift Check Log for ",NAOUN,?70,"Page: ",PG,!,?20,RPDT,!
"RTN","PSDNSCL",47,0)
 W !,?2,"=> DRUG",!,?18,"DATE",?44,"RECD"
"RTN","PSDNSCL",48,0)
 W !,"DISP #",?18,"RECD",?37,"QTY",?45,"BY",?54,"ORDER STATUS"
"RTN","PSDNSCL",49,0)
 W !,LN,!
"RTN","PSDNSCL",50,0)
 Q
"RTN","PSDNSTK")
0^120^B22221930
"RTN","PSDNSTK",1,0)
PSDNSTK ;BIR/JPW-Inactivate Stocked Drugs ; 8 Aug 94
"RTN","PSDNSTK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNSTK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNSTK",4,0)
 W !!,?5,"You may inactivate a Stocked Drug for a single NAOU,",!,?5,"or enter ^ALL  to inactivate the Drug in ALL NAOUs.",!
"RTN","PSDNSTK",5,0)
 K DA,DIC,PSDOUT F  Q:$D(PSDOUT)  W ! S ALL=1,DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC Q:Y<0&(X'="^ALL")  D:X'="^ALL" INACT1 I ALL D ASK Q:$D(PSDOUT)
"RTN","PSDNSTK",6,0)
END K %,%DT,%H,%I,ALL,ANS1,ANS2,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,NAOU,NAOUN,PSDOUT,PSDR,PSDRN,PSDT,QUE,RDT,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDNSTK",7,0)
 K ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDMSG",$J)
"RTN","PSDNSTK",8,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNSTK",9,0)
 Q
"RTN","PSDNSTK",10,0)
INACT1 ;inactivate a drug for a single NAOU
"RTN","PSDNSTK",11,0)
 S NAOU=+Y,NAOUN=$P(Y,"^",2),ALL=0
"RTN","PSDNSTK",12,0)
 I '$D(^PSD(58.8,NAOU,1,0)) W !!,"There are no stocked drugs for this NAOU!!",!! Q
"RTN","PSDNSTK",13,0)
LOOP K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDNSTK",14,0)
 W ! S DIC="^PSD(58.8,"_NAOU_",1,",DA(1)=+NAOU,DIC(0)="QEAM" D ^DIC K DIC I $D(DTOUT)!$D(DUOUT) S PSDOUT=1 Q
"RTN","PSDNSTK",15,0)
 Q:Y<0  S PSDR=+Y K DA,DIE,DR S DA(1)=+NAOU,DIE="^PSD(58.8,"_NAOU_",1,",DA=+PSDR,DR="13;I X="""" S Y=""@1"";14;I X'=""O"" S Y=""@1"";14.5;@1" D ^DIE K DIE I $D(Y)!$D(DTOUT) S PSDOUT=1 Q
"RTN","PSDNSTK",16,0)
 S PSDRN=$P($G(^PSDRUG(+PSDR,0)),"^")
"RTN","PSDNSTK",17,0)
 I $P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),"^",14) W !!,PSDRN," is now INACTIVE.",!! G LOOP
"RTN","PSDNSTK",18,0)
 W !!,"This "_PSDRN_" is ACTIVE on "_NAOUN_".",!!
"RTN","PSDNSTK",19,0)
 G LOOP
"RTN","PSDNSTK",20,0)
ASK ;ask inactivation date and reason
"RTN","PSDNSTK",21,0)
 ;clashed with CMOP W ! K DA,DIR,DIRUT S DIR(0)="50,.01O",DIR("A")="Select DRUG",DIR("?")="Enter the DRUG you wish to inactivate in all NAOUs." D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDNSTK",22,0)
 K DA,DIC S DIC=50,DIC("S")="I $P($G(^(2)),""^"",3)[""N""",DIC(0)="AQEOM",DIC("A")="Select DRUG: " D ^DIC K DIC S:Y<0 PSDOUT=1 Q:$G(PSDOUT)  S PSDR=+Y,PSDRN=$P(Y,"^",2),(ANS1,ANS2)=""
"RTN","PSDNSTK",23,0)
 W !! K DA,DIR,DIRUT S DIR(0)="58.8001,13" D ^DIR K DIR I $D(DIRUT)!'Y S PSDOUT=1 Q
"RTN","PSDNSTK",24,0)
 S PSDT=Y K DA,DIR,DIRUT,DTOUT,DUOUT S DIR(0)="58.8001,14" D ^DIR K DIR I $D(DUOUT)!$D(DTOUT) S PSDOUT=1 Q
"RTN","PSDNSTK",25,0)
 S ANS1=Y G:ANS1'="O" QUE K DA,DIR,DIRUT,DTOUT,DUOUT S DIR(0)="58.8001,14.5" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSDOUT=1 Q
"RTN","PSDNSTK",26,0)
 S ANS2=Y
"RTN","PSDNSTK",27,0)
QUE ;asks queueing information
"RTN","PSDNSTK",28,0)
 S QUE=0 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you want to queue this job",DIR("?",1)="To queue this job to run at a later time and free up your terminal now,"
"RTN","PSDNSTK",29,0)
 S DIR("?")="accept the default, enter 'N' to run immediately or '^' to quit." D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 W $C(7),!!,"The DRUG you selected will not be inactivated.",!! Q
"RTN","PSDNSTK",30,0)
 I 'Y W !!,"Inactivating now..." G START
"RTN","PSDNSTK",31,0)
 S QUE=1 W !!,"You will be notified by MailMan when the job is completed. ",!!
"RTN","PSDNSTK",32,0)
 S ZTIO="",ZTRTN="START^PSDNSTK",ZTDESC="CS PHARM MASS DRUG INACTIVATION" S (ZTSAVE("PSDR"),ZTSAVE("PSDRN"),ZTSAVE("ANS1"),ZTSAVE("ANS2"),ZTSAVE("QUE"),ZTSAVE("PSDT"),ZTSAVE("PSDSITE"))="" D ^%ZTLOAD K ZTSK Q
"RTN","PSDNSTK",33,0)
START ;
"RTN","PSDNSTK",34,0)
 S CNT=0 F NAOU=0:0 S NAOU=$O(^PSD(58.8,NAOU)) Q:'NAOU  I $P($G(^PSD(58.8,NAOU,0)),"^",3)=+PSDSITE,$P($G(^PSD(58.8,NAOU,0)),"^",2)'="P",$D(^PSD(58.8,NAOU,1,PSDR,0)),$P(^(0),"^",14)="" D DIE S CNT=CNT+1
"RTN","PSDNSTK",35,0)
 I 'QUE W $C(7),!!,PSDRN_" has been inactivated in "_CNT_" NAOU(s).",! Q
"RTN","PSDNSTK",36,0)
MSG ;send mailman message with completed info
"RTN","PSDNSTK",37,0)
 K XMY,^TMP("PSDMSG",$J) D NOW^%DTC S Y=X X ^DD("DD") S RDT=Y S ^TMP("PSDMSG",$J,1,0)="CS PHARM DRUG Inactivation background job has run to completion."
"RTN","PSDNSTK",38,0)
 S ^TMP("PSDMSG",$J,2,0)="Run Date: "_RDT,^TMP("PSDMSG",$J,3,0)="",^TMP("PSDMSG",$J,4,0)="**  "_PSDRN_" has been inactivated as of "_RDT_" in "_CNT_" NAOU(s)."
"RTN","PSDNSTK",39,0)
 S XMSUB="CS PHARM MASS DRUG INACTIVATION SUMMARY",XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMTEXT="^TMP(""PSDMSG"",$J,",XMY(DUZ)="" S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDMSG",$J)
"RTN","PSDNSTK",40,0)
 G END
"RTN","PSDNSTK",41,0)
DIE ;inactivate a Drug for NAOUs
"RTN","PSDNSTK",42,0)
 K DA,DIE,DR S DA(1)=+NAOU,DA=+PSDR,DIE="^PSD(58.8,"_NAOU_",1,",DR="13////"_PSDT_";14////"_ANS1_";14.5////"_ANS2 D ^DIE K DIE,DR
"RTN","PSDNSTK",43,0)
 Q
"RTN","PSDNTEG")
0^121^B19457876
"RTN","PSDNTEG",1,0)
PSDNTEG ;ISC/XTSUMBLD KERNEL - Package checksum checker ;2970224.092204
"RTN","PSDNTEG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTEG",3,0)
 ;;7.3;2970224.092204
"RTN","PSDNTEG",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","PSDNTEG",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","PSDNTEG",6,0)
 G CONT^PSDNTEG0
"RTN","PSDNTEG",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","PSDNTEG",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","PSDNTEG",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","PSDNTEG",10,0)
 W ! G CONT
"RTN","PSDNTEG",11,0)
ROU ;;
"RTN","PSDNTEG",12,0)
PSDACT ;;9975594
"RTN","PSDNTEG",13,0)
PSDACT1 ;;11604254
"RTN","PSDNTEG",14,0)
PSDACT2 ;;6805666
"RTN","PSDNTEG",15,0)
PSDADJ ;;13992080
"RTN","PSDNTEG",16,0)
PSDADJB ;;3411172
"RTN","PSDNTEG",17,0)
PSDADJC ;;12709010
"RTN","PSDNTEG",18,0)
PSDADJD ;;13684417
"RTN","PSDNTEG",19,0)
PSDADJI ;;9664608
"RTN","PSDNTEG",20,0)
PSDADJIN ;;10882845
"RTN","PSDNTEG",21,0)
PSDADJN ;;12308094
"RTN","PSDNTEG",22,0)
PSDADJN1 ;;9209503
"RTN","PSDNTEG",23,0)
PSDADJR ;;9137032
"RTN","PSDNTEG",24,0)
PSDADJW ;;3140510
"RTN","PSDNTEG",25,0)
PSDADT ;;1852503
"RTN","PSDNTEG",26,0)
PSDADT1 ;;2880338
"RTN","PSDNTEG",27,0)
PSDAMIS ;;12951751
"RTN","PSDNTEG",28,0)
PSDAMIS0 ;;12093150
"RTN","PSDNTEG",29,0)
PSDAMIS1 ;;10954000
"RTN","PSDNTEG",30,0)
PSDAMIS2 ;;8653026
"RTN","PSDNTEG",31,0)
PSDAMIS3 ;;11517002
"RTN","PSDNTEG",32,0)
PSDAMIS4 ;;6905875
"RTN","PSDNTEG",33,0)
PSDAPU ;;453681
"RTN","PSDNTEG",34,0)
PSDBAL ;;11324223
"RTN","PSDNTEG",35,0)
PSDBALI ;;13145477
"RTN","PSDNTEG",36,0)
PSDBALI1 ;;4034805
"RTN","PSDNTEG",37,0)
PSDBAN ;;11322182
"RTN","PSDNTEG",38,0)
PSDBAN1 ;;6447121
"RTN","PSDNTEG",39,0)
PSDCODE ;;1276619
"RTN","PSDNTEG",40,0)
PSDCOR ;;12698386
"RTN","PSDNTEG",41,0)
PSDCOR1 ;;13395954
"RTN","PSDNTEG",42,0)
PSDCOR2 ;;13487461
"RTN","PSDNTEG",43,0)
PSDCOR3 ;;1989323
"RTN","PSDNTEG",44,0)
PSDCORP ;;10704766
"RTN","PSDNTEG",45,0)
PSDCORP1 ;;8074809
"RTN","PSDNTEG",46,0)
PSDCORP2 ;;8214810
"RTN","PSDNTEG",47,0)
PSDCORP3 ;;9384457
"RTN","PSDNTEG",48,0)
PSDCOSD ;;11666341
"RTN","PSDNTEG",49,0)
PSDCOSH ;;8058420
"RTN","PSDNTEG",50,0)
PSDCOSM ;;1588896
"RTN","PSDNTEG",51,0)
PSDCOSN ;;11610030
"RTN","PSDNTEG",52,0)
PSDCOST ;;17808268
"RTN","PSDNTEG",53,0)
PSDCOSV ;;8309730
"RTN","PSDNTEG",54,0)
PSDCPO ;;15492261
"RTN","PSDNTEG",55,0)
PSDCRP ;;15861595
"RTN","PSDNTEG",56,0)
PSDCSI ;;8739313
"RTN","PSDNTEG",57,0)
PSDCSL ;;9907995
"RTN","PSDNTEG",58,0)
PSDDFP ;;13632184
"RTN","PSDNTEG",59,0)
PSDDFP1 ;;4717046
"RTN","PSDNTEG",60,0)
PSDDWK ;;14582819
"RTN","PSDNTEG",61,0)
PSDDWK1 ;;8730816
"RTN","PSDNTEG",62,0)
PSDDWK2 ;;7776016
"RTN","PSDNTEG",63,0)
PSDDWK3 ;;7689842
"RTN","PSDNTEG",64,0)
PSDDWK4 ;;5365045
"RTN","PSDNTEG",65,0)
PSDDWKE ;;10267106
"RTN","PSDNTEG",66,0)
PSDEA ;;7236323
"RTN","PSDNTEG",67,0)
PSDEA41 ;;13153026
"RTN","PSDNTEG",68,0)
PSDEM ;;11848547
"RTN","PSDNTEG",69,0)
PSDEM1 ;;12993745
"RTN","PSDNTEG",70,0)
PSDEM2 ;;11157976
"RTN","PSDNTEG",71,0)
PSDEM3 ;;2984202
"RTN","PSDNTEG",72,0)
PSDEM4 ;;7256790
"RTN","PSDNTEG",73,0)
PSDEN ;;9553918
"RTN","PSDNTEG",74,0)
PSDERCP ;;15389660
"RTN","PSDNTEG",75,0)
PSDERD ;;7069296
"RTN","PSDNTEG",76,0)
PSDERP ;;15124151
"RTN","PSDNTEG",77,0)
PSDEST ;;14170737
"RTN","PSDNTEG",78,0)
PSDESTF ;;11545390
"RTN","PSDNTEG",79,0)
PSDESTO ;;12940785
"RTN","PSDNTEG",80,0)
PSDESTP ;;24798965
"RTN","PSDNTEG",81,0)
PSDEVO ;;13442414
"RTN","PSDNTEG",82,0)
PSDEVO1 ;;11404589
"RTN","PSDNTEG",83,0)
PSDEVOR ;;15314902
"RTN","PSDNTEG",84,0)
PSDEXGS ;;12646994
"RTN","PSDNTEG",85,0)
PSDEXGS1 ;;6305959
"RTN","PSDNTEG",86,0)
PSDEXP ;;15048479
"RTN","PSDNTEG",87,0)
PSDEXP1 ;;5042879
"RTN","PSDNTEG",88,0)
PSDFIL2 ;;14725710
"RTN","PSDNTEG",89,0)
PSDFIL3 ;;14685555
"RTN","PSDNTEG",90,0)
PSDFILM ;;2926376
"RTN","PSDNTEG",91,0)
PSDFND ;;16502908
"RTN","PSDNTEG",92,0)
PSDFND1 ;;2124618
"RTN","PSDNTEG",93,0)
PSDFT ;;14866922
"RTN","PSDNTEG",94,0)
PSDFT1 ;;15918295
"RTN","PSDNTEG",95,0)
PSDGEN ;;1437730
"RTN","PSDNTEG",96,0)
PSDGPR ;;11702075
"RTN","PSDNTEG",97,0)
PSDGSH ;;3741711
"RTN","PSDNTEG",98,0)
PSDGSH1 ;;5746281
"RTN","PSDNTEG",99,0)
PSDGSH11 ;;6013794
"RTN","PSDNTEG",100,0)
PSDGSH2 ;;13901298
"RTN","PSDNTEG",101,0)
PSDGSK ;;7890554
"RTN","PSDNTEG",102,0)
PSDGSL ;;8633650
"RTN","PSDNTEG",103,0)
PSDGSL1 ;;8018119
"RTN","PSDNTEG",104,0)
PSDGSPU ;;8969282
"RTN","PSDNTEG",105,0)
PSDGSRV ;;13538823
"RTN","PSDNTEG",106,0)
PSDGSRV1 ;;16149091
"RTN","PSDNTEG",107,0)
PSDGSRV2 ;;14427491
"RTN","PSDNTEG",108,0)
PSDHELP ;;167485
"RTN","PSDNTEG",109,0)
PSDHL7 ;;6316421
"RTN","PSDNTEG",110,0)
PSDHLK ;;1069196
"RTN","PSDNTEG",111,0)
PSDHLP ;;1933023
"RTN","PSDNTEG",112,0)
PSDHLX ;;1153846
"RTN","PSDNTEG",113,0)
PSDHLY ;;924987
"RTN","PSDNTEG",114,0)
PSDHRPT ;;14954948
"RTN","PSDNTEG",115,0)
PSDINPRE ;;3161234
"RTN","PSDNTEG",116,0)
PSDIPOS1 ;;4077569
"RTN","PSDNTEG",117,0)
PSDIPOST ;;6876049
"RTN","PSDNTEG",118,0)
PSDLBL ;;14060349
"RTN","PSDNTEG",119,0)
PSDLBL0 ;;8605513
"RTN","PSDNTEG",120,0)
PSDLBL1 ;;13258327
"RTN","PSDNTEG",121,0)
PSDLBL2 ;;10638900
"RTN","PSDNTEG",122,0)
PSDLBL3 ;;10994226
"RTN","PSDNTEG",123,0)
PSDLBL4 ;;4065314
"RTN","PSDNTEG",124,0)
PSDLBL5 ;;7201861
"RTN","PSDNTEG",125,0)
PSDLBLB ;;7160018
"RTN","PSDNTEG",126,0)
PSDLBLI ;;9423541
"RTN","PSDNTEG",127,0)
PSDLBLP ;;12044908
"RTN","PSDNTEG",128,0)
PSDLBLR ;;9703853
"RTN","PSDNTEG",129,0)
PSDLBLR0 ;;6059606
"RTN","PSDNTEG",130,0)
PSDLBLR1 ;;2638419
"RTN","PSDNTEG",131,0)
PSDLBLR2 ;;4532916
"RTN","PSDNTEG",132,0)
PSDLSTK ;;8066682
"RTN","PSDNTEG",133,0)
PSDLSTK1 ;;9733870
"RTN","PSDNTEG",134,0)
PSDLSTK2 ;;8185271
"RTN","PSDNTEG",135,0)
PSDMAPU ;;7479575
"RTN","PSDNTEG",136,0)
PSDMFG ;;3721775
"RTN","PSDNTEG",137,0)
PSDNACT ;;6740699
"RTN","PSDNTEG",138,0)
PSDNARC ;;3678699
"RTN","PSDNTEG",139,0)
PSDNBT ;;11058243
"RTN","PSDNTEG",140,0)
PSDNCGS ;;10321965
"RTN","PSDNTEG",141,0)
PSDNDES ;;13786726
"RTN","PSDNTEG",142,0)
PSDNRGO ;;12162069
"RTN","PSDNTEG",143,0)
PSDNRGS ;;15623486
"RTN","PSDNTEG",144,0)
PSDNSCG ;;10659453
"RTN","PSDNTEG",145,0)
PSDNSCL ;;9525064
"RTN","PSDNTEG",146,0)
PSDNSTK ;;16898603
"RTN","PSDNTEG",147,0)
PSDNTF ;;19598600
"RTN","PSDNTEG",148,0)
PSDNTR ;;14807386
"RTN","PSDNTEG",149,0)
PSDNTT ;;10244486
"RTN","PSDNTEG",150,0)
PSDNTT1 ;;8835538
"RTN","PSDNTEG",151,0)
PSDNU ;;13021502
"RTN","PSDNTEG",152,0)
PSDNU1 ;;14738135
"RTN","PSDNTEG",153,0)
PSDNU2 ;;12732100
"RTN","PSDNTEG",154,0)
PSDNU3 ;;2907042
"RTN","PSDNTEG",155,0)
PSDNVT ;;1478644
"RTN","PSDNTEG",156,0)
PSDOPT ;;12920789
"RTN","PSDNTEG",157,0)
PSDOPT0 ;;9875269
"RTN","PSDNTEG",158,0)
PSDOPT1 ;;7115187
"RTN","PSDNTEG",159,0)
PSDOPT2 ;;2480174
"RTN","PSDNTEG",160,0)
PSDOPTI ;;16473032
"RTN","PSDNTEG",161,0)
PSDOPTN ;;10853518
"RTN","PSDNTEG",162,0)
PSDOPTR ;;2226366
"RTN","PSDNTEG",163,0)
PSDOPTS ;;15071130
"RTN","PSDNTEG",164,0)
PSDOPTX ;;10178752
"RTN","PSDNTEG",165,0)
PSDOPTY ;;5930170
"RTN","PSDNTEG",166,0)
PSDOPTZ ;;7145611
"RTN","PSDNTEG",167,0)
PSDOR2 ;;7280763
"RTN","PSDNTEG",168,0)
PSDOR21 ;;9843322
"RTN","PSDNTEG",169,0)
PSDORD ;;13245815
"RTN","PSDNTEG0")
0^122^B13053136
"RTN","PSDNTEG0",1,0)
PSDNTEG0 ;ISC/XTSUMBLD KERNEL - Package checksum checker ;2970224.092204
"RTN","PSDNTEG0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTEG0",3,0)
 ;;7.3;2970224.092204
"RTN","PSDNTEG0",4,0)
 S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","PSDNTEG0",5,0)
CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","PSDNTEG0",6,0)
 ;
"RTN","PSDNTEG0",7,0)
 K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","PSDNTEG0",8,0)
ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","PSDNTEG0",9,0)
 W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","PSDNTEG0",10,0)
 W ! G CONT
"RTN","PSDNTEG0",11,0)
ROU ;;
"RTN","PSDNTEG0",12,0)
PSDORD1 ;;5503924
"RTN","PSDNTEG0",13,0)
PSDORD2 ;;9845578
"RTN","PSDNTEG0",14,0)
PSDORD3 ;;10533519
"RTN","PSDNTEG0",15,0)
PSDORD4 ;;6799467
"RTN","PSDNTEG0",16,0)
PSDORL ;;8634977
"RTN","PSDNTEG0",17,0)
PSDORM ;;776198
"RTN","PSDNTEG0",18,0)
PSDORN ;;17240585
"RTN","PSDNTEG0",19,0)
PSDORN0 ;;3335766
"RTN","PSDNTEG0",20,0)
PSDORN1 ;;10110015
"RTN","PSDNTEG0",21,0)
PSDORN2 ;;9413654
"RTN","PSDNTEG0",22,0)
PSDORN3 ;;2529519
"RTN","PSDNTEG0",23,0)
PSDORNC ;;11880898
"RTN","PSDNTEG0",24,0)
PSDORNO ;;8417500
"RTN","PSDNTEG0",25,0)
PSDORNP ;;2507189
"RTN","PSDNTEG0",26,0)
PSDORNV ;;22085947
"RTN","PSDNTEG0",27,0)
PSDORP ;;13916576
"RTN","PSDNTEG0",28,0)
PSDORP1 ;;10804969
"RTN","PSDNTEG0",29,0)
PSDORP2 ;;10839369
"RTN","PSDNTEG0",30,0)
PSDORSN ;;12743249
"RTN","PSDNTEG0",31,0)
PSDORST ;;11974190
"RTN","PSDNTEG0",32,0)
PSDORSU ;;1465679
"RTN","PSDNTEG0",33,0)
PSDORV ;;12050829
"RTN","PSDNTEG0",34,0)
PSDORV1 ;;9568706
"RTN","PSDNTEG0",35,0)
PSDPAT ;;9885020
"RTN","PSDNTEG0",36,0)
PSDPAT1 ;;15574098
"RTN","PSDNTEG0",37,0)
PSDPAT2 ;;1802637
"RTN","PSDNTEG0",38,0)
PSDPATI ;;2646287
"RTN","PSDNTEG0",39,0)
PSDPDR ;;12844263
"RTN","PSDNTEG0",40,0)
PSDPDR1 ;;9409104
"RTN","PSDNTEG0",41,0)
PSDPDR2 ;;11849071
"RTN","PSDNTEG0",42,0)
PSDPDU ;;6045018
"RTN","PSDNTEG0",43,0)
PSDPDU1 ;;8201887
"RTN","PSDNTEG0",44,0)
PSDPGS ;;14596742
"RTN","PSDNTEG0",45,0)
PSDPGS1 ;;13694811
"RTN","PSDNTEG0",46,0)
PSDPLOG ;;11534343
"RTN","PSDNTEG0",47,0)
PSDPLOG1 ;;12446872
"RTN","PSDNTEG0",48,0)
PSDPLOG2 ;;12389311
"RTN","PSDNTEG0",49,0)
PSDPLOG3 ;;13851776
"RTN","PSDNTEG0",50,0)
PSDPMFG ;;13422702
"RTN","PSDNTEG0",51,0)
PSDPMFG1 ;;5591190
"RTN","PSDNTEG0",52,0)
PSDPND ;;13294730
"RTN","PSDNTEG0",53,0)
PSDPND1 ;;6924928
"RTN","PSDNTEG0",54,0)
PSDPRG ;;1970060
"RTN","PSDNTEG0",55,0)
PSDPRT ;;2408019
"RTN","PSDNTEG0",56,0)
PSDPSI ;;14873503
"RTN","PSDNTEG0",57,0)
PSDPSTK ;;8990935
"RTN","PSDNTEG0",58,0)
PSDPSTK1 ;;8092144
"RTN","PSDNTEG0",59,0)
PSDPUGS ;;16231791
"RTN","PSDNTEG0",60,0)
PSDPWK ;;15287898
"RTN","PSDNTEG0",61,0)
PSDPWK1 ;;7742039
"RTN","PSDNTEG0",62,0)
PSDPWK2 ;;7700215
"RTN","PSDNTEG0",63,0)
PSDPWK3 ;;2545818
"RTN","PSDNTEG0",64,0)
PSDRDR ;;15646391
"RTN","PSDNTEG0",65,0)
PSDRDR1 ;;8437976
"RTN","PSDNTEG0",66,0)
PSDRDR2 ;;8426549
"RTN","PSDNTEG0",67,0)
PSDREC ;;14123478
"RTN","PSDNTEG0",68,0)
PSDREC1 ;;12864977
"RTN","PSDNTEG0",69,0)
PSDREC2 ;;15231570
"RTN","PSDNTEG0",70,0)
PSDREC3 ;;15332761
"RTN","PSDNTEG0",71,0)
PSDREC4 ;;18621378
"RTN","PSDNTEG0",72,0)
PSDREPD ;;13641941
"RTN","PSDNTEG0",73,0)
PSDREPV ;;7760550
"RTN","PSDNTEG0",74,0)
PSDREV ;;7566494
"RTN","PSDNTEG0",75,0)
PSDREVC ;;11004109
"RTN","PSDNTEG0",76,0)
PSDREVD ;;11761089
"RTN","PSDNTEG0",77,0)
PSDRF ;;10486656
"RTN","PSDNTEG0",78,0)
PSDRF1 ;;4186133
"RTN","PSDNTEG0",79,0)
PSDRF2 ;;1861988
"RTN","PSDNTEG0",80,0)
PSDRF4 ;;9624765
"RTN","PSDNTEG0",81,0)
PSDRF5 ;;3739493
"RTN","PSDNTEG0",82,0)
PSDRFD ;;5100369
"RTN","PSDNTEG0",83,0)
PSDRFL ;;4102731
"RTN","PSDNTEG0",84,0)
PSDRFM ;;3789859
"RTN","PSDNTEG0",85,0)
PSDRFR ;;11253895
"RTN","PSDNTEG0",86,0)
PSDRFS ;;10472321
"RTN","PSDNTEG0",87,0)
PSDRFT ;;5774305
"RTN","PSDNTEG0",88,0)
PSDRFU ;;4537478
"RTN","PSDNTEG0",89,0)
PSDRFV ;;2769747
"RTN","PSDNTEG0",90,0)
PSDRFW ;;11631143
"RTN","PSDNTEG0",91,0)
PSDRFX ;;4489710
"RTN","PSDNTEG0",92,0)
PSDRFZ ;;2541571
"RTN","PSDNTEG0",93,0)
PSDRLOG ;;11699910
"RTN","PSDNTEG0",94,0)
PSDRLOG1 ;;11924210
"RTN","PSDNTEG0",95,0)
PSDRLOG2 ;;11940626
"RTN","PSDNTEG0",96,0)
PSDRLOG3 ;;14064513
"RTN","PSDNTEG0",97,0)
PSDRPGS ;;9527571
"RTN","PSDNTEG0",98,0)
PSDRPGS1 ;;6879636
"RTN","PSDNTEG0",99,0)
PSDRPGS2 ;;10242187
"RTN","PSDNTEG0",100,0)
PSDRPGS3 ;;783899
"RTN","PSDNTEG0",101,0)
PSDRPT ;;14469073
"RTN","PSDNTEG0",102,0)
PSDRSI ;;8838714
"RTN","PSDNTEG0",103,0)
PSDRWK ;;13538312
"RTN","PSDNTEG0",104,0)
PSDSET ;;5861527
"RTN","PSDNTEG0",105,0)
PSDSITE ;;5487380
"RTN","PSDNTEG0",106,0)
PSDSP ;;1202028
"RTN","PSDNTEG0",107,0)
PSDSTK ;;13320484
"RTN","PSDNTEG0",108,0)
PSDTER ;;15930469
"RTN","PSDNTEG0",109,0)
PSDTER1 ;;2193405
"RTN","PSDNTEG0",110,0)
PSDTER2 ;;12051923
"RTN","PSDNTEG0",111,0)
PSDTRA ;;14206901
"RTN","PSDNTEG0",112,0)
PSDTRA1 ;;5410830
"RTN","PSDNTEG0",113,0)
PSDTRAK ;;6276923
"RTN","PSDNTEG0",114,0)
PSDTRN ;;15129881
"RTN","PSDNTEG0",115,0)
PSDTRN1 ;;4640239
"RTN","PSDNTEG0",116,0)
PSDTRV ;;11437123
"RTN","PSDNTEG0",117,0)
PSDTRV1 ;;8648163
"RTN","PSDNTEG0",118,0)
PSDTRVR ;;10130105
"RTN","PSDNTEG0",119,0)
PSDTRVR1 ;;8134031
"RTN","PSDNTEG0",120,0)
PSDUP2 ;;7299120
"RTN","PSDNTEG0",121,0)
PSDUP3 ;;5837741
"RTN","PSDNTEG0",122,0)
PSDUSER ;;5959242
"RTN","PSDNTEG0",123,0)
PSDUTL ;;7108281
"RTN","PSDNTEG0",124,0)
PSDUTL1 ;;7232289
"RTN","PSDNTEG0",125,0)
PSDUTL2 ;;2220870
"RTN","PSDNTEG0",126,0)
PSDUTL3 ;;5520873
"RTN","PSDNTEG0",127,0)
PSDUTL4 ;;1808777
"RTN","PSDNTEG0",128,0)
PSDUTL5 ;;3705845
"RTN","PSDNTEG0",129,0)
PSDWADD ;;17564518
"RTN","PSDNTEG0",130,0)
PSDWCHG ;;18928513
"RTN","PSDNTEG0",131,0)
PSDWL ;;2402560
"RTN","PSDNTF")
0^123^B31086621
"RTN","PSDNTF",1,0)
PSDNTF ;BIR/JPW-Transfer Green Sheet - From this NAOU ; 30 Aug 94
"RTN","PSDNTF",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTF",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNTF",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):1,1:0)
"RTN","PSDNTF",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to",!,?12,"transfer narcotic orders.",!!,"PSJ RNURSE, PSD NURSE, or PSJ RPHARM security key required.",! K OK Q
"RTN","PSDNTF",6,0)
 W !!,"Transfer a Green Sheet from this NAOU" S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDNTF",7,0)
ASKN ;ask transfer from naou
"RTN","PSDNTF",8,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select Transfer from NAOU: "
"RTN","PSDNTF",9,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNTF",10,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDNTF",11,0)
GS ;select green sheet #
"RTN","PSDNTF",12,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDNTF",13,0)
 S DIC("S")="I $P(^(0),""^"",11)=4!($P(^(0),U,11)=13),$P(^(0),""^"",18)=AOU",DIC("W")="W "" "",$P($G(^PSDRUG($P(^(0),U,5),0)),U),"" => "",$P($G(^DPT(+$P($G(^PSD(58.81,Y,9)),U),0)),U)"
"RTN","PSDNTF",14,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDNTF",15,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDNTF",16,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDNTF",17,0)
 S MFG=$P(Y(0),"^",13),LOT=$P(Y(0),"^",14),EXP=$P(Y(0),"^",15),QTY=+$P(Y(0),"^",6),PSDS=+$P(Y(0),"^",3)
"RTN","PSDNTF",18,0)
 S NBKU=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),"^",8)
"RTN","PSDNTF",19,0)
 I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=+$P(^(4),"^",3)
"RTN","PSDNTF",20,0)
 I AOU'=NAOU W !!,"The Green Sheet # ",PSDPN," does not reside on ",AOUN,".",!,"Please select another Green Sheet.",! G ASKN
"RTN","PSDNTF",21,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNTF",22,0)
 I STAT'=4,STAT'=13 W !!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNTF",23,0)
ASKT ;ask transfer to naou
"RTN","PSDNTF",24,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select Transfer To NAOU: "
"RTN","PSDNTF",25,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNTF",26,0)
 D ^DIC K DIC G:Y<0 END S NAOUT=+Y,NAOUTN=$P(Y,"^",2)
"RTN","PSDNTF",27,0)
 I NAOUT=AOU W !!,"You may not transfer a Green Sheet to your NAOU!",!,"Please select another NAOU.",!! G ASKT
"RTN","PSDNTF",28,0)
 I QTY=1 S RQTY=1 W !,"Quantity to Transfer (",NBKU,"/1)",! G OK
"RTN","PSDNTF",29,0)
QTY ;
"RTN","PSDNTF",30,0)
 W !,"Quantity to Transfer ("_NBKU_"/"_QTY_"): " R X:DTIME I '$T!(X="^")!(X="") S PSDOUT=1 W !!,"**** No action taken. ****",!! G END
"RTN","PSDNTF",31,0)
 I X'?1.6N!(X=0) W !!,"Enter a whole number between 1 and ",QTY,! G QTY
"RTN","PSDNTF",32,0)
 I X>QTY W $C(7),!!,"The quantity returned must not exceed "_QTY_"!",! G QTY
"RTN","PSDNTF",33,0)
 S RQTY=X
"RTN","PSDNTF",34,0)
OK ;if perpetual NAOU and not ordered for patient
"RTN","PSDNTF",35,0)
 D:QTY=1&('$P($G(^PSD(58.81,PSDA,9)),U))  G:$G(PSDOUT) END
"RTN","PSDNTF",36,0)
 .W !,PSDRN," Current Balance:  ",$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4)," ",NBKU,!
"RTN","PSDNTF",37,0)
 .S DIR(0)="Y",DIR("A")="Is this a PCA syringe that has already been signed out for a patient",DIR("B")="Y",DIR("?")="If you answer no, your balance will be subtracted by one" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDNTF",38,0)
 .Q:Y'=1
"RTN","PSDNTF",39,0)
 .S RQTY(1)=1
"RTN","PSDNTF",40,0)
 .S DIC="^DPT(",DIC(0)="AEMQ",DIC("A")="Scan/Enter Patient: "
"RTN","PSDNTF",41,0)
 .W ! D ^DIC K DIC I Y<1 S PSDOUT=1 W !!,"No action taken.",!! Q
"RTN","PSDNTF",42,0)
 .S PAT=+Y
"RTN","PSDNTF",43,0)
 ;ask ok to transfer
"RTN","PSDNTF",44,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDNTF",45,0)
 S DIR("?",1)="Answer 'YES' to transfer this Green Sheet to another NAOU or",DIR("?")="answer 'NO' to leave the Green Sheet status active on your NAOU."
"RTN","PSDNTF",46,0)
 D ^DIR K DIR G:$D(DIRUT) END G:'Y GS
"RTN","PSDNTF",47,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDNTF",48,0)
COM ;complete at order level in 58.8
"RTN","PSDNTF",49,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDNTF",50,0)
 S BQTY=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),"^",22):$P(^(0),"^",22)-RQTY,1:QTY-RQTY)
"RTN","PSDNTF",51,0)
 W !!,"Updating your records now..."
"RTN","PSDNTF",52,0)
 ;update transaction file (58.81)
"RTN","PSDNTF",53,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="64////"_RECD_";65////"_PSDUZ_";66////"_NAOUT_";70////"_RQTY_";10////10;73////"_$G(PAT) D ^DIE K DA,DIE,DR
"RTN","PSDNTF",54,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN TRANSFERRED **",!!,"The status remains "_STATN,! G END
"RTN","PSDNTF",55,0)
 ;update order
"RTN","PSDNTF",56,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////10;22////"_BQTY D ^DIE K DA,DIE,DR
"RTN","PSDNTF",57,0)
 ;update naou bal
"RTN","PSDNTF",58,0)
 F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDNTF",59,0)
 S:'$P($G(^PSD(58.81,PSDA,9)),U)&('$G(RQTY(1))) $P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4)-RQTY
"RTN","PSDNTF",60,0)
 W:$P($G(^PSD(58.8,NAOU,2)),U,5) !,PSDRN," Remaining Balance:  ",$P($G(^PSD(58.8,NAOU,1,PSDR,0)),U,4)," ",NBKU,!
"RTN","PSDNTF",61,0)
 L -^PSD(58.8,NAOU,PSDR,0)
"RTN","PSDNTF",62,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11)
"RTN","PSDNTF",63,0)
 W ?2,!,"*** The status of your Green Sheet #"_PSDPN_" is now",!,$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDNTF",64,0)
PRINT ;print 2321
"RTN","PSDNTF",65,0)
 W !!,"Number of copies of VA FORM 10-2321? " R NUM:DTIME I '$T!(NUM="^")!(NUM="") W !!,"No copies printed!!",!! Q
"RTN","PSDNTF",66,0)
 I NUM'?1N!(NUM=0)  W !!,"Enter a whole number between 1 and 9",! G PRINT
"RTN","PSDNTF",67,0)
 S (PG,PSDOUT)=0,REAS="",COMP=999,RECDT=$E(RECD,4,5)_"/"_$E(RECD,6,7)_"/"_$E(RECD,2,3) S:EXP EXP=$E(EXP,4,5)_"/"_$E(EXP,2,3) D ^PSDGSRV2
"RTN","PSDNTF",68,0)
END K %,%DT,%H,%I,AOU,AOUN,BQTY,COMP,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,LOT,MFG
"RTN","PSDNTF",69,0)
 K NAOU,NAOUN,NAOUT,NAOUTN,NBKU,NUM,OK,ORD,PG,PSDA,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDUZ,PSDUZN,QTY,REAS,RECD,RECDT,RQTY,STAT,STATN,X,Y
"RTN","PSDNTF",70,0)
 Q
"RTN","PSDNTR")
0^124^B22251404
"RTN","PSDNTR",1,0)
PSDNTR ;BIR/JPW-CS Transfer Between NAOUs Report ; 2 Aug 94
"RTN","PSDNTR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNTR",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS reports.  PSJ RPHARM security key required.",! Q
"RTN","PSDNTR",5,0)
 W !!,"CS Transfer Green Sheets Between NAOUs Report",!!
"RTN","PSDNTR",6,0)
DATE ;ask date range
"RTN","PSDNTR",7,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNTR",8,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNTR",9,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDNTR",10,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDNTR",11,0)
ASKN ;ask NAOU(s)
"RTN","PSDNTR",12,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!
"RTN","PSDNTR",13,0)
 D NOW^%DTC S PSDT=X K DA,DIC
"RTN","PSDNTR",14,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDNTR",15,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDNTR",16,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDNTR",17,0)
DEV ;dev & queue info
"RTN","PSDNTR",18,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDNTR",19,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNTR",20,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDNTR",ZTDESC="CS Transfer Between NAOUs Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNTR",21,0)
 U IO
"RTN","PSDNTR",22,0)
START ;compile data
"RTN","PSDNTR",23,0)
 K ^TMP("PSDNTR",$J) S PSDOUT=0
"RTN","PSDNTR",24,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ATRN",PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ATRN",PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)),$D(^(7)) D SET
"RTN","PSDNTR",25,0)
PRINT ;print transfer between naous by date
"RTN","PSDNTR",26,0)
 S (PG,PSDOUT)=0
"RTN","PSDNTR",27,0)
 K LN S $P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDNTR",28,0)
 I '$D(^TMP("PSDNTR",$J)) D HDR W !!,?45,"****  NO TRANSFER BETWEEN NAOUs DATA FOR THIS REPORT  ****" G DONE
"RTN","PSDNTR",29,0)
 D HDR
"RTN","PSDNTR",30,0)
 S PSD="" F  S PSD=$O(^TMP("PSDNTR",$J,PSD)) Q:PSD=""!(PSDOUT)  W !!,?5,"=> ",PSD,! S NUM="" F  S NUM=$O(^TMP("PSDNTR",$J,PSD,NUM)) Q:NUM=""!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^TMP("PSDNTR",$J,PSD,NUM,PSDA)) Q:'PSDA!(PSDOUT)  D
"RTN","PSDNTR",31,0)
 .D:$Y+5>IOSL HDR Q:PSDOUT
"RTN","PSDNTR",32,0)
 .S NODE=^TMP("PSDNTR",$J,PSD,NUM,PSDA) W !,NUM,?12,$P(NODE,"^"),?38,$E($P(NODE,"^",4),1,30),?60,$J($P(NODE,"^",3),6),?80,$P(NODE,"^",2),?100,$E($P(NODE,"^",5),1,30)
"RTN","PSDNTR",33,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNTR",34,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNTR",35,0)
END ;
"RTN","PSDNTR",36,0)
 K %,%DT,%H,%I,%ZIS,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,LN,NAOU,NAOUN,NAOUT,NAOUTN,NODE,NODE7,NUM,OK
"RTN","PSDNTR",37,0)
 K PG,POP,PSD,PSDA,PSDATE,PSDDT,PSDED,PSDOUT,PSDPN,PSDSD,PSDT,QTY,RPDT,TRFD,TRTD,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNTR",38,0)
 K ^TMP("PSDNTR",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNTR",39,0)
 Q
"RTN","PSDNTR",40,0)
HDR ;header for log
"RTN","PSDNTR",41,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNTR",42,0)
 S PG=PG+1 W:$Y @IOF W !,?35,"CS TRANSFER GREEN SHEETS BETWEEN NAOUs REPORT",?120,"Page: ",PG
"RTN","PSDNTR",43,0)
 W !,?35,"FOR PERIOD ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)
"RTN","PSDNTR",44,0)
 W !,?40,"PRINTED ",RPDT,!!,?5,"=> DRUG",!
"RTN","PSDNTR",45,0)
 W ?16,"DATE",?36,"NAOU",?86,"DATE",?104,"NAOU",!
"RTN","PSDNTR",46,0)
 W "DISP #",?11,"TRANSFERRED FROM",?32,"TRANSFERRED FROM",?62,"QUANTITY",?82,"TRANSFERRED IN",?100,"TRANSFERRED IN",!,LN,!
"RTN","PSDNTR",47,0)
 Q
"RTN","PSDNTR",48,0)
SAVE S (ZTSAVE("PSDSITE"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"))=""
"RTN","PSDNTR",49,0)
 S:$D(NAOU) ZTSAVE("NAOU(")=""
"RTN","PSDNTR",50,0)
 Q
"RTN","PSDNTR",51,0)
SET ;set data for printing
"RTN","PSDNTR",52,0)
 S NODE=^PSD(58.81,PSDA,0),DRUG=+$P(NODE,"^",5),NAOU=+$P(NODE,"^",18) Q:'$D(NAOU(NAOU))
"RTN","PSDNTR",53,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDNTR",54,0)
 S DRUGN=$S($D(^PSDRUG(DRUG,0)):$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNTR",55,0)
 S NAOUN=$S($D(^PSD(58.8,NAOU,0)):$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDNTR",56,0)
 S NODE7=^PSD(58.81,PSDA,7),TRFD=+$P(NODE7,"^"),TRTD=+$P(NODE7,"^",4)
"RTN","PSDNTR",57,0)
 Q:'TRTD!('TRFD)  S Y=TRFD X ^DD("DD") S TRFD=Y
"RTN","PSDNTR",58,0)
 S Y=TRTD X ^DD("DD") S TRTD=Y
"RTN","PSDNTR",59,0)
 S NAOUT=+$P(NODE7,"^",3),NAOUTN=$S($D(^PSD(58.8,NAOUT,0)):$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDNTR",60,0)
 S QTY=+$P(NODE7,"^",7)
"RTN","PSDNTR",61,0)
 S ^TMP("PSDNTR",$J,DRUGN,PSDPN,PSDA)=TRFD_"^"_TRTD_"^"_QTY_"^"_NAOUN_"^"_NAOUTN
"RTN","PSDNTR",62,0)
 Q
"RTN","PSDNTT")
0^125^B14284752
"RTN","PSDNTT",1,0)
PSDNTT ;BIR/JPW-Transfer Green Sheet - Receive this NAOU ; 22 Jun 93
"RTN","PSDNTT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNTT",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDNTT",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to transfer",!,?12,"narcotic orders.",!!,"PSJ RNURSE or PSD NURSE security key required.",! K OK Q
"RTN","PSDNTT",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH Q
"RTN","PSDNTT",7,0)
 W !!,"Receive a transferred Green Sheet into this NAOU" S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDNTT",8,0)
ASKN ;ask transfer to naou
"RTN","PSDNTT",9,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select Receive Transfer In NAOU: "
"RTN","PSDNTT",10,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNTT",11,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDNTT",12,0)
GS ;select green sheet #
"RTN","PSDNTT",13,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDNTT",14,0)
 S DIC("S")="I $P(^(0),""^"",11)=10,'$P($G(^(7)),""^"",4),($P($G(^(7)),""^"",3)=AOU)!($P(^(0),""^"",18)=AOU)"
"RTN","PSDNTT",15,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDNTT",16,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDNTT",17,0)
 S ORD=+$P(Y(0),"^",20),PSDRG=+$P(Y(0),"^",5),PSDRGN=$P($G(^PSDRUG(PSDRG,0)),"^")
"RTN","PSDNTT",18,0)
 S NAOUF=+$P(Y(0),"^",18),NAOUFN=$P($G(^PSD(58.8,+NAOUF,0)),"^")
"RTN","PSDNTT",19,0)
 S PSDSP=$P($G(^PSD(58.8,NAOUF,1,PSDRG,3,ORD,0)),"^",14)
"RTN","PSDNTT",20,0)
 S MFG=$P(Y(0),"^",13),LOT=$P(Y(0),"^",14),EXP=$P(Y(0),"^",15),PSDS=+$P(Y(0),"^",3)
"RTN","PSDNTT",21,0)
 S QTY=+$P(Y(0),"^",6) I $D(^PSD(58.81,+PSDA,4)),+$P(^(4),"^",3) S QTY=+$P(^(4),"^",3)
"RTN","PSDNTT",22,0)
 S RQTY=+$P($G(^PSD(58.81,PSDA,7)),"^",7)
"RTN","PSDNTT",23,0)
 S NAOU=+$P($G(^PSD(58.81,PSDA,7)),"^",3),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^")
"RTN","PSDNTT",24,0)
 S PAT=+$P($G(^PSD(58.81,PSDA,9)),U)
"RTN","PSDNTT",25,0)
 I STAT'=10 W !!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDNTT",26,0)
 D CHK G:PSDOUT END N X,X1 D SIG^XUSESIG G:X1="" END
"RTN","PSDNTT",27,0)
 D ^PSDNTT1
"RTN","PSDNTT",28,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DIK,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DR,DTOUT,DUOUT,EXP,FLAG,JJ,LOT,MFG
"RTN","PSDNTT",29,0)
 K NAOU,NAOUF,NAOUFN,NAOUN,NAOUT,NAOUTN,OK,ORD,PAT,PSDA,PSDOUT,PSDPN,PSDREC,PSDRG,PSDRGN,PSDRN,PSDS,PSDSP,PSDT,PSDUZ,PSDUZN,QTY,RECD,RECDT,RQTY,STAT,STATN,X,Y
"RTN","PSDNTT",30,0)
 K XMDUZ,XMSUB,XMTEXT,XMY,^TMP("PSDNTMSG",$J)
"RTN","PSDNTT",31,0)
 Q
"RTN","PSDNTT",32,0)
CHK ;check transfer to naou
"RTN","PSDNTT",33,0)
 S PSDOUT=0 W !!,?5,"The Green Sheet # ",PSDPN," and quantity of ",RQTY
"RTN","PSDNTT",34,0)
 I AOU'=NAOU W " was being transferred",!,?10,"*** from ",NAOUFN,!,?10,"*** to ",NAOUN,".",!!,$C(7),?5,"You are transferring it from ",NAOUFN,!,?10,"*** to ",AOUN,"."
"RTN","PSDNTT",35,0)
 I AOU=NAOU W " is being transferred ",!,?10,"*** from ",NAOUFN,!,?10,"*** to ",NAOUN,"."
"RTN","PSDNTT",36,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you wish to complete this transfer",DIR("B")="NO"
"RTN","PSDNTT",37,0)
 S DIR("?",1)="Answer 'YES' to complete this Green Sheet transfer,",DIR("?")="answer 'NO' or '^' to quit without completing the transfer."
"RTN","PSDNTT",38,0)
 D ^DIR K DIR I 'Y!($D(DIRUT)) S PSDOUT=1 W !!,"Receive Green Sheet # ",PSDPN," transfer into another NAOU not completed.",!! Q
"RTN","PSDNTT",39,0)
 Q
"RTN","PSDNTT1")
0^126^B14095691
"RTN","PSDNTT1",1,0)
PSDNTT1 ;BIR/JPW-Transfer Green Sheet - Receive this NAOU ; 27 Aug 93
"RTN","PSDNTT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNTT1",3,0)
COM ;complete order and transaction
"RTN","PSDNTT1",4,0)
 S FLAG=0 D NOW^%DTC S PSDT=X,(RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDNTT1",5,0)
 W !!,"Accessing ",PSDRGN," information...",!!
"RTN","PSDNTT1",6,0)
 I '$D(^PSD(58.8,+AOU,1,+PSDRG,0)) D DRUG
"RTN","PSDNTT1",7,0)
 W !!,"Updating your records now..."
"RTN","PSDNTT1",8,0)
DIE ;create the order request in 58.8
"RTN","PSDNTT1",9,0)
 S:'$D(^PSD(58.8,AOU,1,PSDRG,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDNTT1",10,0)
 S PSDRN=$P(^PSD(58.8,AOU,1,PSDRG,3,0),"^",3)+1 I $D(^PSD(58.8,AOU,1,PSDRG,3,PSDRN)) S $P(^PSD(58.8,AOU,1,PSDRG,3,0),"^",3)=$P(^PSD(58.8,AOU,1,PSDRG,3,0),"^",3)+1 G DIE
"RTN","PSDNTT1",11,0)
 W "order..."
"RTN","PSDNTT1",12,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_AOU_",1,"_PSDRG_",3,",DA(2)=AOU,DA(1)=PSDRG,(X,DINUM)=PSDRN D FILE^DICN K DIC
"RTN","PSDNTT1",13,0)
 S DA=PSDRN,DA(1)=PSDRG,DA(2)=AOU
"RTN","PSDNTT1",14,0)
 S DR="16////"_PSDPN_";14////"_PSDSP_";15////"_RECD_";2////"_+PSDS_";6////"_PSDUZ_";7////"_MFG_";8////"_LOT_";9////"_EXP_";10////4;19////"_QTY_";20////"_RQTY_";22////"_RQTY
"RTN","PSDNTT1",15,0)
 D ^DIE K DIE,DR
"RTN","PSDNTT1",16,0)
 W "transaction..."
"RTN","PSDNTT1",17,0)
ADD ;find entry number in 58.81
"RTN","PSDNTT1",18,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDNTT1",19,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDNTT1",20,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDNTT1",21,0)
 L -^PSD(58.81,0)
"RTN","PSDNTT1",22,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDNTT1",23,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^5^"_PSDS_"^"_RECD_"^"_PSDRG_"^"_RQTY_"^^^^^4^^"_MFG_"^"_LOT_"^"_EXP_"^^"_PSDPN_"^"_AOU_"^^"_PSDRN
"RTN","PSDNTT1",24,0)
 S ^PSD(58.81,PSDREC,1)="^^"_PSDUZ_"^"_RECD_"^^^^"_RQTY
"RTN","PSDNTT1",25,0)
 S ^PSD(58.81,PSDREC,7)="^^^^^"_PSDA,^PSD(58.81,PSDREC,9)=PAT
"RTN","PSDNTT1",26,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDNTT1",27,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDNTT1",28,0)
 ;update new order and prev trans #
"RTN","PSDNTT1",29,0)
 S $P(^PSD(58.8,AOU,1,PSDRG,3,PSDRN,0),"^",17)=PSDREC
"RTN","PSDNTT1",30,0)
 S $P(^PSD(58.81,PSDA,7),"^",4)=RECD,$P(^(7),"^",5)=PSDUZ,$P(^(7),"^",3)=AOU
"RTN","PSDNTT1",31,0)
BAL ;update naou to balance
"RTN","PSDNTT1",32,0)
 F  L +^PSD(58.8,AOU,1,PSDRG,0):0 I  Q
"RTN","PSDNTT1",33,0)
 S:'$P($G(^PSD(58.81,PSDA,9)),U) $P(^PSD(58.8,AOU,1,PSDRG,0),"^",4)=$P(^PSD(58.8,AOU,1,PSDRG,0),"^",4)+RQTY
"RTN","PSDNTT1",34,0)
 L -^PSD(58.8,AOU,1,PSDRG,0)
"RTN","PSDNTT1",35,0)
COMP ;completed msg
"RTN","PSDNTT1",36,0)
 W "done.",!!
"RTN","PSDNTT1",37,0)
 S STAT=$P($G(^PSD(58.81,PSDREC,0)),"^",11)
"RTN","PSDNTT1",38,0)
 W ?2,!,"*** The status of your Green Sheet #"_PSDPN_" is now",!,?2,$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDNTT1",39,0)
 G:'FLAG END
"RTN","PSDNTT1",40,0)
MSG ;send mail message
"RTN","PSDNTT1",41,0)
 K XMY,^TMP("PSDNTMSG",$J) S ^TMP("PSDNTMSG",$J,1,0)="CS PHARM Transfer Green Sheet between NAOUs",^TMP("PSDNTMSG",$J,2,0)="Transfer In Date: "_RECDT
"RTN","PSDNTT1",42,0)
 S ^TMP("PSDNTMSG",$J,3,0)=""
"RTN","PSDNTT1",43,0)
 S ^TMP("PSDNTMSG",$J,4,0)="Drug: "_PSDRGN_"      Green Sheet #"_PSDPN
"RTN","PSDNTT1",44,0)
 S ^TMP("PSDNTMSG",$J,5,0)="Transfer to: "_AOUN
"RTN","PSDNTT1",45,0)
 S ^TMP("PSDNTMSG",$J,6,0)="",^TMP("PSDNTMSG",$J,7,0)="This drug has been inactivated."
"RTN","PSDNTT1",46,0)
 S XMSUB="CS PHARM TRANSFER GREEN SHEET INACTIVATE DRUG",XMTEXT="^TMP(""PSDNTMSG"",$J,",XMDUZ="CONTROLLED SUBSTANCES PHARMACY"
"RTN","PSDNTT1",47,0)
 F JJ=0:0 S JJ=$O(^XUSEC("PSDMGR",JJ)) Q:'JJ  S XMY(JJ)=""
"RTN","PSDNTT1",48,0)
 S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDNTMSG",$J)
"RTN","PSDNTT1",49,0)
END Q
"RTN","PSDNTT1",50,0)
DRUG ;add drug and inactivate it
"RTN","PSDNTT1",51,0)
 S:'$D(^PSD(58.8,AOU,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSDNTT1",52,0)
 K DA,DIC,DIE,DD,DO S (DIC,DIE)="^PSD(58.8,"_AOU_",1,",(X,DINUM)=+PSDRG,DA(1)=AOU,DIC(0)="L" D FILE^DICN K DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDNTT1",53,0)
 K DA,DR S DA=PSDRG,DA(1)=AOU,DR="13////"_PSDT_";14////O;14.5////TRANSFER FROM ANOTHER NAOU" D ^DIE K DA,DIE,DR
"RTN","PSDNTT1",54,0)
 S FLAG=1
"RTN","PSDNTT1",55,0)
 Q
"RTN","PSDNU")
0^127^B17960955
"RTN","PSDNU",1,0)
PSDNU ;BIR/JPW-Usage Report for NAOUs ; 18 July 94
"RTN","PSDNU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNU",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNU",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"the narcotic NAOU Usage Report.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDNU",5,0)
 W !!,"Select Date Range for NAOU Usage Report",!
"RTN","PSDNU",6,0)
DATE ;ask date range
"RTN","PSDNU",7,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNU",8,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDNU",9,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDNU",10,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDNU",11,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDNU",12,0)
SUM ;if summary only
"RTN","PSDNU",13,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDNU",14,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the detail report including summary totals."
"RTN","PSDNU",15,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDNU",16,0)
SORT ;sel sort order
"RTN","PSDNU",17,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/ALL NAOUS;N:NAOU/ALL DRUGS",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDNU",18,0)
 S DIR("?",1)="Enter 'D' if you wish to print the NAOU Usage Report sorted by DRUG",DIR("?",2)="  and within DRUG by each NAOU."
"RTN","PSDNU",19,0)
 S DIR("?",3)="Enter 'N' to print the NAOU Usage Report by NAOU",DIR("?")="  and within NAOU by each DRUG."
"RTN","PSDNU",20,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDNU",21,0)
 G:ANS="D" DRUG
"RTN","PSDNU",22,0)
ASKN ;ask NAOU(s)
"RTN","PSDNU",23,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDNU",24,0)
 K DA,DIC
"RTN","PSDNU",25,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDNU",26,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDNU",27,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S LOC(PSD)=""
"RTN","PSDNU",28,0)
 G DEV
"RTN","PSDNU",29,0)
DRUG ;ask drug(s)
"RTN","PSDNU",30,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDNU",31,0)
 K DA,DIC F  S DIC("A")="Select DRUG: ",DIC=50,DIC(0)="QEAM",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC Q:Y<0  S LOC(+Y)=""
"RTN","PSDNU",32,0)
 I '$D(LOC)&(X'="^ALL") G END
"RTN","PSDNU",33,0)
 I X="^ALL" S ALL=1
"RTN","PSDNU",34,0)
DEV ;asks device and queueing information
"RTN","PSDNU",35,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDNU",36,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNU",37,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(ANS="D":"START^PSDNU1",1:"START^PSDNU2"),ZTDESC="CS PHARM NAOU Usage Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNU",38,0)
 U IO G:ANS="D" START^PSDNU1 G:ANS="N" START^PSDNU2
"RTN","PSDNU",39,0)
END ;
"RTN","PSDNU",40,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),LOC
"RTN","PSDNU",41,0)
 K POP,PSD,PSDATE,PSDED,PSDOUT,PSDSD,PSDT,SUM,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDNU",42,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNU",43,0)
 Q
"RTN","PSDNU",44,0)
SAVE ;save variables for queueing
"RTN","PSDNU",45,0)
 S ZTSAVE("ANS")="",ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(LOC) ZTSAVE("LOC(")=""
"RTN","PSDNU",46,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDNU",47,0)
 S (ZTSAVE("PSDATE"),ZTSAVE("PSDED"),ZTSAVE("PSDSD"))=""
"RTN","PSDNU",48,0)
 Q
"RTN","PSDNU1")
0^128^B24081140
"RTN","PSDNU1",1,0)
PSDNU1 ;BIR/JPW-Print NAOU Usage Report by Drug ; 2 Aug 94
"RTN","PSDNU1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNU1",3,0)
START ;entry point for report
"RTN","PSDNU1",4,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUS",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQT",$J),^TMP("PSDNUQ",$J)
"RTN","PSDNU1",5,0)
 I $D(ALL) D ALL G PRINT
"RTN","PSDNU1",6,0)
 F JJ2=2,3,4,5 F PSDR=0:0 S PSDR=$O(LOC(PSDR)) Q:'PSDR  F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  D
"RTN","PSDNU1",7,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,JJ2,KK)) Q:'KK  D SET
"RTN","PSDNU1",8,0)
PRINT ;prints data for stock drugs
"RTN","PSDNU1",9,0)
 I SUM D ^PSDNU3 G DONE
"RTN","PSDNU1",10,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDNU1",11,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDNU1",12,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDNU",$J,PSDR)) D:PSDR="" GTOT Q:PSDR=""!(PSDOUT)  D HDR S NAOU="" F  S NAOU=$O(^TMP("PSDNU",$J,PSDR,NAOU)) D:NAOU="" NTOT Q:NAOU=""!(PSDOUT)  W !,?2,"=> ",NAOU,!! D
"RTN","PSDNU1",13,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDNU",$J,PSDR,NAOU,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDNU",$J,PSDR,NAOU,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDNU1",14,0)
 ..S NODE=^TMP("PSDNU",$J,PSDR,NAOU,NUM,JJ),DATE=$E(JJ,4,5)_"/"_$E(JJ,6,7)_"/"_$E(JJ,2,3)
"RTN","PSDNU1",15,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",NAOU,!!
"RTN","PSDNU1",16,0)
 ..W NUM,?16,DATE,?25,$J($P(NODE,"^"),6),?37,$P(NODE,"^",2),?70,$P(NODE,"^",3),!
"RTN","PSDNU1",17,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNU1",18,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNU1",19,0)
END ;
"RTN","PSDNU1",20,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJ2,KK,LOC,LN
"RTN","PSDNU1",21,0)
 K NAOU,NAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDSD,PSDT,PSDTR,RPDT,SUM,X,Y
"RTN","PSDNU1",22,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNU1",23,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J),^TMP("PSDNUS",$J),^TMP("PSDNUQT",$J)
"RTN","PSDNU1",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNU1",25,0)
 Q
"RTN","PSDNU1",26,0)
ALL ;loops for all drugs
"RTN","PSDNU1",27,0)
 Q:'$D(ALL)
"RTN","PSDNU1",28,0)
 F JJ2=2,3,4,5 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDNU1",29,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,JJ2,KK)) Q:'KK  D SET
"RTN","PSDNU1",30,0)
 Q
"RTN","PSDNU1",31,0)
HDR ;lists header information
"RTN","PSDNU1",32,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNU1",33,0)
 W:$Y @IOF S PG=PG+1 W !,"DRUG/NAOU USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDNU1",34,0)
 I $D(PSDR),PSDR]"" W "DRUG: ",PSDR,!
"RTN","PSDNU1",35,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDNU1",36,0)
 W !,?2,"=> NAOU",!,?16,"DATE",!,"DISP #",?15,"FILLED",?25,"QUANTITY",?37,"ORDERED BY",?72,"TYPE",!,LN,!
"RTN","PSDNU1",37,0)
 Q
"RTN","PSDNU1",38,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDNUS",$J,PSDR,NAOU),?25,$J(^TMP("PSDNUQ",$J,PSDR,NAOU),6),?37,"Totals",!
"RTN","PSDNU1",39,0)
 Q
"RTN","PSDNU1",40,0)
NTOT Q:PSDOUT  W !,"DRUG Subtotal # of Orders: ",^TMP("PSDNUT",$J,PSDR),"   Total Quantity: ",^TMP("PSDNUQT",$J,PSDR),!
"RTN","PSDNU1",41,0)
 Q
"RTN","PSDNU1",42,0)
GTOT ;grand total
"RTN","PSDNU1",43,0)
 Q:PSDOUT
"RTN","PSDNU1",44,0)
 W !,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDNU1",45,0)
 Q
"RTN","PSDNU1",46,0)
SET ;sets data
"RTN","PSDNU1",47,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18)
"RTN","PSDNU1",48,0)
 Q:$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  S PSDOK=0
"RTN","PSDNU1",49,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNU1",50,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDNU1",51,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDNU1",52,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P($G(^(4)),"^",3)
"RTN","PSDNU1",53,0)
 I JJ2=2,$D(^PSD(58.81,KK,7)),+$P($G(^(7)),"^",3)'=PSD S QTY=QTY-(+$P(^(7),"^",7))
"RTN","PSDNU1",54,0)
 S QTY=$S(JJ2=3:-(+$P($G(^PSD(58.81,KK,3)),"^",2)),JJ2=4:-(+$P($G(^PSD(58.81,KK,3)),"^",5)),JJ2=14:+$P($G(^PSD(58.81,KK,4)),"^",3),1:QTY)
"RTN","PSDNU1",55,0)
 I JJ2=5 S PSDTR=+$P($G(^PSD(58.81,KK,7)),"^",6) D:PSDTR
"RTN","PSDNU1",56,0)
 .I +$P($G(^PSD(58.81,PSDTR,0)),"^",18)=PSD S PSDOK=1
"RTN","PSDNU1",57,0)
 S NURS=$S(+$P($G(^PSD(58.81,KK,1)),"^",7):+$P($G(^(1)),"^",7),1:+$P($G(^PSD(58.81,KK,1)),"^",3))
"RTN","PSDNU1",58,0)
 S NURS=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),PSDPN="DISP W/O GS":"N/A",1:"UNKNOWN")
"RTN","PSDNU1",59,0)
 S ^TMP("PSDNU",$J,PSDRN,NAOUN,PSDPN,JJ)=QTY_"^"_NURS_"^"_$S(JJ2=2:"DISPENSE",JJ2=3:"RET/STK",JJ2=4:"DESTROY",JJ2=5:"TRANSFER",1:"N/A")
"RTN","PSDNU1",60,0)
 S:'$D(^TMP("PSDNUT",$J,PSDRN)) ^TMP("PSDNUT",$J,PSDRN)=0 S:'PSDOK ^TMP("PSDNUT",$J,PSDRN)=+^TMP("PSDNUT",$J,PSDRN)+1
"RTN","PSDNU1",61,0)
 S:'$D(^TMP("PSDNUQT",$J,PSDRN)) ^TMP("PSDNUQT",$J,PSDRN)=0 S ^TMP("PSDNUQT",$J,PSDRN)=+^TMP("PSDNUQT",$J,PSDRN)+QTY
"RTN","PSDNU1",62,0)
 S:'$D(^TMP("PSDNUS",$J,PSDRN,NAOUN)) ^TMP("PSDNUS",$J,PSDRN,NAOUN)=0 S:'PSDOK ^TMP("PSDNUS",$J,PSDRN,NAOUN)=+^TMP("PSDNUS",$J,PSDRN,NAOUN)+1
"RTN","PSDNU1",63,0)
 S:'$D(^TMP("PSDNUQ",$J,PSDRN,NAOUN)) ^TMP("PSDNUQ",$J,PSDRN,NAOUN)=0 S ^TMP("PSDNUQ",$J,PSDRN,NAOUN)=+^TMP("PSDNUQ",$J,PSDRN,NAOUN)+QTY
"RTN","PSDNU1",64,0)
 S:'$D(^TMP("PSDNUG",$J)) ^TMP("PSDNUG",$J)=0 S:'PSDOK ^TMP("PSDNUG",$J)=+^TMP("PSDNUG",$J)+1
"RTN","PSDNU1",65,0)
 S PSDOK=0
"RTN","PSDNU1",66,0)
 Q
"RTN","PSDNU2")
0^129^B19397437
"RTN","PSDNU2",1,0)
PSDNU2 ;BIR/JPW-Print NAOU Usage Report by NAOU ; 2 Aug 94
"RTN","PSDNU2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNU2",3,0)
START ;entry point for report
"RTN","PSDNU2",4,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUS",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J)
"RTN","PSDNU2",5,0)
 F JJ2=2,3,4,5 F JJ=PSDSD:0 S JJ=$O(^PSD(58.81,"ACT",JJ)) Q:'JJ!(JJ>PSDED)  F JJ1=0:0 S JJ1=$O(^PSD(58.81,"ACT",JJ,JJ1)) Q:'JJ1  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR)) Q:'PSDR  D
"RTN","PSDNU2",6,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",JJ,JJ1,PSDR,JJ2,KK)) Q:'KK  D SET
"RTN","PSDNU2",7,0)
PRINT ;prints data for stock drugs
"RTN","PSDNU2",8,0)
 I SUM D ^PSDNU3 G DONE
"RTN","PSDNU2",9,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDNU2",10,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDNU2",11,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDNU",$J,NAOU)) D:NAOU="" GTOT Q:NAOU=""!(PSDOUT)  D HDR S PSDR="" F  S PSDR=$O(^TMP("PSDNU",$J,NAOU,PSDR)) D:PSDR="" NTOT Q:PSDR=""!(PSDOUT)  W !,?2,"=> ",PSDR,!! D
"RTN","PSDNU2",12,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDNU",$J,NAOU,PSDR,NUM)) D:NUM="" TOT Q:NUM=""!(PSDOUT)  F JJ=0:0 S JJ=$O(^TMP("PSDNU",$J,NAOU,PSDR,NUM,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDNU2",13,0)
 ..S NODE=^TMP("PSDNU",$J,NAOU,PSDR,NUM,JJ),DATE=$E(JJ,4,5)_"/"_$E(JJ,6,7)_"/"_$E(JJ,2,3)
"RTN","PSDNU2",14,0)
 ..I $Y+8>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",PSDR,!!
"RTN","PSDNU2",15,0)
 ..W NUM,?16,DATE,?25,$J($P(NODE,"^"),6),?37,$P(NODE,"^",2),?70,$P(NODE,"^",3),!
"RTN","PSDNU2",16,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNU2",17,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNU2",18,0)
END ;
"RTN","PSDNU2",19,0)
 K %,%DT,%H,%I,%ZIS,ALL,ANS,DA,DATE,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJ2,KK,LOC,LN
"RTN","PSDNU2",20,0)
 K NAOU,NAOUN,NODE,NUM,NURS,QTY,PG,POP,PSD,PSDATE,PSDED,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDSD,PSDT,PSDTR,RPDT,SUM,X,Y
"RTN","PSDNU2",21,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNU2",22,0)
 K ^TMP("PSDNU",$J),^TMP("PSDNUT",$J),^TMP("PSDNUG",$J),^TMP("PSDNUQ",$J),^TMP("PSDNUS",$J)
"RTN","PSDNU2",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNU2",24,0)
 Q
"RTN","PSDNU2",25,0)
SET ;sets data
"RTN","PSDNU2",26,0)
 Q:'$D(^PSD(58.81,KK,0))  S NODE=^PSD(58.81,KK,0),PSD=+$P(NODE,"^",18)
"RTN","PSDNU2",27,0)
 Q:'$D(LOC(PSD))  Q:+$P($G(^PSD(58.8,PSD,0)),"^",3)'=+PSDSITE  S PSDOK=0
"RTN","PSDNU2",28,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNU2",29,0)
 S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDNU2",30,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"DISP W/O GS"),QTY=+$P(NODE,"^",6)
"RTN","PSDNU2",31,0)
 S:+$P($G(^PSD(58.81,KK,4)),"^",3) QTY=+$P($G(^(4)),"^",3)
"RTN","PSDNU2",32,0)
 I JJ2=2,$D(^PSD(58.81,KK,7)),+$P(^(7),"^",3)'=PSD S QTY=QTY-(+$P(^(7),"^",7))
"RTN","PSDNU2",33,0)
 S QTY=$S(JJ2=3:-(+$P($G(^PSD(58.81,KK,3)),"^",2)),JJ2=4:-(+$P($G(^PSD(58.81,KK,3)),"^",5)),JJ2=14:+$P($G(^PSD(58.81,KK,4)),"^",3),1:QTY)
"RTN","PSDNU2",34,0)
 I JJ2=5 S PSDTR=+$P($G(^PSD(58.81,KK,7)),"^",6) D:PSDTR
"RTN","PSDNU2",35,0)
 .I +$P($G(^PSD(58.81,PSDTR,0)),"^",18)=PSD S PSDOK=1
"RTN","PSDNU2",36,0)
 S NURS=$S(+$P($G(^PSD(58.81,KK,1)),"^",7):+$P($G(^(1)),"^",7),1:+$P($G(^PSD(58.81,KK,1)),"^",3))
"RTN","PSDNU2",37,0)
 S NURS=$S($P($G(^VA(200,NURS,0)),"^")]"":$P(^(0),"^"),PSDPN="DISP W/O GS":"N/A",1:"UNKNOWN")
"RTN","PSDNU2",38,0)
 S ^TMP("PSDNU",$J,NAOUN,PSDRN,PSDPN,JJ)=QTY_"^"_NURS_"^"_$S(JJ2=2:"DISPENSE",JJ2=3:"RET/STK",JJ2=4:"DESTROY",JJ2=5:"TRANSFER",1:"N/A")
"RTN","PSDNU2",39,0)
 S:'$D(^TMP("PSDNUT",$J,NAOUN)) ^TMP("PSDNUT",$J,NAOUN)=0 S:'PSDOK ^TMP("PSDNUT",$J,NAOUN)=+^TMP("PSDNUT",$J,NAOUN)+1
"RTN","PSDNU2",40,0)
 S:'$D(^TMP("PSDNUS",$J,NAOUN,PSDRN)) ^TMP("PSDNUS",$J,NAOUN,PSDRN)=0 S:'PSDOK ^TMP("PSDNUS",$J,NAOUN,PSDRN)=+^TMP("PSDNUS",$J,NAOUN,PSDRN)+1
"RTN","PSDNU2",41,0)
 S:'$D(^TMP("PSDNUQ",$J,NAOUN,PSDRN)) ^TMP("PSDNUQ",$J,NAOUN,PSDRN)=0 S ^TMP("PSDNUQ",$J,NAOUN,PSDRN)=+^TMP("PSDNUQ",$J,NAOUN,PSDRN)+QTY
"RTN","PSDNU2",42,0)
 S:'$D(^TMP("PSDNUG",$J)) ^TMP("PSDNUG",$J)=0 S:'PSDOK ^TMP("PSDNUG",$J)=+^TMP("PSDNUG",$J)+1
"RTN","PSDNU2",43,0)
 S PSDOK=0
"RTN","PSDNU2",44,0)
 Q
"RTN","PSDNU2",45,0)
HDR ;lists header information
"RTN","PSDNU2",46,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNU2",47,0)
 W:$Y @IOF S PG=PG+1 W !,"NAOU/DRUG USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDNU2",48,0)
 W:$D(NAOU) "NAOU: ",NAOU,!
"RTN","PSDNU2",49,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDNU2",50,0)
 W !,?2,"=> DRUG",!,?16,"DATE",!,"DISP #",?15,"FILLED",?25,"QUANTITY",?37,"ORDERED BY",?70,"TYPE",!,LN,!
"RTN","PSDNU2",51,0)
 Q
"RTN","PSDNU2",52,0)
TOT Q:PSDOUT  W !,"---------",?25,"----------",!,?3,^TMP("PSDNUS",$J,NAOU,PSDR),?25,$J(^TMP("PSDNUQ",$J,NAOU,PSDR),6),?37,"Totals",!
"RTN","PSDNU2",53,0)
 Q
"RTN","PSDNU2",54,0)
NTOT Q:PSDOUT  W !,"NAOU Subtotal # of Orders: ",^TMP("PSDNUT",$J,NAOU),!
"RTN","PSDNU2",55,0)
 Q
"RTN","PSDNU2",56,0)
GTOT ;grand total
"RTN","PSDNU2",57,0)
 Q:PSDOUT
"RTN","PSDNU2",58,0)
 W !,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDNU2",59,0)
 Q
"RTN","PSDNU3")
0^130^B3705047
"RTN","PSDNU3",1,0)
PSDNU3 ;BIR/JPW-Print NAOU Usage Report Summary Totals ; 2 Aug 94
"RTN","PSDNU3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNU3",3,0)
PRINT ;prints data for stock drugs
"RTN","PSDNU3",4,0)
 K LN S $P(LN,"-",80)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y
"RTN","PSDNU3",5,0)
 I '$D(^TMP("PSDNU",$J)) D HDR W !!,?10,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" Q
"RTN","PSDNU3",6,0)
 S JJ="" F  S JJ=$O(^TMP("PSDNUS",$J,JJ)) Q:JJ=""!(PSDOUT)  D HDR S KK="" F  S KK=$O(^TMP("PSDNUS",$J,JJ,KK)) D:KK="" NTOT Q:KK=""!(PSDOUT)  D TOT
"RTN","PSDNU3",7,0)
 Q
"RTN","PSDNU3",8,0)
HDR ;lists header information
"RTN","PSDNU3",9,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNU3",10,0)
 W:$Y @IOF S PG=PG+1 W !,"SUMMARY NAOU/DRUG USAGE REPORT  -  DATE: "_RPDT,?70,"PAGE: ",PG,!
"RTN","PSDNU3",11,0)
 I ANS="N",$D(JJ) W "NAOU: ",JJ,!
"RTN","PSDNU3",12,0)
 I ANS="D",$D(JJ) W "DRUG: ",JJ,!
"RTN","PSDNU3",13,0)
 W "From ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDNU3",14,0)
 W !,?2,"=> ",$S(ANS="D":"NAOU",1:"DRUG"),!,"TOTAL # OF ORDERS",?30,"TOTAL QUANTITY",!,LN,!
"RTN","PSDNU3",15,0)
 Q
"RTN","PSDNU3",16,0)
TOT Q:PSDOUT  I $Y+8>IOSL D HDR
"RTN","PSDNU3",17,0)
 W !!,?2,"=> ",KK,!,$J(^TMP("PSDNUS",$J,JJ,KK),8),?34,$J(^TMP("PSDNUQ",$J,JJ,KK),6)
"RTN","PSDNU3",18,0)
 Q
"RTN","PSDNU3",19,0)
NTOT Q:PSDOUT  I $Y+6>IOSL D HDR
"RTN","PSDNU3",20,0)
 W !!,?2,"=> ",KK
"RTN","PSDNU3",21,0)
 W !!,$S(ANS="D":"DRUG",1:"NAOU")," Subtotal # of Orders: ",^TMP("PSDNUT",$J,JJ) W:ANS="D" "    Total Quantity: ",^TMP("PSDNUQT",$J,JJ)
"RTN","PSDNU3",22,0)
 W !!,"Grand Total # of Orders: ",^TMP("PSDNUG",$J),!
"RTN","PSDNU3",23,0)
 Q
"RTN","PSDNVT")
0^131^B1547220
"RTN","PSDNVT",1,0)
PSDNVT ;BIR/JPW-Enter/Edit Inventory Types ; 6 July 94
"RTN","PSDNVT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDNVT",3,0)
INVEN ;entry for inventory types into file 58.16
"RTN","PSDNVT",4,0)
 K DA,DIC,DLAYGO F  W ! S (DIC,DLAYGO)=58.16,DIC("A")="Select NAOU INVENTORY TYPE NAME: ",DIC(0)="QEAL" D ^DIC K DIC,DLAYGO Q:Y<0  K DA,DIE,DR S DIE=58.16,DA=+Y,DR=".01 NAOU INVENTORY TYPE NAME;1" D ^DIE K DIE,DR
"RTN","PSDNVT",5,0)
END K DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","PSDON001")
1^132
"RTN","PSDONIT")
1^133
"RTN","PSDONIT1")
1^134
"RTN","PSDONIT2")
1^135
"RTN","PSDONIT3")
1^136
"RTN","PSDOPT")
0^137^B22140879
"RTN","PSDOPT",1,0)
PSDOPT ;BIR/JPW,LTL-Outpatient Rx Entry ; 29 Aug 94
"RTN","PSDOPT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDOPT",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Please contact your Pharmacy Coordinator for access",!,"to log Outpatient Prescriptions.  PSJ RPHARM security key required.",!! Q
"RTN","PSDOPT",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDOPT",6,0)
 N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDOPT",7,0)
 N LN S (PSDOUT,NEW)=0,PSDUZ=DUZ,$P(LN,"-",80)="",Y=DT
"RTN","PSDOPT",8,0)
 X ^DD("DD") S RPDT=Y
"RTN","PSDOPT",9,0)
ASKD ;ask disp site
"RTN","PSDOPT",10,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDOPT",11,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDOPT",12,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDOPT",13,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDOPT",14,0)
 W ! D ^DIC K DIC G:Y<0 END
"RTN","PSDOPT",15,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDOPT",16,0)
CHKD I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no stocked drugs for this Pharmacy Vault!!",!! G END
"RTN","PSDOPT",17,0)
ASKPH ;ask releasing RPH
"RTN","PSDOPT",18,0)
 S DIC="^VA(200,",DIC(0)="QEAM",DIC("S")="I $D(^XUSEC(""PSORPH"",+Y))"
"RTN","PSDOPT",19,0)
 S DIC("A")="Please identify Pharmacist for Outpatient Release: "
"RTN","PSDOPT",20,0)
 S:$D(^XUSEC("PSORPH",DUZ)) DIC("B")=$P($G(^VA(200,DUZ,0)),U)
"RTN","PSDOPT",21,0)
 W ! D ^DIC K DIC G:Y<1 END S PSDRPH=+Y
"RTN","PSDOPT",22,0)
ASKP ;ask rx #
"RTN","PSDOPT",23,0)
 W ! K DIR,NEW,PSDRX,RXNUM S DIR("A")="Enter/Wand PRESCRIPTION number"
"RTN","PSDOPT",24,0)
 S DIR("?")="^D HELP^PSODISP",DIR(0)="F^1:35" D ^DIR K DIR
"RTN","PSDOPT",25,0)
 G:$D(DTOUT)!($D(DUOUT)) END G:X="" ASKPH
"RTN","PSDOPT",26,0)
 S X=$$UP^XLFSTR(X)
"RTN","PSDOPT",27,0)
 I X'["-" D  W:'$G(PSDRX) !,"INVALID PRESCRIPTION NUMBER" G:'$G(PSDRX) ASKP G BC1
"RTN","PSDOPT",28,0)
 .S PSDRX=0 F  S PSDRX=$O(^PSRX("B",X,PSDRX)) Q:'PSDRX!(PSDRX&($P($G(^PSRX(+PSDRX,0)),U,15)'=13))
"RTN","PSDOPT",29,0)
 S PSD(1)=X,DIC="^DIC(4,",DR=99,DA=+$P($G(^XMB(1,1,"XUS")),U,17)
"RTN","PSDOPT",30,0)
 S DIQ="PSD" D EN^DIQ1 S X=PSD(1) K DIC,DR,DIQ
"RTN","PSDOPT",31,0)
 I X["-",$P(X,"-")'=PSD(4,DA,99) K DA,PSD W !?7,$C(7),"   INVALID STATION NUMBER !!",! G ASKP
"RTN","PSDOPT",32,0)
 K DA,PSD
"RTN","PSDOPT",33,0)
 I X["-" S PSDRX=$P(X,"-",2) I '$D(^PSRX(+$G(PSDRX),0))!($G(PSDRX)']"") W !?7,$C(7),"   NON-EXISTENT PRESCRIPTION" G ASKP
"RTN","PSDOPT",34,0)
 G:$D(^PSRX(PSDRX,0)) BC1
"RTN","PSDOPT",35,0)
 W !?7,$C(7),"   IMPROPER BARCODE FORMAT" G ASKP
"RTN","PSDOPT",36,0)
BC1 ;
"RTN","PSDOPT",37,0)
 I +$P($G(^PSRX(+PSDRX,0)),"^",15)=13!+$P($G(^PSRX(+PSDRX,0)),"^",2)=0 W !?7,$C(7),"    PRESCRIPTION HAS BEEN DELETED." G ASKP
"RTN","PSDOPT",38,0)
 I +$P($G(^PSRX(+PSDRX,0)),"^",15),$S($P(^(0),"^",15)=2:0,$P(^(0),"^",15)=5:0,$P(^(0),"^",15)=11:0,$P(^(0),"^",15)=12:0,1:1) D  K J,RX0,RX2,ST,ST0 G ASKP
"RTN","PSDOPT",39,0)
 .S RX0=$G(^PSRX(+PSDRX,0)),RX2=^PSRX(+PSDRX,2),J=PSDRX D ^PSOFUNC
"RTN","PSDOPT",40,0)
 .W !!,$C(7),"     Status of ",ST," is not appropriate for selection."
"RTN","PSDOPT",41,0)
 S RXNUM=$P($G(^PSRX(+PSDRX,0)),U),PSDR=+$P($G(^(0)),U,6),DFN=+$P($G(^(0)),U,2),QTY=$P($G(^(0)),U,7),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDOPT",42,0)
 N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ S PATN=Y
"RTN","PSDOPT",43,0)
 D PID^VADPT6
"RTN","PSDOPT",44,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) W !!,PSDRN," is not currently stocked in ",PSDSN,".",!!,"** No action taken. **",!! G END
"RTN","PSDOPT",45,0)
 I $D(^PSD(58.81,"AOP",PSDRX)) D ^PSDOPT2 I PSDOUT D MSG G END
"RTN","PSDOPT",46,0)
 G ^PSDOPT0
"RTN","PSDOPT",47,0)
CHK ;displays and checks if ok
"RTN","PSDOPT",48,0)
 D DISPLAY G:PSDOUT END
"RTN","PSDOPT",49,0)
 K DA,DIR,DIRUT S DIR(0)="YA",DIR("B")="YES",DIR("A")="Is this OK? "
"RTN","PSDOPT",50,0)
 S DIR("?",1)="Answer 'YES' to log this RX transaction in your CS vault,",DIR("?")="answer 'NO' to reselect a prescription, or '^' to quit."
"RTN","PSDOPT",51,0)
 D ^DIR K DIR I Y<1 D MSG G:$D(DIRUT) END G:Y<1 ASKP
"RTN","PSDOPT",52,0)
 D ^PSDOPT1 G ASKP
"RTN","PSDOPT",53,0)
END K %,%H,%I,BAL,C,CNT,DA,DAT,DD,DFN,DIC,DIE,DIK,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DO,DR,JJ,LN,NEW,NODE,NODE6 D FINAL^PSOLSET
"RTN","PSDOPT",54,0)
 K PATN,PHARM,PHARMN,PRF,PSDA,PSDATE,PSDOUT,PSDR,PSDRN,PSDRPH,PSDRX,PSDS,PSDSN,PSDT,PSDUZ,PSOCSUB,QTY,RF,RPDT,RXNUM,X,Y
"RTN","PSDOPT",55,0)
 D KVAR^VADPT K VA("PID"),VA("BID")
"RTN","PSDOPT",56,0)
 Q
"RTN","PSDOPT",57,0)
DISPLAY ;disp data
"RTN","PSDOPT",58,0)
 W !!,?20,"View Controlled Substances Rx # ",RXNUM,!,?28,RPDT,!,LN,!!
"RTN","PSDOPT",59,0)
 W "Location: ",?10,PSDSN,?55
"RTN","PSDOPT",60,0)
 S PSDRN(1)=$S(NEW:"Original",$G(NEW(1)):"Refill #"_NEW(1),1:"Partial #"_$G(NEW(2))) W PSDRN(1)
"RTN","PSDOPT",61,0)
 W !,"Drug: ",?10,PSDRN,?55,"Quantity: ",QTY
"RTN","PSDOPT",62,0)
 W !,"Patient: ",?10,PATN_"  ("_VA("BID")_")",?55,PSDRN(1)," Date: ",?65,$E(DAT,4,5)_"/"_$E(DAT,6,7)_"/"_$E(DAT,2,3),!
"RTN","PSDOPT",63,0)
 S BAL=+$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),"^",4) I QTY>BAL W !!,?5,"Your balance is ",BAL,".",!,?5,"You may not dispense lower than your balance.",!! D MSG S PSDOUT=1 Q
"RTN","PSDOPT",64,0)
 W !!,?15,"Old Balance: ",BAL,?40,"New Balance: ",BAL-QTY,!!
"RTN","PSDOPT",65,0)
 Q
"RTN","PSDOPT",66,0)
MSG W $C(7),!!,"No action taken.  This transaction has not been recorded.",!!
"RTN","PSDOPT",67,0)
 Q
"RTN","PSDOPT0")
0^138^B16009026
"RTN","PSDOPT0",1,0)
PSDOPT0 ;BIR/JPW,LTL-Outpatient Rx Entry (cont'd) ; 20 July 94
"RTN","PSDOPT0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPT0",3,0)
 ;called by ^PSDOPT
"RTN","PSDOPT0",4,0)
LOOP ;loop to find new, refills and partials
"RTN","PSDOPT0",5,0)
 W !!,"Accessing the prescription history..."
"RTN","PSDOPT0",6,0)
 N PSDOIN,PSDRXFD,PSDSUPN,PSDLBL S PSDOIN=+$P($G(^PS(59.7,1,49.99)),U,2)
"RTN","PSDOPT0",7,0)
 ;check for unposted refills not returned to stock and not in suspense
"RTN","PSDOPT0",8,0)
 S (RF,DAT)=0 F JJ=0:0 S JJ=$O(^PSRX(PSDRX,1,JJ)) Q:'JJ  I $D(^PSRX(PSDRX,1,JJ,0)),'$D(PSDRX("RF",JJ)),'$P(^(0),U,16),$P($G(^(0)),U)'<PSDOIN D
"RTN","PSDOPT0",9,0)
 .;checking for suspense
"RTN","PSDOPT0",10,0)
 .S PSDRXFD=$E($P(^PSRX(PSDRX,1,JJ,0),U),1,7)
"RTN","PSDOPT0",11,0)
 .S PSDSUPN=$O(^PS(52.5,"B",PSDRX,0))
"RTN","PSDOPT0",12,0)
 .I PSDSUPN,$D(^PS(52.5,"C",PSDRXFD,PSDSUPN)),$G(^PS(52.5,PSDSUPN,"P"))'=1 W !!,"Refill #",JJ," suspended." Q
"RTN","PSDOPT0",13,0)
 .F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I $P(^PSRX(PSDRX,"L",PSDLBL,0),U,2)=JJ S PSDLBL(1)=1
"RTN","PSDOPT0",14,0)
 .I '$G(PSDLBL(1)) W !!,"Refill #",JJ," label not printed." Q
"RTN","PSDOPT0",15,0)
 .S RXNUM("RF",JJ)=+^PSRX(PSDRX,1,JJ,0)_U_$P(^(0),U,4) K PSDLBLP
"RTN","PSDOPT0",16,0)
 ;check for unposted partials not returned to stock or suspended
"RTN","PSDOPT0",17,0)
 S PRF=0 F JJ=0:0 S JJ=$O(^PSRX(PSDRX,"P",JJ)) Q:'JJ  I $D(^PSRX(PSDRX,"P",JJ,0)),'$D(PSDRX("PR",JJ)),'$P(^(0),U,16),$P($G(^(0)),U)'<PSDOIN D
"RTN","PSDOPT0",18,0)
 .;check for suspense
"RTN","PSDOPT0",19,0)
 .S PSDRXFD=$E($P(^PSRX(PSDRX,"P",JJ,0),U),1,7)
"RTN","PSDOPT0",20,0)
 .S PSDSUPN=$O(^PS(52.5,"B",PSDRX,0))
"RTN","PSDOPT0",21,0)
 .I PSDSUPN,$D(^PS(52.5,"C",PSDRXFD,PSDSUPN)),$G(^PS(52.5,PSDSUPN,"P"))'=1,($G(JJ)=$P(^PS(52.5,PSDSUPN,0),U,5)) W !!,"Partial #",JJ," suspended." Q
"RTN","PSDOPT0",22,0)
 .F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I $P(^PSRX(PSDRX,"L",0),U,2)=99-JJ S PSDLBL(1)=1
"RTN","PSDOPT0",23,0)
 .I '$G(PSDLBL(1)) W !!,"Partial #",JJ," label not printed." Q
"RTN","PSDOPT0",24,0)
 .S RXNUM("PR",JJ)=+^PSRX(PSDRX,"P",JJ,0)_U_$P(^(0),U,4) K PSDLBL
"RTN","PSDOPT0",25,0)
 ;original returned to stock
"RTN","PSDOPT0",26,0)
 S:$P($G(^PSRX(+PSDRX,2)),U,15) PSDRX(1)=""
"RTN","PSDOPT0",27,0)
 ;Check for suspense
"RTN","PSDOPT0",28,0)
 I +$P($G(^PSRX(PSDRX,2)),U,2)'<PSDOIN S PSDRXFD=$P(^(2),U,2) D
"RTN","PSDOPT0",29,0)
 .S PSDSUPN=$O(^PS(52.5,"B",PSDRX,0))
"RTN","PSDOPT0",30,0)
 .I PSDSUPN,$D(^PS(52.5,"C",PSDRXFD,PSDSUPN)),$G(^PS(52.5,PSDSUPN,"P"))'=1 W !!,"Original suspended." S PSDRX(1)="" Q
"RTN","PSDOPT0",31,0)
 .F PSDLBL=0:0 S PSDLBL=$O(^PSRX(PSDRX,"L",PSDLBL)) Q:'PSDLBL  I '+$P(^PSRX(PSDRX,"L",0),U,2) S PSDLBL(1)=1
"RTN","PSDOPT0",32,0)
 .I $G(PSDLBL(1)) S PSDRX(1)="" W !!,"Original label not printed."
"RTN","PSDOPT0",33,0)
 I '$O(RXNUM("RF",0)),'$O(RXNUM("PR",0)),$O(PSDRX(0)) W !!,"There is no dispensing to post for Rx #",RXNUM,"." G ASKP^PSDOPT
"RTN","PSDOPT0",34,0)
 ;no unposted refills or partials ask to post original
"RTN","PSDOPT0",35,0)
 I '$O(RXNUM("RF",0)),'$O(RXNUM("PR",0)) S NEW=1,DAT=$P($G(^PSRX(PSDRX,2)),"^",2) G CHK^PSDOPT
"RTN","PSDOPT0",36,0)
 ;prepare to check for multiple unposted refills or partials
"RTN","PSDOPT0",37,0)
 S NEW=$O(RXNUM("RF",0)),NEW(1)=$O(RXNUM("PR",0))
"RTN","PSDOPT0",38,0)
 ;one unposted refill only
"RTN","PSDOPT0",39,0)
 I NEW,'$O(RXNUM("RF",NEW)),'NEW(1),$O(PSDRX(0)) S DAT=$P(RXNUM("RF",NEW),U),QTY=$P(RXNUM("RF",NEW),U,2),NEW(1)=NEW,NEW=0 G CHK^PSDOPT
"RTN","PSDOPT0",40,0)
 ;one unposted partial only
"RTN","PSDOPT0",41,0)
 I NEW(1),'$O(RXNUM("PR",NEW(1))),'NEW,$O(PSDRX(0)) S DAT=$P(RXNUM("PR",NEW(1)),U),QTY=$P(RXNUM("PR",NEW(1)),U,2),NEW(2)=NEW(1),(NEW,NEW(1))=0 G CHK^PSDOPT
"RTN","PSDOPT0",42,0)
 S DIR("A")="Choice",(CNT,NEW)=0
"RTN","PSDOPT0",43,0)
 S DIR("?")="Because there is multiple dispensing from which to post, I need a choice."
"RTN","PSDOPT0",44,0)
 S:'$O(PSDRX(0)) DIR(0)="S^1:Original;",CNT=1
"RTN","PSDOPT0",45,0)
 F  S NEW=$O(RXNUM("RF",NEW)) Q:'NEW  S CNT=$G(CNT)+1 D
"RTN","PSDOPT0",46,0)
 .I $G(DIR(0))']"" S DIR(0)="S^1:Refill #"_NEW_";" Q
"RTN","PSDOPT0",47,0)
 .S DIR(0)=DIR(0)_CNT_":Refill #"_NEW_";"
"RTN","PSDOPT0",48,0)
 F  S NEW=$O(RXNUM("PR",NEW)) Q:'NEW  S CNT=$G(CNT)+1 D
"RTN","PSDOPT0",49,0)
 .I $G(DIR(0))']"" S DIR(0)="S^1:Partial #"_NEW_";" Q
"RTN","PSDOPT0",50,0)
 .S DIR(0)=DIR(0)_CNT_":Partial #"_NEW_" ("_$P(RXNUM("PR",NEW),U,2)_");"
"RTN","PSDOPT0",51,0)
 D ^DIR K DIR
"RTN","PSDOPT0",52,0)
 I $D(DIRUT) G END^PSDOPT
"RTN","PSDOPT0",53,0)
 I $E(Y(0))="O" S DAT=$P($G(^PSRX(PSDRX,2)),U,2),NEW=1,NEW(1)=0 G CHK^PSDOPT
"RTN","PSDOPT0",54,0)
 I $E(Y(0))="R" S DAT=$P(RXNUM("RF",+$P(Y(0),"#",2)),U),QTY=$P(RXNUM("RF",+$P(Y(0),"#",2)),U,2),NEW(1)=$P(Y(0),"#",2),NEW=0 G CHK^PSDOPT
"RTN","PSDOPT0",55,0)
 S DAT=$P(RXNUM("PR",+$P(Y(0),"#",2)),U),QTY=$P(RXNUM("PR",+$P(Y(0),"#",2)),U,2),NEW(2)=+$P(Y(0),"#",2),(NEW,NEW(1))=0 G CHK^PSDOPT
"RTN","PSDOPT1")
0^139^B9292680
"RTN","PSDOPT1",1,0)
PSDOPT1 ;BIR/JPW,LTL-Outpatient Rx Entry (cont'd) ; 20 July 94
"RTN","PSDOPT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPT1",3,0)
UPDATE W !!,"Creating an Outpatient Transaction..."
"RTN","PSDOPT1",4,0)
 F  L +^PSD(58.8,+PSDS,1,PSDR,0):0 I  Q
"RTN","PSDOPT1",5,0)
 D NOW^%DTC S PSDT=+% S BAL=+$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-QTY
"RTN","PSDOPT1",6,0)
 L -^PSD(58.8,+PSDS,1,PSDR,0)
"RTN","PSDOPT1",7,0)
 W "updating..."
"RTN","PSDOPT1",8,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDOPT1",9,0)
FIND S PSDA=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDA)) S $P(^PSD(58.81,0),"^",3)=PSDA G FIND
"RTN","PSDOPT1",10,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.81,DIC(0)="L",(X,DINUM)=PSDA D ^DIC K DIC,DLAYGO
"RTN","PSDOPT1",11,0)
 L -^PSD(58.81,0)
"RTN","PSDOPT1",12,0)
ADD ;set trans
"RTN","PSDOPT1",13,0)
 S ^PSD(58.81,PSDA,0)=PSDA_"^6^"_+PSDS_"^"_PSDT_"^"_PSDR_"^"_QTY_"^"_PSDUZ_"^^^"_BAL
"RTN","PSDOPT1",14,0)
 S ^PSD(58.81,PSDA,6)=PSDRX_"^"_$S($G(NEW(1)):NEW(1),1:"")_"^"_DAT_"^"_$S($G(NEW(2)):NEW(2),1:"")_"^"_RXNUM_"^"_PSDRPH
"RTN","PSDOPT1",15,0)
 S ^PSD(58.81,PSDA,"CS")=1
"RTN","PSDOPT1",16,0)
 S DIK="^PSD(58.81,",DA=PSDA D IX^DIK K DA,DIK
"RTN","PSDOPT1",17,0)
 W "vault activity..."
"RTN","PSDOPT1",18,0)
DIE I '$D(^PSD(58.8,+PSDS,1,PSDR,4,0)) S ^(0)="^58.800119PA^^"
"RTN","PSDOPT1",19,0)
 K DA,DIC,DD,DO S DA(1)=PSDR,DA(2)=+PSDS,(X,DINUM)=PSDA,DIC(0)="L",DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",4," D FILE^DICN K DIC,DINUM
"RTN","PSDOPT1",20,0)
 ;monthly activity
"RTN","PSDOPT1",21,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,0)) S ^(0)="^58.801A^^"
"RTN","PSDOPT1",22,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,5,$E(DT,1,5)*100,0)) K DA,DIC S DIC="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DIC(0)="LM",DLAYGO=58.8,(X,DINUM)=$E(DT,1,5)*100,DA(2)=+PSDS,DA(1)=PSDR D ^DIC K DA,DIC,DINUM,DLAYGO
"RTN","PSDOPT1",23,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_+PSDS_",1,"_PSDR_",5,",DA(2)=+PSDS,DA(1)=PSDR,DA=$E(DT,1,5)*100,DR="9////^S X=$P($G(^(0)),""^"",6)+QTY" D ^DIE K DA,DIE,DR
"RTN","PSDOPT1",24,0)
 W "done."
"RTN","PSDOPT1",25,0)
 I $G(NEW(2)),$P($G(^PSRX(+PSDRX,"P",NEW(2),0)),U,19) S Y=$P(^(0),U,19) X ^DD("DD") W !!,"Partial #",NEW(2)," for Rx # ",RXNUM," was released on ",Y,"." Q
"RTN","PSDOPT1",26,0)
 I $G(NEW(1)),$P($G(^PSRX(+PSDRX,1,NEW(1),0)),U,18) S Y=$P(^(0),U,18) X ^DD("DD") W !!,"Refill #",NEW(1)," for Rx # ",RXNUM," was released on ",Y,"." Q
"RTN","PSDOPT1",27,0)
 I '$G(NEW(1)),'$G(NEW(2)),$P($G(^PSRX(+PSDRX,2)),U,13) S Y=$P(^(2),U,13) X ^DD("DD") W !!,"Rx # ",RXNUM," was released on ",Y,"." Q
"RTN","PSDOPT1",28,0)
 S X="PSOCSRL" X ^%ZOSF("TEST") I $T S XTYPE=$S($G(NEW(2)):"P"_U_NEW(2),$G(NEW(1)):1_U_NEW(1),1:"") D EN^PSOCSRL(PSDRX,XTYPE,PSDRPH)
"RTN","PSDOPT1",29,0)
 Q
"RTN","PSDOPT2")
0^140^B3029215
"RTN","PSDOPT2",1,0)
PSDOPT2 ;BIR/JPW,LTL-Outpatient Rx Entry (cont. from PSDOPT); 9 Jan 95
"RTN","PSDOPT2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPT2",3,0)
 ;lists posted cs rxs
"RTN","PSDOPT2",4,0)
 W !!,"Previously posted transactions for Rx #",RXNUM,!!,"Date Posted:",?22,"Pharmacist:",?54,"Type:",?70,"Quantity:"
"RTN","PSDOPT2",5,0)
 F JJ=0:0 S JJ=$O(^PSD(58.81,"AOP",PSDRX,JJ)) Q:'JJ  I $D(^PSD(58.81,JJ,0)),$D(^(6)) D
"RTN","PSDOPT2",6,0)
 .S NODE=^PSD(58.81,JJ,0),NODE6=^PSD(58.81,JJ,6)
"RTN","PSDOPT2",7,0)
 .S PHARM=+$P(NODE,"^",7),PHARMN="" I PHARM S PHARMN=$P($G(^VA(200,PHARM,0)),"^")
"RTN","PSDOPT2",8,0)
 .S PSDATE=+$P(NODE,"^",4) I PSDATE S Y=PSDATE X ^DD("DD") S PSDATE=Y
"RTN","PSDOPT2",9,0)
 .S VAULT=+$P(NODE,"^",3),VAULT=$P($G(^PSD(58.8,VAULT,0)),"^")
"RTN","PSDOPT2",10,0)
 .W:VAULT'=PSDSN !,"Dispensing Site:  ",VAULT
"RTN","PSDOPT2",11,0)
 .W !,PSDATE,?22,PHARMN,?54,$S($P(NODE6,U,2):"Refill #"_$P(NODE6,U,2),$P(NODE6,U,4):"Partial #"_$P(NODE6,U,4),1:"Original"),?70,$J($P(NODE,U,6),6)
"RTN","PSDOPT2",12,0)
 .S:$P(NODE6,U,2) PSDRX("RF",$P(NODE6,U,2))=""
"RTN","PSDOPT2",13,0)
 .S:$P(NODE6,U,4) PSDRX("PR",$P(NODE6,U,4))=""
"RTN","PSDOPT2",14,0)
 .S:'$P(NODE6,U,2)&('$P(NODE6,U,4)) PSDRX(1)=""
"RTN","PSDOPT2",15,0)
 K JJ,PSDATE,PHARMN,VAULT
"RTN","PSDOPT2",16,0)
 W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="Press <RET> to continue " D ^DIR K DIR
"RTN","PSDOPT2",17,0)
 I 'Y S PSDOUT=1
"RTN","PSDOPT2",18,0)
 Q
"RTN","PSDOPTI")
0^141^B25983890
"RTN","PSDOPTI",1,0)
PSDOPTI ;BIR/LTL-Review OP Transactions by Inventory Type ; 29 Aug 94
"RTN","PSDOPTI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTI",3,0)
 S CNT=0 W !!,"You may select one, several, or ^ALL Inventory Types."
"RTN","PSDOPTI",4,0)
 N PSDI S PSDI=0
"RTN","PSDOPTI",5,0)
INV F  S DIC="^PSI(58.16,",DIC(0)="AEQ",DIC("A")="Please Select Inventory Type: " W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  S PSDI(+Y)=$P(Y,U,2),CNT=CNT+1
"RTN","PSDOPTI",6,0)
 I X="^ALL" F  S PSDI=$O(^PSI(58.16,PSDI)) Q:'PSDI  S PSDI(PSDI)=$P($G(^PSI(58.16,PSDI,0)),U)
"RTN","PSDOPTI",7,0)
 S CNT=0 W !!,"Now, you may select one, several, or ^ALL drugs."
"RTN","PSDOPTI",8,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEQ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  D
"RTN","PSDOPTI",9,0)
 .I '$O(^PSD(58.81,"F",+Y,0)) W !!,"There have been no transactions for this drug.",!! Q
"RTN","PSDOPTI",10,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,PSDLOC,1,+Y,2,PSD(1))) S:$D(PSDI(+PSD(1))) PSD(2)=PSD(1) Q:$G(PSD(2))!('PSD(1))
"RTN","PSDOPTI",11,0)
 .I '$G(PSD(2)) W !!,"Not in selected Inventory Type(s)",!! Q
"RTN","PSDOPTI",12,0)
 .S PSD=$P($G(^PSDRUG(+Y,0)),U),CNT=CNT+1
"RTN","PSDOPTI",13,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_+Y)
"RTN","PSDOPTI",14,0)
 .S ^TMP("PSD",$J,PSDI(PSD(2)),PSD,+Y)="" K PSD
"RTN","PSDOPTI",15,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  D
"RTN","PSDOPTI",16,0)
 .Q:'$O(^PSD(58.81,"F",PSDU,0))
"RTN","PSDOPTI",17,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,PSDLOC,1,PSDU,2,PSD(1))) S:$D(PSDI(+PSD(1))) PSD(2)=PSD(1) Q:$G(PSD(2))!('PSD(1))
"RTN","PSDOPTI",18,0)
 .Q:'$G(PSD(2))
"RTN","PSDOPTI",19,0)
 .S PSD=$P($G(^PSDRUG(PSDU,0)),U)
"RTN","PSDOPTI",20,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_PSDU)
"RTN","PSDOPTI",21,0)
 .S ^TMP("PSD",$J,PSDI(PSD(2)),PSD,PSDU)="" K PSD
"RTN","PSDOPTI",22,0)
 S DIR(0)="S^1:Sort by Rx #;2:Sort by Date Posted"
"RTN","PSDOPTI",23,0)
 S DIR("A")="Within Drug, Sort by",DIR("B")=1
"RTN","PSDOPTI",24,0)
 S DIR("?")="For each drug, do you want the transactions listed in the order they were posted or by Rx #?"
"RTN","PSDOPTI",25,0)
 D ^DIR K DIR G:$D(DIRUT) END I Y=1 S PSDI=1 G ^PSDOPTX
"RTN","PSDOPTI",26,0)
 S DIR(0)="D^2910501:NOW:AEPT",DIR("A")="Beginning date@time",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTI",27,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0),DIR(0)="D^"_PSDT_":NOW:AEPT"
"RTN","PSDOPTI",28,0)
 S DIR("A")="Ending date@time"
"RTN","PSDOPTI",29,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTI",30,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTI",31,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTI",32,0)
DEV ;asks device and queueing info
"RTN","PSDOPTI",33,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTI",34,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTI",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTI",35,0)
START ;compiles and prints output
"RTN","PSDOPTI",36,0)
 N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER S (PSD,PSDU)=0
"RTN","PSDOPTI",37,0)
 F  S PSD=$O(^TMP("PSD",$J,PSD)) Q:PSD']""  F  S PSDU=$O(^TMP("PSD",$J,PSD,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSD,PSDU,0)) D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDOPTI",38,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  D:$O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))=PSDU(1))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0)))  Q:PSDOUT
"RTN","PSDOPTI",39,0)
 ..S PSDR(3)=+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0))
"RTN","PSDOPTI",40,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDR(3),0))
"RTN","PSDOPTI",41,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDR(3),6))
"RTN","PSDOPTI",42,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTI",43,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU,?60,PSD,!
"RTN","PSDOPTI",44,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,?19
"RTN","PSDOPTI",45,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTI",46,0)
 ..N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTI",47,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTI",48,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTI",49,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTI",50,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTI",51,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTI",52,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTI",53,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTI",54,0)
 ..W !,LN,!
"RTN","PSDOPTI",55,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTI",56,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTI",57,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTI",58,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTI",59,0)
 Q
"RTN","PSDOPTI",60,0)
HEADER ;prints header info
"RTN","PSDOPTI",61,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTI",62,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTI",63,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOPTI",64,0)
 Q
"RTN","PSDOPTI",65,0)
SAVE ;save queued variables
"RTN","PSDOPTI",66,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTI",67,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("),ZTSAVE("PSDLOC"))=""
"RTN","PSDOPTI",68,0)
 Q
"RTN","PSDOPTN")
0^142^B17545688
"RTN","PSDOPTN",1,0)
PSDOPTN ;BIR/LTL-Review OP Transactions for a Drug (cont.) ; 24 Jan 95
"RTN","PSDOPTN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTN",3,0)
 S DIR(0)="DA^2910501::AEPT"
"RTN","PSDOPTN",4,0)
 S DIR("A")="Beginning date@time filled (not posted): ",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range.  Please don't enter a date@time in the future" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTN",5,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0)
"RTN","PSDOPTN",6,0)
 S DIR(0)="DA^"_PSDT_"::AET"
"RTN","PSDOPTN",7,0)
 S DIR("A")="Ending date@time filled (not posted): "
"RTN","PSDOPTN",8,0)
 S DIR("?")=$G(DIR("?"))_" or before "_$G(PSDTB(2))
"RTN","PSDOPTN",9,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTN",10,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTN",11,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTN",12,0)
DEV ;device
"RTN","PSDOPTN",13,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTN",14,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTN",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTN",15,0)
START ;compiles
"RTN","PSDOPTN",16,0)
 N PSDR,PG S (PG,PSDOUT)=0 K LN D HEADER S PSDT=PSDT-1
"RTN","PSDOPTN",17,0)
 ;loop thru Prescription file by date filled
"RTN","PSDOPTN",18,0)
 F  S PSDT=$O(^PSRX("AD",PSDT)) Q:'PSDT!(PSDT>PSDTB(1))  W:$E(IOST)="C" "." S PSDT(1)=0 D
"RTN","PSDOPTN",19,0)
 .F  S PSDT(1)=$O(^PSRX("AD",PSDT,PSDT(1))) Q:'PSDT(1)  D
"RTN","PSDOPTN",20,0)
 ..S PSDT(5)=$G(^PSRX(PSDT(1),0))
"RTN","PSDOPTN",21,0)
 ..S PSDT(2)=$P($G(^PSDRUG(+$P(PSDT(5),U,6),0)),U) Q:PSDT(2)']""
"RTN","PSDOPTN",22,0)
 ..Q:'$D(^TMP("PSD",$J,PSDT(2)))  S PSDT(4)=""
"RTN","PSDOPTN",23,0)
 ..F  S PSDT(4)=$O(^PSRX("AD",PSDT,PSDT(1),PSDT(4))) Q:PSDT(4)=""  D
"RTN","PSDOPTN",24,0)
 ...;Returned to stock?
"RTN","PSDOPTN",25,0)
 ...Q:$S('PSDT(4):$P($G(^PSRX(PSDT(1),2)),U,15),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,16))
"RTN","PSDOPTN",26,0)
 ...;posted to the vault?
"RTN","PSDOPTN",27,0)
 ...S PSDT(3)=0
"RTN","PSDOPTN",28,0)
 ...F  S PSDT(3)=$O(^PSD(58.81,"AOP",PSDT(1),PSDT(3))) Q:'PSDT(3)!($S('PSDT(4)&('$P($G(^PSD(58.81,+PSDT(3),6)),U,2)):1,PSDT(4)=$P($G(^(6)),U,2):1,1:0))
"RTN","PSDOPTN",29,0)
 ...Q:PSDT(3)
"RTN","PSDOPTN",30,0)
 ...;suspended & printed
"RTN","PSDOPTN",31,0)
 ...S (PSDT(3),PSDT(8))=0
"RTN","PSDOPTN",32,0)
 ...I PSDT>DT D  Q:'PSDT(8)
"RTN","PSDOPTN",33,0)
 ....F  S PSDT(3)=$O(^PSRX(PSDT(1),"L",PSDT(3))) Q:'PSDT(3)  S:$P($G(^PSRX(PSDT(1),"L",PSDT(3),0)),U,2)=PSDT(4) PSDT(8)=1
"RTN","PSDOPTN",34,0)
 ...;quantity
"RTN","PSDOPTN",35,0)
 ...S PSDT(6)=$S('PSDT(4):$P(PSDT(5),U,7),1:$P($G(^PSRX(PSDT(1),1,PSDT(4),0)),U,4))
"RTN","PSDOPTN",36,0)
 ...S DFN=$P(PSDT(5),U,2) N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTN",37,0)
 ...S PSDT(7)=Y D PID^VADPT6 S PSDT(7)=PSDT(7)_" ("_VA("BID")_")"
"RTN","PSDOPTN",38,0)
 ...S:$P(PSDT(5),U)]"" ^TMP("PSDO",$J,PSDT(2),$P(PSDT(5),U),PSDT(4))=PSDT(6)_U_PSDT_U_PSDT(7)
"RTN","PSDOPTN",39,0)
 I '$D(^TMP("PSDO",$J)) W !!,"Nothing to Report.",!! G END
"RTN","PSDOPTN",40,0)
 F  S PSDT=$O(^TMP("PSDO",$J,PSDT)) Q:PSDT']""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",41,0)
 .D:$Y+5>IOSL HEADER Q:PSDOUT  W !!,"Drug =>  ",PSDT  S PSDT(1)=0
"RTN","PSDOPTN",42,0)
 .F  S PSDT(1)=$O(^TMP("PSDO",$J,PSDT,PSDT(1))) Q:'PSDT(1)!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",43,0)
 ..S PSDT(2)=""
"RTN","PSDOPTN",44,0)
 ..F  S PSDT(2)=$O(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2))) Q:PSDT(2)=""!PSDOUT  D  Q:PSDOUT
"RTN","PSDOPTN",45,0)
 ...I $Y+4>IOSL D HEADER Q:PSDOUT  W !!,PSDT," (continued)"
"RTN","PSDOPTN",46,0)
 ...W !!,PSDT(1)," (",PSDT(2),")"
"RTN","PSDOPTN",47,0)
 ...S PSDT(3)=$G(^TMP("PSDO",$J,PSDT,PSDT(1),PSDT(2)))
"RTN","PSDOPTN",48,0)
 ...W ?9,$J($P(PSDT(3),U),4) S Y=$P(PSDT(3),U,2) X ^DD("DD") W ?20,Y
"RTN","PSDOPTN",49,0)
 ...W ?40,$P(PSDT(3),U,3)
"RTN","PSDOPTN",50,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTN",51,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." W ! D ^DIR
"RTN","PSDOPTN",52,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTN",53,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSDO",$J)
"RTN","PSDOPTN",54,0)
 Q
"RTN","PSDOPTN",55,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTN",56,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTN",57,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Rx#",?10,"QTY",?20,"Fill Date",?40,"Patient",!,LN
"RTN","PSDOPTN",58,0)
 Q
"RTN","PSDOPTN",59,0)
SAVE ;
"RTN","PSDOPTN",60,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTN",61,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDLOC"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("))=""
"RTN","PSDOPTN",62,0)
 Q
"RTN","PSDOPTR")
0^143^B2802824
"RTN","PSDOPTR",1,0)
PSDOPTR ;BIR/LTL-Review OP Transactions for a Drug ; 29 Aug 94
"RTN","PSDOPTR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTR",3,0)
 N PSDOUT I '$D(PSDSITE) D ^PSDSET I '$D(PSDSITE) S PSDOUT=1 G END
"RTN","PSDOPTR",4,0)
 N C,CNT,DFN,DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDEV,PSDI,PSDR,PSDU,PSDLOC,PSDLOCN,PSDT,PSDTB,X,Y S PSDOUT=1,PSDU=0
"RTN","PSDOPTR",5,0)
 D DT^DICRW
"RTN","PSDOPTR",6,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDOPTR",7,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDOPTR",8,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDOPTR",9,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))"
"RTN","PSDOPTR",10,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDOPTR",11,0)
 W ! D ^DIC K DIC G:Y<0 END S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDOPTR",12,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDOPTR",13,0)
CHKD K ^TMP("PSD",$J)
"RTN","PSDOPTR",14,0)
 S DIR(0)="S^1:Sort by Drug;2:Sort by Rx #;3:Sort by Inventory Type"
"RTN","PSDOPTR",15,0)
 S DIR("A")="Sort by",DIR("B")=1
"RTN","PSDOPTR",16,0)
 S DIR("?")="Please select the sort that sounds most promising."
"RTN","PSDOPTR",17,0)
 D ^DIR K DIR G:$D(DIRUT) END G:Y=2 ^PSDOPTX G:Y=3 ^PSDOPTI
"RTN","PSDOPTR",18,0)
 G ^PSDOPTS Q
"RTN","PSDOPTR",19,0)
END Q
"RTN","PSDOPTS")
0^144^B23312561
"RTN","PSDOPTS",1,0)
PSDOPTS ;BIR/LTL-Review OP Transactions for a Drug (cont.) ; 29 Aug 94
"RTN","PSDOPTS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTS",3,0)
 S CNT=0 W !!,"You may select one, several, or ^ALL drugs."
"RTN","PSDOPTS",4,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEQ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  D
"RTN","PSDOPTS",5,0)
 .I '$O(^PSD(58.81,"F",+Y,0)) W !!,"There have been no transactions for this drug.",!! Q
"RTN","PSDOPTS",6,0)
 .S PSD=$P($G(^PSDRUG(+Y,0)),U),CNT=CNT+1
"RTN","PSDOPTS",7,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_+Y)
"RTN","PSDOPTS",8,0)
 .S ^TMP("PSD",$J,PSD,+Y)="" K PSD
"RTN","PSDOPTS",9,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  D
"RTN","PSDOPTS",10,0)
 .Q:'$O(^PSD(58.81,"F",PSDU,0))
"RTN","PSDOPTS",11,0)
 .S PSD=$P($G(^PSDRUG(PSDU,0)),U)
"RTN","PSDOPTS",12,0)
 .S PSD=$S(PSD]"":PSD,1:"UNKNOWN DRUG #"_PSDU)
"RTN","PSDOPTS",13,0)
 .S ^TMP("PSD",$J,PSD,PSDU)="" K PSD
"RTN","PSDOPTS",14,0)
 S DIR(0)="S^1:Sort by Rx #;2:Sort by Date Posted;3:Sort by Date Filled (Not Posted)"
"RTN","PSDOPTS",15,0)
 S DIR("A")="Within Drug, Sort by",DIR("B")=1
"RTN","PSDOPTS",16,0)
 S DIR("?")="For each drug, do you want the transactions listed in the order they were posted, by Rx #, or by fill date (not posted)?"
"RTN","PSDOPTS",17,0)
 D ^DIR K DIR G:$D(DIRUT) END G:Y=1 ^PSDOPTX G:Y=3 ^PSDOPTN
"RTN","PSDOPTS",18,0)
 S DIR(0)="DA^2910501:NOW:AEPT"
"RTN","PSDOPTS",19,0)
 S DIR("A")="Beginning date@time posted: ",DIR("?")="I will list Outpatient transactions for your selected drug(s) within your selected date@time range.  Please don't enter a date@time in the future" W ! D ^DIR G:Y<1 END
"RTN","PSDOPTS",20,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0)
"RTN","PSDOPTS",21,0)
 S DIR(0)="DA^"_PSDT_":NOW:AET"
"RTN","PSDOPTS",22,0)
 S DIR("A")="Ending date@time posted: "
"RTN","PSDOPTS",23,0)
 S DIR("?")=$G(DIR("?"))_" or before "_$G(PSDTB(2))
"RTN","PSDOPTS",24,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDOPTS",25,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDOPTS",26,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTS",27,0)
DEV ;device
"RTN","PSDOPTS",28,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTS",29,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTS",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTS",30,0)
START ;compiles
"RTN","PSDOPTS",31,0)
 N PSDR,PG S (PG,PSDOUT)=0 K LN D HEADER S PSDU=0
"RTN","PSDOPTS",32,0)
 F  S PSDU=$O(^TMP("PSD",$J,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSDU,0)) D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDOPTS",33,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  D:$O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))=PSDU(1))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0)))  Q:PSDOUT
"RTN","PSDOPTS",34,0)
 ..S PSDR(3)=+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,+PSDU(1),6,0))
"RTN","PSDOPTS",35,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDR(3),0))
"RTN","PSDOPTS",36,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDR(3),6))
"RTN","PSDOPTS",37,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTS",38,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU
"RTN","PSDOPTS",39,0)
 ..W:$P(PSDR(4),U,6)&($P(PSDR(2),U,7)'=$P(PSDR(4),U,6)) ?54,"RPH=> ",$E($P($G(^VA(200,+$P(PSDR(4),U,6),0)),U),1,20)
"RTN","PSDOPTS",40,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !!,Y,?19
"RTN","PSDOPTS",41,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTS",42,0)
 ..N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTS",43,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTS",44,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTS",45,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTS",46,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTS",47,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTS",48,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTS",49,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTS",50,0)
 ..W !,LN,!
"RTN","PSDOPTS",51,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTS",52,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTS",53,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTS",54,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTS",55,0)
 Q
"RTN","PSDOPTS",56,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTS",57,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTS",58,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOPTS",59,0)
 Q
"RTN","PSDOPTS",60,0)
SAVE ;
"RTN","PSDOPTS",61,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTS",62,0)
 S (ZTSAVE("PSDT"),ZTSAVE("PSDLOC"),ZTSAVE("PSDTB"),ZTSAVE("PSDTB("))=""
"RTN","PSDOPTS",63,0)
 Q
"RTN","PSDOPTX")
0^145^B15455667
"RTN","PSDOPTX",1,0)
PSDOPTX ;BIR/LTL-Review OP Transactions by Rx # ; 29 Aug 94
"RTN","PSDOPTX",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTX",3,0)
 N C,PSDRX
"RTN","PSDOPTX",4,0)
BRX S DIC="^PSRX(",DIC(0)="AEQ",DIC("A")="Please select beginning Rx #: "
"RTN","PSDOPTX",5,0)
 W ! D ^DIC G:Y<1 END S (PSDRX,PSDRX(4))=+Y,PSDRX(1)=$P(Y,U,2)
"RTN","PSDOPTX",6,0)
 I '$O(^PSD(58.81,"AOP",+Y,0))&('$O(^PSD(58.81,"AOP",+Y))) W !!,"No transactions beginning from Rx # ",PSDRX(1),"." G BRX
"RTN","PSDOPTX",7,0)
ERX S DIC("A")="Please select ending Rx #: "
"RTN","PSDOPTX",8,0)
 S DIC("B")=$P($G(^PSRX(+$P($G(^PSRX(0)),U,3),0)),U)
"RTN","PSDOPTX",9,0)
 W ! D ^DIC G:Y<1 END S PSDRX(2)=+Y,PSDRX(3)=$P(Y,U,2)
"RTN","PSDOPTX",10,0)
 I PSDRX(2)<PSDRX W !!,"Ending Rx # must have been created after Rx # ",PSDRX(1),"." G ERX
"RTN","PSDOPTX",11,0)
 K DIC
"RTN","PSDOPTX",12,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDOPTX",13,0)
DEV ;asks device and queueing info
"RTN","PSDOPTX",14,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDOPTX",15,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDOPTX",ZTDESC="Drug OP transaction review" D SAVE D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDOPTX",16,0)
START ;compiles and prints output
"RTN","PSDOPTX",17,0)
 N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER S PSDU=0
"RTN","PSDOPTX",18,0)
 G:$G(PSDI) ^PSDOPTZ
"RTN","PSDOPTX",19,0)
 G:$O(^TMP("PSD",$J,PSDU))']"" ^PSDOPTY
"RTN","PSDOPTX",20,0)
 S PSDRX=PSDRX-1
"RTN","PSDOPTX",21,0)
 F  S PSDU=$O(^TMP("PSD",$J,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSDU,0)) D  G:PSDOUT END S PSDRX=PSDRX(4)-1,PSDT(1)=0
"RTN","PSDOPTX",22,0)
LOOP .F  S PSDRX=$O(^PSD(58.81,"AOP",PSDRX)) W:$E(IOST)="C" "." Q:'PSDRX!(PSDRX>PSDRX(2))  S PSDRX(5)=0 F  S PSDRX(5)=$O(^PSD(58.81,"AOP",PSDRX,PSDRX(5))) Q:'PSDRX(5)  D  Q:PSDOUT
"RTN","PSDOPTX",23,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDRX(5),0))
"RTN","PSDOPTX",24,0)
 ..Q:$P(PSDR(2),U,3)'=PSDLOC!($P(PSDR(2),U,5)'=PSDU(1))
"RTN","PSDOPTX",25,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDRX(5),6))
"RTN","PSDOPTX",26,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTX",27,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU
"RTN","PSDOPTX",28,0)
 ..W:$P(PSDR(4),U,6)&($P(PSDR(2),U,7)'=$P(PSDR(4),U,6)) ?54,"RPH=> ",$E($P($G(^VA(200,+$P(PSDR(4),U,6),0)),U),1,20)
"RTN","PSDOPTX",29,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !!,Y,?19
"RTN","PSDOPTX",30,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTX",31,0)
 ..K C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTX",32,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTX",33,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTX",34,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTX",35,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTX",36,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTX",37,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTX",38,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTX",39,0)
 ..W !,LN,!
"RTN","PSDOPTX",40,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTX",41,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTX",42,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTX",43,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTX",44,0)
 Q
"RTN","PSDOPTX",45,0)
HEADER ;prints header info
"RTN","PSDOPTX",46,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTX",47,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTX",48,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from Rx # ",PSDRX(1)," to Rx # ",PSDRX(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOPTX",49,0)
 Q
"RTN","PSDOPTX",50,0)
SAVE ;save queued variables
"RTN","PSDOPTX",51,0)
 S ZTSAVE("^TMP(""PSD"",$J,")=""
"RTN","PSDOPTX",52,0)
 S (ZTSAVE("PSDLOC"),ZTSAVE("PSDRX"),ZTSAVE("PSDRX("))=""
"RTN","PSDOPTX",53,0)
 Q
"RTN","PSDOPTY")
0^146^B7975847
"RTN","PSDOPTY",1,0)
PSDOPTY ;BIR/LTL-Review OP Transactions by Rx # ; 21 July 94
"RTN","PSDOPTY",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTY",3,0)
 S PSDRX=PSDRX(4)-1,PSDT(1)=0
"RTN","PSDOPTY",4,0)
LOOP F  S PSDRX=$O(^PSD(58.81,"AOP",PSDRX)) W:$E(IOST)="C" "." Q:'PSDRX!(PSDRX>PSDRX(2))!(PSDOUT)  S PSDRX(5)=0 F  S PSDRX(5)=$O(^PSD(58.81,"AOP",PSDRX,PSDRX(5))) Q:'PSDRX(5)  D  Q:PSDOUT
"RTN","PSDOPTY",5,0)
 .S PSDR(2)=$G(^PSD(58.81,PSDRX(5),0))
"RTN","PSDOPTY",6,0)
 .Q:$P(PSDR(2),U,3)'=PSDLOC
"RTN","PSDOPTY",7,0)
 .S PSDU=$P($G(^PSDRUG(+$P(PSDR(2),U,5),0)),U)
"RTN","PSDOPTY",8,0)
 .S PSDR(4)=$G(^PSD(58.81,PSDRX(5),6))
"RTN","PSDOPTY",9,0)
 .D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTY",10,0)
 .W !,PSDU
"RTN","PSDOPTY",11,0)
 .W:$P(PSDR(4),U,6)&($P(PSDR(2),U,7)'=$P(PSDR(4),U,6)) ?54,"RPH=> ",$E($P($G(^VA(200,+$P(PSDR(4),U,6),0)),U),1,20)
"RTN","PSDOPTY",12,0)
 .S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !!,Y,?19
"RTN","PSDOPTY",13,0)
 .S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTY",14,0)
 .N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTY",15,0)
 .W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTY",16,0)
 .D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTY",17,0)
 .I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTY",18,0)
 .I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTY",19,0)
 .I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTY",20,0)
 .W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTY",21,0)
 .W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTY",22,0)
 .W !,LN,!
"RTN","PSDOPTY",23,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTY",24,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTY",25,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTY",26,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTY",27,0)
 Q
"RTN","PSDOPTY",28,0)
HEADER ;prints header info
"RTN","PSDOPTY",29,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTY",30,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTY",31,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from Rx # ",PSDRX(1)," to Rx # ",PSDRX(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN
"RTN","PSDOPTZ")
0^147^B9200202
"RTN","PSDOPTZ",1,0)
PSDOPTZ ;BIR/LTL-Review OP Transactions by Rx # ; 29 Aug 94
"RTN","PSDOPTZ",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOPTZ",3,0)
 S PSDRX=PSDRX(4)-1,(PSD,PSDU)=0
"RTN","PSDOPTZ",4,0)
 F  S PSD=$O(^TMP("PSD",$J,PSD)) Q:PSD']""  F  S PSDU=$O(^TMP("PSD",$J,PSD,PSDU)) Q:PSDU']""  S PSDU(1)=$O(^TMP("PSD",$J,PSD,PSDU,0)) D  G:PSDOUT END S PSDRX=PSDRX(4)-1,PSDT(1)=0
"RTN","PSDOPTZ",5,0)
LOOP .F  S PSDRX=$O(^PSD(58.81,"AOP",PSDRX)) W:$E(IOST)="C" "." Q:'PSDRX!(PSDRX>PSDRX(2))  S PSDRX(5)=0 F  S PSDRX(5)=$O(^PSD(58.81,"AOP",PSDRX,PSDRX(5))) Q:'PSDRX(5)  D  Q:PSDOUT
"RTN","PSDOPTZ",6,0)
 ..S PSDR(2)=$G(^PSD(58.81,PSDRX(5),0))
"RTN","PSDOPTZ",7,0)
 ..Q:$P(PSDR(2),U,3)'=PSDLOC!($P(PSDR(2),U,5)'=PSDU(1))
"RTN","PSDOPTZ",8,0)
 ..S PSDR(4)=$G(^PSD(58.81,PSDRX(5),6))
"RTN","PSDOPTZ",9,0)
 ..D:$Y+6>IOSL HEADER Q:PSDOUT
"RTN","PSDOPTZ",10,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU,?60,PSD,!
"RTN","PSDOPTZ",11,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,?19
"RTN","PSDOPTZ",12,0)
 ..S DFN=$P($G(^PSRX(+$P(PSDR(4),U),0)),U,2)
"RTN","PSDOPTZ",13,0)
 ..N C S Y=DFN,C=$P(^DD(58.81,73,0),U,2) D Y^DIQ
"RTN","PSDOPTZ",14,0)
 ..W $P(PSDR(4),U,5),?28,Y
"RTN","PSDOPTZ",15,0)
 ..D PID^VADPT6 W " ("_VA("BID")_")",?60
"RTN","PSDOPTZ",16,0)
 ..I $P(PSDR(4),U,2) S Y=$P($G(^PSRX(+$P(PSDR(4),U),1,+$P(PSDR(4),U,2),0)),U,18) X ^DD("DD") W Y
"RTN","PSDOPTZ",17,0)
 ..I $P(PSDR(4),U,4) S Y=$P($G(^PSRX(+$P(PSDR(4),U),"P",+$P(PSDR(4),U,4),0)),U,19) X ^DD("DD") W Y
"RTN","PSDOPTZ",18,0)
 ..I '$P(PSDR(4),U,2)&('$P(PSDR(4),U,4)) S Y=$P($G(^PSRX(+$P(PSDR(4),U),2)),U,13) X ^DD("DD") W Y
"RTN","PSDOPTZ",19,0)
 ..W !,"Qty: ",$P(PSDR(2),U,6),"  Bal: ",$P(PSDR(2),U,10)-$P(PSDR(2),U,6),?22,"RPH=> ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),?60
"RTN","PSDOPTZ",20,0)
 ..W $S($P(PSDR(4),U,2):"Refill #"_$P(PSDR(4),U,2),$P(PSDR(4),U,4):"Partial #"_$P(PSDR(4),U,4),1:"Original")
"RTN","PSDOPTZ",21,0)
 ..W !,LN,!
"RTN","PSDOPTZ",22,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDOPTZ",23,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDOPTZ",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDOPTZ",25,0)
 D KVAR^VADPT K IO("Q"),VA("PID"),VA("BID"),^TMP("PSD",$J)
"RTN","PSDOPTZ",26,0)
 Q
"RTN","PSDOPTZ",27,0)
HEADER ;prints header info
"RTN","PSDOPTZ",28,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDOPTZ",29,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDOPTZ",30,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"Outpatient Activity from Rx # ",PSDRX(1)," to Rx # ",PSDRX(3),?70,"PAGE: ",PG,!,LN,!,"Date Posted",?19,"Rx#",?28,"Patient",?60,"Date Released",!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDOR2")
0^148^B10866213
"RTN","PSDOR2",1,0)
PSDOR2 ;BIR/LTL-Reg 2 Nurse CS Order Request Entry ; 2 Aug 94
"RTN","PSDOR2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOR2",3,0)
QTY K ORD S (CNT,PSDOUT,PSDR(2))=0
"RTN","PSDOR2",4,0)
 S DIR(0)="DA^NOW::AEFT",DIR("A")="Date/time required: "
"RTN","PSDOR2",5,0)
 S DIR("?",1)="You are on the verge of creating an unscheduled order."
"RTN","PSDOR2",6,0)
 S DIR("?",2)="If this is a mistake, enter ""^"" to create a scheduled order, otherwise,"
"RTN","PSDOR2",7,0)
 S DIR("?")="Pharmacy needs to know how soon you need this order."
"RTN","PSDOR2",8,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END X ^DD("DD") S PSDT(9)=Y
"RTN","PSDOR2",9,0)
 ;Dispensing Site's Maximum Quantity per Order
"RTN","PSDOR2",10,0)
 S PSDR(1)=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),U,7)
"RTN","PSDOR2",11,0)
 ;Ask Quantity
"RTN","PSDOR2",12,0)
 S DIR(0)="NA^1:"_$S(PSDR(1):PSDR(1),1:999999)_":0"
"RTN","PSDOR2",13,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDOR2",14,0)
 W:$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),U,3) !,"Stock Level:  ",$P($G(^(0)),U,3)," ",NBKU,!
"RTN","PSDOR2",15,0)
 S:PSDR(1) DIR("A",1)="Maximum quantity per order:  "_PSDR(1)_" "_NBKU,DIR("A",2)=""
"RTN","PSDOR2",16,0)
 S DIR("?",1)="Because "_NAOUN_" is keeping a perpetual inventory,"
"RTN","PSDOR2",17,0)
 S DIR("?",2)="Pharmacy Service has set "_$S(PSDR(1):"a maximum quantity of "_PSDR(1)_" "_NBKU_" per order",1:"no maximum order quantity")
"RTN","PSDOR2",18,0)
 S DIR("?")="for "_PSDRN_"."
"RTN","PSDOR2",19,0)
 D ^DIR K DIR G:Y<1 END S PSDQTY=Y
"RTN","PSDOR2",20,0)
 ;Quantity ordered is equal to or less than max ord qty
"RTN","PSDOR2",21,0)
NOMAX I '(Y#NPKG)&('PSDR(1)!(Y'>PSDR(1))) D DIE,ASK^PSDORN1 G:PSDOUT END K PSDEM G DRUG^PSDORN
"RTN","PSDOR2",22,0)
 ;Quantity ordered is not divisible by package size
"RTN","PSDOR2",23,0)
 D:(Y#NPKG)  G:$D(DIRUT) END G:Y<1 QTY I 'PSDR(1)!(Y>PSDR(1)) S Y=PSDQTY G QTY
"RTN","PSDOR2",24,0)
 .S PSDQTY=Y-(Y#NPKG)
"RTN","PSDOR2",25,0)
 .S DIR(0)="S^"_PSDQTY_":"_NBKU_";"_(PSDQTY+NPKG)_":"_NBKU_";*:New Quantity"
"RTN","PSDOR2",26,0)
 .S DIR("A",1)="Please order "_PSDRN,DIR("A",3)=""
"RTN","PSDOR2",27,0)
 .S DIR("A",2)="in multiples of "_NPKG_" "_NBKU_".",DIR("B")=PSDQTY
"RTN","PSDOR2",28,0)
 .S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_")"
"RTN","PSDOR2",29,0)
 .S DIR("?")="Enter an adjusted quantity or * to enter a new quantity" D ^DIR K DIR Q:Y<1  S PSDQTY=Y
"RTN","PSDOR2",30,0)
 D DIE,ASK^PSDORN1 G:PSDOUT END K PSDEM G DRUG^PSDORN
"RTN","PSDOR2",31,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDOR2",32,0)
 K NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDT,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDOR2",33,0)
 Q
"RTN","PSDOR2",34,0)
DIE ;create the order request
"RTN","PSDOR2",35,0)
 S:$G(ORD)<2 PSDEM=1
"RTN","PSDOR2",36,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDOR2",37,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDOR2",38,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDOR2",39,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDOR2",40,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////1;5////"_PSDQTY_";24////"_$G(PSDEM)_";13" D ^DIE K DIE,DR
"RTN","PSDOR2",41,0)
 Q
"RTN","PSDOR21")
0^149^B14070880
"RTN","PSDOR21",1,0)
PSDOR21 ;BIR/JPW,LTL-Reg 2 Nurse CS Order Entry (cont'd) ; 2 Aug 94
"RTN","PSDOR21",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDOR21",3,0)
 ;Multiple orders
"RTN","PSDOR21",4,0)
 I $D(ORD) F CNT1=1:1:CNT S PSDA=+ORD(CNT1) S:$G(PSDR(2))&(CNT1=1) PSDQTY=PSDR(2) D ASK
"RTN","PSDOR21",5,0)
 Q
"RTN","PSDOR21",6,0)
ASK ;displays order for review
"RTN","PSDOR21",7,0)
 D DISPLAY
"RTN","PSDOR21",8,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDOR21",9,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDOR21",10,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDOR21",11,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDOR21",12,0)
 I Y D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT W ?32,"Sent to Pharmacy...",!! R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDOR21",13,0)
 Q
"RTN","PSDOR21",14,0)
DISPLAY ;displays order request to screen
"RTN","PSDOR21",15,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDOR21",16,0)
 W @IOF,!,?23,"Controlled Substance Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDOR21",17,0)
 W !!,"Pharmacy Dispensing #: ",!,"Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^"),?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDOR21",18,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDOR21",19,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDOR21",20,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDOR21",21,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDOR21",22,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDOR21",23,0)
 I  D ^DIWW
"RTN","PSDOR21",24,0)
 Q
"RTN","PSDOR21",25,0)
EDIT ;edit or delete order request
"RTN","PSDOR21",26,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDOR21",27,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDOR21",28,0)
 I "Dd"[X D DEL Q
"RTN","PSDOR21",29,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="13" D ^DIE K DIE,DR
"RTN","PSDOR21",30,0)
 Q
"RTN","PSDOR21",31,0)
DEL ;deletes order request
"RTN","PSDOR21",32,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDOR21",33,0)
 Q
"RTN","PSDOR21",34,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDOR21",35,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDOR21",36,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDOR21",37,0)
 K DA,DIC,DIE,DLAYGO,DR S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDOR21",38,0)
 L -^PSD(58.85,0)
"RTN","PSDOR21",39,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDOR21",40,0)
 S DA=PSDREC,DR="1////"_+PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZ_";19////"_PSDRD D ^DIE K DIE
"RTN","PSDOR21",41,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDOR21",42,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDOR21",43,0)
 K DA,DIC,DIE,DLAYGO,DR,PSDREC,WORD S PSDQTY=PSDR(1)
"RTN","PSDOR21",44,0)
 Q
"RTN","PSDORD")
0^150^B20585761
"RTN","PSDORD",1,0)
PSDORD ;BIR/JPW,LTL-Nurse CS Order Request Entry DIR style; 8 Aug 94
"RTN","PSDORD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORD",3,0)
 ;Any requests not ordered?
"RTN","PSDORD",4,0)
 K PSD,PSDA,PSDB S PSD=0
"RTN","PSDORD",5,0)
 W !,"Searching for ",$P($G(^VA(200,DUZ,.1)),U,4),"'s pending requests."
"RTN","PSDORD",6,0)
 F  S PSD=$O(^PSD(58.8,"AC",.5,+NAOU,PSD)) Q:'PSD  D
"RTN","PSDORD",7,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,"AC",.5,+NAOU,PSD,PSD(1))) Q:'PSD(1)  W "." S:$P($G(^PSD(58.8,+NAOU,1,+PSD,3,PSD(1),0)),U,4)=DUZ PSDA(PSD,PSD(1))=$G(^(0))
"RTN","PSDORD",8,0)
 I $O(PSDA(0)) D ^PSDORD1 G:$G(PSDOUT) END
"RTN","PSDORD",9,0)
 W:'$O(PSDA(0)) "  No pending requests.",!
"RTN","PSDORD",10,0)
DRUG ;select drug
"RTN","PSDORD",11,0)
 K DA,DIC,PSDR S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" W $S('$G(^PSD(58.8,NAOU,1,Y,0)):"" NOT STOCKED BY ""_NAOUN,$P(^(0),U,14)&($P(^(0),U,14)'>DT):"" INACTIVE on ""_NAOUN,1:"""")"
"RTN","PSDORD",12,0)
 S DIC("S")="I '$P($G(^(7)),U,2),$S('$P(^(0),""^"",14):1,+$P(^(0),""^"",14)>DT:1,1:0)"
"RTN","PSDORD",13,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_+PSDS_",1,"
"RTN","PSDORD",14,0)
 ;one time requests not allowed by dispensing site
"RTN","PSDORD",15,0)
 D:'$P($G(^PSD(58.8,+PSDS,0)),U,13)
"RTN","PSDORD",16,0)
 .S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""  N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),U,14)]"""",$P(^(0),U,14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORD",17,0)
 .S DIC("S")="I $S('$P(^(0),U,14):1,+$P(^(0),U,14)>DT:1,1:0)"
"RTN","PSDORD",18,0)
 .S DA(1)=+NAOU,DIC="^PSD(58.8,"_NAOU_",1,"
"RTN","PSDORD",19,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END G:Y<1&($O(PSDA(0))) ^PSDORD1 G:Y<1 END S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORD",20,0)
 I $S('$D(^PSD(58.8,NAOU,1,PSDR,0)):1,$P(^(0),U,14)&($P(^(0),U,14)'>DT):1,1:0) D ^PSDORD4 G:$D(DIRUT) END G DRUG
"RTN","PSDORD",21,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,0)) D MSG G END
"RTN","PSDORD",22,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORD",23,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORD",24,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORD",25,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORD",26,0)
 D LIST^PSDORL
"RTN","PSDORD",27,0)
 ;Perpetual?
"RTN","PSDORD",28,0)
 G:$P($G(^PSD(58.8,+NAOU,2)),U,5) ^PSDORD3
"RTN","PSDORD",29,0)
QTY K ORD S PSDOUT=0 S DIR(0)="58.800118,5A"
"RTN","PSDORD",30,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDORD",31,0)
 D ^DIR K DIR G:$D(DIRUT) END G:Y<1 DRUG
"RTN","PSDORD",32,0)
 I Y=NPKG S PSDQTY=Y D DIE W ! G DRUG
"RTN","PSDORD",33,0)
 I X["?"!(X'?1.N)!(X#NPKG)!('X) W !!,"Quantity must be "_NPKG_" or a multiple of "_NPKG,! G QTY
"RTN","PSDORD",34,0)
 S CNT=X/NPKG W !!,"This will be "_CNT_" separate order requests.  The quantity is "_NPKG_" per request."
"RTN","PSDORD",35,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORD",36,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORD",37,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORD",38,0)
 I Y W !!,"The "_CNT_" requests are being created.",! S PSDQTY=NPKG D  W ! G DRUG
"RTN","PSDORD",39,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE S PSDA(+PSDR,PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,+PSDA,0))
"RTN","PSDORD",40,0)
 I '$G(PSDOUT) W ! G DRUG
"RTN","PSDORD",41,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORD",42,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSD,PSDA,PSDB,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORD",43,0)
 Q
"RTN","PSDORD",44,0)
DIE ;create the order request
"RTN","PSDORD",45,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORD",46,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORD",47,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORD",48,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORD",49,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////.5;5////"_PSDQTY_";13" D ^DIE K DIE,DR
"RTN","PSDORD",50,0)
 S PSDA(+PSDR,+PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,PSDA,0))
"RTN","PSDORD",51,0)
 Q
"RTN","PSDORD",52,0)
MSG ;display error message
"RTN","PSDORD",53,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORD",54,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORD",55,0)
 Q
"RTN","PSDORD1")
0^151^B7811612
"RTN","PSDORD1",1,0)
PSDORD1 ;BIR/LTL-CS Order Entry Listing and Cancel pending; 19 Dec 94
"RTN","PSDORD1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORD1",3,0)
 D PRT S PSDC="D" F PSD=1:1:$G(PSD(2)) S PSDD=$G(PSDD)_PSD_","
"RTN","PSDORD1",4,0)
 G:$G(PSDOUT) SKIP2
"RTN","PSDORD1",5,0)
AC S DIR(0)="SA^A:Approve;D:Delete"
"RTN","PSDORD1",6,0)
 S DIR("A")="Approve or Delete (A/D): "
"RTN","PSDORD1",7,0)
 S DIR("?")="After selecting an action, you may select a range of orders."
"RTN","PSDORD1",8,0)
 S DIR("B")="Approve" D ^DIR K DIR N PSDC S PSDC=Y
"RTN","PSDORD1",9,0)
 G:$D(DIRUT) SKIP2
"RTN","PSDORD1",10,0)
 I $G(PSD(2))=1 S PSDD="1," G SKIP
"RTN","PSDORD1",11,0)
 S DIR(0)="L^1:"_$G(PSD(2)) W ! D ^DIR K DIR I $D(DIRUT) S PSDC="D" G SKIP2
"RTN","PSDORD1",12,0)
 S PSDD=Y
"RTN","PSDORD1",13,0)
SKIP I PSDC="D" S DIR(0)="Y",DIR("B")="No",DIR("A")="Are you sure you want to cancel request(s) #"_$E(PSDD,1,($L(PSDD)-1)) W ! D ^DIR K DIR G:$D(DIRUT) SKIP2 G:'Y AC G SKIP2
"RTN","PSDORD1",14,0)
 N X,X1 D SIG^XUSESIG I X1="" S PSDC="D" G SKIP
"RTN","PSDORD1",15,0)
SKIP2 S PSDD(1)=1 F  S PSDD(2)=$P(PSDD,",",PSDD(1)) Q:'PSDD(2)  S PSDD(1)=PSDD(1)+1 D
"RTN","PSDORD1",16,0)
ORD .;update ord
"RTN","PSDORD1",17,0)
 .S PSDR=+$O(PSDB(PSDD(2),0)),PSDA=+$O(PSDB(PSDD(2),PSDR,0))
"RTN","PSDORD1",18,0)
 .S PSDQTY=$P($G(^PSD(58.8,+NAOU,1,+PSDR,3,+PSDA,0)),U,6)
"RTN","PSDORD1",19,0)
 .I PSDC="A" D NOW^%DTC S PSDT=+$E(%,1,12),DIE="^PSD(58.8,+NAOU,1,+PSDR,3,",DA(2)=NAOU,DA(1)=PSDR,DA=PSDA,DR="1////"_PSDT_";10////1" D ^DIE K DIE,DA,DR D PHARM^PSDORD2 K PSDA(PSDR,PSDA) Q
"RTN","PSDORD1",20,0)
 .D DEL^PSDORD2 K PSDA(PSDR,PSDA) S PSDOUT=0
"RTN","PSDORD1",21,0)
END K DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,PSD,PSDOUT,PSDB,PSDD,X,Y
"RTN","PSDORD1",22,0)
 Q
"RTN","PSDORD1",23,0)
PRT ;displays list
"RTN","PSDORD1",24,0)
 W @IOF,"Accessing pending requests for ",$P($G(^VA(200,DUZ,.1)),U,4),"...",!
"RTN","PSDORD1",25,0)
 K ^UTILITY($J,"W")
"RTN","PSDORD1",26,0)
 N X,DIWL,DIWR,DIWF S PSD=0,DIWL=1,DIWR=80,DIWF="W"
"RTN","PSDORD1",27,0)
 F  S PSD=$O(^PSD(58.8,+PSDS,5,PSD)) Q:'PSD  S X=$G(^PSD(58.8,+PSDS,5,PSD,0)) D ^DIWP
"RTN","PSDORD1",28,0)
 D ^DIWW
"RTN","PSDORD1",29,0)
 W !,"The following request(s) may be approved or deleted:",!
"RTN","PSDORD1",30,0)
 W !,"#  DATE ORDERED",?20,"DRUG",?72,"QUANTITY",!! S PSD=0
"RTN","PSDORD1",31,0)
 F  S PSD=$O(PSDA(PSD)) Q:'PSD!($G(PSDOUT))  S PSD(1)=0 F  S PSD(1)=$O(PSDA(PSD,PSD(1))) Q:'PSD(1)  S PSD(2)=$G(PSD(2))+1,PSDB(PSD(2),PSD,PSD(1))="" D  Q:$G(PSDOUT)
"RTN","PSDORD1",32,0)
 .S Y=$E($P(PSDA(PSD,PSD(1)),U,2),1,7) X ^DD("DD") W !,PSD(2),?3,Y,?16
"RTN","PSDORD1",33,0)
 .W $P($G(^PSDRUG(PSD,0)),U),?72,$J($P(PSDA(PSD,PSD(1)),U,6),4)
"RTN","PSDORD1",34,0)
 .I $Y+2>IOSL S DIR(0)="E" D ^DIR K DIR S:Y<1 PSDOUT=1 W @IOF
"RTN","PSDORD1",35,0)
 Q
"RTN","PSDORD2")
0^152^B14074750
"RTN","PSDORD2",1,0)
PSDORD2 ;BIR/JPW,LTL-Nurse CS Order Entry (cont'd) ; 21 Dec 94
"RTN","PSDORD2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORD2",3,0)
 I $D(ORD) F CNT1=1:1:CNT S PSDA=+ORD(CNT1) D ASK
"RTN","PSDORD2",4,0)
 Q
"RTN","PSDORD2",5,0)
ASK ;displays order for review
"RTN","PSDORD2",6,0)
 D DISPLAY
"RTN","PSDORD2",7,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORD2",8,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORD2",9,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORD2",10,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORD2",11,0)
 I Y D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT W ?32,"Sent to Pharmacy...",!! R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORD2",12,0)
 Q
"RTN","PSDORD2",13,0)
DISPLAY ;displays order request to screen
"RTN","PSDORD2",14,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORD2",15,0)
 W @IOF,!,?23,"Controlled Substance Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDORD2",16,0)
 W !!,"Pharmacy Dispensing #: ",!,"Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^"),?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDORD2",17,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORD2",18,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORD2",19,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORD2",20,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORD2",21,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORD2",22,0)
 I  D ^DIWW
"RTN","PSDORD2",23,0)
 Q
"RTN","PSDORD2",24,0)
EDIT ;edit or delete order request
"RTN","PSDORD2",25,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORD2",26,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORD2",27,0)
 I "Dd"[X D DEL Q
"RTN","PSDORD2",28,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="13" D ^DIE K DIE,DR
"RTN","PSDORD2",29,0)
 Q
"RTN","PSDORD2",30,0)
DEL ;deletes order request
"RTN","PSDORD2",31,0)
 S PSDOUT=1 W !,?25,"Request #",PSDD(2)," being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORD2",32,0)
 Q
"RTN","PSDORD2",33,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORD2",34,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","PSDORD2",35,0)
 W ?5,!,"Processing your request #",PSDD(2)," now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDORD2",36,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORD2",37,0)
 K DA,DIC,DIE,DLAYGO,DR S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORD2",38,0)
 L -^PSD(58.85,0)
"RTN","PSDORD2",39,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORD2",40,0)
 S DA=PSDREC,DR="1////"_+PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZ_";19////"_PSDRD D ^DIE K DIE
"RTN","PSDORD2",41,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORD2",42,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORD2",43,0)
 K DA,DIC,DIE,DLAYGO,DR,PSDREC,WORD
"RTN","PSDORD2",44,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","PSDORD2",45,0)
 Q
"RTN","PSDORD3")
0^153^B16404681
"RTN","PSDORD3",1,0)
PSDORD3 ;BIR/LTL-Reg 2 Nurse CS Order Request Entry (batch) ; 6 Jan 95
"RTN","PSDORD3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORD3",3,0)
QTY K ORD S (CNT,PSDOUT,PSDR(2))=0
"RTN","PSDORD3",4,0)
 ;Dispensing Site's Maximum Quantity per Order
"RTN","PSDORD3",5,0)
 S PSDR(1)=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),U,7)
"RTN","PSDORD3",6,0)
 ;Ask Quantity
"RTN","PSDORD3",7,0)
 S DIR(0)="NA^1:999999:0"
"RTN","PSDORD3",8,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDORD3",9,0)
 W:$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),U,3) !,"Stock Level:  ",$P($G(^(0)),U,3)," ",NBKU,!
"RTN","PSDORD3",10,0)
 S:PSDR(1) DIR("A",1)="Maximum quantity per order:  "_PSDR(1)_" "_NBKU,DIR("A",2)=""
"RTN","PSDORD3",11,0)
 S DIR("?",1)="Because "_NAOUN_" is keeping a perpetual inventory,"
"RTN","PSDORD3",12,0)
 S DIR("?",2)="Pharmacy Service has set "_$S(PSDR(1):"a maximum quantity of "_PSDR(1)_" "_NBKU_" per order",1:"no maximum order quantity")
"RTN","PSDORD3",13,0)
 S DIR("?")="for "_PSDRN_"."
"RTN","PSDORD3",14,0)
 S:PSDR(1) DIR("?")="If you request more than "_PSDR(1)_" "_NBKU_", multiple orders will be generated.",DIR("?",3)="for "_PSDRN_".",DIR("?",4)=""
"RTN","PSDORD3",15,0)
 D ^DIR K DIR G:Y<1 END S PSDQTY=Y
"RTN","PSDORD3",16,0)
 ;Quantity ordered is equal to or less than max ord qty
"RTN","PSDORD3",17,0)
NOMAX I '(Y#NPKG)&('PSDR(1)!(Y'>PSDR(1))) D DIE G:PSDOUT END G DRUG^PSDORD
"RTN","PSDORD3",18,0)
 ;Quantity ordered is not divisible by package size
"RTN","PSDORD3",19,0)
 D:(Y#NPKG)  G:$D(DIRUT) END G:Y<1 QTY I 'PSDR(1)!(Y<PSDR(1)) S Y=PSDQTY G NOMAX
"RTN","PSDORD3",20,0)
 .S PSDQTY=Y-(Y#NPKG)
"RTN","PSDORD3",21,0)
 .S DIR(0)="S^"_PSDQTY_":"_NBKU_";"_(PSDQTY+NPKG)_":"_NBKU_";*:New Quantity"
"RTN","PSDORD3",22,0)
 .S DIR("A",1)="Please order "_PSDRN,DIR("A",3)=""
"RTN","PSDORD3",23,0)
 .S DIR("A",2)="in multiples of "_NPKG_" "_NBKU_".",DIR("B")=PSDQTY
"RTN","PSDORD3",24,0)
 .S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_")"
"RTN","PSDORD3",25,0)
 .S DIR("?")="Enter an adjusted quantity or * to enter a new quantity" D ^DIR K DIR Q:Y<1  S PSDQTY=Y
"RTN","PSDORD3",26,0)
 S:(PSDQTY#PSDR(1)) CNT=1,PSDR(2)=(PSDQTY#PSDR(1))
"RTN","PSDORD3",27,0)
 ;Number of orders to generate
"RTN","PSDORD3",28,0)
 S CNT=$G(CNT)+(PSDQTY\PSDR(1))
"RTN","PSDORD3",29,0)
 W !!,"This will be "_CNT_" separate order requests,"
"RTN","PSDORD3",30,0)
 W:PSDR(2) !!,"One order for ",PSDR(2)," ",NBKU,", and"
"RTN","PSDORD3",31,0)
 W !!,(PSDQTY\PSDR(1))," order"
"RTN","PSDORD3",32,0)
 W:CNT>2!('PSDR(2)&(CNT=2)) "s"
"RTN","PSDORD3",33,0)
 W " for ",PSDR(1)," ",NBKU,"."
"RTN","PSDORD3",34,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORD3",35,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORD3",36,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORD3",37,0)
 I Y W !!,"The "_CNT_" requests are being created.",! S PSDQTY=$S(PSDR(2):PSDR(2),1:PSDR(1)) D  S PSDR(2)=0
"RTN","PSDORD3",38,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE S PSDA(+PSDR,PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,+PSDA,0)),PSDQTY=PSDR(1)
"RTN","PSDORD3",39,0)
 G:'PSDOUT DRUG^PSDORD
"RTN","PSDORD3",40,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORD3",41,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORD3",42,0)
 Q
"RTN","PSDORD3",43,0)
DIE ;create the order request
"RTN","PSDORD3",44,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORD3",45,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORD3",46,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORD3",47,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORD3",48,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////.5;5////"_PSDQTY_";13" D ^DIE K DIE,DR
"RTN","PSDORD3",49,0)
 S PSDA(+PSDR,+PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,PSDA,0))
"RTN","PSDORD3",50,0)
 Q
"RTN","PSDORD4")
0^154^B9037751
"RTN","PSDORD4",1,0)
PSDORD4 ;BIR/JPW,LTL-Nurse CS Order Request Entry (One time); 22 May 95
"RTN","PSDORD4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORD4",3,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","PSDORD4",4,0)
 S DIR("A",1)="You have selected "_PSDRN
"RTN","PSDORD4",5,0)
 S DIR("A",2)="which is "_$S('$G(^PSD(58.8,+NAOU,1,PSDR,0)):"not stocked by ",1:"inactive on ")_NAOUN_"."
"RTN","PSDORD4",6,0)
 S DIR("A")="Are you sure you want to create a one time request"
"RTN","PSDORD4",7,0)
 S DIR("?")="^N XQH S XQH=""PSD ORDER ENTRY ONE TIME"" D EN^XQH"
"RTN","PSDORD4",8,0)
 D ^DIR K DIR Q:Y<1
"RTN","PSDORD4",9,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORD4",10,0)
 I '$D(^PSD(58.8,+NAOU,1,+PSDR,0)) S DA(1)=+NAOU,DIC="^PSD(58.8,+NAOU,1,",DIC(0)="L",DLAYGO=58.8,X="`"_PSDR,DIC("DR")="13////"_DT_";14////"_"O"_";14.5////"_"One Time Request",DINUM=PSDR D ^DIC K DIC,DLAYGO
"RTN","PSDORD4",11,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORD4",12,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORD4",13,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORD4",14,0)
 W !!,"Sending a Mailman message to the Pharmacy Supervisor(s)...",!!
"RTN","PSDORD4",15,0)
 D ^PSDORM,LIST^PSDORL
"RTN","PSDORD4",16,0)
QTY K ORD S PSDOUT=0 S PSDQTY=NPKG,CNT=0 D DIE G:PSDOUT END
"RTN","PSDORD4",17,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORD4",18,0)
 K PSDEM,PSDOUT,X,Y
"RTN","PSDORD4",19,0)
 Q
"RTN","PSDORD4",20,0)
DIE ;create the order request
"RTN","PSDORD4",21,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORD4",22,0)
DIE2 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE2
"RTN","PSDORD4",23,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORD4",24,0)
 D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDORD4",25,0)
 W ?10,!!,"processing one order for ",PSDQTY," now..."
"RTN","PSDORD4",26,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////1;5////"_PSDQTY_";13" D ^DIE K DIE,DR
"RTN","PSDORD4",27,0)
 S PSDA(+PSDR,+PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,PSDA,0))
"RTN","PSDORD4",28,0)
 Q
"RTN","PSDORD4",29,0)
MSG ;display error message
"RTN","PSDORD4",30,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORD4",31,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORD4",32,0)
 Q
"RTN","PSDORL")
0^155^B12339427
"RTN","PSDORL",1,0)
PSDORL ;BIR/JPW/LTL-CS Order Entry Listing and Cancel ; 19 Dec 94
"RTN","PSDORL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORL",3,0)
LIST ;list if pending orders
"RTN","PSDORL",4,0)
 W !!,"Searching for pending orders..."
"RTN","PSDORL",5,0)
 S PSDOUT=0 D SORT G:PSDOUT END
"RTN","PSDORL",6,0)
CANC ;ask to cancel orders
"RTN","PSDORL",7,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you wish to cancel any pending orders",DIR("?")="Answer YES to select order(s) to cancel, NO or ^ to continue this order."
"RTN","PSDORL",8,0)
 S DIR("B")="NO" D ^DIR I 'Y!($D(DIRUT)) D MSG G END
"RTN","PSDORL",9,0)
 D PRT
"RTN","PSDORL",10,0)
ASK K DA,DIR,DIRUT
"RTN","PSDORL",11,0)
 W !,"You may cancel one order at a time.",!
"RTN","PSDORL",12,0)
 S DIR("A")="Please enter the order number you wish to cancel",DIR(0)="NO^1:"_OCNT,DIR("?")="Answer with the order number you wish to cancel or <RET> to continue with your order"
"RTN","PSDORL",13,0)
 D ^DIR I 'Y D MSG G END
"RTN","PSDORL",14,0)
 S KKO=+Y
"RTN","PSDORL",15,0)
ORD ;update ord
"RTN","PSDORL",16,0)
 K DA,DIE,DR S DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA=+$P($G(LOC(KKO)),"^",2),DA(1)=PSDR,DA(2)=NAOU,DR="10////9;19////@" D ^DIE K DA,DIE,DR
"RTN","PSDORL",17,0)
 S DA=+$P($G(LOC(KKO)),"^")
"RTN","PSDORL",18,0)
 K DIE,DR S DIE=58.85,DR="6////9" D ^DIE K DA,DIE,DR
"RTN","PSDORL",19,0)
 W $C(7),!!,"** The order you selected has been cancelled. **",!
"RTN","PSDORL",20,0)
 G LIST
"RTN","PSDORL",21,0)
END K AA,DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,KK,KKO,KK2,KK3,KK4,KK5,LL,LOC,NODEL,OCNT,PSDOUT,TOT,Y
"RTN","PSDORL",22,0)
 Q
"RTN","PSDORL",23,0)
MSG W !!,"No orders cancelled.  Continue processing your order.",!
"RTN","PSDORL",24,0)
 Q
"RTN","PSDORL",25,0)
SORT ;searches for orders
"RTN","PSDORL",26,0)
 K LL
"RTN","PSDORL",27,0)
 S (AA,TOT,OCNT)=0 F  S AA=$O(^PSD(58.85,"AC",AA)) Q:'AA!(AA>3)  S JJ=0 F  S JJ=$O(^PSD(58.85,"AC",AA,+NAOU,+PSDR,JJ)) Q:'JJ  S KK=0 F  S KK=$O(^PSD(58.85,"AC",AA,+NAOU,+PSDR,JJ,KK)) Q:'KK  D
"RTN","PSDORL",28,0)
 .Q:'$D(^PSD(58.85,KK,0))  S NODEL=^PSD(58.85,KK,0),TOT=TOT+$P(NODEL,"^",6),OCNT=OCNT+1
"RTN","PSDORL",29,0)
 .I AA=1,'+$G(^PSD(58.85,KK,2)) S LL(KK)=""
"RTN","PSDORL",30,0)
 W !!,$S(OCNT:"Orders pending: "_OCNT_"  Quantity Ordered ("_NBKU_"): "_TOT,1:"No orders pending"),!!
"RTN","PSDORL",31,0)
 I 'OCNT S PSDOUT=1 Q
"RTN","PSDORL",32,0)
 I '$O(LL(0)) W $C(7),"All pending orders are currently being processed.  Please review the PENDING ",!,"CS ORDERS REPORT for more information.",! S PSDOUT=1 Q
"RTN","PSDORL",33,0)
 Q
"RTN","PSDORL",34,0)
PRT ;displays list
"RTN","PSDORL",35,0)
 K LOC
"RTN","PSDORL",36,0)
 W !!,"Accessing pending orders for ",PSDRN,"...",!!,"The following orders may be cancelled:",!
"RTN","PSDORL",37,0)
 W !,?6,"DATE ORDERED",?25,"QUANTITY",?38,"ORDERED BY",! S (KK,OCNT)=0
"RTN","PSDORL",38,0)
 F  S KK=$O(LL(KK)) Q:'KK  I $D(^PSD(58.85,KK,0)),'$D(^PSD(58.85,KK,2)) D
"RTN","PSDORL",39,0)
 .S NODEL=^PSD(58.85,KK,0) Q:$P(NODEL,"^",7)>1
"RTN","PSDORL",40,0)
 .Q:+$P($G(NODEL),"^",8)  S KK2=+$P($G(NODEL),"^",5),KK3=+$P($G(NODEL),"^",6),(KK4,Y)=+$P($G(NODEL),"^",18) X ^DD("DD") S KK4=Y
"RTN","PSDORL",41,0)
 .S KK5=+$P($G(NODEL),"^",12),KK5=$S($P($G(^VA(200,KK5,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDORL",42,0)
 .S OCNT=OCNT+1,LOC(OCNT)=KK_"^"_KK2_"^"_KK3_"^"_KK4_"^"_KK5
"RTN","PSDORL",43,0)
 .W !,"(",OCNT,")",?5,KK4,?25,$J(KK3,8),?38,KK5
"RTN","PSDORL",44,0)
 W !
"RTN","PSDORL",45,0)
 Q
"RTN","PSDORM")
0^156^B1008754
"RTN","PSDORM",1,0)
PSDORM ;BIR/LTL-Send MM about one-time request, PSDORNO (cont'd) ; 20 Jan 95
"RTN","PSDORM",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORM",3,0)
 N PSD D KILL^XM
"RTN","PSDORM",4,0)
 S XMSUB="One Time Request",XMDUZ="NAOU Monitor" D XMZ^XMA2
"RTN","PSDORM",5,0)
 I XMZ<1 D KILL^XM Q
"RTN","PSDORM",6,0)
 S XMY(DUZ)="",PSD=0
"RTN","PSDORM",7,0)
 F  S PSD=$O(^XUSEC("PSDMGR",PSD)) Q:'PSD  S XMY(PSD)=""
"RTN","PSDORM",8,0)
 S PSD(1)=$P($P($G(^VA(200,DUZ,0)),U),",",2)_" "_$P($P($G(^(0)),U),",")
"RTN","PSDORM",9,0)
 S PSD(1)=PSD(1)_" has placed a one time request.",(PSD(2),PSD(4))=""
"RTN","PSDORM",10,0)
 S PSD(3)="The drug ordered was "_$G(PSDRN)_"."
"RTN","PSDORM",11,0)
 S PSD(5)="This drug is INACTIVE on "_NAOUN_"."
"RTN","PSDORM",12,0)
 S XMTEXT="PSD(" D ^XMD,KILL^XM Q
"RTN","PSDORN")
0^157^B30216870
"RTN","PSDORN",1,0)
PSDORN ;BIR/JPW,LTL-Nurse CS Order Request Entry ; 8 Aug 94
"RTN","PSDORN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDORN",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):2,$D(^XUSEC("PSJ PHARM TECH",DUZ)):2,1:0)
"RTN","PSDORN",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to order",!,?12,"narcotic supplies.",!!,"PSJ RNURSE, PSJ RPHARM, or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDORN",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDORN",7,0)
 G:OK=2 ^PSDORP
"RTN","PSDORN",8,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDORN",9,0)
NAOU ;select NAOU to order supplies for
"RTN","PSDORN",10,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ordering NAOU: "
"RTN","PSDORN",11,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDORN",12,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDORN",13,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDORN",14,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDORN",15,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4)
"RTN","PSDORN",16,0)
 S:PSDS PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5)
"RTN","PSDORN",17,0)
 I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDORN",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDORN",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDORN",20,0)
 S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDORN",21,0)
 K ^UTILITY($J,"W") W ! N X,DIWL,DIWR,DIWF,PSD
"RTN","PSDORN",22,0)
 S PSD=0,DIWL=1,DIWR=80,DIWF="W",X="IORVON;IORVOFF" D ENDR^%ZISS W IORVON
"RTN","PSDORN",23,0)
 F  S PSD=$O(^PSD(58.8,+PSDS,5,PSD)) Q:'PSD  S X=$G(^PSD(58.8,+PSDS,5,PSD,0)) D ^DIWP
"RTN","PSDORN",24,0)
 D ^DIWW W IORVOFF D KILL^%ZISS
"RTN","PSDORN",25,0)
TYPE S DIR(0)="SAM^S:Scheduled Delivery;U:Unscheduled Pick Up"
"RTN","PSDORN",26,0)
 S DIR("A")="Scheduled Delivery or Unscheduled Pick Up (S/U):  "
"RTN","PSDORN",27,0)
 S DIR("B")="Scheduled Delivery"
"RTN","PSDORN",28,0)
 S DIR("?")="^N XQH S XQH=""PSD ORDER ENTRY"" D EN^XQH"
"RTN","PSDORN",29,0)
 D ^DIR K DIR G:$D(DIRUT) END W ! G:Y="S" ^PSDORD
"RTN","PSDORN",30,0)
DRUG ;select drug
"RTN","PSDORN",31,0)
 K DA,DIC,PSDR
"RTN","PSDORN",32,0)
 S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""   N/F"" W $S('$G(^PSD(58.8,NAOU,1,Y,0)):""  NOT STOCKED BY ""_NAOUN,$P(^(0),U,14)&($P(^(0),U,14)'>DT):"" INACTIVE on ""_NAOUN,1:"""")"
"RTN","PSDORN",33,0)
 S DIC("S")="I '$P($G(^(7)),U,2),$S('$P(^(0),""^"",14):1,+$P(^(0),""^"",14)>DT:1,1:0)"
"RTN","PSDORN",34,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_+PSDS_",1,"
"RTN","PSDORN",35,0)
 ;no one-time requests allowed by dispensing site
"RTN","PSDORN",36,0)
 D:'$P($G(^PSD(58.8,+PSDS,0)),U,13)
"RTN","PSDORN",37,0)
 .S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""  N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),U,14)]"""",$P(^(0),U,14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORN",38,0)
 .S DIC("S")="I $S('$P(^(0),U,14):1,+$P(^(0),U,14)>DT:1,1:0)"
"RTN","PSDORN",39,0)
 .S DA(1)=+NAOU,DIC="^PSD(58.8,"_NAOU_",1,"
"RTN","PSDORN",40,0)
 D ^DIC K DIC G:Y<0 END S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORN",41,0)
 ;zero balance in vault
"RTN","PSDORN",42,0)
 I '$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),U,4) D ENS^%ZISS W IOBON,!!,?20,"ZERO BALANCE IN PHARMACY",IOBOFF D KILL^%ZISS
"RTN","PSDORN",43,0)
 I $S('$D(^PSD(58.8,NAOU,1,PSDR,0)):1,$P(^(0),U,14)&($P(^(0),U,14)'>DT):1,1:0) D ^PSDORNO G:$D(DIRUT) END G TYPE
"RTN","PSDORN",44,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORN",45,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORN",46,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORN",47,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORN",48,0)
 D LIST^PSDORL
"RTN","PSDORN",49,0)
 ;Perpetual?
"RTN","PSDORN",50,0)
 G:$P($G(^PSD(58.8,+NAOU,2)),U,5) ^PSDOR2
"RTN","PSDORN",51,0)
QTY K ORD S PSDOUT=0 W !!,"QUANTITY ("_NBKU_"/"_NPKG_"): "_NPKG_"// " R X:DTIME S PSDT(8)=X I '$T!(X["^") G END
"RTN","PSDORN",52,0)
 S DIR(0)="DA^NOW::AEFT",DIR("A")="Date/time required: "
"RTN","PSDORN",53,0)
 S DIR("?",1)="You are on the verge of creating an unscheduled order."
"RTN","PSDORN",54,0)
 S DIR("?",2)="If this is a mistake, enter ""^"" to create a scheduled order, otherwise,"
"RTN","PSDORN",55,0)
 S DIR("?")="Pharmacy needs to know how soon you need this order."
"RTN","PSDORN",56,0)
 W ! D ^DIR K DIR G:$D(DIRUT) TYPE X ^DD("DD") S PSDT(9)=Y
"RTN","PSDORN",57,0)
 S:PSDT(8)="" PSDT(8)=NPKG I PSDT(8)=NPKG S PSDQTY=NPKG,CNT=0 D DIE^PSDORN0 G:$G(PSDOUT) END D ASK^PSDORN1 K PSDEM G:PSDOUT END G DRUG
"RTN","PSDORN",58,0)
 I PSDT(8)["?"!(PSDT(8)'?1.N)!(PSDT(8)#NPKG)!('PSDT(8)) W !!,"Quantity must be "_NPKG_" or a multiple of "_NPKG,! G QTY
"RTN","PSDORN",59,0)
 S CNT=PSDT(8)/NPKG W !!,"This will be "_CNT_" separate order requests.  The quantity is "_NPKG_" per request."
"RTN","PSDORN",60,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORN",61,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORN",62,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORN",63,0)
 I Y W !!,"The "_CNT_" requests are being created.  You must review every request.",! S PSDQTY=NPKG D  G:$G(PSDOUT) END D ^PSDORN1
"RTN","PSDORN",64,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE^PSDORN0 Q:$G(PSDOUT)  S ORD(ORD)=PSDA
"RTN","PSDORN",65,0)
 G:'PSDOUT DRUG
"RTN","PSDORN",66,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORN",67,0)
 K NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDT,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORN",68,0)
 Q
"RTN","PSDORN",69,0)
MSG ;display error message
"RTN","PSDORN",70,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORN",71,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORN",72,0)
 Q
"RTN","PSDORN0")
0^158^B3755003
"RTN","PSDORN0",1,0)
PSDORN0 ;BIR/JPW,LTL-Nurse CS Order Request Entry (continued); 16 Feb 95
"RTN","PSDORN0",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORN0",3,0)
DIE ;create the order request
"RTN","PSDORN0",4,0)
 S:$G(ORD)<2 PSDEM=1
"RTN","PSDORN0",5,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORN0",6,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORN0",7,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORN0",8,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORN0",9,0)
 I $G(PAT),$G(PSD(2)),$O(^PSD(58.81,PSD(2),2,0)),'$G(PSD(4)) S ^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)=^PSD(58.81,PSD(2),2,0) D
"RTN","PSDORN0",10,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.81,PSD(2),2,WORD)) Q:'WORD  S ^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)=^PSD(58.81,PSD(2),2,WORD,0)
"RTN","PSDORN0",11,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////1;5////"_PSDQTY_";24////"_$G(PSDEM)_";13//"_$G(PSDR(1)) D ^DIE K DIE,DR,WORD
"RTN","PSDORN0",12,0)
 Q
"RTN","PSDORN1")
0^159^B16015048
"RTN","PSDORN1",1,0)
PSDORN1 ;BIR/JPW,LTL-Nurse CS Order Entry (cont'd) ; 16 Feb 95
"RTN","PSDORN1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORN1",3,0)
 I $D(ORD) F CNT1=1:1:CNT S PSDA=+ORD(CNT1) D ASK
"RTN","PSDORN1",4,0)
 Q
"RTN","PSDORN1",5,0)
ASK ;displays order for review
"RTN","PSDORN1",6,0)
 D DISPLAY
"RTN","PSDORN1",7,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORN1",8,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORN1",9,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORN1",10,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORN1",11,0)
 I Y N X,X1 D SIG^XUSESIG S:X1="" PSDOUT=1 D:X1="" DEL Q:X1=""  D
"RTN","PSDORN1",12,0)
 .D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT
"RTN","PSDORN1",13,0)
 .W ?32,"Sent to Pharmacy...",!!
"RTN","PSDORN1",14,0)
 .R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORN1",15,0)
 Q
"RTN","PSDORN1",16,0)
DISPLAY ;displays order request to screen
"RTN","PSDORN1",17,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORN1",18,0)
 W @IOF,!,?17,"Controlled Substance "
"RTN","PSDORN1",19,0)
 W:$G(PSDEM) "*UNSCHEDULED PICK UP* "
"RTN","PSDORN1",20,0)
 W "Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDORN1",21,0)
 W:$G(PAT) !!,"Patient:  ",$P($G(^DPT(PAT,0)),U),!!
"RTN","PSDORN1",22,0)
 W !!,"Pharmacy Dispensing #: ",!
"RTN","PSDORN1",23,0)
 W "Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDORN1",24,0)
 W ?51,$S($G(PSDT(9))]"":"Needed by: "_PSDT(9),1:"Request Date: "_REQD),!,LN,!
"RTN","PSDORN1",25,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORN1",26,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORN1",27,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORN1",28,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORN1",29,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORN1",30,0)
 I  D ^DIWW
"RTN","PSDORN1",31,0)
 Q
"RTN","PSDORN1",32,0)
EDIT ;edit or delete order request
"RTN","PSDORN1",33,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORN1",34,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORN1",35,0)
 I "Dd"[X D DEL Q
"RTN","PSDORN1",36,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="13" D ^DIE K DIE,DR
"RTN","PSDORN1",37,0)
 Q
"RTN","PSDORN1",38,0)
DEL ;deletes order request
"RTN","PSDORN1",39,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORN1",40,0)
 Q
"RTN","PSDORN1",41,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORN1",42,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","PSDORN1",43,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDORN1",44,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORN1",45,0)
 K DA,DIC,DIE,DLAYGO,DR S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORN1",46,0)
 L -^PSD(58.85,0)
"RTN","PSDORN1",47,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORN1",48,0)
 S DA=PSDREC,DR="1////"_+PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZ_";19////"_PSDRD_";21////"_$P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,2)),U,2)_";22////"_$G(PAT) D ^DIE K DIE
"RTN","PSDORN1",49,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORN1",50,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORN1",51,0)
 K DA,DIC,DIE,DLAYGO,DR,WORD
"RTN","PSDORN1",52,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","PSDORN1",53,0)
 D:$P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,2)),U,2) ^PSDORNP K PSDREC,PSDT(9)
"RTN","PSDORN1",54,0)
 Q
"RTN","PSDORN2")
0^376^B14389778
"RTN","PSDORN2",1,0)
PSDORN2 ;BIR/JPW,LTL-Nurse CS Infusion Order Entry (cont'd) ; 16 Feb 95
"RTN","PSDORN2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORN2",3,0)
ASK ;displays order for review
"RTN","PSDORN2",4,0)
 D DISPLAY
"RTN","PSDORN2",5,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORN2",6,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORN2",7,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORN2",8,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORN2",9,0)
 I Y N X,X1 D SIG^XUSESIG S:X1="" PSDOUT=1 D:X1="" DEL Q:X1=""  D
"RTN","PSDORN2",10,0)
 .D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT
"RTN","PSDORN2",11,0)
 .W ?32,"Sent to Pharmacy...",!!
"RTN","PSDORN2",12,0)
 .R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORN2",13,0)
 Q
"RTN","PSDORN2",14,0)
DISPLAY ;displays order request to screen
"RTN","PSDORN2",15,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORN2",16,0)
 W @IOF,!,?17,"Controlled Substance "
"RTN","PSDORN2",17,0)
 W:$G(PSDEM) "*INFUSION* Order Request"
"RTN","PSDORN2",18,0)
 W !!,"Patient:  ",$P($G(^DPT(PAT,0)),U),!!
"RTN","PSDORN2",19,0)
 W "Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDORN2",20,0)
 W ?51,$S($G(PSDT(9))]"":"Needed by: "_PSDT(9),1:"Request Date: "_REQD),!,LN,!
"RTN","PSDORN2",21,0)
 W !,"Drug",?16,": ",PSDRN
"RTN","PSDORN2",22,0)
 ;W ?56,"Quantity: ",?66,PSDQTY
"RTN","PSDORN2",23,0)
 W !,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORN2",24,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORN2",25,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORN2",26,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORN2",27,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORN2",28,0)
 I  D ^DIWW
"RTN","PSDORN2",29,0)
 Q
"RTN","PSDORN2",30,0)
EDIT ;edit or delete order request
"RTN","PSDORN2",31,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORN2",32,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORN2",33,0)
 I "Dd"[X D DEL Q
"RTN","PSDORN2",34,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="13" D ^DIE K DIE,DR
"RTN","PSDORN2",35,0)
 Q
"RTN","PSDORN2",36,0)
DEL ;deletes order request
"RTN","PSDORN2",37,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORN2",38,0)
 Q
"RTN","PSDORN2",39,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORN2",40,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDORN2",41,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORN2",42,0)
 K DA,DIC,DIE,DLAYGO,DR S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORN2",43,0)
 L -^PSD(58.85,0)
"RTN","PSDORN2",44,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORN2",45,0)
 S DA=PSDREC,DR="1////"_+PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZ_";19////"_PSDRD_";21////"_$P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,2)),U,2)_";22////"_$G(PAT) D ^DIE K DIE
"RTN","PSDORN2",46,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORN2",47,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORN2",48,0)
 K DA,DIC,DIE,DLAYGO,DR,WORD
"RTN","PSDORN2",49,0)
 D ^PSDORN3 K PSDREC,PSDT(9)
"RTN","PSDORN2",50,0)
 Q
"RTN","PSDORN3")
0^377^B3396739
"RTN","PSDORN3",1,0)
PSDORN3 ;BIR/LTL-Nurse CS INF Order Entry Print emer order (cont'd) ; 17 Feb 95
"RTN","PSDORN3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORN3",3,0)
 N Y,ZTRTN,ZTDTH,ZTSK,ZTDESC,ZTIO,ZTSAVE
"RTN","PSDORN3",4,0)
 S ZTRTN="PRINT^PSDORN3",ZTDESC="Print a Controlled Subs order"
"RTN","PSDORN3",5,0)
 S ZTDTH=$H,Y=$P($G(^PSD(58.8,+PSDS,2)),U,11),C=$P(^DD(58.8,29,0),U,2)
"RTN","PSDORN3",6,0)
 D Y^DIQ I Y']"" W !!,"Pharmacy has not set up an unscheduled order printer, you'll need to call." Q
"RTN","PSDORN3",7,0)
 S ZTIO=Y,ZTSAVE("PSD*")="",ZTSAVE("REQD")="",ZTSAVE("NAOU*")="",ZTSAVE("PAT")=""
"RTN","PSDORN3",8,0)
 W ?40,"Printing on ",Y,"..." D ^%ZTLOAD,HOME^%ZIS Q
"RTN","PSDORN3",9,0)
PRINT W:$Y&(IOF]"") @IOF W "* CONT. SUBS. INFUSION ORDER *"
"RTN","PSDORN3",10,0)
 W !!,"Date/Time Needed: ",$$FMTE^XLFDT($G(PSDT(9)),2)
"RTN","PSDORN3",11,0)
 W !,"Patient: ",$P($G(^DPT(PAT,0)),U)
"RTN","PSDORN3",12,0)
 W !,"Location",?14,": ",NAOUN
"RTN","PSDORN3",13,0)
 W !,"Drug",?14,": ",!,PSDRN
"RTN","PSDORN3",14,0)
 ;W !,"Quantity",?14,": ",PSDQTY
"RTN","PSDORN3",15,0)
 W:'$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),U,4) "  ZERO IN VAULT"
"RTN","PSDORN3",16,0)
 W !,"Requested by",?14,": ",$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDORN3",17,0)
 W !,"Worksheet #",?14,": ",PSDREC
"RTN","PSDORN3",18,0)
 W !,"Comments:"
"RTN","PSDORN3",19,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORN3",20,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORN3",21,0)
 I  D ^DIWW
"RTN","PSDORN3",22,0)
 W:$Y&(IOF]"") @IOF
"RTN","PSDORN3",23,0)
 S DIE="^PSD(58.85,",DA=PSDREC,DR="13////"_1 D ^DIE K DIE,DA,DR
"RTN","PSDORN3",24,0)
 S ZTREQ="@" Q
"RTN","PSDORNC")
0^378^B17540217
"RTN","PSDORNC",1,0)
PSDORNC ;BIR/JPW,LTL-Nurse CS PCA Order Request Entry ; 8 Aug 94
"RTN","PSDORNC",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORNC",3,0)
DRUG ;select drug
"RTN","PSDORNC",4,0)
 K DA,DIC,PSDR
"RTN","PSDORNC",5,0)
 S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""   N/F"" W $S('$G(^PSD(58.8,NAOU,1,Y,0)):""  NOT STOCKED BY ""_NAOUN,$P(^(0),U,14)&($P(^(0),U,14)'>DT):"" INACTIVE on ""_NAOUN,1:"""")"
"RTN","PSDORNC",6,0)
 S DIC("S")="I '$P($G(^(7)),U,2),$P($G(^(7)),U,3),$S('$P(^(0),""^"",14):1,+$P(^(0),""^"",14)>DT:1,1:0)"
"RTN","PSDORNC",7,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_+PSDS_",1,"
"RTN","PSDORNC",8,0)
 ;no one-time requests allowed by dispensing site
"RTN","PSDORNC",9,0)
 D:'$P($G(^PSD(58.8,+PSDS,0)),U,13)
"RTN","PSDORNC",10,0)
 .S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""  N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),U,14)]"""",$P(^(0),U,14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORNC",11,0)
 .S DIC("S")="I $S('$P(^(0),U,14):1,+$P(^(0),U,14)>DT:1,1:0)"
"RTN","PSDORNC",12,0)
 .S DA(1)=+NAOU,DIC="^PSD(58.8,"_NAOU_",1,"
"RTN","PSDORNC",13,0)
 D ^DIC K DIC G:Y<0 END S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORNC",14,0)
 ;zero balance in vault
"RTN","PSDORNC",15,0)
 I '$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),U,4) D ENS^%ZISS W IOBON,!!,?20,"ZERO BALANCE IN PHARMACY",IOBOFF D KILL^%ZISS
"RTN","PSDORNC",16,0)
 I $S('$D(^PSD(58.8,NAOU,1,PSDR,0)):1,$P(^(0),U,14)&($P(^(0),U,14)'>DT):1,1:0) D ^PSDORNO G:$D(DIRUT) END G PAT^PSDORNV
"RTN","PSDORNC",17,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORNC",18,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORNC",19,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORNC",20,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORNC",21,0)
 D LIST^PSDORL
"RTN","PSDORNC",22,0)
 ;Perpetual?
"RTN","PSDORNC",23,0)
 G:$P($G(^PSD(58.8,+NAOU,2)),U,5) ^PSDOR2
"RTN","PSDORNC",24,0)
QTY K ORD S PSDOUT=0 W !!,"QUANTITY ("_NBKU_"/"_NPKG_"): "_NPKG_"// " R X:DTIME S PSDT(8)=X I '$T!(X["^") G END
"RTN","PSDORNC",25,0)
 S DIR(0)="DA^NOW::AEFT",DIR("A")="Date/time required: "
"RTN","PSDORNC",26,0)
 S DIR("?",1)="You are on the verge of creating an unscheduled order."
"RTN","PSDORNC",27,0)
 S DIR("?",2)="If this is a mistake, enter ""^"" to create a scheduled order, otherwise,"
"RTN","PSDORNC",28,0)
 S DIR("?")="Pharmacy needs to know how soon you need this order."
"RTN","PSDORNC",29,0)
 W ! D ^DIR K DIR G:$D(DIRUT) DRUG X ^DD("DD") S PSDT(9)=Y
"RTN","PSDORNC",30,0)
 S:PSDT(8)="" PSDT(8)=NPKG I PSDT(8)=NPKG S PSDQTY=NPKG,CNT=0 D DIE^PSDORN0 G:$G(PSDOUT) END D ASK^PSDORN1 K PSDEM G:PSDOUT END G DRUG
"RTN","PSDORNC",31,0)
 I PSDT(8)["?"!(PSDT(8)'?1.N)!(PSDT(8)#NPKG)!('PSDT(8)) W !!,"Quantity must be "_NPKG_" or a multiple of "_NPKG,! G QTY
"RTN","PSDORNC",32,0)
 S CNT=PSDT(8)/NPKG W !!,"This will be "_CNT_" separate order requests.  The quantity is "_NPKG_" per request."
"RTN","PSDORNC",33,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORNC",34,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORNC",35,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORNC",36,0)
 I Y W !!,"The "_CNT_" requests are being created.  You must review every request.",! S PSDQTY=NPKG D  G:$G(PSDOUT) END D ^PSDORN1
"RTN","PSDORNC",37,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE^PSDORN0 Q:$G(PSDOUT)  S ORD(ORD)=PSDA
"RTN","PSDORNC",38,0)
 G:'PSDOUT DRUG
"RTN","PSDORNC",39,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORNC",40,0)
 K NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORNC",41,0)
 Q
"RTN","PSDORNC",42,0)
MSG ;display error message
"RTN","PSDORNC",43,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORNC",44,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORNC",45,0)
 Q
"RTN","PSDORNO")
0^160^B11690529
"RTN","PSDORNO",1,0)
PSDORNO ;BIR/JPW,LTL-Nurse CS Order Request Entry (One time); 15 Jan 95
"RTN","PSDORNO",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORNO",3,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","PSDORNO",4,0)
 S DIR("A",1)="You have selected "_PSDRN
"RTN","PSDORNO",5,0)
 S DIR("A",2)="which is "_$S('$G(^PSD(58.8,+NAOU,1,PSDR,0)):"not stocked by ",1:"inactive on ")_NAOUN_"."
"RTN","PSDORNO",6,0)
 S DIR("A")="Are you sure you want to create a one time request"
"RTN","PSDORNO",7,0)
 S DIR("?")="^N XQH S XQH=""PSD ORDER ENTRY ONE TIME"" D EN^XQH"
"RTN","PSDORNO",8,0)
 W ! D ^DIR K DIR Q:Y<1
"RTN","PSDORNO",9,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORNO",10,0)
 S DIR(0)="DA^NOW::AEFT",DIR("A")="Date/time required: "
"RTN","PSDORNO",11,0)
 S DIR("?",1)="You are on the verge of creating an unscheduled order."
"RTN","PSDORNO",12,0)
 S DIR("?",2)="If this is a mistake, enter ""^"" to create a scheduled order, otherwise,"
"RTN","PSDORNO",13,0)
 S DIR("?")="Pharmacy needs to know how soon you need this order."
"RTN","PSDORNO",14,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END X ^DD("DD") S PSDT(9)=Y
"RTN","PSDORNO",15,0)
 I '$D(^PSD(58.8,+NAOU,1,+PSDR,0)) S DA(1)=+NAOU,DIC="^PSD(58.8,+NAOU,1,",DIC(0)="L",DLAYGO=58.8,X="`"_PSDR,DIC("DR")="13////"_DT_";14////"_"O"_";14.5////"_"One Time Request",DINUM=PSDR D ^DIC K DIC,DLAYGO I Y<1 W !,"Inactive drug" G END
"RTN","PSDORNO",16,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORNO",17,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORNO",18,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORNO",19,0)
 W !!,"Sending a Mailman message to the Pharmacy Supervisor(s)...",!!
"RTN","PSDORNO",20,0)
 D ^PSDORM,LIST^PSDORL
"RTN","PSDORNO",21,0)
QTY K ORD S PSDOUT=0 S PSDQTY=NPKG,CNT=0 D DIE G:PSDOUT END
"RTN","PSDORNO",22,0)
 D ASK^PSDORN1 G:PSDOUT END
"RTN","PSDORNO",23,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORNO",24,0)
 K PSDEM,PSDOUT,X,Y
"RTN","PSDORNO",25,0)
 Q
"RTN","PSDORNO",26,0)
DIE ;create the order request
"RTN","PSDORNO",27,0)
 Q:'$D(^PSD(58.8,NAOU,1,PSDR,0))
"RTN","PSDORNO",28,0)
 S PSDEM=1
"RTN","PSDORNO",29,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORNO",30,0)
DIE2 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE2
"RTN","PSDORNO",31,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORNO",32,0)
 D NOW^%DTC S PSDT=+$E(%,1,12)
"RTN","PSDORNO",33,0)
 W ?10,!!,"processing one order for ",PSDQTY," now..."
"RTN","PSDORNO",34,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////1;5////"_PSDQTY_";24////"_$G(PSDEM)_";13" D ^DIE K DIE,DR
"RTN","PSDORNO",35,0)
 Q
"RTN","PSDORNO",36,0)
MSG ;display error message
"RTN","PSDORNO",37,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORNO",38,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORNO",39,0)
 Q
"RTN","PSDORNP")
0^161^B3303494
"RTN","PSDORNP",1,0)
PSDORNP ;BIR/LTL-Nurse CS Order Entry Print emergency order (cont'd) ; 17 Feb 95
"RTN","PSDORNP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORNP",3,0)
 N Y,ZTRTN,ZTDTH,ZTSK,ZTDESC,ZTIO,ZTSAVE
"RTN","PSDORNP",4,0)
 S ZTRTN="PRINT^PSDORNP",ZTDESC="Print a Controlled Subs order"
"RTN","PSDORNP",5,0)
 S ZTDTH=$H,Y=$P($G(^PSD(58.8,+PSDS,2)),U,11),C=$P(^DD(58.8,29,0),U,2)
"RTN","PSDORNP",6,0)
 D Y^DIQ I Y']"" W !!,"Pharmacy has not set up an unscheduled order printer, you'll need to call." Q
"RTN","PSDORNP",7,0)
 S ZTIO=Y,ZTSAVE("PSD*")="",ZTSAVE("REQD")="",ZTSAVE("NAOU*")=""
"RTN","PSDORNP",8,0)
 W ?40,"Printing on ",Y,"..." D ^%ZTLOAD,HOME^%ZIS Q
"RTN","PSDORNP",9,0)
PRINT W:$Y&(IOF]"") @IOF W "* UNSCHEDULED CONT. SUBS. ORDER *"
"RTN","PSDORNP",10,0)
 W !!,"Date/Time Needed: ",$$FMTE^XLFDT($G(PSDT(9)),2)
"RTN","PSDORNP",11,0)
 W !,"Location",?14,": ",NAOUN
"RTN","PSDORNP",12,0)
 W !,"Drug",?14,": ",!,PSDRN,!,"Quantity",?14,": ",PSDQTY
"RTN","PSDORNP",13,0)
 W:'$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),U,4) "  ZERO IN VAULT"
"RTN","PSDORNP",14,0)
 W !,"Requested by",?14,": ",$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDORNP",15,0)
 W !,"Worksheet #",?14,": ",PSDREC
"RTN","PSDORNP",16,0)
 W !,"Comments:"
"RTN","PSDORNP",17,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORNP",18,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORNP",19,0)
 I  D ^DIWW
"RTN","PSDORNP",20,0)
 W:$Y&(IOF]"") @IOF
"RTN","PSDORNP",21,0)
 S DIE="^PSD(58.85,",DA=PSDREC,DR="13////"_1 D ^DIE K DIE,DA,DR
"RTN","PSDORNP",22,0)
 S ZTREQ="@" Q
"RTN","PSDORNV")
0^379^B42380281
"RTN","PSDORNV",1,0)
PSDORNV ;BIR/JPW,LTL-Nurse CS Infusion Order Request Entry ; 8 Aug 94
"RTN","PSDORNV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORNV",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDORNV",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):2,$D(^XUSEC("PSJ PHARM TECH",DUZ)):2,1:0)
"RTN","PSDORNV",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to order",!,?12,"narcotic supplies.",!!,"PSJ RNURSE, PSJ RPHARM, or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDORNV",6,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDORNV",7,0)
 G:OK=2 ^PSDORP
"RTN","PSDORNV",8,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDORNV",9,0)
NAOU ;select NAOU to order supplies for
"RTN","PSDORNV",10,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ordering NAOU: "
"RTN","PSDORNV",11,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDORNV",12,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDORNV",13,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDORNV",14,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDORNV",15,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4)
"RTN","PSDORNV",16,0)
 S:PSDS PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5)
"RTN","PSDORNV",17,0)
 I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDORNV",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDORNV",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDORNV",20,0)
 S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDORNV",21,0)
 K ^UTILITY($J,"W") W ! N X,DIWL,DIWR,DIWF,PSD
"RTN","PSDORNV",22,0)
 S PSD=0,DIWL=1,DIWR=80,DIWF="W",X="IORVON;IORVOFF" D ENDR^%ZISS W IORVON
"RTN","PSDORNV",23,0)
 F  S PSD=$O(^PSD(58.8,+PSDS,5,PSD)) Q:'PSD  S X=$G(^PSD(58.8,+PSDS,5,PSD,0)) D ^DIWP
"RTN","PSDORNV",24,0)
 D ^DIWW W IORVOFF D KILL^%ZISS
"RTN","PSDORNV",25,0)
PAT N DFN,DIC,DTOUT,DUOUT,X,Y,PAT,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDORNV",26,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDORNV",27,0)
 W ! D ^DIC K DIC G:Y<1 END S (DFN,PAT)=+Y
"RTN","PSDORNV",28,0)
PCA S DIR(0)="S^I:Infusion;P:PCA Syringe" W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORNV",29,0)
 I Y="P" D ^PSDORNC G PAT
"RTN","PSDORNV",30,0)
 W !!,"Checking for active Controlled Substance IV orders."
"RTN","PSDORNV",31,0)
 D ENHS^PSJEEU0 K ^UTILITY("PSG",$J),^TMP("PSG",$J) S PSD(1)=0
"RTN","PSDORNV",32,0)
 F  S PSD=$O(^UTILITY("PSIV",$J,PSD)) Q:'PSD  F  S PSD(1)=$O(^UTILITY("PSIV",$J,PSD,"A",PSD(1))) Q:'PSD(1)  S PSD(2)=$G(^UTILITY("PSIV",$J,PSD,"A",PSD(1))) D:$P($G(^PSDRUG(+$P($G(^PS(52.6,+$P(PSD(2),U),0)),U,2),2)),U,3)["N"
"RTN","PSDORNV",33,0)
 .W !,$P($P(PSD(2),U),";",2)," ",$P(PSD(2),U,2),"  "
"RTN","PSDORNV",34,0)
 .W $P($P($G(^UTILITY("PSIV",$J,PSD,"S",PSD(1))),U),";",2)," ",$P($G(^(PSD(1))),U,2)
"RTN","PSDORNV",35,0)
 F  S PSD=$O(^TMP("PSIV",$J,PSD)) Q:'PSD  F  S PSD(1)=$O(^TMP("PSIV",$J,PSD,"A",PSD(1))) Q:'PSD(1)  S PSD(2)=$G(^TMP("PSIV",$J,PSD,"A",PSD(1))) D:$P($G(^PSDRUG(+$P($G(^PS(52.6,+$P(PSD(2),U),0)),U,2),2)),U,3)["N"
"RTN","PSDORNV",36,0)
 .W !,$P($P(PSD(2),U),";",2)," ",$P(PSD(2),U,2),"  "
"RTN","PSDORNV",37,0)
 .W $P($P($G(^TMP("PSIV",$J,PSD,"S",PSD(1))),U),";",2)," ",$P($G(^(PSD(1))),U,2)
"RTN","PSDORNV",38,0)
 K ^UTILITY("PSIV",$J),^TMP("PSIV",$J)
"RTN","PSDORNV",39,0)
DRUG ;select drug
"RTN","PSDORNV",40,0)
 W !
"RTN","PSDORNV",41,0)
 K DA,DIC,PSDR
"RTN","PSDORNV",42,0)
 S DIC="^PS(52.6,",DIC(0)="AEMQZ",DIC("A")="Select the primary Controlled Substance for this infusion: ",DIC("S")="I $P($G(^PSDRUG(+$P($G(^PS(52.6,+Y,0)),U,2),2)),U,3)[""N"""
"RTN","PSDORNV",43,0)
 D ^DIC K DIC G:Y<0 END S PSDR=$P(Y(0),U,2),(PSDR(1),PSDR(2))=Y(0),PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORNV",44,0)
 ;zero balance in vault
"RTN","PSDORNV",45,0)
 I '$P($G(^PSD(58.8,+PSDS,1,PSDR,0)),U,4) D ENS^%ZISS W IOBON,!!,?20,"ZERO BALANCE IN PHARMACY",IOBOFF D KILL^%ZISS
"RTN","PSDORNV",46,0)
 ;I $S('$D(^PSD(58.8,NAOU,1,PSDR,0)):1,$P(^(0),U,14)&($P(^(0),U,14)'>DT):1,1:0) D ^PSDORNO G:$D(DIRUT) END G TYPE
"RTN","PSDORNV",47,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORNV",48,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORNV",49,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORNV",50,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORNV",51,0)
 D LIST^PSDORL
"RTN","PSDORNV",52,0)
CHEC W !,"Checking for the last order for ",$P($G(^DPT(PAT,0)),U),".",!
"RTN","PSDORNV",53,0)
 N PSD
"RTN","PSDORNV",54,0)
 S PSD=$$FMADD^XLFDT(DT,-1)
"RTN","PSDORNV",55,0)
 F  S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD  S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.81,"ACT",PSD,+PSDS,PSDR,2,PSD(1))) Q:'PSD(1)  I $P($G(^PSD(58.81,PSD(1),9)),U)=PAT S PSD(2)=PSD(1) S PSD(3)=$G(^PSD(58.81,PSD(1),0))
"RTN","PSDORNV",56,0)
 I $G(PSD(3)) S PSDT(8)=$P(PSD(3),U,6),PSDR(1)=$P($G(^PSD(58.81,+PSD(2),2,1,0)),U)
"RTN","PSDORNV",57,0)
QTY K ORD S PSDOUT=0
"RTN","PSDORNV",58,0)
 ;W ! S DIR(0)="58.85,5A"
"RTN","PSDORNV",59,0)
 ;S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): "
"RTN","PSDORNV",60,0)
 ;S:$G(PSDT(8)) DIR("B")=$G(PSDT(8))
"RTN","PSDORNV",61,0)
 ;D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORNV",62,0)
 D:$G(PSD(3))  G:$D(DIRUT) DRUG
"RTN","PSDORNV",63,0)
 .K ^UTILITY($J,"W") W ! N X,DIWL,DIWR,DIWF,PSD1
"RTN","PSDORNV",64,0)
 .S PSD1=0,DIWL=1,DIWR=80,DIWF="W"
"RTN","PSDORNV",65,0)
 .F  S PSD1=$O(^PSD(58.81,PSD(2),2,PSD1)) Q:'PSD1  S X=$G(^PSD(58.81,PSD(2),2,PSD1,0)) D ^DIWP
"RTN","PSDORNV",66,0)
 .D ^DIWW
"RTN","PSDORNV",67,0)
 .S DIR(0)="Y",DIR("A")="Change" D ^DIR K DIR S PSD(4)=Y
"RTN","PSDORNV",68,0)
 I $G(PSD(4))']""!($G(PSD(4))=1) D  G:$D(DIRUT)!($G(Y)<1) DRUG
"RTN","PSDORNV",69,0)
 .S PSDT(8)=0,Y=$P(PSDR(2),U,3),C=$P(^DD(52.6,2,0),U,2) D Y^DIQ
"RTN","PSDORNV",70,0)
 .S PSDR(1)=Y,DIR(0)="NA^0:99999:3",DIR("A")="Dosage in "_PSDR(1)_"s: "
"RTN","PSDORNV",71,0)
 .W ! D ^DIR K DIR Q:$D(DIRUT)  S PSDR(1)=Y_" "_PSDR(1)
"RTN","PSDORNV",72,0)
 .S DIC="^PS(52.7,",DIC(0)="AEMQZ" W ! D ^DIC K DIC Q:Y<1
"RTN","PSDORNV",73,0)
 .S PSDR(1)=PSDR(1)_" in "_$P(Y(0),U,3)_" of "_$P(Y,U,2) W PSDR(1)
"RTN","PSDORNV",74,0)
 S DIR(0)="DA^NOW::AEFT",DIR("A")="Date/time required: "
"RTN","PSDORNV",75,0)
 S DIR("?",1)="You are on the verge of creating an unscheduled order."
"RTN","PSDORNV",76,0)
 S DIR("?",2)="If this is a mistake, enter ""^"" to create a scheduled order, otherwise,"
"RTN","PSDORNV",77,0)
 S DIR("?")="Pharmacy needs to know how soon you need this order."
"RTN","PSDORNV",78,0)
 W ! D ^DIR K DIR G:$D(DIRUT) DRUG X ^DD("DD") S PSDT(9)=Y
"RTN","PSDORNV",79,0)
 S PSDQTY=PSDT(8),CNT=0 D DIE^PSDORN0 G:$G(PSDOUT) END D ^PSDORN2 K PSDEM G:PSDOUT END G PAT
"RTN","PSDORNV",80,0)
 I PSDT(8)["?"!(PSDT(8)'?1.N)!(PSDT(8)#NPKG)!('PSDT(8)) W !!,"Quantity must be "_NPKG_" or a multiple of "_NPKG,! G QTY
"RTN","PSDORNV",81,0)
 S CNT=PSDT(8)/NPKG W !!,"This will be "_CNT_" separate order requests.  The quantity is "_NPKG_" per request."
"RTN","PSDORNV",82,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORNV",83,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORNV",84,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORNV",85,0)
 I Y W !!,"The "_CNT_" requests are being created.  You must review every request.",! S PSDQTY=NPKG D  G:$G(PSDOUT) END D ^PSDORN1
"RTN","PSDORNV",86,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE^PSDORN0 Q:$G(PSDOUT)  S ORD(ORD)=PSDA
"RTN","PSDORNV",87,0)
 G:'PSDOUT DRUG
"RTN","PSDORNV",88,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORNV",89,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORNV",90,0)
 Q
"RTN","PSDORNV",91,0)
MSG ;display error message
"RTN","PSDORNV",92,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORNV",93,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORNV",94,0)
 Q
"RTN","PSDORP")
0^162^B22890772
"RTN","PSDORP",1,0)
PSDORP ;BIR/JPW-Pharm CS Order Request Entry ; 8 Aug 94
"RTN","PSDORP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORP",3,0)
 W !!,"Controlled Substances Order Entry",!! S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^"),(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDORP",4,0)
NAOU ;select NAOU to order supplies for
"RTN","PSDORP",5,0)
 K ^UTILITY($J,"W")
"RTN","PSDORP",6,0)
 N X,DIWL,DIWR,DIWF,PSD S PSD=0,DIWL=1,DIWR=80,DIWF="W"
"RTN","PSDORP",7,0)
 F  S PSD=$O(^PSD(58.8,+$P(PSDSITE,U,3),5,PSD)) Q:'PSD  S X=$G(^PSD(58.8,+$P(PSDSITE,U,3),5,PSD,0)) D ^DIWP
"RTN","PSDORP",8,0)
 D ^DIWW
"RTN","PSDORP",9,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ordering NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N"""
"RTN","PSDORP",10,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDORP",11,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDORP",12,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDORP",13,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDORP",14,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDORP",15,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDORP",16,0)
 S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDORP",17,0)
DRUG ;select drug
"RTN","PSDORP",18,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORP",19,0)
 S DA(1)=+NAOU,DIC(0)="QEAM",DIC="^PSD(58.8,"_NAOU_",1," D ^DIC K DIC G:Y<0 NAOU S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORP",20,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,0)) D MSG G END
"RTN","PSDORP",21,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORP",22,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORP",23,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORP",24,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORP",25,0)
 D LIST^PSDORL
"RTN","PSDORP",26,0)
 ;NAOU using perpetual?
"RTN","PSDORP",27,0)
 G:$P($G(^PSD(58.8,+NAOU,2)),U,5) ^PSDORP2
"RTN","PSDORP",28,0)
QTY K ORD S (CNT,PSDR(2),PSDOUT)=0
"RTN","PSDORP",29,0)
 ;DISPLAY STOCK LEVEL
"RTN","PSDORP",30,0)
 W:$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),U,3) !,"Stock Level:  ",$P($G(^(0)),U,3)," ",NBKU,!
"RTN","PSDORP",31,0)
 ;ASK QUANTITY
"RTN","PSDORP",32,0)
 S DIR(0)="NA^1:999999:0"
"RTN","PSDORP",33,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDORP",34,0)
 D ^DIR K DIR G:Y<1 END S PSDQTY=Y
"RTN","PSDORP",35,0)
 I Y=NPKG S PSDQTY=NPKG,CNT=0 D DIE,ASK^PSDORP1 G:PSDOUT END G DRUG
"RTN","PSDORP",36,0)
 ;QUANTITY EXCEEDS PACKAGE SIZE, MULTIPLE ORDERS
"RTN","PSDORP",37,0)
 S:(PSDQTY#NPKG) CNT=1,PSDR(2)=(PSDQTY#NPKG)
"RTN","PSDORP",38,0)
 S CNT=$G(CNT)+(Y\NPKG)
"RTN","PSDORP",39,0)
 W !!,"This will be "_CNT_" separate order requests,"
"RTN","PSDORP",40,0)
 W:PSDR(2) !!,"One order for ",PSDR(2)," ",NBKU,", and"
"RTN","PSDORP",41,0)
 W !!,(PSDQTY\NPKG)," order"
"RTN","PSDORP",42,0)
 W:CNT>2!('PSDR(2)&(CNT=2)) "s"
"RTN","PSDORP",43,0)
 W " for ",NPKG," ",NBKU,"."
"RTN","PSDORP",44,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORP",45,0)
 S DIR("?")="Answer 'NO' to edit your quantity or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORP",46,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORP",47,0)
 I Y W !!,"The "_CNT_" requests are being created.  You must review every request.",! S PSDQTY=$S(PSDR(2):PSDR(2),1:NPKG) D  D ^PSDORP1 S PSDQTY=NPKG
"RTN","PSDORP",48,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE S ORD(ORD)=PSDA
"RTN","PSDORP",49,0)
 G:'PSDOUT DRUG
"RTN","PSDORP",50,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORP",51,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZA,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORP",52,0)
 Q
"RTN","PSDORP",53,0)
DIE ;create the order request
"RTN","PSDORP",54,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORP",55,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORP",56,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORP",57,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORP",58,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_PSDS_";10////1;5////"_PSDQTY_";13;3//^S X=PSDUZN" D ^DIE K DIE,DR
"RTN","PSDORP",59,0)
 S PSDUZA=+$P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",4)
"RTN","PSDORP",60,0)
 Q
"RTN","PSDORP",61,0)
MSG ;display error message
"RTN","PSDORP",62,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"PSDR")_" is missing "
"RTN","PSDORP",63,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORP",64,0)
 Q
"RTN","PSDORP1")
0^163^B15178147
"RTN","PSDORP1",1,0)
PSDORP1 ;BIR/JPW-Pharm CS Order Entry (cont'd) ; 2 Aug 94
"RTN","PSDORP1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORP1",3,0)
 ;MULTIPLE ORDERS
"RTN","PSDORP1",4,0)
 I $D(ORD) F CNT1=1:1:CNT S PSDA=+ORD(CNT1) S:$G(PSDR(2))&(CNT1=1) PSDQTY=PSDR(2) D ASK
"RTN","PSDORP1",5,0)
 Q
"RTN","PSDORP1",6,0)
ASK ;displays order for review
"RTN","PSDORP1",7,0)
 D DISPLAY
"RTN","PSDORP1",8,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORP1",9,0)
 S DIR("?",2)="or 'NO' to edit or delete this request",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORP1",10,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORP1",11,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORP1",12,0)
 I Y N X,X1 D SIG^XUSESIG S:X1="" PSDOUT=1 D:X1="" DEL Q:X1=""  D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT W ?32,"Sent to Pharmacy...",!! R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORP1",13,0)
 Q
"RTN","PSDORP1",14,0)
DISPLAY ;displays order request to screen
"RTN","PSDORP1",15,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORP1",16,0)
 W @IOF,!,?23,"Controlled Substance Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDORP1",17,0)
 W !!,"Pharmacy Dispensing #: ",!,"Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^"),?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDORP1",18,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORP1",19,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORP1",20,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORP1",21,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORP1",22,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORP1",23,0)
 I  D ^DIWW
"RTN","PSDORP1",24,0)
 Q
"RTN","PSDORP1",25,0)
EDIT ;edit or delete order request
"RTN","PSDORP1",26,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORP1",27,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORP1",28,0)
 I "Dd"[X D DEL Q
"RTN","PSDORP1",29,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="3;13" D ^DIE K DIE,DR
"RTN","PSDORP1",30,0)
 Q
"RTN","PSDORP1",31,0)
DEL ;deletes order request
"RTN","PSDORP1",32,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORP1",33,0)
 Q
"RTN","PSDORP1",34,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORP1",35,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDORP1",36,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORP1",37,0)
 K DA,DIC,DIE,DR,DLAYGO S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORP1",38,0)
 L -^PSD(58.85,0)
"RTN","PSDORP1",39,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORP1",40,0)
 S DA=PSDREC,DR="1////"_PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZA_";19////"_PSDRD_";20////"_PSDUZ D ^DIE K DIE
"RTN","PSDORP1",41,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORP1",42,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORP1",43,0)
 K DA,DIC,DIE,DLAYGO,DR,PSDREC,WORD S PSDQTY=$S($G(PSDR(1)):PSDR(1),1:NPKG)
"RTN","PSDORP1",44,0)
 Q
"RTN","PSDORP2")
0^164^B16047567
"RTN","PSDORP2",1,0)
PSDORP2 ;BIR/JPW,LTL-Pharm CS Order Request Entry ; 22 Jun 94
"RTN","PSDORP2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORP2",3,0)
QTY K ORD S (CNT,PSDR(2),PSDOUT)=0
"RTN","PSDORP2",4,0)
 ;DISPLAY STOCK LEVEL
"RTN","PSDORP2",5,0)
 W:$P($G(^PSD(58.8,+NAOU,1,+PSDR,0)),U,3) !,"Stock Level:  ",$P($G(^(0)),U,3)," ",NBKU,!
"RTN","PSDORP2",6,0)
 ;Dispensing Sites's Max Qty per order
"RTN","PSDORP2",7,0)
 S PSDR(1)=$P($G(^PSD(58.8,+PSDS,1,+PSDR,0)),U,7)
"RTN","PSDORP2",8,0)
 ;ASK QUANTITY
"RTN","PSDORP2",9,0)
 S DIR(0)="NA^1:999999:0"
"RTN","PSDORP2",10,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDORP2",11,0)
 S:PSDR(1) DIR("A",1)="Maximum quantity per order:  "_PSDR(1)_" "_NBKU,DIR("A",2)=""
"RTN","PSDORP2",12,0)
 S DIR("?",1)="Because "_NAOUN_" is keeping a perpetual inventory,"
"RTN","PSDORP2",13,0)
 S DIR("?",2)=$S(PSDR(1):"a maximum quantity of "_PSDR(1)_" "_NBKU_" per order",1:"no maximum order quantity")_" has been set for "_PSDRN_"."
"RTN","PSDORP2",14,0)
 S:PSDR(1) DIR("?")="If you request more than "_PSDR(1)_" "_NBKU_", multiple orders will be generated.",DIR("?",3)="for "_PSDRN_".",DIR("?",4)=""
"RTN","PSDORP2",15,0)
 D ^DIR K DIR G:Y<1 END S PSDQTY=Y
"RTN","PSDORP2",16,0)
 ;quantity ordered is equal to or less than max ord qty
"RTN","PSDORP2",17,0)
NOMAX I 'PSDR(1)!(Y'>PSDR(1)) D DIE,ASK^PSDORP1 G:PSDOUT END G DRUG^PSDORP
"RTN","PSDORP2",18,0)
 ;QUANTITY EXCEEDS MAX ORD QTY, MULTIPLE ORDERS
"RTN","PSDORP2",19,0)
 S:(PSDQTY#PSDR(1)) CNT=1,PSDR(2)=(PSDQTY#PSDR(1))
"RTN","PSDORP2",20,0)
 S CNT=$G(CNT)+(Y\PSDR(1))
"RTN","PSDORP2",21,0)
 W !!,"This will be "_CNT_" separate order requests,"
"RTN","PSDORP2",22,0)
 W:PSDR(2) !!,"One order for ",PSDR(2)," ",NBKU,", and"
"RTN","PSDORP2",23,0)
 W !!,(PSDQTY\PSDR(1))," order"
"RTN","PSDORP2",24,0)
 W:CNT>2!('PSDR(2)&(CNT=2)) "s"
"RTN","PSDORP2",25,0)
 W " for ",PSDR(1)," ",NBKU,"."
"RTN","PSDORP2",26,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORP2",27,0)
 S DIR("?")="Answer 'NO' to edit your quantity or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORP2",28,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORP2",29,0)
 I Y W !!,"The "_CNT_" requests are being created.  You must review every request.",! S PSDQTY=$S(PSDR(2):PSDR(2),1:PSDR(1)) D  D ^PSDORP1 S PSDQTY=PSDR(1)
"RTN","PSDORP2",30,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE S ORD(ORD)=PSDA
"RTN","PSDORP2",31,0)
 G:'PSDOUT DRUG^PSDORP
"RTN","PSDORP2",32,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORP2",33,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZA,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORP2",34,0)
 Q
"RTN","PSDORP2",35,0)
DIE ;create the order request
"RTN","PSDORP2",36,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORP2",37,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORP2",38,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORP2",39,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORP2",40,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_PSDS_";10////1;5////"_PSDQTY_";13;3//^S X=PSDUZN" D ^DIE K DIE,DR
"RTN","PSDORP2",41,0)
 S PSDUZA=+$P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",4)
"RTN","PSDORP2",42,0)
 Q
"RTN","PSDORP2",43,0)
MSG ;display error message
"RTN","PSDORP2",44,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"PSDR")_" is missing "
"RTN","PSDORP2",45,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORP2",46,0)
 Q
"RTN","PSDORSN")
0^165^B19429676
"RTN","PSDORSN",1,0)
PSDORSN ;BIR/JPW-Nurse Order Stats Report ; 8 Aug 94
"RTN","PSDORSN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORSN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDORSN",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,$D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDORSN",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to",!,?12,"print this report.",!!,"PSJ RPHARM, PSJ PHARM TECH, PSJ RNURSE, or PSD NURSE security key required.",! K OK Q
"RTN","PSDORSN",6,0)
ASKN ;ask naou
"RTN","PSDORSN",7,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDORSN",8,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)" D ^DIC K DIC G:Y<0 END
"RTN","PSDORSN",9,0)
 S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDORSN",10,0)
ALL ;asks for all orders
"RTN","PSDORSN",11,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print this report for all drugs",DIR("B")="NO"
"RTN","PSDORSN",12,0)
 S DIR("?",1)="Answer 'YES' to list all pending orders for this NAOU,",DIR("?")="answer 'NO' to list orders for a specific drug or '^' to quit."
"RTN","PSDORSN",13,0)
 D ^DIR K DIR G:$D(DIRUT) END S ALL=+Y
"RTN","PSDORSN",14,0)
 G:ALL DEV
"RTN","PSDORSN",15,0)
DRUG ;select drugs
"RTN","PSDORSN",16,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORSN",17,0)
 S DA(1)=+NAOU,DIC(0)="QEAM",DIC="^PSD(58.8,"_NAOU_",1," D ^DIC K DIC G:Y<0 END S PSDR=+Y
"RTN","PSDORSN",18,0)
DEV ;ask device and queue info
"RTN","PSDORSN",19,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDORSN",20,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="HOME" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDORSN",21,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDORSN",ZTDESC="Status of Pending Narcotic Orders" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDORSN",22,0)
 U IO
"RTN","PSDORSN",23,0)
START ;loops thru pending orders and orders cancelled in the past 3 days
"RTN","PSDORSN",24,0)
 K ^TMP("PSDNST",$J)
"RTN","PSDORSN",25,0)
 D NOW^%DTC S (PSDT,X1)=X,X2=-3 D C^%DTC S PSDST=X
"RTN","PSDORSN",26,0)
 I ALL F STAT=.5:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:'STAT!(STAT>3)  D LOOP
"RTN","PSDORSN",27,0)
 I ALL S STAT=9 D:$D(^PSD(58.8,"AC",STAT)) LOOP G PRINT
"RTN","PSDORSN",28,0)
 F STAT=.5:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:'STAT!(STAT>3)  D ORD
"RTN","PSDORSN",29,0)
 S STAT=9 D:$D(^PSD(58.8,"AC",STAT,NAOU,PSDR)) ORD
"RTN","PSDORSN",30,0)
PRINT ;prints the report
"RTN","PSDORSN",31,0)
 S (PG,PSDOUT)=0,Y=PSDT X ^DD("DD") S RPDT=Y
"RTN","PSDORSN",32,0)
 K LN S $P(LN,"-",80)="" D HDR I '$D(^TMP("PSDNST",$J)) W !!,?10,"****  NO PENDING ORDERS TO REPORT  ****" G END
"RTN","PSDORSN",33,0)
 S PSDR="" F  S PSDR=$O(^TMP("PSDNST",$J,PSDR)) Q:PSDR=""!(PSDOUT)  W !!,?2,"=>  ",PSDR,! D  Q:PSDOUT
"RTN","PSDORSN",34,0)
 .F ORD=0:0 S ORD=$O(^TMP("PSDNST",$J,PSDR,ORD)) Q:'ORD!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  D
"RTN","PSDORSN",35,0)
 ..S NODE=^TMP("PSDNST",$J,PSDR,ORD) W !,$P(NODE,"^",4),?11,$P(NODE,"^",3),?33,$J($P(NODE,"^",2),6),?42,$P(NODE,"^")
"RTN","PSDORSN",36,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDORSN",37,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDORSN",38,0)
END K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,NAOU,NAOUN,NODE,OK,ORD
"RTN","PSDORSN",39,0)
 K PG,POP,PSDOUT,PSDPN,PSDR,PSDRN,PSDST,PSDT,QTY,REQ,RPDT,STAT,STATN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDORSN",40,0)
 K ^TMP("PSDNST",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDORSN",41,0)
 Q
"RTN","PSDORSN",42,0)
LOOP ;starts drug loop for all orders
"RTN","PSDORSN",43,0)
 F PSDR=0:0 S PSDR=$O(^PSD(58.8,"AC",STAT,NAOU,PSDR)) Q:'PSDR  D ORD
"RTN","PSDORSN",44,0)
 Q
"RTN","PSDORSN",45,0)
ORD ;order loop
"RTN","PSDORSN",46,0)
 F ORD=0:0 S ORD=$O(^PSD(58.8,"AC",STAT,NAOU,PSDR,ORD)) Q:'ORD  D SET
"RTN","PSDORSN",47,0)
 Q
"RTN","PSDORSN",48,0)
SET ;sets data for printing
"RTN","PSDORSN",49,0)
 Q:'$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0))  S NODE=^(0),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORSN",50,0)
 I STAT=9,$P(NODE,"^",2)<PSDST Q
"RTN","PSDORSN",51,0)
 S STATN=$P($G(^PSD(58.82,STAT,0)),"^"),STATN=$E(STATN,1,30),QTY=$P(NODE,"^",6),PSDPN=$P(NODE,"^",16),REQ=$P(NODE,"^",2) I REQ S Y=REQ X ^DD("DD") S REQ=Y
"RTN","PSDORSN",52,0)
 S ^TMP("PSDNST",$J,PSDRN,ORD)=STATN_"^"_QTY_"^"_REQ_"^"_PSDPN
"RTN","PSDORSN",53,0)
 Q
"RTN","PSDORSN",54,0)
HDR ;header for log
"RTN","PSDORSN",55,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDORSN",56,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"Status of Pending Narcotic Orders",?70,"Page: ",PG,!,?35,NAOUN,!,?35,RPDT,!
"RTN","PSDORSN",57,0)
 W !,?2,"=> DRUG",!,?13,"DATE",?33,"QUANTITY",!,"DISP #",?12,"ORDERED",?33,"ORDERED",?48,"ORDER STATUS"
"RTN","PSDORSN",58,0)
 W !,LN,!
"RTN","PSDORSN",59,0)
 Q
"RTN","PSDORSN",60,0)
SAVE S (ZTSAVE("ALL"),ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" S:$D(PSDR) ZTSAVE("PSDR")=""
"RTN","PSDORSN",61,0)
 Q
"RTN","PSDORST")
0^166^B17319849
"RTN","PSDORST",1,0)
PSDORST ;BIR/JPW-Pharmacy Vault Order Stats Report ; 29 Aug 94
"RTN","PSDORST",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORST",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDORST",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDORST",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print this status report.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDORST",6,0)
ASKD ;ask dispensing location
"RTN","PSDORST",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDORST",8,0)
 G:$P(PSDSITE,U,5) DEV
"RTN","PSDORST",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDORST",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDORST",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDORST",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDORST",13,0)
DEV ;ask device and queue info
"RTN","PSDORST",14,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDORST",15,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDORST",16,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDORST",17,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDORST",ZTDESC="Pharm Status of Pending Narcotic Orders",(ZTSAVE("PSDS"),ZTSAVE("PSDSN"))="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDORST",18,0)
 U IO
"RTN","PSDORST",19,0)
START ;loops thru pending orders and orders cancelled in the past 3 days
"RTN","PSDORST",20,0)
 K ^TMP("PSDTST",$J)
"RTN","PSDORST",21,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDORST",22,0)
 F STAT=0:0 S STAT=$O(^PSD(58.85,"AC",STAT)) Q:'STAT!(STAT>2)  F NAOU=0:0 S NAOU=$O(^PSD(58.85,"AC",STAT,NAOU)) Q:'NAOU  D LOOP
"RTN","PSDORST",23,0)
PRINT ;prints the report
"RTN","PSDORST",24,0)
 S (PG,PSDOUT)=0,Y=PSDT X ^DD("DD") S RPDT=Y
"RTN","PSDORST",25,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDTST",$J)) D HDR W !!,?10,"****  NO PENDING ORDERS TO REPORT  ****" G END
"RTN","PSDORST",26,0)
 D HDR
"RTN","PSDORST",27,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDTST",$J,DRUG)) Q:DRUG=""!(PSDOUT)  W !,?2,"=>  ",DRUG,!! F ORD=0:0 S ORD=$O(^TMP("PSDTST",$J,DRUG,ORD)) Q:'ORD!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDORST",28,0)
 .S NODE=^TMP("PSDTST",$J,DRUG,ORD) I $Y+5>IOSL D HDR Q:PSDOUT  W !,?2,"=> ",DRUG,!!
"RTN","PSDORST",29,0)
 .W $P(NODE,"^",4),?11,$P(NODE,"^",3),?33,$P(NODE,"^",2),?40,$E($P(NODE,"^",5),1,12),?58,$P($P(NODE,"^"),"-"),!,?55,$P($P(NODE,"^"),"-",2),!!
"RTN","PSDORST",30,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDORST",31,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDORST",32,0)
END K %,%H,%I,%ZIS,C,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NAOUN,NODE,OK,ORD
"RTN","PSDORST",33,0)
 K PG,PSDA,PSDEV,PSDOUT,PSDPN,PSDS,PSDSN,PSDT,QTY,REQ,RPDT,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDORST",34,0)
 K ^TMP("PSDTST",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDORST",35,0)
 Q
"RTN","PSDORST",36,0)
LOOP ;starts drug loop for all orders
"RTN","PSDORST",37,0)
 F DRUG=0:0 S DRUG=$O(^PSD(58.85,"AC",STAT,NAOU,DRUG)) Q:'DRUG  F ORD=0:0 S ORD=$O(^PSD(58.85,"AC",STAT,NAOU,DRUG,ORD)) Q:'ORD  S PSDA=$O(^PSD(58.85,"AC",STAT,NAOU,DRUG,ORD,0)) I PSDA D SET
"RTN","PSDORST",38,0)
 Q
"RTN","PSDORST",39,0)
SET ;sets data for printing
"RTN","PSDORST",40,0)
 Q:'$D(^PSD(58.85,PSDA,0))  S NODE=^(0) Q:+$P(NODE,"^",2)'=+PSDS
"RTN","PSDORST",41,0)
 S DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORST",42,0)
 S NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"NAOU NAME MISSING")
"RTN","PSDORST",43,0)
 S STATN=$P($G(^PSD(58.82,STAT,0)),"^"),STATN=$E(STATN,1,30),QTY=$P(NODE,"^",6),PSDPN=$P(NODE,"^",15),REQ=$P(NODE,"^",18) I REQ S Y=REQ X ^DD("DD") S REQ=Y
"RTN","PSDORST",44,0)
 S ^TMP("PSDTST",$J,DRUGN,PSDA)=STATN_"^"_QTY_"^"_REQ_"^"_PSDPN_"^"_NAOUN
"RTN","PSDORST",45,0)
 Q
"RTN","PSDORST",46,0)
HDR ;header for log
"RTN","PSDORST",47,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDORST",48,0)
 S PG=PG+1 W:$Y @IOF W !,?20,"Pharmacy Status of Pending Narcotic Orders",?70,"Page: ",PG,!,?35,PSDSN,!,?35,RPDT,!
"RTN","PSDORST",49,0)
 W !,?2,"=> DRUG",!,?13,"DATE",!,"DISP #",?12,"ORDERED",?32,"QTY",?40,"NAOU",?55,"ORDER STATUS"
"RTN","PSDORST",50,0)
 W !,LN,!
"RTN","PSDORST",51,0)
 Q
"RTN","PSDORSU")
0^496^B1990201
"RTN","PSDORSU",1,0)
PSDORSU ;BIR/JPW,LTL-Nurse Order Stats Report ; 8 Aug 94
"RTN","PSDORSU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORSU",3,0)
 W !!,"You are about to adjust the balance upward.",!!
"RTN","PSDORSU",4,0)
 W "Before you do, let's check to see if there are any orders that need receiving."
"RTN","PSDORSU",5,0)
 N AOU,STAT,ORD S STAT=3
"RTN","PSDORSU",6,0)
 S:'$G(NAOU) NAOU=PSDLOC
"RTN","PSDORSU",7,0)
 S AOU=NAOU,ORD=0
"RTN","PSDORSU",8,0)
 S:$G(PSDRUG) PSDR=PSDRUG
"RTN","PSDORSU",9,0)
ORD ;order loop
"RTN","PSDORSU",10,0)
 S:'$D(^XUSEC("PSJ RNURSE",DUZ))&('$D(^XUSEC("PSD NURSE",DUZ))) STAT(1)=1
"RTN","PSDORSU",11,0)
 F  S ORD=$O(^PSD(58.8,"AC",STAT,NAOU,PSDR,ORD)) Q:'ORD  D  Q:$D(DIRUT)!($G(PSDOUT))
"RTN","PSDORSU",12,0)
 .S ORD(1)=$G(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),PSDA=$P(ORD(1),U,17)
"RTN","PSDORSU",13,0)
 .W !!,"Pharmacy Dispensing #: ",$P(ORD(1),U,16)
"RTN","PSDORSU",14,0)
 .W "  Date/time ordered: ",$$FMTE^XLFDT($P(ORD(1),U,2),"2P")
"RTN","PSDORSU",15,0)
 .W "  Quantity: ",$P(ORD(1),U,6)
"RTN","PSDORSU",16,0)
 .Q:$G(STAT(1))
"RTN","PSDORSU",17,0)
 .S DIR(0)="Y",DIR("A")="Receive now" W ! D ^DIR K DIR
"RTN","PSDORSU",18,0)
 .S:$D(DIRUT) PSDOUT=1 Q:Y'=1
"RTN","PSDORSU",19,0)
 .S Y(0)=$G(^PSD(58.81,+PSDA,0)) D ORD^PSDNRGO
"RTN","PSDORSU",20,0)
 Q
"RTN","PSDORV")
0^167^B16936413
"RTN","PSDORV",1,0)
PSDORV ;BIR/JPW-IV Pharm CS Order Request Entry ; 8 Aug 94
"RTN","PSDORV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORV",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDORV",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):2,$D(^XUSEC("PSJ PHARM TECH",DUZ)):2,1:0)
"RTN","PSDORV",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDORV",6,0)
 W !!,"Controlled Substances Order Entry",!! S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^"),(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDORV",7,0)
NAOU ;select NAOU to order supplies for
"RTN","PSDORV",8,0)
 K ^UTILITY($J,"W")
"RTN","PSDORV",9,0)
 N X,DIWL,DIWR,DIWF,PSD S PSD=0,DIWL=1,DIWR=80,DIWF="W"
"RTN","PSDORV",10,0)
 F  S PSD=$O(^PSD(58.8,+$P(PSDSITE,U,3),5,PSD)) Q:'PSD  S X=$G(^PSD(58.8,+$P(PSDSITE,U,3),5,PSD,0)) D ^DIWP
"RTN","PSDORV",11,0)
 D ^DIWW
"RTN","PSDORV",12,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ordering NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N"""
"RTN","PSDORV",13,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDORV",14,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDORV",15,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDORV",16,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDORV",17,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDORV",18,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDORV",19,0)
 S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDORV",20,0)
DRUG ;select drug
"RTN","PSDORV",21,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORV",22,0)
 S DA(1)=+NAOU,DIC(0)="QEAM",DIC="^PSD(58.8,"_NAOU_",1," D ^DIC K DIC G:Y<0 END S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORV",23,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,0)) D MSG G END
"RTN","PSDORV",24,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORV",25,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORV",26,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORV",27,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORV",28,0)
 D LIST^PSDORL
"RTN","PSDORV",29,0)
QTY K ORD S PSDOUT=0 W !!,"QUANTITY ("_NBKU_"/"_NPKG_"): "_NPKG_"// " R X:DTIME I '$T!(X["^") G END
"RTN","PSDORV",30,0)
 S:X="" (X,PSDQTY)=NPKG I X["?"!(X'?1.N)!('X)!(X>999999) W !!,"Quantity must be a whole number between 1 and 999999",! G QTY
"RTN","PSDORV",31,0)
 S PSDQTY=X,CNT=0 D DIE,ASK^PSDORV1 G:PSDOUT END G DRUG
"RTN","PSDORV",32,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORV",33,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDOUT,PSDQTY,PSDR,PSDRD,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORV",34,0)
 Q
"RTN","PSDORV",35,0)
DIE ;create the order request
"RTN","PSDORV",36,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORV",37,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORV",38,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORV",39,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORV",40,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_PSDS_";3////"_PSDUZ_";10////1;5////"_PSDQTY_";13" D ^DIE K DIE,DR
"RTN","PSDORV",41,0)
 Q
"RTN","PSDORV",42,0)
MSG ;display error message
"RTN","PSDORV",43,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"DRUG")_" is missing "
"RTN","PSDORV",44,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORV",45,0)
 Q
"RTN","PSDORV1")
0^168^B13220403
"RTN","PSDORV1",1,0)
PSDORV1 ;BIR/JPW-IV Pharm CS Order Entry (cont'd) ; 2 Aug 94
"RTN","PSDORV1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDORV1",3,0)
ASK ;displays order for review
"RTN","PSDORV1",4,0)
 D DISPLAY
"RTN","PSDORV1",5,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK",DIR("?",1)="Answer 'YES' to send this request to pharmacy for processing,"
"RTN","PSDORV1",6,0)
 S DIR("?",2)="or 'NO' to edit or delete this request,",DIR("?")="or '^' to quit and DELETE this CS order request." D ^DIR K DIR
"RTN","PSDORV1",7,0)
 I $D(DIRUT) S PSDOUT=1 D DEL Q
"RTN","PSDORV1",8,0)
 I 'Y D EDIT Q:PSDOUT  G ASK
"RTN","PSDORV1",9,0)
 I Y D PHARM W !! W:$D(ORD) "Your order request #"_CNT1_" of "_CNT W ?32,"Sent to Pharmacy...",!! R:$D(ORD) "Press <RET> to continue",X:DTIME,!!
"RTN","PSDORV1",10,0)
 Q
"RTN","PSDORV1",11,0)
DISPLAY ;displays order request to screen
"RTN","PSDORV1",12,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDORV1",13,0)
 W @IOF,!,?23,"Controlled Substance Order Request" I $D(ORD) W " # "_CNT1_" of "_CNT
"RTN","PSDORV1",14,0)
 W !!,"Pharmacy Dispensing #: ",!,"Requested by",?16,": ",$P($G(^VA(200,PSDUZ,0)),"^"),?52,"Request Date: ",REQD,!,LN,!
"RTN","PSDORV1",15,0)
 W !,"Drug",?16,": ",PSDRN,?56,"Quantity: ",?66,PSDQTY,!,"Dispensed by",?16,": N/A",?50,"Dispensed Date: N/A"
"RTN","PSDORV1",16,0)
 W !,"Disp. Location",?16,": " W:+PSDS $P($G(^PSD(58.8,+PSDS,0)),"^") W !,"Exp. Date",?16,": ",!,"Manufacturer",?16,": ",!,"Lot #",?16,": "
"RTN","PSDORV1",17,0)
 W !,"Ord. Location",?16,": ",NAOUN,!,"Order Status",?16,": ",$P($G(^PSD(58.82,1,0)),"^"),!,"Comments:"
"RTN","PSDORV1",18,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT)) Q:'TEXT  D
"RTN","PSDORV1",19,0)
 .S X=$G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,TEXT,0)),DIWL=5,DIWR=75,DIWF="W" D ^DIWP
"RTN","PSDORV1",20,0)
 I  D ^DIWW
"RTN","PSDORV1",21,0)
 Q
"RTN","PSDORV1",22,0)
EDIT ;edit or delete order request
"RTN","PSDORV1",23,0)
 W !!,"Edit or Delete this Order Request:  EDIT//  " R X:DTIME I '$T S PSDOUT=1 D DEL Q
"RTN","PSDORV1",24,0)
 Q:X["^"  S X=$E(X) S:X="" X="E" I "EeDd"'[X W !!,"Press <RET> to edit this order request, or enter 'D' to delete the request.",! G EDIT
"RTN","PSDORV1",25,0)
 I "Dd"[X D DEL Q
"RTN","PSDORV1",26,0)
 K DA,DIE,DR S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DR="3;13" D ^DIE K DIE,DR
"RTN","PSDORV1",27,0)
 Q
"RTN","PSDORV1",28,0)
DEL ;deletes order request
"RTN","PSDORV1",29,0)
 S PSDOUT=1 W !!,?25,"Request being deleted...",! K DIK S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DIK="^PSD(58.8,"_NAOU_",1,"_PSDR_",3," D ^DIK K DIK
"RTN","PSDORV1",30,0)
 Q
"RTN","PSDORV1",31,0)
PHARM ;create worksheet entry in file 58.85
"RTN","PSDORV1",32,0)
 W ?5,!!,"Processing your request now..." F  L +^PSD(58.85,0):0 I  Q
"RTN","PSDORV1",33,0)
ADD S PSDREC=$P(^PSD(58.85,0),"^",3)+1 I $D(^PSD(58.85,PSDREC)) S $P(^PSD(58.85,0),"^",3)=PSDREC G ADD
"RTN","PSDORV1",34,0)
 K DA,DIC,DIE,DR,DLAYGO S (DIC,DIE,DLAYGO)=58.85,DIC(0)="L",X=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDORV1",35,0)
 L -^PSD(58.85,0)
"RTN","PSDORV1",36,0)
 S PSDRD=$S($P($G(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0)),"^",2):$P(^(0),"^",2),1:DT)
"RTN","PSDORV1",37,0)
 S DA=PSDREC,DR="1////"_PSDS_";2////"_NAOU_";3////"_PSDR_";4////"_PSDA_";5////"_PSDQTY_";6////1;12////"_PSDUZ_";19////"_PSDRD D ^DIE K DIE
"RTN","PSDORV1",38,0)
 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0)) S ^PSD(58.85,PSDREC,1,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,0) D
"RTN","PSDORV1",39,0)
 .F WORD=0:0 S WORD=$O(^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD)) Q:'WORD  S ^PSD(58.85,PSDREC,1,WORD,0)=^PSD(58.8,NAOU,1,PSDR,3,PSDA,1,WORD,0)
"RTN","PSDORV1",40,0)
 K DA,DIC,DIE,DLAYGO,DR,PSDREC,WORD
"RTN","PSDORV1",41,0)
 Q
"RTN","PSDPAT")
0^169^B13997882
"RTN","PSDPAT",1,0)
PSDPAT ;B'ham ISC/JPW - Prt Data from TRAKKER (Patient/Drug) ; 27 Jan 94
"RTN","PSDPAT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPAT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPAT",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDPAT",5,0)
 ;I 'OK W $C(7),!!,"Contact your Nursing ADP Coordinator for access to display the Dispensing Report.",!! K OK Q
"RTN","PSDPAT",6,0)
SUM ;ask detail or summary
"RTN","PSDPAT",7,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DETAIL LISTING ONLY;S:SUMMARY LISTING ONLY"
"RTN","PSDPAT",8,0)
 S DIR("A")="Select Dispensing Report(s) to Print"
"RTN","PSDPAT",9,0)
 S DIR("?",1)="Answer 'D' to print only the transaction detail for this report,",DIR("?",2)="answer 'S' to print only the summary totals  or <RET> to quit."
"RTN","PSDPAT",10,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDPAT",11,0)
ASKN ;select NAOU for report
"RTN","PSDPAT",12,0)
 K DA,DIC
"RTN","PSDPAT",13,0)
 S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: ",DIC("B")=$G(NAOUN)
"RTN","PSDPAT",14,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDPAT",15,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDPAT",16,0)
 I '+$P($G(^PSD(58.8,NAOU,2)),"^",5) W !!,"This NAOU does not maintain a perpetual inventory balance to list",!,"Dispensing data.",!! K NAOU,NAOUN G ASKN
"RTN","PSDPAT",17,0)
CHKD I '$O(^PSD(58.8,NAOU,1,0)) W !!,"There are no CS stocked drugs for the NAOU you selected.",!! G ASKN
"RTN","PSDPAT",18,0)
DRUG ;ask drug
"RTN","PSDPAT",19,0)
 W !!,?5,"You may select a single drug, several drugs,",!,?5,"or enter ^ALL to select all drugs.",!!
"RTN","PSDPAT",20,0)
 W ! K DA,DIC
"RTN","PSDPAT",21,0)
 F  S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***""",DA(1)=+NAOU,DIC(0)="QEAMZ",DIC="^PSD(58.8,"_NAOU_",1," D ^DIC K DIC Q:Y<0  D
"RTN","PSDPAT",22,0)
 .S PSDRG(+Y)=+$P(Y(0),"^",4)
"RTN","PSDPAT",23,0)
 I '$D(PSDRG)&(X'="^ALL") G END
"RTN","PSDPAT",24,0)
 I X="^ALL" S ALL=1
"RTN","PSDPAT",25,0)
DATE W ! K %DT S %DT="AEXR",%DT("A")="Start with Date and Time: " D ^%DT I Y<0 G END
"RTN","PSDPAT",26,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date and Time: " D ^%DT I Y<0 G END
"RTN","PSDPAT",27,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDPAT",28,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.0001
"RTN","PSDPAT",29,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPAT",30,0)
DEV ;sel device
"RTN","PSDPAT",31,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS="QM" D ^%ZIS I POP W !!,"NO DEVICE SELECTED OR REPORT PRINTED!!",! G END
"RTN","PSDPAT",32,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPAT1",ZTDESC="CS PHARM Compile Patient/Drug Activity" D SAVE,^%ZTLOAD K ZTSK G END
"RTN","PSDPAT",33,0)
 U IO G START^PSDPAT1
"RTN","PSDPAT",34,0)
END ;
"RTN","PSDPAT",35,0)
 D KVAR^VADPT K VA
"RTN","PSDPAT",36,0)
 K %,%DT,%H,%I,%ZIS,ALL,CNT,DA,DATE,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,LOOP,NAOU,NAOUN,NODE,NODE9,NUR1,NUR2
"RTN","PSDPAT",37,0)
 K PAT,PG,POP,PSD,PSD1,PSDA,PSDATE,PSDED,PSDOUT,PSDPN,PSDR,PSDRG,PSDRGN,PSDSD,TYP,QTY,SUM,X,Y
"RTN","PSDPAT",38,0)
 K ^TMP("PSDPAT",$J),^TMP("PSDPATL",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPAT",39,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPAT",40,0)
 Q
"RTN","PSDPAT",41,0)
SAVE ;sets variables for queueing
"RTN","PSDPAT",42,0)
 S (ZTSAVE("NAOU"),ZTSAVE("NAOUN"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"),ZTSAVE("PSDIO"),ZTSAVE("SUM"))=""
"RTN","PSDPAT",43,0)
 S:$D(ALL) ZTSAVE("ALL")="" S:$D(PSDRG) ZTSAVE("PSDRG(")=""
"RTN","PSDPAT",44,0)
 Q
"RTN","PSDPAT1")
0^170^B26977789
"RTN","PSDPAT1",1,0)
PSDPAT1 ;B'ham ISC/JPW - Prt activity report (Patient/Drug) ; 1 Feb 94
"RTN","PSDPAT1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPAT1",3,0)
START ;entry for compile and print
"RTN","PSDPAT1",4,0)
 K ^TMP("PSDPAT",$J) S (AQTY,CNT)=0
"RTN","PSDPAT1",5,0)
 I $D(ALL) F PSDR=0:0 S PSDR=$O(^PSD(58.8,+NAOU,1,PSDR)) Q:'PSDR  I $D(^PSD(58.8,+NAOU,1,+PSDR,0)) S PSDRG(+PSDR)=+$P(^(0),"^",4)
"RTN","PSDPAT1",6,0)
 F PSDR=0:0 S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD!(PSD>PSDED)  D
"RTN","PSDPAT1",7,0)
 .F TYP=0:0 S TYP=$O(^PSD(58.81,"ACT",PSD,+NAOU,PSDR,TYP)) Q:'TYP  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSD,+NAOU,PSDR,TYP,PSDA)) Q:'PSDA  D SET
"RTN","PSDPAT1",8,0)
 F PSDR=0:0 S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  F PSDA=0:0 S PSDA=$O(^PSD(58.8,+NAOU,1,PSDR,3,PSDA)) Q:'PSDA  D
"RTN","PSDPAT1",9,0)
 .Q:'$D(^PSD(58.8,NAOU,1,PSDR,3,PSDA,0))  S NODE=^(0),PSD=$P(NODE,"^",15)
"RTN","PSDPAT1",10,0)
 .I (PSD>PSDSD),(PSD<PSDED) D
"RTN","PSDPAT1",11,0)
 ..S NUR1=+$P(NODE,"^",7),NUR2="",QTY=+$P(NODE,"^",20),PAT="PHARMACY DISP #"_$P(NODE,U,16),PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR_" NAME MISSING")
"RTN","PSDPAT1",12,0)
 ..I (TYP=18)!(TYP=17) S $P(PSDRG(+PSDR),"^",2)=+$P(PSDRG(+PSDR),"^",2)+QTY
"RTN","PSDPAT1",13,0)
 ..S NUR1=$S($P($G(^VA(200,NUR1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPAT1",14,0)
 ..S NODE9="",$P(NODE,U,16)="",TYP=0
"RTN","PSDPAT1",15,0)
 ..S $P(NODE,U,10)=$P(NODE,U,22) D SET1
"RTN","PSDPAT1",16,0)
 F  S PSDR=$O(PSDRG(PSDR)) Q:'PSDR  I $G(PSDRG(PSDR))  S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),U)]"":$P(^(0),U),1:"ZZ/"_PSDR_" NAME MISSING") D:'$D(^TMP("PSDPAT",$J,PSDRN))
"RTN","PSDPAT1",17,0)
 .S ^TMP("PSDPAT",$J,PSDRN,DT,"NO ACTIVITY",1)=0
"RTN","PSDPAT1",18,0)
 .S ^TMP("PSDPATL",$J,PSDRN)=U_PSDRG(PSDR)
"RTN","PSDPAT1",19,0)
PRINT ;prints data
"RTN","PSDPAT1",20,0)
 I SUM="S" D ^PSDPAT2 G DONE
"RTN","PSDPAT1",21,0)
 S (PG,PSDOUT,AQTY)=0,PSDRN="",$P(LN,"-",132)=""
"RTN","PSDPAT1",22,0)
 I '$D(^TMP("PSDPAT",$J)) D HDR W !!,?15,"**** NO DISPENSING ACTIVITY ****",!! G DONE
"RTN","PSDPAT1",23,0)
 D HDR S PSDRG="" F  S PSDRG=$O(^TMP("PSDPAT",$J,PSDRG)) Q:PSDRG=""!(PSDOUT)  W !,?5,"=> ",PSDRG,! D CHK F PSD=0:0 S PSD=$O(^TMP("PSDPAT",$J,PSDRG,PSD)) D:'PSD TOT Q:PSD=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPAT1",24,0)
 .S PAT="" F  S PAT=$O(^TMP("PSDPAT",$J,PSDRG,PSD,PAT)) Q:PAT=""!(PSDOUT)  F PSD1=0:0 S PSD1=$O(^TMP("PSDPAT",$J,PSDRG,PSD,PAT,PSD1)) Q:'PSD1!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPAT1",25,0)
 ..S NODE=^TMP("PSDPAT",$J,PSDRG,PSD,PAT,PSD1),PSDRGN=PSDRG
"RTN","PSDPAT1",26,0)
 ..I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",PSDRG,!
"RTN","PSDPAT1",27,0)
 ..S Y=+$E(PSD,1,12) X ^DD("DD") S DATE=Y
"RTN","PSDPAT1",28,0)
 ..S TYP=+$P(NODE,"^",4),QTY=+$P(NODE,"^")
"RTN","PSDPAT1",29,0)
 ..S PQTY=$P(NODE,U,7)+($S(TYP=18:-QTY,TYP=17:-QTY,1:QTY))
"RTN","PSDPAT1",30,0)
 ..I $P(NODE,U,5),'QTY S PQTY=$P(NODE,U,7)-$P(NODE,U,5)
"RTN","PSDPAT1",31,0)
 ..W DATE,?22,PAT,?55 W:TYP=17 "-" W $J(QTY,6)
"RTN","PSDPAT1",32,0)
 ..W ?75,$J(PQTY,6),?98,$P(NODE,"^",2),!,?98,$P(NODE,"^",3),!
"RTN","PSDPAT1",33,0)
 ..W:$P(NODE,U,5) $P(NODE,U,5)," wasted"
"RTN","PSDPAT1",34,0)
 ..W:$P(NODE,U,6)]"" ?22,$P(NODE,U,6)
"RTN","PSDPAT1",35,0)
 ..W:$P(NODE,U,5)&($P(NODE,U,9)) !
"RTN","PSDPAT1",36,0)
 ..W:$P(NODE,U,9) $P(NODE,U,9)," returned ",$P(NODE,U,10)
"RTN","PSDPAT1",37,0)
 ..W:$P(NODE,U,8) " recorded by ",$P($G(^VA(200,$P(NODE,U,8),0)),U)
"RTN","PSDPAT1",38,0)
 ..W !! S UQTY=PQTY I (TYP=18)!(TYP=17) S AQTY=AQTY+QTY
"RTN","PSDPAT1",39,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPAT1",40,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPAT1",41,0)
END ;
"RTN","PSDPAT1",42,0)
 D KVAR^VADPT K VA
"RTN","PSDPAT1",43,0)
 K %,%DT,%H,%I,%ZIS,ALL,AQTY,BAL,CNT,DA,DATE,DFN,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LN,LOOP,NAOU,NAOUN,NODE,NODE9,NUR1,NUR2
"RTN","PSDPAT1",44,0)
 K PAT,PG,POP,PSD,PSD1,PSDA,PSDATE,PSDED,PSDOUT,PSDPN,PQTY,PSDR,PSDRG,PSDRGN,PSDRN,PSDSD,RPDT,TQTY,TYP,QTY,SUM,UQTY,VADM,VAERR,X,Y
"RTN","PSDPAT1",45,0)
 K ^TMP("PSDPAT",$J),^TMP("PSDPATL",$J),ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPAT1",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPAT1",47,0)
 Q
"RTN","PSDPAT1",48,0)
SET ;sets data
"RTN","PSDPAT1",49,0)
 ;Q:TYP=11
"RTN","PSDPAT1",50,0)
 Q:'$D(^PSD(58.81,PSDA,0))  S NODE=^(0),QTY=$P(NODE,"^",6)
"RTN","PSDPAT1",51,0)
 S NODE9=$G(^PSD(58.81,PSDA,9))
"RTN","PSDPAT1",52,0)
 S NODE3=$G(^PSD(58.81,PSDA,3))
"RTN","PSDPAT1",53,0)
 S DFN=+$P($G(NODE9),"^") D DEM^VADPT S PAT=$S(TYP=18:"WASTED AMOUNT",TYP=11:"INITIALIZE BALANCE",TYP=9:"BALANCE ADJUSTMENT",TYP=23:"COUNT VERIFICATION",'VAERR:VADM(1),1:"UNKNOWN")
"RTN","PSDPAT1",54,0)
 S NUR1=$S($P(NODE9,U,2):$P(NODE9,U,2),1:$P(NODE,U,7))
"RTN","PSDPAT1",55,0)
 S:NUR1'=$P(NODE,U,7) NUR1(1)=$P(NODE,U,7)
"RTN","PSDPAT1",56,0)
 ;S NUR1=$S(TYP=11:+$P(NODE,"^",7),1:+$P($G(NODE9),"^",2)) S:TYP=9 NUR1=$S(+$P(NODE,"^",7):+$P(NODE,"^",7),1:+$P($G(NODE9),"^",2))
"RTN","PSDPAT1",57,0)
 S NUR1=$S($P($G(^VA(200,+NUR1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPAT1",58,0)
 S NUR2=$P($G(NODE9),"^",6) S:NUR2 NUR2=$S($P($G(^VA(200,+NUR2,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDPAT1",59,0)
 S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR_" NAME MISSING")
"RTN","PSDPAT1",60,0)
 ;I +$P(NODE9,"^",4) S QTY=+$P(NODE9,"^",4)
"RTN","PSDPAT1",61,0)
 ;I +$P(NODE9,"^",7) S QTY=+$P(NODE9,"^",7)-$P(NODE9,"^",3)
"RTN","PSDPAT1",62,0)
 I +$P(NODE9,"^",5) S QTY=+$P(NODE9,"^",5)
"RTN","PSDPAT1",63,0)
 I (TYP=18)!(TYP=17) S $P(PSDRG(+PSDR),"^",2)=+$P(PSDRG(+PSDR),"^",2)+QTY
"RTN","PSDPAT1",64,0)
SET1 ;sets ^tmp
"RTN","PSDPAT1",65,0)
 S CNT=CNT+1,^TMP("PSDPAT",$J,PSDRN,PSD,PAT,CNT)=QTY_"^"_NUR1_"^"_NUR2_"^"_TYP_U_$P(NODE9,U,4)_U_$P(NODE,U,16)_U_$P(NODE,U,10)_U_$G(NUR1(1))_U_$P($G(NODE3),U,2)_U_$P($G(NODE3),U,3)
"RTN","PSDPAT1",66,0)
 S:'$D(^TMP("PSDPATL",$J,PSDRN)) ^TMP("PSDPATL",$J,PSDRN)=0
"RTN","PSDPAT1",67,0)
 S ^TMP("PSDPATL",$J,PSDRN)=+^TMP("PSDPATL",$J,PSDRN)+($S(TYP=18:-QTY,TYP=17:-QTY,1:QTY)),$P(^(PSDRN),"^",2)=+PSDRG(PSDR)
"RTN","PSDPAT1",68,0)
 S $P(^TMP("PSDPATL",$J,PSDRN),"^",3)=+$P(^TMP("PSDPATL",$J,PSDRN),"^",3)+$P(PSDRG(+PSDR),"^",2)
"RTN","PSDPAT1",69,0)
 K QTY,NUR1,NUR2,NODE9,NODE Q 
"RTN","PSDPAT1",70,0)
HDR ;header
"RTN","PSDPAT1",71,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPAT1",72,0)
 S PG=PG+1 W:$Y @IOF W !,?20,"Activity Report for ",NAOUN,?115,"Page: ",PG,!,?20,"Date: ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!
"RTN","PSDPAT1",73,0)
 W ?5,"=>  DRUG",!,"DATE/TIME",?22,"PATIENT",?55,"QUANTITY",?75,"BALANCE",?98,"NURSE 1",!,?98,"NURSE2",!,LN,!!
"RTN","PSDPAT1",74,0)
 Q
"RTN","PSDPAT1",75,0)
CHK ;sets total qty used and balance
"RTN","PSDPAT1",76,0)
 S TQTY=+$G(^TMP("PSDPATL",$J,PSDRG)),BAL=+$P($G(^TMP("PSDPATL",$J,PSDRG)),"^",2),UQTY=BAL-TQTY
"RTN","PSDPAT1",77,0)
 Q
"RTN","PSDPAT1",78,0)
TOT ;prints total qty used and balance
"RTN","PSDPAT1",79,0)
 I $Y+4>IOSL D HDR Q:PSDOUT  W !,?5,"=> ",$S(PSDRG]"":PSDRG,1:PSDRGN),!
"RTN","PSDPAT1",80,0)
 ;W !,?55,"----------",?75,"----------",!,?5,"Total Quantity Used and Balance",?55,$J(AQTY,6),?70,$J(PQTY,6),!
"RTN","PSDPAT1",81,0)
 W ! S AQTY=0
"RTN","PSDPAT1",82,0)
 Q
"RTN","PSDPAT2")
0^171^B2198141
"RTN","PSDPAT2",1,0)
PSDPAT2 ;B'ham ISC/JPW - Print Patient/Drug Report (summary) ; 1 Feb 94
"RTN","PSDPAT2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPAT2",3,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPAT2",4,0)
 S (PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDPAT2",5,0)
 I '$D(^TMP("PSDPATL",$J)) D HDR W !!,?45,"****  NO DISPENSING SUMMARY  ****" Q
"RTN","PSDPAT2",6,0)
PRINT ;prints data for dispensing
"RTN","PSDPAT2",7,0)
 D HDR Q:PSDOUT
"RTN","PSDPAT2",8,0)
 S LOOP="" F  S LOOP=$O(^TMP("PSDPATL",$J,LOOP)) Q:LOOP=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  D  Q:PSDOUT
"RTN","PSDPAT2",9,0)
 .W !,LOOP,?55,$J(+$P(^TMP("PSDPATL",$J,LOOP),"^",3),6),?70,$J(+$P(^(LOOP),"^",2),6),!
"RTN","PSDPAT2",10,0)
DONE I SUM,$E(IOST)'="C" W @IOF
"RTN","PSDPAT2",11,0)
 Q
"RTN","PSDPAT2",12,0)
HDR ;lists header information
"RTN","PSDPAT2",13,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPAT2",14,0)
 W:$Y @IOF S PG=PG+1 W !,?22,"ACTIVITY",?70,"PG "_PG,!,?29,"** SUMMARY **",!,?27,"Date: ",$P(PSDATE,"^")," to ",$P(PSDATE,"^",2),!!,"NAOU: ",NAOUN,!!
"RTN","PSDPAT2",15,0)
 W "DRUG",?55,"QUANTITY USED",?70,"BALANCE",!,LN,!
"RTN","PSDPAT2",16,0)
 Q
"RTN","PSDPATI")
0^172^B3029340
"RTN","PSDPATI",1,0)
PSDPATI ;B'ham ISC/JPW - Patient/Location Inquiry ; 23 Nov 93
"RTN","PSDPATI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPATI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPATI",4,0)
 I '$D(^XUSEC("PSD ERROR",DUZ)) W $C(7),!!,"Contact your Pharmacy Coordinator for access to display the",!,"Patient/Location data.",!!,"PSD ERROR security key required.",! Q
"RTN","PSDPATI",5,0)
PAT ;ask patient
"RTN","PSDPATI",6,0)
 K DA,DIC S DIC=2,DIC(0)="QEAMZ",DIC("A")="Select Patient Name: "
"RTN","PSDPATI",7,0)
 D ^DIC K DIC G:Y<0 END  S DFN=+Y,PSDPAT=$P(Y,"^",2)
"RTN","PSDPATI",8,0)
DATE ;ask date
"RTN","PSDPATI",9,0)
 K DA,%DT S %DT="AET",%DT("A")="Enter Date of Stay: "
"RTN","PSDPATI",10,0)
 D ^%DT K %DT G:Y<0 END S VAINDT=+Y X ^DD("DD") S PSDT=Y
"RTN","PSDPATI",11,0)
INQ ;patient inquire
"RTN","PSDPATI",12,0)
 D INP^VADPT W @IOF,?15,"Patient Inquiry",!!,"Patient: ",PSDPAT,!,"Date of Stay: ",PSDT,!,"Ward Location: ",$P(VAIN(4),"^",2),!,"Room-Bed: ",$P(VAIN(5),"^"),!
"RTN","PSDPATI",13,0)
 D KVAR^VADPT K VA
"RTN","PSDPATI",14,0)
 G PAT
"RTN","PSDPATI",15,0)
END ;kills variables
"RTN","PSDPATI",16,0)
 K %DT,DA,DIC,DTOUT,DUOUT,PSDT,PSDPAT,X,Y
"RTN","PSDPATI",17,0)
 Q
"RTN","PSDPDR")
0^173^B17629765
"RTN","PSDPDR",1,0)
PSDPDR ;BIR/BJW-Narc Disp/Rec Report (in lieu of VA FORM 10-2321) ; 09 FEB 95
"RTN","PSDPDR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPDR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPDR",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDPDR",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"process/dispense narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDPDR",6,0)
COPY ;ask vault, nursing or both
"RTN","PSDPDR",7,0)
 K DA,DIR,DIRUT S DIR(0)="SO^V:VAULT COPY ONLY;N:NURSING COPY ONLY;B:BOTH VAULT AND NURSING COPY"
"RTN","PSDPDR",8,0)
 S DIR("A")="Select Disp/Receiving Report(s) to Print"
"RTN","PSDPDR",9,0)
 S DIR("?",1)="Answer 'V' to print only the vault copy of this report,",DIR("?",2)="answer 'N' to print only the nursing copy  or",DIR("?")="answer 'B' to print both the vault and nursing copies."
"RTN","PSDPDR",10,0)
 D ^DIR K DIR
"RTN","PSDPDR",11,0)
 I $D(DIRUT) W !,"No report will be printed.",! G END
"RTN","PSDPDR",12,0)
 S PSDCPY=Y
"RTN","PSDPDR",13,0)
ASKD ;ask dispensing location
"RTN","PSDPDR",14,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPDR",15,0)
 G:$P(PSDSITE,U,5) ASKN
"RTN","PSDPDR",16,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDPDR",17,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPDR",18,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPDR",19,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPDR",20,0)
ASKN ;ask naou or group
"RTN","PSDPDR",21,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPDR",22,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPDR",23,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPDR",24,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X,PSDPT=+$E(%,1,12) K DA,DIC S CNT=0
"RTN","PSDPDR",25,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDPDR",26,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPDR",27,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPDR",28,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPDR",29,0)
 S:X="^ALL" ALL=1
"RTN","PSDPDR",30,0)
DEV ;ask device and queue info
"RTN","PSDPDR",31,0)
 W !,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPDR",32,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPDR",33,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPDR",34,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPDR1",ZTDESC="Compile Narcotic Disp Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPDR",35,0)
 U IO G START^PSDPDR1
"RTN","PSDPDR",36,0)
END K %,%H,%I,%ZIS,ALL,C,CNT,COPY,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,LOT,MFG,NAOU,NODE,NUM
"RTN","PSDPDR",37,0)
 K OK,ORD,ORDN,POP,PSD,PSDCPY,PSDA,PSDDT,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDPT,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDSN,PSDST,QTY,REQD,REQDT,SEL,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPDR",38,0)
 K ^TMP("PSDRPT",$J) D ^%ZISC
"RTN","PSDPDR",39,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPDR",40,0)
 Q
"RTN","PSDPDR",41,0)
GROUP ;select group of naous
"RTN","PSDPDR",42,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPDR",43,0)
 Q
"RTN","PSDPDR",44,0)
SAVE S (ZTSAVE("PSDIO"),ZTSAVE("PSDT"),ZTSAVE("CNT"),ZTSAVE("PSDS"),ZTSAVE("PSDPT"),ZTSAVE("PSDCPY"))="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPDR",45,0)
 Q
"RTN","PSDPDR1")
0^174^B12120883
"RTN","PSDPDR1",1,0)
PSDPDR1 ;BIR/BJW-Narc Disp/Rec Report (VA FORM 10-2321) (cont'd) ; 09 FEB 95
"RTN","PSDPDR1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPDR1",3,0)
START ;compile data
"RTN","PSDPDR1",4,0)
 K ^TMP("PSDRPT",$J)
"RTN","PSDPDR1",5,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),$P(^(0),"^",2)="N",+$P(^(0),"^",4)=+PSDS S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPDR1",6,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",4)=+PSDS S NAOU(+PSD)=""
"RTN","PSDPDR1",7,0)
 F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",3,PSD)) G:('PSD)&($D(ZTQUEUED)) PRTQUE G:'PSD PRINT^PSDPDR2 F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",3,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)) D
"RTN","PSDPDR1",8,0)
 .S NODE=^PSD(58.81,PSDA,0),PSDN=+$P(NODE,"^",18)
"RTN","PSDPDR1",9,0)
 .I $D(NAOU(PSDN)) S PSDNA=$S($P($G(^PSD(58.8,PSDN,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDN) D
"RTN","PSDPDR1",10,0)
 ..S PSDR=+$P(NODE,"^",5),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR),STAT=+$P(NODE,"^",11) Q:+$P($G(^PSD(58.81,PSDA,"CS")),"^",3)!(STAT'=3)
"RTN","PSDPDR1",11,0)
 ..S STATN=$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPDR1",12,0)
 ..S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDPDR1",13,0)
 ..S COMM=$S($D(^PSD(58.81,PSDA,2,0)):1,1:0),MFG=$P(NODE,"^",13),LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15),EXPD=""
"RTN","PSDPDR1",14,0)
 ..;;The next two lines inserted for E3R# 3311 2-9-95.
"RTN","PSDPDR1",15,0)
 ..S:$D(^PSD(58.81,PSDA,4)) NEWBAL=$P(^(4),"^",7)+$P(^(4),"^",4),FNOTE="*"
"RTN","PSDPDR1",16,0)
 ..S:'$D(^PSD(58.81,PSDA,4)) NEWBAL=$P(NODE,"^",10)-QTY,FNOTE=""
"RTN","PSDPDR1",17,0)
 ..I EXP S EXPD=$E(EXP,4,5)_"/"_$E(EXP,2,3)
"RTN","PSDPDR1",18,0)
 ..S NUM=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDPDR1",19,0)
 ..S ORD=+$P($G(^PSD(58.81,PSDA,1)),"^",7),ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPDR1",20,0)
 ..S REQD=$P($G(^PSD(58.81,PSDA,1)),"^",6),REQDT="" I REQD S REQDT=$E(REQD,4,5)_"/"_$E(REQD,6,7)_"/"_$E(REQD,2,3)
"RTN","PSDPDR1",21,0)
 ..S PSDST=$P(NODE,"^",4),PSDDT="" I PSDST S PSDDT=$E(PSDST,4,5)_"/"_$E(PSDST,6,7)_"/"_$E(PSDST,2,3)
"RTN","PSDPDR1",22,0)
 ..;;Fnote and Newbal added for E3R# 3311 2-9-95.
"RTN","PSDPDR1",23,0)
 ..S ^TMP("PSDRPT",$J,PSDNA,NUM)=PSDRN_"^"_QTY_FNOTE_"^"_PSDDT_"^"_REQDT_"^"_ORDN_"^"_MFG_"^"_LOT_"^"_EXPD_"^"_COMM_"^"_PSDA_"^"_NEWBAL_"^"_FNOTE
"RTN","PSDPDR1",24,0)
 Q
"RTN","PSDPDR1",25,0)
PRTQUE ;queues print after compile
"RTN","PSDPDR1",26,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDPDR2",ZTDESC="Print Narcotic Disp Report",ZTDTH=$H
"RTN","PSDPDR1",27,0)
 S (ZTSAVE("^TMP(""PSDRPT"",$J,"),ZTSAVE("PSDS"),ZTSAVE("PSDPT"),ZTSAVE("CNT"),ZTSAVE("PSDCPY"))=""
"RTN","PSDPDR1",28,0)
 D ^%ZTLOAD K ^TMP("PSDRPT",$J),ZTSK
"RTN","PSDPDR1",29,0)
END K %,%H,%I,%ZIS,ALL,C,CNT,COPY,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,LOT,MFG,NAOU,NEWBAL,NODE,NUM
"RTN","PSDPDR1",30,0)
 K FNOTE,OK,ORD,ORDN,POP,PSD,PSDA,PSDCPY,PSDDT,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDPT,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDSN,PSDST,QTY,REQD,REQDT,SEL,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPDR1",31,0)
 K ^TMP("PSDRPT",$J) D ^%ZISC
"RTN","PSDPDR1",32,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPDR1",33,0)
 Q
"RTN","PSDPDR2")
0^175^B16552223
"RTN","PSDPDR2",1,0)
PSDPDR2 ;BIR/BJW-Narc Disp/Rec Report (VA FORM 10-2321) (cont'd) ; 09 FEB 95
"RTN","PSDPDR2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPDR2",3,0)
PRINT ;entry to print
"RTN","PSDPDR2",4,0)
 S COPY=$S(PSDCPY="V":2,1:1) D COPY
"RTN","PSDPDR2",5,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPDR2",6,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPDR2",7,0)
END K %,%H,%I,%ZIS,ALL,ANS,C,CNT,COPY,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,LN,LOOP,LOT,MFG,NAOU,NODE,NUM
"RTN","PSDPDR2",8,0)
 K OK,ORD,ORDN,PG,POP,PSD,PSDA,PSDCPY,PSDDT,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDOUT,PSDPT,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDSN,PSDST,QTY,REQD,REQDT,RPDT,SEL,STAT,STATN,TEXT,X,Y
"RTN","PSDPDR2",9,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPDR2",10,0)
 K ^TMP("PSDRPT",$J) D ^%ZISC
"RTN","PSDPDR2",11,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPDR2",12,0)
 Q
"RTN","PSDPDR2",13,0)
HDR ;header for log
"RTN","PSDPDR2",14,0)
 ;;The next line inserted for E3R# 3311 2-9-95.
"RTN","PSDPDR2",15,0)
 I PG,$G(PSDCPY)="V"!($G(COPY)=2) W !,"* VERIFIED ORDER WAS EDITED."
"RTN","PSDPDR2",16,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPDR2",17,0)
 S PG=PG+1 W:$Y @IOF I PSDCPY="V"!(COPY=2) W !,?45,"*** RECEIPT VERIFICATION COPY ***",!,?42,"Technician Delivering Orders: ________________________",!
"RTN","PSDPDR2",18,0)
 W !,?2,"VA FORM 10-2321",?42,"Narcotic Dispensing/Receiving Report" I NAOU]"",NAOU'=0 W " for ",NAOU W:$P($G(^PSD(58.8,+$O(^PSD(58.8,"B",NAOU,0)),2)),U,5) " (Perpetual Inventory)"
"RTN","PSDPDR2",19,0)
 W ?125,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDPDR2",20,0)
 W !,?14,"DATE",?78,"DATE"
"RTN","PSDPDR2",21,0)
 W !,"DISP #",?12,"DISPENSED",?24,"QTY",?33,"DRUG",?78,"ORD",?90,"ORDERED BY"
"RTN","PSDPDR2",22,0)
 W !,LN,!!
"RTN","PSDPDR2",23,0)
 Q
"RTN","PSDPDR2",24,0)
COPY ;copy 1 and 2
"RTN","PSDPDR2",25,0)
 S (COMM,PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPDR2",26,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDRPT",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS TO BE DELIVERED  ****" S FLAG=1 Q
"RTN","PSDPDR2",27,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDRPT",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  D  Q:PSDOUT  I PSDCPY="B",COPY=1 S COPY=2 D HDR D  S COPY=1
"RTN","PSDPDR2",28,0)
 .;;$Y changed to 12 to force fnote to print at bottom of page E3R# 3311.
"RTN","PSDPDR2",29,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDRPT",$J,NAOU,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+12>IOSL HDR Q:PSDOUT  S NODE=^TMP("PSDRPT",$J,NAOU,NUM) D
"RTN","PSDPDR2",30,0)
COP ..I $P(NODE,"^",9),$Y+12>IOSL D HDR Q:PSDOUT
"RTN","PSDPDR2",31,0)
 ..;;The next line inserted for E3r# 3311 2-9-95.
"RTN","PSDPDR2",32,0)
 ..NEW X S X=$P(NODE,"^",2) S X=$S(PSDCPY="V":X,COPY=2:X,1:+X)
"RTN","PSDPDR2",33,0)
 ..W !,NUM,?12,$P(NODE,"^",3),?21,$J(X,6),?33,$P(NODE,"^"),?78,$P(NODE,"^",4),?90,$P(NODE,"^",5)
"RTN","PSDPDR2",34,0)
 ..;;Balance inserted for E3R# 3311 2-9-95.
"RTN","PSDPDR2",35,0)
 ..I PSDCPY="V"!(COPY=2) W !,?33,"BALANCE:  "_$S($P(NODE,"^",11)]"":+$P(NODE,"^",11),1:"UNKNOWN")_" "_$P(NODE,"^",12)
"RTN","PSDPDR2",36,0)
 ..I $P(NODE,"^",6)]"" W !,?33,"Mfg/Lot #/Exp Date:  ",$P(NODE,"^",6)_"  "_$P(NODE,"^",7)_"  "_$P(NODE,"^",8)
"RTN","PSDPDR2",37,0)
 ..W !!,?7,"Disp by RPh:___________________________________",?61,"Rec'd by Nurse:___________________________________",!,?19,"(Full Name)",?76,"(Full Name)",!
"RTN","PSDPDR2",38,0)
 ..I $P(NODE,"^",9) W ?24,"COMMENTS:" S COMM=1,PSDA=$P(NODE,"^",10) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.81,PSDA,2,TEXT)) Q:'TEXT  D:$Y+4>IOSL HDR Q:PSDOUT  S X=$G(^PSD(58.81,PSDA,2,TEXT,0)),DIWL=34,DIWR=115,DIWF="W" D ^DIWP
"RTN","PSDPDR2",39,0)
 ..I COMM D ^DIWW S COMM=0 W !
"RTN","PSDPDR2",40,0)
 ..K DA,DIE,DR S (DA,PSDA)=+$P(NODE,"^",10),DR="102////"_PSDPT,DIE=58.81 D ^DIE K DA,DIE,DR
"RTN","PSDPDR2",41,0)
 ;;The next line inserted for E3R# 3311 2-9-95.
"RTN","PSDPDR2",42,0)
 I PG,$G(PSDCPY)="V"!($G(COPY)=2) W !,"* VERIFIED ORDER WAS EDITED."
"RTN","PSDPDR2",43,0)
 Q
"RTN","PSDPDU")
0^176^B7009260
"RTN","PSDPDU",1,0)
PSDPDU ;BIR/JPW-Print Breakdown/Disp Unit for Stock Drugs ; 6 July 94
"RTN","PSDPDU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPDU",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPDU",4,0)
 W !!,?5,"You may select a single Dispensing Site, several Dispensing Sites,",!,?5,"or enter ^ALL to select all Dispensing Sites.",!!
"RTN","PSDPDU",5,0)
ASKN ;ask NAOU(s)
"RTN","PSDPDU",6,0)
 D NOW^%DTC S PSDT=X K DA,DIC S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPDU",7,0)
 F  S DIC=58.8,DIC("A")="Select Dispensing Site: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0),$P(^(0),""^"",3)=+PSDSITE" D  Q:Y<0
"RTN","PSDPDU",8,0)
 .D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDPDU",9,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPDU",10,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$S($P($G(^(0)),"^",2)="M":1,$P($G(^(0)),"^",2)="S":1,1:0),$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDPDU",11,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPDU",12,0)
DEV ;asks device and queueing information
"RTN","PSDPDU",13,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPDU",14,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPDU1",ZTDESC="CS PHARM List Disp Unit" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPDU",15,0)
 U IO G START^PSDPDU1
"RTN","PSDPDU",16,0)
END ;
"RTN","PSDPDU",17,0)
 K %,%H,%I,%ZIS,ANS,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),NAOU,POP,PSD,PSDT,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","PSDPDU",18,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPDU",19,0)
 Q
"RTN","PSDPDU",20,0)
SAVE ;save variables for queueing
"RTN","PSDPDU",21,0)
 S ZTSAVE=("PSDSITE")="",ZTSAVE("PSD")="",ZTSAVE("PSDT")="" S:$D(NAOU) ZTSAVE("NAOU(")=""
"RTN","PSDPDU",22,0)
 Q
"RTN","PSDPDU1")
0^177^B10477770
"RTN","PSDPDU1",1,0)
PSDPDU1 ;BIR/JPW-Print Breakdown/Disp Unit (cont'd) ; 2 Aug 94
"RTN","PSDPDU1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPDU1",3,0)
START ;entry point for report
"RTN","PSDPDU1",4,0)
 K ^TMP("PSDPDU",$J)
"RTN","PSDPDU1",5,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) G:'PSD PRINT S:$D(^PSD(58.8,PSD,0)) NAOUN=$S($P(^(0),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD) F DRUG=0:0 S DRUG=$O(^PSD(58.8,PSD,1,DRUG)) Q:'DRUG  I $D(^PSD(58.8,PSD,1,DRUG,0)) D
"RTN","PSDPDU1",6,0)
 .Q:'$D(^PSD(58.8,PSD,1,DRUG,0))  I +$P(^PSD(58.8,PSD,1,DRUG,0),"^",14) D NOW^%DTC I $P(^PSD(58.8,PSD,1,DRUG,0),"^",14)'>X Q
"RTN","PSDPDU1",7,0)
 .Q:'$D(^PSDRUG(DRUG,0))  I $D(^PSDRUG(DRUG,0)) S DRUGN=$S($P(^PSDRUG(DRUG,0),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDPDU1",8,0)
 .S PSDP=$P($G(^PSD(58.8,PSD,0)),"^",4)
"RTN","PSDPDU1",9,0)
 .S NODE=^PSD(58.8,PSD,1,DRUG,0),NBKU=$P(NODE,"^",8),NPKG=$P(NODE,"^",9)
"RTN","PSDPDU1",10,0)
 .S NDU=$S($P($G(^PSDRUG(DRUG,660)),"^",8)]"":$P($G(^(660)),"^",8),1:"NO DATA"),NDUP=$S($P($G(^(660)),"^",6)]"":$P($G(^(660)),"^",6),1:"NO DATA")
"RTN","PSDPDU1",11,0)
 .S ^TMP("PSDPDU",$J,NAOUN,DRUGN)=NBKU_"^"_NPKG_"^"_NDU_"^"_NDUP
"RTN","PSDPDU1",12,0)
PRINT ;prints data for stock drugs
"RTN","PSDPDU1",13,0)
 K LN S $P(LN,"-",132)="",(PG,PSDOUT)=0,%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y D HDR Q:PSDOUT
"RTN","PSDPDU1",14,0)
 I '$D(^TMP("PSDPDU",$J)) W !!,?45,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G DONE
"RTN","PSDPDU1",15,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDPDU",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D:$Y+5>IOSL HDR Q:PSDOUT  W !!,"=> ",$S(NAOU["ZZ/":"#"_$P(NAOU,"/",2)_" NAME MISSING",1:NAOU) D
"RTN","PSDPDU1",16,0)
 .S DRUG="" F  S DRUG=$O(^TMP("PSDPDU",$J,NAOU,DRUG)) Q:DRUG=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPDU1",17,0)
 ..S NODE=^TMP("PSDPDU",$J,NAOU,DRUG),NBKU=$P(NODE,"^"),NPKG=$P(NODE,"^",2),NDU=$P(NODE,"^",3),NDUP=$P(NODE,"^",4)
"RTN","PSDPDU1",18,0)
 ..I $Y+5>IOSL D HDR Q:PSDOUT  W !!,"=> ",$S(NAOU["ZZ/":"#"_$P(NAOU,"/",2)_" NAME MISSING",1:NAOU)
"RTN","PSDPDU1",19,0)
 ..W !,?4,DRUG,?58,NBKU,?75,$J(NPKG,6),?93,$J(NDU,6),?118,$J(NDUP,6)
"RTN","PSDPDU1",20,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPDU1",21,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPDU1",22,0)
END ;
"RTN","PSDPDU1",23,0)
 K %,%DT,%H,%I,%ZIS,ANS,DA,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,IO("Q"),LN,NAOU,NAOUN,NBKU,NDU,NDUP,NODE,NODED,NPKG,PG,POP,PSD,PSDP,PSDT,PSDOUT,RPDT,TYP,TYPE,X,Y,^TMP("PSDPDU",$J)
"RTN","PSDPDU1",24,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPDU1",25,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPDU1",26,0)
 Q
"RTN","PSDPDU1",27,0)
HDR ;lists header information
"RTN","PSDPDU1",28,0)
 I $E(IOST,1,2)="C-",PG K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPDU1",29,0)
 W:$Y @IOF S PG=PG+1 W !,"Breakdown/Dispensing Unit Listing  -  Date: "_RPDT,?121,"PAGE: "_PG,!!,"=> DISPENSING SITE"
"RTN","PSDPDU1",30,0)
 W !,?57,"BREAKDOWN",?75,"PACKAGE",?92,"DISPENSING",?115,"PRICE PER"
"RTN","PSDPDU1",31,0)
 W !,?12,"DRUG",?59,"UNIT",?76,"SIZE",?95,"UNIT",?115,"DISP UNIT",!,LN,!
"RTN","PSDPDU1",32,0)
 Q
"RTN","PSDPGS")
0^178^B21156981
"RTN","PSDPGS",1,0)
PSDPGS ;BIR/JPW-Print Green Sheet (VA FORM 10-2638) ; 30 Aug 94
"RTN","PSDPGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPGS",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDPGS",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access",!,?12,"to print Green Sheets.",!!,"PSJ PHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDPGS",6,0)
ASKD ;ask dispensing location
"RTN","PSDPGS",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPGS",8,0)
 I $P(PSDSITE,U,5) S PRT=+$P($G(^PSD(58.8,+PSDS,2)),"^",6),ASK=+$G(^(2.5)) G CHKD
"RTN","PSDPGS",9,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPGS",10,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPGS",11,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PRT=+$P($G(^PSD(58.8,+PSDS,2)),"^",6),ASK=+$G(^PSD(58.8,+PSDS,2.5)),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPGS",12,0)
CHKD I '$O(^PSD(58.8,+PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! G END
"RTN","PSDPGS",13,0)
ONE ;asks print type
"RTN","PSDPGS",14,0)
 K DA,DIR,DIRUT S DIR(0)="S^N:NAOU(s);R:Range of Green Sheet Numbers;A:All Green Sheets",DIR("A")="Printing Method"
"RTN","PSDPGS",15,0)
 S DIR("?",1)="Answer 'N' to select printing by NAOU(s), 'R' to select a number range,",DIR("?",2)="answer 'A' to print ALL Green Sheets not previously printed",DIR("?")="or '^' to quit."
"RTN","PSDPGS",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDPGS",17,0)
 G:ANS="A" DEV G:ANS="N" SEL
"RTN","PSDPGS",18,0)
GS1 ;ask gs # range
"RTN","PSDPGS",19,0)
 W !!,"You may enter a Green Sheet # list and/or a Green Sheet # range.",!
"RTN","PSDPGS",20,0)
 W "NOTE: This response must be a list or range, e.g. 1,3,5 or 2-4,8.",!
"RTN","PSDPGS",21,0)
 K DA,DIR,DIRUT S DIR(0)="LOA^0:999999999",DIR("A")="Select Green Sheet #(s): "
"RTN","PSDPGS",22,0)
 D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDPGS",23,0)
 S PSD1="" F  S PSD1=$O(Y(PSD1)) Q:PSD1=""  S:$D(Y(PSD1)) PSD1(PSD1)=Y(PSD1) K Y(PSD1)
"RTN","PSDPGS",24,0)
 G DEV
"RTN","PSDPGS",25,0)
SEL ;sel naou or group
"RTN","PSDPGS",26,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPGS",27,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPGS",28,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPGS",29,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X K DA,DIC S CNT=0
"RTN","PSDPGS",30,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDPGS",31,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N""" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPGS",32,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPGS",33,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPGS",34,0)
 S:X="^ALL" ALL=1
"RTN","PSDPGS",35,0)
DEV ;ask device and queue info
"RTN","PSDPGS",36,0)
 W $C(7),!!,"This report now prints on plain paper.",!,"Please check your printer before starting this report.",!!,"You may queue this report to print at a later time.",!!
"RTN","PSDPGS",37,0)
 S PSDCPI=10
"RTN","PSDPGS",38,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",8),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPGS",39,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPGS",40,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPGS1",ZTDESC="Print Green Sheets (VA FORM 10-2638)" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPGS",41,0)
 U IO G START^PSDPGS1
"RTN","PSDPGS",42,0)
END K %ZIS,ALL,ANS,ASK,C,CNT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,IOP,JJ,LINE,LOOP,LOT,NAOU,NAOUN,NODE,NODE1
"RTN","PSDPGS",43,0)
 K OK,ORD,ORDN,POP,PRT,PSD,PSD1,PSDA,PSDBY,PSDBYN,PSDCPI,PSDCNT,PSDDT,PSDEV,PSDG,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT
"RTN","PSDPGS",44,0)
 K QTY,SEL,SITE,STAT,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPGS",45,0)
 K ^TMP("PSDPGS",$J)
"RTN","PSDPGS",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPGS",47,0)
 Q
"RTN","PSDPGS",48,0)
SAVE ;saves queued variables
"RTN","PSDPGS",49,0)
 S (ZTSAVE("ASK"),ZTSAVE("ANS"),ZTSAVE("PSDSITE"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDCPI"))="" S:$D(PRT) ZTSAVE("PRT")=""
"RTN","PSDPGS",50,0)
 S:$D(PSD1) ZTSAVE("PSD1(")="" S:$D(PSDG) ZTSAVE("PSDG(")=""
"RTN","PSDPGS",51,0)
 S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPGS",52,0)
 S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(CNT) ZTSAVE("CNT")=""
"RTN","PSDPGS",53,0)
 Q
"RTN","PSDPGS",54,0)
GROUP ;select group of naous
"RTN","PSDPGS",55,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPGS",56,0)
 Q
"RTN","PSDPGS1")
0^179^B25630481
"RTN","PSDPGS1",1,0)
PSDPGS1 ;BIR/JPW-Print Green Sheet (VA FORM 10-2638 ) (cont'd) ; 30 Aug 94
"RTN","PSDPGS1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPGS1",3,0)
START ;loop through transactions
"RTN","PSDPGS1",4,0)
 ;second call to %ZIS to restore variables for open execute
"RTN","PSDPGS1",5,0)
 I $D(ZTQUEUED) S IOP=ION D ^%ZIS U IO
"RTN","PSDPGS1",6,0)
 ;get ready for bar codes and formatting
"RTN","PSDPGS1",7,0)
 N PSD10,PSD12,PSDL,A7BAR0,A7BAR1
"RTN","PSDPGS1",8,0)
 D A7BAR
"RTN","PSDPGS1",9,0)
 S PSD10=$P($G(^%ZIS(2,+$G(IOST(0)),5)),U),PSD12=$P($G(^(5)),U,2)
"RTN","PSDPGS1",10,0)
 S PSDL=$P($G(^%ZIS(2,+$G(IOST(0)),12.16)),U)
"RTN","PSDPGS1",11,0)
 S PSDL(1)=$P($G(^%ZIS(2,+$G(IOST(0)),12.15)),U)
"RTN","PSDPGS1",12,0)
 I PSD12']""!(PSD10']"")!(PSDL']"")!(PSDL(1)']"") W !!,"The device you selected is not set up for green sheets, please contact IRM.",!! Q
"RTN","PSDPGS1",13,0)
 K ^TMP("PSDPGS",$J)
"RTN","PSDPGS1",14,0)
 S PSDCNT=1
"RTN","PSDPGS1",15,0)
 I ANS="R" S PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDPGS1",16,0)
 I ANS="R" G PRINT
"RTN","PSDPGS1",17,0)
 I ANS="N",$D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",3)=+PSDSITE S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPGS1",18,0)
 I ANS="N",$D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",3)=+PSDSITE S NAOU(+PSD)=""
"RTN","PSDPGS1",19,0)
 S LOOP=$S(PRT:2,1:3)
"RTN","PSDPGS1",20,0)
 F STAT=LOOP-.99:0 S STAT=$O(^PSD(58.81,"AD",STAT)) Q:'STAT!(STAT>3)  F PSD=0:0 S PSD=$O(^PSD(58.81,"AD",STAT,PSD)) Q:'PSD  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",STAT,PSD,PSDA)) Q:'PSDA  D SET
"RTN","PSDPGS1",21,0)
PRINT ;print green sheet
"RTN","PSDPGS1",22,0)
 I '$D(^TMP("PSDPGS",$J)) W !,"*** SORRY NO GREEN SHEETS TO PRINT ***",! G END
"RTN","PSDPGS1",23,0)
 S PSDPN="" F  S PSDPN=$O(^TMP("PSDPGS",$J,PSDPN)) Q:PSDPN=""  D
"RTN","PSDPGS1",24,0)
 .S NODE=^TMP("PSDPGS",$J,PSDPN),NAOUN=$P(NODE,"^"),PSDBYN=$P(NODE,"^",5),PSDT=$P(NODE,"^",6),ORDN=$P(NODE,"^",7)
"RTN","PSDPGS1",25,0)
 .I ORDN]"",ORDN'="UNKNOWN" S ORDN=$P(ORDN,",")_","_$E($P(ORDN,",",2))
"RTN","PSDPGS1",26,0)
 .I PSDBYN]"",PSDBYN'="UNKNOWN" S PSDBYN=$P(PSDBYN,",")_","_$E($P(PSDBYN,",",2))
"RTN","PSDPGS1",27,0)
 .S PSDDT="" I PSDT S PSDDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3)
"RTN","PSDPGS1",28,0)
 .W:$Y @IOF,@PSD12 W ?33,NAOUN,"  ",$P($G(^DPT(+$P(NODE,U,9),0)),U)
"RTN","PSDPGS1",29,0)
 .I $D(A7PRT) W *13,?70,@A7BAR1,@PSD10,PSDPN,@A7BAR0,@PSD12
"RTN","PSDPGS1",30,0)
 .W @PSDL,!?6,"CONTROLLED SUBSTANCE ADMINISTRATION RECORD",?54
"RTN","PSDPGS1",31,0)
 .W "Pharmacy Dispensing # ",@PSD10,PSDPN,@PSD12,!?6
"RTN","PSDPGS1",32,0)
 .W "Drug: ",@PSD10,$P(NODE,U,2),@PSD12,?60,"Exp: ",$P(NODE,U,4),?75
"RTN","PSDPGS1",33,0)
 .W "Qty: ",@PSD10,$P(NODE,U,3),@PSD12,!?6
"RTN","PSDPGS1",34,0)
 .W "Lot#",$P(NODE,U,8),?21,"Ord by: ",$E(ORDN,1,20)
"RTN","PSDPGS1",35,0)
 .W ?45,"Disp by: ",$E(PSDBYN,1,20),?70,"Date: ",PSDDT,@PSDL(1),!?7
"RTN","PSDPGS1",36,0)
 .S $P(LN,"_",80)="" W LN,@PSDL,!?6
"RTN","PSDPGS1",37,0)
 .W "| DATE   TIME     NAME OF PATIENT      DOSE  BALANCE  ADMINISTERED BY           |"
"RTN","PSDPGS1",38,0)
 .F LINE=1:1:30 W !?6,"|________|_____|_______________________|_____|______|___________________________|"
"RTN","PSDPGS1",39,0)
 .W !?6,"Above Drug Received:      Date__________ R.N. Sign_______________________________"
"RTN","PSDPGS1",40,0)
 .W !?6,"Above Drug Administered:  Date__________ R.N. Sign_______________________________"
"RTN","PSDPGS1",41,0)
 .W !?6,"Entries Reviewed:         Date__________ R.PH. Sign______________________________",!?6
"RTN","PSDPGS1",42,0)
 .W @PSDL(1),"Drug: ",@PSD10,$P(NODE,U,2),@PSD12,?65
"RTN","PSDPGS1",43,0)
 .W "Pharmacy Dispensing # ",@PSD10,PSDPN,@PSD12,!?6
"RTN","PSDPGS1",44,0)
 .W "Automated VA FORM 10-2638"
"RTN","PSDPGS1",45,0)
END K %ZIS,ALL,ANS,ASK,C,CNT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,IOP,JJ,LINE,LOOP,LOT,NAOU,NAOUN,NODE,NODE1
"RTN","PSDPGS1",46,0)
 K OK,ORD,ORDN,POP,PRT,PSD,PSD1,PSDA,PSDBY,PSDBYN,PSDCPI,PSDCNT,PSDDT,PSDEV,PSDG,PSDN,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT
"RTN","PSDPGS1",47,0)
 K QTY,SEL,SITE,STAT,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPGS1",48,0)
 K ^TMP("PSDPGS",$J)
"RTN","PSDPGS1",49,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPGS1",50,0)
 Q
"RTN","PSDPGS1",51,0)
LOOP S PSDPN=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSDPN="" S PSDCNT=1 Q
"RTN","PSDPGS1",52,0)
 S PSDA=$O(^PSD(58.81,"D",PSDPN,0)),PSD=+$P($G(^PSD(58.81,+PSDA,0)),"^",18) D SET
"RTN","PSDPGS1",53,0)
 G LOOP
"RTN","PSDPGS1",54,0)
 Q
"RTN","PSDPGS1",55,0)
SET ;set data for printing
"RTN","PSDPGS1",56,0)
 Q:'$D(^PSD(58.81,+PSDA,0))  Q:+$P($G(^PSD(58.81,+PSDA,0)),"^",3)'=+PSDS
"RTN","PSDPGS1",57,0)
 Q:+$P($G(^PSD(58.8,+PSD,2)),"^",5)&('$P($G(^PSD(58.8,+PSDS,1,+$P($G(^PSD(58.81,+PSDA,0)),U,5),7)),U,3))&('$P($G(^PSD(58.81,+PSDA,9)),U))
"RTN","PSDPGS1",58,0)
 Q:+$P($G(^PSD(58.81,+PSDA,"CS")),"^",4)
"RTN","PSDPGS1",59,0)
 I ANS="N" Q:'$D(NAOU(+PSD))
"RTN","PSDPGS1",60,0)
 S NODE=^PSD(58.81,+PSDA,0) Q:+$P(NODE,"^",11)>3
"RTN","PSDPGS1",61,0)
 S NAOUN=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPGS1",62,0)
 S PSDR=+$P(NODE,"^",5),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPGS1",63,0)
 S PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN"),PSDT=$P(NODE,"^",4)
"RTN","PSDPGS1",64,0)
 S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDPGS1",65,0)
 S LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15),EXPD="" I EXP S Y=$E(EXP,1,7) X ^DD("DD") S EXPD=Y
"RTN","PSDPGS1",66,0)
 S (PSDBY,PSDBYN,ORD,ORDN)=""
"RTN","PSDPGS1",67,0)
 I $D(^PSD(58.81,PSDA,1)) S NODE1=^(1),PSDBY=$P(NODE1,"^"),ORD=$P(NODE1,"^",7)
"RTN","PSDPGS1",68,0)
 S:ORD ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPGS1",69,0)
 S:PSDBY PSDBYN=$S($P($G(^VA(200,PSDBY,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPGS1",70,0)
 S ^TMP("PSDPGS",$J,PSDPN)=NAOUN_"^"_PSDRN_"^"_QTY_"^"_EXPD_"^"_PSDBYN_"^"_PSDT_"^"_ORDN_"^"_LOT_U_$P($G(^PSD(58.81,PSDA,9)),U)
"RTN","PSDPGS1",71,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="103////1" D ^DIE K DA,DIE,DR
"RTN","PSDPGS1",72,0)
 Q
"RTN","PSDPGS1",73,0)
A7BAR ;DALISC/JRR set up vars to print barcode on green sheet
"RTN","PSDPGS1",74,0)
 ;This subroutine added by James Reed, Dallas ISC, 9/8/95
"RTN","PSDPGS1",75,0)
 K A7PRT ;Var will be defined if bar code logic was set up in device file
"RTN","PSDPGS1",76,0)
 F JJ=0,1 S @("A7BAR"_JJ)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_JJ)) S @("A7BAR"_JJ)=^("BAR"_JJ)
"RTN","PSDPGS1",77,0)
 I A7BAR1]"",A7BAR0]"" S A7PRT=1 ;okay to print bar code
"RTN","PSDPLOG")
0^180^B17070442
"RTN","PSDPLOG",1,0)
PSDPLOG ;BIR/JPW-CS Inspector's Log ; 6 July 94
"RTN","PSDPLOG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPLOG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPLOG",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print the CS Inspector's Log.",! K OK Q
"RTN","PSDPLOG",5,0)
 W !,?5,"Inspector's Log for Active Green Sheets",!
"RTN","PSDPLOG",6,0)
RET ;ask to include returns
"RTN","PSDPLOG",7,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Include Returns to Stock"
"RTN","PSDPLOG",8,0)
 S DIR("?")="Answer 'YES' or return to include returns to stock, 'NO' to continue without returns, or '^' to quit."
"RTN","PSDPLOG",9,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDPLOG",10,0)
 S PSDRET=+Y G:'PSDRET ASKN
"RTN","PSDPLOG",11,0)
RDATE ;ask return date
"RTN","PSDPLOG",12,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date Returned to Stock: " D ^%DT I Y<0 S PSDOUT=1 D MSG G END
"RTN","PSDPLOG",13,0)
 S PSDSD=Y,PSDSD=PSDSD-.0001
"RTN","PSDPLOG",14,0)
ASKN ;ask naou or group
"RTN","PSDPLOG",15,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPLOG",16,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPLOG",17,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPLOG",18,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X K DA,DIC S CNT=0
"RTN","PSDPLOG",19,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G SORT
"RTN","PSDPLOG",20,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPLOG",21,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPLOG",22,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPLOG",23,0)
 S:X="^ALL" ALL=1
"RTN","PSDPLOG",24,0)
SORT ;asks sort
"RTN","PSDPLOG",25,0)
 W ! K DA,DIR,DIRUT S DIR(0)="YO",DIR("A")="Do you wish to sort by Inventory Type",DIR("B")="NO"
"RTN","PSDPLOG",26,0)
 S DIR("?")="Answer YES to sort drugs by Inventory Type, NO or <RET> to sort by drug."
"RTN","PSDPLOG",27,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASKN=Y
"RTN","PSDPLOG",28,0)
SORT2 ;asks second sort
"RTN","PSDPLOG",29,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/DISPENSING #S;N:NUMERIC DISPENSING #S"
"RTN","PSDPLOG",30,0)
 S DIR("A")="Select Print Order for Inspector's Log",DIR("?",1)="Select D to print Dispensing Number numerically by drug, within an NAOU,",DIR("?")="select N to print numerically within an NAOU, or '^' to quit."
"RTN","PSDPLOG",31,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASK=Y
"RTN","PSDPLOG",32,0)
DEV ;ask device and queue info
"RTN","PSDPLOG",33,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPLOG",34,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPLOG",35,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION_";"_IOST_";"_IOM_";"_IOSL,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPLOG1",ZTDESC="Compile Narcotic Inspector Log" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPLOG",36,0)
 U IO G START^PSDPLOG1
"RTN","PSDPLOG",37,0)
END K %,%DT,%H,%I,%ZIS,ALL,ASK,ASKN,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,JJ,NAOU,NODE,NODE3,NUM
"RTN","PSDPLOG",38,0)
 K OK,PSD,PSDA,PSDDT,PSDG,PSDIO,PSDOK,PSDOUT,PSDN,PSDNA,PSDPT,PSDR,PSDRN,PSDRD,PSDRDT,PSDRET,PSDSD,PSDST,PSDT,PSDTR
"RTN","PSDPLOG",39,0)
 K QTY,SEL,STAT,STATN,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPLOG",40,0)
 K ^TMP("PSDLOG",$J) D ^%ZISC
"RTN","PSDPLOG",41,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPLOG",42,0)
 Q
"RTN","PSDPLOG",43,0)
GROUP ;select group of naous
"RTN","PSDPLOG",44,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPLOG",45,0)
 Q
"RTN","PSDPLOG",46,0)
SAVE S (ZTSAVE("PSDIO"),ZTSAVE("PSDT"),ZTSAVE("CNT"),ZTSAVE("PSDSITE"),ZTSAVE("ASK"),ZTSAVE("ASKN"))=""
"RTN","PSDPLOG",47,0)
 S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPLOG",48,0)
 S ZTSAVE("PSDRET")="" S:$D(PSDSD) ZTSAVE("PSDSD")=""
"RTN","PSDPLOG",49,0)
 Q
"RTN","PSDPLOG",50,0)
MSG W !!,"No action taken.",!!
"RTN","PSDPLOG",51,0)
 Q
"RTN","PSDPLOG1")
0^181^B19281186
"RTN","PSDPLOG1",1,0)
PSDPLOG1 ;BIR/JPW,LTL-CS Inspector's Log (cont'd) ; 31 May 95
"RTN","PSDPLOG1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPLOG1",3,0)
START ;compile data
"RTN","PSDPLOG1",4,0)
 K ^TMP("PSDLOG",$J) S (PSDCNT,PSDOUT)=0
"RTN","PSDPLOG1",5,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",3)=+PSDSITE S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPLOG1",6,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",3)=+PSDSITE,'$P(^(0),"^",7) S NAOU(+PSD)=""
"RTN","PSDPLOG1",7,0)
 F STAT=2.99:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:('STAT)!(STAT>5)  F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDPLOG1",8,0)
 S STAT=10 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDPLOG1",9,0)
 I $G(PSDRET) F PSDN=PSDSD:0 S PSDN=$O(^PSD(58.81,"ACT",PSDN)) Q:'PSDN!(PSDOUT)  F JJ=0:0 S JJ=$O(^PSD(58.81,"ACT",PSDN,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDPLOG1",10,0)
 .F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",PSDN,JJ,PSDR)) Q:'PSDR!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSDN,JJ,PSDR,3,PSDA)) Q:'PSDA!(PSDOUT)  S PSDOK="#" D
"RTN","PSDPLOG1",11,0)
 ..Q:'$D(^PSD(58.81,+PSDA,0))  S NODE=^PSD(58.81,PSDA,0),NODE3=$G(^(3))
"RTN","PSDPLOG1",12,0)
 ..S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ"_PSDR)
"RTN","PSDPLOG1",13,0)
 ..S PSD=+$P(NODE,"^",18) Q:'$D(NAOU(PSD))
"RTN","PSDPLOG1",14,0)
 ..S PSDNA=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDPLOG1",15,0)
 ..S NUM=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN"),QTY=+$P(NODE3,"^",2),EXP=$P(NODE,"^",15),EXPD="" I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDPLOG1",16,0)
 ..S Y=$E(PSDN,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDPLOG1",17,0)
 ..D SET
"RTN","PSDPLOG1",18,0)
 G:$D(ZTQUEUED) PRTQUE
"RTN","PSDPLOG1",19,0)
 I ASKN G PRINT^PSDPLOG3 Q
"RTN","PSDPLOG1",20,0)
 G PRINT^PSDPLOG2
"RTN","PSDPLOG1",21,0)
 Q
"RTN","PSDPLOG1",22,0)
PRTQUE ;queues print after compile
"RTN","PSDPLOG1",23,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN=$S(ASKN:"PRINT^PSDPLOG3",1:"PRINT^PSDPLOG2"),ZTDESC="Print Narcotic Inspector Log",ZTDTH=$H
"RTN","PSDPLOG1",24,0)
 S (ZTSAVE("^TMP(""PSDLOG"",$J,"),ZTSAVE("CNT"),ZTSAVE("ASK"),ZTSAVE("ASKN"))=""
"RTN","PSDPLOG1",25,0)
 D ^%ZTLOAD K ^TMP("PSDLOG",$J),ZTSK
"RTN","PSDPLOG1",26,0)
END K %,%DT,%H,%I,%ZIS,ALL,ASK,ASKN,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,JJ,NAOU,NODE,NODE3,NUM
"RTN","PSDPLOG1",27,0)
 K OK,PSD,PSDA,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDOUT,PSDN,PSDNA,PSDPT,PSDR,PSDRN,PSDRD,PSDRDT,PSDRET,PSDSD,PSDST,PSDT,PSDTR
"RTN","PSDPLOG1",28,0)
 K QTY,SEL,STAT,STATN,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPLOG1",29,0)
 K ^TMP("PSDLOG",$J) D ^%ZISC
"RTN","PSDPLOG1",30,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPLOG1",31,0)
 Q
"RTN","PSDPLOG1",32,0)
LOOP ;starts drug loop
"RTN","PSDPLOG1",33,0)
 F PSDR=0:0 S PSDR=$O(^PSD(58.8,"AC",STAT,PSD,PSDR)) Q:'PSDR  D
"RTN","PSDPLOG1",34,0)
 .F PSDA=0:0 S PSDA=$O(^PSD(58.8,"AC",STAT,PSD,PSDR,PSDA)) Q:'PSDA  I $D(^PSD(58.8,PSD,1,PSDR,3,PSDA,0)) S NODE=^PSD(58.8,PSD,1,PSDR,3,PSDA,0) D
"RTN","PSDPLOG1",35,0)
 ..Q:'$D(NAOU(PSD))  S PSDNA=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDPLOG1",36,0)
 ..S PSDOK=$S(STAT=3:"**",STAT=10:"*",1:""),PSDTR=$P(NODE,"^",17) I STAT=10 Q:$D(^PSD(58.81,"AE",PSDTR))
"RTN","PSDPLOG1",37,0)
 ..S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR),STAT=+$P(NODE,"^",11),STATN=$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPLOG1",38,0)
 ..S QTY=$P(NODE,"^",19),NUM=$S($P(NODE,"^",16)]"":$P(NODE,"^",16),1:"UNKNOWN"),EXP=$P(NODE,"^",10),EXPD="" I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDPLOG1",39,0)
 ..S PSDST=$P(NODE,"^",14),PSDDT="" I PSDST S Y=$E(PSDST,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDPLOG1",40,0)
 ..D SET
"RTN","PSDPLOG1",41,0)
 Q
"RTN","PSDPLOG1",42,0)
SET ;sets ^tmp
"RTN","PSDPLOG1",43,0)
 S PSDCNT=PSDCNT+1
"RTN","PSDPLOG1",44,0)
 I ASKN D LOOP0 Q
"RTN","PSDPLOG1",45,0)
 S:ASK="D" ^TMP("PSDLOG",$J,PSDNA,PSDRN,NUM,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK
"RTN","PSDPLOG1",46,0)
 S:ASK="N" ^TMP("PSDLOG",$J,PSDNA,NUM,PSDRN,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK
"RTN","PSDPLOG1",47,0)
 Q
"RTN","PSDPLOG1",48,0)
LOOP0 ;sets sort for inventory type sort
"RTN","PSDPLOG1",49,0)
 I '$O(^PSD(58.8,PSD,1,PSDR,2,0)) S TYPN="ZZ** NO INVENTORY TYPE DATA **" D LOOP1 Q
"RTN","PSDPLOG1",50,0)
 ;F NAOU=0:0 S NAOU=$O(NAOU(NAOU)) Q:'NAOU  
"RTN","PSDPLOG1",51,0)
 F TYP=0:0 S TYP=$O(^PSD(58.8,+PSD,1,PSDR,2,TYP)) Q:'TYP  S TYPN=$S($P($G(^PSI(58.16,+TYP,0)),"^")]"":$P(^(0),"^"),1:"TYPE NAME MISSING") D LOOP1
"RTN","PSDPLOG1",52,0)
 Q
"RTN","PSDPLOG1",53,0)
LOOP1 ;S:ASK="D" ^TMP("PSDLOG",$J,PSDNA,TYPN,PSDRN,NUM,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK
"RTN","PSDPLOG1",54,0)
 S:'$G(TYP) TYP=999999
"RTN","PSDPLOG1",55,0)
 D:ASK="D"
"RTN","PSDPLOG1",56,0)
 .S ^TMP("PSDLOG",$J,"B",PSDNA,PSD)="",^TMP("PSDLOG",$J,PSD,+TYP)=0
"RTN","PSDPLOG1",57,0)
 .S ^TMP("PSDLOG",$J,PSD,"B",TYPN,+TYP)=""
"RTN","PSDPLOG1",58,0)
 .S ^TMP("PSDLOG",$J,PSD,+TYP,PSDR,NUM,PSDCNT)=QTY_U_PSDDT_U_EXPD_U_PSDOK
"RTN","PSDPLOG1",59,0)
 .S ^TMP("PSDLOG",$J,PSD,+TYP,"B",PSDRN,PSDR)=""
"RTN","PSDPLOG1",60,0)
 ;S:ASK="N" ^TMP("PSDLOG",$J,PSDNA,TYPN,NUM,PSDRN,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK
"RTN","PSDPLOG1",61,0)
 D:ASK="N"
"RTN","PSDPLOG1",62,0)
 .S ^TMP("PSDLOG",$J,"B",PSDNA,PSD)="",^TMP("PSDLOG",$J,PSD,+TYP)=0
"RTN","PSDPLOG1",63,0)
 .S ^TMP("PSDLOG",$J,PSD,"B",TYPN,+TYP)=""
"RTN","PSDPLOG1",64,0)
 .S ^TMP("PSDLOG",$J,PSD,+TYP,NUM,PSDR,PSDCNT)=QTY_U_PSDDT_U_EXPD_U_PSDOK_U_PSDRN
"RTN","PSDPLOG1",65,0)
 Q
"RTN","PSDPLOG2")
0^182^B16699847
"RTN","PSDPLOG2",1,0)
PSDPLOG2 ;BIR/JPW-Inspector's Log (cont'd) ; 2 Aug 94
"RTN","PSDPLOG2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPLOG2",3,0)
PRINT ;print inspector's log by naou, drug and green sheet #
"RTN","PSDPLOG2",4,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPLOG2",5,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDLOG",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS FOR INSPECTION  ****",! G DONE
"RTN","PSDPLOG2",6,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDLOG",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y D  Q:PSDOUT  D PRT
"RTN","PSDPLOG2",7,0)
 .I ASKN D LOOP2 Q
"RTN","PSDPLOG2",8,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDLOG",$J,NAOU,PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG2",9,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y
"RTN","PSDPLOG2",10,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDLOG",$J,NAOU,PSDRN,NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDLOG",$J,NAOU,PSDRN,NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG2",11,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y
"RTN","PSDPLOG2",12,0)
 ...S NODE=$G(^TMP("PSDLOG",$J,NAOU,PSDRN,NUM,PSDCNT))
"RTN","PSDPLOG2",13,0)
 ...W !,$P(NODE,"^",4),?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55,$P(NODE,"^",2),?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3),?100,"____________",?118,"____________",!
"RTN","PSDPLOG2",14,0)
 ...S LNUM=$Y
"RTN","PSDPLOG2",15,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPLOG2",16,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPLOG2",17,0)
END K %,%DT,%H,%I,%ZIS,ALL,ANS,ASK,ASKN,CNT,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,JJ,LN,LNUM,LOOP,LOT,MFG,NAOU,NODE,NODE3,NUM
"RTN","PSDPLOG2",18,0)
 K OK,ORD,ORDN,PG,PSD,PSDA,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDN,PSDNA,PSDOUT,PSDR,PSDRN,PSDSD,PSDST,PSDT,PSDTR,QTY,REQD,REQDT,RPDT,RQTY
"RTN","PSDPLOG2",19,0)
 K SEL,STAT,STATN,TEXT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPLOG2",20,0)
 K ^TMP("PSDLOG",$J) D ^%ZISC
"RTN","PSDPLOG2",21,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPLOG2",22,0)
 Q
"RTN","PSDPLOG2",23,0)
HDR ;header for log
"RTN","PSDPLOG2",24,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPLOG2",25,0)
 S PG=PG+1 W:$Y @IOF W !,?42,"Inspector's Log for Controlled Substances",?120,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDPLOG2",26,0)
 W !,?57,"DATE",?71,"QTY"
"RTN","PSDPLOG2",27,0)
 W !,"DISP #",?13,"DRUG",?55,"DISPENSED",?68,"DISPENSED",?85,"EXP DATE",?100,"QTY ON HAND",?118,"NAME/DATE"
"RTN","PSDPLOG2",28,0)
 W !,LN,!
"RTN","PSDPLOG2",29,0)
 Q
"RTN","PSDPLOG2",30,0)
LOOP2 ;print inv typ loop
"RTN","PSDPLOG2",31,0)
 S TYPN="" F  S TYPN=$O(^TMP("PSDLOG",$J,NAOU,TYPN)) Q:TYPN=""!(PSDOUT)  W !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y D
"RTN","PSDPLOG2",32,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDLOG",$J,NAOU,TYPN,PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG2",33,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDPLOG2",34,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDLOG",$J,NAOU,TYPN,PSDRN,NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDLOG",$J,NAOU,TYPN,PSDRN,NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG2",35,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",TYPN,! S LNUM=$Y
"RTN","PSDPLOG2",36,0)
 ...S NODE=$G(^TMP("PSDLOG",$J,NAOU,TYPN,PSDRN,NUM,PSDCNT))
"RTN","PSDPLOG2",37,0)
 ...W !,$P(NODE,"^",4),?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55,$P(NODE,"^",2),?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3),?100,"____________",?118,"____________",!
"RTN","PSDPLOG2",38,0)
 ...S LNUM=$Y
"RTN","PSDPLOG2",39,0)
 Q
"RTN","PSDPLOG2",40,0)
PRT ;
"RTN","PSDPLOG2",41,0)
 I LNUM<IOSL-7 F JJ=LNUM:1:IOSL-7 W !
"RTN","PSDPLOG2",42,0)
 W LN,!,"*  - Transferred to another NAOU but not yet received",!,"** - Filled not yet received",!,"#  - Returned to Stock",!
"RTN","PSDPLOG2",43,0)
 Q
"RTN","PSDPLOG3")
0^183^B19498393
"RTN","PSDPLOG3",1,0)
PSDPLOG3 ;BIR/JPW,LTL-Inspector's Log (cont'd) ; 31 May 95
"RTN","PSDPLOG3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPLOG3",3,0)
PRINT ;print inspector's log by naou, drug and green sheet #
"RTN","PSDPLOG3",4,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPLOG3",5,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDLOG",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS FOR INSPECTION  ****",! G DONE
"RTN","PSDPLOG3",6,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDLOG",$J,"B",NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y D LOOP2 Q:PSDOUT  D PRT
"RTN","PSDPLOG3",7,0)
 D:'PSDOUT PRT
"RTN","PSDPLOG3",8,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPLOG3",9,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPLOG3",10,0)
END K %,%DT,%H,%I,%ZIS,ALL,ANS,ASK,ASKN,CNT,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,JJ,LN,LNUM,LOOP,LOT,MFG,NAOU,NODE,NODE3,NUM
"RTN","PSDPLOG3",11,0)
 K OK,ORD,ORDN,PG,PSD,PSDA,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDN,PSDNA,PSDOUT,PSDR,PSDRN,PSDSD,PSDST,PSDT,PSDTR,QTY,REQD,REQDT,RPDT,RQTY
"RTN","PSDPLOG3",12,0)
 K SEL,STAT,STATN,TEXT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPLOG3",13,0)
 K ^TMP("PSDLOG",$J) D ^%ZISC
"RTN","PSDPLOG3",14,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPLOG3",15,0)
 Q
"RTN","PSDPLOG3",16,0)
HDR ;header for log
"RTN","PSDPLOG3",17,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPLOG3",18,0)
 S PG=PG+1 W:$Y @IOF W !,?42,"Inspector's Log for Controlled Substances",?120,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDPLOG3",19,0)
 W !,?57,"DATE",?71,"QTY"
"RTN","PSDPLOG3",20,0)
 W !,"DISP #",?13,"DRUG",?55,"DISPENSED",?68,"DISPENSED",?85,"EXP DATE",?100,"QTY ON HAND",?118,"NAME/DATE"
"RTN","PSDPLOG3",21,0)
 W !,LN,!
"RTN","PSDPLOG3",22,0)
 Q
"RTN","PSDPLOG3",23,0)
LOOP2 ;print inv typ loop
"RTN","PSDPLOG3",24,0)
 S NAOU(1)=$O(^TMP("PSDLOG",$J,"B",NAOU,0))
"RTN","PSDPLOG3",25,0)
 S TYPN="" F  S TYPN=$O(^TMP("PSDLOG",$J,NAOU(1),"B",TYPN)) Q:TYPN=""!(PSDOUT)  W !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y D
"RTN","PSDPLOG3",26,0)
 .S TYPN(1)=$O(^TMP("PSDLOG",$J,NAOU(1),"B",TYPN,0))
"RTN","PSDPLOG3",27,0)
 .I ASK="N" D  Q
"RTN","PSDPLOG3",28,0)
 ..S NUM=0
"RTN","PSDPLOG3",29,0)
 ..F  S NUM=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),NUM)) Q:NUM=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG3",30,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,!!?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDPLOG3",31,0)
 ...S PSDR=0
"RTN","PSDPLOG3",32,0)
 ...F  S PSDR=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),NUM,PSDR)) Q:'PSDR!(PSDOUT)  S PSDCNT=0 F  S PSDCNT=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),NUM,PSDR,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG3",33,0)
 ....I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,!!?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDPLOG3",34,0)
 ....S NODE=$G(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),NUM,PSDR,PSDCNT))
"RTN","PSDPLOG3",35,0)
 ....W !,$P(NODE,U,4),?2,NUM,?13,$P(NODE,U,5),?55,$P(NODE,U,2),?70,$J($P(NODE,U),6),?85,$P(NODE,U,3),?100,"____________",?118,"____________",! S LNUM=$Y
"RTN","PSDPLOG3",36,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),"B",PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG3",37,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDPLOG3",38,0)
 ..S PSDRN(1)=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),"B",PSDRN,0))
"RTN","PSDPLOG3",39,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPLOG3",40,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",TYPN,! S LNUM=$Y
"RTN","PSDPLOG3",41,0)
 ...S NODE=$G(^TMP("PSDLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM,PSDCNT))
"RTN","PSDPLOG3",42,0)
 ...W !,$P(NODE,"^",4),?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55,$P(NODE,"^",2),?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3),?100,"____________",?118,"____________",!
"RTN","PSDPLOG3",43,0)
 ...S LNUM=$Y
"RTN","PSDPLOG3",44,0)
 Q
"RTN","PSDPLOG3",45,0)
PRT ;
"RTN","PSDPLOG3",46,0)
 I LNUM<IOSL-7 F JJ=LNUM:1:IOSL-7 W !
"RTN","PSDPLOG3",47,0)
 W LN,!,"*  - Transferred to another NAOU but not yet received",!,"** - Filled not yet received",!,"#  - Returned to Stock",!
"RTN","PSDPLOG3",48,0)
 Q
"RTN","PSDPMFG")
0^184^B17709092
"RTN","PSDPMFG",1,0)
PSDPMFG ;BIR/JPW-Print Mfg/Lot #/Exp. Date for Stock Drugs ; 6 July 94
"RTN","PSDPMFG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPMFG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPMFG",4,0)
 W !!,"=>  This report lists Manufacturer, Lot #, Expiration Date, and Narcotic ",!,"    Information for CS Stock Drugs.",!
"RTN","PSDPMFG",5,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDPMFG",6,0)
 I '$O(^PSD(58.8,0)) W !!,"You MUST create NAOUs before running this report!" Q
"RTN","PSDPMFG",7,0)
ASKN ;ask NAOU(s)
"RTN","PSDPMFG",8,0)
 D NOW^%DTC S PSDT=X K DA,DIC S CNT=0,DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPMFG",9,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>PSDT:1,1:0),$P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC Q:Y<0  S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPMFG",10,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPMFG",11,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,+^("I")>PSDT:1,1:0),$P($G(^(0)),"^",2)'="P",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(+PSD)="",CNT=CNT+1
"RTN","PSDPMFG",12,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/NAOU;N:NAOU/DRUG",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDPMFG",13,0)
 S DIR("?",1)="Enter 'D' to print the report sorted by DRUG then NAOU",DIR("?")="Enter 'N' to print the report sorted by NAOU then DRUG."
"RTN","PSDPMFG",14,0)
 S DIR("A")="Select SORT ORDER for Report" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDPMFG",15,0)
DEV ;ask device and queueing information
"RTN","PSDPMFG",16,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPMFG",17,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPMFG",18,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPMFG",ZTDESC="Compile Mfg Data for CS PHARM Stock Drugs" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPMFG",19,0)
 U IO
"RTN","PSDPMFG",20,0)
START ;compile mfg/lot #/exp. date/narcotic breakdown unit/pkg data
"RTN","PSDPMFG",21,0)
 K ^TMP("PSDPMFG",$J)
"RTN","PSDPMFG",22,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) G:('PSD)&($D(ZTQUEUED)) PRTQUE G:'PSD PRINT^PSDPMFG1 I $D(^PSD(58.8,PSD,0)) F DRUG=0:0 S DRUG=$O(^PSD(58.8,PSD,1,DRUG)) Q:'DRUG  D
"RTN","PSDPMFG",23,0)
 .S NAOUN=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDPMFG",24,0)
 .Q:'$D(^PSD(58.8,PSD,1,DRUG,0))  S NODE=^PSD(58.8,PSD,1,DRUG,0) I +$P(NODE,"^",14) D NOW^%DTC I $P(^PSD(58.8,PSD,1,DRUG,0),"^",14)'>X Q
"RTN","PSDPMFG",25,0)
 .Q:'$D(^PSDRUG(DRUG,0))  I $D(^PSDRUG(DRUG,0)) S DRUGN=$S($P(^PSDRUG(DRUG,0),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDPMFG",26,0)
 .S MFG=$S($P(NODE,"^",10)]"":$P(NODE,"^",10),1:"____________________")
"RTN","PSDPMFG",27,0)
 .S LOT=$S($P(NODE,"^",11)]"":$P(NODE,"^",11),1:"__________"),EXP=$S($P(NODE,"^",12)]"":$P(NODE,"^",12),1:"__________")
"RTN","PSDPMFG",28,0)
 .S BKU=$S($P(NODE,"^",8)]"":$P(NODE,"^",8),1:"__________"),PKG=$S($P(NODE,"^",9)]"":$P(NODE,"^",9),1:"__________") I +EXP S Y=EXP X ^DD("DD") S EXP=Y
"RTN","PSDPMFG",29,0)
 .I (CNT=1)!(ANS="N") S ^TMP("PSDPMFG",$J,NAOUN,DRUGN)=MFG_"^"_LOT_"^"_EXP_"^"_BKU_"^"_PKG
"RTN","PSDPMFG",30,0)
 .I ANS="D",CNT'=1 S ^TMP("PSDPMFG",$J,DRUGN,NAOUN)=MFG_"^"_LOT_"^"_EXP_"^"_BKU_"^"_PKG
"RTN","PSDPMFG",31,0)
 Q
"RTN","PSDPMFG",32,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDPMFG",33,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDPMFG1",ZTDESC="Print Mfg Data for CS PHARM Stock Drugs",ZTDTH=$H,ZTSAVE("^TMP(""PSDPMFG"",$J,")="",ZTSAVE("ANS")="",ZTSAVE("CNT")=""
"RTN","PSDPMFG",34,0)
 D ^%ZTLOAD K ^TMP("PSDPMFG",$J),ZTSK
"RTN","PSDPMFG",35,0)
END ;
"RTN","PSDPMFG",36,0)
 K %,%H,%I,%ZIS,ANS,BKU,CNT,DA,DIC,DIR,DIROUT,DIRUT,DIK,DRUG,DRUGN,DTOUT,DUOUT,EXP,IO("Q"),LOT,MFG,NAOU,NAOUN,NODE,PKG,POP,PSD,PSDIO,PSDT
"RTN","PSDPMFG",37,0)
 K X,Y,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTRTN,^TMP("PSDPMFG",$J) D ^%ZISC
"RTN","PSDPMFG",38,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPMFG",39,0)
 Q
"RTN","PSDPMFG",40,0)
SAVE ;save variables for queueing
"RTN","PSDPMFG",41,0)
 S ZTSAVE("PSDIO")="",ZTSAVE("PSDT")="",ZTSAVE("ANS")="",ZTSAVE("PSDSITE")=""
"RTN","PSDPMFG",42,0)
 S ZTSAVE("CNT")="",ZTSAVE("NAOU(")="",ZTSAVE("PSD")=""
"RTN","PSDPMFG",43,0)
 Q
"RTN","PSDPMFG1")
0^185^B6793120
"RTN","PSDPMFG1",1,0)
PSDPMFG1 ;BIR/JPW-Print Mfg data for CS Drugs (cont'd) ; 2 Aug 94
"RTN","PSDPMFG1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPMFG1",3,0)
PRINT ;print data for stock drugs
"RTN","PSDPMFG1",4,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="",%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y D HEADER Q:PSDOUT
"RTN","PSDPMFG1",5,0)
 I '$D(^TMP("PSDPMFG",$J)) W !!,?45,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G END
"RTN","PSDPMFG1",6,0)
 S VAR1="" F  S VAR1=$O(^TMP("PSDPMFG",$J,VAR1)) Q:VAR1=""!(PSDOUT)  D:$Y+5>IOSL HEADER Q:PSDOUT  W !,"=> ",$S(VAR1["ZZ/":"#"_$P(VAR1,"/",2)_" NAME MISSING",1:VAR1) D  Q:PSDOUT
"RTN","PSDPMFG1",7,0)
 .S VAR2="" F  S VAR2=$O(^TMP("PSDPMFG",$J,VAR1,VAR2)) Q:VAR2=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPMFG1",8,0)
 ..S NODE=^TMP("PSDPMFG",$J,VAR1,VAR2) S VAR2N=$S(VAR2["ZZ/":"#"_$P(VAR2,"/",2)_" NAME MISSING",1:VAR2)
"RTN","PSDPMFG1",9,0)
 ..S MFG=$P(NODE,"^"),LOT=$P(NODE,"^",2),BKU=$P(NODE,"^",4),PKG=$P(NODE,"^",5),EXP=$P(NODE,"^",3)
"RTN","PSDPMFG1",10,0)
 ..D:$Y+5>IOSL HEADER Q:PSDOUT  W !,?4,VAR2N,?46,MFG,?80,LOT,?95,EXP,?110,BKU,?122,PKG
"RTN","PSDPMFG1",11,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPMFG1",12,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPMFG1",13,0)
END ;
"RTN","PSDPMFG1",14,0)
 K %DT,%ZIS,ANS,BKU,CNT,DA,DIK,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,EXP,LN,LOT,MFG,NAOU,NAOUN,NODE,PG,PKG,POP,PSD,PSDIO,PSDT,PSDOUT,RPDT
"RTN","PSDPMFG1",15,0)
 K VAR1,VAR2,VAR2N,X,Y,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTRTN,^TMP("PSDPMFG",$J) D ^%ZISC
"RTN","PSDPMFG1",16,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPMFG1",17,0)
 Q
"RTN","PSDPMFG1",18,0)
HEADER ;lists header infomation
"RTN","PSDPMFG1",19,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPMFG1",20,0)
 W:$Y @IOF S PG=PG+1 W !,RPDT,?122,"PAGE: "_PG,!,?50,"MANUFACTURER and NARCOTIC INFORMATION",!,?60,"FOR CS STOCK DRUGS",!!
"RTN","PSDPMFG1",21,0)
 W "=> ",$S(CNT=1:"NAOU",ANS="N":"NAOU",1:"DRUG"),?95,"EXPIRATION",?110,"BREAKDOWN",?122,"PACKAGE",!,?14,$S(CNT=1:"DRUG",ANS="N":"DRUG",1:"NAOU")
"RTN","PSDPMFG1",22,0)
 W ?46,"MANUFACTURER",?80,"LOT #",?95,"DATE",?110,"UNIT",?122,"SIZE",!,LN,!
"RTN","PSDPMFG1",23,0)
 Q
"RTN","PSDPND")
0^186^B20543522
"RTN","PSDPND",1,0)
PSDPND ;BIR/JPW-Pharm Dispensing Report ; 29 Aug 94
"RTN","PSDPND",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPND",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPND",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDPND",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS reports.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDPND",6,0)
ASKD ;ask disp loc
"RTN","PSDPND",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPND",8,0)
 G:$P(PSDSITE,U,5) DATE
"RTN","PSDPND",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDPND",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPND",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPND",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPND",13,0)
DATE ;ask date range
"RTN","PSDPND",14,0)
 W ! K %DT S %DT="AEX",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDPND",15,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDPND",16,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDPND",17,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDPND",18,0)
SUM ;if sum only
"RTN","PSDPND",19,0)
 K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the summary totals only",DIR("B")="NO"
"RTN","PSDPND",20,0)
 S DIR("?",1)="Answer 'YES' to print only the summary totals for this report,",DIR("?")="answer 'NO' to print the report and the summary totals."
"RTN","PSDPND",21,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDPND",22,0)
DEV ;dev & queue info
"RTN","PSDPND",23,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPND",24,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPND",25,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPND",26,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPND",ZTDESC="Pharm Narcotic Disp Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPND",27,0)
 U IO
"RTN","PSDPND",28,0)
START ;compile data
"RTN","PSDPND",29,0)
 K ^TMP("PSDND",$J),^TMP("PSDNDT",$J)
"RTN","PSDPND",30,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"AF",PSD)) Q:'PSD!(PSD>PSDED)  F JJ=2,6,7 F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AF",PSD,PSDS,JJ,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)) D
"RTN","PSDPND",31,0)
 .S NODE=^PSD(58.81,PSDA,0),PSDPN=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDPND",32,0)
 .S NAOU=+$P(NODE,"^",18),NAOUN=$S($P($G(^PSD(58.8,NAOU,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_NAOU) I NAOUN'="UNKNOWN" S NAOUN=$E(NAOUN,1,24)
"RTN","PSDPND",33,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDPND",34,0)
 .S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDPND",35,0)
 .I JJ=7 S QTY=0 Q:PSDPN="UNKNOWN"
"RTN","PSDPND",36,0)
 .I $D(^PSD(58.81,PSDA,5)),+^(5) S QTY=0,NAOUN="CANCELLED"
"RTN","PSDPND",37,0)
 .S:'$D(^TMP("PSDNDT",$J,DRUGN)) ^TMP("PSDNDT",$J,DRUGN)=0
"RTN","PSDPND",38,0)
 .S ^TMP("PSDNDT",$J,DRUGN)=^TMP("PSDNDT",$J,DRUGN)+QTY Q:SUM
"RTN","PSDPND",39,0)
 .I 'PSDPN S PSDPN="W/O 2638",PHARM=+$P(NODE,"^",7)
"RTN","PSDPND",40,0)
 .I $D(^PSD(58.81,PSDA,1)) S PHARM=+$P(^(1),"^")
"RTN","PSDPND",41,0)
 .S PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") I PHARMN'="UNKNOWN" S PHARMN=$P(PHARMN,",")_","_$E($P(PHARMN,",",2))
"RTN","PSDPND",42,0)
 .S PSDST=$P(NODE,"^",4),PSDDT="" I PSDST S Y=$E(PSDST,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDPND",43,0)
 .I JJ=6,'$D(^PSD(58.81,PSDA,6)) Q
"RTN","PSDPND",44,0)
 .I JJ=6 S PSRX=+$P(^PSD(58.81,PSDA,6),"^"),PSDPN=$S($P(^(6),"^",5)]"":$P(^(6),"^",5),$P($G(^PSRX(PSRX,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN") D
"RTN","PSDPND",45,0)
 ..S PSRXP=+$P($G(^PSRX(PSRX,0)),"^",2)
"RTN","PSDPND",46,0)
 ..K C S Y=PSRXP,C=$P(^DD(58.81,73,0),"^",2) D Y^DIQ K C
"RTN","PSDPND",47,0)
 ..S NAOUN=$S('$O(^PSRX("B",PSDPN,0)):"RX DELETED",$P($G(^PSRX(PSRX,0)),"^",15)=13:"RX DELETED",PSRXP]"":Y,1:"UNKNOWN"),NAOUN=$E(NAOUN,1,24)
"RTN","PSDPND",48,0)
 .S ^TMP("PSDND",$J,PSDPN,PSDA)=DRUGN_"^"_NAOUN_"^"_QTY_"^"_PSDDT_"^"_PHARMN
"RTN","PSDPND",49,0)
PRT D PRINT^PSDPND1
"RTN","PSDPND",50,0)
END ;
"RTN","PSDPND",51,0)
 K %,%DT,%H,%I,%ZIS,C,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DRUG,DRUGN,DUOUT,JJ,LN,NAOU,NAOUN,NODE,NUM,OK
"RTN","PSDPND",52,0)
 K PG,PHARM,PHARMN,POP,PSD,PSDA,PSDATE,PSDDT,PSDED,PSDEV,PSDOUT,PSDPN,PSRX,PSRXP,PSDS,PSDSD,PSDSN,PSDST,QTY,SUM,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPND",53,0)
 K ^TMP("PSDND",$J),^TMP("PSDNDT",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPND",54,0)
 Q
"RTN","PSDPND",55,0)
SAVE S (ZTSAVE("SUM"),ZTSAVE("PSDSN"),ZTSAVE("PSDS"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDATE"))=""
"RTN","PSDPND",56,0)
 Q
"RTN","PSDPND1")
0^187^B8758594
"RTN","PSDPND1",1,0)
PSDPND1 ;BIR/JPW-Pharm Dispensing Report (cont'd) ; 2 Aug 94
"RTN","PSDPND1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPND1",3,0)
PRINT ;print pharmacy disp log by date
"RTN","PSDPND1",4,0)
 I SUM S PG=0 D SUMPRT G DONE
"RTN","PSDPND1",5,0)
 S (PG,PSDOUT)=0
"RTN","PSDPND1",6,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDND",$J)) D HDR W !!,?45,"****  NO DISPENSING DATA FOR THIS DISPENSING LOCATION  ****" G DONE
"RTN","PSDPND1",7,0)
 D HDR S NUM="" F  S NUM=$O(^TMP("PSDND",$J,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  D
"RTN","PSDPND1",8,0)
 .F PSD=0:0 S PSD=$O(^TMP("PSDND",$J,NUM,PSD)) Q:'PSD!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  S NODE=^TMP("PSDND",$J,NUM,PSD) W !,NUM,?15,$P(NODE,"^"),?58,$J($P(NODE,"^",3),6),?68,$P(NODE,"^",4),?86,$P(NODE,"^",2),?112,$P(NODE,"^",5)
"RTN","PSDPND1",9,0)
 I $E(IOST,1,2)="C-",'PSDOUT W !!,"Press <RET> to return to display the summary totals" R X:DTIME
"RTN","PSDPND1",10,0)
 D:'PSDOUT SUMPRT
"RTN","PSDPND1",11,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPND1",12,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPND1",13,0)
 Q
"RTN","PSDPND1",14,0)
HDR ;header for log
"RTN","PSDPND1",15,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPND1",16,0)
 S PG=PG+1 W:$Y @IOF W !,?45,"Pharmacy Dispensing Report",?115,"Page: ",PG,!,?45,"Dispensing Vault: "_PSDSN,!,?45,$P(PSDATE,"^")_" to "_$P(PSDATE,"^",2)
"RTN","PSDPND1",17,0)
 W !!,?58,"QUANTITY",?71,"DATE"
"RTN","PSDPND1",18,0)
 W !,"DISP #",?15,"DRUG",?58,"DISPENSED",?71,"DISP",?86,"DISPENSED TO",?112,"DISPENSED BY"
"RTN","PSDPND1",19,0)
 W !,LN,!
"RTN","PSDPND1",20,0)
 Q
"RTN","PSDPND1",21,0)
SUMPRT ;prt sum
"RTN","PSDPND1",22,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",80)=""
"RTN","PSDPND1",23,0)
 I '$D(^TMP("PSDNDT",$J)) D SUMHDR W !!,?45,"****  NO DISPENSING DATA FOR THIS DISPENSING LOCATION  ****" Q
"RTN","PSDPND1",24,0)
PRTSUM ;prints summary data
"RTN","PSDPND1",25,0)
 D SUMHDR Q:PSDOUT
"RTN","PSDPND1",26,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDNDT",$J,DRUG)) Q:DRUG=""  D:$Y+4>IOSL SUMHDR Q:PSDOUT  W !,?2,DRUG,?60,$J(+^TMP("PSDNDT",$J,DRUG),6),!
"RTN","PSDPND1",27,0)
 Q
"RTN","PSDPND1",28,0)
SUMHDR ;sum header
"RTN","PSDPND1",29,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPND1",30,0)
 W:$Y @IOF S PG=PG+1 W !,?25,"Pharmacy Dispensing Report",?70,"Page "_PG,!,?25,$P(PSDATE,"^")_" to "_$P(PSDATE,"^",2),!,?31,"** SUMMARY **",!!,"Dispensing Vault: ",PSDSN,!!
"RTN","PSDPND1",31,0)
 W ?5,"DRUG",?57,"TOTAL DISPENSED",!,LN,!
"RTN","PSDPND1",32,0)
 Q
"RTN","PSDPRG")
0^188^B2077020
"RTN","PSDPRG",1,0)
PSDPRG ;BIR/JPW-Purge the CS WORKSHEET file (#58.85) ; 3 Jun 94
"RTN","PSDPRG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPRG",3,0)
LOOP ;start looping on order status x-ref
"RTN","PSDPRG",4,0)
 F PSD=3.99:0 S PSD=$O(^PSD(58.85,"AC",PSD)) Q:'PSD!(PSD>9)  F PSDA=0:0 S PSDA=$O(^PSD(58.85,"AC",PSD,PSDA)) Q:'PSDA  F PSDR=0:0 S PSDR=$O(^PSD(58.85,"AC",PSD,PSDA,PSDR)) Q:'PSDR  D
"RTN","PSDPRG",5,0)
 .F PSDN=0:0 S PSDN=$O(^PSD(58.85,"AC",PSD,PSDA,PSDR,PSDN)) Q:'PSDN  S DA=+$O(^PSD(58.85,"AC",PSD,PSDA,PSDR,PSDN,0)) I DA,$D(^PSD(58.85,+DA,0)) S DIK="^PSD(58.85," D ^DIK K DA,DIK
"RTN","PSDPRG",6,0)
 K PSD,PSDA,PSDN,PSDR
"RTN","PSDPRT")
0^189^B2823025
"RTN","PSDPRT",1,0)
PSDPRT ;BIR/JPW-Print Setup Lists for Package ; 4 Sept 92
"RTN","PSDPRT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPRT",3,0)
INVEN ;print inventory types from file 58.16
"RTN","PSDPRT",4,0)
 W @IOF W !!,"The NAOU Inventory Types report is designed for an 80 column format.",!!
"RTN","PSDPRT",5,0)
 K DIC S DIC=58.16,L=0,FLDS=".01,1",BY=".01",(FR,TO)="",DHD="NAOU INVENTORY TYPES" D EN1^DIP G END
"RTN","PSDPRT",6,0)
 ;
"RTN","PSDPRT",7,0)
CODE ;print drug location codes from file 58.17
"RTN","PSDPRT",8,0)
 W @IOF W !!,"The CS Drug Location Codes report is designed for an 80 column format.",!!
"RTN","PSDPRT",9,0)
 K DIC S DIC=58.17,L=0,FLDS=".01;""CODE"",.5;C18",BY=".01",(FR,TO)="",DHD="CS DRUG LOCATION CODES" D EN1^DIP G END
"RTN","PSDPRT",10,0)
 ;
"RTN","PSDPRT",11,0)
NAOU ;print NAOU, location type & primary disp. site by inpatient site
"RTN","PSDPRT",12,0)
 W @IOF,!!,"The NARCOTIC AREA OF USE data report is designed for a 132 column format.",!
"RTN","PSDPRT",13,0)
 K DIC S DIC=58.8,L=0,FLDS=".01;""NAOU"",1;C40,3;C60",BY="2,.01",(FR,TO)="",DHD="NARCOTIC AREA OF USE",DIS(0)="I $P(^PSD(58.8,D0,0),""^"",2)'=""P""" D EN1^DIP
"RTN","PSDPRT",14,0)
 ;
"RTN","PSDPRT",15,0)
END ;
"RTN","PSDPRT",16,0)
 K BY,DHD,DIC,DIS,FLDS,FR,L,TO,X
"RTN","PSDPSI")
0^190^B23713234
"RTN","PSDPSI",1,0)
PSDPSI ;BIR/JPW-Green Sheets Placed on Insp Hold Rpt ; 29 Aug 94
"RTN","PSDPSI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPSI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPSI",4,0)
ASKD ;ask disp location
"RTN","PSDPSI",5,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPSI",6,0)
 I $P(PSDSITE,U,5) S PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) G ASKN
"RTN","PSDPSI",7,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDPSI",8,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPSI",9,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPSI",10,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PSDS=PSDS_"^"_+$P(Y(0),"^",5)
"RTN","PSDPSI",11,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPSI",12,0)
ASKN ;ask naou or group
"RTN","PSDPSI",13,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPSI",14,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPSI",15,0)
 S DIR("?",1)="Enter 'N' to select one, some, or ^ALL for all NAOU(s).",DIR("?")="Enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPSI",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X,PSDPT=+$E(%,1,12) K DA,DIC S CNT=0
"RTN","PSDPSI",17,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDPSI",18,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7),$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPSI",19,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPSI",20,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPSI",21,0)
 S:X="^ALL" ALL=1
"RTN","PSDPSI",22,0)
DEV ;ask device and queue info
"RTN","PSDPSI",23,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDPSI",24,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPSI",25,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPSI",26,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPSI",ZTDESC="CS Green Sheets Placed on Insp Hold" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPSI",27,0)
 U IO
"RTN","PSDPSI",28,0)
START ;compile data
"RTN","PSDPSI",29,0)
 K ^TMP("PSDPSI",$J)
"RTN","PSDPSI",30,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",4)=+PSDS S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPSI",31,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",4)=+PSDS,'$P(^(0),"^",7) S NAOU(+PSD)=""
"RTN","PSDPSI",32,0)
 F PSD=0:0 S PSD=$O(NAOU(PSD)) Q:'PSD  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AD",11,PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)) S NODE=^PSD(58.81,PSDA,0) D
"RTN","PSDPSI",33,0)
 .S PSDNA=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDPSI",34,0)
 .S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDPSI",35,0)
 .S PSDBY=+$P(NODE,"^",7),PSDBY=$P($G(^VA(200,+PSDBY,0)),"^")
"RTN","PSDPSI",36,0)
 .S (PSDTH,Y)=+$P($G(^PSD(58.81,PSDA,1.5)),"^",3) X ^DD("DD") S PSDTH=Y
"RTN","PSDPSI",37,0)
 .S PSDANS=$G(^PSD(58.81,PSDA,1.6))
"RTN","PSDPSI",38,0)
 .S NUM=$P(NODE,"^",17),^TMP("PSDPSI",$J,PSDNA,NUM,DRUGN)=PSDBY_"^"_PSDTH_"^"_PSDANS
"RTN","PSDPSI",39,0)
PRINT ;print green sheets picked up naou, green sheet #
"RTN","PSDPSI",40,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPSI",41,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDPSI",$J)) D HDR W !!,?10,"****  NO GREEN SHEETS ON INSPECTOR HOLD  ****" G END
"RTN","PSDPSI",42,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDPSI",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: "_NAOU,! D  Q:PSDOUT
"RTN","PSDPSI",43,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDPSI",$J,NAOU,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+6>IOSL HDR Q:PSDOUT  S DRUG=$O(^TMP("PSDPSI",$J,NAOU,NUM,0)) Q:DRUG=""  D
"RTN","PSDPSI",44,0)
 ..W !,NUM,?12,DRUG,?55,$P(^TMP("PSDPSI",$J,NAOU,NUM,DRUG),"^"),!,?15,$P(^TMP("PSDPSI",$J,NAOU,NUM,DRUG),"^",2),!
"RTN","PSDPSI",45,0)
 ..W:$P(^TMP("PSDPSI",$J,NAOU,NUM,DRUG),"^",3)]"" ?15,$P(^TMP("PSDPSI",$J,NAOU,NUM,DRUG),"^",3),!
"RTN","PSDPSI",46,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPSI",47,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPSI",48,0)
END K %,%H,%I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NODE,NUM
"RTN","PSDPSI",49,0)
 K OK,PG,POP,PSD,PSDBY,PSDA,PSDANS,PSDEV,PSDG,PSDN,PSDNA,PSDS,PSDSN,PSDOUT,PSDPT,PSDT,PSDTH,RPDT,SEL,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPSI",50,0)
 K ^TMP("PSDPSI",$J) D ^%ZISC
"RTN","PSDPSI",51,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPSI",52,0)
 Q
"RTN","PSDPSI",53,0)
GROUP ;select group of naous
"RTN","PSDPSI",54,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPSI",55,0)
 Q
"RTN","PSDPSI",56,0)
SAVE S (ZTSAVE("PSDT"),ZTSAVE("CNT"),ZTSAVE("PSDS"))="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPSI",57,0)
 Q
"RTN","PSDPSI",58,0)
HDR ;header for log
"RTN","PSDPSI",59,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPSI",60,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"Green Sheets Placed on Hold for Inspector Review",?70,"Page: ",PG,!,?26,"Run Date: ",RPDT,!
"RTN","PSDPSI",61,0)
 W !,"DISP #",?12,"DRUG",?55,"PLACED ON HOLD BY",!,?15,"DATE PLACED ON HOLD",!,?15,"HOLD REMARKS"
"RTN","PSDPSI",62,0)
 W !,LN,!
"RTN","PSDPSI",63,0)
 Q
"RTN","PSDPSTK")
0^191^B11031635
"RTN","PSDPSTK",1,0)
PSDPSTK ;BIR/JPW-Print Data for CS Stock Drugs ; 7 Sept 92
"RTN","PSDPSTK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPSTK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPSTK",4,0)
 W !!,"This report lists data stored for CS Stock Drugs.",!!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPSTK",5,0)
 I '$O(^PSD(58.8,0)) W !!,"You MUST create NAOUs before running this report!" Q
"RTN","PSDPSTK",6,0)
 D NOW^%DTC S PSDT=X
"RTN","PSDPSTK",7,0)
DEV ;ask device and queueing information
"RTN","PSDPSTK",8,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPSTK",9,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPSTK",ZTDESC="Compile Data for CS PHARM Stock Drugs",ZTSAVE("PSDIO")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSDT")="" D ^%ZTLOAD K ZTSK G END
"RTN","PSDPSTK",10,0)
 U IO
"RTN","PSDPSTK",11,0)
START ;compile data for stock drug report
"RTN","PSDPSTK",12,0)
 K ^TMP("PSDPSTK",$J)
"RTN","PSDPSTK",13,0)
 F NAOU=0:0 S NAOU=$O(^PSD(58.8,NAOU)) G:('NAOU)&($D(ZTQUEUED)) PRTQUE G:'NAOU PRINT^PSDPSTK1 I $D(^PSD(58.8,NAOU,0)),$P(^(0),"^",3)=+PSDSITE,$P(^(0),"^",2)'="P" F DRUG=0:0 S DRUG=$O(^PSD(58.8,NAOU,1,DRUG)) Q:'DRUG  D
"RTN","PSDPSTK",14,0)
 .Q:'$D(^PSD(58.8,NAOU,1,DRUG,0))  I +$P(^PSD(58.8,NAOU,1,DRUG,0),"^",14) D NOW^%DTC I $P(^PSD(58.8,NAOU,1,DRUG,0),"^",14)'>X Q
"RTN","PSDPSTK",15,0)
 .Q:'$D(^PSDRUG(DRUG,0))  I $D(^PSDRUG(DRUG,0)) S DRUGN=$S($P(^PSDRUG(DRUG,0),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDPSTK",16,0)
 .I $D(^PSD(58.8,NAOU,"I")),$P(^("I"),"^"),$P(^("I"),"^")'>PSDT S ^TMP("PSDPSTK",$J,DRUGN,NAOU,0)="I^"_$P(^("I"),"^") Q
"RTN","PSDPSTK",17,0)
 .S NODE=^PSD(58.8,NAOU,1,DRUG,0),LOC=$S($P(NODE,"^",2)]"":$P(NODE,"^",2),1:"NONE"),STK=$S($P(NODE,"^",3)]"":$P(NODE,"^",3),1:"NONE")
"RTN","PSDPSTK",18,0)
 .S TYPE="" F TYP=0:0 S TYP=$O(^PSD(58.8,NAOU,1,DRUG,2,TYP)) Q:'TYP  S TYPE=TYPE_";;"_TYP
"RTN","PSDPSTK",19,0)
 .S WARD="" F WRD=0:0 S WRD=$O(^PSD(58.8,NAOU,1,DRUG,1,WRD)) Q:'WRD  S WARD=WARD_";;"_WRD
"RTN","PSDPSTK",20,0)
 .S:TYPE="" TYPE=";;NONE" S:WARD="" WARD=";;NONE" S ^TMP("PSDPSTK",$J,DRUGN,NAOU,0)=LOC_"^"_STK_"^"_TYPE
"RTN","PSDPSTK",21,0)
 .S ^TMP("PSDPSTK",$J,DRUGN,NAOU,1)=WARD
"RTN","PSDPSTK",22,0)
 Q
"RTN","PSDPSTK",23,0)
END ;
"RTN","PSDPSTK",24,0)
 K %,%H,%I,%ZIS,DA,DATEI,DIK,DRUG,DRUGN,IO("Q"),LOC,NAOU,NODE,POP,PSDIO,PSDT,STK,TYP,TYPE,WARD,WRD
"RTN","PSDPSTK",25,0)
 K X,Y,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTRTN,^TMP("PSDPSTK",$J) D ^%ZISC
"RTN","PSDPSTK",26,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPSTK",27,0)
 Q
"RTN","PSDPSTK",28,0)
PRTQUE ;queues print after data is compiled
"RTN","PSDPSTK",29,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDPSTK1",ZTDESC="Print Data for CS PHARM Stock Drugs",ZTDTH=$H,ZTSAVE("^TMP(""PSDPSTK"",$J,")=""
"RTN","PSDPSTK",30,0)
 D ^%ZTLOAD K ^TMP("PSDPSTK",$J) K ZTSK G END
"RTN","PSDPSTK1")
0^192^B10175288
"RTN","PSDPSTK1",1,0)
PSDPSTK1 ;BIR/JPW-Print Data for CS Drugs (cont'd) ; 2 Aug 94
"RTN","PSDPSTK1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPSTK1",3,0)
PRINT ;print data for stock drugs
"RTN","PSDPSTK1",4,0)
 K LN S (PG,PSDOUT)=0,$P(LN,"-",132)="",%DT="",X="T" D ^%DT X ^DD("DD") S RPDT=Y D HEADER Q:PSDOUT
"RTN","PSDPSTK1",5,0)
 I '$D(^TMP("PSDPSTK",$J)) W !!,?45,"*****  NO DATA AVAILABLE FOR THIS REPORT  *****" G END
"RTN","PSDPSTK1",6,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDPSTK",$J,DRUG)) Q:DRUG=""!(PSDOUT)  D:$Y+5>IOSL HEADER Q:PSDOUT  W !,"=> ",$S(DRUG["ZZ/":"#"_$P(DRUG,"/",2)_" NAME MISSING",1:DRUG) D  Q:PSDOUT
"RTN","PSDPSTK1",7,0)
 .F NAOU=0:0 S NAOU=$O(^TMP("PSDPSTK",$J,DRUG,NAOU)) Q:'NAOU!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPSTK1",8,0)
 ..S NODE=^TMP("PSDPSTK",$J,DRUG,NAOU,0) S NAOUN=$S($P(^PSD(58.8,NAOU,0),"^")]"":$P(^(0),"^"),1:"NAOU #"_NAOU_"/NAME MISSING")
"RTN","PSDPSTK1",9,0)
 ..I $P(NODE,"^")="I" S Y=$P(NODE,"^",2) X ^DD("DD") S DATEI=Y D:$Y+5>IOSL HEADER Q:PSDOUT  W !,?4,NAOUN_" (NAOU INACTIVE AS OF "_DATEI_")",! Q
"RTN","PSDPSTK1",10,0)
 ..S LOC=$P(NODE,"^"),STK=$P(NODE,"^",2),TYPE=$P(NODE,"^",3)
"RTN","PSDPSTK1",11,0)
 ..S WARD=$G(^TMP("PSDPSTK",$J,DRUG,NAOU,1))
"RTN","PSDPSTK1",12,0)
 ..S CNTW=$L(WARD,";;"),CNTT=$L(TYPE,";;"),CNT=$S(CNTT>CNTW!(CNTT=CNTW):CNTT,CNTW>CNTT:CNTW,1:2)
"RTN","PSDPSTK1",13,0)
 ..I $Y+5>IOSL D HEADER Q:PSDOUT  W !,"=> ",$S(DRUG["ZZ/":"#"_$P(DRUG,"/",2)_" NAME MISSING",1:DRUG)
"RTN","PSDPSTK1",14,0)
 ..W !,?4,NAOUN,?45,LOC,?55,$J(STK,6),?67 S WARDN=$P(WARD,";;",2) D:WARDN WARD W WARDN,?101 S TYPEN=$P(TYPE,";;",2) D:TYPEN TYPE W TYPEN,!
"RTN","PSDPSTK1",15,0)
 ..I CNT>2 F JJ=3:1:CNT D:$Y+5>IOSL HEADER W ?67 S WARDN=$P(WARD,";;",JJ) D:WARDN WARD W WARDN,?101 S TYPEN=$P(TYPE,";;",JJ) D:TYPEN TYPE W TYPEN,!
"RTN","PSDPSTK1",16,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPSTK1",17,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPSTK1",18,0)
END ;
"RTN","PSDPSTK1",19,0)
 K %DT,%ZIS,CNT,CNTT,CNTW,DA,DATEI,DIK,DIR,DIRUT,DRUG,DRUGN,JJ,LN,LOC,NAOU,NAOUN,NODE,PG,POP,PSDIO,PSDT,PSDOUT,RPDT,STK,TYP,TYPE,TYPEN,WARD,WARDN,WRD
"RTN","PSDPSTK1",20,0)
 K X,Y,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTRTN,^TMP("PSDPSTK",$J) D ^%ZISC
"RTN","PSDPSTK1",21,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPSTK1",22,0)
 Q
"RTN","PSDPSTK1",23,0)
HEADER ;lists header infomation
"RTN","PSDPSTK1",24,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPSTK1",25,0)
 W:$Y @IOF S PG=PG+1 W !,RPDT,?122,"PAGE: "_PG,!,?55,"DATA FOR CS STOCK DRUGS",!!,"=> DRUG",!,?57,"STOCK",!,?14,"NAOU",?45,"LOCATION",?57,"LEVEL",?67,"WARD (FOR DRUG)",?101,"TYPE",!,LN,!
"RTN","PSDPSTK1",26,0)
 Q
"RTN","PSDPSTK1",27,0)
WARD ;checks for vaild ward name
"RTN","PSDPSTK1",28,0)
 I $D(^DIC(42,WARDN,0)),$P(^(0),"^")]"" S WARDN=$P(^(0),"^") Q
"RTN","PSDPSTK1",29,0)
 S WARDN="WARD #"_WARD_"/NO NAME OR DELETED"
"RTN","PSDPSTK1",30,0)
 Q
"RTN","PSDPSTK1",31,0)
TYPE ;ckecks for valid type name
"RTN","PSDPSTK1",32,0)
 I $D(^PSI(58.16,TYPEN,0)),$P(^(0),"^")]"" S TYPEN=$P(^(0),"^") Q
"RTN","PSDPSTK1",33,0)
 S TYPEN="TYPE #"_TYPEN_"/NO NAME OR DELETED"
"RTN","PSDPSTK1",34,0)
 Q
"RTN","PSDPUGS")
0^193^B24812757
"RTN","PSDPUGS",1,0)
PSDPUGS ;BIR/JPW-Green Sheets Ready for Pickup Log ; 29 Aug 94
"RTN","PSDPUGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPUGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPUGS",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDPUGS",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print the Green Sheets Ready for Pickup Log.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDPUGS",6,0)
ASKD ;ask disp loccation
"RTN","PSDPUGS",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPUGS",8,0)
 I $P(PSDSITE,U,5) S PSDS=PSDS_"^"_+$P($G(^PSD(58.8,+PSDS,0)),"^",5) G ASKN
"RTN","PSDPUGS",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDPUGS",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPUGS",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPUGS",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PSDS=PSDS_"^"_+$P(Y(0),"^",5)
"RTN","PSDPUGS",13,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPUGS",14,0)
ASKN ;ask naou or group
"RTN","PSDPUGS",15,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPUGS",16,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPUGS",17,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s).",DIR("?")="Enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPUGS",18,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y D NOW^%DTC S PSDT=X,PSDPT=+$E(%,1,12) K DA,DIC S CNT=0
"RTN","PSDPUGS",19,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G DEV
"RTN","PSDPUGS",20,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7),$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPUGS",21,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPUGS",22,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPUGS",23,0)
 S:X="^ALL" ALL=1
"RTN","PSDPUGS",24,0)
DEV ;ask device and queue info
"RTN","PSDPUGS",25,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDPUGS",26,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPUGS",27,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPUGS",28,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPUGS",ZTDESC="CS Pharm Green Sheets Ready for Pickup Log" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDPUGS",29,0)
 U IO
"RTN","PSDPUGS",30,0)
START ;compile data
"RTN","PSDPUGS",31,0)
 K ^TMP("PSDPUGS",$J)
"RTN","PSDPUGS",32,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",4)=+PSDS S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPUGS",33,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",4)=+PSDS,'$P(^(0),"^",7) S NAOU(+PSD)=""
"RTN","PSDPUGS",34,0)
 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",5,PSD)) Q:'PSD  F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AC",5,PSD,DRUG)) Q:'DRUG  D
"RTN","PSDPUGS",35,0)
 .F PSDA=0:0 S PSDA=$O(^PSD(58.8,"AC",5,PSD,DRUG,PSDA)) Q:'PSDA  I $D(^PSD(58.8,PSD,1,DRUG,3,PSDA,0)) S NODE=^PSD(58.8,PSD,1,DRUG,3,PSDA,0) D
"RTN","PSDPUGS",36,0)
 ..I $D(NAOU(PSD)),$P($G(^PSD(58.81,+$P(NODE,U,17),"CS")),U,4) S PSDNA=$S($P($G(^PSD(58.8,PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD) D
"RTN","PSDPUGS",37,0)
 ...S DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG),STAT=+$P(NODE,"^",11) Q:STAT'=5
"RTN","PSDPUGS",38,0)
 ...S NUM=$P(NODE,"^",16),^TMP("PSDPUGS",$J,PSDNA,NUM,DRUGN)=""
"RTN","PSDPUGS",39,0)
PRINT ;print green sheets ready for pickup by naou, green sheet #
"RTN","PSDPUGS",40,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPUGS",41,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDPUGS",$J)) D HDR W !!,?10,"****  NO PENDING GREEN SHEETS READY FOR PICKUP  ****" G END
"RTN","PSDPUGS",42,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDPUGS",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: "_NAOU,! D  Q:PSDOUT
"RTN","PSDPUGS",43,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDPUGS",$J,NAOU,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  S DRUG=$O(^TMP("PSDPUGS",$J,NAOU,NUM,0)) Q:DRUG=""  D
"RTN","PSDPUGS",44,0)
 ..W !,NUM,?12,DRUG,?55,"__________",?68,"__________",!,?55,"(Pharmacy)",?70,"(Nurse)",!
"RTN","PSDPUGS",45,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPUGS",46,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPUGS",47,0)
END K %,%H,%I,%ZIS,ALL,C,CNT,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NODE,NUM
"RTN","PSDPUGS",48,0)
 K OK,PG,POP,PSD,PSDA,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDS,PSDSN,PSDOUT,PSDPT,PSDT,RPDT,SEL,STAT,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPUGS",49,0)
 K ^TMP("PSDPUGS",$J) D ^%ZISC
"RTN","PSDPUGS",50,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPUGS",51,0)
 Q
"RTN","PSDPUGS",52,0)
GROUP ;select group of naous
"RTN","PSDPUGS",53,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPUGS",54,0)
 Q
"RTN","PSDPUGS",55,0)
SAVE S (ZTSAVE("PSDT"),ZTSAVE("CNT"),ZTSAVE("PSDS"))="" S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPUGS",56,0)
 Q
"RTN","PSDPUGS",57,0)
HDR ;header for log
"RTN","PSDPUGS",58,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPUGS",59,0)
 S PG=PG+1 W:$Y @IOF W !,?25,"Green Sheets Ready for Pickup",?70,"Page: ",PG,!,?30,RPDT,!
"RTN","PSDPUGS",60,0)
 W !,?57,"PICKED",?70,"GIVEN",!,"DISP #",?12,"DRUG",?57,"UP BY",?70,"TO BY"
"RTN","PSDPUGS",61,0)
 W !,LN,!
"RTN","PSDPUGS",62,0)
 Q
"RTN","PSDPWK")
0^194^B22501092
"RTN","PSDPWK",1,0)
PSDPWK ;BIR/JPW-Print Pharm Disp. Worksheet ; 29 Aug 94
"RTN","PSDPWK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPWK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDPWK",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDPWK",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"process/dispense narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDPWK",6,0)
 W !!,"=>  This report lists all pending CS requests for a dispensing site.",!!
"RTN","PSDPWK",7,0)
 I '$O(^PSD(58.85,0)) W $C(7),!!,"There are no pending request orders.",!! K OK Q
"RTN","PSDPWK",8,0)
SUM ;ask worksheet, summary or both
"RTN","PSDPWK",9,0)
 K DA,DIR,DIRUT S DIR(0)="SO^W:WORKSHEET ONLY;S:SUMMARY TOTALS ONLY;B:BOTH WORKSHEET AND SUMMARY TOTALS"
"RTN","PSDPWK",10,0)
 S DIR("A")="Select Worksheet Report(s) to Print"
"RTN","PSDPWK",11,0)
 S DIR("?",1)="Answer 'W' to print only the worksheet for this report,",DIR("?",2)="answer 'S' to print only the summary totals, or",DIR("?")="answer 'B' to print the worksheet and the summary totals."
"RTN","PSDPWK",12,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDPWK",13,0)
ASKD ;ask disp location
"RTN","PSDPWK",14,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDPWK",15,0)
 I $P(PSDSITE,U,5) S PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) G CHKD
"RTN","PSDPWK",16,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDPWK",17,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDPWK",18,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PSDS=PSDS_"^"_+$P(Y(0),"^",5)
"RTN","PSDPWK",19,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDPWK",20,0)
CHKD I '$O(^PSD(58.85,"AE",+PSDS,0)) W !!,"There are no pending CS requests for "_PSDSN_".",!! G END
"RTN","PSDPWK",21,0)
ASKN ;ask naou or group
"RTN","PSDPWK",22,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDPWK",23,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDPWK",24,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s).",DIR("?")="Enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDPWK",25,0)
 D ^DIR K DIR
"RTN","PSDPWK",26,0)
 I $D(DIRUT),X="^ALL" S ALL=1,CNT=0,SEL="N" D NOW^%DTC S PSDT=X G SORT
"RTN","PSDPWK",27,0)
 I $D(DIRUT) G END
"RTN","PSDPWK",28,0)
 S SEL=Y D NOW^%DTC S PSDT=X K DA,DIC S CNT=0
"RTN","PSDPWK",29,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G SORT
"RTN","PSDPWK",30,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  D
"RTN","PSDPWK",31,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDPWK",32,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDPWK",33,0)
 S:X="^ALL" ALL=1
"RTN","PSDPWK",34,0)
SORT ;asks sort
"RTN","PSDPWK",35,0)
 S ANS=$P($G(^PSD(58.8,+PSDS,2)),"^",7)
"RTN","PSDPWK",36,0)
 I (ANS="D")!(ANS="N") G DEV
"RTN","PSDPWK",37,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/NAOU;N:NAOU/DRUG",DIR("A",1)="You may print by either of these sorting methods."
"RTN","PSDPWK",38,0)
 S DIR("?",1)="Enter 'D' to print the worksheet sorted by DRUG then NAOU",DIR("?")="Enter 'N' to print the worksheet sorted by NAOU then DRUG."
"RTN","PSDPWK",39,0)
 S DIR("A")="Select SORT ORDER for Worksheet" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDPWK",40,0)
DEV ;ask device and queue info
"RTN","PSDPWK",41,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDPWK",42,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDPWK",43,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDPWK",44,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDPWK1",ZTDESC="Compile Worksheet for CS PHARM" D SAVE,^%ZTLOAD K ZTSK G END
"RTN","PSDPWK",45,0)
 U IO G START^PSDPWK1
"RTN","PSDPWK",46,0)
END K %,%H,%I,%ZIS,ALL,ANS,C,CNT,COMM,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJDA,LOOP,LOOP2,NAOU,NODE,OK,ORD,ORDN
"RTN","PSDPWK",47,0)
 K POP,PRT,PSD,PSDCPY,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDR,PSDRN,PSDS,PSDSN,PSDT
"RTN","PSDPWK",48,0)
 K QTY,SEL,SUM,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDWK",$J),^TMP("PSDWKT",$J) D ^%ZISC
"RTN","PSDPWK",49,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPWK",50,0)
 Q
"RTN","PSDPWK",51,0)
GROUP ;select group of naous
"RTN","PSDPWK",52,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDPWK",53,0)
 Q
"RTN","PSDPWK",54,0)
SAVE S (ZTSAVE("PSDT"),ZTSAVE("PSDIO"),ZTSAVE("ANS"),ZTSAVE("CNT"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("SUM"),ZTSAVE("PSDSITE"))=""
"RTN","PSDPWK",55,0)
 S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDPWK",56,0)
 Q
"RTN","PSDPWK1")
0^195^B9766078
"RTN","PSDPWK1",1,0)
PSDPWK1 ;BIR/JPW-Print Pharm Disp. Worksheet (cont'd) ; 17 Oct 93
"RTN","PSDPWK1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPWK1",3,0)
START ;compile data
"RTN","PSDPWK1",4,0)
 K ^TMP("PSDWK",$J),^TMP("PSDWKT",$J) S PRT=0
"RTN","PSDPWK1",5,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),$P(^(0),"^",4)=+PSDS S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDPWK1",6,0)
 F JJ=0:0 S JJ=$O(^PSD(58.85,"AW",+PSDS,JJ)) Q:'JJ  S JJDA=+$O(^PSD(58.85,"AW",+PSDS,JJ,0)) I JJDA D:$D(ALL)!($D(NAOU(+$P($G(^PSD(58.85,JJDA,0)),U,3))))
"RTN","PSDPWK1",7,0)
 .K ^PSD(58.85,"AW",+PSDS,JJ,JJDA) S:$D(^PSD(58.85,JJDA,2)) ^PSD(58.85,JJDA,2)=""
"RTN","PSDPWK1",8,0)
 F PSD=0:0 S PSD=$O(^PSD(58.85,"AE",+PSDS,PSD)) Q:'PSD  I $D(^PSD(58.85,PSD,0)) S PSDN=+$P(^(0),"^",3) I $D(ALL)!$D(NAOU(PSDN)) D
"RTN","PSDPWK1",9,0)
 .Q:+$P(^PSD(58.85,PSD,0),"^",7)>2
"RTN","PSDPWK1",10,0)
 .S PSDNA=$S($P($G(^PSD(58.8,PSDN,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDN)
"RTN","PSDPWK1",11,0)
 .S PSDR=+$P(^PSD(58.85,PSD,0),"^",4),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR) S:'$D(^TMP("PSDWKT",$J,PSDRN,PSDNA)) ^TMP("PSDWKT",$J,PSDRN,PSDNA)=0
"RTN","PSDPWK1",12,0)
 .S QTY=$P(^PSD(58.85,PSD,0),"^",6) S ^TMP("PSDWKT",$J,PSDRN,PSDNA)=^TMP("PSDWKT",$J,PSDRN,PSDNA)+QTY
"RTN","PSDPWK1",13,0)
 .S ORD=+$P(^PSD(58.85,PSD,0),"^",12),ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDPWK1",14,0)
 .S COMM=$S($D(^PSD(58.85,PSD,1,0)):1,1:0)
"RTN","PSDPWK1",15,0)
 .I (CNT=1)!(ANS="N") S ^TMP("PSDWK",$J,PSDNA,PSDRN,PSD)=QTY_"^"_ORDN_"^"_COMM
"RTN","PSDPWK1",16,0)
 .I ANS="D",CNT'=1 S ^TMP("PSDWK",$J,PSDRN,PSDNA,PSD)=QTY_"^"_ORDN_"^"_COMM
"RTN","PSDPWK1",17,0)
 S JJ="" F  S JJ=$O(^TMP("PSDWK",$J,JJ)) Q:JJ=""  S JJ1="" F  S JJ1=$O(^TMP("PSDWK",$J,JJ,JJ1)) Q:JJ1=""  F JJDA=0:0 S JJDA=$O(^TMP("PSDWK",$J,JJ,JJ1,JJDA)) Q:'JJDA  D
"RTN","PSDPWK1",18,0)
 .S PRT=PRT+1 K DA,DIE,DR S DIE=58.85,DA=JJDA,DR="13////"_PRT D ^DIE K DA,DIE,DR
"RTN","PSDPWK1",19,0)
 G:'$D(ZTQUEUED) PRINT^PSDPWK2
"RTN","PSDPWK1",20,0)
PRTQUE ;queues print after compile
"RTN","PSDPWK1",21,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN="PRINT^PSDPWK2",ZTDESC="Print Worksheet for CS PHARM",ZTDTH=$H
"RTN","PSDPWK1",22,0)
 S (ZTSAVE("^TMP(""PSDWK"",$J,"),ZTSAVE("^TMP(""PSDWKT"",$J,"),ZTSAVE("PSDS*"),ZTSAVE("ANS"),ZTSAVE("CNT"),ZTSAVE("SUM"))=""
"RTN","PSDPWK1",23,0)
 D ^%ZTLOAD K ^TMP("PSDWK",$J),^TMP("PSDWKT",$J),ZTSK
"RTN","PSDPWK1",24,0)
END K %,%H,%I,%ZIS,ALL,ANS,C,CNT,COMM,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,DUOUT,IO("Q"),JJ,JJ1,JJDA,LOOP,LOOP2,NAOU,NODE
"RTN","PSDPWK1",25,0)
 K OK,ORD,ORDN,PG,POP,PRT,PSD,PSDCPY,PSDEV,PSDG,PSDIO,PSDN,PSDNA,PSDOUT,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDSN
"RTN","PSDPWK1",26,0)
 K QTY,SEL,SUM,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDWK",$J),^TMP("PSDWKT",$J) D ^%ZISC
"RTN","PSDPWK1",27,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPWK1",28,0)
 Q
"RTN","PSDPWK2")
0^196^B9753100
"RTN","PSDPWK2",1,0)
PSDPWK2 ;BIR/JPW-Print Pharm Disp. Worksheet (Summary) ; 2 Aug 94
"RTN","PSDPWK2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPWK2",3,0)
PRINT ;prints data for worksheet
"RTN","PSDPWK2",4,0)
 I SUM="S" D ^PSDPWK3 G DONE
"RTN","PSDPWK2",5,0)
 K LN S (COMM,PG,PSDOUT)=0,$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y D HEADER Q:PSDOUT
"RTN","PSDPWK2",6,0)
 I '$D(^TMP("PSDWK",$J)) W !!,?45,"****  NO PENDING REQUESTS FOR THIS DISPENSING LOCATION  ****" G DONE
"RTN","PSDPWK2",7,0)
 S VAR1="" F  S VAR1=$O(^TMP("PSDWK",$J,VAR1)) Q:VAR1=""!(PSDOUT)  D:$Y+5>IOSL HEADER Q:PSDOUT  S VAR2="" F  S VAR2=$O(^TMP("PSDWK",$J,VAR1,VAR2)) Q:VAR2=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDPWK2",8,0)
 .F WK=0:0 S WK=$O(^TMP("PSDWK",$J,VAR1,VAR2,WK)) Q:'WK!(PSDOUT)  S NODE=^TMP("PSDWK",$J,VAR1,VAR2,WK) D  Q:PSDOUT
"RTN","PSDPWK2",9,0)
 ..S PSDR=$S(CNT=1:VAR2,ANS="N":VAR2,1:VAR1) S NAOU=$S(CNT=1:VAR1,ANS="N":VAR1,1:VAR2)
"RTN","PSDPWK2",10,0)
 ..D:$Y+8>IOSL HEADER Q:PSDOUT
"RTN","PSDPWK2",11,0)
 ..W !,WK,?10,PSDR,?52,$P(NODE,"^"),?60,NAOU,?100,$P(NODE,"^",2)
"RTN","PSDPWK2",12,0)
 ..W:$P($G(^PSD(58.85,+WK,2)),U,2) !,"* EMERGENCY *"
"RTN","PSDPWK2",13,0)
 ..I $P(NODE,"^",3) S COMM=1 K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.85,WK,1,TEXT)) Q:'TEXT  S X=$G(^PSD(58.85,WK,1,TEXT,0)),DIWL=15,DIWR=125,DIWF="W" D ^DIWP
"RTN","PSDPWK2",14,0)
 ..I COMM D ^DIWW S COMM=0
"RTN","PSDPWK2",15,0)
 ..W !!,?10,"Disp # ____________  Manufacturer: __________________   Lot # __________   Exp. Date: __________",!
"RTN","PSDPWK2",16,0)
 I $E(IOST,1,2)="C-",'PSDOUT,SUM="B" W !!,"Press <RET> to display the summary totals" R X:DTIME
"RTN","PSDPWK2",17,0)
 I SUM="B",'PSDOUT D PRINT^PSDPWK3
"RTN","PSDPWK2",18,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDPWK2",19,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDPWK2",20,0)
END K %,%H,%I,%ZIS,ALL,ANS,C,CNT,COMM,DA,DIC,DIE,DIR,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,IO("Q"),JJ,JJ1,JJDA,LN,LOOP,LOOP2,NAOU,NODE
"RTN","PSDPWK2",21,0)
 K OK,ORD,ORDN,PG,POP,PRT,PSD,PSDCPY,PSDEV,PSDN,PSDNA,PSDOUT,PSDR,PSDRN,PSDS,PSDSN,PSDT,QTY,RPDT,SEL,SUM,TEXT,VAR1,VAR2,WK,X,Y,^TMP("PSDWK",$J),^TMP("PSDWKT",$J)
"RTN","PSDPWK2",22,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDPWK2",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDPWK2",24,0)
 Q
"RTN","PSDPWK2",25,0)
HEADER ;lists header information
"RTN","PSDPWK2",26,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPWK2",27,0)
 W:$Y @IOF S PG=PG+1 W !,?40,"PHARMACY DISPENSING WORKSHEET",!!,"Dispensing Location: ",PSDSN,?65,RPDT,?105,"PG "_PG,!!
"RTN","PSDPWK2",28,0)
 W "WS #",?10,"DRUG",?50,"QUANTITY",?60,"DISPENSE TO",!,?12,"COMMENTS",?50,"ORDERED",?60,"LOCATION",?102,"ORDERED BY",!,LN,!
"RTN","PSDPWK2",29,0)
 Q
"RTN","PSDPWK3")
0^197^B3030236
"RTN","PSDPWK3",1,0)
PSDPWK3 ;BIR/JPW-Print Pharm Disp. Worksheet (Summary) ; 23 Jun 94
"RTN","PSDPWK3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDPWK3",3,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDPWK3",4,0)
 S (PG,PSDOUT)=0
"RTN","PSDPWK3",5,0)
 I '$D(^TMP("PSDWKT",$J)) D HDR W !!,?45,"****  NO PENDING REQUESTS FOR THIS DISPENSING LOCATION  ****" Q
"RTN","PSDPWK3",6,0)
PRINT ;prints data for worksheet
"RTN","PSDPWK3",7,0)
 D HDR Q:PSDOUT
"RTN","PSDPWK3",8,0)
 S LOOP="" F  S LOOP=$O(^TMP("PSDWKT",$J,LOOP)) Q:LOOP=""!(PSDOUT)  W !,?2,"=> ",LOOP D:$Y+4>IOSL HDR Q:PSDOUT  D
"RTN","PSDPWK3",9,0)
 .S LOOP2="" F  S LOOP2=$O(^TMP("PSDWKT",$J,LOOP,LOOP2)) Q:LOOP2=""!(PSDOUT)  D:$Y+4>IOSL HDR Q:PSDOUT  W !,LOOP2,?60,+^TMP("PSDWKT",$J,LOOP,LOOP2),!
"RTN","PSDPWK3",10,0)
DONE I SUM,$E(IOST)'="C" W @IOF
"RTN","PSDPWK3",11,0)
 Q
"RTN","PSDPWK3",12,0)
HDR ;lists header information
"RTN","PSDPWK3",13,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDPWK3",14,0)
 K LN S $P(LN,"-",80)=""
"RTN","PSDPWK3",15,0)
 W:$Y @IOF S PG=PG+1 W !,?22,"PHARMACY DISPENSING WORKSHEET",?70,"PG "_PG,!,?29,"** SUMMARY **",!,?27,RPDT,!!,"Dispensing Location: ",PSDSN,!!
"RTN","PSDPWK3",16,0)
 W ?2,"=> DRUG",!,"NAOU",?55,"TOTAL TO DISPENSE",!,LN,!
"RTN","PSDPWK3",17,0)
 Q
"RTN","PSDRDR")
0^198^B22926262
"RTN","PSDRDR",1,0)
PSDRDR ;BIR/BJW-Narc Disp/Rec Report (reprint VA FORM 10-2321) ; 29 Aug 94
"RTN","PSDRDR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRDR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRDR",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDRDR",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"process/dispense narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDRDR",6,0)
ASKD ;ask dispensing location
"RTN","PSDRDR",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDRDR",8,0)
 G:$P(PSDSITE,U,5) SUM
"RTN","PSDRDR",9,0)
 K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)"
"RTN","PSDRDR",10,0)
 S DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDRDR",11,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDRDR",12,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDRDR",13,0)
SUM ;if ret-to-stock or turn in for dest
"RTN","PSDRDR",14,0)
 K DA,DIR,DIRUT W ! S DIR(0)="Y",DIR("A")="Is this a Return to Stock or Turn in for Destruction Reprint",DIR("B")="NO"
"RTN","PSDRDR",15,0)
 S DIR("?",1)="Answer 'YES' to select a Return to Stock or Turn in for Destruction form,",DIR("?")="answer 'NO' to print a dispensing VA FORM 10-2321."
"RTN","PSDRDR",16,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y G:SUM TYPE^PSDRPT
"RTN","PSDRDR",17,0)
COPY ;ask vault, nursing or both
"RTN","PSDRDR",18,0)
 K DA,DIR,DIRUT S DIR(0)="SO^V:VAULT COPY ONLY;N:NURSING COPY ONLY;B:BOTH VAULT AND NURSING COPY"
"RTN","PSDRDR",19,0)
 S DIR("A")="Select Disp/Receiving Report(s) to Print"
"RTN","PSDRDR",20,0)
 S DIR("?",1)="Answer 'V' to print only the vault copy of this report,",DIR("?",2)="answer 'N' to print only the nursing copy, or",DIR("?")="answer 'B' to print both the vault and nursing copies."
"RTN","PSDRDR",21,0)
 D ^DIR K DIR
"RTN","PSDRDR",22,0)
 I $D(DIRUT) W !,"No report will be printed.",! G END
"RTN","PSDRDR",23,0)
 S PSDCPY=Y
"RTN","PSDRDR",24,0)
ASKN ;ask naou or green sheet number
"RTN","PSDRDR",25,0)
 K DA,DIR,DIRUT S DIR(0)="SO^N:NAOU;G:Green Sheet #",DIR("A")="Select Method"
"RTN","PSDRDR",26,0)
 S DIR("?",1)="Enter 'N' to select one, several, or ^ALL NAOUs,",DIR("?")="enter 'G' to select a Green Sheet #, or '^' to quit"
"RTN","PSDRDR",27,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y
"RTN","PSDRDR",28,0)
 I SEL="G" W ! K DA,DIC S DIC("A")="Select Green Sheet #: ",DIC=58.81,D="D",DIC(0)="QEAS",DIC("S")="I $P(^(0),""^"",3)=+PSDS" D IX^DIC G:Y<0 END S PSDA=+Y G DEV
"RTN","PSDRDR",29,0)
NAOU ;sel naou
"RTN","PSDRDR",30,0)
 W !!,?5,"You may select a single NAOU, several NAOUs,",!,?5,"or enter ^ALL to select all NAOUs.",!!
"RTN","PSDRDR",31,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",2)=""N"",$P(^(0),""^"",4)=+PSDS" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDRDR",32,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDRDR",33,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $P($G(^PSD(58.8,PSD,0)),"^",2)="N",$P($G(^(0)),"^",4)=+PSDS S NAOU(PSD)=""
"RTN","PSDRDR",34,0)
DATE ;asks date range if naou is selected
"RTN","PSDRDR",35,0)
 W !!,"Please enter the DATE and TIME period you wish to reprint data for this report",!
"RTN","PSDRDR",36,0)
 W ! K %DT S %DT="AERXT",%DT("A")="Start with Date/Time: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDRDR",37,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date/Time: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDRDR",38,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDRDR",39,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.0001
"RTN","PSDRDR",40,0)
DEV ;ask device and queue info
"RTN","PSDRDR",41,0)
 W !,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDRDR",42,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDRDR",43,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDRDR",44,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDRDR1",ZTDESC="Reprint Narcotic Disp Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDRDR",45,0)
 U IO G START^PSDRDR1
"RTN","PSDRDR",46,0)
END K %,%I,%H,%ZIS,C,COMM,COPY,D,DA,DIC,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DRUG,DRUGN,DTOUT,DUOUT,EXP,EXPD,FLAG,LN,LOOP,LOT,MFG,NAOU,NAOUN,NODE,NUM,OK,ORD,ORDN
"RTN","PSDRDR",47,0)
 K PG,PHARM,PHARMN,PSD,PSDA,PSDATE,PSDCPY,PSDDT,PSDED,PSDEV,PSDN,PSDNA,PSDOUT,PSDS,PSDSD,PSDSN,PSDST,QTY,REC,RECN,REQD,REQDT,RPDT,SEL,SUM,TEXT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRDR",48,0)
 K ^TMP("PSDRDR",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRDR",49,0)
 Q
"RTN","PSDRDR",50,0)
SAVE S (ZTSAVE("PSDATE"),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("PSDSN"),ZTSAVE("PSDS"),ZTSAVE("PSDCPY"))=""
"RTN","PSDRDR",51,0)
 S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(PSDA) ZTSAVE("PSDA")=""
"RTN","PSDRDR",52,0)
 Q
"RTN","PSDRDR1")
0^199^B10986671
"RTN","PSDRDR1",1,0)
PSDRDR1 ;BIR/BJW-Narc Disp/Rec (reprint VA FORM 10-2321) (cont'd) ; 24 Oct 93
"RTN","PSDRDR1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRDR1",3,0)
 ;;This routine modified on 2-9-95 for E3R# 3311.
"RTN","PSDRDR1",4,0)
START ;compile data
"RTN","PSDRDR1",5,0)
 K ^TMP("PSDRDR",$J)
"RTN","PSDRDR1",6,0)
 I $D(PSDA),$D(^PSD(58.81,PSDA,0)) D SET,^PSDRDR2 G END
"RTN","PSDRDR1",7,0)
 F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"AC",PSD)) Q:'PSD!(PSD>PSDED)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AC",PSD,PSDA)) Q:'PSDA  I $D(^PSD(58.81,PSDA,0)),$D(NAOU(+$P(^PSD(58.81,PSDA,0),"^",18))),$P(^PSD(58.81,PSDA,0),"^",3)=+PSDS D SET
"RTN","PSDRDR1",8,0)
 D ^PSDRDR2
"RTN","PSDRDR1",9,0)
END K %,%I,%H,%ZIS,C,COMM,COPY,D,DA,DIC,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DRUG,DRUGN,DTOUT,DUOUT,EXP,EXPD,FLAG,LN,LOOP,LOT,MFG,NAOU,NAOUN,NEWBAL,NODE,NUM,OK,ORD,ORDN
"RTN","PSDRDR1",10,0)
 K FNOTE,PG,PHARM,PHARMN,PSD,PSDA,PSDATE,PSDCPY,PSDDT,PSDED,PSDEV,PSDN,PSDNA,PSDOUT,PSDS,PSDSD,PSDSN,PSDST,QTY,REC,RECN,REQD,REQDT,RPDT,SEL,SUM,TEXT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRDR1",11,0)
 K ^TMP("PSDRDR",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRDR1",12,0)
 Q
"RTN","PSDRDR1",13,0)
SET ;sets data for printing
"RTN","PSDRDR1",14,0)
 Q:'$D(^PSD(58.81,PSDA,0))  S NODE=^PSD(58.81,PSDA,0),PSDN=+$P(NODE,"^",18)
"RTN","PSDRDR1",15,0)
 S PSDNA=$S($P($G(^PSD(58.8,PSDN,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDN)
"RTN","PSDRDR1",16,0)
 S DRUG=+$P(NODE,"^",5),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDRDR1",17,0)
 S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDRDR1",18,0)
 S COMM=$S($D(^PSD(58.81,PSDA,2,0)):1,1:0),MFG=$P(NODE,"^",13),LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15),EXPD=""
"RTN","PSDRDR1",19,0)
 ;;The next 2 lines were inserted for E3R# 3311,to print a drug balance.
"RTN","PSDRDR1",20,0)
 S:$D(^PSD(58.81,PSDA,4)) NEWBAL=$P(^(4),"^",7)+$P(^(4),"^",4),FNOTE="*"
"RTN","PSDRDR1",21,0)
 S:'$D(^PSD(58.81,PSDA,4)) NEWBAL=$P(NODE,"^",10)-QTY,FNOTE=""
"RTN","PSDRDR1",22,0)
 I EXP S EXPD=$E(EXP,4,5)_"/"_$E(EXP,2,3)
"RTN","PSDRDR1",23,0)
 S NUM=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN")
"RTN","PSDRDR1",24,0)
 S ORD=+$P($G(^PSD(58.81,PSDA,1)),"^",7),ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRDR1",25,0)
 S REQD=$P($G(^PSD(58.81,PSDA,1)),"^",6),REQDT="" I REQD S REQDT=$E(REQD,4,5)_"/"_$E(REQD,6,7)_"/"_$E(REQD,2,3)
"RTN","PSDRDR1",26,0)
 S PSDST=$P(NODE,"^",4),PSDDT="" I PSDST S PSDDT=$E(PSDST,4,5)_"/"_$E(PSDST,6,7)_"/"_$E(PSDST,2,3)
"RTN","PSDRDR1",27,0)
 S (REC,PHARM,RECN,PHARMN)="" I $D(^PSD(58.81,PSDA,1)),+$P(^PSD(58.81,PSDA,1),"^",4) S PHARM=$P(^(1),"^"),REC=$P(^(1),"^",3)
"RTN","PSDRDR1",28,0)
 I PHARM S PHARMN=$P($G(^VA(200,PHARM,0)),"^")
"RTN","PSDRDR1",29,0)
 I REC S RECN=$P($G(^VA(200,REC,0)),"^")
"RTN","PSDRDR1",30,0)
 ;;The next line modified for E3R# 3311,newbal and fnote added.
"RTN","PSDRDR1",31,0)
 S ^TMP("PSDRDR",$J,PSDNA,NUM)=DRUGN_"^"_QTY_FNOTE_"^"_PSDDT_"^"_REQDT_"^"_ORDN_"^"_MFG_"^"_LOT_"^"_EXPD_"^"_COMM_"^"_PSDA_"^"_PHARMN_"^"_RECN_"^"_NEWBAL_"^"_FNOTE
"RTN","PSDRDR1",32,0)
 Q
"RTN","PSDRDR2")
0^200^B11545864
"RTN","PSDRDR2",1,0)
PSDRDR2 ;BIR/BJW-Narc Disp/Rec (reprint VA FORM 10-2321) (cont'd) ; 4 Aug 94
"RTN","PSDRDR2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRDR2",3,0)
PRINT ;reprint log in lieu of VA FORM 10-2321
"RTN","PSDRDR2",4,0)
 S COPY=1 D COPY Q:PSDOUT  G:$D(FLAG) DONE
"RTN","PSDRDR2",5,0)
 I PSDCPY="B" S COPY=2 D COPY
"RTN","PSDRDR2",6,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDRDR2",7,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDRDR2",8,0)
END Q
"RTN","PSDRDR2",9,0)
HDR ;header for log
"RTN","PSDRDR2",10,0)
 I PG,$G(PSDCPY)="V"!($G(COPY)=2) W !,"* VERIFIED ORDER WAS EDITED."
"RTN","PSDRDR2",11,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDRDR2",12,0)
 S PG=PG+1 W:$Y @IOF W !,?55,"*** REPRINT ***",! I PSDCPY="V"!(COPY=2) W !,?50,"*** PHARMACY VAULT COPY ***",!,?42,"Technician Delivering Orders: ____________________",!
"RTN","PSDRDR2",13,0)
 W !,?2,"VA FORM 10-2321",?42,"Narcotic Dispensing/Receiving Report" I NAOU]"",NAOU'=0 W " for ",NAOU
"RTN","PSDRDR2",14,0)
 W ?120,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDRDR2",15,0)
 W !,?14,"DATE",?78,"DATE"
"RTN","PSDRDR2",16,0)
 W !,"DISP #",?12,"DISPENSED",?24,"QTY",?33,"DRUG",?78,"ORD",?90,"ORDERED BY"
"RTN","PSDRDR2",17,0)
 W !,LN,!!
"RTN","PSDRDR2",18,0)
 Q
"RTN","PSDRDR2",19,0)
COPY ;copy number
"RTN","PSDRDR2",20,0)
 S (COMM,PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDRDR2",21,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDRDR",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS TO BE DELIVERED  ****" S FLAG=1 Q
"RTN","PSDRDR2",22,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDRDR",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  D  Q:PSDOUT
"RTN","PSDRDR2",23,0)
 .S NUM="" F  S NUM=$O(^TMP("PSDRDR",$J,NAOU,NUM)) Q:NUM=""!(PSDOUT)  D:$Y+12>IOSL HDR Q:PSDOUT  S NODE=^TMP("PSDRDR",$J,NAOU,NUM) D
"RTN","PSDRDR2",24,0)
 ..I $P(NODE,"^",9),$Y+12>IOSL D HDR Q:PSDOUT
"RTN","PSDRDR2",25,0)
 ..NEW X S X=$P(NODE,"^",2) S X=$S(PSDCPY="V":X,COPY=2:X,1:+X)
"RTN","PSDRDR2",26,0)
 ..W !,NUM,?12,$P(NODE,"^",3),?21,$J(X,6),?33,$P(NODE,"^"),?78,$P(NODE,"^",4),?90,$P(NODE,"^",5)
"RTN","PSDRDR2",27,0)
 ..;;The next line added for E3R# 3311 2-9-95.
"RTN","PSDRDR2",28,0)
 ..I PSDCPY="V"!(COPY=2) W !,?33,"BALANCE:  "_$S(+$P(NODE,"^",13):+$P(NODE,"^",13),1:"UNKNOWN")_" "_$P(NODE,"^",14)
"RTN","PSDRDR2",29,0)
 ..I $P(NODE,"^",6)]"" W !,?33,"Mfg/Lot #/Exp Date:  ",$P(NODE,"^",6)_"  "_$P(NODE,"^",7)_"  "_$P(NODE,"^",8)
"RTN","PSDRDR2",30,0)
 ..W !!,?7,"Disp by RPh:",$S($P(NODE,"^",11)]"":"  "_$P(NODE,"^",11),1:"___________________________________")
"RTN","PSDRDR2",31,0)
 ..W ?61,"Rec'd by Nurse:",$S($P(NODE,"^",12)]"":"  "_$P(NODE,"^",12),1:"___________________________________")
"RTN","PSDRDR2",32,0)
 ..W !,?19,"(Full Name)",?76,"(Full Name)",!
"RTN","PSDRDR2",33,0)
 ..I $P(NODE,"^",9) W ?24,"COMMENTS:" S COMM=1,PSDA=$P(NODE,"^",10) K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.81,PSDA,2,TEXT)) Q:'TEXT  D:$Y+4>IOSL HDR Q:PSDOUT  S X=$G(^PSD(58.81,PSDA,2,TEXT,0)),DIWL=34,DIWR=115,DIWF="W" D ^DIWP
"RTN","PSDRDR2",34,0)
 ..I COMM D ^DIWW S COMM=0 W !
"RTN","PSDRDR2",35,0)
 I PG,$G(PSDCPY)="V"!($G(COPY)=2) W !,"* VERIFIED ORDER WAS EDITED."
"RTN","PSDRDR2",36,0)
 Q
"RTN","PSDREC")
0^201^B18294703
"RTN","PSDREC",1,0)
PSDREC ;BIR/LTL-CS Receiving ; 6 July 94
"RTN","PSDREC",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREC",3,0)
 I '$D(PSDSITE) D ^PSDSET G:'$D(PSDSITE) QUIT
"RTN","PSDREC",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"Sorry, you need the PSJ RPHARM Security key to do receiving.",!! G QUIT
"RTN","PSDREC",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G QUIT
"RTN","PSDREC",6,0)
SETUP D DT^DICRW N C,D,D0,DA,DIC,DINUM,DIE,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,DZ,PSDAT,PSDB,PSDI,PSDIT,PSDW,PSDLOC,PSDLOCN,PSDOUT,PSDP,PSDPI,PSDS,PSDCON,PSDL,PSDPO,PSDREC,PSDRUG,PSDRUGN,PSDT,PSAPV,X,Y,%,%H,%I S PSDL=0,(PSDI,PSDPO)=""
"RTN","PSDREC",7,0)
 D NOW^%DTC S PSDAT=+$E(%,1,12)
"RTN","PSDREC",8,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDREC",9,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDREC",10,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDREC",11,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""M""&($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))"
"RTN","PSDREC",12,0)
 S:$P($G(^PSD(58.8,+PSDLOC,0)),U,2)["M" DIC("B")=PSDLOCN
"RTN","PSDREC",13,0)
 D ^DIC K DIC G:Y<0 QUIT S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDREC",14,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDREC",15,0)
CHKD D:$P($G(^PSD(58.8,PSDLOC,0)),U,8)=1  G:$D(DIRUT) QUIT
"RTN","PSDREC",16,0)
PV .W ! S DIR(0)="Y",DIR("A")="Is this a Prime Vendor receipt",DIR("B")="Yes",DIR("?")="If so, I'll retrieve the current Prime Vendor P.O.# for this Dispensing Site." D ^DIR K DIR Q:$D(DIRUT)!(Y<1)  S:Y=1 PSAPV=1
"RTN","PSDREC",17,0)
 .S (PSDPO,Y)=$P($G(^PSD(58.8,+PSDLOC,0)),U,9),C=$P(^DD(58.8,13,0),U,2)
"RTN","PSDREC",18,0)
 .D Y^DIQ S DIC("B")=Y
"RTN","PSDREC",19,0)
 .I +$E($P($G(^PRC(442,+PSDPO,12)),U,5),4,5)'=+$E(DT,4,5) W !!,"Current Prime Vendor P.O.#: ",Y,?40 S Y=$P($G(^(12)),U,5) X ^DD("DD") W "Date Assigned: ",Y
"RTN","PSDREC",20,0)
 I '$O(^PSD(58.8,PSDLOC,1,0)) W !!,"There are no drugs in ",PSDLOCN G QUIT
"RTN","PSDREC",21,0)
PO W ! S DIC="^PRC(442,",DIC(0)="AEMQZ" S:'$G(DIC("B")) DIC("B")=$G(PSDPO)
"RTN","PSDREC",22,0)
 S DIC("A")="Select Pharmacy Purchase Order Number: ",DIC("S")="I $P($G(^(0)),U,5)[822400" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) QUIT S:Y>0 PSDPO=+Y I Y<1 S PSDPO(1)=0 G ^PSDREC2
"RTN","PSDREC",23,0)
 S PSDCON=$P($G(Y(0)),U,12)
"RTN","PSDREC",24,0)
 I $G(PSAPV),PSDPO'=$P($G(^PSD(58.8,+PSDLOC,0)),U,9) S DIE="^PSD(58.8,",DA=PSDLOC,DR="13////"_PSDPO D ^DIE K DIE,DA,DR
"RTN","PSDREC",25,0)
LINE I '$O(^PRC(442,+PSDPO,2,0)) W !!,"No line items on this P.O.",!! S PSDPO(1)=0 G ^PSDREC2
"RTN","PSDREC",26,0)
 I '$O(^PRC(442,+PSDPO,2,1)),'$P($G(^PRC(442,+PSDPO,2,1,0)),U,5) S PSDPO(1)=0 G ^PSDREC2
"RTN","PSDREC",27,0)
PART I '$O(^PRC(442,+PSDPO,11,0)) W !!,"No receipts processed for this P.O.",!! S PSDPO(1)=0 G ^PSDREC2
"RTN","PSDREC",28,0)
PRE I $O(^PSD(58.81,"C",PSDPO,"")) W !!,"Previous receipts have been processed for this P.O.",! S DIR(0)="Y",DIR("A")="Would you like to review them before proceeding",DIR("B")="Yes" D ^DIR K DIR G:$D(DIRUT) QUIT G:Y=1 DEV^PSDREV
"RTN","PSDREC",29,0)
CHO S DIR(0)="Y",DIR("A")="Loop through all items for a selected receipt",DIR("B")="Yes",DIR("?")="If not, I will ask you to select the item(s) to receive."
"RTN","PSDREC",30,0)
 S DIR("??")="^W !!,""If you plan on receiving only certain items, you may prefer NOT to loop."""
"RTN","PSDREC",31,0)
 W ! D ^DIR K DIR
"RTN","PSDREC",32,0)
 Q:$D(DIRUT)  G:'Y ^PSDREC3
"RTN","PSDREC",33,0)
 S PSDPI=$O(^PRC(442,+PSDPO,11,0)),PSDP=$P($G(^PRC(442,+PSDPO,11,+PSDPI,0)),U),Y=1 D:$O(^PRC(442,+PSDPO,11,PSDPI))
"RTN","PSDREC",34,0)
PSEL .S DIC="^PRC(442,+PSDPO,11,",DA(1)=PSDPO,DIC(0)="AEMQ",DIC("A")="Please select Warehouse receipt date: ",DIC("B")=$P($G(^PRC(442,+PSDPO,11,+$P($G(^PRC(442,+PSDPO,11,0)),U,3),0)),U),D="B",DZ="??" D DQ^DICQ
"RTN","PSDREC",35,0)
 .W ! D ^DIC K DIC S PSDPI=+Y,PSDP=$P(Y,U,2)
"RTN","PSDREC",36,0)
 D:Y>0 ^PSDREC1 S PSDPO="" G PO
"RTN","PSDREC",37,0)
QUIT Q
"RTN","PSDREC1")
0^202^B18469784
"RTN","PSDREC1",1,0)
PSDREC1 ;BIR/LTL-CS Receiving (cont'd) ; 8 Aug 94
"RTN","PSDREC1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREC1",3,0)
 N X,X1 D SIG^XUSESIG Q:X1=""
"RTN","PSDREC1",4,0)
LOOP F  S PSDI=$O(^PRC(442,+PSDPO,2,"AB",PSDP,PSDI)) Q:'PSDI  S PSDREC=$P($G(^PRC(442,+PSDPO,2,+PSDI,3,+$O(^PRC(442,+PSDPO,2,"AB",+PSDP,+PSDI,0)),0)),U,2) D:PSDREC  G:$D(DTOUT)!($D(DUOUT)) QUIT
"RTN","PSDREC1",5,0)
 .S PSDIT=$G(^PRC(442,+PSDPO,2,+PSDI,0))
"RTN","PSDREC1",6,0)
 .W !!,$P(PSDIT,U)
"RTN","PSDREC1",7,0)
 .S PSDW=0 F  S PSDW=$O(^PRC(442,+PSDPO,2,+PSDI,1,PSDW)) Q:'PSDW  W ?5,$E($P($G(^PRC(442,+PSDPO,2,+PSDI,1,PSDW,0)),U),1,75),!
"RTN","PSDREC1",8,0)
 .W !,"Packaging: ",$S($P(PSDIT,U,12):$P(PSDIT,U,12)_"/",1:"")
"RTN","PSDREC1",9,0)
 .W $P($G(^PRCD(420.5,+$P(PSDIT,U,3),0)),U)
"RTN","PSDREC1",10,0)
 .W ?20,"Price: $",$P(PSDIT,U,9)
"RTN","PSDREC1",11,0)
 .W ?35,"Item #: ",$P(PSDIT,U,5),?48,"Vendor Stock #: ",$P(PSDIT,U,6),!
"RTN","PSDREC1",12,0)
NON .I '$P(PSDIT,U,5)!('$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")))!('$G(^PSD(58.8,+PSDLOC,1,+$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),0))) D  Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC1",13,0)
 ..S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC
"RTN","PSDREC1",14,0)
 ..D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC1",15,0)
 ..S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U)
"RTN","PSDREC1",16,0)
 ..I $P(PSDIT,U,5),$E($G(^PRC(441,+$P(PSDIT,U,5),3)),1)'=1,'$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")) D
"RTN","PSDREC1",17,0)
 ...S DIR(0)="Y",DIR("A",1)="Are you sure that you want to link ITEM MASTER file entry,"
"RTN","PSDREC1",18,0)
 ...S DIR("A",2)="",DIR("A",3)=$P($G(^PRC(441,+$P(PSDIT,U,5),0)),U,2)_" to DRUG file entry,"
"RTN","PSDREC1",19,0)
 ...S DIR("A",4)="",DIR("A",5)=PSDRUGN,DIR("A")="Y/N",DIR("B")="Yes"
"RTN","PSDREC1",20,0)
 ...S DIR("?")="Once linked, future receipts for this item will be posted to this drug.",DIR("A",6)=""
"RTN","PSDREC1",21,0)
 ...W ! D ^DIR K DIR Q:Y<1
"RTN","PSDREC1",22,0)
 ...S DIE=50,DA=PSDRUG,DR="441///^S X=$P(PSDIT,U,5)" D ^DIE K DIE W:'$D(Y) !!,"Now, ",PSDRUGN," is linked to Item # ",$P(PSDIT,U,5),"." S Y=1
"RTN","PSDREC1",23,0)
IT .S:'$D(PSDRUG) PSDRUG=$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),PSDRUGN=$P($G(^PSDRUG(+PSDRUG,0)),U)
"RTN","PSDREC1",24,0)
 .W !!,PSDRUGN,!!
"RTN","PSDREC1",25,0)
 .S DIE="^PSDRUG(",DA=PSDRUG,DR="15Dispense units per order unit;13Price per order unit" D ^DIE K DIE I $D(Y) K PSDRUG Q
"RTN","PSDREC1",26,0)
DISP .W !!,"Quantity rec'd: ",PSDREC
"RTN","PSDREC1",27,0)
 .W ?40,"Converted quantity: " S PSDREC=PSDREC*$P($G(^PSDRUG(+PSDRUG,660)),U,5) W PSDREC,!
"RTN","PSDREC1",28,0)
POST .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="If yes, the balance will be updated and a transaction stored." D ^DIR K DIR D:Y=1  K PSDRUG Q
"RTN","PSDREC1",29,0)
 ..W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDREC1",30,0)
 ..F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDREC1",31,0)
 ..D NOW^%DTC S PSDAT=+%
"RTN","PSDREC1",32,0)
 ..S PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC1",33,0)
 ..S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSDB
"RTN","PSDREC1",34,0)
 ..L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDREC1",35,0)
MON ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDREC1",36,0)
 ..I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="LM",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC
"RTN","PSDREC1",37,0)
 ..S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="5////^S X=$P($G(^(0)),U,3)+PSDREC" D ^DIE
"RTN","PSDREC1",38,0)
 ..W !,"Updating monthly receipts and transaction history.",!
"RTN","PSDREC1",39,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDREC1",40,0)
FIND ..S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDREC1",41,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDREC1",42,0)
 ..S DIE="^PSD(58.81,",DA=PSDT,DR="1////1;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;7////^S X=PSDCON;8////^S X=PSDPO;9////^S X=PSDB;100////1" D ^DIE K DIE
"RTN","PSDREC1",43,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDREC1",44,0)
 ..S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",(X,DINUM)=PSDT
"RTN","PSDREC1",45,0)
 ..S DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,PSDRUG
"RTN","PSDREC1",46,0)
 G:'PSDPO ^PSDREC2
"RTN","PSDREC1",47,0)
QUIT Q
"RTN","PSDREC2")
0^203^B19149867
"RTN","PSDREC2",1,0)
PSDREC2 ;BIR/LTL-CS Receiving (cont'd) ; 8 Aug 94
"RTN","PSDREC2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREC2",3,0)
CON S DIC="^PRCS(410,",DIC(0)="AEMQZ",DIC("A")="Select Pharmacy Transaction number: ",DIC("B")=$S($D(PSDCON):$P($G(^PRCS(410,+PSDCON,0)),U),1:""),DIC("S")="I $P($G(^(0)),U,2)=""O"",$P($G(^(3)),U,3)[822400"
"RTN","PSDREC2",4,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) QUIT S PSDCON=$S(Y>0:+Y,1:"")
"RTN","PSDREC2",5,0)
 I $G(PSDPO)+$G(PSDCON)<1 W !!,"Sorry, we really can't allow receiving without a P.O. or CP transaction.",!! G QUIT
"RTN","PSDREC2",6,0)
 I '$O(^PRCS(410,+PSDCON,"IT",1)),'$P($G(^PRCS(410,+PSDCON,"IT",1,0)),U,5) G INV
"RTN","PSDREC2",7,0)
 G:$D(PSDPO(1))&($O(^PRCS(410,+PSDCON,"IT",0))) ^PSDREC4
"RTN","PSDREC2",8,0)
INV I $G(PSAPV) S DIR(0)="58.81,71O",DIR("A")="Please enter the Prime Vendor Invoice number" D ^DIR K DIR G:Y'=""&($D(DIRUT)) QUIT S PSAPV=Y
"RTN","PSDREC2",9,0)
 I $G(PSAPV)=" " S PSAPV=1 W $C(7),!!,"Sorry, the space bar won't work here.",! G INV
"RTN","PSDREC2",10,0)
 I $G(PSAPV)]"",$O(^PSD(58.81,"PV",Y,"")) S PSD(2)=PSAPV W !!,"Previous receipts have been processed for this invoice.",!! S DIR(0)="Y",DIR("A")="Would you like to review",DIR("B")="Yes" D ^DIR K DIR G:$D(DIRUT) QUIT G:Y=1 DEV^PSDREPV
"RTN","PSDREC2",11,0)
 N X,X1 D SIG^XUSESIG I X1="" S PSDOUT=1 G QUIT
"RTN","PSDREC2",12,0)
DRUG F  S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC D  Q:$G(PSDOUT)
"RTN","PSDREC2",13,0)
 .W ! D ^DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDREC2",14,0)
 .K DIC S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U),PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC2",15,0)
PRIC .W ! S DIE="^PSDRUG(",DA=PSDRUG,DR="15Dispense units per order unit: ;13Price per order unit: " D ^DIE K DIE I $D(Y) S PSDOUT=1 Q
"RTN","PSDREC2",16,0)
QTY .W ! S DIR(0)="NA^0:999999:0",DIR("A")="Number of "_$P($G(^DIC(51.5,+$P($G(^PSDRUG(+PSDRUG,660)),U,2),0)),U)_"(S) to receive: " D ^DIR K DIR S (PSDREC,PSDREC(1))=Y I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDREC2",17,0)
DISP .W ?50,"Converted quantity: ",PSDREC*$P($G(^PSDRUG(+PSDRUG,660)),U,5) S PSDREC=$P($G(^(660)),U,5)*PSDREC
"RTN","PSDREC2",18,0)
PQ .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="If yes, the balance will be updated and a transaction stored." D ^DIR K DIR D:Y=1  I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDREC2",19,0)
 ..W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDREC2",20,0)
 ..F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDREC2",21,0)
 ..D NOW^%DTC S PSDAT=+%
"RTN","PSDREC2",22,0)
 ..S PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC2",23,0)
 ..S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSDB
"RTN","PSDREC2",24,0)
 ..L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDREC2",25,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDREC2",26,0)
 ..I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="L",DLAYGO=58.8,X=$E(DT,1,5)*100,DINUM=X,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DLAYGO
"RTN","PSDREC2",27,0)
 ..S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="5////^S X=$P($G(^(0)),U,3)+PSDREC" D ^DIE
"RTN","PSDREC2",28,0)
 ..W !,"Updating monthly receipts and transaction history.",!
"RTN","PSDREC2",29,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDREC2",30,0)
FIND ..S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDREC2",31,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDREC2",32,0)
 ..S DIE="^PSD(58.81,",DA=PSDT,DR="1////1;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;7////^S X=PSDCON;8////^S X=PSDPO;9////^S X=PSDB;100////1;71////^S X=$G(PSAPV)" D ^DIE
"RTN","PSDREC2",33,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDREC2",34,0)
 ..S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDREC2",35,0)
 ..S (X,DINUM)=PSDT
"RTN","PSDREC2",36,0)
 ..S DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,PSDRUG
"RTN","PSDREC2",37,0)
QUIT Q
"RTN","PSDREC3")
0^204^B21225124
"RTN","PSDREC3",1,0)
PSDREC3 ;BIR/LTL-CS Receiving (cont'd) ; 8 Aug 94
"RTN","PSDREC3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREC3",3,0)
 N X,X1 D SIG^XUSESIG Q:X1=""
"RTN","PSDREC3",4,0)
SEL F  S D0=+PSDPO,DIC="^PRC(442,"_+D0_",2,",DIC(0)="AEMQZ",DIC("A")="Select Line Item Number: ",D="B",DZ="??" D DQ^DICQ W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)  S PSDI=+Y,PSDIT=Y(0) D  Q:$D(DTOUT)!($D(DUOUT))!(Y>1)
"RTN","PSDREC3",5,0)
 .S PSDPI=$O(^PRC(442,+PSDPO,2,+PSDIT,3,0)) D:$O(^PRC(442,+PSDPO,2,+PSDIT,3,PSDPI))  Q:Y<1
"RTN","PSDREC3",6,0)
PART ..S DIC="^PRC(442,+PSDPO,2,+PSDIT,3,",DIC(0)="AEMQZ",DIC("A")="Select Warehouse Receipt date: ",DA(2)=PSDPO,DA(1)=PSDIT,D="B",DZ="??" D DQ^DICQ W ! D ^DIC K DIC S PSDPI=+Y
"RTN","PSDREC3",7,0)
 .W !!,$P(PSDIT,U)
"RTN","PSDREC3",8,0)
 .S PSDW=0 F  S PSDW=$O(^PRC(442,+PSDPO,2,+PSDI,1,PSDW)) Q:'PSDW  W ?5,$E($P($G(^PRC(442,+PSDPO,2,+PSDI,1,PSDW,0)),U),1,75),!
"RTN","PSDREC3",9,0)
 .W !,"Packaging: ",$S($P(PSDIT,U,12):$P(PSDIT,U,12)_"/",1:"")
"RTN","PSDREC3",10,0)
 .W $P($G(^PRCD(420.5,+$P(PSDIT,U,3),0)),U)
"RTN","PSDREC3",11,0)
 .W ?20,"Price :$",$P(PSDIT,U,9)
"RTN","PSDREC3",12,0)
 .W ?35,"Item #: ",$P(PSDIT,U,5),?50,"Vendor Stock #: ",$P(PSDIT,U,6),!
"RTN","PSDREC3",13,0)
NON .I '$P(PSDIT,U,5)!('$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")))!('$G(^PSD(58.8,+PSDLOC,1,+$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),0))) D  Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC3",14,0)
 ..S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC3",15,0)
 ..S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U),PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC3",16,0)
 ..I $P(PSDIT,U,5),$E($G(^PRC(441,+$P(PSDIT,U,5),3)),1)'=1,'$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")) D
"RTN","PSDREC3",17,0)
 ...S DIR(0)="Y",DIR("A",1)="Are you sure that you want to link ITEM MASTER file entry,"
"RTN","PSDREC3",18,0)
 ...S DIR("A",2)="",DIR("A",3)=$P($G(^PRC(441,+$P(PSDIT,U,5),0)),U,2)_" to DRUG file entry,"
"RTN","PSDREC3",19,0)
 ...S DIR("A",4)="",DIR("A",5)=PSDRUGN,DIR("A")="Y/N",DIR("B")="Yes"
"RTN","PSDREC3",20,0)
 ...S DIR("?")="Once linked, future receipts for this item will be posted to this drug.",DIR("A",6)=""
"RTN","PSDREC3",21,0)
 ...W ! D ^DIR K DIR Q:Y<1
"RTN","PSDREC3",22,0)
 ...S DIE=50,DA=PSDRUG,DR="441///^S X=$P(PSDIT,U,5)" D ^DIE K DIE W:'$D(Y) !!,"Now, ",PSDRUGN," is linked to Item # ",$P(PSDIT,U,5),"." S Y=1
"RTN","PSDREC3",23,0)
IT .S:'$D(PSDRUG) PSDRUG=$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),PSDRUGN=$P($G(^PSDRUG(+PSDRUG,0)),U)
"RTN","PSDREC3",24,0)
 .W !!,PSDRUGN,!!
"RTN","PSDREC3",25,0)
 .S DIE="^PSDRUG(",DA=PSDRUG,DR="15Dispense units per order unit;13Price per order unit" D ^DIE K DIE I $D(Y) K PSDRUG Q
"RTN","PSDREC3",26,0)
DISP .W !!,"Quantity rec'd: ",$P($G(^PRC(442,+PSDPO,2,+PSDI,3,+PSDPI,0)),U,2) S PSDREC=$P($G(^(0)),U,2)
"RTN","PSDREC3",27,0)
 .W ?40,"Converted quantity: ",PSDREC*$P($G(^PSDRUG(+PSDRUG,660)),U,5),! S PSDREC=$P($G(^(660)),U,5)*PSDREC
"RTN","PSDREC3",28,0)
POST .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="If yes, the balance will be updated and a transaction stored." D ^DIR K DIR D:Y=1  K PSDRUG Q
"RTN","PSDREC3",29,0)
 ..W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDREC3",30,0)
 ..F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDREC3",31,0)
 ..D NOW^%DTC S PSDAT=+%
"RTN","PSDREC3",32,0)
 ..S PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC3",33,0)
 ..S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSDB
"RTN","PSDREC3",34,0)
 ..L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDREC3",35,0)
MON ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDREC3",36,0)
 ..I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="",X=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC
"RTN","PSDREC3",37,0)
 ..S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="5////^S X=$P($G(^(0)),U,3)+PSDREC" D ^DIE
"RTN","PSDREC3",38,0)
 ..W !,"Updating monthly receipts and transaction history.",!
"RTN","PSDREC3",39,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDREC3",40,0)
FIND ..S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDREC3",41,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDREC3",42,0)
 ..S DIE="^PSD(58.81,",DA=PSDT,DR="1////1;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;7////^S X=PSDCON;8////^S X=PSDPO;9////^S X=PSDB;100////1" D ^DIE K DIE
"RTN","PSDREC3",43,0)
 ..S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDREC3",44,0)
 ..S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDREC3",45,0)
 ..S (X,DINUM)=PSDT
"RTN","PSDREC3",46,0)
 ..S DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC,DA,DLAYGO,PSDRUG
"RTN","PSDREC3",47,0)
QUIT Q
"RTN","PSDREC4")
0^205^B25188789
"RTN","PSDREC4",1,0)
PSDREC4 ;BIR/LTL-Issues Receiving ; 8 Aug 94
"RTN","PSDREC4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREC4",3,0)
PRE I $O(^PSD(58.81,"E",+PSDCON,"")) W !!,"Previous receipts have been processed for this transaction.",! S DIR(0)="Y",DIR("A")="Would you like to review them before proceeding",DIR("B")="Yes" D ^DIR K DIR G:$D(DIRUT) QUIT G:Y=1 DEV^PSDREVC
"RTN","PSDREC4",4,0)
CHO S PSDI=0,DIR(0)="Y",DIR("A")="Loop through all items",DIR("B")="Yes",DIR("?")="If not, I will ask you to select the item(s) to receive." W ! D ^DIR K DIR G:$D(DIRUT) QUIT G:'Y SEL
"RTN","PSDREC4",5,0)
 F  S PSDI=$O(^PRCS(410,+PSDCON,"IT",PSDI)) G:'PSDI!($D(DTOUT))!($D(DUOUT)) QUIT S PSDIT=$G(^PRCS(410,+PSDCON,"IT",PSDI,0)) D ITEM G:$D(DTOUT)!($D(DUOUT))!($D(Y)) QUIT
"RTN","PSDREC4",6,0)
SEL F  S DIC="^PRCS(410,+PSDCON,""IT"",",DIC(0)="AEMQZ",DA(1)=PSDCON D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) QUIT S PSDI=+Y,PSDIT=Y(0) D ITEM G:$D(DTOUT)!($D(DUOUT)) QUIT
"RTN","PSDREC4",7,0)
ITEM W !!,$P(PSDIT,U)
"RTN","PSDREC4",8,0)
 S PSDW=0 F  S PSDW=$O(^PRCS(410,+PSDCON,"IT",+PSDI,1,PSDW)) Q:'PSDW  W ?5,$E($P($G(^PRCS(410,+PSDCON,"IT",+PSDI,1,PSDW,0)),U),1,75),!
"RTN","PSDREC4",9,0)
 W !,"Packaging: "
"RTN","PSDREC4",10,0)
 W $P($G(^PRCD(420.5,+$P(PSDIT,U,3),0)),U)
"RTN","PSDREC4",11,0)
 W ?18,"Price :$",$P(PSDIT,U,7)
"RTN","PSDREC4",12,0)
 W ?33,"Item #: ",$P(PSDIT,U,5),?48,"Vendor Stock #: ",$P(PSDIT,U,6),!
"RTN","PSDREC4",13,0)
NON I $S('$P(PSDIT,U,5):1,'$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")):1,'$O(^PSD(58.8,PSDLOC,1,$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),""))=0:1,1:0) D  Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC4",14,0)
 .S DIC="^PSD(58.8,PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Select "_PSDLOCN_" drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)",DA(1)=PSDLOC D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDREC4",15,0)
 .S PSDRUG=+Y,PSDRUGN=$P($G(^PSDRUG(+Y,0)),U),PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC4",16,0)
 .I $P(PSDIT,U,5),$E($G(^PRC(441,+$P(PSDIT,U,5),3)),1)'=1,'$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")) D
"RTN","PSDREC4",17,0)
 ..S DIR(0)="Y",DIR("A",1)="Are you sure that you want to link ITEM MASTER file entry,"
"RTN","PSDREC4",18,0)
 ..S DIR("A",2)="",DIR("A",3)=$P($G(^PRC(441,+$P(PSDIT,U,5),0)),U,2)_" to DRUG file entry,"
"RTN","PSDREC4",19,0)
 ..S DIR("A",4)="",DIR("A",5)=PSDRUGN,DIR("A")="Y/N",DIR("B")="Yes"
"RTN","PSDREC4",20,0)
 ..S DIR("?")="Onced linked, future receipts for this item will be posted to this drug.",DIR("A",6)=""
"RTN","PSDREC4",21,0)
 ..W ! D ^DIR K DIR Q:Y<1
"RTN","PSDREC4",22,0)
 ..S DIE=50,DA=PSDRUG,DR="441///^S X=$P(PSDIT,U,5)" D ^DIE K DIE W:'$D(Y) !!,"Now, ",PSDRUGN," is linked to Item # ",$P(PSDIT,U,5),"." S Y=1
"RTN","PSDREC4",23,0)
IT S:'$D(PSDRUG) PSDRUG=$O(^PSDRUG("AB",+$P(PSDIT,U,5),"")),PSDRUGN=$P($G(^PSDRUG(+PSDRUG,0)),U)
"RTN","PSDREC4",24,0)
 W !!,PSDRUGN,!!
"RTN","PSDREC4",25,0)
 S DIE="^PSDRUG(",DA=PSDRUG,DR="15Dispense units per order unit;13Price per order unit" D ^DIE K DIE I $D(Y) K PSDRUG Q
"RTN","PSDREC4",26,0)
DISP W !!,"Quantity ordered: ",$P($G(^PRCS(410,+PSDCON,"IT",+PSDI,0)),U,2) S PSDREC=$P($G(^(0)),U,2)
"RTN","PSDREC4",27,0)
 I $P($G(^PRCS(410,+PSDCON,"IT",+PSDI,0)),U,12) W ?40,"Quantity warehouse posted: ",$P($G(^(0)),U,12) S PSDREC=$P($G(^(0)),U,12)
"RTN","PSDREC4",28,0)
 I $P($G(^PRCS(410,+PSDCON,"IT",+PSDI,0)),U,13) W !!,"Quantity received by Primary: ",$P($G(^(0)),U,13) S PSDREC=$P($G(^(0)),U,13)
"RTN","PSDREC4",29,0)
 W ?40,"Converted quantity: ",PSDREC*$P($G(^PSDRUG(+PSDRUG,660)),U,5),! S PSDREC=$P($G(^(660)),U,5)*PSDREC
"RTN","PSDREC4",30,0)
POST S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="If yes, the balance will be updated and a transaction stored." D ^DIR K DIR D:Y=1  K PSDRUG Q
"RTN","PSDREC4",31,0)
 .W !!,"There were ",$S($P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4):$P($G(^(0)),U,4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),U,4)+PSDREC," on hand.",!
"RTN","PSDREC4",32,0)
 .F  L +^PSD(58.8,+PSDLOC,1,+PSDRUG,0):0 I  Q
"RTN","PSDREC4",33,0)
 .D NOW^%DTC S PSDAT=+%
"RTN","PSDREC4",34,0)
 .S PSDB=$P($G(^PSD(58.8,+PSDLOC,1,+PSDRUG,0)),U,4)
"RTN","PSDREC4",35,0)
 .S $P(^PSD(58.8,+PSDLOC,1,+PSDRUG,0),U,4)=PSDREC+PSDB
"RTN","PSDREC4",36,0)
 .L -^PSD(58.8,+PSDLOC,1,+PSDRUG,0)
"RTN","PSDREC4",37,0)
MON .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSDREC4",38,0)
 .I '$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DIC(0)="",X=$E(DT,1,5)*100,DA(2)=PSDLOC,DA(1)=PSDRUG D ^DIC K DIC
"RTN","PSDREC4",39,0)
 .S DIE="^PSD(58.8,+PSDLOC,1,+PSDRUG,5,",DA(2)=PSDLOC,DA(1)=PSDRUG,DA=$E(DT,1,5)*100,DR="5////^S X=$P($G(^(0)),U,3)+PSDREC" D ^DIE
"RTN","PSDREC4",40,0)
 .W !,"Updating monthly receipts and transaction history.",!
"RTN","PSDREC4",41,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDREC4",42,0)
FIND .S PSDT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSDT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSDREC4",43,0)
 .S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSDT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSDREC4",44,0)
 .S DIE="^PSD(58.81,",DA=PSDT,DR="1////1;2////^S X=PSDLOC;3////^S X=PSDAT;4////^S X=PSDRUG;5////^S X=PSDREC;6////^S X=DUZ;7////^S X=PSDCON;8////^S X=PSDPO;9////^S X=PSDB;100////1" D ^DIE K DIE
"RTN","PSDREC4",45,0)
 .S:'$D(^PSD(58.8,+PSDLOC,1,+PSDRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSDREC4",46,0)
 .S DIC="^PSD(58.8,+PSDLOC,1,+PSDRUG,4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSDREC4",47,0)
 .S (X,DINUM)=PSDT,DA(2)=PSDLOC,DA(1)=PSDRUG
"RTN","PSDREC4",48,0)
 .D ^DIC K DIC,DA,DLAYGO,PSDRUG
"RTN","PSDREC4",49,0)
QUIT Q
"RTN","PSDREPD")
0^206^B21938573
"RTN","PSDREPD",1,0)
PSDREPD ;BIR/LTL-Invoice Review by Date Range ; 29 Aug 94
"RTN","PSDREPD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREPD",3,0)
 I '$D(PSDSITE) W ! D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDREPD",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to print",!,?12,"the Invoice Review Report.  PSJ RPHARM security key required.",! Q
"RTN","PSDREPD",5,0)
 N %,%H,%I,C,DIR,DIRUT,DUOUT,DTOUT,X,Y,LN,PG,POP,PSD,PSDATE,PSDC,PSDED,PSDS,PSDSD,PSDEV,PSDOUT,SUM S PSDS=0
"RTN","PSDREPD",6,0)
 F  S PSDS=$O(^PSD(58.8,"ADISP","M",PSDS)) Q:'PSDS  I $P($G(^PSD(58.8,+PSDS,0)),U,3)=+PSDSITE&('$G(^PSD(58.8,+PSDS,"I"))!($G(^PSD(58.8,+PSDS,"I"))>DT)) S PSDC=$G(PSDC)+1
"RTN","PSDREPD",7,0)
 I '$G(PSDC) W !!,"Sorry, no Master Vaults set up for this site.",!! G END
"RTN","PSDREPD",8,0)
 S:PSDC=1 PSDS=$O(^PSD(58.8,"ADISP","M",0))
"RTN","PSDREPD",9,0)
 I PSDC>1 D  G:Y<1 END S PSDS=+Y W !
"RTN","PSDREPD",10,0)
 .S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDREPD",11,0)
 .S:$P($G(^PSD(58.8,+$P(PSDSITE,U,3),0)),U,2)["M" DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDREPD",12,0)
 .S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""M"",$S('$G(^(""I"")):1,+^(""I"")>DT:1,1:0)"
"RTN","PSDREPD",13,0)
 .W ! D ^DIC K DIC S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDREPD",14,0)
 W !,"Select Invoice Date Range",!
"RTN","PSDREPD",15,0)
DATE ;ask date range
"RTN","PSDREPD",16,0)
 K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDREPD",17,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " W ! D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDREPD",18,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDREPD",19,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDREPD",20,0)
SUM ;if summary only
"RTN","PSDREPD",21,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to print the invoice numbers only",DIR("B")="NO"
"RTN","PSDREPD",22,0)
 S DIR("?",1)="Answer 'YES' to print only the invoice numbers for this report,",DIR("?")="answer 'NO' to print the detailed report including drug totals."
"RTN","PSDREPD",23,0)
 D ^DIR K DIR G:$D(DIRUT) END S SUM=Y
"RTN","PSDREPD",24,0)
 D NOW^%DTC S PSDT=X,Y=% X ^DD("DD") S PSDT(1)=Y
"RTN","PSDREPD",25,0)
DEV ;asks device and queueing information
"RTN","PSDREPD",26,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDREPD",27,0)
 S Y=$P($G(^PSD(58.8,+$P(PSDSITE,U,3),2)),U,9),C=$P(^DD(58.8,24,0),U,2) D Y^DIQ S PSDEV=Y
"RTN","PSDREPD",28,0)
 K %ZIS,IOP,IO("Q") S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS
"RTN","PSDREPD",29,0)
 I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSDOUT=1 G END
"RTN","PSDREPD",30,0)
 I $D(IO("Q")) K IO("Q") S ZTIO=ION N ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDREPD",ZTDESC="CS Invoice Report data" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK S PSDOUT=1 G END
"RTN","PSDREPD",31,0)
 U IO
"RTN","PSDREPD",32,0)
START S (PG,PSDOUT)=0,PSDSD(1)=PSDSD D HEADER
"RTN","PSDREPD",33,0)
 F  S PSDSD=$O(^PSD(58.81,"AF",PSDSD)) Q:PSDSD>PSDED!('PSDSD)!(PSDOUT)  S PSD(1)=$O(^PSD(58.81,"AF",PSDSD,0)),PSD(2)=$O(^PSD(58.81,"AF",PSDSD,PSD(1),1,0)) D:PSD(1)=PSDS&(PSD(2))
"RTN","PSDREPD",34,0)
 .S PSD(4)=$G(^PSD(58.81,+PSD(2),0)),PSD(5)=$G(^PSD(58.81,+PSD(2),8))
"RTN","PSDREPD",35,0)
 .Q:PSD(5)']""  Q:$D(^TMP("PSD",$J,PSD(5)))
"RTN","PSDREPD",36,0)
 .S (PSD,PSDC,^TMP("PSD",$J,PSD(5)))=0
"RTN","PSDREPD",37,0)
 .I SUM D  Q
"RTN","PSDREPD",38,0)
 ..D:$Y+4>IOSL HEADER Q:PSDOUT
"RTN","PSDREPD",39,0)
 ..W !!,$$FMTE^XLFDT(PSDSD,"1P"),?26,PSD(5),?54
"RTN","PSDREPD",40,0)
 ..W $E($P($G(^VA(200,+$P(PSD(4),U,7),0)),U),1,26)
"RTN","PSDREPD",41,0)
 .I $Y+4>IOSL D HEADER S PSDC=0 Q:PSDOUT
"RTN","PSDREPD",42,0)
 .W !!,"Invoice Number ==>  ",PSD(5)
"RTN","PSDREPD",43,0)
 .F  S PSD=$O(^PSD(58.81,"PV",PSD(5),PSD)) Q:'PSD  D:$Y+4>IOSL HEADER Q:PSDOUT  S PSD(1)=$G(^PSD(58.81,+PSD,0)) D:$P(PSD(1),U,4)>PSDSD(1)&($P(PSD(1),U,4)'>PSDED)
"RTN","PSDREPD",44,0)
 ..I PSDC W !!,"Invoice Number ==>  ",PSD(5)," (continued)" S PSDC=0
"RTN","PSDREPD",45,0)
 ..W !!,$E($P($G(^PSDRUG(+$P(PSD(1),U,5),0)),U),1,30),?32
"RTN","PSDREPD",46,0)
 ..W $J($P(PSD(1),U,6),8),?41
"RTN","PSDREPD",47,0)
 ..W $P($G(^PSDRUG(+$P(PSD(1),U,5),660)),U,8),?54
"RTN","PSDREPD",48,0)
 ..W $E($P($G(^VA(200,+$P(PSD(1),U,7),0)),U),1,18),?72
"RTN","PSDREPD",49,0)
 ..W $$FMTE^XLFDT($P(PSD(1),U,4),"2D")
"RTN","PSDREPD",50,0)
END ;
"RTN","PSDREPD",51,0)
 W:$E(IOST)'="C" @IOF
"RTN","PSDREPD",52,0)
 I $E(IOST)="C",'$G(PSDOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDREPD",53,0)
 K %DT,%ZIS,DA,DIROUT,IO("Q"),PSDT,ZTDESC,ZTIO,ZTRTN,^TMP("PSD",$J) D ^%ZISC
"RTN","PSDREPD",54,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDREPD",55,0)
 Q
"RTN","PSDREPD",56,0)
SAVE ;save variables for queueing
"RTN","PSDREPD",57,0)
 S ZTSAVE("SUM")="",ZTSAVE("PSDSITE")="",ZTSAVE("PSD*")=""
"RTN","PSDREPD",58,0)
 Q
"RTN","PSDREPD",59,0)
HEADER ;prints header info
"RTN","PSDREPD",60,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDREPD",61,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDREPD",62,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1
"RTN","PSDREPD",63,0)
 W !?2,$E($S($P($G(^VA(200,+$G(DUZ),.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($P($G(^VA(200,+$G(DUZ),0)),U),",",2)),1,20),"'s Invoice Review From "
"RTN","PSDREPD",64,0)
 W $P(PSDATE,U)," To ",$P(PSDATE,U,2),?72,"Page ",PG,!!
"RTN","PSDREPD",65,0)
 W ?45,"Report Date:  ",PSDT(1)
"RTN","PSDREPD",66,0)
 I SUM W !!,"Date",?22,"Invoice Number",?54,"Received By",!,LN Q
"RTN","PSDREPD",67,0)
 W !!?5,"Drug",?34,"Quantity            Received By         Date",!,LN
"RTN","PSDREPD",68,0)
 S:PG PSDC=PSDC+1
"RTN","PSDREPV")
0^207^B10465287
"RTN","PSDREPV",1,0)
PSDREPV ;BIR/LTL-Review PV Receipt Transactions ; 29 Aug 94
"RTN","PSDREPV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREPV",3,0)
 N C,D,DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDL,PSDEV,PSDOUT,X,Y
"RTN","PSDREPV",4,0)
 D DT^DICRW
"RTN","PSDREPV",5,0)
 S DIR(0)="Y",DIR("A")="Would you like to select a date range"
"RTN","PSDREPV",6,0)
 S DIR("B")="No",DIR("?")="If you select a date range, I'll show all invoices for that range." D ^DIR K DIR G:Y<0 END G:Y ^PSDREPD
"RTN","PSDREPV",7,0)
 S DIC="^PSD(58.81,",DIC(0)="AEQ",D="PV",DIC("A")="Please select Prime Vendor Invoice number: " W ! D IX^DIC K DIC S PSD=+Y,PSD(2)=$P($G(^PSD(58.81,+Y,8)),U) I Y<0 S PSDOUT=1 G END
"RTN","PSDREPV",8,0)
 I PSD(2)']"" W !!,"No Prime Vendor Invoice for this transaction." S PSDOUT=1 G END
"RTN","PSDREPV",9,0)
DEV S PSDEV=$P($G(^%ZIS(1,+$P($G(^PSD(58.8,+$S($G(PSDLOC):PSDLOC,1:$P($G(^PSD(58.81,+Y,0)),U,3)),2)),U,9),0)),U)
"RTN","PSDREPV",10,0)
 ;asks device and queueing info
"RTN","PSDREPV",11,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSDOUT=1 G END
"RTN","PSDREPV",12,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDREPV",ZTDESC="Invoice receipt review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDREPV",13,0)
START ;compiles and prints output
"RTN","PSDREPV",14,0)
 N %DT,LN,PG,RPDT S (PG,PSDOUT,PSD(1))=0,Y=DT X ^DD("DD") S RPDT=Y
"RTN","PSDREPV",15,0)
 D HEADER
"RTN","PSDREPV",16,0)
LOOP F  S PSD(1)=$O(^PSD(58.81,"PV",PSD(2),PSD(1))) Q:'PSD(1)  G:$G(PSDOUT) END D:$Y+5>IOSL HEADER G:PSDOUT END S PSD(3)=$G(^PSD(58.81,+PSD(1),0)) D
"RTN","PSDREPV",17,0)
 .I '$G(PSDLOC) S PSDLOC=$P(PSD(3),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSDLOC,0)),U),!
"RTN","PSDREPV",18,0)
 .I $G(PSDLOC)'=$P(PSD(3),U,3),$P(PSD(3),U,3) S PSDL(PSD(1))=PSD(3) Q
"RTN","PSDREPV",19,0)
 .S Y=+$E($P(PSD(3),U,4),1,12) X ^DD("DD") W !,Y,"  "
"RTN","PSDREPV",20,0)
 .W $E($P($G(^PSDRUG(+$P(PSD(3),U,5),0)),U),1,25)," -> "
"RTN","PSDREPV",21,0)
 .W $P(PSD(3),U,6)," rec'd by "
"RTN","PSDREPV",22,0)
 .W $E($P($G(^VA(200,+$P(PSD(3),U,7),0)),U),1,20),!
"RTN","PSDREPV",23,0)
 W:$O(PSDL(0)) !,"Receiving Site: ",$P($G(^PSD(58.8,+$P(PSD(3),U,3),0)),U),!
"RTN","PSDREPV",24,0)
 F  S PSD(1)=$O(PSDL(PSD(1))) Q:'PSD(1)  D:$Y+5>IOSL HEADER Q:PSDOUT  D
"RTN","PSDREPV",25,0)
 .S PSD(3)=$G(PSDL(PSD(1)))
"RTN","PSDREPV",26,0)
 .S Y=$E($P(PSD(3),U,4),1,12) X ^DD("DD") W !,Y,"  "
"RTN","PSDREPV",27,0)
 .W $E($P($G(^PSDRUG(+$P(PSD(3),U,5),0)),U),1,25)," -> "
"RTN","PSDREPV",28,0)
 .W $P(PSD(3),U,6)," rec'd by "
"RTN","PSDREPV",29,0)
 .W $E($P($G(^VA(200,+$P(PSD(3),U,7),0)),U),1,20),!
"RTN","PSDREPV",30,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDREPV",31,0)
 I $E(IOST)="C",'$G(PSDOUT) S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu. " D ^DIR
"RTN","PSDREPV",32,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDREPV",33,0)
 Q
"RTN","PSDREPV",34,0)
HEADER ;prints header info
"RTN","PSDREPV",35,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDREPV",36,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1 Q
"RTN","PSDREPV",37,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"History of receipts for Invoice # ",PSD(2),?57,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDREV")
0^208^B9113997
"RTN","PSDREV",1,0)
PSDREV ;BIR/LTL-Review Receipt Transactions ; 29 Aug 94
"RTN","PSDREV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREV",3,0)
 N C,DIC,DIR,DTOUT,DUOUT,PSDEV,PSDLOC,PSDOUT,PSDPO,X,Y
"RTN","PSDREV",4,0)
 S DIC="^PRC(442,",DIC(0)="AEMQZ",DIC("A")="Please Select Purchase Order Number: ",DIC("S")="I $P($G(^(0)),U,5)[822400",PSDOUT=1 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSDPO=+Y
"RTN","PSDREV",5,0)
 I '$O(^PSD(58.81,"C",+Y,"")) W !!,"There have been no receipts for this Purchase Order.",!! G END
"RTN","PSDREV",6,0)
DEV ;asks device and queueing info
"RTN","PSDREV",7,0)
 S Y=$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+$O(^PSD(58.81,"C",+Y,0)),0)),U,3),2)),U,9),C=$P(^DD(58.8,24,0),U,2) D Y^DIQ S PSDEV=Y
"RTN","PSDREV",8,0)
 K IO("Q"),PSDLOC N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDREV",9,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDREV",ZTDESC="Receipt transaction review",ZTSAVE("PSDPO")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDREV",10,0)
START ;compiles and prints output
"RTN","PSDREV",11,0)
 N %DT,LN,PSDR,PG,RPDT S (PG,PSDOUT)=0,Y=DT,PSDR="" X ^DD("DD") S RPDT=Y D HEADER
"RTN","PSDREV",12,0)
LOOP F  S PSDR=$O(^PSD(58.81,"C",PSDPO,PSDR)) G:'PSDR END D:$Y+5>IOSL HEADER G:PSDOUT END D
"RTN","PSDREV",13,0)
 .I '$D(PSDLOC) S PSDLOC=$P($G(^PSD(58.81,+PSDR,0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSDLOC,0)),U),!
"RTN","PSDREV",14,0)
 .I $G(PSDLOC)'=$P($G(^PSD(58.81,+PSDR,0)),U,3) S PSDLOC=$P($G(^(0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+PSDR,0)),U,3),0)),U),!
"RTN","PSDREV",15,0)
 .S Y=$P($G(^PSD(58.81,+PSDR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSDR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSDREV",16,0)
 .W $P($G(^PSD(58.81,+PSDR,0)),U,6)," rec'd by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSDR,0)),U,7),0)),U),1,20),!
"RTN","PSDREV",17,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDREV",18,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDREV",19,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDREV",20,0)
 Q
"RTN","PSDREV",21,0)
HEADER ;prints header info
"RTN","PSDREV",22,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDREV",23,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1 Q
"RTN","PSDREV",24,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !?2,"History of receipts for P.O.# ",$P($G(^PRC(442,+PSDPO,0)),U),?50,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDREVC")
0^209^B12924217
"RTN","PSDREVC",1,0)
PSDREVC ;BIR/LTL-Review Receipt Transactions ; 29 Aug 94
"RTN","PSDREVC",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREVC",3,0)
 W !!,"Because of the size of this file, look-ups of less than four characters",!!,"are NOT advised.  Please enter either the entire transaction number,",!!,"Station-FY-QTR-Control Point-Sequence Number, or at least the four digit"
"RTN","PSDREVC",4,0)
 W !!,"Sequence Number.",!!
"RTN","PSDREVC",5,0)
 N C,DIC,DIR,DTOUT,DUOUT,PSDCON,PSDEV,PSDLOC,PSDOUT,X,Y
"RTN","PSDREVC",6,0)
 S DIC="^PRCS(410,",DIC(0)="AEMQ",DIC("A")="Please select Control Point Transaction: ",DIC("S")="I $P($G(^(0)),U,2)=""O"",$P($G(^(3)),U,3)[822400",PSDOUT=1 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSDCON=+Y
"RTN","PSDREVC",7,0)
 I '$O(^PSD(58.81,"E",+PSDCON,"")) W !!,"There are no receipts for this Transaction.",!! G END
"RTN","PSDREVC",8,0)
DEV S Y=$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+$O(^PSD(58.81,"E",+Y,0)),0)),U,3),2)),U,9),C=$P(^DD(58.8,24,0),U,2) D Y^DIQ S PSDEV=Y ; set default printer to report printer
"RTN","PSDREVC",9,0)
 ;asks device and queueing info
"RTN","PSDREVC",10,0)
 K IO("Q"),PSDLOC N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDREVC",11,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDREVC",ZTDESC="Receipt transaction review",ZTSAVE("PSDCON")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDREVC",12,0)
START ;compiles and prints output
"RTN","PSDREVC",13,0)
 N %DT,LN,PSDR,PG,RPDT S (PG,PSDOUT)=0,Y=DT,PSDR="" X ^DD("DD") S RPDT=Y D HEADER
"RTN","PSDREVC",14,0)
LOOP F  S PSDR=$O(^PSD(58.81,"E",+PSDCON,PSDR)) G:'PSDR END D:$Y+5>IOSL HEADER G:PSDOUT END D
"RTN","PSDREVC",15,0)
 .I '$D(PSDLOC) S PSDLOC=$P($G(^PSD(58.81,+PSDR,0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSDLOC,0)),U),!
"RTN","PSDREVC",16,0)
 .I $G(PSDLOC)'=$P($G(^PSD(58.81,+PSDR,0)),U,3) S PSDLOC=$P($G(^(0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+PSDR,0)),U,3),0)),U),!
"RTN","PSDREVC",17,0)
 .S Y=$P($G(^PSD(58.81,+PSDR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSDR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSDREVC",18,0)
 .W $P($G(^PSD(58.81,+PSDR,0)),U,6)," rec'd by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSDR,0)),U,7),0)),U),1,20),!
"RTN","PSDREVC",19,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDREVC",20,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDREVC",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDREVC",22,0)
 Q
"RTN","PSDREVC",23,0)
HEADER ;prints header info
"RTN","PSDREVC",24,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDREVC",25,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1 Q
"RTN","PSDREVC",26,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !,"History of receipts for Transaction # ",$P($G(^PRCS(410,+PSDCON,0)),U),?57,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDREVD")
0^210^B16186105
"RTN","PSDREVD",1,0)
PSDREVD ;BIR/LTL-Review Receipt Transactions for a Drug ; 29 Aug 94
"RTN","PSDREVD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDREVD",3,0)
 N PSDOUT I '$D(PSDSITE) D ^PSDSET I '$D(PSDSITE) S PSDOUT=1 G END
"RTN","PSDREVD",4,0)
 N C,CNT,DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDEV,PSDR,PSDU,PSDLOC,PSDLOCN,PSDT,X,Y S PSDOUT=1,PSDU=0
"RTN","PSDREVD",5,0)
 D DT^DICRW
"RTN","PSDREVD",6,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDREVD",7,0)
 S CNT=0 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDREVD",8,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDREVD",9,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$P($G(^(0)),U,2)[""M""&($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))"
"RTN","PSDREVD",10,0)
 S:$P($G(^PSD(58.8,+PSDLOC,0)),U,2)["M" DIC("B")=PSDLOCN
"RTN","PSDREVD",11,0)
 W ! D ^DIC K DIC G:Y<0 END S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDREVD",12,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDLOCN
"RTN","PSDREVD",13,0)
 S CNT=0 W !!,"You may select one, several, or ^ALL drugs.",!
"RTN","PSDREVD",14,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEMQ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  S PSD(+Y)="",CNT=CNT+1
"RTN","PSDREVD",15,0)
 I CNT=1&('$O(^PSD(58.81,"F",+$O(PSD(0)),""))) W !!,"There have been no receipts for this drug.",!! G END
"RTN","PSDREVD",16,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  S PSD(PSDU)=""
"RTN","PSDREVD",17,0)
 S DIR(0)="D:AEP",DIR("A")="How far back in time do you want to go? ",DIR("B")="T-6M",DIR("?")="I will list receipts for your selected drug(s) within the last six months if you press return" W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDREVD",18,0)
 S PSDT=Y
"RTN","PSDREVD",19,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDREVD",20,0)
DEV ;asks device and queueing info
"RTN","PSDREVD",21,0)
 K IO("Q"),PSDLOC N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDREVD",22,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDREVD",ZTDESC="Drug receipt transaction review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDREVD",23,0)
START ;compiles and prints output
"RTN","PSDREVD",24,0)
 N %DT,LN,PSDR,PG,RPDT S (PG,PSDOUT)=0,Y=DT,PSDR="" X ^DD("DD") S RPDT=Y,PSDU(1)=$O(PSD(0)) D HEADER S PSDU=0
"RTN","PSDREVD",25,0)
 F  S PSDU=$O(PSD(PSDU)) Q:'PSDU  K PSDR(1) D  G:PSDOUT END I 'PSDR,$O(PSD(PSDU)) S PSDU(1)=$O(PSD(PSDU))
"RTN","PSDREVD",26,0)
LOOP .F  S PSDR=$O(^PSD(58.81,"F",PSDU,PSDR)) Q:'PSDR  D:$Y+6>IOSL HEADER Q:PSDOUT  S PSDR(2)=$G(^PSD(58.81,+PSDR,0)) D:$P(PSDR(2),U,4)'<PSDT&($P(PSDR(2),U,2)=1)
"RTN","PSDREVD",27,0)
 ..S PSDR(1)=$G(PSDR(1))+1 W:PSDR(1)=1 $P($G(^PSDRUG(+PSDU,0)),U),!
"RTN","PSDREVD",28,0)
 ..I '$D(PSDLOC) S PSDLOC=$P(PSDR(2),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSDLOC,0)),U),!
"RTN","PSDREVD",29,0)
 ..I $G(PSDLOC)'=$P(PSDR(2),U,3) S PSDLOC=$P(PSDR(2),U,3) W !,"Receiving site: ",$P($G(^PSD(58.8,+PSDLOC,0)),U),!
"RTN","PSDREVD",30,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,"  "," -> "
"RTN","PSDREVD",31,0)
 ..W $P(PSDR(2),U,6)," received by ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),!!
"RTN","PSDREVD",32,0)
 ..W:$P($G(^PRC(442,+$P(PSDR(2),U,9),0)),U) "P.O.#:  "_$P($G(^(0)),U),?20
"RTN","PSDREVD",33,0)
 ..W:$P($G(^PRCS(410,+$P(PSDR(2),U,8),0)),U) "TR#:  ",$P($G(^(0)),U),"  "
"RTN","PSDREVD",34,0)
 ..W:$P($G(^PSD(58.81,+PSDR,8)),U)]"" "INV#:  ",$P($G(^(8)),U)
"RTN","PSDREVD",35,0)
 ..W !,LN,!
"RTN","PSDREVD",36,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDREVD",37,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDREVD",38,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDREVD",39,0)
 Q
"RTN","PSDREVD",40,0)
HEADER ;prints header info
"RTN","PSDREVD",41,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDREVD",42,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDREVD",43,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1 W !?2,"History of Drug Receipts",?50,RPDT,?70,"PAGE: ",PG,!,LN,!
"RTN","PSDRF")
0^211^B20180450
"RTN","PSDRF",1,0)
PSDRF ;BIR/JPW,LTL-Nurse RF Dispensing ; 8 Aug 94
"RTN","PSDRF",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRF",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRF",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRF",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRF",6,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRF",7,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRF",8,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRF",9,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRF",10,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRF",11,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRF",12,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRF",13,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRF",14,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRF",15,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRF",16,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRF",17,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRF",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRF",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRF",20,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRF",21,0)
PATIENT N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRF",22,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRF",23,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRF",24,0)
DRUG ;select drug
"RTN","PSDRF",25,0)
 N DIR,PSD,PSDR,PSDQ,WQTY
"RTN","PSDRF",26,0)
 S DIR(0)="FAO^1:40"
"RTN","PSDRF",27,0)
 S DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRF",28,0)
 W ! D ^DIR K DIR G:Y="" PATIENT G:$D(DIRUT) END
"RTN","PSDRF",29,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRF",30,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRF",31,0)
 .S PSD=0
"RTN","PSDRF",32,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRF",33,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRF",34,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRF",35,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRF",36,0)
 .S DIC("S")="I $P($G(^(0)),U,4)"
"RTN","PSDRF",37,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRF",38,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRF",39,0)
 ;S DIC="^PSD(58.81,",DIC(0)="EMQSZ"
"RTN","PSDRF",40,0)
 ;S DIC("S")="I $P(^(0),U,11)>3,$P(^(0),U,18)=NAOU"
"RTN","PSDRF",41,0)
 ;W ! D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRF",42,0)
 ;S PSDR=$P(Y(0),U,5),PSDPN=$P(Y(0),U,17),PSDTYP=17
"RTN","PSDRF",43,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRF",44,0)
 I 'OQTY,'$P($G(^PSD(58.81,+$G(PSD),9)),U) W !!,"Sorry, this drug has a zero balance." G DRUG
"RTN","PSDRF",45,0)
 D ^PSDRFV
"RTN","PSDRF",46,0)
 S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRF",47,0)
 S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRF",48,0)
 S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRF",49,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRF",50,0)
 I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1),PSDTYP=17
"RTN","PSDRF",51,0)
 G:'$G(PSDS) END
"RTN","PSDRF",52,0)
LIQ G:$P($G(^PSD(58.8,+PSDS,1,PSDR,7)),U) ^PSDRFL
"RTN","PSDRF",53,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRF",54,0)
 S DIR("B")=1 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRF",55,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRF",56,0)
 .W ?30,"Amount wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRF",57,0)
 .W !,"You have sixty seconds to find a witness.",!
"RTN","PSDRF",58,0)
WIT .W:$G(NUR2(1)) !,"OK, sixty more seconds, but that's it.",!
"RTN","PSDRF",59,0)
 .S NUR2=$$WITNESS^XUVERIFY("WITNESS"),NUR2(1)=$G(NUR2(1))+1
"RTN","PSDRF",60,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRF",61,0)
 .G:NUR2'>0&(NUR2(1)<2) WIT I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRF",62,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U)) S PSDQ=PSDQ+(1-PSDQ#1)
"RTN","PSDRF",63,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRF",64,0)
 D UPDAT^PSDRF1 G DRUG
"RTN","PSDRF",65,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRF",66,0)
 K NAOU,NAOUN,NBKU,NPKG,NUR2,OK,OKTYP,ORD,PAT,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRF",67,0)
 Q
"RTN","PSDRF",68,0)
MSG ;display error message
"RTN","PSDRF",69,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRF",70,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRF",71,0)
 Q
"RTN","PSDRF1")
0^212^B6498777
"RTN","PSDRF1",1,0)
PSDRF1 ;B'ham ISC/JPW,LTL - File Dispensing Info ; 13 Dec 93
"RTN","PSDRF1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRF1",3,0)
UPDAT I $G(PSDPN) F JJ=0:0 S JJ=$O(^PSD(58.8,"F",PSDPN,NAOU,PSDR,JJ)) Q:'JJ  S ORD=+JJ
"RTN","PSDRF1",4,0)
 ;$S(WQTY:18,CQTY:9,1:17) S:PSDTYP=9 QTY=CQTY-OQTY
"RTN","PSDRF1",5,0)
 W ?40,"Recording transaction...  "
"RTN","PSDRF1",6,0)
 D UPDATE W "done."
"RTN","PSDRF1",7,0)
END ;kill variables
"RTN","PSDRF1",8,0)
 K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,LQTY,NAOUN,NODE,NUR2,OK,ORD
"RTN","PSDRF1",9,0)
 K PSD,PSDER,PSDREC,PSDRN,PSDT,PSDTN,QTY,WQTY,X,Y
"RTN","PSDRF1",10,0)
 Q
"RTN","PSDRF1",11,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDRF1",12,0)
 ;updating drug balance in 58.8
"RTN","PSDRF1",13,0)
 F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDRF1",14,0)
 D NOW^%DTC S (PSDTN,PSDT)=+%
"RTN","PSDRF1",15,0)
 S BAL=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-PSDQ
"RTN","PSDRF1",16,0)
 L -^PSD(58.8,NAOU,1,PSDR,0)
"RTN","PSDRF1",17,0)
 ;update order balance
"RTN","PSDRF1",18,0)
 ;I $G(ORD),$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),PSDTYP'=9 S $P(^(0),"^",22)=$P(^(0),"^",22)-PSDQ,DA=+$P(^(0),"^",17) D:$P(^(0),"^",22)=0  K DA,DIE,DR
"RTN","PSDRF1",19,0)
 ;.K DIE,DR S DIE="^PSD(58.81,",DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRF1",20,0)
 ;.K DA,DIE,DR S DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA=+ORD,DA(1)=+PSDR,DA(2)=+NAOU,DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRF1",21,0)
ADD ;find entry number in 58.81
"RTN","PSDRF1",22,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDRF1",23,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDRF1",24,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDRF1",25,0)
 L -^PSD(58.81,0)
"RTN","PSDRF1",26,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDRF1",27,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP_"^"_NAOU_"^"_PSDT_"^"_PSDR_"^"_$S(PSDTYP=9:-PSDQ,1:PSDQ)_"^"_$G(NUR1)_"^^^"_BAL_"^^^^^^"_$S(PSDTYP=9:$G(PSDRE),1:"")_"^"_$G(PSDPN)_"^"_NAOU_"^^"_$G(ORD)
"RTN","PSDRF1",28,0)
 S ^PSD(58.81,PSDREC,9)=$G(PAT)_"^"_NUR1_"^"_OQTY_"^"_$G(WQTY)_"^"_$G(LQTY)_"^"_$G(NUR2)_"^"_BAL
"RTN","PSDRF1",29,0)
 ;S:PATL ^PSD(58.81,PSDREC,9.5)=PATL
"RTN","PSDRF1",30,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDRF1",31,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDRF1",32,0)
 I PSDTYP'=17 D ERR
"RTN","PSDRF1",33,0)
 Q
"RTN","PSDRF1",34,0)
ERR ;err log update
"RTN","PSDRF1",35,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDRF1",36,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDRF1",37,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDRF1",38,0)
 L -^PSD(58.89,0)
"RTN","PSDRF1",39,0)
EDIT9 ;edit error log
"RTN","PSDRF1",40,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_NAOU D ^DIE K DA,DIE,DR
"RTN","PSDRF1",41,0)
 S PHARM1=NUR1,QTY=PSDQ
"RTN","PSDRF1",42,0)
 S:$G(NAOUN)']"" NAOUN=$P($G(^PSD(58.8,NAOU,0)),U) D ^PSDRFM
"RTN","PSDRF1",43,0)
 Q
"RTN","PSDRF2")
0^213^B2483597
"RTN","PSDRF2",1,0)
PSDRF2 ;BIR/JPW,LTL-Nurse RF Dispensing count correction; 8 Aug 94
"RTN","PSDRF2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRF2",3,0)
QTY S DIR(0)="NA^.01:999999:2",DIR("A")="Correct Count: "
"RTN","PSDRF2",4,0)
 W ! D ^DIR K DIR
"RTN","PSDRF2",5,0)
 I $D(DIRUT)!(Y'>0) S PSDOUT=1 G END
"RTN","PSDRF2",6,0)
 S PSDQ(1)=Y,PSDTYP=9,PSDQ=OQTY-Y
"RTN","PSDRF2",7,0)
 I PSDQ(1)=OQTY W !!,"That's no change." Q
"RTN","PSDRF2",8,0)
 I Y>OQTY S NAOU(1)=0 D ^PSDORSU G:$G(NAOU(1)) BAL^PSDRF I $G(PSDOUT) G END
"RTN","PSDRF2",9,0)
 S DIR(0)="58.81,15" W ! D ^DIR K DIR
"RTN","PSDRF2",10,0)
 I $D(DIRUT) S PSDOUT=1 G END
"RTN","PSDRF2",11,0)
 S PSDRE=Y
"RTN","PSDRF2",12,0)
WIT W ! S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRF2",13,0)
 I DUZ=NUR2 W !!,"Hold it, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRF2",14,0)
 I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRF2",15,0)
 W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRF2",16,0)
 D UPDAT^PSDRF1
"RTN","PSDRF2",17,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRF2",18,0)
 K NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDQTY,PSDRD,PSDRE,PSDRN,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X
"RTN","PSDRF2",19,0)
 Q
"RTN","PSDRF3")
1^214
"RTN","PSDRF4")
0^380^B16231710
"RTN","PSDRF4",1,0)
PSDRF4 ;BIR/JPW,LTL-Nurse RF damaged dose ; 8 Aug 94
"RTN","PSDRF4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRF4",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRF4",4,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRF4",5,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRF4",6,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRF4",7,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRF4",8,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G DRUG
"RTN","PSDRF4",9,0)
 W !!,"Please enter the ward from which the defective drug(s) will be destroyed."
"RTN","PSDRF4",10,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRF4",11,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRF4",12,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRF4",13,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRF4",14,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRF4",15,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRF4",16,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRF4",17,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRF4",18,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRF4",19,0)
DRUG ;select drug
"RTN","PSDRF4",20,0)
 N DIR,PSD,PSDR,PSDQ
"RTN","PSDRF4",21,0)
 S DIR(0)="FAO^1:40"
"RTN","PSDRF4",22,0)
 S DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRF4",23,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRF4",24,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRF4",25,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRF4",26,0)
 .S PSD=0
"RTN","PSDRF4",27,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=9,PSDRE="DEFECTIVE DOSE" Q
"RTN","PSDRF4",28,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRF4",29,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 DRUG
"RTN","PSDRF4",30,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRF4",31,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRF4",32,0)
 .S PSDR=+Y,PSDTYP=9,PSDRE="DEFECTIVE DOSE"
"RTN","PSDRF4",33,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRF4",34,0)
 I 'OQTY W !!,"Sorry, this drug has a zero balance." G DRUG
"RTN","PSDRF4",35,0)
 D ^PSDRFV
"RTN","PSDRF4",36,0)
 S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRF4",37,0)
 S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRF4",38,0)
 S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRF4",39,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRF4",40,0)
 I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1),PSDTYP=17
"RTN","PSDRF4",41,0)
LIQ G:$P($G(^PSD(58.8,+PSDS,1,PSDR,7)),U) ^PSDRF5
"RTN","PSDRF4",42,0)
DEF W ! S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount defective: "
"RTN","PSDRF4",43,0)
 S DIR("B")=1 D ^DIR K DIR G:$D(DIRUT) END S (PSDQ,WQTY)=Y
"RTN","PSDRF4",44,0)
WIT S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRF4",45,0)
 I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRF4",46,0)
 I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRF4",47,0)
 W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRF4",48,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRF4",49,0)
 D UPDAT^PSDRF1
"RTN","PSDRF4",50,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRF4",51,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRF4",52,0)
 Q
"RTN","PSDRF4",53,0)
MSG ;display error message
"RTN","PSDRF4",54,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRF4",55,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRF4",56,0)
 Q
"RTN","PSDRF5")
0^381^B4475969
"RTN","PSDRF5",1,0)
PSDRF5 ;BIR/JPW,LTL-Nurse RF defective liquid Dispensing ; 8 Aug 94
"RTN","PSDRF5",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRF5",3,0)
 S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount defective: "
"RTN","PSDRF5",4,0)
 W ! D ^DIR K DIR S:$D(DIRUT) PSDOUT=1 Q:Y'>0  S (WQTY,PSDQ)=Y
"RTN","PSDRF5",5,0)
WIT S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRF5",6,0)
 I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRF5",7,0)
 I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRF5",8,0)
 W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRF5",9,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRF5",10,0)
 D UPDAT^PSDRF1 G DRUG^PSDRF4
"RTN","PSDRF5",11,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRF5",12,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRF5",13,0)
 Q
"RTN","PSDRF5",14,0)
MSG ;display error message
"RTN","PSDRF5",15,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRF5",16,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRF5",17,0)
 Q
"RTN","PSDRFD")
0^215^B6887259
"RTN","PSDRFD",1,0)
PSDRFD ;BIR/JPW,LTL-Nurse RF Dispensing ; 8 Aug 94
"RTN","PSDRFD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFD",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRFD",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRFD",5,0)
 ;I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRFD",6,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRFD",7,0)
NURSE ;N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRFD",8,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRFD",9,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRFD",10,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRFD",11,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRFD",12,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRFD",13,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRFD",14,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRFD",15,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRFD",16,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRFD",17,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRFD",18,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRFD",19,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRFD",20,0)
 ;check to see if NAOU is keeping perpetual inventory
"RTN","PSDRFD",21,0)
 I '$P($G(^PSD(58.8,NAOU,2)),U,5) W !!,"Sorry, Pharmacy has not set up ",$G(NAOUN)," to keep a perpetual inventory." S XQUIT=1
"RTN","PSDRFD",22,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFD",23,0)
 K NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFD",24,0)
 S:'$G(NAOU) XQUIT=1 Q
"RTN","PSDRFD",25,0)
MSG ;display error message
"RTN","PSDRFD",26,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFD",27,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFD",28,0)
 S XQUIT=1 Q
"RTN","PSDRFL")
0^265^B5249171
"RTN","PSDRFL",1,0)
PSDRFL ;BIR/JPW,LTL-Nurse RF Dispensing ; 8 Aug 94
"RTN","PSDRFL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFL",3,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRFL",4,0)
 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRFL",5,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRFL",6,0)
 .S DIR(0)="Y",DIR("A")="Will you be wasting any of this dose"
"RTN","PSDRFL",7,0)
 .W ! D ^DIR K DIR S:$D(DIRUT) PSDOUT=1 Q:Y'=1
"RTN","PSDRFL",8,0)
 .W ?44,"Amount to be wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRFL",9,0)
WIT .S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFL",10,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFL",11,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFL",12,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRFL",13,0)
 .S PSDQ=PSDQ+WQTY ;S DUZ=PSDUZ
"RTN","PSDRFL",14,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRFL",15,0)
 D UPDAT^PSDRF1 G DRUG^PSDRF
"RTN","PSDRFL",16,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFL",17,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFL",18,0)
 Q
"RTN","PSDRFL",19,0)
MSG ;display error message
"RTN","PSDRFL",20,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFL",21,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFL",22,0)
 Q
"RTN","PSDRFM")
0^216^B4735710
"RTN","PSDRFM",1,0)
PSDRFM ;BIR/JPW-File/Adj Mail Msg ; 29 Aug 94
"RTN","PSDRFM",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFM",3,0)
MSG ;send mailman message with count correction adj info
"RTN","PSDRFM",4,0)
 S PHARMN1=$S($P($G(^VA(200,+PHARM1,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN"),PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRFM",5,0)
 K XMY,^TMP("PSDTAMSG",$J) S Y=PSDT X ^DD("DD") S RDT=Y S ^TMP("PSDTAMSG",$J,1,0)="Controlled Substances count correction has been filed."
"RTN","PSDRFM",6,0)
 S (^TMP("PSDTAMSG",$J,1.5,0),^TMP("PSDTAMSG",$J,1.7,0))=""
"RTN","PSDRFM",7,0)
 S ^TMP("PSDTAMSG",$J,1.6,0)="Option used: "_$P($G(XQY0),U,2)
"RTN","PSDRFM",8,0)
 S ^TMP("PSDTAMSG",$J,2,0)="Correction Date/Time: "_RDT,^TMP("PSDTAMSG",$J,3,0)=""
"RTN","PSDRFM",9,0)
 S ^TMP("PSDTAMSG",$J,4,0)="Ward signed out from: "_$G(NAOUN)
"RTN","PSDRFM",10,0)
 S:$G(PAT) ^TMP("PSDTAMSG",$J,4.5,0)="Patient: "_$P($G(^DPT(+PAT,0)),U)
"RTN","PSDRFM",11,0)
 S ^TMP("PSDTAMSG",$J,5,0)="Drug: "_PSDRN
"RTN","PSDRFM",12,0)
 S ^TMP("PSDTAMSG",$J,6,0)="Quantity adjusted: "_-QTY
"RTN","PSDRFM",13,0)
 S ^TMP("PSDTAMSG",$J,7,0)="Adjusted by: "_PHARMN1
"RTN","PSDRFM",14,0)
 S ^TMP("PSDTAMSG",$J,8,0)="Witnessed by: "_$P($G(^VA(200,+$G(NUR2),0)),U)
"RTN","PSDRFM",15,0)
 S ^TMP("PSDTAMSG",$J,9,0)="Reason: "_$G(PSDRE)
"RTN","PSDRFM",16,0)
 S XMSUB="CONTROLLED SUBS ADJUSTMENT",XMTEXT="^TMP(""PSDTAMSG"",$J,",XMDUZ="CONTROLLED SUBSTANCES MONITOR"
"RTN","PSDRFM",17,0)
 F JJ=0:0 S JJ=$O(^XUSEC("PSD ERROR",JJ)) Q:'JJ  S XMY(JJ)=""
"RTN","PSDRFM",18,0)
 I $P($G(^PSD(58.8,+$G(NAOU),6)),U) S XMY("G."_$P($G(^XMB(3.8,+$P($G(^PSD(58.8,+$G(NAOU),6)),U),0)),U))="" W !!,"Notifying "
"RTN","PSDRFM",19,0)
 S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDTAMSG",$J)
"RTN","PSDRFM",20,0)
 K JJ,PHARMN1,PSDRN,RDT,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDRFM",21,0)
 Q
"RTN","PSDRFR")
0^269^B21078152
"RTN","PSDRFR",1,0)
PSDRFR ;BIR/JPW,LTL-Nurse RF Return to stock ; 8 Aug 94
"RTN","PSDRFR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRFR",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRFR",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRFR",6,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRFR",7,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRFR",8,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRFR",9,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRFR",10,0)
 W !!,"Please enter the ward from which the drug(s) was signed out."
"RTN","PSDRFR",11,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRFR",12,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRFR",13,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRFR",14,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRFR",15,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRFR",16,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRFR",17,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRFR",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRFR",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRFR",20,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRFR",21,0)
PATIENT W !!,"Returns can only be recorded within "
"RTN","PSDRFR",22,0)
 S NAOU(1)=$S($P($G(^PSD(58.8,NAOU,6)),U,2):$P(^(6),U,2),1:12)
"RTN","PSDRFR",23,0)
 W NAOU(1)," hours after signing out a dose."
"RTN","PSDRFR",24,0)
 N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRFR",25,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRFR",26,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRFR",27,0)
DRUG ;select drug
"RTN","PSDRFR",28,0)
 N DIR,PSD,PSDR,PSDQ
"RTN","PSDRFR",29,0)
 S DIR(0)="FAO^1:40",DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRFR",30,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRFR",31,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRFR",32,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRFR",33,0)
 .S PSD=0
"RTN","PSDRFR",34,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRFR",35,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRFR",36,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFR",37,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRFR",38,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRFR",39,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRFR",40,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRFR",41,0)
 D ^PSDRFV
"RTN","PSDRFR",42,0)
 I '$G(PSDA(1)) W !!,"No doses signed out",!! G END
"RTN","PSDRFR",43,0)
 S OQTY=$P($G(^PSD(58.81,PSDA(1),0)),U,6)
"RTN","PSDRFR",44,0)
 I $$FMADD^XLFDT(PSDA(3),"",NAOU(1))<$$NOW^XLFDT W !!,"The last dose was signed out at ",PSDA(2),", over ",NAOU(1)," hours ago.",!!,"It is too late to return to stock.",!! G END
"RTN","PSDRFR",45,0)
 I PSDA(4)'=DUZ W !!,"Sorry, only the person who signed out the dose can return to stock.",!! G END
"RTN","PSDRFR",46,0)
 W !!,"Starting Balance:  "_$P(PSDR(1),U,4)_" "_$P(PSDR(1),U,8)
"RTN","PSDRFR",47,0)
QTY S DIR(0)="NA^0:"_OQTY_":2"
"RTN","PSDRFR",48,0)
 S DIR("A")="Amount actually given at "_PSDA(2)_": "
"RTN","PSDRFR",49,0)
 W ! D ^DIR K DIR I $D(DIRUT)!(Y=OQTY) S PSDOUT=1 G END
"RTN","PSDRFR",50,0)
 S PSDQ=Y
"RTN","PSDRFR",51,0)
WASTE I PSDQ'=OQTY D  G:$G(PSDOUT) END
"RTN","PSDRFR",52,0)
 .I (OQTY-PSDQ)>1 D  Q:$G(PSDOUT)  G REA
"RTN","PSDRFR",53,0)
 ..S DIR(0)="N^1:"_(OQTY-PSDQ)_":2",DIR("A")="Amount returned"
"RTN","PSDRFR",54,0)
 ..S DIR("B")=OQTY-PSDQ D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDRFR",55,0)
 ..S WQTY=Y S:OQTY-WQTY PSDQ(1)=OQTY-WQTY
"RTN","PSDRFR",56,0)
 .S WQTY=$S('$G(PSDQ(2)):OQTY-PSDQ,1:OQTY-WQTY)
"RTN","PSDRFR",57,0)
 .W ?55,"Amount returned: ",WQTY,!
"RTN","PSDRFR",58,0)
REA .S DIR(0)="58.81,15",DIR("B")="Not given, returned to stock"
"RTN","PSDRFR",59,0)
 .D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDRFR",60,0)
 .S PSDRE(1)=Y
"RTN","PSDRFR",61,0)
 D UPDATE^PSDRFX W !!,"Balance:  ",$P(PSDR(1),U,4)+OQTY-PSDQ," ",$P(PSDR(1),U,8),!!
"RTN","PSDRFR",62,0)
 I $G(PSDQ(1)) S PSDQ=PSDQ(1) D WASTE^PSDRFW
"RTN","PSDRFR",63,0)
END I $G(PSDQ(2)),$G(PSDOUT) S $P(^PSD(58.81,PSDA(1),0),U,6)=PSDQ
"RTN","PSDRFR",64,0)
 W:$G(PSDOUT) !!,"No return recorded.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFR",65,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PAT,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRE,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WQTY,OQTY,PSDQ,WORD,X,Y
"RTN","PSDRFR",66,0)
 Q
"RTN","PSDRFR",67,0)
MSG ;display error message
"RTN","PSDRFR",68,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFR",69,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFR",70,0)
 Q
"RTN","PSDRFS")
0^497^B20279415
"RTN","PSDRFS",1,0)
PSDRFS ;BIR/JPW,LTL-Nurse RF Delayed Dispensing ; 8 Aug 94
"RTN","PSDRFS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRFS",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRFS",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRFS",6,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRFS",7,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRFS",8,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRFS",9,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRFS",10,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRFS",11,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRFS",12,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRFS",13,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRFS",14,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRFS",15,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRFS",16,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRFS",17,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRFS",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRFS",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRFS",20,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRFS",21,0)
PATIENT N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRFS",22,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRFS",23,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRFS",24,0)
DRUG ;select drug
"RTN","PSDRFS",25,0)
 N DIR,PSD,PSDR,PSDQ,WQTY
"RTN","PSDRFS",26,0)
 S DIR(0)="FAO^1:40"
"RTN","PSDRFS",27,0)
 S DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRFS",28,0)
 W ! D ^DIR K DIR G:Y="" PATIENT G:$D(DIRUT) END
"RTN","PSDRFS",29,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRFS",30,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRFS",31,0)
 .S PSD=0
"RTN","PSDRFS",32,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRFS",33,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRFS",34,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFS",35,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRFS",36,0)
 .S DIC("S")="I $P($G(^(0)),U,4)"
"RTN","PSDRFS",37,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRFS",38,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRFS",39,0)
 ;S DIC="^PSD(58.81,",DIC(0)="EMQSZ"
"RTN","PSDRFS",40,0)
 ;S DIC("S")="I $P(^(0),U,11)>3,$P(^(0),U,18)=NAOU"
"RTN","PSDRFS",41,0)
 ;W ! D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFS",42,0)
 ;S PSDR=$P(Y(0),U,5),PSDPN=$P(Y(0),U,17),PSDTYP=17
"RTN","PSDRFS",43,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRFS",44,0)
 I 'OQTY,'$P($G(^PSD(58.81,+$G(PSD),9)),U) W !!,"Sorry, this drug has a zero balance." G DRUG
"RTN","PSDRFS",45,0)
 D ^PSDRFV
"RTN","PSDRFS",46,0)
 S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRFS",47,0)
 S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRFS",48,0)
 S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRFS",49,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRFS",50,0)
 I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1),PSDTYP=17
"RTN","PSDRFS",51,0)
LIQ G:$P($G(^PSD(58.8,+PSDS,1,PSDR,7)),U) ^PSDRFU
"RTN","PSDRFS",52,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRFS",53,0)
 S DIR("B")=1 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRFS",54,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRFS",55,0)
 .W ?30,"Amount wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRFS",56,0)
WIT .S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFS",57,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFS",58,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFS",59,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U)) S PSDQ=PSDQ+(1-PSDQ#1)
"RTN","PSDRFS",60,0)
 S %DT="AEPRX",%DT(0)="-NOW",%DT("A")="Date/time given: "
"RTN","PSDRFS",61,0)
 W ! D ^%DT K %DT G:Y<1 END S PSDT=Y D ^PSDRFZ
"RTN","PSDRFS",62,0)
 S DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Nurse that signed out dose: "
"RTN","PSDRFS",63,0)
 W ! D ^DIC K DIC G:Y<1 END S NUR1=+Y,NUR1(1)=DUZ
"RTN","PSDRFS",64,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRFS",65,0)
 D UPDAT^PSDRFT G DRUG
"RTN","PSDRFS",66,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFS",67,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFS",68,0)
 Q
"RTN","PSDRFS",69,0)
MSG ;display error message
"RTN","PSDRFS",70,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFS",71,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFS",72,0)
 Q
"RTN","PSDRFT")
0^498^B8515082
"RTN","PSDRFT",1,0)
PSDRFT ;B'ham ISC/JPW,LTL - File Delayed Dispensing Info ; 13 Dec 93
"RTN","PSDRFT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFT",3,0)
UPDAT I $G(PSDPN) F JJ=0:0 S JJ=$O(^PSD(58.8,"F",PSDPN,NAOU,PSDR,JJ)) Q:'JJ  S ORD=+JJ
"RTN","PSDRFT",4,0)
 ;$S(WQTY:18,CQTY:9,1:17) S:PSDTYP=9 QTY=CQTY-OQTY
"RTN","PSDRFT",5,0)
 W ?40,"Recording transaction...  "
"RTN","PSDRFT",6,0)
 D UPDATE W "done."
"RTN","PSDRFT",7,0)
END ;kill variables
"RTN","PSDRFT",8,0)
 K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,LQTY,NAOUN,NODE,NUR2,OK,ORD
"RTN","PSDRFT",9,0)
 K PSD,PSDER,PSDREC,PSDRN,PSDT,PSDTN,QTY,WQTY,X,Y
"RTN","PSDRFT",10,0)
 Q
"RTN","PSDRFT",11,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDRFT",12,0)
 ;updating drug balance in 58.8
"RTN","PSDRFT",13,0)
 F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDRFT",14,0)
 D NOW^%DTC S PSDTN=+%
"RTN","PSDRFT",15,0)
 S BAL=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)-PSDQ
"RTN","PSDRFT",16,0)
 L -^PSD(58.8,NAOU,1,PSDR,0)
"RTN","PSDRFT",17,0)
 ;update order balance
"RTN","PSDRFT",18,0)
 I $G(ORD),$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),PSDTYP'=9 S $P(^(0),"^",22)=$P(^(0),"^",22)-PSDQ,DA=+$P(^(0),"^",17) D:$P(^(0),"^",22)=0  K DA,DIE,DR
"RTN","PSDRFT",19,0)
 .K DIE,DR S DIE="^PSD(58.81,",DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRFT",20,0)
 .K DA,DIE,DR S DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA=+ORD,DA(1)=+PSDR,DA(2)=+NAOU,DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRFT",21,0)
ADD ;find entry number in 58.81
"RTN","PSDRFT",22,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDRFT",23,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDRFT",24,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDRFT",25,0)
 L -^PSD(58.81,0)
"RTN","PSDRFT",26,0)
EDIT ;edit new transaction in 58.81
"RTN","PSDRFT",27,0)
 S ^PSD(58.81,PSDREC,0)=PSDREC_"^"_PSDTYP_"^"_NAOU_"^"_PSDT_"^"_PSDR_"^"_$S(PSDTYP=9:-PSDQ,1:PSDQ)_"^"_$G(NUR1(1))_"^^^"_BAL_"^^^^^^Dose signed out during computer down time^"_$G(PSDPN)_"^"_NAOU_"^^"_$G(ORD)
"RTN","PSDRFT",28,0)
 S ^PSD(58.81,PSDREC,9)=$G(PAT)_"^"_NUR1_"^"_OQTY_"^"_$G(WQTY)_"^"_$G(LQTY)_"^"_$G(NUR2)_"^"_BAL
"RTN","PSDRFT",29,0)
 ;S:PATL ^PSD(58.81,PSDREC,9.5)=PATL
"RTN","PSDRFT",30,0)
 S ^PSD(58.81,PSDREC,"CS")=1
"RTN","PSDRFT",31,0)
 K DA,DIK S DA=PSDREC,DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDRFT",32,0)
 I PSDTYP'=17 D ERR
"RTN","PSDRFT",33,0)
 Q
"RTN","PSDRFT",34,0)
ERR ;err log update
"RTN","PSDRFT",35,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDRFT",36,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDRFT",37,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDRFT",38,0)
 L -^PSD(58.89,0)
"RTN","PSDRFT",39,0)
EDIT9 ;edit error log
"RTN","PSDRFT",40,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_NAOU D ^DIE K DA,DIE,DR
"RTN","PSDRFT",41,0)
 S PHARM1=NUR1,QTY=PSDQ
"RTN","PSDRFT",42,0)
 S:$G(NAOUN)']"" NAOUN=$P($G(^PSD(58.8,NAOU,0)),U) D ^PSDRFM
"RTN","PSDRFT",43,0)
 Q
"RTN","PSDRFU")
0^499^B6085633
"RTN","PSDRFU",1,0)
PSDRFU ;BIR/JPW,LTL-Nurse RF Delayed Dispensing Liquid; 8 Aug 94
"RTN","PSDRFU",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFU",3,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRFU",4,0)
 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRFU",5,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRFU",6,0)
 .S DIR(0)="Y",DIR("A")="Will you be wasting any of this dose"
"RTN","PSDRFU",7,0)
 .W ! D ^DIR K DIR S:$D(DIRUT) PSDOUT=1 Q:Y'=1
"RTN","PSDRFU",8,0)
 .W ?44,"Amount to be wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRFU",9,0)
WIT .S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFU",10,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFU",11,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFU",12,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRFU",13,0)
 .S PSDQ=PSDQ+WQTY ;S DUZ=PSDUZ
"RTN","PSDRFU",14,0)
 S %DT="AEPRX",%DT(0)="-NOW",%DT("A")="Date/time given: "
"RTN","PSDRFU",15,0)
 W ! D ^%DT K %DT G:Y<1 END S PSDT=Y
"RTN","PSDRFU",16,0)
 S DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Nurse that signed out dose: "
"RTN","PSDRFU",17,0)
 W ! D ^DIC K DIC G:Y<1 END S NUR1=+Y,NUR1(1)=DUZ
"RTN","PSDRFU",18,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRFU",19,0)
 D UPDAT^PSDRFT G DRUG^PSDRFS
"RTN","PSDRFU",20,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFU",21,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRFU",22,0)
 Q
"RTN","PSDRFU",23,0)
MSG ;display error message
"RTN","PSDRFU",24,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFU",25,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFU",26,0)
 Q
"RTN","PSDRFV")
0^264^B3244967
"RTN","PSDRFV",1,0)
PSDRFV ;BIR/JPW,LTL-Nurse RF Dispensing review; 8 Aug 94
"RTN","PSDRFV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFV",3,0)
 ;PAT=PATIENT,PSDR=DRUG
"RTN","PSDRFV",4,0)
LOOP N PSD,PSDL,PSDT S (PSDL,PSDA)=0
"RTN","PSDRFV",5,0)
 W !!,"Doses signed out in the last ",$S($G(NAOU(1)):NAOU(1),1:"eight")," hours:"
"RTN","PSDRFV",6,0)
 S PSD=$$FMADD^XLFDT($$NOW^XLFDT,0,-$S($G(NAOU(1)):NAOU(1),1:8))
"RTN","PSDRFV",7,0)
CHEC F  S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD  F  S PSDL=$O(^PSD(58.81,"ACT",PSD,PSDL)) Q:'PSDL  F  S PSDA=$O(^PSD(58.81,"ACT",PSD,PSDL,PSDR,17,PSDA)) Q:'PSDA  D:$P($G(^PSD(58.81,PSDA,9)),U)=$G(PAT)
"RTN","PSDRFV",8,0)
 .S PSDA(2)=$$FMTE^XLFDT(PSD,"2P"),PSDA(3)=PSD
"RTN","PSDRFV",9,0)
 .W !!,PSDA(2),?22,$P($G(^PSD(58.81,PSDA,0)),U,6)," ",$S($P($G(^(0)),U,8)]"":$P($G(^(0)),U,8),1:$P($G(^PSDRUG(PSDR,660)),U,8))
"RTN","PSDRFV",10,0)
 .W:$P($G(^PSD(58.81,PSDA,9)),U,4) " (",$P($G(^(9)),U,4)," WASTED)"
"RTN","PSDRFV",11,0)
 .W:$P($G(^PSD(58.81,PSDA,3)),U,2) " (",$P($G(^(3)),U,2)," RETURNED)"
"RTN","PSDRFV",12,0)
 .W "  ",$P($G(^VA(200,+$P($G(^PSD(58.81,PSDA,0)),U,7),0)),U)
"RTN","PSDRFV",13,0)
 .W:$P($G(^PSD(58.81,PSDA,0)),U,16)]"" !?25,$P($G(^(0)),U,16) S PSDA(4)=$P($G(^(0)),U,7)
"RTN","PSDRFV",14,0)
 .W:PSDL'=$G(NAOU) " {",$P($G(^PSD(58.8,PSDL,0)),U),"}"
"RTN","PSDRFV",15,0)
 .S PSDA(1)=PSDA
"RTN","PSDRFV",16,0)
END Q
"RTN","PSDRFW")
0^266^B22581277
"RTN","PSDRFW",1,0)
PSDRFW ;BIR/JPW,LTL-Nurse RF Dispensing ; 8 Aug 94
"RTN","PSDRFW",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFW",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRFW",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRFW",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRFW",6,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRFW",7,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRFW",8,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRFW",9,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRFW",10,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRFW",11,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRFW",12,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRFW",13,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRFW",14,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRFW",15,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRFW",16,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRFW",17,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRFW",18,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRFW",19,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRFW",20,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRFW",21,0)
PATIENT W !!,"Wastage can only be recorded within "
"RTN","PSDRFW",22,0)
 S NAOU(1)=$S($P($G(^PSD(58.8,NAOU,6)),U,2):$P(^(6),U,2),1:12)
"RTN","PSDRFW",23,0)
 W NAOU(1)," hours after signing out a dose.",!!
"RTN","PSDRFW",24,0)
 W "(except for PCA syringes and Infusions)"
"RTN","PSDRFW",25,0)
 N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRFW",26,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRFW",27,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRFW",28,0)
DRUG ;select drug
"RTN","PSDRFW",29,0)
 N DIR,PSD,PSDA,PSDR,PSDQ
"RTN","PSDRFW",30,0)
 S DIR(0)="FAO^1:40",DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRFW",31,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRFW",32,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRFW",33,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRFW",34,0)
 .S PSD=0
"RTN","PSDRFW",35,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRFW",36,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRFW",37,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRFW",38,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRFW",39,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRFW",40,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRFW",41,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRFW",42,0)
 D ^PSDRFV
"RTN","PSDRFW",43,0)
 I '$G(PSDA(1)) W !!,"No doses signed out",!! G END
"RTN","PSDRFW",44,0)
 S OQTY=$P($G(^PSD(58.81,PSDA(1),0)),U,6)
"RTN","PSDRFW",45,0)
 I $$FMADD^XLFDT(PSDA(3),"",NAOU(1))<$$NOW^XLFDT W !!,"The last dose was signed out at ",PSDA(2),", over ",NAOU(1)," hours ago.",!!,"It is too late to record wastage.",!! G END
"RTN","PSDRFW",46,0)
 I PSDA(4)'=DUZ W !!,"Sorry, only the person that signed out the dose can record delayed wastage.",!! G END
"RTN","PSDRFW",47,0)
 ;S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRFW",48,0)
 ;S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRFW",49,0)
 ;S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRFW",50,0)
 ;W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRFW",51,0)
 ;I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1)
"RTN","PSDRFW",52,0)
QTY S DIR(0)="NA^0:"_OQTY_":2"
"RTN","PSDRFW",53,0)
 S DIR("A")="Amount actually given at "_PSDA(2)_": "
"RTN","PSDRFW",54,0)
 W ! D ^DIR K DIR I $D(DIRUT)!(Y=OQTY) S PSDOUT=1 G END
"RTN","PSDRFW",55,0)
 S PSDQ=Y
"RTN","PSDRFW",56,0)
WASTE I PSDQ'=OQTY D  G:$G(PSDOUT) END
"RTN","PSDRFW",57,0)
 .I (OQTY-PSDQ)>1 D  Q:$G(PSDOUT)  G REA
"RTN","PSDRFW",58,0)
 ..S DIR(0)="N^1:"_(OQTY-PSDQ)_":2",DIR("A")="Amount wasted"
"RTN","PSDRFW",59,0)
 ..S DIR("B")=OQTY-PSDQ D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDRFW",60,0)
 ..S WQTY=Y S:OQTY-WQTY PSDQ(2)=OQTY-WQTY
"RTN","PSDRFW",61,0)
 .S WQTY=$S('$G(PSDQ(1)):OQTY-PSDQ,1:PSDQ)
"RTN","PSDRFW",62,0)
 .W ?55,"Amount wasted: ",WQTY,!
"RTN","PSDRFW",63,0)
REA .S DIR(0)="58.81,15" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDRFW",64,0)
 .S PSDRE=Y
"RTN","PSDRFW",65,0)
WIT .W ! S NUR2=$$WITNESS^XUVERIFY("WITNESS")
"RTN","PSDRFW",66,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRFW",67,0)
 .I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRFW",68,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U))
"RTN","PSDRFW",69,0)
 D EDIT^PSDRFX I $G(PSDQ(2)) S PSDQ=PSDQ(2) D WASTE^PSDRFR
"RTN","PSDRFW",70,0)
END I $G(PSDQ(1)),$G(PSDOUT) S $P(^PSD(58.81,PSDA(1),0),U,6)=PSDQ
"RTN","PSDRFW",71,0)
 W:$G(PSDOUT) !!,"No wastage recorded.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRFW",72,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PAT,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRE,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WQTY,OQTY,PSDQ,WORD,X,Y
"RTN","PSDRFW",73,0)
 Q
"RTN","PSDRFW",74,0)
MSG ;display error message
"RTN","PSDRFW",75,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRFW",76,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRFW",77,0)
 Q
"RTN","PSDRFX")
0^267^B7219196
"RTN","PSDRFX",1,0)
PSDRFX ;B'ham ISC/JPW,LTL - File Dispensing Info ; 13 Dec 93
"RTN","PSDRFX",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFX",3,0)
UPDAT I $G(PSDPN) F JJ=0:0 S JJ=$O(^PSD(58.8,"F",PSDPN,NAOU,PSDR,JJ)) Q:'JJ  S ORD=+JJ
"RTN","PSDRFX",4,0)
 ;$S(WQTY:18,CQTY:9,1:17) S:PSDTYP=9 QTY=CQTY-OQTY
"RTN","PSDRFX",5,0)
 W ?40,"Recording transaction...  "
"RTN","PSDRFX",6,0)
 D UPDATE W "done."
"RTN","PSDRFX",7,0)
END ;kill variables
"RTN","PSDRFX",8,0)
 K %,%DT,%H,%I,BAL,CQTY,DA,DIC,DIE,DIK,DINUM,DLAYGO,DR,JJ,LQTY,NAOUN,NODE,NUR2,OK,ORD
"RTN","PSDRFX",9,0)
 K PSD,PSDER,PSDREC,PSDRN,PSDT,PSDTN,QTY,WQTY,X,Y
"RTN","PSDRFX",10,0)
 Q
"RTN","PSDRFX",11,0)
UPDATE ;update 58.8 and 58.81
"RTN","PSDRFX",12,0)
 ;updating drug balance in 58.8
"RTN","PSDRFX",13,0)
 F  L +^PSD(58.8,NAOU,1,PSDR,0):0 I  Q
"RTN","PSDRFX",14,0)
 D NOW^%DTC S (PSDTN,PSDT)=+%
"RTN","PSDRFX",15,0)
 S BAL=$P(^PSD(58.8,NAOU,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+WQTY
"RTN","PSDRFX",16,0)
 L -^PSD(58.8,NAOU,1,PSDR,0)
"RTN","PSDRFX",17,0)
 S $P(^PSD(58.81,+PSDA(1),3),U,2)=$P($G(^(3)),U,2)+WQTY K WQTY
"RTN","PSDRFX",18,0)
 S $P(^PSD(58.81,+PSDA(1),3),U,3)=$G(PSDRE(1)) G EDIT
"RTN","PSDRFX",19,0)
 ;update order balance
"RTN","PSDRFX",20,0)
 I $G(ORD),$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)),PSDTYP'=9 S $P(^(0),"^",22)=$P(^(0),"^",22)-PSDQ,DA=+$P(^(0),"^",17) D:$P(^(0),"^",22)=0  K DA,DIE,DR
"RTN","PSDRFX",21,0)
 .K DIE,DR S DIE="^PSD(58.81,",DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRFX",22,0)
 .K DA,DIE,DR S DIE="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA=+ORD,DA(1)=+PSDR,DA(2)=+NAOU,DR="10////12;11////1" D ^DIE K DA,DIE,DR
"RTN","PSDRFX",23,0)
ADD ;find entry number in 58.81
"RTN","PSDRFX",24,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDRFX",25,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDRFX",26,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDRFX",27,0)
 L -^PSD(58.81,0)
"RTN","PSDRFX",28,0)
EDIT ;edit transaction in 58.81
"RTN","PSDRFX",29,0)
 S $P(^PSD(58.81,PSDA(1),0),U,16)=$G(PSDRE)
"RTN","PSDRFX",30,0)
 S $P(^PSD(58.81,PSDA(1),0),U,6)=$S($G(WQTY)&('$G(PSDQ(1))):PSDQ+WQTY,'$G(PSDQ(2)):PSDQ,1:OQTY-$G(PSDQ(2)))
"RTN","PSDRFX",31,0)
 S:$G(WQTY) $P(^PSD(58.81,PSDA(1),9),U,4)=WQTY
"RTN","PSDRFX",32,0)
 S $P(^PSD(58.81,PSDA(1),9),U,6)=$G(NUR2)
"RTN","PSDRFX",33,0)
 K DA,DIK S DA=PSDA(1),DIK="^PSD(58.81," D IX^DIK K DA,DIK
"RTN","PSDRFX",34,0)
 ;I PSDTYP'=17 D ERR
"RTN","PSDRFX",35,0)
 Q
"RTN","PSDRFX",36,0)
ERR ;err log update
"RTN","PSDRFX",37,0)
 F  L +^PSD(58.89,0):0 I  Q
"RTN","PSDRFX",38,0)
FIND9 S PSDER=$P(^PSD(58.89,0),"^",3)+1 I $D(^PSD(58.89,PSDER)) S $P(^PSD(58.89,0),"^",3)=PSDER G FIND9
"RTN","PSDRFX",39,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.89,(X,DINUM)=PSDER D ^DIC K DIC,DLAYGO
"RTN","PSDRFX",40,0)
 L -^PSD(58.89,0)
"RTN","PSDRFX",41,0)
EDIT9 ;edit error log
"RTN","PSDRFX",42,0)
 K DA,DIE,DR S DA=PSDER,DIE=58.89,DR="1////"_PSDREC_";2////"_PSDT_";6////"_NAOU D ^DIE K DA,DIE,DR
"RTN","PSDRFX",43,0)
 S PHARM1=NUR1,QTY=PSDQ
"RTN","PSDRFX",44,0)
 S:$G(NAOUN)']"" NAOUN=$P($G(^PSD(58.8,NAOU,0)),U) D ^PSDRFM
"RTN","PSDRFX",45,0)
 Q
"RTN","PSDRFZ")
0^500^B3069199
"RTN","PSDRFZ",1,0)
PSDRFZ ;BIR/JPW,LTL-Nurse RF Delayed Dispensing review; 8 Aug 94
"RTN","PSDRFZ",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRFZ",3,0)
 ;PAT=PATIENT,PSDR=DRUG
"RTN","PSDRFZ",4,0)
LOOP N PSD,PSDL S (PSDL,PSDA)=0
"RTN","PSDRFZ",5,0)
 W !!,"Checking for any transactions since ",$$FMTE^XLFDT(PSDT,"1P")
"RTN","PSDRFZ",6,0)
 S PSD=PSDT
"RTN","PSDRFZ",7,0)
CHEC F  S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD  F  S PSDL=$O(^PSD(58.81,"ACT",PSD,PSDL)) Q:'PSDL  F  S PSDA=$O(^PSD(58.81,"ACT",PSD,PSDL,PSDR,17,PSDA)) Q:'PSDA  D
"RTN","PSDRFZ",8,0)
 .W !!,"You may need to re-adjust the balance because of the following transaction(s)."
"RTN","PSDRFZ",9,0)
 .S PSDA(2)=$$FMTE^XLFDT(PSD,"2P"),PSDA(3)=PSD
"RTN","PSDRFZ",10,0)
 .W !!,PSDA(2),?20,$P($G(^PSD(58.81,PSDA,0)),U,6)," ",$S($P($G(^(0)),U,8)]"":$P($G(^(0)),U,8),1:$P($G(^PSDRUG(PSDR,660)),U,8))
"RTN","PSDRFZ",11,0)
 .W:$P($G(^PSD(58.81,PSDA,9)),U,4) " (",$P($G(^(9)),U,4)," WASTED)"
"RTN","PSDRFZ",12,0)
 .W:$P($G(^PSD(58.81,PSDA,3)),U,2) " (",$P($G(^(3)),U,2)," RETURNED)"
"RTN","PSDRFZ",13,0)
 .W "  ",$P($G(^VA(200,+$P($G(^PSD(58.81,PSDA,0)),U,7),0)),U)
"RTN","PSDRFZ",14,0)
 .W:$P($G(^PSD(58.81,PSDA,0)),U,16)]"" !?25,$P($G(^(0)),U,16) S PSDA(4)=$P($G(^(0)),U,7)
"RTN","PSDRFZ",15,0)
 .W:PSDL'=$G(NAOU) " {",$P($G(^PSD(58.8,PSDL,0)),U),"}"
"RTN","PSDRFZ",16,0)
 .S PSDA(1)=PSDA
"RTN","PSDRFZ",17,0)
END Q
"RTN","PSDRLOG")
0^217^B18309161
"RTN","PSDRLOG",1,0)
PSDRLOG ;BIR/JPW-CS Inspector's Log By Date ; 24 Aug 94
"RTN","PSDRLOG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRLOG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRLOG",4,0)
 ;S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print the CS Inspector's Log.",! K OK Q
"RTN","PSDRLOG",5,0)
 W !,?5,"Inspector's Log by Date Received",!
"RTN","PSDRLOG",6,0)
DATE ;ask date range
"RTN","PSDRLOG",7,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date Received: " D ^%DT I Y<0 S PSDOUT=1 D MSG G END
"RTN","PSDRLOG",8,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y
"RTN","PSDRLOG",9,0)
 S PSDSD=PSDSD-.0001
"RTN","PSDRLOG",10,0)
RET ;ask ret to stk
"RTN","PSDRLOG",11,0)
 K DA,DIR S DIR(0)="Y",DIR("A")="Include Returns to Stock",DIR("B")="YES"
"RTN","PSDRLOG",12,0)
 S DIR("?")="Answer 'YES' or return to include returns to stock, 'NO' to continue without returns, or '^' to quit."
"RTN","PSDRLOG",13,0)
 D ^DIR K DIR I $D(DIRUT) D MSG G END
"RTN","PSDRLOG",14,0)
 S PSDRET=Y G:'PSDRET ASKN
"RTN","PSDRLOG",15,0)
RDATE ;ask return date
"RTN","PSDRLOG",16,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date Returned to Stock: " D ^%DT I Y<0 S PSDOUT=1 D MSG G END
"RTN","PSDRLOG",17,0)
 S PSDRD=Y,PSDRD=PSDRD-.0001
"RTN","PSDRLOG",18,0)
ASKN ;ask naou or group
"RTN","PSDRLOG",19,0)
 W !!,?5,"Select one of the following:",!!,?10,"N",?20,"NAOU (One, Some, or ^ALL)",!,?10,"G",?20,"Group of NAOUs",!
"RTN","PSDRLOG",20,0)
 K DA,DIR,DIRUT S DIR(0)="SOA^N:NAOU;G:Group of NAOUs",DIR("A")="Select Method: "
"RTN","PSDRLOG",21,0)
 S DIR("?",1)="Enter 'N' to select one, some or ^ALL NAOU(s),",DIR("?")="enter 'G' to select a group of NAOUs, or '^' to quit"
"RTN","PSDRLOG",22,0)
 D ^DIR K DIR G:$D(DIRUT) END S SEL=Y K DA,DIC S CNT=0
"RTN","PSDRLOG",23,0)
 I SEL="G" D GROUP G:'$D(PSDG) END G SORT
"RTN","PSDRLOG",24,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)" D ^DIC K DIC Q:Y<0  D
"RTN","PSDRLOG",25,0)
 .S NAOU(+Y)="",CNT=CNT+1
"RTN","PSDRLOG",26,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDRLOG",27,0)
 S:X="^ALL" ALL=1
"RTN","PSDRLOG",28,0)
SORT ;asks sort
"RTN","PSDRLOG",29,0)
 W ! K DA,DIR,DIRUT S DIR(0)="YO",DIR("A")="Do you wish to sort by Inventory Type",DIR("B")="NO"
"RTN","PSDRLOG",30,0)
 S DIR("?")="Answer YES to sort drugs by Inventory Type, NO or <RET> to sort by drug."
"RTN","PSDRLOG",31,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASKN=Y
"RTN","PSDRLOG",32,0)
SORT2 ;asks second sort
"RTN","PSDRLOG",33,0)
 K DA,DIR,DIRUT S DIR(0)="SO^D:DRUG/DISPENSING #S;N:NUMERIC DISPENSING #S"
"RTN","PSDRLOG",34,0)
 S DIR("A")="Select Print Order for Inspector's Log",DIR("?",1)="Select D to print Dispensing Number numerically by drug, within an NAOU,",DIR("?")="select N to print numerically within an NAOU, or '^' to quit."
"RTN","PSDRLOG",35,0)
 D ^DIR K DIR G:$D(DIRUT) END S ASK=Y
"RTN","PSDRLOG",36,0)
DEV ;ask device and queue info
"RTN","PSDRLOG",37,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDRLOG",38,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDRLOG",39,0)
 I $D(IO("Q")) K IO("Q") S PSDIO=ION,ZTIO="" K ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDRLOG1",ZTDESC="Compile Narcotic Inspector Log By Date" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDRLOG",40,0)
 U IO G START^PSDRLOG1
"RTN","PSDRLOG",41,0)
END K %,%DT,%H,%I,%ZIS,ALL,ASK,ASKN,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,JJ,KK,NAOU,NODE,NODE1,NODE3,NODE7,NUM
"RTN","PSDRLOG",42,0)
 K OK,PSD,PSDA,PSDATE,PSDCNT,PSDDT,PSDED,PSDG,PSDIO,PSDOK,PSDOUT,PSDN,PSDNA,PSDPN,PSDR,PSDRD,PSDRET,PSDRN,PSDSD,PSDST,PSDTR,PSDTYP
"RTN","PSDRLOG",43,0)
 K QTY,SEL,STAT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRLOG",44,0)
 K ^TMP("PSDRLOG",$J) D ^%ZISC
"RTN","PSDRLOG",45,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRLOG",46,0)
 Q
"RTN","PSDRLOG",47,0)
GROUP ;select group of naous
"RTN","PSDRLOG",48,0)
 K DA,DIC F  S DIC=58.2,DIC("A")="Select NAOU INVENTORY GROUP NAME: ",DIC(0)="QEA",DIC("S")="I $S($D(^PSI(58.2,""CS"",+Y)):1,1:0)" D ^DIC K DIC Q:Y<0  S PSDG(+Y)=""
"RTN","PSDRLOG",49,0)
 Q
"RTN","PSDRLOG",50,0)
SAVE S (ZTSAVE("PSDIO"),ZTSAVE("CNT"),ZTSAVE("PSDSITE"),ZTSAVE("ASK"),ZTSAVE("ASKN"))=""
"RTN","PSDRLOG",51,0)
 S:$D(PSDG) ZTSAVE("PSDG(")="" S:$D(NAOU) ZTSAVE("NAOU(")="" S:$D(ALL) ZTSAVE("ALL")=""
"RTN","PSDRLOG",52,0)
 S:$D(PSDSD) ZTSAVE("PSDSD")=""
"RTN","PSDRLOG",53,0)
 S:$D(PSDATE) ZTSAVE("PSDATE")=""
"RTN","PSDRLOG",54,0)
 S:$D(PSDRET) ZTSAVE("PSDRET")=""
"RTN","PSDRLOG",55,0)
 S:$D(PSDRD) ZTSAVE("PSDRD")=""
"RTN","PSDRLOG",56,0)
 Q
"RTN","PSDRLOG",57,0)
MSG W !!,"No action taken.",!!
"RTN","PSDRLOG",58,0)
 Q
"RTN","PSDRLOG1")
0^218^B17919515
"RTN","PSDRLOG1",1,0)
PSDRLOG1 ;BIR/JPW-CS Inspector's Log By Date (cont'd) ; 24 Aug 94
"RTN","PSDRLOG1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRLOG1",3,0)
START ;compile data
"RTN","PSDRLOG1",4,0)
 K ^TMP("PSDRLOG",$J) S (FLAG,PSDCNT,PSDOUT)=0,PSDTR=""
"RTN","PSDRLOG1",5,0)
 I $D(PSDG) F PSD=0:0 S PSD=$O(PSDG(PSD)) Q:'PSD  F PSDN=0:0 S PSDN=$O(^PSI(58.2,PSD,3,PSDN)) Q:'PSDN  I $D(^PSD(58.8,PSDN,0)),'$P(^(0),"^",7),$P(^(0),"^",3)=+PSDSITE S NAOU(PSDN)="",CNT=CNT+1
"RTN","PSDRLOG1",6,0)
 I $D(ALL) F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$P(^(0),"^",2)="N",$P(^(0),"^",3)=+PSDSITE,'$P(^(0),"^",7) S NAOU(+PSD)=""
"RTN","PSDRLOG1",7,0)
 S PSD="" F  S PSD=$O(NAOU(PSD)) Q:PSD=""!(PSDOUT)  F PSDN=PSDSD:0 S PSDN=$O(^PSD(58.81,"AK",PSDN)) Q:'PSDN!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"AK",PSDN,PSD,PSDA)) Q:'PSDA!(PSDOUT)  D LOOP
"RTN","PSDRLOG1",8,0)
 I $G(PSDRET) F PSDN=PSDRD:0 S PSDN=$O(^PSD(58.81,"ACT",PSDN)) Q:'PSDN!(PSDOUT)  F JJ=0:0 S JJ=$O(^PSD(58.81,"ACT",PSDN,JJ)) Q:'JJ!(PSDOUT)  D
"RTN","PSDRLOG1",9,0)
 .F KK=0:0 S KK=$O(^PSD(58.81,"ACT",PSDN,JJ,KK)) Q:'KK!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSDN,JJ,KK,3,PSDA)) Q:'PSDA!(PSDOUT)  S FLAG=3 D LOOP
"RTN","PSDRLOG1",10,0)
 F PSDN=PSDSD:0 S PSDN=$O(^PSD(58.81,"ATRN",PSDN)) Q:'PSDN!(PSDOUT)  F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ATRN",PSDN,PSDA)) Q:'PSDA!(PSDOUT)  S FLAG=1 D LOOP
"RTN","PSDRLOG1",11,0)
 G:$D(ZTQUEUED) PRTQUE
"RTN","PSDRLOG1",12,0)
 I ASKN G PRINT^PSDRLOG3
"RTN","PSDRLOG1",13,0)
 G PRINT^PSDRLOG2
"RTN","PSDRLOG1",14,0)
 Q
"RTN","PSDRLOG1",15,0)
PRTQUE ;queues print after compile
"RTN","PSDRLOG1",16,0)
 K ZTSAVE,ZTIO S ZTIO=PSDIO,ZTRTN=$S(ASKN:"PRINT^PSDRLOG3",1:"PRINT^PSDRLOG2"),ZTDESC="Print Narcotic Inspector Log",ZTDTH=$H
"RTN","PSDRLOG1",17,0)
 S (ZTSAVE("^TMP(""PSDRLOG"",$J,"),ZTSAVE("CNT"),ZTSAVE("ASK"),ZTSAVE("ASKN"),ZTSAVE("PSDRET"))=""
"RTN","PSDRLOG1",18,0)
 D ^%ZTLOAD K ^TMP("PSDRLOG",$J),ZTSK
"RTN","PSDRLOG1",19,0)
END K %,%H,%I,%ZIS,ALL,ASK,ASKN,CNT,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,JJ,KK,LNUM,NAOU,NODE,NODE1,NODE3,NODE7,NUM
"RTN","PSDRLOG1",20,0)
 K OK,PSD,PSDA,PSDATE,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDOUT,PSDN,PSDNA,PSDR,PSDRD,PSDRET,PSDRN,PSDSD,PSDST,PSDTR,PSDTYP
"RTN","PSDRLOG1",21,0)
 K QTY,SEL,STAT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRLOG1",22,0)
 K ^TMP("PSDRLOG",$J) D ^%ZISC
"RTN","PSDRLOG1",23,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRLOG1",24,0)
 Q
"RTN","PSDRLOG1",25,0)
LOOP ;starts drug loop
"RTN","PSDRLOG1",26,0)
 Q:'$D(^PSD(58.81,+PSDA,0))  S NODE=^PSD(58.81,PSDA,0)
"RTN","PSDRLOG1",27,0)
 S PSDR=+$P(NODE,"^",5),STAT=+$P(NODE,"^",11),PSDTYP=+$P(NODE,"^",2)
"RTN","PSDRLOG1",28,0)
 S NODE1=$G(^PSD(58.81,PSDA,1)),NODE7=$G(^PSD(58.81,PSDA,7)),NODE3=$G(^PSD(58.81,PSDA,3))
"RTN","PSDRLOG1",29,0)
 S:PSDTYP=5 FLAG=2
"RTN","PSDRLOG1",30,0)
 I FLAG S PSD=+$P(NODE,"^",18) Q:'$D(NAOU(+PSD))
"RTN","PSDRLOG1",31,0)
 S:FLAG=1 PSDTR=+$P(NODE7,"^",3),PSDTR=$S($P($G(^PSD(58.8,PSDTR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRLOG1",32,0)
 S PSDNA=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSD)
"RTN","PSDRLOG1",33,0)
 S PSDOK=$S(FLAG=3:"#",FLAG=2:"**",FLAG=1:"*",1:"")
"RTN","PSDRLOG1",34,0)
 S PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDR)
"RTN","PSDRLOG1",35,0)
 S QTY=$S(FLAG=3:+$P(NODE3,"^",2),FLAG=1:+$P(NODE7,"^",7),1:+$P(NODE1,"^",8))
"RTN","PSDRLOG1",36,0)
 S NUM=$S($P(NODE,"^",17)]"":$P(NODE,"^",17),1:"UNKNOWN"),EXP=$P(NODE,"^",15),EXPD="" I EXP S Y=EXP X ^DD("DD") S EXPD=Y
"RTN","PSDRLOG1",37,0)
 S Y=$E(PSDN,1,7) X ^DD("DD") S PSDDT=Y
"RTN","PSDRLOG1",38,0)
 S PSDCNT=PSDCNT+1,FLAG=0
"RTN","PSDRLOG1",39,0)
 I ASKN D LOOP0 Q
"RTN","PSDRLOG1",40,0)
SET ;sets ^tmp
"RTN","PSDRLOG1",41,0)
 S:ASK="D" ^TMP("PSDRLOG",$J,PSDNA,PSDRN,NUM,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK_"^"_PSDTR
"RTN","PSDRLOG1",42,0)
 S:ASK="N" ^TMP("PSDRLOG",$J,PSDNA,NUM,PSDRN,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK_"^"_PSDTR
"RTN","PSDRLOG1",43,0)
 Q
"RTN","PSDRLOG1",44,0)
LOOP0 ;sets sort for inventory type sort
"RTN","PSDRLOG1",45,0)
 I '$O(^PSD(58.8,PSD,1,PSDR,2,0)) S TYPN="ZZ** NO INVENTORY TYPE DATA **" D LOOP1 Q
"RTN","PSDRLOG1",46,0)
 ;F NAOU=0:0 S NAOU=$O(NAOU(NAOU)) Q:'NAOU  
"RTN","PSDRLOG1",47,0)
 F TYP=0:0 S TYP=$O(^PSD(58.8,+PSD,1,PSDR,2,TYP)) Q:'TYP  S TYPN=$S($P($G(^PSI(58.16,+TYP,0)),"^")]"":$P(^(0),"^"),1:"TYPE NAME MISSING") D LOOP1
"RTN","PSDRLOG1",48,0)
 Q
"RTN","PSDRLOG1",49,0)
LOOP1 ;sets inv typ ^tmp
"RTN","PSDRLOG1",50,0)
 ;S:ASK="D" ^TMP("PSDRLOG",$J,PSDNA,TYPN,PSDRN,NUM,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK_"^"_PSDTR
"RTN","PSDRLOG1",51,0)
 S:'$G(TYP) TYP=999999
"RTN","PSDRLOG1",52,0)
 D:ASK="D"
"RTN","PSDRLOG1",53,0)
 .S ^TMP("PSDRLOG",$J,"B",PSDNA,PSD)="",^TMP("PSDLOG",$J,PSD,+TYP)=0
"RTN","PSDRLOG1",54,0)
 .S ^TMP("PSDRLOG",$J,PSD,"B",TYPN,+TYP)=""
"RTN","PSDRLOG1",55,0)
 .S ^TMP("PSDRLOG",$J,PSD,+TYP,PSDR,NUM,PSDCNT)=QTY_U_PSDDT_U_EXPD_U_PSDOK
"RTN","PSDRLOG1",56,0)
 .S ^TMP("PSDRLOG",$J,PSD,+TYP,"B",PSDRN,PSDR)=""
"RTN","PSDRLOG1",57,0)
 ;S:ASK="N" ^TMP("PSDRLOG",$J,PSDNA,TYPN,NUM,PSDRN,PSDCNT)=QTY_"^"_PSDDT_"^"_EXPD_"^"_PSDOK_"^"_PSDTR
"RTN","PSDRLOG1",58,0)
 D:ASK="N"
"RTN","PSDRLOG1",59,0)
 .S ^TMP("PSDRLOG",$J,"B",PSDNA,PSD)="",^TMP("PSDRLOG",$J,PSD,+TYP)=0
"RTN","PSDRLOG1",60,0)
 .S ^TMP("PSDRLOG",$J,PSD,"B",TYPN,+TYP)=""
"RTN","PSDRLOG1",61,0)
 .S ^TMP("PSDRLOG",$J,PSD,+TYP,NUM,PSDR,PSDCNT)=QTY_U_PSDDT_U_EXPD_U_PSDOK_U_PSDTR_U_PSDRN
"RTN","PSDRLOG1",62,0)
 Q
"RTN","PSDRLOG2")
0^219^B17243309
"RTN","PSDRLOG2",1,0)
PSDRLOG2 ;BIR/JPW-Inspector's Log By Date (cont'd) ; 30 Aug 94
"RTN","PSDRLOG2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRLOG2",3,0)
PRINT ;print inspector's log by naou, drug and green sheet #
"RTN","PSDRLOG2",4,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDRLOG2",5,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDRLOG",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS FOR INSPECTION  ****",! G DONE
"RTN","PSDRLOG2",6,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDRLOG",$J,NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y D  Q:PSDOUT  D PRT
"RTN","PSDRLOG2",7,0)
 .I ASKN D LOOP2 Q
"RTN","PSDRLOG2",8,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDRLOG",$J,NAOU,PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG2",9,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y
"RTN","PSDRLOG2",10,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDRLOG",$J,NAOU,PSDRN,NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDRLOG",$J,NAOU,PSDRN,NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D
"RTN","PSDRLOG2",11,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y
"RTN","PSDRLOG2",12,0)
 ...S NODE=$G(^TMP("PSDRLOG",$J,NAOU,PSDRN,NUM,PSDCNT))
"RTN","PSDRLOG2",13,0)
 ...W ! W:$P(NODE,"^",4)["*" $P(NODE,U,4)
"RTN","PSDRLOG2",14,0)
 ...W ?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55
"RTN","PSDRLOG2",15,0)
 ...W:$P(NODE,U,4)'="#" $P(NODE,"^",2)
"RTN","PSDRLOG2",16,0)
 ...W ?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3)
"RTN","PSDRLOG2",17,0)
 ...W:$P(NODE,U,4)="#" ?100,$P(NODE,U,2) W ?118,"____________",!
"RTN","PSDRLOG2",18,0)
 ...W:$P(NODE,"^",5)]"" ?13,"(TRANSFERRED TO "_$P(NODE,"^",5)_")",!
"RTN","PSDRLOG2",19,0)
 ...S LNUM=$Y
"RTN","PSDRLOG2",20,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDRLOG2",21,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDRLOG2",22,0)
END K %,%H,%I,%ZIS,ALL,ANS,ASK,ASKN,CNT,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,JJ,KK,LN,LOOP,LNUM,LOT,MFG,NAOU,NODE,NODE1,NODE3,NODE7,NUM
"RTN","PSDRLOG2",23,0)
 K OK,ORD,ORDN,PG,PSD,PSDA,PSDATE,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDN,PSDNA,PSDOUT,PSDR,PSDRD,PSDRET,PSDRN,PSDSD,PSDST,PSDTR,PSDTYP,QTY,REQD,REQDT,RPDT,RQTY
"RTN","PSDRLOG2",24,0)
 K SEL,STAT,STATN,TEXT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRLOG2",25,0)
 K ^TMP("PSDRLOG",$J) D ^%ZISC
"RTN","PSDRLOG2",26,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRLOG2",27,0)
 Q
"RTN","PSDRLOG2",28,0)
HDR ;header for log
"RTN","PSDRLOG2",29,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDRLOG2",30,0)
 S PG=PG+1 W:$Y @IOF W !,?42,"Inspector's Log for Controlled Substances",?120,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDRLOG2",31,0)
 W !,?57,"DATE",?71,"QTY"
"RTN","PSDRLOG2",32,0)
 W !,"DISP #",?13,"DRUG",?55,"RECEIVED",?68,"RECEIVED",?85,"EXP DATE"
"RTN","PSDRLOG2",33,0)
 W:$G(PSDRET) ?100,"DATE RETURNED" W ?118,"NAME/DATE"
"RTN","PSDRLOG2",34,0)
 W !,LN,!
"RTN","PSDRLOG2",35,0)
 Q
"RTN","PSDRLOG2",36,0)
LOOP2 ;print inv typ loop
"RTN","PSDRLOG2",37,0)
 S TYPN="" F  S TYPN=$O(^TMP("PSDRLOG",$J,NAOU,TYPN)) Q:TYPN=""!(PSDOUT)  W !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y D
"RTN","PSDRLOG2",38,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDRLOG",$J,NAOU,TYPN,PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG2",39,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDRLOG2",40,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDRLOG",$J,NAOU,TYPN,PSDRN,NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDRLOG",$J,NAOU,TYPN,PSDRN,NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG2",41,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",TYPN,! S LNUM=$Y
"RTN","PSDRLOG2",42,0)
 ...S NODE=$G(^TMP("PSDRLOG",$J,NAOU,TYPN,PSDRN,NUM,PSDCNT))
"RTN","PSDRLOG2",43,0)
 ...W !,$P(NODE,"^",4),?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55,$P(NODE,"^",2),?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3),?100,"____________",?118,"____________",!
"RTN","PSDRLOG2",44,0)
 ...W:$P(NODE,"^",5)]"" ?13,"(TRANSFERRED TO "_$P(NODE,"^",5)_")",!
"RTN","PSDRLOG2",45,0)
 ...S LNUM=$Y
"RTN","PSDRLOG2",46,0)
 Q
"RTN","PSDRLOG2",47,0)
PRT ;
"RTN","PSDRLOG2",48,0)
 I LNUM<IOSL-7 F JJ=LNUM:1:IOSL-7 W !
"RTN","PSDRLOG2",49,0)
 W !,LN,!,"*  - Transferred to another NAOU",!,"** - Received from another NAOU",!
"RTN","PSDRLOG2",50,0)
 Q
"RTN","PSDRLOG3")
0^220^B19919761
"RTN","PSDRLOG3",1,0)
PSDRLOG3 ;BIR/JPW,LTL-Inspector's Log By Date (cont'd) ; 31 May 95
"RTN","PSDRLOG3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRLOG3",3,0)
PRINT ;print inspector's log by naou, drug and green sheet #
"RTN","PSDRLOG3",4,0)
 S (PG,PSDOUT,NAOU)=0 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDRLOG3",5,0)
 K LN S $P(LN,"-",132)="" I '$D(^TMP("PSDRLOG",$J)) D HDR W !!,?45,"****  NO PENDING NARCOTIC ORDERS FOR INSPECTION  ****",! G DONE
"RTN","PSDRLOG3",6,0)
 S NAOU="" F  S NAOU=$O(^TMP("PSDRLOG",$J,"B",NAOU)) Q:NAOU=""!(PSDOUT)  D HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! S LNUM=$Y D LOOP2 Q:PSDOUT  D PRT
"RTN","PSDRLOG3",7,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDRLOG3",8,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDRLOG3",9,0)
END K %,%H,%I,%ZIS,ALL,ANS,ASK,ASKN,CNT,COMM,DA,DIC,DIE,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,EXP,EXPD,FLAG,JJ,KK,LN,LOOP,LNUM,LOT,MFG,NAOU,NODE,NODE1,NODE3,NODE7,NUM
"RTN","PSDRLOG3",10,0)
 K OK,ORD,ORDN,PG,PSD,PSDA,PSDATE,PSDCNT,PSDDT,PSDG,PSDIO,PSDOK,PSDN,PSDNA,PSDOUT,PSDR,PSDRD,PSDRET,PSDRN,PSDSD,PSDST,PSDTR,PSDTYP,QTY,REQD,REQDT,RPDT,RQTY
"RTN","PSDRLOG3",11,0)
 K SEL,STAT,STATN,TEXT,TYP,TYPN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRLOG3",12,0)
 K ^TMP("PSDRLOG",$J) D ^%ZISC
"RTN","PSDRLOG3",13,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRLOG3",14,0)
 Q
"RTN","PSDRLOG3",15,0)
HDR ;header for log
"RTN","PSDRLOG3",16,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDRLOG3",17,0)
 S PG=PG+1 W:$Y @IOF W !,?42,"Inspector's Log for Controlled Substances",?120,"Page: ",PG,!,?52,RPDT,!
"RTN","PSDRLOG3",18,0)
 W !,?57,"DATE",?71,"QTY"
"RTN","PSDRLOG3",19,0)
 W !,"DISP #",?13,"DRUG",?55,"RECEIVED",?68,"RECEIVED",?85,"EXP DATE"
"RTN","PSDRLOG3",20,0)
 W:$G(PSDRET) ?100,"DATE RETURNED" W ?118,"NAME/DATE"
"RTN","PSDRLOG3",21,0)
 W !,LN,!
"RTN","PSDRLOG3",22,0)
 Q
"RTN","PSDRLOG3",23,0)
LOOP2 ;print inv typ loop
"RTN","PSDRLOG3",24,0)
 S NAOU(1)=$O(^TMP("PSDRLOG",$J,"B",NAOU,0))
"RTN","PSDRLOG3",25,0)
 S TYPN="" F  S TYPN=$O(^TMP("PSDRLOG",$J,NAOU(1),"B",TYPN)) Q:TYPN=""!(PSDOUT)  W !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y D
"RTN","PSDRLOG3",26,0)
 .S TYPN(1)=$O(^TMP("PSDRLOG",$J,NAOU(1),"B",TYPN,0))
"RTN","PSDRLOG3",27,0)
 .I ASK="N" D  Q
"RTN","PSDRLOG3",28,0)
 ..S NUM=0
"RTN","PSDRLOG3",29,0)
 ..F  S NUM=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),NUM)) Q:NUM=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG3",30,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !?2,"=> NAOU: ",NAOU,!!?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDRLOG3",31,0)
 ...S PSDR=0
"RTN","PSDRLOG3",32,0)
 ...F  S PSDR=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),NUM,PSDR)) Q:'PSDR!(PSDOUT)  S PSDCNT=0 F  S PSDCNT=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),NUM,PSDR,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG3",33,0)
 ....I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !?2,"=> NAOU: ",NAOU,!!?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDRLOG3",34,0)
 ....S NODE=$G(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),NUM,PSDR,PSDCNT))
"RTN","PSDRLOG3",35,0)
 ....W !,$P(NODE,U,4),?2,NUM,?13,$P(NODE,U,6),?55,$P(NODE,U,2),?70,$J($P(NODE,U),6),?85,$P(NODE,U,3),?100,"____________",?118,"____________",!
"RTN","PSDRLOG3",36,0)
 ....W:$P(NODE,U,5)]"" ?13,"(TRANSFERRED TO ",$P(NODE,U,5),")",! S LNUM=$Y
"RTN","PSDRLOG3",37,0)
 .S PSDRN="" F  S PSDRN=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),"B",PSDRN)) Q:PSDRN=""!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG3",38,0)
 ..I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",$S($E(TYPN,1,2)="ZZ":$E(TYPN,3,99),1:TYPN),! S LNUM=$Y
"RTN","PSDRLOG3",39,0)
 ..S PSDRN(1)=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),"B",PSDRN,0))
"RTN","PSDRLOG3",40,0)
 ..S NUM="" F  S NUM=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM)) Q:NUM=""!(PSDOUT)  F PSDCNT=0:0 S PSDCNT=$O(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM,PSDCNT)) Q:'PSDCNT!(PSDOUT)  D  Q:PSDOUT
"RTN","PSDRLOG3",41,0)
 ...I $Y+8>IOSL D PRT,HDR Q:PSDOUT  W !,?2,"=> NAOU: ",NAOU,! W:ASKN !,?4,"=> INVENTORY TYPE: ",TYPN,! S LNUM=$Y
"RTN","PSDRLOG3",42,0)
 ...S NODE=$G(^TMP("PSDRLOG",$J,NAOU(1),TYPN(1),PSDRN(1),NUM,PSDCNT))
"RTN","PSDRLOG3",43,0)
 ...W !,$P(NODE,"^",4),?2,$S(ASK="N":PSDRN,1:NUM),?13,$S(ASK="D":PSDRN,1:NUM),?55,$P(NODE,"^",2),?70,$J($P(NODE,"^"),6),?85,$P(NODE,"^",3),?100,"____________",?118,"____________",!
"RTN","PSDRLOG3",44,0)
 ...W:$P(NODE,"^",5)]"" ?13,"(TRANSFERRED TO "_$P(NODE,"^",5)_")",!
"RTN","PSDRLOG3",45,0)
 ...S LNUM=$Y
"RTN","PSDRLOG3",46,0)
 Q
"RTN","PSDRLOG3",47,0)
PRT ;
"RTN","PSDRLOG3",48,0)
 I LNUM<IOSL-7 F JJ=LNUM:1:IOSL-7 W !
"RTN","PSDRLOG3",49,0)
 W LN,!,"*  - Transferred to another NAOU",!,"** - Received from another NAOU",!
"RTN","PSDRLOG3",50,0)
 Q
"RTN","PSDRPGS")
0^221^B11947150
"RTN","PSDRPGS",1,0)
PSDRPGS ;BIR/JPW-Reprint Green Sheet (VA FORM 10-2638) ; 29 Aug 94
"RTN","PSDRPGS",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRPGS",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRPGS",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDRPGS",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"reprint Green Sheets.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDRPGS",6,0)
ASKD ;ask dispensing location
"RTN","PSDRPGS",7,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDRPGS",8,0)
 I $P(PSDSITE,U,5) S PRT=+$P($G(^PSD(58.8,+PSDS,2)),"^",6),ASK=+$G(^(2.5)) G GS1
"RTN","PSDRPGS",9,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDRPGS",10,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDRPGS",11,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PRT=+$P($G(^PSD(58.8,+PSDS,2)),"^",6),ASK=+$G(^PSD(58.8,+PSDS,2.5)),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDRPGS",12,0)
GS1 ;ask gs # range
"RTN","PSDRPGS",13,0)
 W !!,"You may enter a Green Sheet # list and/or a Green Sheet # range.",!
"RTN","PSDRPGS",14,0)
 W "NOTE: This response must be a list or range, e.g., 1,3,5 or 2-4,8.",!
"RTN","PSDRPGS",15,0)
 K DA,DIR,DIRUT S DIR(0)="LOA^0:999999999",DIR("A")="Select Green Sheet #(s): "
"RTN","PSDRPGS",16,0)
 D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRPGS",17,0)
 S PSD1="" F  S PSD1=$O(Y(PSD1)) Q:PSD1=""  S:$D(Y(PSD1)) PSD1(PSD1)=Y(PSD1) K Y(PSD1)
"RTN","PSDRPGS",18,0)
DEV ;ask device and queue info
"RTN","PSDRPGS",19,0)
 W $C(7),!!,"This report now prints on plain paper.",!,"Please check your printer before starting this report.",!!,"You may queue this report to print at a later time.",!!
"RTN","PSDRPGS",20,0)
 S PSDCPI=10
"RTN","PSDRPGS",21,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",8),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDRPGS",22,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="Q",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDRPGS",23,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDRPGS2",ZTDESC="Reprint Green Sheets (VA FORM 10-2638)" D SAVE D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDRPGS",24,0)
 U IO G START^PSDRPGS2
"RTN","PSDRPGS",25,0)
END K %ZIS,ANS,ASK,C,CNT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,LINE,LOT,NAOU,NAOUN,NODE,NODE1,PSDW
"RTN","PSDRPGS",26,0)
 K OK,ORD,ORDN,POP,PRT,PSD,PSD1,PSDA,PSDBY,PSDBYN,PSDCNT,PSDDT,PSDEV,PSDOUT,PSDCPI,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDTR,PSDTRN,REPRINT,QTY,SITE,STAT,TRANS,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRPGS",27,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRPGS",28,0)
 Q
"RTN","PSDRPGS",29,0)
SAVE ;save var
"RTN","PSDRPGS",30,0)
 S (ZTSAVE("ASK"),ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDCPI"))="" S:$D(REPRINT) ZTSAVE("REPRINT")=""
"RTN","PSDRPGS",31,0)
 S ZTSAVE("PSD1(")=""
"RTN","PSDRPGS",32,0)
 Q
"RTN","PSDRPGS1")
0^222^B11631175
"RTN","PSDRPGS1",1,0)
PSDRPGS1 ;BIR/JPW-Reprint Green Sheet (VA FORM 10-2638) cont'd ; 21 Jun 94
"RTN","PSDRPGS1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRPGS1",3,0)
START ;loop through transactions
"RTN","PSDRPGS1",4,0)
 ;second call to %ZIS to restore varibles for open execute
"RTN","PSDRPGS1",5,0)
 I $D(ZTQUEUED) S IOP=ION D ^%ZIS U IO
"RTN","PSDRPGS1",6,0)
 S PSD=$P(PSDS,"^",2),PSDCNT=1
"RTN","PSDRPGS1",7,0)
 S PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDRPGS1",8,0)
END K %ZIS,ANS,ASK,C,CNT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,LINE,LOT,NAOU,NAOUN,NODE,NODE1
"RTN","PSDRPGS1",9,0)
 K OK,ORD,ORDN,POP,PRT,PSD,PSD1,PSDA,PSDBY,PSDBYN,PSDCNT,PSDDT,PSDEV,PSDOUT,PSDCPI,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDTR,PSDTRN,REPRINT,QTY,SITE,STAT,TRANS,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRPGS1",10,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRPGS1",11,0)
 Q
"RTN","PSDRPGS1",12,0)
LOOP S PSDPN=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSDPN="" S PSDCNT=1 Q
"RTN","PSDRPGS1",13,0)
 S PSDA=$O(^PSD(58.81,"D",PSDPN,0)) D SET
"RTN","PSDRPGS1",14,0)
 G LOOP
"RTN","PSDRPGS1",15,0)
 Q
"RTN","PSDRPGS1",16,0)
SET ;set data for printing
"RTN","PSDRPGS1",17,0)
 K TRANS,PSDTR S PSDOUT=0
"RTN","PSDRPGS1",18,0)
 Q:'$D(^PSD(58.81,+PSDA,0))  S NODE=^PSD(58.81,+PSDA,0)
"RTN","PSDRPGS1",19,0)
 Q:+$P(NODE,"^",3)'=+PSDS  I (+$P(NODE,"^",11)>4)&(+$P(NODE,"^",11)'=10)&(+$P(NODE,U,11)'=13) Q
"RTN","PSDRPGS1",20,0)
 I +$P($G(^PSD(58.81,PSDA,"CS")),"^",4)  S REPRINT=1
"RTN","PSDRPGS1",21,0)
 S PSD=+$P(NODE,"^",18)
"RTN","PSDRPGS1",22,0)
 S NAOUN=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",23,0)
 S PSDR=$P(NODE,"^",5),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",24,0)
 S PSDT=$P(NODE,"^",4)
"RTN","PSDRPGS1",25,0)
 S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDRPGS1",26,0)
 S LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15),EXPD="" I EXP S Y=$E(EXP,1,7) X ^DD("DD") S EXPD=Y
"RTN","PSDRPGS1",27,0)
 S (PSDBY,PSDBYN,ORD,ORDN)=""
"RTN","PSDRPGS1",28,0)
 I $D(^PSD(58.81,PSDA,1)) S NODE1=^(1),PSDBY=$P(NODE1,"^"),ORD=$P(NODE1,"^",7)
"RTN","PSDRPGS1",29,0)
 S:ORD ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",30,0)
 S:PSDBY PSDBYN=$S($P($G(^VA(200,PSDBY,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",31,0)
 S CNT=1,PSDTR(CNT)=+$O(^PSD(58.81,"AE",PSDA,0)) D:PSDTR(CNT)  G:PSDOUT PRINT
"RTN","PSDRPGS1",32,0)
 .S TRANS=1
"RTN","PSDRPGS1",33,0)
 .D SETT Q:PSDOUT
"RTN","PSDRPGS1",34,0)
 .S NAOU=+$P($G(^PSD(58.81,PSDTR(CNT),0)),"^",18)
"RTN","PSDRPGS1",35,0)
 .S:NAOU $P(PSDTR(CNT),"^",2)=$S($P($G(^PSD(58.8,+NAOU,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",36,0)
PRINT ;print green sheet
"RTN","PSDRPGS1",37,0)
 I ORDN]"",ORDN'="UNKNOWN" S ORDN=$P(ORDN,",")_","_$E($P(ORDN,",",2))
"RTN","PSDRPGS1",38,0)
 I PSDBYN]"",PSDBYN'="UNKNOWN" S PSDBYN=$P(PSDBYN,",")_","_$E($P(PSDBYN,",",2))
"RTN","PSDRPGS1",39,0)
 S PSDDT="" I PSDT S PSDDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3)
"RTN","PSDRPGS1",40,0)
 W:$Y @IOF W:$D(REPRINT) ?10,"** REPRINT **" I '$D(TRANS) W ?33,NAOUN
"RTN","PSDRPGS1",41,0)
 W:$D(TRANS) "** Transferred to: ",$S($P(PSDTR(CNT),"^",2)]"":$P(PSDTR(CNT),"^",2),1:$P(PSDTR(CNT-1),"^",2))," **"
"RTN","PSDRPGS1",42,0)
 D A7BAR^PSDPGS1 I $D(A7PRT) W @A7BAR1,PSDPN,@A7BAR0 ;DALISC/JRR
"RTN","PSDRPGS1",43,0)
 W !!,?56,PSDPN,!!,?6,PSDRN,?36,EXPD,?65,QTY,!!,?6,LOT,?20,ORDN,?42,PSDBYN,?60,$E(NAOUN,1,6),?67,PSDDT,!
"RTN","PSDRPGS1",44,0)
 F LINE=1:1:50 W !
"RTN","PSDRPGS1",45,0)
 W:ASK !
"RTN","PSDRPGS1",46,0)
 W ?6,PSDRN,?61,PSDPN,!
"RTN","PSDRPGS1",47,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="103////1" D ^DIE K DA,DIE,DR
"RTN","PSDRPGS1",48,0)
 Q
"RTN","PSDRPGS1",49,0)
SETT ;set trans naous
"RTN","PSDRPGS1",50,0)
 S PSDTRN=+$O(^PSD(58.81,"AE",+PSDTR(CNT),0)) Q:'PSDTRN
"RTN","PSDRPGS1",51,0)
 S NAOU=$P($G(^PSD(58.81,+PSDTRN,0)),"^",18) I 'NAOU S PSDOUT=1 Q
"RTN","PSDRPGS1",52,0)
 S:NAOU $P(PSDTR(CNT),"^",2)=$S($P($G(^PSD(58.8,+NAOU,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS1",53,0)
 I $O(^PSD(58.81,"AE",+PSDTRN,0)) S CNT=CNT+1,PSDTR(CNT)=$O(^PSD(58.81,"AE",+PSDTRN,0)) G SETT
"RTN","PSDRPGS1",54,0)
 Q
"RTN","PSDRPGS2")
0^223^B20238927
"RTN","PSDRPGS2",1,0)
PSDRPGS2 ;BIR/JPW,LTL-Reprint Green Sheet (VA FORM 10-2638) cont'd ; 21 Jun 94
"RTN","PSDRPGS2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRPGS2",3,0)
START ;loop through transactions
"RTN","PSDRPGS2",4,0)
 ;second call to %ZIS to restore varibles for open execute
"RTN","PSDRPGS2",5,0)
 I $D(ZTQUEUED) S IOP=ION D ^%ZIS U IO
"RTN","PSDRPGS2",6,0)
 ;get ready for bar codes and formatting
"RTN","PSDRPGS2",7,0)
 N PSD10,PSD12,PSDL,A7BAR0,A7BAR1
"RTN","PSDRPGS2",8,0)
 D A7BAR^PSDPGS1
"RTN","PSDRPGS2",9,0)
 S PSD10=$P($G(^%ZIS(2,+$G(IOST(0)),5)),U),PSD12=$P($G(^(5)),U,2)
"RTN","PSDRPGS2",10,0)
 S PSDL=$P($G(^%ZIS(2,+$G(IOST(0)),12.16)),U)
"RTN","PSDRPGS2",11,0)
 S PSDL(1)=$P($G(^%ZIS(2,+$G(IOST(0)),12.15)),U)
"RTN","PSDRPGS2",12,0)
 I PSD12']""!(PSD10']"")!(PSDL']"")!(PSDL(1)']"") W !!,"The device you selected is not set up for green sheets, please contact IRM.",!! Q
"RTN","PSDRPGS2",13,0)
 S PSD=$P(PSDS,"^",2),PSDCNT=1
"RTN","PSDRPGS2",14,0)
 S PSD1="" F  S PSD1=$O(PSD1(PSD1)) Q:PSD1=""  D LOOP
"RTN","PSDRPGS2",15,0)
END K %ZIS,ANS,ASK,C,CNT,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,EXPD,LINE,LOT,NAOU,NAOUN,NODE,NODE1
"RTN","PSDRPGS2",16,0)
 K OK,ORD,ORDN,POP,PRT,PSD,PSD1,PSDA,PSDBY,PSDBYN,PSDCNT,PSDDT,PSDEV,PSDOUT,PSDCPI,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDT,PSDTR,PSDTRN,REPRINT,QTY,SITE,STAT,TRANS,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDRPGS2",17,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRPGS2",18,0)
 Q
"RTN","PSDRPGS2",19,0)
LOOP S PSDPN=$P(PSD1(PSD1),",",PSDCNT),PSDCNT=PSDCNT+1 I PSDPN="" S PSDCNT=1 Q
"RTN","PSDRPGS2",20,0)
 S PSDA=$O(^PSD(58.81,"D",PSDPN,0)) D SET
"RTN","PSDRPGS2",21,0)
 G LOOP
"RTN","PSDRPGS2",22,0)
 Q
"RTN","PSDRPGS2",23,0)
SET ;set data for printing
"RTN","PSDRPGS2",24,0)
 K TRANS,PSDTR S PSDOUT=0
"RTN","PSDRPGS2",25,0)
 Q:'$D(^PSD(58.81,+PSDA,0))  S NODE=^PSD(58.81,+PSDA,0)
"RTN","PSDRPGS2",26,0)
 Q:+$P(NODE,"^",3)'=+PSDS  I (+$P(NODE,"^",11)>4)&(+$P(NODE,"^",11)'=10)&(+$P(NODE,U,11)'=13) Q
"RTN","PSDRPGS2",27,0)
 I +$P($G(^PSD(58.81,PSDA,"CS")),"^",4)  S REPRINT=1
"RTN","PSDRPGS2",28,0)
 S PSD=+$P(NODE,"^",18)
"RTN","PSDRPGS2",29,0)
 S NAOUN=$S($P($G(^PSD(58.8,+PSD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",30,0)
 S PSDR=$P(NODE,"^",5),PSDRN=$S($P($G(^PSDRUG(PSDR,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",31,0)
 S PSDT=$P(NODE,"^",4)
"RTN","PSDRPGS2",32,0)
 S QTY=$P(NODE,"^",6) I $D(^PSD(58.81,PSDA,4)),+$P(^(4),"^",3) S QTY=$P(^(4),"^",3)
"RTN","PSDRPGS2",33,0)
 S LOT=$P(NODE,"^",14),EXP=$P(NODE,"^",15),EXPD="" I EXP S Y=$E(EXP,1,7) X ^DD("DD") S EXPD=Y
"RTN","PSDRPGS2",34,0)
 S (PSDBY,PSDBYN,ORD,ORDN)=""
"RTN","PSDRPGS2",35,0)
 I $D(^PSD(58.81,PSDA,1)) S NODE1=^(1),PSDBY=$P(NODE1,"^"),ORD=$P(NODE1,"^",7)
"RTN","PSDRPGS2",36,0)
 S:ORD ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",37,0)
 S:PSDBY PSDBYN=$S($P($G(^VA(200,PSDBY,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",38,0)
 S CNT=1,PSDTR(CNT)=+$O(^PSD(58.81,"AE",PSDA,0)) D:PSDTR(CNT)  G:PSDOUT PRINT
"RTN","PSDRPGS2",39,0)
 .S TRANS=1
"RTN","PSDRPGS2",40,0)
 .D SETT Q:PSDOUT
"RTN","PSDRPGS2",41,0)
 .S NAOU=+$P($G(^PSD(58.81,PSDTR(CNT),0)),"^",18)
"RTN","PSDRPGS2",42,0)
 .S:NAOU $P(PSDTR(CNT),"^",2)=$S($P($G(^PSD(58.8,+NAOU,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",43,0)
PRINT ;print green sheet
"RTN","PSDRPGS2",44,0)
 I ORDN]"",ORDN'="UNKNOWN" S ORDN=$P(ORDN,",")_","_$E($P(ORDN,",",2))
"RTN","PSDRPGS2",45,0)
 I PSDBYN]"",PSDBYN'="UNKNOWN" S PSDBYN=$P(PSDBYN,",")_","_$E($P(PSDBYN,",",2))
"RTN","PSDRPGS2",46,0)
 S PSDDT="" I PSDT S PSDDT=$E(PSDT,4,5)_"/"_$E(PSDT,6,7)_"/"_$E(PSDT,2,3)
"RTN","PSDRPGS2",47,0)
 W:$Y @IOF,@PSD12
"RTN","PSDRPGS2",48,0)
 W:$D(REPRINT) *13,?10,"* REPRINT *",$P($G(^DPT(+$P($G(^PSD(58.81,PSDA,9)),U),0)),U) I '$D(TRANS) W ?33,NAOUN
"RTN","PSDRPGS2",49,0)
 W:$D(TRANS) "* Transferred to: ",$S($P(PSDTR(CNT),"^",2)]"":$P(PSDTR(CNT),"^",2),1:$P(PSDTR(CNT-1),"^",2))," *"
"RTN","PSDRPGS2",50,0)
 I $D(A7PRT) W *13,?70,@A7BAR1,@PSD10,PSDPN,@A7BAR0,@PSD12
"RTN","PSDRPGS2",51,0)
 W @PSDL,!?6,"CONTROLLED SUBSTANCE ADMINISTRATION RECORD",?54
"RTN","PSDRPGS2",52,0)
 W "Pharmacy Dispensing # ",@PSD10,PSDPN,@PSD12,!?6
"RTN","PSDRPGS2",53,0)
 W "Drug: ",@PSD10,PSDRN,@PSD12,?60,"Exp: ",EXPD,?75
"RTN","PSDRPGS2",54,0)
 W "Qty: ",@PSD10,QTY,@PSD12,!?6
"RTN","PSDRPGS2",55,0)
 W "Lot#",LOT,?21,"Ord by: ",$E(ORDN,1,20)
"RTN","PSDRPGS2",56,0)
 W ?45,"Disp by: ",$E(PSDBYN,1,20),?70,"Date: ",PSDDT,@PSDL(1),!?7
"RTN","PSDRPGS2",57,0)
 S $P(LN,"_",79)="" W LN,@PSDL,!?6
"RTN","PSDRPGS2",58,0)
 W "| DATE   TIME     NAME OF PATIENT      DOSE  BALANCE  ADMINISTERED BY          |"
"RTN","PSDRPGS2",59,0)
 F LINE=1:1:30 W !?6,"|_______|_____|_______________________|_____|______|___________________________|"
"RTN","PSDRPGS2",60,0)
 ;W:ASK !
"RTN","PSDRPGS2",61,0)
 W !?6,"Above Drug Received:      Date__________  R.N. Sign_____________________________"
"RTN","PSDRPGS2",62,0)
 W !?6,"Above Drug Administered:  Date__________  R.N. Sign_____________________________"
"RTN","PSDRPGS2",63,0)
 W !?6,"Entries Reviewed:         Date__________  R.PH. Sign____________________________",!?6
"RTN","PSDRPGS2",64,0)
 W @PSDL(1),"Drug: ",@PSD10,PSDRN,@PSD12,?65
"RTN","PSDRPGS2",65,0)
 W "Pharmacy Dispensing # ",@PSD10,PSDPN,@PSD12,!?6
"RTN","PSDRPGS2",66,0)
 W "Automated VA FORM 10-2638"
"RTN","PSDRPGS2",67,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="103////1" D ^DIE K DA,DIE,DR
"RTN","PSDRPGS2",68,0)
 Q
"RTN","PSDRPGS2",69,0)
SETT ;set trans naous
"RTN","PSDRPGS2",70,0)
 S PSDTRN=+$O(^PSD(58.81,"AE",+PSDTR(CNT),0)) Q:'PSDTRN
"RTN","PSDRPGS2",71,0)
 S NAOU=$P($G(^PSD(58.81,+PSDTRN,0)),"^",18) I 'NAOU S PSDOUT=1 Q
"RTN","PSDRPGS2",72,0)
 S:NAOU $P(PSDTR(CNT),"^",2)=$S($P($G(^PSD(58.8,+NAOU,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRPGS2",73,0)
 I $O(^PSD(58.81,"AE",+PSDTRN,0)) S CNT=CNT+1,PSDTR(CNT)=$O(^PSD(58.81,"AE",+PSDTRN,0)) G SETT
"RTN","PSDRPGS2",74,0)
 Q
"RTN","PSDRPGS3")
0^270^B878286
"RTN","PSDRPGS3",1,0)
PSDRPGS3 ;BIR/JPW,LTL-Reprint Green Sheet (VA FORM 10-2638) cont'd ; 21 Jun 94
"RTN","PSDRPGS3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRPGS3",3,0)
 W !?6,"CONTROLLED SUBSTANCE ADMINISTRATION RECORD",?54
"RTN","PSDRPGS3",4,0)
 K LN S $P(LN,"_",80)="" W !,LN,!?6
"RTN","PSDRPGS3",5,0)
 W "| DATE   TIME     NAME OF PATIENT      DOSE  BALANCE  ADMINISTERED BY    |"
"RTN","PSDRPGS3",6,0)
 F LINE=1:1:10 W !?6,"|_______|_____|_______________________|_____|______|_____________________|",!
"RTN","PSDRPGS3",7,0)
 Q
"RTN","PSDRPT")
0^224^B21629642
"RTN","PSDRPT",1,0)
PSDRPT ;BIR/BJW-Reprint Misc (VA FORM 10-2321) ; 8 Mar 95
"RTN","PSDRPT",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRPT",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRPT",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):1,1:0)
"RTN","PSDRPT",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Coordinator for access to reprint",!,?12,"this transfer copy of VA FORM 10-2321.",!!,"PSJ RNURSE, PSD NURSE, or PSJ RPHARM security key required.",! K OK Q
"RTN","PSDRPT",6,0)
 W !!,"Reprint Transfer Between NAOUs VA FORM 10-2321",!
"RTN","PSDRPT",7,0)
 W $C(7),!,"Please note that you may reprint only the copy of the VA FORM 10-2321 for",!,"Green Sheets transferred from your NAOU that have NOT BEEN RECEIVED on",!,"the transfer to NAOU.",!
"RTN","PSDRPT",8,0)
ASKN ;ask transfer from naou
"RTN","PSDRPT",9,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select Transfer From NAOU: "
"RTN","PSDRPT",10,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRPT",11,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDRPT",12,0)
 S TYPE=3 G GS
"RTN","PSDRPT",13,0)
TYPE ;select type return to stock or turn in for destruction
"RTN","PSDRPT",14,0)
 K DA,DIR,DIRUT S DIR(0)="SO^1:RETURN TO STOCK;2:TURN IN FOR DESTRUCTION"
"RTN","PSDRPT",15,0)
 S DIR("A")="Select Type of VA FORM 10-2321 to Reprint"
"RTN","PSDRPT",16,0)
 S DIR("?",1)="Answer '1' to reprint a Return to Stock VA FORM 10-2321,"
"RTN","PSDRPT",17,0)
 S DIR("?",2)="answer '2' to reprint a Turn in For Destruction VA FORM 10-2321 or",DIR("?")="answer '^' to quit without reprinting any forms."
"RTN","PSDRPT",18,0)
 D ^DIR K DIR G:$D(DIRUT) END S TYPE=Y
"RTN","PSDRPT",19,0)
 G:TYPE'=2 GS
"RTN","PSDRPT",20,0)
CHK ;check for type of destructions
"RTN","PSDRPT",21,0)
 W ! K DA,DIR,DIRUT S DIR(0)="YO",DIR("B")="YES",DIR("A")="Is this a Green Sheet Turn in for Destructions reprint"
"RTN","PSDRPT",22,0)
 S DIR("?",1)="Answer 'YES' to enter Green Sheet number, 'NO' to select",DIR("?")="a Holding for Destructions number, or '^' to quit."
"RTN","PSDRPT",23,0)
 D ^DIR K DIR I $D(DIRUT) D MSG1 G END
"RTN","PSDRPT",24,0)
 I 'Y D LOOK G:PSDOUT END G PRINT
"RTN","PSDRPT",25,0)
GS ;select green sheet #
"RTN","PSDRPT",26,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDRPT",27,0)
 S:TYPE=1 DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",12)=3"
"RTN","PSDRPT",28,0)
 S:TYPE=2 DIC("S")="I $P(^(0),""^"",3)=+PSDS,$P(^(0),""^"",12)=2"
"RTN","PSDRPT",29,0)
 S:TYPE=3 DIC("S")="I $P(^(0),""^"",11)=10,$P(^(0),""^"",18)=AOU"
"RTN","PSDRPT",30,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDRPT",31,0)
 S PSDPN=$P(Y(0),"^",17),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDRPT",32,0)
 S MFG=$P(Y(0),"^",13),LOT=$P(Y(0),"^",14),EXP=$P(Y(0),"^",15),PSDS=+$P(Y(0),"^",3)
"RTN","PSDRPT",33,0)
 I TYPE'=3,'$D(^PSD(58.81,PSDA,3)) D MSG G:PSDOUT END
"RTN","PSDRPT",34,0)
 I TYPE=3,'$D(^PSD(58.81,PSDA,7)) D MSG G:PSDOUT END
"RTN","PSDRPT",35,0)
 I TYPE'=3 S NODE=^PSD(58.81,PSDA,3) S:TYPE=1 RECD=$P(NODE,"^"),RQTY=$P(NODE,"^",2),REAS=$P(NODE,"^",3) S:TYPE=2 RECD=$P(NODE,"^",4),RQTY=$P(NODE,"^",5),PSDHLD=$P(NODE,"^",8),REAS=$P(NODE,"^",6)
"RTN","PSDRPT",36,0)
 I TYPE=3 S NODE=^PSD(58.81,PSDA,7),RECD=$P(NODE,"^"),NAOUT=+$P(NODE,"^",3),RQTY=$P(NODE,"^",7),NAOUTN=$P($G(^PSD(58.8,NAOUT,0)),"^")
"RTN","PSDRPT",37,0)
PRINT ;print 2321
"RTN","PSDRPT",38,0)
 ;2nd line added for E3R# 3771 to print comments.
"RTN","PSDRPT",39,0)
 S REPRINT=1 S:'$D(REAS) REAS=""
"RTN","PSDRPT",40,0)
 S:$D(^PSD(58.86,+$G(PSDHLD),2)) PSDCOMS=$P(^(2),"^",1)
"RTN","PSDRPT",41,0)
 W !!,"Number of copies of VA FORM 10-2321? " R NUM:DTIME I '$T!(NUM="^")!(NUM="") W !!,"No copies printed!!",!! Q
"RTN","PSDRPT",42,0)
 S COMP=$S(TYPE=1:3,TYPE=2:2,1:999)
"RTN","PSDRPT",43,0)
 I NUM'?1N!(NUM=0)  W !!,"Enter a whole number between 1 and 9",! G PRINT
"RTN","PSDRPT",44,0)
 S (PG,PSDOUT)=0,RECDT=$E(RECD,4,5)_"/"_$E(RECD,6,7)_"/"_$E(RECD,2,3) S:EXP EXP=$E(EXP,4,5)_"/"_$E(EXP,2,3) D ^PSDGSRV2
"RTN","PSDRPT",45,0)
END K %,%DT,%H,%I,AOU,AOUN,COMP,D,DA,DIC,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,EXP,LOT,MFG
"RTN","PSDRPT",46,0)
 K NAOUT,NAOUTN,NODE,NUM,OK,ORD,PG,PSDCOMS,PSDA,PSDHLD,PSDOK,PSDOUT,PSDPN,PSDR,PSDRN,PSDS,PSDSN,PSDTYP,PSDUZ,REAS,RECD,RECDT,REPRINT,RQTY,STAT,STATN,SUM,TYPE,X,Y
"RTN","PSDRPT",47,0)
 Q
"RTN","PSDRPT",48,0)
MSG ;check and write msg if not ok
"RTN","PSDRPT",49,0)
 W !!,"Green Sheet #",PSDPN," has not been ",$S(TYPE=1:"returned to stock",TYPE=2:"turned in for destruction",1:"transferred between NAOUs"),".",!
"RTN","PSDRPT",50,0)
MSG1 W !,"No Reprint of VA FORM 10-2321",!!
"RTN","PSDRPT",51,0)
 S PSDOUT=1
"RTN","PSDRPT",52,0)
 Q
"RTN","PSDRPT",53,0)
LOOK ;lookup destructions #
"RTN","PSDRPT",54,0)
 S PSDOUT=0
"RTN","PSDRPT",55,0)
 W ! K DA,DIC S DIC=58.86,DIC(0)="QEAZ",DIC("A")="Select Destructions Holding #: "
"RTN","PSDRPT",56,0)
 S DIC("S")="I $P(^(0),""^"",7)=+PSDS,'+$P(^(0),""^"",11)" D ^DIC K DIC I Y<0 D MSG1 Q
"RTN","PSDRPT",57,0)
 S PSDHLD=+Y,RQTY=+$P(Y(0),"^",3),RECD=+$P(Y(0),"^",6),PSDOK=1,PSDR=+$P(Y(0),"^",2),PSDRN=$S(PSDR:$P($G(^PSDRUG(+PSDR,0)),"^"),1:$G(^PSD(58.86,+PSDHLD,1)))
"RTN","PSDRPT",58,0)
 S:PSDRN']"" PSDRN="UNKNOWN" S (MFG,LOT,EXP)=""
"RTN","PSDRPT",59,0)
 Q
"RTN","PSDRSI")
0^225^B11533233
"RTN","PSDRSI",1,0)
PSDRSI ;BIR/JPW-Inspector Remove Hold on Green Sheet ; 10 Nov 93
"RTN","PSDRSI",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRSI",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRSI",4,0)
 W !!,"Inspector Remove a Green Sheet from Hold" S PSDUZ=DUZ,PSDUZN=$S($P($G(^VA(200,PSDUZ,0)),"^")]"":$P(^(0),"^"),1:"")
"RTN","PSDRSI",5,0)
ASKN ;if nurse ask naou
"RTN","PSDRSI",6,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: "
"RTN","PSDRSI",7,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRSI",8,0)
 D ^DIC K DIC G:Y<0 END S AOU=+Y,AOUN=$P(Y,"^",2)
"RTN","PSDRSI",9,0)
GS ;select green sheet #
"RTN","PSDRSI",10,0)
 W ! K DA,DIC S DIC("A")="Select the Green Sheet #: ",DIC=58.81,DIC(0)="QEASZ",D="D"
"RTN","PSDRSI",11,0)
 S DIC("S")="I $P(^(0),""^"",11)=11"
"RTN","PSDRSI",12,0)
 D IX^DIC K DIC G:Y<0 END S PSDA=+Y
"RTN","PSDRSI",13,0)
 S STAT=+$P(Y(0),"^",11),PSDPN=$P(Y(0),"^",17),STATN="" I STAT S STATN=$P($G(^PSD(58.82,STAT,0)),"^")
"RTN","PSDRSI",14,0)
 S ORD=+$P(Y(0),"^",20),NAOU=+$P(Y(0),"^",18),NAOUN=$P($G(^PSD(58.8,NAOU,0)),"^"),PSDR=+$P(Y(0),"^",5),PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDRSI",15,0)
 I AOU'=NAOU W $C(7),!!,"The Green Sheet # ",PSDPN," is assigned to ",NAOUN,".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDRSI",16,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,3,ORD,0)) W $C(7),!!,"There's no data on ",NAOUN," for Green Sheet # ",PSDPN,".",!,"Contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDRSI",17,0)
 I STAT'=11 W $C(7),!!,"This Green Sheet has a status of "_$S(STATN]"":STATN,1:"UNKNOWN")_".",!,"Please select another Green Sheet.",! G GS
"RTN","PSDRSI",18,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","PSDRSI",19,0)
 S DIR("?",1)="Answer 'YES' to to remove this Green Sheet from hold for the Inspector or",DIR("?")="answer 'NO' to leave the Green Sheet status under review by Inspector."
"RTN","PSDRSI",20,0)
 D ^DIR K DIR G:$D(DIRUT) END G:'Y GS
"RTN","PSDRSI",21,0)
 D NOW^%DTC S (RECD,Y)=+$E(%,1,12) X ^DD("DD") S RECDT=Y
"RTN","PSDRSI",22,0)
COM ;complete at order level in 58.8
"RTN","PSDRSI",23,0)
 W !!,"Accessing ",PSDRN," information...",!!
"RTN","PSDRSI",24,0)
 W !!,"Updating your records now..."
"RTN","PSDRSI",25,0)
 ;update transaction file (58.81)
"RTN","PSDRSI",26,0)
 K DA,DIE,DR S DA=PSDA,DIE=58.81,DR="29.7////"_RECD_";10////4" D ^DIE K DA,DIE,DR
"RTN","PSDRSI",27,0)
 I $D(Y)!$D(DTOUT) W $C(7),!!,"** THIS GREEN SHEET HAS NOT BEEN REMOVED FROM HOLD **",!!,"The status remains "_STATN,! G END
"RTN","PSDRSI",28,0)
 K DA,DIE,DR S DA=ORD,DA(1)=PSDR,DA(2)=NAOU,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",3,",DR="10////4" D ^DIE K DA,DIE,DR
"RTN","PSDRSI",29,0)
 S STAT=$P($G(^PSD(58.81,PSDA,0)),"^",11) W ?2,!,"*** Your Green Sheet #"_PSDPN_" is now "_$S($P($G(^PSD(58.82,STAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")_" ***",!
"RTN","PSDRSI",30,0)
 G GS
"RTN","PSDRSI",31,0)
END K %,%DT,%H,%I,AOU,AOUN,D,DA,DIC,DIE,DR,DTOUT,DUOUT
"RTN","PSDRSI",32,0)
 K NAOU,NAOUN,OK,ORD,PSDA,PSDPN,PSDR,PSDRN,PSDUZ,PSDUZN,RECD,RECDT,STAT,STATN,SUB,TRANS,X,Y
"RTN","PSDRSI",33,0)
 Q
"RTN","PSDRWK")
0^226^B19279076
"RTN","PSDRWK",1,0)
PSDRWK ;BIR/JPW-Reprint Pharm Disp. Worksheet ; 29 Aug 94
"RTN","PSDRWK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDRWK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRWK",4,0)
 S OK=$S($D(^XUSEC("PSJ RPHARM",DUZ)):1,$D(^XUSEC("PSJ PHARM TECH",DUZ)):1,1:0)
"RTN","PSDRWK",5,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"process/dispense narcotic supplies.",!!,"PSJ RPHARM or PSJ PHARM TECH security key required.",! K OK Q
"RTN","PSDRWK",6,0)
 W !!,"=>  This report reprints a worksheet listing of all pending CS requests for a",!,"    dispensing site.",!!
"RTN","PSDRWK",7,0)
 I '$O(^PSD(58.85,0)) W $C(7),!!,"There are no pending request orders.",!! K OK Q
"RTN","PSDRWK",8,0)
ASKD ;ask disp location
"RTN","PSDRWK",9,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDRWK",10,0)
 I $P(PSDSITE,U,5) S PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) G CHKD
"RTN","PSDRWK",11,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Primary Dispensing Site: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDRWK",12,0)
 D ^DIC K DIC G:Y<0 END
"RTN","PSDRWK",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),PSDS=PSDS_"^"_+$P(Y(0),"^",5)
"RTN","PSDRWK",14,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDRWK",15,0)
CHKD I '$O(^PSD(58.85,"AE",+PSDS,0)) W !!,"There are no pending CS requests for "_PSDSN_".",!! G END
"RTN","PSDRWK",16,0)
DEV ;ask device and queue info
"RTN","PSDRWK",17,0)
 W !!,"This report is designed for a 132 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDRWK",18,0)
 S Y=$P($G(^PSD(58.8,+PSDS,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDRWK",19,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")=PSDEV D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDRWK",20,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDRWK",ZTDESC="Reprint Worksheet for CS PHARM" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDRWK",21,0)
 U IO
"RTN","PSDRWK",22,0)
START ;entry for reprint
"RTN","PSDRWK",23,0)
 K LN S (CNT,PG,PSDOUT)=0,$P(LN,"-",132)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y D HDR Q:PSDOUT
"RTN","PSDRWK",24,0)
 F JJ=0:0 S JJ=$O(^PSD(58.85,"AW",+PSDS,JJ)) Q:'JJ!(PSDOUT)  F PSD=0:0 S PSD=$O(^PSD(58.85,"AW",+PSDS,JJ,PSD)) Q:'PSD!(PSDOUT)  I $D(^PSD(58.85,PSD,0)) S PSDN=+$P(^(0),"^",3) D
"RTN","PSDRWK",25,0)
 .S NODE=^PSD(58.85,PSD,0),CNT=CNT+1,WK=$S($P(NODE,"^",7)>2:"*",1:"")
"RTN","PSDRWK",26,0)
 .S PSDNA=$S($P($G(^PSD(58.8,PSDN,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_PSDN)
"RTN","PSDRWK",27,0)
 .S DRUG=+$P(NODE,"^",4),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"ZZ/"_DRUG)
"RTN","PSDRWK",28,0)
 .S QTY=$P(NODE,"^",6),ORD=+$P(NODE,"^",12),ORDN=$S($P($G(^VA(200,ORD,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDRWK",29,0)
 .S COMM=$S($D(^PSD(58.85,PSD,1,0)):1,1:0)
"RTN","PSDRWK",30,0)
 .;prints detail data
"RTN","PSDRWK",31,0)
 .I 'CNT W !!,?45,"****  NO REQUESTS PREVIOUSLY PRINTED FOR THIS DISPENSING LOCATION  ****" S PSDOUT=1 Q
"RTN","PSDRWK",32,0)
 .D:$Y+8>IOSL HDR Q:PSDOUT
"RTN","PSDRWK",33,0)
 .W !,PSD_WK,?10,DRUGN,?52,QTY,?60,PSDNA,?100,ORDN
"RTN","PSDRWK",34,0)
 .W:$P($G(^PSD(58.85,PSD,2)),U,2) !,"* EMERGENCY *"
"RTN","PSDRWK",35,0)
 .I COMM K ^UTILITY($J,"W") F TEXT=0:0 S TEXT=$O(^PSD(58.85,PSD,1,TEXT)) Q:'TEXT  S X=$G(^PSD(58.85,PSD,1,TEXT,0)),DIWL=15,DIWR=125,DIWF="W" D ^DIWP
"RTN","PSDRWK",36,0)
 .I COMM D ^DIWW
"RTN","PSDRWK",37,0)
 .W !!,?10,"Disp # ____________  Manufacturer: __________________   Lot # __________   Exp. Date: __________",!
"RTN","PSDRWK",38,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDRWK",39,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDRWK",40,0)
END K %,%H,%I,%ZIS,C,CNT,COMM,DA,DIC,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DTOUT,DRUG,DRUGN,DUOUT,IO("Q"),JJ,LN,NODE,OK,ORD,ORDN
"RTN","PSDRWK",41,0)
 K PG,POP,PSD,PSDEV,PSDN,PSDNA,PSDOUT,PSDS,PSDSN,QTY,RPDT,TEXT,WK,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK D ^%ZISC
"RTN","PSDRWK",42,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDRWK",43,0)
 Q
"RTN","PSDRWK",44,0)
SAVE S (ZTSAVE("PSDS"),ZTSAVE("PSDSN"),ZTSAVE("PSDSITE"))=""
"RTN","PSDRWK",45,0)
 Q
"RTN","PSDRWK",46,0)
HDR ;lists header information
"RTN","PSDRWK",47,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDRWK",48,0)
 W:$Y @IOF S PG=PG+1 W !,?40,"PHARMACY DISPENSING WORKSHEET (Reprint)",!!,"Dispensing Location: ",PSDSN,?65,RPDT,?105,"PG "_PG,!!
"RTN","PSDRWK",49,0)
 W "WS #",?10,"DRUG",?50,"QUANTITY",?60,"DISPENSE TO",!,?12,"COMMENTS",?50,"ORDERED",?60,"LOCATION",?102,"ORDERED BY",!,LN,!
"RTN","PSDRWK",50,0)
 Q
"RTN","PSDSET")
0^227^B7164276
"RTN","PSDSET",1,0)
PSDSET ;BIR/JPW-Check Inpatient Site for CS Use ; 6 July 94
"RTN","PSDSET",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDSET",3,0)
SITE ;checks for valid cs inpatient site
"RTN","PSDSET",4,0)
 K XQUIT,X,PSDA,LOC I '$D(^PS(59.4,"B")) D  G:$G(XQUIT)="" END1 G END
"RTN","PSDSET",5,0)
 .W ! K DA,DIC,DIE,DLAYGO,DR S (DIC,DIE,DLAYGO)=59.4,DIC("A")="Enter Controlled Substances Inpatient Site Name: ",DIC(0)="QEAL" D ^DIC K DIC,DLAYGO I Y<0 S XQUIT="" Q
"RTN","PSDSET",6,0)
 .S (DA,PSDA)=+Y,DR="31///1" D ^DIE K DIE,DR S PSDSITE=PSDA
"RTN","PSDSET",7,0)
LOOP S (CNT,LOC,PSDA)=0 F PSDA=0:0 S PSDA=$O(^PS(59.4,PSDA)) Q:'PSDA  S CNT=CNT+1 S:$P(^PS(59.4,PSDA,0),"^",31) LOC=LOC+1,LOC(+PSDA)=""
"RTN","PSDSET",8,0)
CHK I LOC=1 S PSDSITE=+$O(LOC(0)) W !!,"Controlled Substances Inpatient Site Name: "_$P(^PS(59.4,PSDSITE,0),"^")
"RTN","PSDSET",9,0)
 I 'LOC,CNT=1 S PSDA=$O(^PS(59.4,0)),$P(^(PSDA,0),"^",31)=1,PSDSITE=+^(0) W !!,"Controlled Substances Inpatient Site Name: "_$P(^(0),"^")
"RTN","PSDSET",10,0)
 I CNT>1,LOC'=1 D  G:'$G(PSDSITE) END1
"RTN","PSDSET",11,0)
 .K DIC,DLAYGO S (DIC,DLAYGO)=59.4,DIC("A")="Enter Controlled Substances Inpatient Site Name: ",DIC(0)="QEA" S:LOC>1 DIC("S")="I $P(^(0),""^"",31)" S:LOC=0 DIC(0)="QEAL" D ^DIC K DIC,DLAYGO
"RTN","PSDSET",12,0)
 .S:Y<0 XQUIT="" Q:Y<0  S $P(^PS(59.4,+Y,0),"^",31)=1,PSDSITE=+Y_"^M"
"RTN","PSDSET",13,0)
END K LOC D EN^PSDSP
"RTN","PSDSET",14,0)
 I $G(PSDS) S $P(PSDSITE,U,3)=PSDS,$P(PSDSITE,U,4)=$P($G(^PSD(58.8,+PSDS,0)),U),$P(PSDSITE,U,5)=1 Q
"RTN","PSDSET",15,0)
 ;Set up Default Dispensing Site
"RTN","PSDSET",16,0)
 D:'$P(PSDSITE,U,3)&($P($G(XQY0),U)'["NUR")&($P($G(XQY0),U)'["INS")
"RTN","PSDSET",17,0)
 .;Make sure there's at least one Master Vault
"RTN","PSDSET",18,0)
 .Q:'$O(^PSD(58.8,"ASITE",+PSDSITE,"M",0))
"RTN","PSDSET",19,0)
 .S DIC="^PSD(58.8,",DIC(0)="AEQ"
"RTN","PSDSET",20,0)
 .S DIC("A")="Select Default Dispensing Site: "
"RTN","PSDSET",21,0)
 .S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),$S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0)"
"RTN","PSDSET",22,0)
 .W ! D ^DIC K DIC S:$D(DTOUT) XQUIT="" Q:Y<0
"RTN","PSDSET",23,0)
 .S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDSET",24,0)
END1 K CNT,DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,LOC,PSDA,PSDS,PSDSN,X,Y
"RTN","PSDSITE")
0^228^B8382033
"RTN","PSDSITE",1,0)
PSDSITE ;BIR/JPW,LTL-Site Parameters for CS ; 3 May 95
"RTN","PSDSITE",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDSITE",3,0)
SITE ;entry for selecting inpatient sites in file 59.4
"RTN","PSDSITE",4,0)
 K DIC,DLAYGO S (DIC,DLAYGO)="^PS(59.4,",DIC(0)="QEAL",D="B",DZ="??"
"RTN","PSDSITE",5,0)
 D DQ^DICQ K D,DZ W ! D ^DIC K DIC G:Y<0 END
"RTN","PSDSITE",6,0)
 K DA,DIE,DR S DIE=59.4,DA=+Y,DR="31"_"Is "_$P(Y,U,2)_" selectable for Controlled Subs" W ! D ^DIE K DIE
"RTN","PSDSITE",7,0)
END K DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","PSDSITE",8,0)
 Q
"RTN","PSDSITE",9,0)
 ;
"RTN","PSDSITE",10,0)
LOW ;if auto generate, check low range for numbers
"RTN","PSDSITE",11,0)
 I '$D(X) S PSDFLAG=1 Q
"RTN","PSDSITE",12,0)
 K PSD,PSDFLAG,PSDL F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$D(^(2)),$P(^(2),"^") D
"RTN","PSDSITE",13,0)
 .I +$P(^PSD(58.8,PSD,2),"^",2),+$P(^(2),"^",3) S PSDL(+PSD)=""
"RTN","PSDSITE",14,0)
 I $O(PSDL(0)) F PSD=0:0 S PSD=+$O(PSDL(PSD)) Q:'PSD  D
"RTN","PSDSITE",15,0)
 .I X'<$P($G(^PSD(58.8,PSD,2)),"^",2),(X'>$P($G(^(2)),"^",3)),PSD'=DA D MSG S PSDFLAG=1 Q
"RTN","PSDSITE",16,0)
 W:$D(PSDFLAG) "  Select another range.",! K PSD,PSDL
"RTN","PSDSITE",17,0)
 Q
"RTN","PSDSITE",18,0)
 ;
"RTN","PSDSITE",19,0)
HIGH ;validates high range for dispensing numbers
"RTN","PSDSITE",20,0)
 I '$D(X) S PSDFLAG=1 Q
"RTN","PSDSITE",21,0)
 K PSD,PSDFLAG,PSDH,PSDL F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $D(^PSD(58.8,PSD,0)),$D(^(2)),$P(^(2),"^") D
"RTN","PSDSITE",22,0)
 .I +$P(^PSD(58.8,PSD,2),"^",2) S PSDL(+$P(^(2),"^",2))=PSD
"RTN","PSDSITE",23,0)
 S PSDL=+$P($G(^PSD(58.8,DA,2)),"^",2),PSDH=+$O(PSDL(PSDL)) I PSDH S PSD=+$P(PSDL(PSDH),"^")
"RTN","PSDSITE",24,0)
 I X'>PSDL W !!,"High dispensing # must be larger than your low dispensing # "_PSDL_".",!! S PSDFLAG=1 Q
"RTN","PSDSITE",25,0)
 I PSDH,X'<PSDH D MSG S PSDFLAG=1
"RTN","PSDSITE",26,0)
 W:$D(PSDFLAG) "  Select another range.",! K PSD,PSDH,PSDL
"RTN","PSDSITE",27,0)
 Q
"RTN","PSDSITE",28,0)
 ;
"RTN","PSDSITE",29,0)
MSG ;prints message if range already in use
"RTN","PSDSITE",30,0)
 W $C(7),!!,?12," =>  Dispensing Site "_$S($P(^PSD(58.8,PSD,0),"^")]"":$P(^(0),"^"),1:"NAME MISSING")_"  <=",!,"has set aside the range "_$P($G(^PSD(58.8,PSD,2)),"^",2)_" through "_$P($G(^(2)),"^",3)_"."
"RTN","PSDSITE",31,0)
 Q
"RTN","PSDSITE",32,0)
 ;
"RTN","PSDSITE",33,0)
LAST ;checks range for 'last dispensed'
"RTN","PSDSITE",34,0)
 I '$D(X) S PSDFLAG=1 Q
"RTN","PSDSITE",35,0)
 I $D(PSDEN) D LAST1 K LOW,HIGH,PSDCHK Q
"RTN","PSDSITE",36,0)
 I X<$P($G(^PSD(58.8,DA,2)),"^",2) D MSG1 S PSDFLAG=1 Q
"RTN","PSDSITE",37,0)
 I X>$P($G(^PSD(58.8,DA,2)),"^",3) D MSG1 S PSDFLAG=1
"RTN","PSDSITE",38,0)
 Q
"RTN","PSDSITE",39,0)
 ;
"RTN","PSDSITE",40,0)
MSG1 ;prints message if not in dispensing range
"RTN","PSDSITE",41,0)
 W $C(7),!!,"Last number dispensed must be within the range "_$P($G(^PSD(58.8,DA,2)),"^",2)_" to "_$S($P($G(^(2)),"^",3):$P($G(^(2)),"^",3),1:999999999)_".",!
"RTN","PSDSITE",42,0)
 Q
"RTN","PSDSITE",43,0)
LAST1 ;checks LOW/HIGH range and LAST dispensed
"RTN","PSDSITE",44,0)
 I X<LOW D MSG2 S PSDFLAG=1 Q
"RTN","PSDSITE",45,0)
 I X>HIGH D MSG2 S PSDFLAG=1
"RTN","PSDSITE",46,0)
 Q
"RTN","PSDSITE",47,0)
MSG2 ;prints msg if not in dispensing range
"RTN","PSDSITE",48,0)
 S PSDCHK=1
"RTN","PSDSITE",49,0)
 W $C(7),!!,"Last number dispensed must be within the range ",LOW," to ",HIGH,".",!
"RTN","PSDSITE",50,0)
 Q
"RTN","PSDSP")
0^229^B1316387
"RTN","PSDSP",1,0)
PSDSP ;BIR/JPW-Check for Disp Site - one or more ; 27 Jul 92
"RTN","PSDSP",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDSP",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDSP",4,0)
EN S CNT=0 F LOC="M","S" F JJ=0:0 S JJ=$O(^PSD(58.8,"ASITE",+PSDSITE,LOC,JJ)) Q:'JJ  S CNT=CNT+1,LOC(CNT)=JJ
"RTN","PSDSP",5,0)
 I '$D(LOC(1)) W !!,"Please contact your Pharmacy Coordinator.",!,"You have not defined a pharmacy Dispensing Site",!! G END
"RTN","PSDSP",6,0)
 S:'$D(LOC(2)) PSDS=+LOC(1),PSDSN=$P($G(^PSD(58.8,+PSDS,0)),"^")
"RTN","PSDSP",7,0)
END K CNT,JJ,LOC
"RTN","PSDSTK")
0^230^B18401652
"RTN","PSDSTK",1,0)
PSDSTK ;BIR/JPW-Stock Drugs Enter/Edit ; 8 Aug 94
"RTN","PSDSTK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDSTK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDSTK",4,0)
STOCK ;entry for  NAOU stocked drugs into file 58.8
"RTN","PSDSTK",5,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC G:Y<0 END
"RTN","PSDSTK",6,0)
 S PSDA=+Y,PSDS=+$P(Y(0),"^",4),TYPE=$P(Y(0),"^",2) D DRUG
"RTN","PSDSTK",7,0)
 G:('PSDOUT)!(FLAG1) STOCK
"RTN","PSDSTK",8,0)
END K ADD,DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,FLAG,FLAG1,NAOU,NEW,OK,PSDA,PSDR,PSDRN,PSDRG,PSDOUT,PSDS,TYPE,SITE,X,Y
"RTN","PSDSTK",9,0)
 Q
"RTN","PSDSTK",10,0)
DRUG ;add drugs
"RTN","PSDSTK",11,0)
 S (FLAG,FLAG1,PSDOUT)=0
"RTN","PSDSTK",12,0)
 W !! K DA,DIR,DIRUT S DIR(0)="SOA^A:ADD;E:EDIT",DIR("A")="Do you wish to ADD or EDIT stock drugs? "
"RTN","PSDSTK",13,0)
 S DIR("?",1)="Answer 'ADD' to add new CS stock drugs, or",DIR("?")="answer 'EDIT' to edit existing stock drugs, or '^' to quit."
"RTN","PSDSTK",14,0)
 S DIR("B")="ADD" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDSTK",15,0)
 S ADD=Y
"RTN","PSDSTK",16,0)
 I TYPE'="M",ADD="A" D VAULT Q:(PSDOUT)!(FLAG1)  G:FLAG DRUG G DIE
"RTN","PSDSTK",17,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDA,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDSTK",18,0)
 I TYPE="M",ADD="A",'$D(^PSD(58.8,PSDA,1,0)) S ^(0)="^58.8001IP^^"
"RTN","PSDSTK",19,0)
 S DA(1)=+PSDA,DIC(0)=$S(ADD="E":"QEAMZ",1:"QEAMLZ"),DIC="^PSD(58.8,"_PSDA_",1,",DLAYGO=58.8 D ^DIC K DIC,DLAYGO Q:Y<0  S PSDR=+Y
"RTN","PSDSTK",20,0)
DIE D CHKID I OK K DA,DIE,DR S DIE="^PSD(58.8,"_PSDA_",1,",DA(1)=+PSDA,DA=+PSDR,DR="1;I $P(^PSD(58.8,PSDA,0),""^"",2)'=""N"" S Y=16;15;16;2;4;5;I $P(^PSD(58.8,PSDA,0),""^"",2)=""N"" S Y=9;7;8;26;28;29;8.5;9;10;11" D ^DIE K DA,DIE,DR
"RTN","PSDSTK",21,0)
 G DRUG
"RTN","PSDSTK",22,0)
 ;
"RTN","PSDSTK",23,0)
CHKID ;check for current inactivation date
"RTN","PSDSTK",24,0)
 I $P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)="" D CHKNP Q
"RTN","PSDSTK",25,0)
 D CHKNP Q:'OK
"RTN","PSDSTK",26,0)
 W $C(7),!!,?5,"This Drug is currently defined for this NAOU with an INACTIVATION DATE.",!!,?5,"If you want to add this Drug as a new standard Stock Drug for this NAOU",!,?5,"you must delete the INACTIVATION DATE.",!
"RTN","PSDSTK",27,0)
 K DA,DIE,DR S OK=1,DA(1)=PSDA,DA=PSDR,DIE="^PSD(58.8,"_PSDA_",1,",DR="13" D ^DIE K DIE S:$P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)]"" OK=0 W !
"RTN","PSDSTK",28,0)
 Q
"RTN","PSDSTK",29,0)
CHKNP ;check for non-CS entries in file 50
"RTN","PSDSTK",30,0)
 S OK=$S($P($G(^PSDRUG(PSDR,2)),"^",3)["N":1,1:0) Q:OK
"RTN","PSDSTK",31,0)
 I $P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)="" K DA,DIE,DR S DA(1)=PSDA,DA=PSDR,DIE="^PSD(58.8,"_PSDA_",1,",DR="13///"_DT_";14////O;14.5////NON-CS DRUG" D ^DIE K DIE
"RTN","PSDSTK",32,0)
 W $C(7),!!,?5,"This stocked drug is currently defined for this NAOU but appears to be",!,?5,"a non-CS drug.  It has been inactivated as of " S Y=$P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14) X ^DD("DD") W Y,!
"RTN","PSDSTK",33,0)
 Q
"RTN","PSDSTK",34,0)
VAULT ;check for stock drugs in vault
"RTN","PSDSTK",35,0)
 I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! S PSDOUT=1 Q
"RTN","PSDSTK",36,0)
 W !!,"You may select only CS drugs stocked in your dispensing vault.",!!
"RTN","PSDSTK",37,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDSTK",38,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC I Y<0 S FLAG1=1 Q
"RTN","PSDSTK",39,0)
 S PSDR=+Y I $D(^PSD(58.8,PSDA,1,PSDR,0)) Q
"RTN","PSDSTK",40,0)
 S PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDSTK",41,0)
 S:'$D(^PSD(58.8,PSDA,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSDSTK",42,0)
 S NEW=+$P(^PSD(58.8,PSDA,1,0),"^",4)+1
"RTN","PSDSTK",43,0)
 K DA,DIR,DIRUT,Y S DIR(0)="YO",DIR("A")="ARE YOU ADDING '"_PSDRN_"' AS A NEW DRUG (FOR THIS DRUG ACCOUNTABILITY STATS)",DIR("B")="Y"
"RTN","PSDSTK",44,0)
 D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDSTK",45,0)
 I 'Y S FLAG=1 Q
"RTN","PSDSTK",46,0)
 K DA,DIC,DD,DO S DA(1)=PSDA,DIC(0)="L",(X,DINUM)=PSDR,DIC="^PSD(58.8,"_PSDA_",1," D FILE^DICN K DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDSTK",47,0)
 Q
"RTN","PSDTER")
0^231^B23417786
"RTN","PSDTER",1,0)
PSDTER ;BIR/LTL-Barcode Terminal Type/Device Loader ; 26 Nov 93
"RTN","PSDTER",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTER",3,0)
 ;An IRM utility to stuff barcoding
"RTN","PSDTER",4,0)
 ;data into fields in the DEVICE & TERMINAL TYPE files.
"RTN","PSDTER",5,0)
 D DT^DICRW
"RTN","PSDTER",6,0)
 N DIC,DIE,DA,DR,DLAYGO,DIR,DIRUT,DTOUT,PSDALL,PSDCHO,PSDKY,PSDTERM,X,Y
"RTN","PSDTER",7,0)
BEG S DIR(0)="S^1:Load all three barcode Terminal Types;2:Load the P-HP BARCODER Terminal Type;3:Load the P-KYOCERA-BARCODE Terminal Type;4:Load the C-VT420 (9440) Terminal Type;5:Select your own Terminal Type;6:Display;7:Nevermind"
"RTN","PSDTER",8,0)
 S DIR("?")="If any of the selected Terminal Types already exist, I will ask for your approval before proceeding."
"RTN","PSDTER",9,0)
 D ^DIR K DIR G:Y<1!(Y=7) END S:Y=1 PSDALL=1 S PSDCHO=Y
"RTN","PSDTER",10,0)
TERM S DIC="^%ZIS(2,",DIC(0)=$S(Y=5:"AEMQL",Y=6:"AEMQ",1:"L"),DLAYGO=3.2
"RTN","PSDTER",11,0)
 S:Y<5 X=$S(Y<3:"P-HP BARCODER",Y=3:"P-KYOCERA-BARCODE",1:"C-VT420 (9440)")
"RTN","PSDTER",12,0)
 D ^DIC K DIC G:Y<1 END S PSDTERM=$P(Y,U,2),PSDTERM(1)=+Y
"RTN","PSDTER",13,0)
 I '$P(Y,U,3) S DIC="^%ZIS(2,",DA=+Y W !!,"Current settings:",! D EN^DIQ
"RTN","PSDTER",14,0)
 G:PSDCHO=6 BEG
"RTN","PSDTER",15,0)
 I PSDCHO=5 D  G:Y<1 END
"RTN","PSDTER",16,0)
 .S DIR(0)="S^1:Hewlett Packard Printer;2:Kyocera Printer;3:Trakker"
"RTN","PSDTER",17,0)
 .S DIR("?")="Your choice will determine what type of barcode set-up gets stuffed into "_PSDTERM_"." D ^DIR K DIR S PSDCHO(1)=Y
"RTN","PSDTER",18,0)
SURE S DIR(0)="Y",(DIR("A",1),PSDTERM(4))="Are you sure that you want to stuff the Controlled Substances barcode set-up",DIR("A")="into the "_PSDTERM_" Terminal Type",DIR("B")="No"
"RTN","PSDTER",19,0)
 S (DIR("?"),PSDTERM(6))="Yes and I'll update OPEN EXECUTE, RIGHT MARGIN, PAGE LENGTH, Etc. fields." W ! D ^DIR K DIR G:Y<1 END
"RTN","PSDTER",20,0)
 S PSDTERM(2)="Update the DEVICE file",PSDTERM(3)="Yes, and I will add the "_PSDTERM_" Terminal Type and update a few fields in the device of your selection."
"RTN","PSDTER",21,0)
HP ;Hewlett Packard update
"RTN","PSDTER",22,0)
 I $G(PSDALL)!(PSDCHO=2)!($G(PSDCHO(1))=1) D  G:'$G(PSDALL) BEG
"RTN","PSDTER",23,0)
 .S DIE="^%ZIS(2,",DA=PSDTERM(1)
"RTN","PSDTER",24,0)
 .W !!,"Updating ",PSDTERM,"."
"RTN","PSDTER",25,0)
 .S DR=".02///NO;1////0;2////#;3////58;4////$C(8);6////W $C(27)_""E""_$C(27)_""&l0O""_$C(27)_""(8U""_$C(27)_""(s0p""_$S($G(PSDCPI)=10:""10h14"",1:""12h12"")_""v0s0b6T"";10////$C(27)_""(s10H"";12////$C(27)_""(s12H"""
"RTN","PSDTER",26,0)
 .S DR(1,3.2,1)="12.15////$C(27)_""&l8C"";12.16////$C(27)_""&l12C"";60////$S($D(PSDX2):$C(27)_""*p""_(PSDX2-1*300+200)_""y*p""_(PSDX1-1*810+38)_""X"",1:"""")_$C(27)_""(0Y""_$C(27)_""(s0p8.1h12v0s0b0T*"""
"RTN","PSDTER",27,0)
 .S DR(1,3.2,2)="61////""*""_$C(27)_""&l0O""_$C(27)_""(8U""_$C(27)_""(s0p""_$S($G(PSDCPI)=10:""10h14"",1:""12h12"")_""v0s0b6T"""
"RTN","PSDTER",28,0)
 .D ^DIE K DR
"RTN","PSDTER",29,0)
 .S DIR(0)="Y",DIR("A")=PSDTERM(2),DIR("B")="No",DIR("?")=PSDTERM(3)
"RTN","PSDTER",30,0)
 .W ! D ^DIR K DIR Q:Y<1
"RTN","PSDTER",31,0)
 .S DIC="^%ZIS(1,",DIC(0)="AEMQL",DLAYGO=3.5,DIC("B")="HP III BARCODER"
"RTN","PSDTER",32,0)
 .W ! D ^DIC K DIC Q:Y<1  S DIE="^%ZIS(1,",DA=+Y
"RTN","PSDTER",33,0)
 .S DR=".02;1;1.95///NO;2///TERMINAL;3////^S X=PSDTERM(1);4///YES;5///YES;9////0;10////#;11////58;12////$C(8);61;62;63///NOT SPOOLED;64////96"
"RTN","PSDTER",34,0)
 .D ^DIE
"RTN","PSDTER",35,0)
KY ;Kyocera update
"RTN","PSDTER",36,0)
 I $G(PSDALL)!(PSDCHO=3)!($G(PSDCHO(1))=2) D  G:'$G(PSDALL) BEG
"RTN","PSDTER",37,0)
 .I $G(PSDALL) D  Q:Y<1
"RTN","PSDTER",38,0)
 ..S DIC="^%ZIS(2,",DIC(0)="L",DLAYGO=3.2,X="P-KYOCERA-BARCODE"
"RTN","PSDTER",39,0)
 ..D ^DIC K DIC Q:Y<1  S PSDTERM=$P(Y,U,2),PSDTERM(1)=+Y
"RTN","PSDTER",40,0)
 ..I '$P(Y,U,3) S DIC="^%ZIS(2,",DA=+Y W !,"Current settings:",! D EN^DIQ
"RTN","PSDTER",41,0)
 ..S DIR(0)="Y",DIR("A",1)=PSDTERM(4),DIR("?")=PSDTERM(6),DIR("B")="No"
"RTN","PSDTER",42,0)
 ..S DIR("A")="into the "_PSDTERM_" Terminal Type" W ! D ^DIR K DIR
"RTN","PSDTER",43,0)
 .S DIE="^%ZIS(2,",DA=PSDTERM(1)
"RTN","PSDTER",44,0)
 .W !!,"Updating ",PSDTERM,"."
"RTN","PSDTER",45,0)
 .S PSDKY="W ""!R! RES;FONT ""_$S($G(PSDCPI)=10:1,1:6)_"";EXIT;"""
"RTN","PSDTER",46,0)
 .S PSDKY(1)="""!R! FONT 6; UNIT D; ""_$S('$D(PSDX1):"""",PSDX1=1:""MRP 0,-60 ; "",1:"""")_$S('$D(PSDX1):"""",1:""MRP ""_(PSDX1>1*810+38)_"" , 0 ;"")_"" BARC 19, N, '"""
"RTN","PSDTER",47,0)
 .S PSDKY(2)="""', 60, 60, 3, 6, 6, 6, 3, 6, 6, 6;""_$S('$D(PSDX1):"""",PSDX1=PSDCNT:""MRP 0 , 60;"",1:"""")_""EXIT;"""
"RTN","PSDTER",48,0)
 .S PSDKY(3)="""!R! SLPI 4.1; EXIT;"""
"RTN","PSDTER",49,0)
 .S PSDKY(4)="""!R! FONT1; EXIT;"""
"RTN","PSDTER",50,0)
 .S PSDKY(5)="""!R! FONT6; EXIT;"""
"RTN","PSDTER",51,0)
 .S PSDKY(6)="""!R! SLM 2; EXIT;"""
"RTN","PSDTER",52,0)
 .S DR=".02///NO;1////0;2////#;3////66;4////$C(8);6////^S X=PSDKY;10////^S X=PSDKY(4);12////^S X=PSDKY(5);12.15////^S X=PSDKY(6);12.16////^S X=PSDKY(3);60////^S X=PSDKY(1);61////^S X=PSDKY(2)"
"RTN","PSDTER",53,0)
 .D ^DIE
"RTN","PSDTER",54,0)
 .S DIR(0)="Y",DIR("A")=PSDTERM(2),DIR("B")="No",DIR("?")=PSDTERM(3)
"RTN","PSDTER",55,0)
 .W ! D ^DIR K DIR Q:Y<1
"RTN","PSDTER",56,0)
 .S DIC="^%ZIS(1,",DIC(0)="AEMQL",DLAYGO=3.5,DIC("B")="KYOCERA BARCODER"
"RTN","PSDTER",57,0)
 .W ! D ^DIC K DIC Q:Y<1  S DIE="^%ZIS(1,",DA=+Y
"RTN","PSDTER",58,0)
 .S DR=".02;1;1.95///NO;2///TERMINAL;3////^S X=PSDTERM(1);4///YES;5///YES;9////0;10////#;11////66;12////$C(8)" D ^DIE
"RTN","PSDTER",59,0)
TRAK ;Trakker update
"RTN","PSDTER",60,0)
 I $G(PSDALL)!(PSDCHO=4)!($G(PSDCHO(1))=3) D TRAK^PSDTER1
"RTN","PSDTER",61,0)
END Q
"RTN","PSDTER1")
0^232^B2990848
"RTN","PSDTER1",1,0)
PSDTER1 ;BIR/LTL-Barcode Terminal Type/Device Loader (cont'd) ; 26 Nov 93
"RTN","PSDTER1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTER1",3,0)
 ;An IRM utility to stuff barcoding
"RTN","PSDTER1",4,0)
 ;data into fields in the DEVICE & TERMINAL TYPE files.
"RTN","PSDTER1",5,0)
TRAK ;Trakker update
"RTN","PSDTER1",6,0)
 D  G:'$G(PSDALL) BEG^PSDTER Q
"RTN","PSDTER1",7,0)
 .I $G(PSDALL) D  Q:Y<1
"RTN","PSDTER1",8,0)
 ..S DIC="^%ZIS(2,",DIC(0)="L",DLAYGO=3.2,X="C-VT420 (9440)"
"RTN","PSDTER1",9,0)
 ..D ^DIC K DIC Q:Y<1  S PSDTERM=$P(Y,U,2),PSDTERM(1)=+Y
"RTN","PSDTER1",10,0)
 ..I '$P(Y,U,3) S DIC="^%ZIS(2,",DA=+Y W !,"Current settings:",! D EN^DIQ
"RTN","PSDTER1",11,0)
 ..S DIR(0)="Y",DIR("A",1)=PSDTERM(4),DIR("?")=PSDTERM(6),DIR("B")="No"
"RTN","PSDTER1",12,0)
 ..S DIR("A")="into the "_PSDTERM_" Terminal Type" W ! D ^DIR K DIR
"RTN","PSDTER1",13,0)
 .S DIE="^%ZIS(2,",DA=PSDTERM(1)
"RTN","PSDTER1",14,0)
 .W !!,"Updating ",PSDTERM,"."
"RTN","PSDTER1",15,0)
 .S DR="1////80;2////#;3////9999;6////W $C(0);99////TRAKKER 9440 TO AUX PORT OF VT420;110////W $C(27)_""[5i"";111////W $C(27)_""[4i"""
"RTN","PSDTER1",16,0)
 .D ^DIE K DIE,DA,DR
"RTN","PSDTER1",17,0)
 .S DIR(0)="Y",DIR("A")=PSDTERM(2),DIR("B")="No",DIR("?")=PSDTERM(3)
"RTN","PSDTER1",18,0)
 .W ! D ^DIR K DIR Q:Y<1
"RTN","PSDTER1",19,0)
 .S DIC="^%ZIS(1,",DIC(0)="AEMQL",DLAYGO=3.5,DIC("B")="TRAKKERSL"
"RTN","PSDTER1",20,0)
 .W ! D ^DIC K DIC Q:Y<1  S DIE="^%ZIS(1,",DA=+Y
"RTN","PSDTER1",21,0)
 .S DR=".02//SLAVED 9440 FROM VT420 AUX PORT;1////0;2///TERMINAL;3////^S X=PSDTERM(1);9////80;10////#;11////9999;12////$C(8)" D ^DIE
"RTN","PSDTER2")
0^271^B17639482
"RTN","PSDTER2",1,0)
PSDTER2 ;BIR/LTL-Barcode Terminal Type/Device Loader ; 26 Nov 93
"RTN","PSDTER2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTER2",3,0)
 ;An IRM utility to stuff green sheet formatting
"RTN","PSDTER2",4,0)
 ;data into fields in the TERMINAL TYPE file.
"RTN","PSDTER2",5,0)
 Q:XPDENV'=1  D DT^DICRW
"RTN","PSDTER2",6,0)
 W !!,"Please select the Terminal Type for the printer currently used by Pharmacy",!!,"to print green sheets (VA FORM 10-2638).",!!
"RTN","PSDTER2",7,0)
 N DIC,DIE,DA,DR,DLAYGO,DIR,DIRUT,DTOUT,PSDALL,PSDCHO,PSDKY,PSDTERM,X,Y
"RTN","PSDTER2",8,0)
BEG S PSDCHO=3
"RTN","PSDTER2",9,0)
TERM S DIC="^%ZIS(2,",DIC(0)="AEMQL",DLAYGO=3.2
"RTN","PSDTER2",10,0)
 S DIC("B")="P-HP BARCODER"
"RTN","PSDTER2",11,0)
 D ^DIC K DIC G:Y<1 END S PSDTERM=$P(Y,U,2),PSDTERM(1)=+Y
"RTN","PSDTER2",12,0)
 I '$P(Y,U,3) S DIC="^%ZIS(2,",DA=+Y W !!,"Current settings:",! D EN^DIQ
"RTN","PSDTER2",13,0)
SURE S DIR(0)="Y",(DIR("A",1),PSDTERM(4))="Are you sure that you want to stuff the Controlled Substances barcode set-up",DIR("A")="into the "_PSDTERM_" Terminal Type",DIR("B")="No"
"RTN","PSDTER2",14,0)
 S (DIR("?"),PSDTERM(6))="Yes and I'll update OPEN EXECUTE, RIGHT MARGIN, PAGE LENGTH, Etc. fields." W ! D ^DIR K DIR G:Y<1 END
"RTN","PSDTER2",15,0)
 S PSDTERM(2)="Update the DEVICE file",PSDTERM(3)="Yes, and I will add the "_PSDTERM_" Terminal Type and update a few fields in the device of your selection."
"RTN","PSDTER2",16,0)
HP ;Hewlett Packard update
"RTN","PSDTER2",17,0)
 S DIE="^%ZIS(2,",DA=PSDTERM(1)
"RTN","PSDTER2",18,0)
 W !!,"Updating ",PSDTERM,"."
"RTN","PSDTER2",19,0)
 S DR=".02///NO;1////0;2////#;3////58;4////$C(8);6////W $C(27)_""E""_$C(27)_""&l0O""_$C(27)_""(8U""_$C(27)_""(s0p""_$S($G(PSDCPI)=10:""10h14"",1:""12h12"")_""v0s0b6T"";10////$C(27)_""(s10H"";12////$C(27)_""(s12H"""
"RTN","PSDTER2",20,0)
 S DR(1,3.2,1)="12.15////$C(27)_""&l8C"";12.16////$C(27)_""&l12C"";60////$S($D(PSDX2):$C(27)_""*p""_(PSDX2-1*300+200)_""y*p""_(PSDX1-1*810+38)_""X"",1:"""")_$C(27)_""(0Y""_$C(27)_""(s0p8.1h12v0s0b0T*"""
"RTN","PSDTER2",21,0)
 S DR(1,3.2,2)="61////""*""_$C(27)_""&l0O""_$C(27)_""(8U""_$C(27)_""(s0p""_$S($G(PSDCPI)=10:""10h14"",1:""12h12"")_""v0s0b6T"""
"RTN","PSDTER2",22,0)
 D ^DIE K DR S PSDKY=1 Q
"RTN","PSDTER2",23,0)
 S DIR(0)="Y",DIR("A")=PSDTERM(2),DIR("B")="No",DIR("?")=PSDTERM(3)
"RTN","PSDTER2",24,0)
 W ! D ^DIR K DIR Q:Y<1
"RTN","PSDTER2",25,0)
 S DIC="^%ZIS(1,",DIC(0)="AEMQL",DLAYGO=3.5,DIC("B")="HP III BARCODER"
"RTN","PSDTER2",26,0)
 W ! D ^DIC K DIC Q:Y<1  S DIE="^%ZIS(1,",DA=+Y
"RTN","PSDTER2",27,0)
 S DR=".02;1;1.95///NO;2///TERMINAL;3////^S X=PSDTERM(1);4///YES;5///YES;9////0;10////#;11////58;12////$C(8);61;62;63///NOT SPOOLED;64////96"
"RTN","PSDTER2",28,0)
 D ^DIE
"RTN","PSDTER2",29,0)
KY ;Kyocera update
"RTN","PSDTER2",30,0)
 I $G(PSDALL)!(PSDCHO=3)!($G(PSDCHO(1))=2) D  G:'$G(PSDALL) BEG
"RTN","PSDTER2",31,0)
 .I $G(PSDALL) D  Q:Y<1
"RTN","PSDTER2",32,0)
 ..S DIC="^%ZIS(2,",DIC(0)="L",DLAYGO=3.2,X="P-KYOCERA-BARCODE"
"RTN","PSDTER2",33,0)
 ..D ^DIC K DIC Q:Y<1  S PSDTERM=$P(Y,U,2),PSDTERM(1)=+Y
"RTN","PSDTER2",34,0)
 ..I '$P(Y,U,3) S DIC="^%ZIS(2,",DA=+Y W !,"Current settings:",! D EN^DIQ
"RTN","PSDTER2",35,0)
 ..S DIR(0)="Y",DIR("A",1)=PSDTERM(4),DIR("?")=PSDTERM(6),DIR("B")="No"
"RTN","PSDTER2",36,0)
 ..S DIR("A")="into the "_PSDTERM_" Terminal Type" W ! D ^DIR K DIR
"RTN","PSDTER2",37,0)
 .S DIE="^%ZIS(2,",DA=PSDTERM(1)
"RTN","PSDTER2",38,0)
 .W !!,"Updating ",PSDTERM,"."
"RTN","PSDTER2",39,0)
 .S PSDKY="W ""!R! RES;FONT ""_$S($G(PSDCPI)=10:1,1:6)_"";EXIT;"""
"RTN","PSDTER2",40,0)
 .S PSDKY(1)="""!R! FONT 6; UNIT D; ""_$S('$D(PSDX1):"""",PSDX1=1:""MRP 0,-60 ; "",1:"""")_$S('$D(PSDX1):"""",1:""MRP ""_(PSDX1>1*810+38)_"" , 0 ;"")_"" BARC 19, N, '"""
"RTN","PSDTER2",41,0)
 .S PSDKY(2)="""', 60, 60, 3, 6, 6, 6, 3, 6, 6, 6;""_$S('$D(PSDX1):"""",PSDX1=PSDCNT:""MRP 0 , 60;"",1:"""")_""EXIT;"""
"RTN","PSDTER2",42,0)
 .S DR=".02///NO;1////0;2////#;3////66;4////$C(8);6////^S X=PSDKY;60////^S X=PSDKY(1);61////^S X=PSDKY(2)"
"RTN","PSDTER2",43,0)
 .D ^DIE
"RTN","PSDTER2",44,0)
 .S DIR(0)="Y",DIR("A")=PSDTERM(2),DIR("B")="No",DIR("?")=PSDTERM(3)
"RTN","PSDTER2",45,0)
 .W ! D ^DIR K DIR Q:Y<1
"RTN","PSDTER2",46,0)
 .S DIC="^%ZIS(1,",DIC(0)="AEMQL",DLAYGO=3.5,DIC("B")="KYOCERA BARCODER"
"RTN","PSDTER2",47,0)
 .W ! D ^DIC K DIC Q:Y<1  S DIE="^%ZIS(1,",DA=+Y
"RTN","PSDTER2",48,0)
 .S DR=".02;1;1.95///NO;2///TERMINAL;3////^S X=PSDTERM(1);4///YES;5///YES;9////0;10////#;11////66;12////$C(8)" D ^DIE
"RTN","PSDTER2",49,0)
TRAK ;Trakker update
"RTN","PSDTER2",50,0)
 I $G(PSDALL)!(PSDCHO=4)!($G(PSDCHO(1))=3) D TRAK^PSDTER1
"RTN","PSDTER2",51,0)
END I '$G(PSDKY) S XPDQUIT=2 W !!,"Sorry these routines cannot be loaded without setting up the terminal type.",!! Q
"RTN","PSDTRA")
0^233^B18224157
"RTN","PSDTRA",1,0)
PSDTRA ;BIR/JPW-Transfer Stock Entries from AOU to NAOU ; 18 July 94
"RTN","PSDTRA",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRA",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDTRA",4,0)
 K LOC("TR") S CNT=0,PSDUZ=DUZ
"RTN","PSDTRA",5,0)
 W !!,"This option will copy the stock entries from one AR/WS AOU into NAOUs you ",!,"select.  No more than 10 transfers are allowed at a time.",!,"Inactive drugs will not be transferred.",!
"RTN","PSDTRA",6,0)
NUM ;ask how many NAOUs
"RTN","PSDTRA",7,0)
 W ! K DA,DIR,DIRUT S DIR(0)="SO^1:Transfer to one NAOU;2:Transfer to multiple NAOUs",DIR("A")="Select Transfer Type"
"RTN","PSDTRA",8,0)
 S DIR("?",1)="Answer '1' if transfer to only ONE NAOU is desired, '2' if the same",DIR("?")="stock list is to be copied into more than one NAOU, or '^' to quit."
"RTN","PSDTRA",9,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS=+Y
"RTN","PSDTRA",10,0)
METHOD ;asks method of stock transfer
"RTN","PSDTRA",11,0)
 W !!!,"=>  Methods of transferring stock drug data."
"RTN","PSDTRA",12,0)
 W ! K DA,DIR,DIRUT S DIR(0)="SO^1:Drug name only;2:Drug name, stock level, and location code;3:Drug name, stock level, location code, and inv. types",DIR("A")="Select Transfer Method"
"RTN","PSDTRA",13,0)
 S DIR("?",1)="Answer '1' if transfer of ONLY drug name is desired, '2' if you wish to",DIR("?",2)="copy drug name, stock level, and location code, '3' if you wish to transfer"
"RTN","PSDTRA",14,0)
 S DIR("?")="drug name, stock level, location code, and inv. type, or '^' to quit."
"RTN","PSDTRA",15,0)
 D ^DIR K DIR G:$D(DIRUT) END S MTR=+Y
"RTN","PSDTRA",16,0)
FROM ;select AR/WS AOU to transfer stock from
"RTN","PSDTRA",17,0)
 W ! K DA,DIC S DIC=58.1,DIC(0)="QEA",DIC("A")="Select AR/WS AOU to transfer drug stock FROM: " D ^DIC K DIC G:Y<0 END S AOU=+Y
"RTN","PSDTRA",18,0)
TO ;select NAOU(s) to transfer stock to
"RTN","PSDTRA",19,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU to transfer drug stock INTO: ",DIC("S")="I $P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE"
"RTN","PSDTRA",20,0)
 D ^DIC K DIC G:(Y<0)&(ANS=1) END G:(Y<0)&(ANS=2) CHK S LOC("TR",+Y)="",CNT=CNT+1
"RTN","PSDTRA",21,0)
 I CNT>9 W !!,"You may not transfer TO additional NAOUs at this time.",!,"Enter the option again to transfer to more NAOUs.",!
"RTN","PSDTRA",22,0)
 I ANS=2,CNT<10 G TO
"RTN","PSDTRA",23,0)
CHK ;checks for valid NAOUs
"RTN","PSDTRA",24,0)
 G:'$O(LOC("TR",0)) END
"RTN","PSDTRA",25,0)
 W !!,?5,"I will now COPY the ENTIRE drug stock list from ",!,?5,$P(^PSI(58.1,AOU,0),"^"),"  into" F TR=0:0 S TR=$O(LOC("TR",TR)) Q:'TR  W !,?5,$P(^PSD(58.8,TR,0),"^")
"RTN","PSDTRA",26,0)
 W !!,?5,"I will transfer ",$S(MTR=3:"drug name, stock level, location code and types.",MTR=2:"drug name, stock level and location code.",1:"drug name only.")
"RTN","PSDTRA",27,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure that is what you want to do"
"RTN","PSDTRA",28,0)
 S DIR("?",1)="Answer 'YES' if you wish to transfer stock entries,",DIR("?")="answer 'NO' or <RET> if you do not."
"RTN","PSDTRA",29,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) G END
"RTN","PSDTRA",30,0)
QUE W !!,"This job will automatically be queued to run in the background.",!,"You'll be notified by a MailMan message when the transfer is completed.",!
"RTN","PSDTRA",31,0)
 S NAOUT="" F TR=0:0 S TR=$O(LOC("TR",TR)) Q:'TR  S NAOUT=NAOUT_TR_","
"RTN","PSDTRA",32,0)
 S ZTIO="",ZTDTH=$H,ZTRTN="^PSDTRA1",ZTDESC="Transfer AR/WS Stock to NAOU" S (ZTSAVE("MTR"),ZTSAVE("NAOUT"),ZTSAVE("AOU"),ZTSAVE("PSDUZ"))=""
"RTN","PSDTRA",33,0)
 D ^%ZTLOAD W !!,"Transfer AR/WS Stock Drugs to NAOU has been queued.",!
"RTN","PSDTRA",34,0)
END K ANS,AOU,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LOC,MTR,NAOUT,PSDUZ,TR,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDTRA",35,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRA1")
0^234^B6750678
"RTN","PSDTRA1",1,0)
PSDTRA1 ;BIR/JPW-Transfer Stock AR/WS AOU to NAOU (cont'd) ; 23 Jun 93
"RTN","PSDTRA1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRA1",3,0)
TO ;loops through local array to obtain NAOU to
"RTN","PSDTRA1",4,0)
 F LOOP=1:1:($L(NAOUT,",")-1) S NAOU=$P(NAOUT,",",LOOP) D FROM
"RTN","PSDTRA1",5,0)
MSG ;sends message information
"RTN","PSDTRA1",6,0)
 K XMY,^TMP("PSDTRA",$J)
"RTN","PSDTRA1",7,0)
 S XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMY(PSDUZ)="",XMSUB="CS PHARM STOCK TRANSFER FROM AR/WS",^TMP("PSDTRA",$J,1,0)="Stock Drugs from AR/WS "_$P(^PSI(58.1,AOU,0),"^")_" have been transferred into:"
"RTN","PSDTRA1",8,0)
 F LOOP=1:1:($L(NAOUT,",")-1) S NAOU=$P(NAOUT,",",LOOP),^TMP("PSDTRA",$J,(LOOP+1),0)=$P(^PSD(58.8,NAOU,0),"^")
"RTN","PSDTRA1",9,0)
 S:'$D(XMY) XMY(.5)="" S XMTEXT="^TMP(""PSDTRA"",$J," D ^XMD K XMY,^TMP("PSDTRA",$J)
"RTN","PSDTRA1",10,0)
END K AOU,DA,DIC,DIE,DINUM,DR,PSDRG,PSDR,LOC,LOOP,MTR,NAOU,NAOUT,PSDUZ,STK,TYP,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDTRA1",11,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRA1",12,0)
 Q
"RTN","PSDTRA1",13,0)
FROM ;finds drugs and sets data transfer
"RTN","PSDTRA1",14,0)
 F PSDR=0:0 S PSDR=$O(^PSI(58.1,AOU,1,"B",PSDR)) Q:'PSDR  S PSDRG=+$O(^PSI(58.1,AOU,1,"B",PSDR,0)) I PSDRG D
"RTN","PSDTRA1",15,0)
 .Q:'$D(^PSI(58.1,AOU,1,PSDRG,0))
"RTN","PSDTRA1",16,0)
 .Q:$P($G(^PSDRUG(PSDR,2)),"^",3)'["N"
"RTN","PSDTRA1",17,0)
 .I $P(^PSI(58.1,AOU,1,PSDRG,0),"^",3)]"",$P(^(0),"^",3)'>DT Q
"RTN","PSDTRA1",18,0)
 .I '$D(^PSD(58.8,NAOU,1,0)) S ^(0)="^58.8001IP^^"
"RTN","PSDTRA1",19,0)
 .Q:$D(^PSD(58.8,NAOU,1,PSDR,0))
"RTN","PSDTRA1",20,0)
 .K DA,DIC,DIE,DR S DA(1)=NAOU,DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,",(X,DINUM)=PSDR K DD,DO D FILE^DICN K DIC
"RTN","PSDTRA1",21,0)
 .I MTR'=1 S LOC=$P(^PSI(58.1,AOU,1,PSDRG,0),"^",8),STK=$P(^(0),"^",2),DA=PSDR,DA(1)=NAOU,DR="1///"_LOC_";2///"_STK D ^DIE K DIE
"RTN","PSDTRA1",22,0)
 .I MTR=3,'$D(^PSI(58.1,AOU,1,PSDRG,2,0)) Q
"RTN","PSDTRA1",23,0)
 .I MTR=3,'$D(^PSD(58.8,NAOU,1,PSDR,2,0)) S ^(0)="^58.800116PA^^"
"RTN","PSDTRA1",24,0)
 .I MTR=3 F TYP=0:0 S TYP=$O(^PSI(58.1,AOU,1,PSDRG,2,TYP)) Q:'TYP  S DA(1)=PSDR,DA(2)=NAOU,DIC="^PSD(58.8,"_NAOU_",1,"_PSDR_",2,",DIC(0)="L",(X,DINUM)=TYP K DD,DO D FILE^DICN K DIC
"RTN","PSDTRA1",25,0)
 Q
"RTN","PSDTRAK")
0^235^B16147747
"RTN","PSDTRAK",1,0)
PSDTRAK ;BIR/DAV-Set up TRAKKER ; 14 Sept 94
"RTN","PSDTRAK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRAK",3,0)
 W !," "
"RTN","PSDTRAK",4,0)
 W !,"To set-up the TRAKKER:"
"RTN","PSDTRAK",5,0)
 W !," "
"RTN","PSDTRAK",6,0)
 W !,"(1) Turn on the TRAKKER by pressing the [on-off] key."
"RTN","PSDTRAK",7,0)
 W !," "
"RTN","PSDTRAK",8,0)
 W !,"    After the TRAKKER performs a self test the following prompt will"
"RTN","PSDTRAK",9,0)
 W !,"    be displayed   ""Ready"""
"RTN","PSDTRAK",10,0)
 W !," "
"RTN","PSDTRAK",11,0)
 W !,"(2) At this point hold down the [ctrl] key and press [E]."
"RTN","PSDTRAK",12,0)
 W !," "
"RTN","PSDTRAK",13,0)
 W !,"    The words ""CONFIGURATION MENU:"" should appear."
"RTN","PSDTRAK",14,0)
 W !," "
"RTN","PSDTRAK",15,0)
 W !,"(3) Press the [Enter] key until you are prompted to ""Select or modify"
"RTN","PSDTRAK",16,0)
 W !,"    operating parms.?"" The word NO will appear. Use the space key to"
"RTN","PSDTRAK",17,0)
 W !,"    toggle this to a YES and press [Enter]."
"RTN","PSDTRAK",18,0)
 W !," "
"RTN","PSDTRAK",19,0)
 W !,"(4) Use the [enter] key to step through the basic operating parameters"
"RTN","PSDTRAK",20,0)
 W !," "
"RTN","PSDTRAK",21,0)
 W !,"    NOTE - in most cases the proper selection can be made using the"
"RTN","PSDTRAK",22,0)
 W !,"    [space] key."
"RTN","PSDTRAK",23,0)
 W !," "
"RTN","PSDTRAK",24,0)
11 D WAIT G Q:$D(ERR)
"RTN","PSDTRAK",25,0)
 W !,"a. BEEP VOLUME - low or high"
"RTN","PSDTRAK",26,0)
 W !,"b. DIPLAY MODE...............BUFFERED"
"RTN","PSDTRAK",27,0)
 W !,"c. CHARACTER SET.............US-ASCII"
"RTN","PSDTRAK",28,0)
 W !,"d. CPU RESP REQD MODE........DISABLED"
"RTN","PSDTRAK",29,0)
 W !,"e. PREAMBLE REQUIRED.........NO"
"RTN","PSDTRAK",30,0)
 W !,"f. LASER SCANNER MODE........ONE SHOT TRIGGER"
"RTN","PSDTRAK",31,0)
 W !,"g. APPEND TIME TO DATA.......NO"
"RTN","PSDTRAK",32,0)
 W !,"h. TIME IS SECONDS...........YES"
"RTN","PSDTRAK",33,0)
 W !,"i. RESUME IRL PROGRAM........NO"
"RTN","PSDTRAK",34,0)
 W !,"j. AUTOMATIC SHUT-OFF........10"
"RTN","PSDTRAK",35,0)
 W !,"k. BACKLIGHT TIMEOUT.........60"
"RTN","PSDTRAK",36,0)
 W !," "
"RTN","PSDTRAK",37,0)
 W !,"(5) The next configuration heading is ""Select or modify comm protocol?"""
"RTN","PSDTRAK",38,0)
 W !," "
"RTN","PSDTRAK",39,0)
 W !,"    Use space bar to obtain POINT TO POINT"
"RTN","PSDTRAK",40,0)
 W !," "
"RTN","PSDTRAK",41,0)
 W !,"(6) Use the [enter] key to step through the ""comm protocol"""
"RTN","PSDTRAK",42,0)
 W !," "
"RTN","PSDTRAK",43,0)
22 D WAIT G Q:$D(ERR)
"RTN","PSDTRAK",44,0)
 W !,"a. CHECK CTS............NO"
"RTN","PSDTRAK",45,0)
 W !,"b. XON..................Hold down the [ctrl] key & press [Q], to get DC1"
"RTN","PSDTRAK",46,0)
 W !,"c. XOFF.................Hold down the [ctrl] key & press [S], to get DC3"
"RTN","PSDTRAK",47,0)
 W !,"d. BAUD RATE............1200"
"RTN","PSDTRAK",48,0)
 W !,"e. PARITY...............DISABLED"
"RTN","PSDTRAK",49,0)
 W !,"f. DATA BITS............8"
"RTN","PSDTRAK",50,0)
 W !,"g. STOP BITS............1"
"RTN","PSDTRAK",51,0)
 W !,"h. TIMEOUT DELAY........10 seconds"
"RTN","PSDTRAK",52,0)
 W !,"i. INTERCHAR DELAY......50 milliseconds"
"RTN","PSDTRAK",53,0)
 W !,"j. TURNAROUND DELAY.....0 ms."
"RTN","PSDTRAK",54,0)
 W !," "
"RTN","PSDTRAK",55,0)
 W !,"At this point you will see ""Select or modify barcodes?"""
"RTN","PSDTRAK",56,0)
 W !,"Press [alt] then [E] to exit and save changes."
"RTN","PSDTRAK",57,0)
 W !,"or"
"RTN","PSDTRAK",58,0)
 W !,"Hold [ctrl] and press [Z] to exit without saving changes."
"RTN","PSDTRAK",59,0)
 W !," "
"RTN","PSDTRAK",60,0)
33 D WAIT G Q:$D(ERR)
"RTN","PSDTRAK",61,0)
 W !," "
"RTN","PSDTRAK",62,0)
 W !,"TO DOWNLOAD to the TRAKKER or to UPLOAD to DHCP, new entries must be made"
"RTN","PSDTRAK",63,0)
 W !,"in the TERMINAL TYPE and DEVICE files."
"RTN","PSDTRAK",64,0)
 W !," "
"RTN","PSDTRAK",65,0)
 W !,"TERMINAL TYPE"
"RTN","PSDTRAK",66,0)
 W !,"-------------"
"RTN","PSDTRAK",67,0)
 W !,"NAME               : C-VT420 (9440)"
"RTN","PSDTRAK",68,0)
 W !,"FORM FEED          : #"
"RTN","PSDTRAK",69,0)
 W !,"OPEN EXECUTE       : W $C(0)"
"RTN","PSDTRAK",70,0)
 W !,"DESCRIPTION        : TRAKKER 9440 TO AUX PORT OF VT420"
"RTN","PSDTRAK",71,0)
 W !,"OPEN PRINTER PORT  : W $C(27)_"_"""[5i"""
"RTN","PSDTRAK",72,0)
 W !,"CLOSE PRINTER PORT : W $C(27)_"_"""4i"""
"RTN","PSDTRAK",73,0)
 W !,"RIGHT MARGIN       : 80"
"RTN","PSDTRAK",74,0)
 W !,"PAGE LENGTH        : 9999"
"RTN","PSDTRAK",75,0)
 W !," "
"RTN","PSDTRAK",76,0)
44 D WAIT G Q:$D(ERR)
"RTN","PSDTRAK",77,0)
 W !,"DEVICE"
"RTN","PSDTRAK",78,0)
 W !,"-------"
"RTN","PSDTRAK",79,0)
 W !,"NAME               : TRAKKERSL"
"RTN","PSDTRAK",80,0)
 W !,"LOCATION           : SLAVED 9440 FROM VT420 AUX PORT"
"RTN","PSDTRAK",81,0)
 W !,"MARGIN WIDTH       : 80"
"RTN","PSDTRAK",82,0)
 W !,"PAGE LENGTH        : 9999"
"RTN","PSDTRAK",83,0)
 W !,"MNEMONIC           : TRAKKERSL"
"RTN","PSDTRAK",84,0)
 W !,"FORM FEED          : #"
"RTN","PSDTRAK",85,0)
 W !,"BACK SPACE         : $C(8)"
"RTN","PSDTRAK",86,0)
 W !,"SUB-TYPE           : C-VT420 (9440)"
"RTN","PSDTRAK",87,0)
 W !,"TYPE               : TERMINAL"
"RTN","PSDTRAK",88,0)
 W !,"$I                 : 0 (zero)"
"RTN","PSDTRAK",89,0)
 W !," "
"RTN","PSDTRAK",90,0)
 W !,"---------------------------------------------------------------------"
"RTN","PSDTRAK",91,0)
Q K AN,ERR Q
"RTN","PSDTRAK",92,0)
WAIT I $E(IOST)["C" W !,"Press <RET> to continue, or '^' to abort: " R AN:DTIME I AN="^"!('$T) S ERR=1 Q
"RTN","PSDTRAK",93,0)
 I $E(IOST)["C" W @IOF,"SET UP PROCEDURES",!
"RTN","PSDTRAK",94,0)
 Q
"RTN","PSDTRN")
0^236^B19444622
"RTN","PSDTRN",1,0)
PSDTRN ;BIR/JPW-Transfer Stock Entries from NAOU to NAOU ; 18 July 94
"RTN","PSDTRN",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRN",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDTRN",4,0)
 K LOC("TR") S CNT=0,PSDUZ=DUZ
"RTN","PSDTRN",5,0)
 W !!,"This option will copy the stock entries from one NAOU into NAOUs you select.",!,"No more than 10 transfers are allowed at a time.",!,"Inactive drugs will not be transferred.",!
"RTN","PSDTRN",6,0)
NUM ;ask how many NAOUs
"RTN","PSDTRN",7,0)
 W ! K DA,DIR,DIRUT S DIR(0)="SO^1:Transfer to one NAOU;2:Transfer to multiple NAOUs",DIR("A")="Select Transfer Type"
"RTN","PSDTRN",8,0)
 S DIR("?",1)="Answer '1' if transfer to only ONE NAOU is desired, '2' if the same",DIR("?")="stock list is to be copied into more than one NAOU, or '^' to quit"
"RTN","PSDTRN",9,0)
 D ^DIR K DIR G:$D(DIRUT) END S ANS=+Y
"RTN","PSDTRN",10,0)
METHOD ;asks method of stock transfer
"RTN","PSDTRN",11,0)
 W !!!,"=>  Methods of transferring stock drug data."
"RTN","PSDTRN",12,0)
 W ! K DA,DIR,DIRUT S DIR(0)="SO^1:Drug name only;2:Drug name, stock level, and location code;3:Drug name, stock level, location code, and inv. types",DIR("A")="Select Transfer Method"
"RTN","PSDTRN",13,0)
 S DIR("?",1)="Answer '1' if transfer of ONLY drug name is desired, '2' if you wish to",DIR("?",2)="copy drug name, stock level, and location code, '3' if you wish to transfer"
"RTN","PSDTRN",14,0)
 S DIR("?")="drug name, stock level, location code, and inv. type, or '^' to quit"
"RTN","PSDTRN",15,0)
 D ^DIR K DIR G:$D(DIRUT) END S MTR=+Y
"RTN","PSDTRN",16,0)
FROM ;select NAOU to transfer stock from
"RTN","PSDTRN",17,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU to transfer drug stock FROM: ",DIC("S")="I $P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC G:Y<0 END S NSF=+Y
"RTN","PSDTRN",18,0)
TO ;select NAOU(s) to transfer stock to
"RTN","PSDTRN",19,0)
 W ! K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU to transfer drug stock INTO: ",DIC("S")="I $P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE"
"RTN","PSDTRN",20,0)
 D ^DIC K DIC G:(Y<0)&(ANS=1) END G:(Y<0)&(ANS=2) CHK S LOC("TR",+Y)="",CNT=CNT+1
"RTN","PSDTRN",21,0)
 I CNT>9 W !!,"You may not transfer TO additional NAOUs at this time.",!,"Enter the option again to transfer to more NAOUs."
"RTN","PSDTRN",22,0)
 I ANS=2,CNT<10 G TO
"RTN","PSDTRN",23,0)
CHK ;checks for valid NAOUs
"RTN","PSDTRN",24,0)
 I $D(LOC("TR",NSF)) W $C(7),$C(7),!!,?5," ** NOT ALLOWED to transfer out of and into SAME NAOU! **" G END
"RTN","PSDTRN",25,0)
 G:'$O(LOC("TR",0)) END
"RTN","PSDTRN",26,0)
 W !!,?5,"I will now COPY the ENTIRE drug stock list from ",!,?5,$P(^PSD(58.8,NSF,0),"^")," into" F TR=0:0 S TR=$O(LOC("TR",TR)) Q:'TR  W !,?5,$P(^PSD(58.8,TR,0),"^")
"RTN","PSDTRN",27,0)
 W !!,?5,"I will transfer ",$S(MTR=3:"drug name, stock level, location code and types.",MTR=2:"drug name, stock level and location code.",1:"drug name only.")
"RTN","PSDTRN",28,0)
 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure that is what you want to do"
"RTN","PSDTRN",29,0)
 S DIR("?",1)="Answer 'YES' if you wish to transfer stock entries,",DIR("?")="answer 'NO' or <RET> if you do not."
"RTN","PSDTRN",30,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) G END
"RTN","PSDTRN",31,0)
QUE W !!,"This job will automatically be queued to run in the background.",!,"You will be notified by a MailMan message when the transfer is completed.",!
"RTN","PSDTRN",32,0)
 S NAOUT="" F TR=0:0 S TR=$O(LOC("TR",TR)) Q:'TR  S NAOUT=NAOUT_TR_","
"RTN","PSDTRN",33,0)
 S ZTIO="",ZTDTH=$H,ZTRTN="^PSDTRN1",ZTDESC="Transfer NAOU Stock" S (ZTSAVE("MTR"),ZTSAVE("NAOUT"),ZTSAVE("NSF"),ZTSAVE("PSDUZ"))=""
"RTN","PSDTRN",34,0)
 D ^%ZTLOAD W !!,"'Transfer Stock Drugs from NAOU to NAOU' has been queued.",!
"RTN","PSDTRN",35,0)
END K ANS,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LOC,MTR,NAOUT,NSF,PSDUZ,TR,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRN1")
0^237^B5977161
"RTN","PSDTRN1",1,0)
PSDTRN1 ;BIR/JPW-Transfer Stock NAOU to NAOU (cont'd) ; 23 Jun 93
"RTN","PSDTRN1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRN1",3,0)
TO ;loops through local array to obtain NAOU transferring to
"RTN","PSDTRN1",4,0)
 F LOOP=1:1:($L(NAOUT,",")-1) S NAOU=$P(NAOUT,",",LOOP) D FROM
"RTN","PSDTRN1",5,0)
MSG ;sends message information
"RTN","PSDTRN1",6,0)
 K XMY,^TMP("PSDNTR",$J)
"RTN","PSDTRN1",7,0)
 S XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMY(PSDUZ)="",XMSUB="CS PHARM NAOU STOCK TRANSFER",^TMP("PSDNTR",$J,1,0)="Stock Drugs from "_$P(^PSD(58.8,NSF,0),"^")_" have been transferred into: "
"RTN","PSDTRN1",8,0)
 F LOOP=1:1:($L(NAOUT,",")-1) S NAOU=$P(NAOUT,",",LOOP),^TMP("PSDNTR",$J,(LOOP+1),0)=$P(^PSD(58.8,NAOU,0),"^")
"RTN","PSDTRN1",9,0)
 S:'$D(XMY) XMY(.5)="" S XMTEXT="^TMP(""PSDNTR"",$J," D ^XMD K XMY,^TMP("PSDNTR",$J)
"RTN","PSDTRN1",10,0)
END K DA,DIC,DIE,DINUM,LOC,LOOP,MTR,NAOU,NAOUT,NSF,PSDR,PSDUZ,STK,TYP,X,XMDUZ,XMSUB,XMTEXT,Y
"RTN","PSDTRN1",11,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRN1",12,0)
 Q
"RTN","PSDTRN1",13,0)
FROM ;finds drugs and sets data transfer
"RTN","PSDTRN1",14,0)
 F PSDR=0:0 S PSDR=$O(^PSD(58.8,NSF,1,PSDR)) Q:'PSDR  D
"RTN","PSDTRN1",15,0)
 .Q:'$D(^PSD(58.8,NSF,1,PSDR,0))
"RTN","PSDTRN1",16,0)
 .Q:$P($G(^PSDRUG(PSDR,2)),"^",3)'["N"
"RTN","PSDTRN1",17,0)
 .I $P(^PSD(58.8,NSF,1,PSDR,0),"^",14)]"",$P(^(0),"^",14)'>DT Q
"RTN","PSDTRN1",18,0)
 .I '$D(^PSD(58.8,NAOU,1,0)) S ^(0)="^58.8001IP^^"
"RTN","PSDTRN1",19,0)
 .Q:$D(^PSD(58.8,NAOU,1,PSDR,0))
"RTN","PSDTRN1",20,0)
 .K DA,DIC,DIE,DR S DA(1)=NAOU,DIC(0)="L"
"RTN","PSDTRN1",21,0)
 .S (DIC,DIE)="^PSD(58.8,"_NAOU_",1,",(X,DINUM)=PSDR K DD,DO
"RTN","PSDTRN1",22,0)
 .D FILE^DICN K DIC
"RTN","PSDTRN1",23,0)
 .I MTR'=1 S LOC=$P(^PSD(58.8,NSF,1,PSDR,0),"^",2),STK=$P(^(0),"^",3),DA=PSDR,DA(1)=NAOU,DR="1///"_LOC_";2///"_STK D ^DIE K DIE
"RTN","PSDTRN1",24,0)
 .I MTR=3,'$D(^PSD(58.8,NSF,1,PSDR,2,0)) Q
"RTN","PSDTRN1",25,0)
 .I MTR=3,'$D(^PSD(58.8,NAOU,1,PSDR,2,0)) S ^(0)="^58.800116PA^^"
"RTN","PSDTRN1",26,0)
 .I MTR=3 F TYP=0:0 S TYP=$O(^PSD(58.8,NSF,1,PSDR,2,TYP)) Q:'TYP  S DA(1)=PSDR,DA(2)=NAOU,DIC="^PSD(58.8,"_NAOU_",1,"_PSDR_",2,",DIC(0)="L",(X,DINUM)=TYP K DD,DO D FILE^DICN K DIC
"RTN","PSDTRN1",27,0)
 Q
"RTN","PSDTRV")
0^238^B16960376
"RTN","PSDTRV",1,0)
PSDTRV ;BIR/JPW-Transfer CS Drugs between Vaults ; 10 Aug 94
"RTN","PSDTRV",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRV",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDTRV",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to transfer",!,?12,"controlled substances between dispensing sites.",!!,"PSJ RPHARM security key required.",! Q
"RTN","PSDTRV",5,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH Q
"RTN","PSDTRV",6,0)
 S PSDUZ=DUZ,PSDUZN=$P($G(^VA(200,PSDUZ,0)),"^")
"RTN","PSDTRV",7,0)
 N X,X1 D SIG^XUSESIG G:X1="" END
"RTN","PSDTRV",8,0)
FROM ;select FROM disp site
"RTN","PSDTRV",9,0)
 S (ADD,PSDOUT)=0
"RTN","PSDTRV",10,0)
 K DA,DIC W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Transfer from Dispensing Site: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDTRV",11,0)
 D ^DIC K DIC G:Y<0 END S PSDS=+Y,PSDSN=$P(Y,"^",2)
"RTN","PSDTRV",12,0)
DRUG ;select drug
"RTN","PSDTRV",13,0)
 I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! S PSDOUT=1 G END
"RTN","PSDTRV",14,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDTRV",15,0)
 S DIC("A")="Select DRUG From "_PSDSN_": "
"RTN","PSDTRV",16,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC
"RTN","PSDTRV",17,0)
 I ($D(DTOUT))!($D(DUOUT)) S PSDOUT=1 G END
"RTN","PSDTRV",18,0)
 I Y<0,'PSDOUT G FROM
"RTN","PSDTRV",19,0)
 S PSDR=+Y,PSDRN=$P($G(^PSDRUG(PSDR,0)),"^"),QTY=+$P($G(^PSD(58.8,PSDS,1,PSDR,0)),"^",4),NBKU=$P(^(0),"^",8),NPKG=$P(^(0),"^",9),MFG=$P(^(0),"^",10),LOT=$P(^(0),"^",11),EXP=$P(^(0),"^",12)
"RTN","PSDTRV",20,0)
 I 'QTY W $C(7),!!,PSDRN," has a zero balance.",!,"Please select another drug to transfer.",!! G DRUG
"RTN","PSDTRV",21,0)
QTY ;enter quantity
"RTN","PSDTRV",22,0)
 W !!,?5,"Breakdown Unit: ",NBKU,?35,"Package Size: ",NPKG,!
"RTN","PSDTRV",23,0)
 K DIR,DA S DIR(0)="NO^1:"_QTY_":0"
"RTN","PSDTRV",24,0)
 S DIR("A")="Enter Quantity to Transfer"
"RTN","PSDTRV",25,0)
 S DIR("?")="Answer with a whole number between 1 and "_QTY
"RTN","PSDTRV",26,0)
 D ^DIR K DIR
"RTN","PSDTRV",27,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)  D MSG G END
"RTN","PSDTRV",28,0)
 S TQTY=+Y
"RTN","PSDTRV",29,0)
TO ;transfer TO disp site (not restricted to inpat site)
"RTN","PSDTRV",30,0)
 K DA,DIC W ! S DIC=58.8,DIC(0)="QEA",DIC("A")="Transfer to Dispensing Site: ",DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"RTN","PSDTRV",31,0)
 D ^DIC K DIC G:Y<0 END S VAULT=+Y,VAULTN=$P(Y,"^",2)
"RTN","PSDTRV",32,0)
CHK I VAULT=PSDS W $C(7),!!,?5,"** NOT ALLOWED to transfer out of and into SAME Dispensing Site! **" G END
"RTN","PSDTRV",33,0)
 I '$D(^PSD(58.8,VAULT,1,PSDR,0)) W $C(7),!!,?5,"** ",VAULTN," does not stock ",PSDRN,"! **",! D ADD G:PSDOUT END G ASK
"RTN","PSDTRV",34,0)
 I $P(^PSD(58.8,VAULT,1,PSDR,0),"^",8)'=NBKU W $C(7),!!,"** The Narcotic Breakdown Unit does not match." D MSG G END
"RTN","PSDTRV",35,0)
ASK ;ask ok
"RTN","PSDTRV",36,0)
 W !!,"Transferring: ",TQTY," (",NBKU,")",!,"From: ",PSDSN,"    To: ",VAULTN,!!
"RTN","PSDTRV",37,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("A")="Is this OK",DIR("B")="NO"
"RTN","PSDTRV",38,0)
 S DIR("?")="Answer 'YES' to post this transfer, 'NO' or '^' to quit."
"RTN","PSDTRV",39,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG G END
"RTN","PSDTRV",40,0)
 D:ADD ADD1 D ^PSDTRV1 G:'PSDOUT DRUG
"RTN","PSDTRV",41,0)
END K %,%H,%I,ADD,BAL,CNT,DA,DD,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DO,DR,DTOUT,DUOUT,EXP,JJ,LOT,MFG,NBKU,NPKG,PSDT,PSDLES,PSDOUT,PSDR,PSDREC,PSDRN,PSDS,PSDSN
"RTN","PSDTRV",42,0)
 K PSDUZ,PSDUZN,QTY,RDT,TEMP,TQTY,VAULT,VAULTN,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDTRV",43,0)
 Q
"RTN","PSDTRV",44,0)
MSG W $C(7),!!,"No action taken.",!!
"RTN","PSDTRV",45,0)
 Q
"RTN","PSDTRV",46,0)
ADD ;ask to add drug
"RTN","PSDTRV",47,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to continue"
"RTN","PSDTRV",48,0)
 S DIR("?")="Answer 'YES' to continue with this transfer, 'NO' or '^' to quit."
"RTN","PSDTRV",49,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG S PSDOUT=1 Q
"RTN","PSDTRV",50,0)
 S ADD=1
"RTN","PSDTRV",51,0)
 Q
"RTN","PSDTRV",52,0)
ADD1 ;add drug
"RTN","PSDTRV",53,0)
 Q:$D(^PSD(58.8,VAULT,1,PSDR,0))
"RTN","PSDTRV",54,0)
 S:'$D(^PSD(58.8,VAULT,1,0)) ^PSD(58.8,VAULT,1,0)="^58.8001IP^^"
"RTN","PSDTRV",55,0)
 K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+VAULT_",1,",DA(1)=+VAULT,(X,DINUM)=+PSDR D FILE^DICN K DA,DIC
"RTN","PSDTRV1")
0^239^B12908934
"RTN","PSDTRV1",1,0)
PSDTRV1 ;BIR/JPW-Transfer CS Drugs between Vaults (cont'd) ; 17 Nov 93
"RTN","PSDTRV1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRV1",3,0)
UPDATE ;update vault balances
"RTN","PSDTRV1",4,0)
 D CHK G:PSDLES END
"RTN","PSDTRV1",5,0)
 W !!,"Updating vault on-hand balances now..." F CNT=1:1:2 D CALC
"RTN","PSDTRV1",6,0)
 W "done!",!! D:ADD MSG
"RTN","PSDTRV1",7,0)
 S (ADD,PSDOUT)=0
"RTN","PSDTRV1",8,0)
END K %,%H,%I,BAL,CNT,DA,DD,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DLAYGO,DO,DR,DTOUT,DUOUT,EXP,JJ,LOT,MFG,NBKU,NPKG,PSDT,PSDLES,PSDR,PSDREC,PSDRN
"RTN","PSDTRV1",9,0)
 K QTY,RDT,TEMP,TQTY,VAULT,VAULTN,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","PSDTRV1",10,0)
 Q
"RTN","PSDTRV1",11,0)
CALC ;sub/add qty from dsp sites
"RTN","PSDTRV1",12,0)
 W $S(CNT=2:VAULTN,1:PSDSN)_"..."
"RTN","PSDTRV1",13,0)
 S TEMP=$S(CNT=2:VAULT,1:PSDS),TQTY=-TQTY
"RTN","PSDTRV1",14,0)
 F  L +^PSD(58.8,TEMP,1,PSDR,0):0 I  Q
"RTN","PSDTRV1",15,0)
 D NOW^%DTC S PSDT=+%
"RTN","PSDTRV1",16,0)
 S BAL(CNT)=$P(^PSD(58.8,TEMP,1,PSDR,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+TQTY,$P(BAL(CNT),"^",2)=+BAL(CNT)+TQTY
"RTN","PSDTRV1",17,0)
 L -^PSD(58.8,TEMP,1,PSDR,0)
"RTN","PSDTRV1",18,0)
ADD ;find entry number
"RTN","PSDTRV1",19,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSDTRV1",20,0)
FIND S PSDREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSDREC)) S $P(^PSD(58.81,0),"^",3)=PSDREC G FIND
"RTN","PSDTRV1",21,0)
 K DIC,DLAYGO S DIC(0)="L",(DIC,DLAYGO)=58.81,(X,DINUM)=PSDREC D ^DIC K DIC,DLAYGO
"RTN","PSDTRV1",22,0)
 L -^PSD(58.81,0)
"RTN","PSDTRV1",23,0)
DIE ;update transaction data
"RTN","PSDTRV1",24,0)
 K DA,DIE,DR S DA=PSDREC,DIE=58.81
"RTN","PSDTRV1",25,0)
 S DR="1////16;2////"_+TEMP_";4////"_PSDR_";3////"_PSDT_";Q;5////"_TQTY_";6////"_PSDUZ_";9////"_$P(BAL(CNT),"^")_";100////1"
"RTN","PSDTRV1",26,0)
 D ^DIE K DA,DIE,DR W !,"Still updating..."
"RTN","PSDTRV1",27,0)
 ;update vault drug info
"RTN","PSDTRV1",28,0)
 I CNT=2 K DA,DIE,DR S DIE="^PSD(58.8,"_+TEMP_",1,",DA(1)=+TEMP,DA=+PSDR,DR="I 'ADD S Y=9;7////"_NBKU_";8////"_NPKG_";9////"_MFG_";10////"_LOT_";11////"_EXP D ^DIE K DA,DIE,DR
"RTN","PSDTRV1",29,0)
 S:'$D(^PSD(58.8,+TEMP,1,+PSDR,4,0)) ^PSD(58.8,+TEMP,1,+PSDR,4,0)="^58.800119PA^^"
"RTN","PSDTRV1",30,0)
 I '$D(^PSD(58.8,+TEMP,1,+PSDR,4,PSDREC,0)) K DA,DIC,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+TEMP_",1,"_+PSDR_",4,",DA(2)=+TEMP,DA(1)=+PSDR,(X,DINUM)=PSDREC D FILE^DICN K DA,DIC
"RTN","PSDTRV1",31,0)
 Q
"RTN","PSDTRV1",32,0)
CHK ;check for valid bal
"RTN","PSDTRV1",33,0)
 S PSDLES=0 D:TQTY>$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4)
"RTN","PSDTRV1",34,0)
 .W $C(7),!!,"=>   The drug balance is "_+$P(^PSD(58.8,PSDS,1,PSDR,0),"^",4)_".  You cannot transfer "_TQTY_" for this drug.",! S PSDLES=1
"RTN","PSDTRV1",35,0)
 .W "No action taken.",!
"RTN","PSDTRV1",36,0)
 Q
"RTN","PSDTRV1",37,0)
MSG ;send mailman message with transfer info
"RTN","PSDTRV1",38,0)
 K XMY,^TMP("PSDTRV",$J) D NOW^%DTC S Y=X X ^DD("DD") S RDT=Y S ^TMP("PSDTRV",$J,1,0)="Controlled Substances have been transferred between Dispensing Sites."
"RTN","PSDTRV1",39,0)
 S ^TMP("PSDTRV",$J,2,0)="Run Date: "_RDT,^TMP("PSDTRV",$J,3,0)=""
"RTN","PSDTRV1",40,0)
 S ^TMP("PSDTRV",$J,4,0)="Drug: "_PSDRN
"RTN","PSDTRV1",41,0)
 S ^TMP("PSDTRV",$J,5,0)="Transferred from: "_PSDSN,^TMP("PSDTRV",$J,6,0)="Transferred and Added to: "_VAULTN
"RTN","PSDTRV1",42,0)
 S ^TMP("PSDTRV",$J,7,0)="Quantity ("_NBKU_"): "_TQTY,^TMP("PSDTRV",$J,8,0)="Pharmacist: "_PSDUZN
"RTN","PSDTRV1",43,0)
 S XMSUB="CS DRUG TRANSFER BETWEEN VAULTS",XMTEXT="^TMP(""PSDTRV"",$J,",XMDUZ="CONTROLLED SUBSTANCES PHARMACY" F JJ=0:0 S JJ=$O(^XUSEC("PSDMGR",JJ)) Q:'JJ  S XMY(JJ)=""
"RTN","PSDTRV1",44,0)
 S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDTRV",$J)
"RTN","PSDTRV1",45,0)
 Q
"RTN","PSDTRVR")
0^240^B12885307
"RTN","PSDTRVR",1,0)
PSDTRVR ;BIR/JPW-CS Transfer Between Vaults Report ; 6 July 94
"RTN","PSDTRVR",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRVR",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDTRVR",4,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ))&('$D(^XUSEC("PSD TECH",DUZ))) W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print CS reports.",!!,"PSJ RPHARM or PSD TECH security key required.",! Q
"RTN","PSDTRVR",5,0)
 W !!,"CS Transfer Controlled Substances Between Vaults Report",!
"RTN","PSDTRVR",6,0)
ASK K DA,DIR,DTOUT,DUOUT S DIR(0)="YO",DIR("A")="Do you wish to print a Transferred/Received By signature line",DIR("B")="NO"
"RTN","PSDTRVR",7,0)
 S DIR("?")="Answer YES to print the signature line, NO or <RET> to omit the signature line."
"RTN","PSDTRVR",8,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G END
"RTN","PSDTRVR",9,0)
 S ASK=+Y
"RTN","PSDTRVR",10,0)
SITE ;sel one, some or all inp sites
"RTN","PSDTRVR",11,0)
 S CNT=0 F JJ=0:0 S JJ=$O(^PS(59.4,JJ)) Q:'JJ  I $P($G(^PS(59.4,JJ,0)),"^",31) S SITE(JJ)="",CNT=CNT+1
"RTN","PSDTRVR",12,0)
 I 'CNT W !!,"There are no Inpatient Sites defined for Controlled Substances use.",!,"Please contact your Pharmacy Coordinator for assistance.",! G END
"RTN","PSDTRVR",13,0)
 G:CNT=1 DATE K SITE
"RTN","PSDTRVR",14,0)
 W !!,?2,"You may display Dispensing Sites transfers from a single Inpatient Site, ",!,?2,"several Inpatient Sites, or enter ^ALL to select all Inpatient Sites.",!!
"RTN","PSDTRVR",15,0)
 F  S DIC=59.4,DIC("A")="Select Inpatient Site: ",DIC(0)="QEA",DIC("S")="I $P(^(0),""^"",31)" D ^DIC K DIC Q:Y<0  S SITE(+Y)=""
"RTN","PSDTRVR",16,0)
 G:'$T END I '$D(SITE)&(X'="^ALL") G END
"RTN","PSDTRVR",17,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PS(59.4,PSD)) Q:'PSD  I $P($G(^PS(59.4,PSD,0)),"^",31) S SITE(PSD)=""
"RTN","PSDTRVR",18,0)
DATE ;ask date range
"RTN","PSDTRVR",19,0)
 W ! K %DT S %DT="AE",%DT("A")="Start with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDTRVR",20,0)
 S PSDSD=Y D D^DIQ S PSDATE=Y,%DT("A")="End with Date: " D ^%DT I Y<0 S PSDOUT=1 G END
"RTN","PSDTRVR",21,0)
 I Y<PSDSD W !!,"The ending date of the range must be later than the starting date." G DATE
"RTN","PSDTRVR",22,0)
 S PSDED=Y D D^DIQ S PSDATE=PSDATE_"^"_Y,PSDSD=PSDSD-.0001,PSDED=PSDED+.9999
"RTN","PSDTRVR",23,0)
DEV ;dev & queue info
"RTN","PSDTRVR",24,0)
 W !!,"This report is designed for a 80 column format.",!,"You may queue this report to print at a later time.",!!
"RTN","PSDTRVR",25,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDTRVR",26,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDTRVR1",ZTDESC="CS Transfer Between Vaults Report" D SAVE,^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDTRVR",27,0)
 U IO G ^PSDTRVR1
"RTN","PSDTRVR",28,0)
END ;
"RTN","PSDTRVR",29,0)
 K %,%DT,%H,%I,%ZIS,ASK,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,OK
"RTN","PSDTRVR",30,0)
 K POP,PSD,PSDATE,PSDED,PSDOUT,PSDSD,SITE,SITEN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDTRVR",31,0)
 K ^TMP("PSDTRVR",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRVR",32,0)
 Q
"RTN","PSDTRVR",33,0)
SAVE S (ZTSAVE("SITE("),ZTSAVE("PSDSD"),ZTSAVE("PSDED"),ZTSAVE("ASK"),ZTSAVE("PSDATE"))=""
"RTN","PSDTRVR",34,0)
 Q
"RTN","PSDTRVR1")
0^241^B10855633
"RTN","PSDTRVR1",1,0)
PSDTRVR1 ;BIR/JPW-CS Transfer Vaults Report (cont'd) ; 4 Aug 94
"RTN","PSDTRVR1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDTRVR1",3,0)
START ;compile data
"RTN","PSDTRVR1",4,0)
 K ^TMP("PSDTRVR",$J) S PSDOUT=0
"RTN","PSDTRVR1",5,0)
 F JJ=0:0 S JJ=$O(SITE(JJ)) Q:'JJ  F TYP="M","S" F PSDS=0:0 S PSDS=$O(^PSD(58.8,"ASITE",+JJ,TYP,PSDS)) Q:'PSDS  S PSDS(PSDS)=""
"RTN","PSDTRVR1",6,0)
 F PSDS=0:0 S PSDS=$O(PSDS(PSDS)) Q:'PSDS  F PSD=PSDSD:0 S PSD=$O(^PSD(58.81,"ACT",PSD)) Q:'PSD!(PSD>PSDED)  F PSDR=0:0 S PSDR=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR)) Q:'PSDR  D
"RTN","PSDTRVR1",7,0)
 .F PSDA=0:0 S PSDA=$O(^PSD(58.81,"ACT",PSD,PSDS,PSDR,16,PSDA)) Q:'PSDA  D
"RTN","PSDTRVR1",8,0)
 ..Q:'$D(^PSD(58.81,PSDA,0))  S NODE=^PSD(58.81,PSDA,0)
"RTN","PSDTRVR1",9,0)
 ..S PSDRN=$S($P($G(^PSDRUG(+PSDR,0)),"^")]"":$P(^(0),"^"),1:"ZZ/UNKNOWN")
"RTN","PSDTRVR1",10,0)
 ..S PSDSN=$S($P($G(^PSD(58.8,+PSDS,0)),"^")]"":$P(^(0),"^"),1:"ZZ/UNKNOWN")
"RTN","PSDTRVR1",11,0)
 ..S QTY=$P(NODE,"^",6),PHARM=$P(NODE,"^",7),PHARMN=$S($P($G(^VA(200,+PHARM,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSDTRVR1",12,0)
 ..S ^TMP("PSDTRVR",$J,PSDSN,PSDRN,PSD)=QTY_"^"_PHARMN
"RTN","PSDTRVR1",13,0)
PRINT ;print transfer between vaults by date
"RTN","PSDTRVR1",14,0)
 S (PG,PSDOUT)=0
"RTN","PSDTRVR1",15,0)
 K LN S $P(LN,"-",80)="" D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDTRVR1",16,0)
 I '$D(^TMP("PSDTRVR",$J)) D HDR W !!,?10,"****  NO TRANSFER BETWEEN VAULTS DATA FOR THIS REPORT  ****" G DONE
"RTN","PSDTRVR1",17,0)
 S JJ="" F  S JJ=$O(^TMP("PSDTRVR",$J,JJ)) Q:JJ=""!(PSDOUT)  D HDR S KK="" F  S KK=$O(^TMP("PSDTRVR",$J,JJ,KK)) Q:KK=""!(PSDOUT)  D:$Y+9>IOSL HDR Q:PSDOUT  W !,?2,"=> ",KK,!! F LL=0:0 S LL=$O(^TMP("PSDTRVR",$J,JJ,KK,LL)) Q:'LL!(PSDOUT)  D
"RTN","PSDTRVR1",18,0)
 .D:$Y+8>IOSL HDR Q:PSDOUT
"RTN","PSDTRVR1",19,0)
 .S NODE=^TMP("PSDTRVR",$J,JJ,KK,LL),QTY=$P(NODE,"^")
"RTN","PSDTRVR1",20,0)
 .S Y=LL X ^DD("DD") S PSDT=Y
"RTN","PSDTRVR1",21,0)
 .W PSDT,?25,$J(QTY,8),?40,$P(NODE,"^",2),!
"RTN","PSDTRVR1",22,0)
 .W:ASK !,?5,"Transferred/Received By: _______________________________________________",!!
"RTN","PSDTRVR1",23,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDTRVR1",24,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDTRVR1",25,0)
END ;
"RTN","PSDTRVR1",26,0)
 K %,%DT,%H,%I,%ZIS,ASK,CNT,DA,DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,JJ,KK,LL,LN,NODE,OK
"RTN","PSDTRVR1",27,0)
 K PG,PHARM,PHARMN,POP,PSD,PSDA,PSDATE,PSDED,PSDOUT,PSDR,PSDRN,PSDS,PSDSD,PSDSN,PSDT,QTY,RPDT,SITE,SITEN,TYP,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDTRVR1",28,0)
 K ^TMP("PSDTRVR",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDTRVR1",29,0)
 Q
"RTN","PSDTRVR1",30,0)
HDR ;header for log
"RTN","PSDTRVR1",31,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDTRVR1",32,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"TRANSFER CS DRUGS BETWEEN DISP SITES REPORT",?70,"Page: ",PG
"RTN","PSDTRVR1",33,0)
 W !,?15,"TRANSACTIONS FOR PERIOD ",$P(PSDATE,"^")," TO ",$P(PSDATE,"^",2)
"RTN","PSDTRVR1",34,0)
 W:$G(JJ)]"" !,?15,"DISPENSING SITE: ",JJ
"RTN","PSDTRVR1",35,0)
 W !,?15,"PRINTED ",RPDT,!!,?2,"=> DRUG",!!,"DATE/TIME TRANSFERRED",?28,"QUANTITY",?40,"TRANSFERRED BY",!,LN,!
"RTN","PSDTRVR1",36,0)
 Q
"RTN","PSDUP2")
0^242^B10638755
"RTN","PSDUP2",1,0)
PSDUP2 ;BHM/DAV,JPW-IRL Program/Data Download Vault Inv. Pharm. ; 5 Oct 94
"RTN","PSDUP2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUP2",3,0)
VAULT ;vault upload
"RTN","PSDUP2",4,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDUP2",5,0)
 S OK=$S($D(^XUSEC("PSDMGR",DUZ)):1,$D(^XUSEC("PSJ RPHARM",DUZ)):1,1:0)
"RTN","PSDUP2",6,0)
 I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"upload this data to the trakker.",!!,"PSDMGR or PSJ RPHARM security key required.",! K OK Q
"RTN","PSDUP2",7,0)
ASKD ;ask disp location
"RTN","PSDUP2",8,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDUP2",9,0)
 G:$P(PSDSITE,U,5) LOOP
"RTN","PSDUP2",10,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Dispensing Site to Inventory: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDUP2",11,0)
 D ^DIC K DIC
"RTN","PSDUP2",12,0)
 I Y<0 W $C(7),!!,"No action taken!",!! G Q
"RTN","PSDUP2",13,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDUP2",14,0)
LOOP ;loop and set ^tmp for trakker
"RTN","PSDUP2",15,0)
 K ^TMP("PSDUP2",$J)
"RTN","PSDUP2",16,0)
 W !!,"Compiling inventory data...",!
"RTN","PSDUP2",17,0)
 F PSD=0:0 S PSD=$O(^PSD(58.8,+PSDS,1,PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S QTY=+$P($G(^(0)),"^",4) D
"RTN","PSDUP2",18,0)
 .S PSDN=$S($P($G(^PSDRUG(+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDUP2",19,0)
 .S ^TMP("PSDUP2",$J,PSD)=PSDN_"^"_QTY
"RTN","PSDUP2",20,0)
START ;begin
"RTN","PSDUP2",21,0)
 D ^%ZIS G Q:POP S PSDIO=IO,PSDIO(0)=IOST(0) U IO X:$D(^%ZIS(2,IOST(0),10)) ^(10)
"RTN","PSDUP2",22,0)
 W !,"/$",!,".$1",!,"$$",!,"I",!
"RTN","PSDUP2",23,0)
 K X,X1
"RTN","PSDUP2",24,0)
1 S X1=$S('$D(X1):$O(^PSD(58.88,1,1,0)),1:$O(^PSD(58.88,1,1,X1))) G 2:X1'>0 S X=$P(^PSD(58.88,1,1,X1,0),"::")
"RTN","PSDUP2",25,0)
 F Y=$L(X):-1:0 Q:$E(X,Y)'=" "  S X=$E(X,1,(Y-1))
"RTN","PSDUP2",26,0)
 W X,! G 1
"RTN","PSDUP2",27,0)
 ;
"RTN","PSDUP2",28,0)
2 W !,"ER",!,"//",! X:$D(^%ZIS(2,IOST(0),11)) ^(11) H 3 W !,"Awaiting TRAKKER signal" F X=1:1 R XX:DTIME Q:XX="*"  G NOSIGN:XX["^"!('$T)
"RTN","PSDUP2",29,0)
 U PSDIO X:$D(^%ZIS(2,PSDIO(0),10)) ^(10)
"RTN","PSDUP2",30,0)
 I XX="*" W "*"_+PSDS,!
"RTN","PSDUP2",31,0)
 K DATA
"RTN","PSDUP2",32,0)
DATA S DATA="" F  S DATA=$O(^TMP("PSDUP2",$J,DATA))  G QQ:DATA="" S DATA(1)=^TMP("PSDUP2",$J,DATA) W DATA,!,$P(DATA(1),U),!,$P(DATA(1),U,2),!
"RTN","PSDUP2",33,0)
QQ W !,"END" X:$D(^%ZIS(2,PSDIO(0),11)) ^(11)
"RTN","PSDUP2",34,0)
 W !,"You can now disconnect the TRAKKER.",!! H 2
"RTN","PSDUP2",35,0)
 D ^%ZISC
"RTN","PSDUP2",36,0)
 G Q
"RTN","PSDUP2",37,0)
UPLOAD ;upload data to DHCP
"RTN","PSDUP2",38,0)
 W !!,"Use the Send Data to DHCP option on the TRAKKER at this time.",!
"RTN","PSDUP2",39,0)
 K CNT,X,^TMP("PSDWN2",$J) S PSDCON=$C(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31)
"RTN","PSDUP2",40,0)
UP1 R !,X:DTIME S CNT=$G(CNT)+1 G FIL:$L(X)'>1 I CNT=1 S ^TMP("PSDWN2",$J,CNT,0)=$TR(X,PSDCON) G UP1
"RTN","PSDUP2",41,0)
 S ^TMP("PSDWN2",$J,CNT,0)=$TR(X,PSDCON) G UP1
"RTN","PSDUP2",42,0)
FIL G ^PSDFIL2
"RTN","PSDUP2",43,0)
Q K CNT,DA,DATA,DIC,DTOUT,DUOUT,OK,POP,PSD,PSDCON,PSDIO,PSDN,PSDS,PSDSN,PROG,QTY,X,X1,XX,Y
"RTN","PSDUP2",44,0)
 K ^TMP("PSDUP2",$J)
"RTN","PSDUP2",45,0)
 Q
"RTN","PSDUP2",46,0)
NOSIGN W $C(7),$C(7),!!,"No signal received from the TRAKKER",! G Q
"RTN","PSDUP3")
0^243^B8827324
"RTN","PSDUP3",1,0)
PSDUP3 ;BHM/DAV,JPW-IRL Program/Data Download Vault Inv. Insp. ; 5 Oct 94
"RTN","PSDUP3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUP3",3,0)
VAULT ;vault upload
"RTN","PSDUP3",4,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDUP3",5,0)
ASKD ;ask disp location
"RTN","PSDUP3",6,0)
 S PSDS=$P(PSDSITE,U,3),PSDSN=$P(PSDSITE,U,4)
"RTN","PSDUP3",7,0)
 G:$P(PSDSITE,U,5) LOOP
"RTN","PSDUP3",8,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)[""M"":1,$P(^(0),""^"",2)[""S"":1,1:0)",DIC("A")="Select Dispensing Site to Inventory: ",DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDUP3",9,0)
 D ^DIC K DIC
"RTN","PSDUP3",10,0)
 I Y<0 W $C(7),!!,"No action taken!",!! G Q
"RTN","PSDUP3",11,0)
 S PSDS=+Y,PSDSN=$P(Y,"^",2),$P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=PSDSN
"RTN","PSDUP3",12,0)
LOOP ;loop and set ^tmp for trakker
"RTN","PSDUP3",13,0)
 K ^TMP("PSDUP3",$J)
"RTN","PSDUP3",14,0)
 W !!,"Compiling inventory data...",!
"RTN","PSDUP3",15,0)
 F PSD=0:0 S PSD=$O(^PSD(58.8,+PSDS,1,PSD)) Q:'PSD  I $D(^PSD(58.8,+PSDS,1,PSD,0)) S QTY=+$P($G(^(0)),"^",4) D
"RTN","PSDUP3",16,0)
 .S PSDN=$S($P($G(^PSDRUG(+PSD,0)),"^")]"":$P($G(^(0)),"^"),1:"UNKNOWN")
"RTN","PSDUP3",17,0)
 .S ^TMP("PSDUP3",$J,PSD)=PSDN_"^"_QTY
"RTN","PSDUP3",18,0)
START ;begin
"RTN","PSDUP3",19,0)
 D ^%ZIS G Q:POP S PSDIO=IO,PSDIO(0)=IOST(0) U IO X:$D(^%ZIS(2,IOST(0),10)) ^(10)
"RTN","PSDUP3",20,0)
 W !,"/$",!,".$1",!,"$$",!,"I",!
"RTN","PSDUP3",21,0)
 K X,X1
"RTN","PSDUP3",22,0)
1 S X1=$S('$D(X1):$O(^PSD(58.88,1,1,0)),1:$O(^PSD(58.88,1,1,X1))) G 2:X1'>0 S X=$P(^PSD(58.88,1,1,X1,0),"::")
"RTN","PSDUP3",23,0)
 F Y=$L(X):-1:0 Q:$E(X,Y)'=" "  S X=$E(X,1,(Y-1))
"RTN","PSDUP3",24,0)
 W X,! G 1
"RTN","PSDUP3",25,0)
 ;
"RTN","PSDUP3",26,0)
2 W !,"ER",!,"//",! X:$D(^%ZIS(2,IOST(0),11)) ^(11) H 3 W !,"Awaiting TRAKKER signal" F X=1:1 R XX:DTIME Q:XX="*"  G NOSIGN:XX["^"!('$T)
"RTN","PSDUP3",27,0)
 U PSDIO X:$D(^%ZIS(2,PSDIO(0),10)) ^(10)
"RTN","PSDUP3",28,0)
 I XX="*" W "*"_+PSDS,!
"RTN","PSDUP3",29,0)
 K DATA
"RTN","PSDUP3",30,0)
DATA S DATA="" F  S DATA=$O(^TMP("PSDUP3",$J,DATA))  G QQ:DATA="" S DATA(1)=^TMP("PSDUP3",$J,DATA) W DATA,!,$P(DATA(1),U),!,$P(DATA(1),U,2),!
"RTN","PSDUP3",31,0)
QQ W !,"END" X:$D(^%ZIS(2,PSDIO(0),11)) ^(11)
"RTN","PSDUP3",32,0)
 W !,"You can now disconnect the TRAKKER.",!! H 2
"RTN","PSDUP3",33,0)
 D ^%ZISC
"RTN","PSDUP3",34,0)
 G Q
"RTN","PSDUP3",35,0)
UPLOAD ;upload data to DHCP
"RTN","PSDUP3",36,0)
 W !!,"Use the Send Data to DHCP option on the TRAKKER at this time.",!
"RTN","PSDUP3",37,0)
 K CNT,X,^TMP("PSDWN3",$J) S PSDCON=$C(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31)
"RTN","PSDUP3",38,0)
UP1 R !,X:DTIME S CNT=$G(CNT)+1 G FIL:$L(X)'>1 I CNT=1 S ^TMP("PSDWN3",$J,CNT,0)=$TR(X,PSDCON) G UP1
"RTN","PSDUP3",39,0)
 S ^TMP("PSDWN3",$J,CNT,0)=$TR(X,PSDCON) G UP1
"RTN","PSDUP3",40,0)
FIL G ^PSDFIL3
"RTN","PSDUP3",41,0)
Q K CNT,DA,DATA,DIC,DTOUT,DUOUT,OK,POP,PSD,PSDCON,PSDIO,PSDN,PSDS,PSDSN,PROG,QTY,X,X1,XX,Y
"RTN","PSDUP3",42,0)
 K ^TMP("PSDUP3",$J)
"RTN","PSDUP3",43,0)
 Q
"RTN","PSDUP3",44,0)
NOSIGN W $C(7),$C(7),!!,"No signal received from the TRAKKER",! G Q
"RTN","PSDUSER")
0^244^B7784204
"RTN","PSDUSER",1,0)
PSDUSER ;BIR/LTL- MFI - NDES USERS Message builder for HL7 ; 16 Aug 95
"RTN","PSDUSER",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUSER",3,0)
 N DIC,DIR,DIRUT,DTOUT,DUOUT,PSD,PSDOUT,X,Y
"RTN","PSDUSER",4,0)
PIC S DIC="^VA(200,",DIC(0)="AEMQ"
"RTN","PSDUSER",5,0)
 S DIC("S")="I $S('$P($G(^(0)),U,11):1,$P($G(^(0)),U,11)>DT:1,1:0)"
"RTN","PSDUSER",6,0)
 F  S DIC("W")="W ""  USER ID:  "",Y,""  "",$P($G(^DIC(3.1,+$P($G(^VA(200,Y,0)),U,9),0)),U)" D ^DIC Q:Y<1  S PSD($P(Y,U,2))=+Y_U_$P($G(^VA(200,+Y,.13)),U)
"RTN","PSDUSER",7,0)
 K DIC Q:$D(DTOUT)!($D(DUOUT))!($O(PSD(0))']"")
"RTN","PSDUSER",8,0)
 S PSD(1)=$O(PSD(0)) G:$O(PSD(PSD(1)))']"" HL
"RTN","PSDUSER",9,0)
PRI S DIR(0)="Y",DIR("A")="Would you like to print a list of the names you are about to transmit",DIR("B")="Yes"
"RTN","PSDUSER",10,0)
 S DIR("?")="You will be able to add or remove names from the list after reviewing"
"RTN","PSDUSER",11,0)
 W ! D ^DIR K DIR Q:$D(DIRUT)  G:Y=0 HL
"RTN","PSDUSER",12,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS Q:POP
"RTN","PSDUSER",13,0)
 I $D(IO("Q")) N ZTIO,ZTDTH,ZTSK S ZTRTN="Q^PSDUSER",ZTDESC="CS Print User List for NDES interface",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS G HL
"RTN","PSDUSER",14,0)
Q N LN,PG S (PG,PSDOUT)=0 D HEADER S PSD=1
"RTN","PSDUSER",15,0)
 F  S PSD=$O(PSD(PSD)) Q:PSD']""  D:$Y+2>IOSL HEADER Q:PSDOUT  W !,PSD,?32,+PSD(PSD),?42,$P(PSD(PSD),U,2)
"RTN","PSDUSER",16,0)
 Q
"RTN","PSDUSER",17,0)
HL N HLERR,HLEVN,HLNDAP,HLMTN,HLFS,HLECH,HLSDATA,HLSDT,HLSEC,HLCHAR,HLDA,HLDAN,HLDAP,HLDT,HLDT1,HLNDAP0,HLPID,HLQ,HLVER
"RTN","PSDUSER",18,0)
 S HLNDAP="PSD-NDES" D INIT^HLTRANS I $D(HLERR) D KILL^HLTRANS Q
"RTN","PSDUSER",19,0)
 S HLMTN="MFN",HLEVN=1,HLSDT=DT
"RTN","PSDUSER",20,0)
MFI S ^TMP("HLS",$J,HLSDT,1)="MFI"_HLFS_200_$E(HLECH)_"NEW PERSON"_HLFS_"PSD-CS"_HLFS_"UPD"_HLFS_HLDT1_HLFS_HLFS_"AL",PSD=0,PSD(1)=2
"RTN","PSDUSER",21,0)
MFE F  S PSD=$O(PSD(PSD)) Q:PSD']""  S ^TMP("HLS",$J,HLSDT,PSD(1))="MFE"_HLFS_"MUP"_HLFS_HLFS_HLFS_PSD(PSD)_$E(HLECH)_PSD,PSD(1)=PSD(1)+1
"RTN","PSDUSER",22,0)
SEND D EN^HLTRANS Q
"RTN","PSDUSER",23,0)
HEADER I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDUSER",24,0)
 I $$S^%ZTLOAD W !!,"Task#",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDUSER",25,0)
 W:$Y @IOF S $P(LN,"-",81)="",PG=PG+1
"RTN","PSDUSER",26,0)
 W !,"User List for Narcotic Dispensing Equipment System",?70
"RTN","PSDUSER",27,0)
 W "Page:  ",PG,!,LN,!?5,"NAME",?32,"USER ID",?42,"PHONE NUMBER",!,LN
"RTN","PSDUTL")
0^245^B15937132
"RTN","PSDUTL",1,0)
PSDUTL ;BIR/CML,JPW,LTL-Utility Routine for FileMan Functions ; 21 Dec 94
"RTN","PSDUTL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL",3,0)
INACT ;check for inactive date on drug for 'D' x-ref (file 58.8)
"RTN","PSDUTL",4,0)
 K PSDFLAG I '$D(^PSD(58.8,DA(2),1,DA(1),"I")) S PSDFLAG=1 Q
"RTN","PSDUTL",5,0)
 S:$O(^PSD(58.8,DA(2),1,DA(1),"I"))>DT PSDFLAG=1
"RTN","PSDUTL",6,0)
 Q
"RTN","PSDUTL",7,0)
DELR ;deletes inactivation reason when inactivation date deleted
"RTN","PSDUTL",8,0)
 I $D(^PSD(58.8,DA(1),1,DA,0)),'$P(^(0),"^",14) S $P(^(0),"^",15,16)="^"
"RTN","PSDUTL",9,0)
 Q
"RTN","PSDUTL",10,0)
IG ;reset sort keys for inventory groups
"RTN","PSDUTL",11,0)
 F INVGRP=0:0 S INVGRP=$O(^PSI(58.2,INVGRP)) Q:'INVGRP  I $O(^PSI(58.2,INVGRP,3,"D",0)) W "." D IGSET
"RTN","PSDUTL",12,0)
 K INVGRP
"RTN","PSDUTL",13,0)
 Q
"RTN","PSDUTL",14,0)
IGSET S CNT=0 F SK=0:0 S SK=$O(^PSI(58.2,INVGRP,3,"D",SK)) Q:'SK  S NAOU=$O(^PSI(58.2,INVGRP,3,"D",SK,0)),CNT=CNT+1,NAOULP(CNT)=NAOU
"RTN","PSDUTL",15,0)
 F SK=0:0 S SK=$O(NAOULP(SK)) Q:'SK  S NSK=SK*100,DA(1)=INVGRP,DA=NAOULP(SK),DIE="^PSI(58.2,"_DA(1)_",3,",DR="2///"_NSK D ^DIE K DIE
"RTN","PSDUTL",16,0)
 K D,D0,DA,D1,DIC,DIE,DQ,DR,X,CNT,NAOU,NAOULP,NSK,SK
"RTN","PSDUTL",17,0)
 Q
"RTN","PSDUTL",18,0)
NAOU ;checks for NAOU inpatient site
"RTN","PSDUTL",19,0)
 S SITE=0
"RTN","PSDUTL",20,0)
 I '$P($G(^PSD(58.8,PSDA,0)),"^",3) W !!,"You must define a CS inpatient site for this NAOU.",!,"Use the 'Create the Narcotic Area of Use' option to add this data.",!!,"Press <RET> to continue " R X:DTIME S SITE=1 W @IOF
"RTN","PSDUTL",21,0)
 K X
"RTN","PSDUTL",22,0)
 Q
"RTN","PSDUTL",23,0)
STAT ;sets order status cross-reference in file 58.85 (field 6)
"RTN","PSDUTL",24,0)
 N PSDNL,PSDD,PSDREQ S PSDNL=$P(^PSD(58.85,DA,0),"^",3),PSDD=$P(^(0),"^",4),PSDREQ=$P(^(0),"^",5)
"RTN","PSDUTL",25,0)
 Q:'PSDNL!('PSDD)!('PSDREQ)
"RTN","PSDUTL",26,0)
 S ^PSD(58.85,"AC",X,PSDNL,PSDD,PSDREQ,DA)=""
"RTN","PSDUTL",27,0)
 Q
"RTN","PSDUTL",28,0)
KSTAT ;kills order status cross-reference in file 58.85 (field 6)
"RTN","PSDUTL",29,0)
 N PSDNL,PSDD,PSDREQ S PSDNL=$P(^PSD(58.85,DA,0),"^",3),PSDD=$P(^(0),"^",4),PSDREQ=$P(^(0),"^",5)
"RTN","PSDUTL",30,0)
 Q:'PSDNL!('PSDD)!('PSDREQ)
"RTN","PSDUTL",31,0)
 K ^PSD(58.85,"AC",X,PSDNL,PSDD,PSDREQ,DA)
"RTN","PSDUTL",32,0)
 Q
"RTN","PSDUTL",33,0)
REQ ;sets request # x-ref in file 58.85 (field 4)
"RTN","PSDUTL",34,0)
 N PSDNL,PSDD S PSDNL=$P(^PSD(58.85,DA,0),"^",3),PSDD=$P(^(0),"^",4)
"RTN","PSDUTL",35,0)
 Q:'PSDNL!('PSDD)
"RTN","PSDUTL",36,0)
 S ^PSD(58.85,"AD",PSDNL,PSDD,X,DA)=""
"RTN","PSDUTL",37,0)
 Q
"RTN","PSDUTL",38,0)
KREQ ;kills request # x-ref in file 58.85 (field 4)
"RTN","PSDUTL",39,0)
 N PSDNL,PSDD S PSDNL=$P(^PSD(58.85,DA,0),"^",3),PSDD=$P(^(0),"^",4)
"RTN","PSDUTL",40,0)
 Q:'PSDNL!('PSDD)
"RTN","PSDUTL",41,0)
 K ^PSD(58.85,"AD",PSDNL,PSDD,X,DA)
"RTN","PSDUTL",42,0)
 Q
"RTN","PSDUTL",43,0)
SAD ;sets 'AD' xref in file 58.81 (field 10)
"RTN","PSDUTL",44,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL",45,0)
 S ^PSD(58.81,"AD",X,PSDNL,DA)="" K PSDNL
"RTN","PSDUTL",46,0)
 Q
"RTN","PSDUTL",47,0)
KAD ;kills 'AD' x-ref in file 58.81 (field 10)
"RTN","PSDUTL",48,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL",49,0)
 K ^PSD(58.81,"AD",X,PSDNL,DA),PSDNL
"RTN","PSDUTL",50,0)
 Q
"RTN","PSDUTL",51,0)
SAF ;set 'AF' x-ref on field 3 in 58.81
"RTN","PSDUTL",52,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL",53,0)
 I 'PSDNL!('PSDTYPE) K PSDNL,PSDTYPE Q
"RTN","PSDUTL",54,0)
 S ^PSD(58.81,"AF",X,PSDNL,PSDTYPE,DA)="" K PSDNL,PSDTYPE
"RTN","PSDUTL",55,0)
 Q
"RTN","PSDUTL",56,0)
KAF ;kill 'AF' x-ref on field 3 in 58.81
"RTN","PSDUTL",57,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL",58,0)
 I 'PSDNL!('PSDTYPE) K PSDNL,PSDTYPE Q
"RTN","PSDUTL",59,0)
 K ^PSD(58.81,"AF",X,PSDNL,PSDTYPE,DA),PSDNL,PSDTYPE
"RTN","PSDUTL",60,0)
 Q
"RTN","PSDUTL",61,0)
SAFL ;set 'AF' (for loc) on field 3 in 58.81
"RTN","PSDUTL",62,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL",63,0)
 I 'PSDATT!('PSDTYPE) K PSDATT,PSDTYPE Q
"RTN","PSDUTL",64,0)
 S ^PSD(58.81,"AF",PSDATT,X,PSDTYPE,DA)="" K PSDATT,PSDTYPE
"RTN","PSDUTL",65,0)
 Q
"RTN","PSDUTL",66,0)
KAFL ;kill 'AF' (for loc) on field 3 in 58.81
"RTN","PSDUTL",67,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL",68,0)
 I 'PSDATT!('PSDTYPE) K PSDATT,PSDTYPE Q
"RTN","PSDUTL",69,0)
 K ^PSD(58.81,"AF",PSDATT,X,PSDTYPE,DA),PSDATT,PSDTYPE
"RTN","PSDUTL",70,0)
 Q
"RTN","PSDUTL",71,0)
SASITE ;set 'ASITE' x-ref on field 2 in 58.8
"RTN","PSDUTL",72,0)
 Q:$P(^PSD(58.8,DA,0),"^",2)=""
"RTN","PSDUTL",73,0)
 S PSDTYPE=$P(^PSD(58.8,DA,0),"^",2)
"RTN","PSDUTL",74,0)
 S ^PSD(58.8,"ASITE",X,PSDTYPE,DA)="" K PSDTYPE
"RTN","PSDUTL",75,0)
 Q
"RTN","PSDUTL",76,0)
KASITE ;kill 'ASITE' x-ref on field 2 in 58.8
"RTN","PSDUTL",77,0)
 Q:$P(^PSD(58.8,DA,0),"^",2)=""
"RTN","PSDUTL",78,0)
 S PSDTYPE=$P(^PSD(58.8,DA,0),"^",2)
"RTN","PSDUTL",79,0)
 K ^PSD(58.8,"ASITE",X,PSDTYPE,DA),PSDTYPE
"RTN","PSDUTL",80,0)
 Q
"RTN","PSDUTL",81,0)
SASITE1 ;set 'ASITE' x-ref on field 1
"RTN","PSDUTL",82,0)
 S PSDDS=$P(^PSD(58.8,DA,0),"^",3) I 'PSDDS K PSDDS Q
"RTN","PSDUTL",83,0)
 S ^PSD(58.8,"ASITE",PSDDS,X,DA)="" K PSDDS
"RTN","PSDUTL",84,0)
 Q
"RTN","PSDUTL",85,0)
KASITE1 ;k 'ASITE' on field 1 in 58.8
"RTN","PSDUTL",86,0)
 S PSDDS=$P(^PSD(58.8,DA,0),"^",3) I 'PSDDS K PSDDS Q
"RTN","PSDUTL",87,0)
 K ^PSD(58.8,"ASITE",PSDDS,X,DA),PSDDS
"RTN","PSDUTL",88,0)
 Q
"RTN","PSDUTL",89,0)
SAFT ;set 'AF' field 1 in 58.81
"RTN","PSDUTL",90,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4)
"RTN","PSDUTL",91,0)
 I 'PSDNL!('PSDATT) K PSDNL,PSDATT Q
"RTN","PSDUTL",92,0)
 S ^PSD(58.81,"AF",PSDATT,PSDNL,X,DA)="" K PSDATT,PSDNL
"RTN","PSDUTL",93,0)
 Q
"RTN","PSDUTL",94,0)
KAFT ;kill 'AF' field 1 in 58.81
"RTN","PSDUTL",95,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4)
"RTN","PSDUTL",96,0)
 I 'PSDNL!('PSDATT) K PSDNL,PSDATT Q
"RTN","PSDUTL",97,0)
 K ^PSD(58.81,"AF",PSDATT,PSDNL,X,DA),PSDATT,PSDNL
"RTN","PSDUTL",98,0)
 Q
"RTN","PSDUTL1")
0^246^B17512555
"RTN","PSDUTL1",1,0)
PSDUTL1 ;BIR/JPW-Utility FM and X-Refs (cont'd) ; 18 Jan 94
"RTN","PSDUTL1",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL1",3,0)
SACT ;set 'ACT' x-ref on field 3 in 58.81
"RTN","PSDUTL1",4,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",5,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",6,0)
 S ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",7,0)
 Q
"RTN","PSDUTL1",8,0)
KACT ;kill 'ACT' x-ref on field 3 in 58.81
"RTN","PSDUTL1",9,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",10,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",11,0)
 K ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",12,0)
 Q
"RTN","PSDUTL1",13,0)
SACT1 ;set 'ACT' x-ref on field 1 in 58.81
"RTN","PSDUTL1",14,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDNL=$P(^(0),"^",3),PSDDRU=$P(^(0),"^",5)
"RTN","PSDUTL1",15,0)
 I ('PSDATT)!('PSDNL)!('PSDDRU) K PSDATT,PSDNL,PSDDRU Q
"RTN","PSDUTL1",16,0)
 S ^PSD(58.81,"ACT",PSDATT,PSDNL,PSDDRU,X,DA)="" K PSDNL,PSDATT,PSDDRU
"RTN","PSDUTL1",17,0)
 Q
"RTN","PSDUTL1",18,0)
KACT1 ;kill 'ACT' x-ref on field 1 in 58.81
"RTN","PSDUTL1",19,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDNL=$P(^(0),"^",3),PSDDRU=$P(^(0),"^",5)
"RTN","PSDUTL1",20,0)
 I ('PSDATT)!('PSDNL)!('PSDDRU) K PSDATT,PSDNL,PSDDRU Q
"RTN","PSDUTL1",21,0)
 K ^PSD(58.81,"ACT",PSDATT,PSDNL,PSDDRU,X,DA),PSDNL,PSDATT,PSDDRU
"RTN","PSDUTL1",22,0)
 Q
"RTN","PSDUTL1",23,0)
SACT2 ;set 'ACT' x-ref on field 2 in 58.81
"RTN","PSDUTL1",24,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",25,0)
 I ('PSDATT)!('PSDDRU)!('PSDTYPE) K PSDATT,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",26,0)
 S ^PSD(58.81,"ACT",PSDATT,X,PSDDRU,PSDTYPE,DA)="" K PSDATT,PSDDRU,PSDTYPE
"RTN","PSDUTL1",27,0)
 Q
"RTN","PSDUTL1",28,0)
KACT2 ;kill 'ACT' x-ref on field 2 in 58.81
"RTN","PSDUTL1",29,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",30,0)
 I ('PSDATT)!('PSDDRU)!('PSDTYPE) K PSDATT,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",31,0)
 K ^PSD(58.81,"ACT",PSDATT,X,PSDDRU,PSDTYPE,DA),PSDATT,PSDDRU,PSDTYPE
"RTN","PSDUTL1",32,0)
 Q
"RTN","PSDUTL1",33,0)
SACT3 ;set 'ACT' x-ref on field 4 in 58.81
"RTN","PSDUTL1",34,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",35,0)
 I 'PSDNL!('PSDATT)!('PSDTYPE) K PSDNL,PSDATT,PSDTYPE Q
"RTN","PSDUTL1",36,0)
 S ^PSD(58.81,"ACT",PSDATT,PSDNL,X,PSDTYPE,DA)="" K PSDATT,PSDNL,PSDTYPE
"RTN","PSDUTL1",37,0)
 Q
"RTN","PSDUTL1",38,0)
KACT3 ;kill 'ACT' x-ref on field 4 in 58.81
"RTN","PSDUTL1",39,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDTYPE=$P(^(0),"^",2)
"RTN","PSDUTL1",40,0)
 I ('PSDNL)!('PSDATT)!('PSDTYPE) K PSDNL,PSDATT,PSDTYPE Q
"RTN","PSDUTL1",41,0)
 K ^PSD(58.81,"ACT",PSDATT,PSDNL,X,PSDTYPE,DA),PSDNL,PSDATT,PSDTYPE
"RTN","PSDUTL1",42,0)
 Q
"RTN","PSDUTL1",43,0)
SACT4 ;set 'ACT' x-ref on field 34 in 58.81
"RTN","PSDUTL1",44,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=3
"RTN","PSDUTL1",45,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",46,0)
 S ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",47,0)
 Q
"RTN","PSDUTL1",48,0)
KACT4 ;kill 'ACT' x-ref on field 34 in 58.81
"RTN","PSDUTL1",49,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=3
"RTN","PSDUTL1",50,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",51,0)
 K ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",52,0)
 Q
"RTN","PSDUTL1",53,0)
SACT5 ;set 'ACT' x-ref on field 48 in 58.81
"RTN","PSDUTL1",54,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=14
"RTN","PSDUTL1",55,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",56,0)
 S ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",57,0)
 Q
"RTN","PSDUTL1",58,0)
KACT5 ;kill 'ACT' x-ref on field 48 in 58.81
"RTN","PSDUTL1",59,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=14
"RTN","PSDUTL1",60,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",61,0)
 K ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",62,0)
 Q
"RTN","PSDUTL1",63,0)
SACT6 ;set 'ACT' x-ref on field 55 in 58.81
"RTN","PSDUTL1",64,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=13
"RTN","PSDUTL1",65,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",66,0)
 S ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",67,0)
 Q
"RTN","PSDUTL1",68,0)
KACT6 ;kill 'ACT' x-ref on field 55 in 58.81
"RTN","PSDUTL1",69,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=13
"RTN","PSDUTL1",70,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL1",71,0)
 K ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL1",72,0)
 Q
"RTN","PSDUTL1",73,0)
SAD ;set 'AD' x-ref on field 17 in 58.81
"RTN","PSDUTL1",74,0)
 S PSDOST=+$P(^PSD(58.81,DA,0),"^",11) I 'PSDOST K PSDOST Q
"RTN","PSDUTL1",75,0)
 S ^PSD(58.81,"AD",PSDOST,X,DA)="" K PSDOST
"RTN","PSDUTL1",76,0)
 Q
"RTN","PSDUTL1",77,0)
KAD ;kill 'AD' x-ref on field 17 in 58.81
"RTN","PSDUTL1",78,0)
 S PSDOST=+$P(^PSD(58.81,DA,0),"^",11) I 'PSDOST K PSDOST Q
"RTN","PSDUTL1",79,0)
 K ^PSD(58.81,"AD",PSDOST,X,DA),PSDOST
"RTN","PSDUTL1",80,0)
 Q
"RTN","PSDUTL1",81,0)
SAW ;set 'AW' x-ref on field 13 in 58.85
"RTN","PSDUTL1",82,0)
 S PSDDS=$P(^PSD(58.85,DA,0),"^",2) I 'PSDDS K PSDDS Q
"RTN","PSDUTL1",83,0)
 S ^PSD(58.85,"AW",PSDDS,X,DA)="" K PSDDS
"RTN","PSDUTL1",84,0)
 Q
"RTN","PSDUTL1",85,0)
KAW ;kill 'AW' x-ref on field 13 in 58.85
"RTN","PSDUTL1",86,0)
 S PSDDS=$P(^PSD(58.85,DA,0),"^",2) I 'PSDDS K PSDDS Q
"RTN","PSDUTL1",87,0)
 K ^PSD(58.85,"AW",PSDDS,X,DA),PSDDS
"RTN","PSDUTL1",88,0)
 Q
"RTN","PSDUTL1",89,0)
SAW1 ;set 'AW' x-ref on field 1 in 58.85
"RTN","PSDUTL1",90,0)
 Q:'$D(^PSD(58.85,DA,2))
"RTN","PSDUTL1",91,0)
 S PSDPRT=$P(^PSD(58.85,DA,2),"^") I 'PSDPRT K PSDPRT Q
"RTN","PSDUTL1",92,0)
 S ^PSD(58.85,"AW",X,PSDPRT,DA)="" K PSDPRT
"RTN","PSDUTL1",93,0)
 Q
"RTN","PSDUTL1",94,0)
KAW1 ;kill 'AW' x-ref on field 1 in 58.85
"RTN","PSDUTL1",95,0)
 Q:'$D(^PSD(58.85,DA,2))
"RTN","PSDUTL1",96,0)
 S PSDPRT=$P(^PSD(58.85,DA,2),"^") I 'PSDPRT K PSDPRT Q
"RTN","PSDUTL1",97,0)
 K ^PSD(58.85,"AW",X,PSDPRT,DA),PSDPRT
"RTN","PSDUTL1",98,0)
 Q
"RTN","PSDUTL2")
0^247^B4494693
"RTN","PSDUTL2",1,0)
PSDUTL2 ;BIR/JPW-Utility FM and X-Refs (cont'd) ; 6 Sept 92
"RTN","PSDUTL2",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL2",3,0)
SAG ;sets 'AG' xref in file 58.81 (field 11)
"RTN","PSDUTL2",4,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL2",5,0)
 S ^PSD(58.81,"AG",X,PSDNL,DA)="" K PSDNL
"RTN","PSDUTL2",6,0)
 Q
"RTN","PSDUTL2",7,0)
KAG ;kills 'AG' x-ref in file 58.81 (field 11)
"RTN","PSDUTL2",8,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL2",9,0)
 K ^PSD(58.81,"AG",X,PSDNL,DA),PSDNL
"RTN","PSDUTL2",10,0)
 Q
"RTN","PSDUTL2",11,0)
SAG1 ;set 'AG' x-ref on field 17 in 58.81
"RTN","PSDUTL2",12,0)
 S PSDOST=+$P(^PSD(58.81,DA,0),"^",12) I 'PSDOST K PSDOST Q
"RTN","PSDUTL2",13,0)
 S ^PSD(58.81,"AG",PSDOST,X,DA)="" K PSDOST
"RTN","PSDUTL2",14,0)
 Q
"RTN","PSDUTL2",15,0)
KAG1 ;kill 'AG' x-ref on field 17 in 58.81
"RTN","PSDUTL2",16,0)
 S PSDOST=+$P(^PSD(58.81,DA,0),"^",12) I 'PSDOST K PSDOST Q
"RTN","PSDUTL2",17,0)
 K ^PSD(58.81,"AG",PSDOST,X,DA),PSDOST
"RTN","PSDUTL2",18,0)
 Q
"RTN","PSDUTL2",19,0)
SAC ;set 'AC' x-ref on field 1 in 58.87
"RTN","PSDUTL2",20,0)
 S PSDNL=+$P(^PSD(58.87,DA,0),"^",13) I 'PSDNL K PSDNL Q
"RTN","PSDUTL2",21,0)
 S PSDTYPE=+$P(^PSD(58.87,DA,0),"^",12) I 'PSDTYPE K PSDTYPE Q
"RTN","PSDUTL2",22,0)
 S ^PSD(58.87,"AC",PSDTYPE,PSDNL,X,DA)="" K PSDNL,PSDTYPE
"RTN","PSDUTL2",23,0)
 Q
"RTN","PSDUTL2",24,0)
KAC ;kill 'AC' x-ref on field 1 in 58.87
"RTN","PSDUTL2",25,0)
 S PSDNL=+$P(^PSD(58.87,DA,0),"^",13),PSDTYPE=+$P(^(0),"^",12)
"RTN","PSDUTL2",26,0)
 I 'PSDNL!('PSDTYPE) K PSDNL,PSDTYPE Q
"RTN","PSDUTL2",27,0)
 K ^PSD(58.87,"AC",PSDTYPE,PSDNL,X,DA),PSDNL,PSDTYPE
"RTN","PSDUTL2",28,0)
 Q
"RTN","PSDUTL2",29,0)
SAC1 ;set 'AC' x-ref on field 11 in 58.87
"RTN","PSDUTL2",30,0)
 S PSDNL=+$P(^PSD(58.87,DA,0),"^",13),PSDDAT=+$P(^(0),"^",2)
"RTN","PSDUTL2",31,0)
 I 'PSDNL!('PSDDAT) K PSDNL,PSDDAT Q
"RTN","PSDUTL2",32,0)
 S ^PSD(58.87,"AC",X,PSDNL,PSDDAT,DA)="" K PSDNL,PSDDAT
"RTN","PSDUTL2",33,0)
 Q
"RTN","PSDUTL2",34,0)
KAC1 ;kill 'AC' x-ref on field 11 in 58.87
"RTN","PSDUTL2",35,0)
 S PSDNL=+$P(^PSD(58.87,DA,0),"^",13),PSDDAT=+$P(^(0),"^",2)
"RTN","PSDUTL2",36,0)
 I 'PSDNL!('PSDDAT) K PSDNL,PSDDAT Q
"RTN","PSDUTL2",37,0)
 K ^PSD(58.87,"AC",X,PSDNL,PSDDAT,DA),PSDNL,PSDDAT
"RTN","PSDUTL2",38,0)
 Q
"RTN","PSDUTL2",39,0)
SAC2 ;set 'AC' x-ref on field 12 in 58.87
"RTN","PSDUTL2",40,0)
 S PSDTYPE=+$P(^PSD(58.87,DA,0),"^",12),PSDDAT=+$P(^(0),"^",2)
"RTN","PSDUTL2",41,0)
 I 'PSDTYPE!('PSDDAT) K PSDTYPE,PSDDAT Q
"RTN","PSDUTL2",42,0)
 S ^PSD(58.87,"AC",PSDTYPE,X,PSDDAT,DA)="" K PSDTYPE,PSDDAT
"RTN","PSDUTL2",43,0)
 Q
"RTN","PSDUTL2",44,0)
KAC2 ;kill 'AC' x-ref on field 12 in 58.87
"RTN","PSDUTL2",45,0)
 S PSDTYPE=+$P(^PSD(58.87,DA,0),"^",12),PSDDAT=+$P(^(0),"^",2)
"RTN","PSDUTL2",46,0)
 I 'PSDTYPE!('PSDDAT) K PSDTYPE,PSDDAT Q
"RTN","PSDUTL2",47,0)
 K ^PSD(58.87,"AC",PSDTYPE,X,PSDDAT,DA),PSDTYPE,PSDDAT
"RTN","PSDUTL2",48,0)
 Q
"RTN","PSDUTL3")
0^248^B10003466
"RTN","PSDUTL3",1,0)
PSDUTL3 ;BIR/JPW-Utility FM and X-Refs (cont'd) ; 18 Jan 94
"RTN","PSDUTL3",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL3",3,0)
SAC ;sets 'AC' x-ref on field 10 in file 58.86
"RTN","PSDUTL3",4,0)
 S PSDDRU=+$P(^PSD(58.86,DA,0),"^",2),PSDNL=+$P(^(0),"^",7) I 'PSDDRU!('PSDNL) K PSDDDU,PSDNL Q
"RTN","PSDUTL3",5,0)
 S ^PSD(58.86,"AC",X,PSDNL,PSDDRU,DA)="" K PSDDRU,PSDNL
"RTN","PSDUTL3",6,0)
 Q
"RTN","PSDUTL3",7,0)
KAC ;kills 'AC' x-ref on field 10 in file 58.86
"RTN","PSDUTL3",8,0)
 S PSDDRU=+$P(^PSD(58.86,DA,0),"^",2),PSDNL=+$P(^(0),"^",7) I 'PSDDRU!('PSDNL) K PSDDRU,PSDNL Q
"RTN","PSDUTL3",9,0)
 K ^PSD(58.86,"AC",X,PSDNL,PSDDRU,DA),PSDDRU,PSDNL
"RTN","PSDUTL3",10,0)
 Q
"RTN","PSDUTL3",11,0)
SAC1 ;sets 'AC' x-ref on field 1 in file 58.86
"RTN","PSDUTL3",12,0)
 S PSDDAT=+$P(^PSD(58.86,DA,0),"^",11),PSDNL=+$P(^(0),"^",7) I 'PSDDAT!('PSDNL) K PSDDAT,PSDNL Q
"RTN","PSDUTL3",13,0)
 S ^PSD(58.86,"AC",PSDDAT,PSDNL,X,DA)="" K PSDDAT,PSDNL
"RTN","PSDUTL3",14,0)
 Q
"RTN","PSDUTL3",15,0)
KAC1 ;kills 'AC' x-ref on field 1 in file 58.86
"RTN","PSDUTL3",16,0)
 S PSDDAT=+$P(^PSD(58.86,DA,0),"^",11),PSDNL=+$P(^(0),"^",7) I 'PSDDAT!('PSDNL) K PSDDAT,PSDNL Q
"RTN","PSDUTL3",17,0)
 K ^PSD(58.86,"AC",PSDDAT,PSDNL,X,DA),PSDDAT,PSDNL
"RTN","PSDUTL3",18,0)
 Q
"RTN","PSDUTL3",19,0)
SAC2 ;sets 'AC' x-ref on field 6 in file 58.86
"RTN","PSDUTL3",20,0)
 S PSDDRU=$P(^PSD(58.86,DA,0),"^",2),PSDDAT=$P(^(0),"^",11) I 'PSDDRU!('PSDDAT) K PSDDRU,PSDDAT Q
"RTN","PSDUTL3",21,0)
 S ^PSD(58.86,"AC",PSDDAT,X,PSDDRU,DA)="" K PSDDAT,PSDDRU
"RTN","PSDUTL3",22,0)
 Q
"RTN","PSDUTL3",23,0)
KAC2 ;kills 'AC' x-ref on field 6 in file 58.86
"RTN","PSDUTL3",24,0)
 S PSDDRU=$P(^PSD(58.86,DA,0),"^",2),PSDDAT=$P(^(0),"^",11) I 'PSDDRU!('PSDDAT) K PSDDRU,PSDDAT Q
"RTN","PSDUTL3",25,0)
 K ^PSD(58.86,"AC",PSDDAT,X,PSDDRU,DA),PSDDAT,PSDDRU
"RTN","PSDUTL3",26,0)
 Q
"RTN","PSDUTL3",27,0)
SAD ;sets 'AD' x-ref on field 10 in file 58.86
"RTN","PSDUTL3",28,0)
 S PSDDRU=$P($G(^PSD(58.86,DA,1)),"^"),PSDNL=+$P(^(0),"^",7) I PSDDRU']""!('PSDNL) K PSDDRU,PSDNL Q
"RTN","PSDUTL3",29,0)
 S ^PSD(58.86,"AD",X,PSDNL,PSDDRU,DA)="" K PSDDRU,PSDNL
"RTN","PSDUTL3",30,0)
 Q
"RTN","PSDUTL3",31,0)
KAD ;kills 'AD' x-ref on field 10 in file 58.86
"RTN","PSDUTL3",32,0)
 S PSDDRU=$P($G(^PSD(58.86,DA,1)),"^"),PSDNL=+$P(^(0),"^",7) I PSDDRU']""!('PSDNL) K PSDDRU,PSDNL Q
"RTN","PSDUTL3",33,0)
 K ^PSD(58.86,"AD",X,PSDNL,PSDDRU,DA),PSDDRU,PSDNL
"RTN","PSDUTL3",34,0)
 Q
"RTN","PSDUTL3",35,0)
SAD1 ;sets 'AD' x-ref on field 13 in file 58.86
"RTN","PSDUTL3",36,0)
 S PSDDAT=+$P(^PSD(58.86,DA,0),"^",11),PSDNL=+$P(^(0),"^",7) I 'PSDDAT!('PSDNL) K PSDDAT,PSDNL Q
"RTN","PSDUTL3",37,0)
 S ^PSD(58.86,"AD",PSDDAT,PSDNL,X,DA)="" K PSDDAT,PSDNL
"RTN","PSDUTL3",38,0)
 Q
"RTN","PSDUTL3",39,0)
KAD1 ;kills 'AD' x-ref on field 13 in file 58.86
"RTN","PSDUTL3",40,0)
 S PSDDAT=+$P(^PSD(58.86,DA,0),"^",11),PSDNL=+$P(^(0),"^",7) I 'PSDDAT!('PSDNL) K PSDDAT,PSDNL Q
"RTN","PSDUTL3",41,0)
 K ^PSD(58.86,"AD",PSDDAT,PSDNL,X,DA),PSDDAT,PSDNL
"RTN","PSDUTL3",42,0)
 Q
"RTN","PSDUTL3",43,0)
SAD2 ;sets 'AD' x-ref on field 6 in file 58.86
"RTN","PSDUTL3",44,0)
 S PSDDRU=$P($G(^PSD(58.86,DA,1)),"^"),PSDDAT=$P(^(0),"^",11) I PSDDRU']""!('PSDDAT) K PSDDRU,PSDDAT Q
"RTN","PSDUTL3",45,0)
 S ^PSD(58.86,"AD",PSDDAT,X,PSDDRU,DA)="" K PSDDAT,PSDDRU
"RTN","PSDUTL3",46,0)
 Q
"RTN","PSDUTL3",47,0)
KAD2 ;kills 'AD' x-ref on field 6 in file 58.86
"RTN","PSDUTL3",48,0)
 S PSDDRU=$P($G(^PSD(58.86,DA,1)),"^"),PSDDAT=$P(^(0),"^",11) I PSDDRU']""!('PSDDAT) K PSDDRU,PSDDAT Q
"RTN","PSDUTL3",49,0)
 K ^PSD(58.86,"AD",PSDDAT,X,PSDDRU,DA),PSDDAT,PSDDRU
"RTN","PSDUTL3",50,0)
 Q
"RTN","PSDUTL3",51,0)
SACT7 ;set 'ACT' x-ref on field 37 in 58.81
"RTN","PSDUTL3",52,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=4
"RTN","PSDUTL3",53,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL3",54,0)
 S ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL3",55,0)
 Q
"RTN","PSDUTL3",56,0)
KACT7 ;kill 'ACT' x-ref on field 37 in 58.81
"RTN","PSDUTL3",57,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=4
"RTN","PSDUTL3",58,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL3",59,0)
 K ^PSD(58.81,"ACT",X,PSDNL,PSDDRU,PSDTYPE,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL3",60,0)
 Q
"RTN","PSDUTL4")
0^249^B3775971
"RTN","PSDUTL4",1,0)
PSDUTL4 ;BIR/JPW-Utility FM and X-Refs (cont'd) ; 22 Jun 94
"RTN","PSDUTL4",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL4",3,0)
SAD ;sets 'AD' x-ref on field 2 in file 58.89
"RTN","PSDUTL4",4,0)
 S PSDNL=+$P(^PSD(58.89,DA,0),"^",6) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",5,0)
 S ^PSD(58.89,"AD",X,PSDNL,DA)="" K PSDNL
"RTN","PSDUTL4",6,0)
 Q
"RTN","PSDUTL4",7,0)
KAD ;kills 'AD' x-ref on field 2 in file 58.89
"RTN","PSDUTL4",8,0)
 S PSDNL=+$P(^PSD(58.89,DA,0),"^",6) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",9,0)
 K ^PSD(58.89,"AD",X,PSDNL,DA),PSDNL
"RTN","PSDUTL4",10,0)
 Q
"RTN","PSDUTL4",11,0)
SAD1 ;sets 'AD' x-ref on field 6 in file 58.89
"RTN","PSDUTL4",12,0)
 S PSDDAT=+$P(^PSD(58.89,DA,0),"^",3) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",13,0)
 S ^PSD(58.89,"AD",PSDDAT,X,DA)="" K PSDDAT
"RTN","PSDUTL4",14,0)
 Q
"RTN","PSDUTL4",15,0)
KAD1 ;kills 'AD' x-ref on field 6 in file 58.89
"RTN","PSDUTL4",16,0)
 S PSDDAT=+$P(^PSD(58.89,DA,0),"^",3) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",17,0)
 K ^PSD(58.89,"AD",PSDDAT,X,DA),PSDDAT
"RTN","PSDUTL4",18,0)
 Q
"RTN","PSDUTL4",19,0)
SAE ;sets 'AE' x-ref on field 4 in file 58.89
"RTN","PSDUTL4",20,0)
 S PSDNL=+$P(^PSD(58.89,DA,0),"^",6) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",21,0)
 S ^PSD(58.89,"AE",X,PSDNL,DA)="" K PSDNL
"RTN","PSDUTL4",22,0)
 Q
"RTN","PSDUTL4",23,0)
KAE ;kills 'AE' x-ref on field 4 in file 58.89
"RTN","PSDUTL4",24,0)
 S PSDNL=+$P(^PSD(58.89,DA,0),"^",6) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",25,0)
 K ^PSD(58.89,"AE",X,PSDNL,DA),PSDNL
"RTN","PSDUTL4",26,0)
 Q
"RTN","PSDUTL4",27,0)
SAE1 ;sets 'AE' x-ref on field 6 in file 58.89
"RTN","PSDUTL4",28,0)
 S PSDDAT=+$P(^PSD(58.89,DA,0),"^",5) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",29,0)
 S ^PSD(58.89,"AE",PSDDAT,X,DA)="" K PSDDAT
"RTN","PSDUTL4",30,0)
 Q
"RTN","PSDUTL4",31,0)
KAE1 ;kills 'AE' x-ref on field 6 in file 58.89
"RTN","PSDUTL4",32,0)
 S PSDDAT=+$P(^PSD(58.89,DA,0),"^",5) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",33,0)
 K ^PSD(58.89,"AE",PSDDAT,X,DA),PSDDAT
"RTN","PSDUTL4",34,0)
 Q
"RTN","PSDUTL4",35,0)
SAK ;sets 'AK' x-ref on field 21 in file 58.81
"RTN","PSDUTL4",36,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",37,0)
 S ^PSD(58.81,"AK",X,PSDNL,DA)="" K PSDNL
"RTN","PSDUTL4",38,0)
 Q
"RTN","PSDUTL4",39,0)
KAK ;kills 'AK' x-ref on field 21 in file 58.81
"RTN","PSDUTL4",40,0)
 S PSDNL=+$P(^PSD(58.81,DA,0),"^",18) I 'PSDNL K PSDNL Q
"RTN","PSDUTL4",41,0)
 K ^PSD(58.81,"AK",X,PSDNL,DA),PSDNL
"RTN","PSDUTL4",42,0)
 Q
"RTN","PSDUTL4",43,0)
SAK1 ;sets 'AK' x-ref on field 17 in file 58.81
"RTN","PSDUTL4",44,0)
 S PSDDAT=+$P($G(^PSD(58.81,DA,1)),"^",4) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",45,0)
 S ^PSD(58.81,"AK",PSDDAT,X,DA)="" K PSDDAT
"RTN","PSDUTL4",46,0)
 Q
"RTN","PSDUTL4",47,0)
KAK1 ;kills 'AK' x-ref on field 17 in file 58.81
"RTN","PSDUTL4",48,0)
 S PSDDAT=+$P($G(^PSD(58.81,DA,1)),"^",4) I 'PSDDAT K PSDDAT Q
"RTN","PSDUTL4",49,0)
 K ^PSD(58.81,"AK",PSDDAT,X,DA),PSDDAT
"RTN","PSDUTL4",50,0)
 Q
"RTN","PSDUTL5")
0^250^B6088397
"RTN","PSDUTL5",1,0)
PSDUTL5 ;BIR/JPW,LTL-Utility FM and X-Refs (cont'd) ; 14 Feb 95
"RTN","PSDUTL5",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDUTL5",3,0)
SAEM ;set 'AEM' x-ref on field 3 in 58.81
"RTN","PSDUTL5",4,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",5,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL5",6,0)
 S ^PSD(58.81,"AEM",X,PSDNL,PSDDRU,DA)="" K PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL5",7,0)
 Q
"RTN","PSDUTL5",8,0)
KAEM ;kill 'AEM' x-ref on field 3 in 58.81
"RTN","PSDUTL5",9,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",10,0)
 I ('PSDNL)!('PSDDRU)!('PSDTYPE) K PSDNL,PSDDRU,PSDTYPE Q
"RTN","PSDUTL5",11,0)
 K ^PSD(58.81,"AEM",X,PSDNL,PSDDRU,DA),PSDNL,PSDDRU,PSDTYPE
"RTN","PSDUTL5",12,0)
 Q
"RTN","PSDUTL5",13,0)
SAEM1 ;set 'AEM' x-ref on field 85 in 58.81
"RTN","PSDUTL5",14,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDDRU=$P(^(0),"^",5)
"RTN","PSDUTL5",15,0)
 I ('X)!('PSDATT)!('PSDDRU)!('PSDNL) K PSDATT,PSDDRU,PSDNL Q
"RTN","PSDUTL5",16,0)
 S ^PSD(58.81,"AEM",PSDATT,PSDNL,PSDDRU,DA)="" K PSDNL,PSDDRU,PSDATT
"RTN","PSDUTL5",17,0)
 Q
"RTN","PSDUTL5",18,0)
KAEM1 ;kill 'AEM' x-ref on field 85 in 58.81
"RTN","PSDUTL5",19,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDDRU=$P(^(0),"^",5)
"RTN","PSDUTL5",20,0)
 I ('PSDNL)!('PSDDRU)!('PSDATT) K PSDATT,PSDDRU,PSDNL Q
"RTN","PSDUTL5",21,0)
 K ^PSD(58.81,"AEM",PSDATT,PSDNL,PSDDRU,DA),PSDATT,PSDDRU,PSDNL
"RTN","PSDUTL5",22,0)
 Q
"RTN","PSDUTL5",23,0)
SAEM2 ;set 'AEM' x-ref on field 2 in 58.81
"RTN","PSDUTL5",24,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",25,0)
 I ('PSDATT)!('PSDDRU)!('PSDTYPE) K PSDATT,PSDDRU,PSDTYPE Q
"RTN","PSDUTL5",26,0)
 S ^PSD(58.81,"AEM",PSDATT,X,PSDDRU,DA)="" K PSDATT,PSDDRU,PSDTYPE
"RTN","PSDUTL5",27,0)
 Q
"RTN","PSDUTL5",28,0)
KAEM2 ;kill 'AEM' x-ref on field 2 in 58.81
"RTN","PSDUTL5",29,0)
 S PSDATT=$P(^PSD(58.81,DA,0),"^",4),PSDDRU=$P(^(0),"^",5),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",30,0)
 I ('PSDATT)!('PSDDRU)!('PSDTYPE) K PSDATT,PSDDRU,PSDTYPE Q
"RTN","PSDUTL5",31,0)
 K ^PSD(58.81,"AEM",PSDATT,X,PSDDRU,DA),PSDATT,PSDDRU,PSDTYPE
"RTN","PSDUTL5",32,0)
 Q
"RTN","PSDUTL5",33,0)
SAEM3 ;set 'AEM' x-ref on field 4 in 58.81
"RTN","PSDUTL5",34,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",35,0)
 I 'PSDNL!('PSDATT)!('PSDTYPE) K PSDNL,PSDATT,PSDTYPE Q
"RTN","PSDUTL5",36,0)
 S ^PSD(58.81,"AEM",PSDATT,PSDNL,X,DA)="" K PSDATT,PSDNL,PSDTYPE
"RTN","PSDUTL5",37,0)
 Q
"RTN","PSDUTL5",38,0)
KAEM3 ;kill 'AEM' x-ref on field 4 in 58.81
"RTN","PSDUTL5",39,0)
 S PSDNL=$P(^PSD(58.81,DA,0),"^",3),PSDATT=$P(^(0),"^",4),PSDTYPE=$P($G(^("CS")),"^",6)
"RTN","PSDUTL5",40,0)
 I ('PSDNL)!('PSDATT)!('PSDTYPE) K PSDNL,PSDATT,PSDTYPE Q
"RTN","PSDUTL5",41,0)
 K ^PSD(58.81,"AEM",PSDATT,PSDNL,X,DA),PSDNL,PSDATT,PSDTYPE
"RTN","PSDUTL5",42,0)
 Q
"RTN","PSDWADD")
0^251^B24356010
"RTN","PSDWADD",1,0)
PSDWADD ;BIR/JPW-Add/Delete Ward (for Drug) ; 6 July 94
"RTN","PSDWADD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDWADD",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDWADD",4,0)
 S PSDUZ=DUZ
"RTN","PSDWADD",5,0)
 W !!,"This option will allow you to add or delete a Ward (for Drug) assignment for",!,"all stock drugs in one or more ACTIVE NAOUs."
"RTN","PSDWADD",6,0)
ASKAD ;ask for 'Add' or 'Delete'
"RTN","PSDWADD",7,0)
 K DA,DIR,DIRUT S DIR(0)="SBO^A:ADD;D:DELETE",DIR("A")="Do you wish to ADD or DELETE?"
"RTN","PSDWADD",8,0)
 S DIR("?",1)="Enter 'A' to ADD a Ward (for Drug), 'D' to DELETE a Ward (for Drug),",DIR("?")="or '^' to quit" D ^DIR K DIR G:$D(DIRUT) END S ANS=Y
"RTN","PSDWADD",9,0)
 W !!,?5,"You may select a single NAOU, several NAOUs, or enter ^ALL to select all NAOUs.",!
"RTN","PSDWADD",10,0)
NAOU ;ask NAOU
"RTN","PSDWADD",11,0)
 K DA,DIC
"RTN","PSDWADD",12,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDWADD",13,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDWADD",14,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,^("I")>DT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDWADD",15,0)
 G:'$D(NAOU) END
"RTN","PSDWADD",16,0)
WARD ;ask ward
"RTN","PSDWADD",17,0)
 W ! S DIC=42,DIC(0)="QEAM",DIC("A")="Select WARD (for Drug) to "_$S(ANS="A":"add",1:"delete")_": " D ^DIC K DIC G:Y<0 END S PSDW=+Y,PSDWN=$P(Y,"^",2)
"RTN","PSDWADD",18,0)
QUE ;asks queueing information
"RTN","PSDWADD",19,0)
 S QUE=0 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you want to queue this job",DIR("?",1)="To queue this job to run at a later time and free up your terminal now,"
"RTN","PSDWADD",20,0)
 S DIR("?")="accept the default, enter 'N' to run immediately or '^' to quit." D ^DIR K DIR I $D(DIRUT) W ! G END
"RTN","PSDWADD",21,0)
 I 'Y W !!,"Starting the WARD (for Drug) "_$S(ANS="A":"additions",ANS="D":"deletions")_"." G START
"RTN","PSDWADD",22,0)
 S QUE=1 W !!,"You will be notified by MailMan when the job is completed.",!!
"RTN","PSDWADD",23,0)
 S ZTIO="",ZTRTN="START^PSDWADD",ZTDESC="CS PHARM WARD (for Drug) ADD/DELETE" S (ZTSAVE("QUE"),ZTSAVE("PSDW"),ZTSAVE("ANS"),ZTSAVE("PSDWN"),ZTSAVE("PSDUZ"))=""
"RTN","PSDWADD",24,0)
 S:$D(NAOU) ZTSAVE("NAOU(")="" D ^%ZTLOAD K ZTSK G END
"RTN","PSDWADD",25,0)
START ;add or delete ward (for drug) data
"RTN","PSDWADD",26,0)
 K ^TMP("PSDWADD",$J) S (CNTD,CNTN,OK)=0 D:ANS="A" ADD D:ANS="D" DEL D:QUE MSG
"RTN","PSDWADD",27,0)
 I 'QUE W $C(7),!!,"WARD (for Drug) assignment of "_PSDWN_" has been ",$S(ANS="A":"added to",1:"deleted from"),":",!," => Total NAOU(s): "_CNTN_"   => Total Stock Drugs: "_CNTD
"RTN","PSDWADD",28,0)
END K %,%H,%I,ANS,CNTD,CNTN,DA,DIC,DIE,DIK,DINUM,DIR,DIRUT,DR,PSDRG,DTOUT,DUOUT,PSDL,NAOU,OK,PSD,PSDUZ,QUE,RDT,PSDW,PSDWN
"RTN","PSDWADD",29,0)
 K X,XMDUZ,XMSUB,XMTEXT,XMY,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDWADD",30,0)
 Q
"RTN","PSDWADD",31,0)
ADD ;add ward (for drug)
"RTN","PSDWADD",32,0)
 F PSDL=0:0 S PSDL=$O(NAOU(PSDL)) S:OK CNTN=CNTN+1 Q:'PSDL  S OK=0 I $S('$D(^PSD(58.8,PSDL,"I")):1,'^("I"):1,^("I")>DT:1,1:0),$S($P($G(^(0)),"^",2)'="P":1,1:0) D
"RTN","PSDWADD",33,0)
 .F PSDRG=0:0 S PSDRG=$O(^PSD(58.8,PSDL,1,PSDRG)) Q:'PSDRG  I '$D(^PSD(58.8,PSDL,1,PSDRG,1,PSDW,0)) D
"RTN","PSDWADD",34,0)
 ..I '$D(^PSD(58.8,PSDL,1,PSDRG,1,0)) S ^(0)="^58.800115PA^^"
"RTN","PSDWADD",35,0)
 ..K DA,DIC S (DA,DINUM)=PSDW,X="`"_PSDW,DA(1)=PSDRG,DA(2)=PSDL,DIC="^PSD(58.8,"_PSDL_",1,"_PSDRG_",1,",DIC(0)="LNX",DLAYGO=58.8 D ^DIC K DIC,DLAYGO S CNTD=CNTD+1,OK=1 W:'QUE "."
"RTN","PSDWADD",36,0)
 Q
"RTN","PSDWADD",37,0)
DEL ;delete ward (for drug)
"RTN","PSDWADD",38,0)
 F PSDL=0:0 S PSDL=$O(NAOU(PSDL)) S:OK CNTN=CNTN+1 Q:'PSDL  S OK=0 I $S('$D(^PSD(58.8,PSDL,"I")):1,'^("I"):1,^("I")>DT:1,1:0),$S($P($G(^(0)),"^",2)'="P":1,1:0) D
"RTN","PSDWADD",39,0)
 .F PSDRG=0:0 S PSDRG=$O(^PSD(58.8,PSDL,1,PSDRG)) Q:'PSDRG  I $D(^PSD(58.8,PSDL,1,PSDRG,1,PSDW,0)) D
"RTN","PSDWADD",40,0)
 ..K DA,DIK,DR S DA(2)=PSDL,DA(1)=PSDRG,DA=PSDW,DIK="^PSD(58.8,"_DA(2)_",1,"_PSDRG_",1,",DR="15///@" D ^DIK K DIK S CNTD=CNTD+1,OK=1 W:'QUE "."
"RTN","PSDWADD",41,0)
 Q
"RTN","PSDWADD",42,0)
MSG ;send mailman message with completed info
"RTN","PSDWADD",43,0)
 K XMY,^TMP("PSDWAMSG",$J) D NOW^%DTC S Y=X X ^DD("DD") S RDT=Y S ^TMP("PSDWAMSG",$J,1,0)="CS PHARM WARD (for Drug) "_$S(ANS="A":"ADDITION",1:"DELETION")_" background job has run to completion."
"RTN","PSDWADD",44,0)
 S ^TMP("PSDWAMSG",$J,2,0)="Run Date: "_RDT,^TMP("PSDWAMSG",$J,3,0)=""
"RTN","PSDWADD",45,0)
 S ^TMP("PSDWAMSG",$J,4,0)="WARD (for Drug) assignment of "_PSDWN_" has been "_$S(ANS="A":"Added to",1:"Deleted from")_":"
"RTN","PSDWADD",46,0)
 S ^TMP("PSDWAMSG",$J,5,0)="=> Total NAOU(s): "_CNTN_"     => Total Stock Drugs: "_CNTD
"RTN","PSDWADD",47,0)
 S XMSUB="CS PHARM MASS WARD (for Drug) "_$S(ANS="A":"ADDITION",1:"DELETION")_" SUMMARY",XMTEXT="^TMP(""PSDWAMSG"",$J,",XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMY(PSDUZ)=""
"RTN","PSDWADD",48,0)
 S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDWAMSG",$J)
"RTN","PSDWADD",49,0)
 Q
"RTN","PSDWCHG")
0^252^B25154156
"RTN","PSDWCHG",1,0)
PSDWCHG ;BIR/JPW-CS Mass Ward (for Drug) Transfer ; 6 July 94
"RTN","PSDWCHG",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDWCHG",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDWCHG",4,0)
 S PSDUZ=DUZ
"RTN","PSDWCHG",5,0)
 W !!,"This routine will allow you to do a mass conversion of all drugs in an ",!,"active NAOU from an old Ward designation to a new Ward designation."
"RTN","PSDWCHG",6,0)
 W !!,"You may convert a single NAOU, several NAOUs, or enter ^ALL to convert",!,"all NAOUs.",!!
"RTN","PSDWCHG",7,0)
NAOU ;ask NAOU
"RTN","PSDWCHG",8,0)
 K DA,DIC
"RTN","PSDWCHG",9,0)
 F  S DIC=58.8,DIC("A")="Select NAOU: ",DIC(0)="QEA",DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC Q:Y<0  S NAOU(+Y)=""
"RTN","PSDWCHG",10,0)
 I '$D(NAOU)&(X'="^ALL") G END
"RTN","PSDWCHG",11,0)
 I X="^ALL" F PSD=0:0 S PSD=$O(^PSD(58.8,PSD)) Q:'PSD  I $S('$D(^PSD(58.8,PSD,"I")):1,'^("I"):1,^("I")>DT:1,1:0),$P($G(^(0)),"^",2)="N",$P($G(^(0)),"^",3)=+PSDSITE S NAOU(PSD)=""
"RTN","PSDWCHG",12,0)
 G:'$D(NAOU) END
"RTN","PSDWCHG",13,0)
OLD ;asking for old (current) WARD (FOR DRUG)
"RTN","PSDWCHG",14,0)
 K DA,DIR,DIRUT S DIR(0)="PO^42:EM",DIR("A")="Select OLD WARD",DIR("?")="Enter the Ward that currently exists in the WARD (FOR DRUG) field." D ^DIR K DIR I (Y<0)!$D(DIRUT) G END
"RTN","PSDWCHG",15,0)
 S OLD=+Y,OLDN=$P(Y,"^",2)
"RTN","PSDWCHG",16,0)
NEW ;asking new (replacement) WARD (FOR DRUG)
"RTN","PSDWCHG",17,0)
 K DA,DIR,DIRUT S DIR(0)="PO^42:EM",DIR("A")="Select NEW WARD",DIR("?")="Enter the new Ward you wish to replace "_OLDN D ^DIR K DIR I $D(DIRUT)!(Y<0) W !,"No Action Taken",! G END
"RTN","PSDWCHG",18,0)
 S NEW=+Y,NEWN=$P(Y,"^",2)
"RTN","PSDWCHG",19,0)
QUE ;asks queueing information
"RTN","PSDWCHG",20,0)
 S QUE=0 W !! K DA,DIR,DIRUT S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you want to queue this job",DIR("?",1)="To queue this job to run at a later time and free up your terminal now,"
"RTN","PSDWCHG",21,0)
 S DIR("?")="accept the default, enter 'N' to run immediately or '^' to quit." D ^DIR K DIR I $D(DIRUT) W $C(7),!!,"The WARD change you selected will not be updated.",!! G END
"RTN","PSDWCHG",22,0)
 I 'Y W !!,"Converting WARD (for Drug) now..." G START
"RTN","PSDWCHG",23,0)
 S QUE=1 W !!,"You will be notified by MailMan when the job is completed.",!!
"RTN","PSDWCHG",24,0)
 S ZTIO="",ZTRTN="START^PSDWCHG",ZTDESC="CS MASS WARD CONVERSION" S (ZTSAVE("OLD"),ZTSAVE("OLDN"),ZTSAVE("NEW"),ZTSAVE("NEWN"),ZTSAVE("QUE"),ZTSAVE("PSDUZ"))="" S:$D(NAOU) ZTSAVE("NAOU(")="" D ^%ZTLOAD K ZTSK G END
"RTN","PSDWCHG",25,0)
START ;loop to update ward conversion
"RTN","PSDWCHG",26,0)
 K ^TMP("PSDWCHG",$J) S (CNTN,CNTD)=0
"RTN","PSDWCHG",27,0)
 F PSDRG=0:0 S PSDRG=$O(^PSD(58.8,"D",PSDRG)) Q:'PSDRG  F LOC=0:0 S LOC=$O(^PSD(58.8,"D",PSDRG,OLD,LOC)) Q:'LOC  I $D(NAOU(LOC)),$P($G(^PSD(58.8,LOC,0)),"^",2)'="P",$D(^PSD(58.8,LOC,1,PSDRG,0)) S ^TMP("PSDWCHG",$J,LOC,PSDRG)=""
"RTN","PSDWCHG",28,0)
 I $D(^TMP("PSDWCHG",$J)) F LOC=0:0 S LOC=$O(^TMP("PSDWCHG",$J,LOC)) Q:'LOC  S CNTN=CNTN+1 F PSDRG=0:0 S PSDRG=$O(^TMP("PSDWCHG",$J,LOC,PSDRG)) Q:'PSDRG  S CNTD=CNTD+1 D CHG
"RTN","PSDWCHG",29,0)
 K ^TMP("PSDWCHG",$J) D:QUE MSG
"RTN","PSDWCHG",30,0)
 I 'QUE W $C(7),!!,"Total Stock Drugs converted: ",CNTD,!,"Total NAOU(s) converted: ",CNTN,!
"RTN","PSDWCHG",31,0)
END K %,%H,%I,CNTD,CNTN,DA,DIC,DIE,DIR,DIR,DIRUT,DR,DTOUT,DUOUT,JJ,LOC,NAOU,NEW,NEWN,OLD,OLDN
"RTN","PSDWCHG",32,0)
 K PSD,PSDA,PSDOUT,PSDR,PSDRG,PSDUZ,QUE,RDT,SUB,X,XMDUZ,XMSUB,XMTEXT,XMY,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,^TMP("PSDWCHG",$J)
"RTN","PSDWCHG",33,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDWCHG",34,0)
 Q
"RTN","PSDWCHG",35,0)
CHG ;change wards
"RTN","PSDWCHG",36,0)
 K DA,DIK S DA(2)=LOC,DA(1)=PSDRG,DA=OLD,DIK="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",1," D ^DIK K DIK
"RTN","PSDWCHG",37,0)
 I '$D(^PSD(58.8,LOC,1,PSDRG,1,NEW,0)) K DA S DA(2)=LOC,DA(1)=PSDRG,DA=NEW,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",1,",DR=".01////"_NEW D ^DIE K DIE W:'QUE "."
"RTN","PSDWCHG",38,0)
 S SUB=0 F JJ=0:0 S JJ=$O(^PSD(58.8,LOC,1,PSDRG,1,JJ)) Q:'JJ  S SUB=SUB+1
"RTN","PSDWCHG",39,0)
 S $P(^PSD(58.8,LOC,1,PSDRG,1,0),"^",3,4)=NEW_"^"_SUB
"RTN","PSDWCHG",40,0)
 Q
"RTN","PSDWCHG",41,0)
MSG ;send mailman message with completed info
"RTN","PSDWCHG",42,0)
 K XMY,^TMP("PSDWCMSG",$J) D NOW^%DTC S Y=X X ^DD("DD") S RDT=Y S ^TMP("PSDWCMSG",$J,1,0)="CS PHARM Conversion background job has run to completion.",^TMP("PSDWCMSG",$J,2,0)="Run Date: "_RDT,^TMP("PSDWCMSG",$J,3,0)=""
"RTN","PSDWCHG",43,0)
 S ^TMP("PSDWCMSG",$J,4,0)="Old Ward: "_OLDN_" converted to New Ward: "_NEWN,^TMP("PSDWCMSG",$J,5,0)="Total number of NAOU(s) converted: "_CNTN
"RTN","PSDWCHG",44,0)
 S ^TMP("PSDWCMSG",$J,6,0)="Total number of Stock Drugs converted: "_CNTD
"RTN","PSDWCHG",45,0)
 S XMSUB="CS PHARM MASS WARD CONVERSION SUMMARY",XMTEXT="^TMP(""PSDWCMSG"",$J,",XMDUZ="CONTROLLED SUBSTANCES PHARMACY",XMY(PSDUZ)="" S:'$D(XMY) XMY(.5)="" D ^XMD K XMY,^TMP("PSDWCMSG",$J)
"RTN","PSDWCHG",46,0)
 Q
"RTN","PSDWL")
0^253^B2601418
"RTN","PSDWL",1,0)
PSDWL ;BIR/LTL- MFI - WARD LOCATION Message builder for HL7 ; 9 Aug 95
"RTN","PSDWL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;;13 Feb 97
"RTN","PSDWL",3,0)
 N D0,HLERR,HLEVN,HLNDAP,HLMTN,HLFS,HLECH,HLSDATA,HLSDT,HLSEC,HLCHAR,HLDA,HLDAN,HLDAP,HLDT,HLDT1,HLNDAP0,HLPID,HLQ,HLVER,PSD,X
"RTN","PSDWL",4,0)
 S HLNDAP="PSD-NDES" D INIT^HLTRANS I $D(HLERR) D KILL^HLTRANS Q
"RTN","PSDWL",5,0)
 S HLMTN="MFN",HLEVN=1,HLSDT=DT
"RTN","PSDWL",6,0)
MFI S ^TMP("HLS",$J,HLSDT,1)="MFI"_HLFS_42_$E(HLECH)_"WARD LOCATION"_HLFS_"PSD-CS"_HLFS_"UPD"_HLFS_HLDT1_HLFS_HLFS_"AL",PSD=0,PSD(1)=2
"RTN","PSDWL",7,0)
MFE F  S PSD=$O(^DIC(42,PSD)) Q:'PSD  S D0=PSD D WIN^DGPMDDCF S:'X ^TMP("HLS",$J,HLSDT,PSD(1))="MFE"_HLFS_"MUP"_HLFS_HLFS_HLFS_PSD_$E(HLECH)_$P($G(^DIC(42,PSD,0)),U),PSD(1)=PSD(1)+1
"RTN","PSDWL",8,0)
SEND D EN^HLTRANS Q
"SEC","^DIC",58.8,58.8,0,"AUDIT")
@
"SEC","^DIC",58.8,58.8,0,"DD")
@
"SEC","^DIC",58.8,58.8,0,"DEL")
@
"SEC","^DIC",58.8,58.8,0,"LAYGO")
@
"SEC","^DIC",58.8,58.8,0,"RD")
@
"SEC","^DIC",58.8,58.8,0,"WR")
@
"SEC","^DIC",58.81,58.81,0,"AUDIT")
@
"SEC","^DIC",58.81,58.81,0,"DD")
@
"SEC","^DIC",58.81,58.81,0,"DEL")
@
"SEC","^DIC",58.81,58.81,0,"LAYGO")
@
"SEC","^DIC",58.81,58.81,0,"RD")
@
"SEC","^DIC",58.81,58.81,0,"WR")
@
"SEC","^DIC",58.82,58.82,0,"AUDIT")
@
"SEC","^DIC",58.82,58.82,0,"DD")
@
"SEC","^DIC",58.82,58.82,0,"DEL")
@
"SEC","^DIC",58.82,58.82,0,"LAYGO")
@
"SEC","^DIC",58.82,58.82,0,"RD")
@
"SEC","^DIC",58.82,58.82,0,"WR")
@
"SEC","^DIC",58.83,58.83,0,"AUDIT")
@
"SEC","^DIC",58.83,58.83,0,"DD")
@
"SEC","^DIC",58.83,58.83,0,"DEL")
@
"SEC","^DIC",58.83,58.83,0,"LAYGO")
@
"SEC","^DIC",58.83,58.83,0,"RD")
@
"SEC","^DIC",58.83,58.83,0,"WR")
@
"SEC","^DIC",58.84,58.84,0,"AUDIT")
@
"SEC","^DIC",58.84,58.84,0,"DD")
@
"SEC","^DIC",58.84,58.84,0,"DEL")
@
"SEC","^DIC",58.84,58.84,0,"LAYGO")
@
"SEC","^DIC",58.84,58.84,0,"RD")
@
"SEC","^DIC",58.84,58.84,0,"WR")
@
"SEC","^DIC",58.85,58.85,0,"AUDIT")
@
"SEC","^DIC",58.85,58.85,0,"DD")
@
"SEC","^DIC",58.85,58.85,0,"DEL")
@
"SEC","^DIC",58.85,58.85,0,"LAYGO")
@
"SEC","^DIC",58.85,58.85,0,"RD")
@
"SEC","^DIC",58.85,58.85,0,"WR")
@
"SEC","^DIC",58.86,58.86,0,"AUDIT")
@
"SEC","^DIC",58.86,58.86,0,"DD")
@
"SEC","^DIC",58.86,58.86,0,"DEL")
@
"SEC","^DIC",58.86,58.86,0,"LAYGO")
@
"SEC","^DIC",58.86,58.86,0,"RD")
@
"SEC","^DIC",58.86,58.86,0,"WR")
@
"SEC","^DIC",58.87,58.87,0,"AUDIT")
@
"SEC","^DIC",58.87,58.87,0,"DD")
@
"SEC","^DIC",58.87,58.87,0,"DEL")
@
"SEC","^DIC",58.87,58.87,0,"LAYGO")
@
"SEC","^DIC",58.87,58.87,0,"RD")
@
"SEC","^DIC",58.87,58.87,0,"WR")
@
"SEC","^DIC",58.88,58.88,0,"AUDIT")
@
"SEC","^DIC",58.88,58.88,0,"DD")
@
"SEC","^DIC",58.88,58.88,0,"DEL")
@
"SEC","^DIC",58.88,58.88,0,"LAYGO")
@
"SEC","^DIC",58.88,58.88,0,"RD")
@
"SEC","^DIC",58.88,58.88,0,"WR")
@
"SEC","^DIC",58.89,58.89,0,"AUDIT")
@
"SEC","^DIC",58.89,58.89,0,"DD")
@
"SEC","^DIC",58.89,58.89,0,"DEL")
@
"SEC","^DIC",58.89,58.89,0,"LAYGO")
@
"SEC","^DIC",58.89,58.89,0,"RD")
@
"SEC","^DIC",58.89,58.89,0,"WR")
@
"UP",50,50.0441,-1)
50^441
"UP",50,50.0441,0)
50.0441
"UP",58.2,58.23,-1)
58.2^2
"UP",58.2,58.23,0)
58.23
"UP",58.2,58.29,-1)
58.2^3
"UP",58.2,58.29,0)
58.29
"VER")
8.0^21.0
"^DD",50,50,63,0)
APPLICATION PACKAGES' USE^FI^^2;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>90!($L(X)<1) X
"^DD",50,50,63,1,0)
^.1
"^DD",50,50,63,1,1,0)
50^IU
"^DD",50,50,63,1,1,1)
S ^PSDRUG("IU",X,DA)=""
"^DD",50,50,63,1,1,2)
K ^PSDRUG("IU",X,DA)
"^DD",50,50,63,1,2,0)
50^AIU^MUMPS
"^DD",50,50,63,1,2,1)
S Y(1)=$P(^PSDRUG(DA,0),"^") I Y(1)]"" F Y(2)=1:1:$L(X) S ^PSDRUG("AIU"_$E(X,Y(2)),Y(1),DA)=""
"^DD",50,50,63,1,2,2)
S Y(1)=$P(^PSDRUG(DA,0),"^") I Y(1)]"" F Y(2)=1:1:$L(X) K ^PSDRUG("AIU"_$E(X,Y(2)),Y(1),DA)
"^DD",50,50,63,1,2,"%D",0)
^^1^1^2920831^
"^DD",50,50,63,1,2,"%D",1,0)
Sets application package use field (63) cross-ref.
"^DD",50,50,63,3)
Answer must be 1-90 characters in length.
"^DD",50,50,63,8.5)
^
"^DD",50,50,63,9)
^
"^DD",50,50,63,20,0)
^.3LA^1^1
"^DD",50,50,63,20,1,0)
PS
"^DD",50,50,63,21,0)
^^3^3^2910923^^^^
"^DD",50,50,63,21,1,0)
This field is free text, but contains the codes of the DHCP packages
"^DD",50,50,63,21,2,0)
that consider this drug part of its formulary.  This field is set through
"^DD",50,50,63,21,3,0)
the routine ^PSGIU, and NOT through VA FileMan.
"^DD",50,50,63,21,4,0)
 
"^DD",50,50,63,21,5,0)
NOTES: Uneditable through VA FileMan.
"^DD",50,50,63,"DT")
2901221
"^DD",50,50,441,0)
IFCAP ITEM NUMBER^50.0441P^^441;0
"^DD",50,50,441,21,0)
^^1^1^2921117^^^^
"^DD",50,50,441,21,1,0)
To provide a direct link between the DRUG file and the ITEM MASTER file.
"^DD",50,50,441,23,0)
^^2^2^2921117^^^
"^DD",50,50,441,23,1,0)
To connect the DRUG file (#50) to the ITEM MASTER file (#441).
"^DD",50,50,441,23,2,0)
This may be a one-to-many relationship.
"^DD",50,50,441,"DT")
2920317
"^DD",50,50.0441,0)
IFCAP ITEM NUMBER SUB-FIELD^^.01^1
"^DD",50,50.0441,0,"NM","IFCAP ITEM NUMBER")

"^DD",50,50.0441,.01,0)
ITEM NUMBER^M*P441'X^PRC(441,^0;1^D:$G(DA) FI^PSAUTL S DIC("S")="I $E($G(^(3)),1)'=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",50,50.0441,.01,1,0)
^.1
"^DD",50,50.0441,.01,1,1,0)
50.0441^B
"^DD",50,50.0441,.01,1,1,1)
S ^PSDRUG(DA(1),441,"B",$E(X,1,30),DA)=""
"^DD",50,50.0441,.01,1,1,2)
K ^PSDRUG(DA(1),441,"B",$E(X,1,30),DA)
"^DD",50,50.0441,.01,1,2,0)
50^AB
"^DD",50,50.0441,.01,1,2,1)
S ^PSDRUG("AB",$E(X,1,30),DA(1),DA)=""
"^DD",50,50.0441,.01,1,2,2)
K ^PSDRUG("AB",$E(X,1,30),DA(1),DA)
"^DD",50,50.0441,.01,1,2,"%D",0)
^^1^1^2921123^^
"^DD",50,50.0441,.01,1,2,"%D",1,0)
To locate drug by ITEM MASTER file number.
"^DD",50,50.0441,.01,1,2,"DT")
2920318
"^DD",50,50.0441,.01,3)
Enter ITEM MASTER Number or short description.
"^DD",50,50.0441,.01,12)
Cannot select Inactive items.
"^DD",50,50.0441,.01,12.1)
S DIC("S")="I $E($G(^(3)),1)'=1"
"^DD",50,50.0441,.01,21,0)
^^3^3^2921117^^^^
"^DD",50,50.0441,.01,21,1,0)
This field contains any or all items in the ITEM MASTER file that relate to
"^DD",50,50.0441,.01,21,2,0)
this drug.  This relationship will enable automated receiving from the IFCAP
"^DD",50,50.0441,.01,21,3,0)
Inventory module.
"^DD",50,50.0441,.01,23,0)
^^2^2^2921117^^^^
"^DD",50,50.0441,.01,23,1,0)
With the "AB" cross reference this multiple will be used when
"^DD",50,50.0441,.01,23,2,0)
PRCP routines pass receiving data to PSA routines.
"^DD",50,50.0441,.01,"DT")
2920731
"^DD",50,50.0441,.01,"LAYGO",1,0)
N PSA S PSA=$O(^PSDRUG("AB",+X,0)) S:PSA=DA PSA=$O(^(DA)) W:$G(PSA) *7,!!,$P($G(^PSDRUG(+$O(^PSDRUG("AB",+X,0)),0)),U)," is already linked to",!!,"Item #",X,"  ",$$DESCR^PRCPUX1(0,X) I '$G(PSA)
"^DD",58.2,58.2,2,0)
GROUP DESCRIPTION^58.23^^2;0
"^DD",58.2,58.2,2,21,0)
^^3^3^2910304^^^
"^DD",58.2,58.2,2,21,1,0)
This text describes the inventory group and its use, and perhaps
"^DD",58.2,58.2,2,21,2,0)
the times when normally processed.  This is purely for documentation
"^DD",58.2,58.2,2,21,3,0)
of your site specific information.
"^DD",58.2,58.2,3,0)
NARCOTIC AREA OF USE (NAOU)^58.29P^^3;0
"^DD",58.2,58.2,3,21,0)
^^4^4^2940915^^^^
"^DD",58.2,58.2,3,21,1,0)
Enter name of NAOU that is to be inventoried when specifying this
"^DD",58.2,58.2,3,21,2,0)
inventory group at the time of creating an inventory date.  This is
"^DD",58.2,58.2,3,21,3,0)
a way to "group" commonly inventoried NAOUs under an easy to remember
"^DD",58.2,58.2,3,21,4,0)
inventory group name.
"^DD",58.2,58.23,0)
GROUP DESCRIPTION SUB-FIELD^NL^.01^1
"^DD",58.2,58.23,0,"NM","GROUP DESCRIPTION")

"^DD",58.2,58.23,0,"UP")
58.2
"^DD",58.2,58.23,.01,0)
GROUP DESCRIPTION^W^^0;1^Q
"^DD",58.2,58.23,.01,21,0)
^^3^3^2910304^
"^DD",58.2,58.23,.01,21,1,0)
This text describes the inventory group and its use, and perhaps
"^DD",58.2,58.23,.01,21,2,0)
the times when normally processed.  This is purely for documentation
"^DD",58.2,58.23,.01,21,3,0)
of your site specific information.
"^DD",58.2,58.29,0)
NARCOTIC AREA OF USE (NAOU) SUB-FIELD^^2^3
"^DD",58.2,58.29,0,"NM","NARCOTIC AREA OF USE (NAOU)")

"^DD",58.2,58.29,.01,0)
NARCOTIC AREA OF USE (NAOU)^MR*P58.8'X^PSD(58.8,^0;1^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",58.2,58.29,.01,1,0)
^.1
"^DD",58.2,58.29,.01,1,1,0)
58.29^B
"^DD",58.2,58.29,.01,1,1,1)
S ^PSI(58.2,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.2,58.29,.01,1,1,2)
K ^PSI(58.2,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.2,58.29,.01,1,2,0)
58.2^CS^MUMPS
"^DD",58.2,58.29,.01,1,2,1)
S ^PSI(58.2,"CS",DA(1),$E(X,1,30))=""
"^DD",58.2,58.29,.01,1,2,2)
K ^PSI(58.2,"CS",DA(1),$E(X,1,30))
"^DD",58.2,58.29,.01,1,2,3)
DO NOT DELETE
"^DD",58.2,58.29,.01,1,2,"%D",0)
^^4^4^2940915^^
"^DD",58.2,58.29,.01,1,2,"%D",1,0)
This cross-reference is used to distinguish between inventory groups
"^DD",58.2,58.29,.01,1,2,"%D",2,0)
that belong to the AR/WS module and those belonging to the CS module.
"^DD",58.2,58.29,.01,1,2,"%D",3,0)
This cross-reference will identify CS inventory groups and will be
"^DD",58.2,58.29,.01,1,2,"%D",4,0)
used for lookup and sorting.
"^DD",58.2,58.29,.01,1,2,"DT")
2920220
"^DD",58.2,58.29,.01,3)
Enter the NAOU for this inventory group.
"^DD",58.2,58.29,.01,12)
Select only Controlled Substances locations.
"^DD",58.2,58.29,.01,12.1)
S DIC("S")="I $P(^(0),""^"",2)'=""P"",$P(^(0),""^"",3)=+PSDSITE"
"^DD",58.2,58.29,.01,21,0)
^^3^3^2941027^^^^
"^DD",58.2,58.29,.01,21,1,0)
This contains the name of the NAOU that is to be inventoried when
"^DD",58.2,58.29,.01,21,2,0)
selecting this inventory group.  This points to File 58.8 - DRUG
"^DD",58.2,58.29,.01,21,3,0)
ACCOUNTABILITY STATS file.
"^DD",58.2,58.29,.01,23,0)
^^2^2^2940920^^^^
"^DD",58.2,58.29,.01,23,1,0)
Screened pointer to File 58.8 - DRUG ACCOUNTABILITY STATS file.  Screens
"^DD",58.2,58.29,.01,23,2,0)
out entries with type defined as "P" for Primary.
"^DD",58.2,58.29,.01,"DT")
2920910
"^DD",58.2,58.29,2,0)
SORT KEY^NJ15,4^^0;2^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."5N.N) X
"^DD",58.2,58.29,2,1,0)
^.1
"^DD",58.2,58.29,2,1,1,0)
58.29^D
"^DD",58.2,58.29,2,1,1,1)
S ^PSI(58.2,DA(1),3,"D",$E(X,1,30),DA)=""
"^DD",58.2,58.29,2,1,1,2)
K ^PSI(58.2,DA(1),3,"D",$E(X,1,30),DA)
"^DD",58.2,58.29,2,1,1,"DT")
2920213
"^DD",58.2,58.29,2,3)
Type a Number between 0 and 9999999999, 4 Decimal Digits
"^DD",58.2,58.29,2,21,0)
^^2^2^2920213^
"^DD",58.2,58.29,2,21,1,0)
The sort key is used to define the sort order of NAOUs within an
"^DD",58.2,58.29,2,21,2,0)
inventory group.
"^DD",58.2,58.29,2,"DT")
2920213
"^DD",58.8,58.8,0)
FIELD^^34^34
"^DD",58.8,58.8,0,"DDA")
N
"^DD",58.8,58.8,0,"DT")
2961219
"^DD",58.8,58.8,0,"ID","WRITE")
I $D(^("I")),^("I")]"",^("I")'>DT D EN^DDIOL($C(7)_"**INACTIVE**")
"^DD",58.8,58.8,0,"IX","AB",58.842,.01)

"^DD",58.8,58.8,0,"IX","AC",58.800118,10)

"^DD",58.8,58.8,0,"IX","AD",58.800118,14)

"^DD",58.8,58.8,0,"IX","ADISP",58.8,1)

"^DD",58.8,58.8,0,"IX","AEXP",58.8001,11)

"^DD",58.8,58.8,0,"IX","AEXPO",58.800118,9)

"^DD",58.8,58.8,0,"IX","AIV",58.831,.01)

"^DD",58.8,58.8,0,"IX","AOP",58.8,20)

"^DD",58.8,58.8,0,"IX","ASITE",58.8,2)

"^DD",58.8,58.8,0,"IX","ASITE1",58.8,1)

"^DD",58.8,58.8,0,"IX","B",58.8,.01)

"^DD",58.8,58.8,0,"IX","C",58.8001,.01)

"^DD",58.8,58.8,0,"IX","D",58.800115,.01)

"^DD",58.8,58.8,0,"IX","E",58.8,11)

"^DD",58.8,58.8,0,"IX","F",58.800118,16)

"^DD",58.8,58.8,0,"IX","P",58.8445,.01)

"^DD",58.8,58.8,0,"NM","DRUG ACCOUNTABILITY STATS")

"^DD",58.8,58.8,0,"PT",58.29,.01)

"^DD",58.8,58.8,0,"PT",58.8,3)

"^DD",58.8,58.8,0,"PT",58.800118,2)

"^DD",58.8,58.8,0,"PT",58.81,2)

"^DD",58.8,58.8,0,"PT",58.81,17)

"^DD",58.8,58.8,0,"PT",58.81,66)

"^DD",58.8,58.8,0,"PT",58.8112,4)

"^DD",58.8,58.8,0,"PT",58.8112,13)

"^DD",58.8,58.8,0,"PT",58.85,1)

"^DD",58.8,58.8,0,"PT",58.85,2)

"^DD",58.8,58.8,0,"PT",58.86,6)

"^DD",58.8,58.8,0,"PT",58.87,5)

"^DD",58.8,58.8,0,"PT",58.87,12)

"^DD",58.8,58.8,0,"PT",58.89,6)

"^DD",58.8,58.8,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.8,58.8,.01,0)
PHARMACY LOCATION^RF^^0;1^K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",58.8,58.8,.01,.1)
NAOU
"^DD",58.8,58.8,.01,1,0)
^.1
"^DD",58.8,58.8,.01,1,1,0)
58.8^B
"^DD",58.8,58.8,.01,1,1,1)
S ^PSD(58.8,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8,.01,1,1,2)
K ^PSD(58.8,"B",$E(X,1,30),DA)
"^DD",58.8,58.8,.01,3)
Answer must be 2-30 characters in length.
"^DD",58.8,58.8,.01,21,0)
^^4^4^2921106^^^^
"^DD",58.8,58.8,.01,21,1,0)
This field contains the name of the Pharmacy location.
"^DD",58.8,58.8,.01,21,2,0)
   
"^DD",58.8,58.8,.01,21,3,0)
The Controlled Substances module will recognize this location as the
"^DD",58.8,58.8,.01,21,4,0)
Narcotic Area of Use (NAOU) throughout this package.
"^DD",58.8,58.8,.01,23,0)
^^1^1^2920504^^^^
"^DD",58.8,58.8,.01,23,1,0)
Free text name of this Pharmacy location.  Not to exceed 30 characters.
"^DD",58.8,58.8,.01,"DEL",.01,0)
I 1 W !,?5,"DO NOT DELETE.  Use the Inactivate NAOU option. "
"^DD",58.8,58.8,.01,"DT")
2920305
"^DD",58.8,58.8,1,0)
LOCATION TYPE^RSX^M:MASTER VAULT;S:SATELLITE VAULT;N:NARCOTIC LOCATION;P:PRIMARY;^0;2^K X W $C(7),!,?10," ** No Editing ** ",!
"^DD",58.8,58.8,1,.1)
Location Type
"^DD",58.8,58.8,1,1,0)
^.1
"^DD",58.8,58.8,1,1,1,0)
58.8^ADISP
"^DD",58.8,58.8,1,1,1,1)
S ^PSD(58.8,"ADISP",$E(X,1,30),DA)=""
"^DD",58.8,58.8,1,1,1,2)
K ^PSD(58.8,"ADISP",$E(X,1,30),DA)
"^DD",58.8,58.8,1,1,1,"DT")
2920530
"^DD",58.8,58.8,1,1,2,0)
58.8^ASITE1^MUMPS
"^DD",58.8,58.8,1,1,2,1)
D SASITE1^PSDUTL
"^DD",58.8,58.8,1,1,2,2)
D KASITE1^PSDUTL
"^DD",58.8,58.8,1,1,2,3)
DO NOT DELETE
"^DD",58.8,58.8,1,1,2,"%D",0)
^^3^3^2920912^^^
"^DD",58.8,58.8,1,1,2,"%D",1,0)
This cross-reference is used in determining site for all Controlled
"^DD",58.8,58.8,1,1,2,"%D",2,0)
Substances applications.
"^DD",58.8,58.8,1,1,2,"%D",3,0)
The cross-reference is ^PSD(58.8,"ASITE",INPATIENT SITE,LOC TYPE,DA)="".
"^DD",58.8,58.8,1,1,2,"DT")
2920606
"^DD",58.8,58.8,1,3)
Enter the location type.
"^DD",58.8,58.8,1,21,0)
^^10^10^2940923^^^^
"^DD",58.8,58.8,1,21,1,0)
This field contains the location type for this Pharmacy location.
"^DD",58.8,58.8,1,21,2,0)
Location types are "M" for master vault, "S" for satellite vault, "N" for
"^DD",58.8,58.8,1,21,3,0)
narcotic location, and "P" for primary.
"^DD",58.8,58.8,1,21,4,0)
  
"^DD",58.8,58.8,1,21,5,0)
This field should NOT be edited directly using VA FileMan.  The Drug
"^DD",58.8,58.8,1,21,6,0)
Accountability and Controlled Substances modules depend on the accuracy
"^DD",58.8,58.8,1,21,7,0)
of this data.
"^DD",58.8,58.8,1,21,8,0)
 
"^DD",58.8,58.8,1,21,9,0)
The Controlled Substances module supports "M", "S" and "N" location types.
"^DD",58.8,58.8,1,21,10,0)
For CS use, enter the Master vault locations first. 
"^DD",58.8,58.8,1,23,0)
^^1^1^2921106^^
"^DD",58.8,58.8,1,23,1,0)
Set of codes.  Do NOT edit directly using VA FileMan.
"^DD",58.8,58.8,1,"DT")
2931021
"^DD",58.8,58.8,2,0)
INPATIENT SITE^R*P59.4'^PS(59.4,^0;3^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",31)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,2,.1)
CS SITE
"^DD",58.8,58.8,2,1,0)
^.1
"^DD",58.8,58.8,2,1,1,0)
58.8^ASITE^MUMPS
"^DD",58.8,58.8,2,1,1,1)
D SASITE^PSDUTL
"^DD",58.8,58.8,2,1,1,2)
D KASITE^PSDUTL
"^DD",58.8,58.8,2,1,1,3)
DO NOT DELETE
"^DD",58.8,58.8,2,1,1,"%D",0)
^^4^4^2940923^^^^
"^DD",58.8,58.8,2,1,1,"%D",1,0)
This cross-reference is used in distinguishing multi-divisional
"^DD",58.8,58.8,2,1,1,"%D",2,0)
sites.  The Controlled Substances software uses this cross-reference
"^DD",58.8,58.8,2,1,1,"%D",3,0)
in all ordering, dispensing, and reporting activity.
"^DD",58.8,58.8,2,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"ASITE",INPATIENT SITE,LOC TYPE,DA)="".
"^DD",58.8,58.8,2,1,1,"DT")
2920606
"^DD",58.8,58.8,2,3)
Enter inpatient site.
"^DD",58.8,58.8,2,12)
Select only sites that are "Selectable for CS" in File 59.4.
"^DD",58.8,58.8,2,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",31)"
"^DD",58.8,58.8,2,21,0)
^^2^2^2940923^^^^
"^DD",58.8,58.8,2,21,1,0)
This field contains a pointer to the inpatient site.  This is a required
"^DD",58.8,58.8,2,21,2,0)
data element within the Controlled Substances module.
"^DD",58.8,58.8,2,23,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,2,23,1,0)
Screened pointer to File 59.4 - INPATIENT SITE file.  Required for CS use.
"^DD",58.8,58.8,2,"DT")
2920609
"^DD",58.8,58.8,3,0)
PRIMARY DISPENSING SITE^*P58.8'^PSD(58.8,^0;4^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,+Y'=DA,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,3,.1)
Primary Dispensing Site
"^DD",58.8,58.8,3,3)
Answer must be the name of an existing Master or Satellite vault.
"^DD",58.8,58.8,3,12)
Selection limited to Master or Satellite vault.
"^DD",58.8,58.8,3,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,+Y'=DA,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.8,58.8,3,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.8,3,21,1,0)
This field contains a pointer to the primary dispensing site for this
"^DD",58.8,58.8,3,21,2,0)
Pharmacy location.  This data is utilized within the Controlled Substances
"^DD",58.8,58.8,3,21,3,0)
module.
"^DD",58.8,58.8,3,23,0)
^^2^2^2940923^^^^
"^DD",58.8,58.8,3,23,1,0)
Screened pointer to File 58.8 - DRUG ACCOUNTABILITY STATS file.
"^DD",58.8,58.8,3,23,2,0)
Selection limited to Master vault or Satellite vault.
"^DD",58.8,58.8,3,"DT")
2920821
"^DD",58.8,58.8,4,0)
INACTIVE DATE^D^^I;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8,4,.1)
Inactive Date
"^DD",58.8,58.8,4,3)
Enter the date when this Pharmacy location became inactive.
"^DD",58.8,58.8,4,21,0)
^^1^1^2920305^^^
"^DD",58.8,58.8,4,21,1,0)
The date on which this Pharmacy location was inactivated.
"^DD",58.8,58.8,4,23,0)
^^1^1^2920504^^^
"^DD",58.8,58.8,4,23,1,0)
Inactive date for this Pharmacy location.
"^DD",58.8,58.8,4,"DT")
2920106
"^DD",58.8,58.8,5,0)
ASK MFG/LOT #/EXP.DATE?^S^1:YES;0:NO;^0;5^Q
"^DD",58.8,58.8,5,.1)
Ask Mfg/Lot #/Exp.Date?
"^DD",58.8,58.8,5,3)
Enter "1" or "Y" if you wish to be prompted for mfg., lot #, and exp. date.
"^DD",58.8,58.8,5,21,0)
^^7^7^2940923^^^^
"^DD",58.8,58.8,5,21,1,0)
The answer for asking manufacturer, lot #, and expiration date on drugs
"^DD",58.8,58.8,5,21,2,0)
tracked within this Pharmacy location .  If this field is set to "1" or
"^DD",58.8,58.8,5,21,3,0)
"YES", manufacturer, lot number, and expiration date will be asked when
"^DD",58.8,58.8,5,21,4,0)
dispensing drugs within this Pharmacy location.
"^DD",58.8,58.8,5,21,5,0)
  
"^DD",58.8,58.8,5,21,6,0)
For Controlled Substances use, this field should be answered for Master
"^DD",58.8,58.8,5,21,7,0)
vaults and Satellite vaults.
"^DD",58.8,58.8,5,23,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,5,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,5,"DT")
2920106
"^DD",58.8,58.8,6,0)
IS THIS PHARM WORKING STOCK?^S^1:YES;0:NO;^0;7^Q
"^DD",58.8,58.8,6,.1)
Is this a Pharmacy NAOU for Working Stock?
"^DD",58.8,58.8,6,3)
Enter "1" or "Y" if this is a Pharmacy NAOU for working stock.
"^DD",58.8,58.8,6,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.8,6,21,1,0)
Pharmacy location designated as a Narcotic Area of Use for pharmacy working
"^DD",58.8,58.8,6,21,2,0)
stock. If this field is set to "1" or "YES" drug data will be utilized
"^DD",58.8,58.8,6,21,3,0)
differently within the Controlled Substances module.
"^DD",58.8,58.8,6,23,0)
^^1^1^2940923^^^
"^DD",58.8,58.8,6,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,6,"DT")
2920505
"^DD",58.8,58.8,10,0)
DRUG^58.8001IP^^1;0
"^DD",58.8,58.8,10,21,0)
^^8^8^2941201^^^^
"^DD",58.8,58.8,10,21,1,0)
Drug is defined by physical location, stock level, balance on-hand,
"^DD",58.8,58.8,10,21,2,0)
reorder level, quantity to reorder, breakdown unit, package size,
"^DD",58.8,58.8,10,21,3,0)
manufacturer, lot number, and expiration date.  Other information available
"^DD",58.8,58.8,10,21,4,0)
is inventory types, ward (for drug), and Prime Vendor item number
"^DD",58.8,58.8,10,21,5,0)
(if applicable).
"^DD",58.8,58.8,10,21,6,0)
  
"^DD",58.8,58.8,10,21,7,0)
In the Controlled Substances module, all CS order requests are stored
"^DD",58.8,58.8,10,21,8,0)
in the ORDERS multiple within DRUG.
"^DD",58.8,58.8,11,0)
*PRIMARY INVENTORY POINT^*P445'X^PRCP(445,^0;6^S DATABASE=1,DIC("S")="I $P(^(0),U,3)=""P""&($P(^(0),U,7)=822400)" D ^DIC K DIC S DIC=DIE,X=+Y D ^PSAUTL K DATABASE K:Y<0 X
"^DD",58.8,58.8,11,1,0)
^.1
"^DD",58.8,58.8,11,1,1,0)
58.8^E
"^DD",58.8,58.8,11,1,1,1)
S ^PSD(58.8,"E",$E(X,1,30),DA)=""
"^DD",58.8,58.8,11,1,1,2)
K ^PSD(58.8,"E",$E(X,1,30),DA)
"^DD",58.8,58.8,11,1,1,"%D",0)
^^1^1^2940915^^
"^DD",58.8,58.8,11,1,1,"%D",1,0)
To identify Pharmacy location linked to an Inventory Point.
"^DD",58.8,58.8,11,1,1,"DT")
2930309
"^DD",58.8,58.8,11,3)
For Controlled Substances enter the name of the Pharmacy Inventory Point which contains ONLY the controlled substances stored in this Pharmacy Master vault.
"^DD",58.8,58.8,11,12)
You can only select a Primary Inventory Point with a Cost Center of 822400.
"^DD",58.8,58.8,11,12.1)
S DIC("S")="I $P(^(0),U,3)=""P""&($P(^(0),U,7)=822400)"
"^DD",58.8,58.8,11,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.8,11,21,1,0)
To provide a direct link between a Pharmacy Inventory Point and a Pharmacy
"^DD",58.8,58.8,11,21,2,0)
location entry in this file.  Receiving that occurs in the Inventory Point
"^DD",58.8,58.8,11,21,3,0)
will update on hand quantities in the Pharmacy location.
"^DD",58.8,58.8,11,23,0)
^^2^2^2940923^^^^
"^DD",58.8,58.8,11,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445) and the 
"^DD",58.8,58.8,11,23,2,0)
DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8,11,"DT")
2930309
"^DD",58.8,58.8,11.5,0)
*RECEIPT FAILURE NOTIFICATION?^S^1:YES;0:NO;^0;11^Q
"^DD",58.8,58.8,11.5,3)
Enter "1" or "Y" to notify the RECEIPT FAILURE mail group of items that could not be received.
"^DD",58.8,58.8,11.5,21,0)
^^7^7^2940923^^^
"^DD",58.8,58.8,11.5,21,1,0)
If a Drug Accountability location is linked to a Primary Inventory Point
"^DD",58.8,58.8,11.5,21,2,0)
the items received into the Primary Inventory Point will also be updated in
"^DD",58.8,58.8,11.5,21,3,0)
the Drug Accountability location.  If items are received into the linked
"^DD",58.8,58.8,11.5,21,4,0)
Primary Inventory that are not connected to the DRUG file (#50) or not
"^DD",58.8,58.8,11.5,21,5,0)
stocked in the Drug Accountability location, and this field is set to
"^DD",58.8,58.8,11.5,21,6,0)
"YES", the RECEIPT FAILURE mail group will be notified with a list
"^DD",58.8,58.8,11.5,21,7,0)
of the items.
"^DD",58.8,58.8,11.5,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,11.5,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,11.5,"DT")
2930319
"^DD",58.8,58.8,12,0)
PRIME VENDOR?^S^1:YES;0:NO;^0;8^Q
"^DD",58.8,58.8,12,3)
Enter "1" or "Y" for "YES" or "0" or "N" for "NO".
"^DD",58.8,58.8,12,21,0)
^^4^4^2940915^^^^
"^DD",58.8,58.8,12,21,1,0)
To more efficiently process Prime Vendor receipts, setting this flag to
"^DD",58.8,58.8,12,21,2,0)
"YES" will allow you to store an obligation number.  This number will then
"^DD",58.8,58.8,12,21,3,0)
be offered as a default whenever using the Receive Directly into Drug
"^DD",58.8,58.8,12,21,4,0)
Accountability option on the Receiving Menu.
"^DD",58.8,58.8,12,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.8,12,23,1,0)
Directs the flow of receipt processing and checks for a 1358 obligation
"^DD",58.8,58.8,12,23,2,0)
number stored in the CURRENT PRIME VENDOR PO# field.
"^DD",58.8,58.8,12,"DT")
2920501
"^DD",58.8,58.8,13,0)
CURRENT PRIME VENDOR PO#^*P442'^PRC(442,^0;9^S DIC("S")="I $P($G(^(0)),U,5)[822400" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,13,3)
Enter the 1358 obligation number for the current month.
"^DD",58.8,58.8,13,12)
You can only select P.O.#s with a 822400 cost center.
"^DD",58.8,58.8,13,12.1)
S DIC("S")="I $P($G(^(0)),U,5)[822400"
"^DD",58.8,58.8,13,21,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,13,21,1,0)
This entry will be used as a default when receiving from the Prime Vendor.
"^DD",58.8,58.8,13,23,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,13,23,1,0)
Default value for Prime Vendor receiving.
"^DD",58.8,58.8,13,"DT")
2920511
"^DD",58.8,58.8,14,0)
AUTO GENERATE DISPENSING #'S?^S^1:YES;0:NO;^2;1^Q
"^DD",58.8,58.8,14,3)
Answer "YES" to automatically generate the pharmacy dispensing # for CS orders.
"^DD",58.8,58.8,14,21,0)
^^5^5^2941027^^^^
"^DD",58.8,58.8,14,21,1,0)
The pharmacy dispensing number (Green Sheet #) will be automatically
"^DD",58.8,58.8,14,21,2,0)
generated when dispensing Controlled Substances orders if this field is
"^DD",58.8,58.8,14,21,3,0)
set to "1" or "YES".  If left blank, or if "0", or "NO" are entered the
"^DD",58.8,58.8,14,21,4,0)
pharmacy employee processing the Controlled Substances order will have
"^DD",58.8,58.8,14,21,5,0)
to enter the dispensing number (Green Sheet #).
"^DD",58.8,58.8,14,"DT")
2920606
"^DD",58.8,58.8,15,0)
LOW DISPENSING #^NJ9,0X^^2;2^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D LOW^PSDSITE K:$D(PSDFLAG) X K PSD,PSDFLAG,PSDL
"^DD",58.8,58.8,15,3)
Enter the lowest CS dispensing # for this dispensing site (1 to 999999999).
"^DD",58.8,58.8,15,21,0)
^^2^2^2940915^^
"^DD",58.8,58.8,15,21,1,0)
The lowest CS pharmacy dispensing number for this dispensing site.  The
"^DD",58.8,58.8,15,21,2,0)
system will not allow numbers smaller than the one you choose.
"^DD",58.8,58.8,15,"DT")
2921123
"^DD",58.8,58.8,16,0)
HIGH DISPENSING #^NJ9,0X^^2;3^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D HIGH^PSDSITE K:$D(PSDFLAG) X K PSD,PSDFLAG,PSDH,PSDL
"^DD",58.8,58.8,16,3)
Enter the largest CS dispensing number for this dispensing site (1-999999999).
"^DD",58.8,58.8,16,21,0)
^^4^4^2920915^^^
"^DD",58.8,58.8,16,21,1,0)
The largest acceptable pharmacy dispensing number for this dispensing
"^DD",58.8,58.8,16,21,2,0)
site.  The difference between this number and the lowest pharmacy
"^DD",58.8,58.8,16,21,3,0)
dispensing number should be substantial.  The system will not allow
"^DD",58.8,58.8,16,21,4,0)
numbers larger than the one you choose.
"^DD",58.8,58.8,16,"DT")
2921123
"^DD",58.8,58.8,17,0)
LAST DISPENSING #^NJ9,0X^^2;4^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D LAST^PSDSITE K:$D(PSDFLAG) X K PSDFLAG
"^DD",58.8,58.8,17,3)
Enter the last CS dispensing number used for this dispensing site (1 to 999999999).
"^DD",58.8,58.8,17,21,0)
^^4^4^2940915^^^^
"^DD",58.8,58.8,17,21,1,0)
The last CS pharmacy dispensing number used.  This number will
"^DD",58.8,58.8,17,21,2,0)
start at the lowest pharmacy dispensing number, increment it by
"^DD",58.8,58.8,17,21,3,0)
one until it finds a number that has not been used, and then use
"^DD",58.8,58.8,17,21,4,0)
that number for the next Controlled Substances order.
"^DD",58.8,58.8,17,"DT")
2921123
"^DD",58.8,58.8,18,0)
USING PERPETUAL INVENTORY?^S^1:YES;0:NO;^2;5^Q
"^DD",58.8,58.8,18,3)
Answer "YES" if this site is using the perpetual inventory method.
"^DD",58.8,58.8,18,21,0)
^^13^13^2941201^^^^
"^DD",58.8,58.8,18,21,1,0)
This flag is used to determine if this NAOU is using the Controlled
"^DD",58.8,58.8,18,21,2,0)
Substances perpetual inventory functionality.
"^DD",58.8,58.8,18,21,3,0)
If this field is set to "YES" or "1" the standard Controlled
"^DD",58.8,58.8,18,21,4,0)
Substance Administration Record VA FORM 10-2638 (Green Sheet)
"^DD",58.8,58.8,18,21,5,0)
WILL NOT be printed and will be replaced by the perpetual inventory method
"^DD",58.8,58.8,18,21,6,0)
of tracking CS drugs.
"^DD",58.8,58.8,18,21,7,0)
     For an NAOU that is using a perpetual inventory, the MAXIMUM
"^DD",58.8,58.8,18,21,8,0)
QUANTITY PER ORDER field for a drug in the dispensing site will limit
"^DD",58.8,58.8,18,21,9,0)
the maximum quantity that Nursing Service may enter for any single
"^DD",58.8,58.8,18,21,10,0)
order for that drug.  If the MAXIMUM QUANTITY PER ORDER is left
"^DD",58.8,58.8,18,21,11,0)
blank, deleted, or set to zero, Nursing Service will be able to enter any
"^DD",58.8,58.8,18,21,12,0)
quantity that is a multiple of package size, up to 999999, for any single 
"^DD",58.8,58.8,18,21,13,0)
order of that drug.
"^DD",58.8,58.8,18,"DT")
2930628
"^DD",58.8,58.8,19,0)
PRINT GREEN SHEET^S^1:YES;0:NO;^2;6^Q
"^DD",58.8,58.8,19,3)
Enter "YES" to print the Green Sheet after process only, "NO" to print after RPh verification.
"^DD",58.8,58.8,19,21,0)
^^6^6^2940915^^^
"^DD",58.8,58.8,19,21,1,0)
This is a flag used to determine the sequence in which a Controlled
"^DD",58.8,58.8,19,21,2,0)
Substance Administration Record VA FORM 10-2638 (Green Sheet) will
"^DD",58.8,58.8,19,21,3,0)
be printed.  If set to "YES" or "1" the "Green Sheet" will print
"^DD",58.8,58.8,19,21,4,0)
after the order has been processed and prior to a RPh verification.
"^DD",58.8,58.8,19,21,5,0)
If set to "NO" or "0" the "Green Sheet" will print after a RPh has
"^DD",58.8,58.8,19,21,6,0)
verified the filled order.
"^DD",58.8,58.8,19,"DT")
2920606
"^DD",58.8,58.8,19.5,0)
GREEN SHEET STOCK^S^1:GPO 1992 PRINTING;0:OTHER GPO PRINTING;^2.5;1^Q
"^DD",58.8,58.8,19.5,3)
Enter 1 for GPO 1992 printed stock.
"^DD",58.8,58.8,19.5,21,0)
^^4^4^2940915^^^
"^DD",58.8,58.8,19.5,21,1,0)
The VA FORM 10-2638 (Green Sheet) stock was printed on 8 x 10 1/2 paper.
"^DD",58.8,58.8,19.5,21,2,0)
In 1992, the paper size changed to 8 1/2 x 11.  This field is used as a
"^DD",58.8,58.8,19.5,21,3,0)
site parameter when printing the Green Sheet forms.  Additional spacing
"^DD",58.8,58.8,19.5,21,4,0)
is required for the GPO 1992 printed stock.
"^DD",58.8,58.8,19.5,"DT")
2930526
"^DD",58.8,58.8,20,0)
OUTPATIENT SITE^P59'X^PS(59,^0;10^I $D(X) S Z=$O(^PSD(58.8,"AOP",+X,0)) S:Z=DA Z=$O(^(DA)) W:$G(Z) $C(7),!,$P($G(^PSD(58.8,+$O(^PSD(58.8,"AOP",+X,0)),0)),U)," is already linked to ",$P($G(^PS(59,+X,0)),U) K:$G(Z) X,Z
"^DD",58.8,58.8,20,1,0)
^.1
"^DD",58.8,58.8,20,1,1,0)
58.8^AOP
"^DD",58.8,58.8,20,1,1,1)
S ^PSD(58.8,"AOP",$E(X,1,30),DA)=""
"^DD",58.8,58.8,20,1,1,2)
K ^PSD(58.8,"AOP",$E(X,1,30),DA)
"^DD",58.8,58.8,20,1,1,"%D",0)
^^1^1^2940915^^
"^DD",58.8,58.8,20,1,1,"%D",1,0)
To be used for automated updating of total dispensed when Rx is filled.
"^DD",58.8,58.8,20,1,1,"DT")
2920701
"^DD",58.8,58.8,20,3)
Enter the Outpatient Site from which to gather prescription dispensing data.
"^DD",58.8,58.8,20,21,0)
^^2^2^2920701^
"^DD",58.8,58.8,20,21,1,0)
When prescriptions are filled the corresponding drug for this Outpatient
"^DD",58.8,58.8,20,21,2,0)
Site will be updated for monthly total dispensed.
"^DD",58.8,58.8,20,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,20,23,1,0)
To be used for automated updating of total dispensed when Rx is filled.
"^DD",58.8,58.8,20,"DT")
2931021
"^DD",58.8,58.8,21,0)
WARD^58.842P^^3;0
"^DD",58.8,58.8,21,21,0)
^^2^2^2950801^^^
"^DD",58.8,58.8,21,21,1,0)
When Unit Dose and IV dispensing data is compiled, it will affect 
"^DD",58.8,58.8,21,21,2,0)
the Drug Accountability Location to which a ward is linked.
"^DD",58.8,58.8,21,23,0)
^^1^1^2950801^^^
"^DD",58.8,58.8,21,23,1,0)
For UD/IV dispensing to be subtracted from the appropriate DA location.
"^DD",58.8,58.8,22,0)
PRIMARY INVENTORY POINT(S)^58.8445P^^4;0
"^DD",58.8,58.8,22,12)
Must be Special Inventory Point Type "D" for Drug Accountability.
"^DD",58.8,58.8,22,12.1)
S DIC("S")="I $P(^(0),U,20)=""D"""
"^DD",58.8,58.8,22,21,0)
^^3^3^2970204^^^^
"^DD",58.8,58.8,22,21,1,0)
To provide a direct link between a Pharmacy Inventory Point and a Pharmacy
"^DD",58.8,58.8,22,21,2,0)
location entry in this file.  Receiving that occurs in the Inventory Point
"^DD",58.8,58.8,22,21,3,0)
will update on hand quantities in the Pharmacy location.
"^DD",58.8,58.8,22,23,0)
^^2^2^2970204^^^
"^DD",58.8,58.8,22,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445)
"^DD",58.8,58.8,22,23,2,0)
and the DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8,23,0)
DISPENSING WORKSHEET SORT^S^D:DRUG/NAOU;N:NAOU/DRUG;S:SELECT AT PRINTING;^2;7^Q
"^DD",58.8,58.8,23,3)
Enter the sort order to be used in creating the dispensing worksheet.
"^DD",58.8,58.8,23,21,0)
^^4^4^2940929^^^^
"^DD",58.8,58.8,23,21,1,0)
This field determines the sort order when printing the Controlled
"^DD",58.8,58.8,23,21,2,0)
Substances "Pharmacy Dispensing Worksheet".  The sort order may be defined
"^DD",58.8,58.8,23,21,3,0)
by drug then NAOU, by NAOU then drug, or selected when printing
"^DD",58.8,58.8,23,21,4,0)
the worksheet.
"^DD",58.8,58.8,23,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.8,23,23,1,0)
Set of codes used in determining the sort order when printing the "Pharmacy
"^DD",58.8,58.8,23,23,2,0)
Dispensing Worksheet".
"^DD",58.8,58.8,23,"DT")
2930426
"^DD",58.8,58.8,24,0)
DEFAULT GREEN SHEET PRINTER^P3.5'^%ZIS(1,^2;8^Q
"^DD",58.8,58.8,24,3)
Enter the name of the device selected to print Green Sheets.
"^DD",58.8,58.8,24,21,0)
^^2^2^2930427^^
"^DD",58.8,58.8,24,21,1,0)
A pointer to the name of the device selected as the default printer
"^DD",58.8,58.8,24,21,2,0)
for Green Sheets.
"^DD",58.8,58.8,24,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,24,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,24,"DT")
2930426
"^DD",58.8,58.8,25,0)
DEFAULT REPORT PRINTER^P3.5'^%ZIS(1,^2;9^Q
"^DD",58.8,58.8,25,3)
Enter the name of the device selected to print CS reports.
"^DD",58.8,58.8,25,21,0)
^^2^2^2941027^^^
"^DD",58.8,58.8,25,21,1,0)
A pointer to the name of the device selected as the default printer for
"^DD",58.8,58.8,25,21,2,0)
various Controlled Substances reports.
"^DD",58.8,58.8,25,23,0)
^^1^1^2940915^^^
"^DD",58.8,58.8,25,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,25,"DT")
2930426
"^DD",58.8,58.8,26,0)
DEFAULT LABEL PRINTER^P3.5'^%ZIS(1,^2;10^Q
"^DD",58.8,58.8,26,3)
Enter the name of the device selected to print CS labels.
"^DD",58.8,58.8,26,21,0)
^^2^2^2930427^
"^DD",58.8,58.8,26,21,1,0)
A pointer to the name of the device selected as the default printer
"^DD",58.8,58.8,26,21,2,0)
for Controlled Substances labels.
"^DD",58.8,58.8,26,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,26,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,26,"DT")
2930426
"^DD",58.8,58.8,27,0)
LAST UD UPDATE^D^^0;12^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8,27,3)
The last date that dispensing from the UNIT DOSE PICK LIST STATS file (#57.6) was collected to update this location.
"^DD",58.8,58.8,27,21,0)
^^3^3^2941201^^^^
"^DD",58.8,58.8,27,21,1,0)
When the UD dispensing data is collected from the UNIT DOSE PICK LIST STATS
"^DD",58.8,58.8,27,21,2,0)
file (#57.6) a date is stored here.  Each time UD dispensing data is
"^DD",58.8,58.8,27,21,3,0)
collected, it begins FROM this date.
"^DD",58.8,58.8,27,23,0)
^^2^2^2941201^^^^
"^DD",58.8,58.8,27,23,1,0)
Used and stored by the PSAUDP routine for the collection of dispensing data
"^DD",58.8,58.8,27,23,2,0)
from the UNIT DOSE PICK LIST STATS file (#57.6).
"^DD",58.8,58.8,27,"DT")
2930617
"^DD",58.8,58.8,28,0)
ORDER ENTRY BANNER^58.828^^5;0
"^DD",58.8,58.8,28,21,0)
^^3^3^2950130^^^
"^DD",58.8,58.8,28,21,1,0)
A banner to be displayed for Nursing Order Entry, Pharmacy Order Entry
"^DD",58.8,58.8,28,21,2,0)
from Nursing, and Infusion Order Entry.  This banner may be edited via
"^DD",58.8,58.8,28,21,3,0)
the option, Create/Edit the Narcotic Area of Use.
"^DD",58.8,58.8,28,23,0)
^^1^1^2950130^^^
"^DD",58.8,58.8,28,23,1,0)
A banner to be displayed for Order Entry.
"^DD",58.8,58.8,29,0)
EMERGENCY ORDER PRINTER^P3.5'^%ZIS(1,^2;11^Q
"^DD",58.8,58.8,29,3)
Select a device for this dispensing vault which can receive notice of emergency orders submitted by nursing personnel.
"^DD",58.8,58.8,29,21,0)
^^4^4^2950130^
"^DD",58.8,58.8,29,21,1,0)
This device will be used to print a notice of emergency orders submitted
"^DD",58.8,58.8,29,21,2,0)
by nursing personnel.  The printer designated to receive these messages
"^DD",58.8,58.8,29,21,3,0)
SHOULD NOT be the printer which prints green sheets or controlled
"^DD",58.8,58.8,29,21,4,0)
substances labels.
"^DD",58.8,58.8,29,23,0)
^^1^1^2950130^
"^DD",58.8,58.8,29,23,1,0)
This field is a pointer to the DEVICE file (#3.5).
"^DD",58.8,58.8,29,"DT")
2950130
"^DD",58.8,58.8,30,0)
ALLOW ONE-TIME REQUESTS?^S^1:YES;0:NO;^0;13^Q
"^DD",58.8,58.8,30,3)
Enter "1" or "Y" to allow NAOUs to place one-time requests.
"^DD",58.8,58.8,30,21,0)
^^5^5^2950801^^
"^DD",58.8,58.8,30,21,1,0)
     If the primary dispensing site for an NAOU allows one-time requests,
"^DD",58.8,58.8,30,21,2,0)
any active drug in that dispensing site may be ordered, even though it may
"^DD",58.8,58.8,30,21,3,0)
be inactive or not stocked by that NAOU.  Certain drugs within a dispensing
"^DD",58.8,58.8,30,21,4,0)
site may be marked as not selectable and are unavailable for even one-time
"^DD",58.8,58.8,30,21,5,0)
requests.
"^DD",58.8,58.8,30,23,0)
^^1^1^2950801^^
"^DD",58.8,58.8,30,23,1,0)
Checked by order entry routines (PSDOR*) before allowing one-time requests.
"^DD",58.8,58.8,30,"DT")
2950731
"^DD",58.8,58.8,31,0)
IV ROOM^58.831P^^3.5;0
"^DD",58.8,58.8,31,21,0)
^^4^4^2951215^
"^DD",58.8,58.8,31,21,1,0)
The IV Room multiple contains the Outpatient Clinic's IV rooms to which the 
"^DD",58.8,58.8,31,21,2,0)
Outpatient Pharmacy dispenses IVs. When IV dispensing data is compiled, it 
"^DD",58.8,58.8,31,21,3,0)
will affect the Drug Accountability outpatient pharmacy location to which 
"^DD",58.8,58.8,31,21,4,0)
the IV Room is linked.
"^DD",58.8,58.8,31,23,0)
^^1^1^2951215^
"^DD",58.8,58.8,31,23,1,0)
This field points to the IV ROOM FILE (#59.5).
"^DD",58.8,58.8,32,0)
ADJUSTMENT MAIL GROUP^P3.8'^XMB(3.8,^6;1^Q
"^DD",58.8,58.8,32,3)
Enter the mail group that should receive messages when adjustments occur.
"^DD",58.8,58.8,32,21,0)
^^2^2^2961007^
"^DD",58.8,58.8,32,21,1,0)
The persons in this mail group will receive messages whenever an adjustment
"^DD",58.8,58.8,32,21,2,0)
or count correction occurs for this Narcotic Area of Use (NAOU).
"^DD",58.8,58.8,32,"DT")
2961007
"^DD",58.8,58.8,33,0)
TIME LIMIT FOR DELAYED DOSES^NJ5,2^^6;2^K:+X'=X!(X>12)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.8,33,3)
Type a Number between 0 and 12, 2 Decimal Digits
"^DD",58.8,58.8,33,21,0)
^^4^4^2961007^
"^DD",58.8,58.8,33,21,1,0)
This is the time limit for Nursing to record a delayed wastage
"^DD",58.8,58.8,33,21,2,0)
or return to stock for a dose that was not administered to a patient.
"^DD",58.8,58.8,33,21,3,0)
If a "1" is entered, Nurses will have one hour to record the
"^DD",58.8,58.8,33,21,4,0)
disposition of a dose for this Narcotic Area of Use.
"^DD",58.8,58.8,33,"DT")
2961007
"^DD",58.8,58.8,34,0)
MAINTAIN REORDER LEVELS?^S^1:YES;0:NO;^0;14^Q
"^DD",58.8,58.8,34,.1)
Maintain Reorder Levels?
"^DD",58.8,58.8,34,3)
Enter YES if the reorder level is to entered for each drug in the pharmacy location or master vault.
"^DD",58.8,58.8,34,21,0)
^^2^2^2970131^^^^
"^DD",58.8,58.8,34,21,1,0)
The MAINTAIN REORDER LEVELS? field denotes if the drugs in the pharmacy
"^DD",58.8,58.8,34,21,2,0)
location or master vault are to maintain their reorder levels.
"^DD",58.8,58.8,34,"DT")
2970131
"^DD",58.8,58.8001,0)
DRUG SUB-FIELD^^29^38
"^DD",58.8,58.8001,0,"DT")
2961031
"^DD",58.8,58.8001,0,"IX","AC",58.8001,13)

"^DD",58.8,58.8001,0,"IX","B",58.8001,.01)

"^DD",58.8,58.8001,0,"IX","C",58.8001,12)

"^DD",58.8,58.8001,0,"NM","DRUG")

"^DD",58.8,58.8001,0,"UP")
58.8
"^DD",58.8,58.8001,.01,0)
DRUG^MR*P50'X^PSDRUG(^0;1^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.8001,.01,.1)
CS Drug
"^DD",58.8,58.8001,.01,1,0)
^.1
"^DD",58.8,58.8001,.01,1,1,0)
58.8001^B
"^DD",58.8,58.8001,.01,1,1,1)
S ^PSD(58.8,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8001,.01,1,1,2)
K ^PSD(58.8,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.8,58.8001,.01,1,1,"DT")
2920220
"^DD",58.8,58.8001,.01,1,2,0)
58.8^C
"^DD",58.8,58.8001,.01,1,2,1)
S ^PSD(58.8,"C",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.8001,.01,1,2,2)
K ^PSD(58.8,"C",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.8001,.01,1,2,3)
DO NOT DELETE
"^DD",58.8,58.8001,.01,1,2,"%D",0)
^^2^2^2920912^^^
"^DD",58.8,58.8001,.01,1,2,"%D",1,0)
This cross-reference will be used for various reports within the
"^DD",58.8,58.8001,.01,1,2,"%D",2,0)
Drug Accountability and Controlled Substances modules.
"^DD",58.8,58.8001,.01,1,2,"DT")
2920330
"^DD",58.8,58.8001,.01,3)
Enter the name of the drug being stocked in this Pharmacy location.
"^DD",58.8,58.8001,.01,4)

"^DD",58.8,58.8001,.01,12)
For CS locations, select only ACTIVE drugs marked for CS package use.
"^DD",58.8,58.8001,.01,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)"
"^DD",58.8,58.8001,.01,21,0)
^^2^2^2930413^^^^
"^DD",58.8,58.8001,.01,21,1,0)
This field contains a pointer to the drug being stocked in this Pharmacy
"^DD",58.8,58.8001,.01,21,2,0)
location.
"^DD",58.8,58.8001,.01,23,0)
^^5^5^2940914^^^^
"^DD",58.8,58.8001,.01,23,1,0)
Within the Controlled Substances module, select only ACTIVE drugs marked
"^DD",58.8,58.8001,.01,23,2,0)
for use in the CS package.   Do not select INACTIVE or NON-PHARMACY drugs.
"^DD",58.8,58.8001,.01,23,3,0)
This field should not be edited directly using VA FileMan.  The appropriate
"^DD",58.8,58.8001,.01,23,4,0)
screen for selecting ACTIVE drugs marked for CS use is contained within
"^DD",58.8,58.8001,.01,23,5,0)
the package functionality.  DINUMed pointer to File 50 - DRUG file.
"^DD",58.8,58.8001,.01,"DEL",.01,0)
I 1 W !,?5,"DO NOT DELETE.  For CS locations, use the Inactivate Stocked CS Drug option. "
"^DD",58.8,58.8001,.01,"DT")
2920330
"^DD",58.8,58.8001,1,0)
LOCATION^F^^0;2^K:$L(X)>12!($L(X)<1) X
"^DD",58.8,58.8001,1,.1)
Location
"^DD",58.8,58.8001,1,3)
Answer must be 1-12 characters in length.
"^DD",58.8,58.8001,1,21,0)
^^4^4^2950222^^^
"^DD",58.8,58.8001,1,21,1,0)
This is the location address of the drug in the Pharmacy location.  It
"^DD",58.8,58.8001,1,21,2,0)
can consist of up to 3 levels, each separated by a comma.  For example,
"^DD",58.8,58.8001,1,21,3,0)
"MR,CA,S3" or "CUR,CB,D1".  This information is used to sort drugs on
"^DD",58.8,58.8001,1,21,4,0)
inventory sheets and other printouts.
"^DD",58.8,58.8001,1,23,0)
^^3^3^2950222^^^
"^DD",58.8,58.8001,1,23,1,0)
Location address of this drug.  It can consist of up to 3 levels
"^DD",58.8,58.8001,1,23,2,0)
of locations defined in File 58.17 - AOU ITEM LOCATION file.
"^DD",58.8,58.8001,1,23,3,0)
Not to exceed 12 characters.
"^DD",58.8,58.8001,1,"DT")
2910904
"^DD",58.8,58.8001,2,0)
STOCK LEVEL^NJ6,0^^0;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,2,.1)
Stock Level
"^DD",58.8,58.8001,2,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,2,21,0)
^^2^2^2920504^^^
"^DD",58.8,58.8001,2,21,1,0)
This field contains the quantity that is the required stock level for the
"^DD",58.8,58.8001,2,21,2,0)
drug in this Pharmacy location.
"^DD",58.8,58.8001,2,"DT")
2920324
"^DD",58.8,58.8001,3,0)
BALANCE^NJ9,2^^0;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.8001,3,.1)
Balance
"^DD",58.8,58.8001,3,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.8,58.8001,3,21,0)
^^1^1^2920624^^^^
"^DD",58.8,58.8001,3,21,1,0)
This field contains the current balance (quantity) of this stocked drug.
"^DD",58.8,58.8001,3,"DT")
2930428
"^DD",58.8,58.8001,4,0)
REORDER LEVEL^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,4,.1)
Reorder Level
"^DD",58.8,58.8001,4,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,4,21,0)
^^2^2^2910815^
"^DD",58.8,58.8001,4,21,1,0)
This field contains the on-hand level that must be reached before a drug
"^DD",58.8,58.8001,4,21,2,0)
will have replacements dispensed.
"^DD",58.8,58.8001,4,"DT")
2920324
"^DD",58.8,58.8001,5,0)
QUANTITY TO REORDER^NJ6,0^^0;6^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,5,.1)
Quantity to Reorder
"^DD",58.8,58.8001,5,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,5,21,0)
^^1^1^2920624^^
"^DD",58.8,58.8001,5,21,1,0)
This field contains the quantity to reorder for this stocked drug.
"^DD",58.8,58.8001,5,"DT")
2920324
"^DD",58.8,58.8001,6,0)
DA CONVERSION #^CJ8,0^^ ; ^X ^DD(58.8001,6,9.2) S D0=$P(Y(58.8001,6,1),U,1) S:'$D(^PSDRUG(+D0,0)) D0=-1 S Y(58.8001,6,101)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=$P(Y(58.8001,6,101),U,5) S D0=Y(58.8001,6,80) S D1=Y(58.8001,6,81)
"^DD",58.8,58.8001,6,.1)
Drug Accountability Conversion #
"^DD",58.8,58.8001,6,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,6,9)
^
"^DD",58.8,58.8001,6,9.01)
50^15;58.8001^.01
"^DD",58.8,58.8001,6,9.1)
DRUG:DISPENSE UNITS PER ORDER UNIT
"^DD",58.8,58.8001,6,9.2)
S Y(58.8001,6,81)=$S($D(D1):D1,1:""),Y(58.8001,6,80)=$S($D(D0):D0,1:""),Y(58.8001,6,1)=$S($D(^PSD(58.8,D0,1,D1,0)):^(0),1:"")
"^DD",58.8,58.8001,6,21,0)
^^3^3^2920903^^^
"^DD",58.8,58.8001,6,21,1,0)
This field is computed by the value in the corresponding drug field,
"^DD",58.8,58.8001,6,21,2,0)
dispensing units per order unit and used to convert receipts.
"^DD",58.8,58.8001,6,21,3,0)
 
"^DD",58.8,58.8001,6,"DT")
2920422
"^DD",58.8,58.8001,7,0)
BREAKDOWN UNIT^F^^0;8^K:$L(X)>10!($L(X)<1)!'(X?1A.A) X
"^DD",58.8,58.8001,7,.1)
Breakdown Unit
"^DD",58.8,58.8001,7,3)
Enter dispensing unit, i.e., PACK, BOTTLE, EACH.  Not to exceed 10 characters.
"^DD",58.8,58.8001,7,21,0)
^^6^6^2921123^^^^
"^DD",58.8,58.8001,7,21,1,0)
This unit represents the pharmacy dispensing unit.
"^DD",58.8,58.8001,7,21,2,0)
Examples: BOX, EACH, BOTTLE, etc.
"^DD",58.8,58.8001,7,21,3,0)
   
"^DD",58.8,58.8001,7,21,4,0)
In the Controlled Substances module this is referred to as the "Narcotic
"^DD",58.8,58.8001,7,21,5,0)
Breakdown Unit" and will be displayed during order entry.  This information
"^DD",58.8,58.8001,7,21,6,0)
is required for order entry.
"^DD",58.8,58.8001,7,23,0)
^^3^3^2921123^^^^
"^DD",58.8,58.8001,7,23,1,0)
The breakdown unit name is free text not to exceed 10 characters.
"^DD",58.8,58.8001,7,23,2,0)
In the Controlled Substances module this unit is required for order
"^DD",58.8,58.8001,7,23,3,0)
entry.
"^DD",58.8,58.8001,7,"DT")
2920330
"^DD",58.8,58.8001,8,0)
PACKAGE SIZE^NJ6,0^^0;9^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,8,.1)
Package Size
"^DD",58.8,58.8001,8,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,8,21,0)
^^5^5^2941027^^^^
"^DD",58.8,58.8001,8,21,1,0)
This is the number of units dispensed from pharmacy.
"^DD",58.8,58.8001,8,21,2,0)
  
"^DD",58.8,58.8001,8,21,3,0)
In the Controlled Substances module, this is referred to as the "Narcotic
"^DD",58.8,58.8001,8,21,4,0)
Package Size" and will be displayed during order entry.  This information
"^DD",58.8,58.8001,8,21,5,0)
is required for order entry.
"^DD",58.8,58.8001,8,23,0)
^^1^1^2920912^^^
"^DD",58.8,58.8001,8,23,1,0)
In the Controlled Substances module this is required for order entry.
"^DD",58.8,58.8001,8,"DT")
2920330
"^DD",58.8,58.8001,8.5,0)
MAXIMUM QUANTITY PER ORDER^NJ6,0X^^0;7^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X I $P($G(^PSD(58.8,DA(1),1,DA,0)),U,9),$G(X)#$P($G(^(0)),U,9) D EN^DDIOL("Must be a multiple of "_$P($G(^(0)),U,9)) K X
"^DD",58.8,58.8001,8.5,3)
Type a Number between 0 and 999999, 0 Decimal Digits, and a multiple of the package size.
"^DD",58.8,58.8001,8.5,21,0)
^^5^5^2940608^^
"^DD",58.8,58.8001,8.5,21,1,0)
     For an NAOU that is keeping a perpetual inventory, this field may be
"^DD",58.8,58.8001,8.5,21,2,0)
used to limit the maximum quantity that Nursing Service may enter for any
"^DD",58.8,58.8001,8.5,21,3,0)
single order for this drug.  If this field is left blank, deleted, or set
"^DD",58.8,58.8001,8.5,21,4,0)
to zero, Nursing Service will be able to enter any quantity that is a 
"^DD",58.8,58.8001,8.5,21,5,0)
multiple of package size, up to 999999, for any single order of this drug.
"^DD",58.8,58.8001,8.5,23,0)
^^4^4^2940914^^^
"^DD",58.8,58.8001,8.5,23,1,0)
If the fifth piece of the second node of an entry in File 58.8 equals 1,
"^DD",58.8,58.8001,8.5,23,2,0)
the routine PSDSTK will allow access to this field.  Under the same
"^DD",58.8,58.8001,8.5,23,3,0)
circumstances, this field will be used to limit order entry in routine
"^DD",58.8,58.8001,8.5,23,4,0)
PSDOR2.
"^DD",58.8,58.8001,8.5,"DT")
2940608
"^DD",58.8,58.8001,9,0)
MANUFACTURER^F^^0;10^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.8001,9,.1)
Manufacturer
"^DD",58.8,58.8001,9,3)
Answer must be 1-30 characters in length.
"^DD",58.8,58.8001,9,21,0)
^^2^2^2920624^^^
"^DD",58.8,58.8001,9,21,1,0)
This field contains the manufacturer of the currently stocked drug in
"^DD",58.8,58.8001,9,21,2,0)
this Pharmacy location.
"^DD",58.8,58.8001,9,"DT")
2910904
"^DD",58.8,58.8001,10,0)
LOT #^F^^0;11^K:$L(X)>10!($L(X)<1) X
"^DD",58.8,58.8001,10,.1)
Lot #
"^DD",58.8,58.8001,10,3)
Answer must be 1-10 characters in length.
"^DD",58.8,58.8001,10,21,0)
^^2^2^2920624^^^
"^DD",58.8,58.8001,10,21,1,0)
This field contains the lot # of the currently stocked drug in this
"^DD",58.8,58.8001,10,21,2,0)
Pharmacy location.
"^DD",58.8,58.8001,10,"DT")
2910904
"^DD",58.8,58.8001,11,0)
EXPIRATION DATE^D^^0;12^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,11,.1)
Expiration Date
"^DD",58.8,58.8001,11,1,0)
^.1
"^DD",58.8,58.8001,11,1,1,0)
58.8^AEXP^MUMPS
"^DD",58.8,58.8001,11,1,1,1)
S ^PSD(58.8,"AEXP",$E(X,1,30),DA,DA(1))=""
"^DD",58.8,58.8001,11,1,1,2)
K ^PSD(58.8,"AEXP",$E(X,1,30),DA,DA(1))
"^DD",58.8,58.8001,11,1,1,3)
DO NOT DELETE
"^DD",58.8,58.8001,11,1,1,"%D",0)
^^4^4^2940914^^^^
"^DD",58.8,58.8001,11,1,1,"%D",1,0)
This cross-reference is used for compiling the Expiration Date Report
"^DD",58.8,58.8001,11,1,1,"%D",2,0)
in the Controlled Substances module.
"^DD",58.8,58.8001,11,1,1,"%D",3,0)
  
"^DD",58.8,58.8001,11,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"AEXP",DATE,DRUG,DA)="".
"^DD",58.8,58.8001,11,1,1,"DT")
2920310
"^DD",58.8,58.8001,11,3)
Enter expiration date for this drug.
"^DD",58.8,58.8001,11,21,0)
^^1^1^2920504^^^
"^DD",58.8,58.8001,11,21,1,0)
This field contains the expiration date for this stocked drug.
"^DD",58.8,58.8001,11,23,0)
^^1^1^2920504^
"^DD",58.8,58.8001,11,23,1,0)
Date may be imprecise.
"^DD",58.8,58.8001,11,"DT")
2920421
"^DD",58.8,58.8001,12,0)
PRIME VENDOR ITEM #^F^^0;13^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3) X
"^DD",58.8,58.8001,12,.1)

"^DD",58.8,58.8001,12,1,0)
^.1
"^DD",58.8,58.8001,12,1,1,0)
58.8001^C
"^DD",58.8,58.8001,12,1,1,1)
S ^PSD(58.8,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",58.8,58.8001,12,1,1,2)
K ^PSD(58.8,DA(1),1,"C",$E(X,1,30),DA)
"^DD",58.8,58.8001,12,1,1,"%D",0)
^^1^1^2920526^
"^DD",58.8,58.8001,12,1,1,"%D",1,0)
To allow look-up by Prime Vendor Item number during receiving.
"^DD",58.8,58.8001,12,1,1,"DT")
2920526
"^DD",58.8,58.8001,12,3)
Answer must be 3-30 characters in length.
"^DD",58.8,58.8001,12,21,0)
^^2^2^2920817^^^^
"^DD",58.8,58.8001,12,21,1,0)
To allow look-up by Prime Vendor Item # during receipt process.
"^DD",58.8,58.8001,12,21,2,0)
Also to locate by Prime Vendor Item #, all receipts for that item.
"^DD",58.8,58.8001,12,23,0)
^^1^1^2920817^^^
"^DD",58.8,58.8001,12,23,1,0)
Used as a cross-reference for look-up during Prime Vendor receiving.
"^DD",58.8,58.8001,12,"DT")
2920526
"^DD",58.8,58.8001,13,0)
INACTIVATION DATE^D^^0;14^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,13,.1)
Inactivation Date
"^DD",58.8,58.8001,13,1,0)
^.1
"^DD",58.8,58.8001,13,1,1,0)
58.8001^AC^MUMPS
"^DD",58.8,58.8001,13,1,1,1)
S ^PSD(58.8,DA(1),1,DA,"I",X)=""
"^DD",58.8,58.8001,13,1,1,2)
K ^PSD(58.8,DA(1),1,DA,"I",X) D DELR^PSDUTL
"^DD",58.8,58.8001,13,1,1,"%D",0)
^^1^1^2920114^^
"^DD",58.8,58.8001,13,1,1,"%D",1,0)
This cross reference is used for locating inactivated CS stocked drugs.
"^DD",58.8,58.8001,13,1,1,"DT")
2920114
"^DD",58.8,58.8001,13,21,0)
^^3^3^2920305^^
"^DD",58.8,58.8001,13,21,1,0)
This field contains the date on which this drug was inactivated, and thus
"^DD",58.8,58.8001,13,21,2,0)
is no longer considered part of the standard stock for this Pharmacy
"^DD",58.8,58.8001,13,21,3,0)
location.
"^DD",58.8,58.8001,13,"DT")
2920114
"^DD",58.8,58.8001,14,0)
INACTIVATION REASON^S^N:NOT USED;O:OTHER;DF:DELETED FROM FORMULARY;^0;15^Q
"^DD",58.8,58.8001,14,.1)
Inactivation Reason
"^DD",58.8,58.8001,14,21,0)
^^2^2^2921117^^^^
"^DD",58.8,58.8001,14,21,1,0)
This field contains the reason that the drug has been inactivated from
"^DD",58.8,58.8001,14,21,2,0)
the list of drugs normally stocked in this Pharmacy location.
"^DD",58.8,58.8001,14,"DT")
2910911
"^DD",58.8,58.8001,14.5,0)
INACTIVATION REASON (OTHER)^F^^0;16^K:$L(X)>40!($L(X)<3) X
"^DD",58.8,58.8001,14.5,.1)
Inactivation Reason (Other)
"^DD",58.8,58.8001,14.5,3)
Answer must be 3-40 characters in length.
"^DD",58.8,58.8001,14.5,21,0)
^^3^3^2921117^^^^
"^DD",58.8,58.8001,14.5,21,1,0)
This field contains the custom reason for inactivating the drug from
"^DD",58.8,58.8001,14.5,21,2,0)
the stock list.  An inactivation reason of "other" should have been
"^DD",58.8,58.8001,14.5,21,3,0)
entered if a custom reason is to be listed.
"^DD",58.8,58.8001,14.5,"DT")
2910911
"^DD",58.8,58.8001,15,0)
WARD (FOR DRUG)^58.800115PA^^1;0
"^DD",58.8,58.8001,15,21,0)
^^3^3^2920912^^^
"^DD",58.8,58.8001,15,21,1,0)
Names of the ward or wards using this drug will be entered.  This is
"^DD",58.8,58.8001,15,21,2,0)
a link between the Controlled Substances package and the Unit Dose
"^DD",58.8,58.8001,15,21,3,0)
package for determining ward stocked drugs.
"^DD",58.8,58.8001,16,0)
INVENTORY TYPE^58.800116PA^^2;0
"^DD",58.8,58.8001,16,21,0)
^^2^2^2920718^^
"^DD",58.8,58.8001,16,21,1,0)
Inventory types are used to group related drugs in a Narcotic Area of
"^DD",58.8,58.8001,16,21,2,0)
Use.
"^DD",58.8,58.8001,16,"DT")
2920122
"^DD",58.8,58.8001,17,0)
SKIP PRINTING VA FORM 10-2638?^S^1:YES;0:NO;^GS;1^Q
"^DD",58.8,58.8001,17,.1)
Skip printing VA Form 10-2638 when dispensing this drug?
"^DD",58.8,58.8001,17,3)
Enter "YES" or "1" to skip printing VA FORM 10-2638 when dispensing this drug.
"^DD",58.8,58.8001,17,21,0)
^^2^2^2940914^^
"^DD",58.8,58.8001,17,21,1,0)
Answer "1" or "YES" to skip printing the VA FORM 10-2638 (Green Sheet)
"^DD",58.8,58.8001,17,21,2,0)
when dispensing this drug to this Narcotic Area of Use.
"^DD",58.8,58.8001,17,"DT")
2920422
"^DD",58.8,58.8001,18,0)
ORDERS^58.800118A^^3;0
"^DD",58.8,58.8001,18,21,0)
^^2^2^2920912^^
"^DD",58.8,58.8001,18,21,1,0)
The ORDERS multiple stores all data associated with Controlled
"^DD",58.8,58.8001,18,21,2,0)
Substances order requests.
"^DD",58.8,58.8001,18,"DT")
2920319
"^DD",58.8,58.8001,19,0)
ACTIVITY^58.800119PA^^4;0
"^DD",58.8,58.8001,19,21,0)
^^5^5^2940923^^^^
"^DD",58.8,58.8001,19,21,1,0)
A link to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) where each
"^DD",58.8,58.8001,19,21,2,0)
receipt and adjustment is stored as an audit trail.
"^DD",58.8,58.8001,19,21,3,0)
  
"^DD",58.8,58.8001,19,21,4,0)
In the Controlled Substances package, each dispensing transaction is
"^DD",58.8,58.8001,19,21,5,0)
also stored.
"^DD",58.8,58.8001,20,0)
MONTHLY ACTIVITY^58.801A^^5;0
"^DD",58.8,58.8001,20,21,0)
^^2^2^2920718^
"^DD",58.8,58.8001,20,21,1,0)
As activity (receipts, adjustments, dispensing) occurs for each drug,
"^DD",58.8,58.8001,20,21,2,0)
an entry will be added here in which to store totals.
"^DD",58.8,58.8001,21,0)
PRICE PER DISPENSE UNIT^CJ10,2X^^ ; ^S X=$S($D(^PSDRUG(D1,660)):$P(^PSDRUG(D1,660),U,6),1:0)
"^DD",58.8,58.8001,21,9)
^
"^DD",58.8,58.8001,21,9.01)

"^DD",58.8,58.8001,21,9.1)
S X=$P(^PSDRUG(D1,660),U,6)
"^DD",58.8,58.8001,21,21,0)
^^1^1^2941208^^^^
"^DD",58.8,58.8001,21,21,1,0)
Computed by price per dispense unit in the DRUG file (#50).
"^DD",58.8,58.8001,21,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,21,23,1,0)
Uses price per dispense unit from File 50 - DRUG file.
"^DD",58.8,58.8001,21,"DT")
2920511
"^DD",58.8,58.8001,22,0)
LAST OP COLLECTION DATE^D^^6;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,22,3)
Enter the last date to collect Outpatient dispensing.
"^DD",58.8,58.8001,22,21,0)
^^3^3^2940915^^^^
"^DD",58.8,58.8001,22,21,1,0)
When collecting Outpatient dispensing data, this field will be used
"^DD",58.8,58.8001,22,21,2,0)
in conjunction with the "AL" cross-reference in File 52 - PRESCRIPTION
"^DD",58.8,58.8001,22,21,3,0)
file - to determine a starting point from which to gather dispensing data.
"^DD",58.8,58.8001,22,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.8001,22,23,1,0)
This field contains the date from the last
"^DD",58.8,58.8001,22,23,2,0)
collection of Outpatient dispensing data.
"^DD",58.8,58.8001,22,"DT")
2930713
"^DD",58.8,58.8001,22.1,0)
LAST OP COLLECTION RX^F^^6;5^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,22.1,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,22.1,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,22.1,21,1,0)
The last prescription for which dispensing data was collected.
"^DD",58.8,58.8001,22.1,23,0)
^^2^2^2930713^
"^DD",58.8,58.8001,22.1,23,1,0)
The last entry from the PRESCRIPTION file (#52) for which dispensing
"^DD",58.8,58.8001,22.1,23,2,0)
data was collected.
"^DD",58.8,58.8001,22.1,"DT")
2930713
"^DD",58.8,58.8001,22.2,0)
LAST OP PARTIAL DATE^D^^6;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,22.2,3)
Enter last partial date.
"^DD",58.8,58.8001,22.2,21,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,22.2,21,1,0)
The last date that a partial was dispensed for this drug.
"^DD",58.8,58.8001,22.2,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,22.2,23,1,0)
Determined by looping through the "AM" cross-reference in the PRESCRIPTION
"^DD",58.8,58.8001,22.2,23,2,0)
file (#52).
"^DD",58.8,58.8001,22.2,"DT")
2930713
"^DD",58.8,58.8001,22.3,0)
LAST OP PARTIAL RX^F^^6;8^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,22.3,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,22.3,21,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,22.3,21,1,0)
Last partial prescription dispensed.
"^DD",58.8,58.8001,22.3,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,22.3,23,1,0)
The last entry in the PRESCRIPTION file (#52) for which a partial was
"^DD",58.8,58.8001,22.3,23,2,0)
dispensed.
"^DD",58.8,58.8001,22.3,"DT")
2930713
"^DD",58.8,58.8001,23,0)
LAST OP RET TO STOCK DATE^D^^6;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,23,3)
Enter the last date for collection of Outpatient dispensing.
"^DD",58.8,58.8001,23,21,0)
^^4^4^2940915^^^
"^DD",58.8,58.8001,23,21,1,0)
When collecting Outpatient dispensing data, this field will be used
"^DD",58.8,58.8001,23,21,2,0)
in conjunction with the "AJ" cross-reference in File 52 - PRESCRIPTION
"^DD",58.8,58.8001,23,21,3,0)
file - to determine a starting point from which to gather return to
"^DD",58.8,58.8001,23,21,4,0)
stock data.
"^DD",58.8,58.8001,23,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.8001,23,23,1,0)
This field contains the date from the last
"^DD",58.8,58.8001,23,23,2,0)
collection of return to stock data in the Outpatient module.
"^DD",58.8,58.8001,23,"DT")
2930713
"^DD",58.8,58.8001,23.1,0)
LAST OP RET TO STOCK RX^F^^6;6^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,23.1,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,23.1,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.1,21,1,0)
The last prescription returned to stock.
"^DD",58.8,58.8001,23.1,23,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.1,23,1,0)
The last entry in the PRESCRIPTION file (#52) returned to stock.
"^DD",58.8,58.8001,23.1,"DT")
2930713
"^DD",58.8,58.8001,23.2,0)
LAST OP PARTIAL RET DATE^D^^6;9^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,23.2,3)
Enter date of last partial returned to stock.
"^DD",58.8,58.8001,23.2,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.2,21,1,0)
Date that the last partial was returned to stock for this drug.
"^DD",58.8,58.8001,23.2,23,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.2,23,1,0)
The date that the last partial was returned to stock for this drug.
"^DD",58.8,58.8001,23.2,"DT")
2930713
"^DD",58.8,58.8001,23.3,0)
LAST OP PARTIAL RET RX^F^^6;10^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,23.3,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,23.3,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.3,21,1,0)
The last partial prescription returned to stock for this drug.
"^DD",58.8,58.8001,23.3,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,23.3,23,1,0)
The last entry in the PRESCRIPTION file (#52) that had a partial returned to
"^DD",58.8,58.8001,23.3,23,2,0)
stock.
"^DD",58.8,58.8001,23.3,"DT")
2930713
"^DD",58.8,58.8001,24,0)
LAST IV COLLECTION DATE,WARD^F^^6;3^K:$L(X)>60!($L(X)<3) X
"^DD",58.8,58.8001,24,3)
Answer must be 3-60 characters in length.
"^DD",58.8,58.8001,24,21,0)
^^3^3^2940915^^^
"^DD",58.8,58.8001,24,21,1,0)
When collecting IV dispensing data, this field will be used to store
"^DD",58.8,58.8001,24,21,2,0)
the last date,ward collected from the IV STATS file (#50.8).  It will then
"^DD",58.8,58.8001,24,21,3,0)
be used as a starting point for future collections.
"^DD",58.8,58.8001,24,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,24,23,1,0)
Date and ward from File 50.8 - IV STATS file - at which dispensing data
"^DD",58.8,58.8001,24,23,2,0)
was last collected.
"^DD",58.8,58.8001,24,"DT")
2920903
"^DD",58.8,58.8001,25,0)
IV CONVERSION FACTOR^NJ9,2^^6;4^K:+X'=X!(X>999999)!(X<.01)!(X?.E1"."3N.N) X
"^DD",58.8,58.8001,25,3)
Enter a number to convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,21,0)
^^2^2^2940915^^^
"^DD",58.8,58.8001,25,21,1,0)
When dispensing occurs in the IV module, this number will be used to
"^DD",58.8,58.8001,25,21,2,0)
convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,23,0)
^^1^1^2940915^^^
"^DD",58.8,58.8001,25,23,1,0)
Used to convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,"DT")
2930702
"^DD",58.8,58.8001,26,0)
LIQUID?^S^0:NO;1:YES;^7;1^Q
"^DD",58.8,58.8001,26,3)
Is this CS drug a liquid?
"^DD",58.8,58.8001,26,21,0)
^^1^1^2930817^
"^DD",58.8,58.8001,26,21,1,0)
This field is used to flag a Controlled Substances drug as a liquid.
"^DD",58.8,58.8001,26,"DT")
2930817
"^DD",58.8,58.8001,27,0)
INITIALIZED BALANCE^S^1:YES;0:NO;^0;17^Q
"^DD",58.8,58.8001,27,3)
Enter YES if this drug balance has been initialized.
"^DD",58.8,58.8001,27,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.8001,27,21,1,0)
When the drug balance has been initialized, this field will be set
"^DD",58.8,58.8001,27,21,2,0)
to "1" or "YES".  A drug balance may only be initialized once.
"^DD",58.8,58.8001,27,"DT")
2930829
"^DD",58.8,58.8001,28,0)
RESTRICT FROM NAOUS?^S^1:YES;0:NO;^7;2^Q
"^DD",58.8,58.8001,28,3)
Enter "1" or "Y" to prevent one-time requests.
"^DD",58.8,58.8001,28,21,0)
^^3^3^2951122^^^
"^DD",58.8,58.8001,28,21,1,0)
     If the primary dispensing site for an NAOU allows one-time requests,
"^DD",58.8,58.8001,28,21,2,0)
entering "YES" will prevent this drug from being ordered by any NAOU that
"^DD",58.8,58.8001,28,21,3,0)
does not already stock it.
"^DD",58.8,58.8001,28,23,0)
^^1^1^2951122^^^
"^DD",58.8,58.8001,28,23,1,0)
Checked by order entry routines (PSDOR*) before allowing one-time requests.
"^DD",58.8,58.8001,28,"DT")
2950731
"^DD",58.8,58.8001,29,0)
ALWAYS PRINT VA FORM 10-2638?^S^1:YES;0:NO;^7;3^Q
"^DD",58.8,58.8001,29,3)
Enter "YES" or "1" to force printing VA FORM 10-2638.
"^DD",58.8,58.8001,29,21,0)
^^3^3^2960308^
"^DD",58.8,58.8001,29,21,1,0)
Answer "1" or "YES" to force printing a VA FORM 10-2638 even when
"^DD",58.8,58.8001,29,21,2,0)
dispensing to a Narcotic Area of Use that is keeping a perpetual
"^DD",58.8,58.8001,29,21,3,0)
inventory.
"^DD",58.8,58.8001,29,"DT")
2960308
"^DD",58.8,58.800115,0)
WARD (FOR DRUG) SUB-FIELD^^.01^1
"^DD",58.8,58.800115,0,"DT")
2920321
"^DD",58.8,58.800115,0,"NM","WARD (FOR DRUG)")

"^DD",58.8,58.800115,0,"UP")
58.8001
"^DD",58.8,58.800115,.01,0)
WARD (FOR DRUG)^MP42'X^DIC(42,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.800115,.01,1,0)
^.1
"^DD",58.8,58.800115,.01,1,1,0)
58.8^D^MUMPS
"^DD",58.8,58.800115,.01,1,1,1)
I $D(^PSD(58.8,DA(2),1,DA(1),0)),^(0) D INACT^PSDUTL I $D(PSDFLAG) S ^PSD(58.8,"D",+^(0),DA,DA(2))="" K PSDFLAG
"^DD",58.8,58.800115,.01,1,1,2)
I $D(^PSD(58.8,DA(2),1,DA(1),0)),^(0) K ^PSD(58.8,"D",+^(0),DA,DA(2))
"^DD",58.8,58.800115,.01,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800115,.01,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.8,58.800115,.01,1,1,"%D",1,0)
This cross-reference is the link between the Controlled Substances
"^DD",58.8,58.800115,.01,1,1,"%D",2,0)
package and the Unit Dose package for determining ward stocked drugs.
"^DD",58.8,58.800115,.01,1,1,"%D",3,0)
The cross-reference is ^PSD(58.8,"D",DRUG,WARD,DA)=""
"^DD",58.8,58.800115,.01,1,1,"DT")
2920321
"^DD",58.8,58.800115,.01,3)
Enter the ward which uses this drug.
"^DD",58.8,58.800115,.01,21,0)
^^5^5^2940920^^^^
"^DD",58.8,58.800115,.01,21,1,0)
This field contains information from the WARD LOCATION file (#42).  Names
"^DD",58.8,58.800115,.01,21,2,0)
of the ward or wards using this drug will be entered.  This is the
"^DD",58.8,58.800115,.01,21,3,0)
link between the Controlled Substances package and the Unit Dose
"^DD",58.8,58.800115,.01,21,4,0)
package for determining ward stocked drugs.
"^DD",58.8,58.800115,.01,21,5,0)
  
"^DD",58.8,58.800115,.01,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800115,.01,23,1,0)
DINUMed pointer to File 42 - WARD LOCATION file.
"^DD",58.8,58.800115,.01,"DT")
2920321
"^DD",58.8,58.800116,0)
INVENTORY TYPE SUB-FIELD^^.01^1
"^DD",58.8,58.800116,0,"DT")
2920213
"^DD",58.8,58.800116,0,"NM","INVENTORY TYPE")

"^DD",58.8,58.800116,0,"UP")
58.8001
"^DD",58.8,58.800116,.01,0)
TYPE^M*P58.16'X^PSI(58.16,^0;1^S DIC("S")="I $P(^(0),""^"")'=""ALL""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.800116,.01,1,0)
^.1^^0
"^DD",58.8,58.800116,.01,3)
Enter the inventory type(s) for this CS drug.
"^DD",58.8,58.800116,.01,12)
Screens out selection of "ALL" as Inventory Type.
"^DD",58.8,58.800116,.01,12.1)
S DIC("S")="I $P(^(0),""^"")'=""ALL"""
"^DD",58.8,58.800116,.01,21,0)
^^5^5^2940920^^^^
"^DD",58.8,58.800116,.01,21,1,0)
Pointer to the inventory types defined in File 58.16 - AOU INVENTORY
"^DD",58.8,58.800116,.01,21,2,0)
TYPE file.
"^DD",58.8,58.800116,.01,21,3,0)
   
"^DD",58.8,58.800116,.01,21,4,0)
The Controlled Substances module uses inventory types to group related
"^DD",58.8,58.800116,.01,21,5,0)
drugs in a Narcotic Area of Use.
"^DD",58.8,58.800116,.01,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800116,.01,23,1,0)
DINUMed pointer to File 58.16 - AOU INVENTORY TYPE file.
"^DD",58.8,58.800116,.01,"DT")
2920213
"^DD",58.8,58.800118,0)
ORDERS SUB-FIELD^^25^26
"^DD",58.8,58.800118,0,"DT")
2961031
"^DD",58.8,58.800118,0,"IX","B",58.800118,.01)

"^DD",58.8,58.800118,0,"NM","ORDERS")

"^DD",58.8,58.800118,0,"UP")
58.8001
"^DD",58.8,58.800118,.01,0)
REQUEST #^NJ8,0X^^0;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.800118,.01,1,0)
^.1
"^DD",58.8,58.800118,.01,1,1,0)
58.800118^B
"^DD",58.8,58.800118,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.800118,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.8,58.800118,.01,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.8,58.800118,.01,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,.01,21,1,0)
Internal entry number for this Controlled Substances request order.
"^DD",58.8,58.800118,.01,23,0)
^^1^1^2920503^
"^DD",58.8,58.800118,.01,23,1,0)
DINUM
"^DD",58.8,58.800118,.01,"DT")
2920322
"^DD",58.8,58.800118,1,0)
REQUEST DATE/TIME^D^^0;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,1,3)
Enter the request date or date/time for this order.
"^DD",58.8,58.800118,1,21,0)
^^2^2^2920912^^^
"^DD",58.8,58.800118,1,21,1,0)
The date or date/time this Controlled Substances request order was
"^DD",58.8,58.800118,1,21,2,0)
generated.
"^DD",58.8,58.800118,1,"DT")
2920319
"^DD",58.8,58.800118,2,0)
DISPENSING SITE^R*P58.8'^PSD(58.8,^0;3^S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,2,3)
Enter the Pharmacy dispensing location.
"^DD",58.8,58.800118,2,12)
Allows selection of master vault or satellite vault as a dispensing site.
"^DD",58.8,58.800118,2,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.8,58.800118,2,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.800118,2,21,1,0)
A pointer to the primary dispensing site for this Controlled Substances
"^DD",58.8,58.800118,2,21,2,0)
request order.  A primary dispensing site is defined in the DRUG
"^DD",58.8,58.800118,2,21,3,0)
ACCOUNTABILITY STATS file (#58.8) as a Master vault or Satellite vault.
"^DD",58.8,58.800118,2,23,0)
^^3^3^2940923^^^
"^DD",58.8,58.800118,2,23,1,0)
Screened pointer to File 58.8 - DRUG ACCOUNTABILITY STATS file.
"^DD",58.8,58.800118,2,23,2,0)
Allows selection of Master vault or Satellite vault as a dispensing
"^DD",58.8,58.800118,2,23,3,0)
site.
"^DD",58.8,58.800118,2,"DT")
2920325
"^DD",58.8,58.800118,3,0)
ORDERED BY^R*P200'^VA(200,^0;4^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,3,3)
Enter the name of the person requesting this CS order.
"^DD",58.8,58.800118,3,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.8,58.800118,3,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.8,58.800118,3,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,3,21,1,0)
A pointer to the name of the person requesting this Controlled Substances
"^DD",58.8,58.800118,3,21,2,0)
order.
"^DD",58.8,58.800118,3,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,3,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,3,"DT")
2920419
"^DD",58.8,58.800118,4,0)
DISPENSED BY^R*P200'^VA(200,^0;5^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,4,3)
Enter the name of the pharmacist dispensing this CS order.
"^DD",58.8,58.800118,4,12)
Access granted to pharmacist holding the appropriate security key.
"^DD",58.8,58.800118,4,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.8,58.800118,4,21,0)
^^2^2^2920912^^^
"^DD",58.8,58.800118,4,21,1,0)
A pointer to the name of the pharmacist dispensing the drug for this
"^DD",58.8,58.800118,4,21,2,0)
Controlled Substances order.
"^DD",58.8,58.800118,4,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,4,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,4,"DT")
2920503
"^DD",58.8,58.800118,5,0)
QUANTITY ORDERED^RNJ6,0^^0;6^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,5,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,5,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,5,21,1,0)
The drug quantity originally requested on this Controlled Substances
"^DD",58.8,58.800118,5,21,2,0)
order.
"^DD",58.8,58.800118,5,"DT")
2920330
"^DD",58.8,58.800118,6,0)
RECEIVED BY^*P200'^VA(200,^0;7^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,6,3)
Enter the name of the person receiving this CS order.
"^DD",58.8,58.800118,6,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.8,58.800118,6,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.8,58.800118,6,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,6,21,1,0)
A pointer to the name of the person receiving this Controlled Substances
"^DD",58.8,58.800118,6,21,2,0)
order.
"^DD",58.8,58.800118,6,23,0)
^^3^3^2940914^^^
"^DD",58.8,58.800118,6,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,6,23,2,0)
Limits selection to nurses or pharmacy personnel holding the
"^DD",58.8,58.800118,6,23,3,0)
appropriate security key.
"^DD",58.8,58.800118,6,"DT")
2930527
"^DD",58.8,58.800118,7,0)
MANUFACTURER^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.800118,7,3)
Enter the current manufacturer for the drug dispensed on this CS order.
"^DD",58.8,58.800118,7,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,7,21,1,0)
The current manufacturer of the drug dispensed on this Controlled
"^DD",58.8,58.800118,7,21,2,0)
Substances order.
"^DD",58.8,58.800118,7,"DT")
2920107
"^DD",58.8,58.800118,8,0)
LOT #^F^^0;9^K:$L(X)>10!($L(X)<1) X
"^DD",58.8,58.800118,8,3)
Enter the current lot # for the drug dispensed on this CS order.
"^DD",58.8,58.800118,8,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,8,21,1,0)
The current lot # for the drug dispensed on this Controlled Substances
"^DD",58.8,58.800118,8,21,2,0)
order.
"^DD",58.8,58.800118,8,"DT")
2920107
"^DD",58.8,58.800118,9,0)
EXPIRATION DATE^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,9,1,0)
^.1
"^DD",58.8,58.800118,9,1,1,0)
58.8^AEXPO^MUMPS
"^DD",58.8,58.800118,9,1,1,1)
S ^PSD(58.8,"AEXPO",$E(X,1,30),DA(1),DA(2),DA)=""
"^DD",58.8,58.800118,9,1,1,2)
K ^PSD(58.8,"AEXPO",$E(X,1,30),DA(1),DA(2),DA)
"^DD",58.8,58.800118,9,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,9,1,1,"%D",0)
^^4^4^2940929^^^^
"^DD",58.8,58.800118,9,1,1,"%D",1,0)
This cross-reference is used for compiling the Expiration Date
"^DD",58.8,58.800118,9,1,1,"%D",2,0)
Report in the Controlled Substances module.
"^DD",58.8,58.800118,9,1,1,"%D",3,0)
  
"^DD",58.8,58.800118,9,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"AEXPO",DATE,DRUG,NAOU,REQUEST #)=""
"^DD",58.8,58.800118,9,1,1,"DT")
2920504
"^DD",58.8,58.800118,9,3)
Enter the expiration date for the drug dispensed on this CS order.
"^DD",58.8,58.800118,9,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,9,21,1,0)
The current expiration date for the drug dispensed on this Controlled
"^DD",58.8,58.800118,9,21,2,0)
Substances order.
"^DD",58.8,58.800118,9,23,0)
^^1^1^2920624^^
"^DD",58.8,58.800118,9,23,1,0)
Date may be imprecise.
"^DD",58.8,58.800118,9,"DT")
2920504
"^DD",58.8,58.800118,10,0)
ORDER STATUS^P58.82'^PSD(58.82,^0;11^Q
"^DD",58.8,58.800118,10,1,0)
^.1
"^DD",58.8,58.800118,10,1,1,0)
58.8^AC^MUMPS
"^DD",58.8,58.800118,10,1,1,1)
S ^PSD(58.8,"AC",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,10,1,1,2)
K ^PSD(58.8,"AC",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,10,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,10,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.8,58.800118,10,1,1,"%D",1,0)
This cross reference is used in compiling data for various Controlled
"^DD",58.8,58.800118,10,1,1,"%D",2,0)
Substances statistical reports.
"^DD",58.8,58.800118,10,1,1,"%D",3,0)
It represents ^PSD(58.8,"AC",ORDER STATUS,NAOU,DRUG,REQUEST #)=""
"^DD",58.8,58.800118,10,1,1,"DT")
2920325
"^DD",58.8,58.800118,10,3)
Enter the status of this Controlled Substances order.
"^DD",58.8,58.800118,10,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,10,21,1,0)
The status of this Controlled Substances order.
"^DD",58.8,58.800118,10,"DT")
2920325
"^DD",58.8,58.800118,11,0)
COMPLETION STATUS^P58.83'^PSD(58.83,^0;12^Q
"^DD",58.8,58.800118,11,1,0)
^.1^^0
"^DD",58.8,58.800118,11,3)
Enter the completion status of this Controlled Substances order.
"^DD",58.8,58.800118,11,21,0)
^^1^1^2920916^^
"^DD",58.8,58.800118,11,21,1,0)
The completion status for this Controlled Substances order.
"^DD",58.8,58.800118,11,"DT")
2920629
"^DD",58.8,58.800118,12,0)
COMPLETION DATE/TIME^D^^0;13^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,12,3)
Enter the date/time this order was completed.
"^DD",58.8,58.800118,12,21,0)
^^1^1^2920912^^^^
"^DD",58.8,58.800118,12,21,1,0)
The date or date/time this Controlled Substances order was completed.
"^DD",58.8,58.800118,12,"DT")
2930701
"^DD",58.8,58.800118,13,0)
COMMENTS^58.80011813^^1;0
"^DD",58.8,58.800118,13,21,0)
^^2^2^2920915^^^^
"^DD",58.8,58.800118,13,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.8,58.800118,13,21,2,0)
request.
"^DD",58.8,58.800118,14,0)
DISPENSED DATE/TIME^D^^0;14^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,14,1,0)
^.1
"^DD",58.8,58.800118,14,1,1,0)
58.8^AD
"^DD",58.8,58.800118,14,1,1,1)
S ^PSD(58.8,"AD",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,14,1,1,2)
K ^PSD(58.8,"AD",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,14,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,14,1,1,"DT")
2920908
"^DD",58.8,58.800118,14,3)
Enter the date/time pharmacy dispensed this drug.
"^DD",58.8,58.800118,14,21,0)
^^2^2^2920915^^^
"^DD",58.8,58.800118,14,21,1,0)
The date or date/time this Controlled Substances order was dispensed
"^DD",58.8,58.800118,14,21,2,0)
from pharmacy.
"^DD",58.8,58.800118,14,"DT")
2930701
"^DD",58.8,58.800118,15,0)
RECEIPT DATE/TIME^D^^0;15^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,15,1,0)
^.1^^0
"^DD",58.8,58.800118,15,3)
Enter date/time this drug was received into this Narcotic Area of Use.
"^DD",58.8,58.800118,15,21,0)
^^2^2^2920503^
"^DD",58.8,58.800118,15,21,1,0)
The date or date/time this drug order was received into this Narcotic
"^DD",58.8,58.800118,15,21,2,0)
Area of Use.
"^DD",58.8,58.800118,15,"DT")
2920908
"^DD",58.8,58.800118,16,0)
PHARMACY DISPENSING #^F^^0;16^K:$L(X)>9!($L(X)<1) X
"^DD",58.8,58.800118,16,1,0)
^.1
"^DD",58.8,58.800118,16,1,1,0)
58.8^F
"^DD",58.8,58.800118,16,1,1,1)
S ^PSD(58.8,"F",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,16,1,1,2)
K ^PSD(58.8,"F",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,16,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,16,1,1,"DT")
2920513
"^DD",58.8,58.800118,16,3)
Answer must be 1-9 characters in length.
"^DD",58.8,58.800118,16,21,0)
^^6^6^2940914^^^^
"^DD",58.8,58.800118,16,21,1,0)
The Controlled Substances control number (Green Sheet #) pharmacy assigned
"^DD",58.8,58.800118,16,21,2,0)
to this order.
"^DD",58.8,58.800118,16,21,3,0)
   
"^DD",58.8,58.800118,16,21,4,0)
If the site parameter "AUTO GENERATE DISPENSING #'S?" was answered
"^DD",58.8,58.800118,16,21,5,0)
"YES", this number will be automatically generated within the
"^DD",58.8,58.800118,16,21,6,0)
Controlled Substances package.
"^DD",58.8,58.800118,16,"DT")
2920812
"^DD",58.8,58.800118,17,0)
TRANSACTION #^P58.81'^PSD(58.81,^0;17^Q
"^DD",58.8,58.800118,17,3)
Enter the transaction number for this CS order.
"^DD",58.8,58.800118,17,21,0)
^^1^1^2920912^^^^
"^DD",58.8,58.800118,17,21,1,0)
A pointer to the transaction for this Controlled Substances order.
"^DD",58.8,58.800118,17,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800118,17,23,1,0)
Pointer to File 58.81 - DRUG ACCOUNTABILITY TRANSACTION file.
"^DD",58.8,58.800118,17,"DT")
2920322
"^DD",58.8,58.800118,18,0)
RX #^P52'^PSRX(^0;18^Q
"^DD",58.8,58.800118,18,3)
Enter the prescription number for this CS order.
"^DD",58.8,58.800118,18,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,18,21,1,0)
The prescription number for this Controlled Substances order.
"^DD",58.8,58.800118,18,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,18,23,1,0)
Pointer to File 52 - PRESCRIPTION file.
"^DD",58.8,58.800118,18,"DT")
2920323
"^DD",58.8,58.800118,19,0)
QUANTITY DISPENSED^NJ6,0^^0;19^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,19,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,19,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,19,21,1,0)
The actual quantity of the drug dispensed from pharmacy on this
"^DD",58.8,58.800118,19,21,2,0)
Controlled Substances order.
"^DD",58.8,58.800118,19,"DT")
2920330
"^DD",58.8,58.800118,20,0)
QUANTITY RECEIVED^NJ6,0^^0;20^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,20,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,20,21,0)
^^2^2^2930823^^^^
"^DD",58.8,58.800118,20,21,1,0)
The actual quantity of the drug received on this Controlled Substances
"^DD",58.8,58.800118,20,21,2,0)
order.
"^DD",58.8,58.800118,20,"DT")
2930823
"^DD",58.8,58.800118,21,0)
DISCREPANCY UNRESOLVED^S^1:YES;0:NO;^0;21^Q
"^DD",58.8,58.800118,21,1,0)
^.1^^0
"^DD",58.8,58.800118,21,3)
Answer "YES" if this receiving discrepancy is unresolved.
"^DD",58.8,58.800118,21,21,0)
^^3^3^2921106^^
"^DD",58.8,58.800118,21,21,1,0)
If the actual quantity of the drug received is different from the
"^DD",58.8,58.800118,21,21,2,0)
actual quantity pharmacy dispensed, then this field will be set
"^DD",58.8,58.800118,21,21,3,0)
to "1" or "YES".
"^DD",58.8,58.800118,21,"DT")
2920629
"^DD",58.8,58.800118,22,0)
BALANCE^NJ6,0^^0;22^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,22,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,22,21,0)
^^1^1^2930823^^^^
"^DD",58.8,58.800118,22,21,1,0)
Actual balance of the drug for this Controlled Substances order.
"^DD",58.8,58.800118,22,"DT")
2930823
"^DD",58.8,58.800118,23,0)
COMPLETED BY NURSE^*P200'^VA(200,^2;1^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,23,3)
Enter the name of the nurse returning this order.
"^DD",58.8,58.800118,23,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.8,58.800118,23,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.8,58.800118,23,21,0)
^^2^2^2940914^^^^
"^DD",58.8,58.800118,23,21,1,0)
A pointer to the name of the nurse returning the VA FORM 10-2638
"^DD",58.8,58.800118,23,21,2,0)
(Green Sheet) to pharmacy.
"^DD",58.8,58.800118,23,23,0)
^^2^2^2940914^
"^DD",58.8,58.800118,23,23,1,0)
Screened pointer to File 200 - NEW PERSON file.  Limits selection
"^DD",58.8,58.800118,23,23,2,0)
to nurses holding the appropriate security key.
"^DD",58.8,58.800118,23,"DT")
2930527
"^DD",58.8,58.800118,24,0)
EMERGENCY^S^1:YES;0:NO;^2;2^Q
"^DD",58.8,58.800118,24,3)
Answer "YES" if this is an emergency order.
"^DD",58.8,58.800118,24,21,0)
^^2^2^2950214^
"^DD",58.8,58.800118,24,21,1,0)
A "YES" entry in this field will cause an order to print on the pharmacy
"^DD",58.8,58.800118,24,21,2,0)
emergency order printer and allow for expedited processing.
"^DD",58.8,58.800118,24,23,0)
^^1^1^2950214^^
"^DD",58.8,58.800118,24,23,1,0)
This field is used to flag orders for expedited processing.
"^DD",58.8,58.800118,24,"DT")
2950214
"^DD",58.8,58.800118,25,0)
BALANCE BEFORE RECEIPT^NJ10,3^^2;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."4N.N) X
"^DD",58.8,58.800118,25,3)
Type a Number between 0 and 999999, 3 Decimal Digits
"^DD",58.8,58.800118,25,21,0)
^^1^1^2961031^
"^DD",58.8,58.800118,25,21,1,0)
The balance of this drug before receiving this order
"^DD",58.8,58.800118,25,"DT")
2961031
"^DD",58.8,58.80011813,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",58.8,58.80011813,0,"DT")
2920323
"^DD",58.8,58.80011813,0,"NM","COMMENTS")

"^DD",58.8,58.80011813,0,"UP")
58.800118
"^DD",58.8,58.80011813,.01,0)
COMMENTS^W^^0;1^Q
"^DD",58.8,58.80011813,.01,3)
Enter any comments for this order.
"^DD",58.8,58.80011813,.01,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.80011813,.01,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.8,58.80011813,.01,21,2,0)
request.
"^DD",58.8,58.80011813,.01,"DT")
2920323
"^DD",58.8,58.800119,0)
ACTIVITY SUB-FIELD^^.01^1
"^DD",58.8,58.800119,0,"DT")
2920423
"^DD",58.8,58.800119,0,"IX","B",58.800119,.01)

"^DD",58.8,58.800119,0,"NM","ACTIVITY")

"^DD",58.8,58.800119,0,"UP")
58.8001
"^DD",58.8,58.800119,.01,0)
ACTIVITY^MP58.81X^PSD(58.81,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.800119,.01,1,0)
^.1
"^DD",58.8,58.800119,.01,1,1,0)
58.800119^B
"^DD",58.8,58.800119,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.800119,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)
"^DD",58.8,58.800119,.01,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.800119,.01,21,1,0)
A link to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) where each
"^DD",58.8,58.800119,.01,21,2,0)
receipt and adjustment is stored as an audit trail.
"^DD",58.8,58.800119,.01,23,0)
^^2^2^2940923^^^
"^DD",58.8,58.800119,.01,23,1,0)
Points to File 58.81 - DRUG ACCOUNTABILITY TRANSACTION file - where full
"^DD",58.8,58.800119,.01,23,2,0)
information about each transaction is stored.
"^DD",58.8,58.800119,.01,"DT")
2920427
"^DD",58.8,58.801,0)
MONTHLY ACTIVITY SUB-FIELD^^12^13
"^DD",58.8,58.801,0,"DT")
2930923
"^DD",58.8,58.801,0,"IX","B",58.801,.01)

"^DD",58.8,58.801,0,"NM","MONTHLY ACTIVITY")

"^DD",58.8,58.801,0,"UP")
58.8001
"^DD",58.8,58.801,.01,0)
MONTHLY ACTIVITY^NJ5,0OX^^0;1^K:+X'=X!(X>9999999)!(X<29204)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.801,.01,1,0)
^.1^^0
"^DD",58.8,58.801,.01,1,1,0)
58.801^B
"^DD",58.8,58.801,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.801,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),5,"B",$E(X,1,30),DA)
"^DD",58.8,58.801,.01,2)
S Y(0)=Y X ^DD("DD")
"^DD",58.8,58.801,.01,2.1)
X ^DD("DD")
"^DD",58.8,58.801,.01,3)
Type a Number between 29204 and 9999999, 0 Decimal Digits
"^DD",58.8,58.801,.01,21,0)
^^2^2^2930225^^^
"^DD",58.8,58.801,.01,21,1,0)
As activity (receipts, adjustments, dispensing) occurs for each drug,
"^DD",58.8,58.801,.01,21,2,0)
an entry will be added here in which to store totals.
"^DD",58.8,58.801,.01,23,0)
^^1^1^2930225^^^
"^DD",58.8,58.801,.01,23,1,0)
Month of activity stored in seven digit FM format.
"^DD",58.8,58.801,.01,"DT")
2930225
"^DD",58.8,58.801,1,0)
BEGINNING BALANCE^NJ10,2^^0;2^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,1,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,1,21,0)
^^2^2^2921106^^^^
"^DD",58.8,58.801,1,21,1,0)
At the beginning of each month, the current balance of a drug will be
"^DD",58.8,58.801,1,21,2,0)
stuffed here by a queued option.
"^DD",58.8,58.801,1,23,0)
^^1^1^2921106^^^
"^DD",58.8,58.801,1,23,1,0)
The balance of a drug at the beginning of the month.
"^DD",58.8,58.801,1,"DT")
2930503
"^DD",58.8,58.801,2,0)
BEGINNING VALUE^CJ10,2X^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,2,2)=X S Y(58.801,2,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,2,1),U,2)*Y(58.801,2,2)
"^DD",58.8,58.801,2,9)
^
"^DD",58.8,58.801,2,9.01)
58.8001^12;58.801^1
"^DD",58.8,58.801,2,9.1)
BEG*PRICE PER DI
"^DD",58.8,58.801,2,21,0)
^^2^2^2940923^^^^
"^DD",58.8,58.801,2,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,2,21,2,0)
beginning balance.
"^DD",58.8,58.801,2,23,0)
^^2^2^2940923^^^^
"^DD",58.8,58.801,2,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times beginning
"^DD",58.8,58.801,2,23,2,0)
balance.
"^DD",58.8,58.801,2,"DT")
2920429
"^DD",58.8,58.801,3,0)
ENDING BALANCE^NJ10,2^^0;4^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,3,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,3,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.801,3,21,1,0)
At the beginning of each month the current balance will be stuffed as
"^DD",58.8,58.801,3,21,2,0)
the previous month's ending balance.
"^DD",58.8,58.801,3,23,0)
^^1^1^2940923^^
"^DD",58.8,58.801,3,23,1,0)
The balance of a drug at the end of the month.
"^DD",58.8,58.801,3,"DT")
2930503
"^DD",58.8,58.801,4,0)
ENDING VALUE^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,4,2)=X S Y(58.801,4,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,4,1),U,4)*Y(58.801,4,2)
"^DD",58.8,58.801,4,9)
^
"^DD",58.8,58.801,4,9.01)
58.8001^21;58.801^3
"^DD",58.8,58.801,4,9.1)
ENDING BALANCE*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,4,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,4,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,4,21,2,0)
ending balance.
"^DD",58.8,58.801,4,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,4,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times ending
"^DD",58.8,58.801,4,23,2,0)
balance.
"^DD",58.8,58.801,5,0)
TOTAL RECEIVED^NJ10,2^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,5,3)
Type a Number between 0 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,5,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,5,21,1,0)
Each receipt added to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) will
"^DD",58.8,58.801,5,21,2,0)
increment this amount.
"^DD",58.8,58.801,5,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,5,23,1,0)
Incremented by receipt transactions in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,5,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,5,"DT")
2930923
"^DD",58.8,58.801,6,0)
VALUE RECEIVED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,6,2)=X S Y(58.801,6,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,6,1),U,3)*Y(58.801,6,2)
"^DD",58.8,58.801,6,9)
^
"^DD",58.8,58.801,6,9.01)
58.8001^21;58.801^5
"^DD",58.8,58.801,6,9.1)
TOTAL RECEIVED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,6,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,6,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,6,21,2,0)
total received.
"^DD",58.8,58.801,6,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,6,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,6,23,2,0)
received.
"^DD",58.8,58.801,7,0)
TOTAL ADJUSTED^NJ10,2^^0;5^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,7,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,7,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,7,21,1,0)
Each adjustment added to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81)
"^DD",58.8,58.801,7,21,2,0)
will increment/decrement this amount.
"^DD",58.8,58.801,7,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,7,23,1,0)
Incremented/decremented by adjustments in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,7,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,7,"DT")
2930923
"^DD",58.8,58.801,8,0)
VALUE ADJUSTED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,8,2)=X S Y(58.801,8,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,8,1),U,5)*Y(58.801,8,2)
"^DD",58.8,58.801,8,9)
^
"^DD",58.8,58.801,8,9.01)
58.8001^21;58.801^7
"^DD",58.8,58.801,8,9.1)
TOTAL ADJUSTED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,8,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,8,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,8,21,2,0)
total adjusted.
"^DD",58.8,58.801,8,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,8,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,8,23,2,0)
adjusted.
"^DD",58.8,58.801,9,0)
TOTAL DISPENSED^NJ10,2^^0;6^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,9,3)
Type a Number between 0 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,9,21,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,9,21,1,0)
Each dispensing transaction added to the DRUG ACCOUNTABILITY TRANSACTION
"^DD",58.8,58.801,9,21,2,0)
file (#58.81) will increment this amount.
"^DD",58.8,58.801,9,23,0)
^^2^2^2940915^^
"^DD",58.8,58.801,9,23,1,0)
Incremented by dispensing recorded in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,9,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,9,"DT")
2930923
"^DD",58.8,58.801,10,0)
VALUE DISPENSED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,10,2)=X S Y(58.801,10,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,10,1),U,6)*Y(58.801,10,2)
"^DD",58.8,58.801,10,9)
^
"^DD",58.8,58.801,10,9.01)
58.8001^21;58.801^9
"^DD",58.8,58.801,10,9.1)
TOTAL DISPENSED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,10,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,10,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,10,21,2,0)
total dispensed.
"^DD",58.8,58.801,10,23,0)
^^2^2^2940915^^
"^DD",58.8,58.801,10,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,10,23,2,0)
dispensed.
"^DD",58.8,58.801,11,0)
TOTAL RETURN TO STOCK^NJ10,2^^0;7^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,11,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,11,21,0)
^^2^2^2930803^
"^DD",58.8,58.801,11,21,1,0)
The total number of drugs return to stock during this month.  This total
"^DD",58.8,58.801,11,21,2,0)
includes cancelled orders returned to stock.
"^DD",58.8,58.801,11,23,0)
^^1^1^2930803^
"^DD",58.8,58.801,11,23,1,0)
Monthly total of drugs returned to stock.
"^DD",58.8,58.801,11,"DT")
2930803
"^DD",58.8,58.801,12,0)
TOTAL TURN IN FOR DESTRUCTION^NJ10,2^^0;8^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,12,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,12,21,0)
^^1^1^2930803^
"^DD",58.8,58.801,12,21,1,0)
The total number of drugs turned into the pharmacy for destruction.
"^DD",58.8,58.801,12,23,0)
^^1^1^2930803^
"^DD",58.8,58.801,12,23,1,0)
Monthly total of drugs turned in for destruction.
"^DD",58.8,58.801,12,"DT")
2930803
"^DD",58.8,58.828,0)
ORDER ENTRY BANNER SUB-FIELD^^.01^1
"^DD",58.8,58.828,0,"DT")
2950116
"^DD",58.8,58.828,0,"NM","ORDER ENTRY BANNER")

"^DD",58.8,58.828,0,"UP")
58.8
"^DD",58.8,58.828,.01,0)
ORDER ENTRY BANNER^W^^0;1^Q
"^DD",58.8,58.828,.01,3)
Enter a banner which will be displayed for Nursing Order Entry,                 Pharmacy Order Entry from Nursing, and Infusion Order Entry.
"^DD",58.8,58.828,.01,"DT")
2950116
"^DD",58.8,58.831,0)
IV ROOM SUB-FIELD^^.01^1
"^DD",58.8,58.831,0,"DT")
2951215
"^DD",58.8,58.831,0,"NM","IV ROOM")

"^DD",58.8,58.831,0,"UP")
58.8
"^DD",58.8,58.831,.01,0)
IV ROOM^P59.5'X^PS(59.5,^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.831,.01,.1)
IV Room
"^DD",58.8,58.831,.01,1,0)
^.1
"^DD",58.8,58.831,.01,1,1,0)
58.8^AIV
"^DD",58.8,58.831,.01,1,1,1)
S ^PSD(58.8,"AIV",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.831,.01,1,1,2)
K ^PSD(58.8,"AIV",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.831,.01,1,1,3)
DO NOT DELETE!
"^DD",58.8,58.831,.01,1,1,"%D",0)
^^2^2^2960112^^^^
"^DD",58.8,58.831,.01,1,1,"%D",1,0)
The cross-reference is used to locate the outpatient pharmacy location
"^DD",58.8,58.831,.01,1,1,"%D",2,0)
that is linked to the IV Room. 
"^DD",58.8,58.831,.01,1,1,"DT")
2951215
"^DD",58.8,58.831,.01,3)
Enter the IV Room to which the Outpatient Pharmacy Location dispenses IVs.
"^DD",58.8,58.831,.01,21,0)
^^4^4^2951215^^
"^DD",58.8,58.831,.01,21,1,0)
The IV Room is the Outpatient Clinic's IV room to which the Outpatient
"^DD",58.8,58.831,.01,21,2,0)
Pharmacy dispenses IVs. When IV dispensing data is compiled, it will affect
"^DD",58.8,58.831,.01,21,3,0)
the Drug Accountability outpatient pharmacy location to which the IV
"^DD",58.8,58.831,.01,21,4,0)
Room is linked.
"^DD",58.8,58.831,.01,23,0)
^^1^1^2951215^
"^DD",58.8,58.831,.01,23,1,0)
This field points to the IV ROOM FILE (#59.5).
"^DD",58.8,58.831,.01,"DT")
2951215
"^DD",58.8,58.842,0)
WARD SUB-FIELD^^.01^1
"^DD",58.8,58.842,0,"DT")
2920825
"^DD",58.8,58.842,0,"IX","B",58.842,.01)

"^DD",58.8,58.842,0,"NM","WARD")

"^DD",58.8,58.842,0,"UP")
58.8
"^DD",58.8,58.842,.01,0)
WARD^MP42'X^DIC(42,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.842,.01,1,0)
^.1
"^DD",58.8,58.842,.01,1,1,0)
58.842^B
"^DD",58.8,58.842,.01,1,1,1)
S ^PSD(58.8,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.842,.01,1,1,2)
K ^PSD(58.8,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.8,58.842,.01,1,2,0)
58.8^AB
"^DD",58.8,58.842,.01,1,2,1)
S ^PSD(58.8,"AB",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.842,.01,1,2,2)
K ^PSD(58.8,"AB",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.842,.01,1,2,"%D",0)
^^2^2^2950718^^^^
"^DD",58.8,58.842,.01,1,2,"%D",1,0)
To be used to determine which Drug Accountability location should be
"^DD",58.8,58.842,.01,1,2,"%D",2,0)
affected by Unit Dose and IV dispensing data.
"^DD",58.8,58.842,.01,1,2,"DT")
2920825
"^DD",58.8,58.842,.01,3)
Select those wards for which you wish to gather Unit Dose or IV dispensing data.
"^DD",58.8,58.842,.01,21,0)
^^2^2^2940915^^
"^DD",58.8,58.842,.01,21,1,0)
When Unit Dose and IV dispensing data is compiled, it will affect the
"^DD",58.8,58.842,.01,21,2,0)
Drug Accountability location to which a ward is linked.
"^DD",58.8,58.842,.01,23,0)
^^1^1^2940915^^
"^DD",58.8,58.842,.01,23,1,0)
For UD/IV dispensing to be subtracted from the appropriate DA location.
"^DD",58.8,58.842,.01,"DT")
2950802
"^DD",58.8,58.8445,0)
PRIMARY INVENTORY POINT(S) SUB-FIELD^^2^3
"^DD",58.8,58.8445,0,"DT")
2930301
"^DD",58.8,58.8445,0,"IX","B",58.8445,.01)

"^DD",58.8,58.8445,0,"NM","PRIMARY INVENTORY POINT(S)")

"^DD",58.8,58.8445,0,"UP")
58.8
"^DD",58.8,58.8445,.01,0)
PRIMARY INVENTORY POINT(S)^M*P445'X^PRCP(445,^0;1^S PRCPPRIV=1,DIC("S")="I $P(^(0),U,20)=""D""" D ^DIC K DIC S DIC=DIE,X=+Y K PRCPPRIV K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.8445,.01,1,0)
^.1
"^DD",58.8,58.8445,.01,1,1,0)
58.8445^B
"^DD",58.8,58.8445,.01,1,1,1)
S ^PSD(58.8,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8445,.01,1,1,2)
K ^PSD(58.8,DA(1),4,"B",$E(X,1,30),DA)
"^DD",58.8,58.8445,.01,1,2,0)
58.8^P
"^DD",58.8,58.8445,.01,1,2,1)
S ^PSD(58.8,"P",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.8445,.01,1,2,2)
K ^PSD(58.8,"P",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.8445,.01,1,2,"%D",0)
^^3^3^2940915^^
"^DD",58.8,58.8445,.01,1,2,"%D",1,0)
When receiving occurs in a Primary Inventory Point flagged as a Drug
"^DD",58.8,58.8445,.01,1,2,"%D",2,0)
Accountability special inventory type, this cross-reference will be used
"^DD",58.8,58.8445,.01,1,2,"%D",3,0)
to locate the correct Drug Accountability location to update.
"^DD",58.8,58.8445,.01,1,2,"DT")
2930223
"^DD",58.8,58.8445,.01,3)
Only Primary Inventory Points that are set up with a special inventory type of "D" for Drug Accountability may be selected.
"^DD",58.8,58.8445,.01,12)
Must be Special Inventory Type "D" for Drug Accountability.
"^DD",58.8,58.8445,.01,12.1)
S DIC("S")="I $P(^(0),U,20)=""D"""
"^DD",58.8,58.8445,.01,21,0)
^^3^3^2970204^^^^
"^DD",58.8,58.8445,.01,21,1,0)
To provide a direct link between a Pharmacy Inventory Point and a Pharmacy
"^DD",58.8,58.8445,.01,21,2,0)
location entry in this file.  Receiving that occurs in the Inventory Point
"^DD",58.8,58.8445,.01,21,3,0)
will update on hand quantities in the Pharmacy location.
"^DD",58.8,58.8445,.01,23,0)
^^2^2^2970204^^^^
"^DD",58.8,58.8445,.01,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445)
"^DD",58.8,58.8445,.01,23,2,0)
and the DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8445,.01,"DT")
2930224
"^DD",58.8,58.8445,.01,"LAYGO",1,0)
N PSA S PSA=$O(^PSD(58.8,"P",+X,0)) S:PSA=DA PSA=$O(^(DA)) D:$G(PSA) EN^DDIOL($C(7)_$P($G(^PSD(58.8,+$O(^PSD(58.8,"P",+X,0)),0)),U)_" is already linked to "_$$INVNAME^PRCPUX1(X)) I '$G(PSA)
"^DD",58.8,58.8445,1,0)
RECEIPT FAILURE NOTIFICATION?^S^1:YES;0:NO;^0;2^Q
"^DD",58.8,58.8445,1,3)
Enter "1" or "Y" to transmit a MailMan message to the receiver and the RECEIPT FAILURE mail group each time a failure occurs.
"^DD",58.8,58.8445,1,21,0)
^^6^6^2940923^^^
"^DD",58.8,58.8445,1,21,1,0)
If a Drug Accountability location is linked to a Primary Inventory Point,
"^DD",58.8,58.8445,1,21,2,0)
items received into the Primary Inventory Point will also be updated in
"^DD",58.8,58.8445,1,21,3,0)
the Drug Accountability location.  If items are received that are not 
"^DD",58.8,58.8445,1,21,4,0)
connected to the DRUG file (#50) or not stocked in the Drug Accountability
"^DD",58.8,58.8445,1,21,5,0)
location, and this field is set to "YES", the receiver and the RECEIPT
"^DD",58.8,58.8445,1,21,6,0)
FAILURE mail group will be notified with a list of failed items.
"^DD",58.8,58.8445,1,23,0)
^^1^1^2940923^^^
"^DD",58.8,58.8445,1,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8445,1,"DT")
2930301
"^DD",58.8,58.8445,2,0)
RECEIPT MAIL GROUP^FX^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.8445,2,3)
Answer must be 1-30 characters in length.
"^DD",58.8,58.8445,2,21,0)
^^3^3^2940915^^^
"^DD",58.8,58.8445,2,21,1,0)
Enter the name of the mail group that should receive messages whenever
"^DD",58.8,58.8445,2,21,2,0)
inventory items cannot be received into a Pharmacy location and also
"^DD",58.8,58.8445,2,21,3,0)
this same group will receive DRUG file (#50) price update messages.
"^DD",58.8,58.8445,2,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.8445,2,23,1,0)
When the routine PSAGIP is passed data by IFCAP, items that cannot
"^DD",58.8,58.8445,2,23,2,0)
be updated are listed in messages sent to the receiver and this group.
"^DD",58.8,58.8445,2,"DT")
2930622
"^DD",58.81,58.81,0)
FIELD^^106^96
"^DD",58.81,58.81,0,"DDA")
N
"^DD",58.81,58.81,0,"DT")
2970210
"^DD",58.81,58.81,0,"ID",4)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSDRUG(+$P(^(0),U,5),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(50,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.81,58.81,0,"ID",17)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSD(58.8,+$P(^(0),U,18),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(58.8,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.81,58.81,0,"IX","AC",58.81,102)

"^DD",58.81,58.81,0,"IX","ACT",58.81,3)

"^DD",58.81,58.81,0,"IX","ACT1",58.81,1)

"^DD",58.81,58.81,0,"IX","ACT2",58.81,2)

"^DD",58.81,58.81,0,"IX","ACT3",58.81,4)

"^DD",58.81,58.81,0,"IX","ACT4",58.81,34)

"^DD",58.81,58.81,0,"IX","ACT5",58.81,48)

"^DD",58.81,58.81,0,"IX","ACT6",58.81,55)

"^DD",58.81,58.81,0,"IX","ACT7",58.81,37)

"^DD",58.81,58.81,0,"IX","AD",58.81,10)

"^DD",58.81,58.81,0,"IX","AD1",58.81,17)

"^DD",58.81,58.81,0,"IX","AE",58.81,69)

"^DD",58.81,58.81,0,"IX","AEM",58.81,3)

"^DD",58.81,58.81,0,"IX","AEM1",58.81,85)

"^DD",58.81,58.81,0,"IX","AEM2",58.81,2)

"^DD",58.81,58.81,0,"IX","AEM3",58.81,4)

"^DD",58.81,58.81,0,"IX","AF",58.81,3)

"^DD",58.81,58.81,0,"IX","AF1",58.81,2)

"^DD",58.81,58.81,0,"IX","AF2",58.81,1)

"^DD",58.81,58.81,0,"IX","AG",58.81,11)

"^DD",58.81,58.81,0,"IX","AG1",58.81,17)

"^DD",58.81,58.81,0,"IX","AH",58.81,103)

"^DD",58.81,58.81,0,"IX","AK",58.81,21)

"^DD",58.81,58.81,0,"IX","AK1",58.81,17)

"^DD",58.81,58.81,0,"IX","AL",58.81,104)

"^DD",58.81,58.81,0,"IX","AOP",58.81,60)

"^DD",58.81,58.81,0,"IX","ATRN",58.81,64)

"^DD",58.81,58.81,0,"IX","B",58.81,.01)

"^DD",58.81,58.81,0,"IX","C",58.81,8)

"^DD",58.81,58.81,0,"IX","D",58.81,16)

"^DD",58.81,58.81,0,"IX","E",58.81,7)

"^DD",58.81,58.81,0,"IX","F",58.81,4)

"^DD",58.81,58.81,0,"IX","PV",58.81,71)

"^DD",58.81,58.81,0,"NM","DRUG ACCOUNTABILITY TRANSACTION")

"^DD",58.81,58.81,0,"PT",58.800118,17)

"^DD",58.81,58.81,0,"PT",58.800119,.01)

"^DD",58.81,58.81,0,"PT",58.81,69)

"^DD",58.81,58.81,0,"PT",58.85,7)

"^DD",58.81,58.81,0,"PT",58.86,8)

"^DD",58.81,58.81,0,"PT",58.89,1)

"^DD",58.81,58.81,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.81,58.81,.01,0)
TRANSACTION NUMBER^RNJ9,0X^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.81,58.81,.01,1,0)
^.1
"^DD",58.81,58.81,.01,1,1,0)
58.81^B
"^DD",58.81,58.81,.01,1,1,1)
S ^PSD(58.81,"B",$E(X,1,30),DA)=""
"^DD",58.81,58.81,.01,1,1,2)
K ^PSD(58.81,"B",$E(X,1,30),DA)
"^DD",58.81,58.81,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",58.81,58.81,.01,21,0)
^^1^1^2920624^
"^DD",58.81,58.81,.01,21,1,0)
The internal entry number for this transaction.
"^DD",58.81,58.81,.01,23,0)
^^1^1^2920624^
"^DD",58.81,58.81,.01,23,1,0)
DINUMed.
"^DD",58.81,58.81,.01,"DT")
2920616
"^DD",58.81,58.81,1,0)
TYPE^P58.84'^PSD(58.84,^0;2^Q
"^DD",58.81,58.81,1,1,0)
^.1
"^DD",58.81,58.81,1,1,1,0)
58.81^AF2^MUMPS
"^DD",58.81,58.81,1,1,1,1)
D SAFT^PSDUTL
"^DD",58.81,58.81,1,1,1,2)
D KAFT^PSDUTL
"^DD",58.81,58.81,1,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,1,1,1,"%D",0)
^^3^3^2940929^^^
"^DD",58.81,58.81,1,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug
"^DD",58.81,58.81,1,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is 
"^DD",58.81,58.81,1,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)=""
"^DD",58.81,58.81,1,1,1,"DT")
2920609
"^DD",58.81,58.81,1,1,2,0)
58.81^ACT1^MUMPS
"^DD",58.81,58.81,1,1,2,1)
D SACT1^PSDUTL1
"^DD",58.81,58.81,1,1,2,2)
D KACT1^PSDUTL1
"^DD",58.81,58.81,1,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,1,1,2,"%D",0)
^^4^4^2940929^^^^
"^DD",58.81,58.81,1,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,1,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,1,1,2,"%D",3,0)
  
"^DD",58.81,58.81,1,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,1,1,2,"DT")
2920612
"^DD",58.81,58.81,1,3)
Enter the transaction type.
"^DD",58.81,58.81,1,21,0)
^^1^1^2920912^^
"^DD",58.81,58.81,1,21,1,0)
A pointer to the name of this type transaction.
"^DD",58.81,58.81,1,"DT")
2920612
"^DD",58.81,58.81,2,0)
PHARMACY LOCATION^*P58.8'^PSD(58.8,^0;3^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,2,.1)
DISPENSING SITE
"^DD",58.81,58.81,2,1,0)
^.1
"^DD",58.81,58.81,2,1,1,0)
58.81^AF1^MUMPS
"^DD",58.81,58.81,2,1,1,1)
D SAFL^PSDUTL
"^DD",58.81,58.81,2,1,1,2)
D KAFL^PSDUTL
"^DD",58.81,58.81,2,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,1,"%D",0)
^^3^3^2940915^^^
"^DD",58.81,58.81,2,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug
"^DD",58.81,58.81,2,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is
"^DD",58.81,58.81,2,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)="".
"^DD",58.81,58.81,2,1,1,"DT")
2920602
"^DD",58.81,58.81,2,1,2,0)
58.81^ACT2^MUMPS
"^DD",58.81,58.81,2,1,2,1)
D SACT2^PSDUTL1
"^DD",58.81,58.81,2,1,2,2)
D KACT2^PSDUTL1
"^DD",58.81,58.81,2,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,2,"%D",0)
^^4^4^2950216^^^^
"^DD",58.81,58.81,2,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,2,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,2,1,2,"%D",3,0)
 
"^DD",58.81,58.81,2,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)="".
"^DD",58.81,58.81,2,1,2,"DT")
2920613
"^DD",58.81,58.81,2,1,3,0)
58.81^AEM2^MUMPS
"^DD",58.81,58.81,2,1,3,1)
D SAEM2^PSDUTL5
"^DD",58.81,58.81,2,1,3,2)
D KAEM2^PSDUTL5
"^DD",58.81,58.81,2,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,2,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,2,1,3,"%D",2,0)
 
"^DD",58.81,58.81,2,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,2,1,3,"DT")
2950216
"^DD",58.81,58.81,2,3)
Enter the pharmacy location for this transaction.
"^DD",58.81,58.81,2,12)
For CS, does not allow selection of a "primary" type pharmacy location.
"^DD",58.81,58.81,2,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P"""
"^DD",58.81,58.81,2,21,0)
^^4^4^2921117^^^^
"^DD",58.81,58.81,2,21,1,0)
This field contains a pointer to the Pharmacy location in the DRUG
"^DD",58.81,58.81,2,21,2,0)
ACCOUNTABILITY STATS file (#58.8).  The Controlled Substances module
"^DD",58.81,58.81,2,21,3,0)
will recognize this location as the Narcotic Area of Use (NAOU),
"^DD",58.81,58.81,2,21,4,0)
usually the pharmacy dispensing site (vault).
"^DD",58.81,58.81,2,"DT")
2950216
"^DD",58.81,58.81,3,0)
DATE/TIME^D^^0;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,3,1,0)
^.1
"^DD",58.81,58.81,3,1,1,0)
58.81^AF^MUMPS
"^DD",58.81,58.81,3,1,1,1)
D SAF^PSDUTL
"^DD",58.81,58.81,3,1,1,2)
D KAF^PSDUTL
"^DD",58.81,58.81,3,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,1,"%D",0)
^^3^3^2920912^^^
"^DD",58.81,58.81,3,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug 
"^DD",58.81,58.81,3,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is
"^DD",58.81,58.81,3,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)=""
"^DD",58.81,58.81,3,1,1,"DT")
2920602
"^DD",58.81,58.81,3,1,2,0)
58.81^ACT^MUMPS
"^DD",58.81,58.81,3,1,2,1)
D SACT^PSDUTL1
"^DD",58.81,58.81,3,1,2,2)
D KACT^PSDUTL1
"^DD",58.81,58.81,3,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,2,"%D",0)
^^4^4^2950216^^^
"^DD",58.81,58.81,3,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,3,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,3,1,2,"%D",3,0)
  
"^DD",58.81,58.81,3,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)="".
"^DD",58.81,58.81,3,1,2,"DT")
2920613
"^DD",58.81,58.81,3,1,3,0)
58.81^AEM^MUMPS
"^DD",58.81,58.81,3,1,3,1)
D SAEM^PSDUTL5
"^DD",58.81,58.81,3,1,3,2)
D KAEM^PSDUTL5
"^DD",58.81,58.81,3,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,3,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,3,1,3,"%D",2,0)
 
"^DD",58.81,58.81,3,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,3,1,3,"DT")
2950216
"^DD",58.81,58.81,3,2)
S Y(0)=Y X ^DD("DD")
"^DD",58.81,58.81,3,2.1)
X ^DD("DD")
"^DD",58.81,58.81,3,3)
Enter the date of this transaction.
"^DD",58.81,58.81,3,21,0)
^^4^4^2920912^^^
"^DD",58.81,58.81,3,21,1,0)
The date/time of this transaction.
"^DD",58.81,58.81,3,21,2,0)
  
"^DD",58.81,58.81,3,21,3,0)
For Controlled Substances dispensing transactions, this is the date/time
"^DD",58.81,58.81,3,21,4,0)
the pharmacist verified this transaction.
"^DD",58.81,58.81,3,"DT")
2950216
"^DD",58.81,58.81,4,0)
DRUG^*P50'^PSDRUG(^0;5^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,4,1,0)
^.1
"^DD",58.81,58.81,4,1,1,0)
58.81^F
"^DD",58.81,58.81,4,1,1,1)
S ^PSD(58.81,"F",$E(X,1,30),DA)=""
"^DD",58.81,58.81,4,1,1,2)
K ^PSD(58.81,"F",$E(X,1,30),DA)
"^DD",58.81,58.81,4,1,1,"%D",0)
^^1^1^2920520^
"^DD",58.81,58.81,4,1,1,"%D",1,0)
To locate all receipt history for a given drug.
"^DD",58.81,58.81,4,1,1,"DT")
2920520
"^DD",58.81,58.81,4,1,2,0)
58.81^ACT3^MUMPS
"^DD",58.81,58.81,4,1,2,1)
D SACT3^PSDUTL1
"^DD",58.81,58.81,4,1,2,2)
D KACT3^PSDUTL1
"^DD",58.81,58.81,4,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,4,1,2,"%D",0)
^^4^4^2940929^^^
"^DD",58.81,58.81,4,1,2,"%D",1,0)
This cross-reference is used for compiling data to print the pharmacy
"^DD",58.81,58.81,4,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,4,1,2,"%D",3,0)
  
"^DD",58.81,58.81,4,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,4,1,2,"DT")
2920613
"^DD",58.81,58.81,4,1,3,0)
58.81^AEM3^MUMPS
"^DD",58.81,58.81,4,1,3,1)
D SAEM3^PSDUTL5
"^DD",58.81,58.81,4,1,3,2)
D KAEM3^PSDUTL5
"^DD",58.81,58.81,4,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,4,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,4,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,4,1,3,"%D",2,0)
 
"^DD",58.81,58.81,4,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,4,1,3,"DT")
2950216
"^DD",58.81,58.81,4,3)
Enter the name of the drug being processed in this transaction.
"^DD",58.81,58.81,4,12)
For CS locations, select only ACTIVE drugs marked for CS package use.
"^DD",58.81,58.81,4,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)"
"^DD",58.81,58.81,4,21,0)
^^1^1^2940915^^^
"^DD",58.81,58.81,4,21,1,0)
A pointer to the drug for this transaction.
"^DD",58.81,58.81,4,23,0)
^^6^6^2940915^^^^
"^DD",58.81,58.81,4,23,1,0)
Within the Controlled Substances module, select only ACTIVE drugs
"^DD",58.81,58.81,4,23,2,0)
marked for use in the CS package.  Do not select INACTIVE or
"^DD",58.81,58.81,4,23,3,0)
NON-PHARMACY drugs.  This field should not be edited directly
"^DD",58.81,58.81,4,23,4,0)
using VA FileMan.  The appropriate screen for selecting ACTIVE drugs
"^DD",58.81,58.81,4,23,5,0)
marked for CS use is contained within the package functionality.
"^DD",58.81,58.81,4,23,6,0)
DINUMed pointer to File 50 - DRUG file.
"^DD",58.81,58.81,4,"DT")
2950216
"^DD",58.81,58.81,5,0)
QUANTITY^NJ9,2^^0;6^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,5,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,5,21,0)
^^4^4^2940915^^^^
"^DD",58.81,58.81,5,21,1,0)
The transaction quantity for this drug.
"^DD",58.81,58.81,5,21,2,0)
  
"^DD",58.81,58.81,5,21,3,0)
If the transaction type is BALANCE ADJUSTMENT, this quantity may
"^DD",58.81,58.81,5,21,4,0)
be a negative number.
"^DD",58.81,58.81,5,"DT")
2930923
"^DD",58.81,58.81,6,0)
TRANSACTOR^P200'^VA(200,^0;7^Q
"^DD",58.81,58.81,6,3)
Enter the name of the person initiating this transaction.
"^DD",58.81,58.81,6,21,0)
^^2^2^2920415^
"^DD",58.81,58.81,6,21,1,0)
This field contains a pointer to the name of the person initiating
"^DD",58.81,58.81,6,21,2,0)
this transaction.
"^DD",58.81,58.81,6,"DT")
2920415
"^DD",58.81,58.81,7,0)
CONTROL POINT ACTIVITY^P410'^PRCS(410,^0;8^Q
"^DD",58.81,58.81,7,1,0)
^.1
"^DD",58.81,58.81,7,1,1,0)
58.81^E
"^DD",58.81,58.81,7,1,1,1)
S ^PSD(58.81,"E",$E(X,1,30),DA)=""
"^DD",58.81,58.81,7,1,1,2)
K ^PSD(58.81,"E",$E(X,1,30),DA)
"^DD",58.81,58.81,7,1,1,"%D",0)
^^1^1^2920515^
"^DD",58.81,58.81,7,1,1,"%D",1,0)
To locate all transactions linked to a certain Control Point Activity #.
"^DD",58.81,58.81,7,1,1,"DT")
2920515
"^DD",58.81,58.81,7,3)
Enter the Control Point Activity number.
"^DD",58.81,58.81,7,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,7,21,1,0)
Posted (Warehouse) Issue activity that created this transaction.
"^DD",58.81,58.81,7,21,2,0)
This field is a pointer to the CONTROL POINT ACTIVITY file (#410) and
"^DD",58.81,58.81,7,21,3,0)
will be used mainly for receipt transactions.
"^DD",58.81,58.81,7,23,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,7,23,1,0)
Pointer to the entry in File 410 - CONTROL POINT ACTIVITY file - that
"^DD",58.81,58.81,7,23,2,0)
created this transaction.
"^DD",58.81,58.81,7,"DT")
2920415
"^DD",58.81,58.81,8,0)
PURCHASE ORDER NUMBER^P442'^PRC(442,^0;9^Q
"^DD",58.81,58.81,8,1,0)
^.1
"^DD",58.81,58.81,8,1,1,0)
58.81^C
"^DD",58.81,58.81,8,1,1,1)
S ^PSD(58.81,"C",$E(X,1,30),DA)=""
"^DD",58.81,58.81,8,1,1,2)
K ^PSD(58.81,"C",$E(X,1,30),DA)
"^DD",58.81,58.81,8,1,1,"DT")
2920501
"^DD",58.81,58.81,8,3)
Enter the Purchase Order number for this transaction.
"^DD",58.81,58.81,8,21,0)
^^4^4^2921106^^^^
"^DD",58.81,58.81,8,21,1,0)
The Unposted (Non-Warehouse) Purchase Order from which this transaction
"^DD",58.81,58.81,8,21,2,0)
was created.  This field is a pointer to the PROCUREMENT & ACCOUNTING
"^DD",58.81,58.81,8,21,3,0)
TRANSACTION file (#442) and will be used mainly for receipt
"^DD",58.81,58.81,8,21,4,0)
transactions.
"^DD",58.81,58.81,8,23,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,8,23,1,0)
Pointer to the entry in File 442 - PROCUREMENT & ACCOUNTING TRANSACTION
"^DD",58.81,58.81,8,23,2,0)
file - to which this transaction is linked.
"^DD",58.81,58.81,8,"DT")
2920501
"^DD",58.81,58.81,9,0)
BALANCE FORWARD^NJ9,2^^0;10^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,9,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,9,21,0)
^^3^3^2921106^^^
"^DD",58.81,58.81,9,21,1,0)
The pharmacy dispensing site (vault) inventory balance forward for
"^DD",58.81,58.81,9,21,2,0)
this drug.  This balance is used in listing pharmacy's "Daily
"^DD",58.81,58.81,9,21,3,0)
Activity Log".
"^DD",58.81,58.81,9,"DT")
2930428
"^DD",58.81,58.81,10,0)
ORDER STATUS^P58.82'^PSD(58.82,^0;11^Q
"^DD",58.81,58.81,10,1,0)
^.1
"^DD",58.81,58.81,10,1,1,0)
58.81^AD^MUMPS
"^DD",58.81,58.81,10,1,1,1)
D SAD^PSDUTL
"^DD",58.81,58.81,10,1,1,2)
D KAD^PSDUTL
"^DD",58.81,58.81,10,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,10,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,10,1,1,"%D",1,0)
This cross-reference is used for compiling the "Narcotic Dispensing
"^DD",58.81,58.81,10,1,1,"%D",2,0)
Report".
"^DD",58.81,58.81,10,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AD",ORDER STATUS,NAOU,DA)=""
"^DD",58.81,58.81,10,1,1,"DT")
2920507
"^DD",58.81,58.81,10,3)
Enter the processing status for this order.
"^DD",58.81,58.81,10,21,0)
^^3^3^2921117^^^^
"^DD",58.81,58.81,10,21,1,0)
The processing status for the Controlled Substances order being updated
"^DD",58.81,58.81,10,21,2,0)
in this transaction.  This field is a pointer to the CS ORDER STATUS
"^DD",58.81,58.81,10,21,3,0)
file (#58.82).
"^DD",58.81,58.81,10,23,0)
^^1^1^2940915^^^
"^DD",58.81,58.81,10,23,1,0)
Pointer to File 58.82 - CS ORDER STATS file.
"^DD",58.81,58.81,10,"DT")
2920507
"^DD",58.81,58.81,11,0)
COMPLETION STATUS^P58.83'^PSD(58.83,^0;12^Q
"^DD",58.81,58.81,11,1,0)
^.1
"^DD",58.81,58.81,11,1,1,0)
58.81^AG^MUMPS
"^DD",58.81,58.81,11,1,1,1)
D SAG^PSDUTL2
"^DD",58.81,58.81,11,1,1,2)
D KAG^PSDUTL2
"^DD",58.81,58.81,11,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,11,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,11,1,1,"%D",1,0)
This cross-reference is used for compiling reports displaying Green Sheet
"^DD",58.81,58.81,11,1,1,"%D",2,0)
discrepancies.
"^DD",58.81,58.81,11,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AG",COMPLETION STATUS,NAOU,DA)=""
"^DD",58.81,58.81,11,1,1,"DT")
2920905
"^DD",58.81,58.81,11,3)
Enter the completion status for this Controlled Substances order.
"^DD",58.81,58.81,11,21,0)
^^3^3^2940915^^^^
"^DD",58.81,58.81,11,21,1,0)
The completion status for this Controlled Substances order being updated
"^DD",58.81,58.81,11,21,2,0)
by this transaction.  This field is a pointer to the CS COMPLETION STATUS
"^DD",58.81,58.81,11,21,3,0)
file (#58.83).
"^DD",58.81,58.81,11,23,0)
^^1^1^2940915^^^^
"^DD",58.81,58.81,11,23,1,0)
Pointer to File 58.83 - CS COMPLETION STATUS file.
"^DD",58.81,58.81,11,"DT")
2920905
"^DD",58.81,58.81,12,0)
MANUFACTURER^F^^0;13^K:$L(X)>30!($L(X)<1) X
"^DD",58.81,58.81,12,3)
Enter the current manufacturer (1-30 characters).
"^DD",58.81,58.81,12,21,0)
^^1^1^2920415^
"^DD",58.81,58.81,12,21,1,0)
The current manufacturer of this drug.
"^DD",58.81,58.81,12,"DT")
2920415
"^DD",58.81,58.81,13,0)
LOT #^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",58.81,58.81,13,3)
Enter the current lot # for this drug (1-10 characters).
"^DD",58.81,58.81,13,21,0)
^^1^1^2920415^
"^DD",58.81,58.81,13,21,1,0)
The current lot # of this drug.
"^DD",58.81,58.81,13,"DT")
2920415
"^DD",58.81,58.81,14,0)
EXPIRATION DATE^D^^0;15^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,14,3)
Enter the expiration date for this drug.
"^DD",58.81,58.81,14,21,0)
^^1^1^2920601^^
"^DD",58.81,58.81,14,21,1,0)
The current expiration date for this drug.
"^DD",58.81,58.81,14,"DT")
2920430
"^DD",58.81,58.81,15,0)
REASON^F^^0;16^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,15,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,15,21,0)
^^1^1^2951108^^^
"^DD",58.81,58.81,15,21,1,0)
Reason for creating this transaction.
"^DD",58.81,58.81,15,"DT")
2920415
"^DD",58.81,58.81,16,0)
PHARMACY DISPENSING #^F^^0;17^K:$L(X)>9!($L(X)<1) X
"^DD",58.81,58.81,16,1,0)
^.1
"^DD",58.81,58.81,16,1,1,0)
58.81^D
"^DD",58.81,58.81,16,1,1,1)
S ^PSD(58.81,"D",$E(X,1,30),DA)=""
"^DD",58.81,58.81,16,1,1,2)
K ^PSD(58.81,"D",$E(X,1,30),DA)
"^DD",58.81,58.81,16,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,16,1,1,"DT")
2920501
"^DD",58.81,58.81,16,3)
Answer must be 1-9 characters in length.
"^DD",58.81,58.81,16,21,0)
^^3^3^2920912^^
"^DD",58.81,58.81,16,21,1,0)
The pharmacy control number to identify and track this Controlled
"^DD",58.81,58.81,16,21,2,0)
Substances transaction.  This number may be manually entered in
"^DD",58.81,58.81,16,21,3,0)
pharmacy or auto-generated by the CS software.
"^DD",58.81,58.81,16,"DT")
2920812
"^DD",58.81,58.81,17,0)
NAOU^*P58.8'^PSD(58.8,^0;18^S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,17,1,0)
^.1
"^DD",58.81,58.81,17,1,1,0)
58.81^AD1^MUMPS
"^DD",58.81,58.81,17,1,1,1)
D SAD^PSDUTL1
"^DD",58.81,58.81,17,1,1,2)
D KAD^PSDUTL1
"^DD",58.81,58.81,17,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,1,"%D",0)
^^2^2^2940929^^^^
"^DD",58.81,58.81,17,1,1,"%D",1,0)
This cross-reference is used in compiling the "Narcotic Dispensing Report".
"^DD",58.81,58.81,17,1,1,"%D",2,0)
The cross-reference is ^PSD(58.81,"AD",ORDER STATUS,NAOU,DA)=""
"^DD",58.81,58.81,17,1,1,"DT")
2920805
"^DD",58.81,58.81,17,1,2,0)
58.81^AG1^MUMPS
"^DD",58.81,58.81,17,1,2,1)
D SAG1^PSDUTL2
"^DD",58.81,58.81,17,1,2,2)
D KAG1^PSDUTL2
"^DD",58.81,58.81,17,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,2,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,17,1,2,"%D",1,0)
This cross-reference is used in compiling reports displaying Green Sheet
"^DD",58.81,58.81,17,1,2,"%D",2,0)
discrepancies.
"^DD",58.81,58.81,17,1,2,"%D",3,0)
The cross-reference is ^PSD(58.81,"AG",COMPLETION STATUS,NAOU,DA)=""
"^DD",58.81,58.81,17,1,2,"DT")
2920905
"^DD",58.81,58.81,17,1,3,0)
58.81^AK1^MUMPS
"^DD",58.81,58.81,17,1,3,1)
D SAK1^PSDUTL4
"^DD",58.81,58.81,17,1,3,2)
D KAK1^PSDUTL4
"^DD",58.81,58.81,17,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,3,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,17,1,3,"%D",1,0)
This cross-reference is used in compiling the "Inspector's Log for
"^DD",58.81,58.81,17,1,3,"%D",2,0)
Controlled Substances" generated by date received on the NAOU.
"^DD",58.81,58.81,17,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AK",D/T RECD,NAOU,DA)=""
"^DD",58.81,58.81,17,1,3,"DT")
2940523
"^DD",58.81,58.81,17,3)
Enter the NAOU ordering this drug.
"^DD",58.81,58.81,17,12)
Allows selection of a Satellite vault or Narcotic location.
"^DD",58.81,58.81,17,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.81,58.81,17,21,0)
^^1^1^2920912^^^
"^DD",58.81,58.81,17,21,1,0)
The NAOU ordering this Controlled Substances drug.
"^DD",58.81,58.81,17,"DT")
2940523
"^DD",58.81,58.81,18,0)
DISPENSED BY^*P200'^VA(200,^1;1^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,18,3)
Enter the pharmacist dispensing this drug.
"^DD",58.81,58.81,18,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,18,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,18,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,18,21,1,0)
A pointer to the name of the pharmacist dispensing this drug.
"^DD",58.81,58.81,18,"DT")
2920415
"^DD",58.81,58.81,19,0)
PROCESSED DATE/TIME^D^^1;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,19,1,0)
^.1^^0
"^DD",58.81,58.81,19,3)
Enter the date/time pharmacy processed this drug.
"^DD",58.81,58.81,19,21,0)
^^3^3^2920912^^
"^DD",58.81,58.81,19,21,1,0)
The date/time this transaction was processed.
"^DD",58.81,58.81,19,21,2,0)
For Controlled Substances dispensing transactions, this is the date/time
"^DD",58.81,58.81,19,21,3,0)
a pharmacy technician processed this transaction.
"^DD",58.81,58.81,19,"DT")
2930701
"^DD",58.81,58.81,20,0)
ORDER RECEIVED BY^*P200'^VA(200,^1;3^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,20,3)
Enter the person receiving this drug.
"^DD",58.81,58.81,20,12)
Access granted to persons holding the appropriate security key.
"^DD",58.81,58.81,20,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,20,21,0)
^^2^2^2920912^^^
"^DD",58.81,58.81,20,21,1,0)
A pointer to the name of the person receiving this Controlled
"^DD",58.81,58.81,20,21,2,0)
Substances drug into the ordering Narcotic Area of Use.
"^DD",58.81,58.81,20,"DT")
2930527
"^DD",58.81,58.81,21,0)
RECEIPT DATE/TIME^D^^1;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,21,1,0)
^.1
"^DD",58.81,58.81,21,1,1,0)
58.81^AK^MUMPS
"^DD",58.81,58.81,21,1,1,1)
D SAK^PSDUTL4
"^DD",58.81,58.81,21,1,1,2)
D KAK^PSDUTL4
"^DD",58.81,58.81,21,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,21,1,1,"%D",0)
^^3^3^2941003^^^^
"^DD",58.81,58.81,21,1,1,"%D",1,0)
This cross-reference is used in compiling the "Inspector's Log for
"^DD",58.81,58.81,21,1,1,"%D",2,0)
Controlled Substances" generated by date received on the NAOU.
"^DD",58.81,58.81,21,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AK",D/T RECD,NAOU,DA)=""
"^DD",58.81,58.81,21,1,1,"DT")
2940523
"^DD",58.81,58.81,21,3)
Enter the date/time this drug was received from pharmacy.
"^DD",58.81,58.81,21,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,21,21,1,0)
The date/time this drug was received into the ordering Narcotic
"^DD",58.81,58.81,21,21,2,0)
Area of Use.
"^DD",58.81,58.81,21,"DT")
2940523
"^DD",58.81,58.81,22,0)
COMPLETION DATE/TIME^D^^0;19^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,22,3)
Enter the date/time this order was completed.
"^DD",58.81,58.81,22,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,22,21,1,0)
The date/time this Controlled Substances Green Sheet (VA FORM 10-2638)
"^DD",58.81,58.81,22,21,2,0)
was reviewed as complete by pharmacy.
"^DD",58.81,58.81,22,"DT")
2920415
"^DD",58.81,58.81,23,0)
FILLED BY^*P200'^VA(200,^1;5^S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,23,3)
Enter the name of the pharmacy employee processing this transaction.
"^DD",58.81,58.81,23,12)
Access granted to technicians holding the appropriate security key.
"^DD",58.81,58.81,23,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,23,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,23,21,1,0)
A pointer to the name of the pharmacy technician processing this
"^DD",58.81,58.81,23,21,2,0)
Controlled Substances transaction.
"^DD",58.81,58.81,23,"DT")
2920530
"^DD",58.81,58.81,24,0)
REQUEST DATE/TIME^D^^1;6^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,24,3)
Enter the request date for this order.
"^DD",58.81,58.81,24,21,0)
^^1^1^2920912^^
"^DD",58.81,58.81,24,21,1,0)
The date/time the Controlled Substances order request was generated.
"^DD",58.81,58.81,24,"DT")
2920501
"^DD",58.81,58.81,25,0)
ORDERED BY^*P200'^VA(200,^1;7^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,25,3)
Enter the person's name requesting this order.
"^DD",58.81,58.81,25,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.81,58.81,25,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,25,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,25,21,1,0)
A pointer to the name of the person requesting this Controlled
"^DD",58.81,58.81,25,21,2,0)
Substances drug.
"^DD",58.81,58.81,25,"DT")
2920628
"^DD",58.81,58.81,25.5,0)
ORDERED BY PHARMACY^*P200'^VA(200,^1.5;1^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,25.5,3)
Enter the person's name requesting this order for nursing.
"^DD",58.81,58.81,25.5,12)
Access granted to pharmacy personnel holding the appropriate security key.
"^DD",58.81,58.81,25.5,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,25.5,21,0)
^^2^2^2931010^
"^DD",58.81,58.81,25.5,21,1,0)
A pointer to the name of the pharmacy employee requesting the Controlled
"^DD",58.81,58.81,25.5,21,2,0)
Substances order for nursing.
"^DD",58.81,58.81,25.5,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,25.5,23,1,0)
A screened pointer to NEW PERSON file (#200).
"^DD",58.81,58.81,25.5,"DT")
2931010
"^DD",58.81,58.81,26,0)
COMMENTS^58.8126^^2;0
"^DD",58.81,58.81,26,21,0)
^^1^1^2950301^^^^
"^DD",58.81,58.81,26,21,1,0)
Comments concerning this transaction.
"^DD",58.81,58.81,27,0)
QUANTITY RECEIVED^NJ6,0^^1;8^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,27,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,27,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,27,21,1,0)
The actual quantity of the drug received by the ordering NAOU.
"^DD",58.81,58.81,27,"DT")
2920517
"^DD",58.81,58.81,28,0)
DISCREPANCY UNRESOLVED^S^1:YES;0:NO;^1;9^Q
"^DD",58.81,58.81,28,1,0)
^.1^^0
"^DD",58.81,58.81,28,3)
Enter "YES" if a receiving/dispensing discrepancy exists.
"^DD",58.81,58.81,28,21,0)
^^3^3^2921117^^
"^DD",58.81,58.81,28,21,1,0)
If the actual quantity of the drug received is different from the
"^DD",58.81,58.81,28,21,2,0)
actual quantity pharmacy dispensed, then this field is set to "1"
"^DD",58.81,58.81,28,21,3,0)
or "YES".
"^DD",58.81,58.81,28,"DT")
2920629
"^DD",58.81,58.81,29,0)
COMPLETED BY NURSE^*P200'^VA(200,^1;10^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,29,3)
Enter the name of the nurse returning this Green Sheet.
"^DD",58.81,58.81,29,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,29,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,29,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,29,21,1,0)
A pointer to the name of the nurse returning the Green Sheet
"^DD",58.81,58.81,29,21,2,0)
(VA FORM 10-2638) to pharmacy.
"^DD",58.81,58.81,29,"DT")
2930527
"^DD",58.81,58.81,29.5,0)
COMP BY NURSE DATE/TIME^D^^1.5;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.5,3)
Enter the date/time this Green Sheet was completed by nursing.
"^DD",58.81,58.81,29.5,21,0)
^^2^2^2931010^^
"^DD",58.81,58.81,29.5,21,1,0)
The date/time this Green Sheet was completed by nursing and ready for
"^DD",58.81,58.81,29.5,21,2,0)
pharmacy pickup.
"^DD",58.81,58.81,29.5,"DT")
2931010
"^DD",58.81,58.81,29.6,0)
D/T PLACED ON INSP HOLD^D^^1.5;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.6,3)
Enter the date/time this Green Sheet was placed on hold.
"^DD",58.81,58.81,29.6,21,0)
^^2^2^2931110^
"^DD",58.81,58.81,29.6,21,1,0)
The date/time this Green Sheet was placed on hold for review by the
"^DD",58.81,58.81,29.6,21,2,0)
Controlled Substances Inspector.
"^DD",58.81,58.81,29.6,"DT")
2931110
"^DD",58.81,58.81,29.7,0)
D/T INSP HOLD REMOVED^D^^1.5;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.7,3)
Enter the date/time this Green Sheet was removed from hold.
"^DD",58.81,58.81,29.7,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,29.7,21,1,0)
The date/time this Green Sheet was removed from hold by the Controlled
"^DD",58.81,58.81,29.7,21,2,0)
Substances inspector.
"^DD",58.81,58.81,29.7,"DT")
2931110
"^DD",58.81,58.81,29.8,0)
HOLD REMARKS^F^^1.6;1^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,29.8,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,29.8,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,29.8,21,1,0)
This field contains information concerning the Green Sheet being held
"^DD",58.81,58.81,29.8,21,2,0)
for CS inspector's review.
"^DD",58.81,58.81,29.8,"DT")
2940105
"^DD",58.81,58.81,30,0)
RECEIVED BY TECH^*P200'^VA(200,^1;11^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,30,3)
Enter the name of the tech receiving this order.
"^DD",58.81,58.81,30,12)
Access granted to technicians with appropriate security key.
"^DD",58.81,58.81,30,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,30,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,30,21,1,0)
A pointer to the name of the pharmacy technician receiving this
"^DD",58.81,58.81,30,21,2,0)
Controlled Substances drug into the NAOU.
"^DD",58.81,58.81,30,"DT")
2920601
"^DD",58.81,58.81,31,0)
PICK UP DATE/TIME^D^^1;12^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,31,3)
Enter the date/time pharmacy picked up the Green Sheet.
"^DD",58.81,58.81,31,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,31,21,1,0)
The date/time pharmacy picked up the Green Sheet (VA FORM 10-2638)
"^DD",58.81,58.81,31,21,2,0)
from the NAOU.
"^DD",58.81,58.81,31,"DT")
2920531
"^DD",58.81,58.81,32,0)
PICKED UP BY^*P200'^VA(200,^1;13^S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,32,3)
Enter the name of the technician picking up the Green Sheet.
"^DD",58.81,58.81,32,12)
Access granted to technicians picking up Green Sheets.
"^DD",58.81,58.81,32,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,32,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,32,21,1,0)
A pointer to the name of the pharmacy technician picking up the
"^DD",58.81,58.81,32,21,2,0)
Green Sheet (VA FORM 10-2638) from the NAOU.
"^DD",58.81,58.81,32,"DT")
2920531
"^DD",58.81,58.81,33,0)
COMPLETED BY PHARMACIST^*P200'^VA(200,^1;14^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,33,3)
Enter the name of the pharmacist or tech completing this Green Sheet.
"^DD",58.81,58.81,33,12)
Access granted to the pharmacists or techs holding the appropriate security key.
"^DD",58.81,58.81,33,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,33,21,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,33,21,1,0)
A pointer to the name of the pharmacist or pharmacy technician completing
"^DD",58.81,58.81,33,21,2,0)
the Green Sheet (VA FORM 10-2638).
"^DD",58.81,58.81,33,"DT")
2930413
"^DD",58.81,58.81,34,0)
DATE/TIME RET TO STOCK^D^^3;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,34,1,0)
^.1
"^DD",58.81,58.81,34,1,1,0)
58.81^ACT4^MUMPS
"^DD",58.81,58.81,34,1,1,1)
D SACT4^PSDUTL1
"^DD",58.81,58.81,34,1,1,2)
D KACT4^PSDUTL1
"^DD",58.81,58.81,34,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,34,1,1,"%D",0)
^^4^4^2941003^^^
"^DD",58.81,58.81,34,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,34,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,34,1,1,"%D",3,0)
  
"^DD",58.81,58.81,34,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",RET TO STK D/T,LOC,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,34,1,1,"DT")
2920613
"^DD",58.81,58.81,34,3)
Enter date/time returned to stock.
"^DD",58.81,58.81,34,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,34,21,1,0)
The date/time this drug is being returned to stock.
"^DD",58.81,58.81,34,"DT")
2930701
"^DD",58.81,58.81,35,0)
QUANTITY RET TO STOCK^NJ6,0^^3;2^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,35,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,35,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,35,21,1,0)
The actual quantity of this drug being returned to stock.
"^DD",58.81,58.81,35,"DT")
2920603
"^DD",58.81,58.81,36,0)
REASON RETURNED TO STOCK^F^^3;3^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,36,3)
Enter reason this drug was returned to stock.
"^DD",58.81,58.81,36,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,36,21,1,0)
The reason this drug is being returned to stock.
"^DD",58.81,58.81,36,"DT")
2920604
"^DD",58.81,58.81,37,0)
DATE/TIME TURN IN DESTROY^D^^3;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,37,1,0)
^.1
"^DD",58.81,58.81,37,1,1,0)
58.81^ACT7^MUMPS
"^DD",58.81,58.81,37,1,1,1)
D SACT7^PSDUTL3
"^DD",58.81,58.81,37,1,1,2)
D KACT7^PSDUTL3
"^DD",58.81,58.81,37,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,37,1,1,"%D",0)
^^3^3^2941003^^^^
"^DD",58.81,58.81,37,1,1,"%D",1,0)
This cross-reference is used in compiling the cost reports.
"^DD",58.81,58.81,37,1,1,"%D",2,0)
 
"^DD",58.81,58.81,37,1,1,"%D",3,0)
The cross-reference reads ^PSD(58.81,"ACT",D/T TURN IN DEST,LOC,DRUG,DA)=""
"^DD",58.81,58.81,37,1,1,"DT")
2940118
"^DD",58.81,58.81,37,3)
Enter the date/time this drug was turned in for destruction.
"^DD",58.81,58.81,37,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,37,21,1,0)
The date/time this drug is being turned in for destruction.
"^DD",58.81,58.81,37,"DT")
2930701
"^DD",58.81,58.81,38,0)
QUANTITY TURN IN FOR DESTROY^NJ9,2^^3;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,38,3)
Type a Number between 0 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,38,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,38,21,1,0)
The actual quantity of this drug being turned in for destruction.
"^DD",58.81,58.81,38,"DT")
2940518
"^DD",58.81,58.81,39,0)
REASON TURN IN FOR DESTROY^F^^3;6^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,39,3)
Enter reason this drug was turned in for destruction.
"^DD",58.81,58.81,39,21,0)
^^1^1^2950927^^
"^DD",58.81,58.81,39,21,1,0)
The reason this drug is being turned in for destruction.
"^DD",58.81,58.81,39,"DT")
2920604
"^DD",58.81,58.81,40,0)
REQUEST #^NJ8,0^^0;20^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,40,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.81,58.81,40,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,40,21,1,0)
The order request number from the ordering NAOU.
"^DD",58.81,58.81,40,"DT")
2920606
"^DD",58.81,58.81,41,0)
BALANCE FWD RET/STK^NJ9,2^^3;7^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,41,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,41,21,0)
^^2^2^2921117^^
"^DD",58.81,58.81,41,21,1,0)
The inventory balance forward for this drug being returned to stock.
"^DD",58.81,58.81,41,21,2,0)
This balance is used in listing pharmacy's "Daily Activity Log".
"^DD",58.81,58.81,41,"DT")
2930428
"^DD",58.81,58.81,47,0)
DEST HOLDING #^P58.86'^PSD(58.86,^3;8^Q
"^DD",58.81,58.81,47,3)
Enter the destruction holding file # for this transaction.
"^DD",58.81,58.81,47,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,47,21,1,0)
A pointer to the destruction number for this drug being held for
"^DD",58.81,58.81,47,21,2,0)
destruction.
"^DD",58.81,58.81,47,"DT")
2920607
"^DD",58.81,58.81,48,0)
EDIT VERIFIED ORDER DATE/TIME^D^^4;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,48,1,0)
^.1
"^DD",58.81,58.81,48,1,1,0)
58.81^ACT5^MUMPS
"^DD",58.81,58.81,48,1,1,1)
D SACT5^PSDUTL1
"^DD",58.81,58.81,48,1,1,2)
D KACT5^PSDUTL1
"^DD",58.81,58.81,48,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,48,1,1,"%D",0)
^^4^4^2941003^^^^
"^DD",58.81,58.81,48,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,48,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,48,1,1,"%D",3,0)
  
"^DD",58.81,58.81,48,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",EDIT D/T,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,48,1,1,"DT")
2920613
"^DD",58.81,58.81,48,3)
Enter date/time this order was verified.
"^DD",58.81,58.81,48,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,48,21,1,0)
The date/time this verified order is being edited.
"^DD",58.81,58.81,48,"DT")
2930701
"^DD",58.81,58.81,49,0)
PHARMACIST EDITING^*P200'^VA(200,^4;2^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,49,3)
Enter the name of the pharmacist editing this verified order.
"^DD",58.81,58.81,49,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,49,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,49,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,49,21,1,0)
A pointer to name of the pharmacist editing this verified order.
"^DD",58.81,58.81,49,"DT")
2920610
"^DD",58.81,58.81,50,0)
NEW QUANTITY^NJ6,0^^4;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,50,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,50,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,50,21,1,0)
The actual quantity of this drug being dispensed, if quantity is being
"^DD",58.81,58.81,50,21,2,0)
edited.
"^DD",58.81,58.81,50,"DT")
2920610
"^DD",58.81,58.81,51,0)
ADJUSTED BY QUANTITY^NJ6,0^^4;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,51,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,51,21,0)
^^3^3^2920625^
"^DD",58.81,58.81,51,21,1,0)
The difference in the original quantity dispensed and the edited
"^DD",58.81,58.81,51,21,2,0)
quantity dispensed.  The inventory balance will be adjusted by this
"^DD",58.81,58.81,51,21,3,0)
amount.  This quantity may be a negative number.
"^DD",58.81,58.81,51,"DT")
2920610
"^DD",58.81,58.81,52,0)
EDIT MFG/LOT/EXP.DATE^S^1:Y;0:N;^4;5^Q
"^DD",58.81,58.81,52,3)
Answer "YES" if manufacturer, lot #, or exp. date is edited.
"^DD",58.81,58.81,52,21,0)
^^2^2^2940923^^^^
"^DD",58.81,58.81,52,21,1,0)
This field is set to "1" or "YES" if  the manufacturer, lot #,
"^DD",58.81,58.81,52,21,2,0)
or expiration date is being edited on this verified order.
"^DD",58.81,58.81,52,"DT")
2920610
"^DD",58.81,58.81,53,0)
REASON EDITED^F^^4;6^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,53,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,53,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,53,21,1,0)
The reason this verified order is being edited.
"^DD",58.81,58.81,53,"DT")
2920610
"^DD",58.81,58.81,54,0)
BAL FWD EDIT VERIFIED ORDER^NJ6,0^^4;7^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,54,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,54,21,0)
^^3^3^2921106^^^
"^DD",58.81,58.81,54,21,1,0)
The inventory balance forward for this drug at the time this verified
"^DD",58.81,58.81,54,21,2,0)
order is being edited.  This balance is used in listing pharmacy's
"^DD",58.81,58.81,54,21,3,0)
"Daily Activity Log".
"^DD",58.81,58.81,54,"DT")
2920610
"^DD",58.81,58.81,55,0)
CANCEL VERIFIED ORD DATE/TIME^D^^5;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,55,1,0)
^.1
"^DD",58.81,58.81,55,1,1,0)
58.81^ACT6^MUMPS
"^DD",58.81,58.81,55,1,1,1)
D SACT6^PSDUTL1
"^DD",58.81,58.81,55,1,1,2)
D KACT6^PSDUTL1
"^DD",58.81,58.81,55,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,55,1,1,"%D",0)
^^4^4^2941003^^^
"^DD",58.81,58.81,55,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,55,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,55,1,1,"%D",3,0)
  
"^DD",58.81,58.81,55,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",CANCEL D/T,LOC,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,55,1,1,"DT")
2920613
"^DD",58.81,58.81,55,3)
Enter the date/time this verified order was cancelled.
"^DD",58.81,58.81,55,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,55,21,1,0)
The date/time this verified order is being cancelled.
"^DD",58.81,58.81,55,"DT")
2930701
"^DD",58.81,58.81,56,0)
PHARMACIST CANCELLING^*P200'^VA(200,^5;2^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,56,3)
Enter the name of the pharmacist holding the appropriate security key.
"^DD",58.81,58.81,56,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,56,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,56,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,56,21,1,0)
A pointer to the name of the pharmacist cancelling this verified
"^DD",58.81,58.81,56,21,2,0)
order.
"^DD",58.81,58.81,56,"DT")
2920610
"^DD",58.81,58.81,57,0)
ADJUSTMENT QUANTITY^NJ6,0^^5;3^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,57,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,57,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,57,21,1,0)
The actual quantity of the drug for this cancelled order.  The drug
"^DD",58.81,58.81,57,21,2,0)
inventory balance will be increased by this adjustment quantity.
"^DD",58.81,58.81,57,"DT")
2920610
"^DD",58.81,58.81,58,0)
REASON CANCELLED^F^^5;4^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,58,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,58,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,58,21,1,0)
The reason this verified order is being cancelled.
"^DD",58.81,58.81,58,"DT")
2920610
"^DD",58.81,58.81,59,0)
BAL FWD CANCEL VERIFIED ORD^NJ6,0^^5;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,59,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,59,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,59,21,1,0)
The inventory balance forward for this drug at the time this
"^DD",58.81,58.81,59,21,2,0)
verified order is being cancelled.  This balance is used in listing
"^DD",58.81,58.81,59,21,3,0)
pharmacy's "Daily Activity Log".
"^DD",58.81,58.81,59,"DT")
2920610
"^DD",58.81,58.81,60,0)
RX #^P52'^PSRX(^6;1^Q
"^DD",58.81,58.81,60,1,0)
^.1
"^DD",58.81,58.81,60,1,1,0)
58.81^AOP
"^DD",58.81,58.81,60,1,1,1)
S ^PSD(58.81,"AOP",$E(X,1,30),DA)=""
"^DD",58.81,58.81,60,1,1,2)
K ^PSD(58.81,"AOP",$E(X,1,30),DA)
"^DD",58.81,58.81,60,1,1,3)
DO NOT DELETE.
"^DD",58.81,58.81,60,1,1,"DT")
2920824
"^DD",58.81,58.81,60,3)
Enter prescription number for this CS transaction.
"^DD",58.81,58.81,60,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,60,21,1,0)
A pointer to the outpatient prescription number.
"^DD",58.81,58.81,60,"DT")
2920824
"^DD",58.81,58.81,61,0)
REFILL #^NJ3,0^^6;2^K:+X'=X!(X>100)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,61,3)
Type a Number between 1 and 100, 0 Decimal Digits
"^DD",58.81,58.81,61,21,0)
^^2^2^2920625^^
"^DD",58.81,58.81,61,21,1,0)
If this prescription is a refill, this field will contain the refill
"^DD",58.81,58.81,61,21,2,0)
number.
"^DD",58.81,58.81,61,"DT")
2920616
"^DD",58.81,58.81,62,0)
PRESCRIPTION DATE^D^^6;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,62,3)
Enter the date/time this prescription was filled.
"^DD",58.81,58.81,62,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,62,21,1,0)
The fill date for this prescription.
"^DD",58.81,58.81,62,"DT")
2920616
"^DD",58.81,58.81,63,0)
PARTIAL #^NJ3,0^^6;4^K:+X'=X!(X>100)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,63,3)
Type a Number between 1 and 100, 0 Decimal Digits
"^DD",58.81,58.81,63,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,63,21,1,0)
If this prescription is a partial, this field contains the partial
"^DD",58.81,58.81,63,21,2,0)
number.
"^DD",58.81,58.81,63,"DT")
2920616
"^DD",58.81,58.81,63.5,0)
OUTPATIENT RX #^F^^6;5^K:$L(X)>11!($L(X)<1) X
"^DD",58.81,58.81,63.5,3)
Answer must be 1-11 characters in length.
"^DD",58.81,58.81,63.5,21,0)
^^1^1^2930507^
"^DD",58.81,58.81,63.5,21,1,0)
This is the external form of the Outpatient prescription number.
"^DD",58.81,58.81,63.5,"DT")
2930507
"^DD",58.81,58.81,63.6,0)
RELEASING PHARMACIST^P200'^VA(200,^6;6^Q
"^DD",58.81,58.81,63.6,3)
Enter the pharmacist processing the Outpatient release.
"^DD",58.81,58.81,63.6,21,0)
^^3^3^2940915^^
"^DD",58.81,58.81,63.6,21,1,0)
This field is used to store the pharmacist responsible for the release
"^DD",58.81,58.81,63.6,21,2,0)
of an Outpatient prescription in case it is a different person than the
"^DD",58.81,58.81,63.6,21,3,0)
transactor.
"^DD",58.81,58.81,63.6,23,0)
^^2^2^2940915^^
"^DD",58.81,58.81,63.6,23,1,0)
This field records the releasing pharmacist in case this is a different
"^DD",58.81,58.81,63.6,23,2,0)
person than the transactor.
"^DD",58.81,58.81,63.6,"DT")
2940727
"^DD",58.81,58.81,64,0)
TRANSFER FROM NAOU DATE/TIME^D^^7;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,64,1,0)
^.1
"^DD",58.81,58.81,64,1,1,0)
58.81^ATRN
"^DD",58.81,58.81,64,1,1,1)
S ^PSD(58.81,"ATRN",$E(X,1,30),DA)=""
"^DD",58.81,58.81,64,1,1,2)
K ^PSD(58.81,"ATRN",$E(X,1,30),DA)
"^DD",58.81,58.81,64,1,1,3)
DO NOT DELETE.
"^DD",58.81,58.81,64,1,1,"DT")
2920804
"^DD",58.81,58.81,64,3)
Enter the date/time the drug was transferred from this NAOU.
"^DD",58.81,58.81,64,21,0)
^^2^2^2920912^^^
"^DD",58.81,58.81,64,21,1,0)
The date/time the Controlled Substances drug was transferred from this
"^DD",58.81,58.81,64,21,2,0)
NAOU to another NAOU.
"^DD",58.81,58.81,64,"DT")
2920804
"^DD",58.81,58.81,65,0)
TRANSFER FROM NAOU NURSE^*P200'^VA(200,^7;2^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,65,3)
Enter the name of the nurse transferring the drug from this NAOU.
"^DD",58.81,58.81,65,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,65,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,65,21,0)
^^2^2^2931014^^^
"^DD",58.81,58.81,65,21,1,0)
A pointer to the name of the nurse or pharmacist transferring the
"^DD",58.81,58.81,65,21,2,0)
Controlled Substances drug from this NAOU to another NAOU.
"^DD",58.81,58.81,65,"DT")
2931014
"^DD",58.81,58.81,66,0)
TRANSFER TO NAOU^*P58.8'^PSD(58.8,^7;3^S DIC("S")="I $P(^(0),""^"",2)=""N""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,66,3)
Enter the NAOU receiving the transferred drug.
"^DD",58.81,58.81,66,12)
Allows selection of a Satellite vault or Narcotic location.
"^DD",58.81,58.81,66,12.1)
S DIC("S")="I $P(^(0),""^"",2)=""N"""
"^DD",58.81,58.81,66,21,0)
^^1^1^2920912^^^
"^DD",58.81,58.81,66,21,1,0)
The NAOU receiving this Controlled Substances drug from another NAOU.
"^DD",58.81,58.81,66,"DT")
2930527
"^DD",58.81,58.81,67,0)
TRANSFER TO NAOU DATE/TIME^D^^7;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,67,3)
Enter the date/time the drug was transferred to this NAOU.
"^DD",58.81,58.81,67,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,67,21,1,0)
The date/time the Controlled Substances drug was transferred to this
"^DD",58.81,58.81,67,21,2,0)
NAOU from another NAOU.
"^DD",58.81,58.81,67,"DT")
2920804
"^DD",58.81,58.81,68,0)
TRANSFER TO NAOU NURSE^*P200'^VA(200,^7;5^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,68,3)
Enter the name of the nurse receiving this transferred drug.
"^DD",58.81,58.81,68,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,68,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,68,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,68,21,1,0)
A pointer to the name of the nurse receiving this transferred Controlled
"^DD",58.81,58.81,68,21,2,0)
Substances drug from another NAOU.
"^DD",58.81,58.81,68,"DT")
2930527
"^DD",58.81,58.81,69,0)
PREVIOUS TRANSACTION #^*P58.81'^PSD(58.81,^7;6^S DIC("S")="I $P(^(0),""^"",11)=10" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,69,1,0)
^.1
"^DD",58.81,58.81,69,1,1,0)
58.81^AE
"^DD",58.81,58.81,69,1,1,1)
S ^PSD(58.81,"AE",$E(X,1,30),DA)=""
"^DD",58.81,58.81,69,1,1,2)
K ^PSD(58.81,"AE",$E(X,1,30),DA)
"^DD",58.81,58.81,69,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,69,1,1,"DT")
2920804
"^DD",58.81,58.81,69,3)
Enter the previous transferred from NAOU transaction number.
"^DD",58.81,58.81,69,12)
Allows selection of transactions transferred from an NAOU.
"^DD",58.81,58.81,69,12.1)
S DIC("S")="I $P(^(0),""^"",11)=10"
"^DD",58.81,58.81,69,21,0)
^^2^2^2920915^^
"^DD",58.81,58.81,69,21,1,0)
The transaction number of the transferred from NAOU Controlled Substances
"^DD",58.81,58.81,69,21,2,0)
drug.  This is the previous transaction number for this drug.
"^DD",58.81,58.81,69,"DT")
2920804
"^DD",58.81,58.81,70,0)
QUANTITY TRANSFERRED^NJ6,0^^7;7^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,70,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,70,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,70,21,1,0)
The quantity of this Controlled Substances drug being transferred
"^DD",58.81,58.81,70,21,2,0)
from an NAOU to another NAOU.
"^DD",58.81,58.81,70,"DT")
2920805
"^DD",58.81,58.81,71,0)
PRIME VENDOR INVOICE^F^^8;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",58.81,58.81,71,1,0)
^.1
"^DD",58.81,58.81,71,1,1,0)
58.81^PV
"^DD",58.81,58.81,71,1,1,1)
S ^PSD(58.81,"PV",$E(X,1,30),DA)=""
"^DD",58.81,58.81,71,1,1,2)
K ^PSD(58.81,"PV",$E(X,1,30),DA)
"^DD",58.81,58.81,71,1,1,"%D",0)
^^1^1^2920817^
"^DD",58.81,58.81,71,1,1,"%D",1,0)
To locate all receipts that have been posted for a Prime Vendor Invoice.
"^DD",58.81,58.81,71,1,1,"DT")
2920817
"^DD",58.81,58.81,71,3)
Answer must be 1-30 characters in length.
"^DD",58.81,58.81,71,21,0)
^^3^3^2920817^
"^DD",58.81,58.81,71,21,1,0)
To allow the entering of a Prime Vendor Invoice number for a receipt.
"^DD",58.81,58.81,71,21,2,0)
The IFCAP Purchase Order number may be used all month and there may not
"^DD",58.81,58.81,71,21,3,0)
be a corresponding IFCAP transaction number for each Prime Vendor receipt.
"^DD",58.81,58.81,71,23,0)
^^1^1^2920817^
"^DD",58.81,58.81,71,23,1,0)
To track Prime Vendor receipts in the absence of a transaction number.
"^DD",58.81,58.81,71,"DT")
2920817
"^DD",58.81,58.81,72,0)
REFERRED REASON^F^^1;15^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,72,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,72,21,0)
^^2^2^2920825^
"^DD",58.81,58.81,72,21,1,0)
When a completed Green Sheet has been referred to a pharmacy supervisor
"^DD",58.81,58.81,72,21,2,0)
for review, this field may contain comments about the reason.
"^DD",58.81,58.81,72,"DT")
2920824
"^DD",58.81,58.81,73,0)
PATIENT^P2'^DPT(^9;1^Q
"^DD",58.81,58.81,73,3)
Enter the name of the patient receiving this medication.
"^DD",58.81,58.81,73,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,73,21,1,0)
This field contains a pointer to the name of the patient receiving
"^DD",58.81,58.81,73,21,2,0)
this Controlled Substances medication.
"^DD",58.81,58.81,73,23,0)
^^1^1^2930722^
"^DD",58.81,58.81,73,23,1,0)
Pointer to the PATIENT file #2.
"^DD",58.81,58.81,73,"DT")
2930722
"^DD",58.81,58.81,73.5,0)
FROM PATIENT ID LIST?^S^1:YES;0:NO;^9.5;1^Q
"^DD",58.81,58.81,73.5,3)
Is this Patient ID from the Patient ID list?
"^DD",58.81,58.81,73.5,21,0)
^^2^2^2940923^^
"^DD",58.81,58.81,73.5,21,1,0)
This field will be "YES" when the patient ID was picked up from the patient
"^DD",58.81,58.81,73.5,21,2,0)
ID list.
"^DD",58.81,58.81,73.5,"DT")
2931010
"^DD",58.81,58.81,74,0)
NURSE ID^P200'^VA(200,^9;2^Q
"^DD",58.81,58.81,74,3)
Enter the name of the nurse dispensing this medication.
"^DD",58.81,58.81,74,21,0)
^^2^2^2930722^^^
"^DD",58.81,58.81,74,21,1,0)
This field contains a pointer to the name of the nurse dispensing
"^DD",58.81,58.81,74,21,2,0)
this Controlled Substances medication.
"^DD",58.81,58.81,74,23,0)
^^1^1^2940923^^^^
"^DD",58.81,58.81,74,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,74,"DT")
2930722
"^DD",58.81,58.81,75,0)
ORIGINAL COUNT^NJ9,2^^9;3^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,75,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,75,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,75,21,1,0)
This field contains the original count or balance of this drug when
"^DD",58.81,58.81,75,21,2,0)
loaded into the TRAKKER for medication dispensing on the NAOU.
"^DD",58.81,58.81,75,"DT")
2930722
"^DD",58.81,58.81,76,0)
WASTED QUANTITY^NJ9,2^^9;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,76,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,76,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,76,21,1,0)
This field contains the quantity of this Controlled Substances drug
"^DD",58.81,58.81,76,21,2,0)
that was wasted during dispensing at the NAOU.
"^DD",58.81,58.81,76,"DT")
2930722
"^DD",58.81,58.81,77,0)
LIQUID AMOUNT^NJ6,0^^9;5^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,77,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,77,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,77,21,1,0)
This field contains the liquid quantity of the drug dispensed at the
"^DD",58.81,58.81,77,21,2,0)
NAOU.
"^DD",58.81,58.81,77,"DT")
2930722
"^DD",58.81,58.81,78,0)
SECOND NURSE ID^P200'^VA(200,^9;6^Q
"^DD",58.81,58.81,78,3)
Enter the name of the nurse witnessing this transaction.
"^DD",58.81,58.81,78,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,78,21,1,0)
This field contains a pointer to the name of the nurse witnessing this
"^DD",58.81,58.81,78,21,2,0)
Controlled Substances transaction.
"^DD",58.81,58.81,78,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,78,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,78,"DT")
2930722
"^DD",58.81,58.81,79,0)
CORRECT COUNT^NJ9,2^^9;7^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,79,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,79,21,0)
^^2^2^2940923^^
"^DD",58.81,58.81,79,21,1,0)
This field contains the correct count or balance for a Controlled
"^DD",58.81,58.81,79,21,2,0)
Substances drug on an NAOU.
"^DD",58.81,58.81,79,"DT")
2930722
"^DD",58.81,58.81,80,0)
PHARMACIST ID^P200'^VA(200,^9;8^Q
"^DD",58.81,58.81,80,3)
Enter the name of the pharmacist inventorying this CS drug.
"^DD",58.81,58.81,80,21,0)
^^2^2^2930930^
"^DD",58.81,58.81,80,21,1,0)
This field contains a pointer to name of the pharmacist inventorying
"^DD",58.81,58.81,80,21,2,0)
this Controlled Substances drug.
"^DD",58.81,58.81,80,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,80,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,80,"DT")
2930930
"^DD",58.81,58.81,81,0)
SECOND PHARMACIST ID^P200'^VA(200,^9;9^Q
"^DD",58.81,58.81,81,3)
Enter the name of the pharmacist witnessing this transaction.
"^DD",58.81,58.81,81,21,0)
^^2^2^2930930^
"^DD",58.81,58.81,81,21,1,0)
This field contains a pointer to the name of the pharmacist
"^DD",58.81,58.81,81,21,2,0)
witnessing this Controlled Substances transaction.
"^DD",58.81,58.81,81,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,81,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,81,"DT")
2930930
"^DD",58.81,58.81,82,0)
ACTUAL DATE/TIME^D^^9;10^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,82,3)
Enter actual date/time of this transaction.
"^DD",58.81,58.81,82,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,82,21,1,0)
This field contains the actual date/time this transaction was performed
"^DD",58.81,58.81,82,21,2,0)
using the barcode TRAKKER.
"^DD",58.81,58.81,82,"DT")
2930930
"^DD",58.81,58.81,83,0)
CS INSPECTOR^P200'^VA(200,^9;11^Q
"^DD",58.81,58.81,83,3)
Enter the name of the CS inspector performing this inventory.
"^DD",58.81,58.81,83,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,83,21,1,0)
This option contains a pointer to the name of the Controlled
"^DD",58.81,58.81,83,21,2,0)
Substances inspector inventorying this CS drug.
"^DD",58.81,58.81,83,"DT")
2931109
"^DD",58.81,58.81,84,0)
SECOND CS INSPECTOR^P200'^VA(200,^9;12^Q
"^DD",58.81,58.81,84,3)
Enter the name of the CS inspector witnessing this inventory.
"^DD",58.81,58.81,84,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,84,21,1,0)
This field contains a pointer to the name of the Controlled
"^DD",58.81,58.81,84,21,2,0)
Substances inspector witnessing the inventory of this CS drug.
"^DD",58.81,58.81,84,"DT")
2931109
"^DD",58.81,58.81,85,0)
EMERGENCY^S^1:YES;0:NO;^CS;6^Q
"^DD",58.81,58.81,85,1,0)
^.1
"^DD",58.81,58.81,85,1,1,0)
58.81^AEM1^MUMPS
"^DD",58.81,58.81,85,1,1,1)
D SAEM1^PSDUTL5
"^DD",58.81,58.81,85,1,1,2)
D KAEM1^PSDUTL5
"^DD",58.81,58.81,85,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,85,1,1,"%D",0)
^^3^3^2950216^^
"^DD",58.81,58.81,85,1,1,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,85,1,1,"%D",2,0)
 
"^DD",58.81,58.81,85,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,85,1,1,"DT")
2950216
"^DD",58.81,58.81,85,3)
Anser "YES" if this is an emergency order.
"^DD",58.81,58.81,85,21,0)
^^2^2^2950214^
"^DD",58.81,58.81,85,21,1,0)
A "YES" entry in this field will cause an order to print on the pharmacy
"^DD",58.81,58.81,85,21,2,0)
emergency order printer and allow for expedited processing.
"^DD",58.81,58.81,85,23,0)
^^1^1^2950214^
"^DD",58.81,58.81,85,23,1,0)
This field is used to flag orders for expedited processing.
"^DD",58.81,58.81,85,"DT")
2950216
"^DD",58.81,58.81,100,0)
CS TRANSACTION^S^1:YES;^CS;1^Q
"^DD",58.81,58.81,100,3)
Is this a Controlled Substances transaction?
"^DD",58.81,58.81,100,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,100,21,1,0)
This field will be set to "1" or "YES" if this is a Controlled
"^DD",58.81,58.81,100,21,2,0)
Substances package transaction.  This CS flag will be used when
"^DD",58.81,58.81,100,21,3,0)
purging data within this file.
"^DD",58.81,58.81,100,"DT")
2920416
"^DD",58.81,58.81,101,0)
PRINTED 2320^S^1:YES;0:NO;^CS;2^Q
"^DD",58.81,58.81,101,3)
Enter "1" or "Y" if this transaction has been printed.
"^DD",58.81,58.81,101,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,101,21,1,0)
This field is set to "1" or "YES" when this transaction is printed
"^DD",58.81,58.81,101,21,2,0)
on pharmacy's VA FORM 10-2320 for this drug.
"^DD",58.81,58.81,101,"DT")
2920504
"^DD",58.81,58.81,102,0)
PRINTED 2321^D^^CS;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,102,1,0)
^.1
"^DD",58.81,58.81,102,1,1,0)
58.81^AC
"^DD",58.81,58.81,102,1,1,1)
S ^PSD(58.81,"AC",$E(X,1,30),DA)=""
"^DD",58.81,58.81,102,1,1,2)
K ^PSD(58.81,"AC",$E(X,1,30),DA)
"^DD",58.81,58.81,102,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,102,1,1,"DT")
2920504
"^DD",58.81,58.81,102,3)
Enter date or date/time this transaction was printed in lieu of the form 2321.
"^DD",58.81,58.81,102,21,0)
^^6^6^2940915^^^^
"^DD",58.81,58.81,102,21,1,0)
This field is set to "1" or "YES" when this transaction is printed
"^DD",58.81,58.81,102,21,2,0)
on the dispensing/receiving report (in lieu of VA FORM 10-2321).
"^DD",58.81,58.81,102,21,3,0)
This flag is used in printing this transaction only once on the
"^DD",58.81,58.81,102,21,4,0)
dispensing/receiving report.  A reprint option is provided in
"^DD",58.81,58.81,102,21,5,0)
the Controlled Substances module for additional copies to be
"^DD",58.81,58.81,102,21,6,0)
printed.
"^DD",58.81,58.81,102,"DT")
2920504
"^DD",58.81,58.81,103,0)
PRINTED 2638^S^1:YES;0:NO;^CS;4^Q
"^DD",58.81,58.81,103,1,0)
^.1
"^DD",58.81,58.81,103,1,1,0)
58.81^AH
"^DD",58.81,58.81,103,1,1,1)
S ^PSD(58.81,"AH",$E(X,1,30),DA)=""
"^DD",58.81,58.81,103,1,1,2)
K ^PSD(58.81,"AH",$E(X,1,30),DA)
"^DD",58.81,58.81,103,1,1,"DT")
2920524
"^DD",58.81,58.81,103,3)
Enter "1" or "YES" if the FORM 10-2638 has been printed for this transaction.
"^DD",58.81,58.81,103,21,0)
^^5^5^2940915^^^^
"^DD",58.81,58.81,103,21,1,0)
This field is set to "1" or "YES" when a Green Sheet (VA FORM 10-
"^DD",58.81,58.81,103,21,2,0)
2638) is printed for this Controlled Substances order.  This flag
"^DD",58.81,58.81,103,21,3,0)
is used in printing this transaction only once.  A reprint option
"^DD",58.81,58.81,103,21,4,0)
is provided in the Controlled Substances module for additional
"^DD",58.81,58.81,103,21,5,0)
copies to be printed.
"^DD",58.81,58.81,103,"DT")
2920524
"^DD",58.81,58.81,104,0)
PRINTED LABEL^D^^CS;5^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,104,1,0)
^.1
"^DD",58.81,58.81,104,1,1,0)
58.81^AL
"^DD",58.81,58.81,104,1,1,1)
S ^PSD(58.81,"AL",$E(X,1,30),DA)=""
"^DD",58.81,58.81,104,1,1,2)
K ^PSD(58.81,"AL",$E(X,1,30),DA)
"^DD",58.81,58.81,104,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,104,1,1,"DT")
2930829
"^DD",58.81,58.81,104,3)
Enter the date or date/time this transaction label was printed.
"^DD",58.81,58.81,104,21,0)
^^4^4^2940310^^
"^DD",58.81,58.81,104,21,1,0)
This field is set to the date/time when the label for this transaction
"^DD",58.81,58.81,104,21,2,0)
is printed.  This flag is used in printing labels only once for this
"^DD",58.81,58.81,104,21,3,0)
transaction.  A reprint label option is provided in the Controlled
"^DD",58.81,58.81,104,21,4,0)
Substances module for additional labels to be printed.
"^DD",58.81,58.81,104,"DT")
2930829
"^DD",58.81,58.81,105,0)
SPECIALTY^P42.4'^DIC(42.4,^9;13^Q
"^DD",58.81,58.81,105,3)
Enter specialty for patient at time dose dispensed.
"^DD",58.81,58.81,105,21,0)
^^2^2^2950803^
"^DD",58.81,58.81,105,21,1,0)
For CDR reporting the specialty for the patient is stored at the
"^DD",58.81,58.81,105,21,2,0)
time each dose is dispensed.
"^DD",58.81,58.81,105,23,0)
^^1^1^2950803^
"^DD",58.81,58.81,105,23,1,0)
For CDR reporting a call is made to INP^VADPT to get specialty.
"^DD",58.81,58.81,105,"DT")
2950803
"^DD",58.81,58.81,106,0)
PRIME VENDOR ORDER NUMBER^P58.811'^PSD(58.811,^8;2^Q
"^DD",58.81,58.81,106,.1)
Prime Vendor Order Number
"^DD",58.81,58.81,106,3)
Enter the order number for the prime vendor order.
"^DD",58.81,58.81,106,21,0)
^^2^2^2970210^^
"^DD",58.81,58.81,106,21,1,0)
The PRIME VENDOR ORDER NUMBER field contains the order number on which
"^DD",58.81,58.81,106,21,2,0)
the drugs were purchased.
"^DD",58.81,58.81,106,"DT")
2970210
"^DD",58.81,58.8126,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",58.81,58.8126,0,"DT")
2920511
"^DD",58.81,58.8126,0,"NM","COMMENTS")

"^DD",58.81,58.8126,0,"UP")
58.81
"^DD",58.81,58.8126,.01,0)
COMMENTS^W^^0;1^Q
"^DD",58.81,58.8126,.01,3)
Enter your comments for this transaction.
"^DD",58.81,58.8126,.01,21,0)
^^1^1^2950301^^^^
"^DD",58.81,58.8126,.01,21,1,0)
This field contains the comments for this transaction.
"^DD",58.81,58.8126,.01,23,0)
^^1^1^2950301^^^^
"^DD",58.81,58.8126,.01,23,1,0)
Word Processing.
"^DD",58.81,58.8126,.01,"DT")
2920511
"^DD",58.82,58.82,0)
FIELD^^.01^1
"^DD",58.82,58.82,0,"DT")
2910827
"^DD",58.82,58.82,0,"IX","B",58.82,.01)

"^DD",58.82,58.82,0,"NM","CS ORDER STATUS")

"^DD",58.82,58.82,0,"PT",58.800118,10)

"^DD",58.82,58.82,0,"PT",58.81,10)

"^DD",58.82,58.82,0,"PT",58.85,6)

"^DD",58.82,58.82,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.82,58.82,.01,0)
ORDER STATUS^RF^^0;1^K:$L(X)>45!($L(X)<3)!'(X'?1P.E) X
"^DD",58.82,58.82,.01,1,0)
^.1
"^DD",58.82,58.82,.01,1,1,0)
58.82^B
"^DD",58.82,58.82,.01,1,1,1)
S ^PSD(58.82,"B",$E(X,1,30),DA)=""
"^DD",58.82,58.82,.01,1,1,2)
K ^PSD(58.82,"B",$E(X,1,30),DA)
"^DD",58.82,58.82,.01,3)
Answer must be 3-45 characters in length.
"^DD",58.82,58.82,.01,21,0)
^^1^1^2920912^^^^
"^DD",58.82,58.82,.01,21,1,0)
The order status for Controlled Substances requests.
"^DD",58.82,58.82,.01,"DT")
2910827
"^DD",58.83,58.83,0)
FIELD^^.01^1
"^DD",58.83,58.83,0,"DT")
2910827
"^DD",58.83,58.83,0,"IX","B",58.83,.01)

"^DD",58.83,58.83,0,"NM","CS COMPLETION STATUS")

"^DD",58.83,58.83,0,"PT",58.800118,11)

"^DD",58.83,58.83,0,"PT",58.81,11)

"^DD",58.83,58.83,0,"PT",58.87,13)

"^DD",58.83,58.83,0,"PT",58.87,14)

"^DD",58.83,58.83,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.83,58.83,.01,0)
COMPLETION STATUS^RF^^0;1^K:$L(X)>45!($L(X)<3)!'(X'?1P.E) X
"^DD",58.83,58.83,.01,1,0)
^.1
"^DD",58.83,58.83,.01,1,1,0)
58.83^B
"^DD",58.83,58.83,.01,1,1,1)
S ^PSD(58.83,"B",$E(X,1,45),DA)=""
"^DD",58.83,58.83,.01,1,1,2)
K ^PSD(58.83,"B",$E(X,1,45),DA)
"^DD",58.83,58.83,.01,3)
Answer must be 3-45 characters in length.
"^DD",58.83,58.83,.01,21,0)
^^1^1^2920912^^^^
"^DD",58.83,58.83,.01,21,1,0)
The completion status of the Controlled Substances orders.
"^DD",58.83,58.83,.01,"DT")
2910827
"^DD",58.84,58.84,0)
FIELD^^.01^1
"^DD",58.84,58.84,0,"DDA")
N
"^DD",58.84,58.84,0,"IX","B",58.84,.01)

"^DD",58.84,58.84,0,"NM","DRUG ACCOUNTABILITY TRANSACTION TYPE")

"^DD",58.84,58.84,0,"PT",58.81,1)

"^DD",58.84,58.84,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.84,58.84,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",58.84,58.84,.01,1,0)
^.1
"^DD",58.84,58.84,.01,1,1,0)
58.84^B
"^DD",58.84,58.84,.01,1,1,1)
S ^PSD(58.84,"B",$E(X,1,30),DA)=""
"^DD",58.84,58.84,.01,1,1,2)
K ^PSD(58.84,"B",$E(X,1,30),DA)
"^DD",58.84,58.84,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",58.84,58.84,.01,21,0)
^^1^1^2920415^
"^DD",58.84,58.84,.01,21,1,0)
This field contains the transaction type name.
"^DD",58.85,58.85,0)
FIELD^^22^23
"^DD",58.85,58.85,0,"DT")
2960816
"^DD",58.85,58.85,0,"ID",2)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSD(58.8,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(58.8,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.85,58.85,0,"ID",3)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSDRUG(+$P(^(0),U,4),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(50,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.85,58.85,0,"IX","AC",58.85,6)

"^DD",58.85,58.85,0,"IX","AD",58.85,4)

"^DD",58.85,58.85,0,"IX","AE",58.85,1)

"^DD",58.85,58.85,0,"IX","AW",58.85,13)

"^DD",58.85,58.85,0,"IX","AW1",58.85,1)

"^DD",58.85,58.85,0,"IX","B",58.85,.01)

"^DD",58.85,58.85,0,"NM","CS WORKSHEET")

"^DD",58.85,58.85,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.85,58.85,.01,0)
RECORD NUMBER^RNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.85,58.85,.01,1,0)
^.1
"^DD",58.85,58.85,.01,1,1,0)
58.85^B
"^DD",58.85,58.85,.01,1,1,1)
S ^PSD(58.85,"B",$E(X,1,30),DA)=""
"^DD",58.85,58.85,.01,1,1,2)
K ^PSD(58.85,"B",$E(X,1,30),DA)
"^DD",58.85,58.85,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",58.85,58.85,.01,21,0)
^^1^1^2920625^
"^DD",58.85,58.85,.01,21,1,0)
The record number for this worksheet entry.
"^DD",58.85,58.85,.01,"DT")
2920325
"^DD",58.85,58.85,1,0)
DISPENSING SITE^R*P58.8'^PSD(58.8,^0;2^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,1,1,0)
^.1
"^DD",58.85,58.85,1,1,1,0)
58.85^AE
"^DD",58.85,58.85,1,1,1,1)
S ^PSD(58.85,"AE",$E(X,1,30),DA)=""
"^DD",58.85,58.85,1,1,1,2)
K ^PSD(58.85,"AE",$E(X,1,30),DA)
"^DD",58.85,58.85,1,1,1,"DT")
2920407
"^DD",58.85,58.85,1,1,2,0)
58.85^AW1^MUMPS
"^DD",58.85,58.85,1,1,2,1)
D SAW1^PSDUTL1
"^DD",58.85,58.85,1,1,2,2)
D KAW1^PSDUTL1
"^DD",58.85,58.85,1,1,2,3)
DO NOT DELETE
"^DD",58.85,58.85,1,1,2,"%D",0)
^^4^4^2941003^^^^
"^DD",58.85,58.85,1,1,2,"%D",1,0)
This cross-reference will be used in displaying the CS request orders
"^DD",58.85,58.85,1,1,2,"%D",2,0)
in the order printed on the "Pharmacy Dispensing Worksheet" report.
"^DD",58.85,58.85,1,1,2,"%D",3,0)
  
"^DD",58.85,58.85,1,1,2,"%D",4,0)
The cross-reference is ^PSD(58.85,"AW",DISP SITE,PRT #,DA)=""
"^DD",58.85,58.85,1,1,2,"DT")
2920825
"^DD",58.85,58.85,1,3)
Enter the Pharmacy dispensing location.
"^DD",58.85,58.85,1,12)
Allows selection of Master vault or Satellite vault as a dispensing site.
"^DD",58.85,58.85,1,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.85,58.85,1,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,1,21,1,0)
The pharmacy dispensing site (vault) for this Controlled Substances
"^DD",58.85,58.85,1,21,2,0)
order.
"^DD",58.85,58.85,1,"DT")
2920825
"^DD",58.85,58.85,2,0)
NAOU^R*P58.8'^PSD(58.8,^0;3^S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,2,1,0)
^.1^^0
"^DD",58.85,58.85,2,3)
Enter the requesting NAOU.
"^DD",58.85,58.85,2,12)
Allows selection of a Satellite vault or a Narcotic location.
"^DD",58.85,58.85,2,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.85,58.85,2,21,0)
^^1^1^2920912^^
"^DD",58.85,58.85,2,21,1,0)
The Narcotic Area of Use requesting the Controlled Substances order.
"^DD",58.85,58.85,2,"DT")
2920825
"^DD",58.85,58.85,3,0)
DRUG^R*P50'^PSDRUG(^0;4^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$S($P($G(^(2)),""^"",3)[""N"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,3,3)
Enter drug requested for this order.
"^DD",58.85,58.85,3,12)
Allows selection of ACTIVE drugs marked for Controlled Substances package use.
"^DD",58.85,58.85,3,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$S($P($G(^(2)),""^"",3)[""N"":1,1:0)"
"^DD",58.85,58.85,3,21,0)
^^1^1^2920912^^
"^DD",58.85,58.85,3,21,1,0)
The Controlled Substances drug requested on this order.
"^DD",58.85,58.85,3,"DT")
2920325
"^DD",58.85,58.85,4,0)
REQUEST #^RNJ8,0^^0;5^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.85,58.85,4,1,0)
^.1
"^DD",58.85,58.85,4,1,1,0)
58.85^AD^MUMPS
"^DD",58.85,58.85,4,1,1,1)
D REQ^PSDUTL
"^DD",58.85,58.85,4,1,1,2)
D KREQ^PSDUTL
"^DD",58.85,58.85,4,1,1,3)
DO NOT DELETE
"^DD",58.85,58.85,4,1,1,"%D",0)
^^4^4^2941003^^^^
"^DD",58.85,58.85,4,1,1,"%D",1,0)
This cross-reference will be used for updating order requests stored
"^DD",58.85,58.85,4,1,1,"%D",2,0)
in the DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.85,58.85,4,1,1,"%D",3,0)
  
"^DD",58.85,58.85,4,1,1,"%D",4,0)
The cross-reference is ^PSD(58.85,"AD",NAOU,DRUG,REQUEST #,DA)=""
"^DD",58.85,58.85,4,1,1,"DT")
2920325
"^DD",58.85,58.85,4,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.85,58.85,4,21,0)
^^1^1^2920912^^
"^DD",58.85,58.85,4,21,1,0)
The request number for this Controlled Substances order.
"^DD",58.85,58.85,4,"DT")
2920325
"^DD",58.85,58.85,5,0)
QUANTITY ORDERED^RNJ6,0^^0;6^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.85,58.85,5,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.85,58.85,5,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,5,21,1,0)
The drug quantity originally requested on this Controlled Substances
"^DD",58.85,58.85,5,21,2,0)
order.
"^DD",58.85,58.85,5,"DT")
2920415
"^DD",58.85,58.85,6,0)
ORDER STATUS^RP58.82'^PSD(58.82,^0;7^Q
"^DD",58.85,58.85,6,1,0)
^.1
"^DD",58.85,58.85,6,1,1,0)
58.85^AC^MUMPS
"^DD",58.85,58.85,6,1,1,1)
D STAT^PSDUTL
"^DD",58.85,58.85,6,1,1,2)
D KSTAT^PSDUTL
"^DD",58.85,58.85,6,1,1,3)
DO NOT DELETE
"^DD",58.85,58.85,6,1,1,"%D",0)
^^4^4^2941003^^^^
"^DD",58.85,58.85,6,1,1,"%D",1,0)
This cross-reference is used for various Controlled Substances
"^DD",58.85,58.85,6,1,1,"%D",2,0)
statistical reports.
"^DD",58.85,58.85,6,1,1,"%D",3,0)
   
"^DD",58.85,58.85,6,1,1,"%D",4,0)
The cross-reference is ^PSD(58.85,"AC",STATUS,NAOU,DRUG,REQUEST #,DA)=""
"^DD",58.85,58.85,6,1,1,"DT")
2920325
"^DD",58.85,58.85,6,3)
Enter processing status for this order.
"^DD",58.85,58.85,6,21,0)
^^1^1^2920912^^
"^DD",58.85,58.85,6,21,1,0)
A pointer to the order status for this Controlled Substances request.
"^DD",58.85,58.85,6,"DT")
2920325
"^DD",58.85,58.85,7,0)
TRANSACTION #^P58.81'^PSD(58.81,^0;8^Q
"^DD",58.85,58.85,7,3)
Enter the transaction # for this order.
"^DD",58.85,58.85,7,21,0)
^^2^2^2920625^
"^DD",58.85,58.85,7,21,1,0)
If this request is processed by pharmacy, this field contains a pointer
"^DD",58.85,58.85,7,21,2,0)
to the transaction dispensing this order.
"^DD",58.85,58.85,7,"DT")
2920325
"^DD",58.85,58.85,8,0)
COMMENTS^58.858^^1;0
"^DD",58.85,58.85,8,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,8,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.85,58.85,8,21,2,0)
request.
"^DD",58.85,58.85,9,0)
MANUFACTURER^F^^0;9^K:$L(X)>30!($L(X)<1) X
"^DD",58.85,58.85,9,3)
Enter the current manufacturer.
"^DD",58.85,58.85,9,21,0)
^^1^1^2920625^
"^DD",58.85,58.85,9,21,1,0)
The manufacturer for the drug requested on this order.
"^DD",58.85,58.85,9,"DT")
2920405
"^DD",58.85,58.85,10,0)
LOT #^F^^0;10^K:$L(X)>10!($L(X)<1) X
"^DD",58.85,58.85,10,3)
Enter the current lot # for this drug.
"^DD",58.85,58.85,10,21,0)
^^1^1^2920625^
"^DD",58.85,58.85,10,21,1,0)
The lot number for the drug requested on this order.
"^DD",58.85,58.85,10,"DT")
2920405
"^DD",58.85,58.85,11,0)
EXPIRATION DATE^D^^0;11^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.85,58.85,11,3)
Enter the expiration date for this drug.
"^DD",58.85,58.85,11,21,0)
^^1^1^2920625^
"^DD",58.85,58.85,11,21,1,0)
The expiration date for the drug requested on this order.
"^DD",58.85,58.85,11,"DT")
2920430
"^DD",58.85,58.85,12,0)
ORDERED BY^*P200'^VA(200,^0;12^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,12,3)
Enter the person's name requesting this order.
"^DD",58.85,58.85,12,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.85,58.85,12,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.85,58.85,12,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,12,21,1,0)
A pointer to the name of the person requesting this Controlled
"^DD",58.85,58.85,12,21,2,0)
Substances order.
"^DD",58.85,58.85,12,"DT")
2920419
"^DD",58.85,58.85,13,0)
PRINTED^NJ6,0^^2;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.85,58.85,13,1,0)
^.1
"^DD",58.85,58.85,13,1,1,0)
58.85^AW^MUMPS
"^DD",58.85,58.85,13,1,1,1)
D SAW^PSDUTL1
"^DD",58.85,58.85,13,1,1,2)
D KAW^PSDUTL1
"^DD",58.85,58.85,13,1,1,3)
DO NOT DELETE
"^DD",58.85,58.85,13,1,1,"%D",0)
^^4^4^2941003^^^^
"^DD",58.85,58.85,13,1,1,"%D",1,0)
This cross-reference will be used in displaying CS request orders in
"^DD",58.85,58.85,13,1,1,"%D",2,0)
the order printed on the "Pharmacy Dispensing Worksheet" report.
"^DD",58.85,58.85,13,1,1,"%D",3,0)
  
"^DD",58.85,58.85,13,1,1,"%D",4,0)
The cross-reference is ^PSD(58.85,"AW",DISP SITE,PRT #,DA)=""
"^DD",58.85,58.85,13,1,1,"DT")
2920825
"^DD",58.85,58.85,13,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.85,58.85,13,21,0)
^^3^3^2920912^^^^
"^DD",58.85,58.85,13,21,1,0)
This printed flag will be set to a counter if this request has been
"^DD",58.85,58.85,13,21,2,0)
printed on a worksheet report.  This flag will be used to compile the
"^DD",58.85,58.85,13,21,3,0)
pharmacy worksheet log used in dispensing Controlled Substances drugs.
"^DD",58.85,58.85,13,"DT")
2920825
"^DD",58.85,58.85,14,0)
DISPENSED BY^*P200'^VA(200,^0;13^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,14,.1)
DISPENSING PHARMACIST
"^DD",58.85,58.85,14,3)
Enter name of the dispensing pharmacist.
"^DD",58.85,58.85,14,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.85,58.85,14,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.85,58.85,14,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,14,21,1,0)
A pointer to the name of the pharmacist dispensing this Controlled
"^DD",58.85,58.85,14,21,2,0)
Substances order.
"^DD",58.85,58.85,14,"DT")
2920419
"^DD",58.85,58.85,15,0)
DISPENSED DATE/TIME^D^^0;14^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.85,58.85,15,21,0)
^^1^1^2920912^^
"^DD",58.85,58.85,15,21,1,0)
The dispensed date/time of this Controlled Substances order.
"^DD",58.85,58.85,15,"DT")
2930701
"^DD",58.85,58.85,16,0)
PHARMACY DISPENSING #^F^^0;15^K:$L(X)>9!($L(X)<1) X
"^DD",58.85,58.85,16,3)
Answer must be 1-9 characters in length.
"^DD",58.85,58.85,16,21,0)
^^2^2^2940915^^^
"^DD",58.85,58.85,16,21,1,0)
The pharmacy control number (Green Sheet #) assigned to identify
"^DD",58.85,58.85,16,21,2,0)
and track this Controlled Substances order.
"^DD",58.85,58.85,16,"DT")
2920812
"^DD",58.85,58.85,17,0)
TECH^*P200'^VA(200,^0;16^S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,17,3)
Enter the name of the pharmacy employee processing this order.
"^DD",58.85,58.85,17,12)
Access granted to technicians holding the appropriate security key.
"^DD",58.85,58.85,17,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.85,58.85,17,21,0)
^^2^2^2920625^
"^DD",58.85,58.85,17,21,1,0)
If a pharmacy technician processed this order, this field will contain
"^DD",58.85,58.85,17,21,2,0)
a pointer to the name of the technician.
"^DD",58.85,58.85,17,"DT")
2920419
"^DD",58.85,58.85,18,0)
QUANTITY DISPENSED^NJ6,0^^0;17^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.85,58.85,18,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.85,58.85,18,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,18,21,1,0)
The actual drug quantity dispensed from pharmacy for this Controlled
"^DD",58.85,58.85,18,21,2,0)
Substances order.
"^DD",58.85,58.85,18,"DT")
2920415
"^DD",58.85,58.85,19,0)
REQUEST DATE/TIME^D^^0;18^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.85,58.85,19,3)
Enter the request date for this order.
"^DD",58.85,58.85,19,21,0)
^^2^2^2920912^^
"^DD",58.85,58.85,19,21,1,0)
The date/time this Controlled Substances request was entered by
"^DD",58.85,58.85,19,21,2,0)
the NAOU.
"^DD",58.85,58.85,19,"DT")
2920501
"^DD",58.85,58.85,20,0)
ORDERED BY PHARMACY^*P200'^VA(200,^0;19^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHAM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.85,58.85,20,3)
Enter the person's name requesting this order for nursing.
"^DD",58.85,58.85,20,12)
Access granted to pharmacy personnel holding the appropriate security key.
"^DD",58.85,58.85,20,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHAM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.85,58.85,20,21,0)
^^2^2^2931010^
"^DD",58.85,58.85,20,21,1,0)
A pointer to the pharmacy employee's name entering the Controlled
"^DD",58.85,58.85,20,21,2,0)
Substances request for nursing.
"^DD",58.85,58.85,20,"DT")
2931010
"^DD",58.85,58.85,21,0)
EMERGENCY^S^1:YES;0:NO;^2;2^Q
"^DD",58.85,58.85,21,3)
Answer "YES" if this is an emergency order.
"^DD",58.85,58.85,21,21,0)
^^2^2^2950214^
"^DD",58.85,58.85,21,21,1,0)
A "YES" entry in this field will cause an order to print on the pharmacy
"^DD",58.85,58.85,21,21,2,0)
emergency order printer and allow for expedited processing.
"^DD",58.85,58.85,21,23,0)
^^1^1^2950214^
"^DD",58.85,58.85,21,23,1,0)
This field is used to flag orders for expedited processing.
"^DD",58.85,58.85,21,"DT")
2950214
"^DD",58.85,58.85,22,0)
PATIENT^P2'^DPT(^2;3^Q
"^DD",58.85,58.85,22,3)
Enter the patient for which this Controlled Substance is being ordered.
"^DD",58.85,58.85,22,21,0)
^^1^1^2960816^
"^DD",58.85,58.85,22,21,1,0)
This field is for infusion and PCA syringe orders.
"^DD",58.85,58.85,22,"DT")
2960816
"^DD",58.85,58.858,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",58.85,58.858,0,"DT")
2920405
"^DD",58.85,58.858,0,"NM","COMMENTS")

"^DD",58.85,58.858,0,"UP")
58.85
"^DD",58.85,58.858,.01,0)
COMMENTS^W^^0;1^Q
"^DD",58.85,58.858,.01,21,0)
^^2^2^2920912^^
"^DD",58.85,58.858,.01,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.85,58.858,.01,21,2,0)
request.
"^DD",58.85,58.858,.01,"DT")
2920405
"^DD",58.86,58.86,0)
FIELD^^19^19
"^DD",58.86,58.86,0,"DT")
2950705
"^DD",58.86,58.86,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSDRUG(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(50,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.86,58.86,0,"ID",13)
W:$D(^(1)) "   ",$P(^(1),U,1)
"^DD",58.86,58.86,0,"IX","AC",58.86,10)

"^DD",58.86,58.86,0,"IX","AC1",58.86,1)

"^DD",58.86,58.86,0,"IX","AC2",58.86,6)

"^DD",58.86,58.86,0,"IX","AD",58.86,10)

"^DD",58.86,58.86,0,"IX","AD1",58.86,13)

"^DD",58.86,58.86,0,"IX","AD2",58.86,6)

"^DD",58.86,58.86,0,"IX","B",58.86,.01)

"^DD",58.86,58.86,0,"NM","CS DESTRUCTION")

"^DD",58.86,58.86,0,"PT",58.81,47)

"^DD",58.86,58.86,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.86,58.86,.01,0)
NUMBER^RNJ8,0X^^0;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.86,58.86,.01,1,0)
^.1
"^DD",58.86,58.86,.01,1,1,0)
58.86^B
"^DD",58.86,58.86,.01,1,1,1)
S ^PSD(58.86,"B",$E(X,1,30),DA)=""
"^DD",58.86,58.86,.01,1,1,2)
K ^PSD(58.86,"B",$E(X,1,30),DA)
"^DD",58.86,58.86,.01,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.86,58.86,.01,21,0)
^^1^1^2951130^^^
"^DD",58.86,58.86,.01,21,1,0)
The destruction number for this Controlled Substances drug.
"^DD",58.86,58.86,.01,23,0)
^^1^1^2951130^^
"^DD",58.86,58.86,.01,23,1,0)
DINUMed.
"^DD",58.86,58.86,.01,"DT")
2920603
"^DD",58.86,58.86,1,0)
DRUG^*P50'^PSDRUG(^0;2^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.86,58.86,1,1,0)
^.1
"^DD",58.86,58.86,1,1,1,0)
58.86^AC1^MUMPS
"^DD",58.86,58.86,1,1,1,1)
D SAC1^PSDUTL3
"^DD",58.86,58.86,1,1,1,2)
D KAC1^PSDUTL3
"^DD",58.86,58.86,1,1,1,3)
DO NOT DELETE
"^DD",58.86,58.86,1,1,1,"%D",0)
^^5^5^2941003^^^^
"^DD",58.86,58.86,1,1,1,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,1,1,1,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,1,1,1,"%D",3,0)
 
"^DD",58.86,58.86,1,1,1,"%D",4,0)
The cross-reference is ^PSD(58.86,"AC",DATE/TIME DESTROYED,DISPENSING
"^DD",58.86,58.86,1,1,1,"%D",5,0)
SITE,DRUG,DA)=""
"^DD",58.86,58.86,1,1,1,"DT")
2930515
"^DD",58.86,58.86,1,3)
Enter the name of the drug being destroyed.
"^DD",58.86,58.86,1,12)
Allows selection of ACTIVE drugs to be destroyed.
"^DD",58.86,58.86,1,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)"
"^DD",58.86,58.86,1,21,0)
^^1^1^2920912^^
"^DD",58.86,58.86,1,21,1,0)
A pointer to the name of the drug being destroyed.
"^DD",58.86,58.86,1,"DT")
2930817
"^DD",58.86,58.86,2,0)
QUANTITY^NJ9,2^^0;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.86,58.86,2,3)
Type a Number between 0 and 999999, 2 Decimal Digits
"^DD",58.86,58.86,2,21,0)
^^1^1^2920625^
"^DD",58.86,58.86,2,21,1,0)
The quantity of the drug being destroyed.
"^DD",58.86,58.86,2,"DT")
2940518
"^DD",58.86,58.86,3,0)
PHARMACIST TURNING IN DRUG^*P200'^VA(200,^0;4^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.86,58.86,3,3)
Enter the name of the pharmacist turning this drug in for destruction.
"^DD",58.86,58.86,3,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.86,58.86,3,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.86,58.86,3,21,0)
^^2^2^2920625^
"^DD",58.86,58.86,3,21,1,0)
A pointer to the name of the pharmacist turning the drug in for
"^DD",58.86,58.86,3,21,2,0)
destruction.
"^DD",58.86,58.86,3,"DT")
2920607
"^DD",58.86,58.86,4,0)
NURSE RETURNING DRUG^*P200'^VA(200,^0;5^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.86,58.86,4,3)
Enter the name of the nurse returning this drug.
"^DD",58.86,58.86,4,12)
Access granted to nurse holding the appropriate security key.
"^DD",58.86,58.86,4,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.86,58.86,4,21,0)
^^2^2^2920625^
"^DD",58.86,58.86,4,21,1,0)
A pointer to the name of the nurse returning the drug to pharmacy
"^DD",58.86,58.86,4,21,2,0)
for destruction.
"^DD",58.86,58.86,4,"DT")
2930527
"^DD",58.86,58.86,5,0)
DATE/TIME TURNED IN^D^^0;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.86,58.86,5,3)
Enter date/time this drug was turned in for destruction.
"^DD",58.86,58.86,5,21,0)
^^1^1^2920625^
"^DD",58.86,58.86,5,21,1,0)
The date/time the drug is turned in for destruction.
"^DD",58.86,58.86,5,"DT")
2930701
"^DD",58.86,58.86,6,0)
RETURNED TO DISP SITE^*P58.8'^PSD(58.8,^0;7^S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.86,58.86,6,1,0)
^.1
"^DD",58.86,58.86,6,1,1,0)
58.86^AC2^MUMPS
"^DD",58.86,58.86,6,1,1,1)
D SAC2^PSDUTL3
"^DD",58.86,58.86,6,1,1,2)
D KAC2^PSDUTL3
"^DD",58.86,58.86,6,1,1,3)
DO NOT DELETE
"^DD",58.86,58.86,6,1,1,"%D",0)
^^5^5^2941003^^^^
"^DD",58.86,58.86,6,1,1,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,6,1,1,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,6,1,1,"%D",3,0)
  
"^DD",58.86,58.86,6,1,1,"%D",4,0)
The cross-reference is ^PSD(58.86,"AC",DATE/TIME DESTROYED,DISPENSING
"^DD",58.86,58.86,6,1,1,"%D",5,0)
SITE,DRUG,DA)=""
"^DD",58.86,58.86,6,1,1,"DT")
2930515
"^DD",58.86,58.86,6,1,2,0)
58.86^AD2^MUMPS
"^DD",58.86,58.86,6,1,2,1)
D SAD2^PSDUTL3
"^DD",58.86,58.86,6,1,2,2)
D KAD2^PSDUTL3
"^DD",58.86,58.86,6,1,2,3)
DO NOT DELETE
"^DD",58.86,58.86,6,1,2,"%D",0)
^^5^5^2941003^^^^
"^DD",58.86,58.86,6,1,2,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,6,1,2,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,6,1,2,"%D",3,0)
 
"^DD",58.86,58.86,6,1,2,"%D",4,0)
The cross-reference is ^PSD(58.86,"AD",DATE/TIME DESTROYED,DISPENSING SITE,
"^DD",58.86,58.86,6,1,2,"%D",5,0)
FREE-TEXT DRUG NAME,DA)=""
"^DD",58.86,58.86,6,1,2,"DT")
2931024
"^DD",58.86,58.86,6,3)
Enter the name of the dispensing vault holding this drug for destruction.
"^DD",58.86,58.86,6,12)
Allows selection of Master or Satellite vaults.
"^DD",58.86,58.86,6,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.86,58.86,6,21,0)
^^1^1^2920625^
"^DD",58.86,58.86,6,21,1,0)
The pharmacy dispensing site (vault) holding the drug for destruction.
"^DD",58.86,58.86,6,"DT")
2931024
"^DD",58.86,58.86,8,0)
TRANSACTION #^P58.81'^PSD(58.81,^0;9^Q
"^DD",58.86,58.86,8,3)
Enter transaction number of this drug.
"^DD",58.86,58.86,8,21,0)
^^1^1^2920625^
"^DD",58.86,58.86,8,21,1,0)
A pointer to the transaction associated with this drug destruction.
"^DD",58.86,58.86,8,"DT")
2920607
"^DD",58.86,58.86,9,0)
PHARMACIST DESTROYED DRUG^*P200'^VA(200,^0;10^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSDMGR"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.86,58.86,9,3)
Enter the name of the pharmacist destroying this drug.
"^DD",58.86,58.86,9,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.86,58.86,9,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSDMGR"",+Y)):1,1:0)"
"^DD",58.86,58.86,9,21,0)
^^2^2^2920625^
"^DD",58.86,58.86,9,21,1,0)
A pointer to the name of the pharmacist verifying this drug was
"^DD",58.86,58.86,9,21,2,0)
destroyed.
"^DD",58.86,58.86,9,"DT")
2931024
"^DD",58.86,58.86,10,0)
DATE/TIME DESTROYED^D^^0;11^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.86,58.86,10,1,0)
^.1
"^DD",58.86,58.86,10,1,1,0)
58.86^AC^MUMPS
"^DD",58.86,58.86,10,1,1,1)
D SAC^PSDUTL3
"^DD",58.86,58.86,10,1,1,2)
D KAC^PSDUTL3
"^DD",58.86,58.86,10,1,1,3)
DO NOT DELETE
"^DD",58.86,58.86,10,1,1,"%D",0)
^^5^5^2941003^^^^
"^DD",58.86,58.86,10,1,1,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,10,1,1,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,10,1,1,"%D",3,0)
 
"^DD",58.86,58.86,10,1,1,"%D",4,0)
The cross-reference is ^PSD(58.86,"AC",DATE/TIME DESTROYED,DISPENSING
"^DD",58.86,58.86,10,1,1,"%D",5,0)
SITE,DRUG,DA)=""
"^DD",58.86,58.86,10,1,1,"DT")
2930515
"^DD",58.86,58.86,10,1,2,0)
58.86^AD^MUMPS
"^DD",58.86,58.86,10,1,2,1)
D SAD^PSDUTL3
"^DD",58.86,58.86,10,1,2,2)
D KAD^PSDUTL3
"^DD",58.86,58.86,10,1,2,3)
DO NOT DELETE
"^DD",58.86,58.86,10,1,2,"%D",0)
^^5^5^2941003^^^^
"^DD",58.86,58.86,10,1,2,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,10,1,2,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,10,1,2,"%D",3,0)
 
"^DD",58.86,58.86,10,1,2,"%D",4,0)
The cross-reference is ^PSD(58.86,"AC",DATE/TIME DESTROYED,DISPENSING SITE,
"^DD",58.86,58.86,10,1,2,"%D",5,0)
FREE-TEXT DRUG NAME,DA)=""
"^DD",58.86,58.86,10,1,2,"DT")
2931024
"^DD",58.86,58.86,10,3)
Enter the date/time this drug was destroyed.
"^DD",58.86,58.86,10,21,0)
^^1^1^2960717^^^^
"^DD",58.86,58.86,10,21,1,0)
The destruction date/time of this drug.
"^DD",58.86,58.86,10,"DT")
2931024
"^DD",58.86,58.86,11,0)
NO. OF CONTAINERS^NJ3,0^^0;8^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.86,58.86,11,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",58.86,58.86,11,21,0)
^^2^2^2951130^^
"^DD",58.86,58.86,11,21,1,0)
This field contains the number of containers destroyed. This information
"^DD",58.86,58.86,11,21,2,0)
is required for DEA Form - 41.
"^DD",58.86,58.86,11,"DT")
2930516
"^DD",58.86,58.86,12,0)
UNIT^F^^0;12^K:$L(X)>10!($L(X)<1)!'(X?1A.A) X
"^DD",58.86,58.86,12,3)
Enter unit being destroyed (e.g., PACK, EACH. Not to exceed 10 characters).
"^DD",58.86,58.86,12,21,0)
^^2^2^2940922^^
"^DD",58.86,58.86,12,21,1,0)
The DEA Form - 41 requires that unit be defined for each controlled
"^DD",58.86,58.86,12,21,2,0)
substance destroyed.
"^DD",58.86,58.86,12,"DT")
2930516
"^DD",58.86,58.86,13,0)
DRUG ITEM^F^^1;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>40!($L(X)<1)!'(X'?1P.E) X
"^DD",58.86,58.86,13,1,0)
^.1
"^DD",58.86,58.86,13,1,1,0)
58.86^AD1^MUMPS
"^DD",58.86,58.86,13,1,1,1)
D SAD1^PSDUTL3
"^DD",58.86,58.86,13,1,1,2)
D KAD1^PSDUTL3
"^DD",58.86,58.86,13,1,1,3)
DO NOT DELETE
"^DD",58.86,58.86,13,1,1,"%D",0)
^^5^5^2941003^^^
"^DD",58.86,58.86,13,1,1,"%D",1,0)
This cross-reference is used in compiling the Controlled Substances
"^DD",58.86,58.86,13,1,1,"%D",2,0)
destroyed drugs report.
"^DD",58.86,58.86,13,1,1,"%D",3,0)
 
"^DD",58.86,58.86,13,1,1,"%D",4,0)
The cross-reference is ^PSD(58.86,"AD",DATE/TIME DESTROYED,DISPENSING SITE,
"^DD",58.86,58.86,13,1,1,"%D",5,0)
FREE-TEXT DRUG NAME,DA)=""
"^DD",58.86,58.86,13,1,1,"DT")
2931024
"^DD",58.86,58.86,13,3)
Answer must be 1-40 characters in length.
"^DD",58.86,58.86,13,21,0)
^^1^1^2930817^
"^DD",58.86,58.86,13,21,1,0)
The free-text name of the drug not normally housed within the VA.
"^DD",58.86,58.86,13,"DT")
2931024
"^DD",58.86,58.86,14,0)
COMMENTS^F^^2;1^K:$L(X)>60!($L(X)<1) X
"^DD",58.86,58.86,14,3)
Answer must be 1-60 characters in length.
"^DD",58.86,58.86,14,21,0)
^^1^1^2950302^
"^DD",58.86,58.86,14,21,1,0)
Enter patient name, RX# and reason drug is placed on hold.
"^DD",58.86,58.86,14,23,0)
^^1^1^2950302^
"^DD",58.86,58.86,14,23,1,0)
E3R# 3771 requested a comment field to enter patient name, RX# and reason drug is placed on hold.
"^DD",58.86,58.86,14,"DT")
2950302
"^DD",58.86,58.86,15,0)
DATE/TIME CANCELLED^D^^3;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.86,58.86,15,3)
Enter the date/time the holding number was cancelled.
"^DD",58.86,58.86,15,21,0)
^^1^1^2960717^^^^
"^DD",58.86,58.86,15,21,1,0)
The date the holding number is being cancelled.
"^DD",58.86,58.86,15,23,0)
^^1^1^2960717^^^^
"^DD",58.86,58.86,15,23,1,0)
E3R# 4990. This field displays the date the holding number was cancelled.
"^DD",58.86,58.86,15,"DT")
2950516
"^DD",58.86,58.86,16,0)
CANCELLED BY^P200'^VA(200,^3;2^Q
"^DD",58.86,58.86,16,3)
Enter the name of the pharmacist cancelling the holding number.
"^DD",58.86,58.86,16,21,0)
^^1^1^2950517^^^^
"^DD",58.86,58.86,16,21,1,0)
A pointer to file# 200 for the name of the pharmacist cancelling the holding number.
"^DD",58.86,58.86,16,23,0)
^^1^1^2950517^^^^
"^DD",58.86,58.86,16,23,1,0)
E3R# 4990. This field displays the name of the pharmacist cancelling the holding number.
"^DD",58.86,58.86,16,"DT")
2950517
"^DD",58.86,58.86,17,0)
COMMENTS^F^^3;3^K:$L(X)>60!($L(X)<1) X
"^DD",58.86,58.86,17,3)
Answer must be 1-60 characters in length.
"^DD",58.86,58.86,17,21,0)
^^1^1^2950717^^^
"^DD",58.86,58.86,17,21,1,0)
Enter the reason the holding number was cancelled.
"^DD",58.86,58.86,17,23,0)
^^1^1^2950717^^^
"^DD",58.86,58.86,17,23,1,0)
E3R# 4990. Enter the reason the holding number was cancelled.
"^DD",58.86,58.86,17,"DT")
2950717
"^DD",58.86,58.86,18,0)
PATIENT RETURNING DRUG^P2'^DPT(^0;13^Q
"^DD",58.86,58.86,18,.1)
Patient returning the drug
"^DD",58.86,58.86,18,3)
Enter the name of the patient/person returning the drug.
"^DD",58.86,58.86,18,21,0)
^^1^1^2950913^^^
"^DD",58.86,58.86,18,21,1,0)
A pointer to the name of the patient/person returning the drug for destruction.
"^DD",58.86,58.86,18,23,0)
^^1^1^2950913^^
"^DD",58.86,58.86,18,23,1,0)
E3R# 4990 and David@jackson requested this fld be added to enter patient name returning the drug.
"^DD",58.86,58.86,18,"DT")
2950703
"^DD",58.86,58.86,19,0)
PRICE PER DISPENSE UNIT^P50'^PSDRUG(^0;14^Q
"^DD",58.86,58.86,19,3)
This fld is automatically filled with data fr file #50,16 660;6.
"^DD",58.86,58.86,19,21,0)
^^1^1^2950705^^^
"^DD",58.86,58.86,19,21,1,0)
This fld holds the data selected fr file #50,16 660;6.
"^DD",58.86,58.86,19,23,0)
^^1^1^2950705^^
"^DD",58.86,58.86,19,23,1,0)
This fld and Qty 2,0;3 are used to calculate cost data by drug for the Destroyed Drug Report.
"^DD",58.86,58.86,19,"DT")
2950705
"^DD",58.87,58.87,0)
FIELD^^14^15
"^DD",58.87,58.87,0,"DDA")
N
"^DD",58.87,58.87,0,"DT")
2930531
"^DD",58.87,58.87,0,"IX","AC",58.87,1)

"^DD",58.87,58.87,0,"IX","AC1",58.87,11)

"^DD",58.87,58.87,0,"IX","AC2",58.87,12)

"^DD",58.87,58.87,0,"IX","B",58.87,.01)

"^DD",58.87,58.87,0,"NM","CS CORRECTION LOG")

"^DD",58.87,58.87,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.87,58.87,.01,0)
LOG NUMBER^RNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.87,58.87,.01,1,0)
^.1
"^DD",58.87,58.87,.01,1,1,0)
58.87^B
"^DD",58.87,58.87,.01,1,1,1)
S ^PSD(58.87,"B",$E(X,1,30),DA)=""
"^DD",58.87,58.87,.01,1,1,2)
K ^PSD(58.87,"B",$E(X,1,30),DA)
"^DD",58.87,58.87,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",58.87,58.87,.01,21,0)
^^1^1^2920906^^
"^DD",58.87,58.87,.01,21,1,0)
This field contains the correction log number for this entry.
"^DD",58.87,58.87,.01,"DT")
2920906
"^DD",58.87,58.87,1,0)
CORRECTION DATE/TIME^D^^0;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.87,58.87,1,1,0)
^.1
"^DD",58.87,58.87,1,1,1,0)
58.87^AC^MUMPS
"^DD",58.87,58.87,1,1,1,1)
D SAC^PSDUTL2
"^DD",58.87,58.87,1,1,1,2)
D KAC^PSDUTL2
"^DD",58.87,58.87,1,1,1,3)
DO NOT DELETE
"^DD",58.87,58.87,1,1,1,"%D",0)
^^3^3^2941003^^^
"^DD",58.87,58.87,1,1,1,"%D",1,0)
This cross-reference is used in compiling the "CS Correction Log Report".
"^DD",58.87,58.87,1,1,1,"%D",2,0)
  
"^DD",58.87,58.87,1,1,1,"%D",3,0)
The cross-reference is ^PSD(58.87,"AC",TYPE,DISP SITE,DATE,DA)=""
"^DD",58.87,58.87,1,1,1,"DT")
2920906
"^DD",58.87,58.87,1,3)
Enter the date/time of this correction action.
"^DD",58.87,58.87,1,21,0)
^^1^1^2930309^^
"^DD",58.87,58.87,1,21,1,0)
The date/time of this correction entry.
"^DD",58.87,58.87,1,"DT")
2920906
"^DD",58.87,58.87,2,0)
CORRECTED BY PHARMACIST^*P200'^VA(200,^0;3^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,2,3)
Enter the name of the pharmacist correcting this problem.
"^DD",58.87,58.87,2,12)
Access granted to the pharmacists holding the appropriate security key.
"^DD",58.87,58.87,2,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.87,58.87,2,21,0)
^^2^2^2920906^
"^DD",58.87,58.87,2,21,1,0)
A pointer to the name of the pharmacist associated with this correction
"^DD",58.87,58.87,2,21,2,0)
action.
"^DD",58.87,58.87,2,"DT")
2920906
"^DD",58.87,58.87,3,0)
PHARMACY DISPENSING #^F^^0;4^K:$L(X)>9!($L(X)<1) X
"^DD",58.87,58.87,3,3)
Answer must be 1-9 characters in length.
"^DD",58.87,58.87,3,21,0)
^^2^2^2920912^^^
"^DD",58.87,58.87,3,21,1,0)
The pharmacy control number to identify and track this Controlled
"^DD",58.87,58.87,3,21,2,0)
Substances correction entry.
"^DD",58.87,58.87,3,"DT")
2920906
"^DD",58.87,58.87,4,0)
DRUG^*P50'^PSDRUG(^0;5^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,4,3)
Enter the name of the drug associated with this correction action.
"^DD",58.87,58.87,4,12)
Allows selection of ACTIVE drugs marked for Controlled Substances use.
"^DD",58.87,58.87,4,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)[""N"""
"^DD",58.87,58.87,4,21,0)
^^1^1^2920906^
"^DD",58.87,58.87,4,21,1,0)
A pointer to the drug associated with this correction action.
"^DD",58.87,58.87,4,"DT")
2920906
"^DD",58.87,58.87,5,0)
NAOU^*P58.8'^PSD(58.8,^0;6^S DIC("S")="I $P(^(0),""^"",2)=""N""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,5,3)
Enter the name of the NAOU associated with this correction action.
"^DD",58.87,58.87,5,12)
Allows selection of Narcotic locations only.
"^DD",58.87,58.87,5,12.1)
S DIC("S")="I $P(^(0),""^"",2)=""N"""
"^DD",58.87,58.87,5,21,0)
^^1^1^2920906^
"^DD",58.87,58.87,5,21,1,0)
A pointer to the NAOU associated with this correction action.
"^DD",58.87,58.87,5,"DT")
2920906
"^DD",58.87,58.87,6,0)
NURSE^*P200'^VA(200,^0;7^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,6,3)
Enter the name of the nurse associated with this correction action.
"^DD",58.87,58.87,6,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.87,58.87,6,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.87,58.87,6,21,0)
^^2^2^2920906^
"^DD",58.87,58.87,6,21,1,0)
A pointer to the name of the nurse who completed the Green Sheet
"^DD",58.87,58.87,6,21,2,0)
and marked it ready for pharmacy pickup.
"^DD",58.87,58.87,6,"DT")
2930527
"^DD",58.87,58.87,7,0)
PROBLEM DATE/TIME^D^^0;8^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.87,58.87,7,3)
Enter the date/time the problem was created.
"^DD",58.87,58.87,7,21,0)
^^1^1^2920906^
"^DD",58.87,58.87,7,21,1,0)
This field contains the date/time when the problem was created.
"^DD",58.87,58.87,7,"DT")
2920906
"^DD",58.87,58.87,8,0)
REQUEST #^NJ8,0^^0;9^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.87,58.87,8,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.87,58.87,8,21,0)
^^1^1^2920906^
"^DD",58.87,58.87,8,21,1,0)
The order request number associated with this correction action.
"^DD",58.87,58.87,8,"DT")
2920906
"^DD",58.87,58.87,9,0)
GS ENTERED BY PHARM^*P200'^VA(200,^0;10^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,9,3)
Enter the name of the pharmacist who entered the Green Sheet.
"^DD",58.87,58.87,9,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.87,58.87,9,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.87,58.87,9,21,0)
^^2^2^2930522^^
"^DD",58.87,58.87,9,21,1,0)
A pointer to the name of the pharmacist who entered/completed the Green
"^DD",58.87,58.87,9,21,2,0)
Sheet.
"^DD",58.87,58.87,9,"DT")
2930531
"^DD",58.87,58.87,10,0)
QUANTITY^NJ6,0^^0;11^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.87,58.87,10,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.87,58.87,10,21,0)
^^1^1^2920906^
"^DD",58.87,58.87,10,21,1,0)
The quantity of the drug associated with this correction action.
"^DD",58.87,58.87,10,"DT")
2920906
"^DD",58.87,58.87,11,0)
TYPE OF CORRECTION^S^1:GREEN SHEET READY FOR PICKUP;2:DELETE EXISTING GREEN SHEETS;3:ERROR FOUND ON COMPLETED GS;4:ERROR RESOLVED ON GREEN SHEET;^0;12^Q
"^DD",58.87,58.87,11,1,0)
^.1
"^DD",58.87,58.87,11,1,1,0)
58.87^AC1^MUMPS
"^DD",58.87,58.87,11,1,1,1)
D SAC1^PSDUTL2
"^DD",58.87,58.87,11,1,1,2)
D KAC1^PSDUTL2
"^DD",58.87,58.87,11,1,1,3)
DO NOT DELETE
"^DD",58.87,58.87,11,1,1,"%D",0)
^^3^3^2941003^^^
"^DD",58.87,58.87,11,1,1,"%D",1,0)
This cross-reference is used in compiling the "CS Correction Log Report".
"^DD",58.87,58.87,11,1,1,"%D",2,0)
  
"^DD",58.87,58.87,11,1,1,"%D",3,0)
The cross-reference is ^PSD(58.87,"AC",TYPE,DISP SITE,DATE,DA)=""
"^DD",58.87,58.87,11,1,1,"DT")
2920906
"^DD",58.87,58.87,11,3)
Enter the appropriate type of correction action.
"^DD",58.87,58.87,11,21,0)
^^1^1^2930522^^
"^DD",58.87,58.87,11,21,1,0)
The type of correction action associated with this entry.
"^DD",58.87,58.87,11,"DT")
2930522
"^DD",58.87,58.87,12,0)
PHARM DISPENSING SITE^*P58.8'^PSD(58.8,^0;13^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.87,58.87,12,1,0)
^.1
"^DD",58.87,58.87,12,1,1,0)
58.87^AC2^MUMPS
"^DD",58.87,58.87,12,1,1,1)
D SAC2^PSDUTL2
"^DD",58.87,58.87,12,1,1,2)
D KAC2^PSDUTL2
"^DD",58.87,58.87,12,1,1,3)
DO NOT DELETE
"^DD",58.87,58.87,12,1,1,"%D",0)
^^3^3^2941003^^^
"^DD",58.87,58.87,12,1,1,"%D",1,0)
This cross-reference is used in compiling the "CS Correction Log Report".
"^DD",58.87,58.87,12,1,1,"%D",2,0)
  
"^DD",58.87,58.87,12,1,1,"%D",3,0)
The cross-reference is ^PSD(58.87,"AC",TYPE,DISP SITE,DATE,DA)=""
"^DD",58.87,58.87,12,1,1,"DT")
2920906
"^DD",58.87,58.87,12,3)
Enter the dispensing vault associated with this correction action.
"^DD",58.87,58.87,12,12)
Selection limited to a Master vault or a Satellite vault.
"^DD",58.87,58.87,12,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.87,58.87,12,21,0)
^^2^2^2920906^
"^DD",58.87,58.87,12,21,1,0)
This field contains a pointer to the pharmacy dispensing site (vault)
"^DD",58.87,58.87,12,21,2,0)
associated with this correction action.
"^DD",58.87,58.87,12,"DT")
2920906
"^DD",58.87,58.87,13,0)
PREVIOUS COMPLETION STATUS^P58.83'^PSD(58.83,^0;14^Q
"^DD",58.87,58.87,13,3)
Enter the previous completion status for the order.
"^DD",58.87,58.87,13,21,0)
^^1^1^2931213^
"^DD",58.87,58.87,13,21,1,0)
The completion status prior to correction action being taken.
"^DD",58.87,58.87,13,"DT")
2930522
"^DD",58.87,58.87,14,0)
CURRENT COMPLETED STATUS^P58.83'^PSD(58.83,^0;15^Q
"^DD",58.87,58.87,14,3)
Enter the current completion status for this order.
"^DD",58.87,58.87,14,21,0)
^^1^1^2931213^
"^DD",58.87,58.87,14,21,1,0)
The completion status after this correction action has been performed.
"^DD",58.87,58.87,14,"DT")
2930522
"^DD",58.88,58.88,0)
FIELD^^1^2
"^DD",58.88,58.88,0,"DDA")
N
"^DD",58.88,58.88,0,"DT")
2930825
"^DD",58.88,58.88,0,"IX","B",58.88,.01)

"^DD",58.88,58.88,0,"NM","CS IRL PROGRAM")

"^DD",58.88,58.88,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.88,58.88,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",58.88,58.88,.01,1,0)
^.1
"^DD",58.88,58.88,.01,1,1,0)
58.88^B
"^DD",58.88,58.88,.01,1,1,1)
S ^PSD(58.88,"B",$E(X,1,30),DA)=""
"^DD",58.88,58.88,.01,1,1,2)
K ^PSD(58.88,"B",$E(X,1,30),DA)
"^DD",58.88,58.88,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",58.88,58.88,.01,21,0)
^^1^1^2931213^
"^DD",58.88,58.88,.01,21,1,0)
This field contains the name of this IRL program.
"^DD",58.88,58.88,.01,"DT")
2931019
"^DD",58.88,58.88,1,0)
IRL PROGRAM^58.881^^1;0
"^DD",58.88,58.88,1,21,0)
^^2^2^2941201^^
"^DD",58.88,58.88,1,21,1,0)
The IRL program for performing a part of the Controlled Substances perpetual
"^DD",58.88,58.88,1,21,2,0)
inventory functions.
"^DD",58.88,58.881,0)
IRL PROGRAM SUB-FIELD^^.01^1
"^DD",58.88,58.881,0,"DT")
2930825
"^DD",58.88,58.881,0,"NM","IRL PROGRAM")

"^DD",58.88,58.881,0,"UP")
58.88
"^DD",58.88,58.881,.01,0)
IRL PROGRAM^WL^^0;1^Q
"^DD",58.88,58.881,.01,21,0)
^^2^2^2941201^
"^DD",58.88,58.881,.01,21,1,0)
The IRL program for performing a part of the Controlled Substances
"^DD",58.88,58.881,.01,21,2,0)
perpetual inventory functions.
"^DD",58.88,58.881,.01,"DT")
2930825
"^DD",58.89,58.89,0)
FIELD^^6^7
"^DD",58.89,58.89,0,"DT")
2931107
"^DD",58.89,58.89,0,"ID",6)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSD(58.8,+$P(^(0),U,6),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(58.8,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.89,58.89,0,"IX","AC",58.89,1)

"^DD",58.89,58.89,0,"IX","AD",58.89,2)

"^DD",58.89,58.89,0,"IX","AD1",58.89,6)

"^DD",58.89,58.89,0,"IX","AE",58.89,4)

"^DD",58.89,58.89,0,"IX","AE1",58.89,6)

"^DD",58.89,58.89,0,"IX","B",58.89,.01)

"^DD",58.89,58.89,0,"NM","CS ERROR LOG")

"^DD",58.89,58.89,0,"VRPK")
CONTROLLED SUBSTANCES
"^DD",58.89,58.89,.01,0)
LOG NUMBER^RNJ9,0X^^0;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.89,58.89,.01,1,0)
^.1
"^DD",58.89,58.89,.01,1,1,0)
58.89^B
"^DD",58.89,58.89,.01,1,1,1)
S ^PSD(58.89,"B",$E(X,1,30),DA)=""
"^DD",58.89,58.89,.01,1,1,2)
K ^PSD(58.89,"B",$E(X,1,30),DA)
"^DD",58.89,58.89,.01,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",58.89,58.89,.01,21,0)
^^2^2^2931017^
"^DD",58.89,58.89,.01,21,1,0)
This field contains the internal entry number for this Controlled
"^DD",58.89,58.89,.01,21,2,0)
Substances error.
"^DD",58.89,58.89,.01,23,0)
^^1^1^2931017^
"^DD",58.89,58.89,.01,23,1,0)
DINUMed.
"^DD",58.89,58.89,.01,"DT")
2931107
"^DD",58.89,58.89,1,0)
TRANSACTION NUMBER^P58.81'^PSD(58.81,^0;2^Q
"^DD",58.89,58.89,1,1,0)
^.1
"^DD",58.89,58.89,1,1,1,0)
58.89^AC
"^DD",58.89,58.89,1,1,1,1)
S ^PSD(58.89,"AC",$E(X,1,30),DA)=""
"^DD",58.89,58.89,1,1,1,2)
K ^PSD(58.89,"AC",$E(X,1,30),DA)
"^DD",58.89,58.89,1,1,1,3)
DO NOT DELETE
"^DD",58.89,58.89,1,1,1,"DT")
2931018
"^DD",58.89,58.89,1,3)
Enter the transaction number generating this error.
"^DD",58.89,58.89,1,21,0)
^^2^2^2931017^
"^DD",58.89,58.89,1,21,1,0)
This field contains a pointer to the Controlled Substances transaction
"^DD",58.89,58.89,1,21,2,0)
generating this error.
"^DD",58.89,58.89,1,"DT")
2931018
"^DD",58.89,58.89,2,0)
DATE/TIME^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.89,58.89,2,1,0)
^.1
"^DD",58.89,58.89,2,1,1,0)
58.89^AD^MUMPS
"^DD",58.89,58.89,2,1,1,1)
D SAD^PSDUTL4
"^DD",58.89,58.89,2,1,1,2)
D KAD^PSDUTL4
"^DD",58.89,58.89,2,1,1,3)
DO NOT DELETE
"^DD",58.89,58.89,2,1,1,"%D",0)
^^3^3^2941003^^^
"^DD",58.89,58.89,2,1,1,"%D",1,0)
This cross-reference is used in compiling various CS error log reports.
"^DD",58.89,58.89,2,1,1,"%D",2,0)
 
"^DD",58.89,58.89,2,1,1,"%D",3,0)
The cross-reference is defined by: ^PSD(58.89,"AD",DATE/TIME,NAOU,DA)=""
"^DD",58.89,58.89,2,1,1,"DT")
2931107
"^DD",58.89,58.89,2,3)
Enter the date/time the error occurred.
"^DD",58.89,58.89,2,21,0)
^^2^2^2931017^
"^DD",58.89,58.89,2,21,1,0)
This field contains the date/time the Controlled Substances error
"^DD",58.89,58.89,2,21,2,0)
occurred.
"^DD",58.89,58.89,2,"DT")
2931107
"^DD",58.89,58.89,3,0)
CORRECTED BY^*P200'^VA(200,^0;4^S DIC("S")="I $D(^XUSEC(""PSD ERROR"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.89,58.89,3,3)
Enter the name of the supervisor correcting this error.
"^DD",58.89,58.89,3,12)
Access granted to pharmacy and nursing supervisors holding the appropriate key.
"^DD",58.89,58.89,3,12.1)
S DIC("S")="I $D(^XUSEC(""PSD ERROR"",+Y))"
"^DD",58.89,58.89,3,21,0)
^^2^2^2931017^
"^DD",58.89,58.89,3,21,1,0)
This field contains a pointer to the name of the pharmacy or nursing
"^DD",58.89,58.89,3,21,2,0)
supervisor correcting this error.
"^DD",58.89,58.89,3,"DT")
2931017
"^DD",58.89,58.89,4,0)
DATE/TIME CORRECTED^D^^0;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.89,58.89,4,1,0)
^.1
"^DD",58.89,58.89,4,1,1,0)
58.89^AE^MUMPS
"^DD",58.89,58.89,4,1,1,1)
D SAE^PSDUTL4
"^DD",58.89,58.89,4,1,1,2)
D KAE^PSDUTL4
"^DD",58.89,58.89,4,1,1,3)
DO NOT DELETE
"^DD",58.89,58.89,4,1,1,"%D",0)
^^5^5^2941003^^^
"^DD",58.89,58.89,4,1,1,"%D",1,0)
This cross-reference is used in compiling the CS resolved error log
"^DD",58.89,58.89,4,1,1,"%D",2,0)
report.
"^DD",58.89,58.89,4,1,1,"%D",3,0)
 
"^DD",58.89,58.89,4,1,1,"%D",4,0)
The cross-reference is defined by:
"^DD",58.89,58.89,4,1,1,"%D",5,0)
 ^PSD(58.89,"AE",DATE/TIME CORRECTED,CS LOCATION,DA)=""
"^DD",58.89,58.89,4,1,1,"DT")
2931107
"^DD",58.89,58.89,4,3)
Enter the date/time this error was corrected.
"^DD",58.89,58.89,4,21,0)
^^1^1^2931017^
"^DD",58.89,58.89,4,21,1,0)
The date/time this Controlled Substances error was corrected.
"^DD",58.89,58.89,4,"DT")
2931107
"^DD",58.89,58.89,5,0)
RESOLUTION^58.895^^1;0
"^DD",58.89,58.89,5,21,0)
^^1^1^2931017^
"^DD",58.89,58.89,5,21,1,0)
The final resolution for this Controlled Substances error.
"^DD",58.89,58.89,6,0)
CS LOCATION^*P58.8'^PSD(58.8,^0;6^S DIC("S")="I $P(^(0),""^"",2)'=""P""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.89,58.89,6,1,0)
^.1
"^DD",58.89,58.89,6,1,1,0)
58.89^AD1^MUMPS
"^DD",58.89,58.89,6,1,1,1)
D SAD1^PSDUTL4
"^DD",58.89,58.89,6,1,1,2)
D KAD1^PSDUTL4
"^DD",58.89,58.89,6,1,1,3)
DO NOT DELETE
"^DD",58.89,58.89,6,1,1,"%D",0)
^^3^3^2941003^^^^
"^DD",58.89,58.89,6,1,1,"%D",1,0)
This cross-reference is used in compiling various CS error log reports.
"^DD",58.89,58.89,6,1,1,"%D",2,0)
 
"^DD",58.89,58.89,6,1,1,"%D",3,0)
This cross-reference is defined by: ^PSD(58.89,"AD",DATE/TIME,NAOU,DA)=""
"^DD",58.89,58.89,6,1,1,"DT")
2931107
"^DD",58.89,58.89,6,1,2,0)
58.89^AE1^MUMPS
"^DD",58.89,58.89,6,1,2,1)
D SAE1^PSDUTL4
"^DD",58.89,58.89,6,1,2,2)
D KAE1^PSDUTL4
"^DD",58.89,58.89,6,1,2,3)
DO NOT DELETE
"^DD",58.89,58.89,6,1,2,"%D",0)
^^5^5^2941003^^^
"^DD",58.89,58.89,6,1,2,"%D",1,0)
This cross-reference is used in compiling the CS resolved error log
"^DD",58.89,58.89,6,1,2,"%D",2,0)
report.
"^DD",58.89,58.89,6,1,2,"%D",3,0)
 
"^DD",58.89,58.89,6,1,2,"%D",4,0)
This cross-reference is defined by:
"^DD",58.89,58.89,6,1,2,"%D",5,0)
 ^PSD(58.89,"AE",DATE/TIME CORRECTED,CS LOCATION,DA)=""
"^DD",58.89,58.89,6,1,2,"DT")
2931107
"^DD",58.89,58.89,6,3)
Enter the NAOU or dispensing site generating this error log entry.
"^DD",58.89,58.89,6,12)
Allows selection of CS locations.
"^DD",58.89,58.89,6,12.1)
S DIC("S")="I $P(^(0),""^"",2)'=""P"""
"^DD",58.89,58.89,6,21,0)
^^2^2^2940915^^
"^DD",58.89,58.89,6,21,1,0)
This field contains a pointer to the Controlled Substances location,
"^DD",58.89,58.89,6,21,2,0)
dispensing vault or NAOU, where this error occurred.
"^DD",58.89,58.89,6,"DT")
2931107
"^DD",58.89,58.895,0)
RESOLUTION SUB-FIELD^^.01^1
"^DD",58.89,58.895,0,"DT")
2931017
"^DD",58.89,58.895,0,"NM","RESOLUTION")

"^DD",58.89,58.895,0,"UP")
58.89
"^DD",58.89,58.895,.01,0)
RESOLUTION^W^^0;1^Q
"^DD",58.89,58.895,.01,3)
Enter the resolution for this Controlled Substances error.
"^DD",58.89,58.895,.01,21,0)
^^1^1^2931017^
"^DD",58.89,58.895,.01,21,1,0)
The final resolution for this Controlled Substances error.
"^DD",58.89,58.895,.01,"DT")
2931017
"^DD",59.4,59.4,31,0)
IS SITE SELECTABLE FOR CS?^S^1:YES;0:NO;^0;31^Q
"^DD",59.4,59.4,31,.1)
Is Site Selectable for CS?
"^DD",59.4,59.4,31,1,0)
^.1^^0
"^DD",59.4,59.4,31,3)
Enter 1 for "YES" or  0 for "NO"
"^DD",59.4,59.4,31,20,0)
^.3LA^1^1
"^DD",59.4,59.4,31,20,1,0)
PSD
"^DD",59.4,59.4,31,21,0)
^^5^5^2940915^^^^
"^DD",59.4,59.4,31,21,1,0)
Should this site name be shown for use by the Controlled Substances module
"^DD",59.4,59.4,31,21,2,0)
of the Pharmacy software?  If you answer "YES", the software will display
"^DD",59.4,59.4,31,21,3,0)
or allow you to pick this site name for Controlled Substances.  If you
"^DD",59.4,59.4,31,21,4,0)
answer "NO", the software will screen out the site name so that CS users
"^DD",59.4,59.4,31,21,5,0)
will not see or be able to select the site name while in the CS package.
"^DD",59.4,59.4,31,23,0)
^^1^1^2940915^^^^
"^DD",59.4,59.4,31,23,1,0)
Flag for use in the Controlled Substances package.
"^DD",59.4,59.4,31,"DT")
2920323
"^DD",59.7,59.7,71,0)
DATE V2 CS/DA CONVERSION^D^^70;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",59.7,59.7,71,3)
Enter date that the post-inits for Version 2.0 of Controlled Substances or Drug Accountability were completed.
"^DD",59.7,59.7,71,21,0)
^^2^2^2940915^^^
"^DD",59.7,59.7,71,21,1,0)
This field will contain the date that the post-inits were completed for
"^DD",59.7,59.7,71,21,2,0)
Version 2.0 of Controlled Substances or Drug Accountability.
"^DD",59.7,59.7,71,23,0)
^^4^4^2940915^^^
"^DD",59.7,59.7,71,23,1,0)
Version 2.0 of Controlled Substances and Drug Accountability will update
"^DD",59.7,59.7,71,23,2,0)
the DRUG ACCOUNTABILITY STATS (#58.8) file with a new multiple pointer
"^DD",59.7,59.7,71,23,3,0)
to the GENERIC INVENTORY file (#445) and change the format of the MONTHLY
"^DD",59.7,59.7,71,23,4,0)
ACTIVITY multiple from five (5) digits to seven (7) digits.
"^DD",59.7,59.7,71,"DT")
2930301
"^DIC",58.8,58.8,0)
DRUG ACCOUNTABILITY STATS^58.8I
"^DIC",58.8,58.8,0,"GL")
^PSD(58.8,
"^DIC",58.8,58.8,"%D",0)
^^10^10^2970204^^^^
"^DIC",58.8,58.8,"%D",1,0)
This file contains data associated with the Pharmacy Drug Accountability
"^DIC",58.8,58.8,"%D",2,0)
Stats location.  Entries in this file may be edited but not deleted.
"^DIC",58.8,58.8,"%D",3,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.8,58.8,"%D",4,0)
  
"^DIC",58.8,58.8,"%D",5,0)
This file is designed to be shared between the Drug Accountability module
"^DIC",58.8,58.8,"%D",6,0)
and the Controlled Substances module of the Pharmacy software.
"^DIC",58.8,58.8,"%D",7,0)
The Controlled Substances module will recognize a location as a Narcotic
"^DIC",58.8,58.8,"%D",8,0)
Area of Use (NAOU). The menu option INACTIVATE NAOU is used to inactivate
"^DIC",58.8,58.8,"%D",9,0)
NAOUs no longer in use.  The menu option INACTIVATE NAOU STOCK DRUGS
"^DIC",58.8,58.8,"%D",10,0)
is used to inactivate drugs no longer stocked within that NAOU.
"^DIC",58.8,58.8,"%D",11,0)

"^DIC",58.8,"B","DRUG ACCOUNTABILITY STATS",58.8)

"^DIC",58.81,58.81,0)
DRUG ACCOUNTABILITY TRANSACTION^58.81
"^DIC",58.81,58.81,0,"GL")
^PSD(58.81,
"^DIC",58.81,58.81,"%D",0)
^^9^9^2931019^^^^
"^DIC",58.81,58.81,"%D",1,0)
This file contains the data associated with drug accountability
"^DIC",58.81,58.81,"%D",2,0)
transactions.  This file is designed to be shared between the
"^DIC",58.81,58.81,"%D",3,0)
Drug Accountability module and the Controlled Substances module.
"^DIC",58.81,58.81,"%D",4,0)
   
"^DIC",58.81,58.81,"%D",5,0)
Entries in this file should NOT be edited directly for Controlled
"^DIC",58.81,58.81,"%D",6,0)
Substances use.  The CS module contains all appropriate checks for this
"^DIC",58.81,58.81,"%D",7,0)
file's use.
"^DIC",58.81,58.81,"%D",8,0)
  
"^DIC",58.81,58.81,"%D",9,0)
Controlled Substances entries will be flagged.
"^DIC",58.81,"B","DRUG ACCOUNTABILITY TRANSACTION",58.81)

"^DIC",58.82,58.82,0)
CS ORDER STATUS
"^DIC",58.82,58.82,0,"GL")
^PSD(58.82,
"^DIC",58.82,58.82,"%D",0)
^^4^4^2941121^^^^
"^DIC",58.82,58.82,"%D",1,0)
This file contains the order status of the Controlled Substances requests.
"^DIC",58.82,58.82,"%D",2,0)
 
"^DIC",58.82,58.82,"%D",3,0)
This is a standard file exported with the Controlled Substances module
"^DIC",58.82,58.82,"%D",4,0)
and additional entries should not be added. Existing data will be merged.
"^DIC",58.82,"B","CS ORDER STATUS",58.82)

"^DIC",58.83,58.83,0)
CS COMPLETION STATUS
"^DIC",58.83,58.83,0,"GL")
^PSD(58.83,
"^DIC",58.83,58.83,"%D",0)
^^5^5^2941121^^^^
"^DIC",58.83,58.83,"%D",1,0)
This file contains the completion status of the Controlled Substances
"^DIC",58.83,58.83,"%D",2,0)
orders.
"^DIC",58.83,58.83,"%D",3,0)
 
"^DIC",58.83,58.83,"%D",4,0)
This is a standard file exported with the Controlled Substances module
"^DIC",58.83,58.83,"%D",5,0)
and additional entries should not be added. Existing data will be merged.
"^DIC",58.83,"B","CS COMPLETION STATUS",58.83)

"^DIC",58.84,58.84,0)
DRUG ACCOUNTABILITY TRANSACTION TYPE^58.84
"^DIC",58.84,58.84,0,"GL")
^PSD(58.84,
"^DIC",58.84,58.84,"%D",0)
5^^9^9^2941121^^^^
"^DIC",58.84,58.84,"%D",1,0)
This file contains the standard types of transactions utilized in
"^DIC",58.84,58.84,"%D",2,0)
pharmacy drug accountability.
"^DIC",58.84,58.84,"%D",3,0)
 
"^DIC",58.84,58.84,"%D",4,0)
This file is shared between the Drug Accountability module and the
"^DIC",58.84,58.84,"%D",5,0)
Controlled Substances module.
"^DIC",58.84,58.84,"%D",6,0)
 
"^DIC",58.84,58.84,"%D",7,0)
This is a standard file exported by both the Controlled Substances and
"^DIC",58.84,58.84,"%D",8,0)
Drug Accountability modules and additional entries should not be added.
"^DIC",58.84,58.84,"%D",9,0)
Existing data will be merged.
"^DIC",58.84,"B","DRUG ACCOUNTABILITY TRANSACTION TYPE",58.84)

"^DIC",58.85,58.85,0)
CS WORKSHEET^58.85
"^DIC",58.85,58.85,0,"GL")
^PSD(58.85,
"^DIC",58.85,58.85,"%D",0)
^^8^8^2931019^^^^
"^DIC",58.85,58.85,"%D",1,0)
This file contains the data associated with the Controlled Substances
"^DIC",58.85,58.85,"%D",2,0)
order requests.  Pharmacy dispenses these orders based on data
"^DIC",58.85,58.85,"%D",3,0)
contained on the worksheet printed from this file.  This file is
"^DIC",58.85,58.85,"%D",4,0)
purged when orders are delivered to an NAOU or when cancelled.
"^DIC",58.85,58.85,"%D",5,0)
  
"^DIC",58.85,58.85,"%D",6,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.85,58.85,"%D",7,0)
The Controlled Substances module contains the appropriate data
"^DIC",58.85,58.85,"%D",8,0)
checks.
"^DIC",58.85,"B","CS WORKSHEET",58.85)

"^DIC",58.86,58.86,0)
CS DESTRUCTION^58.86
"^DIC",58.86,58.86,0,"GL")
^PSD(58.86,
"^DIC",58.86,58.86,"%D",0)
^^6^6^2931019^^^^
"^DIC",58.86,58.86,"%D",1,0)
This file contains the data for all Controlled Substances drugs destroyed.
"^DIC",58.86,58.86,"%D",2,0)
The entries are listed pending destruction until pharmacy destroys
"^DIC",58.86,58.86,"%D",3,0)
the drug and updates this file.
"^DIC",58.86,58.86,"%D",4,0)
  
"^DIC",58.86,58.86,"%D",5,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.86,58.86,"%D",6,0)
The Controlled Substances module contains all necessary data checks.
"^DIC",58.86,"B","CS DESTRUCTION",58.86)

"^DIC",58.87,58.87,0)
CS CORRECTION LOG^58.87
"^DIC",58.87,58.87,0,"GL")
^PSD(58.87,
"^DIC",58.87,58.87,"%D",0)
^^4^4^2931019^^^^
"^DIC",58.87,58.87,"%D",1,0)
This file contains data associated with corrective actions on the
"^DIC",58.87,58.87,"%D",2,0)
Controlled Substances orders.
"^DIC",58.87,58.87,"%D",3,0)
 
"^DIC",58.87,58.87,"%D",4,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.87,"B","CS CORRECTION LOG",58.87)

"^DIC",58.88,58.88,0)
CS IRL PROGRAM^58.88
"^DIC",58.88,58.88,0,"GL")
^PSD(58.88,
"^DIC",58.88,58.88,"%D",0)
^^8^8^2941027^^^^
"^DIC",58.88,58.88,"%D",1,0)
This file contains the Interactive Reader Language (IRL) Program utilized
"^DIC",58.88,58.88,"%D",2,0)
by the barcode TRAKKER when performing Controlled Substances perpetual
"^DIC",58.88,58.88,"%D",3,0)
inventories.
"^DIC",58.88,58.88,"%D",4,0)
 
"^DIC",58.88,58.88,"%D",5,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.88,58.88,"%D",6,0)
 
"^DIC",58.88,58.88,"%D",7,0)
This is a standard file exported with the Controlled Substances
"^DIC",58.88,58.88,"%D",8,0)
module and additional entries should not be added.
"^DIC",58.88,"B","CS IRL PROGRAM",58.88)

"^DIC",58.89,58.89,0)
CS ERROR LOG
"^DIC",58.89,58.89,0,"GL")
^PSD(58.89,
"^DIC",58.89,58.89,"%D",0)
^^7^7^2940915^^^^
"^DIC",58.89,58.89,"%D",1,0)
This file contains the errors generated using the barcode TRAKKER
"^DIC",58.89,58.89,"%D",2,0)
options in Controlled Substances.
"^DIC",58.89,58.89,"%D",3,0)
 
"^DIC",58.89,58.89,"%D",4,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.89,58.89,"%D",5,0)
 
"^DIC",58.89,58.89,"%D",6,0)
This file may expand to include other types of errors tracked within the
"^DIC",58.89,58.89,"%D",7,0)
Controlled Substances module with future releases.
"^DIC",58.89,"B","CS ERROR LOG",58.89)

**END**
**END**
