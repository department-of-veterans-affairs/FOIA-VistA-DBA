Released XU*8*191 SEQ #218
Extracted from mail message
**KIDS**:XU*8.0*191^

**INSTALL NAME**
XU*8.0*191
"BLD",417,0)
XU*8.0*191^KERNEL^0^3020911^y
"BLD",417,1,0)
^^1^1^3020718^^
"BLD",417,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"BLD",417,4,0)
^9.64PA^^
"BLD",417,"INIT")

"BLD",417,"KRN",0)
^9.67PA^8994.2^18
"BLD",417,"KRN",.4,0)
.4
"BLD",417,"KRN",.401,0)
.401
"BLD",417,"KRN",.402,0)
.402
"BLD",417,"KRN",.403,0)
.403
"BLD",417,"KRN",.5,0)
.5
"BLD",417,"KRN",.84,0)
.84
"BLD",417,"KRN",3.6,0)
3.6
"BLD",417,"KRN",3.8,0)
3.8
"BLD",417,"KRN",9.2,0)
9.2
"BLD",417,"KRN",9.8,0)
9.8
"BLD",417,"KRN",9.8,"NM",0)
^9.68A^13^7
"BLD",417,"KRN",9.8,"NM",6,0)
ZISHONT^^0^B32320415
"BLD",417,"KRN",9.8,"NM",7,0)
ZIS4ONT^^0^B24250504
"BLD",417,"KRN",9.8,"NM",8,0)
ZTMGRSET^^0^B33082572
"BLD",417,"KRN",9.8,"NM",10,0)
ZIS^^0^B16647233
"BLD",417,"KRN",9.8,"NM",11,0)
ZIS4VXD^^0^B17769864
"BLD",417,"KRN",9.8,"NM",12,0)
ZISHVXD^^0^B41278848
"BLD",417,"KRN",9.8,"NM",13,0)
ZISFONT^^0^B8486412
"BLD",417,"KRN",9.8,"NM","B","ZIS",10)

"BLD",417,"KRN",9.8,"NM","B","ZIS4ONT",7)

"BLD",417,"KRN",9.8,"NM","B","ZIS4VXD",11)

"BLD",417,"KRN",9.8,"NM","B","ZISFONT",13)

"BLD",417,"KRN",9.8,"NM","B","ZISHONT",6)

"BLD",417,"KRN",9.8,"NM","B","ZISHVXD",12)

"BLD",417,"KRN",9.8,"NM","B","ZTMGRSET",8)

"BLD",417,"KRN",19,0)
19
"BLD",417,"KRN",19,"NM",0)
^9.68A^^
"BLD",417,"KRN",19.1,0)
19.1
"BLD",417,"KRN",101,0)
101
"BLD",417,"KRN",409.61,0)
409.61
"BLD",417,"KRN",771,0)
771
"BLD",417,"KRN",870,0)
870
"BLD",417,"KRN",8994,0)
8994
"BLD",417,"KRN",8994.2,0)
8994.2
"BLD",417,"KRN","B",.4,.4)

"BLD",417,"KRN","B",.401,.401)

"BLD",417,"KRN","B",.402,.402)

"BLD",417,"KRN","B",.403,.403)

"BLD",417,"KRN","B",.5,.5)

"BLD",417,"KRN","B",.84,.84)

"BLD",417,"KRN","B",3.6,3.6)

"BLD",417,"KRN","B",3.8,3.8)

"BLD",417,"KRN","B",9.2,9.2)

"BLD",417,"KRN","B",9.8,9.8)

"BLD",417,"KRN","B",19,19)

"BLD",417,"KRN","B",19.1,19.1)

"BLD",417,"KRN","B",101,101)

"BLD",417,"KRN","B",409.61,409.61)

"BLD",417,"KRN","B",771,771)

"BLD",417,"KRN","B",870,870)

"BLD",417,"KRN","B",8994,8994)

"BLD",417,"KRN","B",8994.2,8994.2)

"BLD",417,"QUES",0)
^9.62^^
"BLD",417,"REQB",0)
^9.611^4^3
"BLD",417,"REQB",1,0)
XU*8.0*104^2
"BLD",417,"REQB",3,0)
XU*8.0*199^2
"BLD",417,"REQB",4,0)
XU*8.0*136^2
"BLD",417,"REQB","B","XU*8.0*104",1)

"BLD",417,"REQB","B","XU*8.0*136",4)

"BLD",417,"REQB","B","XU*8.0*199",3)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
191^3020911
"PKG",3,22,1,"PAH",1,1,0)
^^1^1^3020911
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","ZIS")
0^10^B16647233
"RTN","ZIS",1,0)
%ZIS ;SFISC/AC,RWF -- DEVICE HANDLER ;07/18/2002  07:53
"RTN","ZIS",2,0)
 ;;8.0;KERNEL;**18,23,69,112,199,191**;JUL 10, 1995
"RTN","ZIS",3,0)
 N %ZISOS,%ZISV
"RTN","ZIS",4,0)
 S U="^",%ZISOS=$G(^%ZOSF("OS")),%ZISV=$G(^%ZOSF("VOL"))
"RTN","ZIS",5,0)
 ;Check SPOOLER special case first
"RTN","ZIS",6,0)
INIT I $D(ZTQUEUED),$G(IOT)="SPL",$D(IO)#2,$D(IO(0))#2,IO]"",IO=IO(0),$D(IO(1,IO))#2,%ZISOS["VAX DSM"!(%ZISOS["M/VX"),$G(IOP)[ION!(IOP[IO) K %ZIS,%IS,IOP Q
"RTN","ZIS",7,0)
 ;
"RTN","ZIS",8,0)
 I '$D(%ZIS),$D(%IS) M %ZIS=%IS
"RTN","ZIS",9,0)
 S:$D(%ZIS)[0 %ZIS="M" M %IS=%ZIS ;update %IS for now
"RTN","ZIS",10,0)
 ;
"RTN","ZIS",11,0)
 I $D(ZTQUEUED) D  I '$D(IOP) S POP=1 G EXIT^%ZIS1
"RTN","ZIS",12,0)
 .I $D(ZTIO)#2,ZTIO="" S:%IS'[0 %IS=%IS_"0",%ZIS=%ZIS_"0"
"RTN","ZIS",13,0)
 I '$D(ZTQUEUED),%IS["T",$P($G(IOP),";")="Q" S POP=1 G EXIT^%ZIS1
"RTN","ZIS",14,0)
 N %,%A,%E,%H,%I,%X,%Y,%Z,%Z1,%Z9,%Z90,%Z91,%Z95,%ZISB,%ZTIME,%ZTYPE,%ZISOLD,DTOUT,DUOUT
"RTN","ZIS",15,0)
 ;Save symbols to restore if don't open a device
"RTN","ZIS",16,0)
 D SYMBOL^%ZISUTL(0,$NA(%ZISOLD))
"RTN","ZIS",17,0)
 K IO("CLOSE"),IO("HFSIO"),IO("T")
"RTN","ZIS",18,0)
A K IO("P"),IO("Q"),IO("S"),IO("DOC"),IO("HFSIO")
"RTN","ZIS",19,0)
K2 D K2^%ZIS1
"RTN","ZIS",20,0)
 S %ZISB=%ZIS'["N",(%E,%H,POP)=0,%Y="" S:'$D(IO(0)) IO(0)=$I
"RTN","ZIS",21,0)
 I %ZISOS["VAX DSM",$I["SYS$INPUT:.;" S:%ZIS'[0 %IS=%IS_"0",%ZIS=%ZIS_"0"
"RTN","ZIS",22,0)
 ;I %IS["T"&(%IS["0") S (%H,%E)=0 G ^%ZIS1
"RTN","ZIS",23,0)
 I $D(IOP),IOP=$I!(IOP="HOME")!(0[IOP),$D(^XUTL("XQ",$J,"IO")) D HOME K %IS,%Y,%ZIS,%ZISB,%ZISV,IOP Q
"RTN","ZIS",24,0)
 ;Don't worry about HOME if %ZIS[0
"RTN","ZIS",25,0)
 D:%ZIS'[0 GETHOME G EXIT^%ZIS1:POP,^%ZIS1 ;Jump to next part
"RTN","ZIS",26,0)
 ;
"RTN","ZIS",27,0)
GETHOME I $D(IO("HOME")),$P(IO("HOME"),"^",2)=IO(0) S (%E,%H)=+IO("HOME") Q
"RTN","ZIS",28,0)
 I $D(^XUTL("XQ",$J,"IOS")),$D(^("IO")),IO(0)=^("IO") S (%E,%H)=^("IOS") Q
"RTN","ZIS",29,0)
 ;CALL LINEPORT CODE HERE---
"RTN","ZIS",30,0)
 S %=$$LINEPORT^%ZISUTL I % S (%E,%H)=% Q
"RTN","ZIS",31,0)
 S %ZISVT=$I D VTLKUP I '%E S %ZISVT=$I D VIRTUAL
"RTN","ZIS",32,0)
 I %ZISVT=""!(%E'>0) I %IS'[0 O IO(0)::0 I $T U IO(0) W !,"HOME DEVICE DOES NOT EXIST IN THE DEVICE FILE",!,"PLEASE CONTACT YOUR SYSTEM MANAGER!",*7
"RTN","ZIS",33,0)
 S %H=%E S:'%H&(%IS'[0) POP=1 S:(%H>0)&('$D(IO("HOME"))) IO("HOME")=%H_"^"_$I
"RTN","ZIS",34,0)
 Q
"RTN","ZIS",35,0)
VIRTUAL ;See if a Virtual Terminal (LAT, TELNET)
"RTN","ZIS",36,0)
 ;Change the MSM check for telnet to work with v4.4
"RTN","ZIS",37,0)
 I %ZISOS["MSM" X "I $P($ZV,""Version "",2)'<3 S %ZISVT=$ZDE(+%ZISVT) I %ZISVT?.E1""~""4.5N.E S %ZISVT=""TELNET"""
"RTN","ZIS",38,0)
 F %ZISI=$L(%ZISVT):-1 D:$D(^%ZIS(1,"C",%ZISVT))  Q:$S('%E:0,'$D(^%ZIS(1,%E,"TYPE")):0,^("TYPE")="VTRM":1,1:0)  S %ZISVT=$E(%ZISVT,1,%ZISI) Q:%ZISVT=""
"RTN","ZIS",39,0)
 .D VTLKUP Q:$S('%E:0,'$D(^%ZIS(1,%E,"TYPE")):0,^("TYPE")="VTRM":1,1:0)
"RTN","ZIS",40,0)
 .S %X=0 F %ZISX=%ZISV,"" Q:%X>0  S %X=0 F  S %E=+$O(^%ZIS(1,"CPU",%ZISX_"."_%ZISVT,%X)) S %X=%E Q:%E'>0  I $G(^%ZIS(1,+%E,"TYPE"))="VTRM" Q
"RTN","ZIS",41,0)
 Q
"RTN","ZIS",42,0)
VTLKUP F %ZISX=%ZISV,"" S %E=+$O(^%ZIS(1,"G","SYS."_%ZISX_"."_%ZISVT,0)) Q:%E  S %E=+$O(^%ZIS(1,"CPU",%ZISX_"."_%ZISVT,0)) Q:%E
"RTN","ZIS",43,0)
 Q
"RTN","ZIS",44,0)
 ;
"RTN","ZIS",45,0)
CURRENT N POP,%ZIS,%IS,%E,%H
"RTN","ZIS",46,0)
 S FF="#",SL=24,BS="*8",RM=80,(SUB,XY)="",%IS=0,%ZISOS=$G(^%ZOSF("OS")),%ZISV=$G(^("VOL")),POP=0
"RTN","ZIS",47,0)
 D GETHOME K %E,%IS,%ZISI,%ZISOS,%ZISV,%ZISVT,%ZISX Q:POP
"RTN","ZIS",48,0)
 I $D(^%ZIS(1,%H,"SUBTYPE")) S SUB=+^("SUBTYPE") K %H
"RTN","ZIS",49,0)
 I $D(SUB),SUB,$D(^%ZIS(2,SUB,1)) S SUB=$S($D(^(0)):$P(^(0),"^"),1:""),FF=$P(^(1),"^",2),SL=$P(^(1),"^",3),BS=$P(^(1),"^",4),XY=$P(^(1),"^",5),RM=+^(1)
"RTN","ZIS",50,0)
 E  S SUB=""
"RTN","ZIS",51,0)
 I $D(^%ZOSF("RM")) N X S X=RM X ^("RM") K %A
"RTN","ZIS",52,0)
 Q
"RTN","ZIS",53,0)
HOME ;Entry point to establish IO* variables for home device.
"RTN","ZIS",54,0)
 N X I '$D(^XUTL("XQ",$J,"IO")) S IOP="HOME" D ^%ZIS Q
"RTN","ZIS",55,0)
 D RESETVAR
"RTN","ZIS",56,0)
 I '$D(IO("C")),$D(IOM),IO=$I,$D(IO(1,IO)),$D(^%ZOSF("RM")) S X=+IOM X ^("RM") Q
"RTN","ZIS",57,0)
 Q
"RTN","ZIS",58,0)
RESETVAR ;Reset home IO* variables.
"RTN","ZIS",59,0)
 I '$D(^XUTL("XQ",$J,"IO")) Q
"RTN","ZIS",60,0)
 N % F %="IO","IOBS","IOF","IOM","ION","IOS","IOSL","IOST","IOST(0)","IOT","IOXY" I $D(^XUTL("XQ",$J,%))#2 S @%=^(%)
"RTN","ZIS",61,0)
 S POP=0,IO(0)=IO,(IOPAR,IOUPAR)=""
"RTN","ZIS",62,0)
 Q
"RTN","ZIS",63,0)
SAVEVAR ;Save home IO* variables, called from XUS1
"RTN","ZIS",64,0)
 N % F %="IO","IOBS","IOF","IOM","ION","IOS","IOSL","IOST","IOST(0)","IOT","IOXY" I $D(@%) S ^XUTL("XQ",$J,%)=@%
"RTN","ZIS",65,0)
 Q
"RTN","ZIS",66,0)
ZISLPC Q  ;No longer called in Kernel v8.
"RTN","ZIS",67,0)
 ;
"RTN","ZIS",68,0)
HLP1 G EN1^%ZIS7
"RTN","ZIS",69,0)
HLP2 N %E,%H,%X,%ZISV,X S %ZISV=$S($D(^%ZOSF("VOL")):^("VOL"),1:"") G EN2^%ZIS7
"RTN","ZIS",70,0)
 ;
"RTN","ZIS",71,0)
REWIND(IO2,IOT,IOPAR) ;Rewind Device
"RTN","ZIS",72,0)
 N %,X,Y,$ES,$ET S $ET="D REWERR^%ZIS Q 0"
"RTN","ZIS",73,0)
 S %=$I
"RTN","ZIS",74,0)
 I '($D(IO2)#2)!'$D(IOT)!'$D(IOPAR) Q 0
"RTN","ZIS",75,0)
 I "MT^SDP^HFS"'[IOT Q 0
"RTN","ZIS",76,0)
 S @("Y=$$REW"_IOT_"^%ZIS4(IO2,IOPAR)")
"RTN","ZIS",77,0)
 U %
"RTN","ZIS",78,0)
 Q Y
"RTN","ZIS",79,0)
REWERR ;Error encountered
"RTN","ZIS",80,0)
 S IO("ERROR")=$EC
"RTN","ZIS",81,0)
 S $EC="",$ET="Q:$ES>1  S $EC="""" Q 0" S $EC=",U1,"
"RTN","ZIS",82,0)
 Q 0
"RTN","ZIS",83,0)
 ;
"RTN","ZIS4ONT")
0^7^B24250504
"RTN","ZIS4ONT",1,0)
%ZIS4 ;SFISC/RWF,AC - DEVICE HANDLER SPOOL SPECIFIC CODE (OpenM/WNT) ;06/24/2002  12:17
"RTN","ZIS4ONT",2,0)
 ;;8.0;KERNEL;**34,59,69,191**;Jul 10, 1995
"RTN","ZIS4ONT",3,0)
 ;
"RTN","ZIS4ONT",4,0)
OPEN G OPN2:$D(IO(1,IO))
"RTN","ZIS4ONT",5,0)
 S POP=0 D OP1 G NOPEN:'$D(IO(1,IO))
"RTN","ZIS4ONT",6,0)
OPN2 I $D(%ZISHP),'$D(IOP) W !,*7," Routing to device "_$P(^%ZIS(1,%E,0),"^",1)_$S($D(^(1)):" "_$P(^(1),"^",1)_" ",1:"")
"RTN","ZIS4ONT",7,0)
 Q
"RTN","ZIS4ONT",8,0)
NOPEN I %IS'["D",$D(%ZISHP)!(%ZISHG]"") S POP=1 Q
"RTN","ZIS4ONT",9,0)
 I '$D(IOP) W *7,"  [BUSY]" W "  ...  RETRY" S %=2,U="^" D YN^%ZIS1 G OPEN:%=1
"RTN","ZIS4ONT",10,0)
 K:%E'=%H ^XUTL("ZISPARAM",IO)
"RTN","ZIS4ONT",11,0)
 S POP=1 Q
"RTN","ZIS4ONT",12,0)
 Q
"RTN","ZIS4ONT",13,0)
OP1 N X S X="OPNERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4ONT",14,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4ONT",15,0)
 O IO::%ZISTO S:$T IO(1,IO)="" S:'$T POP=1 L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4ONT",16,0)
 Q
"RTN","ZIS4ONT",17,0)
OPNERR S POP=1,IO("LASTERR")=$G(IO("ERROR")),IO("ERROR")=$ZE,$EC="" Q
"RTN","ZIS4ONT",18,0)
 ;
"RTN","ZIS4ONT",19,0)
O N X D:%IS["L" ZIO
"RTN","ZIS4ONT",20,0)
 I $D(IO("S")),$D(^%ZIS(2,IO("S"),10)),^(10)]"" U IO(0) D X10^ZISX ;Open Printer port
"RTN","ZIS4ONT",21,0)
OPAR I $D(IOP),%ZTYPE="HFS",$D(%IS("HFSIO")),$D(%IS("IOPAR")),%IS("HFSIO")]"" S IO=%IS("HFSIO"),%ZISOPAR=%IS("IOPAR")
"RTN","ZIS4ONT",22,0)
 S %A=$S(%ZISOPAR]"":%ZISOPAR,%ZTYPE'["TRM":"",%ZISIOST?1"C".E:"("_+%Z91_":""C"")",%ZISIOST?1"PK".E:"("_+%Z91_":""P"")",1:+%Z91)
"RTN","ZIS4ONT",23,0)
 S %A=%A_$S(%A["):":"",%ZTYPE["OTH"&($P(%ZTIME,"^",3)="n"):"",1:":"_%ZISTO),%A=""""_IO_""""_$E(":",%A]"")_%A
"RTN","ZIS4ONT",24,0)
 D O1 I POP W:'$D(IOP) !,?5,*7,"[Device is BUSY]" Q
"RTN","ZIS4ONT",25,0)
 ;I %ZTYPE="HFS" U IO S X=IO,IO=IO_";"_$P($ZIO,";",2),IO(1,IO)="" K IO(1,X)
"RTN","ZIS4ONT",26,0)
 U IO S $X=0,$Y=0
"RTN","ZIS4ONT",27,0)
 I %ZISUPAR]"" S %A1=""""_IO_""":"_%ZISUPAR U @%A1
"RTN","ZIS4ONT",28,0)
 ;U:%IS'[0 IO(0)
"RTN","ZIS4ONT",29,0)
 G OXECUTE^%ZIS6
"RTN","ZIS4ONT",30,0)
 ;
"RTN","ZIS4ONT",31,0)
O1 N X S X="OPNERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4ONT",32,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4ONT",33,0)
 O @%A S:'$T&(%A?.E1":".N) POP=1 S:'POP IO(1,IO)=""
"RTN","ZIS4ONT",34,0)
 L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4ONT",35,0)
 S IO("ERROR")=""
"RTN","ZIS4ONT",36,0)
 Q
"RTN","ZIS4ONT",37,0)
ZIO N % S %=$ZIO,IO("ZIO")=$I
"RTN","ZIS4ONT",38,0)
 I '$D(IO("IP")) D
"RTN","ZIS4ONT",39,0)
 . S:($E($I,2,4)="TNT")&($P(%,"/")?1.3N1"."1.3N1"."1.3N1"."1.3N) IO("IP")=$P(%,"/")
"RTN","ZIS4ONT",40,0)
 . S:($E($I,1,3)="TNA")&($P(%,"/")?1.3N1"."1.3N1"."1.3N1"."1.3N) IO("IP")=$P(%,"/")
"RTN","ZIS4ONT",41,0)
 Q
"RTN","ZIS4ONT",42,0)
 ;
"RTN","ZIS4ONT",43,0)
SPOOL ;%ZDA=pointer to ^XMB(3.51, %ZFN=spool file num.
"RTN","ZIS4ONT",44,0)
 N %ZOS S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",45,0)
 I '$D(^XMB(3.51,0)) W:'$D(IOP) !?5,"The spooler files are not setup in this account." G N
"RTN","ZIS4ONT",46,0)
 I $D(ZISDA) W:'$D(IOP) !?5,*7,"You may not Spool the printing of a Spool document" G N
"RTN","ZIS4ONT",47,0)
 I $D(DUZ)[0 W:'$D(IOP) !,"Must be a valid user." G N
"RTN","ZIS4ONT",48,0)
R S %ZY=-1 D NEWDOC^ZISPL1:$D(DUZ)=11 G N:%ZY'>0 S %ZDA=+%ZY,%ZFN=$P(%ZY(0),U,2),IO("DOC")=$P(%ZY(0),U,1) G OK:$D(IO("Q"))
"RTN","ZIS4ONT",49,0)
 G:'%ZISB OK I '$P(%ZY,"^",3),%ZFN]"" D SPL3 G N:%ZFN<0,DOC
"RTN","ZIS4ONT",50,0)
 I %ZOS="NT" D  G:%ZFN>255 N
"RTN","ZIS4ONT",51,0)
 . F %ZFN=1:1:260 I '$D(^XMB(3.51,"C",%ZFN))!$D(^(%ZFN,%ZDA)) Q:%ZFN<256  W:'$D(IOP) *7,"  DELETE SOME OTHER DOCUMENT!" G N
"RTN","ZIS4ONT",52,0)
 . Q:%ZFN>255  D SPL2 S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)=""
"RTN","ZIS4ONT",53,0)
 I %ZOS="VMS" D  G:%ZFN']"" N
"RTN","ZIS4ONT",54,0)
 . S %ZFN=IO_"SPOOL_no_"_%ZDA_".TMP" D SPL2 Q:%ZFN']"" N S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)="",IO=%ZFN
"RTN","ZIS4ONT",55,0)
DOC S IO("SPOOL")=%ZDA,^XUTL("XQ",$J,"SPOOL")=%ZDA
"RTN","ZIS4ONT",56,0)
 I $D(^%ZIS(1,%ZISIOS,1)),$P(^(1),"^",8),$O(^("SPL",0)) S ^XUTL("XQ",$J,"ADSPL")=%ZISIOS,ZISPLAD=%ZISIOS
"RTN","ZIS4ONT",57,0)
OK K %ZDA,%ZFN Q
"RTN","ZIS4ONT",58,0)
N K %ZDA,%ZFN,IO("DOC") S POP=1 Q
"RTN","ZIS4ONT",59,0)
 ;
"RTN","ZIS4ONT",60,0)
SPL2 I %ZOS="NT" O IO:(%ZFN:0) S IO(1,IO)="",^SPOOL(0,IO("DOC"),%ZFN)="",^SPOOL(%ZFN,0)=IO("DOC")_"{"_$H Q
"RTN","ZIS4ONT",61,0)
 O %ZFN:("WNS") G:$ZA<0 SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",62,0)
 ;
"RTN","ZIS4ONT",63,0)
SPL3 I %ZOS="NT" G SPL4:'$D(^SPOOL(%ZFN,2147483647)) O IO:(%ZFN:$P(^(2147483647),"{",3)):1 S:'$T ZISPLQ=1 K ^(2147483647) S IO(1,IO)="" Q
"RTN","ZIS4ONT",64,0)
 N $ETRAP S $ETRAP="S $EC="""" G SPL4^%ZIS4"
"RTN","ZIS4ONT",65,0)
 O %ZFN:"RV":1 S:'$T ZISPLQ=1 G:$ZA<0!('$T) SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",66,0)
 ;
"RTN","ZIS4ONT",67,0)
SPL4 W:'$D(IOP) !,"Spool file already open" S %ZFN=-1 Q
"RTN","ZIS4ONT",68,0)
 ;
"RTN","ZIS4ONT",69,0)
CLOSE N %ZOS,%Z1,%ZCR,%2,%3,%Y,ZTSK,%ZFN S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",70,0)
 I %ZOS="NT",IO=2,$D(IO(1,IO)) K IO(1,IO) C IO
"RTN","ZIS4ONT",71,0)
 I %ZOS="VMS",IO]"",$D(IO(1,IO)) U IO S %ZFN=$ZIO C IO K IO(1,IO)
"RTN","ZIS4ONT",72,0)
 ;See that ZTSK is set so we will move to the global now.
"RTN","ZIS4ONT",73,0)
 S ZTSK=1 D FILE^ZISPL1 I %ZDA'>0 K ZISPLAD Q
"RTN","ZIS4ONT",74,0)
 G:%ZOS="VMS" CLVMS
"RTN","ZIS4ONT",75,0)
 S %ZFN=$P(%ZS,"^",2),%ZCR=$C(13),%Y="",%=0,%3=$P(^SPOOL(%ZFN,2147483647),"{",3)
"RTN","ZIS4ONT",76,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL"))
"RTN","ZIS4ONT",77,0)
 F %2=1:1:%3 Q:'$D(^SPOOL(%ZFN,%2))  S %X=^SPOOL(%ZFN,%2) D
"RTN","ZIS4ONT",78,0)
 . I %Z1<% D LIMIT S %2=%3 Q
"RTN","ZIS4ONT",79,0)
 . I %X[$C(13,12) D:$L($P(%X,$C(13))) ADD($P(%X,$C(13))) D ADD("|TOP|") Q
"RTN","ZIS4ONT",80,0)
 . D ADD($P(%X,$C(13),1))
"RTN","ZIS4ONT",81,0)
 K ^SPOOL(%ZFN),^SPOOL(0,$P(%ZS,U,1)),%Y,%X,%1,%2,%3 D CLOSE^ZISPL1
"RTN","ZIS4ONT",82,0)
 Q
"RTN","ZIS4ONT",83,0)
ADD(L) S %=%+1,^XMBS(3.519,XS,2,%,0)=L Q
"RTN","ZIS4ONT",84,0)
LIMIT D ADD("*** INCOMPLETE REPORT  -- SPOOL DOCUMENT LINE LIMIT EXCEEDED ***") S $P(^XMB(3.51,%ZDA,0),"^",11)=1
"RTN","ZIS4ONT",85,0)
 Q
"RTN","ZIS4ONT",86,0)
CLVMS ;Close for Cache VMS
"RTN","ZIS4ONT",87,0)
 N $ES,$ET S $ET="D:$EC'[""ENDOF"" ^%ZTER,UNDWIND^%ZTER S $EC="""" D SPLEX,UNWIND^%ZTER"
"RTN","ZIS4ONT",88,0)
 ;%ZFN Could be set at the top
"RTN","ZIS4ONT",89,0)
 S %ZFN=$S($G(%ZFN)]"":%ZFN,1:$P(%ZS,"^",2)) D SPL3 Q:%ZFN']""  U %ZFN S %ZCR=$C(13),%Y=""
"RTN","ZIS4ONT",90,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL")),%=0
"RTN","ZIS4ONT",91,0)
 F  R %X#255:5 Q:$ZA<0  D  G:%Z1<% SPLEX
"RTN","ZIS4ONT",92,0)
 . I %Z1<% D LIMIT Q
"RTN","ZIS4ONT",93,0)
 . I %X[$C(12) D ADD("|TOP|") Q
"RTN","ZIS4ONT",94,0)
 . D ADD(%X)
"RTN","ZIS4ONT",95,0)
 . Q
"RTN","ZIS4ONT",96,0)
SPLEX C %ZFN:"D" K:%ZFN]"" IO(1,%ZFN) D CLOSE^ZISPL1 K %Y,%X,%1,%ZFN Q
"RTN","ZIS4ONT",97,0)
 ;
"RTN","ZIS4ONT",98,0)
 ;
"RTN","ZIS4ONT",99,0)
HFS G HFS^%ZISF
"RTN","ZIS4ONT",100,0)
REWMT(IO2,IOPAR) ;Rewind Magtape
"RTN","ZIS4ONT",101,0)
 N $ETRAP S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",102,0)
 U IO2 W *5
"RTN","ZIS4ONT",103,0)
 Q 1
"RTN","ZIS4ONT",104,0)
REWSDP(IO2,IOPAR) ;Rewind SDP
"RTN","ZIS4ONT",105,0)
 G REW1
"RTN","ZIS4ONT",106,0)
REWHFS(IO2,IOPAR) ;Rewind Host File.
"RTN","ZIS4ONT",107,0)
REW1 ;ZIS set % to the current $I so need to update % if = IO
"RTN","ZIS4ONT",108,0)
 N NIO,$ETRAP
"RTN","ZIS4ONT",109,0)
 S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",110,0)
 C IO2 ;You do a rewind to read the file.
"RTN","ZIS4ONT",111,0)
 O IO2:("RV"):1 S IO(1,IO2)=""
"RTN","ZIS4ONT",112,0)
 Q 1
"RTN","ZIS4ONT",113,0)
REWERR ;Error encountered
"RTN","ZIS4ONT",114,0)
 S IO("ERROR")=$EC,$ECODE=""
"RTN","ZIS4ONT",115,0)
 Q 0
"RTN","ZIS4VXD")
0^11^B17769864
"RTN","ZIS4VXD",1,0)
%ZIS4 ;SFISC/AC,RWF,MVB - DEVICE HANDLER SPOOL SPECIFIC CODE(VAX DSM) ;10/11/2001  10:44
"RTN","ZIS4VXD",2,0)
 ;;8.0;KERNEL;**23,36,49,59,69,191**;JUL 03, 1995
"RTN","ZIS4VXD",3,0)
 ;
"RTN","ZIS4VXD",4,0)
OPEN G OPN2:$D(IO(1,IO))
"RTN","ZIS4VXD",5,0)
 S POP=0 D OP1 G NOPEN:'$D(IO(1,IO))
"RTN","ZIS4VXD",6,0)
OPN2 I $D(%ZISHP),'$D(IOP) W !,*7," Routing to device "_$P(^%ZIS(1,%E,0),"^",1)_$S($D(^(1)):" "_$P(^(1),"^",1)_" ",1:"")
"RTN","ZIS4VXD",7,0)
 Q
"RTN","ZIS4VXD",8,0)
NOPEN I %IS'["D",$D(%ZISHP)!(%ZISHG]"") S POP=1 Q
"RTN","ZIS4VXD",9,0)
 I '$D(IOP) W *7,"  [BUSY]" W "  ...  RETRY" S %=2,U="^" D YN^%ZIS1 G OPEN:%=1
"RTN","ZIS4VXD",10,0)
 S POP=1 Q
"RTN","ZIS4VXD",11,0)
 Q
"RTN","ZIS4VXD",12,0)
OP1 S $ZT="OPNERR^%ZIS4",$ZE=""
"RTN","ZIS4VXD",13,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4VXD",14,0)
 O IO::%ZISTO S:$T IO(1,IO)="" S:'$T POP=1 L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4VXD",15,0)
 Q
"RTN","ZIS4VXD",16,0)
OPNERR S POP=1,IO("LASTERR")=$G(IO("ERROR")),IO("ERROR")=$ZE,$EC="" Q
"RTN","ZIS4VXD",17,0)
 ;
"RTN","ZIS4VXD",18,0)
O D:%IS["L" ZIO
"RTN","ZIS4VXD",19,0)
 ;D:$D(%ZISIOS) ZISLPC^%ZIS Q:'%ZISB  ;No longer called in Kernel v8.
"RTN","ZIS4VXD",20,0)
LCKGBL ;Lock Global
"RTN","ZIS4VXD",21,0)
 I %ZTYPE="CHAN" N % S %=$G(^%ZIS(1,+%E,"GBL")) I %]"" L @("+^"_%_":0") S:'$T POP=1 I POP W:'$D(IOP) !,?5,*7,"[DEVICE IS BUSY]" Q
"RTN","ZIS4VXD",22,0)
 I $D(IO("S")),$D(^%ZIS(2,IO("S"),10)),^(10)]"" U IO(0) D X10^ZISX
"RTN","ZIS4VXD",23,0)
OPAR I $D(IOP),%ZTYPE="HFS",$D(%IS("HFSIO")),$D(%IS("IOPAR")),%IS("HFSIO")]"" S IO=%IS("HFSIO"),%ZISOPAR=%IS("IOPAR")
"RTN","ZIS4VXD",24,0)
 I %ZTYPE="CHAN",IO["::""TASK="!(IO["SYS$NET") D ODECNET Q:POP  G OXECUTE^%ZIS6
"RTN","ZIS4VXD",25,0)
 S %A=%ZISOPAR_$S(%ZISOPAR["):":"",%ZTYPE["CHAN"&($P(%ZTIME,"^",3)="n"):"",1:":"_%ZISTO)
"RTN","ZIS4VXD",26,0)
 N % S %(IO)="",%=$P($P($NA(%(IO)),"(",2),")")
"RTN","ZIS4VXD",27,0)
 S %A=%_$E(":",%A]"")_%A
"RTN","ZIS4VXD",28,0)
 D O1 I POP D  Q
"RTN","ZIS4VXD",29,0)
 .I %ZTYPE="HFS",'$D(IOP),$G(IO("ERROR"))["file not found" W !,?5,*7,"[File Not Found]" Q
"RTN","ZIS4VXD",30,0)
 .W:'$D(IOP) !,?5,*7,"[DEVICE IS BUSY]" Q
"RTN","ZIS4VXD",31,0)
 ;S IO(1,IO)="" U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0 I %ZTYPE["TRM" U IO:(WIDTH=+%Z91)
"RTN","ZIS4VXD",32,0)
 U IO S $X=0,$Y=0 I %ZTYPE["TRM" U IO:(WIDTH=+%Z91)
"RTN","ZIS4VXD",33,0)
 I %ZISUPAR]"" S %A1=""""_IO_""":"_%ZISUPAR U @%A1
"RTN","ZIS4VXD",34,0)
 ;U:%IS'[0 IO(0)
"RTN","ZIS4VXD",35,0)
 G OXECUTE^%ZIS6
"RTN","ZIS4VXD",36,0)
 ;
"RTN","ZIS4VXD",37,0)
O1 S $ZT="OPNERR^%ZIS4"
"RTN","ZIS4VXD",38,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4VXD",39,0)
 O @%A S:'$T&(%A?.E1":".N) POP=1 S:'POP IO(1,IO)="" L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4VXD",40,0)
 S IO("ERROR")="" Q
"RTN","ZIS4VXD",41,0)
 ;
"RTN","ZIS4VXD",42,0)
ODECNET ;OPEN DECNET CHANNEL
"RTN","ZIS4VXD",43,0)
 S $ZT="OPNERR^%ZIS4"
"RTN","ZIS4VXD",44,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60 O IO L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4VXD",45,0)
 S IO("ERROR")=""
"RTN","ZIS4VXD",46,0)
 I IO="SYS$NET",$I="SYS$INPUT:;" S IO(0)=IO U IO Q
"RTN","ZIS4VXD",47,0)
 Q
"RTN","ZIS4VXD",48,0)
ZIO N % S %=$ZIO,%=$S(%["Host:":$P($P(%,"Host: ",2)," ")_":"_$P(%,"Port: ",2),1:%) S:%[" " %=$TR(%," ")
"RTN","ZIS4VXD",49,0)
 S IO("ZIO")=% S:($ZIO["Host:")&'$D(IO("IP")) IO("IP")=$P(%,":")
"RTN","ZIS4VXD",50,0)
 Q
"RTN","ZIS4VXD",51,0)
 ;
"RTN","ZIS4VXD",52,0)
SPOOL ;%ZDA=pointer to ^XMB(3.51, %ZFN=spool file name.
"RTN","ZIS4VXD",53,0)
 I $D(ZISDA) W:'$D(IOP) !?5,*7,"You may not Spool the printing of a Spool document" G N
"RTN","ZIS4VXD",54,0)
 I $D(DUZ)[0 W:'$D(IOP) !,"Must be a valid user." G N
"RTN","ZIS4VXD",55,0)
R S %ZY=-1 D NEWDOC^ZISPL1 G N:%ZY'>0 S %ZDA=+%ZY,%ZFN=$P(%ZY(0),U,2),IO("DOC")=$P(%ZY(0),U,1) G OK:$D(IO("Q"))
"RTN","ZIS4VXD",56,0)
 G:'%ZISB OK I '$P(%ZY,"^",3),%ZFN]"" D SPL3 G N:%ZFN']"",DOC
"RTN","ZIS4VXD",57,0)
 S %ZFN=IO_"SPOOL_no_"_%ZDA_".TMP" D SPL2 G:%ZFN']"" N S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)=""
"RTN","ZIS4VXD",58,0)
DOC S IO=%ZFN,IO("SPOOL")=%ZDA,^XUTL("XQ",$J,"SPOOL")=%ZDA,IOF="#"
"RTN","ZIS4VXD",59,0)
 I $D(^%ZIS(1,%ZISIOS,1)),$P(^(1),"^",8),$O(^("SPL",0)) S ^XUTL("XQ",$J,"ADSPL")=%ZISIOS,ZISPLAD=%ZISIOS
"RTN","ZIS4VXD",60,0)
OK K %ZDA,%ZFN Q
"RTN","ZIS4VXD",61,0)
N K %ZDA,%ZFN,IO("DOC") S POP=1 Q
"RTN","ZIS4VXD",62,0)
 ;
"RTN","ZIS4VXD",63,0)
SPL2 O %ZFN:(NEWVERSION:PROT=W:RWD) G:$ZA<0 SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4VXD",64,0)
 ;
"RTN","ZIS4VXD",65,0)
SPL3 N $ETRAP S $ETRAP="S $EC="""" G SPL4^%ZIS4"
"RTN","ZIS4VXD",66,0)
 O %ZFN:READONLY:1 S:'$T ZISPLQ=1 G:$ZA<0!('$T) SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4VXD",67,0)
 ;
"RTN","ZIS4VXD",68,0)
SPL4 W:'$D(IOP)&'$D(ZTQUEUED) !?5,*7,"Couldn't open the spool file." S %ZFN="" Q
"RTN","ZIS4VXD",69,0)
 ;
"RTN","ZIS4VXD",70,0)
CLOSE N %Z1 C:IO]"" IO K:IO]"" IO(1,IO) D FILE^ZISPL1 I %ZDA'>0 K ZISPLAD Q
"RTN","ZIS4VXD",71,0)
 S %ZFN=$P(%ZS,"^",2) D SPL3 Q:%ZFN']""  U %ZFN S %ZCR=$C(13),%Y="",$ZT="SPLEOF^%ZIS4"
"RTN","ZIS4VXD",72,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL"))
"RTN","ZIS4VXD",73,0)
 F %=0:0 R %X#255:5 Q:$ZA<0  S %2=%X D CL2 G:%Z1<% SPLEX
"RTN","ZIS4VXD",74,0)
SPLEOF I $ZE'["ENDO" ZQ  ;Send error up
"RTN","ZIS4VXD",75,0)
SPLEX C %ZFN:DELETE K:%ZFN]"" IO(1,%ZFN) D CLOSE^ZISPL1 K %Y,%X,%1,%ZFN Q
"RTN","ZIS4VXD",76,0)
 ;
"RTN","ZIS4VXD",77,0)
CL2 S %=%+1 I %Z1<% S ^XMBS(3.519,XS,2,%,0)="*** INCOMPLETE REPORT  -- SPOOL DOCUMENT LINE LIMIT EXCEEDED ***",$P(^XMB(3.51,%ZDA,0),"^",11)=1 Q
"RTN","ZIS4VXD",78,0)
 I %2[$C(12) S ^XMBS(3.519,XS,2,%,0)="|TOP|" Q
"RTN","ZIS4VXD",79,0)
 S ^XMBS(3.519,XS,2,%,0)=%2 Q
"RTN","ZIS4VXD",80,0)
 ;
"RTN","ZIS4VXD",81,0)
HFS G HFS^%ZISF
"RTN","ZIS4VXD",82,0)
REWMT(IO,IOPAR) ;Rewind Magtape
"RTN","ZIS4VXD",83,0)
 S X="REWERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4VXD",84,0)
 U IO W *5
"RTN","ZIS4VXD",85,0)
 Q 1
"RTN","ZIS4VXD",86,0)
REWSDP(IO2,IOPAR) ;Rewind SDP
"RTN","ZIS4VXD",87,0)
 G REW1
"RTN","ZIS4VXD",88,0)
REWHFS(IO2,IOPAR) ;Rewind Host File.
"RTN","ZIS4VXD",89,0)
REW1 ;N $ET S $ET="D REWERR^%ZIS4 Q 0"
"RTN","ZIS4VXD",90,0)
 U IO2:DISCONNECT
"RTN","ZIS4VXD",91,0)
 Q 1
"RTN","ZIS4VXD",92,0)
REWERR ;Error encountered
"RTN","ZIS4VXD",93,0)
 S IO("ERROR")=$EC,$EC=""
"RTN","ZIS4VXD",94,0)
 Q
"RTN","ZISFONT")
0^13^B8486412
"RTN","ZISFONT",1,0)
%ZISF ;SFISC/AC - HOST FILES FOR Cache on NT & VMS ;08/12/2002  08:36
"RTN","ZISFONT",2,0)
 ;;8.0;KERNEL;**34,191**;Jul 10, 1995
"RTN","ZISFONT",3,0)
HFS ;Host File Server
"RTN","ZISFONT",4,0)
 Q:$D(IOP)&$D(%IS("HFSIO"))&$D(%IS("IOPAR"))
"RTN","ZISFONT",5,0)
 I $D(%ZIS("HFSNAME")) S IO=%ZIS("HFSNAME"),%X=IO ;
"RTN","ZISFONT",6,0)
 E  D ASKHFS
"RTN","ZISFONT",7,0)
H S:$D(%ZIS("HFSMODE")) %ZISOPAR=$$MODE^%ZISF(%ZIS("HFSMODE"))
"RTN","ZISFONT",8,0)
H1 I $D(IO("Q"))!(%IS["Z") S IO("HFSIO")=""
"RTN","ZISFONT",9,0)
 S IO=$S(%X]"":%X,1:IO),IO=$$CHKNM(IO) ;See that we have a directory
"RTN","ZISFONT",10,0)
 S:$D(IO("HFSIO")) IO("HFSIO")=IO
"RTN","ZISFONT",11,0)
 W:'$D(IOP)&$D(%ZIS("HFSNAME")) "    HOST FILE TO USE:  "_%ZIS("HFSNAME"),!
"RTN","ZISFONT",12,0)
 D ASKPAR^%ZIS6,SETPAR^%ZIS3
"RTN","ZISFONT",13,0)
HFSIOO I '$D(IOP),%ZTYPE="HFS",'$D(%ZIS("HFSMODE")),'$P(^%ZIS(1,%E,0),"^",4),%ZISOPAR="",$D(^%ZIS(1,%E,1)),$P(^(1),"^",6) W ?45,"INPUT/OUTPUT OPERATION: R//"
"RTN","ZISFONT",14,0)
 Q:'$T  D SBR^%ZIS1 I $D(DTOUT)!$D(DFOUT)!$D(DUOUT) S POP=1 Q
"RTN","ZISFONT",15,0)
 D HOPT:%X="?"!'$$CHECK(%X),HOPT1:%X="??" G HFSIOO:%X="?"!'$$CHECK(%X)
"RTN","ZISFONT",16,0)
 S:%X]"" %ZISOPAR="("""_%X_""")" Q
"RTN","ZISFONT",17,0)
 ;
"RTN","ZISFONT",18,0)
CHECK(X) ;Check that we have valid option
"RTN","ZISFONT",19,0)
 N Y,%
"RTN","ZISFONT",20,0)
 Q:(X["R")&(X["W") 0 ;Can't have both
"RTN","ZISFONT",21,0)
 S Y=1 F %=1:1:$L(X) I "AFNRSVW"'[$E(X) S Y=0
"RTN","ZISFONT",22,0)
 Q Y
"RTN","ZISFONT",23,0)
 ;
"RTN","ZISFONT",24,0)
ASKHFS ;---Ask host file name here---
"RTN","ZISFONT",25,0)
 I $D(%IS("B","HFS"))#2,%IS("B","HFS")]"" D
"RTN","ZISFONT",26,0)
 .S IO=%IS("B","HFS") ;Set default host file name
"RTN","ZISFONT",27,0)
 S %X='$P($G(^%ZIS(1,%E,1)),"^",5)
"RTN","ZISFONT",28,0)
 S:'%X %X=""
"RTN","ZISFONT",29,0)
 I $D(IOP)!%X!$D(%ZIS("HFSNAME")) S %X="" Q
"RTN","ZISFONT",30,0)
ASKAGN W !,"HOST FILE NAME: "_IO_"//" D SBR^%ZIS1
"RTN","ZISFONT",31,0)
 I %X?1."?".E W !,"ENTER HOST FILE NAME" G ASKAGN
"RTN","ZISFONT",32,0)
 S:$D(DTOUT)!$D(DUOUT) POP=1
"RTN","ZISFONT",33,0)
 Q
"RTN","ZISFONT",34,0)
CHKNM(H)        ;Check the HFS name
"RTN","ZISFONT",35,0)
 N N,%OS S N=H,%OS=$ZV["VMS"
"RTN","ZISFONT",36,0)
 I %OS,(H'[":")&(H'["[") S N=$$DEFDIR^%ZISH("")_H ;VMS - disk:[directory]file
"RTN","ZISFONT",37,0)
 I '%OS,(H'["\")&(H'[":") S N=$$DEFDIR^%ZISH("")_H ;NT - C:\DIR\FILE
"RTN","ZISFONT",38,0)
 Q N
"RTN","ZISFONT",39,0)
 ;
"RTN","ZISFONT",40,0)
MODE(X) ;Return %ZISOPAR in Y.
"RTN","ZISFONT",41,0)
 N Y,Q S Q=$C(34)
"RTN","ZISFONT",42,0)
 S Y=$S(X["R"&(X["W"):"RWS",X="N":"NWS",X="W":"NWS",X="A":"AWS",1:"RV")
"RTN","ZISFONT",43,0)
 Q $S(Y]"":Q_Y_Q,1:Y)
"RTN","ZISFONT",44,0)
HOPT W !,"You may enter a string of codes that represents",!,"the following host file input/ouput operation:"
"RTN","ZISFONT",45,0)
 W !?16,"R = READ ACCESS",!?16,"W = WRITE ACCESS",!?16,"N = NEWVERSION",!?16,"S = STREAM FORMAT",!?16,"V = VARIABLE FORMAT",!?16,"A = APPEND"
"RTN","ZISFONT",46,0)
 W !,"Example valid groupings 'RS', 'NWS', 'AWS'"
"RTN","ZISFONT",47,0)
 Q
"RTN","ZISFONT",48,0)
HOPT1 S %ZISI=$O(^DIC(9.2,"B","XUHFSPARAM-MVX",0)) Q:'%ZISI  Q:'$D(^DIC(9.2,+%ZISI,0))  Q:$P(^(0),"^",1)'="XUHFSPARAM-MVX"
"RTN","ZISFONT",49,0)
 Q:$D(^DIC(9.2,+%ZISI,1))'>9  F %X=0:0 S %X=$O(^DIC(9.2,+%ZISI,1,%X)) Q:%X'>0  I $D(^(%X,0)) W !,^(0)
"RTN","ZISFONT",50,0)
 W ! S %X="??" Q
"RTN","ZISHONT")
0^6^B32320415
"RTN","ZISHONT",1,0)
%ZISH ;IHS\PR,SFISC/AC - Host File Control for OpenM/Cache for NT/VMS ;09/11/2002  15:07
"RTN","ZISHONT",2,0)
 ;;8.0;KERNEL;**34,65,84,104,191**;JUL 10, 1995
"RTN","ZISHONT",3,0)
 ;
"RTN","ZISHONT",4,0)
 ; **MODIFIED VERSION FOR CACHE/VMS -- 9/7/01**
"RTN","ZISHONT",5,0)
 ;
"RTN","ZISHONT",6,0)
OPEN(X1,X2,X3,X4,X5,X6)    ;SR. Open Host File
"RTN","ZISHONT",7,0)
 ;X1=handle name
"RTN","ZISHONT",8,0)
 ;X2=directory name \dir\
"RTN","ZISHONT",9,0)
 ;X3=file name
"RTN","ZISHONT",10,0)
 ;X4=file access mode e.g.: W for write, R for read, A for append.
"RTN","ZISHONT",11,0)
 ;X5=Max record size for a new file, X6=Subtype
"RTN","ZISHONT",12,0)
 N %,%1,%2,%I,%ZOS,%T,%ZA,%ZISHIO,$ET
"RTN","ZISHONT",13,0)
 S $ET="D OPNERR^%ZISH"
"RTN","ZISHONT",14,0)
 S U="^",%I=$I,%T=0,POP=0,X2=$$DEFDIR($G(X2)),%ZOS=$$OS^%ZOSV M %ZISHIO=IO
"RTN","ZISHONT",15,0)
 I %ZOS="NT" S %1=$S(X4["A":"AW",X4["W":"WN",1:"R")_$S(X4["B":"U",1:"S") ;$$MODE^%ZISF(X2_X3,X4)
"RTN","ZISHONT",16,0)
 I %ZOS="VMS" S %1=$S(X4["A":"AW",X4["W":"WN",1:"R")_$S(X4["B":"U",X4["R":"V",1:"S")
"RTN","ZISHONT",17,0)
 ;The next line eliminates the <ENDOFFILE> error for sequential files for the current process.
"RTN","ZISHONT",18,0)
 S %ZA=$ZUTIL(68,40,1) ;Work like DSM
"RTN","ZISHONT",19,0)
 S %=X2_X3 O %:(%1):2 I '$T S POP=1 Q
"RTN","ZISHONT",20,0)
 U % S %ZA=$ZA
"RTN","ZISHONT",21,0)
 I %ZA=-1 U:%I]"" %I C % S POP=1 Q
"RTN","ZISHONT",22,0)
 S IO=%,IO(1,IO)="",IOT="HFS",POP=0 D SUBTYPE^%ZIS3($G(X6))
"RTN","ZISHONT",23,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHONT",24,0)
 U $S(%I]"":%I,1:$P)
"RTN","ZISHONT",25,0)
 Q
"RTN","ZISHONT",26,0)
 ;
"RTN","ZISHONT",27,0)
OPNERR ;Handle open error
"RTN","ZISHONT",28,0)
 S POP=1,$ECODE=""
"RTN","ZISHONT",29,0)
 U:$P]"" $P
"RTN","ZISHONT",30,0)
 Q
"RTN","ZISHONT",31,0)
 ;
"RTN","ZISHONT",32,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHONT",33,0)
 ;X=HANDLE NAME
"RTN","ZISHONT",34,0)
 ;IO=Device
"RTN","ZISHONT",35,0)
 N %
"RTN","ZISHONT",36,0)
 I $G(IO)]"" C IO K IO(1,IO)
"RTN","ZISHONT",37,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHONT",38,0)
 ;Only reset home if one setup.
"RTN","ZISHONT",39,0)
 I $D(IO("HOME"))!$D(^XUTL("XQ",$J,"IOS")) D HOME^%ZIS
"RTN","ZISHONT",40,0)
 Q
"RTN","ZISHONT",41,0)
 ;
"RTN","ZISHONT",42,0)
OPENERR ;
"RTN","ZISHONT",43,0)
 Q 0
"RTN","ZISHONT",44,0)
 ;
"RTN","ZISHONT",45,0)
DEL(%ZX1,%ZX2) ;ef,SR. Del fl(s)
"RTN","ZISHONT",46,0)
 ;S Y=$$DEL^ZOSHMSM("\dir\",$NA(array))
"RTN","ZISHONT",47,0)
 N %,%ZISH,%ZOS,ZOSHDA,ZOSHF,ZOSHX,ZOSHQ,ZOSHDF,ZOSHC
"RTN","ZISHONT",48,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZOS=$$OS^%ZOSV
"RTN","ZISHONT",49,0)
 ;Get fls to act on
"RTN","ZISHONT",50,0)
 ;No '*' allowed
"RTN","ZISHONT",51,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:'%ZISH  I %ZISH["*" S ZOSHQ=1 Q
"RTN","ZISHONT",52,0)
 I $D(ZOSHQ) Q 0
"RTN","ZISHONT",53,0)
 S %ZISH="" F   S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",54,0)
 . S %=$S(%ZISH[%ZX1:%ZISH,1:%ZX1_%ZISH)
"RTN","ZISHONT",55,0)
 . I %ZOS="VMS",%'[";" S %=%_";*"
"RTN","ZISHONT",56,0)
 . S %=$ZF(-1,"del "_%)
"RTN","ZISHONT",57,0)
 Q 1
"RTN","ZISHONT",58,0)
 ;
"RTN","ZISHONT",59,0)
LIST(%ZX1,%ZX2,%ZX3) ;ef,SR. Create a local array holding fl names
"RTN","ZISHONT",60,0)
 ;S Y=$$LIST^ZOSHDOS("\dir\",$NA(array),$NA(return array))
"RTN","ZISHONT",61,0)
 ;
"RTN","ZISHONT",62,0)
 N %ZISH,%ZISHN,%ZX,%ZISHY,%ZY,%ZOS
"RTN","ZISHONT",63,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZOS=$$OS^%ZOSV
"RTN","ZISHONT",64,0)
 ;Get fls to act on
"RTN","ZISHONT",65,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",66,0)
 .I %ZOS="VMS",%ZISH'["." S %ZISH=%ZISH_".*"
"RTN","ZISHONT",67,0)
 .S %ZX=%ZX1_%ZISH,%ZISHY=$$UP^XLFSTR($P(%ZX,"*"))
"RTN","ZISHONT",68,0)
 .F %ZISHN=0:1 D  Q:(%ZX="") 
"RTN","ZISHONT",69,0)
 .. S %ZX=$ZSEARCH($S(%ZISHN:"",1:%ZX))
"RTN","ZISHONT",70,0)
 .. Q:(%ZX="")!($$UP^XLFSTR(%ZX)'[%ZISHY)!(%ZX?.E1.2".")
"RTN","ZISHONT",71,0)
 .. I %ZOS="VMS" S %ZX=$P(%ZX,%ZX1,2),@%ZX3@(%ZX)=""
"RTN","ZISHONT",72,0)
 .. S %ZY=$P(%ZX,"\",$L(%ZX,"\")),@%ZX3@(%ZY)=""
"RTN","ZISHONT",73,0)
 Q $O(@%ZX3@(""))]""
"RTN","ZISHONT",74,0)
 ;
"RTN","ZISHONT",75,0)
MV(X1,X2,Y1,Y2) ;ef,SR. Rename a fl
"RTN","ZISHONT",76,0)
 ;S Y=$$MV^ZOSHDOS("\dir\","fl","\dir\","fl")
"RTN","ZISHONT",77,0)
 ;
"RTN","ZISHONT",78,0)
 N %,X,Y,%ZOS,%ZISHX S %ZOS=$$OS^%ZOSV
"RTN","ZISHONT",79,0)
 S X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHONT",80,0)
 S X=$ZSEARCH(X1_X2),Y=Y1_Y2 ;move X to Y
"RTN","ZISHONT",81,0)
 I X="" Q 0
"RTN","ZISHONT",82,0)
 S %=$ZF(-1,"copy "_X_" "_Y) ;Use NT/VMS copy
"RTN","ZISHONT",83,0)
 I %ZOS="VMS" S X2=$P(X,X1,2)
"RTN","ZISHONT",84,0)
 S %ZISHX(X2)="" S Y=$$DEL^%ZISH(X1,$NA(%ZISHX))
"RTN","ZISHONT",85,0)
 Q 1
"RTN","ZISHONT",86,0)
 ;
"RTN","ZISHONT",87,0)
PWD() ;ef,SR. Print working directory
"RTN","ZISHONT",88,0)
 N Y,%ZOS
"RTN","ZISHONT",89,0)
 S Y=$$DEFDIR(""),%ZOS=$$OS^%ZOSV
"RTN","ZISHONT",90,0)
 I Y="" S Y=$ZSEARCH("*")
"RTN","ZISHONT",91,0)
 Q $S(%ZOS["VMS":Y,1:$P(Y,".",1))
"RTN","ZISHONT",92,0)
 ;
"RTN","ZISHONT",93,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHONT",94,0)
 ;Need to handle both NT and VMS
"RTN","ZISHONT",95,0)
 N %ZOS S %ZOS=$$OS^%ZOSV
"RTN","ZISHONT",96,0)
 Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHONT",97,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV"))
"RTN","ZISHONT",98,0)
 Q:DF="" ""
"RTN","ZISHONT",99,0)
 ;Check syntax, VMS needs disk:[dir]
"RTN","ZISHONT",100,0)
 I %ZOS="VMS" D  Q DF
"RTN","ZISHONT",101,0)
 . N P1,P2
"RTN","ZISHONT",102,0)
 . I DF[":" S P1=$P(DF,":")_":",P2=$P(DF,":",2)
"RTN","ZISHONT",103,0)
 . E  S P1="",P2=DF
"RTN","ZISHONT",104,0)
 . I P1="",P2["$" S DF=P2 Q  ;Assume a logical
"RTN","ZISHONT",105,0)
 . I $L(P2) S:P2'["[" P2="["_P2 S:P2'["]" P2=P2_"]"
"RTN","ZISHONT",106,0)
 . S DF=P1_P2
"RTN","ZISHONT",107,0)
 ;Check syntax, NT needs \dir\
"RTN","ZISHONT",108,0)
 I %ZOS="NT" D  Q DF
"RTN","ZISHONT",109,0)
 . N P1,P2
"RTN","ZISHONT",110,0)
 . I DF[":" S P1=$P(DF,":")_":",P2=$P(DF,":",2)
"RTN","ZISHONT",111,0)
 . E  S P1="",P2=DF
"RTN","ZISHONT",112,0)
 . S P2=$TR(P2,"/","\")
"RTN","ZISHONT",113,0)
 . I $L(P2) S:".\"'[$E(P2,1) P2="\"_P2 S:$E(P2,$L(P2))'="\" P2=P2_"\"
"RTN","ZISHONT",114,0)
 . S DF=P1_P2
"RTN","ZISHONT",115,0)
 Q DF
"RTN","ZISHONT",116,0)
 ;
"RTN","ZISHONT",117,0)
FL(X) ;Fl len
"RTN","ZISHONT",118,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHONT",119,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHONT",120,0)
 I $L(ZOSHP1)>8 S X=4 Q
"RTN","ZISHONT",121,0)
 I $L(ZOSHP2)>3 S X=4 Q
"RTN","ZISHONT",122,0)
 Q
"RTN","ZISHONT",123,0)
 ;
"RTN","ZISHONT",124,0)
STATUS() ;ef,SR. Return EOF status
"RTN","ZISHONT",125,0)
 U $I
"RTN","ZISHONT",126,0)
 Q $$EOF($ZEOF)
"RTN","ZISHONT",127,0)
 ;
"RTN","ZISHONT",128,0)
EOF(X) ;Eof flag, pass in $ZEOF
"RTN","ZISHONT",129,0)
 Q (X=-1)
"RTN","ZISHONT",130,0)
 ;
"RTN","ZISHONT",131,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHONT",132,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHONT",133,0)
 N I,F,MX
"RTN","ZISHONT",134,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHONT",135,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHONT",136,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHONT",137,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHONT",138,0)
%ZX I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHONT",139,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHONT",140,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHONT",141,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHONT",142,0)
 Q
"RTN","ZISHONT",143,0)
 ;
"RTN","ZISHONT",144,0)
READNXT(REC) ;Read any sized record into array. %ZB has terminator
"RTN","ZISHONT",145,0)
 N %,I,X,$ES,$ET S REC="",$ET="D READNX^%ZISH Q"
"RTN","ZISHONT",146,0)
 U IO R X:5 S %ZB=$A($ZB),REC=$E(X,1,255)
"RTN","ZISHONT",147,0)
 Q:$L(X)<256
"RTN","ZISHONT",148,0)
 S %=256 F I=1:1 Q:$L(X)<%  S REC(I)=$E(X,%,%+254),%=%+255
"RTN","ZISHONT",149,0)
 Q
"RTN","ZISHONT",150,0)
READNX ;Check for EOF
"RTN","ZISHONT",151,0)
 I $ZE["ENDOFFILE" S %ZA=-1
"RTN","ZISHONT",152,0)
 S $EC=""
"RTN","ZISHONT",153,0)
 Q
"RTN","ZISHONT",154,0)
 ;
"RTN","ZISHONT",155,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;ef,SR. Unload contents of host file into global
"RTN","ZISHONT",156,0)
 ;p1=hostf file directory 
"RTN","ZISHONT",157,0)
 ;p2=host file name
"RTN","ZISHONT",158,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHONT",159,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHONT",160,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHONT",161,0)
 N %ZA,%ZB,%ZC,X,%OVFCNT,%ZISHF,%ZISHO,POP,%ZISUB,$ES,$ET
"RTN","ZISHONT",162,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY
"RTN","ZISHONT",163,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHONT",164,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHONT",165,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHONT",166,0)
 I POP Q 0
"RTN","ZISHONT",167,0)
 S %ZC=1,%ZA=0,$ET="S %ZC=0,%ZA=-1,$EC="""" Q"
"RTN","ZISHONT",168,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF($ZEOF)!%ZA  D
"RTN","ZISHONT",169,0)
 . S @%ZISHF=%XX
"RTN","ZISHONT",170,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHONT",171,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHONT",172,0)
 . Q
"RTN","ZISHONT",173,0)
 D CLOSE() ;Normal exit
"RTN","ZISHONT",174,0)
 Q %ZC
"RTN","ZISHONT",175,0)
 ;
"RTN","ZISHONT",176,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Load contents of global to host file.
"RTN","ZISHONT",177,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",178,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",179,0)
 ;p3=host file directory
"RTN","ZISHONT",180,0)
 ;p4=host file name
"RTN","ZISHONT",181,0)
 N %ZISHY,%ZISHOX
"RTN","ZISHONT",182,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"W")
"RTN","ZISHONT",183,0)
 Q %ZISHY
"RTN","ZISHONT",184,0)
 ;
"RTN","ZISHONT",185,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Append to host file.
"RTN","ZISHONT",186,0)
 ;
"RTN","ZISHONT",187,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",188,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",189,0)
 ;p3=host file directory
"RTN","ZISHONT",190,0)
 ;p4=host file name
"RTN","ZISHONT",191,0)
 N %ZISHY
"RTN","ZISHONT",192,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"A")
"RTN","ZISHONT",193,0)
 Q %ZISHY
"RTN","ZISHONT",194,0)
 ;
"RTN","ZISHONT",195,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHONT",196,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",197,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",198,0)
 ;p3=host file directory
"RTN","ZISHONT",199,0)
 ;p4=host file name
"RTN","ZISHONT",200,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHS,%ZISHOX,IO,%ZX,Y
"RTN","ZISHONT",201,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHONT",202,0)
 D OPEN^%ZISH(,$G(%ZX3),%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHONT",203,0)
 I POP Q 0
"RTN","ZISHONT",204,0)
 N X
"RTN","ZISHONT",205,0)
 S X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHONT",206,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHONT",207,0)
 D CLOSE()
"RTN","ZISHONT",208,0)
 Q 1
"RTN","ZISHONT",209,0)
 ;
"RTN","ZISHVXD")
0^12^B41278848
"RTN","ZISHVXD",1,0)
%ZISH ;ISF/AC,RWF - VAX DSM Host file Control ;08/12/2002  09:01
"RTN","ZISHVXD",2,0)
 ;;8.0;KERNEL;**24,36,65,84,104,191**;JUL 10, 1995
"RTN","ZISHVXD",3,0)
 ;
"RTN","ZISHVXD",4,0)
OPEN(X1,X2,X3,X4,X5,X6) ;SR. Open file
"RTN","ZISHVXD",5,0)
 ;D OPEN^%ZISH([handlename],[directory],filename,[accessmode],[recsize])
"RTN","ZISHVXD",6,0)
 ;X1=handle name
"RTN","ZISHVXD",7,0)
 ;X2=directory, X3=filename, X4=access mode
"RTN","ZISHVXD",8,0)
 ;X5=new file max record size, X6=Subtype
"RTN","ZISHVXD",9,0)
 ;
"RTN","ZISHVXD",10,0)
 N %,%1,%2,%I,%IO,%I2,%P,%T,X,Y,$ETRAP
"RTN","ZISHVXD",11,0)
 S $ETRAP="D OPNERR^%ZISH"
"RTN","ZISHVXD",12,0)
 S U="^",%I=$I,X2=$$DEFDIR($G(X2)),X4=$$UP^XLFSTR(X4)
"RTN","ZISHVXD",13,0)
 S Y=$S(X4["A":"",X4["R":"READONLY",X4["W":"NEWVERSION",1:"READONLY")
"RTN","ZISHVXD",14,0)
 S Y=Y_$S(X4["B":":BLOCKSIZE=512",$G(X5)&(X4["W"):":RECORDSIZE="_+X5,1:"")
"RTN","ZISHVXD",15,0)
 S:$E(Y)=":" Y=$E(Y,2,999) S %IO=X2_X3,%I2="%IO:"_$S($L(Y):"("_Y_")",1:"")_":3"
"RTN","ZISHVXD",16,0)
 O @%I2 S %T=$T
"RTN","ZISHVXD",17,0)
 I '%T S POP=1 Q
"RTN","ZISHVXD",18,0)
 S IO=%IO,IO(1,IO)="",IOT="HFS",POP=0 D SUBTYPE^%ZIS3($G(X6))
"RTN","ZISHVXD",19,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHVXD",20,0)
 U IO:NOTRAP U $S(%I]"":%I,1:$P) ;Enable use of $ZA to test EOF condition.
"RTN","ZISHVXD",21,0)
 Q
"RTN","ZISHVXD",22,0)
OPNERR ;error on open
"RTN","ZISHVXD",23,0)
 S POP=1,$ECODE=""
"RTN","ZISHVXD",24,0)
 U:$P]"" $P
"RTN","ZISHVXD",25,0)
 Q
"RTN","ZISHVXD",26,0)
 ;
"RTN","ZISHVXD",27,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHVXD",28,0)
 ;X1=Handle name, IO=device
"RTN","ZISHVXD",29,0)
 I IO]"" C IO K IO(1,IO)
"RTN","ZISHVXD",30,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHVXD",31,0)
 ;Only reset home if one setup.
"RTN","ZISHVXD",32,0)
 I $D(IO("HOME"))!$D(^XUTL("XQ",$J,"IOS")) D HOME^%ZIS
"RTN","ZISHVXD",33,0)
 Q
"RTN","ZISHVXD",34,0)
DEL(%ZX1,%ZX2) ;ef,SR. Del fl(s)
"RTN","ZISHVXD",35,0)
 ;S Y=$$DEL^ZISH("/dir/",namevalue)
"RTN","ZISHVXD",36,0)
 N %ZISH,%ZISHLGR,%ZXIT,%ZX,X
"RTN","ZISHVXD",37,0)
 N $ETRAP,$ESTACK S $ETRAP="D DELERR^%ZISH"
"RTN","ZISHVXD",38,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHVXD",39,0)
 ;Get fls to act on
"RTN","ZISHVXD",40,0)
 ;No '*' allowed
"RTN","ZISHVXD",41,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:'%ZISH  I %ZISH["*" S %ZXIT=1 Q
"RTN","ZISHVXD",42,0)
 Q:$D(%ZXIT) 0
"RTN","ZISHVXD",43,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  S %ZX=%ZX1_%ZISH D
"RTN","ZISHVXD",44,0)
 . S %ZX=$ZSEARCH(%ZX) I %ZX]"" O %ZX:READONLY:0 I $T C %ZX:DELETE
"RTN","ZISHVXD",45,0)
 Q 1
"RTN","ZISHVXD",46,0)
DELERR ;Trap any $ETRAP error, unwind and return.
"RTN","ZISHVXD",47,0)
 Q:$ESTACK>1  S $ECODE="" Q:'$QUIT  Q 0
"RTN","ZISHVXD",48,0)
 ;
"RTN","ZISHVXD",49,0)
LIST(%ZX1,%ZX2,%ZX3) ;ef,SR. Set local array holding fl names
"RTN","ZISHVXD",50,0)
 ;S Y=$$LIST^ZISH("/dir/","list_root","return_root")
"RTN","ZISHVXD",51,0)
 ;list_root can have XX("A*"), XX("test.com")...
"RTN","ZISHVXD",52,0)
 ;Both arrays passed as $NA values (closed roots).
"RTN","ZISHVXD",53,0)
 N %IO,%X,%ZISH,%ZISH1,%ZISHIO,%ZX,POP,X,%ZISHDL1,%ZISHDL2,%ZISHDN1,%ZISHDN2
"RTN","ZISHVXD",54,0)
 N $ETRAP,$ESTACK S $ETRAP="",%ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHVXD",55,0)
 S %IO=$I,%ZISHDN1="ZISH"_$J_".TMPA",%ZISHDN2="ZISH"_$J_".TMPB"
"RTN","ZISHVXD",56,0)
 S %ZISHDL1=%ZX1_%ZISHDN1,%ZISHDL2=%ZX1_%ZISHDN2
"RTN","ZISHVXD",57,0)
 S $ZT="SPAWNERR^%ZISH"
"RTN","ZISHVXD",58,0)
 ;Init %ZISHDL1, %ZISHDL2 by deleteing them
"RTN","ZISHVXD",59,0)
 I $ZSEARCH(%ZISHDL1)["ZISH" S X=$&ZLIB.%SPAWN("DEL "_%ZISHDL1_";*")
"RTN","ZISHVXD",60,0)
 I $ZSEARCH(%ZISHDL2)["ZISH" S X=$&ZLIB.%SPAWN("DEL "_%ZISHDL2_";*")
"RTN","ZISHVXD",61,0)
 ;Get fls to act on, Build listing in ZISH_$J_.TMPA (%ZISHDL1)
"RTN","ZISHVXD",62,0)
 S %ZISH1=0,%ZISH=""
"RTN","ZISHVXD",63,0)
 F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  S X=$$LIST1(%ZX1_%ZISH)
"RTN","ZISHVXD",64,0)
 ;Open %ZISHDL1 to read list backin.
"RTN","ZISHVXD",65,0)
 S $ZT="LSTEOF^%ZISH"
"RTN","ZISHVXD",66,0)
 O %ZISHDL1::5 I '$T G LSTEOF
"RTN","ZISHVXD",67,0)
 U %ZISHDL1:NOTRAP R %ZX:5 I $ZA=-1 G LSTEOF
"RTN","ZISHVXD",68,0)
 F I=0:1 U %ZISHDL1 R %ZX:5 G LSTEOF:$ZA=-1 I %ZX]"" S %X=$P(%ZX,$C(32)) D
"RTN","ZISHVXD",69,0)
 . I %ZX'["Total of",%ZX'?.E1".DIR;".N,%ZX'?1"Directory".E D
"RTN","ZISHVXD",70,0)
 . . I (%X[%ZISHDN1)!(%X[%ZISHDN2) Q
"RTN","ZISHVXD",71,0)
 . . S @%ZX3@(%X)=""
"RTN","ZISHVXD",72,0)
LSTEOF S $ZT=""
"RTN","ZISHVXD",73,0)
 I $L(%IO) U:$D(IO(1,%IO)) IO
"RTN","ZISHVXD",74,0)
 C %ZISHDL1:DELETE
"RTN","ZISHVXD",75,0)
 I $ZSEARCH(%ZISHDL2)]"" S X=$&ZLIB.%SPAWN("DEL "_%ZISHDL2_";*")
"RTN","ZISHVXD",76,0)
 I $ZSEARCH(%ZISHDL1)]"" S X=$&ZLIB.%SPAWN("DEL "_%ZISHDL1_";*")
"RTN","ZISHVXD",77,0)
 S $ECODE=""
"RTN","ZISHVXD",78,0)
 Q ($Q(@%ZX3)]"")
"RTN","ZISHVXD",79,0)
 ;
"RTN","ZISHVXD",80,0)
LIST1(%ZX) ;Get one part of the list
"RTN","ZISHVXD",81,0)
 S $ZT="LSTERR^%ZISH"
"RTN","ZISHVXD",82,0)
 I %ZISH1 D
"RTN","ZISHVXD",83,0)
 . S X=$&ZLIB.%SPAWN("DIR/COL=1 "_%ZX,,%ZISHDL2)
"RTN","ZISHVXD",84,0)
 . I X S X=$&ZLIB.%SPAWN("APPEND "_%ZISHDL2_" "_%ZISHDL1)
"RTN","ZISHVXD",85,0)
 I '%ZISH1 S X=$&ZLIB.%SPAWN("DIR/COL=1 "_%ZX,,%ZISHDL1),%ZISH1=1
"RTN","ZISHVXD",86,0)
 Q 1
"RTN","ZISHVXD",87,0)
LSTERR ;Error in list
"RTN","ZISHVXD",88,0)
 I $ZSEARCH(%ZISHDL2)["ZISH" S X=$&ZLIB.%SPAWN("DEL "_%ZISHDL2_";*")
"RTN","ZISHVXD",89,0)
 Q 0
"RTN","ZISHVXD",90,0)
 ;
"RTN","ZISHVXD",91,0)
SPAWNERR ;TRAP ERROR OF SPAWN
"RTN","ZISHVXD",92,0)
 O %ZISHDL1:READONLY:1 I $T C %ZISHDL1:DELETE
"RTN","ZISHVXD",93,0)
 S $ECODE=""
"RTN","ZISHVXD",94,0)
 Q 0
"RTN","ZISHVXD",95,0)
 ;
"RTN","ZISHVXD",96,0)
MV(X1,X2,Y1,Y2) ;ef,SR. Rename a fl
"RTN","ZISHVXD",97,0)
 ;S Y=$$MV^ZISH("/dir/","fl","/dir/","fl")
"RTN","ZISHVXD",98,0)
 N X,Y,%ZISHDL1
"RTN","ZISHVXD",99,0)
 S %ZISHDL1="ZISH"_$J_".TMPA",X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHVXD",100,0)
 S $ZT="SPAWNERR^%ZISH"
"RTN","ZISHVXD",101,0)
 ;Pbv or qit
"RTN","ZISHVXD",102,0)
 I (X2="")!(Y2="") Q 0
"RTN","ZISHVXD",103,0)
 I X1=Y1 D
"RTN","ZISHVXD",104,0)
 .O @(""""_X1_X2_"""")
"RTN","ZISHVXD",105,0)
 .C @(""""_X1_X2_""":RENAME="_""""_Y1_Y2_"""")
"RTN","ZISHVXD",106,0)
 E  D
"RTN","ZISHVXD",107,0)
 .S Y=$&ZLIB.%SPAWN("COPY "_X1_X2_" "_Y1_Y2,,%ZISHDL1)
"RTN","ZISHVXD",108,0)
 .O %ZISHDL1:READONLY:1
"RTN","ZISHVXD",109,0)
 .I $T C %ZISHDL1:DELETE
"RTN","ZISHVXD",110,0)
 .S X=$&ZLIB.%PARSE(X1_X2)
"RTN","ZISHVXD",111,0)
 .S Y=$&ZLIB.%SPAWN("DEL "_X,,%ZISHDL1)
"RTN","ZISHVXD",112,0)
 .O %ZISHDL1:READONLY:1
"RTN","ZISHVXD",113,0)
 .I $T C %ZISHDL1:DELETE
"RTN","ZISHVXD",114,0)
 Q 1
"RTN","ZISHVXD",115,0)
PWD() ;ef,SR. Print working directory
"RTN","ZISHVXD",116,0)
 N Y
"RTN","ZISHVXD",117,0)
 S Y=$$DEFDIR("")
"RTN","ZISHVXD",118,0)
 S:Y="" Y=$&ZLIB.%PARSE("TMP.TMP",,,"DEVICE")_$&ZLIB.%DIRECTORY
"RTN","ZISHVXD",119,0)
 Q Y
"RTN","ZISHVXD",120,0)
 ;
"RTN","ZISHVXD",121,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHVXD",122,0)
 S DF=$G(DF) Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHVXD",123,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV"))
"RTN","ZISHVXD",124,0)
 ;Check syntax, VMS needs [ ] or $
"RTN","ZISHVXD",125,0)
 N P1,P2
"RTN","ZISHVXD",126,0)
 I DF[":" S P1=$P(DF,":")_":",P2=$P(DF,":",2)
"RTN","ZISHVXD",127,0)
 E  S P1="",P2=DF
"RTN","ZISHVXD",128,0)
 I P1="",P2["$" S DF=P2 Q DF ;Assume a logical
"RTN","ZISHVXD",129,0)
 I $L(P2) S:P2'["[" P2="["_P2 S:P2'["]" P2=P2_"]"
"RTN","ZISHVXD",130,0)
 S DF=P1_P2
"RTN","ZISHVXD",131,0)
 Q DF
"RTN","ZISHVXD",132,0)
STATUS() ;ef,SR. Return EOF status
"RTN","ZISHVXD",133,0)
 U $I:NOTRAP
"RTN","ZISHVXD",134,0)
 Q $$EOF($ZA)
"RTN","ZISHVXD",135,0)
 ;
"RTN","ZISHVXD",136,0)
EOF(X) ;Eof flag, Pass in $ZA
"RTN","ZISHVXD",137,0)
 Q (X=-1)
"RTN","ZISHVXD",138,0)
QL(X) ;Qlfrs
"RTN","ZISHVXD",139,0)
 Q:X=""
"RTN","ZISHVXD",140,0)
 S:$E(X)'="-" X="-"_X
"RTN","ZISHVXD",141,0)
 Q
"RTN","ZISHVXD",142,0)
FL(X) ;Fl len
"RTN","ZISHVXD",143,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHVXD",144,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHVXD",145,0)
 I $L(ZOSHP1)>14 S X=4 Q
"RTN","ZISHVXD",146,0)
 I $L(ZOSHP2)>8 S X=4 Q
"RTN","ZISHVXD",147,0)
 Q
"RTN","ZISHVXD",148,0)
 ;
"RTN","ZISHVXD",149,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHVXD",150,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHVXD",151,0)
 N I,F,MX
"RTN","ZISHVXD",152,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHVXD",153,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHVXD",154,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHVXD",155,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHVXD",156,0)
 I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHVXD",157,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHVXD",158,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHVXD",159,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHVXD",160,0)
 Q
"RTN","ZISHVXD",161,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;ef,SR. Unload contents of host file into global
"RTN","ZISHVXD",162,0)
 ;p1=host file directory 
"RTN","ZISHVXD",163,0)
 ;p2=host file name
"RTN","ZISHVXD",164,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHVXD",165,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHVXD",166,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHVXD",167,0)
 N %ZA,%ZB,%ZC,%ZL,X,%OVFCNT,%CONT
"RTN","ZISHVXD",168,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHLGR,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY,POP,%ZISUB
"RTN","ZISHVXD",169,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHVXD",170,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHVXD",171,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHVXD",172,0)
 I POP Q 0
"RTN","ZISHVXD",173,0)
 N $ETRAP S $ETRAP="",X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",174,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF(%ZA)  D
"RTN","ZISHVXD",175,0)
 . S @%ZISHF=%XX
"RTN","ZISHVXD",176,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHVXD",177,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHVXD",178,0)
 . Q
"RTN","ZISHVXD",179,0)
 D CLOSE() ;Normal exit
"RTN","ZISHVXD",180,0)
 Q 1
"RTN","ZISHVXD",181,0)
 ;
"RTN","ZISHVXD",182,0)
ERREOF D CLOSE() ;Got error Reading file
"RTN","ZISHVXD",183,0)
 Q 0
"RTN","ZISHVXD",184,0)
 ;
"RTN","ZISHVXD",185,0)
READNXT(REC) ;
"RTN","ZISHVXD",186,0)
 N T,I,X,%ZL
"RTN","ZISHVXD",187,0)
 U IO:NOTRAP R REC#255:5 S %ZA=$ZA,%ZB=$ZB,%ZL=%ZA Q:$$EOF(%ZA)
"RTN","ZISHVXD",188,0)
 F I=1:1:%ZL\255 R X#255:5 S %ZA=$ZA Q:$$EOF(%ZA)  S REC(I)=X
"RTN","ZISHVXD",189,0)
 Q
"RTN","ZISHVXD",190,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Load contents of global to host file.
"RTN","ZISHVXD",191,0)
 ;Previously name LOAD
"RTN","ZISHVXD",192,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",193,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",194,0)
 ;p3=host file directory
"RTN","ZISHVXD",195,0)
 ;p4=host file name
"RTN","ZISHVXD",196,0)
 N %ZISHY,%ZISHLGR,%ZISHOX
"RTN","ZISHVXD",197,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,$G(%ZX3),%ZX4,"W")
"RTN","ZISHVXD",198,0)
 Q %ZISHY
"RTN","ZISHVXD",199,0)
 ;
"RTN","ZISHVXD",200,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Append to host file.
"RTN","ZISHVXD",201,0)
 ;
"RTN","ZISHVXD",202,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",203,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",204,0)
 ;p3=host file directory
"RTN","ZISHVXD",205,0)
 ;p4=host file name
"RTN","ZISHVXD",206,0)
 N %ZISHY
"RTN","ZISHVXD",207,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,$G(%ZX3),%ZX4,"A")
"RTN","ZISHVXD",208,0)
 Q %ZISHY
"RTN","ZISHVXD",209,0)
 ;
"RTN","ZISHVXD",210,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHVXD",211,0)
 ;p1=$NAME of global reference
"RTN","ZISHVXD",212,0)
 ;p2=incrementing subscript
"RTN","ZISHVXD",213,0)
 ;p3=host file directory
"RTN","ZISHVXD",214,0)
 ;p4=host file name
"RTN","ZISHVXD",215,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHLGR,%ZISHS,%ZISHOX,IO,%ZX,Y
"RTN","ZISHVXD",216,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHVXD",217,0)
 D OPEN^%ZISH(,%ZX3,%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHVXD",218,0)
 I POP Q 0
"RTN","ZISHVXD",219,0)
 N X
"RTN","ZISHVXD",220,0)
 N $ETRAP S $ETRAP="",X="ERREOF^%ZISH",@^%ZOSF("TRAP")
"RTN","ZISHVXD",221,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHVXD",222,0)
 D CLOSE() ;Normal Exit
"RTN","ZISHVXD",223,0)
 Q 1
"RTN","ZISHVXD",224,0)
 ;
"RTN","ZTMGRSET")
0^8^B33082572
"RTN","ZTMGRSET",1,0)
ZTMGRSET ;SF/RWF SET UP THE MGR ACCOUNT FOR THE SYSTEM ;09/10/2002  17:13
"RTN","ZTMGRSET",2,0)
 ;;8.0;KERNEL;**34,36,69,94,121,127,136,191**;Jul 10, 1995
"RTN","ZTMGRSET",3,0)
 N %D,%S,I,OSMAX,U,X,X1,X2,Y,Z1,Z2,ZTOS,ZTMODE,SCR
"RTN","ZTMGRSET",4,0)
 S ZTMODE=0
"RTN","ZTMGRSET",5,0)
A W !!,"ZTMGRSET Version ",$P($T(+2),";",3)," ",$P($T(+2),";",5),!,"HELLO! I exist to assist you in correctly initializing the MGR account",!,"or to update the current account."
"RTN","ZTMGRSET",6,0)
 I $D(^%ZOSF("UCI")) X ^%ZOSF("UCI") I Y'["MG" W $C(7),!!,"THIS MAY NOT BE THE MANAGER UCI.",!," I think it is ",Y,". Should I continue anyway? N//" R X:120 G A:"YNyn"'[$E(X) Q:"Nn"[$E(X)
"RTN","ZTMGRSET",7,0)
 S ZTOS=$$OS() I ZTOS'>0 W !,"Can't determine the OS type." Q
"RTN","ZTMGRSET",8,0)
 I ZTMODE D  I (PCNM<1)!(PCNM>999) W !,"Need a Patch number to load." Q
"RTN","ZTMGRSET",9,0)
 . R !!,"Patch number to load: ",PCNM:120 Q:(PCNM<1)!(PCNM>999)
"RTN","ZTMGRSET",10,0)
 . S SCR="I $P($T(+2^@X),"";"",5)?.E1P1"_$C(34)_PCNM_$C(34)_"1P.E"
"RTN","ZTMGRSET",11,0)
 . Q
"RTN","ZTMGRSET",12,0)
 ;
"RTN","ZTMGRSET",13,0)
 K ^%ZOSF("MASTER"),^("SIGNOFF") ;Remove old nodes.
"RTN","ZTMGRSET",14,0)
DOIT W !!,"I will now rename a group of routines specific to your operating system."
"RTN","ZTMGRSET",15,0)
 D @ZTOS,ALL,GLOBALS:'ZTMODE W !,"ALL DONE" Q
"RTN","ZTMGRSET",16,0)
 ;
"RTN","ZTMGRSET",17,0)
RELOAD ;Reload any patched routines
"RTN","ZTMGRSET",18,0)
 N %D,%S,I,OSMAX,U,X,X1,X2,Y,Z1,Z2,ZTOS,ZTMODE,SCR
"RTN","ZTMGRSET",19,0)
 S ZTMODE=1 G A
"RTN","ZTMGRSET",20,0)
 Q
"RTN","ZTMGRSET",21,0)
OS() ;Select the OS
"RTN","ZTMGRSET",22,0)
 N Y,X1,X
"RTN","ZTMGRSET",23,0)
 S U="^",SCR="I 1" F I=1:1:20 S X=$T(@I) Q:X=""  S OSMAX=I
"RTN","ZTMGRSET",24,0)
B S Y=0,ZTOS=0 I $D(^%ZOSF("OS")) D
"RTN","ZTMGRSET",25,0)
 . S X1=$P(^%ZOSF("OS"),U),ZTOS=$$OSNUM W !,"I think you are using ",X1
"RTN","ZTMGRSET",26,0)
 W !,"Which MUMPS system should I install?",!
"RTN","ZTMGRSET",27,0)
 F I=1:1:OSMAX W !,I," = ",$P($T(@I),";",3)
"RTN","ZTMGRSET",28,0)
 W !,"System: " W:ZTOS ZTOS,"//" R X:300 S:X="" X=ZTOS I X<1!(X>OSMAX) W !,"NOT A VALID CHOICE" Q:X[U 0 G B
"RTN","ZTMGRSET",29,0)
 Q X
"RTN","ZTMGRSET",30,0)
OSNUM() ;Return the OS number
"RTN","ZTMGRSET",31,0)
 N I,X1,X2,Y S Y=0,X1=$P($G(^%ZOSF("OS")),"^")
"RTN","ZTMGRSET",32,0)
 F I=1:1 S X2=$T(@I) Q:X2=""  I X2[X1 S Y=I Q
"RTN","ZTMGRSET",33,0)
 Q Y
"RTN","ZTMGRSET",34,0)
ALL W !!,"Now to load routines common to all systems."
"RTN","ZTMGRSET",35,0)
 D TM,ETRAP,DEV,OTHER
"RTN","ZTMGRSET",36,0)
 W !,"Installing ^%Z editor" D ^ZTEDIT
"RTN","ZTMGRSET",37,0)
 I 'ZTMODE W !,"Setting ^%ZIS('C')" K ^%ZIS("C") S ^%ZIS("C")="G ^%ZISC"
"RTN","ZTMGRSET",38,0)
 Q
"RTN","ZTMGRSET",39,0)
 ;
"RTN","ZTMGRSET",40,0)
TM S %S="ZTLOAD^ZTLOAD1^ZTLOAD2^ZTLOAD3^ZTLOAD4^ZTLOAD5^ZTLOAD6^ZTLOAD7^ZTM^ZTM0^ZTM1^ZTM2^ZTM3^ZTM4^ZTM5^ZTM6^ZTMS^ZTMS0^ZTMS1^ZTMS2^ZTMS3^ZTMS4^ZTMS7^ZTMSH"
"RTN","ZTMGRSET",41,0)
 S %D="%ZTLOAD^%ZTLOAD1^%ZTLOAD2^%ZTLOAD3^%ZTLOAD4^%ZTLOAD5^%ZTLOAD6^%ZTLOAD7^%ZTM^%ZTM0^%ZTM1^%ZTM2^%ZTM3^%ZTM4^%ZTM5^%ZTM6^%ZTMS^%ZTMS0^%ZTMS1^%ZTMS2^%ZTMS3^%ZTMS4^%ZTMS7^%ZTMSH"
"RTN","ZTMGRSET",42,0)
 D MOVE
"RTN","ZTMGRSET",43,0)
 Q
"RTN","ZTMGRSET",44,0)
ETRAP S %S="ZTER^ZTER1",%D="%ZTER^%ZTER1" D MOVE
"RTN","ZTMGRSET",45,0)
 Q
"RTN","ZTMGRSET",46,0)
OTHER S %S="ZTPP^ZTP1^ZTPTCH^ZTRDEL^ZTMOVE",%D="%ZTPP^%ZTP1^%ZTPTCH^%ZTRDEL^%ZTMOVE" D MOVE
"RTN","ZTMGRSET",47,0)
 Q
"RTN","ZTMGRSET",48,0)
DEV S %S="ZIS^ZIS1^ZIS2^ZIS3^ZIS5^ZIS6^ZIS7^ZISC^ZISP^ZISS^ZISS1^ZISS2^ZISTCP^ZISUTL"
"RTN","ZTMGRSET",49,0)
 S %D="%ZIS^%ZIS1^%ZIS2^%ZIS3^%ZIS5^%ZIS6^%ZIS7^%ZISC^%ZISP^%ZISS^%ZISS1^%ZISS2^%ZISTCP^%ZISUTL"
"RTN","ZTMGRSET",50,0)
 D MOVE
"RTN","ZTMGRSET",51,0)
 Q
"RTN","ZTMGRSET",52,0)
RUM ;Build the routines for Capacity Management (CM)
"RTN","ZTMGRSET",53,0)
 S %S=""
"RTN","ZTMGRSET",54,0)
 I ZTOS=1 S %S="ZOSVKRV^ZOSVKSVE^ZOSVKSVS^ZOSVKSD" ;DSM
"RTN","ZTMGRSET",55,0)
 I ZTOS=2 S %S="ZOSVKRM^ZOSVKSME^ZOSVKSMS^ZOSVKSD" ;MSM
"RTN","ZTMGRSET",56,0)
 I ZTOS=3 S %S="ZOSVKRO^ZOSVKSOE^ZOSVKSOS^ZOSVKSD" ;OpenM
"RTN","ZTMGRSET",57,0)
 S %D="%ZOSVKR^%ZOSVKSE^%ZOSVKSS^%ZOSVKSD"
"RTN","ZTMGRSET",58,0)
 D MOVE
"RTN","ZTMGRSET",59,0)
 Q
"RTN","ZTMGRSET",60,0)
ZOSF(X) ;
"RTN","ZTMGRSET",61,0)
 X SCR I $T D @(U_X)
"RTN","ZTMGRSET",62,0)
 Q
"RTN","ZTMGRSET",63,0)
1 ;;VAX DSM(V6), VAX DSM(V7)
"RTN","ZTMGRSET",64,0)
 S %S="ZOSVVXD^ZTBKCVXD^ZIS4VXD^ZISFVXD^ZISHVXD^XUCIVXD^ZISETVXD"
"RTN","ZTMGRSET",65,0)
 D DES,MOVE
"RTN","ZTMGRSET",66,0)
 S %S="ZOSV2VXD^ZTMDCL",%D="%ZOSV2^%ZTMDCL"
"RTN","ZTMGRSET",67,0)
 D MOVE,RUM,ZOSF("ZOSFVXD")
"RTN","ZTMGRSET",68,0)
 Q
"RTN","ZTMGRSET",69,0)
2 ;;MSM-PC/PLUS, MSM for NT or UNIX
"RTN","ZTMGRSET",70,0)
 W !,"- Use autostart to do ZTMB don't resave as STUSER."
"RTN","ZTMGRSET",71,0)
 S %S="ZOSVMSM^ZTBKCMSM^ZIS4MSM^ZISFMSM^ZISHMSM^XUCIMSM^ZISETMSM"
"RTN","ZTMGRSET",72,0)
 D DES,MOVE
"RTN","ZTMGRSET",73,0)
 S %S="ZOSV2MSM",%D="%ZOSV2"
"RTN","ZTMGRSET",74,0)
 D MOVE,RUM,ZOSF("ZOSFMSM")
"RTN","ZTMGRSET",75,0)
 I $$VERSION^%ZOSV(1)["UNIX" S %S="ZISHMSU",%D="%ZISH" D MOVE
"RTN","ZTMGRSET",76,0)
 Q
"RTN","ZTMGRSET",77,0)
3 ;;OpenM-NT, Cache/NT, Cache/VMS
"RTN","ZTMGRSET",78,0)
 S %S="ZOSVONT^^ZIS4ONT^ZISFONT^ZISHONT^XUCIONT"
"RTN","ZTMGRSET",79,0)
 D DES,MOVE
"RTN","ZTMGRSET",80,0)
 S %S="ZISTCPS",%D="%ZISTCPS"
"RTN","ZTMGRSET",81,0)
 D MOVE,RUM,ZOSF("ZOSFONT")
"RTN","ZTMGRSET",82,0)
 Q
"RTN","ZTMGRSET",83,0)
4 ;;Datatree, DTM-PC, DT-MAX
"RTN","ZTMGRSET",84,0)
 S %S="ZOSVDTM^ZTBKCDTM^ZIS4DTM^ZISFDTM^ZISHDTM^XUCIDTM^ZISETDTM"
"RTN","ZTMGRSET",85,0)
 D DES,MOVE
"RTN","ZTMGRSET",86,0)
 S %S="ZOSV1DTM^ZTMB",%D="%ZOSV1^%ustart"
"RTN","ZTMGRSET",87,0)
 D MOVE,ZOSF("ZOSFDTM")
"RTN","ZTMGRSET",88,0)
 Q
"RTN","ZTMGRSET",89,0)
5 ;;MVX,ISM VAX
"RTN","ZTMGRSET",90,0)
 S %S="ZOSVMSQ^ZTBKCMSQ^ZIS4MSQ^ZISFMSQ^ZISHMSQ^XUCIMSQ^ZISETMSQ"
"RTN","ZTMGRSET",91,0)
 D DES,MOVE
"RTN","ZTMGRSET",92,0)
 S %S="ZTMB",%D="ZSTU"
"RTN","ZTMGRSET",93,0)
 D MOVE,ZOSF("ZOSFMSQ")
"RTN","ZTMGRSET",94,0)
 Q
"RTN","ZTMGRSET",95,0)
6 ;;ISM (UNIX, Open VMS)
"RTN","ZTMGRSET",96,0)
 S %S="ZOSVIS2^^ZIS4IS2^ZISFIS2^ZISHIS2^XUCIIS2^ZISETIS2"
"RTN","ZTMGRSET",97,0)
 D DES,MOVE
"RTN","ZTMGRSET",98,0)
 S %S="ZTMB",%D="ZSTU"
"RTN","ZTMGRSET",99,0)
 D MOVE,ZOSF("ZOSFIS2")
"RTN","ZTMGRSET",100,0)
 Q
"RTN","ZTMGRSET",101,0)
10 ;;NOT SUPPORTED
"RTN","ZTMGRSET",102,0)
 Q
"RTN","ZTMGRSET",103,0)
MOVE ;
"RTN","ZTMGRSET",104,0)
 F %=1:1:$L(%D,"^") S X=$P(%S,U,%),Y=$P(%D,U,%) W !,"Routine: ",X I X]"",Y]"",$T(^@X)]"" X SCR I $T W ?20,"  Loaded, " X "ZL @X ZS @Y" W ?20,"Saved as ",Y
"RTN","ZTMGRSET",105,0)
 Q
"RTN","ZTMGRSET",106,0)
DES S %D="%ZOSV^%ZTBKC1^%ZIS4^%ZISF^%ZISH^%XUCI^ZISETUP" Q
"RTN","ZTMGRSET",107,0)
 ;
"RTN","ZTMGRSET",108,0)
GLOBALS ;Set node zero of file #3.05 & #3.07
"RTN","ZTMGRSET",109,0)
 W !!,"Now, I will check your % globals."
"RTN","ZTMGRSET",110,0)
 W ".........."
"RTN","ZTMGRSET",111,0)
 F %="^%ZIS","^%ZISL","^%ZTER","^%ZUA" S:'$D(@%) @%=""
"RTN","ZTMGRSET",112,0)
 S:$D(^%ZTSK(0))[0 ^%ZTSK(-1)=100,^%ZTSCH=""
"RTN","ZTMGRSET",113,0)
 S Z1=$G(^%ZTSK(-1),-1),Z2=$G(^%ZTSK(0))
"RTN","ZTMGRSET",114,0)
 I Z1'=$P(Z2,"^",3) S:Z1'>0 ^%ZTSK(-1)=+Z2 S ^%ZTSK(0)="TASK'S^14.4^"_^%ZTSK(-1)
"RTN","ZTMGRSET",115,0)
 S:$D(^%ZUA(3.05,0))[0 ^%ZUA(3.05,0)="FAILED ACCESS ATTEMPTS LOG^3.05^^"
"RTN","ZTMGRSET",116,0)
 S:$D(^%ZUA(3.07,0))[0 ^%ZUA(3.07,0)="PROGRAMMER MODE LOG^3.07^^"
"RTN","ZTMGRSET",117,0)
 Q
"RTN","ZTMGRSET",118,0)
NAME ;Setup the static names for this system
"RTN","ZTMGRSET",119,0)
MGR W !,"NAME OF MANAGER'S UCI,VOLUME SET: "_^%ZOSF("MGR")_"// " R X:$S($G(DTIME):DTIME,1:9999) I X]"" X ^("UCICHECK") G MGR:0[Y S ^%ZOSF("MGR")=X
"RTN","ZTMGRSET",120,0)
PROD W !,"PRODUCTION (SIGN-ON) UCI,VOLUME SET: "_^%ZOSF("PROD")_"// " R X:$S($G(DTIME):DTIME,1:9999) I X]"" X ^("UCICHECK") G PROD:0[Y S ^%ZOSF("PROD")=Y
"RTN","ZTMGRSET",121,0)
VOL W !,"NAME OF VOLUME SET: "_^%ZOSF("VOL")_"//" R X:$S($G(DTIME):DTIME,1:9999) I X]"" S:X?3U ^%ZOSF("VOL")=X I X'?3U W "MUST BE 3 Upper case." G VOL
"RTN","ZTMGRSET",122,0)
 W ! Q
"VER")
8.0^22.0
**END**
**END**
