Released ACKQ*3*10 SEQ #10
Extracted from mail message
**KIDS**:ACKQ*3.0*10^

**INSTALL NAME**
ACKQ*3.0*10
"BLD",5707,0)
ACKQ*3.0*10^QUASAR^0^3060104^y
"BLD",5707,1,0)
^^3^3^3040823^^
"BLD",5707,1,1,0)
This patch will correct to problem with in QUASAR
"BLD",5707,1,2,0)
that allows the user to create a new visit for
"BLD",5707,1,3,0)
deceased patients.
"BLD",5707,4,0)
^9.64PA^^
"BLD",5707,"ABPKG")
n
"BLD",5707,"KRN",0)
^9.67PA^8989.52^19
"BLD",5707,"KRN",.4,0)
.4
"BLD",5707,"KRN",.401,0)
.401
"BLD",5707,"KRN",.402,0)
.402
"BLD",5707,"KRN",.403,0)
.403
"BLD",5707,"KRN",.5,0)
.5
"BLD",5707,"KRN",.84,0)
.84
"BLD",5707,"KRN",3.6,0)
3.6
"BLD",5707,"KRN",3.8,0)
3.8
"BLD",5707,"KRN",9.2,0)
9.2
"BLD",5707,"KRN",9.8,0)
9.8
"BLD",5707,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5707,"KRN",9.8,"NM",1,0)
ACKQAS^^0^B84322595
"BLD",5707,"KRN",9.8,"NM","B","ACKQAS",1)

"BLD",5707,"KRN",19,0)
19
"BLD",5707,"KRN",19.1,0)
19.1
"BLD",5707,"KRN",101,0)
101
"BLD",5707,"KRN",409.61,0)
409.61
"BLD",5707,"KRN",771,0)
771
"BLD",5707,"KRN",870,0)
870
"BLD",5707,"KRN",8989.51,0)
8989.51
"BLD",5707,"KRN",8989.52,0)
8989.52
"BLD",5707,"KRN",8994,0)
8994
"BLD",5707,"KRN","B",.4,.4)

"BLD",5707,"KRN","B",.401,.401)

"BLD",5707,"KRN","B",.402,.402)

"BLD",5707,"KRN","B",.403,.403)

"BLD",5707,"KRN","B",.5,.5)

"BLD",5707,"KRN","B",.84,.84)

"BLD",5707,"KRN","B",3.6,3.6)

"BLD",5707,"KRN","B",3.8,3.8)

"BLD",5707,"KRN","B",9.2,9.2)

"BLD",5707,"KRN","B",9.8,9.8)

"BLD",5707,"KRN","B",19,19)

"BLD",5707,"KRN","B",19.1,19.1)

"BLD",5707,"KRN","B",101,101)

"BLD",5707,"KRN","B",409.61,409.61)

"BLD",5707,"KRN","B",771,771)

"BLD",5707,"KRN","B",870,870)

"BLD",5707,"KRN","B",8989.51,8989.51)

"BLD",5707,"KRN","B",8989.52,8989.52)

"BLD",5707,"KRN","B",8994,8994)

"BLD",5707,"QUES",0)
^9.62^^
"BLD",5707,"REQB",0)
^9.611^1^1
"BLD",5707,"REQB",1,0)
ACKQ*3.0*1^1
"BLD",5707,"REQB","B","ACKQ*3.0*1",1)

"MBREQ")
0
"PKG",473,-1)
1^1
"PKG",473,0)
QUASAR^ACKQ^Quality: Audiology and Speech Pathology Audit and Review
"PKG",473,22,0)
^9.49I^1^1
"PKG",473,22,1,0)
3.0^3000211^3000224^66481
"PKG",473,22,1,"PAH",1,0)
10^3060104^100104
"PKG",473,22,1,"PAH",1,1,0)
^^3^3^3060104
"PKG",473,22,1,"PAH",1,1,1,0)
This patch will correct to problem with in QUASAR
"PKG",473,22,1,"PAH",1,1,2,0)
that allows the user to create a new visit for
"PKG",473,22,1,"PAH",1,1,3,0)
deceased patients.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ACKQAS")
0^1^B84322595
"RTN","ACKQAS",1,0)
ACKQAS ;AUG/JLTP BIR/PTD HCIOFO/BH-New Clinic Visits ;  04/01/99 
"RTN","ACKQAS",2,0)
 ;;3.0;QUASAR;**1,10**;Feb 11, 2000
"RTN","ACKQAS",3,0)
 ;Call DEM^VADPT supported by DBIA #10061
"RTN","ACKQAS",4,0)
 ;
"RTN","ACKQAS",5,0)
 ;Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","ACKQAS",6,0)
 ;
"RTN","ACKQAS",7,0)
IVD ;  INITIAL VISIT DATE  ** TRIGGERED FROM PATIENT NAME ***
"RTN","ACKQAS",8,0)
 N Y,DDD,DD,DFN,D0,%DT
"RTN","ACKQAS",9,0)
 S DFN=X,X=$S('$D(^ACK(509850.2,DFN,0)):"",'$P(^(0),U,2):"",1:$P(^(0),U,2))
"RTN","ACKQAS",10,0)
 I 'X D
"RTN","ACKQAS",11,0)
 . F  D  Q:X=""!(X'>DT)
"RTN","ACKQAS",12,0)
 .. S Y=ACKVD D DD^%DT S %DT="AEP",%DT("A")="INITIAL VISIT DATE: "
"RTN","ACKQAS",13,0)
 .. S %DT("B")=Y D ^%DT K %DT S X=$S(Y<1:"",1:Y)
"RTN","ACKQAS",14,0)
 .. I X>DT W !,"No Future Dates Allowed",!
"RTN","ACKQAS",15,0)
 K A1
"RTN","ACKQAS",16,0)
 Q
"RTN","ACKQAS",17,0)
 ;
"RTN","ACKQAS",18,0)
VISIT ;  New visit data input
"RTN","ACKQAS",19,0)
 N ACKOUT
"RTN","ACKQAS",20,0)
 I '$O(^ACK(509850.8,0)) W !,"A&SP site parameters must be established before visits can be entered.",! Q
"RTN","ACKQAS",21,0)
 ;
"RTN","ACKQAS",22,0)
 D LIST^DIC(509850.83,",1,",".01","I","*","","","","","","ACKTRGT","ACKMSG")
"RTN","ACKQAS",23,0)
 I '$P($G(ACKTRGT("DILIST",0)),U,1) W !,"No Divisions have been set up select the Site Parameters function to set up",!,"Division entries.",! Q
"RTN","ACKQAS",24,0)
 ;
"RTN","ACKQAS",25,0)
 ;  Get the Division
"RTN","ACKQAS",26,0)
DIV ;
"RTN","ACKQAS",27,0)
 I $D(ACKDVN),$D(CLINVARR),$P($G(ACKDVN),U,2)=1,$G(CLINVARR)<2 G VEXIT
"RTN","ACKQAS",28,0)
 D VEXIT
"RTN","ACKQAS",29,0)
 S ACKDVN=$$DIV^ACKQUTL2(1,.ACKDIV) G:$P(ACKDVN,U,1)="0" VEXIT
"RTN","ACKQAS",30,0)
 I '$P(ACKDVN,U,2) W !!!!!,"No Active Divisions Set up on Site Parameters File" W ! H 1 G VEXIT
"RTN","ACKQAS",31,0)
 S ACKDIV=$O(ACKDIV("")),ACKDIV=$P(ACKDIV(ACKDIV),U,1)  ;  use division IEN of Parameter file   
"RTN","ACKQAS",32,0)
 I $P(ACKDVN,U,2)>1 W "            Station Number : "_$$GET1^DIQ(40.8,ACKDIV,1)
"RTN","ACKQAS",33,0)
 ;
"RTN","ACKQAS",34,0)
 ;  Get clinic
"RTN","ACKQAS",35,0)
CLIN S ACKCLIN=$$CLIN^ACKQASU1(ACKDIV,"U") G:ACKCLIN=""&($P($G(ACKDVN),U,2)=1) VEXIT  G:ACKCLIN="" DIV
"RTN","ACKQAS",36,0)
 I ACKCLIN=0 W !!!!!,"No Clinics set up for Division " W ! H 1 G DIV
"RTN","ACKQAS",37,0)
 S ACKCLIN=$P(ACKCLIN,U,1)  ;  Use clinic IEN from Clinic file
"RTN","ACKQAS",38,0)
 ;  Get Clinic stop code
"RTN","ACKQAS",39,0)
 D STOP
"RTN","ACKQAS",40,0)
 ;
"RTN","ACKQAS",41,0)
 W !!!,"Clinic: ",$$GET1^DIQ(44,ACKCLIN,.01),"          Stop Code: ",ACKCSC(1)
"RTN","ACKQAS",42,0)
 ;
"RTN","ACKQAS",43,0)
 ;  Get visit date
"RTN","ACKQAS",44,0)
VDATE S DIR(0)="D^:DT:AEX",DIR("A")="Enter Visit Date",DIR("B")="TODAY"
"RTN","ACKQAS",45,0)
 S DIR("?")="Enter the visit date or press return for TODAY. Future dates not allowed",DIR("??")="^D HELP^%DTC"
"RTN","ACKQAS",46,0)
 D ^DIR K DIR I X?1"^"1.E W !,"Jumping not allowed." G VDATE
"RTN","ACKQAS",47,0)
 G:$D(DIRUT) DIV
"RTN","ACKQAS",48,0)
 S ACKVD=Y
"RTN","ACKQAS",49,0)
 ;
"RTN","ACKQAS",50,0)
 ;
"RTN","ACKQAS",51,0)
PATIENT S DIC="^ACK(509850.2,",DIC(0)="AEMQL",DLAYGO=509850.2
"RTN","ACKQAS",52,0)
 S DIC("W")="N ACKA,ACKB S ACKA=$$GET1^DIQ(2,Y,.03),ACKB=$$GET1^DIQ(2,Y,.09),ACKA=$E(ACKA,1,2)_""-""_$E(ACKA,4,5)_""-""_$E(ACKA,9,10) W ?36,ACKA_""     ""_ACKB"
"RTN","ACKQAS",53,0)
 S ACKLAYGO="" D ^DIC I X?1"^"1.E W !,"Jumping not allowed." G PATIENT
"RTN","ACKQAS",54,0)
 G:$D(DTOUT) DIV
"RTN","ACKQAS",55,0)
 I X="^" G DIV
"RTN","ACKQAS",56,0)
 I Y<0 W !,"This is a required response. Enter '^' to exit" G PATIENT
"RTN","ACKQAS",57,0)
 S (ACKPAT,DFN)=+Y
"RTN","ACKQAS",58,0)
 S ACKDFN=DFN
"RTN","ACKQAS",59,0)
 ;; ACKQ*3*10  ADD CHECK FOR DECEASED PATIENT
"RTN","ACKQAS",60,0)
 S ACKOUT=0
"RTN","ACKQAS",61,0)
 D CHKDTH
"RTN","ACKQAS",62,0)
 I ACKOUT=1 S ACKOUT=0 G PATIENT
"RTN","ACKQAS",63,0)
 ;; END ACKQ*3*10
"RTN","ACKQAS",64,0)
 ;  Check to see if Patient has a Primary Eligibility
"RTN","ACKQAS",65,0)
 I '$$ELIGCHK^ACKQASU W !!,"DATA ERROR : Patient has no Primary Eligibility defined on the Patient File.",!,"This requires updating before QUASAR processing can commence.",! D VEXIT G DIV
"RTN","ACKQAS",66,0)
 ;
"RTN","ACKQAS",67,0)
 ; check for duplicate visits (same date/same patient) allow user to select one
"RTN","ACKQAS",68,0)
 S ACKVSEL=$$DUPCHK^ACKQASU1(ACKPAT,ACKVD) G:ACKVSEL=-1 DIV
"RTN","ACKQAS",69,0)
 S (DA,ACKY)=ACKVSEL  ; either 0 (no visit selected) or selected visit ien
"RTN","ACKQAS",70,0)
 ;
"RTN","ACKQAS",71,0)
 S (ACKFLG1,ACKFLG2)=0 I DA D  I (ACKFLG1)!(ACKFLG2) D VEXIT G VISIT
"RTN","ACKQAS",72,0)
 .;  Compare clinic location/stop code of selected visit with
"RTN","ACKQAS",73,0)
 .;  original clinic location/stop code.
"RTN","ACKQAS",74,0)
 .S ACKESITE=$P($G(^ACK(509850.6,ACKY,0)),U,6),ACKECSC=$P($G(^ACK(509850.6,ACKY,2)),U)
"RTN","ACKQAS",75,0)
 .I ACKESITE'=ACKCLIN S ACKFLG1=1
"RTN","ACKQAS",76,0)
 .I ACKECSC'=ACKCSC S ACKFLG2=1
"RTN","ACKQAS",77,0)
 .I (ACKFLG1)!(ACKFLG2) K DA D
"RTN","ACKQAS",78,0)
 ..W !!,"The "_$S(ACKFLG1:"clinic location",1:"clinic stop code")_" for the selected appointment does not match",!,"the current "_$S(ACKFLG1:"clinic location",1:"clinic stop code")_".  Transaction not allowed.",!
"RTN","ACKQAS",79,0)
 ;
"RTN","ACKQAS",80,0)
 ; Get PCE flag - 1 if division set to send to PCE else 0
"RTN","ACKQAS",81,0)
 S ACKPCE=$$PCE^ACKQUTL4(ACKDIV,ACKVD)
"RTN","ACKQAS",82,0)
 ;
"RTN","ACKQAS",83,0)
 ;  Existing A&SP Patient
"RTN","ACKQAS",84,0)
 I DA D EDIT^ACKQAS5 G VISIT
"RTN","ACKQAS",85,0)
 ;
"RTN","ACKQAS",86,0)
 ;  New visit
"RTN","ACKQAS",87,0)
 K DD,DO,DA,D0
"RTN","ACKQAS",88,0)
 S ACKVISIT="NEW",ACKVTME=""   ;  indicates this is a new visit
"RTN","ACKQAS",89,0)
 ;             
"RTN","ACKQAS",90,0)
 ; If PCE interface not on skip to Call Template logic
"RTN","ACKQAS",91,0)
 I 'ACKPCE S ACKVTME="" G FILE
"RTN","ACKQAS",92,0)
 ;
"RTN","ACKQAS",93,0)
PCE ;  Select a PCE visit
"RTN","ACKQAS",94,0)
 ;
"RTN","ACKQAS",95,0)
 ;  Run function to check if there is a PCE visit for today
"RTN","ACKQAS",96,0)
 I '$$PCEVST1^ACKQASU1(ACKVD,ACKPAT,ACKCLIN) G APPMNT
"RTN","ACKQAS",97,0)
 ;
"RTN","ACKQAS",98,0)
 ;  As PCE visits must exist on the visit date run the API that displays
"RTN","ACKQAS",99,0)
 ;  them and prompts the user to either select one or add a new visit.
"RTN","ACKQAS",100,0)
 S ACKPCENO=$$VISITLST^PXAPI(ACKPAT,ACKVD,ACKVD,ACKCLIN,"APO","","A")
"RTN","ACKQAS",101,0)
 I ACKPCENO="-1" G DIV  ;  Go back to Division prompt if '^' entered
"RTN","ACKQAS",102,0)
 S ACKVTME=""
"RTN","ACKQAS",103,0)
 ;  I ACKPCENO="A" 'ADD' selected user wishes to create new visit
"RTN","ACKQAS",104,0)
 I ACKPCENO'="A" G FILE
"RTN","ACKQAS",105,0)
 ;
"RTN","ACKQAS",106,0)
APPMNT ;  Check for any appointments for the patient on this date.
"RTN","ACKQAS",107,0)
 S VASD("C",ACKCLIN)="",VASD("T")=ACKVD,VASD("F")=ACKVD
"RTN","ACKQAS",108,0)
 S VASD("W")="129"
"RTN","ACKQAS",109,0)
 K ^UTILITY("VASD",$J) D SDA^VADPT
"RTN","ACKQAS",110,0)
 I '$D(^UTILITY("VASD",$J)) G FILE  ;  If no appointments goto PCE check
"RTN","ACKQAS",111,0)
 ;
"RTN","ACKQAS",112,0)
 ;  Displays headings and appointments
"RTN","ACKQAS",113,0)
 ;
"RTN","ACKQAS",114,0)
 D DISP^ACKQASU
"RTN","ACKQAS",115,0)
 ;
"RTN","ACKQAS",116,0)
 ;  User is prompted to choose or create a new visit.
"RTN","ACKQAS",117,0)
 ;
"RTN","ACKQAS",118,0)
APPMNT1 S ACKNUM=$O(^UTILITY("VASD",$J,""),-1)
"RTN","ACKQAS",119,0)
 S DIR("A")=" Select Appointment (1-"_ACKNUM_") or (N)ew Visit "
"RTN","ACKQAS",120,0)
 S DIR("B")=1
"RTN","ACKQAS",121,0)
 S DIR("?")=" Select number on left of the list or 'N' for New Visit"
"RTN","ACKQAS",122,0)
 S DIR(0)="F^1:2^S:X=""n"" X=""N"" K:X'=""N""&((+X<1)!(+X>ACKNUM)) X"
"RTN","ACKQAS",123,0)
 D ^DIR K DIR,ACKNUM
"RTN","ACKQAS",124,0)
 I X?1"^"1.E W !,"Jumping not allowed." G APPMNT1
"RTN","ACKQAS",125,0)
 G:$D(DIRUT) DIV  ;  Go back to division if '^' entered.
"RTN","ACKQAS",126,0)
 ;
"RTN","ACKQAS",127,0)
 I X'="N"&(X'="n") S X=+X,ACKVTME=$P(^UTILITY("VASD",$J,X,"I"),U,1),ACKVTME=$P(ACKVTME,".",2),ACKAPMNT=1
"RTN","ACKQAS",128,0)
 K ^UTILITY("VASD",$J)
"RTN","ACKQAS",129,0)
 ;
"RTN","ACKQAS",130,0)
FILE ; Set up dummy record and run input template 
"RTN","ACKQAS",131,0)
 ;
"RTN","ACKQAS",132,0)
 ; If Appointment Time is not yet known, but a PCE Visit was selected, get the time
"RTN","ACKQAS",133,0)
 I ACKVTME="",ACKPCE,$G(ACKPCENO)'="",$G(ACKPCENO)'="A" D
"RTN","ACKQAS",134,0)
 . S ACKVTME=$$GETPCETM^ACKQASU(ACKPCENO),ACKVTME=$P($P(ACKVTME,U,1),".",2)
"RTN","ACKQAS",135,0)
 . I 'ACKVTME S ACKVTME="" Q
"RTN","ACKQAS",136,0)
 ;
"RTN","ACKQAS",137,0)
 I ACKPCE,$G(ACKAPMNT)'=1,'$$ACKAPMNT^ACKQASU7(ACKVD,ACKVTME,ACKCLIN,ACKPAT) D VEXIT,HEADING G VISIT
"RTN","ACKQAS",138,0)
 K ACKAPMNT
"RTN","ACKQAS",139,0)
 ;
"RTN","ACKQAS",140,0)
 ;  Check to see if entry is on 'APCE' cross ref. if so either return to 
"RTN","ACKQAS",141,0)
 ;  Division prompt or null out appointment time variable. 
"RTN","ACKQAS",142,0)
 I ACKVTME'="",$D(^ACK(509850.6,"APCE",ACKPAT,ACKCLIN,ACKVD,"."_ACKVTME)) D  I 'ACKQCHK D UNLOCK,VEXIT,HEADING G VISIT
"RTN","ACKQAS",143,0)
 . S ACKQCHK=$$DUPEDATA^ACKQASU(ACKPAT,ACKCLIN,ACKVD,"."_ACKVTME)
"RTN","ACKQAS",144,0)
 . I 'ACKQCHK Q
"RTN","ACKQAS",145,0)
 . ; user has decided to continue, so TIME is deleted and PCE VISIT is deleted
"RTN","ACKQAS",146,0)
 . ; this ensures that the visit is treated as brand new when sent to PCE
"RTN","ACKQAS",147,0)
 . S ACKVTME=""   ; time
"RTN","ACKQAS",148,0)
 . S ACKPCENO=""  ; pce visit ien
"RTN","ACKQAS",149,0)
 ;
"RTN","ACKQAS",150,0)
 ; create new visit entry
"RTN","ACKQAS",151,0)
 ;
"RTN","ACKQAS",152,0)
 S DIC="^ACK(509850.6,",DIC(0)="L",DLAYGO=509850.6,ACKLAYGO=""
"RTN","ACKQAS",153,0)
 S X=ACKVD D FILE^DICN,CHKDT  ;  File a dummy record prior to template
"RTN","ACKQAS",154,0)
 S ACKVIEN=+$P(Y,U,1)         ; Get visit IEN from Y value.
"RTN","ACKQAS",155,0)
 ;
"RTN","ACKQAS",156,0)
 K ACKARR
"RTN","ACKQAS",157,0)
 S ACKARR(509850.6,ACKVIEN_",",2.6)=ACKCLIN
"RTN","ACKQAS",158,0)
 S ACKARR(509850.6,ACKVIEN_",",60)=ACKDIV
"RTN","ACKQAS",159,0)
 I +ACKVTME S ACKARR(509850.6,ACKVIEN_",",55)="."_ACKVTME        ; file time if known
"RTN","ACKQAS",160,0)
 I +$G(ACKPCENO)'=0 S ACKARR(509850.6,ACKVIEN_",",125)=ACKPCENO  ; file PCE number if one selected
"RTN","ACKQAS",161,0)
 D STOP S ACKARR(509850.6,ACKVIEN_",",4)=ACKCSC                  ; file visit stop (required by COPYPCE)
"RTN","ACKQAS",162,0)
 D FILE^DIE("","ACKARR")
"RTN","ACKQAS",163,0)
 ;
"RTN","ACKQAS",164,0)
 ; Lock the record
"RTN","ACKQAS",165,0)
 L +^ACK(509850.6,ACKVIEN)
"RTN","ACKQAS",166,0)
 ;
"RTN","ACKQAS",167,0)
 ;  Write away any derived PCE values to visit record 
"RTN","ACKQAS",168,0)
 I ACKPCE,$G(ACKPCENO)'="",$G(ACKPCENO)'="A" D  I +ACKERR D DEL,UNLOCK,VEXIT,HEADING G VISIT
"RTN","ACKQAS",169,0)
 . S ACKERR=$$COPYPCE^ACKQASU4(ACKVIEN,ACKPCENO)
"RTN","ACKQAS",170,0)
 . ; if error found, display and reset ACKERR according to whether the 
"RTN","ACKQAS",171,0)
 . ; user wants to continue (SHOWPCE returns 1=exit,0=continue)
"RTN","ACKQAS",172,0)
 . I +ACKERR S ACKERR=$$SHOWPCE^ACKQASU7($NA(^TMP("ACKQASU4",$J,"COPYPCE","ERROR")))
"RTN","ACKQAS",173,0)
 ;
"RTN","ACKQAS",174,0)
 ;
"RTN","ACKQAS",175,0)
TPLATE ;   Call template
"RTN","ACKQAS",176,0)
 S DIE="^ACK(509850.6,",(DA,ACKDA)=ACKVIEN,DR="[ACKQAS VISIT ENTRY]" D ^DIE
"RTN","ACKQAS",177,0)
 ;
"RTN","ACKQAS",178,0)
 K ACKREQ
"RTN","ACKQAS",179,0)
 I $G(ACKLOSS)'="",$$AUDIO^ACKQUTL4 D UTLAUD^ACKQASU2
"RTN","ACKQAS",180,0)
 S ACKQTST=$$POST^ACKQASU2(ACKVIEN) I 'ACKQTST S ACKDFN=DFN G TPLATE
"RTN","ACKQAS",181,0)
 I ACKPCE,ACKQTST=1 I '$$PCESEND^ACKQASU3(ACKVIEN) S ACKDFN=DFN G TPLATE
"RTN","ACKQAS",182,0)
 D UNLOCK,VEXIT,HEADING G VISIT
"RTN","ACKQAS",183,0)
 ;
"RTN","ACKQAS",184,0)
VEXIT ;  Kill off variables at end of processing
"RTN","ACKQAS",185,0)
 ;
"RTN","ACKQAS",186,0)
 D KILL^ACKQASU
"RTN","ACKQAS",187,0)
 D KILL^%ZISS
"RTN","ACKQAS",188,0)
 Q
"RTN","ACKQAS",189,0)
 ;
"RTN","ACKQAS",190,0)
AOA ;  COMPUTE AGE ON APPOINTMENT DATE
"RTN","ACKQAS",191,0)
 N DFN,VA,VADM,VAERR,X1,X2 S DFN=$P(^ACK(509850.6,D0,0),U,2),X1=$P(^(0),U) D DEM^VADPT S X2=+VADM(3),X=X1-X2\10000
"RTN","ACKQAS",192,0)
 Q
"RTN","ACKQAS",193,0)
 ;
"RTN","ACKQAS",194,0)
CHKDT ;
"RTN","ACKQAS",195,0)
 S ACKMON=$E(X,1,5) S ACKGEN=$S($D(^ACK(509850.7,ACKMON,0)):^(0),1:"")
"RTN","ACKQAS",196,0)
 Q:'$L(ACKGEN)  I $P(ACKGEN,U,4) W !!,$C(7),"Capitation data for that time period has already been compiled.",!,"To insure proper credit for this visit, please make sure the capitation",!,"data is regenerated.",!
"RTN","ACKQAS",197,0)
 Q
"RTN","ACKQAS",198,0)
 ;
"RTN","ACKQAS",199,0)
SITE ;
"RTN","ACKQAS",200,0)
 S DIR(0)="P^ACK(509850.8,1,1,:AEMQ",DA(1)=1
"RTN","ACKQAS",201,0)
 S DIR("A")="Select Clinic Location"
"RTN","ACKQAS",202,0)
 S DIR("?")="Choose the clinic location that should be associated with these visits."
"RTN","ACKQAS",203,0)
 D ^DIR K DIR S:'$D(DIRUT) ACKSITE=+Y Q:$D(DIRUT)
"RTN","ACKQAS",204,0)
 ; 
"RTN","ACKQAS",205,0)
STOP ;
"RTN","ACKQAS",206,0)
 S ACKCSCP=$$GET1^DIQ(44,ACKCLIN,8,"I")
"RTN","ACKQAS",207,0)
 S ACKCSC(1)=$S('ACKCSCP:0,1:$$GET1^DIQ(40.7,ACKCSCP,1))
"RTN","ACKQAS",208,0)
 S ACKCSC=""
"RTN","ACKQAS",209,0)
 I ACKCSC(1)=203 S ACKCSC="A"
"RTN","ACKQAS",210,0)
 I ACKCSC(1)=204 S ACKCSC="S"
"RTN","ACKQAS",211,0)
 I ACKCSC(1)=216 D
"RTN","ACKQAS",212,0)
 . S ACKCSCP=$$GET1^DIQ(44,ACKCLIN,2503,"I")
"RTN","ACKQAS",213,0)
 . S ACKCSC(1)=$S('ACKCSCP:0,1:$$GET1^DIQ(40.7,ACKCSCP,1))
"RTN","ACKQAS",214,0)
 . I ACKCSC(1)=203 S ACKCSC="AT"
"RTN","ACKQAS",215,0)
 . I ACKCSC(1)=204 S ACKCSC="ST"
"RTN","ACKQAS",216,0)
 ;
"RTN","ACKQAS",217,0)
 K ACKCSCP
"RTN","ACKQAS",218,0)
 Q
"RTN","ACKQAS",219,0)
 ;
"RTN","ACKQAS",220,0)
 ;
"RTN","ACKQAS",221,0)
UNLOCK ;  Unlock Locked record
"RTN","ACKQAS",222,0)
 L
"RTN","ACKQAS",223,0)
 Q
"RTN","ACKQAS",224,0)
 ;
"RTN","ACKQAS",225,0)
HEADING ;
"RTN","ACKQAS",226,0)
 W @IOF
"RTN","ACKQAS",227,0)
 W !,"This option is used to enter new A&SP clinic visits.  Existing clinic",!,"visits should be updated with the Edit an Existing Visit option.",!
"RTN","ACKQAS",228,0)
 Q
"RTN","ACKQAS",229,0)
 ;
"RTN","ACKQAS",230,0)
DEL W !!,$C(7),"<<INCOMPLETE RECORD DELETED!!>>",!!
"RTN","ACKQAS",231,0)
 S DIK="^ACK(509850.6,",DA=ACKVIEN D ^DIK
"RTN","ACKQAS",232,0)
 Q
"RTN","ACKQAS",233,0)
 ;
"RTN","ACKQAS",234,0)
CHKDTH ;; ACKQ*3*10  ADD CHECK FOR DECEASED PATIENT
"RTN","ACKQAS",235,0)
 N I,X,Y,ACKDIRUT,ACK,VA,VADM,VAERR
"RTN","ACKQAS",236,0)
 D DEM^VADPT
"RTN","ACKQAS",237,0)
 S ACK(4)=""
"RTN","ACKQAS",238,0)
 I VADM(6)'="" D
"RTN","ACKQAS",239,0)
 .S Y=$P(VADM(6),"^",2)
"RTN","ACKQAS",240,0)
 .X ^DD("DD")
"RTN","ACKQAS",241,0)
 .S ACK(4)="[PATIENT DIED ON "_$P(Y,"@")_"]"
"RTN","ACKQAS",242,0)
 I ACK(4)'="" W !!,ACK(4),! S ACKOUT=1
"RTN","ACKQAS",243,0)
 ;; END ACKQ*3*10
"RTN","ACKQAS",244,0)
 Q
"VER")
8.0^22.0
"BLD",5707,6)
^10
**END**
**END**
