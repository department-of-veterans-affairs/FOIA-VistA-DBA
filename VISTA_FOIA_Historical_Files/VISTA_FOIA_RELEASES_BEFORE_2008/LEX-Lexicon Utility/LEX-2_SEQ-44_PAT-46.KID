Released LEX*2*46 SEQ #44
Extracted from mail message
**KIDS**:LEX*2.0*46^

**INSTALL NAME**
LEX*2.0*46
"BLD",5861,0)
LEX*2.0*46^LEXICON UTILITY^0^3061219^y
"BLD",5861,1,0)
^^2^2^3061130^
"BLD",5861,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",5861,1,2,0)
included in this patch.
"BLD",5861,4,0)
^9.64PA^^
"BLD",5861,"INI")

"BLD",5861,"INIT")
POST^LEX2046P
"BLD",5861,"KRN",0)
^9.67PA^8989.52^19
"BLD",5861,"KRN",.4,0)
.4
"BLD",5861,"KRN",.401,0)
.401
"BLD",5861,"KRN",.402,0)
.402
"BLD",5861,"KRN",.403,0)
.403
"BLD",5861,"KRN",.5,0)
.5
"BLD",5861,"KRN",.84,0)
.84
"BLD",5861,"KRN",3.6,0)
3.6
"BLD",5861,"KRN",3.8,0)
3.8
"BLD",5861,"KRN",9.2,0)
9.2
"BLD",5861,"KRN",9.8,0)
9.8
"BLD",5861,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",5861,"KRN",9.8,"NM",3,0)
LEXXGI^^0^B72245270
"BLD",5861,"KRN",9.8,"NM",4,0)
LEXXFI^^0^B48140069
"BLD",5861,"KRN",9.8,"NM",5,0)
LEXXII^^0^B32607949
"BLD",5861,"KRN",9.8,"NM",6,0)
LEXXGI2^^0^B10122401
"BLD",5861,"KRN",9.8,"NM",7,0)
LEX2046^^0^B80475683
"BLD",5861,"KRN",9.8,"NM",8,0)
LEX2046P^^0^B33961753
"BLD",5861,"KRN",9.8,"NM","B","LEX2046",7)

"BLD",5861,"KRN",9.8,"NM","B","LEX2046P",8)

"BLD",5861,"KRN",9.8,"NM","B","LEXXFI",4)

"BLD",5861,"KRN",9.8,"NM","B","LEXXGI",3)

"BLD",5861,"KRN",9.8,"NM","B","LEXXGI2",6)

"BLD",5861,"KRN",9.8,"NM","B","LEXXII",5)

"BLD",5861,"KRN",19,0)
19
"BLD",5861,"KRN",19.1,0)
19.1
"BLD",5861,"KRN",101,0)
101
"BLD",5861,"KRN",409.61,0)
409.61
"BLD",5861,"KRN",771,0)
771
"BLD",5861,"KRN",870,0)
870
"BLD",5861,"KRN",8989.51,0)
8989.51
"BLD",5861,"KRN",8989.52,0)
8989.52
"BLD",5861,"KRN",8994,0)
8994
"BLD",5861,"KRN","B",.4,.4)

"BLD",5861,"KRN","B",.401,.401)

"BLD",5861,"KRN","B",.402,.402)

"BLD",5861,"KRN","B",.403,.403)

"BLD",5861,"KRN","B",.5,.5)

"BLD",5861,"KRN","B",.84,.84)

"BLD",5861,"KRN","B",3.6,3.6)

"BLD",5861,"KRN","B",3.8,3.8)

"BLD",5861,"KRN","B",9.2,9.2)

"BLD",5861,"KRN","B",9.8,9.8)

"BLD",5861,"KRN","B",19,19)

"BLD",5861,"KRN","B",19.1,19.1)

"BLD",5861,"KRN","B",101,101)

"BLD",5861,"KRN","B",409.61,409.61)

"BLD",5861,"KRN","B",771,771)

"BLD",5861,"KRN","B",870,870)

"BLD",5861,"KRN","B",8989.51,8989.51)

"BLD",5861,"KRN","B",8989.52,8989.52)

"BLD",5861,"KRN","B",8994,8994)

"BLD",5861,"PRE")
LEX2046
"BLD",5861,"QUES",0)
^9.62^^
"BLD",5861,"REQB",0)
^9.611^1^1
"BLD",5861,"REQB",1,0)
LEX*2.0*45^2
"BLD",5861,"REQB","B","LEX*2.0*45",1)

"INIT")
POST^LEX2046P
"MBREQ")
0
"PKG",574,-1)
1^1
"PKG",574,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.
"PKG",574,20,0)
^9.402P^^
"PKG",574,22,0)
^9.49I^1^1
"PKG",574,22,1,0)
2.0^2950923^2950923^520642433
"PKG",574,22,1,"PAH",1,0)
46^3061219
"PKG",574,22,1,"PAH",1,1,0)
^^2^2^3061219
"PKG",574,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",574,22,1,"PAH",1,1,2,0)
included in this patch.
"PRE")
LEX2046
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","LEX2046")
0^7^B80475683^n/a
"RTN","LEX2046",1,0)
LEX2046 ; CIO ISL - LEX*2.0*46 Env Check                  ; 01/01/2007
"RTN","LEX2046",2,0)
 ;;2.0;LEXICON UTILITY;**46**;Sep 23, 1996
"RTN","LEX2046",3,0)
 ;                     
"RTN","LEX2046",4,0)
 ; External References
"RTN","LEX2046",5,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","LEX2046",6,0)
 ;   DBIA 10141  $$PATCH^XPDUTL
"RTN","LEX2046",7,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","LEX2046",8,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","LEX2046",9,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","LEX2046",10,0)
 ;                            
"RTN","LEX2046",11,0)
ENV ; LEX*2.0*46 Environment Check
"RTN","LEX2046",12,0)
 ;                    
"RTN","LEX2046",13,0)
 ;   General
"RTN","LEX2046",14,0)
 ;
"RTN","LEX2046",15,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXG,LEXE,LEXSTR D IMP
"RTN","LEX2046",16,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2046",17,0)
 D BM(LEXSTR),M("")
"RTN","LEX2046",18,0)
 S U="^"
"RTN","LEX2046",19,0)
 ;     No user
"RTN","LEX2046",20,0)
 D:+($$UR)'>0 ET("User not defined (DUZ)")
"RTN","LEX2046",21,0)
 ;     No IO
"RTN","LEX2046",22,0)
 D:+($$SY)'>0 ET("Undefined IO variable(s)")
"RTN","LEX2046",23,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2046",24,0)
 ;                    
"RTN","LEX2046",25,0)
 ;   Load Distribution
"RTN","LEX2046",26,0)
 ;
"RTN","LEX2046",27,0)
 ;     XPDENV = 0 Environment Check during Load
"RTN","LEX2046",28,0)
 ;
"RTN","LEX2046",29,0)
 ;       Check Version (2.0)
"RTN","LEX2046",30,0)
 I $$VERSION^XPDUTL("LEX")'="2.0" D  D ABRT Q
"RTN","LEX2046",31,0)
 . D ET("Version 2.0 not found.  Please install Lexicon Utility v 2.0")
"RTN","LEX2046",32,0)
 ;
"RTN","LEX2046",33,0)
 ;       Check Required Patches
"RTN","LEX2046",34,0)
 D:'$L($G(LEXREQP)) IMP I $L(LEXREQP) D
"RTN","LEX2046",35,0)
 . N LEXPAT,LEXI,LEXPN
"RTN","LEX2046",36,0)
 . F LEXI=1:1 Q:'$L($P(LEXREQP,";",LEXI))  S LEXPAT=$P(LEXREQP,";",LEXI) D
"RTN","LEX2046",37,0)
 . . S LEXPN=$$PATCH^XPDUTL(LEXPAT) W !,"   Checking for ",LEXPAT I +LEXPN>0 H 1 W " - installed"
"RTN","LEX2046",38,0)
 . . I +LEXPN'>0 D ET((LEXPAT_" not found, please install "_LEXPAT_" before continuing"))
"RTN","LEX2046",39,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2046",40,0)
 S LEXG=$$RGBL
"RTN","LEX2046",41,0)
 I $D(LEXE)&(+LEXG=0) D ABRT Q
"RTN","LEX2046",42,0)
 I $D(LEXE)&(+LEXG<0) D ABRT Q
"RTN","LEX2046",43,0)
 I '$D(LEXFULL)&(+($G(XPDENV))'=1) D QUIT Q
"RTN","LEX2046",44,0)
 ;                    
"RTN","LEX2046",45,0)
 ;   Install Package(s)
"RTN","LEX2046",46,0)
 ;
"RTN","LEX2046",47,0)
 ;     XPDENV = 1 Environment Check during Install
"RTN","LEX2046",48,0)
 ;
"RTN","LEX2046",49,0)
 ;       Check Data "is installed" or "is translated"
"RTN","LEX2046",50,0)
 N LEXIT S LEXIT=+($$CPD) I '$D(LEXFULL)&(LEXIT) D QUIT Q
"RTN","LEX2046",51,0)
 ;       Checking Global "Write" Protection 
"RTN","LEX2046",52,0)
 D:+($G(XPDENV))=1 GBLS I $D(LEXE) D ABRT Q
"RTN","LEX2046",53,0)
 ;       Check Import Global Checksum 
"RTN","LEX2046",54,0)
 D:+($G(XPDENV))=1 CS I $D(LEXE) D ABRT Q
"RTN","LEX2046",55,0)
 ;                    
"RTN","LEX2046",56,0)
 ;   Quit, Exit or Abort
"RTN","LEX2046",57,0)
 ;
"RTN","LEX2046",58,0)
QUIT ;     Quit   Passed Environment Check
"RTN","LEX2046",59,0)
 K LEXFULL D OK
"RTN","LEX2046",60,0)
 Q
"RTN","LEX2046",61,0)
EXIT ;     Exit   Failed Environment Check
"RTN","LEX2046",62,0)
 D:$D(LEXE) ED S XPDQUIT=2 K LEXE,LEXFULL Q
"RTN","LEX2046",63,0)
ABRT ;     Abort  Failed Environment Check, KILL the distribution
"RTN","LEX2046",64,0)
 D:$D(LEXE) ED S XPDABORT=1,XPDQUIT=1,XPDQUIT("LEX*2.0*46")=1
"RTN","LEX2046",65,0)
 S XPDQUIT("ICD*18.0*12")=1,XPDQUIT("ICPT*6.0*19")=1
"RTN","LEX2046",66,0)
 S XPDQUIT("CTD UTIL 1.0")=1 K LEXE,LEXFULL
"RTN","LEX2046",67,0)
 Q
"RTN","LEX2046",68,0)
 ;               
"RTN","LEX2046",69,0)
 ; Checks
"RTN","LEX2046",70,0)
 ;
"RTN","LEX2046",71,0)
GBLS ;   Check Write access on globals
"RTN","LEX2046",72,0)
 N LEXE,LEXGBL,LEXRT,LEXT,LEXF,LEXI,LEXX,LEXOK,LEXCPD,LEXS,X S LEXOK=1
"RTN","LEX2046",73,0)
 D BM("   I will now check the protection on ^LEX, ^ICPT, ^ICD and ^DIC Globals.")
"RTN","LEX2046",74,0)
 D M("   If you get an ERROR, you will need to change the protection on these")
"RTN","LEX2046",75,0)
 D M("   globals to allow read/write as indicated:")
"RTN","LEX2046",76,0)
 D BM("                        Owner     Group    World   Network")
"RTN","LEX2046",77,0)
 D M("      Cache systems      RWD       RW       RW      RWD")
"RTN","LEX2046",78,0)
 D BM("   Checking:"),M(" ")
"RTN","LEX2046",79,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2046",80,0)
 . S LEXX="" S LEXE="S LEXX=$T(GD+"_LEXI_")" X LEXE S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2046",81,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2046",82,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(19-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2046",83,0)
 . I '$D(@LEXGBL) D RGNF S LEXOK=0 D M(("      <"_LEXRT_" not found>")) Q
"RTN","LEX2046",84,0)
 . D M(("      "_LEXRT_LEXB1_LEXT_LEXB2_LEXF)) S @LEXGBL=$G(@LEXGBL) H 1
"RTN","LEX2046",85,0)
 D:LEXOK M("    --> ok") D:'LEXOK M("    ??") D M(" ")
"RTN","LEX2046",86,0)
 Q
"RTN","LEX2046",87,0)
RGBL(X) ;   Check Write access on globals
"RTN","LEX2046",88,0)
 N LEXCPD,LEXS,LEXI,LEXX,LEXEC,LEXGBL,LEXRT,LEXT,LEXF,LEXB1,LEXB2
"RTN","LEX2046",89,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2046",90,0)
 . S LEXX="" S LEXEC="S LEXX=$T(GD+"_LEXI_")" X LEXEC S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2046",91,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2046",92,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(15-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2046",93,0)
 . I '$D(@LEXGBL) S:LEXS'[LEXRT LEXS=LEXS_", "_LEXRT S X=-1 S:LEXGBL["LEXM("&(X=1) X=0
"RTN","LEX2046",94,0)
 I $L(LEXS),X'>0 D
"RTN","LEX2046",95,0)
 . S:LEXS[", " LEXS=$P(LEXS,", ",1,($L(LEXS,", ")-1))_" and "_$P(LEXS,", ",$L(LEXS,", "))
"RTN","LEX2046",96,0)
 . S:$E(LEXS,1,2)=", " LEXS=$E(LEXS,3,$L(LEXS)) S:$E(LEXS,1,7)[" and " LEXS=$P(LEXS," and ",2)
"RTN","LEX2046",97,0)
 . D:X=-1 ET(("Global"_$S(LEXS[", "!(LEXS[" and "):"s",1:"")_" "_LEXS_" either not found or incomplete."))
"RTN","LEX2046",98,0)
 . D:X=0 CM
"RTN","LEX2046",99,0)
 Q X
"RTN","LEX2046",100,0)
RGNF ;   Required global not found
"RTN","LEX2046",101,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2046",102,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)'["^LEXM") ET(""),ET("Required global "_$P($G(LEXGBL),"(",1)_" not found.")
"RTN","LEX2046",103,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)["^LEXM") CM
"RTN","LEX2046",104,0)
 Q
"RTN","LEX2046",105,0)
CHK ;   Check the Checksum
"RTN","LEX2046",106,0)
 D CS I $D(LEXE) D ED Q
"RTN","LEX2046",107,0)
 D BM("  OK"),M(" ")
"RTN","LEX2046",108,0)
 Q
"RTN","LEX2046",109,0)
CS ;   Checksum for import global
"RTN","LEX2046",110,0)
 K LEXE
"RTN","LEX2046",111,0)
 D BM("   Running checksum routine on the ^LEXM import global, please wait")
"RTN","LEX2046",112,0)
 N LEXCHK,LEXNDS,LEXVER S LEXCHK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEX2046",113,0)
 S LEXNDS=+($G(^LEXM(0,"NODES"))),LEXVER=+($$VC(LEXCHK,LEXNDS))
"RTN","LEX2046",114,0)
 D M(" ") D:LEXVER>0 M("     Checksum is ok"),M(" ")
"RTN","LEX2046",115,0)
 D:LEXVER=0 CM D:LEXVER=-1 CW D:LEXVER=-2 CU D:LEXVER=-3 CF
"RTN","LEX2046",116,0)
 Q
"RTN","LEX2046",117,0)
VC(X,Y) ;   Verify Checksum for import global
"RTN","LEX2046",118,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR Q:'$D(^LEXM) 0
"RTN","LEX2046",119,0)
 D IMP I $G(^LEXM(0,"BUILD"))'=$G(LEXBUILD) Q -1
"RTN","LEX2046",120,0)
 N LEXCHK,LEXNDS,LEXCNT,LEXLC,LEXL,LEXS,LEXNC,LEXD,LEXN,LEXC,LEXGCS,LEXP,LEXT
"RTN","LEX2046",121,0)
 S LEXCHK=+($G(X)),LEXNDS=+($G(Y))
"RTN","LEX2046",122,0)
 Q:LEXCHK'>0!(LEXNDS'>0) -2
"RTN","LEX2046",123,0)
 S LEXL=64,(LEXCNT,LEXLC)=0,LEXS=(+(LEXNDS\LEXL))
"RTN","LEX2046",124,0)
 S:LEXS=0 LEXS=1 D:+($O(^LEXM(0)))>0 M("")
"RTN","LEX2046",125,0)
 S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0 W "   "
"RTN","LEX2046",126,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEX2046",127,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"
"RTN","LEX2046",128,0)
 . Q:LEXN="^LEXM(0,""NODES"")"
"RTN","LEX2046",129,0)
 . S LEXCNT=LEXCNT+1
"RTN","LEX2046",130,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEX2046",131,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD
"RTN","LEX2046",132,0)
 . F LEXP=1:1:$L(LEXT) S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEX2046",133,0)
 Q:LEXNC'=LEXNDS -3
"RTN","LEX2046",134,0)
 Q:LEXGCS'=LEXCHK -3
"RTN","LEX2046",135,0)
 Q 1
"RTN","LEX2046",136,0)
SY(X) ;   Check System variables
"RTN","LEX2046",137,0)
 Q:'$D(IO)!('$D(IOF))!('$D(IOM))!('$D(ION))!('$D(IOSL))!('$D(IOST)) 0
"RTN","LEX2046",138,0)
 Q 1
"RTN","LEX2046",139,0)
UR(X) ;   Check User variables
"RTN","LEX2046",140,0)
 Q:'$L($G(DUZ(0))) 0
"RTN","LEX2046",141,0)
 Q:+($G(DUZ))=0!($$NOTDEF(+$G(DUZ))) 0
"RTN","LEX2046",142,0)
 Q 1
"RTN","LEX2046",143,0)
CPD(X) ;   Check Current Patched Data is installed
"RTN","LEX2046",144,0)
 N INS S INS=1
"RTN","LEX2046",145,0)
 Q 0
"RTN","LEX2046",146,0)
 ;               
"RTN","LEX2046",147,0)
 ; Error messages
"RTN","LEX2046",148,0)
 ;
"RTN","LEX2046",149,0)
CM ;   Missing ^LEXM
"RTN","LEX2046",150,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Missing import global ^LEXM.") D CO
"RTN","LEX2046",151,0)
 Q
"RTN","LEX2046",152,0)
CW ;   Wrong ^LEXM
"RTN","LEX2046",153,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP S LEXB=$G(^LEXM(0,"BUILD")) D ET("")
"RTN","LEX2046",154,0)
 I $L(LEXBUILD),$L(LEXB),LEXBUILD'=LEXB D  Q
"RTN","LEX2046",155,0)
 . D ET(("Incorrect import global ^LEXM found ("_LEXB_" global).")) D CKO
"RTN","LEX2046",156,0)
 D ET("Incorrect import global ^LEXM found.") D CKO
"RTN","LEX2046",157,0)
 Q
"RTN","LEX2046",158,0)
CU ;   Unable to verify
"RTN","LEX2046",159,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Unable to verify checksum for import global ^LEXM (possibly corrupt).") D CKO
"RTN","LEX2046",160,0)
 Q
"RTN","LEX2046",161,0)
CF ;   Failed checksum
"RTN","LEX2046",162,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET("") D ET("Import global ^LEXM failed checksum.") D CKO
"RTN","LEX2046",163,0)
 Q
"RTN","LEX2046",164,0)
CO ;   Obtain new global
"RTN","LEX2046",165,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2046",166,0)
 D ET(""),ET("    Please obtain a copy of the import global ^LEXM contained in the ")
"RTN","LEX2046",167,0)
 D ET(("    global host file "_LEXIGHF_" before continuing with the "_LEXBUILD))
"RTN","LEX2046",168,0)
 D ET(("    installation."))
"RTN","LEX2046",169,0)
 Q
"RTN","LEX2046",170,0)
CKO ;   Kill and Obtain new global
"RTN","LEX2046",171,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2046",172,0)
 D ET(""),ET("    Please KILL the existing import global ^LEXM from your system")
"RTN","LEX2046",173,0)
 D ET(("    and obtain a new copy of ^LEXM contained in the global host file"))
"RTN","LEX2046",174,0)
 D ET(("    "_LEXIGHF_" before continuing with the "_LEXBUILD_" installation."))
"RTN","LEX2046",175,0)
 Q
"RTN","LEX2046",176,0)
ET(X) ;   Error Text
"RTN","LEX2046",177,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)="    "_$G(X),LEXE(0)=LEXI
"RTN","LEX2046",178,0)
 Q
"RTN","LEX2046",179,0)
ED ;   Error Display
"RTN","LEX2046",180,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  D M(LEXE(LEXI))
"RTN","LEX2046",181,0)
 D M(" ") K LEXE Q
"RTN","LEX2046",182,0)
 ;                   
"RTN","LEX2046",183,0)
 ; Miscellaneous
"RTN","LEX2046",184,0)
 ;
"RTN","LEX2046",185,0)
NOTDEF(IEN) ;   Check to see if user is defined
"RTN","LEX2046",186,0)
 N DA,DR,DIQ,LEX,DIC S DA=IEN,DR=.01,DIC=200,DIQ="LEX" D EN^DIQ1 Q '$D(LEX)
"RTN","LEX2046",187,0)
OK ;   Environment is OK
"RTN","LEX2046",188,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXT
"RTN","LEX2046",189,0)
 D IMP S LEXT="  Environment "_$S($L(LEXBUILD):("for patch/build "_LEXBUILD_" "),1:"")_"is ok"
"RTN","LEX2046",190,0)
 D BM(LEXT),M(" ")
"RTN","LEX2046",191,0)
 Q
"RTN","LEX2046",192,0)
BM(X) ;   Blank Line with Message
"RTN","LEX2046",193,0)
 D BMES^XPDUTL($G(X)) Q
"RTN","LEX2046",194,0)
M(X) ;   Message
"RTN","LEX2046",195,0)
 D MES^XPDUTL($G(X)) Q
"RTN","LEX2046",196,0)
TRIM(X) ;   Trim Spaces
"RTN","LEX2046",197,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEX2046",198,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEX2046",199,0)
 Q X
"RTN","LEX2046",200,0)
IMP ;   Import names
"RTN","LEX2046",201,0)
 ;     Patch Type
"RTN","LEX2046",202,0)
 ;S LEXPTYPE="Code Set Remedy Ticket Fixes"
"RTN","LEX2046",203,0)
 S LEXPTYPE="Code Set Update"
"RTN","LEX2046",204,0)
 ;     Revision
"RTN","LEX2046",205,0)
 S LEXLREV=46
"RTN","LEX2046",206,0)
 ;     Required Builds
"RTN","LEX2046",207,0)
 S LEXREQP="LEX*2.0*45"
"RTN","LEX2046",208,0)
 ;     This Build Name
"RTN","LEX2046",209,0)
 S LEXBUILD="LEX*2.0*46"
"RTN","LEX2046",210,0)
 ;     This Build's Export Global Host Filename
"RTN","LEX2046",211,0)
 S LEXIGHF="LEX_2_46.GBL"
"RTN","LEX2046",212,0)
 ;     Fiscal Year
"RTN","LEX2046",213,0)
 S LEXFY="FY07"
"RTN","LEX2046",214,0)
 ;     Quarter
"RTN","LEX2046",215,0)
 S LEXQTR="2nd"
"RTN","LEX2046",216,0)
 Q
"RTN","LEX2046",217,0)
EF ;   Exported Files
"RTN","LEX2046",218,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2046",219,0)
 ;;^LEXT(757.2);^LEXT(757.2);Lexicon Subsets/Defaults;757.2
"RTN","LEX2046",220,0)
 ;;^LEXC(757.9);^LEXC(*;Lexicon Change File;757.9-757.91
"RTN","LEX2046",221,0)
 ;;^LEXM(0);^LEXM(*;Lexicon Export/Import;No File #
"RTN","LEX2046",222,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2046",223,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2046",224,0)
 ;;^DIC(81.2,0);^DIC(81.2);CPT Copyright;81.2
"RTN","LEX2046",225,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2046",226,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2046",227,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2046",228,0)
 ;;^ICD(0);^ICD(;DRG Grouper;80.2
"RTN","LEX2046",229,0)
 ;;^ICM(0);^ICM(;MAJOR DIAGNOSTIC CATEGORY;80.3
"RTN","LEX2046",230,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2046",231,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2046",232,0)
 Q
"RTN","LEX2046",233,0)
GD ;   Global Data
"RTN","LEX2046",234,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2046",235,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2046",236,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2046",237,0)
 ;;^ICD(0);^ICD(;DRG Grouper;80.2
"RTN","LEX2046",238,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2046",239,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2046",240,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2046P")
0^8^B33961753^n/a
"RTN","LEX2046P",1,0)
LEX2046P ; CIO ISL - LEX*2.0*46 Pre/Post Install           ; 01/01/2007
"RTN","LEX2046P",2,0)
 ;;2.0;LEXICON UTILITY;**46**;Sep 23, 1996
"RTN","LEX2046P",3,0)
 ;
"RTN","LEX2046P",4,0)
 ; External References
"RTN","LEX2046P",5,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","LEX2046P",6,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","LEX2046P",7,0)
 ;   DBIA  2055  PRD^DILFD
"RTN","LEX2046P",8,0)
 ;   DBIA 10014  EN^DIU2
"RTN","LEX2046P",9,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","LEX2046P",10,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","LEX2046P",11,0)
 ;                      
"RTN","LEX2046P",12,0)
 Q
"RTN","LEX2046P",13,0)
 ;                      
"RTN","LEX2046P",14,0)
POST ; LEX*2.0*46 Post-Install
"RTN","LEX2046P",15,0)
 N LEXEDT,LEXCHG,LEXSCHG,LEXMUMPS,LEXSHORT S LEXEDT=$G(^LEXM(0,"CREATED")),LEXSHORT=""
"RTN","LEX2046P",16,0)
 S LEXCHG=0 S:$D(^LEXM(80))!($D(^LEXM(80.1)))!($D(^LEXM(81)))!($D(^LEXM(81.2)))!($D(^LEXM(81.3))) LEXCHG=1
"RTN","LEX2046P",17,0)
 ;
"RTN","LEX2046P",18,0)
 ;-----------------------------
"RTN","LEX2046P",19,0)
 ;   Save Changes
"RTN","LEX2046P",20,0)
 D SCHG
"RTN","LEX2046P",21,0)
 ;
"RTN","LEX2046P",22,0)
 ;-----------------------------
"RTN","LEX2046P",23,0)
 ;   Load Data into Files
"RTN","LEX2046P",24,0)
 D LOAD
"RTN","LEX2046P",25,0)
 ;
"RTN","LEX2046P",26,0)
 ;-----------------------------
"RTN","LEX2046P",27,0)
 ;   Data Conversion
"RTN","LEX2046P",28,0)
 D CON
"RTN","LEX2046P",29,0)
 ;
"RTN","LEX2046P",30,0)
 ;-----------------------------
"RTN","LEX2046P",31,0)
 ;   Re-Index Files - N/A for LEX*2.0*46
"RTN","LEX2046P",32,0)
 ;   Do not use for Annual/Quarterly Updates, it disrupts the Protocol
"RTN","LEX2046P",33,0)
 ;   D RX
"RTN","LEX2046P",34,0)
 ;
"RTN","LEX2046P",35,0)
 ;-----------------------------
"RTN","LEX2046P",36,0)
 ;   Fire Protocol 
"RTN","LEX2046P",37,0)
 D NOTIFY^LEXXGI
"RTN","LEX2046P",38,0)
 ;
"RTN","LEX2046P",39,0)
 ;-----------------------------
"RTN","LEX2046P",40,0)
 ;   Send a Install Message
"RTN","LEX2046P",41,0)
 D MSG
"RTN","LEX2046P",42,0)
 ;
"RTN","LEX2046P",43,0)
 ;-----------------------------
"RTN","LEX2046P",44,0)
 ;   Clean up and Quit
"RTN","LEX2046P",45,0)
 D KLEXM
"RTN","LEX2046P",46,0)
 Q
"RTN","LEX2046P",47,0)
 ;                      
"RTN","LEX2046P",48,0)
LOAD ; Load Data from ^LEXM into IC*/LEX Files
"RTN","LEX2046P",49,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXB,LEXCD,LEXSTR,LEXLAST D IMP^LEX2046
"RTN","LEX2046P",50,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2046P",51,0)
 S U="^",LEXB=$G(^LEXM(0,"BUILD")) Q:LEXB=""  Q:LEXBUILD=""
"RTN","LEX2046P",52,0)
 S LEXCD=0 S LEXCD=+($$CPD^LEX2046)
"RTN","LEX2046P",53,0)
 I LEXCD,LEXB=LEXBUILD D  G LQ
"RTN","LEX2046P",54,0)
 . S X="Data for patch "_LEXBUILD_" has already been installed"
"RTN","LEX2046P",55,0)
 . W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X)
"RTN","LEX2046P",56,0)
 . S X="" W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(X)
"RTN","LEX2046P",57,0)
 D:'LEXCD&(LEXB=LEXBUILD) EN^LEXXGI
"RTN","LEX2046P",58,0)
LQ ; Load Quit
"RTN","LEX2046P",59,0)
 D KLEXM
"RTN","LEX2046P",60,0)
 Q
"RTN","LEX2046P",61,0)
 ;
"RTN","LEX2046P",62,0)
MSG ; Send Installation Message to G.LEXICON
"RTN","LEX2046P",63,0)
 Q:+($G(DUZ))=0!($$NOTDEF^LEX2046($G(DUZ)))
"RTN","LEX2046P",64,0)
 D HOME^%ZIS N DIFROM,LEXPRO,LEXPRON,LEXLAST,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXSHORT
"RTN","LEX2046P",65,0)
 S LEXSHORT="" D IMP^LEX2046,POST^LEXXFI Q
"RTN","LEX2046P",66,0)
 ;
"RTN","LEX2046P",67,0)
SCHG ; Save Change File Changes
"RTN","LEX2046P",68,0)
 N NN,NC,ND K LEXSCHG(0) S LEXCHG=0 S NN="^LEXM",NC="^LEXM(" F  S NN=$Q(@NN) Q:'$L(NN)!(NN'[NC)  D
"RTN","LEX2046P",69,0)
 . S ND=$G(@NN) I NN["LEXM(80,"&(+($P(NN,",",2))>1)!(NN["LEXM(80.1,"&(+($P(NN,",",2))>1)) D
"RTN","LEX2046P",70,0)
 . . S:ND["S ^ICD9("!(ND["K ^ICD9(") LEXSCHG(80,0)=+($G(^LEXM(80,0))),LEXSCHG("B",80)="",LEXSCHG("C","ICD",80)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",71,0)
 . . S:ND["S ^ICD0("!(ND["K ^ICD0(") LEXSCHG(80.1,0)=+($G(^LEXM(80.1,0))),LEXSCHG("B",80.1)="",LEXSCHG("C","ICD",80.1)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",72,0)
 . I NN["LEXM(81,"&(+($P(NN,",",2))>1)!(NN["LEXM(81.3,"&(+($P(NN,",",2))>1)) D
"RTN","LEX2046P",73,0)
 . . S:ND["S ^ICPT("!(ND["K ^ICPT(") LEXSCHG(81,0)=+($G(^LEXM(81,0))),LEXSCHG("B",81)="",LEXSCHG("C","CPT",81)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",74,0)
 . . S:ND["S ^DIC(81.3,"!(ND["K ^DIC(81.3,") LEXSCHG(81.3,0)=+($G(^LEXM(81.3,0))),LEXSCHG("B",81.3)="",LEXSCHG("C","CPT",81.3)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",75,0)
 . I NN["LEXM(81.2," D
"RTN","LEX2046P",76,0)
 . . S:ND["S ^DIC(81.2,"!(ND["K ^DIC(81.2,") LEXSCHG(81.2,0)=+($G(^LEXM(81.2,0))),LEXSCHG("B",81.2)="",LEXSCHG("C","CPT",81.2)=""
"RTN","LEX2046P",77,0)
 . I NN["LEXM(757,"&(+($P(NN,",",2))>1)!(NN["LEXM(757."&(+($P(NN,",",2))>1)) D
"RTN","LEX2046P",78,0)
 . . N FI S FI=+($P(NN,"(",2))
"RTN","LEX2046P",79,0)
 . . S:ND["S ^LEX("!(ND["K ^LEX(") LEXSCHG(FI,0)=+($G(^LEXM(+FI,0))),LEXSCHG("B",FI)="",LEXSCHG("C","LEX",FI)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",80,0)
 . . S:ND["S ^LEXT("!(ND["K ^LEXT(") LEXSCHG(FI,0)=+($G(^LEXM(+FI,0))),LEXSCHG("B",FI)="",LEXSCHG("C","LEX",FI)="",LEXSCHG("D","PRO")=""
"RTN","LEX2046P",81,0)
 S:$D(^LEXM(80))!($D(^LEXM(80.1)))!($D(^LEXM(81)))!($D(^LEXM(81.2)))!($D(^LEXM(81.3)))!($D(LEXSCHG("D","PRO"))) LEXCHG=1,LEXSCHG(0)=1
"RTN","LEX2046P",82,0)
 Q
"RTN","LEX2046P",83,0)
 ;
"RTN","LEX2046P",84,0)
KLEXM ; Subscripted Kill of ^LEXM
"RTN","LEX2046P",85,0)
 N DA S DA=0 F  S DA=$O(^LEXM(DA)) Q:+DA=0  K ^LEXM(DA)
"RTN","LEX2046P",86,0)
 N LEX S LEX=$G(^LEXM(0,"PRO")) K ^LEXM(0) S:$L(LEX) ^LEXM(0,"PRO")=LEX
"RTN","LEX2046P",87,0)
 Q
"RTN","LEX2046P",88,0)
 ;
"RTN","LEX2046P",89,0)
PRE ; LEX*2.0*46 Pre-Install   (N/A for patch 46)
"RTN","LEX2046P",90,0)
 Q
"RTN","LEX2046P",91,0)
 ;
"RTN","LEX2046P",92,0)
RX ; Reindex files            (N/A for patch 46)
"RTN","LEX2046P",93,0)
 Q
"RTN","LEX2046P",94,0)
 N LEX,DA,DIK,TH,TM,TD
"RTN","LEX2046P",95,0)
 D BMES^XPDUTL(" Re-indexing NEW Versioned Text Cross-References")
"RTN","LEX2046P",96,0)
 ;
"RTN","LEX2046P",97,0)
 D BMES^XPDUTL("   ICD-9 Diagnosis file                 #80") W !,"   "
"RTN","LEX2046P",98,0)
 S (LEX,DA)=0 F  S DA=$O(^ICD9(DA)) Q:+DA=0  K ^ICD9(DA,66,"B"),^ICD9(DA,67,"B"),^ICD9(DA,68,"B") S LEX=+($G(LEX))+1 W:LEX#120=0 "."
"RTN","LEX2046P",99,0)
 K ^ICD9("AB"),^ICD9("ACC"),^ICD9("ACT"),^ICD9("BA"),^ICD9("D"),^ICD9("AST"),^ICD9("ADS") S DIK="^ICD9(" D IXALL^DIK
"RTN","LEX2046P",100,0)
 ;
"RTN","LEX2046P",101,0)
 D MES^XPDUTL("   ICD-9 Operations/Procedure file      #80.1") W !,"   "
"RTN","LEX2046P",102,0)
 S (LEX,DA)=0 F  S DA=$O(^ICD0(DA)) Q:+DA=0  K ^ICD0(DA,66,"B"),^ICD0(DA,67,"B"),^ICD0(DA,68,"B") S LEX=+($G(LEX))+1 W:LEX#120=0 "."
"RTN","LEX2046P",103,0)
 K ^ICD0("AB"),^ICD0("ACT"),^ICD0("ADS"),^ICD0("AST"),^ICD0("BA"),^ICD0("D"),^ICD0("E") S DIK="^ICD0(" D IXALL^DIK
"RTN","LEX2046P",104,0)
 ;
"RTN","LEX2046P",105,0)
 D MES^XPDUTL("   DRG file                             #80.2") W !,"   "
"RTN","LEX2046P",106,0)
 S (LEX,DA)=0 F  S DA=$O(^ICD(DA)) Q:+DA=0  K ^ICD(DA,1,"B"),^ICD(DA,66,"B"),^ICD(DA,68,"B") S LEX=+($G(LEX))+1 W:LEX#120=0 "."
"RTN","LEX2046P",107,0)
 K ^ICD("ADS"),^ICD("B") S DIK="^ICD(" D IXALL^DIK
"RTN","LEX2046P",108,0)
 ;
"RTN","LEX2046P",109,0)
 D MES^XPDUTL("   CPT/HCPCS Procedure/Services file    #81") W !,"   "
"RTN","LEX2046P",110,0)
 S (LEX,DA)=0 F  S DA=$O(^ICPT(DA)) Q:+DA=0  D
"RTN","LEX2046P",111,0)
 . K ^ICPT(DA,60,"B"),^ICPT(DA,61,"B"),^ICPT(DA,62,"B"),^ICPT(DA,"D","B") S LEX=+($G(LEX))+1 W:LEX#120=0 "."
"RTN","LEX2046P",112,0)
 K ^ICPT("ACT"),^ICPT("ADS"),^ICPT("AST"),^ICPT("B"),^ICPT("BA"),^ICPT("C"),^ICPT("D"),^ICPT("E"),^ICPT("F") S DIK="^ICPT(" D IXALL^DIK
"RTN","LEX2046P",113,0)
 ;
"RTN","LEX2046P",114,0)
 D MES^XPDUTL("   CPT Modifier file                    #81.3") W !,"   "
"RTN","LEX2046P",115,0)
 S (LEX,DA)=0 F  S DA=$O(^DIC(81.3,DA)) Q:+DA=0  D
"RTN","LEX2046P",116,0)
 . K ^DIC(81.3,DA,60,"B"),^DIC(81.3,DA,61,"B"),^DIC(81.3,DA,62,"B") S LEX=+($G(LEX))+1 W:LEX#120=0 "."
"RTN","LEX2046P",117,0)
 K ^DIC(81.3,"ACT"),^DIC(81.3,"ADS"),^DIC(81.3,"AST"),^DIC(81.3,"B"),^DIC(81.3,"BA"),^DIC(81.3,"C"),^DIC(81.3,"D"),^DIC(81.3,"M") S DIK="^DIC(81.3," D IXALL^DIK
"RTN","LEX2046P",118,0)
 Q
"RTN","LEX2046P",119,0)
 ;
"RTN","LEX2046P",120,0)
CON ; Conversion of data       (N/A for patch 46)
"RTN","LEX2046P",121,0)
 Q
"RTN","LEXXFI")
0^4^B48140069^B37167734
"RTN","LEXXFI",1,0)
LEXXFI ; ISL/KER - File Info                     ; 01/01/2007
"RTN","LEXXFI",2,0)
 ;;2.0;LEXICON UTILITY;**32,46**;Sep 23, 1996
"RTN","LEXXFI",3,0)
 Q
"RTN","LEXXFI",4,0)
 ;                   
"RTN","LEXXFI",5,0)
 ; Global Variables
"RTN","LEXXFI",6,0)
 ;   ^LEXM(0
"RTN","LEXXFI",7,0)
 ;   ^TMP("LEX*",$J    SACC 2.3.2.5.1  
"RTN","LEXXFI",8,0)
 ;             
"RTN","LEXXFI",9,0)
 ; External References
"RTN","LEXXFI",10,0)
 ;   DBIA 10086  HOME^%ZIS           
"RTN","LEXXFI",11,0)
 ;   DBIA 10089  ^%ZISC
"RTN","LEXXFI",12,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","LEXXFI",13,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","LEXXFI",14,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","LEXXFI",15,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXFI",16,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXFI",17,0)
 ;   DBIA 10070  ^XMD
"RTN","LEXXFI",18,0)
 ;   DBIA  4409  $$DTIME^XUP
"RTN","LEXXFI",19,0)
 ;             
"RTN","LEXXFI",20,0)
 ; Newed by Post-Install LEX20nnP
"RTN","LEXXFI",21,0)
 ;   LEXBUILD  Build
"RTN","LEXXFI",22,0)
 ;   LEXCRE    Import Global Creation Date
"RTN","LEXXFI",23,0)
 ;   LEXIGHF   Import Global Host File
"RTN","LEXXFI",24,0)
 ;   LEXLREV   Revision
"RTN","LEXXFI",25,0)
 ;   LEXREQP   Required Patches
"RTN","LEXXFI",26,0)
 ;   LEXSHORT  Flag for Summary Install Message
"RTN","LEXXFI",27,0)
 ;                
"RTN","LEXXFI",28,0)
 ; XPDA        Newed by KIDS during Install
"RTN","LEXXFI",29,0)
 ; LEXCOUNT    Flag Checked $D() and not used
"RTN","LEXXFI",30,0)
 ;             
"RTN","LEXXFI",31,0)
 ; Checksums/Counts
"RTN","LEXXFI",32,0)
EN ;   For One or More File(s)
"RTN","LEXXFI",33,0)
 N LEXENV,LEXMET,LEXID S LEXENV=$$ENV Q:+LEXENV'>0  S LEXMET=$$MT^LEXXFI7
"RTN","LEXXFI",34,0)
 I '$L(LEXMET) W !!," Checksum Files (One or All) not Selected" Q
"RTN","LEXXFI",35,0)
 I $L($T(@(LEXMET_"^LEXXFI")))>0 W ! D @LEXMET
"RTN","LEXXFI",36,0)
 Q
"RTN","LEXXFI",37,0)
ONE ;   For ONE file
"RTN","LEXXFI",38,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",39,0)
 N LEXBEG,LEXELP,LEXEND,LEXFC,LEXFI,LEXLDR,LEXMOD,LEXMUL,LEXNM,LEXTCS
"RTN","LEXXFI",40,0)
 N LEXTND,LEXTT,LEXTXT
"RTN","LEXXFI",41,0)
 S LEXBEG=$$TIC^LEXXFI8,LEXMUL=0,LEXMOD=0
"RTN","LEXXFI",42,0)
 S LEXFI=$$FI^LEXXFI7 I +LEXFI'>0 W !!," Checksum File not Selected" Q
"RTN","LEXXFI",43,0)
 S LEXLDR=$$LDR^LEXXFI8(LEXFI),LEXMOD=LEXMOD+($$MOD^LEXXFI8(LEXFI))
"RTN","LEXXFI",44,0)
 S LEXNM=$$FN^LEXXFI8(LEXFI),LEXTT=" "
"RTN","LEXXFI",45,0)
 W ! D ONE^LEXXFI2(LEXFI),ONE^LEXXFI3(LEXFI),ONE^LEXXFI5(LEXFI)
"RTN","LEXXFI",46,0)
 S LEXEND=$$TIC^LEXXFI8,LEXELP=$$ELAP^LEXXFI8(LEXBEG,LEXEND)
"RTN","LEXXFI",47,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXFI",48,0)
 I +LEXBEG>0,LEXEND>0,$L(LEXELP) D TIM
"RTN","LEXXFI",49,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",50,0)
 Q
"RTN","LEXXFI",51,0)
ALL ;   For ALL files
"RTN","LEXXFI",52,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",53,0)
 K ^TMP("LEXINS",$J),^TMP("LEXKID",$J) S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXFI",54,0)
 N LEXBEG,LEXELP,LEXEND,LEXFC,LEXMOD,LEXMUL,LEXTCS,LEXTND,LEXID
"RTN","LEXXFI",55,0)
 S LEXID="LEXKID",LEXBEG=$$TIC^LEXXFI8,LEXMUL=1,(LEXTND,LEXTCS,LEXMOD,LEXFC)=0
"RTN","LEXXFI",56,0)
 H:$D(LEXPOST)&($D(ZTQUEUED)) 45 D:'$D(LEXPOST) HDR
"RTN","LEXXFI",57,0)
 I '$D(LEXSHORT) D ALL^LEXXFI5,ALL^LEXXFI2,ALL^LEXXFI3
"RTN","LEXXFI",58,0)
 S LEXEND=$$TIC^LEXXFI8 S LEXELP=$$ELAP^LEXXFI8(LEXBEG,LEXEND)
"RTN","LEXXFI",59,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXFI",60,0)
 I +LEXBEG>0,LEXEND>0,$L(LEXELP) D TIM
"RTN","LEXXFI",61,0)
 D:$D(LEXSEND)!($D(LEXPOST)) EN^LEXXII K ^LEXM(0,"PRO") D:$D(ZTQUEUED) MAIL
"RTN","LEXXFI",62,0)
 I '$D(ZTQUEUED) D
"RTN","LEXXFI",63,0)
 . N LEXI S LEXI=0 F  S LEXI=$O(^TMP("LEXKID",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",64,0)
 . . W !,$E($G(^TMP("LEXKID",$J,LEXI)),1,79)
"RTN","LEXXFI",65,0)
 H:$D(ZTQUEUED) 45 D KILL
"RTN","LEXXFI",66,0)
 Q
"RTN","LEXXFI",67,0)
 ;              
"RTN","LEXXFI",68,0)
POST ; Entry Point for Post-Install Message
"RTN","LEXXFI",69,0)
 N LEXPOST S LEXPOST=""
"RTN","LEXXFI",70,0)
 ;            
"RTN","LEXXFI",71,0)
SEND ; Send Message
"RTN","LEXXFI",72,0)
 N LEXDESC,LEXENV,LEXP,LEXPRO,LEXPRON,LEXSEND,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,ZTQUEUED,ZTREQ
"RTN","LEXXFI",73,0)
 S LEXP=0,LEXENV=$$ENV Q:+LEXENV'>0  S LEXSEND="",LEXPRON="LEXICAL SERVICES UPDATE",LEXPRO=$G(^LEXM(0,"PRO"))
"RTN","LEXXFI",74,0)
 S:+LEXPRO>0 LEXPRO=$$FMTE^XLFDT(LEXPRO,"1"),LEXP=1
"RTN","LEXXFI",75,0)
 S ZTRTN="ALL^LEXXFI",ZTSAVE("LEXSEND")="",ZTSAVE("LEXPOST")="" S:$D(LEXCOUNT) ZTSAVE("LEXCOUNT")=""
"RTN","LEXXFI",76,0)
 S:$L($G(LEXPRO))&($L($G(LEXPRON)))&(+($G(LEXP))>0) ZTSAVE("LEXPRO")="",ZTSAVE("LEXPRON")=""
"RTN","LEXXFI",77,0)
 S:$D(LEXLREV) ZTSAVE("LEXLREV")="" S:$D(LEXREQP) ZTSAVE("LEXREQP")="" S:$D(LEXBUILD) ZTSAVE("LEXBUILD")=""
"RTN","LEXXFI",78,0)
 S:$D(LEXSHORT) ZTSAVE("LEXSHORT")="" S:$D(LEXIGHF) ZTSAVE("LEXIGHF")="" S:$D(LEXCRE) ZTSAVE("LEXCRE")=""
"RTN","LEXXFI",79,0)
 S:$D(LEXID) ZTSAVE("LEXID")="" S:$D(XPDA) ZTSAVE("XPDA")=""
"RTN","LEXXFI",80,0)
 S (LEXDESC,ZTDESC)="Post-Install File Counts " S:$D(LEXSHORT) (LEXDESC,ZTDESC)="Post-Install Summary",ZTDTH=$H
"RTN","LEXXFI",81,0)
 S ZTIO="" D ^%ZTLOAD W:+($G(ZTSK))>0 !!,"  ",LEXDESC,!,"  Queued Task #",+($G(ZTSK)) W ! D ^%ZISC
"RTN","LEXXFI",82,0)
 Q
"RTN","LEXXFI",83,0)
MAIL ; Mail global array in message
"RTN","LEXXFI",84,0)
 N DIFROM,LEXPRI,LEXADR,LEXI,LEXM,LEXSUB,XCNP,XMDUZ,XMSCR,XMSUB,XMTEXT,XMY,XMZ
"RTN","LEXXFI",85,0)
 G:'$D(LEXSHORT)&(+($G(^TMP("LEXCS",$J,0)))'>0) MAILQ K ^TMP("LEXMSG",$J)
"RTN","LEXXFI",86,0)
 S LEXSUB="Lexicon/ICD/CPT Installation"
"RTN","LEXXFI",87,0)
 S:$L($G(LEXBUILD)) LEXSUB=$G(LEXBUILD)_" Installation"
"RTN","LEXXFI",88,0)
 S LEXPRI=$$ADR^LEXXFI8 G:'$L(LEXPRI) MAILQ
"RTN","LEXXFI",89,0)
 S LEXPRI="G.LEXINS@"_LEXPRI
"RTN","LEXXFI",90,0)
 S LEXADR=$$GET1^DIQ(200,+($G(DUZ)),.01) G:'$L(LEXADR) MAILQ
"RTN","LEXXFI",91,0)
 S U="^",XMSUB="LEX/ICD/CPT File Checksums - "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","LEXXFI",92,0)
 S:$D(LEXCOUNT) XMSUB="LEX/ICD/CPT File Checksums/Counts - "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","LEXXFI",93,0)
 S:$L($G(LEXBUILD)) XMSUB=$G(LEXBUILD)_" File Checksums"
"RTN","LEXXFI",94,0)
 S:$L($G(LEXBUILD))&($D(LEXCOUNT)) XMSUB=$G(LEXBUILD)_" File Checksums/Counts"
"RTN","LEXXFI",95,0)
 S:$D(LEXPOST) XMSUB=LEXSUB
"RTN","LEXXFI",96,0)
 S LEXI=0 F  S LEXI=$O(^TMP("LEXKID",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",97,0)
 . S LEXM=+($O(^TMP("LEXMSG",$J," "),-1))+1
"RTN","LEXXFI",98,0)
 . S ^TMP("LEXMSG",$J,LEXM,0)=$E($G(^TMP("LEXKID",$J,LEXI)),1,79)
"RTN","LEXXFI",99,0)
 . S ^TMP("LEXMSG",$J,0)=LEXM
"RTN","LEXXFI",100,0)
 K ^TMP("LEXKID",$J)
"RTN","LEXXFI",101,0)
 I '$D(LEXSHORT) S LEXI=0 F  S LEXI=$O(^TMP("LEXCS",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",102,0)
 . S LEXM=+($O(^TMP("LEXMSG",$J," "),-1))+1
"RTN","LEXXFI",103,0)
 . S ^TMP("LEXMSG",$J,LEXM,0)=$E($G(^TMP("LEXCS",$J,LEXI)),1,79)
"RTN","LEXXFI",104,0)
 . S ^TMP("LEXMSG",$J,0)=LEXM
"RTN","LEXXFI",105,0)
 K ^TMP("LEXCS",$J) G:'$D(^TMP("LEXMSG",$J)) MAILQ G:+($G(^TMP("LEXMSG",$J,0)))'>0 MAILQ
"RTN","LEXXFI",106,0)
 S XMY(LEXPRI)="",XMY(LEXADR)="",XMTEXT="^TMP(""LEXMSG"",$J,",XMDUZ=.5 D ^XMD
"RTN","LEXXFI",107,0)
MAILQ ; Quit Mail
"RTN","LEXXFI",108,0)
 D KILL K %Z,XCNP,XMSCR,XMDUZ,XMY,XMZ,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","LEXXFI",109,0)
 Q
"RTN","LEXXFI",110,0)
 ;               
"RTN","LEXXFI",111,0)
 ; Miscellaneous
"RTN","LEXXFI",112,0)
HDR ;   Header
"RTN","LEXXFI",113,0)
 N LEXD,LEXP,LEXN,LEXT,LEXU,LEXA,LEXI,LEXF,LEXMUL S LEXF=0
"RTN","LEXXFI",114,0)
 S LEXA=$$U^LEXXFI7,LEXU=$$P^LEXXFI7,LEXD=$$A^LEXXFI7 D TT^LEXXFI8("","Status")
"RTN","LEXXFI",115,0)
 S LEXT="" S:$L(LEXD) LEXT="   As of:       "_LEXD
"RTN","LEXXFI",116,0)
 I $L(LEXD) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",117,0)
 S LEXT="",LEXI=$S($L($P(LEXA,"^",1)):"[",1:"")_$P(LEXA,"^",1)_$S($L($P(LEXA,"^",2)):"]",1:"")
"RTN","LEXXFI",118,0)
 S:$L(LEXI)&($L($P(LEXA,"^",2))) LEXI=LEXI_"  "_$P(LEXA,"^",2)
"RTN","LEXXFI",119,0)
 S LEXT="" S:$L(LEXI) LEXT="   In Account:  "_LEXI
"RTN","LEXXFI",120,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",121,0)
 S LEXN=$P(LEXU,"^",1),LEXP=$P(LEXU,"^",2)
"RTN","LEXXFI",122,0)
 S LEXT="" S:$L(LEXN) LEXT="   Maint By:    "
"RTN","LEXXFI",123,0)
 S:$L(LEXN) LEXT=LEXT_LEXN S:$L(LEXP)&($L(LEXN)) LEXT=LEXT_"   "_LEXP
"RTN","LEXXFI",124,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",125,0)
 S LEXT="" S:$L($G(LEXBUILD)) LEXT="   Build:       "_$G(LEXBUILD)
"RTN","LEXXFI",126,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",127,0)
 S LEXT="" I $L($G(LEXPRO))&($L($G(LEXPRON))) D
"RTN","LEXXFI",128,0)
 . S LEXT="   Protocol:    "_LEXPRON_" invoked "_LEXPRO
"RTN","LEXXFI",129,0)
 . I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",130,0)
 D BL^LEXXFI8
"RTN","LEXXFI",131,0)
 Q
"RTN","LEXXFI",132,0)
TIM ;   Time
"RTN","LEXXFI",133,0)
 Q:$D(LEXPOST)  Q:+($G(LEXBEG))'>0  Q:+($G(LEXEND))'>0  Q:'$L($G(LEXELP))
"RTN","LEXXFI",134,0)
 D BL^LEXXFI8,TL^LEXXFI8(("   Started:   "_$TR($$FMTE^XLFDT(LEXBEG),"@"," ")))
"RTN","LEXXFI",135,0)
 D TL^LEXXFI8(("   Finished:  "_$TR($$FMTE^XLFDT(LEXEND),"@"," ")))
"RTN","LEXXFI",136,0)
 D TL^LEXXFI8(("   Elapsed:   "_LEXELP)),BL^LEXXFI8
"RTN","LEXXFI",137,0)
 Q
"RTN","LEXXFI",138,0)
ENV(X) ;   Environment check
"RTN","LEXXFI",139,0)
 N LEXNM D HOME^%ZIS S U="^",DT=$$DT^XLFDT
"RTN","LEXXFI",140,0)
 I +($G(DUZ))'>0 W !!,"    User (DUZ) not defined",! Q 0
"RTN","LEXXFI",141,0)
 S LEXNM=$$GET1^DIQ(200,+($G(DUZ)),.01) I '$L(LEXNM) W !!,"    Invalid User (DUZ) defined",! Q 0
"RTN","LEXXFI",142,0)
 S DTIME=$$DTIME^XUP(+($G(DUZ)))
"RTN","LEXXFI",143,0)
 Q 1
"RTN","LEXXFI",144,0)
CLR ;   Clear ^TMP("LEXCS",$J)
"RTN","LEXXFI",145,0)
 K ^TMP("LEXCS",$J) Q
"RTN","LEXXFI",146,0)
KILL ;   Kill all ^TMP("LEX**"
"RTN","LEXXFI",147,0)
 K ^TMP("LEXCNT",$J),^TMP("LEXCS",$J),^TMP("LEXI",$J)
"RTN","LEXXFI",148,0)
 K ^TMP("LEXINS",$J),^TMP("LEXMSG",$J),^TMP("LEXKID",$J)
"RTN","LEXXFI",149,0)
 Q
"RTN","LEXXFI",150,0)
 ;;
"RTN","LEXXFI",151,0)
 ;;
"RTN","LEXXFI",152,0)
FILES ;;
"RTN","LEXXFI",153,0)
 ;;;;757
"RTN","LEXXFI",154,0)
 ;;1;;757.001
"RTN","LEXXFI",155,0)
 ;;1;;757.01
"RTN","LEXXFI",156,0)
 ;;;;757.011
"RTN","LEXXFI",157,0)
 ;;;;757.014
"RTN","LEXXFI",158,0)
 ;;;;757.02
"RTN","LEXXFI",159,0)
 ;;;;757.03
"RTN","LEXXFI",160,0)
 ;;1;;757.04
"RTN","LEXXFI",161,0)
 ;;1;;757.05
"RTN","LEXXFI",162,0)
 ;;1;;757.06
"RTN","LEXXFI",163,0)
 ;;;;757.1
"RTN","LEXXFI",164,0)
 ;;;;757.11
"RTN","LEXXFI",165,0)
 ;;;;757.12
"RTN","LEXXFI",166,0)
 ;;;;757.13
"RTN","LEXXFI",167,0)
 ;;;;757.14
"RTN","LEXXFI",168,0)
 ;;1;;757.2
"RTN","LEXXFI",169,0)
 ;;1;;757.21
"RTN","LEXXFI",170,0)
 ;;;;757.3
"RTN","LEXXFI",171,0)
 ;;;;757.31
"RTN","LEXXFI",172,0)
 ;;1;;757.4
"RTN","LEXXFI",173,0)
 ;;1;;757.41
"RTN","LEXXFI",174,0)
 ;;1;;757.9
"RTN","LEXXFI",175,0)
 ;;;;757.901
"RTN","LEXXFI",176,0)
 ;;;;757.902
"RTN","LEXXFI",177,0)
 ;;1;;757.903
"RTN","LEXXFI",178,0)
 ;;1;;757.91
"RTN","LEXXFI",179,0)
 ;;;;80
"RTN","LEXXFI",180,0)
 ;;;;80.1
"RTN","LEXXFI",181,0)
 ;;1;;80.2
"RTN","LEXXFI",182,0)
 ;;;;80.3
"RTN","LEXXFI",183,0)
 ;;;;81
"RTN","LEXXFI",184,0)
 ;;;;81.1
"RTN","LEXXFI",185,0)
 ;;1;;81.2
"RTN","LEXXFI",186,0)
 ;;;;81.3
"RTN","LEXXFI",187,0)
 ;;
"RTN","LEXXFI",188,0)
 ;;
"RTN","LEXXFI",189,0)
 ;;
"RTN","LEXXFI",190,0)
 Q
"RTN","LEXXGI")
0^3^B72245270^B81025317
"RTN","LEXXGI",1,0)
LEXXGI ; ISL/KER - Global Import (Needs ^LEXM) ; 01/01/2007
"RTN","LEXXGI",2,0)
 ;;2.0;LEXICON UTILITY;**4,25,26,27,28,29,46**;Sep 23, 1996
"RTN","LEXXGI",3,0)
 ;             
"RTN","LEXXGI",4,0)
 ; Global Variables
"RTN","LEXXGI",5,0)
 ;   ^LEXM
"RTN","LEXXGI",6,0)
 ;   DBIA   872  ^ORD(101
"RTN","LEXXGI",7,0)
 ;             
"RTN","LEXXGI",8,0)
 ; External References
"RTN","LEXXGI",9,0)
 ;   DBIA 10016  ^DIM
"RTN","LEXXGI",10,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","LEXXGI",11,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","LEXXGI",12,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","LEXXGI",13,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXGI",14,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXGI",15,0)
 ;   DBIA 10101  EN^XQOR
"RTN","LEXXGI",16,0)
 ;             
"RTN","LEXXGI",17,0)
 ; LEXSCHG  Newed by Post-Install LEX20nnP
"RTN","LEXXGI",18,0)
 ; XPDNM    Newed by KIDS during Install
"RTN","LEXXGI",19,0)
 ;             
"RTN","LEXXGI",20,0)
EN ; Lexicon Update
"RTN","LEXXGI",21,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXGI",22,0)
 D IMP Q
"RTN","LEXXGI",23,0)
TASK ;   Lexicon Update Queued (Taskman)
"RTN","LEXXGI",24,0)
 N Y,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK,ZTQUEUED,ZTREQ
"RTN","LEXXGI",25,0)
 S ZTRTN="EN^LEXXGI",ZTDESC="Importing Updated Lexicon Data"
"RTN","LEXXGI",26,0)
 S ZTIO="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS
"RTN","LEXXGI",27,0)
 Q
"RTN","LEXXGI",28,0)
 ;                
"RTN","LEXXGI",29,0)
IMP ; Import Data
"RTN","LEXXGI",30,0)
 N LEXBEG,LEXELP,LEXEND,LEXMSG,LEXOK,LEXFL
"RTN","LEXXGI",31,0)
 D:'$D(^LEXM) NF^LEXXGI2 Q:'$D(^LEXM)
"RTN","LEXXGI",32,0)
 S LEXOK=0 S:$O(^LEXM(0))>0 LEXOK=1 D:'LEXOK IG^LEXXGI2 Q:'LEXOK
"RTN","LEXXGI",33,0)
 S LEXBEG=$$HACK^LEXXGI2 D IMPORT D KLEXM^LEXXGI2
"RTN","LEXXGI",34,0)
 S LEXEND=$$HACK^LEXXGI2,LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND)
"RTN","LEXXGI",35,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI",36,0)
 D PB^LEXXGI2("  Data Updated ")
"RTN","LEXXGI",37,0)
 D PB^LEXXGI2(("     Started:   "_$TR($$FMTE^XLFDT(LEXBEG),"@"," ")))
"RTN","LEXXGI",38,0)
 D TL^LEXXGI2(("     Finished:  "_$TR($$FMTE^XLFDT(LEXEND),"@"," ")))
"RTN","LEXXGI",39,0)
 D TL^LEXXGI2(("     Elapsed:   "_LEXELP))
"RTN","LEXXGI",40,0)
 Q
"RTN","LEXXGI",41,0)
IMPORT ;   Import by File
"RTN","LEXXGI",42,0)
 N LEXHDR,LEXBLD,LEXDAT,LEXFI,LEXFIC,LEXHDRS,LEXLOG,LEXINS
"RTN","LEXXGI",43,0)
 S (LEXFI,LEXFIC)=0,LEXHDR=0,LEXBLD=$G(^LEXM(0,"BUILD"))
"RTN","LEXXGI",44,0)
 S LEXDAT=$P($G(^LEXM(0,"VRRVDT")),"^",1),LEXINS=1
"RTN","LEXXGI",45,0)
 S:+LEXDAT'>0 LEXDAT=$$DT^XLFDT D:LEXOK HDR
"RTN","LEXXGI",46,0)
 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI=0  D FILES
"RTN","LEXXGI",47,0)
 Q
"RTN","LEXXGI",48,0)
FILES ;   Get File Data
"RTN","LEXXGI",49,0)
 N LEXCF,LEXCHG,LEXCHGS,LEXCNT,LEXCNT,LEXFIL,LEXI,LEXIEN,LEXL,LEXLC
"RTN","LEXXGI",50,0)
 N LEXMUMPS,LEXNM,LEXRT,LEXS,LEXTOT,LEXTXT,LEXIGL,LEXIGI,LEXIGF,LEXIGT
"RTN","LEXXGI",51,0)
 N LEXIGD,LEXIGO,LEXBEG,LEXEND,LEXELP,LEXFB
"RTN","LEXXGI",52,0)
 S LEXFB=$G(^LEXM(+LEXFI,0,"BUILD")),LEXIGO=0,LEXBEG=$$HACK^LEXXGI2
"RTN","LEXXGI",53,0)
 S (LEXCNT,LEXLC,LEXI)=0,LEXL=68,LEXFIC=LEXFIC+1 D:LEXOK FHDR(LEXFI)
"RTN","LEXXGI",54,0)
 S LEXTOT=+($G(^LEXM(LEXFI,0))) G:LEXTOT=0 ABRT
"RTN","LEXXGI",55,0)
 S LEXNM=$G(^LEXM(LEXFI,0,"NM"))
"RTN","LEXXGI",56,0)
 I $L(LEXNM),$$UP^LEXXGI2(LEXNM)'["FILE" S LEXNM=LEXNM_" FILE"
"RTN","LEXXGI",57,0)
 S:$L(LEXNM) LEXNM=$$MIX^LEXXGI2(LEXNM) S LEXCHG=$G(^LEXM(LEXFI,0))
"RTN","LEXXGI",58,0)
 S LEXTXT="   "_LEXNM,LEXTXT=LEXTXT_$J("",(40-$L(LEXTXT)))_LEXFI
"RTN","LEXXGI",59,0)
 D:LEXFIC=1 PB^LEXXGI2(LEXTXT) D:LEXFIC'=1 TL^LEXXGI2(LEXTXT)
"RTN","LEXXGI",60,0)
 S LEXS=+(LEXTOT\LEXL) S:LEXS=0 LEXS=1 W:+($O(^LEXM(LEXFI,0)))>0 !,"   "
"RTN","LEXXGI",61,0)
 F  S LEXI=$O(^LEXM(LEXFI,LEXI)) Q:+LEXI=0  D
"RTN","LEXXGI",62,0)
 . S LEXCNT=LEXCNT+1,LEXMUMPS=$G(^LEXM(LEXFI,LEXI))
"RTN","LEXXGI",63,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEXXGI",64,0)
 . S LEXRT=$P(LEXMUMPS,"^",2),LEXFIL=""
"RTN","LEXXGI",65,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2)),LEXFL(+($P(LEXRT,"(",2)))=""
"RTN","LEXXGI",66,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80,LEXFL(80)=""
"RTN","LEXXGI",67,0)
 . S:LEXMUMPS["^ICD0(" LEXFIL=80.1,LEXFL(80.1)=""
"RTN","LEXXGI",68,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81,LEXFL(81)=""
"RTN","LEXXGI",69,0)
 . S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3,LEXFL(81.3)=""
"RTN","LEXXGI",70,0)
 . S:LEXMUMPS["^DIC(81.2" LEXFIL=81.2,LEXFL(81.2)=""
"RTN","LEXXGI",71,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2))
"RTN","LEXXGI",72,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80 S:LEXMUMPS["^ICD0(" LEXFIL=80.1
"RTN","LEXXGI",73,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81 S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3
"RTN","LEXXGI",74,0)
 . S:+LEXFIL>0 LEXSCHG(+LEXFIL,0)=""
"RTN","LEXXGI",75,0)
 . I $L(LEXMUMPS) D
"RTN","LEXXGI",76,0)
 . . N X S X=LEXMUMPS D ^DIM Q:'$D(X)  X LEXMUMPS S LEXIGO=1
"RTN","LEXXGI",77,0)
 I +($G(LEXIGO))>0 D
"RTN","LEXXGI",78,0)
 . S LEXEND=$$HACK^LEXXGI2 S LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND)
"RTN","LEXXGI",79,0)
 . S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI",80,0)
 G ABRT
"RTN","LEXXGI",81,0)
HDR ;     Header - Full
"RTN","LEXXGI",82,0)
 N LEXCRE,LEXL1 S LEXL1=""
"RTN","LEXXGI",83,0)
 S LEXCRE=$G(^LEXM(0,"CREATED"))
"RTN","LEXXGI",84,0)
 S LEXCRE=$S(+LEXCRE>0:($$MIX^LEXXGI2($$FMTE^XLFDT(LEXCRE))),1:"")
"RTN","LEXXGI",85,0)
 S:$L($P(LEXCRE,"@",2)) LEXCRE=$P(LEXCRE,"@",1)_" at "_$P(LEXCRE,"@",2)
"RTN","LEXXGI",86,0)
 S LEXL1=" Updating files "
"RTN","LEXXGI",87,0)
 S:$L($G(LEXCRE))&($L($G(LEXL1))) LEXL1=$G(LEXL1)_"using export global created "_$G(LEXCRE)
"RTN","LEXXGI",88,0)
 D PB^LEXXGI2(LEXL1)
"RTN","LEXXGI",89,0)
 Q
"RTN","LEXXGI",90,0)
FHDR(X) ;     Header
"RTN","LEXXGI",91,0)
 N LEXB,LEXFI,LEXFID,LEXNM,LEXVR,LEXRV,LEXDT,LEXL1,LEXL2 S (LEXL1,LEXL2)="",LEXFI=+($G(X)),LEXFID=$P(LEXFI,".",1)
"RTN","LEXXGI",92,0)
 Q:+LEXFID'>0  Q:$D(LEXHDRS(+LEXFID))  S LEXHDRS(LEXFID)=""
"RTN","LEXXGI",93,0)
 S:+LEXFI=81!(+LEXFI=81.3) LEXHDRS(81)="",LEXHDRS(81.3)=""
"RTN","LEXXGI",94,0)
 S:LEXFID=80 LEXNM="ICD-9-CM" S:LEXFID=81 LEXNM="CPT-4/HCPSC" S:LEXFID=757 LEXNM="Lexicon"
"RTN","LEXXGI",95,0)
 S LEXB=$G(^LEXM(LEXFI,0,"BUILD"))
"RTN","LEXXGI",96,0)
 S LEXVR=$G(^LEXM(LEXFI,0,"VR")),LEXRV=$G(^LEXM(LEXFI,0,"VRRV"))
"RTN","LEXXGI",97,0)
 S LEXDT=$$MIX^LEXXGI2($$FMTE^XLFDT($P(LEXRV,"^",2))),LEXRV=$P(LEXRV,"^",1)
"RTN","LEXXGI",98,0)
 S LEXL1="Updating "_LEXNM S:$L(LEXB) LEXL1=LEXL1_" with patch/build "_LEXB
"RTN","LEXXGI",99,0)
 S:$L(LEXVR) LEXL2=" To version "_LEXVR
"RTN","LEXXGI",100,0)
 S:$L(LEXVR)&($L(LEXRV)) LEXL2=LEXL2_" revision "_LEXRV
"RTN","LEXXGI",101,0)
 S:$L(LEXVR)&($L(LEXRV))&($L(LEXDT)) LEXL2=LEXL2_" dated "_LEXDT
"RTN","LEXXGI",102,0)
 S:$L(LEXL1) LEXL1=" "_LEXL1 S:$L(LEXL2) LEXL2=" "_LEXL2
"RTN","LEXXGI",103,0)
 D BL^LEXXGI2 D:$L(LEXL1) TL^LEXXGI2(LEXL1) D:$L(LEXL2) TL^LEXXGI2(LEXL2),BL^LEXXGI2
"RTN","LEXXGI",104,0)
 Q
"RTN","LEXXGI",105,0)
ABRT ;   Abort File
"RTN","LEXXGI",106,0)
 K ^LEXM(+LEXFI)
"RTN","LEXXGI",107,0)
 Q
"RTN","LEXXGI",108,0)
 ;            
"RTN","LEXXGI",109,0)
NOTIFY ; Notify by Protocol - LEXICAL SERVICES UPDATE
"RTN","LEXXGI",110,0)
 ;     Uses LEXSCHG() from the Post-Install
"RTN","LEXXGI",111,0)
 ;     Sets ^LEXM(0,"PRO")=$$NOW^XLFDT
"RTN","LEXXGI",112,0)
 N X,LEXU,LEXT,LEXF,LEXI,LEXL,LEX1,LEX2,LEX3,LEXN,LEXP,LEXUP
"RTN","LEXXGI",113,0)
 S LEXUP="" S:$D(LEXSCHG("C","ICD"))!($D(LEXSCHG(80)))!($D(LEXSCHG(80.1))) LEXUP=$G(LEXUP)_"ICD"
"RTN","LEXXGI",114,0)
 S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG(81)))!($D(LEXSCHG(81.3))) LEXUP=$G(LEXUP)_"/CPT"
"RTN","LEXXGI",115,0)
 S:$E(LEXUP,1)="/" LEXUP=$E(LEXUP,2,$L(LEXUP)) S:$L(LEXUP) LEXUP=LEXUP_" "
"RTN","LEXXGI",116,0)
 S LEXI=756.999999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="757")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI",117,0)
 S LEXI=79.9990999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="80")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI",118,0)
 S LEXI=80.9990999 F  S LEXI=$O(LEXSCHG(LEXI)) Q:+LEXI'>0!($P(LEXI,".",1)'="81")  S LEXT=$G(LEXT)_", "_LEXI
"RTN","LEXXGI",119,0)
 S:$E($G(LEXT),1,2)=", " LEXT=$E($G(LEXT),3,$L($G(LEXT))),LEXT=$$TRIM^LEXXGI2(LEXT)
"RTN","LEXXGI",120,0)
 I $L(LEXT) D
"RTN","LEXXGI",121,0)
 . S:$L(LEXT,", ")>1 LEXT=$P($G(LEXT),", ",1,($L($G(LEXT),", ")-1))_" and "_$P($G(LEXT),", ",$L($G(LEXT),", "))
"RTN","LEXXGI",122,0)
 S:$P($O(LEXSCHG(756.999999)),".",1)="757" LEXF="Lexicon" S:$P($O(LEXSCHG(79.999999)),".",1)=80 LEXF=$G(LEXF)_", ICD"
"RTN","LEXXGI",123,0)
 S:$P($O(LEXSCHG(80.999999)),".",1)=81 LEXF=$G(LEXF)_", CPT"
"RTN","LEXXGI",124,0)
 S:$E($G(LEXF),1,2)=", " LEXF=$E($G(LEXF),3,$L($G(LEXF))),LEXF=$$TRIM^LEXXGI2(LEXF)
"RTN","LEXXGI",125,0)
 I $L(LEXF) D
"RTN","LEXXGI",126,0)
 . S:$L(LEXF,", ")>1 LEXF=$P($G(LEXF),", ",1,($L($G(LEXF),", ")-1))_" and "_$P($G(LEXF),", ",$L($G(LEXF),", "))
"RTN","LEXXGI",127,0)
 . S:$L($P(LEXF,", ",1)) LEXF=$G(LEXF)_" File"_$S(LEXF[", ":"s",LEXF[" and ":"s",1:"")_" Updated"
"RTN","LEXXGI",128,0)
 S LEXL=78-($L(LEXF)+4),LEXU="Lexical Files Updated" I $L(LEXT)&($L(LEXF))&(LEXL>30) D
"RTN","LEXXGI",129,0)
 . S LEXU=LEXF N LEX S LEX=LEXT K LEXT S LEXT(1)=LEX D WP^LEXXGI2(.LEXT,LEXL)
"RTN","LEXXGI",130,0)
 S LEXP=+($O(^ORD(101,"B","LEXICAL SERVICES UPDATE",0))) Q:LEXP=0  S X=LEXP_";ORD(101," D EN^XQOR S:'$D(LEXSCHG) ^LEXM(0,"PRO")=$$NOW^XLFDT
"RTN","LEXXGI",131,0)
 Q:+($G(^LEXM(0,"PRO")))'>0
"RTN","LEXXGI",132,0)
 I $L($G(LEXU)) D
"RTN","LEXXGI",133,0)
 . N LEXI S LEXI=$L($G(LEXU))+3
"RTN","LEXXGI",134,0)
 . S X=$G(LEXU) D:$O(LEXT(0))'>0 BL^LEXXGI2,TL^LEXXGI2(X),BL^LEXXGI2 I $O(LEXT(0))>0 D
"RTN","LEXXGI",135,0)
 . . D BL^LEXXGI2 S X=$G(LEXU)_":  " N LEX S LEX=0 F  S LEX=$O(LEXT(LEX)) Q:+LEX'>0  D
"RTN","LEXXGI",136,0)
 . . . N LEXX S LEXX=$$TRIM^LEXXGI2($G(LEXT(LEX))) S:$L(LEXX) X=X_LEXX D TL^LEXXGI2(X) S X="",$P(X," ",+LEXI)=" "
"RTN","LEXXGI",137,0)
 . . D BL^LEXXGI2
"RTN","LEXXGI",138,0)
 S X="Protocol 'LEXICAL SERVICES UPDATE' was invoked" D TL^LEXXGI2(X)
"RTN","LEXXGI",139,0)
 S X="Subscribing applications were notified of the "_LEXUP_"update" D TL^LEXXGI2(X),BL^LEXXGI2
"RTN","LEXXGI",140,0)
 Q
"RTN","LEXXGI",141,0)
 ;              
"RTN","LEXXGI",142,0)
CHECKSUM ; ^LEXM Checksum
"RTN","LEXXGI",143,0)
 W !!,"Running checksum routine on the ^LEXM import global, please wait"
"RTN","LEXXGI",144,0)
 N LEXCHK,LEXNDS,LEXVER S LEXCHK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEXXGI",145,0)
 S LEXNDS=+($G(^LEXM(0,"NODES"))),LEXVER=+($$VER(LEXCHK,LEXNDS))
"RTN","LEXXGI",146,0)
 W ! W:LEXVER>0 "  ok",!
"RTN","LEXXGI",147,0)
 D:LEXVER=0 ET^LEXXGI2("Import global ^LEXM is missing.  Please obtain a copy of ^LEXM before"),ET^LEXXGI2("continuing.")
"RTN","LEXXGI",148,0)
 D:LEXVER=-1 ET^LEXXGI2("Unable to verify checksum for import global ^LEXM (possibly corrupt). "),ET^LEXXGI2("Please obtain a new copy of ^LEXM before continuing.")
"RTN","LEXXGI",149,0)
 D:LEXVER=-2 ET^LEXXGI2("Import global ^LEXM failed checksum.  Please obtain a new copy of ^LEXM"),ET^LEXXGI2("before continuing.")
"RTN","LEXXGI",150,0)
 I LEXVER=-3 D
"RTN","LEXXGI",151,0)
 . D ET^LEXXGI2("Import global ^LEXM failed checksum.  Additionally, your copy of the import")
"RTN","LEXXGI",152,0)
 . D ET^LEXXGI2("global ^LEXM is not complete (the number of global nodes exported and the")
"RTN","LEXXGI",153,0)
 . D ET^LEXXGI2("number of global nodes received do not match).  Please obtain a new copy of")
"RTN","LEXXGI",154,0)
 . D ET^LEXXGI2("^LEXM before continuing.")
"RTN","LEXXGI",155,0)
 D:$D(LEXE)&('$D(XPDNM)) ED^LEXXGI2
"RTN","LEXXGI",156,0)
 Q
"RTN","LEXXGI",157,0)
VER(X1,X2) ;   Verify ^LEXM
"RTN","LEXXGI",158,0)
 Q:'$D(^LEXM) 0
"RTN","LEXXGI",159,0)
 N LEXC,LEXCHK,LEXCNT,LEXD,LEXE,LEXGCS,LEXL,LEXLC,LEXN,LEXNC
"RTN","LEXXGI",160,0)
 N LEXNDX,LEXP,LEXS,LEXT
"RTN","LEXXGI",161,0)
 S LEXCHK=+($G(X1)),LEXNDS=+($G(X2)) Q:LEXCHK'>0!(LEXNDS'>0) -1
"RTN","LEXXGI",162,0)
 S LEXL=68,(LEXCNT,LEXLC)=0,LEXS=+(LEXNDS\LEXL)
"RTN","LEXXGI",163,0)
 S:LEXS=0 LEXS=1 W:+($O(^LEXM(0)))>0 !
"RTN","LEXXGI",164,0)
 S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0
"RTN","LEXXGI",165,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEXXGI",166,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"  Q:LEXN="^LEXM(0,""NODES"")"
"RTN","LEXXGI",167,0)
 . S LEXCNT=LEXCNT+1
"RTN","LEXXGI",168,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEXXGI",169,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD,LEXE=$L(LEXT)
"RTN","LEXXGI",170,0)
 . F LEXP=1:1:LEXE S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEXXGI",171,0)
 Q:LEXNC'=LEXNDS -3 Q:LEXGCS'=LEXCHK -2
"RTN","LEXXGI",172,0)
 Q 1
"RTN","LEXXGI2")
0^6^B10122401^B36675891
"RTN","LEXXGI2",1,0)
LEXXGI2 ; ISL/KER - Global Import (Update Change File w/^LEXM)  ; 01/01/2007
"RTN","LEXXGI2",2,0)
 ;;2.0;LEXICON UTILITY;**25,26,28,29,46**;Sep 23, 1996
"RTN","LEXXGI2",3,0)
 ;             
"RTN","LEXXGI2",4,0)
 ; Global Variables
"RTN","LEXXGI2",5,0)
 ;   ^LEXM(
"RTN","LEXXGI2",6,0)
 ;   DBIA 10011  ^UTILITY($J
"RTN","LEXXGI2",7,0)
 ;             
"RTN","LEXXGI2",8,0)
 ; External References
"RTN","LEXXGI2",9,0)
 ;   DBIA 10011  ^DIWP
"RTN","LEXXGI2",10,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXGI2",11,0)
 ;   DBIA 10103  $$FMDIFF^XLFDT
"RTN","LEXXGI2",12,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","LEXXGI2",13,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","LEXXGI2",14,0)
 ;             
"RTN","LEXXGI2",15,0)
 ; XPDNM   Newed by KIDS during Install
"RTN","LEXXGI2",16,0)
 Q
"RTN","LEXXGI2",17,0)
 ; Miscellaneous
"RTN","LEXXGI2",18,0)
NF ;   Import Global Not Found
"RTN","LEXXGI2",19,0)
 D PB("Import Global ^LEXM not found, consult the installation instructions")
"RTN","LEXXGI2",20,0)
 D TL("to install this global")
"RTN","LEXXGI2",21,0)
 Q
"RTN","LEXXGI2",22,0)
IG ;   Invalid Import Global
"RTN","LEXXGI2",23,0)
 D PB("Invalid Import Global ^LEXM, please consult the installation")
"RTN","LEXXGI2",24,0)
 D TL("instructions to reload this global")
"RTN","LEXXGI2",25,0)
 Q
"RTN","LEXXGI2",26,0)
BL ;   Blank Line
"RTN","LEXXGI2",27,0)
 N X S X="" W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(X) Q
"RTN","LEXXGI2",28,0)
PB(X) ;   Preceeding Blank Line
"RTN","LEXXGI2",29,0)
 S X=$G(X) Q:'$L(X)  W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) Q
"RTN","LEXXGI2",30,0)
TL(X) ;   Text Line
"RTN","LEXXGI2",31,0)
 S X=$G(X) Q:'$L(X)  W:'$D(XPDNM) !,X D:$D(XPDNM) MES^XPDUTL(X) Q
"RTN","LEXXGI2",32,0)
HACK(X) ;   Time
"RTN","LEXXGI2",33,0)
 S X=$$NOW^XLFDT Q X
"RTN","LEXXGI2",34,0)
ELAP(X1,X2) ;   Elapsed Time
"RTN","LEXXGI2",35,0)
 N X S X=$$FMDIFF^XLFDT(+($G(X2)),+($G(X1)),3)
"RTN","LEXXGI2",36,0)
 S:X="" X="00:00:00" S X=$TR(X," ","0") S X1=X Q X1
"RTN","LEXXGI2",37,0)
 Q
"RTN","LEXXGI2",38,0)
KLEXM ;   Kill ^LEXM(N)
"RTN","LEXXGI2",39,0)
 N LEX S LEX=0 F  S LEX=$O(^LEXM(LEX)) Q:+LEX=0  K ^LEMM(LEX)
"RTN","LEXXGI2",40,0)
 S LEX=$G(^LEXM(0,"PRO")) K ^LEXM(0) S:$L(LEX) ^LEXM(0,"PRO")=LEX
"RTN","LEXXGI2",41,0)
 Q
"RTN","LEXXGI2",42,0)
 ;   Error Text
"RTN","LEXXGI2",43,0)
ET(X) ;     Save Text
"RTN","LEXXGI2",44,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)=$G(X),LEXE(0)=LEXI Q
"RTN","LEXXGI2",45,0)
ED ;     Display Text
"RTN","LEXXGI2",46,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  W !,LEXE(LEXI)
"RTN","LEXXGI2",47,0)
 W ! K LEXE
"RTN","LEXXGI2",48,0)
 Q
"RTN","LEXXGI2",49,0)
 ;   Case
"RTN","LEXXGI2",50,0)
MIX(X) ;     Mixed Case
"RTN","LEXXGI2",51,0)
 S X=$G(X) N LEXTXT,LEXI S LEXTXT=""
"RTN","LEXXGI2",52,0)
 F LEXI=1:1:$L(X," ") S LEXTXT=LEXTXT_" "_$$UP($E($P(X," ",LEXI),1))_$$LO($E($P(X," ",LEXI),2,$L($P(X," ",LEXI))))
"RTN","LEXXGI2",53,0)
 F  Q:$E(LEXTXT,1)'=" "  S LEXTXT=$E(LEXTXT,2,$L(LEXTXT))
"RTN","LEXXGI2",54,0)
 S:$E(LEXTXT,1,3)="Cpt" LEXTXT="CPT"_$E(LEXTXT,4,$L(LEXTXT))
"RTN","LEXXGI2",55,0)
 S:$E(LEXTXT,1,3)="Icd" LEXTXT="ICD"_$E(LEXTXT,4,$L(LEXTXT))
"RTN","LEXXGI2",56,0)
 S X=LEXTXT Q X
"RTN","LEXXGI2",57,0)
UP(X) ;     Uppercase
"RTN","LEXXGI2",58,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","LEXXGI2",59,0)
LO(X) ;     Lowercase
"RTN","LEXXGI2",60,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","LEXXGI2",61,0)
WP(LEX,L) ;   Wrap Text LEX with Length L
"RTN","LEXXGI2",62,0)
 K ^UTILITY($J,"W") N %,CT,DA,DIC,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,DTOUT,DUOUT,LENGTH,TI,X,Z,END,I
"RTN","LEXXGI2",63,0)
 S TI=0,LENGTH=+($G(L)) F  S TI=$O(LEX(TI)) Q:+TI'>0  D
"RTN","LEXXGI2",64,0)
 . N X,DIWX,DN,DTOUT,DUOUT S X=$G(LEX(TI)),DIWL=1,DIWF="C78" S:+($G(LENGTH))>0 DIWF="C"_+($G(LENGTH)) D ^DIWP
"RTN","LEXXGI2",65,0)
 K LEX S (CT,I)=0 F  S I=$O(^UTILITY($J,"W",1,I)) Q:+I=0  D
"RTN","LEXXGI2",66,0)
 . S X=$G(^UTILITY($J,"W",1,I,0)),CT=CT+1,LEX(CT)=$$TRIM(X)
"RTN","LEXXGI2",67,0)
 K ^UTILITY($J,"W")
"RTN","LEXXGI2",68,0)
 Q
"RTN","LEXXGI2",69,0)
TRIM(X) ;   Trim Spaces
"RTN","LEXXGI2",70,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEXXGI2",71,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEXXGI2",72,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","LEXXGI2",73,0)
 Q X
"RTN","LEXXII")
0^5^B32607949^B28358070
"RTN","LEXXII",1,0)
LEXXII ; ISL/KER - Lexicon Status (Install Info) ; 01/01/2007
"RTN","LEXXII",2,0)
 ;;2.0;LEXICON UTILITY;**32,46**;Sep 23, 1996
"RTN","LEXXII",3,0)
 ;             
"RTN","LEXXII",4,0)
 ; Global Variables
"RTN","LEXXII",5,0)
 ;   DBIA 10096  ^%ZOSF("PROD"
"RTN","LEXXII",6,0)
 ;   DBIA 10096  ^%ZOSF("UCI"
"RTN","LEXXII",7,0)
 ;   DBIA 10060  ^VA(200
"RTN","LEXXII",8,0)
 ;   ^LEXM(0
"RTN","LEXXII",9,0)
 ;   ^TMP("LEX*",$J    SACC 2.3.2.5.1 
"RTN","LEXXII",10,0)
 ;             
"RTN","LEXXII",11,0)
 ; External References
"RTN","LEXXII",12,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXII",13,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXII",14,0)
 ;   DBIA 10103  $$FMDIFF^XLFDT
"RTN","LEXXII",15,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","LEXXII",16,0)
 ;   DBIA  2051  FIND^DIC
"RTN","LEXXII",17,0)
 ;   DBIA  2056  GETS^DIQ
"RTN","LEXXII",18,0)
 ;             
"RTN","LEXXII",19,0)
 ; LEXCRE   Newed in LEXXGI
"RTN","LEXXII",20,0)
 ; LEXID    Newed in LEXXFI
"RTN","LEXXII",21,0)
 ; LEXIGHF  Newed in Post-Install LEX20nnP
"RTN","LEXXII",22,0)
 ;            
"RTN","LEXXII",23,0)
EN ; Main Entry
"RTN","LEXXII",24,0)
 N LEXSUB S LEXSUB=$G(LEXID) S:LEXSUB="" LEXSUB="LEXXII" K ^TMP(LEXSUB,$J) D II
"RTN","LEXXII",25,0)
 Q
"RTN","LEXXII",26,0)
 ;                               
"RTN","LEXXII",27,0)
II ; Install Information
"RTN","LEXXII",28,0)
 N LEXT,LEXA,LEXB,LEXD,LEXE,LEXL,LEXU,LEXN,LEXP,LEXPRO,LEXPRON,LEXPROF,LEXDA H 2
"RTN","LEXXII",29,0)
 S LEXPRON="LEXICAL SERVICES UPDATE",LEXPRO=$G(^LEXM(0,"PRO")) S:+LEXPRO>0 LEXPRO=$$ED(LEXPRO),LEXPROF=1
"RTN","LEXXII",30,0)
 S LEXT="Lexicon/ICD/CPT Installation" D TL(LEXT)
"RTN","LEXXII",31,0)
 S LEXT="============================" D TL(LEXT),BL
"RTN","LEXXII",32,0)
 S LEXD=$$ASOF,LEXA=$$UCI,LEXU=$$USR,LEXN=$P(LEXU,"^",1)
"RTN","LEXXII",33,0)
 S LEXP=$P(LEXU,"^",2),LEXN=$$PM^LEXXFI7(LEXN)
"RTN","LEXXII",34,0)
 S:$L(LEXD) LEXT="  As of:       "_LEXD
"RTN","LEXXII",35,0)
 D:$L(LEXD) TL(LEXT)
"RTN","LEXXII",36,0)
 S LEXT="" S:$L(LEXA) LEXT="  In Account:  "_$S($L($P(LEXA,"^",1)):"[",1:"")_$P(LEXA,"^",1)_$S($L($P(LEXA,"^",2)):"]",1:"")
"RTN","LEXXII",37,0)
 S:$L(LEXT)&($L($P(LEXA,"^",2))) LEXT=LEXT_"  "_$P(LEXA,"^",2)
"RTN","LEXXII",38,0)
 D:$L(LEXA) TL(LEXT)
"RTN","LEXXII",39,0)
 S LEXT="" S:$L(LEXU) LEXT="  Maint By:    "
"RTN","LEXXII",40,0)
 S:$L(LEXN) LEXT=LEXT_LEXN
"RTN","LEXXII",41,0)
 S:$L(LEXP)&($L(LEXN)) LEXT=LEXT_"   "_LEXP
"RTN","LEXXII",42,0)
 D:$L(LEXT)&(LEXT'["UNKNOWN") TL(LEXT)
"RTN","LEXXII",43,0)
 S LEXT="" S:$L($G(LEXBUILD)) LEXT="  Build:       "_$G(LEXBUILD)
"RTN","LEXXII",44,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",45,0)
 S LEXT="" S:$L($G(LEXIGHF)) LEXT="  Host File:   "_$G(LEXIGHF)
"RTN","LEXXII",46,0)
 S:$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT=LEXT_" (Created "_$$ED($G(LEXCRE))_")"
"RTN","LEXXII",47,0)
 S:'$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT="  Created:     "_$$ED($G(LEXCRE))
"RTN","LEXXII",48,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",49,0)
 S LEXT="" I $L($G(LEXPRO))&($L($G(LEXPRON)))&(+($G(LEXPROF))>0) D
"RTN","LEXXII",50,0)
 . S LEXT="  Protocol:    "_LEXPRON D BL,TL(LEXT)
"RTN","LEXXII",51,0)
 . S LEXT="  Invoked:     "_LEXPRO D TL(LEXT)
"RTN","LEXXII",52,0)
 S LEXB=$$SS($G(LEXBUILD)),LEXE=$P(LEXB,"^",2),LEXL=$P(LEXB,"^",3),LEXB=$P(LEXB,"^",1)
"RTN","LEXXII",53,0)
 I $P(LEXB,".",1)?7N!($P(LEXB,".",2)?7N)!($P(LEXB,".",3)[":") D
"RTN","LEXXII",54,0)
 . D BL
"RTN","LEXXII",55,0)
 . I $P(LEXB,".",1)?7N D
"RTN","LEXXII",56,0)
 . . S LEXT="" S LEXT="  Started:     "_$$ED($G(LEXB)) D TL(LEXT)
"RTN","LEXXII",57,0)
 . I $P(LEXE,".",1)?7N D
"RTN","LEXXII",58,0)
 . . S LEXT="" S LEXT="  Finished:    "_$$ED($G(LEXE)) D TL(LEXT)
"RTN","LEXXII",59,0)
 . I $L(LEXL) D
"RTN","LEXXII",60,0)
 . . S LEXT="" S LEXT="  Elapsed:     "_$$ED($G(LEXL)) D TL(LEXT)
"RTN","LEXXII",61,0)
 D BL
"RTN","LEXXII",62,0)
 Q
"RTN","LEXXII",63,0)
 ;                             
"RTN","LEXXII",64,0)
 ; Miscellaneous
"RTN","LEXXII",65,0)
UCI(LEX) ;   UCI where Lexicon is installed
"RTN","LEXXII",66,0)
 N LEXU,LEXP,LEXT X ^%ZOSF("UCI") S LEXU=Y S:Y=^%ZOSF("PROD") LEXP=" (PROD)"
"RTN","LEXXII",67,0)
 S:Y'=^%ZOSF("PROD") LEXP=" (TEST)" S:LEXU["VHA,ROU" LEXP=" (PROD)"
"RTN","LEXXII",68,0)
 S:LEXU["DEM" LEXP=" (DEMO)" S LEX="",$P(LEX,"^",1)=LEXU,$P(LEX,"^",2)=LEXP
"RTN","LEXXII",69,0)
 Q LEX
"RTN","LEXXII",70,0)
USR(LEX) ;   User/Person
"RTN","LEXXII",71,0)
 N LEXDUZ,LEXPH,LEXNM
"RTN","LEXXII",72,0)
 S LEX=+($G(DUZ)),LEXNM=$$GET1^DIQ(200,+LEX,.01) Q:'$L(LEXNM) "UNKNOWN^"
"RTN","LEXXII",73,0)
 S LEXDUZ=LEX S LEXPH=$$GET1^DIQ(200,+LEXDUZ,.132) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.131)
"RTN","LEXXII",74,0)
 S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.133) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.134)
"RTN","LEXXII",75,0)
 S LEXDUZ=$$GET1^DIQ(200,+LEX,.01),LEX=LEXDUZ_"^"_LEXPH Q LEX
"RTN","LEXXII",76,0)
SS(LEX) ;   Start/Stop Times
"RTN","LEXXII",77,0)
 N LEXDA,LEXOUT,LEXIENS,LEXB,LEXBUILD,LEXB,LEXE,LEXL
"RTN","LEXXII",78,0)
 S LEXBUILD=$G(LEX),LEXD=0 S:$L(LEXBUILD) LEXD=$$DDA(LEXBUILD)
"RTN","LEXXII",79,0)
 S LEXDA=+($G(XPDA))
"RTN","LEXXII",80,0)
 I +LEXDA>0 D
"RTN","LEXXII",81,0)
 . S LEXIENS=LEXDA_","
"RTN","LEXXII",82,0)
 . D GETS^DIQ(9.7,LEXIENS,"11;17","I","LEXOUT")
"RTN","LEXXII",83,0)
 . S LEXL=0,LEXB=$G(LEXOUT(9.7,LEXIENS,11,"I"))
"RTN","LEXXII",84,0)
 . S LEXE=$G(LEXOUT(9.7,LEXIENS,17,"I"))
"RTN","LEXXII",85,0)
 . S:+LEXE'>0 LEXE=$$NOW^XLFDT
"RTN","LEXXII",86,0)
 . S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",87,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",88,0)
 I +LEXDA=0 D
"RTN","LEXXII",89,0)
 . S LEX="" S LEXDA=+($G(LEXD)) Q:+LEXDA'>0
"RTN","LEXXII",90,0)
 . S LEXL="",LEXB=$P($G(LEXD),"^",2) Q:$P(LEXB,".",1)'?7N
"RTN","LEXXII",91,0)
 . S LEXE=$P($G(LEXD),"^",3) Q:$P(LEXE,".",1)'?7N
"RTN","LEXXII",92,0)
 . S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",93,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",94,0)
 Q LEX
"RTN","LEXXII",95,0)
DDA(LEX) ;   Get Default DA of Build LEX
"RTN","LEXXII",96,0)
 N LEXB,LEXE,LEXOUT,LEXMSG,LEXI S LEXB=$G(LEX) Q:'$L(LEXB) ""
"RTN","LEXXII",97,0)
 D FIND^DIC(9.7,,"11I;17I","BP",LEXB,,"B",,,"LEXOUT","LEXMSG")
"RTN","LEXXII",98,0)
 S LEXI=+($O(LEXOUT("DILIST"," "),-1))
"RTN","LEXXII",99,0)
 S LEXB=$G(LEXOUT("DILIST",+LEXI,0))
"RTN","LEXXII",100,0)
 S LEXI=$P(LEXB,"^",1),LEXE=$P(LEXB,"^",4),LEXB=$P(LEXB,"^",3)
"RTN","LEXXII",101,0)
 Q:+($G(LEXI))'>0 ""  Q:+($G(LEXB))'>0 ""  S:+LEXE'>0 LEXE=$$NOW^XLFDT
"RTN","LEXXII",102,0)
 S LEX=LEXI_"^"_LEXB_"^"_LEXE
"RTN","LEXXII",103,0)
 Q LEX
"RTN","LEXXII",104,0)
ASOF(LEX) ;   As of date/time
"RTN","LEXXII",105,0)
 S X=$$ED($$NOW^XLFDT) Q X
"RTN","LEXXII",106,0)
ED(LEX) ;   External Date MM/DD/YYYY TT:TT
"RTN","LEXXII",107,0)
 S LEX=$$FMTE^XLFDT($G(LEX),"1Z")
"RTN","LEXXII",108,0)
 S:LEX["@" LEX=$P(LEX,"@",1)_"  "_$P(LEX,"@",2,299) Q LEX
"RTN","LEXXII",109,0)
 Q LEX
"RTN","LEXXII",110,0)
EP(X,Y) ;   Elapsed Time (Begin, End)
"RTN","LEXXII",111,0)
 N LEXTIM,LEXBEG,LEXEND
"RTN","LEXXII",112,0)
 S LEXBEG=$G(X),LEXEND=$G(Y) Q:+LEXBEG'>0 ""  Q:+LEXEND'>0 ""
"RTN","LEXXII",113,0)
 S LEXTIM=$$FMDIFF^XLFDT(LEXEND,LEXBEG,2) Q:+LEXTIM'>0 "00:00:00"
"RTN","LEXXII",114,0)
 S LEXTIM=$$TIM(LEXTIM)
"RTN","LEXXII",115,0)
 Q LEXTIM
"RTN","LEXXII",116,0)
TIM(X) ;   Format Time Elapsed
"RTN","LEXXII",117,0)
 N LEXD,LEXH,LEXM,LEXS,LEXT,LEXV S X=+($G(X)) Q:X'>0 "00:00:00"
"RTN","LEXXII",118,0)
 S LEXD=X\86400 S LEXV=LEXD*86400 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",119,0)
 S LEXH=X\3600 S LEXV=LEXH*3600 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",120,0)
 S:$L(LEXH)<2 LEXH="0"_LEXH S:$L(LEXH)<2 LEXH="0"_LEXH
"RTN","LEXXII",121,0)
 S LEXM=X\60 S LEXV=LEXM*60 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",122,0)
 S:$L(LEXM)<2 LEXM="0"_LEXM S:$L(LEXM)<2 LEXM="0"_LEXM
"RTN","LEXXII",123,0)
 S LEXS=X S:$L(LEXS)<2 LEXS="0"_LEXS S:$L(LEXS)<2 LEXS="0"_LEXS
"RTN","LEXXII",124,0)
 S LEXT="" S:+LEXD>0 LEXT=+LEXD_" day"_$S(+LEXD>1:"s",1:"")_" "
"RTN","LEXXII",125,0)
 S LEXT=LEXT_LEXH_":"_LEXM_":"_LEXS,X=LEXT
"RTN","LEXXII",126,0)
 Q X
"RTN","LEXXII",127,0)
BL ;   Blank Line
"RTN","LEXXII",128,0)
 D TL("") Q
"RTN","LEXXII",129,0)
TL(LEXX) ;   Text Line
"RTN","LEXXII",130,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",131,0)
 I '$D(^TMP(LEXSUB,$J,1)) S ^TMP(LEXSUB,$J,1)=" ",^TMP(LEXSUB,$J,0)=1
"RTN","LEXXII",132,0)
 N LEXNX S LEXNX=$O(^TMP(LEXSUB,$J," "),-1),LEXNX=LEXNX+1
"RTN","LEXXII",133,0)
 S ^TMP(LEXSUB,$J,LEXNX)=" "_$G(LEXX),^TMP(LEXSUB,$J,0)=LEXNX
"RTN","LEXXII",134,0)
 Q
"RTN","LEXXII",135,0)
ST ;   Show Temp Array
"RTN","LEXXII",136,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",137,0)
 N LEXN,LEXC S LEXN="^TMP("""_LEXSUB_""","_$J_")",LEXC="^TMP("""_LEXSUB_""","_$J_","
"RTN","LEXXII",138,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEXXII",139,0)
 . Q:LEXN[",0)"  W !,@LEXN
"RTN","LEXXII",140,0)
 Q
"VER")
8.0^22.0
"BLD",5861,6)
^44
**END**
**END**
