Released IB*2*240 SEQ #248
Extracted from mail message
**KIDS**:IB*2.0*240^

**INSTALL NAME**
IB*2.0*240
"BLD",5450,0)
IB*2.0*240^INTEGRATED BILLING^0^3040630^y
"BLD",5450,1,0)
^^2^2^3040525^^^
"BLD",5450,1,1,0)
Remove references to CHAMPUS.
"BLD",5450,1,2,0)
Fix <UNDEFINED>YR+6^IBAECU by correcting code in IBECEA3.
"BLD",5450,4,0)
^9.64PA^350.1^7
"BLD",5450,4,350.1,0)
350.1
"BLD",5450,4,350.1,2,0)
^9.641^350.1^1
"BLD",5450,4,350.1,2,350.1,0)
IB ACTION TYPE  (File-top level)
"BLD",5450,4,350.1,2,350.1,1,0)
^9.6411^.11^1
"BLD",5450,4,350.1,2,350.1,1,.11,0)
BILLING GROUP
"BLD",5450,4,350.1,222)
y^n^p^^^^n^^n
"BLD",5450,4,350.1,224)

"BLD",5450,4,350.9,0)
350.9
"BLD",5450,4,350.9,2,0)
^9.641^350.9^1
"BLD",5450,4,350.9,2,350.9,0)
IB SITE PARAMETERS  (File-top level)
"BLD",5450,4,350.9,2,350.9,1,0)
^9.6411^9.13^4
"BLD",5450,4,350.9,2,350.9,1,9.01,0)
BILLING PORT
"BLD",5450,4,350.9,2,350.9,1,9.02,0)
AWP PORT
"BLD",5450,4,350.9,2,350.9,1,9.12,0)
AWP CHARGE SET
"BLD",5450,4,350.9,2,350.9,1,9.13,0)
PRESCRIBER ID
"BLD",5450,4,350.9,222)
y^y^p^^^^n^^n
"BLD",5450,4,350.9,224)

"BLD",5450,4,351.5,0)
351.5
"BLD",5450,4,351.5,2,0)
^9.641^351.5^1
"BLD",5450,4,351.5,2,351.5,0)
TRICARE PHARMACY TRANSACTIONS  (File-top level)
"BLD",5450,4,351.5,2,351.5,1,0)
^9.6411^^
"BLD",5450,4,351.5,222)
y^n^p^^^^n^^n
"BLD",5450,4,351.5,224)

"BLD",5450,4,351.51,0)
351.51
"BLD",5450,4,351.51,2,0)
^9.641^351.51^1
"BLD",5450,4,351.51,2,351.51,0)
TRICARE PHARMACY ERRORS  (File-top level)
"BLD",5450,4,351.51,2,351.51,1,0)
^9.6411^^
"BLD",5450,4,351.51,222)
y^n^p^^^^n^^n
"BLD",5450,4,351.51,224)

"BLD",5450,4,351.52,0)
351.52
"BLD",5450,4,351.52,2,0)
^9.641^351.52^1
"BLD",5450,4,351.52,2,351.52,0)
TRICARE PHARMACY REJECTS  (File-top level)
"BLD",5450,4,351.52,2,351.52,1,0)
^9.6411^^
"BLD",5450,4,351.52,222)
y^n^p^^^^n^^n
"BLD",5450,4,351.52,224)

"BLD",5450,4,355.3,0)
355.3
"BLD",5450,4,355.3,2,0)
^9.641^355.3^1
"BLD",5450,4,355.3,2,355.3,0)
GROUP INSURANCE PLAN  (File-top level)
"BLD",5450,4,355.3,2,355.3,1,0)
^9.6411^.15^1
"BLD",5450,4,355.3,2,355.3,1,.15,0)
ELECTRONIC PLAN TYPE
"BLD",5450,4,355.3,222)
y^n^p^^^^n^^n
"BLD",5450,4,355.3,224)

"BLD",5450,4,355.8,0)
355.8
"BLD",5450,4,355.8,2,0)
^9.641^355.8^1
"BLD",5450,4,355.8,2,355.8,0)
SPONSOR  (File-top level)
"BLD",5450,4,355.8,2,355.8,1,0)
^9.6411^^
"BLD",5450,4,355.8,222)
y^n^p^^^^n^^n
"BLD",5450,4,355.8,224)

"BLD",5450,4,"APDD",350.1,350.1)

"BLD",5450,4,"APDD",350.1,350.1,.11)

"BLD",5450,4,"APDD",350.9,350.9)

"BLD",5450,4,"APDD",350.9,350.9,9.01)

"BLD",5450,4,"APDD",350.9,350.9,9.02)

"BLD",5450,4,"APDD",350.9,350.9,9.12)

"BLD",5450,4,"APDD",350.9,350.9,9.13)

"BLD",5450,4,"APDD",351.5,351.5)

"BLD",5450,4,"APDD",351.51,351.51)

"BLD",5450,4,"APDD",351.52,351.52)

"BLD",5450,4,"APDD",355.3,355.3)

"BLD",5450,4,"APDD",355.3,355.3,.15)

"BLD",5450,4,"APDD",355.8,355.8)

"BLD",5450,4,"B",350.1,350.1)

"BLD",5450,4,"B",350.9,350.9)

"BLD",5450,4,"B",351.5,351.5)

"BLD",5450,4,"B",351.51,351.51)

"BLD",5450,4,"B",351.52,351.52)

"BLD",5450,4,"B",355.3,355.3)

"BLD",5450,4,"B",355.8,355.8)

"BLD",5450,"ABPKG")
n
"BLD",5450,"INID")
^n
"BLD",5450,"INIT")
IB20P240
"BLD",5450,"KRN",0)
^9.67PA^8989.52^19
"BLD",5450,"KRN",.4,0)
.4
"BLD",5450,"KRN",.401,0)
.401
"BLD",5450,"KRN",.402,0)
.402
"BLD",5450,"KRN",.403,0)
.403
"BLD",5450,"KRN",.5,0)
.5
"BLD",5450,"KRN",.84,0)
.84
"BLD",5450,"KRN",3.6,0)
3.6
"BLD",5450,"KRN",3.8,0)
3.8
"BLD",5450,"KRN",9.2,0)
9.2
"BLD",5450,"KRN",9.8,0)
9.8
"BLD",5450,"KRN",9.8,"NM",0)
^9.68A^29^29
"BLD",5450,"KRN",9.8,"NM",1,0)
IBACUS^^0^B7353241
"BLD",5450,"KRN",9.8,"NM",2,0)
IBACUS1^^0^B5336207
"BLD",5450,"KRN",9.8,"NM",3,0)
IBACUS2^^0^B33239765
"BLD",5450,"KRN",9.8,"NM",4,0)
IBACVA2^^0^B15743651
"BLD",5450,"KRN",9.8,"NM",5,0)
IBCBB7^^0^B26711457
"BLD",5450,"KRN",9.8,"NM",6,0)
IBCNBAR^^0^B18172525
"BLD",5450,"KRN",9.8,"NM",7,0)
IBCNS1^^0^B34528689
"BLD",5450,"KRN",9.8,"NM",8,0)
IBCNSBL2^^0^B28176933
"BLD",5450,"KRN",9.8,"NM",9,0)
IBCNSMR^^0^B56951877
"BLD",5450,"KRN",9.8,"NM",10,0)
IBCNSU41^^0^B21365764
"BLD",5450,"KRN",9.8,"NM",11,0)
IBECEA2^^0^B18691868
"BLD",5450,"KRN",9.8,"NM",12,0)
IBECEA3^^0^B61517877
"BLD",5450,"KRN",9.8,"NM",13,0)
IBECEA4^^0^B9459925
"BLD",5450,"KRN",9.8,"NM",14,0)
IBECUS^^0^B17845253
"BLD",5450,"KRN",9.8,"NM",15,0)
IBECUS1^^0^B19467740
"BLD",5450,"KRN",9.8,"NM",16,0)
IBECUS2^^0^B33007579
"BLD",5450,"KRN",9.8,"NM",17,0)
IBECUS21^^0^B14370648
"BLD",5450,"KRN",9.8,"NM",18,0)
IBECUS22^^0^B7141414
"BLD",5450,"KRN",9.8,"NM",19,0)
IBECUS3^^0^B7684142
"BLD",5450,"KRN",9.8,"NM",20,0)
IBECUSM^^0^B34135929
"BLD",5450,"KRN",9.8,"NM",21,0)
IBECUSO^^0^B40332782
"BLD",5450,"KRN",9.8,"NM",22,0)
IBJDF5^^0^B27507847
"BLD",5450,"KRN",9.8,"NM",23,0)
IBJDF51^^0^B57252873
"BLD",5450,"KRN",9.8,"NM",24,0)
IBJDF52^^0^B27532688
"BLD",5450,"KRN",9.8,"NM",25,0)
IBJDF53^^0^B23014780
"BLD",5450,"KRN",9.8,"NM",26,0)
IBJDF7H^^0^B10633753
"BLD",5450,"KRN",9.8,"NM",27,0)
IBECEA35^^0^B9285866
"BLD",5450,"KRN",9.8,"NM",28,0)
IBJDF5H^^0^B8952836
"BLD",5450,"KRN",9.8,"NM",29,0)
IB20P240^^0^B50919655
"BLD",5450,"KRN",9.8,"NM","B","IB20P240",29)

"BLD",5450,"KRN",9.8,"NM","B","IBACUS",1)

"BLD",5450,"KRN",9.8,"NM","B","IBACUS1",2)

"BLD",5450,"KRN",9.8,"NM","B","IBACUS2",3)

"BLD",5450,"KRN",9.8,"NM","B","IBACVA2",4)

"BLD",5450,"KRN",9.8,"NM","B","IBCBB7",5)

"BLD",5450,"KRN",9.8,"NM","B","IBCNBAR",6)

"BLD",5450,"KRN",9.8,"NM","B","IBCNS1",7)

"BLD",5450,"KRN",9.8,"NM","B","IBCNSBL2",8)

"BLD",5450,"KRN",9.8,"NM","B","IBCNSMR",9)

"BLD",5450,"KRN",9.8,"NM","B","IBCNSU41",10)

"BLD",5450,"KRN",9.8,"NM","B","IBECEA2",11)

"BLD",5450,"KRN",9.8,"NM","B","IBECEA3",12)

"BLD",5450,"KRN",9.8,"NM","B","IBECEA35",27)

"BLD",5450,"KRN",9.8,"NM","B","IBECEA4",13)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS",14)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS1",15)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS2",16)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS21",17)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS22",18)

"BLD",5450,"KRN",9.8,"NM","B","IBECUS3",19)

"BLD",5450,"KRN",9.8,"NM","B","IBECUSM",20)

"BLD",5450,"KRN",9.8,"NM","B","IBECUSO",21)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF5",22)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF51",23)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF52",24)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF53",25)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF5H",28)

"BLD",5450,"KRN",9.8,"NM","B","IBJDF7H",26)

"BLD",5450,"KRN",19,0)
19
"BLD",5450,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5450,"KRN",19.1,0)
19.1
"BLD",5450,"KRN",101,0)
101
"BLD",5450,"KRN",409.61,0)
409.61
"BLD",5450,"KRN",771,0)
771
"BLD",5450,"KRN",870,0)
870
"BLD",5450,"KRN",8989.51,0)
8989.51
"BLD",5450,"KRN",8989.52,0)
8989.52
"BLD",5450,"KRN",8994,0)
8994
"BLD",5450,"KRN","B",.4,.4)

"BLD",5450,"KRN","B",.401,.401)

"BLD",5450,"KRN","B",.402,.402)

"BLD",5450,"KRN","B",.403,.403)

"BLD",5450,"KRN","B",.5,.5)

"BLD",5450,"KRN","B",.84,.84)

"BLD",5450,"KRN","B",3.6,3.6)

"BLD",5450,"KRN","B",3.8,3.8)

"BLD",5450,"KRN","B",9.2,9.2)

"BLD",5450,"KRN","B",9.8,9.8)

"BLD",5450,"KRN","B",19,19)

"BLD",5450,"KRN","B",19.1,19.1)

"BLD",5450,"KRN","B",101,101)

"BLD",5450,"KRN","B",409.61,409.61)

"BLD",5450,"KRN","B",771,771)

"BLD",5450,"KRN","B",870,870)

"BLD",5450,"KRN","B",8989.51,8989.51)

"BLD",5450,"KRN","B",8989.52,8989.52)

"BLD",5450,"KRN","B",8994,8994)

"BLD",5450,"QUES",0)
^9.62^^
"BLD",5450,"REQB",0)
^9.611^16^16
"BLD",5450,"REQB",1,0)
IB*2.0*51^2
"BLD",5450,"REQB",2,0)
IB*2.0*52^2
"BLD",5450,"REQB",3,0)
IB*2.0*82^2
"BLD",5450,"REQB",4,0)
IB*2.0*89^2
"BLD",5450,"REQB",5,0)
IB*2.0*92^2
"BLD",5450,"REQB",6,0)
IB*2.0*123^2
"BLD",5450,"REQB",7,0)
IB*2.0*137^2
"BLD",5450,"REQB",8,0)
IB*2.0*150^2
"BLD",5450,"REQB",9,0)
IB*2.0*153^2
"BLD",5450,"REQB",10,0)
IB*2.0*159^2
"BLD",5450,"REQB",11,0)
IB*2.0*162^2
"BLD",5450,"REQB",12,0)
IB*2.0*183^2
"BLD",5450,"REQB",13,0)
IB*2.0*185^2
"BLD",5450,"REQB",14,0)
IB*2.0*202^2
"BLD",5450,"REQB",15,0)
IB*2.0*211^2
"BLD",5450,"REQB",16,0)
PRCA*4.5*192^2
"BLD",5450,"REQB","B","IB*2.0*123",6)

"BLD",5450,"REQB","B","IB*2.0*137",7)

"BLD",5450,"REQB","B","IB*2.0*150",8)

"BLD",5450,"REQB","B","IB*2.0*153",9)

"BLD",5450,"REQB","B","IB*2.0*159",10)

"BLD",5450,"REQB","B","IB*2.0*162",11)

"BLD",5450,"REQB","B","IB*2.0*183",12)

"BLD",5450,"REQB","B","IB*2.0*185",13)

"BLD",5450,"REQB","B","IB*2.0*202",14)

"BLD",5450,"REQB","B","IB*2.0*211",15)

"BLD",5450,"REQB","B","IB*2.0*51",1)

"BLD",5450,"REQB","B","IB*2.0*52",2)

"BLD",5450,"REQB","B","IB*2.0*82",3)

"BLD",5450,"REQB","B","IB*2.0*89",4)

"BLD",5450,"REQB","B","IB*2.0*92",5)

"BLD",5450,"REQB","B","PRCA*4.5*192",16)

"FIA",350.1)
IB ACTION TYPE
"FIA",350.1,0)
^IBE(350.1,
"FIA",350.1,0,0)
350.1
"FIA",350.1,0,1)
y^n^p^^^^n^^n
"FIA",350.1,0,10)

"FIA",350.1,0,11)

"FIA",350.1,0,"RLRO")

"FIA",350.1,0,"VR")
2.0^IB
"FIA",350.1,350.1)
1
"FIA",350.1,350.1,.11)

"FIA",350.9)
IB SITE PARAMETERS
"FIA",350.9,0)
^IBE(350.9,
"FIA",350.9,0,0)
350.9I
"FIA",350.9,0,1)
y^y^p^^^^n^^n
"FIA",350.9,0,10)

"FIA",350.9,0,11)

"FIA",350.9,0,"RLRO")

"FIA",350.9,0,"VR")
2.0^IB
"FIA",350.9,350.9)
1
"FIA",350.9,350.9,9.01)

"FIA",350.9,350.9,9.02)

"FIA",350.9,350.9,9.12)

"FIA",350.9,350.9,9.13)

"FIA",351.5)
TRICARE PHARMACY TRANSACTIONS
"FIA",351.5,0)
^IBA(351.5,
"FIA",351.5,0,0)
351.5
"FIA",351.5,0,1)
y^n^f^^^^n^^n
"FIA",351.5,0,10)

"FIA",351.5,0,11)

"FIA",351.5,0,"RLRO")

"FIA",351.5,0,"VR")
2.0^IB
"FIA",351.5,351.5)
0
"FIA",351.51)
TRICARE PHARMACY ERRORS
"FIA",351.51,0)
^IBE(351.51,
"FIA",351.51,0,0)
351.51
"FIA",351.51,0,1)
y^n^f^^^^n^^n
"FIA",351.51,0,10)

"FIA",351.51,0,11)

"FIA",351.51,0,"RLRO")

"FIA",351.51,0,"VR")
2.0^IB
"FIA",351.51,351.51)
0
"FIA",351.52)
TRICARE PHARMACY REJECTS
"FIA",351.52,0)
^IBA(351.52,
"FIA",351.52,0,0)
351.52
"FIA",351.52,0,1)
y^n^f^^^^n^^n
"FIA",351.52,0,10)

"FIA",351.52,0,11)

"FIA",351.52,0,"RLRO")

"FIA",351.52,0,"VR")
2.0^IB
"FIA",351.52,351.52)
0
"FIA",355.3)
GROUP INSURANCE PLAN
"FIA",355.3,0)
^IBA(355.3,
"FIA",355.3,0,0)
355.3IP
"FIA",355.3,0,1)
y^n^p^^^^n^^n
"FIA",355.3,0,10)

"FIA",355.3,0,11)

"FIA",355.3,0,"RLRO")

"FIA",355.3,0,"VR")
2.0^IB
"FIA",355.3,355.3)
1
"FIA",355.3,355.3,.15)

"FIA",355.8)
SPONSOR
"FIA",355.8,0)
^IBA(355.8,
"FIA",355.8,0,0)
355.8V
"FIA",355.8,0,1)
y^n^f^^^^n^^n
"FIA",355.8,0,10)

"FIA",355.8,0,11)

"FIA",355.8,0,"RLRO")

"FIA",355.8,0,"VR")
2.0^IB
"FIA",355.8,355.8)
0
"INIT")
IB20P240
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
240^3040630
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3040630
"PKG",200,22,1,"PAH",1,1,1,0)
Remove references to CHAMPUS.
"PKG",200,22,1,"PAH",1,1,2,0)
Fix <UNDEFINED>YR+6^IBAECU by correcting code in IBECEA3.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
29
"RTN","IB20P240")
0^29^B50919655
"RTN","IB20P240",1,0)
IB20P240 ;ALB/RLC - Post-Init routine for IB*2.0*240; 8/19/2003
"RTN","IB20P240",2,0)
 ;;2.0;INTEGRATED BILLING;**240**;21-MAR-94
"RTN","IB20P240",3,0)
 ;
"RTN","IB20P240",4,0)
 ; This post-init routine is to change and update all references of
"RTN","IB20P240",5,0)
 ; CHAMPUS to TRICARE in numerous IB files.
"RTN","IB20P240",6,0)
 ;
"RTN","IB20P240",7,0)
EN ; entry point for post-init process
"RTN","IB20P240",8,0)
 S U="^"
"RTN","IB20P240",9,0)
 D EN1
"RTN","IB20P240",10,0)
 D EN2
"RTN","IB20P240",11,0)
 D EN3
"RTN","IB20P240",12,0)
 D EN4
"RTN","IB20P240",13,0)
 D EN5
"RTN","IB20P240",14,0)
 D EN6
"RTN","IB20P240",15,0)
 Q
"RTN","IB20P240",16,0)
 ;
"RTN","IB20P240",17,0)
EN1 ; root name ^IBE - files 350.1, 351.7, 355.1, 355.2, 355.97 and 363
"RTN","IB20P240",18,0)
 F FN=1:1 S FILENUM=$P($T(FILE1+FN),";;",2,999) Q:FILENUM=""  D
"RTN","IB20P240",19,0)
 . S (CHID,NODE0,FLD01,FLD02,FLD08)=""
"RTN","IB20P240",20,0)
 . F  S CHID=$O(^IBE(FILENUM,"B",CHID)) Q:CHID=""  D
"RTN","IB20P240",21,0)
 . .  Q:CHID'["CHAMPUS"
"RTN","IB20P240",22,0)
 . .  S DA=$O(^IBE(FILENUM,"B",CHID,0)) Q:'DA
"RTN","IB20P240",23,0)
 . .  S NODE0=$G(^IBE(FILENUM,DA,0))
"RTN","IB20P240",24,0)
 . .  S FLD01=$P(NODE0,U,1)
"RTN","IB20P240",25,0)
 . .  S STRING=""
"RTN","IB20P240",26,0)
 . .  I FLD01["(Tricare)" F X=1:1 S P(X)=$P(FLD01," ",X) Q:P(X)=""  S:P(X)'["(Tricare)" STRING=STRING_P(X)_" "
"RTN","IB20P240",27,0)
 . .  S STRING=$E(STRING,1,$L(STRING)-1)
"RTN","IB20P240",28,0)
 . .  I FLD01'["(Tricare)" S STRING=FLD01
"RTN","IB20P240",29,0)
 . .  I $E(STRING,1,2)="DG" S STRING=$E(STRING,1,3)_$TR($E(STRING,4,10),"CHAMPUS","TRICARE")_$E(STRING,11,$L(STRING))
"RTN","IB20P240",30,0)
 . .  E  I $E(STRING,1,2)'="DG" S STRING=$TR($E(STRING,1,7),"CHAMPUS","TRICARE")_$E(STRING,8,$L(STRING))
"RTN","IB20P240",31,0)
 . .  I FILENUM="350.1" D F3501 Q
"RTN","IB20P240",32,0)
 . .  I FILENUM="355.1" D F3551 Q
"RTN","IB20P240",33,0)
 . .  I FILENUM="355.2" D F3552 Q
"RTN","IB20P240",34,0)
 . .  L +^IBE(FILENUM)
"RTN","IB20P240",35,0)
 . .  S DIE="^IBE(FILENUM,",DR=".01////"_STRING D ^DIE
"RTN","IB20P240",36,0)
 . .  K DIE,DA,DR,STRING,FLD01,NODE0
"RTN","IB20P240",37,0)
 . .  L -^IBE(FILENUM)
"RTN","IB20P240",38,0)
 . Q
"RTN","IB20P240",39,0)
 K FN,FILENUM,CHID,NODE0,FLD01,FLD02,FLD08
"RTN","IB20P240",40,0)
 Q
"RTN","IB20P240",41,0)
 ;
"RTN","IB20P240",42,0)
F3501 ; for file 350.1 must also update fields .02 and .08, and cross-
"RTN","IB20P240",43,0)
 ; references "D" and "E".  Also, need to change external value for
"RTN","IB20P240",44,0)
 ; set of codes in field .11 to Tricare for internal code 7.
"RTN","IB20P240",45,0)
 S FLD02=$P(NODE0,U,2)
"RTN","IB20P240",46,0)
 I FLD02["CUS" S FLD02=$TR($E(FLD02,1,3),"CUS","TRI")_$E(FLD02,4,$L(FLD02))
"RTN","IB20P240",47,0)
 I FLD02["CAN" S FLD02=$E(FLD02,1,4)_$TR($E(FLD02,5),"C","T")_$E(FLD02,6,$L(FLD02))
"RTN","IB20P240",48,0)
 S FLD08=$P(NODE0,U,8)
"RTN","IB20P240",49,0)
 S FLD08=$TR($E(FLD08,1,7),"CHAMPUS","TRICARE")_$E(FLD08,8,$L(FLD08))
"RTN","IB20P240",50,0)
 L +^IBE(350.1)
"RTN","IB20P240",51,0)
 S DIE="^IBE(350.1,",DR=".01////"_STRING_";.02////"_FLD02_";.08////"_FLD08 D ^DIE
"RTN","IB20P240",52,0)
 L -^IBE(350.1)
"RTN","IB20P240",53,0)
 K DIE,DA,DR,FLD02,FLD08,STRING
"RTN","IB20P240",54,0)
 Q
"RTN","IB20P240",55,0)
 ;
"RTN","IB20P240",56,0)
F3551 ; for file 355.1 must also update field .02, and "D" cross-reference
"RTN","IB20P240",57,0)
 S FLD02=$P(NODE0,U,2)
"RTN","IB20P240",58,0)
 Q:FLD02'="CPS"&"CS"
"RTN","IB20P240",59,0)
 S:FLD02="CPS" FLD02=$TR($E(FLD02,1,3),"CPS","TRI")
"RTN","IB20P240",60,0)
 S:FLD02="CS" FLD02=$TR($E(FLD02,1,2),"CS","TS")
"RTN","IB20P240",61,0)
 L +^IBE(355.1)
"RTN","IB20P240",62,0)
 S DIE="^IBE(355.1,",DR=".01////"_STRING_";.02////"_FLD02 D ^DIE
"RTN","IB20P240",63,0)
 D F35510
"RTN","IB20P240",64,0)
 K DIE,DA,DR,FLD02,STRING,WP,DA1,X
"RTN","IB20P240",65,0)
 L -^IBE(355.1)
"RTN","IB20P240",66,0)
 Q
"RTN","IB20P240",67,0)
F35510 ; change references to Champus in description field
"RTN","IB20P240",68,0)
 Q:'$D(^IBE(FILENUM,DA,10))
"RTN","IB20P240",69,0)
 S DA1=0,(STRING,WP)=""
"RTN","IB20P240",70,0)
 F  S DA1=$O(^IBE(FILENUM,DA,10,DA1)) Q:'DA1  D
"RTN","IB20P240",71,0)
 .  S WP=$G(^IBE(FILENUM,DA,10,DA1,0))
"RTN","IB20P240",72,0)
 .  Q:WP'["CHAMPUS,"
"RTN","IB20P240",73,0)
 .  F X=1:1 S P(X)=$P(WP," ",X) Q:P(X)=""  S:P(X)="CHAMPUS," P(X)="TRICARE," S STRING=STRING_P(X)_" "
"RTN","IB20P240",74,0)
 .  S STRING=$E(STRING,1,$L(STRING)-1)
"RTN","IB20P240",75,0)
 .  S ^IBE(FILENUM,DA,10,DA1,0)=STRING
"RTN","IB20P240",76,0)
 K DA1,STRING,P,WP
"RTN","IB20P240",77,0)
 Q
"RTN","IB20P240",78,0)
 ;
"RTN","IB20P240",79,0)
F3552 ; must also update field .02 from CHS to TRI and "C" cross-reference
"RTN","IB20P240",80,0)
 S FLD02=$P(NODE0,U,2)
"RTN","IB20P240",81,0)
 S FLD02=$TR($E(FLD02,1,3),"CHS","TRI")
"RTN","IB20P240",82,0)
 L +^IBE(355.2)
"RTN","IB20P240",83,0)
 S DIE="^IBE(355.2,",DR=".01////"_STRING_";.02////"_FLD02 D ^DIE
"RTN","IB20P240",84,0)
 L -^IBE(355.2)
"RTN","IB20P240",85,0)
 K FLD02,DIE,DR,NODE0
"RTN","IB20P240",86,0)
 Q
"RTN","IB20P240",87,0)
 ;
"RTN","IB20P240",88,0)
EN2 ; root name ^IBA - file 355.3 change .03 field, along with "D", "ACCP"
"RTN","IB20P240",89,0)
 ; and "AGNA" cross references.  Files 364.5 and 364.7 change references 
"RTN","IB20P240",90,0)
 ; from Champus to Tricare in word-processing field
"RTN","IB20P240",91,0)
 F FN=1:1 S FILENUM=$P($T(FILE2+FN),";;",2,999) Q:FILENUM=""  D
"RTN","IB20P240",92,0)
 . I FILENUM="355.3" D EN21
"RTN","IB20P240",93,0)
 . I FILENUM="364.5" S CHID="N-OTHER INSURANCE CO TYPES" D EN22
"RTN","IB20P240",94,0)
 . I FILENUM="364.7" F CHID=805,1005 D EN22
"RTN","IB20P240",95,0)
 . Q
"RTN","IB20P240",96,0)
 K FN,FILENUM,CHID
"RTN","IB20P240",97,0)
 Q
"RTN","IB20P240",98,0)
 ;
"RTN","IB20P240",99,0)
EN21 ; update file 355.3
"RTN","IB20P240",100,0)
 S (CHID,NODE0,FLD03)=""
"RTN","IB20P240",101,0)
 F  S CHID=$O(^IBA(FILENUM,"D",CHID)) Q:CHID=""  D
"RTN","IB20P240",102,0)
 .  Q:CHID'["CHAMPUS"
"RTN","IB20P240",103,0)
 .  S DA=0
"RTN","IB20P240",104,0)
 .  F  S DA=$O(^IBA(FILENUM,"D",CHID,DA)) Q:'DA  D
"RTN","IB20P240",105,0)
 .  .  S NODE0=$G(^IBA(FILENUM,DA,0))
"RTN","IB20P240",106,0)
 .  .  S FLD03=$P(NODE0,U,3)
"RTN","IB20P240",107,0)
 .  .  S FLD03=$TR($E(FLD03,1,7),"CHAMPUS","TRICARE")_$E(FLD03,8,$L(FLD03))
"RTN","IB20P240",108,0)
 .  .  L +^IBA(FILENUM)
"RTN","IB20P240",109,0)
 .  .  S DIE="^IBA(355.3,",DR=".03////"_FLD03 D ^DIE
"RTN","IB20P240",110,0)
 .  .  L -^IBA(FILENUM)
"RTN","IB20P240",111,0)
 K CHID,DA,NODE0,FLD03,DIE,DR
"RTN","IB20P240",112,0)
 Q
"RTN","IB20P240",113,0)
 ;
"RTN","IB20P240",114,0)
EN22 ; update files 364.5 and 364.7
"RTN","IB20P240",115,0)
 S DA=$O(^IBA(FILENUM,"B",CHID,0)) Q:'DA
"RTN","IB20P240",116,0)
 Q:'$D(^IBA(FILENUM,DA,3))
"RTN","IB20P240",117,0)
 S DA1=0,(STRING,WP)=""
"RTN","IB20P240",118,0)
 F  S DA1=$O(^IBA(FILENUM,DA,3,DA1)) Q:'DA1  D
"RTN","IB20P240",119,0)
 .  S WP=$G(^IBA(FILENUM,DA,3,DA1,0))
"RTN","IB20P240",120,0)
 .  Q:WP'["CHAMPUS"
"RTN","IB20P240",121,0)
 .  S STRING=$TR(WP,"CHAMPUS","TRICARE")
"RTN","IB20P240",122,0)
 .  S ^IBA(FILENUM,DA,3,DA1,0)=STRING
"RTN","IB20P240",123,0)
 K DA,DA1,WP,STRING
"RTN","IB20P240",124,0)
 Q
"RTN","IB20P240",125,0)
 ;
"RTN","IB20P240",126,0)
EN3 ; root name ^DGCR - files 399.1 and 399.3
"RTN","IB20P240",127,0)
 S (NODE0,FLD01,FLD02,FLD03,FLD04)=""
"RTN","IB20P240",128,0)
 F FN=1:1 S FILENUM=$P($T(FILE3+FN),";;",2,999) Q:FILENUM=""  D
"RTN","IB20P240",129,0)
 . S CHID=""
"RTN","IB20P240",130,0)
 . F  S CHID=$O(^DGCR(FILENUM,"B",CHID)) Q:CHID=""  D
"RTN","IB20P240",131,0)
 . .  Q:CHID'["CHAMPUS"
"RTN","IB20P240",132,0)
 . .  S DA=$O(^DGCR(FILENUM,"B",CHID,0)) Q:'DA
"RTN","IB20P240",133,0)
 . .  S NODE0=$G(^DGCR(FILENUM,DA,0))
"RTN","IB20P240",134,0)
 . .  S FLD01=$P(NODE0,U,1)
"RTN","IB20P240",135,0)
 . .  S:FILENUM="399.3" FLD02=$P(NODE0,U,2),FLD03=$P(NODE0,U,3),FLD04=$P(NODE0,U,4)
"RTN","IB20P240",136,0)
 . .  S FLD01=$TR($E(FLD01,1,7),"CHAMPUS","TRICARE")_$E(FLD01,8,$L(FLD01))
"RTN","IB20P240",137,0)
 . .  I $D(FLD02) S:FLD02["CHAMPUS" FLD02=$TR($E(FLD02,1,7),"CHAMPUS","TRICARE")_$E(FLD02,8,$L(FLD02))
"RTN","IB20P240",138,0)
 . .  I $D(FLD03) S:FLD03["CHAMPUS" FLD03=$TR($E(FLD03,1,7),"CHAMPUS","TRICARE")_$E(FLD03,8,$L(FLD03))
"RTN","IB20P240",139,0)
 . .  I $D(FLD04) S:FLD04["CHAMPUS" FLD04=$TR($E(FLD04,1,7),"CHAMPUS","TRICARE")_$E(FLD04,8,$L(FLD04))
"RTN","IB20P240",140,0)
 . .  L +^DGCR(FILENUM)
"RTN","IB20P240",141,0)
 . .  S DIE="^DGCR(FILENUM,"
"RTN","IB20P240",142,0)
 . .  I FILENUM="399.3" S DR=".01////"_FLD01_";.02////"_FLD02_";.03////"_FLD03_";.04////"_FLD04 D ^DIE K DIE,DA,DR Q
"RTN","IB20P240",143,0)
 . .  S DR=".01////"_FLD01 D ^DIE
"RTN","IB20P240",144,0)
 . .  K DIE,DA,DR
"RTN","IB20P240",145,0)
 . .  L -^DGCR(FILENUM)
"RTN","IB20P240",146,0)
 K DIE,DA,DR,FILENUM,FN,FLD01,FLD02,FLD03,FLD04,NODE0,CHID
"RTN","IB20P240",147,0)
 Q
"RTN","IB20P240",148,0)
 ;
"RTN","IB20P240",149,0)
EN4 ; update .01 field in file 36
"RTN","IB20P240",150,0)
 S (CHID,NODE0,FLD01)=""
"RTN","IB20P240",151,0)
 F  S CHID=$O(^DIC(36,"B",CHID)) Q:CHID=""  D
"RTN","IB20P240",152,0)
 .  Q:CHID'["CHAMPUS"
"RTN","IB20P240",153,0)
 .  S DA=$O(^DIC(36,"B",CHID,0)) Q:'DA
"RTN","IB20P240",154,0)
 .  S NODE0=$G(^DIC(36,DA,0))
"RTN","IB20P240",155,0)
 .  S FLD01=$P(NODE0,U,1)
"RTN","IB20P240",156,0)
 .  S FLD01=$TR($E(FLD01,1,7),"CHAMPUS","TRICARE")_$E(FLD01,8,$L(FLD01))
"RTN","IB20P240",157,0)
 .  S DIE="^DIC(36,",DR=".01////"_FLD01 D ^DIE
"RTN","IB20P240",158,0)
 .  K DA,DIE,DR
"RTN","IB20P240",159,0)
 K CHID,FLD01,NODE0
"RTN","IB20P240",160,0)
 Q
"RTN","IB20P240",161,0)
 ;
"RTN","IB20P240",162,0)
EN5 ; change all occurrences of CHAMPUS to TRICARE for IB Menu option
"RTN","IB20P240",163,0)
 ; text displays.
"RTN","IB20P240",164,0)
 S NM="",DA=0
"RTN","IB20P240",165,0)
 F  S NM=$O(^DIC(19,"B",NM)) Q:NM=""  D
"RTN","IB20P240",166,0)
 .  Q:NM'["IB CHAMP"
"RTN","IB20P240",167,0)
 .  S (FLD01,STRG1,FLD02,STRING,NODE0)="" K P
"RTN","IB20P240",168,0)
 .  S DA=$O(^DIC(19,"B",NM,0)) Q:'DA
"RTN","IB20P240",169,0)
 .  S NODE0=$G(^DIC(19,DA,0))
"RTN","IB20P240",170,0)
 .  S FLD01=$P(NODE0,U,1)  ; Option name
"RTN","IB20P240",171,0)
 .  F X=1:1 S P(X)=$P(FLD01," ",X) Q:P(X)=""  S:P(X)="CHAMP" P(X)="TRICARE" S STRG1=STRG1_P(X)_" "
"RTN","IB20P240",172,0)
 .  S STRG1=$E(STRG1,1,$L(STRG1)-1)
"RTN","IB20P240",173,0)
 .  S FLD02=$P(^DIC(19,DA,0),U,2)  ; Menu text
"RTN","IB20P240",174,0)
 .  F X=1:1 S P(X)=$P(FLD02," ",X) Q:P(X)=""  S:P(X)="CHAMPUS" P(X)="TRICARE" S STRING=STRING_P(X)_" "
"RTN","IB20P240",175,0)
 .  S STRING=$E(STRING,1,$L(STRING)-1)
"RTN","IB20P240",176,0)
 .  S DIE="^DIC(19,",DR=".01////"_STRG1_";1////"_STRING D ^DIE
"RTN","IB20P240",177,0)
 .  K DIE,DR
"RTN","IB20P240",178,0)
 .  D DESC
"RTN","IB20P240",179,0)
 K X,NM,DA,NODE0,FLD01,FLD02,STRG1,STRING,P
"RTN","IB20P240",180,0)
 D IBJD
"RTN","IB20P240",181,0)
 Q
"RTN","IB20P240",182,0)
 ;
"RTN","IB20P240",183,0)
IBJD ; change text display for menu option
"RTN","IB20P240",184,0)
 S NM="IBJD FOLLOW-UP CHAMPVA/TRICARE"
"RTN","IB20P240",185,0)
 S DA="",DA=$O(^DIC(19,"B",NM,"")) Q:DA=""
"RTN","IB20P240",186,0)
 S STRING="CHAMPVA/TRICARE Follow-Up Report"
"RTN","IB20P240",187,0)
 S DIE="^DIC(19,",DR="1////"_STRING D ^DIE
"RTN","IB20P240",188,0)
 D DESC
"RTN","IB20P240",189,0)
 K DA,DA1,DIE,DR,STRING,NM,WP,P
"RTN","IB20P240",190,0)
 Q
"RTN","IB20P240",191,0)
 ;
"RTN","IB20P240",192,0)
DESC ; change any references from Champus to Tricare in the
"RTN","IB20P240",193,0)
 ; word-processing description multiple field
"RTN","IB20P240",194,0)
 Q:'$D(^DIC(19,DA,1))
"RTN","IB20P240",195,0)
 S DA1=0,(STRING,WP)=""
"RTN","IB20P240",196,0)
 F  S DA1=$O(^DIC(19,DA,1,DA1)) Q:'DA1  D
"RTN","IB20P240",197,0)
 .  S WP=^DIC(19,DA,1,DA1,0)
"RTN","IB20P240",198,0)
 .  Q:WP'["CHAMPUS"
"RTN","IB20P240",199,0)
 .  F X=1:1 S P(X)=$P(WP," ",X) Q:P(X)=""  S:P(X)="CHAMPUS" P(X)="TRICARE" S:P(X)="(Tricare)" P(X)="" S:P(X)'="" STRING=STRING_P(X)_" "
"RTN","IB20P240",200,0)
 .  S STRING=$E(STRING,1,$L(STRING)-1)
"RTN","IB20P240",201,0)
 .  S ^DIC(19,DA,1,DA1,0)=STRING
"RTN","IB20P240",202,0)
 Q
"RTN","IB20P240",203,0)
 ;
"RTN","IB20P240",204,0)
EN6 ; search for all records in file 355.3 that contain internal code
"RTN","IB20P240",205,0)
 ; CH in field .15 (Electronic Plan Type) and change it to TR.
"RTN","IB20P240",206,0)
 ; The external value for this field has been changed from CHAMPUS
"RTN","IB20P240",207,0)
 ; to TRICARE.
"RTN","IB20P240",208,0)
 S DA=0,(NODE0,PC)=""
"RTN","IB20P240",209,0)
 F  S DA=$O(^IBA(355.3,DA)) Q:'DA  D
"RTN","IB20P240",210,0)
 .  S NODE0=$G(^IBA(355.3,DA,0)),PC=$P(NODE0,U,15)
"RTN","IB20P240",211,0)
 .  Q:PC'="CH"
"RTN","IB20P240",212,0)
 .  S PC="TR"
"RTN","IB20P240",213,0)
 .  S DIE="^IBA(355.3,",DR=".15////"_PC D ^DIE
"RTN","IB20P240",214,0)
 K DA,DR,DIE,NODE0,PC
"RTN","IB20P240",215,0)
 Q
"RTN","IB20P240",216,0)
 ;
"RTN","IB20P240",217,0)
FILE1 ; file numbers with root name ^IBE that need to be updated
"RTN","IB20P240",218,0)
 ;;350.1
"RTN","IB20P240",219,0)
 ;;351.7
"RTN","IB20P240",220,0)
 ;;355.1
"RTN","IB20P240",221,0)
 ;;355.2
"RTN","IB20P240",222,0)
 ;;355.97
"RTN","IB20P240",223,0)
 ;;363
"RTN","IB20P240",224,0)
 ;
"RTN","IB20P240",225,0)
FILE2 ; file numbers with root name ^IBA that need to be updated
"RTN","IB20P240",226,0)
 ;;355.3
"RTN","IB20P240",227,0)
 ;;364.5
"RTN","IB20P240",228,0)
 ;;364.7
"RTN","IB20P240",229,0)
 ;
"RTN","IB20P240",230,0)
FILE3 ; file numbers with root name ^DGCR that need to be updated
"RTN","IB20P240",231,0)
 ;;399.1
"RTN","IB20P240",232,0)
 ;;399.3
"RTN","IBACUS")
0^1^B7353241
"RTN","IBACUS",1,0)
IBACUS ;ALB/CPM - TRICARE BILLING UTILITIES ; 02-AUG-96
"RTN","IBACUS",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBACUS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACUS",4,0)
 ;
"RTN","IBACUS",5,0)
CUS(DFN,IBDT) ; Does the patient have TRICARE coverage?
"RTN","IBACUS",6,0)
 ;  Input:    DFN  --  Pointer to the patient in file #2
"RTN","IBACUS",7,0)
 ;           DATE  --  Date on which coverage is to be determined
"RTN","IBACUS",8,0)
 ; Output:  IBCOV  --  0, if the vet has no billable TRICARE coverage
"RTN","IBACUS",9,0)
 ;                     >0 => pointer to such coverage in file #2.312
"RTN","IBACUS",10,0)
 ;
"RTN","IBACUS",11,0)
 N IBCOV,IBPOL,IBI
"RTN","IBACUS",12,0)
 S IBCOV=0
"RTN","IBACUS",13,0)
 I '$G(DFN) G CUSQ
"RTN","IBACUS",14,0)
 S:'$G(IBDT) IBDT=DT
"RTN","IBACUS",15,0)
 ;
"RTN","IBACUS",16,0)
 ; - find a billable TRICARE policy
"RTN","IBACUS",17,0)
 D ALL^IBCNS1(DFN,"IBPOL",1,IBDT)
"RTN","IBACUS",18,0)
 S IBI=0 F  S IBI=$O(IBPOL(IBI)) Q:'IBI  D  Q:IBCOV
"RTN","IBACUS",19,0)
 .Q:$P($G(IBPOL(IBI,3)),"^",4)  ; ignore billing this policy
"RTN","IBACUS",20,0)
 .I $P($G(^IBE(355.1,+$P($G(IBPOL(IBI,355.3)),"^",9),0)),"^",3)=7 S IBCOV=IBI
"RTN","IBACUS",21,0)
CUSQ Q IBCOV
"RTN","IBACUS",22,0)
 ;
"RTN","IBACUS",23,0)
 ;
"RTN","IBACUS",24,0)
TRI() ; Is the Tricare Billing engine up and running?
"RTN","IBACUS",25,0)
 ;  Input:  none
"RTN","IBACUS",26,0)
 ; Output:  0 - No  1 - Yes
"RTN","IBACUS",27,0)
 ;
"RTN","IBACUS",28,0)
 Q $P($G(^IBE(350.9,1,9)),"^",4)>0
"RTN","IBACUS",29,0)
 ;
"RTN","IBACUS",30,0)
 ;
"RTN","IBACUS",31,0)
CHPUS(DFN,DATE,IBRX,IBREF,IBLAB,IBRSITE,IBDUZ) ; Bill this patient for TRICARE?
"RTN","IBACUS",32,0)
 ;  Input:    DFN  --  Pointer to the patient in file #2
"RTN","IBACUS",33,0)
 ;           DATE  --  Date on which coverage is to be determined
"RTN","IBACUS",34,0)
 ;           IBRX  --  Pointer to the prescription in file #52
"RTN","IBACUS",35,0)
 ;          IBREF  --  Pointer to the refill in file #52.1, or
"RTN","IBACUS",36,0)
 ;                     0 if billing the original prescription
"RTN","IBACUS",37,0)
 ;          IBLAB  --  Pharmacy label printing device
"RTN","IBACUS",38,0)
 ;        IBRSITE  --  Pointer to the Pharmacy in file #59
"RTN","IBACUS",39,0)
 ;          IBDUZ  --  Pointer to the Pharmacy user in file #200
"RTN","IBACUS",40,0)
 ; Output:  IBCHK  --  0 => can't bill rx || 1 => bill rx
"RTN","IBACUS",41,0)
 ;
"RTN","IBACUS",42,0)
 N IBCHK,IBKEY S IBCHK=0
"RTN","IBACUS",43,0)
 I '$G(DFN) G CHPUSQ
"RTN","IBACUS",44,0)
 D POL^IBCNSU41(DFN)
"RTN","IBACUS",45,0)
 ;
"RTN","IBACUS",46,0)
 ; - make sure system is running and the patient has TRICARE coverage
"RTN","IBACUS",47,0)
 I '$$TRI() G CHPUSQ
"RTN","IBACUS",48,0)
 I '$$CUS(DFN,DATE) G CHPUSQ
"RTN","IBACUS",49,0)
 ;
"RTN","IBACUS",50,0)
 ; - check remaining user input
"RTN","IBACUS",51,0)
 I '$G(IBRX) G CHPUSQ
"RTN","IBACUS",52,0)
 I $G(IBREF)="" G CHPUSQ
"RTN","IBACUS",53,0)
 I $G(IBLAB)=""!('$G(IBRSITE))!('$G(IBDUZ)) G CHPUSQ
"RTN","IBACUS",54,0)
 ;
"RTN","IBACUS",55,0)
 ; - perform all Pharmacy edits
"RTN","IBACUS",56,0)
 I '$$CHK^PSOCPTRI(IBRX,IBREF) G CHPUSQ
"RTN","IBACUS",57,0)
 ;
"RTN","IBACUS",58,0)
 ; - queue rx for billing
"RTN","IBACUS",59,0)
 S IBCHK=1,IBKEY=IBRX_";"_IBREF
"RTN","IBACUS",60,0)
 S ^IBA(351.5,"APOST",IBKEY)=IBLAB_"^"_IBRSITE_"^"_IBDUZ
"RTN","IBACUS",61,0)
 ;
"RTN","IBACUS",62,0)
CHPUSQ Q IBCHK
"RTN","IBACUS",63,0)
 ;
"RTN","IBACUS",64,0)
 ;
"RTN","IBACUS",65,0)
 ;
"RTN","IBACUS",66,0)
 ;
"RTN","IBACUS",67,0)
 ; The following three queued entry points are invoked by the
"RTN","IBACUS",68,0)
 ; TRICARE Rx Billing engine.  The following two variables are
"RTN","IBACUS",69,0)
 ; defined for each of the jobs:
"RTN","IBACUS",70,0)
 ;
"RTN","IBACUS",71,0)
 ;     IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS",72,0)
 ;      IBKEYD  --  1 ^ 2 ^ 3, where
"RTN","IBACUS",73,0)
 ;                    1 = Rx label printing device
"RTN","IBACUS",74,0)
 ;                    2 = Pointer to the Pharmacy in file #59
"RTN","IBACUS",75,0)
 ;                    3 = Pointer to the Pharmacy user in file #200
"RTN","IBACUS",76,0)
 ;
"RTN","IBACUS",77,0)
RXLAB ; Queued entry point to print the TRICARE Rx label.
"RTN","IBACUS",78,0)
 I $G(IBKEYD)="" G RXLABQ
"RTN","IBACUS",79,0)
 S IBCOP=$J(+$G(^IBA(351.5,+$G(IBCHTRN),2)),0,2)
"RTN","IBACUS",80,0)
 I 'IBCOP G RXLABQ
"RTN","IBACUS",81,0)
 D LABEL^PSOCPTRI(+$G(^IBA(351.5,IBCHTRN,0)),$P(IBKEYD,"^"),$P(IBKEYD,"^",2),$P(IBKEYD,"^",3),IBCOP)
"RTN","IBACUS",82,0)
RXLABQ K IBCOP
"RTN","IBACUS",83,0)
 Q
"RTN","IBACUS",84,0)
 ;
"RTN","IBACUS",85,0)
 ;
"RTN","IBACUS",86,0)
RXBIL ; Queued entry point to create TRICARE Rx Billing charges.
"RTN","IBACUS",87,0)
 ;
"RTN","IBACUS",88,0)
 ; - check some basic input
"RTN","IBACUS",89,0)
 I '$$RXSET G RXBILQ
"RTN","IBACUS",90,0)
 ;
"RTN","IBACUS",91,0)
 ; - create copay charge
"RTN","IBACUS",92,0)
 D BILL^IBACUS1(IBKEY,IBCHTRN)
"RTN","IBACUS",93,0)
 ;
"RTN","IBACUS",94,0)
 ; - create fiscal intermediary claim
"RTN","IBACUS",95,0)
 D BILL^IBACUS2(IBKEY,IBCHTRN)
"RTN","IBACUS",96,0)
 ;
"RTN","IBACUS",97,0)
RXBILQ Q
"RTN","IBACUS",98,0)
 ;
"RTN","IBACUS",99,0)
 ;
"RTN","IBACUS",100,0)
RXCAN ; Queued entry point to cancel TRICARE Rx Billing charges.
"RTN","IBACUS",101,0)
 ;
"RTN","IBACUS",102,0)
 ; - check some basic input
"RTN","IBACUS",103,0)
 I '$$RXSET G RXCANQ
"RTN","IBACUS",104,0)
 ;
"RTN","IBACUS",105,0)
 ; - cancel copay charge
"RTN","IBACUS",106,0)
 D CANC^IBACUS1(IBCHTRN)
"RTN","IBACUS",107,0)
 ;
"RTN","IBACUS",108,0)
 ; - cancel fiscal intermediary claim
"RTN","IBACUS",109,0)
 D CANC^IBACUS2(IBCHTRN)
"RTN","IBACUS",110,0)
 ;
"RTN","IBACUS",111,0)
RXCANQ Q
"RTN","IBACUS",112,0)
 ;
"RTN","IBACUS",113,0)
 ;
"RTN","IBACUS",114,0)
RXSET() ; Establish the session.
"RTN","IBACUS",115,0)
 N IBOK S IBOK=0
"RTN","IBACUS",116,0)
 ;
"RTN","IBACUS",117,0)
 ; - check some basic input
"RTN","IBACUS",118,0)
 I '$G(IBCHTRN) G RXSETQ
"RTN","IBACUS",119,0)
 S IBKEY=$P($G(^IBA(351.5,IBCHTRN,0)),"^")
"RTN","IBACUS",120,0)
 I IBKEY="" G RXSETQ
"RTN","IBACUS",121,0)
 S DUZ=+$P(IBKEYD,"^",3)
"RTN","IBACUS",122,0)
 I $G(^VA(200,DUZ,0))="" G RXSETQ
"RTN","IBACUS",123,0)
 ;
"RTN","IBACUS",124,0)
 S DIQUIET=1 D DT^DICRW
"RTN","IBACUS",125,0)
 S IBOK=1
"RTN","IBACUS",126,0)
 ;
"RTN","IBACUS",127,0)
RXSETQ Q IBOK
"RTN","IBACUS1")
0^2^B5336207
"RTN","IBACUS1",1,0)
IBACUS1 ;ALB/CPM - TRICARE PATIENT RX COPAY CHARGES ; 02-AUG-96
"RTN","IBACUS1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBACUS1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACUS1",4,0)
 ;
"RTN","IBACUS1",5,0)
BILL(IBKEY,IBCHTRN) ; Create the TRICARE Rx copay charge.
"RTN","IBACUS1",6,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBACUS1",7,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBACUS1",8,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBACUS1",9,0)
 ;                             0 for the original fill
"RTN","IBACUS1",10,0)
 ;          IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS1",11,0)
 ;
"RTN","IBACUS1",12,0)
 S IBY=1
"RTN","IBACUS1",13,0)
 I '$G(IBKEY) G BILLQ
"RTN","IBACUS1",14,0)
 I $G(^PSRX(+IBKEY,0))="" G BILLQ
"RTN","IBACUS1",15,0)
 ;
"RTN","IBACUS1",16,0)
 ; - need patient
"RTN","IBACUS1",17,0)
 S DFN=+$P($G(^PSRX(+IBKEY,0)),"^",2)
"RTN","IBACUS1",18,0)
 I 'DFN S IBY="-1^IB002" G BILLQ
"RTN","IBACUS1",19,0)
 ;
"RTN","IBACUS1",20,0)
 ; - need action type
"RTN","IBACUS1",21,0)
 S IBATYP=$O(^IBE(350.1,"E","TRICARE RX COPAY",0))
"RTN","IBACUS1",22,0)
 I 'IBATYP S IBY="-1^IB008" G BILLQ
"RTN","IBACUS1",23,0)
 ;
"RTN","IBACUS1",24,0)
 ; - need facility number
"RTN","IBACUS1",25,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G BILLQ
"RTN","IBACUS1",26,0)
 ;
"RTN","IBACUS1",27,0)
 ; - need the Pharmacy service pointer; get from #350.1 and check it
"RTN","IBACUS1",28,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBACUS1",29,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB003" G BILLQ
"RTN","IBACUS1",30,0)
 ;
"RTN","IBACUS1",31,0)
 ; - need a charge amount (from file #351.5)
"RTN","IBACUS1",32,0)
 S IBCHG=+$G(^IBA(351.5,IBCHTRN,2))
"RTN","IBACUS1",33,0)
 I 'IBCHG S IBY="-1^IB029" G BILLQ
"RTN","IBACUS1",34,0)
 ;
"RTN","IBACUS1",35,0)
 ; - set remaining variables
"RTN","IBACUS1",36,0)
 S IBDESC="TRICARE RX COPAY",IBUNIT=1
"RTN","IBACUS1",37,0)
 S IBSL="52:"_+IBKEY S:$P(IBKEY,";",2) IBSL=IBSL_";1:"_$P(IBKEY,";",2)
"RTN","IBACUS1",38,0)
 S IBFR=DT
"RTN","IBACUS1",39,0)
 ;
"RTN","IBACUS1",40,0)
 ; - add the charge to file #350
"RTN","IBACUS1",41,0)
 D ADD^IBECEAU3 I IBY<0 G BILLQ
"RTN","IBACUS1",42,0)
 ;
"RTN","IBACUS1",43,0)
 ; - release the charge to AR
"RTN","IBACUS1",44,0)
 D AR^IBR
"RTN","IBACUS1",45,0)
 ;
"RTN","IBACUS1",46,0)
 ; - update the rx transaction file (#351.5)
"RTN","IBACUS1",47,0)
 S DA=IBCHTRN,DIE="^IBA(351.5,",DR=".08////"_IBN D ^DIE K DA,DIE,DR
"RTN","IBACUS1",48,0)
 ;
"RTN","IBACUS1",49,0)
BILLQ I IBY<0 D ERRMSG^IBACVA2(1,2)
"RTN","IBACUS1",50,0)
 K IBY,IBATYP,IBSERV,IBCHG,IBDESC,IBUNIT,IBSL,IBFR
"RTN","IBACUS1",51,0)
 Q
"RTN","IBACUS1",52,0)
 ;
"RTN","IBACUS1",53,0)
 ;
"RTN","IBACUS1",54,0)
 ;
"RTN","IBACUS1",55,0)
CANC(IBCHTRN) ; Cancel the TRICARE Rx copay charge.
"RTN","IBACUS1",56,0)
 ;  Input:  IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS1",57,0)
 ;
"RTN","IBACUS1",58,0)
 S IBY=1,IBDUZ=DUZ
"RTN","IBACUS1",59,0)
 S IBCHTRND=$G(^IBA(351.5,IBCHTRN,0)),DFN=+$P(IBCHTRND,"^",2)
"RTN","IBACUS1",60,0)
 S IBN=+$P(IBCHTRND,"^",8) I 'IBN G CANCQ
"RTN","IBACUS1",61,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G CANCQ
"RTN","IBACUS1",62,0)
 S IBCRES=$O(^IBE(350.3,"B","RX CANCELLED",0)) S:'IBCRES IBCRES=5
"RTN","IBACUS1",63,0)
 ;
"RTN","IBACUS1",64,0)
 ; - cancel the charge
"RTN","IBACUS1",65,0)
 D CED^IBECEAU4(IBN) I IBY<0 G CANCQ
"RTN","IBACUS1",66,0)
 D CANC^IBECEAU4(IBN,IBCRES,1)
"RTN","IBACUS1",67,0)
 ;
"RTN","IBACUS1",68,0)
CANCQ I IBY<0 D ERRMSG^IBACVA2(0,2)
"RTN","IBACUS1",69,0)
 K IBCHTRND,IBDUZ,IBN,IBCRES,DFN,IBSITE,IBFAC,IBND,IBPARNT,IBCANC,IBH
"RTN","IBACUS1",70,0)
 K IBCANTR,IBXA,IBATYP,IBSEQNO,IBIL,IBUNIT,IBCHG,IBFR
"RTN","IBACUS1",71,0)
 Q
"RTN","IBACUS2")
0^3^B33239765
"RTN","IBACUS2",1,0)
IBACUS2 ;ALB/CPM - TRICARE FISCAL INTERMEDIARY RX CLAIMS ;02-AUG-96
"RTN","IBACUS2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,91,51,240**;21-MAR-94
"RTN","IBACUS2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACUS2",4,0)
 ;
"RTN","IBACUS2",5,0)
BILL(IBKEY,IBCHTRN) ; Create the TRICARE claim for the Fiscal Intermediary.
"RTN","IBACUS2",6,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBACUS2",7,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBACUS2",8,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBACUS2",9,0)
 ;                             0 for the original fill
"RTN","IBACUS2",10,0)
 ;          IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS2",11,0)
 ;
"RTN","IBACUS2",12,0)
 N IBQUERY
"RTN","IBACUS2",13,0)
 S IBY=1 K IBDRX
"RTN","IBACUS2",14,0)
 I '$G(IBKEY) G BILLQ
"RTN","IBACUS2",15,0)
 I $G(^PSRX(+IBKEY,0))="" G BILLQ
"RTN","IBACUS2",16,0)
 S IBAMT=$P($G(^IBA(351.5,+IBCHTRN,2)),"^",5) ;  FI portion of charge
"RTN","IBACUS2",17,0)
 I 'IBAMT G BILLQ
"RTN","IBACUS2",18,0)
 ;
"RTN","IBACUS2",19,0)
 ; - derive minimal variables
"RTN","IBACUS2",20,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G BILLQ
"RTN","IBACUS2",21,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBACUS2",22,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB003" G BILLQ
"RTN","IBACUS2",23,0)
 ;
"RTN","IBACUS2",24,0)
 ; - establish a stub claim/receivable
"RTN","IBACUS2",25,0)
 D SET^IBR I IBY<0 G BILLQ
"RTN","IBACUS2",26,0)
 ;
"RTN","IBACUS2",27,0)
 ; - set up the following variables for claim establishment:
"RTN","IBACUS2",28,0)
 ;      .01  BILL #
"RTN","IBACUS2",29,0)
 ;      .17  ORIG CLAIM
"RTN","IBACUS2",30,0)
 ;      .2   AUTO?
"RTN","IBACUS2",31,0)
 ;      .02  DFN
"RTN","IBACUS2",32,0)
 ;      .06  TIMEFRAME
"RTN","IBACUS2",33,0)
 ;      .07  RATE TYPE
"RTN","IBACUS2",34,0)
 ;      .18  SC AT TIME?
"RTN","IBACUS2",35,0)
 ;      .04  LOCATION (WILL NEED DIVISION THAT DISPENSED)
"RTN","IBACUS2",36,0)
 ;      .05  BILL CLASSIF  (3)
"RTN","IBACUS2",37,0)
 ;      .03  EVT DATE (FILL DATE)
"RTN","IBACUS2",38,0)
 ;      151  BILL FROM
"RTN","IBACUS2",39,0)
 ;      152  BILL TO
"RTN","IBACUS2",40,0)
 K IB
"RTN","IBACUS2",41,0)
 S (IB(.02),DFN,IBDFN)=+$P($G(^PSRX(+IBKEY,0)),"^",2)
"RTN","IBACUS2",42,0)
 I 'DFN S IBY="-1^IB002" G BILLQ
"RTN","IBACUS2",43,0)
 S IB(.07)=$O(^DGCR(399.3,"B","TRICARE",0))
"RTN","IBACUS2",44,0)
 I 'IB(.07) S IBY="-1^IB059" G BILLQ
"RTN","IBACUS2",45,0)
 I $$TRANS^PSOCPTRI(+IBKEY,+$P(IBKEY,";",2),.IBDRX)<0 S IBY="-1^IB010" G BILLQ
"RTN","IBACUS2",46,0)
 ;
"RTN","IBACUS2",47,0)
 S IBIFN=PRCASV("ARREC")
"RTN","IBACUS2",48,0)
 S IB(.01)=$P(PRCASV("ARBIL"),"-",2)
"RTN","IBACUS2",49,0)
 S IB(.17)=""
"RTN","IBACUS2",50,0)
 S IB(.2)=0
"RTN","IBACUS2",51,0)
 S IB(.06)=1
"RTN","IBACUS2",52,0)
 S IB(.18)=$$SC^IBCU3(DFN)
"RTN","IBACUS2",53,0)
 S IB(.04)=1 ;  how can I get Division?  RON...
"RTN","IBACUS2",54,0)
 S IB(.05)=3
"RTN","IBACUS2",55,0)
 S (IB(.03),IB(151),IB(152))=IBDRX("FDT")
"RTN","IBACUS2",56,0)
 ;
"RTN","IBACUS2",57,0)
 ; - set 362.4 node to rx#^p50^days sup^fill date^qty^ndc
"RTN","IBACUS2",58,0)
 S IB(362.4,+IBKEY,1)=IBDRX("RX#")_"^"_+$P($G(^PSRX(+IBKEY,0)),"^",6)_"^"_IBDRX("SUP")_"^"_IBDRX("FDT")_"^"_IBDRX("QTY")_"^"_IBDRX("NDC")
"RTN","IBACUS2",59,0)
 ;
"RTN","IBACUS2",60,0)
 ; - call the autobiller module to create the claim with a default
"RTN","IBACUS2",61,0)
 ;   diagnosis and procedure for prescriptions
"RTN","IBACUS2",62,0)
 D EN^IBCD3(.IBQUERY)
"RTN","IBACUS2",63,0)
 D CLOSE^IBSDU(.IBQUERY)
"RTN","IBACUS2",64,0)
 ;
"RTN","IBACUS2",65,0)
 ; - add the payor (fiscal intermediary) to the claim
"RTN","IBACUS2",66,0)
 S IBCDFN=$$CUS^IBACUS(DFN)
"RTN","IBACUS2",67,0)
 I 'IBCDFN S IBY="-1^IB054" G BILLQ
"RTN","IBACUS2",68,0)
 S IBINS=+$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBACUS2",69,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="112////"_IBCDFN
"RTN","IBACUS2",70,0)
 D ^DIE K DA,DR,DIE,DGRVRCAL
"RTN","IBACUS2",71,0)
 ;
"RTN","IBACUS2",72,0)
 ; - add charge to the claim
"RTN","IBACUS2",73,0)
 S IBRVCD=$P($G(^DIC(36,IBINS,0)),"^",15) ;                                      rx refill rev code
"RTN","IBACUS2",74,0)
 I IBRVCD="" S IBRVCD=$P($G(^IBE(363.1,+$P($G(^IBE(350.9,1,9)),U,12),0)),U,5) ;  CS def rev code
"RTN","IBACUS2",75,0)
 I IBRVCD="" S X=250 ;                                                           gen'l rx rev code
"RTN","IBACUS2",76,0)
 ;
"RTN","IBACUS2",77,0)
 S IBBS=$P($G(^IBE(363.1,+$P($G(^IBE(350.9,1,9)),U,12),0)),U,6) ;                CS def bedsection
"RTN","IBACUS2",78,0)
 S IBUNITS=1 ;                                    one unit
"RTN","IBACUS2",79,0)
 S IBCPT=$P($G(^IBE(350.9,1,1)),"^",30) ;         def rx refill cpt
"RTN","IBACUS2",80,0)
 S IBDIV="" ;                                     division
"RTN","IBACUS2",81,0)
 S IBAA=0 ;                                       not auto calc charges
"RTN","IBACUS2",82,0)
 S IBTYPE=3 ;                                     rx type
"RTN","IBACUS2",83,0)
 S IBITEM="" ;                                    charge item link
"RTN","IBACUS2",84,0)
 ;
"RTN","IBACUS2",85,0)
 ;
"RTN","IBACUS2",86,0)
 S X=$$ADDRC^IBCRBF(IBIFN,IBRVCD,IBBS,IBAMT,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM)
"RTN","IBACUS2",87,0)
 I X<0 S IBY="-1^^Unable to add Revenue Code charge to claim." G BILLQ
"RTN","IBACUS2",88,0)
 ;
"RTN","IBACUS2",89,0)
 ; - update the authorize/print fields
"RTN","IBACUS2",90,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="9////1" D ^DIE K DA,DR,DIE
"RTN","IBACUS2",91,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="12////"_DT D ^DIE K DA,DR,DIE
"RTN","IBACUS2",92,0)
 ;
"RTN","IBACUS2",93,0)
 ; - pass the claim to AR
"RTN","IBACUS2",94,0)
 D GVAR^IBCBB,ARRAY^IBCBB1,^PRCASVC6,REL^PRCASVC:PRCASV("OKAY")
"RTN","IBACUS2",95,0)
 I 'PRCASV("OKAY") S IBY="-1^^Unable to establish receivable in AR." G BILLQ
"RTN","IBACUS2",96,0)
 ;
"RTN","IBACUS2",97,0)
 ; - update the rx transaction file (#351.5)
"RTN","IBACUS2",98,0)
 S DA=IBCHTRN,DIE="^IBA(351.5,",DR=".09////"_IBIFN D ^DIE K DA,DIE,DR
"RTN","IBACUS2",99,0)
 ;
"RTN","IBACUS2",100,0)
 ; - update the AR status to Active
"RTN","IBACUS2",101,0)
 S PRCASV("STATUS")=16
"RTN","IBACUS2",102,0)
 D STATUS^PRCASVC1
"RTN","IBACUS2",103,0)
 ;
"RTN","IBACUS2",104,0)
BILLQ I IBY<0 D ERRMSG^IBACVA2(1,2)
"RTN","IBACUS2",105,0)
 K IBRVCD,IBBS,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM,IBAMT
"RTN","IBACUS2",106,0)
 K IBSERV,IBFAC,IBSITE,IBDRX,IB,IBCDFN,IBINS,IBIDS,IBIFN,IBDFN
"RTN","IBACUS2",107,0)
 K PRCASV,PRCAERR
"RTN","IBACUS2",108,0)
 Q
"RTN","IBACUS2",109,0)
 ;
"RTN","IBACUS2",110,0)
 ;
"RTN","IBACUS2",111,0)
CANC(IBCHTRN) ; Cancel the claim to the Fiscal Intermediary.
"RTN","IBACUS2",112,0)
 ;  Input:  IBCHTRN  --  Pointer to the transaction entry in file #351.5
"RTN","IBACUS2",113,0)
 ;
"RTN","IBACUS2",114,0)
 S IBIFN=+$P($G(^IBA(351.5,IBCHTRN,0)),"^",9)
"RTN","IBACUS2",115,0)
 I 'IBIFN G CANCQ
"RTN","IBACUS2",116,0)
 F I=0,"S" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBACUS2",117,0)
 I IB(0)="" G CANCQ
"RTN","IBACUS2",118,0)
 I +$P(IB("S"),U,16),$P(IB("S"),U,17)]"" G CANCQ
"RTN","IBACUS2",119,0)
 ;
"RTN","IBACUS2",120,0)
 S DA=IBIFN,DR="16////1;19////PRESCRIPTION REVERSED",DIE="^DGCR(399,"
"RTN","IBACUS2",121,0)
 D ^DIE K DA,DIE,DR
"RTN","IBACUS2",122,0)
 ;
"RTN","IBACUS2",123,0)
 ; - decrease out the receivable in AR
"RTN","IBACUS2",124,0)
 S DFN=+$P(IB(0),"^",2)
"RTN","IBACUS2",125,0)
 S IB("U1")=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBACUS2",126,0)
 S IBIL=$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBACUS2",127,0)
 S IBCHG=$S(IB("U1")']"":0,$P(IB("U1"),"^",1)]"":$P(IB("U1"),"^",1),1:0)
"RTN","IBACUS2",128,0)
 S IBCRES="TRICARE PRESCRIPTION REVERSED"
"RTN","IBACUS2",129,0)
 ;
"RTN","IBACUS2",130,0)
 S X="21^"_IBCHG_"^"_IBIL_"^"_DUZ_"^"_DT_"^"_IBCRES
"RTN","IBACUS2",131,0)
 D ^PRCASER1
"RTN","IBACUS2",132,0)
 I Y<0 S IBY=Y D BULL
"RTN","IBACUS2",133,0)
 ;
"RTN","IBACUS2",134,0)
CANCQ K DFN,IBIFN,IB,IBIL,IBCHG,IBCRES,IBY,X,Y
"RTN","IBACUS2",135,0)
 Q
"RTN","IBACUS2",136,0)
 ;
"RTN","IBACUS2",137,0)
 ;
"RTN","IBACUS2",138,0)
BULL ; Generate a bulletin if there is an error in canceling the claim.
"RTN","IBACUS2",139,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACUS2",140,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBACUS2",141,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBACUS2",142,0)
 S XMY(DUZ)=""
"RTN","IBACUS2",143,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,1)),"^",7),0)),"^")
"RTN","IBACUS2",144,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBACUS2",145,0)
 ;
"RTN","IBACUS2",146,0)
 S IBT(1)="An error occurred while cancelling the Pharmacy claim to the TRICARE"
"RTN","IBACUS2",147,0)
 S IBT(2)="fiscal intermediary for the following patient:"
"RTN","IBACUS2",148,0)
 S IBT(3)=" " S IBC=3
"RTN","IBACUS2",149,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACUS2",150,0)
 S IBC=IBC+1,IBT(IBC)="   Bill #: "_IBIL
"RTN","IBACUS2",151,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",152,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBACUS2",153,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",154,0)
 D ERR^IBAERR1
"RTN","IBACUS2",155,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACUS2",156,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and decrease"
"RTN","IBACUS2",157,0)
 S IBC=IBC+1,IBT(IBC)="out this receivable in Accounts Receivable if necessary."
"RTN","IBACUS2",158,0)
 ;
"RTN","IBACUS2",159,0)
 D ^XMD
"RTN","IBACUS2",160,0)
 K IBC,IBDUZ,IBT,IBPT,IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IBACUS2",161,0)
 Q
"RTN","IBACVA2")
0^4^B15743651
"RTN","IBACVA2",1,0)
IBACVA2 ;ALB/CPM - BULLETINS FOR CHAMPVA BILLING ; 29-JUL-93
"RTN","IBACVA2",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,240**;21-MAR-94
"RTN","IBACVA2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACVA2",4,0)
 ;
"RTN","IBACVA2",5,0)
ERRMSG(IBIND,IBMSG) ; Process CHAMPVA/TRICARE Error Messages.
"RTN","IBACVA2",6,0)
 ;  Input:    IBIND  --  1=>billing 0=>canceling
"RTN","IBACVA2",7,0)
 ;            IBMSG  --  1=>CHAMPVA msg 2=> TRICARE msg
"RTN","IBACVA2",8,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACVA2",9,0)
 S IBMSGT=$S($G(IBMSG)=1:"CHAMPVA inpatient subsistence",1:"TRICARE Pharmacy copayment")
"RTN","IBACVA2",10,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBACVA2",11,0)
 S IBT(1)="An error occurred while "_$S($G(IBIND):"billing",1:"cancelling")_" the "_IBMSGT_" charge"
"RTN","IBACVA2",12,0)
 S IBT(2)=$S($G(IBIND):"to",1:"for")_" the following patient:"
"RTN","IBACVA2",13,0)
 S IBT(3)=" " S IBC=3
"RTN","IBACVA2",14,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACVA2",15,0)
 ;S Y=+DGPMA D DD^%DT
"RTN","IBACVA2",16,0)
 ;S IBC=IBC+1,IBT(IBC)="Disc Date: "_Y
"RTN","IBACVA2",17,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",18,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBACVA2",19,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",20,0)
 D ERR^IBAERR1
"RTN","IBACVA2",21,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",22,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and use the"
"RTN","IBACVA2",23,0)
 S IBC=IBC+1,IBT(IBC)="Cancel/Edit/Add Patient Charges' option to bill or cancel any necessary"
"RTN","IBACVA2",24,0)
 S IBC=IBC+1,IBT(IBC)="charges."
"RTN","IBACVA2",25,0)
 D SEND
"RTN","IBACVA2",26,0)
 Q
"RTN","IBACVA2",27,0)
 ;
"RTN","IBACVA2",28,0)
ADM ; Send a bulletin when CHAMPVA patients are admitted.
"RTN","IBACVA2",29,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACVA2",30,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - CHAMPVA PATIENT"
"RTN","IBACVA2",31,0)
 S IBT(1)="The following CHAMPVA patient has been admitted:"
"RTN","IBACVA2",32,0)
 S IBT(2)=" ",IBC=2
"RTN","IBACVA2",33,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACVA2",34,0)
 S Y=+DGPMA D DD^%DT
"RTN","IBACVA2",35,0)
 S IBC=IBC+1,IBT(IBC)=" Adm Date: "_Y
"RTN","IBACVA2",36,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",37,0)
 S IBC=IBC+1,IBT(IBC)="This patient will be automatically billed the CHAMPVA inpatient"
"RTN","IBACVA2",38,0)
 S IBC=IBC+1,IBT(IBC)="subsistence charge when discharged."
"RTN","IBACVA2",39,0)
 D SEND
"RTN","IBACVA2",40,0)
 Q
"RTN","IBACVA2",41,0)
 ;
"RTN","IBACVA2",42,0)
WARN(IBB,IBE) ; Send bulletins when discharges are edited or deleted.
"RTN","IBACVA2",43,0)
 ;  Input:    IBB  --  Discharge date before edit
"RTN","IBACVA2",44,0)
 ;            IBE  --  Discharge date after edit
"RTN","IBACVA2",45,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACVA2",46,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - DISCHARGE CHANGED"
"RTN","IBACVA2",47,0)
 S IBT(1)="A discharge was "_$S($G(IBE):"edited",1:"deleted")_" for the following CHAMPVA patient:"
"RTN","IBACVA2",48,0)
 S IBT(2)=" " S IBC=2
"RTN","IBACVA2",49,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACVA2",50,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",51,0)
 I $G(IBE) D
"RTN","IBACVA2",52,0)
 .S Y=IBB D DD^%DT S IBC=IBC+1,IBT(IBC)="Prev Discharge Date: "_Y
"RTN","IBACVA2",53,0)
 .S Y=IBE D DD^%DT S IBC=IBC+1,IBT(IBC)=" New Discharge Date: "_Y
"RTN","IBACVA2",54,0)
 .S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",55,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding these movement changes,"
"RTN","IBACVA2",56,0)
 S IBC=IBC+1,IBT(IBC)="and use the 'Cancel/Edit/Add Patient Charges' option to bill or cancel"
"RTN","IBACVA2",57,0)
 S IBC=IBC+1,IBT(IBC)="any necessary charges."
"RTN","IBACVA2",58,0)
 D SEND
"RTN","IBACVA2",59,0)
 Q
"RTN","IBACVA2",60,0)
 ;
"RTN","IBACVA2",61,0)
DEL(DFN,IBN,IBADM) ; Send bulletins when billed admissions are deleted.
"RTN","IBACVA2",62,0)
 ;  Input:    DFN  --  Pointer to the patient in file #2
"RTN","IBACVA2",63,0)
 ;            IBN  --  Pointer to the cancelled charge in file #350
"RTN","IBACVA2",64,0)
 ;          IBADM  --  Admission date/time
"RTN","IBACVA2",65,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBACVA2",66,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ADMISSION DELETED"
"RTN","IBACVA2",67,0)
 S IBT(1)="A billed admission for the following CHAMPVA patient was deleted:"
"RTN","IBACVA2",68,0)
 S IBT(2)=" " S IBC=2
"RTN","IBACVA2",69,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBACVA2",70,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",71,0)
 S Y=+IBADM D DD^%DT
"RTN","IBACVA2",72,0)
 S IBC=IBC+1,IBT(IBC)=" Adm Date: "_Y
"RTN","IBACVA2",73,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBACVA2",74,0)
 S IBC=IBC+1,IBT(IBC)="The inpatient subsistence charge for this admission has been cancelled"
"RTN","IBACVA2",75,0)
 S IBC=IBC+1,IBT(IBC)="in Billing only.  You MUST decrease the receivable "_$P($G(^IB(IBN,0)),"^",11)_" down to $0"
"RTN","IBACVA2",76,0)
 S IBC=IBC+1,IBT(IBC)="in the Accounts Receivable module!!"
"RTN","IBACVA2",77,0)
 D SEND
"RTN","IBACVA2",78,0)
 Q
"RTN","IBACVA2",79,0)
 ;
"RTN","IBACVA2",80,0)
SEND ; Send bulletin to recipients of the Means Test billing mailgroup.
"RTN","IBACVA2",81,0)
 D MAIL^IBAERR1
"RTN","IBACVA2",82,0)
 K IBC,IBT,IBPT,XMSUB,XMY,XMTEXT,XMDUZ,IBMSGT
"RTN","IBACVA2",83,0)
 Q
"RTN","IBACVA2",84,0)
 ;
"RTN","IBACVA2",85,0)
ON() ; Is the CHAMPVA billing module fully installed?
"RTN","IBACVA2",86,0)
 N X S X=+$O(^IBE(350.1,"E","CHAMPVA SUBSISTENCE",0))
"RTN","IBACVA2",87,0)
 Q +$P($G(^IBE(350.1,X,0)),"^",3)
"RTN","IBCBB7")
0^5^B26711457
"RTN","IBCBB7",1,0)
IBCBB7 ;ALB/BGA - CONT. OF MEDICARE EDIT CHECKS ;09/10/98
"RTN","IBCBB7",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,240**;21-MAR-94
"RTN","IBCBB7",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCBB7",4,0)
 ;
"RTN","IBCBB7",5,0)
 ; Revenue Codes
"RTN","IBCBB7",6,0)
 ;
"RTN","IBCBB7",7,0)
 ; rev codes must be between 100 AND 999
"RTN","IBCBB7",8,0)
 I $O(IBREV1(100),-1)>0!($O(IBREV1(999))>0) S IBQUIT=$$IBER^IBCBB3(.IBER,184) Q:IBQUIT
"RTN","IBCBB7",9,0)
 N IBRATYP
"RTN","IBCBB7",10,0)
 ;
"RTN","IBCBB7",11,0)
 ; ibrev1(rev cd,seq #)=Rev code^ptr cpt^unit chg^units^total^tot unc^^^mod ptrs
"RTN","IBCBB7",12,0)
 ; 3 subsection edits
"RTN","IBCBB7",13,0)
 ;
"RTN","IBCBB7",14,0)
 D F^IBCEF("N-BILL RATE TYPE","IBZ",,IBIFN)
"RTN","IBCBB7",15,0)
 ; Don't apply some edits unless specific rate types
"RTN","IBCBB7",16,0)
 S IBZ=$P($G(^DGCR(399.3,+IBZ,0)),U)
"RTN","IBCBB7",17,0)
 S IBRATYP=$S(IBZ="":1,IBZ["TRICARE"!(IBZ["CHAMPVA")!(IBZ["SHARING")!(IBZ["REIMBURS"):1,1:0)
"RTN","IBCBB7",18,0)
 S IBREVC=0 F  S IBREVC=$O(IBREV1(IBREVC)) Q:IBREVC=""  D  Q:IBQUIT
"RTN","IBCBB7",19,0)
 . S IBI=0
"RTN","IBCBB7",20,0)
 . F  S IBI=$O(IBREV1(IBREVC,IBI)) Q:'IBI  D  Q:IBQUIT
"RTN","IBCBB7",21,0)
 . . ;
"RTN","IBCBB7",22,0)
 . . S IBREVD=IBREV1(IBREVC,IBI),IBREVC12=$E(IBREVC,1,2),IBBCPT=$P(IBREVD,U,2)
"RTN","IBCBB7",23,0)
 . . ;
"RTN","IBCBB7",24,0)
 . . ; No charge associated with rev code
"RTN","IBCBB7",25,0)
 . . I '$P(IBREVD,U,3),IBREVC12'=18 S IBQUIT=$$IBER^IBCBB3(.IBER,185) Q:IBQUIT
"RTN","IBCBB7",26,0)
 . . ;
"RTN","IBCBB7",27,0)
 . . ; Charges cannot be negative dollar amounts
"RTN","IBCBB7",28,0)
 . . I $P(IBREVD,U,5)<0 S IBQUIT=$$IBER^IBCBB3(.IBER,213) Q:IBQUIT
"RTN","IBCBB7",29,0)
 . . ;
"RTN","IBCBB7",30,0)
 . . ; Non Covered charges cannot be a negative amount
"RTN","IBCBB7",31,0)
 . . ;     and must not be > total charge
"RTN","IBCBB7",32,0)
 . . I $P(IBREVD,U,6)>$P(IBREVD,U,5)!($P(IBREVD,U,6)<0) S IBQUIT=$$IBER^IBCBB3(.IBER,214) Q:IBQUIT
"RTN","IBCBB7",33,0)
 . . ;
"RTN","IBCBB7",34,0)
 . . ; =====
"RTN","IBCBB7",35,0)
 . . ; Accommodation revenue code edits
"RTN","IBCBB7",36,0)
 . . I IBREV1(IBREVC)="AC" D  Q
"RTN","IBCBB7",37,0)
 . . . N IBBSEC
"RTN","IBCBB7",38,0)
 . . . ; dup Rev accom cds must have diff rates and bedsections
"RTN","IBCBB7",39,0)
 . . . S IBBSEC=$P($G(^DGCR(399,IBIFN,"RC",+$P(IBREVD,U,8),0)),U,5)
"RTN","IBCBB7",40,0)
 . . . I $O(IBREV1(IBREVC,1)) D  Q:IBQUIT
"RTN","IBCBB7",41,0)
 . . . . I IBI=1 K IBREVDUP S IBREVDUP(+$P(IBREVD,U,3)_" "_IBBSEC)=""
"RTN","IBCBB7",42,0)
 . . . . I IBI>1,$D(IBREVDUP(+$P(IBREVD,U,3)_" "_IBBSEC)) S IBQUIT=$$IBER^IBCBB3(.IBER,186)
"RTN","IBCBB7",43,0)
 . . . ; Total Line charges for accom rev codes can not be < 0
"RTN","IBCBB7",44,0)
 . . . I IBREVC>99,IBREVC<220,IBREVTOT("AC")<0 S IBQUIT=$$IBER^IBCBB3(.IBER,211)
"RTN","IBCBB7",45,0)
 . . . ; For accom rev codes, detail charge for revc=18x must be 0
"RTN","IBCBB7",46,0)
 . . . I IBREVC12=18,$P(IBREV1(IBREVC,IBI),U,3) S IBQUIT=$$IBER^IBCBB3(.IBER,212)
"RTN","IBCBB7",47,0)
 . . ;
"RTN","IBCBB7",48,0)
 . . ; =====
"RTN","IBCBB7",49,0)
 . . ; Inpatient Ancillary only Rev Codes edit 60-4
"RTN","IBCBB7",50,0)
 . . I IBREV1(IBREVC)="AI" D  Q
"RTN","IBCBB7",51,0)
 . . . ; Cannot have dup anc REV codes except 24X
"RTN","IBCBB7",52,0)
 . . . N IBMOD
"RTN","IBCBB7",53,0)
 . . . S IBMOD=$P(IBREVD,U,9)
"RTN","IBCBB7",54,0)
 . . . ;I IBRATYP,IBI>1,IBREVC12'=24 S IBQUIT=$$IBER^IBCBB3(.IBER,188)
"RTN","IBCBB7",55,0)
 . . . ;
"RTN","IBCBB7",56,0)
 . . . ;HCPCS code is required for rev code 636 and TOB 13X, 14X, 83X
"RTN","IBCBB7",57,0)
 . . . I IBREVC=636,IBBCPT="",(IBTOB12=13!(IBTOB12=14)!(IBTOB12=83)) S IBQUIT=$$IBER^IBCBB3(.IBER,191)
"RTN","IBCBB7",58,0)
 . . . ;
"RTN","IBCBB7",59,0)
 . . ; =====
"RTN","IBCBB7",60,0)
 . . ; OUTPATIENT ANCILLARY only Rev Codes edit rec 61-04
"RTN","IBCBB7",61,0)
 . . I IBREV1(IBREVC)="AO" D  Q
"RTN","IBCBB7",62,0)
 . . . ;
"RTN","IBCBB7",63,0)
 . . . ; Rev codes with different HCPCS codes can be duplicated
"RTN","IBCBB7",64,0)
 . . . I $$FT^IBCEF(IBIFN)=3,$O(IBREV1(IBREVC,1))  D  Q:IBQUIT
"RTN","IBCBB7",65,0)
 . . . . N IBMOD
"RTN","IBCBB7",66,0)
 . . . . S IBMOD=$P(IBREVD,U,9)
"RTN","IBCBB7",67,0)
 . . . . I IBI=1 K IBREVDUP S IBREVDUP(IBBCPT_" "_IBMOD)=""
"RTN","IBCBB7",68,0)
 . . . . I '$$ISRX^IBCEF1(IBIFN),IBI>1,$D(IBREVDUP(IBBCPT_" "_IBMOD)),IBER'["IB192;" S IBQUIT=$$IBER^IBCBB3(.IBER,192)
"RTN","IBCBB7",69,0)
 . . . ;
"RTN","IBCBB7",70,0)
 . . . ; Rev Code 49x can not be entered with 36x and 37x
"RTN","IBCBB7",71,0)
 . . . I IBREVC12=49,$O(IBREV1(380),-1)'<360 S IBQUIT=$$IBER^IBCBB3(.IBER,195) Q:IBQUIT
"RTN","IBCBB7",72,0)
 . . . ;
"RTN","IBCBB7",73,0)
 . . . ; If Rev=42x & billtype=83x!13x req occ cds 11&35 and val code 50
"RTN","IBCBB7",74,0)
 . . . ;I IBREVC12=42,(IBTOB12=83!(IBTOB12=13)) D  Q:IBQUIT
"RTN","IBCBB7",75,0)
 . . . ;. I '$D(IBVALCD(50))!'$D(IBOCCD(11))!'$D(IBOCCD(35)) S IBQUIT=$$IBER^IBCBB3(.IBER,196)
"RTN","IBCBB7",76,0)
 . . . ;
"RTN","IBCBB7",77,0)
 . . . ; If Rev=43x & billtype=83x!13x req occ cds 11&44 and val code 51
"RTN","IBCBB7",78,0)
 . . . ;I IBREVC12=43,(IBTOB12=83!(IBTOB12=13)) D
"RTN","IBCBB7",79,0)
 . . . ;. I '$D(IBVALCD(51))!'$D(IBOCCD(11))!'$D(IBOCCD(44)) S IBQUIT=$$IBER^IBCBB3(.IBER,197)
"RTN","IBCBB7",80,0)
 . . . ;
"RTN","IBCBB7",81,0)
 . . . ; If Rev=44x & billtype=83x!13x req occ cds 11&45 and val code 52
"RTN","IBCBB7",82,0)
 . . . ;I IBREVC12=44,(IBTOB12=83!(IBTOB12=13)) D
"RTN","IBCBB7",83,0)
 . . . ;. I '$D(IBVALCD(52))!'$D(IBOCCD(11))!'$D(IBOCCD(45)) S IBQUIT=$$IBER^IBCBB3(.IBER,198)
"RTN","IBCBB7",84,0)
 . . . ;
"RTN","IBCBB7",85,0)
 . . . ; If Rev=943 & billtype=83x!13x req occ cds 11&46 and val code 53
"RTN","IBCBB7",86,0)
 . . . ;I IBREVC=943,(IBTOB12=83!IBTOB12=13) D
"RTN","IBCBB7",87,0)
 . . . ;. I '$D(IBVALCD(53))!('$D(IBOCCD(11)))!('$D(IBOCCD(46))) S IBQUIT=$$IBER^IBCBB3(.IBER,199)
"RTN","IBCBB7",88,0)
 . . . ;
"RTN","IBCBB7",89,0)
 . . . ; If Rev=403 & bill type=14x!23x and service date >= 01-01-91
"RTN","IBCBB7",90,0)
 . . . ;   require only HCPCS codes 76092 and no other rev codes
"RTN","IBCBB7",91,0)
 . . . I IBREVC=403,IBFDT'<2910101,(IBTOB12=14!(IBTOB12=23)) D
"RTN","IBCBB7",92,0)
 . . . . I $O(IBREV1(403))!$O(IBREV1(403),-1)!(IBBCPT'=76092) S IBQUIT=$$IBER^IBCBB3(.IBER,194) Q
"RTN","IBCBB7",93,0)
 . . . ;
"RTN","IBCBB7",94,0)
 . . . ; If Rev=401 & bill type=13x!14x!23x!71x allow only HCPSCS codes
"RTN","IBCBB7",95,0)
 . . . ;   76090 or 78091
"RTN","IBCBB7",96,0)
 . . . ;I IBREVC=401,(IBTOB12=13!(IBTOB12=14)!(IBTOB12=23)!(IBTOB12=71)),IBBCPT'="",IBBCPT'=76090,IBBCPT'=78091 S IBQUIT=$$IBER^IBCBB3(.IBER,201)
"RTN","IBCBB7",97,0)
 . . . ;
"RTN","IBCBB7",98,0)
 . . . ; Rev code cannot equal 227 or 29x
"RTN","IBCBB7",99,0)
 . . . ;I IBREVC=227!(IBREVC12=29) S IBQUIT=$$IBER^IBCBB3(.IBER,202)
"RTN","IBCBB7",100,0)
 . . . D REVC^IBCBB7A(IBREVD,IBREVC,IBBCPT,IBREVC12,.IBER)
"RTN","IBCBB7",101,0)
 Q:IBQUIT
"RTN","IBCBB7",102,0)
 ;
"RTN","IBCBB7",103,0)
 D ^IBCBB8
"RTN","IBCBB7",104,0)
 Q
"RTN","IBCNBAR")
0^6^B18172525
"RTN","IBCNBAR",1,0)
IBCNBAR ;ALB/ARH-Ins Buffer: process Accept and Reject ;1 Jun 97
"RTN","IBCNBAR",2,0)
 ;;2.0;INTEGRATED BILLING;**82,240**;21-MAR-94
"RTN","IBCNBAR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNBAR",4,0)
 ;
"RTN","IBCNBAR",5,0)
 ;
"RTN","IBCNBAR",6,0)
ACCEPT(IBBUFDA,DFN,IBINSDA,IBGRPDA,IBPOLDA,IBMVINS,IBMVGRP,IBMVPOL,IBNEWINS,IBNEWGRP,IBNEWPOL) ; move buffer data into Insurance files then cleanup
"RTN","IBCNBAR",7,0)
 ;    1) data moved into insurance files, new records created if needed or edit existing ones
"RTN","IBCNBAR",8,0)
 ;    2) complete some general functions that are executed whenever insurance is entered/edited
"RTN","IBCNBAR",9,0)
 ;    3) allow user to view buffer entry and new/updated insurance records
"RTN","IBCNBAR",10,0)
 ;    4) buffer ins/group/policy data deleted
"RTN","IBCNBAR",11,0)
 ;    5) buffer entry status updated
"RTN","IBCNBAR",12,0)
 ;
"RTN","IBCNBAR",13,0)
 ;
"RTN","IBCNBAR",14,0)
PROCESS ; process all changes selected by user, add/edit insurance files based on buffer data
"RTN","IBCNBAR",15,0)
 ;
"RTN","IBCNBAR",16,0)
 N IVMINSUP,IBNEW,IBCDFN S IBCDFN=IBPOLDA S:+IBNEWPOL IBNEW=1 D BEFORE^IBCNSEVT ; insurance event driver
"RTN","IBCNBAR",17,0)
 ;
"RTN","IBCNBAR",18,0)
 N DIR,X,Y,IBX,IBINSH,IBGRPH,IBPOLH S (IBINSH,IBGRPH,IBPOLH)="Updated" W " ...",!
"RTN","IBCNBAR",19,0)
 ;
"RTN","IBCNBAR",20,0)
 I +IBNEWINS S IBINSDA=+$$NEWINS^IBCNBMN(IBBUFDA) G:'IBINSDA ACCPTQ  S IBINSH="Created"
"RTN","IBCNBAR",21,0)
 I +IBNEWGRP S IBGRPDA=+$$NEWGRP^IBCNBMN(IBBUFDA,+IBINSDA) G:'IBGRPDA ACCPTQ  S IBGRPH="Created"
"RTN","IBCNBAR",22,0)
 I +IBNEWPOL S IBPOLDA=+$$NEWPOL^IBCNBMN(IBBUFDA,+IBINSDA,+IBGRPDA) G:'IBPOLDA ACCPTQ  S IBPOLH="Created"
"RTN","IBCNBAR",23,0)
 ;
"RTN","IBCNBAR",24,0)
 I +IBINSDA,+IBMVINS D INS^IBCNBMI(IBBUFDA,IBINSDA,+IBMVINS) W !,"Insurance Company "_IBINSH_"..."
"RTN","IBCNBAR",25,0)
 I +IBINSDA,+IBMVGRP,+IBGRPDA D GRP^IBCNBMI(IBBUFDA,IBGRPDA,+IBMVGRP) W !,"Group/Plan "_IBGRPH_"..."
"RTN","IBCNBAR",26,0)
 I +IBINSDA,+IBMVPOL,+IBGRPDA,+IBPOLDA D POLICY^IBCNBMI(IBBUFDA,IBPOLDA,+IBMVPOL) W !,"Patient Policy "_IBPOLH_"..."
"RTN","IBCNBAR",27,0)
 ;
"RTN","IBCNBAR",28,0)
CLEANUP ; general updates and checks done whenever insurance is added/edited and clean up buffer file
"RTN","IBCNBAR",29,0)
 N IBSOURCE S IBSOURCE=$P($G(^IBA(355.33,IBBUFDA,0)),U,3)
"RTN","IBCNBAR",30,0)
 ;
"RTN","IBCNBAR",31,0)
 D POL^IBCNSU41(DFN) ;                                               update Tricare sponsor data
"RTN","IBCNBAR",32,0)
 D COVERED^IBCNSM31(DFN) ;                                           update 'Covered by Insurance' field (2,.3192
"RTN","IBCNBAR",33,0)
 I +IBSOURCE=3 D IVM(1,IBBUFDA) ;                                    update/notify IVM
"RTN","IBCNBAR",34,0)
 I +IBINSDA,+IBPOLDA S IBX=$$DUPCO^IBCNSOK1(DFN,IBINSDA,IBPOLDA,1) ; warning if duplicate policy added for patient
"RTN","IBCNBAR",35,0)
 I +IBGRPDA S IBX=$$DUPPOL^IBCNSOK1(IBGRPDA,1) ;                     warning if duplicate plan was added
"RTN","IBCNBAR",36,0)
 I +IBNEWPOL I +$$PTHLD^IBOHCR(DFN,1,1) W !!,"Patient's bills On Hold date updated due to new insurance."
"RTN","IBCNBAR",37,0)
 I $$HOLD^IBCNBLL(DFN) W !!,"There are bills On Hold for this patient."
"RTN","IBCNBAR",38,0)
 ;
"RTN","IBCNBAR",39,0)
 W !! S DIR(0)="FO",DIR("A")="Press 'V' to view the changes or Return to continue" D ^DIR
"RTN","IBCNBAR",40,0)
 I Y="V"!(Y="v") W !! D INS^IBCNBCD(IBBUFDA,IBINSDA),WAIT^IBCNBUH,GRP^IBCNBCD(IBBUFDA,IBGRPDA),WAIT^IBCNBUH,POLICY^IBCNBCD(IBBUFDA,IBPOLDA),WAIT^IBCNBUH
"RTN","IBCNBAR",41,0)
 ;
"RTN","IBCNBAR",42,0)
 ; update buffer file entry so only stub remains and status is changed
"RTN","IBCNBAR",43,0)
 D STATUS^IBCNBEE(IBBUFDA,"A",IBNEWINS,IBNEWGRP,IBNEWPOL) ;          update buffer entry's status to accepted
"RTN","IBCNBAR",44,0)
 D DELDATA^IBCNBED(IBBUFDA) ;                                        delete buffer's insurance/patient data
"RTN","IBCNBAR",45,0)
 ;
"RTN","IBCNBAR",46,0)
 S IBCDFN=IBPOLDA S:+IBSOURCE=3 IVMINSUP=1 D AFTER^IBCNSEVT,^IBCNSEVT ; insurance event driver
"RTN","IBCNBAR",47,0)
 ;
"RTN","IBCNBAR",48,0)
ACCPTQ Q
"RTN","IBCNBAR",49,0)
 ;
"RTN","IBCNBAR",50,0)
 ;
"RTN","IBCNBAR",51,0)
REJECT(IBBUFDA) ; process a buffer entry reject
"RTN","IBCNBAR",52,0)
 ;    1) update/notify IVM
"RTN","IBCNBAR",53,0)
 ;    2) buffer ins/group/policy data deleted
"RTN","IBCNBAR",54,0)
 ;    3) buffer entry status updated
"RTN","IBCNBAR",55,0)
 ;    4) if patient has no other active insurance then release any patient bills On Hold
"RTN","IBCNBAR",56,0)
 ;
"RTN","IBCNBAR",57,0)
 N DFN S DFN=+$G(^IBA(355.33,+IBBUFDA,60))
"RTN","IBCNBAR",58,0)
 ;
"RTN","IBCNBAR",59,0)
 I +$P($G(^IBA(355.33,+IBBUFDA,0)),U,3)=3 D IVM(0,IBBUFDA)
"RTN","IBCNBAR",60,0)
 ;
"RTN","IBCNBAR",61,0)
 D STATUS^IBCNBEE(+IBBUFDA,"R",0,0,0),DELDATA^IBCNBED(+IBBUFDA) W " ... done."
"RTN","IBCNBAR",62,0)
 ;
"RTN","IBCNBAR",63,0)
 I +DFN,'$$INSURED^IBCNS1(DFN),'$$BUFFER^IBCNBU1(DFN) D
"RTN","IBCNBAR",64,0)
 . I +$$PTHLD^IBOHCR(DFN,2,1) W !!,"Patient has no other active Insurance.",!,"All patient bills On Hold waiting for Insurance have been released." D WAIT^IBCNBUH
"RTN","IBCNBAR",65,0)
 ;
"RTN","IBCNBAR",66,0)
 Q
"RTN","IBCNBAR",67,0)
 ;
"RTN","IBCNBAR",68,0)
 ;
"RTN","IBCNBAR",69,0)
IVM(AR,IBBUFDA) ; IVM must be notified whenever a buffer entry that originated in IVM is accepted or rejected
"RTN","IBCNBAR",70,0)
 ; this lets them clean up their files since they also have a buffer type file of insurance uploaded from the IVM center
"RTN","IBCNBAR",71,0)
 ; if rejected they then ask the user for a reason it was rejected
"RTN","IBCNBAR",72,0)
 ; input:  AR = 1 if accepted, 0 if rejected
"RTN","IBCNBAR",73,0)
 ;
"RTN","IBCNBAR",74,0)
 N DFN,IBX,IBY I $P($G(^IBA(355.33,+IBBUFDA,0)),U,3)'=3 Q
"RTN","IBCNBAR",75,0)
 ;
"RTN","IBCNBAR",76,0)
 S DFN=+$G(^IBA(355.33,+IBBUFDA,60))
"RTN","IBCNBAR",77,0)
 S IBX=$P($G(^IBA(355.33,+IBBUFDA,20)),U,1)_U_$P($G(^IBA(355.33,+IBBUFDA,21)),U,1)_U_$P($G(^IBA(355.33,+IBBUFDA,40)),U,3)
"RTN","IBCNBAR",78,0)
 ;
"RTN","IBCNBAR",79,0)
 S IBY=$$UPDATE^IVMLINS4(DFN,AR,IBX)
"RTN","IBCNBAR",80,0)
 Q
"RTN","IBCNS1")
0^7^B34528689
"RTN","IBCNS1",1,0)
IBCNS1 ;ALB/AAS - INSURANCE MANAGEMENT SUPPORTED FUNCTIONS ;22-JULY-91
"RTN","IBCNS1",2,0)
 ;;2.0;INTEGRATED BILLING;**28,60,52,85,107,51,137,240**;21-MAR-94
"RTN","IBCNS1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNS1",4,0)
 ;
"RTN","IBCNS1",5,0)
INSURED(DFN,IBINDT) ; -- Is patient insured
"RTN","IBCNS1",6,0)
 ; --Input  DFN     = patient
"RTN","IBCNS1",7,0)
 ;          IBINDT  = (optional) date insured (default = today)
"RTN","IBCNS1",8,0)
 ; -- Output        = 0 - not insured
"RTN","IBCNS1",9,0)
 ;                  = 1 - insured
"RTN","IBCNS1",10,0)
 ;
"RTN","IBCNS1",11,0)
 N J,X,IBINS S IBINS=0,J=0
"RTN","IBCNS1",12,0)
 I '$G(DFN) G INSQ
"RTN","IBCNS1",13,0)
 I '$G(IBINDT) S IBINDT=DT
"RTN","IBCNS1",14,0)
 F  S J=$O(^DPT(DFN,.312,J)) Q:'J  S X=$G(^(J,0)) S IBINS=$$CHK(X,IBINDT) Q:IBINS
"RTN","IBCNS1",15,0)
INSQ Q IBINS
"RTN","IBCNS1",16,0)
 ;
"RTN","IBCNS1",17,0)
PRE(DFN,IBINDT) ; -- is pre-certification required for patient
"RTN","IBCNS1",18,0)
 N X,Y,J,IBPRE
"RTN","IBCNS1",19,0)
 S IBPRE=0,J=0
"RTN","IBCNS1",20,0)
 S:'$G(IBINDT) IBINDT=DT
"RTN","IBCNS1",21,0)
 F  S J=$O(^DPT(DFN,.312,J)) Q:'J  S X=$G(^(J,0)) I $$CHK(X,IBINDT),$P($G(^IBA(355.3,+$P(X,"^",18),0)),"^",6) S IBPRE=1 Q
"RTN","IBCNS1",22,0)
PREQ Q IBPRE
"RTN","IBCNS1",23,0)
 ;
"RTN","IBCNS1",24,0)
UR(DFN,IBINDT) ; -- is ur required for patient
"RTN","IBCNS1",25,0)
 N X,Y,J,IBPRE
"RTN","IBCNS1",26,0)
 S IBUR=0,J=0
"RTN","IBCNS1",27,0)
 S:'$G(IBINDT) IBINDT=DT
"RTN","IBCNS1",28,0)
 F  S J=$O(^DPT(DFN,.312,J)) Q:'J  S X=$G(^(J,0)) I $$CHK(X,IBINDT),$P($G(^IBA(355.3,+$P(X,"^",18),0)),"^",5) S IBUR=1 Q
"RTN","IBCNS1",29,0)
URQ Q IBUR
"RTN","IBCNS1",30,0)
 ;
"RTN","IBCNS1",31,0)
CHK(X,Z,Y) ; -- check one entry for active
"RTN","IBCNS1",32,0)
 ; --  Input   X    = Zeroth node of entry in insurance multiple (2.312)
"RTN","IBCNS1",33,0)
 ;             Z    = date to check
"RTN","IBCNS1",34,0)
 ;             Y    = 2 if want will not reimburse
"RTN","IBCNS1",35,0)
 ;                  = 3 if want will not reimburse AND indemnity plans
"RTN","IBCNS1",36,0)
 ;                  = 4 if want will not reimburse, but only if it's
"RTN","IBCNS1",37,0)
 ;                       MEDICARE
"RTN","IBCNS1",38,0)
 ; --  Output  1    = Insurance Active
"RTN","IBCNS1",39,0)
 ;             0    = Inactive
"RTN","IBCNS1",40,0)
 ;
"RTN","IBCNS1",41,0)
 N Z1,X1
"RTN","IBCNS1",42,0)
 S Z1=0,Y=$G(Y)
"RTN","IBCNS1",43,0)
 I Y'=3,$$INDEM(X) G CHKQ ; is an indemnity policy or company
"RTN","IBCNS1",44,0)
 S X1=$G(^DIC(36,+X,0)) G:X1="" CHKQ ;insurance company entry doesn't exist
"RTN","IBCNS1",45,0)
 I $P(X,"^",8) G:Z<$P(X,"^",8) CHKQ ;effective date later than care
"RTN","IBCNS1",46,0)
 I $P(X,"^",4) G:Z>$P(X,"^",4) CHKQ ;care after expiration date
"RTN","IBCNS1",47,0)
 I $P($G(^IBA(355.3,+$P(X,"^",18),0)),"^",11) G CHKQ ;plan is inactive
"RTN","IBCNS1",48,0)
 G:$P(X1,"^",5) CHKQ ;insurance company inactive
"RTN","IBCNS1",49,0)
 I Y<2 G:$P(X1,"^",2)="N" CHKQ ;insurance company will not reimburse
"RTN","IBCNS1",50,0)
 I Y=4,$P(X1,"^",2)="N",'$$MCRWNR^IBEFUNC(+X) G CHKQ ;only MEDICARE WNR
"RTN","IBCNS1",51,0)
 S Z1=1
"RTN","IBCNS1",52,0)
CHKQ Q Z1
"RTN","IBCNS1",53,0)
 ;
"RTN","IBCNS1",54,0)
ACTIVE(IBCIFN) ; -- is this company active for this patient for this date
"RTN","IBCNS1",55,0)
 ; -- called from input transform and x-refs for fields 101,102,103
"RTN","IBCNS1",56,0)
 ; -- input
"RTN","IBCNS1",57,0)
 N ACTIVE,DFN,IBINDT
"RTN","IBCNS1",58,0)
 S DFN=$P(^DGCR(399,DA,0),"^",2),IBINDT=$S(+$G(^DGCR(399,DA,"U")):+$G(^("U")),1:DT)
"RTN","IBCNS1",59,0)
 ;
"RTN","IBCNS1",60,0)
ACTIVEQ Q ACTIVE
"RTN","IBCNS1",61,0)
 ;
"RTN","IBCNS1",62,0)
DD ;  - called from input transform and x-refs for field 101,102,103
"RTN","IBCNS1",63,0)
 ;  - input requires da=internal entry number in 399
"RTN","IBCNS1",64,0)
 ;  - outputs IBdd(ins co.) array
"RTN","IBCNS1",65,0)
 N DFN S DFN=$P(^DGCR(399,DA,0),"^",2),IBINDT=$S(+$G(^DGCR(399,DA,"U")):+$G(^("U")),1:DT)
"RTN","IBCNS1",66,0)
 D ALLACT
"RTN","IBCNS1",67,0)
DDQ K IBINDT Q
"RTN","IBCNS1",68,0)
 ;
"RTN","IBCNS1",69,0)
 ;
"RTN","IBCNS1",70,0)
ALLACT ; -- return active insurance zeroth nodes in ibdd(ins co,entry in mult)
"RTN","IBCNS1",71,0)
 N X,X1
"RTN","IBCNS1",72,0)
 S (X1,IBDD)=0
"RTN","IBCNS1",73,0)
 F  S X1=$O(^DPT(DFN,.312,X1)) Q:'X1  S X=$G(^(X,0)) I $$CHK(X,IBINDT) S IBDD(+X,X1)=X
"RTN","IBCNS1",74,0)
 ;
"RTN","IBCNS1",75,0)
ALLACTQ Q
"RTN","IBCNS1",76,0)
 ;
"RTN","IBCNS1",77,0)
HDR W !?4,"Insurance Co.",?22,"Policy #",?40,"Group",?52,"Holder",?60,"Effective",?70,"Expires" S X="",$P(X,"=",IOM-4)="" W !?4,X
"RTN","IBCNS1",78,0)
 Q
"RTN","IBCNS1",79,0)
 ;
"RTN","IBCNS1",80,0)
 ;
"RTN","IBCNS1",81,0)
D1 N X Q:'$D(IBINS)
"RTN","IBCNS1",82,0)
 W !?4,$S($D(^DIC(36,+IBINS,0)):$E($P(^(0),"^",1),1,16),1:"UNKNOWN")
"RTN","IBCNS1",83,0)
 W ?22,$E($P(IBINS,"^",2),1,16)
"RTN","IBCNS1",84,0)
 W ?40,$E($$GRP^IBCNS($P(IBINS,"^",18)),1,10)
"RTN","IBCNS1",85,0)
 S X=$P(IBINS,"^",6) W ?52,$S(X="v":"SELF",X="s":"SPOUSE",1:"OTHER")
"RTN","IBCNS1",86,0)
 W ?60,$$DAT1^IBOUTL($P(IBINS,"^",8)),?70,$$DAT1^IBOUTL($P(IBINS,"^",4))
"RTN","IBCNS1",87,0)
 Q
"RTN","IBCNS1",88,0)
 ;
"RTN","IBCNS1",89,0)
ALL(DFN,VAR,ACT,ADT,SOP) ; -- find all insurance data on a patient
"RTN","IBCNS1",90,0)
 ;
"RTN","IBCNS1",91,0)
 ; -- input DFN  = patient
"RTN","IBCNS1",92,0)
 ;          VAR  = variable to output in format of abc
"RTN","IBCNS1",93,0)
 ;                 or abc(dfn)
"RTN","IBCNS1",94,0)
 ;                 or ^tmp($j,"Insurance")
"RTN","IBCNS1",95,0)
 ;          ACT  = 1 if only active ins. desired
"RTN","IBCNS1",96,0)
 ;               = 2 if active and will not reimburse desired
"RTN","IBCNS1",97,0)
 ;               = 3 if active, will not reimburse, and indemnity are
"RTN","IBCNS1",98,0)
 ;                 all desired (for the $$INSTYP function below)
"RTN","IBCNS1",99,0)
 ;               = 4 if only active and MEDICARE WNR only desired
"RTN","IBCNS1",100,0)
 ;          ADT  = if ACT=1 or 4, then ADT is the internal date to check
"RTN","IBCNS1",101,0)
 ;                 active for, default = dt
"RTN","IBCNS1",102,0)
 ;          SOP  = if SOP=1, then sort policies in COB order
"RTN","IBCNS1",103,0)
 ;
"RTN","IBCNS1",104,0)
 ; -- output var(0)   =: number of entries insurance multiple
"RTN","IBCNS1",105,0)
 ;           var(x,0) =: ^dpt(dfn,.312,x,0)
"RTN","IBCNS1",106,0)
 ;           var(x,1) =: ^dpt(dfn,.312,x,1)
"RTN","IBCNS1",107,0)
 ;           var(x,2) =: ^dpt(dfn,.312,x,2)
"RTN","IBCNS1",108,0)
 ;           var(x,3) =: ^dpt(dfn,.312,x,3)
"RTN","IBCNS1",109,0)
 ;           var(x,4) =: ^dpt(dfn,.312,x,4)
"RTN","IBCNS1",110,0)
 ;       var(x,355.3) =: ^iba(355.3,$p(var(x,0),"^",18),0)
"RTN","IBCNS1",111,0)
 ;       var("S",COB sequence,x) =: (null) as an xref for COB
"RTN","IBCNS1",112,0)
 ;
"RTN","IBCNS1",113,0)
 N X,IBMRA,IBSP
"RTN","IBCNS1",114,0)
 S X=0 I $G(ACT),$E($G(ADT),1,7)'?7N S ADT=DT
"RTN","IBCNS1",115,0)
 S (IBMRA,IBSP)=0 ;Flag to say if pt has medicare wnr, spouse has policy
"RTN","IBCNS1",116,0)
 F  S X=$O(^DPT(DFN,.312,X)) Q:'X  I $D(^(X,0)) D
"RTN","IBCNS1",117,0)
 .I $G(ACT),'$$CHK(^DPT(DFN,.312,X,0),ADT,$G(ACT)) Q
"RTN","IBCNS1",118,0)
 .S @VAR@(0)=$G(@VAR@(0))+1
"RTN","IBCNS1",119,0)
 .S @VAR@(X,0)=$$ZND(DFN,X)
"RTN","IBCNS1",120,0)
 .S @VAR@(X,1)=$G(^DPT(DFN,.312,X,1))
"RTN","IBCNS1",121,0)
 .S @VAR@(X,2)=$G(^DPT(DFN,.312,X,2))
"RTN","IBCNS1",122,0)
 .S @VAR@(X,3)=$G(^DPT(DFN,.312,X,3))
"RTN","IBCNS1",123,0)
 .S @VAR@(X,4)=$G(^DPT(DFN,.312,X,4))
"RTN","IBCNS1",124,0)
 .S @VAR@(X,355.3)=$G(^IBA(355.3,+$P($G(^DPT(DFN,.312,X,0)),"^",18),0))
"RTN","IBCNS1",125,0)
 .I $G(SOP) D
"RTN","IBCNS1",126,0)
 ..N COB,WHO
"RTN","IBCNS1",127,0)
 ..S COB=$P(@VAR@(X,0),U,20)
"RTN","IBCNS1",128,0)
 ..S WHO=$P(@VAR@(X,0),U,6) S:WHO="s" IBSP=1
"RTN","IBCNS1",129,0)
 ..I $$MCRWNR^IBEFUNC(+@VAR@(X,0)) D
"RTN","IBCNS1",130,0)
 ... S COB=.5,IBMRA=1
"RTN","IBCNS1",131,0)
 ... 
"RTN","IBCNS1",132,0)
 ..S COB=$S(COB'="":COB,WHO="v":1,WHO="s":$S(IBMRA:1,1:2),1:3)
"RTN","IBCNS1",133,0)
 ..S @VAR@("S",COB,X)=""
"RTN","IBCNS1",134,0)
 ..Q
"RTN","IBCNS1",135,0)
 ; Ck for spouse's insurance, move it before any MEDICARE WNR if sorting
"RTN","IBCNS1",136,0)
 I $G(SOP),IBMRA,IBSP D
"RTN","IBCNS1",137,0)
 . ; Shuffle Medicare WNR, if necessary
"RTN","IBCNS1",138,0)
 . S X=0 F  S X=$O(@VAR@("S",.5,X)) Q:'X  S @VAR@("S",2,X)="" K @VAR@("S",.5,X)
"RTN","IBCNS1",139,0)
 . S X=0 F  S X=$O(@VAR@("S",2,X)) Q:'X  I $P(@VAR@(X,0),U,6)="s",'$P(@VAR@(X,0),U,20) S @VAR@("S",1,X)="" K @VAR@("S",2,X)
"RTN","IBCNS1",140,0)
ALLQ Q
"RTN","IBCNS1",141,0)
 ;
"RTN","IBCNS1",142,0)
ALLWNR(DFN,VAR,ADT) ; Returns 'all active and MEDICARE WNR'
"RTN","IBCNS1",143,0)
 D ALL(DFN,VAR,4,ADT)
"RTN","IBCNS1",144,0)
 Q
"RTN","IBCNS1",145,0)
 ;
"RTN","IBCNS1",146,0)
ZND(DFN,NODE) ; -- set group number and group name back into zeroth node of ins. type
"RTN","IBCNS1",147,0)
 N X,Y S (X,Y)=""
"RTN","IBCNS1",148,0)
 I '$G(DFN)!('$G(NODE)) G ZNDQ
"RTN","IBCNS1",149,0)
 S X=$G(^DPT(+DFN,.312,+NODE,0))
"RTN","IBCNS1",150,0)
 S Y=$G(^IBA(355.3,+$P(X,"^",18),0)) I Y="" G ZNDQ
"RTN","IBCNS1",151,0)
 S $P(X,"^",3)=$P(Y,"^",4) ; move group number
"RTN","IBCNS1",152,0)
 S $P(X,"^",15)=$P(Y,"^",3) ; move group name
"RTN","IBCNS1",153,0)
 ;
"RTN","IBCNS1",154,0)
ZNDQ Q X
"RTN","IBCNS1",155,0)
 ;
"RTN","IBCNS1",156,0)
INDEM(X) ; -- is this an indemnity plan
"RTN","IBCNS1",157,0)
 ; -- input zeroth node if insurance type field
"RTN","IBCNS1",158,0)
 N IBINDEM,IBCTP
"RTN","IBCNS1",159,0)
 S IBINDEM=1
"RTN","IBCNS1",160,0)
 I $P($G(^DIC(36,+X,0)),"^",13)=15 G INDEMQ ; company is indemnity co.
"RTN","IBCNS1",161,0)
 S IBCTP=$P($G(^IBA(355.3,+$P(X,"^",18),0)),"^",9)
"RTN","IBCNS1",162,0)
 I IBCTP,$P($G(^IBE(355.1,+IBCTP,0)),"^",3)=9 G INDEMQ ; plan is an indemnity plan
"RTN","IBCNS1",163,0)
 S IBINDEM=0
"RTN","IBCNS1",164,0)
INDEMQ Q IBINDEM
"RTN","IBCNS1",165,0)
 ;
"RTN","IBCNS1",166,0)
 ;
"RTN","IBCNS1",167,0)
INSTYP(DFN,DATE) ; -- return type of insurance policy for patient
"RTN","IBCNS1",168,0)
 ;
"RTN","IBCNS1",169,0)
 ; -- input    dfn := pointer to patient file (required)
"RTN","IBCNS1",170,0)
 ;            date := date of insurance (optional, default = today)
"RTN","IBCNS1",171,0)
 ;
"RTN","IBCNS1",172,0)
 ; -- output   Major Category of type of Plan (file 355.1, field .03)
"RTN","IBCNS1",173,0)
 ;             for policy which would be billed first (cob)
"RTN","IBCNS1",174,0)
 ;               null     no insurance found
"RTN","IBCNS1",175,0)
 ;               1        MAJOR MEDICAL (default)
"RTN","IBCNS1",176,0)
 ;               2        DENTAL
"RTN","IBCNS1",177,0)
 ;               3        HMO
"RTN","IBCNS1",178,0)
 ;               4        PPO
"RTN","IBCNS1",179,0)
 ;               5        MEDICARE
"RTN","IBCNS1",180,0)
 ;               6        MEDICAID
"RTN","IBCNS1",181,0)
 ;               7        TRICARE
"RTN","IBCNS1",182,0)
 ;               8        WORKMANS COMP
"RTN","IBCNS1",183,0)
 ;               9        INDEMNITY
"RTN","IBCNS1",184,0)
 ;              10        PRESCRIPTION
"RTN","IBCNS1",185,0)
 ;              11        MEDICARE SUPPLEMENTAL
"RTN","IBCNS1",186,0)
 ;              12        ALL OTHER
"RTN","IBCNS1",187,0)
 ;
"RTN","IBCNS1",188,0)
 N TYPE,POL,IBCPOL
"RTN","IBCNS1",189,0)
 S TYPE=""
"RTN","IBCNS1",190,0)
 I '$G(DFN) G INSTYPQ
"RTN","IBCNS1",191,0)
 I '$G(DATE) S DATE=DT
"RTN","IBCNS1",192,0)
 D ALL(DFN,"POL",3,DATE)
"RTN","IBCNS1",193,0)
 I $G(POL(0))<1 G INSTYPQ
"RTN","IBCNS1",194,0)
 I $G(POL(0))=1 S IBCPOL=+$O(POL(0))
"RTN","IBCNS1",195,0)
 I $G(POL(0))>1 S IBCPOL=$$COB(.POL)
"RTN","IBCNS1",196,0)
 ;
"RTN","IBCNS1",197,0)
 I IBCPOL S TYPE=$P($G(^IBE(355.1,+$P($G(POL(IBCPOL,355.3)),"^",9),0)),"^",3)
"RTN","IBCNS1",198,0)
 I TYPE="" S TYPE=1 ;default is major medical
"RTN","IBCNS1",199,0)
 ;
"RTN","IBCNS1",200,0)
INSTYPQ Q TYPE
"RTN","IBCNS1",201,0)
 ;
"RTN","IBCNS1",202,0)
COB(POL) ; -- find policy with high coordination of benefits
"RTN","IBCNS1",203,0)
 N I,X,IBC,COB,WHO,IBCOB
"RTN","IBCNS1",204,0)
 ;
"RTN","IBCNS1",205,0)
 S IBC=""
"RTN","IBCNS1",206,0)
 S I=0 F  S I=$O(POL(I)) Q:'I  D
"RTN","IBCNS1",207,0)
 .S WHO=$P($G(POL(I,0)),"^",6),COB=$P($G(POL(I,0)),"^",20)
"RTN","IBCNS1",208,0)
 .S X=$S(COB'="":COB,WHO="v":1,WHO="s":2,1:3)
"RTN","IBCNS1",209,0)
 .I 'IBC S IBC=I,IBCOB=X Q
"RTN","IBCNS1",210,0)
 .I X<IBCOB S IBC=I,IBCOB=X
"RTN","IBCNS1",211,0)
 Q IBC
"RTN","IBCNSBL2")
0^8^B28176933
"RTN","IBCNSBL2",1,0)
IBCNSBL2 ;ALB/CPM - 'BILL NEXT PAYOR' BULLETIN ; 08-AUG-96
"RTN","IBCNSBL2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,153,240**;21-MAR-94
"RTN","IBCNSBL2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSBL2",4,0)
 ;
"RTN","IBCNSBL2",5,0)
EOB(IBIFN,IBORIG,IBPYMT,IBTXT) ; determine if there may be another payer for this claim that should be billed
"RTN","IBCNSBL2",6,0)
 ; in general the EOB of the current bill is required to be sent with the next TP bill in the series
"RTN","IBCNSBL2",7,0)
 ; if there is another Third Party Payer then returns true, if any other payer (including patient) then set array
"RTN","IBCNSBL2",8,0)
 ;
"RTN","IBCNSBL2",9,0)
 ;   Input:    IBIFN  --  Pointer to AR (file #430), or Claim (file #399)
"RTN","IBCNSBL2",10,0)
 ;            IBORIG  --  Original amount of the claim
"RTN","IBCNSBL2",11,0)
 ;            IBPYMT  --  Total Amount paid on the claim
"RTN","IBCNSBL2",12,0)
 ;
"RTN","IBCNSBL2",13,0)
 ;  Output:    IBTXT  -- Array, pass by reference, if needed
"RTN","IBCNSBL2",14,0)
 ;                       If a another payer (third party or patient) for the claim can be found, 
"RTN","IBCNSBL2",15,0)
 ;                       this array will contain the text that explains who the next payer is
"RTN","IBCNSBL2",16,0)
 ;
"RTN","IBCNSBL2",17,0)
 ; Returns:     0     -- no need to forward EOB (no next Third Party payer found or payment=>amount due)
"RTN","IBCNSBL2",18,0)
 ;           'true^Next payer' --  if the EOB of the bill needs to be forwarded for inclusion in the next bill,
"RTN","IBCNSBL2",19,0)
 ;                                 generally there must be another payer for the bill that is
"RTN","IBCNSBL2",20,0)
 ;                                 third party, non-patient, and payment was not the amount due
"RTN","IBCNSBL2",21,0)
 ;
"RTN","IBCNSBL2",22,0)
 N X,IB,IBPOL,IBCS,IBARCAT,IBSEC,IBRETURN,IBSEQ,IBINS S IBRETURN=0
"RTN","IBCNSBL2",23,0)
 I '$G(IBIFN) G EOBQ
"RTN","IBCNSBL2",24,0)
 I $G(^PRCA(430,IBIFN,0))="" G EOBQ
"RTN","IBCNSBL2",25,0)
 I '$G(IBORIG) G EOBQ
"RTN","IBCNSBL2",26,0)
 I $G(IBPYMT)="" G EOBQ
"RTN","IBCNSBL2",27,0)
 ;
"RTN","IBCNSBL2",28,0)
 S IB=$G(^DGCR(399,IBIFN,0)) I IB="" G EOBQ
"RTN","IBCNSBL2",29,0)
 ;
"RTN","IBCNSBL2",30,0)
 ; - quit if there is no remaining balance on the bill
"RTN","IBCNSBL2",31,0)
 I IBPYMT'<IBORIG G EOBQ
"RTN","IBCNSBL2",32,0)
 ;
"RTN","IBCNSBL2",33,0)
 S IBARCAT=$P($G(^DGCR(399.3,+$P(IB,"^",7),0)),"^",6) I 'IBARCAT G EOBQ
"RTN","IBCNSBL2",34,0)
 ;
"RTN","IBCNSBL2",35,0)
 ; - for Champva third party claims, bill the Champva Center next
"RTN","IBCNSBL2",36,0)
 I IBARCAT=28 D  G EOBQ
"RTN","IBCNSBL2",37,0)
 . S IBTXT(14)="You should prepare a claim to be sent to the CHAMPVA Center.",IBRETURN="1^CHAMPVA Center"
"RTN","IBCNSBL2",38,0)
 ;
"RTN","IBCNSBL2",39,0)
 ; - for Tricare third party claims, next bill Tricare or the patient
"RTN","IBCNSBL2",40,0)
 I IBARCAT=32 D  G EOBQ
"RTN","IBCNSBL2",41,0)
 . ;
"RTN","IBCNSBL2",42,0)
 . ; - third party bill went to Tricare Supplemental carrier, bill patient next
"RTN","IBCNSBL2",43,0)
 . S IBSEQ=$P($G(^DGCR(399,IBIFN,0)),U,21),IBSEQ=$S(IBSEQ="P":"I1",IBSEQ="S":"I2",IBSEQ="T":"I3",1:-1)
"RTN","IBCNSBL2",44,0)
 . S IBPOL=$G(^DGCR(399,IBIFN,IBSEQ))
"RTN","IBCNSBL2",45,0)
 . S IBCS=$D(^IBE(355.1,"D","CS",+$P($G(^IBA(355.3,+$P(IBPOL,"^",18),0)),"^",9)))>0
"RTN","IBCNSBL2",46,0)
 . I IBCS D  Q
"RTN","IBCNSBL2",47,0)
 .. S IBTXT(14)="This claim was sent to the TRICARE Supplemental insurance carrier."
"RTN","IBCNSBL2",48,0)
 .. S IBTXT(15)="You should send a copayment charge to the patient."
"RTN","IBCNSBL2",49,0)
 . ;
"RTN","IBCNSBL2",50,0)
 . ; - otherwise third party bill went to patients Reimb. Ins carrier, bill the tricare FI next
"RTN","IBCNSBL2",51,0)
 . S IBRETURN="1^TRICARE Fiscal Intermediary"
"RTN","IBCNSBL2",52,0)
 . S IBTXT(14)="You should prepare a claim to send to the TRICARE Fiscal Intermediary."
"RTN","IBCNSBL2",53,0)
 ;
"RTN","IBCNSBL2",54,0)
 ; - for Tricare claims, bill the patient or Tricare supplemental policy
"RTN","IBCNSBL2",55,0)
 I IBARCAT=30 D  G EOBQ
"RTN","IBCNSBL2",56,0)
 . ;
"RTN","IBCNSBL2",57,0)
 . ; - if the patient has a Tricare supplemental policy, bill it
"RTN","IBCNSBL2",58,0)
 . I $$CHPSUP(+$P(IB,"^",2)) D  Q
"RTN","IBCNSBL2",59,0)
 .. S IBRETURN="1^TRICARE Supplemental policy"
"RTN","IBCNSBL2",60,0)
 .. S IBTXT(14)="The patient has a TRICARE Supplemental policy."
"RTN","IBCNSBL2",61,0)
 .. S IBTXT(15)="You should prepare a claim to be sent to that carrier."
"RTN","IBCNSBL2",62,0)
 . ;
"RTN","IBCNSBL2",63,0)
 . ; - otherwise, bill the patient
"RTN","IBCNSBL2",64,0)
 . S IBTXT(14)="You should send a copayment charge to the patient."
"RTN","IBCNSBL2",65,0)
 ;
"RTN","IBCNSBL2",66,0)
 ; - all other bills:  if there is a next payer in the series then a bill needs to be created for that payer
"RTN","IBCNSBL2",67,0)
 S IBSEQ=$P($G(^DGCR(399,IBIFN,0)),U,21),IBSEQ=$S(IBSEQ="P":2,IBSEQ="S":3,1:"")
"RTN","IBCNSBL2",68,0)
 I +IBSEQ S IBINS=$P($G(^DGCR(399,IBIFN,"M")),U,IBSEQ) I +IBINS D
"RTN","IBCNSBL2",69,0)
 . S IBRETURN=+IBINS_U_$P($G(^DIC(36,+IBINS,0)),U,1)
"RTN","IBCNSBL2",70,0)
 . S IBTXT(14)="There is a "_$S(IBSEQ=2:"secondary",1:"tertiary")_" payor associated with this claim."
"RTN","IBCNSBL2",71,0)
 . S IBTXT(15)="You may need to prepare a claim to be sent to "_$P(IBRETURN,U,2)_"."
"RTN","IBCNSBL2",72,0)
 ;
"RTN","IBCNSBL2",73,0)
EOBQ Q IBRETURN
"RTN","IBCNSBL2",74,0)
 ;
"RTN","IBCNSBL2",75,0)
BULL(IBIFN,IBORIG,IBPYMT) ; Generate bulletin detailing next payer for a claim, if any
"RTN","IBCNSBL2",76,0)
 ;
"RTN","IBCNSBL2",77,0)
 ;   Input:    IBIFN  --  Pointer to AR (file #430), or Claim (file #399)
"RTN","IBCNSBL2",78,0)
 ;            IBORIG  --  Original amount of the claim
"RTN","IBCNSBL2",79,0)
 ;            IBPYMT  --  Total Amount paid on the claim
"RTN","IBCNSBL2",80,0)
 ;
"RTN","IBCNSBL2",81,0)
 ;  Output:   Bulletin:   Mail Group MEANS TEST BILLING MAIL GROUP: IB MEANS TEST (350.9,.11)
"RTN","IBCNSBL2",82,0)
 ;                        If a secondary payor for the claim can be found, a bulletin will be sent
"RTN","IBCNSBL2",83,0)
 ;                        to the billing unit to alert them to forward the claim to that payor.
"RTN","IBCNSBL2",84,0)
 ;
"RTN","IBCNSBL2",85,0)
 N X,IB,IBX,IBTXT,IBP,IBGRP
"RTN","IBCNSBL2",86,0)
 ;
"RTN","IBCNSBL2",87,0)
 S IBX=$$EOB($G(IBIFN),$G(IBORIG),$G(IBPYMT),.IBTXT) I '$D(IBTXT) G BULLQ
"RTN","IBCNSBL2",88,0)
 ;
"RTN","IBCNSBL2",89,0)
 S IB=$G(^DGCR(399,IBIFN,0)) I IB="" G BULLQ
"RTN","IBCNSBL2",90,0)
 S IBP=$$PT^IBEFUNC(+$P(IB,"^",2))
"RTN","IBCNSBL2",91,0)
 ;
"RTN","IBCNSBL2",92,0)
 ; - create remainder of bulletin
"RTN","IBCNSBL2",93,0)
 N XMDUZ,XMTEXT,XMY,XMSUB
"RTN","IBCNSBL2",94,0)
 S XMSUB="Notification of Subsequent Payor"
"RTN","IBCNSBL2",95,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBTXT("
"RTN","IBCNSBL2",96,0)
 K XMY S XMY(DUZ)=""
"RTN","IBCNSBL2",97,0)
 ;
"RTN","IBCNSBL2",98,0)
 S IBTXT(1)="A payment has been made on the following claim, which has been identified"
"RTN","IBCNSBL2",99,0)
 S IBTXT(2)="as potentially having a subsequent payor:"
"RTN","IBCNSBL2",100,0)
 S IBTXT(3)=" "
"RTN","IBCNSBL2",101,0)
 S IBTXT(4)="  Bill Number: "_$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBCNSBL2",102,0)
 S IBTXT(5)="      Patient: "_$E($P(IBP,"^"),1,30)_"   Pt. Id: "_$P(IBP,"^",2)
"RTN","IBCNSBL2",103,0)
 S IBTXT(6)="    Bill Type: "_$P($G(^DGCR(399.3,+$P(IB,"^",7),0)),"^")
"RTN","IBCNSBL2",104,0)
 S IBTXT(7)="  Orig Amount: $"_$J(IBORIG,0,2)
"RTN","IBCNSBL2",105,0)
 S IBTXT(8)="  Amount Paid: $"_$J(IBPYMT,0,2)
"RTN","IBCNSBL2",106,0)
 S IBTXT(9)=" "
"RTN","IBCNSBL2",107,0)
 ;
"RTN","IBCNSBL2",108,0)
 S IBX=$G(^DGCR(399,IBIFN,0))
"RTN","IBCNSBL2",109,0)
 S IBTXT(10)="Bill Sequence: "_$$EXSET^IBEFUNC($P(IBX,U,21),399,.21)
"RTN","IBCNSBL2",110,0)
 S IBTXT(11)="   Bill Payer: "_$E($P($G(^DIC(36,+$G(^DGCR(399,IBIFN,"MP")),0)),U,1),1,20)
"RTN","IBCNSBL2",111,0)
 ;
"RTN","IBCNSBL2",112,0)
 S IBX=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCNSBL2",113,0)
 I IBX S IBTXT(10)=IBTXT(10)_$J("",(40-$L(IBTXT(10))))_"  Primary Carrier: "_$E($P($G(^DIC(36,+IBX,0)),U,1),1,20)
"RTN","IBCNSBL2",114,0)
 I +$P(IBX,U,2) S IBTXT(11)=IBTXT(11)_$J("",(40-$L(IBTXT(11))))_"Secondary Carrier: "_$E($P($G(^DIC(36,+$P(IBX,U,2),0)),U,1),1,20)
"RTN","IBCNSBL2",115,0)
 I +$P(IBX,U,3) S IBTXT(12)=$J("",40)_" Tertiary Carrier: "_$E($P($G(^DIC(36,+$P(IBX,U,3),0)),U,1),1,20)
"RTN","IBCNSBL2",116,0)
 S IBTXT(13)=" "
"RTN","IBCNSBL2",117,0)
 ;
"RTN","IBCNSBL2",118,0)
 ; - send to the Means Test billing mailgroup (for now)
"RTN","IBCNSBL2",119,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,0)),"^",11),0)),"^")
"RTN","IBCNSBL2",120,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBCNSBL2",121,0)
 ;
"RTN","IBCNSBL2",122,0)
 D ^XMD
"RTN","IBCNSBL2",123,0)
 ;
"RTN","IBCNSBL2",124,0)
BULLQ Q
"RTN","IBCNSBL2",125,0)
 ;
"RTN","IBCNSBL2",126,0)
 ;
"RTN","IBCNSBL2",127,0)
CHPSUP(DFN) ; Does the patient have a TRICARE Supplemental policy?
"RTN","IBCNSBL2",128,0)
 ;  Input:   DFN  --  Pointer to the patient in file #2
"RTN","IBCNSBL2",129,0)
 ; Output:   0 - Has no TRICARE Supplemental policy
"RTN","IBCNSBL2",130,0)
 ;           1 - Yes, patient has such a policy.
"RTN","IBCNSBL2",131,0)
 ;
"RTN","IBCNSBL2",132,0)
 N X,IBINS,IBCS
"RTN","IBCNSBL2",133,0)
 D ALL^IBCNS1(DFN,"IBINS",1,DT)
"RTN","IBCNSBL2",134,0)
 S (IBCS,X)=0 F  S X=$O(IBINS(X)) Q:'X  D  Q:IBCS
"RTN","IBCNSBL2",135,0)
 .I $D(^IBE(355.1,"D","CS",+$P($G(IBINS(X,355.3)),"^",9))) S IBCS=1
"RTN","IBCNSBL2",136,0)
 Q IBCS
"RTN","IBCNSMR")
0^9^B56951877
"RTN","IBCNSMR",1,0)
IBCNSMR ;ALB/AAS - MEDICARE BILLS ; 02-SEPT-97
"RTN","IBCNSMR",2,0)
 ;;2.0;INTEGRATED BILLING;**92,240**;21-MAR-94
"RTN","IBCNSMR",3,0)
 ;
"RTN","IBCNSMR",4,0)
% G RPRT^IBCNSMRA
"RTN","IBCNSMR",5,0)
 ;
"RTN","IBCNSMR",6,0)
DQ ; -- entry point from task manager
"RTN","IBCNSMR",7,0)
 N I,J,X,Y,IBINSCO,INSCO,NODE,CNT,IBI,IBINSNM,IBNM
"RTN","IBCNSMR",8,0)
 S IBQUIT=0
"RTN","IBCNSMR",9,0)
 K ^TMP("IB-MRA",$J),^TMP("IB-MRA-CNT",$J)
"RTN","IBCNSMR",10,0)
 ;
"RTN","IBCNSMR",11,0)
 S I=0
"RTN","IBCNSMR",12,0)
 F  S I=$O(^IBE(350.9,1,99,I)) Q:'I  S INSCO(+$G(^IBE(350.9,1,99,I,0)))=""
"RTN","IBCNSMR",13,0)
 ;
"RTN","IBCNSMR",14,0)
 S IBI=0
"RTN","IBCNSMR",15,0)
 F  S IBI=$O(^DGCR(399,IBI)) Q:'IBI!(IBQUIT)  D
"RTN","IBCNSMR",16,0)
 .S IBQUIT=$$STOP Q:IBQUIT
"RTN","IBCNSMR",17,0)
 .S IBINSCO="" K NODE
"RTN","IBCNSMR",18,0)
 .S NODE(0)=$G(^DGCR(399,IBI,0)) Q:NODE(0)=""
"RTN","IBCNSMR",19,0)
 .S NODE("C")=$G(^DGCR(399,IBI,"C"))
"RTN","IBCNSMR",20,0)
 .S NODE("M")=$G(^DGCR(399,IBI,"M")) Q:NODE("M")=""
"RTN","IBCNSMR",21,0)
 .S NODE("U")=$G(^DGCR(399,IBI,"U")) Q:NODE("U")=""
"RTN","IBCNSMR",22,0)
 .I $D(INSCO(+NODE("M"))) S IBINSCO=+NODE("M")
"RTN","IBCNSMR",23,0)
 .I 'IBINSCO,$D(INSCO(+$P(NODE("M"),"^",2))) S IBINSCO=$P(NODE("M"),"^",2)
"RTN","IBCNSMR",24,0)
 .I 'IBINSCO,$D(INSCO(+$P(NODE("M"),"^",3))) S IBINSCO=$P(NODE("M"),"^",3)
"RTN","IBCNSMR",25,0)
 .I IBINSCO S IBINSNM=$P($G(^DIC(36,IBINSCO,0)),"^") D BLDDATA
"RTN","IBCNSMR",26,0)
 ;
"RTN","IBCNSMR",27,0)
 I 'IBQUIT D PRINT^IBCNSMR0
"RTN","IBCNSMR",28,0)
 G END^IBCNSMRA
"RTN","IBCNSMR",29,0)
END Q
"RTN","IBCNSMR",30,0)
 ;
"RTN","IBCNSMR",31,0)
BLDDATA ; -- for each bill sent to a selected ins. co. build temp node
"RTN","IBCNSMR",32,0)
 N X,YEAR,TYPE,TYPENO,PROC,DIAG,ORGAMNT,BOTH,IBSTAT,DFN,ALIVE,ARSTAT,IBQUIT,RXBILL,PROSBILL,BILLNO,LOCCARE,RATETYP,RN,WHO,TIMEFRM,TOTPAID,REFGC,DATEPR
"RTN","IBCNSMR",33,0)
 S IBQUIT=0
"RTN","IBCNSMR",34,0)
 S BILLNO=$P(NODE(0),"^")
"RTN","IBCNSMR",35,0)
 S YEAR=$E(+NODE("U"),2,3)
"RTN","IBCNSMR",36,0)
 S TYPENO=$P(NODE(0),"^",5)
"RTN","IBCNSMR",37,0)
 S TYPE=$S(TYPENO<3:"INPATIENT",1:"OUTPATIENT")
"RTN","IBCNSMR",38,0)
 S PROC=$$PROC(IBI)
"RTN","IBCNSMR",39,0)
 S DIAG=$$DIAG(IBI)
"RTN","IBCNSMR",40,0)
 S IBSTAT=$P(NODE(0),"^",13)
"RTN","IBCNSMR",41,0)
 S ARSTAT=$$STA^PRCAFN(IBI)
"RTN","IBCNSMR",42,0)
 S DFN=$P(NODE(0),"^",2)
"RTN","IBCNSMR",43,0)
 S ALIVE=$S(+$G(^DPT(DFN,.35)):"DEAD",1:"ALIVE")
"RTN","IBCNSMR",44,0)
 S ORGAMNT=$$ORI^PRCAFN(IBI)
"RTN","IBCNSMR",45,0)
 S LOCCARE=$P(NODE(0),"^",4)
"RTN","IBCNSMR",46,0)
 S WHO=$P(NODE(0),"^",11)
"RTN","IBCNSMR",47,0)
 S RATETYP=$P(NODE(0),"^",7)
"RTN","IBCNSMR",48,0)
 S RN=$P($G(^DGCR(399.3,+RATETYP,0)),"^")
"RTN","IBCNSMR",49,0)
 S TIMEFRM=$P(NODE(0),"^",6)
"RTN","IBCNSMR",50,0)
 S TOTPAID=$$TPR^PRCAFN(IBI)
"RTN","IBCNSMR",51,0)
 S REFGC=$P($G(^PRCA(430,IBI,6)),"^",4)'=""
"RTN","IBCNSMR",52,0)
 S DATEPR=$P($G(^DGCR(399,IBI,"S")),"^",12)
"RTN","IBCNSMR",53,0)
 S BOTH="NONE"
"RTN","IBCNSMR",54,0)
 S RXBILL=0
"RTN","IBCNSMR",55,0)
 S PROSBILL=0
"RTN","IBCNSMR",56,0)
 I $O(^IBA(362.4,"AIFN"_IBI,"")) S RXBILL=1
"RTN","IBCNSMR",57,0)
 I $O(^IBA(362.5,"AIFN"_IBI,"")) S PROSBILL=1
"RTN","IBCNSMR",58,0)
 D COUNT
"RTN","IBCNSMR",59,0)
 D:'IBQUIT SET
"RTN","IBCNSMR",60,0)
 Q
"RTN","IBCNSMR",61,0)
 ;
"RTN","IBCNSMR",62,0)
COUNT ; -- set totals for all ins, and by ins co.
"RTN","IBCNSMR",63,0)
 S CNT=$G(CNT)+1
"RTN","IBCNSMR",64,0)
 S CNT(0)=$G(CNT(0))+ORGAMNT
"RTN","IBCNSMR",65,0)
 S CNT(3,IBINSNM)=$G(CNT(3,IBINSNM))+1
"RTN","IBCNSMR",66,0)
 S CNT(3,IBINSNM,0)=$G(CNT(3,IBINSNM,0))+ORGAMNT
"RTN","IBCNSMR",67,0)
 I TYPE="INPATIENT" D
"RTN","IBCNSMR",68,0)
 .S CNT("IN")=$G(CNT("IN"))+1
"RTN","IBCNSMR",69,0)
 .S CNT("IN",0)=$G(CNT("IN",0))+ORGAMNT
"RTN","IBCNSMR",70,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",71,0)
 ..S CNT("IN",1)=$G(CNT("IN",1))+1
"RTN","IBCNSMR",72,0)
 ..S CNT("IN",2)=$G(CNT("IN",2))+TOTPAID
"RTN","IBCNSMR",73,0)
 I TYPE="OUTPATIENT" D
"RTN","IBCNSMR",74,0)
 .S CNT("OP")=$G(CNT("OP"))+1
"RTN","IBCNSMR",75,0)
 .S CNT("OP",0)=$G(CNT("OP",0))+ORGAMNT
"RTN","IBCNSMR",76,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",77,0)
 ..S CNT("OP",1)=$G(CNT("OP",1))+1
"RTN","IBCNSMR",78,0)
 ..S CNT("OP",2)=$G(CNT("OP",2))+TOTPAID
"RTN","IBCNSMR",79,0)
 I TOTPAID>0 D
"RTN","IBCNSMR",80,0)
 .S CNT(1)=$G(CNT(1))+1
"RTN","IBCNSMR",81,0)
 .S CNT(2)=$G(CNT(2))+TOTPAID
"RTN","IBCNSMR",82,0)
 .S CNT(3,IBINSNM,1)=$G(CNT(3,IBINSNM,1))+1
"RTN","IBCNSMR",83,0)
 .S CNT(3,IBINSNM,2)=$G(CNT(3,IBINSNM,2))+TOTPAID
"RTN","IBCNSMR",84,0)
 ;
"RTN","IBCNSMR",85,0)
 ;I ALIVE'="ALIVE" D  ; decided to keep dead patients in the report 10/28/97
"RTN","IBCNSMR",86,0)
 ;.S CNT("A")=$G(CNT("A"))+1
"RTN","IBCNSMR",87,0)
 ;.S CNT("A",0)=$G(CNT("A",0))+ORGAMNT
"RTN","IBCNSMR",88,0)
 ;.;S IBQUIT=1
"RTN","IBCNSMR",89,0)
 ;.I TOTPAID>0 D
"RTN","IBCNSMR",90,0)
 ;..S CNT("A",1)=$G(CNT("A",1))+1
"RTN","IBCNSMR",91,0)
 ;..S CNT("A",2)=$G(CNT("A",2))+TOTPAID
"RTN","IBCNSMR",92,0)
 ;
"RTN","IBCNSMR",93,0)
 I DIAG="YES"&(PROC="NO") D
"RTN","IBCNSMR",94,0)
 .S BOTH="DIAG"
"RTN","IBCNSMR",95,0)
 .S IBQUIT=1
"RTN","IBCNSMR",96,0)
 .S CNT("D")=$G(CNT("D"))+1
"RTN","IBCNSMR",97,0)
 .S CNT("D",0)=$G(CNT("D",0))+ORGAMNT
"RTN","IBCNSMR",98,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",99,0)
 ..S CNT("D",1)=$G(CNT("D",1))+1
"RTN","IBCNSMR",100,0)
 ..S CNT("D",2)=$G(CNT("D",2))+TOTPAID
"RTN","IBCNSMR",101,0)
 ;
"RTN","IBCNSMR",102,0)
 I PROC="YES"&(DIAG="NO") D
"RTN","IBCNSMR",103,0)
 .S BOTH="PROC"
"RTN","IBCNSMR",104,0)
 .S IBQUIT=1
"RTN","IBCNSMR",105,0)
 .S CNT("P")=$G(CNT("P"))+1
"RTN","IBCNSMR",106,0)
 .S CNT("P",0)=$G(CNT("P",0))+ORGAMNT
"RTN","IBCNSMR",107,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",108,0)
 ..S CNT("P",1)=$G(CNT("P",1))+1
"RTN","IBCNSMR",109,0)
 ..S CNT("P",2)=$G(CNT("P",2))+TOTPAID
"RTN","IBCNSMR",110,0)
 ;
"RTN","IBCNSMR",111,0)
 I PROC="YES"&(DIAG="YES") D
"RTN","IBCNSMR",112,0)
 .S BOTH="BOTH"
"RTN","IBCNSMR",113,0)
 .S CNT("B")=$G(CNT("B"))+1
"RTN","IBCNSMR",114,0)
 .S CNT("B",0)=$G(CNT("B",0))+ORGAMNT
"RTN","IBCNSMR",115,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",116,0)
 ..S CNT("B",1)=$G(CNT("B",1))+1
"RTN","IBCNSMR",117,0)
 ..S CNT("B",2)=$G(CNT("B",2))+TOTPAID
"RTN","IBCNSMR",118,0)
 ;
"RTN","IBCNSMR",119,0)
 I BOTH="NONE" D
"RTN","IBCNSMR",120,0)
 .S CNT("N")=$G(CNT("N"))+1
"RTN","IBCNSMR",121,0)
 .S CNT("N",0)=$G(CNT("N",0))+ORGAMNT
"RTN","IBCNSMR",122,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",123,0)
 ..S CNT("N",1)=$G(CNT("N",1))+1
"RTN","IBCNSMR",124,0)
 ..S CNT("N",2)=$G(CNT("N",2))+TOTPAID
"RTN","IBCNSMR",125,0)
 ;
"RTN","IBCNSMR",126,0)
 I BOTH'="BOTH" S IBQUIT=1
"RTN","IBCNSMR",127,0)
 ;
"RTN","IBCNSMR",128,0)
 I IBSTAT=7,+ARSTAT=210 D  ;bill canceled before completion
"RTN","IBCNSMR",129,0)
 .S CNT("C")=$G(CNT("C"))+1
"RTN","IBCNSMR",130,0)
 .S CNT("C",0)=$G(CNT("C",0))+ORGAMNT
"RTN","IBCNSMR",131,0)
 .S IBQUIT=1
"RTN","IBCNSMR",132,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",133,0)
 ..S CNT("C",1)=$G(CNT("C",1))+1
"RTN","IBCNSMR",134,0)
 ..S CNT("C",2)=$G(CNT("C",2))+TOTPAID
"RTN","IBCNSMR",135,0)
 ;
"RTN","IBCNSMR",136,0)
 I TYPENO=2!(TYPENO=4) D
"RTN","IBCNSMR",137,0)
 .S CNT("T")=$G(CNT("T"))+1
"RTN","IBCNSMR",138,0)
 .S CNT("T",0)=$G(CNT("T",0))+ORGAMNT
"RTN","IBCNSMR",139,0)
 .S IBQUIT=1
"RTN","IBCNSMR",140,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",141,0)
 ..S CNT("T",1)=$G(CNT("T",1))+1
"RTN","IBCNSMR",142,0)
 ..S CNT("T",2)=$G(CNT("T",2))+TOTPAID
"RTN","IBCNSMR",143,0)
 ;
"RTN","IBCNSMR",144,0)
 I WHO'="i" D
"RTN","IBCNSMR",145,0)
 .S CNT("W")=$G(CNT("W"))+1
"RTN","IBCNSMR",146,0)
 .S CNT("W",0)=$G(CNT("W",0))+ORGAMNT
"RTN","IBCNSMR",147,0)
 .S IBQUIT=1
"RTN","IBCNSMR",148,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",149,0)
 ..S CNT("W",1)=$G(CNT("W",1))+1
"RTN","IBCNSMR",150,0)
 ..S CNT("W",2)=$G(CNT("W",2))+TOTPAID
"RTN","IBCNSMR",151,0)
 ;
"RTN","IBCNSMR",152,0)
 I DATEPR="",IBSTAT<3 D
"RTN","IBCNSMR",153,0)
 .S CNT("F")=$G(CNT("F"))+1
"RTN","IBCNSMR",154,0)
 .S CNT("F",0)=$G(CNT("F",0))+ORGAMNT
"RTN","IBCNSMR",155,0)
 .S IBQUIT=1
"RTN","IBCNSMR",156,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",157,0)
 ..S CNT("F",1)=$G(CNT("F",1))+1
"RTN","IBCNSMR",158,0)
 ..S CNT("F",2)=$G(CNT("F",2))+TOTPAID
"RTN","IBCNSMR",159,0)
 ;
"RTN","IBCNSMR",160,0)
 I $G(RXBILL) D
"RTN","IBCNSMR",161,0)
 .S CNT("X")=$G(CNT("X"))+1
"RTN","IBCNSMR",162,0)
 .S CNT("X",0)=$G(CNT("X",0))+ORGAMNT
"RTN","IBCNSMR",163,0)
 .S IBQUIT=1
"RTN","IBCNSMR",164,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",165,0)
 ..S CNT("X",1)=$G(CNT("X",1))+1
"RTN","IBCNSMR",166,0)
 ..S CNT("X",2)=$G(CNT("X",2))+TOTPAID
"RTN","IBCNSMR",167,0)
 ;
"RTN","IBCNSMR",168,0)
 I $G(PROSBILL) D
"RTN","IBCNSMR",169,0)
 .S CNT("Z")=$G(CNT("Z"))+1
"RTN","IBCNSMR",170,0)
 .S CNT("Z",0)=$G(CNT("Z",0))+ORGAMNT
"RTN","IBCNSMR",171,0)
 .S IBQUIT=1
"RTN","IBCNSMR",172,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",173,0)
 ..S CNT("Z",1)=$G(CNT("Z",1))+1
"RTN","IBCNSMR",174,0)
 ..S CNT("Z",2)=$G(CNT("Z",2))+TOTPAID
"RTN","IBCNSMR",175,0)
 ;
"RTN","IBCNSMR",176,0)
 I $S(RN["MEANS":1,RN["DENTAL":1,RN["TORT":1,RN["TRICARE":1,RN["CHAMPVA":1,RN["MEDICARE":1,RN["WORKERS":1,RN["CRIME":1,RN["SHARING":1,1:0) D
"RTN","IBCNSMR",177,0)
 .S CNT("R")=$G(CNT("R"))+1
"RTN","IBCNSMR",178,0)
 .S CNT("R",0)=$G(CNT("R",0))+ORGAMNT
"RTN","IBCNSMR",179,0)
 .S IBQUIT=1
"RTN","IBCNSMR",180,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",181,0)
 ..S CNT("R",1)=$G(CNT("R",1))+1
"RTN","IBCNSMR",182,0)
 ..S CNT("R",2)=$G(CNT("R",2))+TOTPAID
"RTN","IBCNSMR",183,0)
 Q
"RTN","IBCNSMR",184,0)
 ;
"RTN","IBCNSMR",185,0)
PROC(IBI) ; -- does bill have any procedures
"RTN","IBCNSMR",186,0)
 N PROC
"RTN","IBCNSMR",187,0)
 S PROC="NO"
"RTN","IBCNSMR",188,0)
 I $O(^DGCR(399,IBI,"CP",0)) S PROC="YES"
"RTN","IBCNSMR",189,0)
 I +NODE("C")!($P(NODE("C"),"^",4))!($P(NODE("C"),"^",7)) S PROC="YES"
"RTN","IBCNSMR",190,0)
 Q PROC
"RTN","IBCNSMR",191,0)
 ;
"RTN","IBCNSMR",192,0)
DIAG(IBI) ; -- does bill have any diagnosis
"RTN","IBCNSMR",193,0)
 N DIAG
"RTN","IBCNSMR",194,0)
 S DIAG="NO"
"RTN","IBCNSMR",195,0)
 I $O(^IBA(362.3,"AIFN"_IBI,0)) S DIAG="YES"
"RTN","IBCNSMR",196,0)
 I $P(NODE("C"),"^",10)!($P(NODE("C"),"^",14)) S DIAG="YES"
"RTN","IBCNSMR",197,0)
 Q DIAG
"RTN","IBCNSMR",198,0)
 ;
"RTN","IBCNSMR",199,0)
SET ; -- set up tmp global
"RTN","IBCNSMR",200,0)
 S CNT("M")=$G(CNT("M"))+1,CNT("M",0)=$G(CNT("M",0))+ORGAMNT
"RTN","IBCNSMR",201,0)
 I REFGC D
"RTN","IBCNSMR",202,0)
 .S CNT("M",4)=$G(CNT("M",4))+1
"RTN","IBCNSMR",203,0)
 .S CNT("M",5)=$G(CNT("M",5))+ORGAMNT
"RTN","IBCNSMR",204,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",205,0)
 ..S CNT("M",6)=$G(CNT("M",6))+1
"RTN","IBCNSMR",206,0)
 ..S CNT("M",7)=$G(CNT("M",7))+TOTPAID
"RTN","IBCNSMR",207,0)
 I TOTPAID>0 D
"RTN","IBCNSMR",208,0)
 .S CNT("M",1)=$G(CNT("M",1))+1
"RTN","IBCNSMR",209,0)
 .S CNT("M",2)=$G(CNT("M",2))+TOTPAID
"RTN","IBCNSMR",210,0)
 I TYPE="INPATIENT" D
"RTN","IBCNSMR",211,0)
 .S CNT("M","IN")=$G(CNT("M","IN"))+1
"RTN","IBCNSMR",212,0)
 .S CNT("M","IN",0)=$G(CNT("M","IN",0))+ORGAMNT
"RTN","IBCNSMR",213,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",214,0)
 ..S CNT("M","IN",1)=$G(CNT("M","IN",1))+1
"RTN","IBCNSMR",215,0)
 ..S CNT("M","IN",2)=$G(CNT("M","IN",2))+TOTPAID
"RTN","IBCNSMR",216,0)
 I TYPE="OUTPATIENT" D
"RTN","IBCNSMR",217,0)
 .S CNT("M","OP")=$G(CNT("M","OP"))+1
"RTN","IBCNSMR",218,0)
 .S CNT("M","OP",0)=$G(CNT("M","OP",0))+ORGAMNT
"RTN","IBCNSMR",219,0)
 .I TOTPAID>0 D
"RTN","IBCNSMR",220,0)
 ..S CNT("M","OP",1)=$G(CNT("M","OP",1))+1
"RTN","IBCNSMR",221,0)
 ..S CNT("M","OP",2)=$G(CNT("M","OP",2))+TOTPAID
"RTN","IBCNSMR",222,0)
 ;
"RTN","IBCNSMR",223,0)
 S ^TMP("IB-MRA",$J,+$G(IBINSCO),+$G(YEAR),$G(TYPE,"UNKNOWN"),BOTH,$G(ARSTAT,"UNKNOWN"),+$G(IBSTAT),IBI)=BILLNO_"^"_DFN
"RTN","IBCNSMR",224,0)
 ;
"RTN","IBCNSMR",225,0)
 S ^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT)=(+$G(^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT))+1)
"RTN","IBCNSMR",226,0)
 ;
"RTN","IBCNSMR",227,0)
 S ^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,0)=+$G(^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,0))+ORGAMNT
"RTN","IBCNSMR",228,0)
 ;
"RTN","IBCNSMR",229,0)
 I TOTPAID>0 D
"RTN","IBCNSMR",230,0)
 .S ^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,1)=+$G(^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,1))+1
"RTN","IBCNSMR",231,0)
 .S ^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,2)=+$G(^TMP("IB-MRA-CNT",$J,IBINSCO,YEAR,TYPE,BOTH,ARSTAT,IBSTAT,2))+TOTPAID
"RTN","IBCNSMR",232,0)
 Q
"RTN","IBCNSMR",233,0)
 ;
"RTN","IBCNSMR",234,0)
STOP() ; -- determine if user requested task to stop
"RTN","IBCNSMR",235,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ
"RTN","IBCNSMR",236,0)
 Q +$G(ZTSTOP)
"RTN","IBCNSU41")
0^10^B21365764
"RTN","IBCNSU41",1,0)
IBCNSU41 ;ALB/CPM - SPONSOR UTILITIES (CON'T) ; 5/9/03 1:25pm
"RTN","IBCNSU41",2,0)
 ;;2.0;INTEGRATED BILLING;**52,211,240**;21-MAR-94
"RTN","IBCNSU41",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSU41",4,0)
 ;
"RTN","IBCNSU41",5,0)
SPON(DFN) ; Add/edit sponsor/sponsor relationships for a patient.
"RTN","IBCNSU41",6,0)
 ;  Input:    DFN  --  Pointer to the patient in file #2
"RTN","IBCNSU41",7,0)
 ;
"RTN","IBCNSU41",8,0)
 I '$G(DFN) G SPONQ
"RTN","IBCNSU41",9,0)
 N IBQ S IBQ=0
"RTN","IBCNSU41",10,0)
 F  D LSP Q:IBQ
"RTN","IBCNSU41",11,0)
SPONQ Q
"RTN","IBCNSU41",12,0)
 ;
"RTN","IBCNSU41",13,0)
 ;
"RTN","IBCNSU41",14,0)
 ;
"RTN","IBCNSU41",15,0)
LSP ; Main loop to collect sponsor and relation data.
"RTN","IBCNSU41",16,0)
 S DIR(0)="FAO^3:30",DIR("A")="Select SPONSOR: " D ^DIR K DIR
"RTN","IBCNSU41",17,0)
 I $D(DIRUT)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) K DIRUT,DIROUT,DTOUT,DUOUT S IBQ=1 G LSPQ
"RTN","IBCNSU41",18,0)
 S IBX=X
"RTN","IBCNSU41",19,0)
 ;
"RTN","IBCNSU41",20,0)
 ; - perform lookup to find sponsor or add a patient sponsor
"RTN","IBCNSU41",21,0)
 S DIC(0)="ELMZ",DIC="^IBA(355.8,",DLAYGO=355.8 D ^DIC K DIC,DLAYGO
"RTN","IBCNSU41",22,0)
 I Y>0 S IBSP=+Y,IBSPD=$G(^IBA(355.8,IBSP,0)),IBNAM=Y(0,0) G LSPC
"RTN","IBCNSU41",23,0)
 I IBX'?1.A1","1.ANP W !,"New sponsors must be in the format LAST,FIRST.",! G LSP
"RTN","IBCNSU41",24,0)
 ;
"RTN","IBCNSU41",25,0)
 ; - is this a new sponsor to be added to the system?
"RTN","IBCNSU41",26,0)
 S DIR(0)="Y",DIR("A")="  Are you adding '"_IBX_"' as a new SPONSOR"
"RTN","IBCNSU41",27,0)
 D ^DIR K DIR
"RTN","IBCNSU41",28,0)
 I 'Y!$D(DIRUT)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) K DIRUT,DIROUT,DTOUT,DUOUT G LSP
"RTN","IBCNSU41",29,0)
 ;
"RTN","IBCNSU41",30,0)
 ; - add non-patient sponsor to file #355.82 (sponsor person file)
"RTN","IBCNSU41",31,0)
 S (X,IBNAM)=IBX,DIC(0)="L",DIC="^IBA(355.82,",DLAYGO=355.82
"RTN","IBCNSU41",32,0)
 D FILE^DICN S IBSPP=+Y K DLAYGO
"RTN","IBCNSU41",33,0)
 I IBSPP<0 W !,"Unable to add a new sponsor!" G LSPQ
"RTN","IBCNSU41",34,0)
 ;
"RTN","IBCNSU41",35,0)
 ; - now add to file #355.8 (sponsor file)
"RTN","IBCNSU41",36,0)
 S (IBSPD,X)=IBSPP_";IBA(355.82,",DIC(0)="L",DIC="^IBA(355.8,",DLAYGO=355.8
"RTN","IBCNSU41",37,0)
 D FILE^DICN S IBSP=+Y K DLAYGO
"RTN","IBCNSU41",38,0)
 I IBSP<0 W !,"Unable to add a new sponsor!" G LSPQ
"RTN","IBCNSU41",39,0)
 ;
"RTN","IBCNSU41",40,0)
LSPC ; - allow edit of non-patient sponsor name/dob/ssn
"RTN","IBCNSU41",41,0)
 I $P(IBSPD,"^")["IBA" D
"RTN","IBCNSU41",42,0)
 .S DIE="^IBA(355.82,",DA=+IBSPD
"RTN","IBCNSU41",43,0)
 .S DR=".01  NAME;.02  DATE OF BIRTH;.03  SOCIAL SECURITY NUMBER"
"RTN","IBCNSU41",44,0)
 .D ^DIE K DIE,DA,DR
"RTN","IBCNSU41",45,0)
 ;
"RTN","IBCNSU41",46,0)
 ; - edit remaining sponsor attributes
"RTN","IBCNSU41",47,0)
 S DIE="^IBA(355.8,",DA=IBSP
"RTN","IBCNSU41",48,0)
 S DR=".02  MILITARY STATUS;.03  BRANCH;.04  RANK"
"RTN","IBCNSU41",49,0)
 D ^DIE K DA,DR,DIE
"RTN","IBCNSU41",50,0)
 ;
"RTN","IBCNSU41",51,0)
 ; - find patient relation to sponsor, or create one
"RTN","IBCNSU41",52,0)
 S IBSPR=0 F  S IBSPR=$O(^IBA(355.81,"B",DFN,IBSPR)) Q:'IBSPR  I $P($G(^IBA(355.81,IBSPR,0)),"^",2)=IBSP Q
"RTN","IBCNSU41",53,0)
 I 'IBSPR S IBQQ=0 D  G:IBQQ LSPQ
"RTN","IBCNSU41",54,0)
 .W !!,"The person '",IBNAM,"' is not currently the sponsor of this patient."
"RTN","IBCNSU41",55,0)
 .S DIR(0)="Y",DIR("A")="Okay to add this person as the patient's sponsor"
"RTN","IBCNSU41",56,0)
 .S DIR("?")="Please enter 'YES' to add this person as the patient's sponsor, or 'NO' to select a new sponsor."
"RTN","IBCNSU41",57,0)
 .D ^DIR K DIR I 'Y W ! S IBQQ=1 Q
"RTN","IBCNSU41",58,0)
 .;
"RTN","IBCNSU41",59,0)
 .S X=DFN,DIC="^IBA(355.81,",DIC(0)="L",DIC("DR")=".02////"_IBSP,DLAYGO=355.81
"RTN","IBCNSU41",60,0)
 .D FILE^DICN S IBSPR=+Y S:Y<0 IBQQ=1 K DLAYGO
"RTN","IBCNSU41",61,0)
 ;
"RTN","IBCNSU41",62,0)
 ; - edit sponsor relation attributes
"RTN","IBCNSU41",63,0)
 S DIE="^IBA(355.81,",DA=IBSPR,DR=".03:.06" D ^DIE K DA,DIE,DR
"RTN","IBCNSU41",64,0)
 W !
"RTN","IBCNSU41",65,0)
 ;
"RTN","IBCNSU41",66,0)
LSPQ K IBSP,IBSPD,IBSPP,IBSPR,IBQQ,IBNAM,IBX,DIRUT,DIROUT,DTOUT,DUOUT,X,Y
"RTN","IBCNSU41",67,0)
 Q
"RTN","IBCNSU41",68,0)
 ;
"RTN","IBCNSU41",69,0)
 ;
"RTN","IBCNSU41",70,0)
 ;
"RTN","IBCNSU41",71,0)
POL(DFN) ; Update TRICARE policies with Sponsor information.
"RTN","IBCNSU41",72,0)
 ;  Input:   DFN  --  Pointer to the patient in file #2
"RTN","IBCNSU41",73,0)
 ;
"RTN","IBCNSU41",74,0)
 I '$G(DFN) G POLQ
"RTN","IBCNSU41",75,0)
 N IBX,IBY,SPON,X,X1,X3,Y,Z
"RTN","IBCNSU41",76,0)
 ;
"RTN","IBCNSU41",77,0)
 S X=0 F  S X=$O(^IBA(355.81,"B",DFN,X)) Q:'X  D  Q:$D(Z)
"RTN","IBCNSU41",78,0)
 .S Y=$G(^IBA(355.81,X,0))
"RTN","IBCNSU41",79,0)
 .;
"RTN","IBCNSU41",80,0)
 .; - relationship must be with a Tricare sponsor
"RTN","IBCNSU41",81,0)
 .Q:$P(Y,"^",4)'="T"
"RTN","IBCNSU41",82,0)
 .;
"RTN","IBCNSU41",83,0)
 .S SPON=$G(^IBA(355.8,+$P(Y,"^",2),0)) Q:SPON=""
"RTN","IBCNSU41",84,0)
 .;
"RTN","IBCNSU41",85,0)
 .; - if sponsor is a patient, get name/dob/SSN from the patient
"RTN","IBCNSU41",86,0)
 .;   file; otherwise, use file #355.82
"RTN","IBCNSU41",87,0)
 .I $P(SPON,"^")["DPT" D
"RTN","IBCNSU41",88,0)
 ..S X1=$G(^DPT(+SPON,0)) Q:X1=""
"RTN","IBCNSU41",89,0)
 ..S Z("NAME")=$P(X1,"^"),Z("DOB")=$P(X1,"^",3),Z("SSN")=$P(X1,"^",9)
"RTN","IBCNSU41",90,0)
 .E  D
"RTN","IBCNSU41",91,0)
 ..S X1=$G(^IBA(355.82,+SPON,0)) Q:X1=""
"RTN","IBCNSU41",92,0)
 ..S Z("NAME")=$P(X1,"^"),Z("DOB")=$P(X1,"^",2),Z("SSN")=$TR($P(X1,"^",3),"-","")
"RTN","IBCNSU41",93,0)
 .;
"RTN","IBCNSU41",94,0)
 .S Z("BRAN")=$P(SPON,"^",3),Z("RANK")=$P(SPON,"^",4)
"RTN","IBCNSU41",95,0)
 ;
"RTN","IBCNSU41",96,0)
 ; - if no Tricare sponsors were found, quit.
"RTN","IBCNSU41",97,0)
 I '$D(Z) G POLQ
"RTN","IBCNSU41",98,0)
 ;
"RTN","IBCNSU41",99,0)
 ; - update any policies with TRICARE plans
"RTN","IBCNSU41",100,0)
 S IBX=0 F  S IBX=$O(^DPT(DFN,.312,IBX)) Q:'IBX  S IBY=$G(^(IBX,0)) D
"RTN","IBCNSU41",101,0)
 .;
"RTN","IBCNSU41",102,0)
 .; - only consider TRICARE plans
"RTN","IBCNSU41",103,0)
 .Q:$P($G(^IBE(355.1,+$P($G(^IBA(355.3,+$P(IBY,"^",18),0)),"^",9),0)),"^",3)'=7
"RTN","IBCNSU41",104,0)
 .;
"RTN","IBCNSU41",105,0)
 .; - the policyholder should not be the veteran (patient)
"RTN","IBCNSU41",106,0)
 .Q:$P(IBY,"^",6)="v"
"RTN","IBCNSU41",107,0)
 .;
"RTN","IBCNSU41",108,0)
 .; - if a sponsor DOB exists, be sure it's the same as the
"RTN","IBCNSU41",109,0)
 .;   sponsor file DOB
"RTN","IBCNSU41",110,0)
 .S X3=$G(^DPT(DFN,.312,IBX,3))
"RTN","IBCNSU41",111,0)
 .I X3,+X3'=Z("DOB") Q
"RTN","IBCNSU41",112,0)
 .;
"RTN","IBCNSU41",113,0)
 .S DR=""
"RTN","IBCNSU41",114,0)
 .;IB*2*211
"RTN","IBCNSU41",115,0)
 .I $P(IBY,"^",17)="" S DR=DR_"17////"_Z("NAME")_";"
"RTN","IBCNSU41",116,0)
 .I $P(X3,"^")="",Z("DOB") S DR=DR_"3.01////"_Z("DOB")_";"
"RTN","IBCNSU41",117,0)
 .I $P(X3,"^",2)="",Z("BRAN") S DR=DR_"3.02////"_Z("BRAN")_";"
"RTN","IBCNSU41",118,0)
 .I $P(X3,"^",3)="",Z("RANK")]"" S DR=DR_"3.03////"_Z("RANK")_";"
"RTN","IBCNSU41",119,0)
 .I $P(X3,"^",5)="",Z("SSN")]"" S DR=DR_"3.05////"_Z("SSN")_";"
"RTN","IBCNSU41",120,0)
 .;
"RTN","IBCNSU41",121,0)
 .Q:DR=""
"RTN","IBCNSU41",122,0)
 .I $E(DR,$L(DR))=";" S DR=$E(DR,1,$L(DR)-1)
"RTN","IBCNSU41",123,0)
 .;
"RTN","IBCNSU41",124,0)
 .S DIE="^DPT(DFN,.312,",DA(1)=DFN,DA=IBX D ^DIE K DA,DIE,DR
"RTN","IBCNSU41",125,0)
 ;
"RTN","IBCNSU41",126,0)
POLQ Q
"RTN","IBECEA2")
0^11^B18691868
"RTN","IBECEA2",1,0)
IBECEA2 ;ALB/CPM-Cancel/Edit/Add... Edit a Charge ; 15-MAR-93
"RTN","IBECEA2",2,0)
 ;;2.0;INTEGRATED BILLING;**57,52,150,176,183,240**;21-MAR-94
"RTN","IBECEA2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEA2",4,0)
 ;
"RTN","IBECEA2",5,0)
ONE ; Edit a single charge.
"RTN","IBECEA2",6,0)
 N IBGMTR
"RTN","IBECEA2",7,0)
 S IBGMTR=0 ; GMT Related flag
"RTN","IBECEA2",8,0)
 ;
"RTN","IBECEA2",9,0)
 D HDR^IBECEAU("E D I T")
"RTN","IBECEA2",10,0)
 ;
"RTN","IBECEA2",11,0)
 ; - don't allow edit of CHAMPVA charges
"RTN","IBECEA2",12,0)
 I $P($G(^IB(IBN,1)),"^",5) W !,"Sorry!  You cannot edit the CHAMPVA inpatient subsistence charge.",!,"Please cancel this charge and add a new charge." G ONEQ
"RTN","IBECEA2",13,0)
 ;
"RTN","IBECEA2",14,0)
 ; - don't allow edit of TRICARE charges
"RTN","IBECEA2",15,0)
 I $P($G(^IBE(350.1,+$P($G(^IB(IBN,0)),"^",3),0)),"^",11)=7 W !,"Sorry!  You cannot edit TRICARE copayment charges.",!,"Please cancel this charge and add a new charge." G ONEQ
"RTN","IBECEA2",16,0)
 ;
"RTN","IBECEA2",17,0)
 ; - don't allow edit of LTC charges
"RTN","IBECEA2",18,0)
 S IBXA=$P($G(^IBE(350.1,+$P($G(^IB(IBN,0)),"^",3),0)),"^",11)
"RTN","IBECEA2",19,0)
 I IBXA>7,IBXA<10 W !,"Sorry!  You cannot edit LTC copayment charges.",!,"Please cancel this charge and add a new charge." G ONEQ
"RTN","IBECEA2",20,0)
 ;
"RTN","IBECEA2",21,0)
 ; - perform up-front edits
"RTN","IBECEA2",22,0)
 I 'IBND S IBY="-1^IB021" G ONEQ
"RTN","IBECEA2",23,0)
 S IBPARNT=+$P(IBND,"^",9) I '$D(^IB(IBPARNT,0)) S IBY="-1^IB027" G ONEQ
"RTN","IBECEA2",24,0)
 I $$LAST^IBECEAU(IBPARNT)'=IBN W !,"You can only edit the last transaction for an original charge." G ONEQ
"RTN","IBECEA2",25,0)
 S IBATYP=$G(^IBE(350.1,+$P(IBND,"^",3),0)) I IBATYP="" S IBY="-1^IB022" G ONEQ
"RTN","IBECEA2",26,0)
 S IBSEQNO=$P(IBATYP,"^",5) I 'IBSEQNO S IBY="-1^IB023" G ONEQ
"RTN","IBECEA2",27,0)
 I $P(IBATYP,"^",5)=2 W !,"You cannot edit cancellation transactions... please add a new charge." G ONEQ
"RTN","IBECEA2",28,0)
 I $P(IBND,"^",5)=10 W !,"You cannot edit charges which have been directly cancelled.",!,"Please add a new charge." G ONEQ
"RTN","IBECEA2",29,0)
 ;
"RTN","IBECEA2",30,0)
 ; - see if charge has been billed or not
"RTN","IBECEA2",31,0)
 S IBH="^1^2^8^9^99^"[("^"_+$P(IBND,"^",5)_"^"),IBXA=$P(IBATYP,"^",11)
"RTN","IBECEA2",32,0)
 S IBIL=$P(IBND,"^",11),IBUNITP=+$P(IBND,"^",6),IBCHGP=+$P(IBND,"^",7)
"RTN","IBECEA2",33,0)
 S IBATYP=+$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^",9)
"RTN","IBECEA2",34,0)
 I 'IBH D  G:IBY<0 ONEQ
"RTN","IBECEA2",35,0)
 .I 'IBUNITP W !,"This charge has been billed, but there are no units!" S IBY=-1 Q
"RTN","IBECEA2",36,0)
 .I 'IBCHGP W !,"There is no charge amount associated with this action!" S IBY=-1 Q
"RTN","IBECEA2",37,0)
 .I IBIL="" W !,"This charge has been billed, but there is no bill number!" S IBY=-1 Q
"RTN","IBECEA2",38,0)
 I IBH,$P(IBND,"^",5)'=8 W !,"*** Please Note:  This charge has not yet been passed to Accounts Receivable ***"
"RTN","IBECEA2",39,0)
 I $P(IBND,"^",5)=8 W !?17,"*** Please Note:  This charge is on hold. ***",!?9,"Editing it will cause it to be passed to Accounts Receivable."
"RTN","IBECEA2",40,0)
 ;
"RTN","IBECEA2",41,0)
 ; - ask user for the cancellation reason
"RTN","IBECEA2",42,0)
 I 'IBH,IBXA'=4 D REAS^IBECEAU2("E") G:IBCRES<0 ONEQ
"RTN","IBECEA2",43,0)
 ;
"RTN","IBECEA2",44,0)
 ; - ask user for data to be edited
"RTN","IBECEA2",45,0)
 D ^IBECEA21 G:IBY<0 ONEQ
"RTN","IBECEA2",46,0)
 ;
"RTN","IBECEA2",47,0)
 ; - okay to proceed?
"RTN","IBECEA2",48,0)
 D PROC^IBECEAU4("edit") G:IBY<0 ONEQ S IBUPD=IBND
"RTN","IBECEA2",49,0)
 ;
"RTN","IBECEA2",50,0)
 ; - cancel 354.71 transaction (copay cap)
"RTN","IBECEA2",51,0)
 S:$P(IBND,"^",19) IBAMC=$$CANCEL^IBARXMN(DFN,$P(IBND,"^",19),.IBY) G:IBY<0 ONEQ
"RTN","IBECEA2",52,0)
 ;
"RTN","IBECEA2",53,0)
 ; - build the cancellation transaction
"RTN","IBECEA2",54,0)
 D CANC^IBECEAU4(IBN,IBCRES,0) G:IBY<0 ONEQ
"RTN","IBECEA2",55,0)
 ;
"RTN","IBECEA2",56,0)
 ; - build new 354.71 transaction (copay cap)
"RTN","IBECEA2",57,0)
 I IBXA=5 W !!,"Building the new cap transaction...  " S IBAM=$$ADD^IBARXMN(DFN,"^^"_DT_"^^P^^"_IBUNIT_"^"_IBCHG_"^"_IBDESC_"^^"_IBCHG_"^0^"_IBSITE) I IBAM<0 S IBY="-1^IB316" G ONEQ
"RTN","IBECEA2",58,0)
 ;
"RTN","IBECEA2",59,0)
 ; - build the updated transaction
"RTN","IBECEA2",60,0)
 D UPD^IBECEA22 G:IBY<0 ONEQ
"RTN","IBECEA2",61,0)
 ;
"RTN","IBECEA2",62,0)
 ; - handle updating of clock
"RTN","IBECEA2",63,0)
 I "^1^2^3^"[("^"_IBXA_"^") D CLOCK^IBECEAU(IBDOLA-IBCLDOL,IBCLDAY,IBDAYA-IBCLDAY)
"RTN","IBECEA2",64,0)
 ;
"RTN","IBECEA2",65,0)
ONEQ D ERR^IBECEAU4:IBY<0,PAUSE^IBECEAU
"RTN","IBECEA2",66,0)
 K IBBS,IBCRES,IBDESC,IBIL,IBND,IBARTYP,IBSEQNO,IBTOTL,IBUNIT,IBATYP,IBIDX,IBN,IBY,IBPARNT,IBH,IBXA,IBNOS,IBRTED,IBADJMED,IBAM,IBAMC
"RTN","IBECEA2",67,0)
 K IBAFY,IBCAN,IBCHG,IBCHGP,IBCLDA,IBCLDAY,IBCLDOL,IBCLDOLO,IBCLDT,IBCLST,IBDAYA,IBDAYP,IBDOLA,IBDOLP,IBDT,IBFR,IBFRP,IBI,IBJ,IBLIM,IBMED,IBTO,IBTOP,IBTRAN,IBUNIT,IBUNITP,IBUPD
"RTN","IBECEA2",68,0)
 Q
"RTN","IBECEA3")
0^12^B61517877
"RTN","IBECEA3",1,0)
IBECEA3 ;ALB/CPM-Cancel/Edit/Add... Add a Charge;30-MAR-93
"RTN","IBECEA3",2,0)
 ;;2.0;INTEGRATED BILLING;**7,57,52,132,150,153,166,156,167,176,198,188,183,202,240**;21-MAR-94
"RTN","IBECEA3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEA3",4,0)
 ;
"RTN","IBECEA3",5,0)
ADD ; Add a Charge protocol
"RTN","IBECEA3",6,0)
 N IBGMT,IBGMTR
"RTN","IBECEA3",7,0)
 S (IBGMT,IBGMTR)=0
"RTN","IBECEA3",8,0)
 S IBCOMMIT=0,IBEXSTAT=$$RXST^IBARXEU(DFN,DT),IBCATC=$$BILST^DGMTUB(DFN),IBCVAEL=$$CVA^IBAUTL5(DFN),IBLTCST=$$LTCST^IBAECU(DFN,DT,1)
"RTN","IBECEA3",9,0)
 ;I 'IBCVAEL,'IBCATC,'$G(IBRX),+IBEXSTAT<1 W !!,"This patient has never been Means Test billable." S VALMBCK="" D PAUSE^VALM1 G ADDQ1
"RTN","IBECEA3",10,0)
 ;
"RTN","IBECEA3",11,0)
 ; - clear screen and begin
"RTN","IBECEA3",12,0)
 D CLOCK^IBAUTL3 I 'IBCLDA S (IBMED,IBCLDAY,IBCLDOL,IBCLDT)=0
"RTN","IBECEA3",13,0)
 D HDR^IBECEAU("A D D")
"RTN","IBECEA3",14,0)
 I IBY<0 D NODED^IBECEAU3 G ADDQ
"RTN","IBECEA3",15,0)
 ;
"RTN","IBECEA3",16,0)
 ; - ask for the charge type
"RTN","IBECEA3",17,0)
 D CHTYP^IBECEA33 G:IBY<0 ADDQ
"RTN","IBECEA3",18,0)
 N IBAFEE S:$P($G(^IBE(350.1,+$G(IBATYP),0)),"^",8)="FEE SERVICE/OUTPATIENT" IBAFEE=IBATYP
"RTN","IBECEA3",19,0)
 ;
"RTN","IBECEA3",20,0)
 ; - process CHAMPVA charges
"RTN","IBECEA3",21,0)
 I IBXA=6 D CHMPVA^IBECEA32 G ADDQ
"RTN","IBECEA3",22,0)
 ;
"RTN","IBECEA3",23,0)
 ; - process TRICARE charges
"RTN","IBECEA3",24,0)
 I IBXA=7 D CUS^IBECEA35 G ADDQ
"RTN","IBECEA3",25,0)
 ;
"RTN","IBECEA3",26,0)
 ; - display MT billing clock data
"RTN","IBECEA3",27,0)
 I IBXA=2,$P($G(^IBE(350.1,+IBATYP,0)),"^",8)'["NHCU",IBCLDAY>90 S IBMED=IBMED/2
"RTN","IBECEA3",28,0)
 I IBXA=1,IBCLDAY>90 D MED^IBECEA34 G:IBY<0 ADDQ
"RTN","IBECEA3",29,0)
 I "^1^2^3^"[("^"_IBXA_"^"),IBCLDA W !!,"  ** Active Billing Clock **   # Inpt Days: ",IBCLDAY,"    ",$$INPT^IBECEAU(IBCLDAY)," 90 days: $",+IBCLDOL,!
"RTN","IBECEA3",30,0)
 ;
"RTN","IBECEA3",31,0)
 ; - display LTC billing clock data
"RTN","IBECEA3",32,0)
 I IBXA>7,IBXA<10 D  G:IBCLDA<1 ADDQ
"RTN","IBECEA3",33,0)
 . N IBCLZ
"RTN","IBECEA3",34,0)
 . S IBCLDA=$O(^IBA(351.81,"AE",DFN,9999999),-1)
"RTN","IBECEA3",35,0)
 . S:IBCLDA IBCLDA=$O(^IBA(351.81,"AE",DFN,IBCLDA,0))
"RTN","IBECEA3",36,0)
 . I 'IBCLDA W !!,"  ** Patient has no LTC billing clock **" Q
"RTN","IBECEA3",37,0)
 . S IBCLZ=^IBA(351.81,IBCLDA,0)
"RTN","IBECEA3",38,0)
 . W !!,"  **Last LTC Billing Clock    Start Date: ",$$FMTE^XLFDT($P(IBCLZ,"^",3)),"  Free Days Remaining: ",+$P(IBCLZ,"^",6)
"RTN","IBECEA3",39,0)
 . I $P(IBCLZ,"^",6) W !,"The patient must use his free days first." S IBCLDA=0
"RTN","IBECEA3",40,0)
 ;
"RTN","IBECEA3",41,0)
 ; - ask units for rx copay charge
"RTN","IBECEA3",42,0)
 I IBXA=5 D UNIT^IBECEAU2(0) G ADDQ:IBY<0 D  G ADDQ:IBY<0 G PROC
"RTN","IBECEA3",43,0)
 . ;
"RTN","IBECEA3",44,0)
 . ; has patient been previously tracked for cap info
"RTN","IBECEA3",45,0)
 . D TRACK^IBARXMN(DFN)
"RTN","IBECEA3",46,0)
 . ;
"RTN","IBECEA3",47,0)
 . D CTBB^IBECEAU3
"RTN","IBECEA3",48,0)
 . ;
"RTN","IBECEA3",49,0)
 . ; check if above cap
"RTN","IBECEA3",50,0)
 . I IBY'<0 D
"RTN","IBECEA3",51,0)
 .. N IBB,IBN,DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBECEA3",52,0)
 .. D NEW^IBARXMC(1,IBCHG,DT,.IBB,.IBN) Q:'IBN
"RTN","IBECEA3",53,0)
 .. ;
"RTN","IBECEA3",54,0)
 .. ; display message ask to proceed
"RTN","IBECEA3",55,0)
 .. W !!,"This charge will put the patient > $",$J(IBN,0,2)," above their cap amount."
"RTN","IBECEA3",56,0)
 .. S DIR(0)="Y",DIR("A")="Okay to proceed" D ^DIR S:'Y IBY=-1
"RTN","IBECEA3",57,0)
 .. ;
"RTN","IBECEA3",58,0)
 S IBLIM=$S(IBXA=4!(IBXA=3):DT,1:$$FMADD^XLFDT(DT,-1))
"RTN","IBECEA3",59,0)
 ;
"RTN","IBECEA3",60,0)
FR ; - ask 'bill from' date
"RTN","IBECEA3",61,0)
 D FR^IBECEAU2(0) G:IBY<0 ADDQ
"RTN","IBECEA3",62,0)
 S IBGMT=$$ISGMTPT^IBAGMT(DFN,IBFR),IBGMTR=0 ;GMT Copayment Status
"RTN","IBECEA3",63,0)
 I IBGMT>0,IBXA>0,IBXA<4 W !,"The patient has GMT Copayment Status."
"RTN","IBECEA3",64,0)
 ; - check the MT billing clock
"RTN","IBECEA3",65,0)
 I IBXA'=8,IBXA'=9 D CLMSG^IBECEA33 G:IBY<0 ADDQ
"RTN","IBECEA3",66,0)
 ;Adjust Deductible for GMT patient
"RTN","IBECEA3",67,0)
 I IBGMT>0,IBXA>0,IBXA<4,$G(IBMED) S IBMED=$$REDUCE^IBAGMT(IBMED) W !,"Medicare Deductible reduced due to GMT Copayment Status ($",$J(IBMED,"",2),")."
"RTN","IBECEA3",68,0)
 ;
"RTN","IBECEA3",69,0)
 ; - check the LTC billing clock
"RTN","IBECEA3",70,0)
 I IBXA>7,IBXA<10 D  I IBY<0 W !!,"The patient has no LTC clock active for the date.",! G ADDQ
"RTN","IBECEA3",71,0)
 . N IBCLZ S IBCLZ=^IBA(351.81,IBCLDA,0)
"RTN","IBECEA3",72,0)
 . ;
"RTN","IBECEA3",73,0)
 . ; is this the clock and within the date range
"RTN","IBECEA3",74,0)
 . I IBFR'<$P(IBCLZ,"^",3),$$YR^IBAECU($P(IBCLZ,"^",3),IBFR) S IBY=-1 Q
"RTN","IBECEA3",75,0)
 . ;
"RTN","IBECEA3",76,0)
 . ; look for another clock that might fit the date
"RTN","IBECEA3",77,0)
 . I IBFR<$P(IBCLZ,"^",3) S IBCLDA=$O(^IBA(351.81,"AE",DFN,IBFR+1),-1) I 'IBCLDA!($$YR^IBAECU($P($G(^IBA(351.81,+IBCLDA,0)),"^",3),IBFR)) S IBY=-1
"RTN","IBECEA3",78,0)
 ;
"RTN","IBECEA3",79,0)
 ; - calculate the MT inpt copay charge
"RTN","IBECEA3",80,0)
 I IBXA=2 S IBDT=IBFR D COPAY^IBAUTL2 G ADDQ:IBY<0 S:IBGMT>0 IBGMTR=1,IBCHG=$$REDUCE^IBAGMT(IBCHG) I IBCHG+IBCLDOL<IBMED W *7,"   ($",IBCHG,"/day)" W:IBGMTR " GMT Rate"
"RTN","IBECEA3",81,0)
 ;
"RTN","IBECEA3",82,0)
 ; - find the correct clock from the 'bill from' date (ignore LTC)
"RTN","IBECEA3",83,0)
 I IBXA'=8,IBXA'=9,('IBCLDA!(IBCLDA&(IBFR<IBCLDT))) D NOCL^IBECEA33 G:IBY<0 ADDQ
"RTN","IBECEA3",84,0)
 ;
"RTN","IBECEA3",85,0)
 ; - perform outpatient edits
"RTN","IBECEA3",86,0)
 N IBSTOPDA
"RTN","IBECEA3",87,0)
 I IBXA=4 D  G ADDQ:IBY<0,PROC
"RTN","IBECEA3",88,0)
 .   ;  for visits prior to 12/6/01 or FEE
"RTN","IBECEA3",89,0)
 .   I IBFR<3011206!($G(IBAFEE)) D OPT^IBECEA33 Q
"RTN","IBECEA3",90,0)
 .   ;  for visits on or after 12/5/01
"RTN","IBECEA3",91,0)
 .   D OPT^IBEMTSCU
"RTN","IBECEA3",92,0)
 ;
"RTN","IBECEA3",93,0)
 ; - if LTC outpatient calculate the charge
"RTN","IBECEA3",94,0)
 I IBXA=8 D  G:IBY<0 ADDQ S (IBDT,IBTO,IBEVDT)=IBFR,IBDESC=$P(^IBE(350.1,IBATYP,0),"^",8),IBUNIT=1,IBEVDA="*" D COST^IBAUTL2,CALC^IBAECO,CTBB^IBECEAU3 G @$S(IBCHG:"PROC",1:"ADDQ")
"RTN","IBECEA3",95,0)
 . ;
"RTN","IBECEA3",96,0)
 . ; is this day already a free day
"RTN","IBECEA3",97,0)
 . I $D(^IBA(351.81,IBCLDA,1,"AC",IBFR)) W !!,"This day is already marked as a Free Day." S IBY=-1
"RTN","IBECEA3",98,0)
 . ;
"RTN","IBECEA3",99,0)
 . ; have we already billed for this day
"RTN","IBECEA3",100,0)
 . I $D(^IB("AFDT",DFN,-IBFR)) W !!,"This patient has already been billed for this date." S IBY=-1
"RTN","IBECEA3",101,0)
 ;
"RTN","IBECEA3",102,0)
 ; - find per diem charge and description
"RTN","IBECEA3",103,0)
 I IBXA=3 D  I 'IBCHG W !!,"Unable to determine the per diem rate.  Please check your rate table." G ADDQ
"RTN","IBECEA3",104,0)
 .N IBDT S IBDT=IBFR,IBGMTR=0 D COST^IBAUTL2
"RTN","IBECEA3",105,0)
 .I IBGMT>0 S IBGMTR=1,IBCHG=$$REDUCE^IBAGMT(IBCHG)
"RTN","IBECEA3",106,0)
 .S IBDESC="" X:$D(^IBE(350.1,IBATYP,20)) ^(20)
"RTN","IBECEA3",107,0)
 ;
"RTN","IBECEA3",108,0)
 ; - calculate charge for the inpatient copay
"RTN","IBECEA3",109,0)
 I IBXA=2,IBCHG+IBCLDOL'<IBMED S IBCHG=IBMED-IBCLDOL,IBUNIT=1,IBTO=IBFR D CTBB^IBECEAU3 G EV
"RTN","IBECEA3",110,0)
 ;
"RTN","IBECEA3",111,0)
TO ; - ask 'bill to' date
"RTN","IBECEA3",112,0)
 D TO^IBECEAU2(0) G:IBY<0 ADDQ
"RTN","IBECEA3",113,0)
 I IBXA>0,IBXA<4,IBGMT'=$$ISGMTPT^IBAGMT(DFN,IBTO) W !!,"The patient's GMT Copayment status changed within the specified period!",! G ADDQ
"RTN","IBECEA3",114,0)
 ;
"RTN","IBECEA3",115,0)
 ; - calculate unit charge for LTC inpatient in IBCHG
"RTN","IBECEA3",116,0)
 I IBXA=9 S IBDT=IBFR,IBEVDA=$$EVF^IBECEA31(DFN,IBFR,IBTO,IBNH),IBEVDT=$E(IBFR,1,5)_"01" D:IBEVDA<1  G ADDQ:IBY<0 D COST^IBAUTL2 I $E(IBFR,1,5)'=$E(IBTO,1,5) W !!,"  LTC Copayment charges cannot go from one month to another." G ADDQ
"RTN","IBECEA3",117,0)
 . D NOEV^IBECEA31 I '$G(IBDG)!(IBY<0) S IBY=-1 Q
"RTN","IBECEA3",118,0)
 . ; - build the event record
"RTN","IBECEA3",119,0)
 . N IBNHLTC S IBNHLTC=1 D ADEV^IBECEA31
"RTN","IBECEA3",120,0)
 ;
"RTN","IBECEA3",121,0)
 ;
"RTN","IBECEA3",122,0)
 ; - calculate units and total charge
"RTN","IBECEA3",123,0)
 S IBUNIT=$$FMDIFF^XLFDT(IBTO,IBFR) S:IBXA'=3!(IBFR=IBTO) IBUNIT=IBUNIT+1
"RTN","IBECEA3",124,0)
 I IBXA=1 D:IBGMT>0  D FEPR^IBECEA32 G ADDQ:IBY<0,EV
"RTN","IBECEA3",125,0)
 . S IBGMTR=1
"RTN","IBECEA3",126,0)
 . W !,"The patient has GMT Copayment Status! GMT rate must be applied.",!
"RTN","IBECEA3",127,0)
 S IBCHG=IBCHG*IBUNIT S:IBXA=2 IBCHG=$S(IBCLDOL+IBCHG>IBMED:IBMED-IBCLDOL,1:IBCHG)
"RTN","IBECEA3",128,0)
 ;
"RTN","IBECEA3",129,0)
 ; adjust the LTC charge based on the calculated copay cap
"RTN","IBECEA3",130,0)
 I IBXA=9 D CALC^IBAECI G:IBY<1!('IBCHG) ADDQ S IBDESC="LTC INPATIENT COPAY"
"RTN","IBECEA3",131,0)
 ;
"RTN","IBECEA3",132,0)
 D CTBB^IBECEAU3 W:IBXA=3!(IBXA=9) "  (for ",IBUNIT," day",$E("s",IBUNIT>1),")" W:IBGMTR " GMT Rate"
"RTN","IBECEA3",133,0)
 ;
"RTN","IBECEA3",134,0)
EV ; - find event record, or select admission for linkage
"RTN","IBECEA3",135,0)
 I IBXA'=9 S IBEVDA=$$EVF^IBECEA31(DFN,IBFR,IBTO,IBNH)
"RTN","IBECEA3",136,0)
 I IBEVDA'>0 D NOEV^IBECEA31 G ADDQ:IBY<0,PROC
"RTN","IBECEA3",137,0)
 S IBSL=$P($G(^IB(+IBEVDA,0)),"^",4)
"RTN","IBECEA3",138,0)
 W !!,"Linked charge to ",$$TYP(),"admission on ",$$DAT1^IBOUTL($P(IBEVDA,"^",2)),"  ("
"RTN","IBECEA3",139,0)
 W $S($P(IBEVDA,"^",3)=9999999:"Still admitted)",1:"Discharged on "_$$DAT1^IBOUTL($P(IBEVDA,"^",3))_$S($P(IBEVDA,"^",3)>DT:" [pseudo])",1:")"))," ..."
"RTN","IBECEA3",140,0)
 S IBEVDA=+IBEVDA
"RTN","IBECEA3",141,0)
 I '$G(IBSIBC) D SPEC^IBECEA32(0,$O(^IBE(351.2,"AD",IBEVDA,0)))
"RTN","IBECEA3",142,0)
 ;
"RTN","IBECEA3",143,0)
 ;
"RTN","IBECEA3",144,0)
PROC ; - okay to proceed?
"RTN","IBECEA3",145,0)
 D PROC^IBECEAU4("add") G:IBY<0 ADDQ
"RTN","IBECEA3",146,0)
 ;
"RTN","IBECEA3",147,0)
 ; - build the event record first if necessary
"RTN","IBECEA3",148,0)
 I $G(IBDG),IBXA'=9 D @("ADEV^IBECEA3"_$S($G(IBFEEV):4,1:1)) G:IBY<0 ADDQ
"RTN","IBECEA3",149,0)
 ;
"RTN","IBECEA3",150,0)
 ; - disposition the special inpatient billing case, if necessary
"RTN","IBECEA3",151,0)
 I $G(IBSIBC) D CEA^IBAMTI1(IBSIBC,IBEVDA)
"RTN","IBECEA3",152,0)
 ;
"RTN","IBECEA3",153,0)
 ; - generate entry in file #354.71 and #350
"RTN","IBECEA3",154,0)
 I IBXA=5 W !!,"Building the new transaction...  " S IBAM=$$ADD^IBARXMN(DFN,"^^"_DT_"^^P^^"_IBUNIT_"^"_IBCHG_"^"_IBDESC_"^^"_IBCHG_"^0^"_IBSITE) G:IBAM<0 ADDQ
"RTN","IBECEA3",155,0)
 D ADD^IBECEAU3 G:IBY<0 ADDQ W "done."
"RTN","IBECEA3",156,0)
 ;
"RTN","IBECEA3",157,0)
 ; - pass the charge off to AR on-line
"RTN","IBECEA3",158,0)
 W !,"Passing the charge directly to Accounts Receivable... "
"RTN","IBECEA3",159,0)
 D PASSCH^IBECEA22 W:IBY>0 "done." G:IBY<0 ADDQ
"RTN","IBECEA3",160,0)
 ;
"RTN","IBECEA3",161,0)
 ; - review the special inpatient billing case
"RTN","IBECEA3",162,0)
 I $G(IBSIBC1) D CHK^IBAMTI1(IBSIBC1,IBEVDA)
"RTN","IBECEA3",163,0)
 ;
"RTN","IBECEA3",164,0)
 ; - handle updating of clock
"RTN","IBECEA3",165,0)
 I IBXA'=8,IBXA'=9 D CLUPD^IBECEA32
"RTN","IBECEA3",166,0)
 ;
"RTN","IBECEA3",167,0)
ADDQ ; - display error, rebuild list, and quit
"RTN","IBECEA3",168,0)
 D ERR^IBECEAU4:IBY<0,PAUSE^IBECEAU S VALMBCK="R"
"RTN","IBECEA3",169,0)
 I IBCOMMIT S IBBG=VALMBG W !,"Rebuilding list of charges..." D ARRAY^IBECEA0 S VALMBG=IBBG
"RTN","IBECEA3",170,0)
 K IBMED,IBCLDA,IBCLDT,IBCLDOL,IBCLDAY,IBATYP,IBDG,IBSEQNO,IBXA,IBNH,IBBS,IBLIM,IBFR,IBTO,IBRTED,IBSIBC,IBSIBC1,IBBG,IBFEEV,IBAM
"RTN","IBECEA3",171,0)
 K IBX,IBCHG,IBUNIT,IBDESC,IBDT,IBEVDT,IBEVDA,IBSL,IBNOS,IBN,IBTOTL,IBARTYP,IBIL,IBTRAN,IBAFY,IBCVA,IBCLSF,IBDD,IBND,VADM,VA,VAERR,IBADJMED
"RTN","IBECEA3",172,0)
ADDQ1 K IBEXSTAT,IBCOMMIT,IBCATC,IBCVAEL,IBLTCST
"RTN","IBECEA3",173,0)
 Q
"RTN","IBECEA3",174,0)
 ;
"RTN","IBECEA3",175,0)
 ;
"RTN","IBECEA3",176,0)
TYP() ; Return descriptive admission type.
"RTN","IBECEA3",177,0)
 N X S X=""
"RTN","IBECEA3",178,0)
 I IBNH'=2 G TYPQ
"RTN","IBECEA3",179,0)
 I $G(IBADJMED) S X=$S(IBADJMED=1:"C",1:"H")
"RTN","IBECEA3",180,0)
 E  S X=$S($P($G(^IBE(350.1,+IBATYP,0)),"^")["NHCU":"C",1:"H")
"RTN","IBECEA3",181,0)
 S X=$S(X="C":"CNH ",1:"Contract Hospital ")
"RTN","IBECEA3",182,0)
TYPQ Q X
"RTN","IBECEA35")
0^27^B9285866
"RTN","IBECEA35",1,0)
IBECEA35 ;ALB/CPM - Cancel/Edit/Add... TRICARE Support ; 09-AUG-96
"RTN","IBECEA35",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBECEA35",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEA35",4,0)
 ;
"RTN","IBECEA35",5,0)
CUS ; Process all TRICARE copayment charges.
"RTN","IBECEA35",6,0)
 ;
"RTN","IBECEA35",7,0)
 N X,IBCS,IBINS,IBPLAN
"RTN","IBECEA35",8,0)
 ;
"RTN","IBECEA35",9,0)
 ; - display TRICARE coverage
"RTN","IBECEA35",10,0)
 S IBCS=$$CUS^IBACUS(DFN,DT)
"RTN","IBECEA35",11,0)
 D DISP(DFN,IBCS)
"RTN","IBECEA35",12,0)
 ;
"RTN","IBECEA35",13,0)
 ; - collect parameters needed to create the charge
"RTN","IBECEA35",14,0)
 S IBATYPN=$G(^IBE(350.1,IBATYP,0)),IBUNIT=1
"RTN","IBECEA35",15,0)
 I IBATYPN["RX" D AMT^IBECEAU2 S IBDESC="TRICARE RX COPAY",IBFR=DT G GO
"RTN","IBECEA35",16,0)
 I IBATYPN["OPT" D  G GO
"RTN","IBECEA35",17,0)
 .S IBLIM=DT D FR^IBECEAU2(0),AMT^IBECEAU2:IBY>0
"RTN","IBECEA35",18,0)
 .S IBDESC="TRICARE OPT COPAY",(IBEVDT,IBTO)=IBFR,IBEVDA="*"
"RTN","IBECEA35",19,0)
 I IBATYPN["INPT" D  G GO
"RTN","IBECEA35",20,0)
 .S IBDG=$$ADSEL^IBECEA31(DFN),IBDESC="TRICARE INPT COPAY"
"RTN","IBECEA35",21,0)
 .I IBDG>0 D  Q
"RTN","IBECEA35",22,0)
 ..D AMT^IBECEAU2 Q:IBY'>0
"RTN","IBECEA35",23,0)
 ..S IBSL="405:"_+IBDG,(IBEVDT,IBFR)=$P(IBDG,"^",2),IBEVDA="*"
"RTN","IBECEA35",24,0)
 ..S IBTO=$$DIS^IBECEA31(IBSL),IBTO=$S(IBTO>DT:DT,1:IBTO)
"RTN","IBECEA35",25,0)
 .W !!,"An admission was not available or not selected."
"RTN","IBECEA35",26,0)
 .W !,"This transaction has been cancelled." S IBY=-1 Q
"RTN","IBECEA35",27,0)
 .;
"RTN","IBECEA35",28,0)
 .; - if I pursue this further...
"RTN","IBECEA35",29,0)
 .S DIR(0)="Y",DIR("A")="Do you still wish to create an inpatient copayment charge"
"RTN","IBECEA35",30,0)
 .S DIR("?")="Enter 'Y' or 'YES' to create a charge, or 'N', 'NO', or '^' to quit."
"RTN","IBECEA35",31,0)
 .D ^DIR K DIR I 'Y!($D(DIRUT))!($D(DUOUT)) W !,"This transaction has been cancelled." S IBY=-1 Q
"RTN","IBECEA35",32,0)
 ;
"RTN","IBECEA35",33,0)
 ;
"RTN","IBECEA35",34,0)
GO ; - bill the charge
"RTN","IBECEA35",35,0)
 I IBY<0 G CUSQ
"RTN","IBECEA35",36,0)
 ;
"RTN","IBECEA35",37,0)
 ; - okay to proceed?
"RTN","IBECEA35",38,0)
 D PROC^IBECEAU4("add") I IBY<0 G CUSQ
"RTN","IBECEA35",39,0)
 ;
"RTN","IBECEA35",40,0)
 ; - create charge and pass to AR
"RTN","IBECEA35",41,0)
 W !,"Billing the TRICARE patient copayment charge..."
"RTN","IBECEA35",42,0)
 D ADD^IBECEAU3,AR^IBR:IBY>0 I IBY<0 G CUSQ
"RTN","IBECEA35",43,0)
 ;
"RTN","IBECEA35",44,0)
 S IBCOMMIT=1 W "completed."
"RTN","IBECEA35",45,0)
 ;
"RTN","IBECEA35",46,0)
CUSQ K IBCS
"RTN","IBECEA35",47,0)
 Q
"RTN","IBECEA35",48,0)
 ;
"RTN","IBECEA35",49,0)
 ;
"RTN","IBECEA35",50,0)
DISP(DFN,INS) ; Display TRICARE beneficiary insurance information.
"RTN","IBECEA35",51,0)
 ;  Input:    DFN  --  Pointer to the patient in file #2
"RTN","IBECEA35",52,0)
 ;            INS  --  Pointer to the patient policy in file #2.312
"RTN","IBECEA35",53,0)
 ;
"RTN","IBECEA35",54,0)
 I '$G(INS) W *7,!!,"Please note that this patient does not have active TRICARE coverage!",! G DISPQ
"RTN","IBECEA35",55,0)
 ;
"RTN","IBECEA35",56,0)
 N IBINS,IBINS3,IBPLAN,IBS S IBS=0
"RTN","IBECEA35",57,0)
 S IBINS=$G(^DPT(DFN,.312,IBCS,0)),IBINS3=$G(^(3))
"RTN","IBECEA35",58,0)
 S IBPLAN=$G(^IBA(355.3,+$P(IBINS,"^",18),0))
"RTN","IBECEA35",59,0)
 W !!," TRICARE coverage for ",$P($G(^DPT(DFN,0)),"^"),":"
"RTN","IBECEA35",60,0)
 W !!," Insured Person: ",$E($P(IBINS,"^",17),1,20)
"RTN","IBECEA35",61,0)
 W ?42,"Company: ",$P($G(^DIC(36,+IBINS,0)),"^")
"RTN","IBECEA35",62,0)
 W !," Effective Date: ",$$DAT1^IBOUTL($P(IBINS,"^",8))
"RTN","IBECEA35",63,0)
 W ?40,"Plan Name: ",$P(IBPLAN,"^",3)
"RTN","IBECEA35",64,0)
 W !,"Expiration Date: ",$$DAT1^IBOUTL($P(IBINS,"^",4))
"RTN","IBECEA35",65,0)
 W ?38,"Plan Number: ",$P(IBPLAN,"^",4),!
"RTN","IBECEA35",66,0)
 I $P(IBINS3,"^",2)]"" S IBS=1 W " Service Branch: ",$P($G(^DIC(23,+$P(IBINS3,"^",2),0)),"^")
"RTN","IBECEA35",67,0)
 I $P(IBINS3,"^",3)]"" S IBS=1 W ?37,"Service Rank: ",$P(IBINS3,"^",3)
"RTN","IBECEA35",68,0)
 W:IBS !
"RTN","IBECEA35",69,0)
DISPQ Q
"RTN","IBECEA4")
0^13^B9459925
"RTN","IBECEA4",1,0)
IBECEA4 ;ALB/CPM - Cancel/Edit/Add... Cancel a Charge ;11-MAR-93
"RTN","IBECEA4",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,150,240**;21-MAR-94
"RTN","IBECEA4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEA4",4,0)
 ;
"RTN","IBECEA4",5,0)
ONE ; Cancel a single charge.
"RTN","IBECEA4",6,0)
 D HDR^IBECEAU("C A N C E L")
"RTN","IBECEA4",7,0)
 ;
"RTN","IBECEA4",8,0)
 ; - perform up-front edits
"RTN","IBECEA4",9,0)
 D CED^IBECEAU4(IBN) G:IBY<0 ONEQ
"RTN","IBECEA4",10,0)
 I IBXA=6!(IBXA=7) D  G ONEQ:$G(IBCC),REAS
"RTN","IBECEA4",11,0)
 .I IBCANTR!($P(IBND,"^",5)=10) S IBCC=1 W !,"This transaction has already been cancelled.",!
"RTN","IBECEA4",12,0)
 I IBCANTR!($P(IBND,"^",5)=10) W !,$S(IBH:"Please note that this cancellation action has not yet been passed to AR.",1:"This transaction has already been cancelled."),! G ONEQ:'IBH,REAS
"RTN","IBECEA4",13,0)
 I 'IBH,IBIL="" S IBY="-1^IB024" G ONEQ
"RTN","IBECEA4",14,0)
 ;
"RTN","IBECEA4",15,0)
REAS ; - ask for the cancellation reason
"RTN","IBECEA4",16,0)
 D REAS^IBECEAU2("C") G:IBCRES<0 ONEQ
"RTN","IBECEA4",17,0)
 ;
"RTN","IBECEA4",18,0)
 ; - okay to proceed?
"RTN","IBECEA4",19,0)
 D PROC^IBECEAU4("cancel") G:IBY<0 ONEQ
"RTN","IBECEA4",20,0)
 ;
"RTN","IBECEA4",21,0)
 ; - handle CHAMPVA/TRICARE charges
"RTN","IBECEA4",22,0)
 I IBXA=6!(IBXA=7) D CANC^IBECEAU4(IBN,IBCRES,1) G ONEQ
"RTN","IBECEA4",23,0)
 ;
"RTN","IBECEA4",24,0)
 ; - handle cancellation transactions
"RTN","IBECEA4",25,0)
 I IBCANTR D  G ONEQ
"RTN","IBECEA4",26,0)
 .I IBN=IBPARNT D UPSTAT^IBECEAU4(IBN,1) Q
"RTN","IBECEA4",27,0)
 .I 'IBIL S IBIL=$P($G(^IB(IBPARNT,0)),"^",11) I 'IBIL W !!,"There is no bill number associated with this charge.",!,"The charge cannot be cancelled." Q
"RTN","IBECEA4",28,0)
 .S DIE="^IB(",DA=IBN,DR=".1////"_IBCRES_";.11////"_IBIL D ^DIE,PASS K DIE,DA,DR
"RTN","IBECEA4",29,0)
 ;
"RTN","IBECEA4",30,0)
 ; - update 354.71 and 354.7 (cap info)
"RTN","IBECEA4",31,0)
 I $P(IBND,"^",19) S IBAMC=$$CANCEL^IBARXMN(DFN,$P(IBND,"^",19),.IBY) G:IBY<1 ONEQ I IBAMC D FOUND^IBARXMA(.IBY,IBAMC)
"RTN","IBECEA4",32,0)
 ;
"RTN","IBECEA4",33,0)
 ; - handle incomplete and regular transactions
"RTN","IBECEA4",34,0)
 D CANC^IBECEAU4(IBN,IBCRES,1) G:IBY<1 ONEQ
"RTN","IBECEA4",35,0)
 ;
"RTN","IBECEA4",36,0)
 ; - handle updating of clock
"RTN","IBECEA4",37,0)
 I "^1^2^3^"'[("^"_IBXA_"^") G ONEQ
"RTN","IBECEA4",38,0)
 I 'IBCHG G ONEQ
"RTN","IBECEA4",39,0)
 D CLSTR^IBECEAU1(DFN,IBFR) I 'IBCLDA W !!,"Please note that there is no billing clock which would cover this charge.",!,"Be sure that this patient's billing clock is correct." G ONEQ
"RTN","IBECEA4",40,0)
 D CLOCK^IBECEAU(-IBCHG,+$P(IBCLST,"^",9),-IBUNIT)
"RTN","IBECEA4",41,0)
 ;
"RTN","IBECEA4",42,0)
ONEQ D ERR^IBECEAU4:IBY<0,PAUSE^IBECEAU
"RTN","IBECEA4",43,0)
 K IBCHG,IBCRES,IBDESC,IBIL,IBND,IBSEQNO,IBTOTL,IBUNIT,IBATYP,IBIDX,IBCC
"RTN","IBECEA4",44,0)
 K IBN,IBREB,IBY,IBEVDA,IBPARNT,IBH,IBCANTR,IBXA,IBSL,IBFR,IBTO,IBNOS,IBCANC,IBAMC
"RTN","IBECEA4",45,0)
 Q
"RTN","IBECEA4",46,0)
 ;
"RTN","IBECEA4",47,0)
PASS ; Pass the action to Accounts Receivable.
"RTN","IBECEA4",48,0)
 N IBSERV
"RTN","IBECEA4",49,0)
 W !,"Passing the cancellation action to AR... "
"RTN","IBECEA4",50,0)
 S IBNOS=IBN D ^IBR S IBY=Y W:Y>0 "done."
"RTN","IBECEA4",51,0)
 Q
"RTN","IBECUS")
0^14^B17845253
"RTN","IBECUS",1,0)
IBECUS ;RLM/DVAMC - TRICARE PHARMACY ENGINE OPTIONS ; 14-AUG-96
"RTN","IBECUS",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBECUS",3,0)
 ;
"RTN","IBECUS",4,0)
START ; Start the TRICARE Transaction and AWP Update engines.
"RTN","IBECUS",5,0)
 K IBERR D PAR
"RTN","IBECUS",6,0)
 ;
"RTN","IBECUS",7,0)
 ; - parameters are not set up completely
"RTN","IBECUS",8,0)
 I $O(IBERR(0)) D  G STARTQ
"RTN","IBECUS",9,0)
 .W !!,"The TRICARE Billing engines cannot be started!",*7
"RTN","IBECUS",10,0)
 .W ! S I=0 F  S I=$O(IBERR(I)) Q:'I  W !,IBERR(I)
"RTN","IBECUS",11,0)
 .I IBAPORT="" W !!," *** Note that the AWP Update port has also not been defined."
"RTN","IBECUS",12,0)
 ;
"RTN","IBECUS",13,0)
 ; - AWP and billing ports must be unique
"RTN","IBECUS",14,0)
 I IBBPORT=IBAPORT W !!,"The Billing Transaction and AWP Update ports cannot be the same!" G STARTQ
"RTN","IBECUS",15,0)
 ;
"RTN","IBECUS",16,0)
 ; - only start the billing job if the AWP port is not defined
"RTN","IBECUS",17,0)
 I IBAPORT="" W !!,"The AWP Update port has not been defined.  The AWP Update task will not start."
"RTN","IBECUS",18,0)
 ;
"RTN","IBECUS",19,0)
 I IBVOL]"" W !!,"Note that these jobs will be queued to run on ",IBVOL,"."
"RTN","IBECUS",20,0)
 ;
"RTN","IBECUS",21,0)
 ; - okay to queue these jobs?
"RTN","IBECUS",22,0)
 S DIR(0)="Y",DIR("A")="Is it okay to queue these jobs to run"
"RTN","IBECUS",23,0)
 S DIR("?",1)="Enter:  'Y'  if you wish to task off this job, or"
"RTN","IBECUS",24,0)
 S DIR("?")="        'N' or '^'  to quit this option."
"RTN","IBECUS",25,0)
 W ! D ^DIR
"RTN","IBECUS",26,0)
 I 'Y W !!,"The jobs have not been queued to run." G STARTQ
"RTN","IBECUS",27,0)
 ;
"RTN","IBECUS",28,0)
 ; - turn off the 'shutdown filer' flag
"RTN","IBECUS",29,0)
 S $P(^IBE(350.9,1,9),"^",10)=0
"RTN","IBECUS",30,0)
 ;
"RTN","IBECUS",31,0)
 ; - queue the primary billing task
"RTN","IBECUS",32,0)
 S ZTRTN="BILLP^IBECUS1",ZTDTH=$H,ZTIO=""
"RTN","IBECUS",33,0)
 S ZTDESC="IB - TRICARE Primary Billing Task"
"RTN","IBECUS",34,0)
 I IBVOL]"" S ZTCPU=IBVOL
"RTN","IBECUS",35,0)
 F I="IBBPORT","IBCHAN","IBCHSET","IBPRESCR","IBVOL" S ZTSAVE(I)=""
"RTN","IBECUS",36,0)
 D ^%ZTLOAD
"RTN","IBECUS",37,0)
 I '$D(ZTSK) W !!,"Unable to queue the billing task!" G STARTQ
"RTN","IBECUS",38,0)
 ;
"RTN","IBECUS",39,0)
 W !!,"The TRICARE billing engine has been queued as task# ",ZTSK,"."
"RTN","IBECUS",40,0)
 S DA=1,DIE="^IBE(350.9,",DR="9.04////"_ZTSK_";9.05////@" D ^DIE
"RTN","IBECUS",41,0)
 ;
"RTN","IBECUS",42,0)
 ; - the AWP port must be defined to start that job
"RTN","IBECUS",43,0)
 I IBAPORT="" G STARTQ
"RTN","IBECUS",44,0)
 ;
"RTN","IBECUS",45,0)
 ; - queue the primary AWP update task
"RTN","IBECUS",46,0)
 K ZTSAVE,ZTCPU,ZTSK
"RTN","IBECUS",47,0)
 S ZTRTN="AWPP^IBECUS1",ZTDTH=$H,ZTIO=""
"RTN","IBECUS",48,0)
 S ZTDESC="IB - TRICARE Primary AWP Update Task"
"RTN","IBECUS",49,0)
 I IBVOL]"" S ZTCPU=IBVOL
"RTN","IBECUS",50,0)
 F I="IBAPORT","IBCHAN","IBCHSET","IBVOL" S ZTSAVE(I)=""
"RTN","IBECUS",51,0)
 D ^%ZTLOAD S IBATASK=$G(ZTSK)
"RTN","IBECUS",52,0)
 I '$D(ZTSK) W !!,"Unable to queue the AWP Update task!" G STARTQ
"RTN","IBECUS",53,0)
 ;
"RTN","IBECUS",54,0)
 W !!,"The AWP Update engine has been queued as task# ",ZTSK,"."
"RTN","IBECUS",55,0)
 S DA=1,DIE="^IBE(350.9,",DR="9.06////"_ZTSK_";9.07////@" D ^DIE
"RTN","IBECUS",56,0)
 ;
"RTN","IBECUS",57,0)
STARTQ K DIROUT,DTOUT,DUOUT,IBERR,IBAPORT,IBBPORT,IBCHAN,IBVOL,ZTSK
"RTN","IBECUS",58,0)
 Q
"RTN","IBECUS",59,0)
 ;
"RTN","IBECUS",60,0)
 ;
"RTN","IBECUS",61,0)
STOP ; Shut down the TRICARE Transaction and AWP Update engines.
"RTN","IBECUS",62,0)
 I '$P($G(^IBE(350.9,1,9)),"^",4) W !!,"The primary billing task does not appear to be running."
"RTN","IBECUS",63,0)
 ;
"RTN","IBECUS",64,0)
 ; - okay to shut down these jobs?
"RTN","IBECUS",65,0)
 S DIR(0)="Y",DIR("A")="Are you sure you wish to shut down these jobs"
"RTN","IBECUS",66,0)
 S DIR("?",1)="Enter:  'Y'  if you wish to shut down these jobs, or"
"RTN","IBECUS",67,0)
 S DIR("?")="        'N' or '^'  to quit this option."
"RTN","IBECUS",68,0)
 W ! D ^DIR
"RTN","IBECUS",69,0)
 I 'Y W !!,"The jobs will not be shut down." G STOPQ
"RTN","IBECUS",70,0)
 ;
"RTN","IBECUS",71,0)
 ; - set the 'shutdown filer' flag
"RTN","IBECUS",72,0)
 S $P(^IBE(350.9,1,9),"^",10)=1
"RTN","IBECUS",73,0)
 ;
"RTN","IBECUS",74,0)
 W !!,"The TRICARE Billing and AWP Update engines will be shut down."
"RTN","IBECUS",75,0)
 ;
"RTN","IBECUS",76,0)
STOPQ K DIR,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBECUS",77,0)
 Q
"RTN","IBECUS",78,0)
 ;
"RTN","IBECUS",79,0)
 ;
"RTN","IBECUS",80,0)
PAR ; Retrieve the required engine parameters.
"RTN","IBECUS",81,0)
 N X,Y,ZTSK
"RTN","IBECUS",82,0)
 S X=$G(^IBE(350.9,1,9))
"RTN","IBECUS",83,0)
 S IBBPORT=$P(X,"^")
"RTN","IBECUS",84,0)
 I IBBPORT="" S IBERR(1)="The Billing transaction port has not been defined."
"RTN","IBECUS",85,0)
 S IBAPORT=$P(X,"^",2)
"RTN","IBECUS",86,0)
 S IBCHAN=$P(X,"^",3)
"RTN","IBECUS",87,0)
 I IBCHAN="" S IBERR(2)="The TCP/IP address has not been defined."
"RTN","IBECUS",88,0)
 S ZTSK=$P(X,"^",4)
"RTN","IBECUS",89,0)
 I ZTSK D
"RTN","IBECUS",90,0)
 .D STAT^%ZTLOAD
"RTN","IBECUS",91,0)
 .I ZTSK(1)=2 S IBERR(3)="This job appears to be running!  Check task #"_ZTSK_"." Q
"RTN","IBECUS",92,0)
 .S $P(^IBE(350.9,1,9),"^",4)=""
"RTN","IBECUS",93,0)
 S IBCHSET=+$P(X,"^",12)
"RTN","IBECUS",94,0)
 I $G(^IBE(363.1,IBCHSET,0))="" S IBERR(4)="You must define a Charge Set in the Charge Master so the drug AWP can be found."
"RTN","IBECUS",95,0)
 S IBPRESCR=$P(X,"^",13)
"RTN","IBECUS",96,0)
 I IBPRESCR="" S IBERR(5)="You must enter your Prescriber ID before this task can be started."
"RTN","IBECUS",97,0)
 S IBVOL=$P(X,"^",11)
"RTN","IBECUS",98,0)
 Q
"RTN","IBECUS1")
0^15^B19467740
"RTN","IBECUS1",1,0)
IBECUS1 ;RLM/DVAMC - TRICARE PHARMACY BILLING ENGINES ; 14-AUG-96
"RTN","IBECUS1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,88,240**;21-MAR-94
"RTN","IBECUS1",3,0)
 ;
"RTN","IBECUS1",4,0)
BILLS ; Tasked entry point:  Secondary Billing engine.
"RTN","IBECUS1",5,0)
 ;
"RTN","IBECUS1",6,0)
 I $D(^%ZOSF("TRAP")) S X="ERRS^IBECUS1",@^("TRAP")
"RTN","IBECUS1",7,0)
 ;
"RTN","IBECUS1",8,0)
 ; - main idling loop
"RTN","IBECUS1",9,0)
 F  H 100 Q:'$P($G(^IBE(350.9,1,9)),"^",4)
"RTN","IBECUS1",10,0)
 ;
"RTN","IBECUS1",11,0)
 I $P($G(^IBE(350.9,1,9)),"^",10) S $P(^IBE(350.9,1,9),"^",5)="" G BILLQ
"RTN","IBECUS1",12,0)
 ;
"RTN","IBECUS1",13,0)
 ; - drop into Primary Billing task...
"RTN","IBECUS1",14,0)
 ;
"RTN","IBECUS1",15,0)
 ;
"RTN","IBECUS1",16,0)
BILLP ; Tasked entry point:  Primary Billing engine.
"RTN","IBECUS1",17,0)
 ;
"RTN","IBECUS1",18,0)
 I $D(^%ZOSF("TRAP")) S X="ERRP^IBECUS1",@^("TRAP")
"RTN","IBECUS1",19,0)
 ;
"RTN","IBECUS1",20,0)
 ; - open the port
"RTN","IBECUS1",21,0)
 D CALL^%ZISTCP(IBCHAN,IBBPORT) I POP G BILLC
"RTN","IBECUS1",22,0)
 ;
"RTN","IBECUS1",23,0)
 ; - start secondary job
"RTN","IBECUS1",24,0)
 D SECB
"RTN","IBECUS1",25,0)
 ;
"RTN","IBECUS1",26,0)
 ; - send alert notifying that the billing engine has started
"RTN","IBECUS1",27,0)
 D NOW^%DTC S $P(^IBE(350.9,1,9),"^",8)=%,Y=% X ^DD("DD")
"RTN","IBECUS1",28,0)
 S XQA("G.IB CHAMP RX START")="",XQAMSG="IPS Billing Process Started "_Y
"RTN","IBECUS1",29,0)
 D SETUP^XQALERT
"RTN","IBECUS1",30,0)
 ;
"RTN","IBECUS1",31,0)
 ; - main processing loop
"RTN","IBECUS1",32,0)
 F  R IBX:50 D SND,UPD I $P($G(^IBE(350.9,1,9)),"^",10) Q
"RTN","IBECUS1",33,0)
 ;
"RTN","IBECUS1",34,0)
BILLC D CLOSE^%ZISTCP
"RTN","IBECUS1",35,0)
 ;
"RTN","IBECUS1",36,0)
 ; - delete the primary task
"RTN","IBECUS1",37,0)
 S $P(^IBE(350.9,1,9),"^",4)=""
"RTN","IBECUS1",38,0)
 ;
"RTN","IBECUS1",39,0)
BILLQ Q
"RTN","IBECUS1",40,0)
 ;
"RTN","IBECUS1",41,0)
 ;
"RTN","IBECUS1",42,0)
SND ; Process all prescriptions queued for billing.
"RTN","IBECUS1",43,0)
 F  R *IBI:0 Q:IBI=-1  ; bleed queue
"RTN","IBECUS1",44,0)
 S IBKEY="" F  S IBKEY=$O(^IBA(351.5,"APOST",IBKEY)) Q:'IBKEY  S IBKEYD=$G(^(IBKEY)),IBROU="^IBECUS"_$S(IBKEYD["REVERSE":3,1:2) D @IBROU
"RTN","IBECUS1",45,0)
 Q
"RTN","IBECUS1",46,0)
 ;
"RTN","IBECUS1",47,0)
 ;
"RTN","IBECUS1",48,0)
UPD ; Update the last run date/time.
"RTN","IBECUS1",49,0)
 D NOW^%DTC
"RTN","IBECUS1",50,0)
 S $P(^IBE(350.9,1,9),"^",9)=%
"RTN","IBECUS1",51,0)
 Q
"RTN","IBECUS1",52,0)
 ;
"RTN","IBECUS1",53,0)
 ;
"RTN","IBECUS1",54,0)
ERRP ; Primary billing task error trap
"RTN","IBECUS1",55,0)
 D CLOSE^%ZISTCP
"RTN","IBECUS1",56,0)
 S $P(^IBE(350.9,1,9),"^",4)=""
"RTN","IBECUS1",57,0)
 G ^%ZTER
"RTN","IBECUS1",58,0)
 ;
"RTN","IBECUS1",59,0)
ERRS ; Secondary billing task error trap
"RTN","IBECUS1",60,0)
 D SECB
"RTN","IBECUS1",61,0)
 G ^%ZTER
"RTN","IBECUS1",62,0)
 ;
"RTN","IBECUS1",63,0)
SECB ; Start the secondary billing task.
"RTN","IBECUS1",64,0)
 S ZTRTN="BILLS^IBECUS1",ZTDTH=$H,ZTIO=""
"RTN","IBECUS1",65,0)
 S ZTDESC="IB - TRICARE Secondary Billing Task"
"RTN","IBECUS1",66,0)
 I IBVOL]"" S ZTCPU=IBVOL
"RTN","IBECUS1",67,0)
 F I="IBBPORT","IBCHAN","IBCHSET","IBPRESCR","IBVOL" S ZTSAVE(I)=""
"RTN","IBECUS1",68,0)
 D ^%ZTLOAD
"RTN","IBECUS1",69,0)
 ;
"RTN","IBECUS1",70,0)
 S $P(^IBE(350.9,1,9),"^",5)=$G(ZTSK)
"RTN","IBECUS1",71,0)
 ;
"RTN","IBECUS1",72,0)
 K ZTRTN,ZTDTH,ZTIO,ZTSK,ZTCPU,ZTSAVE
"RTN","IBECUS1",73,0)
 Q
"RTN","IBECUS1",74,0)
 ;
"RTN","IBECUS1",75,0)
 ;
"RTN","IBECUS1",76,0)
 ;
"RTN","IBECUS1",77,0)
AWPS ; Tasked entry point:  Secondary AWP Update engine.
"RTN","IBECUS1",78,0)
 ;
"RTN","IBECUS1",79,0)
 I $D(^%ZOSF("TRAP")) S X="ERRAS^IBECUS1",@^("TRAP")
"RTN","IBECUS1",80,0)
 ;
"RTN","IBECUS1",81,0)
 ; - main idling loop
"RTN","IBECUS1",82,0)
 F  H 100 Q:'$P($G(^IBE(350.9,1,9)),"^",6)
"RTN","IBECUS1",83,0)
 ;
"RTN","IBECUS1",84,0)
 I $P($G(^IBE(350.9,1,9)),"^",10) S $P(^IBE(350.9,1,9),"^",7)="" G AWPPQ
"RTN","IBECUS1",85,0)
 ;
"RTN","IBECUS1",86,0)
 ; - drop into Primary AWP Update task...
"RTN","IBECUS1",87,0)
 ;
"RTN","IBECUS1",88,0)
 ;
"RTN","IBECUS1",89,0)
AWPP ; Tasked Entry Point:  Primary AWP Update Engine
"RTN","IBECUS1",90,0)
 ;
"RTN","IBECUS1",91,0)
 I $D(^%ZOSF("TRAP")) S X="ERRAP^IBECUS1",@^("TRAP")
"RTN","IBECUS1",92,0)
 ;
"RTN","IBECUS1",93,0)
 ; - open the port
"RTN","IBECUS1",94,0)
 D CALL^%ZISTCP(IBCHAN,IBAPORT) I POP G AWPPC
"RTN","IBECUS1",95,0)
 ;
"RTN","IBECUS1",96,0)
 ; - start secondary job
"RTN","IBECUS1",97,0)
 D SECA
"RTN","IBECUS1",98,0)
 ;
"RTN","IBECUS1",99,0)
 ; - main processing loop
"RTN","IBECUS1",100,0)
 S IBUPD=0 F  R IBX:30 D  I $P($G(^IBE(350.9,1,9)),"^",10) Q
"RTN","IBECUS1",101,0)
 .;
"RTN","IBECUS1",102,0)
 .; - if no response, sent alert if necessary
"RTN","IBECUS1",103,0)
 .I IBX="" D:IBUPD  Q
"RTN","IBECUS1",104,0)
 ..D NOW^%DTC S Y=% X ^DD("DD")
"RTN","IBECUS1",105,0)
 ..S XQA("G.IB CHAMP RX START")=""
"RTN","IBECUS1",106,0)
 ..S XQAMSG="AWP update completed on "_Y_".  "_IBUPD_" new rates were added."
"RTN","IBECUS1",107,0)
 ..D SETUP^XQALERT
"RTN","IBECUS1",108,0)
 ..S IBUPD=0
"RTN","IBECUS1",109,0)
 .;
"RTN","IBECUS1",110,0)
 .; - respond if record is not in the anticipated format
"RTN","IBECUS1",111,0)
 .I IBX'?36N W "N" Q
"RTN","IBECUS1",112,0)
 .I IBX?36"9" Q
"RTN","IBECUS1",113,0)
 .;
"RTN","IBECUS1",114,0)
 .; - pull data from the transmitted record
"RTN","IBECUS1",115,0)
 .S IBNDCO=$E(IBX,1,11),IBNDCN=$E(IBX,12,22),IBAWP=$E(IBX,23,29)
"RTN","IBECUS1",116,0)
 .S IBAWP=$E(IBAWP,1,3)_"."_$E(IBAWP,4,7)
"RTN","IBECUS1",117,0)
 .S IBNDC=$S(IBNDCN:IBNDCN,1:IBNDCO)
"RTN","IBECUS1",118,0)
 .S IBNDC=$E(IBNDC,1,5)_"-"_$E(IBNDC,6,9)_"-"_$E(IBNDC,10,11)
"RTN","IBECUS1",119,0)
 .;
"RTN","IBECUS1",120,0)
 .; - find/build billable item and file the new charge item
"RTN","IBECUS1",121,0)
 .S DIQUIET=1,IBG=0 D DT^DICRW
"RTN","IBECUS1",122,0)
 .S IBITEM=+$$ADDBI^IBCREF("NDC",IBNDC)
"RTN","IBECUS1",123,0)
 .I IBITEM,$$ADDCI^IBCREF(IBCHSET,IBITEM,DT,IBAWP) S IBG=1
"RTN","IBECUS1",124,0)
 .;
"RTN","IBECUS1",125,0)
 .; - respond and update the counter
"RTN","IBECUS1",126,0)
 .W "Y",!
"RTN","IBECUS1",127,0)
 .S:IBG IBUPD=IBUPD+1
"RTN","IBECUS1",128,0)
 ;
"RTN","IBECUS1",129,0)
AWPPC D CLOSE^%ZISTCP
"RTN","IBECUS1",130,0)
 ;
"RTN","IBECUS1",131,0)
 ; - delete the primary task
"RTN","IBECUS1",132,0)
 S $P(^IBE(350.9,1,9),"^",6)=""
"RTN","IBECUS1",133,0)
 ;
"RTN","IBECUS1",134,0)
AWPPQ Q
"RTN","IBECUS1",135,0)
 ;
"RTN","IBECUS1",136,0)
 ;
"RTN","IBECUS1",137,0)
SECA ; Start the secondary AWP Update task.
"RTN","IBECUS1",138,0)
 S ZTRTN="AWPS^IBECUS1",ZTDTH=$H,ZTIO=""
"RTN","IBECUS1",139,0)
 S ZTDESC="IB - TRICARE Secondary AWP Update Task"
"RTN","IBECUS1",140,0)
 I IBVOL]"" S ZTCPU=IBVOL
"RTN","IBECUS1",141,0)
 F I="IBAPORT","IBCHAN","IBCHSET","IBVOL" S ZTSAVE(I)=""
"RTN","IBECUS1",142,0)
 D ^%ZTLOAD
"RTN","IBECUS1",143,0)
 ;
"RTN","IBECUS1",144,0)
 S $P(^IBE(350.9,1,9),"^",7)=$G(ZTSK)
"RTN","IBECUS1",145,0)
 ;
"RTN","IBECUS1",146,0)
 K ZTRTN,ZTDTH,ZTIO,ZTSK,ZTCPU,ZTSAVE
"RTN","IBECUS1",147,0)
 Q
"RTN","IBECUS1",148,0)
 ;
"RTN","IBECUS1",149,0)
ERRAP ; Primary billing task error trap
"RTN","IBECUS1",150,0)
 D CLOSE^%ZISTCP
"RTN","IBECUS1",151,0)
 S $P(^IBE(350.9,1,9),"^",6)=""
"RTN","IBECUS1",152,0)
 G ^%ZTER
"RTN","IBECUS1",153,0)
 ;
"RTN","IBECUS1",154,0)
ERRAS ; Secondary billing task error trap
"RTN","IBECUS1",155,0)
 D SECA
"RTN","IBECUS1",156,0)
 G ^%ZTER
"RTN","IBECUS2")
0^16^B33007579
"RTN","IBECUS2",1,0)
IBECUS2 ;DVAMC/RLM - TRICARE PHARMACY BILL TRANSACTION ;14-AUG-96
"RTN","IBECUS2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,89,143,162,240**;21-MAR-94
"RTN","IBECUS2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECUS2",4,0)
 ;
"RTN","IBECUS2",5,0)
EN ; Attempt to bill a prescription directly to the FI.
"RTN","IBECUS2",6,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBECUS2",7,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBECUS2",8,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBECUS2",9,0)
 ;                             0 for the original fill
"RTN","IBECUS2",10,0)
 ;           IBKEYD  --  1 ^ 2 ^ 3 ^ 4 ^ 5, where
"RTN","IBECUS2",11,0)
 ;                         1 = Rx label printing device
"RTN","IBECUS2",12,0)
 ;                         2 = Pointer to the Pharmacy in file #59
"RTN","IBECUS2",13,0)
 ;                         3 = Pointer to the Pharmacy user in file #200
"RTN","IBECUS2",14,0)
 ;                         4 = Pointer to the billing transaction
"RTN","IBECUS2",15,0)
 ;                             in file #351.5 (cancellations only)
"RTN","IBECUS2",16,0)
 ;                         5 = Product Selection Reason 
"RTN","IBECUS2",17,0)
 ;                                  (Resubmissions only)
"RTN","IBECUS2",18,0)
 ;          IBCHSET  --  Pointer to the Charge Set in file #363.1
"RTN","IBECUS2",19,0)
 ;         IBPRESCR  --  Facility Prescriber ID number
"RTN","IBECUS2",20,0)
 ;
"RTN","IBECUS2",21,0)
 ; - get rx data; make sure there is an NDC
"RTN","IBECUS2",22,0)
 K IBDRX,IBERR,IBAWPV,IBRESP
"RTN","IBECUS2",23,0)
 S DIQUIET=1 D DT^DICRW
"RTN","IBECUS2",24,0)
 S IBRX=+IBKEY,IBREF=+$P(IBKEY,";",2)
"RTN","IBECUS2",25,0)
 I $$TRANS^PSOCPTRI(IBRX,IBREF,.IBDRX)<0 S IBERR=1 G ENQ
"RTN","IBECUS2",26,0)
 ;
"RTN","IBECUS2",27,0)
 ; - make sure the AWP is available
"RTN","IBECUS2",28,0)
 S IBDRX("NDC")=$$NDC(IBDRX("NDC"))
"RTN","IBECUS2",29,0)
 S IBITEM=+$$FNDBI^IBCRU2("NDC",IBDRX("NDC"))
"RTN","IBECUS2",30,0)
 I 'IBITEM S IBERR=9 G ENQ ;                     NDC is not in CM
"RTN","IBECUS2",31,0)
 D ITMCHG^IBCRCC(IBCHSET,IBITEM,DT,"",.IBAWPV)
"RTN","IBECUS2",32,0)
 I +IBAWPV'=1 S IBERR=10 G ENQ ;                  Not 1 rate for NDC
"RTN","IBECUS2",33,0)
 S IBAWP=$P(IBAWPV(+$O(IBAWPV(0))),"^",3)
"RTN","IBECUS2",34,0)
 I 'IBAWP S IBERR=11 G ENQ ;                     NDC has a zero charge
"RTN","IBECUS2",35,0)
 ;
"RTN","IBECUS2",36,0)
 ; - is patient data intact?
"RTN","IBECUS2",37,0)
 S DFN=+$P($G(^PSRX(IBRX,0)),"^",2)
"RTN","IBECUS2",38,0)
 S IBDPT(0)=$G(^DPT(DFN,0)),IBDPT(.11)=$G(^(.11)),IBDPT(.13)=$G(^(.13))
"RTN","IBECUS2",39,0)
 I IBDPT(0)="" S IBERR=4 G ENQ
"RTN","IBECUS2",40,0)
 ;
"RTN","IBECUS2",41,0)
 ; - is patient covered by TRICARE?
"RTN","IBECUS2",42,0)
 S IBCDFN=$$CUS^IBACUS(DFN,DT)
"RTN","IBECUS2",43,0)
 I 'IBCDFN S IBERR=2 G ENQ
"RTN","IBECUS2",44,0)
 ;
"RTN","IBECUS2",45,0)
 ; - get the BIN Number for the insurance company
"RTN","IBECUS2",46,0)
 S IBCDFND=$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBECUS2",47,0)
 S IBBIN=$P($G(^DIC(36,+IBCDFND,3)),"^",3)
"RTN","IBECUS2",48,0)
 I $L(IBBIN)'=6 S IBERR=5 G ENQ
"RTN","IBECUS2",49,0)
 ;
"RTN","IBECUS2",50,0)
 ; - build line1:
"RTN","IBECUS2",51,0)
 ;      o pharmacy division
"RTN","IBECUS2",52,0)
 ;      o FI identifier (bin number)
"RTN","IBECUS2",53,0)
 ;      o commercial software package version (32)
"RTN","IBECUS2",54,0)
 ;      o billing transaction code  (01)
"RTN","IBECUS2",55,0)
 ;      o control #_pharmacy #_group (37 spaces)
"RTN","IBECUS2",56,0)
 ;      o insured person's ssn
"RTN","IBECUS2",57,0)
 ;      o person code (3 spaces)
"RTN","IBECUS2",58,0)
 ;
"RTN","IBECUS2",59,0)
 S IBFS=$C(28),IBGS=$C(29)
"RTN","IBECUS2",60,0)
 S IBLINE(1)=$$FILL(IBDRX("DIV"),2)_IBBIN_3201_$J("",37)
"RTN","IBECUS2",61,0)
 S IBLINE(1)=IBLINE(1)_$$LJUST($P(IBCDFND,"^",2),18)_$J("",3)
"RTN","IBECUS2",62,0)
 ;
"RTN","IBECUS2",63,0)
 ; - build line2:
"RTN","IBECUS2",64,0)
 ;      o patient dob
"RTN","IBECUS2",65,0)
 ;      o patient sex
"RTN","IBECUS2",66,0)
 ;      o patient rel. to insured
"RTN","IBECUS2",67,0)
 ;      o other coverage indicator (0)
"RTN","IBECUS2",68,0)
 ;      o rx fill date
"RTN","IBECUS2",69,0)
 ;
"RTN","IBECUS2",70,0)
 S IBLINE(2)=$$DATE($P(IBDPT(0),"^",3))_$P(IBDPT(0),"^",2)
"RTN","IBECUS2",71,0)
 S IBLINE(2)=IBLINE(2)_$S($P(IBCDFND,"^",16)>3:4,1:+$P(IBCDFND,"^",16))
"RTN","IBECUS2",72,0)
 S IBLINE(2)=IBLINE(2)_"0"_$$DATE(IBDRX("FDT"))
"RTN","IBECUS2",73,0)
 ;
"RTN","IBECUS2",74,0)
 ; - build line3:
"RTN","IBECUS2",75,0)
 ;      o patient first name
"RTN","IBECUS2",76,0)
 ;      o patient last name
"RTN","IBECUS2",77,0)
 ;      o insured's first name
"RTN","IBECUS2",78,0)
 ;      o insured's last name
"RTN","IBECUS2",79,0)
 ;      o address line 1, city, state, zip, phone
"RTN","IBECUS2",80,0)
 ;      
"RTN","IBECUS2",81,0)
 S IBLINE(3)=IBFS_"C700"_IBFS_"C90"
"RTN","IBECUS2",82,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CA"_$$LJUST($P($P(IBDPT(0),"^"),",",2),12)
"RTN","IBECUS2",83,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CB"_$$LJUST($P($P(IBDPT(0),"^"),","),15)
"RTN","IBECUS2",84,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CC"_$$LJUST($P($P(IBCDFND,"^",17),",",2),12)
"RTN","IBECUS2",85,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CD"_$$LJUST($P($P(IBCDFND,"^",17),","),15)
"RTN","IBECUS2",86,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CM"_$$LJUST($P(IBDPT(.11),"^"),30)
"RTN","IBECUS2",87,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CN"_$$LJUST($P(IBDPT(.11),"^",4),20)
"RTN","IBECUS2",88,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CO"_$$LJUST($P($G(^DIC(5,+$P(IBDPT(.11),"^",5),0)),"^",2),2)
"RTN","IBECUS2",89,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CP"_$$LJUST($P(IBDPT(.11),"^",6),9)
"RTN","IBECUS2",90,0)
 S IBLINE(3)=IBLINE(3)_IBFS_"CQ"_$$FILL($TR($P(IBDPT(.13),"^"),"-",""),10)
"RTN","IBECUS2",91,0)
 ;
"RTN","IBECUS2",92,0)
 ; - build line4:
"RTN","IBECUS2",93,0)
 ;      o prescription number
"RTN","IBECUS2",94,0)
 ;      o new/refill code
"RTN","IBECUS2",95,0)
 ;      o quantity
"RTN","IBECUS2",96,0)
 ;      o days supply
"RTN","IBECUS2",97,0)
 ;      o compound code (0) or if site param IBDRX("COMP")
"RTN","IBECUS2",98,0)
 ;      o drug NDC #
"RTN","IBECUS2",99,0)
 ;      o dispense as written? (0) or if resubmit look at IBKEYD
"RTN","IBECUS2",100,0)
 ;      o ingredient cost
"RTN","IBECUS2",101,0)
 ;      o Prescriber ID
"RTN","IBECUS2",102,0)
 ;      o date prescription written
"RTN","IBECUS2",103,0)
 ;      o # refills authorized
"RTN","IBECUS2",104,0)
 ;      o rx origin code (1)
"RTN","IBECUS2",105,0)
 ;      o rx denial clarification (00)
"RTN","IBECUS2",106,0)
 ;      o usual and customary charge (currently ingr cost * 5)
"RTN","IBECUS2",107,0)
 ;
"RTN","IBECUS2",108,0)
 ; - but first, strip trailing alpha characters from the rx number
"RTN","IBECUS2",109,0)
 S:$E(IBDRX("RX#"),$L(IBDRX("RX#")))]9 IBDRX("RX#")=$E(IBDRX("RX#"),1,$L(IBDRX("RX#"))-1)
"RTN","IBECUS2",110,0)
 S IBLINE(4)=IBGS_$$FILL(IBDRX("RX#"),7)
"RTN","IBECUS2",111,0)
 S IBLINE(4)=IBLINE(4)_$$FILL(IBREF,2)
"RTN","IBECUS2",112,0)
 S IBLINE(4)=IBLINE(4)_$$FILL($P(IBDRX("QTY"),"."),5)
"RTN","IBECUS2",113,0)
 S IBLINE(4)=IBLINE(4)_$$FILL(IBDRX("SUP"),3)
"RTN","IBECUS2",114,0)
 S IBLINE(4)=IBLINE(4)_$S(+$P($G(^IBE(350.9,1,9)),"^",15):IBDRX("COMP"),1:0)
"RTN","IBECUS2",115,0)
 S IBLINE(4)=IBLINE(4)_$$FILL($TR(IBDRX("NDC"),"-",""),11)
"RTN","IBECUS2",116,0)
 S IBLINE(4)=IBLINE(4)_$S($P($G(^IBA(351.53,+$P(IBKEYD,"^",5),0)),"^"):$P(^(0),"^"),1:0)
"RTN","IBECUS2",117,0)
 ;
"RTN","IBECUS2",118,0)
 S IBUAC=$$FILL(+($E($TR($J(IBAWP,0,2),".",""),1,5))*IBDRX("QTY"),6)
"RTN","IBECUS2",119,0)
 S IBLINE(4)=IBLINE(4)_IBUAC_$$LJUST($S(+$P($G(^IBE(350.9,1,9)),"^",14)&($L(IBDRX("DEA"))):IBDRX("DEA"),1:IBPRESCR),10)
"RTN","IBECUS2",120,0)
 S IBLINE(4)=IBLINE(4)_$$DATE(IBDRX("ISS"))
"RTN","IBECUS2",121,0)
 S IBLINE(4)=IBLINE(4)_$$FILL(IBDRX("#REF"),2)
"RTN","IBECUS2",122,0)
 S IBLINE(4)=IBLINE(4)_"100"_$$FILL(IBUAC*5,6)
"RTN","IBECUS2",123,0)
 ;
"RTN","IBECUS2",124,0)
 ; - build line5:  (not currently used, though must be submitted)
"RTN","IBECUS2",125,0)
 S IBLINE(5)=IBFS_"DA000000"_IBFS_"DC000200"_IBFS_"DG000000000000"_IBFS_"DI00"_IBFS_"DL"_$J("",10)
"RTN","IBECUS2",126,0)
 S IBLINE(5)=IBLINE(5)_IBFS_"DM00000"_IBFS_"DN01"_IBFS_"DO"_$J("",6)_IBFS_"DU000000"_IBFS_"DX000000"
"RTN","IBECUS2",127,0)
 S IBLINE(5)=IBLINE(5)_IBFS_"E4  "_IBFS_"E5  "_IBFS_"E6  "_IBFS_"E700000000"
"RTN","IBECUS2",128,0)
 ;
"RTN","IBECUS2",129,0)
OUT ; - send transaction to the commercial pos package
"RTN","IBECUS2",130,0)
 W $C(2)
"RTN","IBECUS2",131,0)
 F I=1:1:5 W IBLINE(I)
"RTN","IBECUS2",132,0)
 W $C(3)
"RTN","IBECUS2",133,0)
 W !
"RTN","IBECUS2",134,0)
 ;
"RTN","IBECUS2",135,0)
 ; - receive response
"RTN","IBECUS2",136,0)
 R IBRESP(1)#220:120 I '$T S IBERR=6 G ENQ
"RTN","IBECUS2",137,0)
 R IBRESP(2)#220:60,IBRESP(3):60 I '$L(IBRESP(3)) S IBERR=7 G ENQ
"RTN","IBECUS2",138,0)
 ;
"RTN","IBECUS2",139,0)
 S IBRESP(1)=$E(IBRESP(1),2,999)
"RTN","IBECUS2",140,0)
 ;
"RTN","IBECUS2",141,0)
 S XMCHAN=""
"RTN","IBECUS2",142,0)
 I $E(IBRESP(1),1,3)="   " D ERROR^IBECUS22 G ENQ
"RTN","IBECUS2",143,0)
 I $E(IBRESP(1),17)="D" D DUP^IBECUS22 G ENQ
"RTN","IBECUS2",144,0)
 ;
"RTN","IBECUS2",145,0)
 ; - file the billing transaction in file #351.51
"RTN","IBECUS2",146,0)
 D ^IBECUS21
"RTN","IBECUS2",147,0)
 ;
"RTN","IBECUS2",148,0)
 ; - quit if a reject
"RTN","IBECUS2",149,0)
 I $E(IBRESP(1),17)="R" G ENQ
"RTN","IBECUS2",150,0)
 ;
"RTN","IBECUS2",151,0)
 ; - if there was an error, file it and quit
"RTN","IBECUS2",152,0)
 I $E(IBRESP(1),1,3) D ERROR^IBECUS22 G ENQ
"RTN","IBECUS2",153,0)
 ;
"RTN","IBECUS2",154,0)
 ; - Queue tasks to print the label and create charges
"RTN","IBECUS2",155,0)
 F IBI="RXLAB;Rx Label print","RXBIL;Rx Billing" D TASK(IBI)
"RTN","IBECUS2",156,0)
 ;
"RTN","IBECUS2",157,0)
 ; - delete rx from billing queue
"RTN","IBECUS2",158,0)
 K ^IBA(351.5,"APOST",IBKEY)
"RTN","IBECUS2",159,0)
 ;
"RTN","IBECUS2",160,0)
ENQ I $G(IBERR) D ERROR^IBECUS22
"RTN","IBECUS2",161,0)
 Q
"RTN","IBECUS2",162,0)
 ;
"RTN","IBECUS2",163,0)
 ;
"RTN","IBECUS2",164,0)
TASK(IBDESC) ; Queue off label print, charge creation and cancellation jobs
"RTN","IBECUS2",165,0)
 ;  Input:  IBDESC  --  1 ; 2 , where
"RTN","IBECUS2",166,0)
 ;                        1 = routine label to execute
"RTN","IBECUS2",167,0)
 ;                        2 = task description
"RTN","IBECUS2",168,0)
 K ZTSAVE,ZTCPU,ZTSK
"RTN","IBECUS2",169,0)
 S ZTRTN=$P(IBDESC,";")_"^IBACUS",ZTDTH=$H,ZTIO=""
"RTN","IBECUS2",170,0)
 S ZTDESC="IB - "_$P(IBDESC,";",2)
"RTN","IBECUS2",171,0)
 F I="IBKEYD","IBCHTRN" S ZTSAVE(I)=""
"RTN","IBECUS2",172,0)
 D ^%ZTLOAD
"RTN","IBECUS2",173,0)
 Q
"RTN","IBECUS2",174,0)
 ;
"RTN","IBECUS2",175,0)
 ;
"RTN","IBECUS2",176,0)
DATE(X) ; Set date in the format yyyymmdd, or 8 spaces.
"RTN","IBECUS2",177,0)
 N Y
"RTN","IBECUS2",178,0)
 S Y=($E($G(X))+17)_$E($G(X),2,7)
"RTN","IBECUS2",179,0)
 Q $S($L(Y)=8:Y,1:$J("",8))
"RTN","IBECUS2",180,0)
 ;
"RTN","IBECUS2",181,0)
FILL(X,LEN) ; Zero-fill, right justified.
"RTN","IBECUS2",182,0)
 N Y
"RTN","IBECUS2",183,0)
 S:'$G(LEN) LEN=1
"RTN","IBECUS2",184,0)
 S Y=$E($G(X),1,LEN)
"RTN","IBECUS2",185,0)
 F  Q:$L(Y)>(LEN-1)  S Y="0"_Y
"RTN","IBECUS2",186,0)
 Q Y
"RTN","IBECUS2",187,0)
 ;
"RTN","IBECUS2",188,0)
LJUST(X,LEN) ; Space-fill, left justified.
"RTN","IBECUS2",189,0)
 N Y
"RTN","IBECUS2",190,0)
 S:'$G(LEN) LEN=1
"RTN","IBECUS2",191,0)
 S Y=$E($G(X),1,LEN)
"RTN","IBECUS2",192,0)
 F  Q:$L(Y)>(LEN-1)  S Y=Y_" "
"RTN","IBECUS2",193,0)
 Q Y
"RTN","IBECUS2",194,0)
 ;
"RTN","IBECUS2",195,0)
STRIPL(X) ; Strip leading spaces.
"RTN","IBECUS2",196,0)
 N Y S Y=$G(X)
"RTN","IBECUS2",197,0)
 F  Q:$E(Y)'=" "  S Y=$E(Y,2,999)
"RTN","IBECUS2",198,0)
 Q Y
"RTN","IBECUS2",199,0)
 ;
"RTN","IBECUS2",200,0)
NDC(X) ; Massage the NDC as it is stored in Pharmacy
"RTN","IBECUS2",201,0)
 ;  Input:  X  --  The NDC as it is stored in Pharmacy
"RTN","IBECUS2",202,0)
 ; Output:  X  --  The NDC in the format 5N 1"-" 4N 1"-" 2N
"RTN","IBECUS2",203,0)
 ;
"RTN","IBECUS2",204,0)
 I $G(X)="" S X="" G NDCQ
"RTN","IBECUS2",205,0)
 ;
"RTN","IBECUS2",206,0)
 N LEN,PCE,Y,Z
"RTN","IBECUS2",207,0)
 ;
"RTN","IBECUS2",208,0)
 S Z(1)=5,Z(2)=4,Z(3)=2
"RTN","IBECUS2",209,0)
 S PCE=0 F  S PCE=$O(Z(PCE)) Q:'PCE  S LEN=Z(PCE) D
"RTN","IBECUS2",210,0)
 .S Y=$P(X,"-",PCE)
"RTN","IBECUS2",211,0)
 .I $L(Y)>LEN S Y=$E(Y,2,LEN+1)
"RTN","IBECUS2",212,0)
 .I $L(+Y)<LEN S Y=$$FILL(Y,LEN)
"RTN","IBECUS2",213,0)
 .S $P(X,"-",PCE)=Y
"RTN","IBECUS2",214,0)
 ;
"RTN","IBECUS2",215,0)
NDCQ Q X
"RTN","IBECUS21")
0^17^B14370648
"RTN","IBECUS21",1,0)
IBECUS21 ;RLM/DVAMC - FILE TRICARE PHARMACY TRANSACTIONS ; 14-AUG-96
"RTN","IBECUS21",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBECUS21",3,0)
 ;
"RTN","IBECUS21",4,0)
TRAN ; File a Pharmacy Billing transaction in file #351.5.
"RTN","IBECUS21",5,0)
 ;  Input:      DFN  --  Pointer to the patient in file #2
"RTN","IBECUS21",6,0)
 ;           IBLINE  --  Array of data transmitted to the FI
"RTN","IBECUS21",7,0)
 ;           IBRESP  --  Array of data received from the FI
"RTN","IBECUS21",8,0)
 ;            IBKEY  --  1 ; 2, where
"RTN","IBECUS21",9,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBECUS21",10,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBECUS21",11,0)
 ;                             0 for the original fill
"RTN","IBECUS21",12,0)
 ;           IBKEYD  --  1 ^ 2 ^ 3 ^ 4, where
"RTN","IBECUS21",13,0)
 ;                         1 = Rx label printing device
"RTN","IBECUS21",14,0)
 ;                         2 = Pointer to the Pharmacy in file #59
"RTN","IBECUS21",15,0)
 ;                         3 = Pointer to the Pharmacy user in file #200
"RTN","IBECUS21",16,0)
 ;                         4 = Pointer to the billing transaction
"RTN","IBECUS21",17,0)
 ;                             in file #351.5 (cancellations only)
"RTN","IBECUS21",18,0)
 ;
"RTN","IBECUS21",19,0)
 ; - don't process duplicate transactions
"RTN","IBECUS21",20,0)
 I $E(IBRESP(1),17)="D" Q
"RTN","IBECUS21",21,0)
 ;
"RTN","IBECUS21",22,0)
 ; - find transaction entry or create a new one
"RTN","IBECUS21",23,0)
 S IBCHTRN=$O(^IBA(351.5,"B",IBKEY,0))
"RTN","IBECUS21",24,0)
 I 'IBCHTRN D
"RTN","IBECUS21",25,0)
 .S I=$P(^IBA(351.5,0),"^",3)
"RTN","IBECUS21",26,0)
 .F  S I=I+1 L +^IBA(351.5,I):1 Q:$T&'$D(^IBA(351.5,I))  L -^IBA(351.5,I)
"RTN","IBECUS21",27,0)
 .S ^IBA(351.5,I,0)=IBKEY,^IBA(351.5,"B",IBKEY,I)=""
"RTN","IBECUS21",28,0)
 .S ^IBA(351.5,0)=$P(^IBA(351.5,0),"^",1,2)_"^"_I_"^"_($P(^IBA(351.5,0),"^",4)+1)
"RTN","IBECUS21",29,0)
 .S IBCHTRN=I L -^IBA(351.5,IBCHTRN)
"RTN","IBECUS21",30,0)
 ;
"RTN","IBECUS21",31,0)
 ; - prepare i/o for filing
"RTN","IBECUS21",32,0)
 S IBPROC("I")="" F IBI=1:1:2 S IBPROC("I")=IBPROC("I")_$G(IBRESP(IBI))
"RTN","IBECUS21",33,0)
 S IBPROC("O")="" F IBI=1:1:5 S IBPROC("O")=IBPROC("O")_$G(IBLINE(IBI))
"RTN","IBECUS21",34,0)
 S IBPROC("O")=$E(IBPROC("O"),3,999)
"RTN","IBECUS21",35,0)
 ;
"RTN","IBECUS21",36,0)
 ; - file transaction data
"RTN","IBECUS21",37,0)
 S $P(^IBA(351.5,IBCHTRN,0),"^",2,6)=DFN_"^"_$P(IBCDFND,"^",2)_"^"_$TR(IBDRX("NDC"),"-","")_"^"_$J((+IBUAC/100),0,2)_"^"_IBDRX("QTY")
"RTN","IBECUS21",38,0)
 F IBI=1:1 S IBTABLE=$T(TABLE+IBI) Q:$P(IBTABLE,";",3)="$END"  D
"RTN","IBECUS21",39,0)
 .Q:$P(IBTABLE,";",4)<2
"RTN","IBECUS21",40,0)
 .;
"RTN","IBECUS21",41,0)
 .; - file only the 0th node for rejects
"RTN","IBECUS21",42,0)
 .I $E(IBRESP(1),17)="R",$P(IBTABLE,";",4)>1 Q
"RTN","IBECUS21",43,0)
 .;
"RTN","IBECUS21",44,0)
 .S X="" I $P(IBTABLE,";",6)'?1.N X $P(IBTABLE,";",6)
"RTN","IBECUS21",45,0)
 .I X="" S X=$E(IBPROC($P(IBTABLE,";",3)),$P(IBTABLE,";",6),$P(IBTABLE,";",7))
"RTN","IBECUS21",46,0)
 .I $P(IBTABLE,";",2)["D" Q:'X  D DOLLAR
"RTN","IBECUS21",47,0)
 .;
"RTN","IBECUS21",48,0)
 .; - file each field individually
"RTN","IBECUS21",49,0)
 .I X]"" S $P(^IBA(351.5,IBCHTRN,$P(IBTABLE,";",4)),"^",$P(IBTABLE,";",5))=X
"RTN","IBECUS21",50,0)
 ;
"RTN","IBECUS21",51,0)
 ; - delete cancellation authorization number
"RTN","IBECUS21",52,0)
 S $P(^IBA(351.5,IBCHTRN,6),"^")=""
"RTN","IBECUS21",53,0)
 ;
"RTN","IBECUS21",54,0)
 ; - handle rejects, update transaction date and cross reference
"RTN","IBECUS21",55,0)
 D REJECT
"RTN","IBECUS21",56,0)
 S DIQUIET=1 D DT^DICRW S $P(^IBA(351.5,IBCHTRN,0),U,7)=DT
"RTN","IBECUS21",57,0)
 S DA=IBCHTRN,DIK="^IBA(351.5," D IX^DIK
"RTN","IBECUS21",58,0)
 Q
"RTN","IBECUS21",59,0)
 ;
"RTN","IBECUS21",60,0)
 ;
"RTN","IBECUS21",61,0)
DOLLAR ; Convert cents to dollars.
"RTN","IBECUS21",62,0)
 S X=$E(X,1,($L(X)-2))_"."_$E(X,($L(X)-1),$L(X))
"RTN","IBECUS21",63,0)
 F  Q:$E(X,1)'=0  S X=$E(X,2,999)
"RTN","IBECUS21",64,0)
 Q
"RTN","IBECUS21",65,0)
 ;
"RTN","IBECUS21",66,0)
 ;
"RTN","IBECUS21",67,0)
REJECT ; Act on billing rejects.
"RTN","IBECUS21",68,0)
 ;
"RTN","IBECUS21",69,0)
 ; - file reject information
"RTN","IBECUS21",70,0)
 S IBREJ="" I $E(IBRESP(1),17)="R" D
"RTN","IBECUS21",71,0)
 .F IBJ=20:2 S IBJA=$E(IBRESP(1),IBJ,IBJ+1) Q:IBJA="  "!(IBJA="")  D
"RTN","IBECUS21",72,0)
 ..S IBERRP=$$ERRIEN^IBECUS22("UNIVERSAL",IBJA)
"RTN","IBECUS21",73,0)
 ..I IBERRP S IBREJ=IBREJ_","_IBERRP
"RTN","IBECUS21",74,0)
 S:$L(IBREJ) IBREJ=$E(IBREJ,2,999)
"RTN","IBECUS21",75,0)
 S ^IBA(351.5,IBCHTRN,5)=IBREJ
"RTN","IBECUS21",76,0)
 ;
"RTN","IBECUS21",77,0)
 ; - if the transaction was not rejected, delete the existing
"RTN","IBECUS21",78,0)
 ;   reject entry if it exists
"RTN","IBECUS21",79,0)
 S IBCHREJ=$O(^IBA(351.52,"B",IBKEY,0))
"RTN","IBECUS21",80,0)
 I IBREJ="" D  G REJECTQ
"RTN","IBECUS21",81,0)
 .I IBCHREJ S DA=IBCHREJ,DIK="^IBA(351.52," D ^DIK K DA,DIK
"RTN","IBECUS21",82,0)
 ;
"RTN","IBECUS21",83,0)
 ; - add a new reject entry if necessary
"RTN","IBECUS21",84,0)
 I 'IBCHREJ D ADDREJ
"RTN","IBECUS21",85,0)
 ;
"RTN","IBECUS21",86,0)
 ; - update reject file
"RTN","IBECUS21",87,0)
 S DA=IBCHTRN,DIE="^IBA(351.52,",DR=".02////"_IBCHTRN_";.03////"_DT
"RTN","IBECUS21",88,0)
 D ^DIE K DA,DIE,DR
"RTN","IBECUS21",89,0)
 S ^IBA(351.52,IBCHREJ,1)=IBREJ
"RTN","IBECUS21",90,0)
 ;
"RTN","IBECUS21",91,0)
 ; - generate a reject alert
"RTN","IBECUS21",92,0)
 S XQA("G.IB CHAMP RX REJ")="",XQA(+$P(IBKEYD,"^",3))=""
"RTN","IBECUS21",93,0)
 S XQAMSG="Prescription #"_IBDRX("RX#")_" rejected for reason #"_IBREJ
"RTN","IBECUS21",94,0)
 S XQADATA=IBDRX("RX#")_"^"_IBREJ_"^"_DFN,XQAROU="DISP^IBECUS22"
"RTN","IBECUS21",95,0)
 D SETUP^XQALERT
"RTN","IBECUS21",96,0)
 ;
"RTN","IBECUS21",97,0)
 ; - remove prescription from queue
"RTN","IBECUS21",98,0)
 I $P($G(^IBE(351.51,+IBREJ,0)),"^",2)<89 K ^IBA(351.5,"APOST",IBKEY)
"RTN","IBECUS21",99,0)
REJECTQ Q
"RTN","IBECUS21",100,0)
 ;
"RTN","IBECUS21",101,0)
 ;
"RTN","IBECUS21",102,0)
ADDREJ ; Add stub entry to the Reject file.
"RTN","IBECUS21",103,0)
 S I=$P(^IBA(351.52,0),"^",3)
"RTN","IBECUS21",104,0)
 F  S I=I+1 L +^IBA(351.52,I):1 Q:$T&'$D(^IBA(351.52,I))  L -^IBA(351.52,I)
"RTN","IBECUS21",105,0)
 S ^IBA(351.52,I,0)=IBKEY,^IBA(351.52,"B",IBKEY,I)=""
"RTN","IBECUS21",106,0)
 S ^IBA(351.52,0)=$P(^IBA(351.52,0),"^",1,2)_"^"_I_"^"_($P(^IBA(351.52,0),"^",4)+1)
"RTN","IBECUS21",107,0)
 S IBCHREJ=I L -^IBA(351.52,I)
"RTN","IBECUS21",108,0)
 Q
"RTN","IBECUS21",109,0)
 ;
"RTN","IBECUS21",110,0)
 ;
"RTN","IBECUS21",111,0)
TABLE ; Table of field positions and file locations in file #351.5.
"RTN","IBECUS21",112,0)
 ;;O;0;2;S X=DFN
"RTN","IBECUS21",113,0)
 ;;O;0;3;48;65
"RTN","IBECUS21",114,0)
 ;;O;0;4;268;278
"RTN","IBECUS21",115,0)
 ;D;O;0;5;280;285
"RTN","IBECUS21",116,0)
 ;;O;0;6;259;263
"RTN","IBECUS21",117,0)
 ;D;I;2;1;18;23
"RTN","IBECUS21",118,0)
 ;D;I;2;2;24;29
"RTN","IBECUS21",119,0)
 ;D;I;2;3;30;35
"RTN","IBECUS21",120,0)
 ;D;I;2;4;36;41
"RTN","IBECUS21",121,0)
 ;D;I;2;5;42;47
"RTN","IBECUS21",122,0)
 ;;I;2;6;48;61
"RTN","IBECUS21",123,0)
 ;;I;2;7;62;101
"RTN","IBECUS21",124,0)
 ;D;I;3;1;102;109
"RTN","IBECUS21",125,0)
 ;D;I;3;2;110;117
"RTN","IBECUS21",126,0)
 ;D;I;3;3;118;125
"RTN","IBECUS21",127,0)
 ;D;I;3;4;126;131
"RTN","IBECUS21",128,0)
 ;D;I;3;5;132;137
"RTN","IBECUS21",129,0)
 ;D;I;3;6;138;143
"RTN","IBECUS21",130,0)
 ;D;I;3;7;144;149
"RTN","IBECUS21",131,0)
 ;D;I;3;8;150;155
"RTN","IBECUS21",132,0)
 ;;I;3;9;156;157
"RTN","IBECUS21",133,0)
 ;D;I;3;10;158;163
"RTN","IBECUS21",134,0)
 ;;I;7;1;164;323
"RTN","IBECUS21",135,0)
 ;;I;8;1;324;403
"RTN","IBECUS21",136,0)
 ;;$END
"RTN","IBECUS22")
0^18^B7141414
"RTN","IBECUS22",1,0)
IBECUS22 ;RLM/DVAMC - TRICARE PHARMACY BILLING UTILITIES ; 14-AUG-96
"RTN","IBECUS22",2,0)
 ;;2.0;INTEGRATED BILLING;**52,89,240**;21-MAR-94
"RTN","IBECUS22",3,0)
 ;
"RTN","IBECUS22",4,0)
ERROR ; File errors.
"RTN","IBECUS22",5,0)
 ;  Input:  IBERR [opt]  --  DHCP Error Code
"RTN","IBECUS22",6,0)
 ;         IBDRX("RX#")  --  Prescription Number
"RTN","IBECUS22",7,0)
 ;      IBRESP(1) [opt]  --  First record transmitted by the FI
"RTN","IBECUS22",8,0)
 ;                IBKEY  --  1 ; 2, where
"RTN","IBECUS22",9,0)
 ;                             1 = Pointer to the rx in file #52
"RTN","IBECUS22",10,0)
 ;                             2 = Pointer to the refill in file #52.1,
"RTN","IBECUS22",11,0)
 ;                                 or 0 for the original fill
"RTN","IBECUS22",12,0)
 ;               IBKEYD  --  1 ^ 2 ^ 3 ^ 4, where
"RTN","IBECUS22",13,0)
 ;                             1 = Rx label printing device
"RTN","IBECUS22",14,0)
 ;                             2 = Pointer to the Pharmacy in file #59
"RTN","IBECUS22",15,0)
 ;                             3 = Pointer to the Pharmacy user in
"RTN","IBECUS22",16,0)
 ;                                 file #200
"RTN","IBECUS22",17,0)
 ;                             4 = Pointer to the billing transaction
"RTN","IBECUS22",18,0)
 ;                                 in file #351.5 (cancellations only)
"RTN","IBECUS22",19,0)
 ;
"RTN","IBECUS22",20,0)
 I '$G(IBERR) S IBERC=$E(IBRESP(1),1,3)
"RTN","IBECUS22",21,0)
 I $G(IBERR) K ^IBA(351.5,"APOST",IBKEY) S IBERC=IBERR
"RTN","IBECUS22",22,0)
 S IBMACH=$S($D(IBERR):"DHCP",1:"MLINK")
"RTN","IBECUS22",23,0)
 K IBERR,IBTXT
"RTN","IBECUS22",24,0)
 ;
"RTN","IBECUS22",25,0)
 ; - expand the code if necessary
"RTN","IBECUS22",26,0)
 I $D(IBRESP(1)),$E(IBRESP(1),1,3)="   " S IBERC="001"
"RTN","IBECUS22",27,0)
 I IBERC?1.N S IBERC=+IBERC F  Q:$L(IBERC)>1  S IBERC="0"_IBERC
"RTN","IBECUS22",28,0)
 S IBERRP=$$ERRIEN(IBMACH,IBERC)
"RTN","IBECUS22",29,0)
 ;
"RTN","IBECUS22",30,0)
 ; - send bulletin to the Reject Notice group
"RTN","IBECUS22",31,0)
 S IBTXT(1)=IBMACH_" has detected error #"_IBERC_" while processing RX# "_$S($G(IBDRX("RX#"))]"":IBDRX("RX#"),1:"Unknown")
"RTN","IBECUS22",32,0)
 S IBTXT(2)="Error text: "_$$ERRTXT(IBERRP)
"RTN","IBECUS22",33,0)
 S XMDUN="TRICARE PHARMACY BILLING",XMDUZ=.5,XMSUB="Tricare/IPS Billing Error"
"RTN","IBECUS22",34,0)
 S XMTEXT="IBTXT(",XMY("G.IB CHAMP RX REJ")="",XMY(+$P(IBKEYD,"^",3))=""
"RTN","IBECUS22",35,0)
 S DIQUIET=1 D DT^DICRW,^XMD
"RTN","IBECUS22",36,0)
 ;
"RTN","IBECUS22",37,0)
 ; - file the rejected transaction
"RTN","IBECUS22",38,0)
 S IBCHREJ=$O(^IBA(351.52,"B",IBKEY,0))
"RTN","IBECUS22",39,0)
 I 'IBCHREJ D ADDREJ^IBECUS21
"RTN","IBECUS22",40,0)
 I IBCHREJ S $P(^IBA(351.52,IBCHREJ,0),"^",3)=DT,^(1)=IBERRP
"RTN","IBECUS22",41,0)
 K IBERC,IBERRP,IBTXT,IBMACH,XMDUN,XMDUZ,XMSUB,XMTEXT,XMY,XMZ
"RTN","IBECUS22",42,0)
 Q
"RTN","IBECUS22",43,0)
 ;
"RTN","IBECUS22",44,0)
 ;
"RTN","IBECUS22",45,0)
DUP ; Act on duplicates.
"RTN","IBECUS22",46,0)
 S XQA("G.IB CHAMP RX REJ")=""
"RTN","IBECUS22",47,0)
 S XQAMSG="Prescription #"_$S($G(IBDRX("RX#"))]"":IBDRX("RX#"),1:"Unknown")_" is a duplicate submission."
"RTN","IBECUS22",48,0)
 D SETUP^XQALERT
"RTN","IBECUS22",49,0)
 K ^IBA(351.5,"APOST",IBKEY)
"RTN","IBECUS22",50,0)
 Q
"RTN","IBECUS22",51,0)
 ;
"RTN","IBECUS22",52,0)
 ;
"RTN","IBECUS22",53,0)
DISP ; Display Universal errors on alerts.
"RTN","IBECUS22",54,0)
 N ERR,TXT,X,Y
"RTN","IBECUS22",55,0)
 S Y=$G(^DPT(+$P(XQADATA,"^",3),0))
"RTN","IBECUS22",56,0)
 W !!,"RX# ",$P(XQADATA,"^")," for ",$P(Y,"^")," (",$E($P(Y,"^",9),6,10),") rejected because:"
"RTN","IBECUS22",57,0)
 S XQADATA=$P(XQADATA,"^",2)
"RTN","IBECUS22",58,0)
 F X=1:1 S ERR=$P(XQADATA,",",X) Q:ERR=""  D
"RTN","IBECUS22",59,0)
 .S TXT=$$ERRTXT(ERR)
"RTN","IBECUS22",60,0)
 .I TXT]"" W !?3,TXT
"RTN","IBECUS22",61,0)
 W !!,"Press ENTER key to continue..." R X:DTIME
"RTN","IBECUS22",62,0)
 Q
"RTN","IBECUS22",63,0)
 ;
"RTN","IBECUS22",64,0)
 ;
"RTN","IBECUS22",65,0)
ERRTXT(IEN) ; Return Error Text.
"RTN","IBECUS22",66,0)
 ;  Input:   IEN  --  Pointer to the Error Text in file #351.51
"RTN","IBECUS22",67,0)
 Q $P($G(^IBE(351.51,+$G(IEN),0)),"^",3)
"RTN","IBECUS22",68,0)
 ;
"RTN","IBECUS22",69,0)
ERRIEN(MACH,CODE) ; Return Error File Entry Number.
"RTN","IBECUS22",70,0)
 ;  Input:   MACH  --  System on which the error occurred
"RTN","IBECUS22",71,0)
 ;           CODE  --  Error Code
"RTN","IBECUS22",72,0)
 N X S X=""
"RTN","IBECUS22",73,0)
 I $G(MACH)="" G ERRIENQ
"RTN","IBECUS22",74,0)
 I $G(CODE)="" G ERRIENQ
"RTN","IBECUS22",75,0)
 S X=$O(^IBE(351.51,"AD",MACH,CODE,0))
"RTN","IBECUS22",76,0)
ERRIENQ Q X
"RTN","IBECUS3")
0^19^B7684142
"RTN","IBECUS3",1,0)
IBECUS3 ;RLM/DVAMC - CANCEL TRICARE PHARMACY TRANSACTION ; 14-AUG-96
"RTN","IBECUS3",2,0)
 ;;2.0;INTEGRATED BILLING;**52,89,240**;21-MAR-94
"RTN","IBECUS3",3,0)
 ;
"RTN","IBECUS3",4,0)
EN ; Transmit a cancellation transaction.
"RTN","IBECUS3",5,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBECUS3",6,0)
 ;                           1 = Pointer to the prescription in file #52
"RTN","IBECUS3",7,0)
 ;                           2 = Pointer to the refill in file #52.1, or
"RTN","IBECUS3",8,0)
 ;                               0 for the original fill
"RTN","IBECUS3",9,0)
 ;           IBKEYD  --  1 ^ 2 ^ 3 ^ 4, where
"RTN","IBECUS3",10,0)
 ;                         1 = Rx label printing device
"RTN","IBECUS3",11,0)
 ;                         2 = Pointer to the Pharmacy in file #59
"RTN","IBECUS3",12,0)
 ;                         3 = Pointer to the Pharmacy user in file #200
"RTN","IBECUS3",13,0)
 ;                         4 = Pointer to the billing transaction
"RTN","IBECUS3",14,0)
 ;                             in file #351.5 (cancellations only)
"RTN","IBECUS3",15,0)
 ;
"RTN","IBECUS3",16,0)
 ; - bleed off queue
"RTN","IBECUS3",17,0)
 F  R *IBI:0 Q:IBI=-1
"RTN","IBECUS3",18,0)
 ;
"RTN","IBECUS3",19,0)
 ; - get rx data; make sure there is an NDC
"RTN","IBECUS3",20,0)
 K IBDRX,IBERR
"RTN","IBECUS3",21,0)
 I $$TRANS^PSOCPTRI(+IBKEY,+$P(IBKEY,";",2),.IBDRX)<0 S IBERR=1 G ENQ
"RTN","IBECUS3",22,0)
 ;
"RTN","IBECUS3",23,0)
 ; - must be a billing transaction for the cancellation
"RTN","IBECUS3",24,0)
 S IBCHTRN=+$P(IBKEYD,"^",4)
"RTN","IBECUS3",25,0)
 S IBCHTRND=$G(^IBA(351.5,IBCHTRN,0))
"RTN","IBECUS3",26,0)
 I 'IBCHTRND S IBERR=8 G ENQ
"RTN","IBECUS3",27,0)
 S DFN=+$P(IBCHTRND,"^",2)
"RTN","IBECUS3",28,0)
 I 'DFN S IBERR=4 G ENQ
"RTN","IBECUS3",29,0)
 ;
"RTN","IBECUS3",30,0)
 ; - is patient covered by TRICARE?
"RTN","IBECUS3",31,0)
 S IBCDFN=$$CUS^IBACUS(DFN,DT)
"RTN","IBECUS3",32,0)
 I 'IBCDFN S IBERR=2 G ENQ
"RTN","IBECUS3",33,0)
 ;
"RTN","IBECUS3",34,0)
 ; - get the BIN Number for the insurance company
"RTN","IBECUS3",35,0)
 S IBCDFND=$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBECUS3",36,0)
 S IBBIN=$P($G(^DIC(36,+IBCDFND,3)),"^",3)
"RTN","IBECUS3",37,0)
 I $L(IBBIN)'=6 S IBERR=5 G ENQ
"RTN","IBECUS3",38,0)
 ;
"RTN","IBECUS3",39,0)
 ; - build transmission:
"RTN","IBECUS3",40,0)
 ;        o pharmacy division
"RTN","IBECUS3",41,0)
 ;        o FI identifier (bin number)
"RTN","IBECUS3",42,0)
 ;        o commercial software package version (32)
"RTN","IBECUS3",43,0)
 ;        o cancellation transaction code  (11)
"RTN","IBECUS3",44,0)
 ;        o control # (currently 10 spaces)
"RTN","IBECUS3",45,0)
 ;        o pharmacy # (currently 12 spaces)
"RTN","IBECUS3",46,0)
 ;        o rx fill date
"RTN","IBECUS3",47,0)
 ;        o prescription number
"RTN","IBECUS3",48,0)
 ;
"RTN","IBECUS3",49,0)
 ;        (pharmacy number [abp] ??)
"RTN","IBECUS3",50,0)
 ;        S JADNUM=$S($P(JADPSRX(2),"^",9)=1:7745017,1:7745029),JADLEN=12 D LJUST^JADNC S JADNABP=JADNUM
"RTN","IBECUS3",51,0)
 ;
"RTN","IBECUS3",52,0)
 S IBLINE(1)=$$FILL^IBECUS2(IBDRX("DIV"),2)_IBBIN_"3211"_$J("",10)_$J("",12)
"RTN","IBECUS3",53,0)
 S IBLINE(1)=IBLINE(1)_$$DATE^IBECUS2(IBDRX("FDT"))
"RTN","IBECUS3",54,0)
 S IBLINE(1)=IBLINE(1)_$$FILL^IBECUS2(IBDRX("RX#"),7)
"RTN","IBECUS3",55,0)
 ;
"RTN","IBECUS3",56,0)
 ; - transmit
"RTN","IBECUS3",57,0)
 W IBLINE(1),!
"RTN","IBECUS3",58,0)
 ;
"RTN","IBECUS3",59,0)
 ; - receive
"RTN","IBECUS3",60,0)
 R IBRESP(1)#100:120 I '$L(IBRESP(1)) S IBERR=6 G ENQ
"RTN","IBECUS3",61,0)
 ;
"RTN","IBECUS3",62,0)
 ; - handle errors
"RTN","IBECUS3",63,0)
 I $E(IBRESP(1),1,3) D ERROR^IBECUS22 G ENQ
"RTN","IBECUS3",64,0)
 ;
"RTN","IBECUS3",65,0)
 ; - handle rejects
"RTN","IBECUS3",66,0)
 S IBRESP(1)=$E(IBRESP(1),3,999)
"RTN","IBECUS3",67,0)
 I $E(IBRESP(1),5)="R" D REJECT G ENQ
"RTN","IBECUS3",68,0)
 ;
"RTN","IBECUS3",69,0)
 ; - update cancellation auth number and user
"RTN","IBECUS3",70,0)
 S ^IBA(351.5,IBCHTRN,6)=$E(IBRESP(1),6,19)_"^"_+$P(IBKEYD,"^",3)
"RTN","IBECUS3",71,0)
 K ^IBA(351.5,"APOST",IBKEY)
"RTN","IBECUS3",72,0)
 ;
"RTN","IBECUS3",73,0)
 ; - Queue task to cancel charges
"RTN","IBECUS3",74,0)
 D TASK^IBECUS2("RXCAN;Rx Cancellation")
"RTN","IBECUS3",75,0)
 ;
"RTN","IBECUS3",76,0)
ENQ I $G(IBERR) D ERROR^IBECUS22
"RTN","IBECUS3",77,0)
 Q
"RTN","IBECUS3",78,0)
 ;
"RTN","IBECUS3",79,0)
 ;
"RTN","IBECUS3",80,0)
REJECT ; Send alert for a reject.
"RTN","IBECUS3",81,0)
 S IBREJ=""
"RTN","IBECUS3",82,0)
 F IBRJ=8:2 S IBRJA=$E(IBRESP(1),IBRJ,IBRJ+1) Q:IBRJA="  "!(IBRJA="")  D
"RTN","IBECUS3",83,0)
 .S IBERRP=$$ERRIEN^IBECUS22("UNIVERSAL",IBRJA)
"RTN","IBECUS3",84,0)
 .I IBERRP S IBREJ=IBREJ_","_IBERRP
"RTN","IBECUS3",85,0)
 S IBREJ=$E(IBREJ,2,999)
"RTN","IBECUS3",86,0)
 ;
"RTN","IBECUS3",87,0)
 S XQA("G.IB CHAMP RX REJ")="",XQA(+$P(IBKEYD,"^",3))=""
"RTN","IBECUS3",88,0)
 S XQAMSG="Reversal for prescription #"_IBDRX("RX#")_" rejected for reason #"_IBREJ
"RTN","IBECUS3",89,0)
 S XQADATA=IBDRX("RX#")_"^"_IBREJ_"^"_DFN,XQAROU="DISP^IBECUS22"
"RTN","IBECUS3",90,0)
 D SETUP^XQALERT
"RTN","IBECUS3",91,0)
 ;
"RTN","IBECUS3",92,0)
 ; - update transaction file with reject codes
"RTN","IBECUS3",93,0)
 S $P(^IBA(351.5,IBCHTRN,6),"^",3)=IBREJ
"RTN","IBECUS3",94,0)
 ;
"RTN","IBECUS3",95,0)
 K IBERRP,IBREJ,IBRJ,IBRJA
"RTN","IBECUS3",96,0)
 Q
"RTN","IBECUSM")
0^20^B34135929
"RTN","IBECUSM",1,0)
IBECUSM ;DVAMC/RLM - TRICARE PHARMACY BILLING OPTIONS; 20-AUG-96
"RTN","IBECUSM",2,0)
 ;;2.0;INTEGRATED BILLING;**52,162,240**;21-MAR-94
"RTN","IBECUSM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECUSM",4,0)
 ;
"RTN","IBECUSM",5,0)
 ;
"RTN","IBECUSM",6,0)
REV ; Reverse a claim already submitted to the Fiscal Intermediary.
"RTN","IBECUSM",7,0)
 I '$P($G(^IBE(350.9,1,9)),"^",4) W !!,"Please note that your TRICARE Pharmacy billing interface is not running!",!
"RTN","IBECUSM",8,0)
REVA K DIR S DIR(0)="P^52",DIR("A")="Enter the RX# you wish to reverse"
"RTN","IBECUSM",9,0)
 W ! D ^DIR K DIR S IBRX=+Y
"RTN","IBECUSM",10,0)
 I Y<1!($D(DUOUT))!($D(DIRUT)) G REVQ
"RTN","IBECUSM",11,0)
 W !!,"Prescription: ",$P(Y,"^",2),!,"     Patient: ",$P($G(^DPT(+$P($G(^PSRX(+Y,0)),"^",2),0)),"^")
"RTN","IBECUSM",12,0)
 ;
"RTN","IBECUSM",13,0)
 ; - has this prescription been billed?
"RTN","IBECUSM",14,0)
 K IBARR,IBCAN S (IBKEY,IBKEYS)=IBRX_";"
"RTN","IBECUSM",15,0)
 F  S IBKEY=$O(^IBA(351.5,"B",IBKEY)) Q:$E(IBKEY,1,$L(IBKEYS))'=IBKEYS  S IBARR(IBKEY)=+$O(^(IBKEY,0))
"RTN","IBECUSM",16,0)
 I '$D(IBARR) W !!,"This prescription has not yet been billed." G REVA
"RTN","IBECUSM",17,0)
 ;
"RTN","IBECUSM",18,0)
 ; - find all potential transactions
"RTN","IBECUSM",19,0)
 D FINDC^IBECUSMU(.IBARR,1,.IBCAN)
"RTN","IBECUSM",20,0)
 S IBKEY=$O(IBCAN("")) I IBKEY="" G REVA
"RTN","IBECUSM",21,0)
 ;
"RTN","IBECUSM",22,0)
 ; - there's just one
"RTN","IBECUSM",23,0)
 I $O(IBCAN(IBKEY))="" S IBCHTRN=IBCAN(IBKEY) W !!,$S($P(IBKEY,";",2):"Refill #"_$P(IBKEY,";",2),1:"The original fill")," for this prescription can be cancelled." G OKAYC
"RTN","IBECUSM",24,0)
 ;
"RTN","IBECUSM",25,0)
 ; - more than 1; must select from the list
"RTN","IBECUSM",26,0)
 W !!,"More than one fill for rx# ",$P($G(^PSRX(IBRX,0)),"^")," may be cancelled."
"RTN","IBECUSM",27,0)
 S IBREF=$$SEL^IBECUSMU(.IBCAN)
"RTN","IBECUSM",28,0)
 I IBREF<0 G REVQ
"RTN","IBECUSM",29,0)
 ;
"RTN","IBECUSM",30,0)
 S IBKEY=IBRX_";"_IBREF,IBCHTRN=IBCAN(IBKEY)
"RTN","IBECUSM",31,0)
 ;
"RTN","IBECUSM",32,0)
OKAYC ; - okay to cancel?
"RTN","IBECUSM",33,0)
 S DIR("A")="Is it okay to cancel this prescription"
"RTN","IBECUSM",34,0)
 S DIR(0)="Y" D ^DIR K DIR
"RTN","IBECUSM",35,0)
 I 'Y!($D(DUOUT))!($D(DIRUT)) W !,"The claim reversal was NOT submitted." G REVQ
"RTN","IBECUSM",36,0)
 ;
"RTN","IBECUSM",37,0)
 ; - queue cancellation for submittal
"RTN","IBECUSM",38,0)
 S ^IBA(351.5,"APOST",IBKEY)="REVERSE^^"_DUZ_"^"_IBCHTRN
"RTN","IBECUSM",39,0)
 W !,"The claim reversal has been submitted."
"RTN","IBECUSM",40,0)
REVQ K DIROUT,DIRUT,DTOUR,DUOUT,IBRX,IBARR,IBCAN,IBKEY,IBKEYS,IBCHTRN,IBREF
"RTN","IBECUSM",41,0)
 Q
"RTN","IBECUSM",42,0)
 ;
"RTN","IBECUSM",43,0)
 ;
"RTN","IBECUSM",44,0)
 ;
"RTN","IBECUSM",45,0)
RESUB ; Resubmit a claim to the Fiscal Intermediary.
"RTN","IBECUSM",46,0)
 I '$P($G(^IBE(350.9,1,9)),"^",4) W !!,"Please note that your TRICARE Pharmacy billing interface is not running!",!
"RTN","IBECUSM",47,0)
RESUBA K DIR S DIR(0)="P^52",DIR("A")="Enter the RX# you wish to resubmit"
"RTN","IBECUSM",48,0)
 W ! D ^DIR K DIR S IBRX=+Y
"RTN","IBECUSM",49,0)
 I Y<1!($D(DUOUT))!($D(DIRUT)) G RESUBQ
"RTN","IBECUSM",50,0)
 S DFN=+$P($G(^PSRX(+Y,0)),"^",2)
"RTN","IBECUSM",51,0)
 W !!,"Prescription: ",$P(Y,"^",2),!,"     Patient: ",$P($G(^DPT(DFN,0)),"^")
"RTN","IBECUSM",52,0)
 ;
"RTN","IBECUSM",53,0)
 ; - find all potential transactions
"RTN","IBECUSM",54,0)
 K IBBIL D FINDB^IBECUSMU(IBRX,1,.IBBIL)
"RTN","IBECUSM",55,0)
 S IBKEY=$O(IBBIL("")) I IBKEY="" G RESUBA
"RTN","IBECUSM",56,0)
 ;
"RTN","IBECUSM",57,0)
 ; - there's just one
"RTN","IBECUSM",58,0)
 I $O(IBBIL(IBKEY))="" W !!,$S($P(IBKEY,";",2):"Refill #"_$P(IBKEY,";",2),1:"The original fill")," for this prescription can be billed." G IBPSR
"RTN","IBECUSM",59,0)
 ;
"RTN","IBECUSM",60,0)
 ; - more than 1; must select from the list
"RTN","IBECUSM",61,0)
 W !!,"More than one fill for rx# ",$P($G(^PSRX(IBRX,0)),"^")," may be billed."
"RTN","IBECUSM",62,0)
 S IBREF=$$SEL^IBECUSMU(.IBBIL)
"RTN","IBECUSM",63,0)
 I IBREF<0 G RESUBQ
"RTN","IBECUSM",64,0)
 ;
"RTN","IBECUSM",65,0)
 S IBKEY=IBRX_";"_IBREF
"RTN","IBECUSM",66,0)
 ;
"RTN","IBECUSM",67,0)
IBPSR ;Ask for the Product Selection Reason
"RTN","IBECUSM",68,0)
 N DIR,DIE,DR,X,Y,DA
"RTN","IBECUSM",69,0)
 S DIR("B")=$S($P($G(^IBA(351.5,+IBBIL(IBKEY),0)),"^",10):$P(^IBA(351.53,$P(^(0),"^",10),0),"^"),1:0)
"RTN","IBECUSM",70,0)
 S DIR(0)="PO^351.53" D ^DIR I Y=-1 W !,"The prescription was NOT submitted for billing." G RESUBQ
"RTN","IBECUSM",71,0)
 S DA=+$G(IBBIL(IBKEY)),DIE="^IBA(351.5,",DR=".10////"_(+Y) D ^DIE
"RTN","IBECUSM",72,0)
 K DIR
"RTN","IBECUSM",73,0)
OKAYB ; - okay to bill?
"RTN","IBECUSM",74,0)
 S DIR("A")="Is it okay to bill this prescription"
"RTN","IBECUSM",75,0)
 S DIR(0)="Y" D ^DIR
"RTN","IBECUSM",76,0)
 I 'Y!($D(DUOUT))!($D(DIRUT)) W !,"The prescription was NOT submitted for billing." G RESUBQ
"RTN","IBECUSM",77,0)
 ;
"RTN","IBECUSM",78,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","IBECUSM",79,0)
 I '$D(PSOLAP) W !!,*7,"The label printer is not defined!",!,"The prescription has NOT been submitted for billing." G RESUBQ
"RTN","IBECUSM",80,0)
 S ^IBA(351.5,"APOST",IBKEY)=PSOLAP_"^"_PSOSITE_"^"_DUZ_"^^"_$P($G(^IBA(351.5,+IBBIL(IBKEY),0)),"^",10)
"RTN","IBECUSM",81,0)
 W !,"The prescription has been submitted for billing."
"RTN","IBECUSM",82,0)
 ;
"RTN","IBECUSM",83,0)
RESUBQ K DIROUT,DIRUT,DTOUR,DUOUT,IBRX,DFN,IBBIL,IBKEY,IBREF
"RTN","IBECUSM",84,0)
 K PSOBAR0,PSOBAR1,PSOBARS,PSOCLC,PSOCNT,PSODIV,PSODTCUT
"RTN","IBECUSM",85,0)
 K PSOLAP,PSOPAR,PSOPAR7,PSOPRPAS,PSOSITE
"RTN","IBECUSM",86,0)
 Q
"RTN","IBECUSM",87,0)
 ;
"RTN","IBECUSM",88,0)
 ;
"RTN","IBECUSM",89,0)
 ;
"RTN","IBECUSM",90,0)
DREJ ; Delete an entry from the Reject (#351.52) file.
"RTN","IBECUSM",91,0)
 I '$P($G(^IBE(350.9,1,9)),"^",4) W !!,"Please note that your TRICARE Pharmacy billing interface is not running!",!
"RTN","IBECUSM",92,0)
DREJA K DIR S DIR(0)="P^52",DIR("A")="Enter the RX# of the rejected transmission"
"RTN","IBECUSM",93,0)
 W ! D ^DIR K DIR S IBRX=+Y
"RTN","IBECUSM",94,0)
 I Y<1!($D(DUOUT))!($D(DIRUT)) G DREJQ
"RTN","IBECUSM",95,0)
 W !!,"Prescription: ",$P(Y,"^",2),!,"     Patient: ",$P($G(^DPT(+$P($G(^PSRX(+Y,0)),"^",2),0)),"^")
"RTN","IBECUSM",96,0)
 ;
"RTN","IBECUSM",97,0)
 ; - is there a reject entry for this prescription?
"RTN","IBECUSM",98,0)
 K IBARR S (IBKEY,IBKEYS)=IBRX_";"
"RTN","IBECUSM",99,0)
 F  S IBKEY=$O(^IBA(351.52,"B",IBKEY)) Q:$E(IBKEY,1,$L(IBKEYS))'=IBKEYS  S IBARR(IBKEY)=+$O(^(IBKEY,0))
"RTN","IBECUSM",100,0)
 I '$D(IBARR) W !!,"There is no reject entry for this prescription." G DREJA
"RTN","IBECUSM",101,0)
 ;
"RTN","IBECUSM",102,0)
 ; - select the reject entry to delete
"RTN","IBECUSM",103,0)
 S IBKEY=$O(IBARR("")) I IBKEY="" G DREJA
"RTN","IBECUSM",104,0)
 I $O(IBARR(IBKEY))="" S IBCHREF=+IBARR(IBKEY) W !!,$S($P(IBKEY,";",2):"Refill #"_$P(IBKEY,";",2),1:"The original fill")," for this prescription has been rejected." G OKAYD
"RTN","IBECUSM",105,0)
 ;
"RTN","IBECUSM",106,0)
 ; - more than 1; must select from the list
"RTN","IBECUSM",107,0)
 W !!,"More than one fill for rx# ",$P($G(^PSRX(IBRX,0)),"^")," has a reject entry."
"RTN","IBECUSM",108,0)
 S IBREF=$$SEL^IBECUSMU(.IBARR)
"RTN","IBECUSM",109,0)
 I IBREF<0 G DREJQ
"RTN","IBECUSM",110,0)
 ;
"RTN","IBECUSM",111,0)
 S IBKEY=IBRX_";"_IBREF,IBCHREF=+$G(IBARR(IBKEY))
"RTN","IBECUSM",112,0)
 ;
"RTN","IBECUSM",113,0)
OKAYD ; - okay to delete the reject?
"RTN","IBECUSM",114,0)
 I '$D(^IBA(351.52,IBCHREF,0)) K ^IBA(351.52,"B",IBKEY) W !!,"Sorry, can't find a reject for this prescription!" G DREJQ
"RTN","IBECUSM",115,0)
 S DIR("A")="Is it okay to delete this reject entry"
"RTN","IBECUSM",116,0)
 S DIR(0)="Y" D ^DIR K DIR
"RTN","IBECUSM",117,0)
 I 'Y!($D(DUOUT))!($D(DIRUT)) W !,"The reject entry was NOT deleted." G DREJQ
"RTN","IBECUSM",118,0)
 ;
"RTN","IBECUSM",119,0)
 ; - delete the entry
"RTN","IBECUSM",120,0)
 S DA=IBCHREF,DIK="^IBA(351.52," D ^DIK K DA,DIK
"RTN","IBECUSM",121,0)
 W !,"The reject entry has been deleted."
"RTN","IBECUSM",122,0)
DREJQ K DIROUT,DIRUT,DTOUR,DUOUT,IBRX,IBARR,IBKEY,IBKEYS,IBCHREF,IBREF
"RTN","IBECUSM",123,0)
 Q
"RTN","IBECUSO")
0^21^B40332782
"RTN","IBECUSO",1,0)
IBECUSO ;RLM/DVAMC - TRICARE PHARMACY BILLING OUTPUTS ; 21-AUG-96
"RTN","IBECUSO",2,0)
 ;;2.0;INTEGRATED BILLING;**52,240**;21-MAR-94
"RTN","IBECUSO",3,0)
 ;
"RTN","IBECUSO",4,0)
REJ ; Generate the Pharmacy Billing Reject report.
"RTN","IBECUSO",5,0)
 ;
"RTN","IBECUSO",6,0)
 ; - quit if there are no rejects
"RTN","IBECUSO",7,0)
 I '$O(^IBA(351.52,0)) W !!,"There are no rejects to be printed." G REJQ
"RTN","IBECUSO",8,0)
 ;
"RTN","IBECUSO",9,0)
 ; - select a device
"RTN","IBECUSO",10,0)
 S %ZIS="QM" D ^%ZIS G:POP REJQ
"RTN","IBECUSO",11,0)
 I $D(IO("Q")) D  G REJQ
"RTN","IBECUSO",12,0)
 .S ZTRTN="REJDQ^IBECUSO",ZTDESC="IB - LIST TRICARE PHARMACY BILLING REJECTS"
"RTN","IBECUSO",13,0)
 .D ^%ZTLOAD W !!,$S($D(ZTSK):"This job has been queued.  The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBECUSO",14,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBECUSO",15,0)
 ;
"RTN","IBECUSO",16,0)
 U IO
"RTN","IBECUSO",17,0)
 ;
"RTN","IBECUSO",18,0)
REJDQ ; Tasked entry point.
"RTN","IBECUSO",19,0)
 ;
"RTN","IBECUSO",20,0)
 S (IBPAG,IBQ)=0 D REJHDR
"RTN","IBECUSO",21,0)
 ;
"RTN","IBECUSO",22,0)
 ; - print rejects
"RTN","IBECUSO",23,0)
 S IBR=0 F  S IBR=$O(^IBA(351.52,IBR)) Q:'IBR  D  Q:IBQ
"RTN","IBECUSO",24,0)
 .S IBR0=$G(^IBA(351.52,IBR,0)),IBR1=$G(^(1))
"RTN","IBECUSO",25,0)
 .Q:'IBR0
"RTN","IBECUSO",26,0)
 .;
"RTN","IBECUSO",27,0)
 .S IBRXD=$G(^PSRX(+IBR0,0)),DFN=$P(IBRXD,"^",2)
"RTN","IBECUSO",28,0)
 .Q:IBRXD=""
"RTN","IBECUSO",29,0)
 .S IBFDT=$$FDT($P(IBR0,"^"))
"RTN","IBECUSO",30,0)
 .;
"RTN","IBECUSO",31,0)
 .; - display the prescription
"RTN","IBECUSO",32,0)
 .I $Y>(IOSL-4) D PAUSE Q:IBQ  D REJHDR
"RTN","IBECUSO",33,0)
 .D REJERR
"RTN","IBECUSO",34,0)
 .;
"RTN","IBECUSO",35,0)
 .; - display errors
"RTN","IBECUSO",36,0)
 .F I=1:1 Q:$P(IBR1,",",I)=""  S IBERRP=$P(IBR1,",",I) Q:IBERRP=""  D  Q:IBQ
"RTN","IBECUSO",37,0)
 ..I $Y>(IOSL-2) D PAUSE Q:IBQ  D REJHDR,REJERR
"RTN","IBECUSO",38,0)
 ..S IBTXT=$$ERRTXT^IBECUS22(IBERRP)
"RTN","IBECUSO",39,0)
 ..I IBTXT]"" W !?4,IBTXT
"RTN","IBECUSO",40,0)
 ;
"RTN","IBECUSO",41,0)
 ; - end-of-report pause
"RTN","IBECUSO",42,0)
 D:'IBQ PAUSE
"RTN","IBECUSO",43,0)
 ;
"RTN","IBECUSO",44,0)
REJQ I '$D(ZTQUEUED) D ^%ZISC
"RTN","IBECUSO",45,0)
 K IBFDT,IBPAG,IBQ,IBR,IBR0,IBR1,IBRXD,DFN,IBERRP,IBTXT
"RTN","IBECUSO",46,0)
 Q
"RTN","IBECUSO",47,0)
 ;
"RTN","IBECUSO",48,0)
 ;
"RTN","IBECUSO",49,0)
REJHDR ; Print the Reject report header.
"RTN","IBECUSO",50,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF,*13
"RTN","IBECUSO",51,0)
 S IBPAG=IBPAG+1
"RTN","IBECUSO",52,0)
 W !,$$DASH(),!,"Date: ",$$DAT1^IBOUTL(DT),?(IOM/2)-14,"IPS Unresolved Reject Report"
"RTN","IBECUSO",53,0)
 W ?(IOM-10),"Page: ",IBPAG,!,$$DASH()
"RTN","IBECUSO",54,0)
 Q
"RTN","IBECUSO",55,0)
 ;
"RTN","IBECUSO",56,0)
REJERR ; Write the prescription and name.
"RTN","IBECUSO",57,0)
 W !!,"RX# ",$P(IBRXD,"^"),", filled on ",$$DAT1^IBOUTL(IBFDT)
"RTN","IBECUSO",58,0)
 W " (",$E($P($G(^DPT(DFN,0)),"^"),1,17)," ",$P($G(^(0)),"^",9),")"
"RTN","IBECUSO",59,0)
 W " rejected because:"
"RTN","IBECUSO",60,0)
 Q
"RTN","IBECUSO",61,0)
 ;
"RTN","IBECUSO",62,0)
DASH() ; Return a dashed line.
"RTN","IBECUSO",63,0)
 Q $TR($J("",IOM)," ","=")
"RTN","IBECUSO",64,0)
 ;
"RTN","IBECUSO",65,0)
PAUSE ; Page break
"RTN","IBECUSO",66,0)
 Q:$E(IOST,1,2)'="C-"
"RTN","IBECUSO",67,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBECUSO",68,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBECUSO",69,0)
 S DIR(0)="E" D ^DIR I $D(DIRUT)!($D(DUOUT)) S IBQ=1
"RTN","IBECUSO",70,0)
 Q
"RTN","IBECUSO",71,0)
 ;
"RTN","IBECUSO",72,0)
 ;
"RTN","IBECUSO",73,0)
 ;
"RTN","IBECUSO",74,0)
TRN ; Generate the Pharmacy Billing Transmission Report
"RTN","IBECUSO",75,0)
 ;
"RTN","IBECUSO",76,0)
 ; - select dates
"RTN","IBECUSO",77,0)
 K DIR S DIR(0)="D^2960101:"_DT,DIR("A")="Beginning Date:" D ^DIR G:$D(DIRUT) TRNQ S IBBEG=Y
"RTN","IBECUSO",78,0)
 K DIR S DIR(0)="D^"_IBBEG_":"_DT,DIR("A")="Ending Date:" D ^DIR G:$D(DIRUT) TRNQ S IBEND=Y
"RTN","IBECUSO",79,0)
 I IBBEG>IBEND W !,"Beginning data must be before ending date.",! G TRN
"RTN","IBECUSO",80,0)
 ;
"RTN","IBECUSO",81,0)
 ; - select a device
"RTN","IBECUSO",82,0)
 S %ZIS="QM" D ^%ZIS G:POP TRNQ
"RTN","IBECUSO",83,0)
 I $D(IO("Q")) D  G TRNQ
"RTN","IBECUSO",84,0)
 .S ZTRTN="TRNDQ^IBECUSO",ZTDESC="IB - LIST TRICARE PHARMACY BILLING TRANSMISSIONS"
"RTN","IBECUSO",85,0)
 .F I="IBBEG","IBEND" S ZTSAVE(I)=""
"RTN","IBECUSO",86,0)
 .D ^%ZTLOAD W !!,$S($D(ZTSK):"This job has been queued.  The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBECUSO",87,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBECUSO",88,0)
 ;
"RTN","IBECUSO",89,0)
 U IO
"RTN","IBECUSO",90,0)
 ;
"RTN","IBECUSO",91,0)
TRNDQ ; Tasked entry point.
"RTN","IBECUSO",92,0)
 ;
"RTN","IBECUSO",93,0)
 S (IBPAG,IBQ)=0 D TRNHDR
"RTN","IBECUSO",94,0)
 ;
"RTN","IBECUSO",95,0)
 ; - print transactions
"RTN","IBECUSO",96,0)
 S IBC=0 F  S IBC=$O(^IBA(351.5,IBC)) Q:'IBC  D  Q:IBQ
"RTN","IBECUSO",97,0)
 .S IBCD=$G(^IBA(351.5,IBC,0)),IBCD2=$G(^(2)),IBCD5=$G(^(5)),IBCD6=$G(^(6))
"RTN","IBECUSO",98,0)
 .Q:'IBCD
"RTN","IBECUSO",99,0)
 .;
"RTN","IBECUSO",100,0)
 .S IBD=$P($G(^PSRX(+IBCD,3)),"^") I IBD="" S IBD=$P($G(^(2)),"^",2)
"RTN","IBECUSO",101,0)
 .I IBD<IBBEG Q
"RTN","IBECUSO",102,0)
 .I IBD>IBEND Q
"RTN","IBECUSO",103,0)
 .;
"RTN","IBECUSO",104,0)
 .S IBDPT(0)=$G(^DPT($P(IBCD,"^",2),0)),IBRXD=$G(^PSRX(+IBCD,0))
"RTN","IBECUSO",105,0)
 .S IBFDT=$$FDT($P(IBCD,"^"))
"RTN","IBECUSO",106,0)
 .;
"RTN","IBECUSO",107,0)
 .I $Y>(IOSL-5) D PAUSE Q:IBQ  D TRNHDR
"RTN","IBECUSO",108,0)
 .D TRNDAT
"RTN","IBECUSO",109,0)
 .W !,"  Drug Name: ",$P($G(^PSDRUG(+$P(IBRXD,"^",6),0)),"^")
"RTN","IBECUSO",110,0)
 .;
"RTN","IBECUSO",111,0)
 .W !?5,"Status: ",$S($P(IBCD6,"^")]"":"Reversed",IBCD5]"":"Rejected",1:"Accepted")
"RTN","IBECUSO",112,0)
 .;
"RTN","IBECUSO",113,0)
 .; - display errors
"RTN","IBECUSO",114,0)
 .I IBCD5]"" F I=1:1 S IBERRP=$P(IBCD5,",",I) Q:IBERRP=""  D  Q:IBQ
"RTN","IBECUSO",115,0)
 ..I $Y>(IOSL-2) D PAUSE Q:IBQ  D TRNHDR,TRNDAT
"RTN","IBECUSO",116,0)
 ..S IBTXT=$$ERRTXT^IBECUS22(IBERRP)
"RTN","IBECUSO",117,0)
 ..I IBTXT]"" W !?4,IBTXT
"RTN","IBECUSO",118,0)
 .Q:IBCD5]""
"RTN","IBECUSO",119,0)
 .;
"RTN","IBECUSO",120,0)
 .I $Y>(IOSL-3) D PAUSE Q:IBQ  D TRNHDR,TRNDAT
"RTN","IBECUSO",121,0)
 .W !,$P(IBCD,"^",4),?15,$J($P(IBCD,"^",5),6),?25,$J($P(IBCD2,"^"),6),?35,$J($P(IBCD2,"^",2),6),?45,$J($P(IBCD2,"^",3),6),?55,$J($P(IBCD2,"^",5),6)
"RTN","IBECUSO",122,0)
 .W !?15,$P(IBCD2,"^",6),?39,$P(IBCD2,"^",7)
"RTN","IBECUSO",123,0)
 .;
"RTN","IBECUSO",124,0)
 .I $P(IBCD6,"^",3)]"" F I=1:1 S IBERRP=$P($P(IBCD6,"^",3),",",I) Q:IBERRP=""  D  Q:IBQ
"RTN","IBECUSO",125,0)
 ..I $Y>(IOSL-2) D PAUSE Q:IBQ  D TRNHDR,TRNDAT
"RTN","IBECUSO",126,0)
 ..S IBTXT=$$ERRTXT^IBECUS22(IBERRP)
"RTN","IBECUSO",127,0)
 ..I IBTXT]"" W !?4,IBTXT
"RTN","IBECUSO",128,0)
 .;
"RTN","IBECUSO",129,0)
 .I $P(IBCD6,"^")]"" D
"RTN","IBECUSO",130,0)
 ..I $Y>(IOSL-1) D PAUSE Q:IBQ  D TRNHDR,TRNDAT
"RTN","IBECUSO",131,0)
 ..W !,"Reversal Authorization # ",$P(IBCD6,"^"),?40,"Reversed by: ",$P($G(^VA(200,+$P(IBCD6,"^",2),0)),"^")
"RTN","IBECUSO",132,0)
 ;
"RTN","IBECUSO",133,0)
 ; - end-of-report pause
"RTN","IBECUSO",134,0)
 D:'IBQ PAUSE
"RTN","IBECUSO",135,0)
 ;
"RTN","IBECUSO",136,0)
TRNQ I '$D(ZTQUEUED) D ^%ZISC
"RTN","IBECUSO",137,0)
 K IBPAG,IBQ,IBR,IBR0,IBR1,IBRXD,DFN,IBERRP,IBTXT,IBBEG,IBEND
"RTN","IBECUSO",138,0)
 K IBC,IBCD,IBCD2,IBCD5,IBCD6,IBDPT,IBD,IBFDT
"RTN","IBECUSO",139,0)
 Q
"RTN","IBECUSO",140,0)
 ;
"RTN","IBECUSO",141,0)
TRNHDR ; Print the Transmission Report header.
"RTN","IBECUSO",142,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF,*13
"RTN","IBECUSO",143,0)
 S IBPAG=IBPAG+1
"RTN","IBECUSO",144,0)
 W !,$$DASH(),!,"Date: ",$$DAT1^IBOUTL(DT),?(IOM/2)-16,"IPS Prescription Status Report"
"RTN","IBECUSO",145,0)
 W ?(IOM-10),"Page: ",IBPAG
"RTN","IBECUSO",146,0)
 W !?(IOM/2)-17 S Y=IBBEG X ^DD("DD") W Y," through " S Y=IBEND X ^DD("DD") W Y
"RTN","IBECUSO",147,0)
 W !,"RX#",?15,"Fill Date",?27,"Patient Name",?62,"Patient SSN"
"RTN","IBECUSO",148,0)
 W !,"NDC",?15,"AWP",?25,"Copay",?35,"Ing Cost",?45,"Fee Paid",?55,"Total PD"
"RTN","IBECUSO",149,0)
 W !?15,"Auth. #",?39,"Message"
"RTN","IBECUSO",150,0)
 W !,"Reject Failure Codes"
"RTN","IBECUSO",151,0)
 W !,$$DASH(),!
"RTN","IBECUSO",152,0)
 Q
"RTN","IBECUSO",153,0)
 ;
"RTN","IBECUSO",154,0)
TRNDAT ; Display basic description information.
"RTN","IBECUSO",155,0)
 W !!,$P(IBRXD,"^"),?15,$$DAT1^IBOUTL(IBFDT)
"RTN","IBECUSO",156,0)
 W ?27,$P(IBDPT(0),"^"),?62,$P(IBDPT(0),"^",9)
"RTN","IBECUSO",157,0)
 Q
"RTN","IBECUSO",158,0)
 ;
"RTN","IBECUSO",159,0)
FDT(X) ; Find the Fill Date for the prescription.
"RTN","IBECUSO",160,0)
 ;  Input:  X  --  1;2   where 1 :> pointer to the rx in file #52, and
"RTN","IBECUSO",161,0)
 ;                             2 :> pointer to the re-fill in #52.1, or
"RTN","IBECUSO",162,0)
 ;                                  0 if this is the original fill.
"RTN","IBECUSO",163,0)
 N Y S Y=""
"RTN","IBECUSO",164,0)
 I $G(X)="" G FDTQ
"RTN","IBECUSO",165,0)
 I $P(X,";",2) S Y=$P($G(^PSRX(+X,1,$P(X,";",2),0)),"^") G FDTQ
"RTN","IBECUSO",166,0)
 S Z2=$G(^PSRX(+X,2)),Z3=$G(^(3))
"RTN","IBECUSO",167,0)
 S Y=$S($P(Z2,"^",2):$P(Z2,"^",2),+Z3:+Z3,$P(Z2,"^",5):$P(Z2,"^",5),1:"")
"RTN","IBECUSO",168,0)
FDTQ Q Y
"RTN","IBECUSO",169,0)
 ;
"RTN","IBECUSO",170,0)
AWP ;
"RTN","IBECUSO",171,0)
 I '$D(^JADUTIL("AWP UPDATE")) W !,"No updates on file" Q
"RTN","IBECUSO",172,0)
 W !,"Date         Quantity"
"RTN","IBECUSO",173,0)
 S A="" F  S A=$O(^JADUTIL("AWP UPDATE",A)) Q:'A  D
"RTN","IBECUSO",174,0)
 .I A<($P($H,",")-52) K ^JADUTIL("AWP UPDATE",A) Q
"RTN","IBECUSO",175,0)
 .S %H=A D YMD^%DTC S Y=X X ^DD("DD")
"RTN","IBECUSO",176,0)
 .W !,Y,"  ",^JADUTIL("AWP UPDATE",A)
"RTN","IBECUSO",177,0)
 Q
"RTN","IBECUSO",178,0)
 ;
"RTN","IBECUSO",179,0)
 ;
"RTN","IBECUSO",180,0)
 ;
"RTN","IBECUSO",181,0)
REM ; Delete rejects.
"RTN","IBECUSO",182,0)
 W !!,"Delete entry from IPS error file"
"RTN","IBECUSO",183,0)
 W !,"Delete RX#: " R JADTA:DTIME Q:JADTA=""!(JADTA="^")
"RTN","IBECUSO",184,0)
 I '$D(^JADREJ(JADTA)) W !,JADTA," is not in the error file." G REM
"RTN","IBECUSO",185,0)
 K ^JADREJ(JADTA) W !,JADTA," has been deleted." G REM
"RTN","IBECUSO",186,0)
 Q
"RTN","IBJDF5")
0^22^B27507847
"RTN","IBJDF5",1,0)
IBJDF5 ;ALB/RB - CHAMPVA/TRICARE FOLLOW-UP REPORT;15-APR-00
"RTN","IBJDF5",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185,240**;21-MAR-94
"RTN","IBJDF5",3,0)
 ;
"RTN","IBJDF5",4,0)
EN ; - Option entry point.
"RTN","IBJDF5",5,0)
 ;
"RTN","IBJDF5",6,0)
 ; - Select AR categories to print.
"RTN","IBJDF5",7,0)
 S IBPRT="Choose which category of receivables to print:"
"RTN","IBJDF5",8,0)
 K IBCTG
"RTN","IBJDF5",9,0)
 S IBCTG(1)="TRICARE PATIENT"
"RTN","IBJDF5",10,0)
 S IBCTG(2)="SHARING AGREEMENTS"
"RTN","IBJDF5",11,0)
 S IBCTG(3)="TRICARE"
"RTN","IBJDF5",12,0)
 S IBCTG(4)="TRICARE THIRD PARTY"
"RTN","IBJDF5",13,0)
 S IBCTG(5)="CHAMPVA"
"RTN","IBJDF5",14,0)
 S IBCTG(6)="CHAMPVA THIRD PARTY"
"RTN","IBJDF5",15,0)
 S IBCTG(7)="ALL OF THE ABOVE"
"RTN","IBJDF5",16,0)
 S IBSEL=$$MLTP^IBJD(IBPRT,.IBCTG,1) I 'IBSEL G ENQ
"RTN","IBJDF5",17,0)
 ;
"RTN","IBJDF5",18,0)
 S IBSD=0 I IBSEL="1," G TYP
"RTN","IBJDF5",19,0)
 ;
"RTN","IBJDF5",20,0)
 ; - Sort by division, if necessary.
"RTN","IBJDF5",21,0)
 S IBSD=$$SDIV^IBJD() G:IBSD["^" ENQ G:'IBSD TYP
"RTN","IBJDF5",22,0)
 ;
"RTN","IBJDF5",23,0)
 ; - Issue prompt for division.
"RTN","IBJDF5",24,0)
 I IBSD,IBSEL[1 D
"RTN","IBJDF5",25,0)
 . W !!,"NOTE: Tricare Patient receivables will NOT be sorted"
"RTN","IBJDF5",26,0)
 . W !?6,"by division!",!,*7
"RTN","IBJDF5",27,0)
 ;
"RTN","IBJDF5",28,0)
TYP ; - Select type of receivables to print.
"RTN","IBJDF5",29,0)
 ; - Select AR categories to print.
"RTN","IBJDF5",30,0)
 S IBPRT="Choose which type of receivables to print:"
"RTN","IBJDF5",31,0)
 K IBTPR
"RTN","IBJDF5",32,0)
 S IBTPR(1)="INPATIENT"
"RTN","IBJDF5",33,0)
 S IBTPR(2)="OUTPATIENT"
"RTN","IBJDF5",34,0)
 S IBTPR(3)="PHARMACY REFILL"
"RTN","IBJDF5",35,0)
 S IBTPR(4)="ALL RECEIVABLES"
"RTN","IBJDF5",36,0)
 S IBSEL1=$$MLTP^IBJD(IBPRT,.IBTPR,1) I 'IBSEL1 G ENQ
"RTN","IBJDF5",37,0)
 ;
"RTN","IBJDF5",38,0)
 ; - Select a detailed or summary report.
"RTN","IBJDF5",39,0)
 D DS^IBJD G ENQ:IBRPT["^",DEV:IBRPT="S"
"RTN","IBJDF5",40,0)
 ;
"RTN","IBJDF5",41,0)
 ; - Determine sorting (By name or Last 4 SSN)
"RTN","IBJDF5",42,0)
 S IBSN=$$SNL^IBJD() G ENQ:IBSN="^"
"RTN","IBJDF5",43,0)
 ;
"RTN","IBJDF5",44,0)
 ; - Determine the range
"RTN","IBJDF5",45,0)
 S X=$$INTV^IBJD("PATIENT "_$S(IBSN="N":"NAME",1:"LAST 4")) G ENQ:X="^"
"RTN","IBJDF5",46,0)
 S IBSNF=$P(X,"^",1),IBSNL=$P(X,"^",2),IBSNA=$P(X,"^",3)
"RTN","IBJDF5",47,0)
 ;
"RTN","IBJDF5",48,0)
AGE ; - Determine if the active receivable must be within an age range.
"RTN","IBJDF5",49,0)
 W !!,"Include (A)LL active AR's or those within an AGE (R)ANGE: ALL// "
"RTN","IBJDF5",50,0)
 R X:DTIME G:'$T!(X["^") ENQ S:X="" X="A" S X=$E(X)
"RTN","IBJDF5",51,0)
 I "ARar"'[X S IBOFF=1 D HELP^IBJDF5H G AGE
"RTN","IBJDF5",52,0)
 W "  ",$S("Rr"[X:"RANGE",1:"ALL")
"RTN","IBJDF5",53,0)
 S IBSMN=$S("Rr"[X:"R",1:"A") G:IBSMN="A" AMT
"RTN","IBJDF5",54,0)
 ;
"RTN","IBJDF5",55,0)
 ; - Determine the active receivable age range.
"RTN","IBJDF5",56,0)
 S DIR(0)="NA^1:99999"
"RTN","IBJDF5",57,0)
 S DIR("A")="Enter the minimum age of the active receivable: "
"RTN","IBJDF5",58,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=9 D HELP^IBJDF5H"
"RTN","IBJDF5",59,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",60,0)
 S IBSMN=+Y W "   ",IBSMN," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",61,0)
 ;
"RTN","IBJDF5",62,0)
 S DIR(0)="NA^"_IBSMN_":99999"
"RTN","IBJDF5",63,0)
 S DIR("A")="Enter the maximum age of the active receivable: "
"RTN","IBJDF5",64,0)
 S DIR("B")=IBSMN,DIR("T")=DTIME,DIR("?")="^S IBOFF=14 D HELP^IBJDF5H"
"RTN","IBJDF5",65,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",66,0)
 S IBSMX=+Y W "   ",IBSMX," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",67,0)
 ;
"RTN","IBJDF5",68,0)
AMT ; - Print receivables with a minimum balance.
"RTN","IBJDF5",69,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF5",70,0)
 S DIR("A")="Print receivables with a minimum balance"
"RTN","IBJDF5",71,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=19 D HELP^IBJDF5H"
"RTN","IBJDF5",72,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",73,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSAM EXCEL
"RTN","IBJDF5",74,0)
 ;
"RTN","IBJDF5",75,0)
AMT1 ; - Determine the minimum balance amount.
"RTN","IBJDF5",76,0)
 S DIR(0)="NA^1:9999999"
"RTN","IBJDF5",77,0)
 S DIR("A")="Enter the minimum balance amount of the receivable: "
"RTN","IBJDF5",78,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=26 D HELP^IBJDF5H"
"RTN","IBJDF5",79,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",80,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",81,0)
 ;
"RTN","IBJDF5",82,0)
EXCEL ; - Determine whether to gather data for Excel report.
"RTN","IBJDF5",83,0)
 S IBEXCEL=$$EXCEL^IBJD() I Y S (IBEXCEL,IBSH)=1,IBSH1="M" G DEV
"RTN","IBJDF5",84,0)
 ;
"RTN","IBJDF5",85,0)
BCH ; - Determine whether to include the bill comment history.
"RTN","IBJDF5",86,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF5",87,0)
 S DIR("A")="Include the bill comment history with each receivable"
"RTN","IBJDF5",88,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=31 D HELP^IBJDF5H"
"RTN","IBJDF5",89,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",90,0)
 S IBSH=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSH DEV
"RTN","IBJDF5",91,0)
 ;
"RTN","IBJDF5",92,0)
 S DIR(0)="SA^A:ALL;M:MOST RECENT"
"RTN","IBJDF5",93,0)
 S DIR("A")="Print (A)LL comments or the (M)OST RECENT comment: "
"RTN","IBJDF5",94,0)
 S DIR("B")="ALL",DIR("T")=DTIME,DIR("?")="^S IBOFF=40 D HELP^IBJDF5H"
"RTN","IBJDF5",95,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",96,0)
 S IBSH1=Y K DIROUT,DTOUT,DUOUT,DIRUT G:IBSH1="A" DEV
"RTN","IBJDF5",97,0)
 ;
"RTN","IBJDF5",98,0)
 S DIR(0)="NAO^1:999"
"RTN","IBJDF5",99,0)
 S DIR("A")="Minimum age of most recent bill comment (optional): "
"RTN","IBJDF5",100,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=47 D HELP^IBJDF5H"
"RTN","IBJDF5",101,0)
 D ^DIR K DIR G:$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",102,0)
 S IBSH2=+Y W:IBSH2 " days" K DIROUT,DTOUT,DUOUT
"RTN","IBJDF5",103,0)
 ;
"RTN","IBJDF5",104,0)
DEV ; - Select a device.
"RTN","IBJDF5",105,0)
 I '$G(IBEXCEL) D
"RTN","IBJDF5",106,0)
 . S X=$S(IBRPT="S":80,1:132)
"RTN","IBJDF5",107,0)
 . W !!,"You will need a ",X," column printer for this report!",!
"RTN","IBJDF5",108,0)
 . W !,"Note: This report will search through all  active  receivables."
"RTN","IBJDF5",109,0)
 . W !,"      You should  queue it to run after normal business hours.",!
"RTN","IBJDF5",110,0)
 ;
"RTN","IBJDF5",111,0)
 I $G(IBEXCEL) D EXMSG^IBJD
"RTN","IBJDF5",112,0)
 ;
"RTN","IBJDF5",113,0)
 W ! S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDF5",114,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDF5",115,0)
 .S ZTRTN="DQ^IBJDF5",ZTDESC="IB - CHAMPVA/TRICARE FOLLOW-UP REPORT"
"RTN","IBJDF5",116,0)
 .F I="IB*","VAUTD","VAUTD(" S ZTSAVE(I)=""
"RTN","IBJDF5",117,0)
 .D ^%ZTLOAD
"RTN","IBJDF5",118,0)
 .I $G(ZTSK) W !!,"This job has been queued. The task no. is ",ZTSK,"."
"RTN","IBJDF5",119,0)
 .E  W !!,"Unable to queue this job."
"RTN","IBJDF5",120,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDF5",121,0)
 ;
"RTN","IBJDF5",122,0)
 U IO
"RTN","IBJDF5",123,0)
 ;
"RTN","IBJDF5",124,0)
 ; If called by the Extraction Module, change extract status for the 6
"RTN","IBJDF5",125,0)
 ; reports: Tricare Patient, Sharing Agreements, TRICARE, TRICARE 3rd 
"RTN","IBJDF5",126,0)
 ;          Party, CHAMPVA and CHAMPVA 3rd Party
"RTN","IBJDF5",127,0)
DQ I $G(IBXTRACT) F I=17:1:21 D E^IBJDE(I,1)
"RTN","IBJDF5",128,0)
 ;
"RTN","IBJDF5",129,0)
 D ST^IBJDF51 ;  Compile and print the report.
"RTN","IBJDF5",130,0)
 ;
"RTN","IBJDF5",131,0)
ENQ K IBSD,IBSEL,IBSEL1,IBSN,IBSNF,IBSNL,IBSNA,IBOFF,IBSH,IBSH1,IBSH2,IBSAM
"RTN","IBJDF5",132,0)
 K IBPRT,IBCTG,IBRPT,IBTPR,IBSMN,IBSMX,IBTEXT,IBI,IBEXCEL,DIROUT,DTOUT
"RTN","IBJDF5",133,0)
 K DTOUT,DIRUT,POP,VAUTD,%ZIS,ZTDESC,ZTRTN,ZTSAVE,I,X,Y
"RTN","IBJDF5",134,0)
 Q
"RTN","IBJDF51")
0^23^B57252873
"RTN","IBJDF51",1,0)
IBJDF51 ;ALB/RB - CHAMPVA/TRICARE FOLLOW-UP REPORT (COMPILE);15-APR-00
"RTN","IBJDF51",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185,240**;21-MAR-94
"RTN","IBJDF51",3,0)
 ;
"RTN","IBJDF51",4,0)
ST ; - Tasked entry point.
"RTN","IBJDF51",5,0)
 K IB,^TMP("IBJDF5",$J) S IBQ=0
"RTN","IBJDF51",6,0)
 ;
"RTN","IBJDF51",7,0)
 ; - Set selected categories for report.
"RTN","IBJDF51",8,0)
 I IBSEL[1 S IBCAT(31)=1
"RTN","IBJDF51",9,0)
 I IBSEL[2 S IBCAT(19)=2
"RTN","IBJDF51",10,0)
 I IBSEL[3 S IBCAT(30)=3
"RTN","IBJDF51",11,0)
 I IBSEL[4 S IBCAT(32)=4
"RTN","IBJDF51",12,0)
 I IBSEL[5 S IBCAT(29)=5
"RTN","IBJDF51",13,0)
 I IBSEL[6 S IBCAT(28)=6
"RTN","IBJDF51",14,0)
 ;
"RTN","IBJDF51",15,0)
 ; Initialize the Summary Information
"RTN","IBJDF51",16,0)
 S IBCAT="" F  S IBCAT=$O(IBCAT(IBCAT)) Q:IBCAT=""  D
"RTN","IBJDF51",17,0)
 . S IBDIV=0
"RTN","IBJDF51",18,0)
 . I IBSD,IBCAT'=31 D  Q
"RTN","IBJDF51",19,0)
 . . F  S IBDIV=$O(VAUTD(IBDIV)) Q:IBDIV=""  D INIT^IBJDF53
"RTN","IBJDF51",20,0)
 . D INIT^IBJDF53
"RTN","IBJDF51",21,0)
 ;
"RTN","IBJDF51",22,0)
 ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF51",23,0)
 I $G(IBEXCEL) D PHDL
"RTN","IBJDF51",24,0)
 ;
"RTN","IBJDF51",25,0)
 ; - Find data required for the report.
"RTN","IBJDF51",26,0)
 S IBA=0 F  S IBA=$O(^PRCA(430,"AC",16,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF51",27,0)
 . I IBA#100=0 D  Q:IBQ
"RTN","IBJDF51",28,0)
 . . S IBQ=$$STOP^IBOUTL("CHAMPVA/Tricare Follow-Up Report")
"RTN","IBJDF51",29,0)
 . S IBAR=$G(^PRCA(430,IBA,0)) Q:'IBAR
"RTN","IBJDF51",30,0)
 . I $P($G(^DGCR(399,IBA,0)),U,13)=7 Q  ;           Cancelled claim.
"RTN","IBJDF51",31,0)
 . S IBCAT=+$P(IBAR,U,2) Q:'$D(IBCAT(IBCAT))  ;     Invalid AR category.
"RTN","IBJDF51",32,0)
 . S IBCAT1=IBCAT(IBCAT)
"RTN","IBJDF51",33,0)
 . ;
"RTN","IBJDF51",34,0)
 . ; - Get division, if necessary.
"RTN","IBJDF51",35,0)
 . I IBCAT1=1 S IBDIV=0                       ; CHAMPVA/Tricare Patient
"RTN","IBJDF51",36,0)
 . ;
"RTN","IBJDF51",37,0)
 . I IBCAT1'=1 D                              ; Others
"RTN","IBJDF51",38,0)
 . . I 'IBSD S IBDIV=0 Q
"RTN","IBJDF51",39,0)
 . . S IBDIV=$$DIV(IBA)
"RTN","IBJDF51",40,0)
 . ;
"RTN","IBJDF51",41,0)
 . I IBSD,IBDIV,'VAUTD Q:'$D(VAUTD(IBDIV))  ; Not a selected division.
"RTN","IBJDF51",42,0)
 . ;
"RTN","IBJDF51",43,0)
 . ; - Determine whether AR has corresponding IB action or claim and
"RTN","IBJDF51",44,0)
 . ;   whether action/claim is inpatient, outpatient, or RX refill.
"RTN","IBJDF51",45,0)
 . S IBAC=$$CLMACT^IBJD(IBA,IBCAT) Q:IBAC=""!(+IBAC=3)
"RTN","IBJDF51",46,0)
 . I +IBAC=1 D
"RTN","IBJDF51",47,0)
 . . S X=$P($G(^IB($P(IBAC,U,2),0)),U,3)
"RTN","IBJDF51",48,0)
 . . S X=$P($G(^IBE(350.1,X,0)),U)
"RTN","IBJDF51",49,0)
 . . S IBTYP=$S(X["RX":3,X["OPT":2,1:1)
"RTN","IBJDF51",50,0)
 . I +IBAC'=1 D 
"RTN","IBJDF51",51,0)
 . . S IBTYP=$S($P($G(^DGCR(399,IBA,0)),U,5)>2:2,1:1)
"RTN","IBJDF51",52,0)
 . . I $D(^IBA(362.4,"C",IBA)) S IBTYP=3
"RTN","IBJDF51",53,0)
 . ;
"RTN","IBJDF51",54,0)
 . I IBSEL1'[IBTYP,IBSEL1'[4 Q
"RTN","IBJDF51",55,0)
 . ;
"RTN","IBJDF51",56,0)
 . I IBRPT="D" S IBPT=$$PAT(IBA) Q:IBPT=""  ; Get patient info.
"RTN","IBJDF51",57,0)
 . ;
"RTN","IBJDF51",58,0)
 . I '$G(IBEXCEL) D EN^IBJDF53 Q:IBRPT="S"  ; Get stats for summary.
"RTN","IBJDF51",59,0)
 . ;
"RTN","IBJDF51",60,0)
 . ; - Get insurance info.
"RTN","IBJDF51",61,0)
 . S (IBI,IBIN)=0
"RTN","IBJDF51",62,0)
 . I $D(^DGCR(399,IBA,"MP")) D  I 'IBI Q
"RTN","IBJDF51",63,0)
 . . S IBI=+$G(^DGCR(399,IBA,"MP")) I 'IBI S IBIN="*** UNKNOWN ***" Q
"RTN","IBJDF51",64,0)
 . . S IBIN=$P($G(^DIC(36,IBI,0)),U)_"@@"_IBI
"RTN","IBJDF51",65,0)
 . ;
"RTN","IBJDF51",66,0)
 . ; - Check the receivable age, if necessary.
"RTN","IBJDF51",67,0)
 . I IBSMN D  Q:IBARD<IBSMN!(IBARD>IBSMX)
"RTN","IBJDF51",68,0)
 . . S IBARD=+$$ACT^IBJDF2(IBA) S:IBARD IBARD=$$FMDIFF^XLFDT(DT,IBARD)
"RTN","IBJDF51",69,0)
 . ;
"RTN","IBJDF51",70,0)
 . ; - Check the minimum balance amount, if necessary.
"RTN","IBJDF51",71,0)
 . S IBBA=0 F X=1:1:5 S IBBA=IBBA+$P($G(^PRCA(430,IBA,7)),U,X)
"RTN","IBJDF51",72,0)
 . I IBSAM,IBBA<IBSAM Q
"RTN","IBJDF51",73,0)
 . ;
"RTN","IBJDF51",74,0)
 . ; - Get remaining AR/claim information.
"RTN","IBJDF51",75,0)
 . S IBDP=$P(IBAR,U,10),X=$$CLMACT^IBJD(IBA,IBCAT) Q:X=""
"RTN","IBJDF51",76,0)
 . S IBBU=$S(+IBAC=1:$G(^IB($P(IBAC,U,2),0)),1:$G(^DGCR(399,IBA,"U")))
"RTN","IBJDF51",77,0)
 . S IBFR=$P(IBBU,U,$S(+IBAC=1:14,1:1))
"RTN","IBJDF51",78,0)
 . S IBTO=$P(IBBU,U,$S(+IBAC=1:15,1:2))
"RTN","IBJDF51",79,0)
 . S DFN=$P(IBPT,U,5),IBSID=$$SID(DFN,IBI)
"RTN","IBJDF51",80,0)
 . S IBOI=$$OTH(DFN,IBI,IBFR),IBVA=$$VA^IBJD1(DFN)
"RTN","IBJDF51",81,0)
 . S IBBN=$P(IBAR,U),IBOR=$P(IBAR,U,3)
"RTN","IBJDF51",82,0)
 . ;
"RTN","IBJDF51",83,0)
 . ; - Set up indexes for detail report.
"RTN","IBJDF51",84,0)
 . I $G(IBEXCEL) D  Q
"RTN","IBJDF51",85,0)
 . . S IBDIV=$P($G(^DG(40.8,$S('IBDIV:+$$PRIM^VASITE(),1:IBDIV),0)),U)
"RTN","IBJDF51",86,0)
 . . ;
"RTN","IBJDF51",87,0)
 . . S IBEXCEL1=$P(IBPT,U,2)_U_IBVA_U_$P(IBPT,U,3)_U_$TR($P(IBPT,U,4),"-")
"RTN","IBJDF51",88,0)
 . . S IBEXCEL1=IBEXCEL1_U_$S(IBIN=0:"",1:$E($P(IBIN,"@@"),1,12))_U_$E(IBOI,1,12)
"RTN","IBJDF51",89,0)
 . . S IBEXCEL1=IBEXCEL1_U_$$DT^IBJD(IBDP,1)_U_$$DT^IBJD(IBFR,1)
"RTN","IBJDF51",90,0)
 . . S IBEXCEL1=IBEXCEL1_U_$$DT^IBJD(IBTO,1)_U_IBSID_U_IBBN_U_IBOR
"RTN","IBJDF51",91,0)
 . . S IBEXCEL1=IBEXCEL1_U_IBBA_U_$P($G(^PRCA(430.2,IBCAT,0)),U,2)
"RTN","IBJDF51",92,0)
 . . S IBEXCEL1=IBEXCEL1_U_$E("IOR",IBTYP)_U
"RTN","IBJDF51",93,0)
 . . I IBSH D COM  ; This will capture the Last Comment Date
"RTN","IBJDF51",94,0)
 . . S IBD=$$FMDIFF^XLFDT(DT,$S('$P(IBEXCEL1,U,16):IBDP,1:$G(DAT)))
"RTN","IBJDF51",95,0)
 . . S IBEXCEL1=IBEXCEL1_U_IBD_U_$E(IBDIV,1,12) W !,IBEXCEL1 K IBD,IBEXCEL1
"RTN","IBJDF51",96,0)
 . ;
"RTN","IBJDF51",97,0)
 . S IBKEY=$P(IBPT,U)_"@@"_$S($G(IBPT):IBDP,1:IBFR_"/"_IBTO)
"RTN","IBJDF51",98,0)
 . F X=IBTYP,4 I IBSEL1[X D
"RTN","IBJDF51",99,0)
 . . I '($D(^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY))#10) D
"RTN","IBJDF51",100,0)
 . . . S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY)=$P(IBPT,U,2)_" "_IBVA_U_$P(IBPT,U,3,4)_U_IBOI
"RTN","IBJDF51",101,0)
 . . S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY,IBBN)=IBDP_U_IBFR_U_IBTO_U_IBOR_U_IBBA_U_IBSID
"RTN","IBJDF51",102,0)
 . . I IBSH D COM
"RTN","IBJDF51",103,0)
 ;
"RTN","IBJDF51",104,0)
 I 'IBQ,'$G(IBEXCEL) D EN^IBJDF52 ; Print the report.
"RTN","IBJDF51",105,0)
 ;
"RTN","IBJDF51",106,0)
ENQ K ^TMP("IBJDF5",$J)
"RTN","IBJDF51",107,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF51",108,0)
 ;
"RTN","IBJDF51",109,0)
 D ^%ZISC
"RTN","IBJDF51",110,0)
ENQ1 K IB,IBA,IBA1,IBAR,IBARD,IBBU,IBC,IBCAT,IBCAT1,IBDIV,IBD,IBI,IBQ,IBPT
"RTN","IBJDF51",111,0)
 K IBDP,IBKEY,IBVA,IBAC,IBBA,IBBN,IBFR,IBIN,IBOI,IBOR,IBSID,IBTO,IBTYP
"RTN","IBJDF51",112,0)
 K COM,COM1,DAT,DFN,J,X,X1,X2,Y,Z D KVA^VADPT
"RTN","IBJDF51",113,0)
 Q
"RTN","IBJDF51",114,0)
 ;
"RTN","IBJDF51",115,0)
PAT(IBDA) ; - Find the claim patient and decide to include the claim.
"RTN","IBJDF51",116,0)
 ;    Input: IBDA=Pointer to the claim/AR in file #399/#430 plus all
"RTN","IBJDF51",117,0)
 ;             variable input in IBS*
"RTN","IBJDF51",118,0)
 ;   Output: Y=Sort key (name or last 4)_@@_patient IEN to file #2 
"RTN","IBJDF51",119,0)
 ;             ^ Patient name ^ Age ^ SSN ^ Patient IEN to file #2
"RTN","IBJDF51",120,0)
 N AGE,ALL,ARZ,DA,DBTR,DFN,DIC,DIQ,DOB,DR,END,IBZ,INI,KEY,NAME,RCZ,SSN
"RTN","IBJDF51",121,0)
 N VADM,Y,Z
"RTN","IBJDF51",122,0)
 ;
"RTN","IBJDF51",123,0)
 S Y="" G:'$G(IBDA) PATQ
"RTN","IBJDF51",124,0)
 S DFN=0,(NAME,AGE,SSN)="",ARZ=$G(^PRCA(430,IBDA,0))
"RTN","IBJDF51",125,0)
 ;
"RTN","IBJDF51",126,0)
 ; - Look for Patient (Corresponding Claim in IB)
"RTN","IBJDF51",127,0)
 I $D(^DGCR(399,IBDA,0)) D  I 'DFN S Y="" G PATQ
"RTN","IBJDF51",128,0)
 . S IBZ=^DGCR(399,IBDA,0),DFN=+$P(IBZ,"^",2)
"RTN","IBJDF51",129,0)
 . D DEM^VADPT S NAME=VADM(1),SSN=$P(VADM(2),"^",2),AGE=VADM(4)
"RTN","IBJDF51",130,0)
 ;
"RTN","IBJDF51",131,0)
 ; - Look for Debtor (No corresponding Claim in IB)
"RTN","IBJDF51",132,0)
 I '$D(^DGCR(399,IBDA,0)) D  I 'DFN S Y="" G PATQ
"RTN","IBJDF51",133,0)
 . S DBTR=+$P(ARZ,"^",9) I 'DBTR Q
"RTN","IBJDF51",134,0)
 . S RCZ=$G(^RCD(340,DBTR,0)),DFN=+RCZ
"RTN","IBJDF51",135,0)
 . I $P(RCZ,"^")["DPT" D
"RTN","IBJDF51",136,0)
 . . D DEM^VADPT S NAME=VADM(1),SSN=$P(VADM(2),"^",2),AGE=VADM(4)
"RTN","IBJDF51",137,0)
 . I $P(RCZ,"^")'["DPT" D
"RTN","IBJDF51",138,0)
 . . S DIC="^PRCA(430,",DA=IBDA,DR=9,DIQ="DEB" D EN^DIQ1
"RTN","IBJDF51",139,0)
 . . S NAME=$G(DEB(430,DA,9)),KEY=NAME
"RTN","IBJDF51",140,0)
 . . S DIC="^RCD(340,",DA=DBTR,DR=110,DIQ="DEB" D EN^DIQ1
"RTN","IBJDF51",141,0)
 . . S SSN=$G(DEB(340,DA,110))
"RTN","IBJDF51",142,0)
 . . I SSN S SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","IBJDF51",143,0)
 ;
"RTN","IBJDF51",144,0)
 S KEY=$S(IBSN="N":NAME,1:+$P(SSN,"-",3))
"RTN","IBJDF51",145,0)
 S INI=IBSNF,END=IBSNL,ALL=IBSNA
"RTN","IBJDF51",146,0)
 I (INI'="@"&('DFN)) S Y="" G PATQ
"RTN","IBJDF51",147,0)
 I ALL="ALL"&('DFN)!(ALL="NULL"&(DFN)) S Y="" G PATQ
"RTN","IBJDF51",148,0)
 I INI="@",END="zzzzz" G PATC
"RTN","IBJDF51",149,0)
 I INI]KEY!(KEY]END) S Y="" G PATQ
"RTN","IBJDF51",150,0)
 ;
"RTN","IBJDF51",151,0)
PATC ; - Find all patient data.
"RTN","IBJDF51",152,0)
 S Y=KEY_"@@"_DFN_U_$E(NAME,1,25)_U_AGE_U_SSN_"^"_DFN
"RTN","IBJDF51",153,0)
PATQ Q Y
"RTN","IBJDF51",154,0)
 ;
"RTN","IBJDF51",155,0)
DIV(CLM) ;Find the default division of the bill. 
"RTN","IBJDF51",156,0)
 S DIV=$P($G(^DGCR(399,CLM,0)),"^",22)
"RTN","IBJDF51",157,0)
QDIV S:'DIV DIV=$$PRIM^VASITE() S:DIV'>0 DIV=0
"RTN","IBJDF51",158,0)
 Q DIV
"RTN","IBJDF51",159,0)
SID(DFN,INS) ; - Find the subscriber ID for a bill (if any).
"RTN","IBJDF51",160,0)
 ;   Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF51",161,0)
 ;          INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF51",162,0)
 ;  Output: Subscriber ID no. or null
"RTN","IBJDF51",163,0)
 N X,Y,Z S Y="" G:'$G(DFN)!('$G(INS)) SIDQ
"RTN","IBJDF51",164,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D  Q:Y]""
"RTN","IBJDF51",165,0)
 .I +X=INS S Y=$E($P(X,U,2),1,16)
"RTN","IBJDF51",166,0)
 ;
"RTN","IBJDF51",167,0)
SIDQ Q Y
"RTN","IBJDF51",168,0)
 ;
"RTN","IBJDF51",169,0)
PHDL ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF51",170,0)
 N X
"RTN","IBJDF51",171,0)
 S X="Patient^VA Empl.?^Age^SSN^Prim.Ins.Carrier^Other Ins.Carrier^"
"RTN","IBJDF51",172,0)
 S X=X_"Dt Bill prep.^Bill From Dt^Bill To Dt^Subsc.ID^Bill #^"
"RTN","IBJDF51",173,0)
 S X=X_"Orig.Amt^Curr.Bal.^Cat.^Bill Type^Lst Comm.Dt^Days Lst Comm.^"
"RTN","IBJDF51",174,0)
 S X=X_"Division"
"RTN","IBJDF51",175,0)
 W !,X
"RTN","IBJDF51",176,0)
 Q
"RTN","IBJDF51",177,0)
 ;
"RTN","IBJDF51",178,0)
OTH(DFN,INS,DS) ; - Find a patient's other valid insurance carrier (if any).
"RTN","IBJDF51",179,0)
 ;   Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF51",180,0)
 ;          INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF51",181,0)
 ;           DS=Date of service for validity check
"RTN","IBJDF51",182,0)
 ;  Output: Valid insurance carrier (first 15 chars.) or null
"RTN","IBJDF51",183,0)
 N X,X1,Y,Z S Y="" G:'$G(DFN)!('$G(INS))!('$G(DS)) OTHQ
"RTN","IBJDF51",184,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D:X  Q:Y]""
"RTN","IBJDF51",185,0)
 .I +X=INS Q
"RTN","IBJDF51",186,0)
 .S X1=$G(^DIC(36,+X,0)) Q:X1=""
"RTN","IBJDF51",187,0)
 .I $P(X1,U,2)'="N",$$CHK^IBCNS1(X,DS) S Y=$E($P(X1,U),1,15)
"RTN","IBJDF51",188,0)
 ;
"RTN","IBJDF51",189,0)
OTHQ Q Y
"RTN","IBJDF51",190,0)
 ;
"RTN","IBJDF51",191,0)
COM ; - Get bill comments.
"RTN","IBJDF51",192,0)
 S DAT=0,IBA1=$S(IBSH1="M":9999999,1:0)
"RTN","IBJDF51",193,0)
 F  S IBA1=$S(IBSH1="M":$O(^PRCA(433,"C",IBA,IBA1),-1),1:$O(^PRCA(433,"C",IBA,IBA1))) Q:'IBA1  D  I IBSH1="M",DAT Q
"RTN","IBJDF51",194,0)
 .S IBC=$G(^PRCA(433,IBA1,1)) Q:'IBC
"RTN","IBJDF51",195,0)
 .I $G(IBSH2),$$FMDIFF^XLFDT(DT,+IBC)<IBSH2 Q  ; Comment age not minimum.
"RTN","IBJDF51",196,0)
 .I $P(IBC,U,2)'=35,$P(IBC,U,2)'=45 Q  ;   Not decrease/comment transact.
"RTN","IBJDF51",197,0)
 .S DAT=$S(IBC:+IBC\1,1:+$P(IBC,U,9)\1)
"RTN","IBJDF51",198,0)
 .I $G(IBEXCEL),IBSH1="M" S IBEXCEL1=IBEXCEL1_$$DT^IBJD(DAT,1) Q
"RTN","IBJDF51",199,0)
 .;
"RTN","IBJDF51",200,0)
 .; - Append brief and transaction comments.
"RTN","IBJDF51",201,0)
 .K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF51",202,0)
 .S COM1(1)=$P($G(^PRCA(433,IBA1,5)),U,2)
"RTN","IBJDF51",203,0)
 .S COM1(2)=$E($P($G(^PRCA(433,IBA1,8)),U,6),1,70)
"RTN","IBJDF51",204,0)
 .S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF51",205,0)
 .I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF51",206,0)
 .;
"RTN","IBJDF51",207,0)
 .; - Get main comments.
"RTN","IBJDF51",208,0)
 .S X2=0 F  S X2=$O(^PRCA(433,IBA1,7,X2)) Q:'X2  S COM($S(X1:X2+1,1:X2))=^(X2,0)
"RTN","IBJDF51",209,0)
 .;
"RTN","IBJDF51",210,0)
 .S X1="" F  S X1=$O(COM(X1)) Q:X1=""  D
"RTN","IBJDF51",211,0)
 ..S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY,IBBN,IBA1,X1)=COM(X1)
"RTN","IBJDF51",212,0)
 ;
"RTN","IBJDF51",213,0)
 Q
"RTN","IBJDF52")
0^24^B27532688
"RTN","IBJDF52",1,0)
IBJDF52 ;ALB/RB - CHAMPVA/TRICARE FOLLOW-UP REPORT (PRINT) ;15-APR-00
"RTN","IBJDF52",2,0)
 ;;2.0;INTEGRATED BILLING;**123,159,240**;21-MAR-94
"RTN","IBJDF52",3,0)
 ;
"RTN","IBJDF52",4,0)
EN ; - Print the Follow-up report.
"RTN","IBJDF52",5,0)
 S (IBQ,IBFLG)=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%) G:IBRPT="S" SUM
"RTN","IBJDF52",6,0)
 I 'IBSD D DET(0) G SUM
"RTN","IBJDF52",7,0)
 I IBSEL["1" D DET(0)
"RTN","IBJDF52",8,0)
 S IBDIV=""
"RTN","IBJDF52",9,0)
 F  S IBDIV=$O(VAUTD(IBDIV)) Q:IBDIV=""  D DET(IBDIV) Q:IBQ
"RTN","IBJDF52",10,0)
 ;
"RTN","IBJDF52",11,0)
SUM I 'IBQ D PRT^IBJDF53 ; Print summary.
"RTN","IBJDF52",12,0)
ENQ K I,IB0,IBC,IBCAT,IBCD,IBC1,IBC2,IBDIV,IBFLG,IBIN,IBKEY,IBN,IBPT,IBPAG
"RTN","IBJDF52",13,0)
 K IBQ,IBRUN,IBTYP,%
"RTN","IBJDF52",14,0)
 Q
"RTN","IBJDF52",15,0)
 ;
"RTN","IBJDF52",16,0)
DET(IBDIV) ; - Print report for a specific division.
"RTN","IBJDF52",17,0)
 ; Input: IBDIV=Pointer to the division in file #40.8 & variable IBSEL1
"RTN","IBJDF52",18,0)
 S IBCAT=0
"RTN","IBJDF52",19,0)
 F  S IBCAT=$O(IBCAT(IBCAT)) Q:'IBCAT  D  Q:IBQ
"RTN","IBJDF52",20,0)
 . S (IB0,IBIN,IBKEY,IBTYP)=""
"RTN","IBJDF52",21,0)
 . F IBTYP=1:1:4 D:IBSEL1[IBTYP  Q:IBQ
"RTN","IBJDF52",22,0)
 . . I IBDIV,IBCAT=31 Q
"RTN","IBJDF52",23,0)
 . . I IBSD,'IBDIV,IBCAT'=31 Q
"RTN","IBJDF52",24,0)
 . . I '$D(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP)) D HDR1,NAR,PAUSE Q
"RTN","IBJDF52",25,0)
 . . S IBFLG=0
"RTN","IBJDF52",26,0)
 . . F  S IBIN=$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN)) Q:IBIN=""  D  Q:IBQ
"RTN","IBJDF52",27,0)
 . . . D HDR1,HDR2 Q:IBQ
"RTN","IBJDF52",28,0)
 . . . F  S IBKEY=$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY)) Q:IBKEY=""  D  Q:IBQ
"RTN","IBJDF52",29,0)
 . . . . S IBPT=$G(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY))
"RTN","IBJDF52",30,0)
 . . . . D WPAT
"RTN","IBJDF52",31,0)
 . . . . F  S IB0=$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0)) Q:IB0=""  D  Q:IBQ
"RTN","IBJDF52",32,0)
 . . . . . S IBN=$G(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0))
"RTN","IBJDF52",33,0)
 . . . . . I $Y>(IOSL-3) D PAUSE Q:IBQ  D HDR1,HDR2 Q:IBQ  D WPAT
"RTN","IBJDF52",34,0)
 . . . . . W ?59,IB0,?71,$$DAT1^IBOUTL(+IBN)
"RTN","IBJDF52",35,0)
 . . . . . W ?80,$$DAT1^IBOUTL($P(IBN,U,2))
"RTN","IBJDF52",36,0)
 . . . . . W ?89,$$DAT1^IBOUTL($P(IBN,U,3)),?98,$J($P(IBN,U,4),8,2)
"RTN","IBJDF52",37,0)
 . . . . . W ?107,$J($P(IBN,U,5),8,2),?116,$P(IBN,U,6),!
"RTN","IBJDF52",38,0)
 . . . . . ;
"RTN","IBJDF52",39,0)
 . . . . . ; - Display bill comment history, if necessary.
"RTN","IBJDF52",40,0)
 . . . . . I IBSH D WCOM
"RTN","IBJDF52",41,0)
 . . . D:'IBQ PAUSE
"RTN","IBJDF52",42,0)
 ;
"RTN","IBJDF52",43,0)
DETQ Q
"RTN","IBJDF52",44,0)
 ;
"RTN","IBJDF52",45,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDF52",46,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDF52",47,0)
 ;
"RTN","IBJDF52",48,0)
PAUSE ; - Page break.
"RTN","IBJDF52",49,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDF52",50,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDF52",51,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBJDF52",52,0)
 S DIR(0)="E" D ^DIR S:$D(DIRUT)!($D(DUOUT)) IBQ=1
"RTN","IBJDF52",53,0)
 Q
"RTN","IBJDF52",54,0)
 ;
"RTN","IBJDF52",55,0)
HDR1 ; - Write the primary report header.
"RTN","IBJDF52",56,0)
 N FLG,X
"RTN","IBJDF52",57,0)
 ;
"RTN","IBJDF52",58,0)
 S FLG=1 I $G(IBFLG) S FLG=0
"RTN","IBJDF52",59,0)
 I '$G(IBFLG),$E(IOST,1,2)="C-"!$G(IBPAG) D
"RTN","IBJDF52",60,0)
 . W @IOF,*13 S IBFLG=0
"RTN","IBJDF52",61,0)
 . S IBPAG=$G(IBPAG)+1
"RTN","IBJDF52",62,0)
 I $G(IBFLG) D
"RTN","IBJDF52",63,0)
 . I $Y'>(IOSL-11) W !!! Q
"RTN","IBJDF52",64,0)
 . W @IOF,*13 S IBPAG=$G(IBPAG)+1,FLG=1
"RTN","IBJDF52",65,0)
 I '$G(IBPAG) S IBPAG=1
"RTN","IBJDF52",66,0)
 I IBDIV!FLG D
"RTN","IBJDF52",67,0)
 . W "CHAMPVA/TRICARE Follow-Up Report"
"RTN","IBJDF52",68,0)
 . I IBDIV W " for ",$P($G(^DG(40.8,IBDIV,0)),U),"  "
"RTN","IBJDF52",69,0)
 . W ?75,"Run Date: ",IBRUN W:FLG ?123,"Page: ",$J(IBPAG,3)
"RTN","IBJDF52",70,0)
 S X="ALL ACTIVE "_$G(IBCTG(IBCAT(IBCAT)))_" RECEIVABLES "
"RTN","IBJDF52",71,0)
 I IBTYP'=4 S X=X_"("_$G(IBTPR(IBTYP))_") "
"RTN","IBJDF52",72,0)
 I IBSMN S X=X_"OVER "_IBSMN_" AND UNDER "_IBSMX_" DAYS OLD "
"RTN","IBJDF52",73,0)
 S X=X_" / BY PATIENT "_$S(IBSN="N":"NAME",1:"LAST 4 DIGITS OF SSN")
"RTN","IBJDF52",74,0)
 S X=X_" ("_$S($G(IBSNA)="ALL":"ALL",1:"From "_$S(IBSNF="":"FIRST",1:IBSNF)_" to "_$S(IBSNL="zzzzz":"LAST",1:IBSNL))_")"
"RTN","IBJDF52",75,0)
 S X=X_" / "_$S('IBSAM:"NO ",1:"")_"MINIMUM BALANCE"
"RTN","IBJDF52",76,0)
 I IBSAM S X=X_$S(IBSAM:": $"_$FN(IBSAM,",",2),1:"")
"RTN","IBJDF52",77,0)
 S X=X_" / "_$S('IBSH:"NO ",IBSH1="A":"ALL ",1:"ONLY ")_"COMMENTS"
"RTN","IBJDF52",78,0)
 S X=X_$S($G(IBSH2):" NOT OLDER THAN "_IBSH2_" DAYS",1:"")
"RTN","IBJDF52",79,0)
 S X=X_" / '*' AFTER THE PATIENT NAME = VA EMPLOYEE"
"RTN","IBJDF52",80,0)
 F I=1:1 W !,$E(X,1,132) S X=$E(X,133,999) I X="" Q
"RTN","IBJDF52",81,0)
 ;
"RTN","IBJDF52",82,0)
 W !!?71,"Dte Bill",?98,"Original  Current"
"RTN","IBJDF52",83,0)
 W !,"Patient",?26,"Age SSN" W:IBCAT'=31 ?43,"Other Insurance"
"RTN","IBJDF52",84,0)
 W ?59,"Bill Number Prepared",?80,"Bill Frm Bill To    Amount  Balance"
"RTN","IBJDF52",85,0)
 W:IBCAT'=31 ?116,"Subscriber ID"
"RTN","IBJDF52",86,0)
 W !,$$DASH(IOM),!
"RTN","IBJDF52",87,0)
 S IBQ=$$STOP^IBOUTL("CHAMPVA/TRICARE Follow-Up Report")
"RTN","IBJDF52",88,0)
 Q
"RTN","IBJDF52",89,0)
 ;
"RTN","IBJDF52",90,0)
HDR2 ; - Write the insurance company sub-header.
"RTN","IBJDF52",91,0)
 N X,X13
"RTN","IBJDF52",92,0)
 I $P(IBIN,"@@")'=0 W ?2,"Carrier: ",$P(IBIN,"@@")
"RTN","IBJDF52",93,0)
 S X=$G(^DIC(36,+$P(IBIN,"@@",2),.11)),X13=$G(^(.13))
"RTN","IBJDF52",94,0)
 I X]"" D
"RTN","IBJDF52",95,0)
 .W ", ",$P(X,U),", ",$P(X,U,4),", ",$P($G(^DIC(5,+$P(X,U,5),0)),U,2),"  ",$P(X,U,6)
"RTN","IBJDF52",96,0)
 .I $P(X13,U,2)]"" W "   Billing Phone: ",$P(X13,U,2) Q
"RTN","IBJDF52",97,0)
 .I $P(X13,U)]"" W "   Main Phone: ",$P(X13,U)
"RTN","IBJDF52",98,0)
 ;
"RTN","IBJDF52",99,0)
 Q
"RTN","IBJDF52",100,0)
 ;
"RTN","IBJDF52",101,0)
NAR ; - Write detail line (if '$D).
"RTN","IBJDF52",102,0)
 S IBFLG=1
"RTN","IBJDF52",103,0)
 W !!,"There are no active receivables for the parameters above."
"RTN","IBJDF52",104,0)
 Q
"RTN","IBJDF52",105,0)
 ;
"RTN","IBJDF52",106,0)
WPAT ; - Write patient data.
"RTN","IBJDF52",107,0)
 W !,$P(IBPT,U),?26,$J($P(IBPT,U,2),3),?30,$P(IBPT,U,3)
"RTN","IBJDF52",108,0)
 W ?43,$P(IBPT,U,4)
"RTN","IBJDF52",109,0)
 Q
"RTN","IBJDF52",110,0)
 ;
"RTN","IBJDF52",111,0)
WCOM ; - Write bill comments
"RTN","IBJDF52",112,0)
 N CONT,DIWL,DIWR,IBC,IBCD,IBC1,IBC2,X
"RTN","IBJDF52",113,0)
 ;
"RTN","IBJDF52",114,0)
 S (IBC,CONT,IBCD)=0,IBC1="",DIWL=1,DIWR=104 K ^UTILITY($J)
"RTN","IBJDF52",115,0)
 F  S IBC=$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0,IBC)) Q:'IBC  D  Q:IBQ
"RTN","IBJDF52",116,0)
 . F  S IBC1=$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0,IBC,IBC1)) Q:IBC1=""  D  Q:IBQ
"RTN","IBJDF52",117,0)
 . . S IBC2=^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0,IBC,IBC1)
"RTN","IBJDF52",118,0)
 . . I 'IBC1 S IBCD=IBC2 D WCD Q
"RTN","IBJDF52",119,0)
 . . I $Y>(IOSL-4) D WCPB Q:IBQ
"RTN","IBJDF52",120,0)
 . . S X=IBC2 I $E(X)=" ",$L(X)>1 S $E(X)=""
"RTN","IBJDF52",121,0)
 . . D ^DIWP
"RTN","IBJDF52",122,0)
 . . I 'CONT,$L(IBC2)<66 D WCTXT Q
"RTN","IBJDF52",123,0)
 . . S CONT=$L(IBC2)>65
"RTN","IBJDF52",124,0)
 . . I '$O(^TMP("IBJDF5",$J,IBDIV,IBCAT,IBTYP,IBIN,IBKEY,IB0,IBC,IBC1)) D
"RTN","IBJDF52",125,0)
 . . . D:$D(^UTILITY($J,"W")) WCTXT
"RTN","IBJDF52",126,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF52",127,0)
 Q
"RTN","IBJDF52",128,0)
 ;
"RTN","IBJDF52",129,0)
WCTXT ; - Write comment text
"RTN","IBJDF52",130,0)
 N LIN,WLIN
"RTN","IBJDF52",131,0)
 S LIN=""
"RTN","IBJDF52",132,0)
 F  S LIN=$O(^UTILITY($J,"W",1,LIN)) Q:LIN=""  D  Q:IBQ
"RTN","IBJDF52",133,0)
 . S WLIN=$G(^UTILITY($J,"W",1,LIN,0))
"RTN","IBJDF52",134,0)
 . I $Y>(IOSL-4) D WCPB Q:IBQ
"RTN","IBJDF52",135,0)
 . W:WLIN'="" ?26,WLIN,!
"RTN","IBJDF52",136,0)
 K ^UTILITY($J,"W")
"RTN","IBJDF52",137,0)
 Q
"RTN","IBJDF52",138,0)
 ;
"RTN","IBJDF52",139,0)
WCPB ; - Page Break in the middle of Comments
"RTN","IBJDF52",140,0)
 ;
"RTN","IBJDF52",141,0)
 D PAUSE Q:IBQ  D HDR1,HDR2 Q:IBQ
"RTN","IBJDF52",142,0)
 W ! D WPAT D WCD W:IBC1>1 ?26,"(continued)",!
"RTN","IBJDF52",143,0)
 Q 
"RTN","IBJDF52",144,0)
 ;
"RTN","IBJDF52",145,0)
WCD ; - Write comment date.
"RTN","IBJDF52",146,0)
 W !?2,"Comment Date: ",$$DAT1^IBOUTL(IBCD)
"RTN","IBJDF52",147,0)
 Q
"RTN","IBJDF52",148,0)
 ;
"RTN","IBJDF52",149,0)
SSN(X) ; - Format the SSN.
"RTN","IBJDF52",150,0)
 Q $S(X:$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),1:"")
"RTN","IBJDF53")
0^25^B23014780
"RTN","IBJDF53",1,0)
IBJDF53 ;ALB/RB - CHAMPVA/TRICARE FOLLOW-UP REPORT (SUMMARY);15-APR-00
"RTN","IBJDF53",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185,240**;21-MAR-94
"RTN","IBJDF53",3,0)
 ;
"RTN","IBJDF53",4,0)
INIT ; - Initialize counters, if necessary.
"RTN","IBJDF53",5,0)
 ;   Pre-set variables  IBCAT, IBDIV, IBSEL1 required.
"RTN","IBJDF53",6,0)
 N I,IB0
"RTN","IBJDF53",7,0)
 I '$D(IB(IBDIV,IBCAT)) D
"RTN","IBJDF53",8,0)
 . F IB0=1:1:4 I IBSEL1[IB0 F I=1:1:8 S IB(IBDIV,IBCAT,IB0,I)=0
"RTN","IBJDF53",9,0)
 ;
"RTN","IBJDF53",10,0)
 Q
"RTN","IBJDF53",11,0)
 ;
"RTN","IBJDF53",12,0)
EN ; - Compile entry point from IBJDF51.
"RTN","IBJDF53",13,0)
 ;   Pre-set variables IB(, IBA, IBCAT, IBDIV, IBSEL1, IBTYP required.
"RTN","IBJDF53",14,0)
 N I,IB0,IBAGE,IBARD,IBOUT
"RTN","IBJDF53",15,0)
 ;
"RTN","IBJDF53",16,0)
 ; - Add totals for summary.
"RTN","IBJDF53",17,0)
 S IBARD=$$ACT^IBJDF2(IBA) G:'IBARD ENQ ; No activation date.
"RTN","IBJDF53",18,0)
 S IBOUT=0 F I=1:1:5 S IBOUT=IBOUT+$P($G(^PRCA(430,IBA,7)),U,I)
"RTN","IBJDF53",19,0)
 S IBAGE=$$FMDIFF^XLFDT(DT,IBARD),IB0=$$CAT(IBAGE)
"RTN","IBJDF53",20,0)
 F I=IBTYP,4 I IBSEL1[I D
"RTN","IBJDF53",21,0)
 . S $P(IB(IBDIV,IBCAT,I,IB0),U)=+IB(IBDIV,IBCAT,I,IB0)+1
"RTN","IBJDF53",22,0)
 . S $P(IB(IBDIV,IBCAT,I,IB0),U,2)=$P(IB(IBDIV,IBCAT,I,IB0),U,2)+IBOUT
"RTN","IBJDF53",23,0)
 ;
"RTN","IBJDF53",24,0)
ENQ Q
"RTN","IBJDF53",25,0)
 ;
"RTN","IBJDF53",26,0)
PRT ; - Print entry point from IBJDF52.
"RTN","IBJDF53",27,0)
 N IBDIV
"RTN","IBJDF53",28,0)
 ;
"RTN","IBJDF53",29,0)
 ; - Extract summary data.
"RTN","IBJDF53",30,0)
 I $G(IBXTRACT) D EXTMO(.IB) G ENQ1
"RTN","IBJDF53",31,0)
 ;
"RTN","IBJDF53",32,0)
 S IBDIV=""
"RTN","IBJDF53",33,0)
 F  S IBDIV=$O(IB(IBDIV)) Q:IBDIV=""  D
"RTN","IBJDF53",34,0)
 . S IBCAT=0
"RTN","IBJDF53",35,0)
 . F  S IBCAT=$O(IB(IBDIV,IBCAT)) Q:'IBCAT  D SUM(.IBCAT) Q:IBQ
"RTN","IBJDF53",36,0)
 ;
"RTN","IBJDF53",37,0)
ENQ1 Q
"RTN","IBJDF53",38,0)
 ;
"RTN","IBJDF53",39,0)
EXTMO(IBS) ; Extract/transmit data to DM Extract Module
"RTN","IBJDF53",40,0)
 ; IBS - Array containing the summary information
"RTN","IBJDF53",41,0)
 ;
"RTN","IBJDF53",42,0)
 N IB,IBCT,IBI,IBJ,IBR,IBSQ,IBTP,IBZ
"RTN","IBJDF53",43,0)
 ;
"RTN","IBJDF53",44,0)
 F IBI=1:1:6 F IBJ=1:1:16 S IB(IBI,IBJ)=$S(IBJ#2:0,1:"0.00")
"RTN","IBJDF53",45,0)
 ;
"RTN","IBJDF53",46,0)
 S IBCT=""
"RTN","IBJDF53",47,0)
 F  S IBCT=$O(IBS(0,IBCT)) Q:IBCT=""  D
"RTN","IBJDF53",48,0)
 . S IBTP=0
"RTN","IBJDF53",49,0)
 . I IBCT=31 S IBTP=1      ;  TRICARE Patient
"RTN","IBJDF53",50,0)
 . I IBCT=19 Q             ;  Sharing Agreements (NOT EXTRACTED)
"RTN","IBJDF53",51,0)
 . I IBCT=30 S IBTP=2      ;  TRICARE
"RTN","IBJDF53",52,0)
 . I IBCT=32 S IBTP=3      ;  TRICARE THIRD PARTY
"RTN","IBJDF53",53,0)
 . I IBCT=28 S IBTP=4      ;  CHAMPVA
"RTN","IBJDF53",54,0)
 . I IBCT=29 S IBTP=5      ;  CHAMPVA THRID PARTY
"RTN","IBJDF53",55,0)
 . S IBSQ=1
"RTN","IBJDF53",56,0)
 . F IBI=1:1:7 D
"RTN","IBJDF53",57,0)
 . . S IBZ=$G(IBS(0,IBCT,4,IBI))
"RTN","IBJDF53",58,0)
 . . S IB(IBTP,IBSQ)=+IBZ
"RTN","IBJDF53",59,0)
 . . S IB(IBTP,IBSQ+1)=$FN(+$P(IBZ,"^",2),"",2)
"RTN","IBJDF53",60,0)
 . . S IB(IBTP,15)=IB(IBTP,15)+IBZ
"RTN","IBJDF53",61,0)
 . . S IB(IBTP,16)=IB(IBTP,16)+$P(IBZ,"^",2)
"RTN","IBJDF53",62,0)
 . . S IBSQ=IBSQ+2
"RTN","IBJDF53",63,0)
 . S IB(IBTP,16)=$FN(IB(IBTP,16),"",2)
"RTN","IBJDF53",64,0)
 ;
"RTN","IBJDF53",65,0)
 F IBR=17:1:21 D E^IBJDE(IBR,0)
"RTN","IBJDF53",66,0)
 Q
"RTN","IBJDF53",67,0)
 ;
"RTN","IBJDF53",68,0)
SUM(IBCAT) ; - Print summary for AR category.
"RTN","IBJDF53",69,0)
 ;  Input: IBCAT=AR category pointer to file #430.2, and pre-set
"RTN","IBJDF53",70,0)
 ;         variables IBDIV and IBRPT
"RTN","IBJDF53",71,0)
 N IBDH,IBTYP,IBTYPH,I,J
"RTN","IBJDF53",72,0)
 ;
"RTN","IBJDF53",73,0)
 S (IBFLG,IBTYP)=0 D HDR
"RTN","IBJDF53",74,0)
 F  S IBTYP=$O(IB(IBDIV,IBCAT,IBTYP)) Q:'IBTYP  D  Q:IBQ
"RTN","IBJDF53",75,0)
 . I $Y>(IOSL-16) D HDR Q:IBQ
"RTN","IBJDF53",76,0)
 . S IBTYPH=$G(IBCTG(IBCAT(IBCAT)))_" RECEIVABLES ("_$G(IBTPR(IBTYP))_")"
"RTN","IBJDF53",77,0)
 . W !!!?(80-$L(IBTYPH))\2,IBTYPH
"RTN","IBJDF53",78,0)
 . W !?(80-$L(IBTYPH)\2),$$DASH($L(IBTYPH))
"RTN","IBJDF53",79,0)
 . I IBDIV D
"RTN","IBJDF53",80,0)
 . . S IBDH="Division: "_$P($G(^DG(40.8,IBDIV,0)),U)
"RTN","IBJDF53",81,0)
 . . W !?(80-$L(IBDH)\2),IBDH
"RTN","IBJDF53",82,0)
 . W !!
"RTN","IBJDF53",83,0)
 . ;
"RTN","IBJDF53",84,0)
 . ; - Calculate totals first.
"RTN","IBJDF53",85,0)
 . F I=1:1:7 F J=1,2 S $P(IB(IBDIV,IBCAT,IBTYP,8),U,J)=$P(IB(IBDIV,IBCAT,IBTYP,8),U,J)+$P(IB(IBDIV,IBCAT,IBTYP,I),U,J)
"RTN","IBJDF53",86,0)
 . ;
"RTN","IBJDF53",87,0)
 . W "AR Category",?31,"# Receivables",?52,"Total Outstanding Balance",!
"RTN","IBJDF53",88,0)
 . W "-----------",?31,"-------------",?52,"-------------------------"
"RTN","IBJDF53",89,0)
 . I 'IB(IBDIV,IBCAT,IBTYP,8) D  D PAUSE Q
"RTN","IBJDF53",90,0)
 . . W !!,"There are no active receivables",$S(IBDIV:" for this division",1:""),"."
"RTN","IBJDF53",91,0)
 . . S IBFLG=1
"RTN","IBJDF53",92,0)
 . ;
"RTN","IBJDF53",93,0)
 . ; - Primary loop to write results.
"RTN","IBJDF53",94,0)
 . S Y=$P(IB(IBDIV,IBCAT,IBTYP,8),U,2)
"RTN","IBJDF53",95,0)
 . F I=1:1:8 S X=$P($T(CATN+I),";;",2,99) D
"RTN","IBJDF53",96,0)
 . . W:I=8 ! W !,X,?30,$J(+IB(IBDIV,IBCAT,IBTYP,I),6)
"RTN","IBJDF53",97,0)
 . . W "  (",$J(+IB(IBDIV,IBCAT,IBTYP,I)/+IB(IBDIV,IBCAT,IBTYP,8)*100,0,$S(I=8:0,1:2)),"%)"
"RTN","IBJDF53",98,0)
 . . S Z=$FN($P(IB(IBDIV,IBCAT,IBTYP,I),U,2),",",2)
"RTN","IBJDF53",99,0)
 . . W ?52,$J($S(I=1!(I=9):"$",1:"")_Z,15)
"RTN","IBJDF53",100,0)
 . . W "  (",$J($S('Y:0,1:$P(IB(IBDIV,IBCAT,IBTYP,I),U,2)/Y*100),0,$S(I=8:0,1:2)),"%)"
"RTN","IBJDF53",101,0)
 . ;
"RTN","IBJDF53",102,0)
 . D PAUSE
"RTN","IBJDF53",103,0)
 ;
"RTN","IBJDF53",104,0)
SUMQ Q
"RTN","IBJDF53",105,0)
 ;
"RTN","IBJDF53",106,0)
HDR ; - Write the summary report header.
"RTN","IBJDF53",107,0)
 N X
"RTN","IBJDF53",108,0)
 ;
"RTN","IBJDF53",109,0)
 I $E(IOST,1,2)="C-"!$G(IBPAG) W @IOF,*13
"RTN","IBJDF53",110,0)
 S IBPAG=$G(IBPAG)+1
"RTN","IBJDF53",111,0)
 W "CHAMPVA/TRICARE FOLLOW-UP SUMMARY REPORT"
"RTN","IBJDF53",112,0)
 W ?71,"Page: ",$J(IBPAG,3),!,"Run Date: ",IBRUN
"RTN","IBJDF53",113,0)
 S X=""
"RTN","IBJDF53",114,0)
 I IBRPT="D" D
"RTN","IBJDF53",115,0)
 . I IBSMN'="A" D
"RTN","IBJDF53",116,0)
 . . S X="  RECEIVABLES OVER "_IBSMN_" AND LESS THAN "_IBSMX_" DAYS OLD "
"RTN","IBJDF53",117,0)
 . I $G(IBSNA)'="ALL" D
"RTN","IBJDF53",118,0)
 . . S X=X_"/ PATIENTS FROM '"_$S(IBSNF="":"FIRST",1:IBSNF)_"' TO '"
"RTN","IBJDF53",119,0)
 . . S X=X_$S(IBSNL="zzzzz":"LAST",1:IBSNL)_"' "
"RTN","IBJDF53",120,0)
 . I $G(IBSAM) S X=X_"/ MINIMUM BALANCE: $"_$FN(IBSAM,",",2)_" "
"RTN","IBJDF53",121,0)
 S $E(X,1,2)=""
"RTN","IBJDF53",122,0)
 I X'="" F I=1:1 W !,$E(X,1,80) S X=$E(X,81,999) I X="" Q
"RTN","IBJDF53",123,0)
 ;
"RTN","IBJDF53",124,0)
 Q
"RTN","IBJDF53",125,0)
 ;
"RTN","IBJDF53",126,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDF53",127,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDF53",128,0)
 ;
"RTN","IBJDF53",129,0)
PAUSE ; - Page break.
"RTN","IBJDF53",130,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDF53",131,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDF53",132,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBJDF53",133,0)
 S DIR(0)="E" D ^DIR S:$D(DIRUT)!($D(DUOUT)) IBQ=1
"RTN","IBJDF53",134,0)
 Q
"RTN","IBJDF53",135,0)
 ;
"RTN","IBJDF53",136,0)
CAT(X) ; - Determine category to place receivable.
"RTN","IBJDF53",137,0)
 Q $S($G(X)<31:1,X<61:2,X<91:3,X<121:4,X<181:5,X<366:6,1:7)
"RTN","IBJDF53",138,0)
 ;
"RTN","IBJDF53",139,0)
CATN ; - List of category names.
"RTN","IBJDF53",140,0)
 ;;Less than 30 days old
"RTN","IBJDF53",141,0)
 ;;31-60 days
"RTN","IBJDF53",142,0)
 ;;61-90 days
"RTN","IBJDF53",143,0)
 ;;91-120 days
"RTN","IBJDF53",144,0)
 ;;121-180 days
"RTN","IBJDF53",145,0)
 ;;181-365 days
"RTN","IBJDF53",146,0)
 ;;Over 365 days
"RTN","IBJDF53",147,0)
 ;;Total C/C-Tricare Receivables
"RTN","IBJDF5H")
0^28^B8952836
"RTN","IBJDF5H",1,0)
IBJDF5H ;ALB/RB - CHAMPVA/TRICARE FOLLOW-UP REPORT (HELP);15-APR-00
"RTN","IBJDF5H",2,0)
 ;;2.0;INTEGRATED BILLING;**123,240**;21-MAR-94
"RTN","IBJDF5H",3,0)
 ;
"RTN","IBJDF5H",4,0)
HELP W ! F  S IBTEXT=$P($T(TEXT+IBOFF),";",3) Q:IBTEXT="*END*"  D
"RTN","IBJDF5H",5,0)
 .W !,IBTEXT S IBOFF=IBOFF+1
"RTN","IBJDF5H",6,0)
 W !
"RTN","IBJDF5H",7,0)
 Q
"RTN","IBJDF5H",8,0)
 ;
"RTN","IBJDF5H",9,0)
TEXT ; - 'Include (A)LL active AR's...' prompt (Offset=1).
"RTN","IBJDF5H",10,0)
 ;;      Enter:  '<CR>' -  To include all active receivables on the
"RTN","IBJDF5H",11,0)
 ;;                         report
"RTN","IBJDF5H",12,0)
 ;;              'R'    -  To restrict receivables to those within
"RTN","IBJDF5H",13,0)
 ;;                         a certain age range
"RTN","IBJDF5H",14,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF5H",15,0)
 ;;*END*
"RTN","IBJDF5H",16,0)
 ;
"RTN","IBJDF5H",17,0)
 ; - 'Enter the minimum age...' prompt (Offset=9).
"RTN","IBJDF5H",18,0)
 ;; Enter the minimum days in which the receivable should have been in
"RTN","IBJDF5H",19,0)
 ;; an active status, or '^' to quit this option.
"RTN","IBJDF5H",20,0)
 ;;*END*
"RTN","IBJDF5H",21,0)
 ;
"RTN","IBJDF5H",22,0)
 ; - 'Enter the maximum age...' prompt (Offset=14).
"RTN","IBJDF5H",23,0)
 ;; Enter the maximum days in which the receivable should have been in
"RTN","IBJDF5H",24,0)
 ;;  an active status, or '^' to quit this option.
"RTN","IBJDF5H",25,0)
 ;;*END*
"RTN","IBJDF5H",26,0)
 ;
"RTN","IBJDF5H",27,0)
 ; - 'Print receivables with a minimum...' prompt (Offset=19).
"RTN","IBJDF5H",28,0)
 ;;      Enter:  'Y'    -  To print just those receivables that are over
"RTN","IBJDF5H",29,0)
 ;;                        a certain balance amount
"RTN","IBJDF5H",30,0)
 ;;              '<CR>' -  To skip this question
"RTN","IBJDF5H",31,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF5H",32,0)
 ;;*END*
"RTN","IBJDF5H",33,0)
 ;
"RTN","IBJDF5H",34,0)
 ; - 'Enter the minimum balance amount...' prompt (Offset=26).
"RTN","IBJDF5H",35,0)
 ;; Enter the minimum balance amount for the receivable, or '^' to quit
"RTN","IBJDF5H",36,0)
 ;; this option.
"RTN","IBJDF5H",37,0)
 ;;*END*
"RTN","IBJDF5H",38,0)
 ;
"RTN","IBJDF5H",39,0)
 ; - 'Include the Bill Comment history...' prompt (Offset=31).
"RTN","IBJDF5H",40,0)
 ;;      Enter:  '<CR>' -  To exclude the bill comment history from the
"RTN","IBJDF5H",41,0)
 ;;                        report
"RTN","IBJDF5H",42,0)
 ;;              'Y'    -  To include the bill comment history to the
"RTN","IBJDF5H",43,0)
 ;;                        report (This history includes the date
"RTN","IBJDF5H",44,0)
 ;;                        and comments from comment transactions)
"RTN","IBJDF5H",45,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF5H",46,0)
 ;;*END*
"RTN","IBJDF5H",47,0)
 ;
"RTN","IBJDF5H",48,0)
 ; - 'Print (A)ll comments...' prompt (Offset=40).
"RTN","IBJDF5H",49,0)
 ;;      Enter:  '<CR>' -  To print ALL comments for a receivable
"RTN","IBJDF5H",50,0)
 ;;              'M'    -  To print the only the most recent comment
"RTN","IBJDF5H",51,0)
 ;;                         entered for a receivable
"RTN","IBJDF5H",52,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF5H",53,0)
 ;;*END*
"RTN","IBJDF5H",54,0)
 ;
"RTN","IBJDF5H",55,0)
 ; - 'Minimum age of most recent...' prompt (Offset=47).
"RTN","IBJDF5H",56,0)
 ;; Enter the minimum age (number of days ago) of an AR's most recent
"RTN","IBJDF5H",57,0)
 ;; bill comment. AR's with recent comments that are at least this age
"RTN","IBJDF5H",58,0)
 ;; will be included on the report. Enter '<CR>' to skip this prompt,
"RTN","IBJDF5H",59,0)
 ;; or '^' to quit this option.
"RTN","IBJDF5H",60,0)
 ;;*END*
"RTN","IBJDF7H")
0^26^B10633753
"RTN","IBJDF7H",1,0)
IBJDF7H ;ALB/MR - REPAYMENT PLAN REPORT (HELP);14-AUG-00
"RTN","IBJDF7H",2,0)
 ;;2.0;INTEGRATED BILLING;**123,240**;21-MAR-94
"RTN","IBJDF7H",3,0)
 ;
"RTN","IBJDF7H",4,0)
HELP W ! F  S IBTEXT=$P($T(TEXT+IBOFF),";",3) Q:IBTEXT="*END*"  D
"RTN","IBJDF7H",5,0)
 .W !,IBTEXT S IBOFF=IBOFF+1
"RTN","IBJDF7H",6,0)
 W !
"RTN","IBJDF7H",7,0)
 Q
"RTN","IBJDF7H",8,0)
 ;
"RTN","IBJDF7H",9,0)
TEXT ; - 'Sort Patients by (N)AME... ' prompt (Offset=1).
"RTN","IBJDF7H",10,0)
 ;;      Enter:  'N'  -  To select and sort patients by name
"RTN","IBJDF7H",11,0)
 ;;              'L'  -  To select and sort patients by the last 4
"RTN","IBJDF7H",12,0)
 ;;                      of the SSN
"RTN","IBJDF7H",13,0)
 ;;              '^'  -  To quit this option
"RTN","IBJDF7H",14,0)
 ;;*END*
"RTN","IBJDF7H",15,0)
 ;
"RTN","IBJDF7H",16,0)
 ; - 'START WITH PATIENT...' prompt (Offset=8).
"RTN","IBJDF7H",17,0)
 ;;      Enter a valid field value, or
"RTN","IBJDF7H",18,0)
 ;;              '@'    -  To include null values
"RTN","IBJDF7H",19,0)
 ;;              '<CR>' -  To start from the 'first' value for this field
"RTN","IBJDF7H",20,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF7H",21,0)
 ;;*END*
"RTN","IBJDF7H",22,0)
 ;
"RTN","IBJDF7H",23,0)
 ; - 'GO TO PATIENT' prompt (Offset=16).
"RTN","IBJDF7H",24,0)
 ;;      Enter a valid field value, or
"RTN","IBJDF7H",25,0)
 ;;              '@'    -  To include only null values, if 'Start with'
"RTN","IBJDF7H",26,0)
 ;;                         value is @
"RTN","IBJDF7H",27,0)
 ;;              '<CR>' -  To go to the 'last' value for this field
"RTN","IBJDF7H",28,0)
 ;;              '^'    -  To quit this option
"RTN","IBJDF7H",29,0)
 ;;*END*
"RTN","IBJDF7H",30,0)
 ;
"RTN","IBJDF7H",31,0)
 ; - 'Current or Defaulted Repayment Plan...' prompt (Offset=23).
"RTN","IBJDF7H",32,0)
 ;;      Enter the type of Repayment Plan to be listed:
"RTN","IBJDF7H",33,0)
 ;;                
"RTN","IBJDF7H",34,0)
 ;;              'C'  -  To Current Repayment Plan
"RTN","IBJDF7H",35,0)
 ;;              'D'  -  To Defaulted Repayment Plan
"RTN","IBJDF7H",36,0)
 ;;              'B'  -  To Both (Current and Defaulted)
"RTN","IBJDF7H",37,0)
 ;;              '^'  -  To quit this option
"RTN","IBJDF7H",38,0)
 ;;*END*
"RTN","IBJDF7H",39,0)
 ;
"RTN","IBJDF7H",40,0)
 ; - 'Minimum number of days defaulted:' prompt (Offset=32).
"RTN","IBJDF7H",41,0)
 ;;  Please, enter the minimum number of days defaulted on a payment
"RTN","IBJDF7H",42,0)
 ;;  for a Repayment Plan to be considered defaulted. The  Repayment 
"RTN","IBJDF7H",43,0)
 ;;  Plans with no defaulted payments or that defaulted  fewer  days
"RTN","IBJDF7H",44,0)
 ;;  than the number entered here, will be considered current.
"RTN","IBJDF7H",45,0)
 ;;*END*
"RTN","IBJDF7H",46,0)
 ;
"RTN","IBJDF7H",47,0)
 ; - 'MCCR or NON-MCCR Receivables..." prompt (Offset=39).
"RTN","IBJDF7H",48,0)
 ;;         Enter the type of receivables to be listed:
"RTN","IBJDF7H",49,0)
 ;;
"RTN","IBJDF7H",50,0)
 ;;              'M'  -  To MCCR Receivables
"RTN","IBJDF7H",51,0)
 ;;              'N'  -  To NON-MCCR Receivables
"RTN","IBJDF7H",52,0)
 ;;
"RTN","IBJDF7H",53,0)
 ;;              The NON-MCCR Categories are:
"RTN","IBJDF7H",54,0)
 ;;
"RTN","IBJDF7H",55,0)
 ;;     TRICARE          TRICARE Patient        TRICARE Third Party
"RTN","IBJDF7H",56,0)
 ;;     CHAMPVA          CHAMPVA Subsistence    CHAMPVA Third Party
"RTN","IBJDF7H",57,0)
 ;;     Ex-Employee      Current Employee       Military
"RTN","IBJDF7H",58,0)
 ;;     Vendor           Interagency            Sharing Agreements
"RTN","IBJDF7H",59,0)
 ;;     Federal Agencies-refund      Federal Agencies-reimbursement
"RTN","IBJDF7H",60,0)
 ;;
"RTN","IBJDF7H",61,0)
 ;;              All the others are MCCR.
"RTN","IBJDF7H",62,0)
 ;;*END*
"RTN","IBJDF7H",63,0)
 ; - 'Do you want to print TOTAL by Patient?' prompt (Offset=55).
"RTN","IBJDF7H",64,0)
 ;;      Enter:  'Y'  -  To print the total for patients with more
"RTN","IBJDF7H",65,0)
 ;;                      than one entry
"RTN","IBJDF7H",66,0)
 ;;              'N'  -  To NOT print the total by patient
"RTN","IBJDF7H",67,0)
 ;;              '^'  -  To quit this option
"RTN","IBJDF7H",68,0)
 ;;*END*
"VER")
8.0^22
"^DD",350.1,350.1,.11,0)
BILLING GROUP^S^1:INPT/NHCU FEE SERVICE;2:INPT/NHCU COPAY;3:INPT/NHCU PER DIEM;4:OPT COPAY;5:RX COPAY;6:CHAMPVA;7:TRICARE;8:LTC OPT;9:LTC INPT;^0;11^Q
"^DD",350.1,350.1,.11,3)
Enter Group for manual charge processing.
"^DD",350.1,350.1,.11,21,0)
^^2^2^2920415^
"^DD",350.1,350.1,.11,21,1,0)
This field is a set of codes used to enter the group for
"^DD",350.1,350.1,.11,21,2,0)
manual charge processing.
"^DD",350.1,350.1,.11,"DT")
3040316
"^DD",350.9,350.9,9.01,0)
BILLING PORT^F^^9;1^K:$L(X)>15!($L(X)<3) X
"^DD",350.9,350.9,9.01,3)
Answer must be 3-15 characters in length.
"^DD",350.9,350.9,9.01,21,0)
^^4^4^3040512^
"^DD",350.9,350.9,9.01,21,1,0)
This is the logical port which is opened to transmit pharmacy
"^DD",350.9,350.9,9.01,21,2,0)
transactions to the TRICARE fiscal intermediary.  If there is
"^DD",350.9,350.9,9.01,21,3,0)
no value in this field, the Pharmacy billing engine cannot
"^DD",350.9,350.9,9.01,21,4,0)
be started.
"^DD",350.9,350.9,9.01,"DT")
3040512
"^DD",350.9,350.9,9.02,0)
AWP PORT^F^^9;2^K:$L(X)>15!($L(X)<3) X
"^DD",350.9,350.9,9.02,3)
Answer must be 3-15 characters in length.
"^DD",350.9,350.9,9.02,21,0)
^^3^3^3040512^
"^DD",350.9,350.9,9.02,21,1,0)
This is the logical port which is opened to receive AWP updates
"^DD",350.9,350.9,9.02,21,2,0)
from the TRICARE fiscal intermediary.  If this field has no value,
"^DD",350.9,350.9,9.02,21,3,0)
the AWP update engine cannot be started.
"^DD",350.9,350.9,9.02,"DT")
3040512
"^DD",350.9,350.9,9.12,0)
AWP CHARGE SET^*P363.1'^IBE(363.1,^9;12^S DIC("S")="I +$$CSBI^IBCRU3(Y)=3" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",350.9,350.9,9.12,12)
This screen only allows Charge Sets which are based on NDC numbers.
"^DD",350.9,350.9,9.12,12.1)
S DIC("S")="I +$$CSBI^IBCRU3(Y)=3"
"^DD",350.9,350.9,9.12,21,0)
^^3^3^3040512^
"^DD",350.9,350.9,9.12,21,1,0)
The value of this field points to a Charge Set in file #363.1 which
"^DD",350.9,350.9,9.12,21,2,0)
will be used to retrieve the Average Wholesale Price (AWP) of a
"^DD",350.9,350.9,9.12,21,3,0)
drug when the TRICARE Pharmacy Billing software interface is running.
"^DD",350.9,350.9,9.12,"DT")
3040512
"^DD",350.9,350.9,9.13,0)
PRESCRIBER ID^F^^9;13^K:$L(X)>15!($L(X)<3) X
"^DD",350.9,350.9,9.13,3)
Answer must be 3-15 characters in length.
"^DD",350.9,350.9,9.13,21,0)
^^6^6^3040512^
"^DD",350.9,350.9,9.13,21,1,0)
The Prescriber ID is assigned by the TRICARE fiscal intermediary
"^DD",350.9,350.9,9.13,21,2,0)
to a facility.  The ID is used in the TRICARE pharmacy billing
"^DD",350.9,350.9,9.13,21,3,0)
transmission to identify the facility to the intermediary.
"^DD",350.9,350.9,9.13,21,4,0)
 
"^DD",350.9,350.9,9.13,21,5,0)
There must be a value in this field in order to start the TRICARE
"^DD",350.9,350.9,9.13,21,6,0)
pharmacy billing interface task.
"^DD",350.9,350.9,9.13,23,0)
^^2^2^3001120^
"^DD",350.9,350.9,9.13,23,1,0)
 
"^DD",350.9,350.9,9.13,23,2,0)
 
"^DD",350.9,350.9,9.13,"DT")
3040512
"^DD",351.5,351.5,0)
FIELD^^8.01^33
"^DD",351.5,351.5,0,"DDA")
N
"^DD",351.5,351.5,0,"DT")
3010831
"^DD",351.5,351.5,0,"IX","ACC",351.5,.08)

"^DD",351.5,351.5,0,"IX","ACL",351.5,.09)

"^DD",351.5,351.5,0,"IX","AUTH",351.5,2.06)

"^DD",351.5,351.5,0,"IX","B",351.5,.01)

"^DD",351.5,351.5,0,"NM","TRICARE PHARMACY TRANSACTIONS")

"^DD",351.5,351.5,0,"PT",351.52,.02)

"^DD",351.5,351.5,0,"VRPK")
IB
"^DD",351.5,351.5,.01,0)
PRESCRIPTION^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",351.5,351.5,.01,1,0)
^.1
"^DD",351.5,351.5,.01,1,1,0)
351.5^B
"^DD",351.5,351.5,.01,1,1,1)
S ^IBA(351.5,"B",$E(X,1,30),DA)=""
"^DD",351.5,351.5,.01,1,1,2)
K ^IBA(351.5,"B",$E(X,1,30),DA)
"^DD",351.5,351.5,.01,3)
Answer must be 3-30 characters in length.
"^DD",351.5,351.5,.01,"DT")
2960816
"^DD",351.5,351.5,.02,0)
PATIENT^P2'^DPT(^0;2^Q
"^DD",351.5,351.5,.02,"DT")
2960816
"^DD",351.5,351.5,.03,0)
CARD HOLDER SSN^F^^0;3^K:$L(X)>12!($L(X)<1) X
"^DD",351.5,351.5,.03,3)
Answer must be 1-12 characters in length.
"^DD",351.5,351.5,.03,"DT")
2960816
"^DD",351.5,351.5,.04,0)
NDC^F^^0;4^K:$L(X)>11!($L(X)<1) X
"^DD",351.5,351.5,.04,3)
Answer must be 1-11 characters in length.
"^DD",351.5,351.5,.04,"DT")
2960816
"^DD",351.5,351.5,.05,0)
AMOUNT TRANSMITTED^NJ10,2^^0;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>9999999)!(X<1) X
"^DD",351.5,351.5,.05,3)
Type a Dollar Amount between 1 and 9999999, 2 Decimal Digits
"^DD",351.5,351.5,.05,"DT")
2960816
"^DD",351.5,351.5,.06,0)
QUANTITY^NJ5,0^^0;6^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X
"^DD",351.5,351.5,.06,3)
Type a Number between 1 and 99999, 0 Decimal Digits
"^DD",351.5,351.5,.06,"DT")
2960816
"^DD",351.5,351.5,.07,0)
TRANSACTION DATE^D^^0;7^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",351.5,351.5,.07,"DT")
2960816
"^DD",351.5,351.5,.08,0)
COPAYMENT CHARGE^P350'^IB(^0;8^Q
"^DD",351.5,351.5,.08,1,0)
^.1
"^DD",351.5,351.5,.08,1,1,0)
351.5^ACC
"^DD",351.5,351.5,.08,1,1,1)
S ^IBA(351.5,"ACC",$E(X,1,30),DA)=""
"^DD",351.5,351.5,.08,1,1,2)
K ^IBA(351.5,"ACC",$E(X,1,30),DA)
"^DD",351.5,351.5,.08,1,1,"DT")
2960827
"^DD",351.5,351.5,.08,21,0)
^^2^2^2960819^
"^DD",351.5,351.5,.08,21,1,0)
This field points to the copayment charge in the INTEGRATED BILLING
"^DD",351.5,351.5,.08,21,2,0)
ACTION (#350) file which was actually billed to the patient.
"^DD",351.5,351.5,.08,"DT")
2960827
"^DD",351.5,351.5,.09,0)
FISCAL INTERMEDIARY CLAIM^P399'^DGCR(399,^0;9^Q
"^DD",351.5,351.5,.09,1,0)
^.1
"^DD",351.5,351.5,.09,1,1,0)
351.5^ACL
"^DD",351.5,351.5,.09,1,1,1)
S ^IBA(351.5,"ACL",$E(X,1,30),DA)=""
"^DD",351.5,351.5,.09,1,1,2)
K ^IBA(351.5,"ACL",$E(X,1,30),DA)
"^DD",351.5,351.5,.09,1,1,"DT")
2960827
"^DD",351.5,351.5,.09,21,0)
^^5^5^2960819^
"^DD",351.5,351.5,.09,21,1,0)
This field points to the claim in the BILL/CLAIMS (#399) file
"^DD",351.5,351.5,.09,21,2,0)
which was created after the response from the FI was received.
"^DD",351.5,351.5,.09,21,3,0)
Creation of this claim also establishes a receivable in the
"^DD",351.5,351.5,.09,21,4,0)
ACCOUNTS RECEIVABLE (#430) file against which the FI payment
"^DD",351.5,351.5,.09,21,5,0)
will be posted.
"^DD",351.5,351.5,.09,"DT")
2960827
"^DD",351.5,351.5,.1,0)
PRODUCT SELECTION REASON^P351.53'^IBA(351.53,^0;10^Q
"^DD",351.5,351.5,.1,3)
Choose a Product Selection Reason from those listed.
"^DD",351.5,351.5,.1,21,0)
^.001^1^1^3010906^^^
"^DD",351.5,351.5,.1,21,1,0)
This field will store the Product Selection Reason for billing acceptance.
"^DD",351.5,351.5,.1,"DT")
3010831
"^DD",351.5,351.5,2.01,0)
COPAY^NJ9,2^^2;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,2.01,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,2.01,"DT")
2960816
"^DD",351.5,351.5,2.02,0)
INGREDIENT COST PAID^NJ9,2^^2;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,2.02,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,2.02,"DT")
2960816
"^DD",351.5,351.5,2.03,0)
CONTRACT FEE PAID^NJ9,2^^2;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,2.03,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,2.03,"DT")
2960816
"^DD",351.5,351.5,2.04,0)
SALES TAX PAID^NJ9,2^^2;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,2.04,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,2.04,"DT")
2960816
"^DD",351.5,351.5,2.05,0)
TOTAL AMOUNT PAID^NJ9,2^^2;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,2.05,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,2.05,"DT")
2960816
"^DD",351.5,351.5,2.06,0)
AUTHORIZATION NUMBER^F^^2;6^K:$L(X)>14!($L(X)<1) X
"^DD",351.5,351.5,2.06,1,0)
^.1
"^DD",351.5,351.5,2.06,1,1,0)
351.5^AUTH
"^DD",351.5,351.5,2.06,1,1,1)
S ^IBA(351.5,"AUTH",$E(X,1,30),DA)=""
"^DD",351.5,351.5,2.06,1,1,2)
K ^IBA(351.5,"AUTH",$E(X,1,30),DA)
"^DD",351.5,351.5,2.06,1,1,"DT")
2960821
"^DD",351.5,351.5,2.06,3)
Answer must be 1-14 characters in length.
"^DD",351.5,351.5,2.06,"DT")
2960821
"^DD",351.5,351.5,2.07,0)
MESSAGE^F^^2;7^K:$L(X)>40!($L(X)<1) X
"^DD",351.5,351.5,2.07,3)
Answer must be 1-40 characters in length.
"^DD",351.5,351.5,2.07,"DT")
2960816
"^DD",351.5,351.5,3.01,0)
ACCUMULATED DEDUCTIBLE AMOUNT^NJ11,2^^3;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999999)!(X<1) X
"^DD",351.5,351.5,3.01,3)
Type a Dollar Amount between 1 and 99999999, 2 Decimal Digits
"^DD",351.5,351.5,3.01,"DT")
2960816
"^DD",351.5,351.5,3.02,0)
REMAINING DEDUCTABLE AMOUNT^NJ11,2^^3;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999999)!(X<1) X
"^DD",351.5,351.5,3.02,3)
Type a Dollar Amount between 1 and 99999999, 2 Decimal Digits
"^DD",351.5,351.5,3.02,"DT")
2960816
"^DD",351.5,351.5,3.03,0)
REMAINING BENEFIT AMOUNT^NJ11,2^^3;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999999)!(X<1) X
"^DD",351.5,351.5,3.03,3)
Type a Dollar Amount between 1 and 99999999, 2 Decimal Digits
"^DD",351.5,351.5,3.03,"DT")
2960816
"^DD",351.5,351.5,3.04,0)
ATM APPL TO PER DEDUCTIBLE^NJ9,2^^3;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.04,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.04,"DT")
2960816
"^DD",351.5,351.5,3.05,0)
AMT COPAY/COINSURANCE^NJ9,2^^3;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.05,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.05,"DT")
2960816
"^DD",351.5,351.5,3.06,0)
AMT ATTRIB TO PROD SEL^NJ9,2^^3;6^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.06,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.06,"DT")
2960816
"^DD",351.5,351.5,3.07,0)
AMT EXCEEDING PERIODIC MAX BEN^NJ9,2^^3;7^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.07,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.07,"DT")
2960816
"^DD",351.5,351.5,3.08,0)
INCENTIVE FEE PAID^NJ9,2^^3;8^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.08,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.08,"DT")
2960816
"^DD",351.5,351.5,3.09,0)
BASIS OF REIMB DETERMINATION^S^0:NOT SPECIFIED;1:PAID AS SUBMITTED;2:REDUCED TO AWP;3:AWP-X% PRICING;4:USUAL AND CUSTOMARY;5:LOWER IF ING. COST PLUS FEES VS U&C;6:MAC PRICING;7:MAC REDUCED TO MAC;8:CONTRACT PRICING;^3;9^Q
"^DD",351.5,351.5,3.09,"DT")
2960816
"^DD",351.5,351.5,3.1,0)
AMOUNT ATTRIB TO SALES TAX^NJ9,2^^3;10^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<1) X
"^DD",351.5,351.5,3.1,3)
Type a Dollar Amount between 1 and 999999, 2 Decimal Digits
"^DD",351.5,351.5,3.1,"DT")
2960816
"^DD",351.5,351.5,5.01,0)
ERROR CODES^F^^5;1^K:$L(X)>245!($L(X)<1) X
"^DD",351.5,351.5,5.01,3)
Answer must be 1-245 characters in length.
"^DD",351.5,351.5,5.01,"DT")
2960816
"^DD",351.5,351.5,6.01,0)
REVERSAL AUTH NUMBER^F^^6;1^K:$L(X)>14!($L(X)<1) X
"^DD",351.5,351.5,6.01,3)
Answer must be 1-14 characters in length.
"^DD",351.5,351.5,6.01,"DT")
2960816
"^DD",351.5,351.5,6.02,0)
REVERSED BY^P200'^VA(200,^6;2^Q
"^DD",351.5,351.5,6.02,"DT")
2960816
"^DD",351.5,351.5,6.03,0)
REVERSAL ERROR CODES^F^^6;3^K:$L(X)>180!($L(X)<1) X
"^DD",351.5,351.5,6.03,3)
Answer must be 1-180 characters in length.
"^DD",351.5,351.5,6.03,"DT")
2960816
"^DD",351.5,351.5,7.01,0)
DUR RESPONSE DATA^F^^7;1^K:$L(X)>160!($L(X)<1) X
"^DD",351.5,351.5,7.01,3)
Answer must be 1-160 characters in length.
"^DD",351.5,351.5,7.01,"DT")
2960816
"^DD",351.5,351.5,8.01,0)
ADDITIONAL MESSAGE INFORMATION^F^^8;1^K:$L(X)>80!($L(X)<1) X
"^DD",351.5,351.5,8.01,3)
Answer must be 1-80 characters in length.
"^DD",351.5,351.5,8.01,"DT")
2960816
"^DD",351.51,351.51,0)
FIELD^^.03^3
"^DD",351.51,351.51,0,"DDA")
N
"^DD",351.51,351.51,0,"DT")
2960815
"^DD",351.51,351.51,0,"IX","AC",351.51,.02)

"^DD",351.51,351.51,0,"IX","AD",351.51,.01)

"^DD",351.51,351.51,0,"IX","AD1",351.51,.02)

"^DD",351.51,351.51,0,"IX","B",351.51,.01)

"^DD",351.51,351.51,0,"NM","TRICARE PHARMACY ERRORS")

"^DD",351.51,351.51,0,"VRPK")
IB
"^DD",351.51,351.51,.01,0)
SYSTEM^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",351.51,351.51,.01,1,0)
^.1
"^DD",351.51,351.51,.01,1,1,0)
351.51^B
"^DD",351.51,351.51,.01,1,1,1)
S ^IBE(351.51,"B",$E(X,1,30),DA)=""
"^DD",351.51,351.51,.01,1,1,2)
K ^IBE(351.51,"B",$E(X,1,30),DA)
"^DD",351.51,351.51,.01,1,2,0)
351.51^AD^MUMPS
"^DD",351.51,351.51,.01,1,2,1)
I $P(^IBE(351.51,DA,0),U,2)]"" S ^IBE(351.51,"AD",X,$P(^(0),U,2),DA)=""
"^DD",351.51,351.51,.01,1,2,2)
I $P(^IBE(351.51,DA,0),U,2)]"" K ^IBE(351.51,"AD",X,$P(^(0),U,2),DA)
"^DD",351.51,351.51,.01,1,2,"%D",0)
^^3^3^2960815^
"^DD",351.51,351.51,.01,1,2,"%D",1,0)
Cross reference of all errors by System and Error Code.
"^DD",351.51,351.51,.01,1,2,"%D",2,0)
The AD1 cross reference on the ERROR CODE (#.02) field is the
"^DD",351.51,351.51,.01,1,2,"%D",3,0)
companion to this cross reference.
"^DD",351.51,351.51,.01,1,2,"DT")
2960815
"^DD",351.51,351.51,.01,3)
Answer must be 3-30 characters in length.
"^DD",351.51,351.51,.01,21,0)
^^12^12^2960815^
"^DD",351.51,351.51,.01,21,1,0)
This field describes the system on which the error occurred.
"^DD",351.51,351.51,.01,21,2,0)
A description of the systems are as follows:
"^DD",351.51,351.51,.01,21,3,0)
 
"^DD",351.51,351.51,.01,21,4,0)
  System         Description
"^DD",351.51,351.51,.01,21,5,0)
  ------         -----------
"^DD",351.51,351.51,.01,21,6,0)
  DHCP           These errors are identified in DHCP.
"^DD",351.51,351.51,.01,21,7,0)
  MLINK          These errors are identified by the commercial
"^DD",351.51,351.51,.01,21,8,0)
                 point-of-sale pharmacy billing package.
"^DD",351.51,351.51,.01,21,9,0)
  UNIVERSAL      These errors are identified by the Fiscal Intermediary.
"^DD",351.51,351.51,.01,21,10,0)
 
"^DD",351.51,351.51,.01,21,11,0)
Both the System and the Error Code are required to identify a
"^DD",351.51,351.51,.01,21,12,0)
specific error, as different systems may use the same error code.
"^DD",351.51,351.51,.01,"DT")
2960815
"^DD",351.51,351.51,.02,0)
ERROR CODE^F^^0;2^K:$L(X)>5!($L(X)<1) X
"^DD",351.51,351.51,.02,1,0)
^.1
"^DD",351.51,351.51,.02,1,1,0)
351.51^AC
"^DD",351.51,351.51,.02,1,1,1)
S ^IBE(351.51,"AC",$E(X,1,30),DA)=""
"^DD",351.51,351.51,.02,1,1,2)
K ^IBE(351.51,"AC",$E(X,1,30),DA)
"^DD",351.51,351.51,.02,1,1,"DT")
2960815
"^DD",351.51,351.51,.02,1,2,0)
351.51^AD1^MUMPS
"^DD",351.51,351.51,.02,1,2,1)
I $P(^IBE(351.51,DA,0),U)]"" S ^IBE(351.51,"AD",$P(^(0),U),X,DA)=""
"^DD",351.51,351.51,.02,1,2,2)
I $P(^IBE(351.51,DA,0),U)]"" K ^IBE(351.51,"AD",$P(^(0),U),X,DA)
"^DD",351.51,351.51,.02,1,2,"%D",0)
^^3^3^2960815^
"^DD",351.51,351.51,.02,1,2,"%D",1,0)
Cross reference of all errors by System and Error Code.
"^DD",351.51,351.51,.02,1,2,"%D",2,0)
The AD cross reference on the SYSTEM (#.01) field is the
"^DD",351.51,351.51,.02,1,2,"%D",3,0)
companion to this cross reference.
"^DD",351.51,351.51,.02,1,2,"DT")
2960815
"^DD",351.51,351.51,.02,3)
Answer must be 1-5 characters in length.
"^DD",351.51,351.51,.02,21,0)
^^2^2^2960815^
"^DD",351.51,351.51,.02,21,1,0)
This code is used, along with the System on which the error occurred,
"^DD",351.51,351.51,.02,21,2,0)
to identify an error.
"^DD",351.51,351.51,.02,"DT")
2960815
"^DD",351.51,351.51,.03,0)
ERROR MESSAGE^F^^0;3^K:$L(X)>60!($L(X)<1) X
"^DD",351.51,351.51,.03,3)
Answer must be 1-60 characters in length.
"^DD",351.51,351.51,.03,21,0)
^^2^2^2960815^
"^DD",351.51,351.51,.03,21,1,0)
This field describes the error identified by both System and
"^DD",351.51,351.51,.03,21,2,0)
error code.
"^DD",351.51,351.51,.03,"DT")
2960815
"^DD",351.52,351.52,0)
FIELD^^1.01^4
"^DD",351.52,351.52,0,"DDA")
N
"^DD",351.52,351.52,0,"DT")
2960816
"^DD",351.52,351.52,0,"IX","B",351.52,.01)

"^DD",351.52,351.52,0,"NM","TRICARE PHARMACY REJECTS")

"^DD",351.52,351.52,0,"VRPK")
IB
"^DD",351.52,351.52,.01,0)
PRESCRIPTION^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",351.52,351.52,.01,1,0)
^.1
"^DD",351.52,351.52,.01,1,1,0)
351.52^B
"^DD",351.52,351.52,.01,1,1,1)
S ^IBA(351.52,"B",$E(X,1,30),DA)=""
"^DD",351.52,351.52,.01,1,1,2)
K ^IBA(351.52,"B",$E(X,1,30),DA)
"^DD",351.52,351.52,.01,3)
Answer must be 3-30 characters in length.
"^DD",351.52,351.52,.01,"DT")
2960816
"^DD",351.52,351.52,.02,0)
ORIGINAL TRANSACTION^P351.5'^IBA(351.5,^0;2^Q
"^DD",351.52,351.52,.02,"DT")
2960816
"^DD",351.52,351.52,.03,0)
REJECTION DATE^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",351.52,351.52,.03,"DT")
2960816
"^DD",351.52,351.52,1.01,0)
REJECTION ERROR CODES^F^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",351.52,351.52,1.01,3)
Answer must be 1-245 characters in length.
"^DD",351.52,351.52,1.01,"DT")
2960816
"^DD",355.3,355.3,.15,0)
ELECTRONIC PLAN TYPE^S^16:HMO MEDICARE;MX:MEDICARE A or B;TV:TITLE V;MC:MEDICAID;BL:BC/BS;TR:TRICARE;15:INDEMNITY;CI:COMMERCIAL;HM:HMO;DS:DISABILITY;12:PPO;13:POS;ZZ:OTHER;^0;15^Q
"^DD",355.3,355.3,.15,3)
Enter the appropriate type of plan to be used for electronic billing.
"^DD",355.3,355.3,.15,21,0)
^^1^1^3000306^^^
"^DD",355.3,355.3,.15,21,1,0)
This field contains the X12 data needed to identify the source of pay type
"^DD",355.3,355.3,.15,23,0)
^^2^2^3000306^
"^DD",355.3,355.3,.15,23,1,0)
This field must be consistent with the ELECTRONIC TYPE OF INSURANCE in file
"^DD",355.3,355.3,.15,23,2,0)
36.
"^DD",355.3,355.3,.15,"DT")
3040430
"^DD",355.8,355.8,0)
FIELD^^.04^4
"^DD",355.8,355.8,0,"DDA")
N
"^DD",355.8,355.8,0,"DT")
2970501
"^DD",355.8,355.8,0,"IX","B",355.8,.01)

"^DD",355.8,355.8,0,"IX","C",355.8,.02)

"^DD",355.8,355.8,0,"NM","SPONSOR")

"^DD",355.8,355.8,0,"PT",355.81,.02)

"^DD",355.8,355.8,0,"VRPK")
IB
"^DD",355.8,355.8,.01,0)
SPONSOR^RV^^0;1^Q
"^DD",355.8,355.8,.01,1,0)
^.1
"^DD",355.8,355.8,.01,1,1,0)
355.8^B
"^DD",355.8,355.8,.01,1,1,1)
S ^IBA(355.8,"B",$E(X,1,30),DA)=""
"^DD",355.8,355.8,.01,1,1,2)
K ^IBA(355.8,"B",$E(X,1,30),DA)
"^DD",355.8,355.8,.01,3)

"^DD",355.8,355.8,.01,23,0)
^^9^9^2970502^
"^DD",355.8,355.8,.01,23,1,0)
This is a variable-pointer field which is used to identify
"^DD",355.8,355.8,.01,23,2,0)
the sponsor.  If the sponsor is a military retiree, then 
"^DD",355.8,355.8,.01,23,3,0)
that person may likely be a patient and thus have a record
"^DD",355.8,355.8,.01,23,4,0)
in the PATIENT (#2) file.  The sponsor name, date of birth,
"^DD",355.8,355.8,.01,23,5,0)
and social security number should be retrieved from the
"^DD",355.8,355.8,.01,23,6,0)
PATIENT (#2) file.  Sponsors who are active-duty personnel
"^DD",355.8,355.8,.01,23,7,0)
are unlikely to be patients, and thus a separate file
"^DD",355.8,355.8,.01,23,8,0)
(SPONSOR PERSON, file #355.82) is used to store the name,
"^DD",355.8,355.8,.01,23,9,0)
date of birth, and social security number.
"^DD",355.8,355.8,.01,"DT")
2970218
"^DD",355.8,355.8,.01,"V",0)
^.12P^2^2
"^DD",355.8,355.8,.01,"V",1,0)
2^PATIENT^1^PT^n^n
"^DD",355.8,355.8,.01,"V",2,0)
355.82^NON-PATIENT SPONSOR^2^SP^n^n
"^DD",355.8,355.8,.02,0)
MILITARY STATUS^S^A:ACTIVE DUTY;R:RETIRED;^0;2^Q
"^DD",355.8,355.8,.02,1,0)
^.1
"^DD",355.8,355.8,.02,1,1,0)
355.8^C
"^DD",355.8,355.8,.02,1,1,1)
S ^IBA(355.8,"C",$E(X,1,30),DA)=""
"^DD",355.8,355.8,.02,1,1,2)
K ^IBA(355.8,"C",$E(X,1,30),DA)
"^DD",355.8,355.8,.02,1,1,"DT")
2970121
"^DD",355.8,355.8,.02,3)
Enter 'A' for Active Duty or 'R' for a Military Retiree.
"^DD",355.8,355.8,.02,21,0)
^^4^4^2970502^^
"^DD",355.8,355.8,.02,21,1,0)
This field is used to determine if the sponsor is an Active Duty
"^DD",355.8,355.8,.02,21,2,0)
member of the military, or a Military retiree.  This information
"^DD",355.8,355.8,.02,21,3,0)
about the sponsor is useful in determining the type of medical
"^DD",355.8,355.8,.02,21,4,0)
benefits that are available to the patient.
"^DD",355.8,355.8,.02,"DT")
2970218
"^DD",355.8,355.8,.03,0)
BRANCH^P23'^DIC(23,^0;3^Q
"^DD",355.8,355.8,.03,3)
Enter the branch of the military in which the sponsor is/was enrolled.
"^DD",355.8,355.8,.03,21,0)
^^4^4^2970502^
"^DD",355.8,355.8,.03,21,1,0)
This field is used to store the branch of the military in which
"^DD",355.8,355.8,.03,21,2,0)
the sponsor is currently enrolled or is retired from.  This
"^DD",355.8,355.8,.03,21,3,0)
field must be printed on claim forms submitted to the Tricare
"^DD",355.8,355.8,.03,21,4,0)
fiscal intermediary.
"^DD",355.8,355.8,.03,"DT")
2970218
"^DD",355.8,355.8,.04,0)
RANK^F^^0;4^K:$L(X)>20!($L(X)<2) X
"^DD",355.8,355.8,.04,3)
Enter a free-text value (2-20 characters) for the sponsor's military rank.
"^DD",355.8,355.8,.04,21,0)
^^3^3^2970502^
"^DD",355.8,355.8,.04,21,1,0)
This field is used to store the sponsor's current or retired
"^DD",355.8,355.8,.04,21,2,0)
rank in the military.  This information is useful in determining
"^DD",355.8,355.8,.04,21,3,0)
the type of medical benefits that are available to the patient.
"^DD",355.8,355.8,.04,"DT")
2970501
"^DIC",351.5,351.5,0)
TRICARE PHARMACY TRANSACTIONS^351.5
"^DIC",351.5,351.5,0,"GL")
^IBA(351.5,
"^DIC",351.5,351.5,"%",0)
^1.005^^
"^DIC",351.5,351.5,"%D",0)
^^7^7^3040322^
"^DIC",351.5,351.5,"%D",1,0)
This file is used to store data related to each Pharmacy billing
"^DIC",351.5,351.5,"%D",2,0)
transaction with the Tricare fiscal intermediary.  Each transaction
"^DIC",351.5,351.5,"%D",3,0)
is submitted to the the RNA/Triad Pharmacy ClaimGuard System, which
"^DIC",351.5,351.5,"%D",4,0)
is a commercial point of sale pharmacy billing software package,
"^DIC",351.5,351.5,"%D",5,0)
where it is forwarded to the intermediary through an electronic
"^DIC",351.5,351.5,"%D",6,0)
switch company.  All of the information which is returned from the
"^DIC",351.5,351.5,"%D",7,0)
intermediary is stored in this file.
"^DIC",351.5,"B","TRICARE PHARMACY TRANSACTIONS",351.5)

"^DIC",351.51,351.51,0)
TRICARE PHARMACY ERRORS^351.51
"^DIC",351.51,351.51,0,"GL")
^IBE(351.51,
"^DIC",351.51,351.51,"%",0)
^1.005^^
"^DIC",351.51,351.51,"%D",0)
^^3^3^3040322^
"^DIC",351.51,351.51,"%D",1,0)
This table file is used to store the various errors which may
"^DIC",351.51,351.51,"%D",2,0)
occur when TRICARE prescriptions are billed using the commercial
"^DIC",351.51,351.51,"%D",3,0)
point-of-sale pharmacy billing software package.
"^DIC",351.51,"B","TRICARE PHARMACY ERRORS",351.51)

"^DIC",351.52,351.52,0)
TRICARE PHARMACY REJECTS^351.52
"^DIC",351.52,351.52,0,"GL")
^IBA(351.52,
"^DIC",351.52,351.52,"%",0)
^1.005^^
"^DIC",351.52,351.52,"%D",0)
^^6^6^3040322^
"^DIC",351.52,351.52,"%D",1,0)
This file is used to store all of the reasons that were used by the
"^DIC",351.52,351.52,"%D",2,0)
Tricare fiscal intermediary to reject a pharmacy billing transaction.
"^DIC",351.52,351.52,"%D",3,0)
Entries in this file are automatically deleted if a prescription is
"^DIC",351.52,351.52,"%D",4,0)
re-submitted an subsequently accepted.  The option Delete Reject
"^DIC",351.52,351.52,"%D",5,0)
Entry [IB TRICARE DEL REJECT] may be used to delete entries from this
"^DIC",351.52,351.52,"%D",6,0)
file.
"^DIC",351.52,"B","TRICARE PHARMACY REJECTS",351.52)

"^DIC",355.8,355.8,0)
SPONSOR^355.8
"^DIC",355.8,355.8,0,"GL")
^IBA(355.8,
"^DIC",355.8,355.8,"%",0)
^1.005^^
"^DIC",355.8,355.8,"%D",0)
^^11^11^3040429^
"^DIC",355.8,355.8,"%D",1,0)
The SPONSOR file contains a list of people who are the sponsors
"^DIC",355.8,355.8,"%D",2,0)
for patients who have Tricare insurance coverage.  These
"^DIC",355.8,355.8,"%D",3,0)
people, who are typically active duty personnel or military
"^DIC",355.8,355.8,"%D",4,0)
retirees, are stored as either patients (in file #2) or
"^DIC",355.8,355.8,"%D",5,0)
non-patients in the SPONSOR PERSON (#355.82) file.  A variable
"^DIC",355.8,355.8,"%D",6,0)
pointer is used to point to the person in either of those
"^DIC",355.8,355.8,"%D",7,0)
two files.
"^DIC",355.8,355.8,"%D",8,0)
 
"^DIC",355.8,355.8,"%D",9,0)
This file is used as a list of sponsors who may be the sponsor
"^DIC",355.8,355.8,"%D",10,0)
of more than one patient.  The SPONSOR RELATIONSHIP (#355.81)
"^DIC",355.8,355.8,"%D",11,0)
file relates a sponsor to a specific patient.
"^DIC",355.8,"B","SPONSOR",355.8)

**END**
**END**
