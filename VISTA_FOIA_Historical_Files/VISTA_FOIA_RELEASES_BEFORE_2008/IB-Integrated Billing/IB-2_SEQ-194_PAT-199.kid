Released IB*2*199 SEQ #194
Extracted from mail message
**KIDS**:IB*2.0*199^

**INSTALL NAME**
IB*2.0*199
"BLD",3882,0)
IB*2.0*199^INTEGRATED BILLING^0^3021105^y
"BLD",3882,1,0)
^^1^1^3021007^
"BLD",3882,1,1,0)
Changes to suppress PATIENT file fuzzy lookups.
"BLD",3882,4,0)
^9.64PA^^
"BLD",3882,"KRN",0)
^9.67PA^8989.52^19
"BLD",3882,"KRN",.4,0)
.4
"BLD",3882,"KRN",.401,0)
.401
"BLD",3882,"KRN",.402,0)
.402
"BLD",3882,"KRN",.403,0)
.403
"BLD",3882,"KRN",.5,0)
.5
"BLD",3882,"KRN",.84,0)
.84
"BLD",3882,"KRN",3.6,0)
3.6
"BLD",3882,"KRN",3.8,0)
3.8
"BLD",3882,"KRN",9.2,0)
9.2
"BLD",3882,"KRN",9.8,0)
9.8
"BLD",3882,"KRN",9.8,"NM",0)
^9.68A^33^30
"BLD",3882,"KRN",9.8,"NM",1,0)
IBCB^^0^B32932460
"BLD",3882,"KRN",9.8,"NM",2,0)
IBJTU2^^0^B6829396
"BLD",3882,"KRN",9.8,"NM",3,0)
IBAECC^^0^B53892222
"BLD",3882,"KRN",9.8,"NM",4,0)
IBAECP^^0^B44191381
"BLD",3882,"KRN",9.8,"NM",5,0)
IBAMTI1^^0^B18419338
"BLD",3882,"KRN",9.8,"NM",6,0)
IBARXEI^^0^B19789754
"BLD",3882,"KRN",9.8,"NM",7,0)
IBARXEL1^^0^B12887948
"BLD",3882,"KRN",9.8,"NM",8,0)
IBARXEX^^0^B19087839
"BLD",3882,"KRN",9.8,"NM",9,0)
IBARXMQ^^0^B14602656
"BLD",3882,"KRN",9.8,"NM",10,0)
IBCC^^0^B20813790
"BLD",3882,"KRN",9.8,"NM",11,0)
IBCEM03^^0^B35541607
"BLD",3882,"KRN",9.8,"NM",13,0)
IBCF4^^0^B18794540
"BLD",3882,"KRN",9.8,"NM",14,0)
IBCNQ1^^0^B12394029
"BLD",3882,"KRN",9.8,"NM",15,0)
IBCNSM^^0^B17771600
"BLD",3882,"KRN",9.8,"NM",16,0)
IBCNSM4^^0^B3369599
"BLD",3882,"KRN",9.8,"NM",17,0)
IBCRTN^^0^B8707391
"BLD",3882,"KRN",9.8,"NM",18,0)
IBECEA^^0^B9579973
"BLD",3882,"KRN",9.8,"NM",19,0)
IBECPF^^0^B1220927
"BLD",3882,"KRN",9.8,"NM",21,0)
IBEMTBC^^0^B14076227
"BLD",3882,"KRN",9.8,"NM",22,0)
IBOA31^^0^B15171767
"BLD",3882,"KRN",9.8,"NM",23,0)
IBOBCRT^^0^B2862038
"BLD",3882,"KRN",9.8,"NM",24,0)
IBODISP^^0^B5663688
"BLD",3882,"KRN",9.8,"NM",25,0)
IBOHPT1^^0^B25381468
"BLD",3882,"KRN",9.8,"NM",26,0)
IBOLK^^0^B17475445
"BLD",3882,"KRN",9.8,"NM",28,0)
IBOMTP^^0^B2507452
"BLD",3882,"KRN",9.8,"NM",29,0)
IBRREL^^0^B24689660
"BLD",3882,"KRN",9.8,"NM",30,0)
IBTOAT^^0^B11359948
"BLD",3882,"KRN",9.8,"NM",31,0)
IBTOBI^^0^B25489278
"BLD",3882,"KRN",9.8,"NM",32,0)
IBTOTR^^0^B16173940
"BLD",3882,"KRN",9.8,"NM",33,0)
IBTRD^^0^B25402753
"BLD",3882,"KRN",9.8,"NM","B","IBAECC",3)

"BLD",3882,"KRN",9.8,"NM","B","IBAECP",4)

"BLD",3882,"KRN",9.8,"NM","B","IBAMTI1",5)

"BLD",3882,"KRN",9.8,"NM","B","IBARXEI",6)

"BLD",3882,"KRN",9.8,"NM","B","IBARXEL1",7)

"BLD",3882,"KRN",9.8,"NM","B","IBARXEX",8)

"BLD",3882,"KRN",9.8,"NM","B","IBARXMQ",9)

"BLD",3882,"KRN",9.8,"NM","B","IBCB",1)

"BLD",3882,"KRN",9.8,"NM","B","IBCC",10)

"BLD",3882,"KRN",9.8,"NM","B","IBCEM03",11)

"BLD",3882,"KRN",9.8,"NM","B","IBCF4",13)

"BLD",3882,"KRN",9.8,"NM","B","IBCNQ1",14)

"BLD",3882,"KRN",9.8,"NM","B","IBCNSM",15)

"BLD",3882,"KRN",9.8,"NM","B","IBCNSM4",16)

"BLD",3882,"KRN",9.8,"NM","B","IBCRTN",17)

"BLD",3882,"KRN",9.8,"NM","B","IBECEA",18)

"BLD",3882,"KRN",9.8,"NM","B","IBECPF",19)

"BLD",3882,"KRN",9.8,"NM","B","IBEMTBC",21)

"BLD",3882,"KRN",9.8,"NM","B","IBJTU2",2)

"BLD",3882,"KRN",9.8,"NM","B","IBOA31",22)

"BLD",3882,"KRN",9.8,"NM","B","IBOBCRT",23)

"BLD",3882,"KRN",9.8,"NM","B","IBODISP",24)

"BLD",3882,"KRN",9.8,"NM","B","IBOHPT1",25)

"BLD",3882,"KRN",9.8,"NM","B","IBOLK",26)

"BLD",3882,"KRN",9.8,"NM","B","IBOMTP",28)

"BLD",3882,"KRN",9.8,"NM","B","IBRREL",29)

"BLD",3882,"KRN",9.8,"NM","B","IBTOAT",30)

"BLD",3882,"KRN",9.8,"NM","B","IBTOBI",31)

"BLD",3882,"KRN",9.8,"NM","B","IBTOTR",32)

"BLD",3882,"KRN",9.8,"NM","B","IBTRD",33)

"BLD",3882,"KRN",19,0)
19
"BLD",3882,"KRN",19,"NM",0)
^9.68A^^
"BLD",3882,"KRN",19.1,0)
19.1
"BLD",3882,"KRN",101,0)
101
"BLD",3882,"KRN",409.61,0)
409.61
"BLD",3882,"KRN",771,0)
771
"BLD",3882,"KRN",870,0)
870
"BLD",3882,"KRN",8989.51,0)
8989.51
"BLD",3882,"KRN",8989.52,0)
8989.52
"BLD",3882,"KRN",8994,0)
8994
"BLD",3882,"KRN","B",.4,.4)

"BLD",3882,"KRN","B",.401,.401)

"BLD",3882,"KRN","B",.402,.402)

"BLD",3882,"KRN","B",.403,.403)

"BLD",3882,"KRN","B",.5,.5)

"BLD",3882,"KRN","B",.84,.84)

"BLD",3882,"KRN","B",3.6,3.6)

"BLD",3882,"KRN","B",3.8,3.8)

"BLD",3882,"KRN","B",9.2,9.2)

"BLD",3882,"KRN","B",9.8,9.8)

"BLD",3882,"KRN","B",19,19)

"BLD",3882,"KRN","B",19.1,19.1)

"BLD",3882,"KRN","B",101,101)

"BLD",3882,"KRN","B",409.61,409.61)

"BLD",3882,"KRN","B",771,771)

"BLD",3882,"KRN","B",870,870)

"BLD",3882,"KRN","B",8989.51,8989.51)

"BLD",3882,"KRN","B",8989.52,8989.52)

"BLD",3882,"KRN","B",8994,8994)

"BLD",3882,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",192,-1)
1^1
"PKG",192,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",192,20,0)
^9.402P^1^1
"PKG",192,20,1,0)
2^^IBAXDR
"PKG",192,20,1,1)

"PKG",192,20,"B",2,1)

"PKG",192,22,0)
^9.49I^1^1
"PKG",192,22,1,0)
2.0^2940321^2940414
"PKG",192,22,1,"PAH",1,0)
199^3021105
"PKG",192,22,1,"PAH",1,1,0)
^^1^1^3021105
"PKG",192,22,1,"PAH",1,1,1,0)
Changes to suppress PATIENT file fuzzy lookups.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
30
"RTN","IBAECC")
0^3^B53892222
"RTN","IBAECC",1,0)
IBAECC ;LL/ELZ-LONG TERM CARE CLOCK MAINTANCE ; 05-FEB-02
"RTN","IBAECC",2,0)
 ;;2.0;INTEGRATED BILLING;**176,199**;21-MAR-94
"RTN","IBAECC",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified
"RTN","IBAECC",4,0)
 ;
"RTN","IBAECC",5,0)
 ; this routine will allow users to perform LTC copay clock
"RTN","IBAECC",6,0)
 ; maintance.  Every function for the user will be read and evaluated
"RTN","IBAECC",7,0)
 ; before actually filed in the LTC Copay Clock.
"RTN","IBAECC",8,0)
 ;
"RTN","IBAECC",9,0)
OPT ; menu option main entry point
"RTN","IBAECC",10,0)
 ;
"RTN","IBAECC",11,0)
 N DIC,X,Y,DFN,IBLTCX,DTOUT,DUOUT,DIRUT,DIROUT,%,DIR,IBSTDT,IBCL,IBX,IBY,IBLTCZ
"RTN","IBAECC",12,0)
 ;
"RTN","IBAECC",13,0)
 ; select a patient (screen out patients with no LTC clock and are
"RTN","IBAECC",14,0)
 ; not LTC patients.
"RTN","IBAECC",15,0)
OPTA K DIC,X,Y,DFN,IBLTCX,VADP
"RTN","IBAECC",16,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBAECC",17,0)
 S DIC="^DPT(",DIC(0)="AEMNQ",DIC("S")="I $$SCREEN^IBAECC(Y)" W ! D ^DIC G:Y<1 EX
"RTN","IBAECC",18,0)
 S DFN=+Y D DEM^VADPT
"RTN","IBAECC",19,0)
 ;
"RTN","IBAECC",20,0)
 ; is there a clock, if not offer to add
"RTN","IBAECC",21,0)
 I '$D(^IBA(351.81,"C",DFN)) D  G:$G(IBLTCX)<1 OPTA
"RTN","IBAECC",22,0)
 . W !!,"The patient ",VADM(1)," has no LTC clock on file."
"RTN","IBAECC",23,0)
 . F  W !,"Do you want to add one" S %=2 D YN^DICN Q:%'=0  W !,"    Answer with 'Yes' or 'No'"
"RTN","IBAECC",24,0)
 . Q:%'=1
"RTN","IBAECC",25,0)
 . ;
"RTN","IBAECC",26,0)
 . ; start date
"RTN","IBAECC",27,0)
 . W !,"You need to specify the clock start date"
"RTN","IBAECC",28,0)
 . S DIR(0)="D^:"_DT D ^DIR Q:$D(DIRUT)  S IBSTDT=+Y
"RTN","IBAECC",29,0)
 . ;
"RTN","IBAECC",30,0)
 . ; create clock entry
"RTN","IBAECC",31,0)
 . S IBLTCX=+$$ADDCL^IBAECU(DFN,IBSTDT)
"RTN","IBAECC",32,0)
 ;
"RTN","IBAECC",33,0)
 ; choose a clock
"RTN","IBAECC",34,0)
 I $G(IBLTCX)<1 S IBLTCX=$$ASKCLK^IBAECP(DFN,1) G:$G(IBLTCX)<1 OPTA
"RTN","IBAECC",35,0)
 ;
"RTN","IBAECC",36,0)
 S IBLTCZ=^IBA(351.81,IBLTCX,0) D DISPLAY,EDIT
"RTN","IBAECC",37,0)
 G OPTA
"RTN","IBAECC",38,0)
 ;
"RTN","IBAECC",39,0)
EX ;
"RTN","IBAECC",40,0)
 D KVAR^VADPT
"RTN","IBAECC",41,0)
 ;
"RTN","IBAECC",42,0)
 Q
"RTN","IBAECC",43,0)
 ;
"RTN","IBAECC",44,0)
DISPLAY ; display clock information
"RTN","IBAECC",45,0)
 ; Temporary
"RTN","IBAECC",46,0)
 N IBCLK
"RTN","IBAECC",47,0)
 S IBCLK=IBLTCX
"RTN","IBAECC",48,0)
 W @IOF
"RTN","IBAECC",49,0)
 D REPORT^IBAECB1
"RTN","IBAECC",50,0)
 Q
"RTN","IBAECC",51,0)
 ;
"RTN","IBAECC",52,0)
 ;
"RTN","IBAECC",53,0)
EDIT ; edit either start date or free days
"RTN","IBAECC",54,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBAECC",55,0)
AGAINE W ! F X=1:1:IOM W "-"
"RTN","IBAECC",56,0)
 W !,"You can edit Start Date OR Days Not Subject To LTC Copay (Free Days)"
"RTN","IBAECC",57,0)
 S DIR(0)="SO^S:Start Date;F:Free Days;" D ^DIR Q:$D(DIRUT)
"RTN","IBAECC",58,0)
 D @$S(Y="S":"START",1:"FREE"),DISPLAY
"RTN","IBAECC",59,0)
 G AGAINE
"RTN","IBAECC",60,0)
 Q
"RTN","IBAECC",61,0)
 ;
"RTN","IBAECC",62,0)
START ; edit the start date
"RTN","IBAECC",63,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,IBSTDT,DIE,DA,DR,IBZ
"RTN","IBAECC",64,0)
 S DIR(0)="D",DIR("B")=$$FMTE^XLFDT($P(IBLTCZ,"^",3))
"RTN","IBAECC",65,0)
 D ^DIR Q:$D(DIRUT)  S IBSTDT=+Y
"RTN","IBAECC",66,0)
 ;
"RTN","IBAECC",67,0)
 ; no change
"RTN","IBAECC",68,0)
 I IBSTDT=$P(IBLTCZ,"^",3) W !!?10,"No Change !!" H 3 Q
"RTN","IBAECC",69,0)
 ;
"RTN","IBAECC",70,0)
 ; make sure we don't start after a free day
"RTN","IBAECC",71,0)
 S IBZ=0 F  S IBZ=$O(^IBA(351.81,IBLTCX,1,IBZ)) Q:IBZ<1  I $P(^IBA(351.81,IBLTCX,1,IBZ,0),"^",2)<IBSTDT S IBSTDT=0 Q
"RTN","IBAECC",72,0)
 I 'IBSTDT W !,"You must enter a date that is BEFORE all the Free Days" G START
"RTN","IBAECC",73,0)
 ;
"RTN","IBAECC",74,0)
 ; don't go less that 1 year before earliest free day
"RTN","IBAECC",75,0)
 S IBZ=0 F  S IBZ=$O(^IBA(351.81,IBLTCX,1,IBZ)) Q:IBZ<1  I '$$YR(IBSTDT,$P(^IBA(351.81,IBLTCX,1,IBZ,0),"^",2)) S IBSTDT=0 Q
"RTN","IBAECC",76,0)
 I 'IBSTDT W !,"You entered a start date greater than 1 year before a Free Day" G START
"RTN","IBAECC",77,0)
 ;
"RTN","IBAECC",78,0)
 ; file new start date and exp date
"RTN","IBAECC",79,0)
 S DIE="^IBA(351.81,",DA=IBLTCX,DR=".03///^S X=IBSTDT;.04///^S X=$$GETEXPDT^IBAECU4(IBSTDT)" D ^DIE
"RTN","IBAECC",80,0)
 S IBLTCZ=^IBA(351.81,IBLTCX,0)
"RTN","IBAECC",81,0)
 ;
"RTN","IBAECC",82,0)
 D LASTED
"RTN","IBAECC",83,0)
 ;
"RTN","IBAECC",84,0)
 Q
"RTN","IBAECC",85,0)
 ;
"RTN","IBAECC",86,0)
FREE ; change the free days
"RTN","IBAECC",87,0)
 N IBF,IBX,IBC,IBD,IBFREEX,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,IBOPT,IBFREEZ
"RTN","IBAECC",88,0)
 N IBCLK
"RTN","IBAECC",89,0)
 S IBCLK=IBLTCX
"RTN","IBAECC",90,0)
 ;
"RTN","IBAECC",91,0)
AGAINF ;
"RTN","IBAECC",92,0)
 D REINDEX
"RTN","IBAECC",93,0)
 ;
"RTN","IBAECC",94,0)
 S (IBC,IBX)=0 F  S IBX=$O(^IBA(351.81,IBLTCX,1,"AC",IBX)) Q:IBX<1  S IBC=IBC+1,IBF(IBX,IBC)=$O(^IBA(351.81,IBLTCX,1,"AC",IBX,0))
"RTN","IBAECC",95,0)
 ;
"RTN","IBAECC",96,0)
 ; display free days
"RTN","IBAECC",97,0)
 ;W !,"These are the Free Days currently on file:",!
"RTN","IBAECC",98,0)
 ;S IBD=0 F  S IBD=$O(IBF(IBD)) Q:IBD<1  W !?5,$O(IBF(IBD,0)),?10,$$FMTE^XLFDT(IBD)
"RTN","IBAECC",99,0)
 D FRDAYS^IBAECB1
"RTN","IBAECC",100,0)
 ;
"RTN","IBAECC",101,0)
 ; choose add, edit, or delete free day
"RTN","IBAECC",102,0)
 S DIR(0)="SO^A:Add;E:Edit;D:Delete" D ^DIR Q:$D(DIRUT)  S IBOPT=Y
"RTN","IBAECC",103,0)
 ;
"RTN","IBAECC",104,0)
 ; choose which one to change
"RTN","IBAECC",105,0)
 I IBOPT'="A" S DIR(0)="NO^1:"_IBC_":0" D ^DIR Q:$D(DIRUT)  S IBD=0 F  S IBD=$O(IBF(IBD)) Q:IBD<1  I $D(IBF(IBD,+Y)) S IBFREEX=IBF(IBD,+Y),IBFREEZ=^IBA(351.81,IBLTCX,1,IBF(IBD,+Y),0) Q
"RTN","IBAECC",106,0)
 ;
"RTN","IBAECC",107,0)
 D @(IBOPT_"FREE")
"RTN","IBAECC",108,0)
 ;
"RTN","IBAECC",109,0)
 G AGAINF
"RTN","IBAECC",110,0)
 ;
"RTN","IBAECC",111,0)
 Q
"RTN","IBAECC",112,0)
 ;
"RTN","IBAECC",113,0)
AFREE ; add free days
"RTN","IBAECC",114,0)
 N IBX,IBC,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,IBDT,DO,DIC,DINUM,DA,DIE,DR
"RTN","IBAECC",115,0)
 ;
"RTN","IBAECC",116,0)
 ; make sure there are not more than 21 already
"RTN","IBAECC",117,0)
 S (IBX,IBC)=0 F  S IBX=$O(^IBA(351.81,IBLTCX,1,IBX)) Q:IBX<1  S IBC=IBC+1
"RTN","IBAECC",118,0)
 I IBC>20 W !,"Patients are only allowed 21 free days.  ",!,VADM(1)," has ",IBC," already." Q
"RTN","IBAECC",119,0)
 ;
"RTN","IBAECC",120,0)
 ; what date do you want to add
"RTN","IBAECC",121,0)
AFREEA S IBDT=$$DATE I IBDT<1 Q
"RTN","IBAECC",122,0)
 ;
"RTN","IBAECC",123,0)
 ; is that date already there
"RTN","IBAECC",124,0)
 D ALREADY G:IBDT<1 AFREEA
"RTN","IBAECC",125,0)
 ;
"RTN","IBAECC",126,0)
 ; is free day before start date or > 1 year out
"RTN","IBAECC",127,0)
 D BADDT I IBDT<1 G AFREEA
"RTN","IBAECC",128,0)
 ;
"RTN","IBAECC",129,0)
 ; file free day
"RTN","IBAECC",130,0)
 F IBX=1:1:21 Q:'$D(^IBA(351.81,IBLTCX,1,IBX))
"RTN","IBAECC",131,0)
 K DO S DIC="^IBA(351.81,"_IBLTCX_",1,",DIC(0)="",X=IBX,DINUM=X,DA(1)=IBLTCX,DIC("DR")=".02///^S X=IBDT" D FILE^DICN
"RTN","IBAECC",132,0)
 ;
"RTN","IBAECC",133,0)
 W ?40,"... ",$$FMTE^XLFDT(IBDT)," was ",$S(Y>0:"",1:"NOT "),"added."
"RTN","IBAECC",134,0)
 I Y>0 S DIE="^IBA(351.81,",DA=IBLTCX,DR=".06///"_($P(IBLTCZ,"^",6)-1) D ^DIE S IBLTCZ=^IBA(351.81,IBLTCX,0)
"RTN","IBAECC",135,0)
 ;
"RTN","IBAECC",136,0)
 D LASTED,REINDEX
"RTN","IBAECC",137,0)
 ;
"RTN","IBAECC",138,0)
 ; allow adding more if they are not all used up.
"RTN","IBAECC",139,0)
 G:$P(IBLTCZ,"^",6)>0 AFREEA
"RTN","IBAECC",140,0)
 ;
"RTN","IBAECC",141,0)
 Q
"RTN","IBAECC",142,0)
 ;
"RTN","IBAECC",143,0)
EFREE ; edit a free day IBFREEX
"RTN","IBAECC",144,0)
 N IBDT,DIE,DA,DR
"RTN","IBAECC",145,0)
 ;
"RTN","IBAECC",146,0)
 ; what date do you want to change it to
"RTN","IBAECC",147,0)
 S IBDT=$$DATE($$FMTE^XLFDT($P(IBFREEZ,"^",2))) I IBDT<1 Q
"RTN","IBAECC",148,0)
 I IBDT=$P(IBFREEZ,"^",2) W !,"No change" Q
"RTN","IBAECC",149,0)
 ;
"RTN","IBAECC",150,0)
 ; is free day already there
"RTN","IBAECC",151,0)
 D ALREADY Q:IBDT<1
"RTN","IBAECC",152,0)
 ;
"RTN","IBAECC",153,0)
 ; is free day before start date or > 1 year out
"RTN","IBAECC",154,0)
 D BADDT Q:IBDT<1
"RTN","IBAECC",155,0)
 ;
"RTN","IBAECC",156,0)
 ; file free day
"RTN","IBAECC",157,0)
 S DIE="^IBA(351.81,"_IBLTCX_",1,",DA(1)=IBLTCX,DA=IBFREEX,DR=".02///^S X=IBDT" D ^DIE
"RTN","IBAECC",158,0)
 ;
"RTN","IBAECC",159,0)
 D LASTED,REINDEX
"RTN","IBAECC",160,0)
 ;
"RTN","IBAECC",161,0)
 Q
"RTN","IBAECC",162,0)
 ;
"RTN","IBAECC",163,0)
DFREE ; delete a free day
"RTN","IBAECC",164,0)
 N %,DA,DIK,DIE,DR
"RTN","IBAECC",165,0)
 ;
"RTN","IBAECC",166,0)
 ; are you sure
"RTN","IBAECC",167,0)
 F  W !,"Are you sure you want to delete this date" S %=2 D YN^DICN Q:%'=0  W !,"    Answer with 'Yes' or 'No'"
"RTN","IBAECC",168,0)
 Q:%'=1
"RTN","IBAECC",169,0)
 ;
"RTN","IBAECC",170,0)
 ; delete it
"RTN","IBAECC",171,0)
 S DIK="^IBA(351.81,"_IBLTCX_",1,",DA(1)=IBLTCX,DA=IBFREEX D ^DIK
"RTN","IBAECC",172,0)
 S DIE="^IBA(351.81,",DA=IBLTCX,DR=".06///"_($P(IBLTCZ,"^",6)+1) D ^DIE S IBLTCZ=^IBA(351.81,IBLTCX,0)
"RTN","IBAECC",173,0)
 ;
"RTN","IBAECC",174,0)
 D LASTED,REINDEX
"RTN","IBAECC",175,0)
 ;
"RTN","IBAECC",176,0)
 Q
"RTN","IBAECC",177,0)
 ;
"RTN","IBAECC",178,0)
SCREEN(DFN) ; screen out non-LTC patients
"RTN","IBAECC",179,0)
 N IBLTCST S IBLTCST=$$LTCST^IBAECU(DFN,DT,1)
"RTN","IBAECC",180,0)
 Q $S($D(^IBA(351.81,"C",DFN)):1,+IBLTCST=2:1,1:0)
"RTN","IBAECC",181,0)
 ;
"RTN","IBAECC",182,0)
ALREADY ; checks to see if the free day is already there
"RTN","IBAECC",183,0)
 N IBX
"RTN","IBAECC",184,0)
 S IBX=0 F  S IBX=$O(^IBA(351.81,IBLTCX,1,IBX)) Q:IBX<1  I $P(^IBA(351.81,IBLTCX,1,IBX,0),"^",2)=IBDT S IBDT="-1^"_IBDT Q
"RTN","IBAECC",185,0)
 I IBDT<1 W !!,$$FMTE^XLFDT($P(IBDT,"^",2))," is already on file!"
"RTN","IBAECC",186,0)
 Q
"RTN","IBAECC",187,0)
 ;
"RTN","IBAECC",188,0)
DATE(IBB) ; prompts for date selection (IBB is default)
"RTN","IBAECC",189,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBAECC",190,0)
 S DIR(0)="DO^:"_DT S:$G(IBB) DIR("B")=IBB D ^DIR
"RTN","IBAECC",191,0)
 Q +Y
"RTN","IBAECC",192,0)
 ;
"RTN","IBAECC",193,0)
BADDT ; checks out IBDT to make sure it is a valid date based upon start date
"RTN","IBAECC",194,0)
 I IBDT<$P(IBLTCZ,"^",3) W !!,$$FMTE^XLFDT(IBDT)," is less than the clock start date of ",$$FMTE^XLFDT($P(IBLTCZ,"^",3)) S IBDT=0 Q
"RTN","IBAECC",195,0)
 I '$$YR($P(IBLTCZ,"^",3),IBDT) W !!,$$FMTE^XLFDT(IBDT)," is greater than 1 year pased the clock start date." S IBDT=0 Q
"RTN","IBAECC",196,0)
 ; if date is current month, don't allow
"RTN","IBAECC",197,0)
 I $E(IBDT,1,5)=$E(DT,1,5) W !!,$$FMTE^XLFDT(IBDT)," is during the current month.",!,"You must allow the montly job to enter this date into the clock." S IBDT=0
"RTN","IBAECC",198,0)
 Q
"RTN","IBAECC",199,0)
 ;
"RTN","IBAECC",200,0)
LASTED ; update last edited by and date fields
"RTN","IBAECC",201,0)
 N DIE,DR,DA
"RTN","IBAECC",202,0)
 S DIE="^IBA(351.81,",DA=IBLTCX,DR="4.03////^S X=DUZ;4.04///NOW" D ^DIE
"RTN","IBAECC",203,0)
 Q
"RTN","IBAECC",204,0)
YR(IBCLDT,IBFR) ; is the effective date of the clock too old?
"RTN","IBAECC",205,0)
 ;  Input:   IBCLDT  --  New Clock Effective Date
"RTN","IBAECC",206,0)
 ;             IBFR  --  Event Date
"RTN","IBAECC",207,0)
 ;  Output:       1  --  Effective Date is too old
"RTN","IBAECC",208,0)
 ;                0  --  Not
"RTN","IBAECC",209,0)
 N IBNUM,IBYR
"RTN","IBAECC",210,0)
 S IBNUM=$$FMDIFF^XLFDT(IBFR,IBCLDT),IBYR=$E(IBFR,1,3)
"RTN","IBAECC",211,0)
 Q IBYR#4&(IBNUM<364)!(IBYR#4=0&(IBNUM<365))
"RTN","IBAECC",212,0)
 ;
"RTN","IBAECC",213,0)
REINDEX ; this will take a clock and re-index the free days in order
"RTN","IBAECC",214,0)
 ;   assumes IBLTCX
"RTN","IBAECC",215,0)
 N IBX,DIK,DA,X,Y,IBZ
"RTN","IBAECC",216,0)
 ;
"RTN","IBAECC",217,0)
 ; clean out what is there
"RTN","IBAECC",218,0)
 S IBX=0 F  S IBX=$O(^IBA(351.81,IBLTCX,1,IBX)) Q:IBX<1  S IBZ($P(^IBA(351.81,IBLTCX,1,IBX,0),"^",2))="" S DIK="^IBA(351.81,"_IBLTCX_",1,",DA=IBX,DA(1)=IBLTCX D ^DIK
"RTN","IBAECC",219,0)
 ;
"RTN","IBAECC",220,0)
 ; place them back in - in order
"RTN","IBAECC",221,0)
 S IBZ=0 F IBX=1:1 S IBZ=$O(IBZ(IBZ)) Q:IBZ<1  K DO S DIC="^IBA(351.81,"_IBLTCX_",1,",DIC(0)="",DA(1)=IBLTCX,X=IBX,DINUM=IBX,DIC("DR")=".02////^S X=IBZ" D FILE^DICN
"RTN","IBAECC",222,0)
 Q
"RTN","IBAECP")
0^4^B44191381
"RTN","IBAECP",1,0)
IBAECP ;WOIFO/AAT-LTC SINGLE PATIENT PROFILE ; 20-FEB-02
"RTN","IBAECP",2,0)
 ;;2.0;INTEGRATED BILLING;**171,176,199**;21-MAR-94
"RTN","IBAECP",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified
"RTN","IBAECP",4,0)
 ;
"RTN","IBAECP",5,0)
 S:'$D(DTIME) DTIME=300 D HOME^%ZIS
"RTN","IBAECP",6,0)
 ;
"RTN","IBAECP",7,0)
 ;
"RTN","IBAECP",8,0)
 N IBQUIT,POP
"RTN","IBAECP",9,0)
 F  S IBQUIT=0 D  Q:IBQUIT
"RTN","IBAECP",10,0)
 . N IBDFN,IBCLK,IBDT1,IBDT2,%DT,X,Y,DIC,IBOFD,IBOEV
"RTN","IBAECP",11,0)
 . W !
"RTN","IBAECP",12,0)
 . S IBDFN=$$ASKPAT() I IBDFN=-1 S IBQUIT=1 Q
"RTN","IBAECP",13,0)
 . ; Enter required clock (if more than one)
"RTN","IBAECP",14,0)
 . S IBCLK=$$ASKCLK(IBDFN) I IBCLK<1 Q  S IBQUIT=1
"RTN","IBAECP",15,0)
 . ; Ask about beginning and ending date and perform action
"RTN","IBAECP",16,0)
 . ; No default valies provided
"RTN","IBAECP",17,0)
 . ; W !,"The report is not available at the patch IB*2.0*171" Q
"RTN","IBAECP",18,0)
 . D DATE I IBDT1<0 Q  S IBQUIT=1 Q  ;Enter date range (defaults are begin/end of the clock)
"RTN","IBAECP",19,0)
 . D ASKOFD I IBOFD<0 Q  S IBQUIT=1 Q  ;Option - print free days
"RTN","IBAECP",20,0)
 . D ASKOEV I IBOEV<0 Q  S IBQUIT=1 Q  ;Option - print event history
"RTN","IBAECP",21,0)
 . D ASKDEV
"RTN","IBAECP",22,0)
 Q
"RTN","IBAECP",23,0)
 ;
"RTN","IBAECP",24,0)
ASKDEV ; Ask about output device and print the report (or run task)
"RTN","IBAECP",25,0)
 N %ZIS
"RTN","IBAECP",26,0)
 S %ZIS="QM"
"RTN","IBAECP",27,0)
 W ! D ^%ZIS Q:POP  ; Quit and ask for patient again. Otherwise Set IBSTOP=1
"RTN","IBAECP",28,0)
 ; If it was queued
"RTN","IBAECP",29,0)
 I $D(IO("Q")) D RUNTASK Q
"RTN","IBAECP",30,0)
 U IO D REPORT^IBAECP1 ; Generate report directly
"RTN","IBAECP",31,0)
 D ^%ZISC ; Close the device
"RTN","IBAECP",32,0)
 Q
"RTN","IBAECP",33,0)
 ;
"RTN","IBAECP",34,0)
 ;
"RTN","IBAECP",35,0)
RUNTASK ; Start Taskman job
"RTN","IBAECP",36,0)
 N ZTRTN,ZTSK,IBVAR,ZTSAVE,ZTDESC
"RTN","IBAECP",37,0)
 S ZTRTN="REPORT^IBAECP1",ZTDESC="LTC SINGLE PATIENT BILLING PROFILE"
"RTN","IBAECP",38,0)
 F IBVAR="IBDFN","IBCLK","IBDT1","IBDT2","IBOFD","IBOEV" S ZTSAVE(IBVAR)=""
"RTN","IBAECP",39,0)
 D ^%ZTLOAD
"RTN","IBAECP",40,0)
 K IO("Q")
"RTN","IBAECP",41,0)
 D HOME^%ZIS W !
"RTN","IBAECP",42,0)
 Q
"RTN","IBAECP",43,0)
 ;
"RTN","IBAECP",44,0)
 ; User's interface for LTC Billing Clock
"RTN","IBAECP",45,0)
 ; If the user has only one clock - doesn't ask, only shows brief info. 
"RTN","IBAECP",46,0)
 ; Parameters: 
"RTN","IBAECP",47,0)
 ;  IBDFN - patient IEN
"RTN","IBAECP",48,0)
 ;  IBSHOW - if 1, the list of clocks will be printed
"RTN","IBAECP",49,0)
 ; Returns: LTC Clock IEN (or -1, if canceled, or 0, if the user doesn't has any clocks)
"RTN","IBAECP",50,0)
ASKCLK(IBDFN,IBSHOW) N IBDT,IBDT2,IBX,IBZ,IBCNT,IBCL,DIRUT,Y,DIR,IBI,IBY,IBCLK
"RTN","IBAECP",51,0)
 I '$D(^IBA(351.81,"AE",IBDFN)) D  Q 0 ; No data for the patient
"RTN","IBAECP",52,0)
 . W !,"The user doesn't have LTC Billing Clock created"
"RTN","IBAECP",53,0)
 ; Collect all data in IBCL array IBCL(DATE)=IEN,IBCL=<Number of clocks>
"RTN","IBAECP",54,0)
 S IBCL=0
"RTN","IBAECP",55,0)
 S IBCLK=0,IBDT=0 F  S IBDT=$O(^IBA(351.81,"AE",IBDFN,IBDT)) Q:'IBDT  D
"RTN","IBAECP",56,0)
 . S IBX=0 F  S IBX=$O(^IBA(351.81,"AE",IBDFN,IBDT,IBX)) Q:'IBX  D
"RTN","IBAECP",57,0)
 .. S IBCL(IBDT)=IBX
"RTN","IBAECP",58,0)
 .. S IBCL=IBCL+1
"RTN","IBAECP",59,0)
 ;
"RTN","IBAECP",60,0)
 ; If there is only one clock - no need to ask, just show
"RTN","IBAECP",61,0)
 I IBCL=1 S IBCLK=IBCL($O(IBCL(""))) D LSTCLK W ! Q IBCLK
"RTN","IBAECP",62,0)
 K Y
"RTN","IBAECP",63,0)
 F  D  Q:$D(DIRUT)  Q:$D(IBCL(Y))  W " ??"
"RTN","IBAECP",64,0)
 . ;Choose one
"RTN","IBAECP",65,0)
 . I $D(Y)!($G(IBSHOW)) W ! D LSTCLK W ! ; Bad enter - list options
"RTN","IBAECP",66,0)
 . K DIR,DIRUT
"RTN","IBAECP",67,0)
 . S DIR(0)="FE"
"RTN","IBAECP",68,0)
 . S DIR("A")="Choose LTC BILLING CLOCK (1-"_IBCL_")"
"RTN","IBAECP",69,0)
 . S DIR("B")=$$FMTE^XLFDT(+$O(IBCL(""),-1),"1D")
"RTN","IBAECP",70,0)
 . S DIR("?")="Enter date of the required LTC BILLING CLOCK. Enter '??' for clocks list."
"RTN","IBAECP",71,0)
 . S DIR("??")="^D LSTCLK^IBAECP"
"RTN","IBAECP",72,0)
 . D ^DIR Q:$D(DIRUT)
"RTN","IBAECP",73,0)
 . ; User may enter just number
"RTN","IBAECP",74,0)
 . I Y=+Y,Y>0,Y'>IBCL D  I IBY S Y=IBY Q
"RTN","IBAECP",75,0)
 .. S IBY="" F IBI=1:1:Y S IBY=$O(IBCL(IBY)) Q:IBY=""
"RTN","IBAECP",76,0)
 . S %DT="" D ^%DT ; Convert external to internal format
"RTN","IBAECP",77,0)
 I $D(DIRUT) Q -1
"RTN","IBAECP",78,0)
 W " (",$$FMTE^XLFDT(Y),")"
"RTN","IBAECP",79,0)
 Q IBCL(Y)
"RTN","IBAECP",80,0)
 ;
"RTN","IBAECP",81,0)
 ; Ask begin/end dates, with default values
"RTN","IBAECP",82,0)
 ; Input:  IBCLK - LTC Clock IEN
"RTN","IBAECP",83,0)
 ; Output: IBDT1,IBDT2 - begin/end dates
"RTN","IBAECP",84,0)
DATE N %DT,Y,IBDT,IBNOW
"RTN","IBAECP",85,0)
DATAGN ;Loop entry point
"RTN","IBAECP",86,0)
 S (IBDT1,IBDT2)=-1
"RTN","IBAECP",87,0)
 ; Get beginning date
"RTN","IBAECP",88,0)
 S IBDT=$P($G(^IBA(351.81,IBCLK,0)),U,3)
"RTN","IBAECP",89,0)
 S IBDT1=$$ASKDT("Start with DATE: ",IBDT)
"RTN","IBAECP",90,0)
 I IBDT1<1 Q
"RTN","IBAECP",91,0)
 ; Get ending date
"RTN","IBAECP",92,0)
 S IBDT=$P($G(^IBA(351.81,IBCLK,0)),U,4)
"RTN","IBAECP",93,0)
 S IBNOW=$$NOW()
"RTN","IBAECP",94,0)
 I 'IBDT S IBDT=IBNOW
"RTN","IBAECP",95,0)
 E  I IBDT>IBNOW S IBDT=IBNOW
"RTN","IBAECP",96,0)
 S IBDT2=$$ASKDT("Go to DATE: ",IBDT)
"RTN","IBAECP",97,0)
 I IBDT2<1 S IBDT1=-1 Q
"RTN","IBAECP",98,0)
 I IBDT2<IBDT1 W !,"Ending date must follow start date!",! G DATAGN
"RTN","IBAECP",99,0)
 Q
"RTN","IBAECP",100,0)
 ;
"RTN","IBAECP",101,0)
 ;Returns today's date in FM format
"RTN","IBAECP",102,0)
NOW() N %,%H,%I,X
"RTN","IBAECP",103,0)
 D NOW^%DTC
"RTN","IBAECP",104,0)
 Q X
"RTN","IBAECP",105,0)
 ;
"RTN","IBAECP",106,0)
 ; Ask - print free days or not?
"RTN","IBAECP",107,0)
 ; Input: none
"RTN","IBAECP",108,0)
 ; Output: IBOFD (bool) IBOFD=-1 if cancelled
"RTN","IBAECP",109,0)
ASKOFD ; Default - YES
"RTN","IBAECP",110,0)
 N DIR,Y,DUOUT
"RTN","IBAECP",111,0)
 S DIR(0)="Y",DIR("A")="Include DAYS NOT SUBJECT TO LTC COPAY on this report",DIR("B")="YES"
"RTN","IBAECP",112,0)
 D ^DIR
"RTN","IBAECP",113,0)
 S IBOFD=$S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","IBAECP",114,0)
 Q
"RTN","IBAECP",115,0)
 ; Ask - print LTC events or not?
"RTN","IBAECP",116,0)
 ; Input: none
"RTN","IBAECP",117,0)
 ; Output: IBOEV (bool) IBOEV=-1 if cancelled
"RTN","IBAECP",118,0)
ASKOEV ; Default - YES
"RTN","IBAECP",119,0)
 N DIR,Y,DUOUT
"RTN","IBAECP",120,0)
 S DIR(0)="Y",DIR("A")="Include LTC EVENTS on this report",DIR("B")="YES"
"RTN","IBAECP",121,0)
 D ^DIR
"RTN","IBAECP",122,0)
 S IBOEV=$S($G(DUOUT)!$G(DTOUT)!(Y="^"):-1,1:Y)
"RTN","IBAECP",123,0)
 Q
"RTN","IBAECP",124,0)
 ; Double question mark action - for the "enter clock" dialog
"RTN","IBAECP",125,0)
 ; Input:
"RTN","IBAECP",126,0)
 ;   IBCL=<Number of clocks>
"RTN","IBAECP",127,0)
 ;   IBCL(<Clock date>)=<Clock IEN> local array - list of clocks
"RTN","IBAECP",128,0)
 ;   IBDFN= IEN of the patient
"RTN","IBAECP",129,0)
LSTCLK N IBZ,IBDT,IBCNT,IBDT2
"RTN","IBAECP",130,0)
 W !,$P(^DPT(IBDFN,0),U)," has the following LTC Copay Clock",$S(IBCL>1:"s",1:""),!
"RTN","IBAECP",131,0)
 S IBCNT=0
"RTN","IBAECP",132,0)
 S IBDT=0 F  S IBDT=$O(IBCL(IBDT)) Q:'IBDT  D
"RTN","IBAECP",133,0)
 . S IBX=IBCL(IBDT)
"RTN","IBAECP",134,0)
 . S IBZ=^IBA(351.81,IBX,0),IBCNT=IBCNT+1
"RTN","IBAECP",135,0)
 . W !?10,IBCNT,?15,$$FMTE^XLFDT(IBDT)
"RTN","IBAECP",136,0)
 . S IBDT2=$P(IBZ,U,4)
"RTN","IBAECP",137,0)
 . I IBDT2 W ?28," - ",$$FMTE^XLFDT(IBDT2)
"RTN","IBAECP",138,0)
 . W ?48,$$EXTERNAL^DILFD(351.81,.05,"",$P(IBZ,"^",5))
"RTN","IBAECP",139,0)
 Q
"RTN","IBAECP",140,0)
 ;
"RTN","IBAECP",141,0)
 ; Input: prompt, default value (FM format)
"RTN","IBAECP",142,0)
 ; Output: date (FM) or -1, if cancelled
"RTN","IBAECP",143,0)
ASKDT(IBPRMT,IBDFLT) ;Date input
"RTN","IBAECP",144,0)
 N DIR,Y,Y0,X,DIROUT,DIRUT
"RTN","IBAECP",145,0)
 I $G(IBPRMT)'="" S DIR("A")=IBPRMT
"RTN","IBAECP",146,0)
 I $G(IBDFLT)'="" S DIR("B")=$$FMTE^XLFDT(IBDFLT,"1D")
"RTN","IBAECP",147,0)
 S DIR(0)="DA"
"RTN","IBAECP",148,0)
 D ^DIR I $D(DIRUT) Q -1
"RTN","IBAECP",149,0)
 W " (",$$FMTE^XLFDT(Y),")"
"RTN","IBAECP",150,0)
 Q Y
"RTN","IBAECP",151,0)
 ;
"RTN","IBAECP",152,0)
 ;Enter PATIENT NAME (LTC Patients, having a clock only!)
"RTN","IBAECP",153,0)
 ;Customized dialog (added more explanation on '??' input)
"RTN","IBAECP",154,0)
ASKPAT() N DIR,DIC,Y,X,IBDFN
"RTN","IBAECP",155,0)
 F  D  Q:$D(DIRUT)  Q:Y>0
"RTN","IBAECP",156,0)
 . S DIR("A")="Select PATIENT NAME"
"RTN","IBAECP",157,0)
 . S DIR(0)="FO"
"RTN","IBAECP",158,0)
 . S DIR("?")="Enter '??' to list all LTC Patients"
"RTN","IBAECP",159,0)
 . S DIR("?",1)="Enter a name of LTC Patient"
"RTN","IBAECP",160,0)
 . S DIR("?",2)="Answer with PATIENT NAME, or SOCIAL SECURITY NUMBER, or last 4 digits"
"RTN","IBAECP",161,0)
 . S DIR("?",3)="of SOCIAL SECURITY NUMBER, or first initial of last name with last"
"RTN","IBAECP",162,0)
 . S DIR("?",4)="4 digits of SOCIAL SECURITY NUMBER"
"RTN","IBAECP",163,0)
 . S DIR("?",5)=""
"RTN","IBAECP",164,0)
 . S DIR("??")="^D ASKPATQQ^IBAECP"
"RTN","IBAECP",165,0)
 . D ^DIR Q:$D(DIRUT)
"RTN","IBAECP",166,0)
 . S X=Y
"RTN","IBAECP",167,0)
 . I X?3N1"-"2N1"-"4N.3A S X=$TR(X,"-","") ; Remove dashes from SSN
"RTN","IBAECP",168,0)
 . S DIC="^DPT(",DIC(0)="QME"
"RTN","IBAECP",169,0)
 . S DIC("S")="I $D(^IBA(351.81,""AE"",Y))"
"RTN","IBAECP",170,0)
 . S DIC("W")="D WRTPAT^IBAECP(+Y)"
"RTN","IBAECP",171,0)
 . N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBAECP",172,0)
 . D ^DIC Q:Y<1  ; Patient code
"RTN","IBAECP",173,0)
 . S Y=+$G(Y)
"RTN","IBAECP",174,0)
 . ;W "  " D WRTPAT(Y)
"RTN","IBAECP",175,0)
 I $D(DIRUT) Q -1
"RTN","IBAECP",176,0)
 Q +Y
"RTN","IBAECP",177,0)
 ;
"RTN","IBAECP",178,0)
ASKPATQQ N DIC,X,Y,IBDFN,IBI,DIR,DIRUT,DIROUT,DTOUT,DUOUT,IBCNT
"RTN","IBAECP",179,0)
 D ASKPHD
"RTN","IBAECP",180,0)
 S IBI=7,IBCNT=0
"RTN","IBAECP",181,0)
 ;S DIC="^DPT",DIC(0)="F",X="??" D ^DIC
"RTN","IBAECP",182,0)
 S IBDFN=0 F  S IBDFN=$O(^IBA(351.81,"AE",IBDFN)) Q:'IBDFN  D  Q:$D(DIRUT)
"RTN","IBAECP",183,0)
 . W ! S IBI=IBI+1
"RTN","IBAECP",184,0)
 . I IBI>IOSL S DIR(0)="E" D ^DIR W ! Q:$D(DIRUT)  W ! S IBI=3 ; D ASKPHD S IBI=4
"RTN","IBAECP",185,0)
 . ; S IBCNT=IBCNT+1
"RTN","IBAECP",186,0)
 . ; W $J(IBCNT,4)," ",?6
"RTN","IBAECP",187,0)
 . D WRTPAT(IBDFN)
"RTN","IBAECP",188,0)
 Q
"RTN","IBAECP",189,0)
 ;
"RTN","IBAECP",190,0)
ASKPHD ;Header
"RTN","IBAECP",191,0)
 N IBI
"RTN","IBAECP",192,0)
 W !,"Choose an LTC Patient:",!
"RTN","IBAECP",193,0)
 Q
"RTN","IBAECP",194,0)
 ;W !," LTC PATIENT NAME",?30,"BIRTH DATE",?45,"SSN",?55,"STATUS",?68,"CLK DATE"
"RTN","IBAECP",195,0)
 ;W ! F IBI=1:1:80 W "-"
"RTN","IBAECP",196,0)
 ;Q
"RTN","IBAECP",197,0)
WRTPAT(IBDFN) ; Write patient's data
"RTN","IBAECP",198,0)
 N IBZ,IBVET,IBSC
"RTN","IBAECP",199,0)
 S IBZ=$G(^DPT(IBDFN,0)) Q:IBZ="" ""
"RTN","IBAECP",200,0)
 S IBSC=($P($G(^DPT(IBDFN,3)),U)="Y")
"RTN","IBAECP",201,0)
 S IBVET=($P($G(^DPT(IBDFN,"VET")),U)="Y")
"RTN","IBAECP",202,0)
 W $P(IBZ,U)
"RTN","IBAECP",203,0)
 W " ",?30,$$FMTE^XLFDT($P($P(IBZ,U,3),"."),"5MZ")
"RTN","IBAECP",204,0)
 W " ",?42,$$SSN($$EXTERNAL^DILFD(2,.09,"",$P(IBZ,U,9)))
"RTN","IBAECP",205,0)
 W " ",?55,$S(IBVET:$S(IBSC:"S/C",1:"NSC")_" VETERAN",1:"")
"RTN","IBAECP",206,0)
 W " ",?68,$$FMTE^XLFDT($P($O(^IBA(351.81,"AE",IBDFN,""),-1),"."),"5MZ")
"RTN","IBAECP",207,0)
 Q
"RTN","IBAECP",208,0)
 ;
"RTN","IBAECP",209,0)
SSN(IBN) ;Format SSN Value
"RTN","IBAECP",210,0)
 I $L(+IBN)<7 Q IBN
"RTN","IBAECP",211,0)
 Q $E(IBN,1,3)_"-"_$E(IBN,4,5)_"-"_$E(IBN,6,255)
"RTN","IBAMTI1")
0^5^B18419338
"RTN","IBAMTI1",1,0)
IBAMTI1 ;ALB/CPM - SPECIAL INPATIENT BILLING CASES (CON'T.) ; 11-AUG-93
"RTN","IBAMTI1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,132,156,199**;21-MAR-94
"RTN","IBAMTI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTI1",4,0)
 ;
"RTN","IBAMTI1",5,0)
DISP ; Manually disposition a case record.
"RTN","IBAMTI1",6,0)
 W !!,"This option is used to disposition case records for special (AO/IR/EC/SC/MST/HNC)"
"RTN","IBAMTI1",7,0)
 W !,"inpatient episodes of care which are not to be billed.  After identifying"
"RTN","IBAMTI1",8,0)
 W !,"the case, please enter the reason (up to 80 characters) for non-billing."
"RTN","IBAMTI1",9,0)
 ;
"RTN","IBAMTI1",10,0)
 ; - main processing loop
"RTN","IBAMTI1",11,0)
 S IBQ=0 F  W ! D SEL Q:IBQ
"RTN","IBAMTI1",12,0)
 K IBQ
"RTN","IBAMTI1",13,0)
 Q
"RTN","IBAMTI1",14,0)
 ;
"RTN","IBAMTI1",15,0)
SEL ; Select an inpatient billing case and enter the reason for non-billing.
"RTN","IBAMTI1",16,0)
 S DIC="^IBE(351.2,",DIC(0)="QEAMZ",DIC("A")="Select PATIENT: "
"RTN","IBAMTI1",17,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBAMTI1",18,0)
 D ^DIC S IBC=+Y I Y<0 S IBQ=1 G SELQ
"RTN","IBAMTI1",19,0)
 I $P(Y(0),"^",5)=1 W !!,"You must wait until this patient has been discharged to disposition the case." G SELQ
"RTN","IBAMTI1",20,0)
 I $P(Y(0),"^",4) S IBBILLED=1 W !!,"Please note that it appears as if this case has been billed."
"RTN","IBAMTI1",21,0)
 I $P(Y(0),"^",8) W !!,"Please note that this case has already been dispositioned."
"RTN","IBAMTI1",22,0)
 ;
"RTN","IBAMTI1",23,0)
 ; - display case record
"RTN","IBAMTI1",24,0)
 W ! D DSPL(IBC)
"RTN","IBAMTI1",25,0)
 ;
"RTN","IBAMTI1",26,0)
 ; - allow user update of record
"RTN","IBAMTI1",27,0)
 S IBHC=$P(Y(0),"^",7),IBHR=$G(^IBE(351.2,IBC,1))
"RTN","IBAMTI1",28,0)
 S DIE="^IBE(351.2,",DA=IBC,DR=$S($G(IBBILLED):".07;",1:"")_1 D ^DIE
"RTN","IBAMTI1",29,0)
 ;
"RTN","IBAMTI1",30,0)
 S IBNC=$P(^IBE(351.2,IBC,0),"^",7),IBNR=$G(^IBE(351.2,IBC,1))
"RTN","IBAMTI1",31,0)
 I IBHC=IBNC,IBHR=IBNR W !!,"No changes made to the case record!" G SELQ
"RTN","IBAMTI1",32,0)
 I IBNR]"" W !!,"This case record will be dispositioned."
"RTN","IBAMTI1",33,0)
 S DR="2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI1",34,0)
 I IBNR]"" S DR=".07////1;.08////1;"_DR
"RTN","IBAMTI1",35,0)
 S DIE="^IBE(351.2,",DA=IBC D ^DIE
"RTN","IBAMTI1",36,0)
SELQ K DA,DIC,DIE,DR,IBC,IBHC,IBHR,IBNC,IBNR,IBBILLED
"RTN","IBAMTI1",37,0)
 Q
"RTN","IBAMTI1",38,0)
 ;
"RTN","IBAMTI1",39,0)
CEA(IBPM,IBEVT) ; Automatically disposition the case from Cancel/Edit/Add.
"RTN","IBAMTI1",40,0)
 ;  Input:     IBPM  --  Pointer to the adm movement in file #405
"RTN","IBAMTI1",41,0)
 ;            IBEVT  --  Pointer to the billing event record in file #350
"RTN","IBAMTI1",42,0)
 I '$G(IBEVT) G CEAQ
"RTN","IBAMTI1",43,0)
 N DA,DIE,DR,IBC
"RTN","IBAMTI1",44,0)
 S IBC=$O(^IBE(351.2,"AC",+$G(IBPM),0)) I IBC D UPD(0)
"RTN","IBAMTI1",45,0)
CEAQ Q
"RTN","IBAMTI1",46,0)
 ;
"RTN","IBAMTI1",47,0)
CHK(IBC,IBEVT) ; Review the case after adding a charge from Cancel/Edit/Add.
"RTN","IBAMTI1",48,0)
 ;  Input:      IBC  --  Pointer to the case in file #351.2
"RTN","IBAMTI1",49,0)
 ;            IBEVT  --  Pointer to the billing event record in file #350
"RTN","IBAMTI1",50,0)
 I '$G(IBC)!'$G(IBEVT) G CHKQ
"RTN","IBAMTI1",51,0)
 N DA,DIE,DR,IBCD,IBCD1
"RTN","IBAMTI1",52,0)
 S IBCD=$G(^IBE(351.2,IBC,0)),IBCD1=$G(^(1))
"RTN","IBAMTI1",53,0)
 I $P(IBCD,"^",7)!'$P(IBCD,"^",8)!(IBCD1]"") D UPD(1)
"RTN","IBAMTI1",54,0)
CHKQ Q
"RTN","IBAMTI1",55,0)
 ;
"RTN","IBAMTI1",56,0)
UPD(IND) ; Disposition the case record.
"RTN","IBAMTI1",57,0)
 ;  Input:      IND  --  0 = dispositioning  |  1 = reviewing
"RTN","IBAMTI1",58,0)
 ;         variables --  IBC => ptr to case record
"RTN","IBAMTI1",59,0)
 ;                       IBEVT => ptr to event record in #350
"RTN","IBAMTI1",60,0)
 W !,"Dispositioning the special inpatient billing case record"
"RTN","IBAMTI1",61,0)
 W:$G(IND) " (as billable)" W "..."
"RTN","IBAMTI1",62,0)
 K ^IBE(351.2,IBC,1)
"RTN","IBAMTI1",63,0)
 S DR=".04////"_IBEVT_";.07////0;.08////1;2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI1",64,0)
 S DIE="^IBE(351.2,",DA=IBC D ^DIE W "  done."
"RTN","IBAMTI1",65,0)
 Q
"RTN","IBAMTI1",66,0)
 ;
"RTN","IBAMTI1",67,0)
DSPL(IBC) ; Display a case record.
"RTN","IBAMTI1",68,0)
 ;  Input:      IBC  --  Pointer to the case record in file #351.2
"RTN","IBAMTI1",69,0)
 I '$G(IBC) G DSPLQ
"RTN","IBAMTI1",70,0)
 N DFN,IBCD,IBC1,IBC2,IBATYP,IBPT,IBDIS,IBCL,IBEVT,IBN,IBND,Y
"RTN","IBAMTI1",71,0)
 S IBCD=$G(^IBE(351.2,IBC,0)),IBC1=$G(^(1)),IBC2=$G(^(2))
"RTN","IBAMTI1",72,0)
 S DFN=+IBCD,IBPT=$$PT^IBEFUNC(DFN),IBCL=$P(IBCD,"^",3)
"RTN","IBAMTI1",73,0)
 W !,$$DASH(),!?1,"Pt. Name: ",$E($P(IBPT,"^"),1,17),"  (",$P(IBPT,"^",3),")"
"RTN","IBAMTI1",74,0)
 W ?38,"Care related to ",$S(IBCL=1:"AO",IBCL=2:"IR",IBCL=3:"EC",IBCL=5:"MST",IBCL=6:"HNC",1:"SC"),": ",$S($P(IBCD,"^",7):"YES",$P(IBCD,"^",7)=0:"NO",1:"UNANSWERED")
"RTN","IBAMTI1",75,0)
 W !?5,"Type: ",$$UCCL^IBAMTI(IBCL),?39,"Case Dispositioned: ",$S($P(IBCD,"^",8):"YES",1:"NO")
"RTN","IBAMTI1",76,0)
 W !?1,"Adm Date: ",$$DAT1^IBOUTL(+$G(^DGPM(+$P(IBCD,"^",2),0)),1),?41,"Date Last Edited: ",$$DAT1^IBOUTL(+$P(IBC2,"^",4),1)
"RTN","IBAMTI1",77,0)
 S IBDIS=+$G(^DGPM(+$P($G(^DGPM(+$P(IBCD,"^",2),0)),"^",17),0))
"RTN","IBAMTI1",78,0)
 W !,"Disc Date: ",$S(IBDIS:$$DAT1^IBOUTL(IBDIS,1),1:"Still Admitted"),?43,"Last Edited By: ",$E($P($G(^VA(200,+$P(IBC2,"^",3),0)),"^"),1,20),!,$$DASH()
"RTN","IBAMTI1",79,0)
 ;
"RTN","IBAMTI1",80,0)
 S IBEVT=+$P(IBCD,"^",4)
"RTN","IBAMTI1",81,0)
 I $O(^IB("AF",IBEVT,IBEVT)) W !?1,"Charges Billed:" D
"RTN","IBAMTI1",82,0)
 .S IBN=0 F  S IBN=$O(^IB("AF",IBEVT,IBN)) Q:'IBN  I IBN'=IBEVT D
"RTN","IBAMTI1",83,0)
 ..S IBND=$G(^IB(IBN,0))
"RTN","IBAMTI1",84,0)
 ..S IBATYP=$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")
"RTN","IBAMTI1",85,0)
 ..S:$E(IBATYP,1,2)="DG" IBATYP=$E(IBATYP,4,99)
"RTN","IBAMTI1",86,0)
 ..W !?5,IBATYP,?35,$$DAT1^IBOUTL($P(IBND,"^",14)),?46,$$DAT1^IBOUTL($P(IBND,"^",15))
"RTN","IBAMTI1",87,0)
 ..W ?57,"$",$P(IBND,"^",7),?64,$P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",2)
"RTN","IBAMTI1",88,0)
 .W !,$$DASH()
"RTN","IBAMTI1",89,0)
 ;
"RTN","IBAMTI1",90,0)
 I IBC1]"" W !?1,"Reason for Non-Billing:",!,IBC1,!,$$DASH(),!
"RTN","IBAMTI1",91,0)
DSPLQ Q
"RTN","IBAMTI1",92,0)
 ;
"RTN","IBAMTI1",93,0)
DASH() ; Return a dashed line.
"RTN","IBAMTI1",94,0)
 Q $TR($J("",80)," ","-")
"RTN","IBARXEI")
0^6^B19789754
"RTN","IBARXEI",1,0)
IBARXEI ;ALB/AAS - RX COPAY EXEMPTION INQUIRY ; 21-JAN-93
"RTN","IBARXEI",2,0)
 ;;2.0; INTEGRATED BILLING ;**34,199**; 21-MAR-94
"RTN","IBARXEI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEI",4,0)
 ;
"RTN","IBARXEI",5,0)
% I '$D(IOF) D HOME^%ZIS
"RTN","IBARXEI",6,0)
 ;
"RTN","IBARXEI",7,0)
PAT I $G(IBQUIT) G END
"RTN","IBARXEI",8,0)
 D END
"RTN","IBARXEI",9,0)
 S (IBPAG,IBQUIT)=0 D NOW^%DTC S Y=% D D^DIQ S IBPDAT=Y
"RTN","IBARXEI",10,0)
 ;
"RTN","IBARXEI",11,0)
 S DIC("W")="N IBX S IBX=$G(^IBA(354,+Y,0)) W ?32,"" "",$P($G(^DPT(+IBX,0)),U,9),?46,"" "",$$TEXT^IBARXEU0($P(IBX,U,4)),?59,"" "",$P($G(^IBE(354.2,+$P(IBX,U,5),0)),U)"
"RTN","IBARXEI",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBARXEI",13,0)
 W ! S DIC="^DPT(",DIC("S")="I $D(^IBA(354,+Y,0))",DIC(0)="AEQM",DIC("A")="Select BILLING PATIENT: " D ^DIC K DIC
"RTN","IBARXEI",14,0)
 G:Y<1 END
"RTN","IBARXEI",15,0)
 S DFN=+Y,IBP=$$PT^IBEFUNC(DFN),IBPBN=$G(^IBA(354,DFN,0))
"RTN","IBARXEI",16,0)
 ;
"RTN","IBARXEI",17,0)
TYP ; -- inquire is active or all
"RTN","IBARXEI",18,0)
 S DIR("?")="Enter 1 or B to see a brief inquiry of all Active Exemptions or enter 2 or F to see a full inquiry of the entire exemption history"
"RTN","IBARXEI",19,0)
 S DIR(0)="SAOM^1:BRIEF;2:FULL",DIR("A")="(B)rief or (Full) Inquiry: ",DIR("B")="Brief"
"RTN","IBARXEI",20,0)
 D ^DIR K DIR G:$D(DIRUT)!($G(Y)<1) END S IBFULL=Y
"RTN","IBARXEI",21,0)
 ;
"RTN","IBARXEI",22,0)
DEV S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBARXEI",23,0)
 I $D(IO("Q")) K IO("Q") S ZTRTN="DQ^IBARXEI",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB INQUIRE TO PATIENT EXEMPTION" D ^%ZTLOAD,HOME^%ZIS K ZTSK D END G PAT
"RTN","IBARXEI",24,0)
 U IO
"RTN","IBARXEI",25,0)
 ;
"RTN","IBARXEI",26,0)
DQ ;
"RTN","IBARXEI",27,0)
 K ^TMP($J)
"RTN","IBARXEI",28,0)
 D @IBFULL
"RTN","IBARXEI",29,0)
 I 'IBQUIT,$E(IOST,1,2)="C-" D PAUSE^IBOUTL
"RTN","IBARXEI",30,0)
 I '$D(ZTQUEUED) D END G PAT
"RTN","IBARXEI",31,0)
 G END
"RTN","IBARXEI",32,0)
 Q
"RTN","IBARXEI",33,0)
 ;
"RTN","IBARXEI",34,0)
1 ; -- brief view active exemptions
"RTN","IBARXEI",35,0)
 D DISP^IBARXEX,STAT^IBARXEX
"RTN","IBARXEI",36,0)
 Q
"RTN","IBARXEI",37,0)
 ;
"RTN","IBARXEI",38,0)
2 ; -- full view all exemptions
"RTN","IBARXEI",39,0)
 D HDR
"RTN","IBARXEI",40,0)
 S IBT=""
"RTN","IBARXEI",41,0)
 ;
"RTN","IBARXEI",42,0)
 ; -- build list in inverse effective date, inverse date/time added
"RTN","IBARXEI",43,0)
 F  S IBT=$O(^IBA(354.1,"APIDT",DFN,IBT)) Q:'IBT  S IBIDT="" F  S IBIDT=$O(^IBA(354.1,"APIDT",DFN,IBT,IBIDT)) Q:'IBIDT  S IBDA="" F  S IBDA=$O(^IBA(354.1,"APIDT",DFN,IBT,IBIDT,IBDA)) Q:'IBDA!(IBQUIT)  D SET
"RTN","IBARXEI",44,0)
 ;
"RTN","IBARXEI",45,0)
 ; -- print list
"RTN","IBARXEI",46,0)
 S IBIDT="" F  S IBIDT=$O(^TMP($J,DFN,IBIDT)) Q:'IBIDT!(IBQUIT)  S IBA="" F  S IBA=$O(^TMP($J,DFN,IBIDT,IBA)) Q:'IBA!(IBQUIT)  S IBDA="" F  S IBDA=$O(^TMP($J,DFN,IBIDT,IBA,IBDA)) Q:'IBDA!(IBQUIT)  S IBND=^(IBDA) D FULL
"RTN","IBARXEI",47,0)
 ;
"RTN","IBARXEI",48,0)
 Q
"RTN","IBARXEI",49,0)
 ;
"RTN","IBARXEI",50,0)
END K ^TMP($J) S ZTREQ="@" I $D(ZTQUEUED) Q
"RTN","IBARXEI",51,0)
 D ^%ZISC
"RTN","IBARXEI",52,0)
 K C,X,Y,DFN,DIC,DIR,DIRUT,ZTSK,ZTREQ,IBCNT,IBDA,IBDT,IBFULL,IBIDT,IBJ,IBND,IBP,IBPAG,IBPBN,IBPDAT,IBQUIT,IBSTAT,IBSTATR,IBT
"RTN","IBARXEI",53,0)
 Q
"RTN","IBARXEI",54,0)
 ;
"RTN","IBARXEI",55,0)
HDR ; -- print header for full inquiry
"RTN","IBARXEI",56,0)
 I IBPAG!($E(IOST,1,2)="C-") W @IOF
"RTN","IBARXEI",57,0)
 S IBPAG=IBPAG+1
"RTN","IBARXEI",58,0)
 W "Billing Exemption Inquiry",?(IOM-35),$P(IBPDAT,"@")," ",$P(IBPDAT,"@",2),"  Page ",IBPAG
"RTN","IBARXEI",59,0)
 W !,$E($P(IBP,"^"),1,20),"   ",$P(IBP,"^",3),?27,"Currently: ",$$TEXT^IBARXEU0($P(IBPBN,"^",4))_"-"_$P($G(^IBE(354.2,+$P(IBPBN,"^",5),0)),"^"),?65," ",$$DAT1^IBOUTL($P(IBPBN,"^",3))
"RTN","IBARXEI",60,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBARXEI",61,0)
 Q
"RTN","IBARXEI",62,0)
 ;
"RTN","IBARXEI",63,0)
FULL ; -- print full inquiry for one exemption
"RTN","IBARXEI",64,0)
 I $Y>(IOSL-8) D PAUSE^IBOUTL Q:IBQUIT  D HDR
"RTN","IBARXEI",65,0)
 I $G(IBND)="" W !,"Error, Missing Record - ",IBDA Q
"RTN","IBARXEI",66,0)
 S Y=+IBND D D^DIQ
"RTN","IBARXEI",67,0)
 W !,$S($P(IBND,"^",10):"**",1:"  "),"Effective Date: ",Y
"RTN","IBARXEI",68,0)
 W ?36,"      Type: ",$P($P($P(^DD(354.1,.03,0),"^",3),$P(IBND,"^",3)_":",2),";",1)
"RTN","IBARXEI",69,0)
 W !,"          Status: ",$P($P($P(^DD(354.1,.04,0),"^",3),$P(IBND,"^",4)_":",2),";",1)
"RTN","IBARXEI",70,0)
 W ?36,"    Reason: ",$P($G(^IBE(354.2,+$P(IBND,"^",5),0)),"^")
"RTN","IBARXEI",71,0)
 W !,"          Active: ",$S($P(IBND,"^",10):"YES, ACTIVE",1:"NO, INACTIVE")
"RTN","IBARXEI",72,0)
 W ?36,"      User: ",$P($G(^VA(200,+$P(IBND,"^",7),0)),"^")
"RTN","IBARXEI",73,0)
 W !,"       How Added: ",$P($P($P(^DD(354.1,.06,0),"^",3),$P(IBND,"^",6)_":",2),";",1)
"RTN","IBARXEI",74,0)
 W ?36,"When Added: " S Y=$P(IBND,"^",8) D DT^DIQ
"RTN","IBARXEI",75,0)
 I $P(IBND,"^",13)'="" W !,"Charges Canceled: " S Y=$P(IBND,"^",13) D DT^DIQ W ?36,"        To: " S Y=$P(IBND,"^",14) D DT^DIQ
"RTN","IBARXEI",76,0)
 I $P(IBND,"^",15)'="" W !," Prior Threshold: " S Y=$P(IBND,"^",15) D DT^DIQ
"RTN","IBARXEI",77,0)
 I $G(DUZ(0))="@" W !,"     Patient DFN: ",$P(IBND,"^",2),?36,"Ex. Number: ",IBDA
"RTN","IBARXEI",78,0)
 W !
"RTN","IBARXEI",79,0)
 Q
"RTN","IBARXEI",80,0)
 ;
"RTN","IBARXEI",81,0)
SET ; -- built tmp array ==> ^tmp($j, dfn, -eff date, -date/time added, da)
"RTN","IBARXEI",82,0)
 N X
"RTN","IBARXEI",83,0)
 S X=$G(^IBA(354.1,+IBDA,0)) Q:X=""
"RTN","IBARXEI",84,0)
 S ^TMP($J,DFN,IBIDT,-$P(X,"^",8),IBDA)=X
"RTN","IBARXEI",85,0)
 Q
"RTN","IBARXEL1")
0^7^B12887948
"RTN","IBARXEL1",1,0)
IBARXEL1 ;ALB/CPM - RX COPAY EXEMPTION REMINDER REPRINT ; 14-APR-95
"RTN","IBARXEL1",2,0)
 ;;2.0; INTEGRATED BILLING ;**34,199**; 21-MAR-94
"RTN","IBARXEL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEL1",4,0)
 ;
"RTN","IBARXEL1",5,0)
REPR ; Reprint a single income test reminder letter.
"RTN","IBARXEL1",6,0)
 S IBLET=$O(^IBE(354.6,"B","IB INCOME TEST REMINDER",0))
"RTN","IBARXEL1",7,0)
 I 'IBLET W !!,"You do not have the Income Test Reminder letter defined!" G REPRQ
"RTN","IBARXEL1",8,0)
 ;
"RTN","IBARXEL1",9,0)
 S DIC="^DPT(",DIC("S")="I $D(^IBA(354,+Y,0))",DIC(0)="AEQMZ",DIC("A")="Select BILLING PATIENT: "
"RTN","IBARXEL1",10,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBARXEL1",11,0)
 D ^DIC K DIC S DFN=+Y G:Y<0 REPRQ
"RTN","IBARXEL1",12,0)
 ;
"RTN","IBARXEL1",13,0)
 ; - find the most recent active exemption
"RTN","IBARXEL1",14,0)
 S IBEX=+$O(^(+$O(^IBA(354.1,"AIVDT",1,DFN,-(DT+.00001))),0))
"RTN","IBARXEL1",15,0)
 S IBEXD=$G(^IBA(354.1,IBEX,0))
"RTN","IBARXEL1",16,0)
 I 'IBEXD W !!,"This veteran has never had an active copayment exemption status!" G REPR
"RTN","IBARXEL1",17,0)
 ;
"RTN","IBARXEL1",18,0)
 I $G(^DPT(DFN,.35)) W !!,*7,"Please note that this veteran died on ",$$DAT1^IBOUTL(+^(.35)),"."
"RTN","IBARXEL1",19,0)
 ;
"RTN","IBARXEL1",20,0)
 ; - display the veteran's current exemption status
"RTN","IBARXEL1",21,0)
 S IBEXREA=$$ACODE^IBARXEU0(IBEXD)
"RTN","IBARXEL1",22,0)
 W !!,$TR($J("",80)," ","=")
"RTN","IBARXEL1",23,0)
 W !?10,"Exemption Status: ",$$TEXT^IBARXEU0(+$P(IBEXD,"^",4)),"  (",$P($G(^IBE(354.2,+$P(IBEXD,"^",5),0)),"^"),")"
"RTN","IBARXEL1",24,0)
 W !?12,"Exemption Date: ",$$DAT1^IBOUTL(+IBEXD)
"RTN","IBARXEL1",25,0)
 ;
"RTN","IBARXEL1",26,0)
 ; - display the previous status if the veteran has not reported income
"RTN","IBARXEL1",27,0)
 I IBEXREA=210 D
"RTN","IBARXEL1",28,0)
 .S IBCHK=1
"RTN","IBARXEL1",29,0)
 .S IBEX=+$O(^(+$O(^IBA(354.1,"AIVDT",1,DFN,-IBEXD)),0))
"RTN","IBARXEL1",30,0)
 .S IBEXD=$G(^IBA(354.1,IBEX,0)) Q:'IBEXD
"RTN","IBARXEL1",31,0)
 .S IBEXREA=$$ACODE^IBARXEU0(IBEXD)
"RTN","IBARXEL1",32,0)
 .W !!?4,"Prior Exemption Status: ",$$TEXT^IBARXEU0(+$P(IBEXD,"^",4)),"  (",$P($G(^IBE(354.2,+$P(IBEXD,"^",5),0)),"^"),")"
"RTN","IBARXEL1",33,0)
 .W !?6,"Prior Exemption Date: ",$$DAT1^IBOUTL(+IBEXD)
"RTN","IBARXEL1",34,0)
 ;
"RTN","IBARXEL1",35,0)
 ; - if a letter has already been printed, display the print date
"RTN","IBARXEL1",36,0)
 I $P(IBEXD,"^",16) D
"RTN","IBARXEL1",37,0)
 .W !!?12,"Letter Printed: ",$$DAT1^IBOUTL($P(IBEXD,"^",16))
"RTN","IBARXEL1",38,0)
 .S X=$P($$LST^DGMTCOU1(DFN,$$FMADD^XLFDT(DT,60),3),"^",2)
"RTN","IBARXEL1",39,0)
 .W ?41,"Current Income Test Date: ",$S(X:$$DAT1^IBOUTL(X),1:"<none>")
"RTN","IBARXEL1",40,0)
 W !,$TR($J("",80)," ","=")
"RTN","IBARXEL1",41,0)
 ;
"RTN","IBARXEL1",42,0)
 ; - exemption must be based on income
"RTN","IBARXEL1",43,0)
 I IBEXREA'=110,IBEXREA'=120 W !!,"You may only generate a letter for an exemption based on income!",! K IBCHK G REPR
"RTN","IBARXEL1",44,0)
 ;
"RTN","IBARXEL1",45,0)
 I '$G(IBCHK),+IBEXD>$$FMADD^XLFDT(DT,-305) W !!,"Please note that this exemption is not due to expire for ",$$FMDIFF^XLFDT(+IBEXD+10000,DT)," days!"
"RTN","IBARXEL1",46,0)
 ;
"RTN","IBARXEL1",47,0)
 ; - okay to print letter?
"RTN","IBARXEL1",48,0)
 S DIR(0)="Y",DIR("A")="Okay to print the reminder letter",DIR("?")="To print the income test reminder letter, answer 'YES.'  Otherwise, answer 'NO.'"
"RTN","IBARXEL1",49,0)
 W ! D ^DIR K DIR,DIRUT,DTOUT,DUOUT,DIROUT I 'Y G REPRQ
"RTN","IBARXEL1",50,0)
 ;
"RTN","IBARXEL1",51,0)
 W !!,"*** Please note that the reminder letter prints in 80 columns. ***",!
"RTN","IBARXEL1",52,0)
 S %ZIS="QM" D ^%ZIS G:POP REPRQ
"RTN","IBARXEL1",53,0)
 I $D(IO("Q")) D  G REPRQ
"RTN","IBARXEL1",54,0)
 .S ZTRTN="DQ^IBARXEL1",ZTDESC="IB - PRINT INCOME TEST REMINDER LETTER"
"RTN","IBARXEL1",55,0)
 .F I="IBEX","IBLET" S ZTSAVE(I)=""
"RTN","IBARXEL1",56,0)
 .D ^%ZTLOAD K IO("Q") D HOME^%ZIS
"RTN","IBARXEL1",57,0)
 .W !!,$S($D(ZTSK):"This job has been queued as task #"_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBARXEL1",58,0)
 .K ZTSK,IO("Q")
"RTN","IBARXEL1",59,0)
 ;
"RTN","IBARXEL1",60,0)
 U IO
"RTN","IBARXEL1",61,0)
 ;
"RTN","IBARXEL1",62,0)
DQ ; Queued entry point.
"RTN","IBARXEL1",63,0)
 D PRINT^IBARXEL
"RTN","IBARXEL1",64,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBARXEL1",65,0)
 ;
"RTN","IBARXEL1",66,0)
REPRQ D ^%ZISC
"RTN","IBARXEL1",67,0)
 K DFN,IBLET,IBEX,IBEXD,IBEXREA,IBCHK,IBEXPD,IBQUIT,IBDATA,IBNAM,IBALIN
"RTN","IBARXEL1",68,0)
 Q
"RTN","IBARXEX")
0^8^B19087839
"RTN","IBARXEX",1,0)
IBARXEX ;ALB/AAS - RX COPAY INCOME EXEMPTION ROUTINE - MANUAL UPDATE OPTION ; 16-NOV-92
"RTN","IBARXEX",2,0)
 ;;2.0; INTEGRATED BILLING ;**199**; 21-MAR-94
"RTN","IBARXEX",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEX",4,0)
 ;
"RTN","IBARXEX",5,0)
% I '$D(DT) D DT^DICRW
"RTN","IBARXEX",6,0)
 D HOME^%ZIS
"RTN","IBARXEX",7,0)
PAT W @IOF,"Medication Copayment Exemption Update Option",!!
"RTN","IBARXEX",8,0)
 S DIC("W")="N IBX S IBX=$G(^IBA(354,+Y,0)) W ?32,"" "",$P($G(^DPT(+IBX,0)),U,9),?46,"" "",$$TEXT^IBARXEU0($P(IBX,U,4)),?59,"" "",$P($G(^IBE(354.2,+$P(IBX,U,5),0)),U)"
"RTN","IBARXEX",9,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBARXEX",10,0)
 S DIC="^DPT(",DIC("S")="I $D(^IBA(354,+Y,0))",DIC(0)="AEQM",DIC("A")="Select BILLING PATIENT: " D ^DIC G:+Y<1 END S DFN=+Y K DIC I $P(Y,"^",3) S IBNEW=""
"RTN","IBARXEX",11,0)
 ;
"RTN","IBARXEX",12,0)
EN ; -- entry point from alert processing , dfn defined
"RTN","IBARXEX",13,0)
 S IBQUIT=0,IBTALK=1,IBJOB=13
"RTN","IBARXEX",14,0)
 D DISP
"RTN","IBARXEX",15,0)
 D STAT
"RTN","IBARXEX",16,0)
 I $D(IBNEW)!(IBSTATR'=$P(IBPBN,"^",5))!($P(IBSTAT,"^",4)'=$P(IBPBN,"^",4)) D AUTO^IBARXEX1 G PATQ ;ask if autoupdate
"RTN","IBARXEX",17,0)
 I $P(IBSTAT,"^",4)=$P(IBPBN,"^",4) D MANUAL^IBARXEX1 ; ask if want to change
"RTN","IBARXEX",18,0)
PATQ I 'IBQUIT D:$D(IBCHANGE) DISP,STAT,PAUSE^IBOUTL
"RTN","IBARXEX",19,0)
 ;
"RTN","IBARXEX",20,0)
 D END
"RTN","IBARXEX",21,0)
 G PAT
"RTN","IBARXEX",22,0)
 ;
"RTN","IBARXEX",23,0)
DISP ; -- single screen display of Pharmacy co-pay income exemption status
"RTN","IBARXEX",24,0)
 S IBP=$$PT^IBEFUNC(DFN),IBPBN=$G(^IBA(354,DFN,0))
"RTN","IBARXEX",25,0)
 D HDR
"RTN","IBARXEX",26,0)
 S IBCNT=0
"RTN","IBARXEX",27,0)
 ;
"RTN","IBARXEX",28,0)
 S IBDT=-(DT+.000001)
"RTN","IBARXEX",29,0)
 F  S IBDT=$O(^IBA(354.1,"AIVDT",1,DFN,IBDT)) Q:'IBDT  S IBDA=0 F  S IBDA=$O(^IBA(354.1,"AIVDT",1,DFN,IBDT,IBDA)) Q:'IBDA  D SHOWONE S IBCNT=IBCNT+1
"RTN","IBARXEX",30,0)
 I 'IBCNT W !,"None"
"RTN","IBARXEX",31,0)
 Q
"RTN","IBARXEX",32,0)
 ;
"RTN","IBARXEX",33,0)
SHOWONE ; -- write display line for one entry
"RTN","IBARXEX",34,0)
 S X=$G(^IBA(354.1,IBDA,0)) Q:X=""
"RTN","IBARXEX",35,0)
 W !,$$DAT1^IBOUTL(+X),?12,$S($P(X,"^",3)=1:"RX COPAY",1:"")
"RTN","IBARXEX",36,0)
 W ?22,$$TEXT^IBARXEU0($P(X,"^",4))
"RTN","IBARXEX",37,0)
 W ?34,$E($P($G(^IBE(354.2,+$P(X,"^",5),0)),"^"),1,22)
"RTN","IBARXEX",38,0)
 W ?56,$S($P(X,"^",6)=1:"SYSTEM",$G(^VA(200,+$P(X,"^",7),0))]"":$E($P(^(0),U),1,14),1:"Unknown"),"/ ",$$DAT1^IBOUTL($P(X,"^",8))
"RTN","IBARXEX",39,0)
 Q
"RTN","IBARXEX",40,0)
 ;
"RTN","IBARXEX",41,0)
STAT ; -- show current status
"RTN","IBARXEX",42,0)
 S IBSTATR=+$$STATUS^IBARXEU1(DFN,DT)
"RTN","IBARXEX",43,0)
 S IBSTAT=$G(^IBE(354.2,+IBSTATR,0))
"RTN","IBARXEX",44,0)
 ;
"RTN","IBARXEX",45,0)
 W !!,"Medication Copayment Exemption Status Currently computes to: ",$$TEXT^IBARXEU0($P(IBSTAT,"^",4))
"RTN","IBARXEX",46,0)
 W !,$P(IBSTAT,"^",2),!!
"RTN","IBARXEX",47,0)
 Q
"RTN","IBARXEX",48,0)
 ;
"RTN","IBARXEX",49,0)
SELCY ; -- select calendar year to work with
"RTN","IBARXEX",50,0)
 ;
"RTN","IBARXEX",51,0)
 W !!
"RTN","IBARXEX",52,0)
 S Y=+$$LST^IBARXEU0(DFN) I Y?7N D D^DIQ S DIR("B")=Y
"RTN","IBARXEX",53,0)
 S DIR("?")="Enter the effective date you wish to add a new exemption record for.  If the exemption is computed from income data then the effective date will be the date of the income test.  It cannot be in the future."
"RTN","IBARXEX",54,0)
 S DIR(0)="DO^"_$$STDATE^IBARXEU_":"_DT,DIR("A")="Select Effective Date" D ^DIR K DIR
"RTN","IBARXEX",55,0)
 I $D(DIRUT)!(Y'?7N) S IBQUIT=1 G SELCYQ
"RTN","IBARXEX",56,0)
 S IBDT=Y
"RTN","IBARXEX",57,0)
 I '$D(^IBA(354.1,"APIDT",DFN,1,-IBDT))&(IBDT'=DT) K IBDT W !!?4,$C(7),"The DATE selected must be the date of an exemption or today!",!?4,"This is the same date as the date of a Means Test or Copay Test.",! G SELCY
"RTN","IBARXEX",58,0)
SELCYQ Q
"RTN","IBARXEX",59,0)
 ;
"RTN","IBARXEX",60,0)
 ;
"RTN","IBARXEX",61,0)
HDR W @IOF,"Medication Copayment Income Exemption Status"
"RTN","IBARXEX",62,0)
 W !,$E($P(IBP,"^"),1,20),"   ",$P(IBP,"^",3),?27," Currently: ",$$TEXT^IBARXEU0($P(IBPBN,"^",4))_"-"_$P($G(^IBE(354.2,+$P(IBPBN,"^",5),0)),"^"),?65," ",$$DAT1^IBOUTL($P(IBPBN,"^",3))
"RTN","IBARXEX",63,0)
 W !!,"EFFECTIVE   TYPE      STATUS      REASON                ADDED BY/ON"
"RTN","IBARXEX",64,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBARXEX",65,0)
 Q
"RTN","IBARXEX",66,0)
 ;
"RTN","IBARXEX",67,0)
END K C,I,J,DA,DIC,DIE,DR,DFN,IBACTIVE,IBADDE,IBALERT,IBCHANGE,IBCNT,IBCODA,IBCODP,IBEXDA,IBDA,IBDT,IBEXREA,IBJ,IBJOB,IBNEW,IBP,IBPBN,DIRUT,IBQUIT,IBSTAT,IBSTATR,IBTALK,IBWHER,X,X1,XCNP,XMZ,Y
"RTN","IBARXEX",68,0)
 Q
"RTN","IBARXMQ")
0^9^B14602656
"RTN","IBARXMQ",1,0)
IBARXMQ ;LL/ELZ-RX COPAY RPC QUERY ROUTINE (MILL BILL) ;10-OCT-2000
"RTN","IBARXMQ",2,0)
 ;;2.0;INTEGRATED BILLING;**150,156,186,199**;21-MAR-94
"RTN","IBARXMQ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXMQ",4,0)
 ;
"RTN","IBARXMQ",5,0)
EN ; main entry point for users to request a query of rx bills from all possible facilities
"RTN","IBARXMQ",6,0)
 N DIC,X,Y,DFN,IBT,IBTFL,%,%ZIS,ZTSAVE,POP,ZTSK,DIR,IBDT,IBPAT,IBROOT
"RTN","IBARXMQ",7,0)
 ;
"RTN","IBARXMQ",8,0)
 ; select patient, and get pt info
"RTN","IBARXMQ",9,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBARXMQ",10,0)
 S DIC="^DPT(",DIC(0)="AEMNQ" D ^DIC Q:Y<1  S DFN=+Y
"RTN","IBARXMQ",11,0)
 D DEM^VADPT S IBPAT=VADM(1)_"^"_VA("BID") D KVAR^VADPT
"RTN","IBARXMQ",12,0)
 ;
"RTN","IBARXMQ",13,0)
 ; ask for month / year
"RTN","IBARXMQ",14,0)
 S DIR(0)="D^::AEMP",DIR("A")="For What Month/Year" D ^DIR Q:Y<1
"RTN","IBARXMQ",15,0)
 S IBDT=Y
"RTN","IBARXMQ",16,0)
 ;
"RTN","IBARXMQ",17,0)
 ; scan for patient to see if different facilities could be involved
"RTN","IBARXMQ",18,0)
 S IBT=$$TFL^IBARXMU(DFN,.IBTFL)
"RTN","IBARXMQ",19,0)
 ;
"RTN","IBARXMQ",20,0)
 ; if multiple facilities ask if we should check
"RTN","IBARXMQ",21,0)
 I IBT W !,"This patient could have Pharmacy Co-payment bills at other facilities",!,"Do you want to check those other facilities" S %=0 D YN^DICN S:%'=1 IBT=0 Q:%<0
"RTN","IBARXMQ",22,0)
 ;
"RTN","IBARXMQ",23,0)
 ; now for a device
"RTN","IBARXMQ",24,0)
 S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","IBARXMQ",25,0)
 I $D(IO("Q")) D  Q
"RTN","IBARXMQ",26,0)
 . S ZTRTN="DQ^IBARXMQ",(ZTSAVE("DFN"),ZTSAVE("IB*"))=""
"RTN","IBARXMQ",27,0)
 . S ZTDESC="PHARMACY BILLING SUMMARY"
"RTN","IBARXMQ",28,0)
 . D ^%ZTLOAD,HOME^%ZIS K IO("Q") W !,"Task# ",ZTSK
"RTN","IBARXMQ",29,0)
 ;
"RTN","IBARXMQ",30,0)
DQ ; tasked entry point
"RTN","IBARXMQ",31,0)
 ;
"RTN","IBARXMQ",32,0)
 N IBD,IBER,X,IBX,IBC,IBB,IBU,DIRUT,IBE,IBP K ^TMP("IBARXM",$J)
"RTN","IBARXMQ",33,0)
 ;
"RTN","IBARXMQ",34,0)
 ; remote stuff, file locally
"RTN","IBARXMQ",35,0)
 I IBT S IBX=0 F  S IBX=$O(IBTFL(IBX)) Q:IBX<1  D
"RTN","IBARXMQ",36,0)
 . W:'$D(ZTQUEUED) !,"Now sending query to ",$P(IBTFL(IBX),"^",2)," ..."
"RTN","IBARXMQ",37,0)
 . D QUERY^IBARXMU(DFN,IBDT,+IBTFL(IBX),.IBD)
"RTN","IBARXMQ",38,0)
 . I $P(IBD(0),"^")=-1!(-1=+IBD)!($P($G(IBD(1)),"^")=-1) S IBER=1 K IBD Q
"RTN","IBARXMQ",39,0)
 . S X=1 F  S X=$O(IBD(X)) Q:X<1  S IBD=$$ADD^IBARXMN(DFN,IBD(X))
"RTN","IBARXMQ",40,0)
 . K IBD
"RTN","IBARXMQ",41,0)
 ;
"RTN","IBARXMQ",42,0)
 ; stuff on local file w/remote stuff, build tmp
"RTN","IBARXMQ",43,0)
 S (IBC,IBX)=0 F  S IBX=$O(^IBAM(354.71,"AD",DFN,IBDT,IBX)) Q:IBX<1  S IBC=IBC+1,IBD=^IBAM(354.71,IBX,0),^TMP("IBARXM",$J,$P(IBD,"^",3),IBC)=IBD
"RTN","IBARXMQ",44,0)
 ;
"RTN","IBARXMQ",45,0)
 ;
"RTN","IBARXMQ",46,0)
PRINT ;
"RTN","IBARXMQ",47,0)
 U IO
"RTN","IBARXMQ",48,0)
 S (IBP,IBE,IBB,IBU)=0 D HEAD F  S IBE=$O(^TMP("IBARXM",$J,IBE)) Q:IBE<1!($D(DIRUT))  S IBX=0 F  S IBX=$O(^TMP("IBARXM",$J,IBE,IBX)) Q:IBX<1!($D(DIRUT))  D
"RTN","IBARXMQ",49,0)
 . D:$Y+3>IOSL HEAD Q:$D(DIRUT)
"RTN","IBARXMQ",50,0)
 . S IBD=^TMP("IBARXM",$J,IBE,IBX)
"RTN","IBARXMQ",51,0)
 . W !,$E($P($$FAC^IBARXMU($$LKUP^XUAF4($P(IBD,"-"))),"^"),1,20)," (",+IBD,")"
"RTN","IBARXMQ",52,0)
 . W ?28,$$FMTE^XLFDT(IBE,"2D")
"RTN","IBARXMQ",53,0)
 . W ?39,$P(IBD,"^",9)
"RTN","IBARXMQ",54,0)
 . W ?64,$J($P(IBD,"^",11),6,2)
"RTN","IBARXMQ",55,0)
 . W ?74,$J($P(IBD,"^",12),6,2)
"RTN","IBARXMQ",56,0)
 . S IBB=IBB+$P(IBD,"^",11),IBU=IBU+$P(IBD,"^",12)
"RTN","IBARXMQ",57,0)
 I $D(DIRUT) G Q
"RTN","IBARXMQ",58,0)
 W !!?62,"--------",?72,"--------"
"RTN","IBARXMQ",59,0)
 W !?65,$J(IBB,5,2),?75,$J(IBU,5,2)
"RTN","IBARXMQ",60,0)
 ;
"RTN","IBARXMQ",61,0)
 ; update totals in the patient's account
"RTN","IBARXMQ",62,0)
 X $S($D(IBER):"W !!,""Unable to perform all remote queries, totals will not be updated!""",IBT=0&($D(IBTFL)):"W !!,""No remote queries needed/performed, account not updated.""",1:"D ACCT^IBARXMN(DFN,IBB,IBU,IBDT,1)")
"RTN","IBARXMQ",63,0)
 ;
"RTN","IBARXMQ",64,0)
 I $E(IOST,1,2)="C-",'$D(DIRUT) N DIR,X,Y,DTOUT,DUOUT,DIROUT S DIR(0)="E" D ^DIR
"RTN","IBARXMQ",65,0)
 ;
"RTN","IBARXMQ",66,0)
Q K ^TMP("IBARXM",$J)
"RTN","IBARXMQ",67,0)
 D ^%ZISC
"RTN","IBARXMQ",68,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","IBARXMQ",69,0)
 Q
"RTN","IBARXMQ",70,0)
 ;
"RTN","IBARXMQ",71,0)
HEAD ; prints header info
"RTN","IBARXMQ",72,0)
 N DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","IBARXMQ",73,0)
 I IBP>0,$E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","IBARXMQ",74,0)
 S IBP=IBP+1
"RTN","IBARXMQ",75,0)
 W @IOF,!,"Medication Co-Pay Billing Summary",?IOM-10,"Page: ",IBP
"RTN","IBARXMQ",76,0)
 W !,"Patient: ",$P(IBPAT,"^")," (",$P(IBPAT,"^",2),")",!
"RTN","IBARXMQ",77,0)
 F X=0:1:IOM-1 W "-"
"RTN","IBARXMQ",78,0)
 W !,"Station                      Date      Brief Description        Billed   No Bill",! F X=0:1:IOM-1 W "-"
"RTN","IBARXMQ",79,0)
 Q
"RTN","IBCB")
0^1^B32932460
"RTN","IBCB",1,0)
IBCB ;ALB/MRL - BILLING BEGINNING POINT/SELECT BILL OR PATIENT ;01 JUN 88 12:00
"RTN","IBCB",2,0)
 ;;2.0;INTEGRATED BILLING;**52,80,106,51,137,161,199**;21-MAR-94
"RTN","IBCB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCB",4,0)
 ;
"RTN","IBCB",5,0)
 ;MAP TO DGCRB
"RTN","IBCB",6,0)
 ;
"RTN","IBCB",7,0)
EN ;
"RTN","IBCB",8,0)
 D HOME^%ZIS Q:'$D(IBAC)
"RTN","IBCB",9,0)
 ;***
"RTN","IBCB",10,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCB" D T1^%ZOSV ;stop rt clock
"RTN","IBCB",11,0)
 ;S XRTL=$ZU(0),XRTN="IBCB-"_$G(IBAC) D T0^%ZOSV ;start rt clock
"RTN","IBCB",12,0)
 ;
"RTN","IBCB",13,0)
 S:'$D(IBV) IBV=1 L  K ^UTILITY($J),DFN,IBIFN,DIC,IBPOPOUT S DIC(0)="EQMZ" R !!,"Enter BILL NUMBER or PATIENT NAME: ",IBX:DTIME I IBX["^"!(IBX="") S IBAC1=0 Q
"RTN","IBCB",14,0)
 K ^TMP("IBCRRX",$J)
"RTN","IBCB",15,0)
 S IBAC1=1
"RTN","IBCB",16,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCB",17,0)
 I IBX?1A4N!(IBX?2A.AP)!(IBX?2.A1",".AP)!(IBX?1A1P.AP) S DIC="^DPT(",X=IBX D ^DIC G EN:Y'>0 S DFN=+Y D HINQ S X=$S('$D(^DGCR(399,"C",DFN)):1,'$D(^DGCR(399,"AOP",DFN)):2,1:0)
"RTN","IBCB",18,0)
 I $D(DFN),X,IBAC<4 W !!,"No ",$S(X=1:"",1:"OPEN "),"billing records on file for this patient." D ASK I '$D(IBIFN) G EN
"RTN","IBCB",19,0)
 I $D(DFN) D  G EN
"RTN","IBCB",20,0)
 . D DATE:'$D(IBIFN),ASK:'$D(IBIFN)
"RTN","IBCB",21,0)
 . I $D(IBIFN) D ST
"RTN","IBCB",22,0)
 S DIC("S")=$S(IBAC'=4&(IBAC'=4.1):"I $P(^(0),U,13)<3 D EN^DDIOL($P(^(0),U))",1:"I $P(^(""S""),U,17)="""""_$S(IBAC=4.1:",$P(^(0),U,13)=3,+$$LAST364^IBCEF4(+Y),""PX""[$P($G(^IBA(364,+$$LAST364^IBCEF4(+Y),0)),U,3)",1:""))
"RTN","IBCB",23,0)
 S DIC="^DGCR(399,",X=IBX
"RTN","IBCB",24,0)
 D ^DIC G:Y'>0 EN S IBIFN=+Y,DFN=$P(Y(0),"^",2)
"RTN","IBCB",25,0)
 ;
"RTN","IBCB",26,0)
 D HINQ,ST G EN
"RTN","IBCB",27,0)
 G EN
"RTN","IBCB",28,0)
HINQ I $S('$D(^DPT(DFN,.361)):1,$P(^(.361),"^",1)'="V":1,1:0) W !?17,"*** ELIGIBILITY NOT VERIFIED ***" D HINQ1
"RTN","IBCB",29,0)
MT ;I $D(DFN) D ^DGMT1 K DGMTLL
"RTN","IBCB",30,0)
 I $D(DFN) D DIS^DGMTU(DFN)
"RTN","IBCB",31,0)
 Q
"RTN","IBCB",32,0)
HINQ1 I $P($G(^IBE(350.9,1,1)),"^",16) S X="DVBHQZ4" X ^%ZOSF("TEST") K X I $T W ! D EN^DVBHQZ4 Q
"RTN","IBCB",33,0)
 ;I $P($G(^IBE(350.9,1,1)),"^",16) F X="DVBHQZ4","DGHINQZ4" X ^%ZOSF("TEST") I $T S DGROUT=X K X W ! D @("EN^"_DGROUT) K DGROUT Q
"RTN","IBCB",34,0)
 K Y Q
"RTN","IBCB",35,0)
ASK I IBAC'=1 K IBIFN Q
"RTN","IBCB",36,0)
 W !!,"DO YOU WANT TO ESTABLISH A NEW BILLING RECORD FOR '",$P(^DPT(DFN,0),"^",1),"'" S %=2 D YN^DICN
"RTN","IBCB",37,0)
 I '% W !!?4,"YES - To establish a new billing record in the billing file.",!?4,"NO  - To discontinue this process immediately." G ASK
"RTN","IBCB",38,0)
 I %'=1 K IBIFN Q
"RTN","IBCB",39,0)
 K DA,Y,DINUM,IBIFN S (IBNEW,IBYN)=1 D ^IBCA Q
"RTN","IBCB",40,0)
DATE I $D(^DGCR(399,"C",DFN)) S DA="" F I=1:1 S DA=$O(^DGCR(399,"APDT",DFN,DA)) Q:DA=""  D DATE1
"RTN","IBCB",41,0)
 I IBAC=4,'$D(^UTILITY($J,"IB")) W !,"No ",$S($D(^DGCR(399,"C",DFN)):"UNCANCELLED ",1:""),"billing records on file for this patient." Q
"RTN","IBCB",42,0)
 S CT=0,CT1=1,IBT="" F J=1:1 S IBT=$O(^UTILITY($J,"IB",IBT)) Q:IBT=""  F J1=0:0 S J1=$O(^UTILITY($J,"IB",IBT,J1)) Q:J1=""  S X=J1 D SET
"RTN","IBCB",43,0)
CT W ! S G="",CT2=$S(CT<(CT1+4):CT,1:(CT1+4)) F K=CT1:1:CT2 I $D(^UTILITY($J,"UB",K)) D WRLINE
"RTN","IBCB",44,0)
 S X="" D WDATE Q:X["^"  I '$D(IB),$D(^UTILITY($J,"UB",K+1)) S CT1=K+1 G CT
"RTN","IBCB",45,0)
 K CT,CT1,CT2,K,^UTILITY($J,"UB") Q
"RTN","IBCB",46,0)
WRLINE N IBX S IBDATA=^UTILITY($J,"UB",K),IBX=$G(^DGCR(399,+$P(IBDATA,"^",2),0))
"RTN","IBCB",47,0)
 W !?2,K,?6 S Y=+IBDATA X ^DD("DD") W Y,?27,$P(IBX,"^",1),?35,$S($P(IBX,U,21)="S":"s",$P(IBX,U,21)="T":"t",1:""),?38,$P(IBDATA,"^",3),?59,$E($P(IBDATA,"^",4),1,10),?70,$E($P(IBDATA,"^",5),1,10)
"RTN","IBCB",48,0)
 Q
"RTN","IBCB",49,0)
DATE1 S IBT=$O(^DGCR(399,"APDT",DFN,DA,0)) I $D(^DGCR(399,+DA,0)),$S(IBAC<3:$P(^(0),U,13)<2,IBAC=3:$P(^(0),U,13)<3,'$D(^("S")):0,$P(^("S"),"^",17)]"":0,1:1) S ^UTILITY($J,"IB",IBT,DA)=""
"RTN","IBCB",50,0)
 Q
"RTN","IBCB",51,0)
WDATE Q:'CT  W !! W:K<CT "PRESS <RETURN> TO CONTINUE, OR",! W "CHOOSE 1",$S(CT=1:"",1:"-"_K),": " R X:DTIME Q:X["^"!(X="")  I X["?" W !!,"Select one of the above or <RETURN> to establish a new billing record." G WDATE
"RTN","IBCB",52,0)
 I $S('$D(^UTILITY($J,"UB",+X)):1,+X>K:1,+X<1:1,'(X?.N):1,1:0) W !!,"NOT A VALID CHOICE!!",*7 G WDATE
"RTN","IBCB",53,0)
 S IBIFN=$P(^UTILITY($J,"UB",X),"^",2),IB=1
"RTN","IBCB",54,0)
 Q
"RTN","IBCB",55,0)
 ;
"RTN","IBCB",56,0)
KEYOK(IBIFN,DUZ) ; Check if COB bill, does user have key
"RTN","IBCB",57,0)
 ; IBIFN = ien of bill (file 399)
"RTN","IBCB",58,0)
 ;
"RTN","IBCB",59,0)
 N IBCOB,IBOK,DIR,X,Y
"RTN","IBCB",60,0)
 S IBOK=1,IBCOB=$$COBN^IBCEF(IBIFN)
"RTN","IBCB",61,0)
 I IBCOB>1 D
"RTN","IBCB",62,0)
 . S IBCOB=$P("^SECONDARY^TERTIARY",U,IBCOB)
"RTN","IBCB",63,0)
 . S DIR(0)="YA",DIR("A",1)="YOU ARE ABOUT TO EDIT A "_IBCOB_" BILL",DIR("A")="ARE YOU SURE YOU WANT TO CONTINUE?: ",DIR("B")="NO" W ! D ^DIR K DIR W !
"RTN","IBCB",64,0)
 . I Y'=1 S IBOK=0
"RTN","IBCB",65,0)
 Q IBOK
"RTN","IBCB",66,0)
 ;
"RTN","IBCB",67,0)
SET I $S(IBV:1,$P(^DGCR(399,+X,0),"^",13):1,1:0) S CT=CT+1 D SET2
"RTN","IBCB",68,0)
 Q
"RTN","IBCB",69,0)
SET2 S IBND0=^DGCR(399,+X,0)
"RTN","IBCB",70,0)
 N IBFTP
"RTN","IBCB",71,0)
 S IBFTP=$S($$FT^IBCEF(+X)=3:"/UB92",$$FT^IBCEF(+X)=2:"/HCFA",1:"")
"RTN","IBCB",72,0)
 S ^UTILITY($J,"UB",CT)=9999999-IBT_"^"_+X_"^"_$P($G(^DGCR(399.3,+$P(IBND0,"^",7),0)),"^",4)_"-"_$$BCHGTYPE^IBCU(+X)_"^"_$P($P($P($P(^DD(399,.13,0),"^",3),$P(IBND0,"^",13)_":",2),";",1),"/",1)
"RTN","IBCB",73,0)
 S ^UTILITY($J,"UB",CT)=^UTILITY($J,"UB",CT)_"^"_$S($P(IBND0,U,27)=1:"INST"_IBFTP,$P(IBND0,U,27)=2:"PROF"_IBFTP,1:"")
"RTN","IBCB",74,0)
 Q
"RTN","IBCB",75,0)
ST ; Do not use the variable IBH when calling this entry point
"RTN","IBCB",76,0)
 L ^DGCR(399,IBIFN):5 I '$T W !,"No further processing of this record permitted at this time.",!,"Record locked by another user.  Try again later." Q
"RTN","IBCB",77,0)
 D RECALL^DILFD(399,IBIFN_",",DUZ)
"RTN","IBCB",78,0)
 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 Q
"RTN","IBCB",79,0)
 I IBAC'=1&(IBAC'=4.1) G ST2
"RTN","IBCB",80,0)
ST1 K ^UTILITY($J) S IBPOPOUT=0
"RTN","IBCB",81,0)
 ; Only allow view of bill waiting for MRA or pending extract
"RTN","IBCB",82,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=2 D  G Q
"RTN","IBCB",83,0)
 . W !,"This bill is requesting an MRA - can only view bill data"
"RTN","IBCB",84,0)
 . S IBV=1 D VIEW^IBCB2
"RTN","IBCB",85,0)
 I IBAC=4.1 D  G Q
"RTN","IBCB",86,0)
 . Q:$P($G(^DGCR(399,IBIFN,0)),U,13)'=3
"RTN","IBCB",87,0)
 . N Z
"RTN","IBCB",88,0)
 . S Z=$P($G(^IBA(364,+$$LAST364^IBCEF4(IBIFN),0)),U,3)
"RTN","IBCB",89,0)
 . I Z'="X"&(Z'="P") Q
"RTN","IBCB",90,0)
 . W !,"This bill has a transmit status of ",$$EXPAND^IBTRE(364,.03,Z)," - can only view bill data"
"RTN","IBCB",91,0)
 . S IBV=1 D VIEW^IBCB2
"RTN","IBCB",92,0)
 D ^IBCSCU,^IBCSC1 G Q:'$T!($G(IBPOPOUT))
"RTN","IBCB",93,0)
ST2 K IBTXPRT,IBPOPOUT
"RTN","IBCB",94,0)
 D ^IBCB1                 ; perform IB edits/authorize the bill
"RTN","IBCB",95,0)
 I $G(IBCIREDT) G ST1     ; Re-edit the bill
"RTN","IBCB",96,0)
 KILL IBCIREDT            ; clean up
"RTN","IBCB",97,0)
 QUIT
"RTN","IBCB",98,0)
 ;
"RTN","IBCB",99,0)
Q ;
"RTN","IBCB",100,0)
 K IBIFN,IBV,IBAC
"RTN","IBCB",101,0)
 ;***
"RTN","IBCB",102,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCB" D T1^%ZOSV ;stop rt clock
"RTN","IBCB",103,0)
 Q
"RTN","IBCB",104,0)
 ;
"RTN","IBCB",105,0)
EDI S IBAC=1,IBV=0 D EN G Q:'IBAC1,EDI
"RTN","IBCB",106,0)
REV G Q
"RTN","IBCB",107,0)
AUT S IBAC=3,IBV=0 D EN G Q:'IBAC1,AUT
"RTN","IBCB",108,0)
GEN S IBAC=4,IBV=1 D EN G Q:'IBAC1,GEN
"RTN","IBCB",109,0)
VIEW S IBAC=4.1,IBV=1 D EN G Q:'IBAC1,VIEW
"RTN","IBCB",110,0)
 Q
"RTN","IBCB",111,0)
 ;
"RTN","IBCC")
0^10^B20813790
"RTN","IBCC",1,0)
IBCC ;ALB/MJB - CANCEL UB-82 THIRD PARTY BILL ;14 JUN 88  10:12
"RTN","IBCC",2,0)
 ;;2.0;INTEGRATED BILLING;**2,19,77,80,51,142,137,161,199**;21-MAR-94
"RTN","IBCC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCC",4,0)
 ;
"RTN","IBCC",5,0)
 ;MAP TO DGCRC
"RTN","IBCC",6,0)
 ;
"RTN","IBCC",7,0)
 ;I '$D(IBCAN) W !!,?3,"***** BILLS MAY ONLY BE CANCELLED THROUGH 'CANCEL BILL' OPTION!! *****",!,?5,"***** PLEASE SEE YOUR SUPERVISOR IF YOU REQUIRE ASSISTANCE!! *****" Q
"RTN","IBCC",8,0)
 I '$D(IBCAN) S IBCAN=1
"RTN","IBCC",9,0)
ASK ;
"RTN","IBCC",10,0)
 ;***
"RTN","IBCC",11,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",12,0)
 ;S XRTL=$ZU(0),XRTN="IBCC-1" D T0^%ZOSV ;start rt clock
"RTN","IBCC",13,0)
 ;
"RTN","IBCC",14,0)
 ; If called at entry point PROCESS, variable IBNOASK will exist.
"RTN","IBCC",15,0)
 ; First time through, IBNOASK=1
"RTN","IBCC",16,0)
 ; Second time through, IBNOASK=2 and it will quit
"RTN","IBCC",17,0)
 I $G(IBNOASK)=2 G Q
"RTN","IBCC",18,0)
 I $G(IBNOASK)=1 S IBNOASK=2
"RTN","IBCC",19,0)
 ;
"RTN","IBCC",20,0)
 G Q:$G(IBCE("EDI"))
"RTN","IBCC",21,0)
 D Q
"RTN","IBCC",22,0)
 S IBQUIT=0
"RTN","IBCC",23,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCC",24,0)
 I '$G(IBNOASK) S DIC="^DGCR(399,",DIC(0)="AEMQZ",DIC("A")="Enter BILL NUMBER or Patient NAME: " W !! D ^DIC I Y<1 S IBQUIT=1 G Q1
"RTN","IBCC",25,0)
 K IB364
"RTN","IBCC",26,0)
NOPTF ; Note if IB364 is >0 it will be used as the ien to update in file 364
"RTN","IBCC",27,0)
 N DA,I
"RTN","IBCC",28,0)
 I '$G(IBNOASK) S IBIFN=+$G(Y)
"RTN","IBCC",29,0)
 I '$G(IBIFN) G ASK
"RTN","IBCC",30,0)
 I IBCAN>1 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 G ASK
"RTN","IBCC",31,0)
 ; Check if bill has been referred to Counsel
"RTN","IBCC",32,0)
 I $P($G(^PRCA(430,IBIFN,6)),U,4) D  G ASK
"RTN","IBCC",33,0)
 . W !,"This bill has been referred to Regional Counsel and cannot be 'CANCELLED' in"
"RTN","IBCC",34,0)
 . W !,"Integrated Billing.  Please use the option 'TP Referred Follow-up'"
"RTN","IBCC",35,0)
 . W !,"[PRCA RC ACTION MENU] in Accounts Receivable to request that Regional"
"RTN","IBCC",36,0)
 . W !,"Counsel return the bill to your facility."
"RTN","IBCC",37,0)
 F I=0,"S","U1" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCC",38,0)
 I IBCAN=2,IB("S")]"",+$P(IB("S"),U,16),$P(IB("S"),U,17)]"" D  G 1
"RTN","IBCC",39,0)
 . W !!,"This bill was cancelled on " S Y=$P(IB("S"),U,17) X ^DD("DD") W Y," by ",$S($P(IB("S"),U,18)']"":IBU,$D(^VA(200,$P(IB("S"),U,18),0)):$P(^(0),U,1),1:IBU),"."
"RTN","IBCC",40,0)
 . S IBQUIT=1
"RTN","IBCC",41,0)
 S IBSTAT=$P(IB(0),"^",13)
"RTN","IBCC",42,0)
 ; Notify if a payment has been posted to this bill before cancel
"RTN","IBCC",43,0)
 I $$TPR^PRCAFN(IBIFN) D
"RTN","IBCC",44,0)
 . W !!,"Please note a PAYMENT of **$"_$$TPR^PRCAFN(IBIFN)_"** has been POSTED to this bill."
"RTN","IBCC",45,0)
CHK S (IBCCCC,IBQUIT)=0 I '$G(IBCEAUTO) W !!,"ARE YOU SURE YOU WANT TO CANCEL THIS BILL" S %=2 D YN^DICN G:%=0 HELP I %'=1 S IBQUIT=1 G NO
"RTN","IBCC",46,0)
 ;W !!,"LAST CHANCE TO CHANGE YOUR MIND..." S DIE("NO^")="",DIE="^DGCR(399,",DA=IBIFN,DR="16;S:'X Y=0;19;S IBCCCC=1;" D ^DIE K DIE,DR
"RTN","IBCC",47,0)
 W:'$G(IBCEAUTO) !!,"LAST CHANCE TO CHANGE YOUR MIND..." S DIE("NO^")="",DIE="^DGCR(399,",DA=IBIFN,DR=$S($G(IBCEAUTO):"16////1;19////EDI/MRA TURNED OFF;S IBCCCC=1;",1:"16;S:'X Y=0;19;S IBCCCC=1;") D ^DIE K DIE,DR
"RTN","IBCC",48,0)
NO I 'IBCCCC W !!,"<NO ACTION TAKEN>",*7 S IBQUIT=1 G ASK:IBCAN<2,Q
"RTN","IBCC",49,0)
 W !!,"...Bill has been cancelled..." D BULL^IBCBULL,BSTAT^IBCDC(IBIFN),PRIOR^IBCCC2(IBIFN)
"RTN","IBCC",50,0)
 ;
"RTN","IBCC",51,0)
 ; cancelling in ingenix claimsmanager if ingenix is running
"RTN","IBCC",52,0)
 ; clean-up of variables is OK if not coming in from ListMan screen
"RTN","IBCC",53,0)
 I $$CM^IBCIUT1(IBIFN) S IBCISNT=4 D ST2^IBCIST I '$G(IBCICNCL) K IBCISNT,IBCISTAT,IBCIREDT,IBCIERR
"RTN","IBCC",54,0)
 ;
"RTN","IBCC",55,0)
 S IBEDI=$G(IB364)
"RTN","IBCC",56,0)
 I 'IBEDI S IBEDI=+$$LAST364^IBCEF4(IBIFN)
"RTN","IBCC",57,0)
 I IBEDI D UPDEDI^IBCEM(IBEDI,"C") ;Update EDI files, if needed
"RTN","IBCC",58,0)
 ;
"RTN","IBCC",59,0)
 F I="S","U1" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCC",60,0)
 S PRCASV("ARREC")=IBIFN,PRCASV("AMT")=$S(IB("U1")']"":0,1:$P(IB("U1"),"^")),PRCASV("DATE")=$P(IB("S"),"^",17),PRCASV("BY")=$P(IB("S"),"^",18)
"RTN","IBCC",61,0)
 S PRCASV("COMMENT")=$S($P(IB("S"),U,19)]"":$P(IB("S"),U,19),$P(^IBE(350.9,1,2),"^",7)]"":$P(^(2),"^",7),1:"BILL CANCELLED IN MAS")
"RTN","IBCC",62,0)
 S PRCASV("BY")=$S($P(IB("S"),U,18)]"":$P(IB("S"),U,18),1:"")
"RTN","IBCC",63,0)
 S X=$$CANCEL^RCBEIB($G(PRCASV("ARREC")),$G(PRCASV("DATE")),$G(PRCASV("BY")),$G(PRCASV("AMT")),$G(PRCASV("COMMENT")))
"RTN","IBCC",64,0)
 W !,$S(X:">> The receivable associated with the claim was cancelled.",1:">> The receivable associated with the claim was not cancelled.")
"RTN","IBCC",65,0)
 I $P(X,U,2)]"" W !,">>> ",$P(X,U,2) ; The reason why the claim can not be cancelled.
"RTN","IBCC",66,0)
 I IBCAN<2 D RNB^IBCC1 ;assign a reason not billable
"RTN","IBCC",67,0)
 G ASK:IBCAN<2,Q
"RTN","IBCC",68,0)
 ;
"RTN","IBCC",69,0)
HELP W !,?3,"Answer 'YES' or 'Y' if you wish to cancel this bill.",!,?3,"Answer 'NO' or 'N' if you want to abort." G CHK
"RTN","IBCC",70,0)
 Q
"RTN","IBCC",71,0)
1 I $P(IB(0),U,13)=1 W !,"This record was re-opened on " S Y=$P(IB(0),U,14) X ^DD("DD") W Y,"." G CHK
"RTN","IBCC",72,0)
 G ASK
"RTN","IBCC",73,0)
Q1 K:IBCAN=1 IBQUIT K IBCAN
"RTN","IBCC",74,0)
Q K %,IBEPAR,IBSTAT,IBARST,IBAC1,IB,DFN,IBX,IBZ,DIC,DIE,DR,PRCASV,PRCASVC,X,Y,IBEDI
"RTN","IBCC",75,0)
 ;***
"RTN","IBCC",76,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",77,0)
 Q
"RTN","IBCC",78,0)
 ;
"RTN","IBCC",79,0)
PROCESS(IBIFN,IBCAN) ;
"RTN","IBCC",80,0)
 ; Entry point when the bill number is already known.  Use this when
"RTN","IBCC",81,0)
 ; you just want to try to cancel this bill and this bill only.
"RTN","IBCC",82,0)
 ; Input:
"RTN","IBCC",83,0)
 ;   IBIFN - Internal bill# (Required)
"RTN","IBCC",84,0)
 ;   IBCAN - Cancel Flag (optional, defaults to 1 if not included)
"RTN","IBCC",85,0)
 ;
"RTN","IBCC",86,0)
 NEW IBNOASK
"RTN","IBCC",87,0)
 S IBNOASK=1
"RTN","IBCC",88,0)
 S IBCAN=$G(IBCAN,1)
"RTN","IBCC",89,0)
 G ASK
"RTN","IBCC",90,0)
 ;
"RTN","IBCC",91,0)
 ;IBCC
"RTN","IBCEM03")
0^11^B35541607
"RTN","IBCEM03",1,0)
IBCEM03 ;ALB/TMP - 837 EDI RESUBMIT INDIVIDUAL BILL PROCESSING ;17-SEP-96
"RTN","IBCEM03",2,0)
 ;;2.0;INTEGRATED BILLING;**137,199**;21-MAR-94
"RTN","IBCEM03",3,0)
 Q
"RTN","IBCEM03",4,0)
 ;
"RTN","IBCEM03",5,0)
BILL2 ; Resubmit a transmitted bill with a new batch #
"RTN","IBCEM03",6,0)
 N DIC,DIR,DIE,DA,DR,IB,IB0,IBDA,IBDA1,IBE,IBSTAT,IBBDA,IBOK,IBNEW,Y,ZTSK
"RTN","IBCEM03",7,0)
 ;
"RTN","IBCEM03",8,0)
ASK N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCEM03",9,0)
 S DIC="^DGCR(399,",DIC(0)="AEMQ",DIC("S")="I $P($G(^(""TX"")),U,2),$P($G(^(0)),U,13)'="""",""234""[$P($G(^(0)),U,13)" D ^DIC Q:Y<0  ;Only auth or printed transmittable bill is a valid selection
"RTN","IBCEM03",10,0)
 ;
"RTN","IBCEM03",11,0)
 S IBIFN=+Y,IBDA=+$$LAST364^IBCEF4(IBIFN),IB0=$G(^IBA(364,IBDA,0)),IBSTAT=$P(IB0,U,3)
"RTN","IBCEM03",12,0)
 ;
"RTN","IBCEM03",13,0)
 I IB0="" W !,"Bill does not exist in BILL TRANSMISSION file" G ASK
"RTN","IBCEM03",14,0)
 ;
"RTN","IBCEM03",15,0)
 I IBSTAT="X" W !,"Bill is currently awaiting extract - will be submitted with next batch run" G ASK
"RTN","IBCEM03",16,0)
 S IBBDA=+$P(IB0,U,2),IB=$P($G(^IBA(364.1,IBBDA,0)),U,9)
"RTN","IBCEM03",17,0)
 ;
"RTN","IBCEM03",18,0)
 I IB D  G:'IBOK ASK
"RTN","IBCEM03",19,0)
 . S IBOK=1,ZTSK=IB D STAT^%ZTLOAD
"RTN","IBCEM03",20,0)
 . I ZTSK(0)=0 S DIE="^IBA(364.1,",DA=IBBDA,DR=".09///@" D ^DIE Q  ;Task not scheduled - delete task #
"RTN","IBCEM03",21,0)
 . I "125"[ZTSK(1) W *7,!,"Cannot resubmit this bill.",!,"This bill's current batch is already ",$S("2"[ZTSK(1):"being resubmitted",1:"scheduled for resubmission")," - Task # is: ",IB,! S IBOK=0
"RTN","IBCEM03",22,0)
 ;
"RTN","IBCEM03",23,0)
 W !
"RTN","IBCEM03",24,0)
 S DIR("A",1)="   Previously In Batch #: "_$$EXPAND^IBTRE(364,.02,$P(IB0,U,2))
"RTN","IBCEM03",25,0)
 S DIR("A",2)="Bill Transmission Status: "_$$EXPAND^IBTRE(364,.03,IBSTAT)
"RTN","IBCEM03",26,0)
 S DIR("A",3)="             Status Date: "_$$FMTE^XLFDT($P(IB0,U,4),2)
"RTN","IBCEM03",27,0)
 S DIR("A",5)=" "
"RTN","IBCEM03",28,0)
 S DIR("A",4)="     Current Bill Status: "_$$EXPAND^IBTRE(399,.13,$P($G(^DGCR(399,+IBIFN,0)),U,13))
"RTN","IBCEM03",29,0)
 I IBSTAT'="P" S DIR("A",11)="WARNING - BILL TRANSMITTED PREVIOUSLY" S:IBSTAT?1"A".E DIR("A",11)=DIR("A",11)_" & CONFIRMED AS RECEIVED BY "_$P("AUSTIN^GENTRAN^INTERMEDIARY^CARRIER",U,$TR(IBSTAT,"A")+1)
"RTN","IBCEM03",30,0)
 S DIR("A")="ARE YOU SURE YOU WANT TO RESUBMIT THIS BILL?: "
"RTN","IBCEM03",31,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","IBCEM03",32,0)
 D ^DIR K DIR
"RTN","IBCEM03",33,0)
 ;
"RTN","IBCEM03",34,0)
 W ! G:'Y ASK
"RTN","IBCEM03",35,0)
 ;
"RTN","IBCEM03",36,0)
 S IBDA1=+$$ADDTBILL^IBCB1(IBIFN) ;Add a new transmit bill record
"RTN","IBCEM03",37,0)
 ;
"RTN","IBCEM03",38,0)
 S Y=$$TX1^IBCB1(IBDA1,1)
"RTN","IBCEM03",39,0)
 ;
"RTN","IBCEM03",40,0)
 I 'Y D  G ASK
"RTN","IBCEM03",41,0)
 . W !,*7,"An error has occurred ... bill NOT re-submitted!!"
"RTN","IBCEM03",42,0)
 . S DIK="^IBA(364,",DA=IBDA1 D:DA ^DIK
"RTN","IBCEM03",43,0)
 . L -^IBA(364,IBDA)
"RTN","IBCEM03",44,0)
 ;
"RTN","IBCEM03",45,0)
 S IBNEW=$P($G(^IBA(364,+IBDA1,0)),U,2)
"RTN","IBCEM03",46,0)
 ;
"RTN","IBCEM03",47,0)
 ;Update the old transmit bill record
"RTN","IBCEM03",48,0)
 D UPDEDI^IBCEM(IBDA,"R")
"RTN","IBCEM03",49,0)
 ;
"RTN","IBCEM03",50,0)
 W !,"Bill # ",$P($G(^DGCR(399,+IB0,0)),U)," was re-submitted in batch # ",$P($G(^IBA(364.1,+IBNEW,0)),U)
"RTN","IBCEM03",51,0)
 ;
"RTN","IBCEM03",52,0)
 L -^IBA(364,IBDA)
"RTN","IBCEM03",53,0)
 G ASK
"RTN","IBCEM03",54,0)
 ;
"RTN","IBCEM03",55,0)
PRINT1(IBIFN,IBDA,IB364,IBRESUB) ; Print bill, submit manually as resolution
"RTN","IBCEM03",56,0)
 ; for a returned message
"RTN","IBCEM03",57,0)
 ; IBIFN = ien of bill in file 399
"RTN","IBCEM03",58,0)
 ; IBDA = array returned from selection of message
"RTN","IBCEM03",59,0)
 ; IB364 = ien of transmit bill entry in file 364
"RTN","IBCEM03",60,0)
 ; IBRESUB = flag to indicate if bill is being resubmitted via print
"RTN","IBCEM03",61,0)
 ;
"RTN","IBCEM03",62,0)
 N IBAC,IBV,IB399,DFN,ZTSK,PRCASV,IBHOLD,IBTXPRT
"RTN","IBCEM03",63,0)
 W !
"RTN","IBCEM03",64,0)
 I IBIFN="" S IBDA="" G PRINT1Q
"RTN","IBCEM03",65,0)
 S IB399=$G(^DGCR(399,IBIFN,0))
"RTN","IBCEM03",66,0)
 I "34"'[$P(IB399,U,13) W !,*7,"Bill status must be AUTHORIZED or PRNT/TX to print the bill" S IBDA="" G PRINT1Q
"RTN","IBCEM03",67,0)
 ;
"RTN","IBCEM03",68,0)
 I $P($G(^DGCR(399,IBIFN,"S")),U,14)=DT W !,*7,"This bill was last printed today.  You must wait at least 1 day from the last",!,"print date to print this bill using this function." S IBDA="" D PAUSE^VALM1 G PRINT1Q
"RTN","IBCEM03",69,0)
 ;
"RTN","IBCEM03",70,0)
 S IBV=1,IBAC=4,DFN=$P(IB399,U,2),IBTXPRT=0
"RTN","IBCEM03",71,0)
 M IBHOLD("IBDA")=IBDA
"RTN","IBCEM03",72,0)
 D 4^IBCB1,ENS^%ZISS
"RTN","IBCEM03",73,0)
 M IBDA=IBHOLD("IBDA")
"RTN","IBCEM03",74,0)
 ;
"RTN","IBCEM03",75,0)
 I 'IBTXPRT W !,"Bill was not printed" S IBDA="" G PRINT1Q
"RTN","IBCEM03",76,0)
 ;
"RTN","IBCEM03",77,0)
 D UPDEDI^IBCEM(IB364,"P")
"RTN","IBCEM03",78,0)
 ;
"RTN","IBCEM03",79,0)
PRINT1Q Q
"RTN","IBCEM03",80,0)
 ;
"RTN","IBCEM03",81,0)
SUB1 ; Select bills in ready for extract status to transmit individually
"RTN","IBCEM03",82,0)
 N IB0,IB399,IBDA,IBIFN,IBSEL,IBU,X,Y,DA,DIC,Z,DIR
"RTN","IBCEM03",83,0)
 K ^TMP("IBSELX",$J)
"RTN","IBCEM03",84,0)
 ;
"RTN","IBCEM03",85,0)
 S IBSEL=""
"RTN","IBCEM03",86,0)
 F  D  Q:'IBSEL
"RTN","IBCEM03",87,0)
 . S DIR("S")="I $P(^(0),U,3)=""X"""
"RTN","IBCEM03",88,0)
 . S DIR(0)="PAO^364:AEMQ",DIR("A")="SELECT "_$S($D(^TMP("IBSELX",$J)):"NEXT ",1:"")_"BILL TO TRANSMIT: "
"RTN","IBCEM03",89,0)
 . S DIR("?")="ONLY BILLS IN 'READY FOR EXTRACT' STATUS CAN BE TRANSMITTED WITH THIS OPTION"
"RTN","IBCEM03",90,0)
 . D ^DIR K DIR
"RTN","IBCEM03",91,0)
 . I Y'>0 K:Y=U ^TMP("IBSELX",$J) S IBSEL="" Q
"RTN","IBCEM03",92,0)
 . S IBSEL=+Y
"RTN","IBCEM03",93,0)
 . S IBDA=+Y,IB0=$G(^IBA(364,IBDA,0)),IBIFN=+IB0,IBU=$G(^DGCR(399,IBIFN,"U")),IB399=$G(^(0))
"RTN","IBCEM03",94,0)
 . S Z=+$$NEEDMRA^IBEFUNC(IBIFN)
"RTN","IBCEM03",95,0)
 . I '$$TXMT^IBCEF4(IBIFN,.IBNOTX),IBNOTX=2 D  Q
"RTN","IBCEM03",96,0)
 .. W !,$S(Z:"MRA",1:"EDI")_" TRANSMISSION PARAMETER HAS BEEN TURNED OFF",!!,"BILL CANNOT BE SELECTED"
"RTN","IBCEM03",97,0)
 . ;
"RTN","IBCEM03",98,0)
 . W !
"RTN","IBCEM03",99,0)
 . S DIR("A",1)="      YOU HAVE SELECTED BILL #: "_$P(IB399,U)_"  ("_$S($$INPAT^IBCEF(IBIFN):"INPATIENT",1:"OUTPATIENT")_"/"_$S($$FT^IBCEF(IBIFN)=3:"UB92",1:"HCFA 1500")_" FORMAT)"
"RTN","IBCEM03",100,0)
 . S DIR("A",2)="                  PATIENT NAME: "_$E($P($G(^DPT(+$P(IB399,U,2),0)),U)_$J("",28),1,28)_"  SSN: "_$P($G(^DPT(+$P(IB399,U,2),0)),U,9)
"RTN","IBCEM03",101,0)
 . S DIR("A",3)="                  CARE DATE(S): "_$$EXPAND^IBTRE(399,151,$P(IBU,U))_" - "_$$EXPAND^IBTRE(399,152,$P(IBU,U,2))
"RTN","IBCEM03",102,0)
 . S DIR("A",4)="'READY TO EXTRACT' STATUS DATE: "_$$EXPAND^IBTRE(364,.04,$P(IB0,U,4))
"RTN","IBCEM03",103,0)
 . S DIR("?",1)=" "
"RTN","IBCEM03",104,0)
 . S DIR("A",5)=" ",DIR("?")="IF THIS IS THE BILL YOU WANT TO TRANSMIT, RESPOND YES, OTHERWISE, RESPOND NO"
"RTN","IBCEM03",105,0)
 . S DIR("A")="ARE YOU SURE THIS IS THE CORRECT BILL TO TRANSMIT?: "
"RTN","IBCEM03",106,0)
 . S DIR(0)="YAO",DIR("B")="NO" D ^DIR K DIR W !
"RTN","IBCEM03",107,0)
 . I Y'=1 W !,"BILL NOT SELECTED" Q
"RTN","IBCEM03",108,0)
 . ;
"RTN","IBCEM03",109,0)
 . S ^TMP("IBSELX",$J,IBDA)=""
"RTN","IBCEM03",110,0)
 ;
"RTN","IBCEM03",111,0)
 I '$O(^TMP("IBSELX",$J,0)) G SUB1Q
"RTN","IBCEM03",112,0)
 ;
"RTN","IBCEM03",113,0)
 W !,"Bills to be transmitted: "
"RTN","IBCEM03",114,0)
 S Z=0 F  S Z=$O(^TMP("IBSELX",$J,Z)) Q:'Z  W !,?8,$P($G(^DGCR(399,+$G(^IBA(364,Z,0)),0)),U)
"RTN","IBCEM03",115,0)
 W !
"RTN","IBCEM03",116,0)
 S DIR("A")="OK TO TRANSMIT NOW?: ",DIR(0)="YA0",DIR("B")="NO" D ^DIR K DIR
"RTN","IBCEM03",117,0)
 G:Y'=1 SUB1Q
"RTN","IBCEM03",118,0)
 W !
"RTN","IBCEM03",119,0)
 S ^TMP("IBSELX",$J)=0
"RTN","IBCEM03",120,0)
 D ONE^IBCE837
"RTN","IBCEM03",121,0)
 W !,"BILL(s) TRANSMITTED ... BATCH #(s): "
"RTN","IBCEM03",122,0)
 S Z=0 F  S Z=$O(^TMP("IBCE-BATCH",$J,Z)) Q:'Z  W Z,$S($O(^(Z)):", ",1:"")
"RTN","IBCEM03",123,0)
 I '$O(^TMP("IBCE-BATCH",$J,0)) W !,"NO BILL(S) TRANSMITTED - CHECK ALERTS/MAIL FOR DETAILS"
"RTN","IBCEM03",124,0)
 ;
"RTN","IBCEM03",125,0)
SUB1Q D PAUSE^VALM1
"RTN","IBCEM03",126,0)
 K ^TMP("IBSELX",$J),^TMP("IBCE-BATCH",$J)
"RTN","IBCEM03",127,0)
 Q
"RTN","IBCEM03",128,0)
 ;
"RTN","IBCF4")
0^13^B18794540
"RTN","IBCF4",1,0)
IBCF4 ;ALB/ARH - PRINT BILL ADDENDUM ;12-JAN-94
"RTN","IBCF4",2,0)
 ;;2.0;INTEGRATED BILLING;**52,137,199**;21-MAR-94
"RTN","IBCF4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCF4",4,0)
 ;
"RTN","IBCF4",5,0)
PRXA ;get bill number then print rx refill addendums for bills
"RTN","IBCF4",6,0)
 S DIC("S")="I $D(^IBA(362.4,""AIFN""_+Y))!($D(^IBA(362.5,""AIFN""_+Y)))"
"RTN","IBCF4",7,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCF4",8,0)
 S DIC="^DGCR(399,",DIC(0)="AEMQ" D ^DIC K DIC G:+Y'>0 EXIT S IBBILL=$P(Y,U,2),IBIFN=+Y
"RTN","IBCF4",9,0)
 ;
"RTN","IBCF4",10,0)
 I $D(^IBA(364,"ABDT",IBIFN)),+$$TXMT^IBCEF4(IBIFN)=1 D  G:'IBTXOK PRXA
"RTN","IBCF4",11,0)
 .S IBTXOK=0
"RTN","IBCF4",12,0)
 .N IBLDT,IBX
"RTN","IBCF4",13,0)
 .S IBLDT=$O(^IBA(364,"ABDT",IBIFN,""),-1),IBX=$O(^IBA(364,"B",IBIFN,+IBLDT,""),-1)
"RTN","IBCF4",14,0)
 .I "X"[$P($G(^IBA(364,+IBX,0)),U,3) W !!,*7,"Transmittable Bill can NOT be printed until transmitted" Q
"RTN","IBCF4",15,0)
 .W !!,"This is a Transmittable Bill that has already been transmitted"
"RTN","IBCF4",16,0)
 .W !!,"WANT TO PRINT THIS BILL ADDENDUM ANYWAY" S %=2 D YN^DICN
"RTN","IBCF4",17,0)
 .Q:'(%+1#3)  ;-1 or 2
"RTN","IBCF4",18,0)
 .S IBTXOK=1
"RTN","IBCF4",19,0)
 ;
"RTN","IBCF4",20,0)
DEV ;get the device
"RTN","IBCF4",21,0)
 W !!,"Report requires 132 columns."
"RTN","IBCF4",22,0)
 S %ZIS="QM",%ZIS("A")="OUTPUT DEVICE: " D ^%ZIS G:POP EXIT
"RTN","IBCF4",23,0)
 I $D(IO("Q")) S ZTRTN="EN^IBCF4",ZTDESC="BILL ADDENDUM FOR "_IBBILL,ZTSAVE("IB*")="" D ^%ZTLOAD K IO("Q"),ZTSK G EXIT
"RTN","IBCF4",24,0)
 U IO D EN
"RTN","IBCF4",25,0)
 ;
"RTN","IBCF4",26,0)
EXIT ;clean up and quit
"RTN","IBCF4",27,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBCF4",28,0)
 K IBQUIT,IBIFN,IBBILL,IBTXOK,X,Y,DTOUT,DUOUT,DIRUT,DIROUT D ^%ZISC
"RTN","IBCF4",29,0)
 Q
"RTN","IBCF4",30,0)
 ;
"RTN","IBCF4",31,0)
EN ;ENTRY POINT IF QUEUED, print all rx refills for a bill
"RTN","IBCF4",32,0)
 S IBY=$G(^DGCR(399,+IBIFN,0)) Q:IBY=""  S IBXREF="AIFN"_IBIFN
"RTN","IBCF4",33,0)
 S (IBQUIT,IBPGN,IBRX)=0,IBHDR="BILL ADDENDUM FOR "_$P($G(^DPT(+$P(IBY,U,2),0)),U,1)_" - "_$P(IBY,U,1) D HDR
"RTN","IBCF4",34,0)
RX I '$D(^IBA(362.4,IBXREF)) G PROS
"RTN","IBCF4",35,0)
 W !!,"PRESCRIPTION REFILLS:",!
"RTN","IBCF4",36,0)
 K IBRC
"RTN","IBCF4",37,0)
 D RCITEM^IBCSC5A(IBIFN,"IBRC",3)
"RTN","IBCF4",38,0)
 S IBRX=0 F  S IBRX=$O(^IBA(362.4,IBXREF,IBRX)) Q:IBRX=""!IBQUIT  S IBRIFN=0 F  S IBRIFN=$O(^IBA(362.4,IBXREF,IBRX,IBRIFN)) Q:'IBRIFN!IBQUIT  D
"RTN","IBCF4",39,0)
 .S IBY=$G(^IBA(362.4,IBRIFN,0)) Q:IBY=""
"RTN","IBCF4",40,0)
 .S IBYC=$$CHG(IBRIFN,3,.IBRC)
"RTN","IBCF4",41,0)
 .;
"RTN","IBCF4",42,0)
 . W !,$P(IBY,U,1),?13,$$FMTE^XLFDT(+$P(IBY,U,3),2),?22,$J($S(IBYC:"$"_$FN(IBYC,",",2),1:""),10),?34,$P($G(^PSDRUG(+$P(IBY,U,4),0)),U,1)
"RTN","IBCF4",43,0)
 . I $P(IBY,U,6)'="" W ?77,"QTY: ",$P(IBY,U,7)
"RTN","IBCF4",44,0)
 . I $P(IBY,U,7)'="" W ?87,"DAYS SUPPLY: ",$P(IBY,U,6)
"RTN","IBCF4",45,0)
 . I $P(IBY,U,8)'="" W ?105,"NDC #: ",$P(IBY,U,8)
"RTN","IBCF4",46,0)
 . S IBLN=IBLN+1 I IBLN>(IOSL-7) D PAUSE,HDR
"RTN","IBCF4",47,0)
 K IBRC
"RTN","IBCF4",48,0)
 ;
"RTN","IBCF4",49,0)
PROS I '$D(^IBA(362.5,IBXREF)) G END
"RTN","IBCF4",50,0)
 W !!!,"PROSTHETIC ITEMS:",!
"RTN","IBCF4",51,0)
 K IBRC
"RTN","IBCF4",52,0)
 D RCITEM^IBCSC5A(IBIFN,"IBRC",5)
"RTN","IBCF4",53,0)
 S IBPI=0 F  S IBPI=$O(^IBA(362.5,IBXREF,IBPI)) Q:IBPI=""!IBQUIT  S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.5,IBXREF,IBPI,IBPIFN)) Q:'IBPIFN!IBQUIT  D
"RTN","IBCF4",54,0)
 . S IBY=$G(^IBA(362.5,IBPIFN,0)),IBYC="" Q:IBY=""
"RTN","IBCF4",55,0)
 . S IBYC=$$CHG(IBPIFN,5,.IBRC)
"RTN","IBCF4",56,0)
 . W !,$$FMTE^XLFDT(+$P(IBY,U,1),2),?11,$J($S(IBYC:"$"_$FN(IBYC,",",2),1:""),10),?24,$P($$PIN^IBCSC5B(+$P(IBY,U,3)),U,2)
"RTN","IBCF4",57,0)
 . S IBLN=IBLN+1 I IBLN>(IOSL-7) D PAUSE,HDR
"RTN","IBCF4",58,0)
 D:'IBQUIT PAUSE
"RTN","IBCF4",59,0)
END K IBX,IBY,IBPGN,IBRX,IBHDR,IBRIFN,IBLN,IBCDT,IBI,IBXREF,IBPI,IBPIFN,IBRC,IBYC
"RTN","IBCF4",60,0)
 Q
"RTN","IBCF4",61,0)
 ;
"RTN","IBCF4",62,0)
CHG(IBY,IBTYP,IBRC) ; Return charge for item entry IBY or null if no charge
"RTN","IBCF4",63,0)
 ; IBRC = the array containing the revenue code items and their units and charges
"RTN","IBCF4",64,0)
 ; IBTYP = the type of item being priced
"RTN","IBCF4",65,0)
 N IBZ,IBYC
"RTN","IBCF4",66,0)
 S IBRC=$S($D(IBRC(IBTYP,IBY)):IBY,1:0),IBYC=""
"RTN","IBCF4",67,0)
 F IBRC=IBRC,0 Q:'$D(IBRC(IBTYP,IBRC))  S IBZ="" D  Q:IBZ'=""!(IBRC=0)
"RTN","IBCF4",68,0)
 .F  S IBZ=$O(IBRC(IBTYP,IBRC,IBZ)) Q:IBZ=""  I IBRC(IBTYP,IBRC,IBZ) S $P(IBRC(IBTYP,IBRC,IBZ),U)=IBRC(IBTYP,IBRC,IBZ)-1,IBYC=$P(IBRC(IBTYP,IBRC,IBZ),U,2) K:'IBRC(IBTYP,IBRC,IBZ) IBRC(IBTYP,IBRC,IBZ) Q
"RTN","IBCF4",69,0)
 Q IBYC
"RTN","IBCF4",70,0)
 ;
"RTN","IBCF4",71,0)
HDR ;print the report header
"RTN","IBCF4",72,0)
 S IBQUIT=$$STOP Q:IBQUIT  S IBPGN=IBPGN+1,IBLN=5
"RTN","IBCF4",73,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S IBCDT=$P(Y,"@",1)_"  "_$P(Y,"@",2)
"RTN","IBCF4",74,0)
 I IBPGN>1!($E(IOST,1,2)["C-") W @IOF
"RTN","IBCF4",75,0)
 W IBHDR W:IOM<85 ! W ?(IOM-30),IBCDT,?(IOM-8),"PAGE ",IBPGN,!
"RTN","IBCF4",76,0)
 ;W !,"RX #",?13,"REFILL DATE",?28,"DRUG",?70,"DAYS SUPPLY",?83,"QTY",?90,"NDC #",!
"RTN","IBCF4",77,0)
 F IBI=1:1:IOM W "-"
"RTN","IBCF4",78,0)
 W !
"RTN","IBCF4",79,0)
 Q
"RTN","IBCF4",80,0)
 ;
"RTN","IBCF4",81,0)
PAUSE ;pause at end of screen if being displayed on a terminal
"RTN","IBCF4",82,0)
 Q:$E(IOST,1,2)'["C-"
"RTN","IBCF4",83,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","IBCF4",84,0)
 I $D(DUOUT)!($D(DIRUT)) S IBQUIT=1
"RTN","IBCF4",85,0)
 Q
"RTN","IBCF4",86,0)
 ;
"RTN","IBCF4",87,0)
STOP() ;determine if user has requested the queued report to stop
"RTN","IBCF4",88,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ I +$G(IBPGN) W !,"***TASK STOPPED BY USER***"
"RTN","IBCF4",89,0)
 Q +$G(ZTSTOP)
"RTN","IBCF4",90,0)
 ;
"RTN","IBCF4",91,0)
RXDISP ;displays all rx refills bills
"RTN","IBCF4",92,0)
 ;N IBX,IBY,IBZ,IBC,X,Y S Y=1,IBC=0,IBX="AIFN"
"RTN","IBCF4",93,0)
 ;F  S IBX=$O(^IBA(362.4,IBX)) Q:IBX=""  S IBY=$E(IBX,5,999),IBZ=$G(^DGCR(399,+IBY,0)) I IBZ'="" D  Q:'Y
"RTN","IBCF4",94,0)
 ;. W !,$P(IBZ,U,1),?10,$E($P($G(^DPT(+$P(IBZ,U,2),0)),U,1),1,20),?32,$$DATE(+$P(IBZ,U,3)),?42,$S(+$P(IBZ,U,5)<3:"INPT",1:"OUTPT")
"RTN","IBCF4",95,0)
 ;. W ?49,$P($G(^DGCR(399.3,+$P(IBZ,U,7),0)),U,4),?59,$E($$EXSET^IBEFUNC(+$P(IBZ,U,13),399,.13),1,7),?68,$E($P($G(^IBE(353,+$P(IBZ,U,19),0)),U,1),1,11)
"RTN","IBCF4",96,0)
 ;. S IBC=IBC+1 I '(IBC#10) S DIR(0)="E" D ^DIR K DIR
"RTN","IBCF4",97,0)
 ;Q
"RTN","IBCF4",98,0)
 ;
"RTN","IBCF4",99,0)
DATE(X) Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCF4",100,0)
 ;
"RTN","IBCF4",101,0)
BILLAD(IFN) ;returns true if bill has either rx refills or prosthetics so addendum should print
"RTN","IBCF4",102,0)
 N IBX S IBX=0,IFN=+$G(IFN) S:+$O(^IBA(362.4,"AIFN"_IFN,0)) IBX=1 S:+$O(^IBA(362.5,"AIFN"_IFN,0)) IBX=IBX+2
"RTN","IBCF4",103,0)
 Q IBX
"RTN","IBCNQ1")
0^14^B12394029
"RTN","IBCNQ1",1,0)
IBCNQ1 ;ALB/CPM - OUTPATIENT VISIT DATE INQUIRY ; 31-JUL-91
"RTN","IBCNQ1",2,0)
 ;;2.0; INTEGRATED BILLING ;**199**; 21-MAR-94
"RTN","IBCNQ1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNQ1",4,0)
 ;
"RTN","IBCNQ1",5,0)
 ;MAP TO DGCRNQ1
"RTN","IBCNQ1",6,0)
 ;
"RTN","IBCNQ1",7,0)
 D HOME^%ZIS
"RTN","IBCNQ1",8,0)
ASKPAT ;
"RTN","IBCNQ1",9,0)
 ;***
"RTN","IBCNQ1",10,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCNQ1" D T1^%ZOSV ;stop rt clock
"RTN","IBCNQ1",11,0)
 ;S XRTL=$ZU(0),XRTN="IBCNQ1-1" D T0^%ZOSV ;start rt clock
"RTN","IBCNQ1",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCNQ1",13,0)
 D END S DIC="^DPT(",DIC(0)="AEMQZ" W ! D ^DIC K DIC G:+Y<1 END
"RTN","IBCNQ1",14,0)
 S DFN=+Y I '$O(^DGCR(399,"AOPV",DFN,"")) W !!,"This patient has no bills with OP visits.  Please enter another patient." G ASKPAT
"RTN","IBCNQ1",15,0)
 ;
"RTN","IBCNQ1",16,0)
 S IBQUIT=0,IBAC=78
"RTN","IBCNQ1",17,0)
ASKDAT S DIR("A")="Select OP Visit Date",DIR(0)="DO^::EX^K:'$D(^DGCR(399,""AOPV"",DFN,Y)) X"
"RTN","IBCNQ1",18,0)
 S DIR("?",1)="Please enter a valid Outpatient Visit date for this patient.",DIR("?")="Enter '??' to list valid dates and bill numbers.",DIR("??")="^D HELP^IBCNQ1"
"RTN","IBCNQ1",19,0)
 D ^DIR K DIR G:Y<1 END
"RTN","IBCNQ1",20,0)
 S X=$O(^DGCR(399,"AOPV",DFN,Y,0)) I '$O(^DGCR(399,"AOPV",DFN,Y,X)) S IBIFN=X
"RTN","IBCNQ1",21,0)
 I '$D(IBIFN) D LIST K IBARR G END:IBQUIT
"RTN","IBCNQ1",22,0)
 I $D(IBIFN) D VIEW^IBCNQ ; Display bill record
"RTN","IBCNQ1",23,0)
 G ASKPAT:'IBQUIT
"RTN","IBCNQ1",24,0)
 ;
"RTN","IBCNQ1",25,0)
END K DFN,IBQUIT,DGI,DGX,DGY,IBS,IBNUM,IBAC,IB,IBBNO,IBN,IBU,IBUK,IBUN,IBX,IBSTAT,IBAC1,IBIFN,IBOPD,IBNOW,IBPAGE,IBPT,J,X,X2,Y
"RTN","IBCNQ1",26,0)
 ;***
"RTN","IBCNQ1",27,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCNQ1" D T1^%ZOSV ;stop rt clock
"RTN","IBCNQ1",28,0)
 Q
"RTN","IBCNQ1",29,0)
 ;
"RTN","IBCNQ1",30,0)
LIST ; If multiple bills for an OP visit date, list them.
"RTN","IBCNQ1",31,0)
 W !!?5,"Select one of the following bills for this visit date:"
"RTN","IBCNQ1",32,0)
 ;
"RTN","IBCNQ1",33,0)
 S DGI=0
"RTN","IBCNQ1",34,0)
 F J=1:1 S DGI=$O(^DGCR(399,"AOPV",DFN,Y,DGI)) Q:'DGI  S IBARR(J)=DGI W !?12,J D DISP,ASKNUM:'(J#5) G:IBQUIT!($D(IBIFN)) LQ
"RTN","IBCNQ1",35,0)
 I '((J-1)#5) W !!?5,"End of list.",!
"RTN","IBCNQ1",36,0)
ASKNUM W !?5,"Select 1-"_$S(J#5:J-1,1:J)_", or type '^' to quit: " R DGX:DTIME S:'$T!(DGX["^") IBQUIT=1 Q:IBQUIT!(DGX="")  I +DGX<1!(+DGX>$S(J#5:J-1,1:J)) W !!?5,*7,"Enter a NUMBER from 1 to "_$S(J#5:J-1,1:J)_".",! G ASKNUM
"RTN","IBCNQ1",37,0)
 I $D(IBARR(DGX)) S IBIFN=IBARR(DGX)
"RTN","IBCNQ1",38,0)
LQ Q
"RTN","IBCNQ1",39,0)
 ;
"RTN","IBCNQ1",40,0)
HELP ; List all OP visit dates and bill numbers for patient.
"RTN","IBCNQ1",41,0)
 W !!?5,"Enter one of the following OP visit dates: ",!
"RTN","IBCNQ1",42,0)
 S (DGY,Y)="",J=0 F  S Y=$O(^DGCR(399,"AOPV",DFN,Y)) Q:'Y!(DGY["^")  S DGX="" F  S DGX=$O(^DGCR(399,"AOPV",DFN,Y,DGX)) Q:'DGX  S J=J+1 D:'(J#20) PAUSE Q:DGY["^"  W !?5,$E(Y,4,5)_"-"_$E(Y,6,7)_"-"_$E(Y,2,3) S DGI=DGX D DISP
"RTN","IBCNQ1",43,0)
 Q
"RTN","IBCNQ1",44,0)
 ;
"RTN","IBCNQ1",45,0)
PAUSE W !!?5,"Enter '^' to stop or <CR> to continue: " R DGY:DTIME S:'$T DGY="^"
"RTN","IBCNQ1",46,0)
 W:DGY'["^" ! Q
"RTN","IBCNQ1",47,0)
 ;
"RTN","IBCNQ1",48,0)
DISP ; Write the bill number, rate type, and bill status.
"RTN","IBCNQ1",49,0)
 Q:'$D(^DGCR(399,DGI,0))  S IBS=$P(^(0),"^",13) W ?20,$P(^(0),"^"),?30,$P($G(^DGCR(399.3,+$P(^(0),"^",7),0)),"^")
"RTN","IBCNQ1",50,0)
 W ?55,$S(IBS=1:"ENTERED/NOT REVIEWED",IBS=2:"REVIEWED",IBS=3:"AUTHORIZED",IBS=4:"PRINTED",IBS=7:"CANCELLED",IBS=0:"CLOSED",1:"")
"RTN","IBCNQ1",51,0)
 Q
"RTN","IBCNSM")
0^15^B17771600
"RTN","IBCNSM",1,0)
IBCNSM ;ALB/AAS - INSURANCE MANAGEMENT, LIST MANAGER INIT ROUTINE ; 21-OCT-92
"RTN","IBCNSM",2,0)
 ;;2.0;INTEGRATED BILLING;**28,46,56,52,82,103,199**;21-MAR-94
"RTN","IBCNSM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSM",4,0)
 ;
"RTN","IBCNSM",5,0)
% ; -- main entry point
"RTN","IBCNSM",6,0)
EN ;
"RTN","IBCNSM",7,0)
 D DT^DICRW
"RTN","IBCNSM",8,0)
 K XQORS,VALMEVL
"RTN","IBCNSM",9,0)
 D EN^VALM("IBCNS INSURANCE MANAGEMENT")
"RTN","IBCNSM",10,0)
ENQ K DFN
"RTN","IBCNSM",11,0)
 Q
"RTN","IBCNSM",12,0)
 ;
"RTN","IBCNSM",13,0)
 ;
"RTN","IBCNSM",14,0)
INIT ; -- set up inital variables
"RTN","IBCNSM",15,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBCNSM",16,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",17,0)
 ;K I,X,SDBEG,SDEND,SDB,XQORNOD,SDFN,SDCLN,DA,DR,DIE,DNM,DQ
"RTN","IBCNSM",18,0)
 S DIR(0)="350.9,4.02",DIR("A")="Select Patient Name or Insurance Co."
"RTN","IBCNSM",19,0)
 D ^DIR K DIR I $D(DIRUT) S VALMQUIT="" G INITQ
"RTN","IBCNSM",20,0)
 S IBY=Y
"RTN","IBCNSM",21,0)
 I IBY["DPT(" S IBTYP="P",DFN=+IBY D BLD
"RTN","IBCNSM",22,0)
 I IBY["DIC(" S IBTYP="I",IBCNS=+IBY D EN^VALM("IBCNS INSURANCE COMPANY") S VALMQUIT=""
"RTN","IBCNSM",23,0)
 ;
"RTN","IBCNSM",24,0)
INITQ Q
"RTN","IBCNSM",25,0)
 ;
"RTN","IBCNSM",26,0)
 ;
"RTN","IBCNSM",27,0)
PAT ; -- select patient you are working with
"RTN","IBCNSM",28,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCNSM",29,0)
 S DIC(0)="AEQMN",DIC="^DPT(" D ^DIC I +Y<1 S VALMQUIT="" Q
"RTN","IBCNSM",30,0)
 S DFN=+Y
"RTN","IBCNSM",31,0)
 Q
"RTN","IBCNSM",32,0)
 ;
"RTN","IBCNSM",33,0)
 ;
"RTN","IBCNSM",34,0)
BLD ; -- build list of bills
"RTN","IBCNSM",35,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",36,0)
 N I,J,K,IBHOLD,IBGRP,IBINS,IBCNT,IBCDFND,IBCPOLD
"RTN","IBCNSM",37,0)
 S (IBN,IBCNT,VALMCNT)=0,IBFILE=2
"RTN","IBCNSM",38,0)
 ;
"RTN","IBCNSM",39,0)
 ; -- find all ins. co data
"RTN","IBCNSM",40,0)
 K IBINS S IBINS=0
"RTN","IBCNSM",41,0)
 D POL^IBCNSU41(DFN)
"RTN","IBCNSM",42,0)
 D ALL^IBCNS1(DFN,"IBINS")
"RTN","IBCNSM",43,0)
 I $G(IBINS(0)) S K=0 F  S K=$O(IBINS(K)) Q:'K  D
"RTN","IBCNSM",44,0)
 .; -- add to list
"RTN","IBCNSM",45,0)
 .W "."
"RTN","IBCNSM",46,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSM",47,0)
 .S IBCDFND=$G(IBINS(K,0))
"RTN","IBCNSM",48,0)
 .S IBCDFND1=$G(IBINS(K,1))
"RTN","IBCNSM",49,0)
 .S IBCPOLD=$G(^IBA(355.3,+$P($G(IBINS(K,0)),"^",18),0))
"RTN","IBCNSM",50,0)
 .S X=""
"RTN","IBCNSM",51,0)
 .S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBCNSM",52,0)
 .I $D(^DIC(36,+IBCDFND,0)) S X=$$SETFLD^VALM1($P(^(0),"^"),X,"NAME")
"RTN","IBCNSM",53,0)
 .S X=$$SETFLD^VALM1($E($P(IBCDFND,"^",2),1,14),X,"POLICY")
"RTN","IBCNSM",54,0)
 .S IBHOLD=$P(IBCDFND,"^",6),X=$$SETFLD^VALM1($S(IBHOLD="v":"SELF",IBHOLD="s":"SPOUSE",IBHOLD="o":"OTHER",1:"UNKNOWN"),X,"HOLDER")
"RTN","IBCNSM",55,0)
 .S X=$$SETFLD^VALM1($E($$GRP^IBCNS($P(IBCDFND,"^",18)),1,10),X,"GROUP")
"RTN","IBCNSM",56,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND,"^",8)),X,"EFFDT")
"RTN","IBCNSM",57,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND,"^",4)),X,"EXPIRE")
"RTN","IBCNSM",58,0)
 .S X=$$SETFLD^VALM1($E($P($G(^IBE(355.1,+$P(IBCPOLD,"^",9),0)),U),1,8),X,"TYPE")
"RTN","IBCNSM",59,0)
 .S X=$$SETFLD^VALM1($P($G(^IBE(355.1,+$P($G(^IBA(355.3,+$P(IBCDFND,"^",18),0)),"^",9),0)),"^"),X,"TYPEPOL")
"RTN","IBCNSM",60,0)
 .S X=$$SETFLD^VALM1($E($P($G(^VA(200,+$P(IBCDFND1,"^",4),0)),U),1,15),X,"VERIFIED BY")
"RTN","IBCNSM",61,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND1,"^",3)),X,"VERIFIED ON")
"RTN","IBCNSM",62,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCPOLD,"^",6)),X,"PRECERT")
"RTN","IBCNSM",63,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCPOLD,"^",5)),X,"UR")
"RTN","IBCNSM",64,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCDFND,"^",20)),X,"COB")
"RTN","IBCNSM",65,0)
 .K IBHOLD,IBGRP
"RTN","IBCNSM",66,0)
 .D SET(X)
"RTN","IBCNSM",67,0)
 I '$D(^TMP("IBNSM",$J)) D
"RTN","IBCNSM",68,0)
 .S VALMCNT=2,IBCNT=2,^TMP("IBNSM",$J,1,0)=" "
"RTN","IBCNSM",69,0)
 .S ^TMP("IBNSM",$J,2,0)="    No Insurance Policies on file for this patient."
"RTN","IBCNSM",70,0)
 S X=$G(^IBA(354,DFN,60)) I X D
"RTN","IBCNSM",71,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSM",72,0)
 .S ^TMP("IBNSM",$J,IBCNT,0)="       Verification of No Coverage "_$$FMTE^XLFDT(X)
"RTN","IBCNSM",73,0)
BLDQ ;
"RTN","IBCNSM",74,0)
 Q
"RTN","IBCNSM",75,0)
 ;
"RTN","IBCNSM",76,0)
SET(X) ; -- set arrays
"RTN","IBCNSM",77,0)
 S VALMCNT=VALMCNT+1,^TMP("IBNSM",$J,VALMCNT,0)=X
"RTN","IBCNSM",78,0)
 S ^TMP("IBNSM",$J,"IDX",VALMCNT,IBCNT)=""
"RTN","IBCNSM",79,0)
 S ^TMP("IBNSMDX",$J,IBCNT)=VALMCNT_"^"_IBFILE_"^"_DFN_"^"_K_"^"_IBCDFND
"RTN","IBCNSM",80,0)
 Q
"RTN","IBCNSM",81,0)
 ;
"RTN","IBCNSM",82,0)
HDR ; -- screen header for initial screen
"RTN","IBCNSM",83,0)
 D PID^VADPT
"RTN","IBCNSM",84,0)
 S VALMHDR(1)="Insurance Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBCNSM",85,0)
 S VALMHDR(2)=" "
"RTN","IBCNSM",86,0)
 I +$$BUFFER^IBCNBU1(DFN) S VALMHDR(2)="*** Patient has Insurance Buffer Records"
"RTN","IBCNSM",87,0)
 Q
"RTN","IBCNSM",88,0)
 ;
"RTN","IBCNSM",89,0)
FNL ; -- exit and clean up
"RTN","IBCNSM",90,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",91,0)
 K IBFASTXT
"RTN","IBCNSM",92,0)
 D CLEAN^VALM10
"RTN","IBCNSM",93,0)
 Q
"RTN","IBCNSM",94,0)
 ;
"RTN","IBCNSM",95,0)
YN(X,Y) ; -- convert 1 or 0 to yes/no/unknown
"RTN","IBCNSM",96,0)
 Q $S($G(X)="":$S($G(Y):"",1:"UNK"),X=0:"NO",X=1:"YES",1:"")
"RTN","IBCNSM",97,0)
 ;
"RTN","IBCNSM",98,0)
CP ; -- change patient
"RTN","IBCNSM",99,0)
 N VALMQUIT
"RTN","IBCNSM",100,0)
 D FULL^VALM1
"RTN","IBCNSM",101,0)
 S IBDFN=DFN D PAT
"RTN","IBCNSM",102,0)
 I $D(VALMQUIT) S DFN=IBDFN
"RTN","IBCNSM",103,0)
 D HDR,BLD
"RTN","IBCNSM",104,0)
 S VALMBCK="R"
"RTN","IBCNSM",105,0)
CPQ K IBDFN
"RTN","IBCNSM",106,0)
 Q
"RTN","IBCNSM",107,0)
 ;
"RTN","IBCNSM",108,0)
PCI S VALMBCK="R" Q
"RTN","IBCNSM",109,0)
 ;
"RTN","IBCNSM",110,0)
FASTEXIT ;just sets a flag signaling system should be exited
"RTN","IBCNSM",111,0)
 S VALMBCK="Q"
"RTN","IBCNSM",112,0)
 D FULL^VALM1
"RTN","IBCNSM",113,0)
 K DIR S DIR(0)="Y",DIR("A")="Exit option entirely",DIR("B")="NO" D ^DIR
"RTN","IBCNSM",114,0)
 I $D(DIRUT)!(Y) S IBFASTXT=1
"RTN","IBCNSM",115,0)
 K DIR
"RTN","IBCNSM",116,0)
 Q
"RTN","IBCNSM4")
0^16^B3369599
"RTN","IBCNSM4",1,0)
IBCNSM4 ;ALB/AAS - INSURANCE MANAGEMENT, LIST MANAGER INIT ROUTINE ; 21-OCT-92
"RTN","IBCNSM4",2,0)
 ;;2.0;INTEGRATED BILLING;**56,82,199**;21-MAR-94
"RTN","IBCNSM4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSM4",4,0)
 ;
"RTN","IBCNSM4",5,0)
% ; -- main entry point
"RTN","IBCNSM4",6,0)
EN ;
"RTN","IBCNSM4",7,0)
 D DT^DICRW
"RTN","IBCNSM4",8,0)
 K XQORS,VALMEVL,DFN,IBFASTXT
"RTN","IBCNSM4",9,0)
 I '$G(IBVIEW) D EN^VALM("IBCNS PATIENT INSURANCE")
"RTN","IBCNSM4",10,0)
 I $G(IBVIEW) D EN^VALM("IBCNS VIEW PAT INS")
"RTN","IBCNSM4",11,0)
ENQ K DFN,IBFASTXT,IBEXP1,IBEXP2,IBCDFN,IBFILE,IBI,IBLCNT,IBN,IBCGN,IBCNT,IBDA,IBDIF,IBPPOL,IBDUZ,IBCPOL,IBCDFND1,IBCDFN,IBCNS,IBYE
"RTN","IBCNSM4",12,0)
 Q
"RTN","IBCNSM4",13,0)
 ;
"RTN","IBCNSM4",14,0)
 ;
"RTN","IBCNSM4",15,0)
INIT ; -- set up inital variables
"RTN","IBCNSM4",16,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBCNSM4",17,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM4",18,0)
 D:'$D(DFN) PAT G:$D(VALMQUIT) INITQ
"RTN","IBCNSM4",19,0)
 D BLD^IBCNSM
"RTN","IBCNSM4",20,0)
 ;
"RTN","IBCNSM4",21,0)
INITQ Q
"RTN","IBCNSM4",22,0)
 ;
"RTN","IBCNSM4",23,0)
 ;
"RTN","IBCNSM4",24,0)
PAT ; -- select patient you are working with
"RTN","IBCNSM4",25,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCNSM4",26,0)
 S DIC(0)="AEQMN",DIC="^DPT(" D ^DIC I +Y<1 S VALMQUIT="" Q
"RTN","IBCNSM4",27,0)
 S DFN=+Y
"RTN","IBCNSM4",28,0)
 Q
"RTN","IBCNSM4",29,0)
 ;
"RTN","IBCNSM4",30,0)
HDR ; -- screen header for initial screen
"RTN","IBCNSM4",31,0)
 D PID^VADPT
"RTN","IBCNSM4",32,0)
 S VALMHDR(1)="Insurance Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBCNSM4",33,0)
 S VALMHDR(2)=" "
"RTN","IBCNSM4",34,0)
 I +$$BUFFER^IBCNBU1(DFN) S VALMHDR(2)="*** Patient has Insurance Buffer Records"
"RTN","IBCNSM4",35,0)
 Q
"RTN","IBCNSM4",36,0)
 ;
"RTN","IBCNSM4",37,0)
FNL ; -- exit and clean up
"RTN","IBCNSM4",38,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM4",39,0)
 ;  for patch 56
"RTN","IBCNSM4",40,0)
 ;K IBFASTXT
"RTN","IBCNSM4",41,0)
 D CLEAN^VALM10
"RTN","IBCNSM4",42,0)
 Q
"RTN","IBCRTN")
0^17^B8707391
"RTN","IBCRTN",1,0)
IBCRTN ;ALB/AAS - EDIT BILLS RETURNED FROM AR (NEW) ;23-MAY-90
"RTN","IBCRTN",2,0)
 ;;2.0;INTEGRATED BILLING;**51,199**;21-MAR-94
"RTN","IBCRTN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCRTN",4,0)
 ;
"RTN","IBCRTN",5,0)
 ;MAP TO DGCRTN
"RTN","IBCRTN",6,0)
 ;
"RTN","IBCRTN",7,0)
EN1 ;
"RTN","IBCRTN",8,0)
 ;***
"RTN","IBCRTN",9,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN1^IBCRTN" D T1^%ZOSV ;stop rt clock
"RTN","IBCRTN",10,0)
 ;S XRTL=$ZU(0),XRTN="EN1^IBCRTN-1" D T0^%ZOSV ;start rt clock
"RTN","IBCRTN",11,0)
 ;
"RTN","IBCRTN",12,0)
 D END S IBAC=5,IBV=0 D LOOK G:'$D(IBIFN) END D EDIT,SEND:$D(IBIFN),PRINT:$D(IBIFN) L  G EN1
"RTN","IBCRTN",13,0)
 Q
"RTN","IBCRTN",14,0)
 ;
"RTN","IBCRTN",15,0)
EN2 ;
"RTN","IBCRTN",16,0)
 ;***
"RTN","IBCRTN",17,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN2^IBCRTN" D T1^%ZOSV ;stop rt clock
"RTN","IBCRTN",18,0)
 ;S XRTL=$ZU(0),XRTN="EN2^IBCRTN-1" D T0^%ZOSV ;start rt clock
"RTN","IBCRTN",19,0)
 ;
"RTN","IBCRTN",20,0)
 D END S IBAC=6,IBV=1 D LOOK G END:'$D(IBIFN) D RTN,SEND:$D(IBIFN),PRINT:$D(IBIFN) L  G EN2
"RTN","IBCRTN",21,0)
 Q
"RTN","IBCRTN",22,0)
 ;
"RTN","IBCRTN",23,0)
LOOK N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCRTN",24,0)
 S DIC="^DGCR(399,",DIC(0)="AEQMZ",DIC("S")="I $S($P(^(0),U,13)=7:0,+$$RETN^PRCAFN(Y):1,1:0)" D ^DIC K DIC Q:+Y<1
"RTN","IBCRTN",25,0)
 S IBIFN=+Y,DFN=$P(Y(0),"^",2)
"RTN","IBCRTN",26,0)
 L ^DGCR(399,IBIFN):1 I '$T W !,"Already being edited by another user" K IBIFN,DFN Q
"RTN","IBCRTN",27,0)
 I '$P(^DGCR(399,IBIFN,"S"),"^",9)!('$D(^XUSEC("IB EDIT",DUZ))) Q
"RTN","IBCRTN",28,0)
 ;
"RTN","IBCRTN",29,0)
FILE K DD,DO I '$D(^DGCR(399,IBIFN,"R",0)) S ^(0)="^399.046^"
"RTN","IBCRTN",30,0)
 S DIC(0)="MN",DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""R"",",DIE=DIC,DIC("DR")=".02////"_DUZ S X="NOW",%DT="T" D ^%DT S X=Y D FILE^DICN G:Y<1 END S DGIFN=+Y
"RTN","IBCRTN",31,0)
 Q
"RTN","IBCRTN",32,0)
 ;
"RTN","IBCRTN",33,0)
EDIT N DGIFN G RTN:IBAC=6 D ^IBCSCU,^IBCSC1 I '$T K IBIFN Q
"RTN","IBCRTN",34,0)
 ;
"RTN","IBCRTN",35,0)
RTN I '$D(^XUSEC("IB AUTHORIZE",DUZ))!('$D(IBIFN)) K IBIFN Q
"RTN","IBCRTN",36,0)
 D EDITS^IBCB2 I IBQUIT K IBIFN Q
"RTN","IBCRTN",37,0)
RTN1 W !!,"WANT TO RETURN BILL TO A/R AT THIS TIME" S %=2 D YN^DICN Q:%=1  I %=-1!(%=2) K IBIFN Q
"RTN","IBCRTN",38,0)
 I '% W !?4,"YES - To set the status to Returned",!?4,"No - To take no action" G RTN1
"RTN","IBCRTN",39,0)
 Q
"RTN","IBCRTN",40,0)
 ;
"RTN","IBCRTN",41,0)
 ;store sending data at this point
"RTN","IBCRTN",42,0)
SEND S DA(1)=IBIFN,DA=DGIFN,(DIC,DIE)="^DGCR(399,"_DA(1)_",""R"",",DR=".03;.04" D ^DIE
"RTN","IBCRTN",43,0)
 I '$P(^DGCR(399,IBIFN,"R",DGIFN,0),"^",4) K IBIFN Q
"RTN","IBCRTN",44,0)
 ;
"RTN","IBCRTN",45,0)
 W !,"Passing completed Bill to Accounts Receivable.  Bill is no longer editable."
"RTN","IBCRTN",46,0)
 I $P(^DGCR(399,IBIFN,"S"),"^",9) D ARCHK^IBCB2(1,1,0,0,0,.PRCASV) D REL^PRCASVC:PRCASV("OKAY") I 'PRCASV("OKAY") K IBIFN Q
"RTN","IBCRTN",47,0)
 W !,"Completed Bill Successfully sent to Accounts Receivable."
"RTN","IBCRTN",48,0)
 Q
"RTN","IBCRTN",49,0)
 ;
"RTN","IBCRTN",50,0)
PRINT I $D(IBIFN) S IBVIEW=1 D 4^IBCB1 Q
"RTN","IBCRTN",51,0)
 Q
"RTN","IBCRTN",52,0)
 ;
"RTN","IBCRTN",53,0)
END L  K IBNDS,IBDISP,IBER,IBNDI1,IBV,DGIFN,IBVIEW,IBIFN,DFN,IBAC,PRCASV,PRCAERR D KILL^IBCMENU
"RTN","IBCRTN",54,0)
 ;***
"RTN","IBCRTN",55,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCRTN" D T1^%ZOSV ;stop rt clock
"RTN","IBCRTN",56,0)
 Q
"RTN","IBECEA")
0^18^B9579973
"RTN","IBECEA",1,0)
IBECEA ;ALB/RLW - Cancel/Edit/Add Patient Charges ; 12-JUN-92
"RTN","IBECEA",2,0)
 ;;2.0; INTEGRATED BILLING ;**199**; 21-MAR-94
"RTN","IBECEA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECEA",4,0)
 ;
"RTN","IBECEA",5,0)
EN ; Cancel/Edit/Add Patient Charges -- invoke the List Manager.
"RTN","IBECEA",6,0)
 I '$$CHECK^IBECEAU(1) G ENQ
"RTN","IBECEA",7,0)
 K XQORS,VALMEVL D EN^VALM("IB CHARGES")
"RTN","IBECEA",8,0)
ENQ K IBSITE,IBFAC,IBSERV
"RTN","IBECEA",9,0)
 Q
"RTN","IBECEA",10,0)
 ;
"RTN","IBECEA",11,0)
INIT ; List Manager (IB CHARGES) main entry point.
"RTN","IBECEA",12,0)
 S IBJOB=4,IBWHER="IBECEA",IBDUZ=DUZ
"RTN","IBECEA",13,0)
 S IBACMAR="^TMP(""IBACM"",$J)",IBACMIDX="^TMP(""IBACMIDX"",$J)",VALMIDX="^TMP(""IBCMLIDX"",$J)"
"RTN","IBECEA",14,0)
 I '$$SLPT S VALMQUIT="" D FNL G INITQ
"RTN","IBECEA",15,0)
 I $$SLDT S VALMQUIT="" D FNL G INITQ
"RTN","IBECEA",16,0)
 I $$SLRX S VALMQUIT="" D FNL G INITQ
"RTN","IBECEA",17,0)
 D ARRAY^IBECEA0
"RTN","IBECEA",18,0)
INITQ Q
"RTN","IBECEA",19,0)
 ;
"RTN","IBECEA",20,0)
PAT ; 'Change Patient' protocol entry action.
"RTN","IBECEA",21,0)
 N IBDFN S IBDFN=DFN
"RTN","IBECEA",22,0)
 I '$$SLPT D MSG S DFN=IBDFN G PATQ
"RTN","IBECEA",23,0)
DATE ; 'Change Date' protocol entry action.
"RTN","IBECEA",24,0)
 N IBDT1,IBDT2,IBRXXX S IBDT1=IBABEG,IBDT2=IBAEND,IBRXXX=IBRX
"RTN","IBECEA",25,0)
 I $$SLDT D MSG S IBABEG=IBDT1,IBAEND=IBDT2 S:$D(IBDFN) DFN=IBDFN G PATQ
"RTN","IBECEA",26,0)
 I $$SLRX D MSG S IBABEG=IBDT1,IBAEND=IBDT2,IBRX=IBRXXX S:$D(IBDFN) DFN=IBDFN G PATQ
"RTN","IBECEA",27,0)
 D ARRAY^IBECEA0,HDR S VALMBCK="R"
"RTN","IBECEA",28,0)
PATQ Q
"RTN","IBECEA",29,0)
 ;
"RTN","IBECEA",30,0)
MSG ; Quick message display.
"RTN","IBECEA",31,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBECEA",32,0)
 W !!,*7,"No changes were made!",!
"RTN","IBECEA",33,0)
 S DIR(0)="E" D ^DIR S VALMBCK=""
"RTN","IBECEA",34,0)
 Q
"RTN","IBECEA",35,0)
 ;
"RTN","IBECEA",36,0)
HDR ; Build screen header.
"RTN","IBECEA",37,0)
 S IBNAM=$$PT^IBEFUNC(DFN)
"RTN","IBECEA",38,0)
 S VALMHDR(1)=$$SETSTR^VALM1($$FDATE^VALM1(IBABEG)_" THRU "_$$FDATE^VALM1(IBAEND),"Cancel/Edit/Add Charges",59,22)
"RTN","IBECEA",39,0)
 S VALMHDR(2)=$E("Patient: "_$P(IBNAM,"^"),1,25)_" "_$E(IBNAM)_$P(IBNAM,"^",3)
"RTN","IBECEA",40,0)
 Q
"RTN","IBECEA",41,0)
 ;
"RTN","IBECEA",42,0)
SLPT() ; Select a patient.
"RTN","IBECEA",43,0)
 N DIC,X,Y
"RTN","IBECEA",44,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBECEA",45,0)
 S DIC="^DPT(",DIC(0)="AEMQ" D ^DIC S DFN=+Y
"RTN","IBECEA",46,0)
 Q Y>0
"RTN","IBECEA",47,0)
 ;
"RTN","IBECEA",48,0)
SLDT() ; Select Charge dates.
"RTN","IBECEA",49,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBECEA",50,0)
 S DIR(0)="DA^2860101:NOW:EX",DIR("A")="Search for CHARGES from: ",DIR("B")=$$DAT2^IBOUTL($$FMADD^XLFDT(DT,-365)) D ^DIR S IBABEG=+Y G:'Y SLDTQ
"RTN","IBECEA",51,0)
 S DIR(0)="DA^"_+Y_":NOW:EX",DIR("A")="                     to: ",DIR("B")=$$DAT2^IBOUTL(DT) D ^DIR S IBAEND=+Y+.999999
"RTN","IBECEA",52,0)
SLDTQ Q $D(DIRUT)!($D(DUOUT))
"RTN","IBECEA",53,0)
 ;
"RTN","IBECEA",54,0)
SLRX() ; Include Rx copay charges?
"RTN","IBECEA",55,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBECEA",56,0)
 S DIR(0)="Y",DIR("A")="Include RX COPAY charges",DIR("B")="NO" D ^DIR S IBRX=Y
"RTN","IBECEA",57,0)
 Q $D(DIRUT)!($D(DUOUT))
"RTN","IBECEA",58,0)
 ;
"RTN","IBECEA",59,0)
FNL ; List Manager (IB CHARGES) exit action.
"RTN","IBECEA",60,0)
 K:$D(IBACMAR) @IBACMAR,IBACMAR K:$D(IBACMIDX) @IBACMIDX,IBACMIDX K:$D(VALMIDX) @VALMIDX,VALMIDX
"RTN","IBECEA",61,0)
 K IBABEG,IBAEND,DFN,IBAT,IBAX,IBY,VA,IBRX,IBWHER,X,^TMP("IBECEA",$J),^TMP("IBCMLIDX",$J),DFN,IBSAVY,IBARTYP,IBPRNT,IBDUZ,IBJOB,IBXA,IBNOW,IBLDT,IBL,IBIL,IBNAM
"RTN","IBECEA",62,0)
 Q
"RTN","IBECEA",63,0)
 ;
"RTN","IBECEA",64,0)
EXIT Q
"RTN","IBECPF")
0^19^B1220927
"RTN","IBECPF",1,0)
IBECPF ;ALB/RLW - IB FLAG/UNFLAG CONTINUOUS PATIENTS ; 1-JAN-92
"RTN","IBECPF",2,0)
 ;;2.0; INTEGRATED BILLING ;**199**; 21-MAR-94
"RTN","IBECPF",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBECPF",4,0)
EN ;
"RTN","IBECPF",5,0)
 ;***
"RTN","IBECPF",6,0)
 ;S XRTL=$ZU(0),XRTN="IBECPF-1" D T0^%ZOSV ;start rt clock
"RTN","IBECPF",7,0)
 D DT^DICRW S IBDATE=%
"RTN","IBECPF",8,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBECPF",9,0)
 S DIC="^IBE(351.1,",DIC(0)="AELMQZ",DLAYGO=351.1,DIC("A")="Select PATIENT: " D ^DIC K DIC
"RTN","IBECPF",10,0)
 G:+Y<0 ENQ
"RTN","IBECPF",11,0)
 I $P(Y,"^",3)=1 S DR=".02;.03////"_DUZ_";.04////"_IBDATE
"RTN","IBECPF",12,0)
 E  S DR=".01;.02;.05////"_DUZ_";.06////"_IBDATE
"RTN","IBECPF",13,0)
 S DIE="^IBE(351.1,",DA=+Y,DIDEL=351.1 D ^DIE K DIE,DA,DR,Y,DIDEL
"RTN","IBECPF",14,0)
ENQ ;
"RTN","IBECPF",15,0)
 K IBDATE
"RTN","IBECPF",16,0)
 ;***
"RTN","IBECPF",17,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBECPF" D T1^%ZOSV ;stop rt clock
"RTN","IBECPF",18,0)
 Q
"RTN","IBEMTBC")
0^21^B14076227
"RTN","IBEMTBC",1,0)
IBEMTBC ;ALB/RLW - IB MEANS TEST BILLING CLOCK FILE UPDATE ; 15-JAN-92
"RTN","IBEMTBC",2,0)
 ;;2.0;INTEGRATED BILLING;**153,199**;21-MAR-94
"RTN","IBEMTBC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBEMTBC",4,0)
 ;
"RTN","IBEMTBC",5,0)
EN ; Entry point for Clock Maintenance
"RTN","IBEMTBC",6,0)
 ;
"RTN","IBEMTBC",7,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBEMTBC" D T1^%ZOSV ;stop rt clock
"RTN","IBEMTBC",8,0)
 ;S XRTL=$ZU(0),XRTN="IBEMTBC-1" D T0^%ZOSV ;start rt clock
"RTN","IBEMTBC",9,0)
 ;
"RTN","IBEMTBC",10,0)
 D HOME^%ZIS,NOW^%DTC S IBDT=% K % I '$D(DT) D DT^DICRW
"RTN","IBEMTBC",11,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBEMTBC",12,0)
 S DIR(0)="PO^2:AEMQZ" D ^DIR K DIR S DFN=+Y I $D(DIRUT) G ENQ
"RTN","IBEMTBC",13,0)
 I $$BILST^DGMTUB(DFN)=0 S J=5 D ERR G EN
"RTN","IBEMTBC",14,0)
 I $D(^IBE(351,"ACT",DFN)) S IBSELECT="ADJUST",IBDR="[IB BILLING CYCLE ADJUST]" D ADJUST,CLEANUP G ENQ
"RTN","IBEMTBC",15,0)
 S IBSELECT="ADD",IBDR="[IB BILLING CYCLE ADD]" D ADDNEW,CLEANUP
"RTN","IBEMTBC",16,0)
 ;
"RTN","IBEMTBC",17,0)
ENQ I '$D(DIRUT) W ! G EN
"RTN","IBEMTBC",18,0)
 K DIC,IBSELECT,DFN,IBDR,IBEL,DFN,IBIEN,IBDATA,J,DIRUT,IBFAC,IBSITE,IBDT
"RTN","IBEMTBC",19,0)
 ;
"RTN","IBEMTBC",20,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBEMTBC" D T1^%ZOSV ;stop rt clock
"RTN","IBEMTBC",21,0)
 ;
"RTN","IBEMTBC",22,0)
 Q
"RTN","IBEMTBC",23,0)
 ;
"RTN","IBEMTBC",24,0)
ADJUST ; - show current active clock; inactivate and add a new one
"RTN","IBEMTBC",25,0)
 W @IOF
"RTN","IBEMTBC",26,0)
 S IBIEN=$O(^IBE(351,"ACT",DFN,0))
"RTN","IBEMTBC",27,0)
 S DIC="^IBE(351,",DA=IBIEN W !! D EN^DIQ K DIC,DA
"RTN","IBEMTBC",28,0)
 S DIR(0)="Y",DIR("A")="Do you want to update" D ^DIR K DIR Q:+Y<1
"RTN","IBEMTBC",29,0)
 ;
"RTN","IBEMTBC",30,0)
 ; - save current clock, change to cancelled and delete "ACT" xref
"RTN","IBEMTBC",31,0)
 K ^IBE(351,"ACT",DFN) L +(^IBE(351,IBIEN))
"RTN","IBEMTBC",32,0)
 S IBDATA=$P(^IBE(351,IBIEN,0),"^",2,10),$P(^IBE(351,IBIEN,0),"^",4)=3,$P(^(1),"^",3,4)=DUZ_"^"_IBDT
"RTN","IBEMTBC",33,0)
 L -(^IBE(351,IBIEN))
"RTN","IBEMTBC",34,0)
 ;
"RTN","IBEMTBC",35,0)
ADDNEW ; - add a new clock and allow updating
"RTN","IBEMTBC",36,0)
 I IBSELECT="ADD" D  Q:'Y  W !
"RTN","IBEMTBC",37,0)
 .W !!,"This patient does not have an active billing clock!"
"RTN","IBEMTBC",38,0)
 .S DIR(0)="Y",DIR("A")="Is it okay to add a new billing clock for this patient"
"RTN","IBEMTBC",39,0)
 .D ^DIR K DIR,DIRUT,DUOUT,DTOUT
"RTN","IBEMTBC",40,0)
 ;
"RTN","IBEMTBC",41,0)
 D SITE^IBAUTL I 'IBSITE S J=1 G ERR
"RTN","IBEMTBC",42,0)
 S I=$P($S($D(^IBE(351,0)):^(0),1:"^^-1"),"^",3)+1 I 'I S J=3 G ERR
"RTN","IBEMTBC",43,0)
 K DD,DO,DIC,DR S DIC="^IBE(351,",DIC(0)="L",DLAYGO=351,DIC("DR")=".02////"_DFN_";11////"_DUZ_";12////"_IBDT
"RTN","IBEMTBC",44,0)
 F I=I:1 I I>0,'$D(^IBE(351,I)) L +^IBE(351,I):2 I $T,'$D(^IBE(351,I)) S DINUM=I,X=+IBSITE_I D FILE^DICN K DIC,DR S IBCL=+Y Q:+Y>0
"RTN","IBEMTBC",45,0)
 I IBSELECT'="ADD" S $P(^IBE(351,IBCL,0),"^",2,10)=IBDATA,DIK="^IBE(351,",DA=IBCL D IX1^DIK K DIK
"RTN","IBEMTBC",46,0)
 S DIE="^IBE(351,",DA=IBCL,DR=IBDR D ^DIE K DA,DIE,DR
"RTN","IBEMTBC",47,0)
 L -^IBE(351,IBCL)
"RTN","IBEMTBC",48,0)
 ;
"RTN","IBEMTBC",49,0)
 ; - if the updated clock was cancelled, with no other changes made,
"RTN","IBEMTBC",50,0)
 ; - move the update reason over to the old clock and cancel the new one.
"RTN","IBEMTBC",51,0)
 I IBSELECT'="ADD" D
"RTN","IBEMTBC",52,0)
 .I $L(^IBE(351,+$G(IBIEN),0),"^")=9 S $P(^IBE(351,+$G(IBIEN),0),"^",10)=""
"RTN","IBEMTBC",53,0)
 .I $L(^IBE(351,IBCL,0),"^")=9 S $P(^IBE(351,IBCL,0),"^",10)=""
"RTN","IBEMTBC",54,0)
 .Q:$P(^IBE(351,+$G(IBIEN),0),"^",2,10)'=$P(^IBE(351,IBCL,0),"^",2,10)
"RTN","IBEMTBC",55,0)
 .W !!,"Since you only cancelled the clock, I'll delete the new clock..."
"RTN","IBEMTBC",56,0)
 .I $P(^IBE(351,IBCL,0),"^",11)]"" S $P(^IBE(351,+$G(IBIEN),0),"^",11)=$P(^IBE(351,IBCL,0),"^",11) W !,"(but I'll save the update reason)..."
"RTN","IBEMTBC",57,0)
 .S DA=IBCL,DIK="^IBE(351," D ^DIK K DIK,DA
"RTN","IBEMTBC",58,0)
 ;
"RTN","IBEMTBC",59,0)
 ; - if the user is adding a new clock, and there is no clock
"RTN","IBEMTBC",60,0)
 ; - begin date or status, delete the clock.
"RTN","IBEMTBC",61,0)
 I IBSELECT="ADD" S IBDATA=^IBE(351,IBCL,0) I '$P(IBDATA,"^",3)!'$P(IBDATA,"^",4) D
"RTN","IBEMTBC",62,0)
 .W !!,"This new clock is incomplete!!  Deleting the clock from the system..."
"RTN","IBEMTBC",63,0)
 .S DA=IBCL,DIK="^IBE(351," D ^DIK K DIK,DA
"RTN","IBEMTBC",64,0)
 K IBCL
"RTN","IBEMTBC",65,0)
 Q
"RTN","IBEMTBC",66,0)
 ;
"RTN","IBEMTBC",67,0)
ERR ; - display error messages
"RTN","IBEMTBC",68,0)
 W !?5,$P($T(ERRMSG+J),";;",2)
"RTN","IBEMTBC",69,0)
CLEANUP K IBCLDA,IBCLDAY,IBCLDT,IBMED,IBCLDOL,X,IBSELECT,DLAYGO,IBDT
"RTN","IBEMTBC",70,0)
 Q
"RTN","IBEMTBC",71,0)
 ;
"RTN","IBEMTBC",72,0)
ERRMSG ; - possible error messages
"RTN","IBEMTBC",73,0)
 ;;No value returned from call to SITE^IBAUTL
"RTN","IBEMTBC",74,0)
 ;;Record locked, try again later!
"RTN","IBEMTBC",75,0)
 ;;Problem extracting last IFN from zeroth node of MEANS TEST BILLING CLOCK file
"RTN","IBEMTBC",76,0)
 ;;Unable to add record to MEANS TEST BILLING CLOCK file
"RTN","IBEMTBC",77,0)
 ;;Not a Means Test copay patient!
"RTN","IBJTU2")
0^2^B6829396
"RTN","IBJTU2",1,0)
IBJTU2 ;ALB/ARH - TPI UTILITIES ; 2/14/95
"RTN","IBJTU2",2,0)
 ;;2.0;INTEGRATED BILLING;**39,106,199**;21-MAR-94
"RTN","IBJTU2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTU2",4,0)
 ;
"RTN","IBJTU2",5,0)
PAT() ; select patient, only allows patient's that have bills - returns DFN^NAME if patient selected, 0 otherwise
"RTN","IBJTU2",6,0)
 N X,Y,DFN,DTOUT,DUOUT,DA
"RTN","IBJTU2",7,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",8,0)
 S DFN=0,DIC(0)="AEQM",DIC="^DPT(",DIC("S")="I $D(^DGCR(399,""C"",Y))" D ^DIC K DIC I Y'<1 S DFN=Y
"RTN","IBJTU2",9,0)
 Q DFN
"RTN","IBJTU2",10,0)
 ;
"RTN","IBJTU2",11,0)
BILL() ; select bill, returns bill IFN^BILL NUMBER or 0 if none selected
"RTN","IBJTU2",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",13,0)
 N X,Y,DTOUT,DUOUT,DA,IBY S IBY=0,DIC="^DGCR(399,",DIC(0)="AEMQ" D ^DIC K DIC I Y'<1 S IBY=Y
"RTN","IBJTU2",14,0)
 Q IBY
"RTN","IBJTU2",15,0)
 ;
"RTN","IBJTU2",16,0)
PB() ; select either a patient name (must have a bill) or bill number
"RTN","IBJTU2",17,0)
 ; if patient chosen: returns "1^"_DFN, if bill chosen: returns "2^"_IBIFN, 0 otherwise
"RTN","IBJTU2",18,0)
 N IBX,IBY,DIC,DTOUT,DUOUT,DA,X,Y S IBY=0
"RTN","IBJTU2",19,0)
 ;
"RTN","IBJTU2",20,0)
PB1 R !!,"Enter BILL NUMBER or PATIENT NAME: ",IBX:DTIME I IBX["^"!(IBX="") G PBQ
"RTN","IBJTU2",21,0)
 ;
"RTN","IBJTU2",22,0)
 ; search for patient name
"RTN","IBJTU2",23,0)
 I IBX?1A4N!(IBX?2A.AP)!(IBX?2.A1",".AP)!(IBX?1A1P.AP) D  I +IBY G PBQ
"RTN","IBJTU2",24,0)
 . N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",25,0)
 . S DIC="^DPT(",DIC(0)="EQM",DIC("S")="I $D(^DGCR(399,""C"",Y))",X=IBX D ^DIC K DIC I Y'<1 S IBY="1^"_+Y
"RTN","IBJTU2",26,0)
 ;
"RTN","IBJTU2",27,0)
 ; search for bill number
"RTN","IBJTU2",28,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",29,0)
 S DIC="^DGCR(399,",DIC(0)="EQM",X=IBX D ^DIC K DIC I Y'<1 S IBY="2^"_+Y G PBQ
"RTN","IBJTU2",30,0)
 ;
"RTN","IBJTU2",31,0)
 G PB1
"RTN","IBJTU2",32,0)
PBQ Q IBY
"RTN","IBJTU2",33,0)
 ;
"RTN","IBJTU2",34,0)
RCANC(IBIFN,ARR,WDTH) ; if bill cancelled returns ARR = IBIFN ^ PTR TO 200 ^ INITIALS OF WHO CANCELLED IN IB
"RTN","IBJTU2",35,0)
 ;                                        ARR(X) = REASON CANCELLED   with line width passed in
"RTN","IBJTU2",36,0)
 N X,DIWL,DIWR,DIWF,IBDS,IBCNT,IBI,IBD K ARR
"RTN","IBJTU2",37,0)
 S ARR=0,IBIFN=+$G(IBIFN),IBDS=$G(^DGCR(399,IBIFN,"S"))
"RTN","IBJTU2",38,0)
 S X=$P(IBDS,U,18) G:'X RCANCQ
"RTN","IBJTU2",39,0)
 S ARR=IBIFN_U_X_U_$P($G(^VA(200,+X,0)),U,2)
"RTN","IBJTU2",40,0)
 S X=$P(IBDS,U,19) G:X="" RCANCQ
"RTN","IBJTU2",41,0)
 S DIWL=1,DIWR=$G(WDTH),DIWF="" D ^DIWP
"RTN","IBJTU2",42,0)
 S (IBCNT,IBI)=0,DIWL=1 F  S IBI=$O(^UTILITY($J,"W",DIWL,IBI)) Q:'IBI  D
"RTN","IBJTU2",43,0)
 . S IBD=$G(^UTILITY($J,"W",DIWL,IBI,0)) I IBD'="" S IBCNT=IBCNT+1,ARR(IBCNT)=IBD
"RTN","IBJTU2",44,0)
 K ^UTILITY($J,"W")
"RTN","IBJTU2",45,0)
RCANCQ Q
"RTN","IBJTU2",46,0)
 ;
"RTN","IBJTU2",47,0)
DR(DB,DE) ; get a date range from the user, DB is default begin date (FM), DE is default end date
"RTN","IBJTU2",48,0)
 ; returns "begin dt ^ end dt" in FM format, or "" if two valid dates are not entered
"RTN","IBJTU2",49,0)
 N IBY,IBX,%DT,X,Y S (IBX,IBY)="" I $G(DB)?7N S %DT("B")=$$FMTE^XLFDT(DB,2)
"RTN","IBJTU2",50,0)
 S %DT="AEX",%DT("A")="Start Date: " D ^%DT K %DT G:Y<0 DRQ S IBX=Y
"RTN","IBJTU2",51,0)
 S %DT(0)=IBX,%DT("B")=$$FMTE^XLFDT($S(IBX>$G(DE):IBX,1:DE),2)
"RTN","IBJTU2",52,0)
 S %DT="AEX",%DT("A")="End Date: " D ^%DT K %DT G:Y<0 DRQ S IBY=IBX_U_Y
"RTN","IBJTU2",53,0)
DRQ Q IBY
"RTN","IBOA31")
0^22^B15171767
"RTN","IBOA31",1,0)
IBOA31 ;ALB/AAS - PRINT ALL BILLS FOR A PATIENT ; 04/18/90
"RTN","IBOA31",2,0)
 ;;2.0; INTEGRATED BILLING ;**95,199**; 21-MAR-94
"RTN","IBOA31",3,0)
 ;
"RTN","IBOA31",4,0)
 ;MAP TO DGCRA31
"RTN","IBOA31",5,0)
EN ;
"RTN","IBOA31",6,0)
 ;***
"RTN","IBOA31",7,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",8,0)
 ;S XRTL=$ZU(0),XRTN="IBOA31-1" D T0^%ZOSV ;start rt clock
"RTN","IBOA31",9,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOA31",10,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC K DIC Q:Y<1  S DFN=+Y
"RTN","IBOA31",11,0)
 S DIR(0)="Y",DIR("A")="Include Pharmacy Co-Pay charges on this report",DIR("B")="NO"
"RTN","IBOA31",12,0)
 S DIR("?",1)="    Enter:  'Y'  -  To include Pharmacy Co-pay charges on this report"
"RTN","IBOA31",13,0)
 S DIR("?",2)="            'N'  -  To exclude Pharmacy Co-pay charges on this report"
"RTN","IBOA31",14,0)
 S DIR("?")="            '^'  -  To select a new patient"
"RTN","IBOA31",15,0)
 D ^DIR K DIR G:$D(DIRUT) END S IBIBRX=Y
"RTN","IBOA31",16,0)
 W !,"You will need a 132 column printer for this report."
"RTN","IBOA31",17,0)
 S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBOA31",18,0)
 I $D(IO("Q")) K IO("Q") D  G ENQ
"RTN","IBOA31",19,0)
 .S ZTDESC="IB - PRINT ALL BILLS FOR A PATIENT",ZTRTN="DQ^IBOA31",ZTSAVE("DFN")="",ZTSAVE("IB*")=""
"RTN","IBOA31",20,0)
 .D ^%ZTLOAD K ZTSK D HOME^%ZIS
"RTN","IBOA31",21,0)
 ;
"RTN","IBOA31",22,0)
 ;***
"RTN","IBOA31",23,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",24,0)
DQ ;
"RTN","IBOA31",25,0)
 ;***
"RTN","IBOA31",26,0)
 ;S XRTL=$ZU(0),XRTN="IBOA31-2" D T0^%ZOSV ;start rt clock
"RTN","IBOA31",27,0)
 U IO S IBPAG=0 D NOW^%DTC S Y=% X ^DD("DD") S IBNOW=Y,$P(IBLINE,"-",IOM+1)=""
"RTN","IBOA31",28,0)
 S IBQUIT=0,IBN=$$PT^IBEFUNC(DFN) D UTIL^IBCA3,UTIL^IBOA32
"RTN","IBOA31",29,0)
 I '$D(^UTILITY($J)) W !,"No Bills On File for ",$P(IBN,"^"),"  SSN: ",$P(IBN,"^",2),"." G ENQ
"RTN","IBOA31",30,0)
 D HDR1 S (IBDT,IBIFN)=""
"RTN","IBOA31",31,0)
 ; - loop through all bills
"RTN","IBOA31",32,0)
 F  S IBDT=$O(^UTILITY($J,IBDT)) Q:IBDT=""!(IBQUIT)  D
"RTN","IBOA31",33,0)
 . F  S IBIFN=$O(^UTILITY($J,IBDT,IBIFN)) Q:IBIFN=""!(IBQUIT)  D @($S($E(IBIFN,$L(IBIFN))="X":"^IBOA32",1:"ONE"))
"RTN","IBOA31",34,0)
 D:'IBQUIT PAUSE
"RTN","IBOA31",35,0)
ENQ W ! G END
"RTN","IBOA31",36,0)
 ;
"RTN","IBOA31",37,0)
ONE D GVAR^IBCBB
"RTN","IBOA31",38,0)
 D:($Y>(IOSL-5)) HDR Q:IBQUIT
"RTN","IBOA31",39,0)
 W !,IBBNO,?8,$$DAT1^IBOUTL($P(IBNDS,"^",12)),?18,$P($G(^DGCR(399.3,+IBAT,0)),"^")
"RTN","IBOA31",40,0)
 W ?37,$S(IBCL=1:"INPATIENT",IBCL=2:"HUMANIT. (INPT)",IBCL=3:"OUTPATIENT",IBCL=4:"HUMANIT. (OPT)",1:""),?54
"RTN","IBOA31",41,0)
 F I=$S(IBCL<3!('$O(^DGCR(399,IBIFN,"OP",0))):IBEVDT,1:$O(^DGCR(399,IBIFN,"OP",0))),IBFDT,IBTDT W $S(I]"":$$DAT1^IBOUTL(I)_"  ",1:"          ")
"RTN","IBOA31",42,0)
 S X=+$$TPR^PRCAFN(IBIFN) W $J($S(X<0:0,1:X),8,2)
"RTN","IBOA31",43,0)
 W ?94,$S(IBST=1:"ENTERED/NOT REV.",IBST=2:"REVIEWED",IBST=3:"AUTHORIZED",IBST=4:"PRINTED",IBST=7:"CANCELLED",1:"")
"RTN","IBOA31",44,0)
 W ?112,$P("NON-PAYMENT/ZERO^ADMIT - DISCHARGE^INTERIM - FIRST^INTERIM - CONTINUING^INTERIM - LAST^LATE CHARGE(S) ONLY^ADJUSTMENT OF PRIOR^REPLACEMENT OF PRIOR","^",(IBTF+1))
"RTN","IBOA31",45,0)
 ; - print remaining outpatient visit dates
"RTN","IBOA31",46,0)
 S IBOPD=$O(^DGCR(399,IBIFN,"OP",0)) Q:'IBOPD
"RTN","IBOA31",47,0)
 F  S IBOPD=$O(^DGCR(399,IBIFN,"OP",IBOPD)) Q:'IBOPD  D  Q:IBQUIT
"RTN","IBOA31",48,0)
 . D:($Y>(IOSL-5)) HDR Q:IBQUIT  W !?54,$$DAT1^IBOUTL(IBOPD)
"RTN","IBOA31",49,0)
 Q
"RTN","IBOA31",50,0)
 ;
"RTN","IBOA31",51,0)
HDR I $E(IOST,1,2)["C-" D PAUSE Q:IBQUIT
"RTN","IBOA31",52,0)
HDR1 S IBPAG=IBPAG+1 W:$E(IOST,1,2)["C-"!(IBPAG>1) @IOF
"RTN","IBOA31",53,0)
 W "List of all Bills for ",$P(IBN,"^"),"  SSN: ",$P(IBN,"^",2),"  ",?(IOM-31),IBNOW,"  PAGE ",IBPAG
"RTN","IBOA31",54,0)
 W !,"BILL",?10,"DATE",?54,"DATE OF",?63,"STATEMENT  STATEMENT  AMOUNT"
"RTN","IBOA31",55,0)
 W !,"NO.      PRINTED  ACTION/RATE TYPE   CLASSIFICATION    CARE    "
"RTN","IBOA31",56,0)
 W $S(IBIBRX=1:"FR/FL DT   TO/RL DT",1:"FROM DATE   TO DATE")
"RTN","IBOA31",57,0)
 W "  COLLECTED STATUS            TIMEFRAME OF BILL"
"RTN","IBOA31",58,0)
 W !,IBLINE
"RTN","IBOA31",59,0)
 W:IBIBRX !,?52,"'*' = outpt visit on same day as Rx fill date",!,IBLINE
"RTN","IBOA31",60,0)
 Q
"RTN","IBOA31",61,0)
 ;
"RTN","IBOA31",62,0)
PAUSE S IBX1="" R:$E(IOST,1,2)["C-" !!!,"Enter ""^"" to quit, or return to continue",IBX1:DTIME S IBQUIT=$S(IBX1["^":1,1:0) Q
"RTN","IBOA31",63,0)
 ;
"RTN","IBOA31",64,0)
END K ^UTILITY($J)
"RTN","IBOA31",65,0)
 ;***
"RTN","IBOA31",66,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOA31" D T1^%ZOSV ;stop rt clock
"RTN","IBOA31",67,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOA31",68,0)
 D END^IBCBB1
"RTN","IBOA31",69,0)
 K IBIFN1,IBQUIT,IBX1,IBDT,IBCNT,IBN,DFN,IBIFN,IBLINE,IBNOW,IBPAG,IBOPD,IBIBRX,DIRUT,DUOUT,DTOUT,X,Y
"RTN","IBOA31",70,0)
 K IBRDT,IBRF,IBRX
"RTN","IBOA31",71,0)
 D ^%ZISC G EN
"RTN","IBOBCRT")
0^23^B2862038
"RTN","IBOBCRT",1,0)
IBOBCRT ;ALB/RJS - IB-BILLING-CYCLE-REPORT 12/19/91
"RTN","IBOBCRT",2,0)
 ;;2.0;INTEGRATED BILLING;**153,199**;21-MAR-94
"RTN","IBOBCRT",3,0)
CATCCLK ;
"RTN","IBOBCRT",4,0)
 ;***
"RTN","IBOBCRT",5,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOBCRT" D T1^%ZOSV ;stop rt clock
"RTN","IBOBCRT",6,0)
 ;S XRTL=$ZU(0),XRTN="IBOBCRT-1" D T0^%ZOSV ;start rt clock
"RTN","IBOBCRT",7,0)
 ;***
"RTN","IBOBCRT",8,0)
 S DIC="^IBE(351,",DIC(0)="AEQMZ"
"RTN","IBOBCRT",9,0)
 S DIC("A")="Select MT Billing Clock by PATIENT NAME: "
"RTN","IBOBCRT",10,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOBCRT",11,0)
 D ^DIC
"RTN","IBOBCRT",12,0)
 I Y<0 G END
"RTN","IBOBCRT",13,0)
 S IBD0=$P(Y,"^",1)
"RTN","IBOBCRT",14,0)
 W ! D OPEN G END:POP
"RTN","IBOBCRT",15,0)
 I $D(IO("Q")) D QUEUED,HOME^%ZIS G CATCCLK
"RTN","IBOBCRT",16,0)
 U IO D DQ
"RTN","IBOBCRT",17,0)
 W ! S DIR(0)="E" D ^DIR I '$D(DIRUT) W @IOF G CATCCLK
"RTN","IBOBCRT",18,0)
 Q
"RTN","IBOBCRT",19,0)
OPEN ;
"RTN","IBOBCRT",20,0)
 S %ZIS="QM" D ^%ZIS
"RTN","IBOBCRT",21,0)
 Q
"RTN","IBOBCRT",22,0)
QUEUED ;
"RTN","IBOBCRT",23,0)
 S ZTRTN="DQ^IBOBCRT",ZTDESC="IB BILLING REPORT",ZTSAVE("IBD0")="" D ^%ZTLOAD W !!,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled")
"RTN","IBOBCRT",24,0)
 Q
"RTN","IBOBCRT",25,0)
HEADER ;
"RTN","IBOBCRT",26,0)
 S Y=DT X ^DD("DD")
"RTN","IBOBCRT",27,0)
 W !,Y,"            Billing Cycle Inquiry",?30,!!
"RTN","IBOBCRT",28,0)
 K Y
"RTN","IBOBCRT",29,0)
 Q
"RTN","IBOBCRT",30,0)
DQ ;
"RTN","IBOBCRT",31,0)
 ;***
"RTN","IBOBCRT",32,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOBCRT" D T1^%ZOSV ;stop rt clock
"RTN","IBOBCRT",33,0)
 ;S XRTL=$ZU(0),XRTN="IBOBCRT-2" D T0^%ZOSV ;start rt clock
"RTN","IBOBCRT",34,0)
 ;*** suppress initial form feed (to all but crts)
"RTN","IBOBCRT",35,0)
 W:$E(IOST,1,2)["C-" @IOF
"RTN","IBOBCRT",36,0)
 S D0=IBD0
"RTN","IBOBCRT",37,0)
 I $E(IOST,1,2)="P-" D HEADER
"RTN","IBOBCRT",38,0)
 K DXS D ^IBXBCR2 K DXS D ^IBXBCR K DXS
"RTN","IBOBCRT",39,0)
END ;
"RTN","IBOBCRT",40,0)
 ;***
"RTN","IBOBCRT",41,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOBCRT" D T1^%ZOSV ;stop rt clock
"RTN","IBOBCRT",42,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOBCRT",43,0)
 D ^%ZISC
"RTN","IBOBCRT",44,0)
 K D0,DIC,DIR,DIRUT,DXS,POP,Y,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,IBD0
"RTN","IBOBCRT",45,0)
 Q
"RTN","IBODISP")
0^24^B5663688
"RTN","IBODISP",1,0)
IBODISP ;ALB/AAS - INTEGRATED BILLING - OUTPUTS ; 8-MAR-91
"RTN","IBODISP",2,0)
 ;;2.0; INTEGRATED BILLING ;**17,199**; 21-MAR-94
"RTN","IBODISP",3,0)
 ;
"RTN","IBODISP",4,0)
EN ;
"RTN","IBODISP",5,0)
 ;***
"RTN","IBODISP",6,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN^IBODISP" D T1^%ZOSV ;stop rt clock
"RTN","IBODISP",7,0)
 ;S XRTL=$ZU(0),XRTN="EN^IBODISP-1" D T0^%ZOSV ;start rt clock
"RTN","IBODISP",8,0)
 ;  -display ib action by reference number
"RTN","IBODISP",9,0)
 S DIC="^IB(",DIC(0)="AEQM" D ^DIC K DIC G ENQ:+Y<1 S DA=+Y D DISP G EN
"RTN","IBODISP",10,0)
 ;***
"RTN","IBODISP",11,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN^IBODISP" D T1^%ZOSV ;stop rt clock
"RTN","IBODISP",12,0)
 Q
"RTN","IBODISP",13,0)
 ;
"RTN","IBODISP",14,0)
DISP S DIC="^IB(",DR="0:1" D EN^DIQ
"RTN","IBODISP",15,0)
 Q
"RTN","IBODISP",16,0)
ENQ K DIC,DA,DR,Y,X,IBQT
"RTN","IBODISP",17,0)
 Q
"RTN","IBODISP",18,0)
EN1 ;
"RTN","IBODISP",19,0)
 ;***
"RTN","IBODISP",20,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN1^IBODISP" D T1^%ZOSV ;stop rt clock
"RTN","IBODISP",21,0)
 ;S XRTL=$ZU(0),XRTN="EN1^IBODISP-1" D T0^%ZOSV ;start rt clock
"RTN","IBODISP",22,0)
 ;
"RTN","IBODISP",23,0)
 ;  -display ib action by patient [by date]
"RTN","IBODISP",24,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBODISP",25,0)
 S DIC="^DPT(",DIC(0)="AEQM" D ^DIC K DIC G EN1Q:+Y<1 S DFN=+Y
"RTN","IBODISP",26,0)
 D DATE^IBOUTL G:'IBEDT EN1
"RTN","IBODISP",27,0)
 ;  -loop through inverse dates by patient and display
"RTN","IBODISP",28,0)
 S S=2,IBDT=IBBDT-.0000001,(IBQUIT,IBOCNT)=0
"RTN","IBODISP",29,0)
 F IBI=0:0 S IBDT=$O(^IB("APTDT",DFN,IBDT)) Q:'IBDT!(IBDT>(IBEDT+.24))  F IBJJ=0:0 S IBJJ=$O(^IB("APTDT",DFN,IBDT,IBJJ)) Q:'IBJJ!('S)!($D(DTOUT))  S DA=IBJJ,IBOCNT=IBOCNT+1 I DA D DISP,PAUSE^IBOUTL G:IBQUIT EN1
"RTN","IBODISP",30,0)
 I IBOCNT<1 W !!,"No IB Actions Found for this Date Range",!!
"RTN","IBODISP",31,0)
 G EN1
"RTN","IBODISP",32,0)
EN1Q K DIC,DA,DR,IBEDT,IBBDT,IBDT,IBI,IBJ,IBJJ,IBOCNT,S,X,Y,DFN,D0,IBQUIT
"RTN","IBODISP",33,0)
 ;***
"RTN","IBODISP",34,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN1^IBODISP" D T1^%ZOSV ;stop rt clock
"RTN","IBODISP",35,0)
 Q
"RTN","IBODISP",36,0)
 ;
"RTN","IBODISP",37,0)
EN2 ;
"RTN","IBODISP",38,0)
 ;  -print list of ib actions
"RTN","IBODISP",39,0)
 ;***
"RTN","IBODISP",40,0)
 ;S XRTL=$ZU(0),XRTN="EN2^IBODISP-1" D T0^%ZOSV ;start rt clock
"RTN","IBODISP",41,0)
 W !!,"Print IB Action Entries by Date Added",!!," ** Please note that this output requires 132 columns **",!
"RTN","IBODISP",42,0)
 S DIC="^IB(",L=0,FLDS="[IB LIST]",BY="@12,@"
"RTN","IBODISP",43,0)
 D ASK G:$G(IBQT) ENQ
"RTN","IBODISP",44,0)
 S DHD="INTEGRATED BILLING ACTIONS FROM: "_FR(1)_" TO: "_TO(1)
"RTN","IBODISP",45,0)
 D EN1^DIP
"RTN","IBODISP",46,0)
 K DIC,L,FLDS,FR,BY,TO
"RTN","IBODISP",47,0)
 D ^%ZISC
"RTN","IBODISP",48,0)
 ;***
"RTN","IBODISP",49,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="EN2^IBODISP" D T1^%ZOSV ;stop rt clock
"RTN","IBODISP",50,0)
 Q
"RTN","IBODISP",51,0)
ASK ;
"RTN","IBODISP",52,0)
 N IBBDT,IBEDT
"RTN","IBODISP",53,0)
 D DATE^IBOUTL
"RTN","IBODISP",54,0)
 I (IBBDT<1)!(IBEDT<1) S IBQT=1 Q
"RTN","IBODISP",55,0)
 S FR=IBBDT_",?",TO=IBEDT_",?"
"RTN","IBODISP",56,0)
 S FR(1)=$$DAT1^IBOUTL(FR),TO(1)=$$DAT1^IBOUTL(TO)
"RTN","IBODISP",57,0)
 Q
"RTN","IBOHPT1")
0^25^B25381468
"RTN","IBOHPT1",1,0)
IBOHPT1 ;ALB/EMG -  REPORT OF ON HOLD CHARGES FOR A PATIENT ;JULY 22 1997
"RTN","IBOHPT1",2,0)
 ;;2.0;INTEGRATED BILLING;**70,95,142,199**;21-MAR-94
"RTN","IBOHPT1",3,0)
 ;
"RTN","IBOHPT1",4,0)
 ;
"RTN","IBOHPT1",5,0)
MAIN ;
"RTN","IBOHPT1",6,0)
 N IBQUIT,IBII,DIRUT,DUOUT,DTOUT,ZTIO,Y S IBQUIT=0
"RTN","IBOHPT1",7,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOHPT1",8,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC K DIC Q:Y<1  S DFN=+Y
"RTN","IBOHPT1",9,0)
 ;
"RTN","IBOHPT1",10,0)
 S DIR(0)="DA^::EX",DIR("A")="Start with DATE: "
"RTN","IBOHPT1",11,0)
 S DIR("?")="Enter the starting date for this report."
"RTN","IBOHPT1",12,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBSDT=+Y
"RTN","IBOHPT1",13,0)
 S DIR(0)="DA^"_+Y_":NOW:EX",DIR("A")="     Go to DATE: "
"RTN","IBOHPT1",14,0)
 S DIR("?")="Enter the ending date for this report."
"RTN","IBOHPT1",15,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBEDT=+Y
"RTN","IBOHPT1",16,0)
 ;
"RTN","IBOHPT1",17,0)
 S DIR(0)="Y",DIR("A")="Include Pharmacy Co-pay charges on this report",DIR("B")="NO"
"RTN","IBOHPT1",18,0)
 S DIR("?",1)="   Enter:  'Y' - to include Pharmacy Co-pay charges on this report"
"RTN","IBOHPT1",19,0)
 S DIR("?",2)="           'N' - to exclude Pharmacy Co-pay charges on this report"
"RTN","IBOHPT1",20,0)
 S DIR("?")="             '^' - to select a new patient"
"RTN","IBOHPT1",21,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBIBRX=Y
"RTN","IBOHPT1",22,0)
 ;
"RTN","IBOHPT1",23,0)
QUEUED ; entry point if queued
"RTN","IBOHPT1",24,0)
 ;***
"RTN","IBOHPT1",25,0)
 K ^TMP($J)
"RTN","IBOHPT1",26,0)
 D:'$G(IBQUIT) DEVICE D:'$G(IBQUIT) CHRGS,REPORT^IBOHPT2
"RTN","IBOHPT1",27,0)
 D EXIT
"RTN","IBOHPT1",28,0)
 ;***
"RTN","IBOHPT1",29,0)
 Q
"RTN","IBOHPT1",30,0)
EXIT ;
"RTN","IBOHPT1",31,0)
 K ^TMP($J)
"RTN","IBOHPT1",32,0)
 K DFN,IBEND,IBSDT,IBEDT,IBIBRX,IBCN,IBDT,IBIFN,X
"RTN","IBOHPT1",33,0)
 K IBRDT,IBRF,IBRX,IBRXN
"RTN","IBOHPT1",34,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOHPT1",35,0)
 D ^%ZISC
"RTN","IBOHPT1",36,0)
 Q
"RTN","IBOHPT1",37,0)
DEVICE ;
"RTN","IBOHPT1",38,0)
 I $D(ZTQUEUED) Q
"RTN","IBOHPT1",39,0)
 W !!,*7,"*** Margin width of this output is 132 ***"
"RTN","IBOHPT1",40,0)
 W !,"*** This output should be queued ***"
"RTN","IBOHPT1",41,0)
 S %ZIS="QM" D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBOHPT1",42,0)
 I $D(IO("Q")) S ZTRTN="QUEUED^IBOHPT1",ZTIO=ION,ZTDESC="ON HOLD CHARGE INFO/PT",ZTSAVE("IB*")="",ZTSAVE("DFN")="" D ^%ZTLOAD W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED") D HOME^%ZIS K ZTSK S IBQUIT=1 Q
"RTN","IBOHPT1",43,0)
 U IO
"RTN","IBOHPT1",44,0)
 Q
"RTN","IBOHPT1",45,0)
 ; indexes records that should be included in report
"RTN","IBOHPT1",46,0)
 ;
"RTN","IBOHPT1",47,0)
CHRGS ; charges on hold
"RTN","IBOHPT1",48,0)
 N DATE,IBN,IBND,A,B,C,D,E,IBNX
"RTN","IBOHPT1",49,0)
 S IBN=0 F  S IBN=$O(^IB("C",DFN,IBN)) Q:'IBN  S IBND=$G(^IB(IBN,0)) D:IBND
"RTN","IBOHPT1",50,0)
 .I 'IBIBRX,$E($G(^IBE(350.1,+$P(IBND,"^",3),0)),1,3)="PSO" Q
"RTN","IBOHPT1",51,0)
 .Q:$P(IBND,"^",8)["ADMISSION"
"RTN","IBOHPT1",52,0)
 .Q:'$P($G(^IB(IBN,1)),"^",6)
"RTN","IBOHPT1",53,0)
 .Q:'$D(^IB("APDT",IBN))
"RTN","IBOHPT1",54,0)
 .S (C,D)="",C=$O(^IB("APDT",IBN,C)),D=$O(^IB("APDT",IBN,C,D))
"RTN","IBOHPT1",55,0)
 .S E=$P($G(^IB(D,0)),U,3)
"RTN","IBOHPT1",56,0)
 .S A=$P($G(^IBE(350.1,E,0)),U,5)
"RTN","IBOHPT1",57,0)
 .S IBNX=$S(A=2:$P($Q(^IB("APDT",IBN,C,D)),")",1),A=3:$P($Q(^IB("APDT",IBN,C,D)),")",1),1:IBN)
"RTN","IBOHPT1",58,0)
 .I (A=2)!(A=3) D
"RTN","IBOHPT1",59,0)
 ..I IBNX["[""" S IBNX="^"_$P(IBNX,"]",2)
"RTN","IBOHPT1",60,0)
 .I $P(IBNX,",",4)>0 S IBNX=$P(IBNX,",",4)
"RTN","IBOHPT1",61,0)
 .S DATE=$P($G(^IB(+$P(IBND,"^",1),0)),"^",17)
"RTN","IBOHPT1",62,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",5)
"RTN","IBOHPT1",63,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",2)\1
"RTN","IBOHPT1",64,0)
 .I (DATE>(IBSDT-.0001))&(DATE<(IBEDT+.9999)) S ^TMP($J,"IB",-DATE,IBNX)="" D BILLS
"RTN","IBOHPT1",65,0)
 Q
"RTN","IBOHPT1",66,0)
 ;
"RTN","IBOHPT1",67,0)
BILLS ; find bills for charges on hold
"RTN","IBOHPT1",68,0)
 N IBFR,IBT,IBATYPE,IBTO
"RTN","IBOHPT1",69,0)
 S IBATYPE=$S($P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")["OPT":"O",$P($G(^IBE(350.1,+IBND,"^",3,0)),"^")["PSO":"RX",1:"I")
"RTN","IBOHPT1",70,0)
 S IBFR=$P(IBND,"^",14),IBTO=$P(IBND,"^",15)
"RTN","IBOHPT1",71,0)
 I IBATYPE="I" D INP
"RTN","IBOHPT1",72,0)
 I IBATYPE="O" D OPT
"RTN","IBOHPT1",73,0)
 E  D RX
"RTN","IBOHPT1",74,0)
 Q
"RTN","IBOHPT1",75,0)
INP ; inpatient bills
"RTN","IBOHPT1",76,0)
 N IBEV,IBBILL,IBT,X,X1,X2,IBEND,IBOK
"RTN","IBOHPT1",77,0)
 S IBEV=$P(IBND,"^",16) Q:'IBEV  ; parent event
"RTN","IBOHPT1",78,0)
 S IBEV=($P($G(^IB(IBEV,0)),"^",17)\1) Q:'IBEV  ; date of parent event
"RTN","IBOHPT1",79,0)
 S X1=IBEV,X2=1 D C^%DTC S IBEND=X
"RTN","IBOHPT1",80,0)
 S IBT=(IBEV-.0001) F  S IBT=$O(^DGCR(399,"D",IBT)) Q:'IBT!(IBT'<IBEND)  S IBBILL=0 F  S IBBILL=$O(^DGCR(399,"D",IBT,IBBILL)) Q:IBBILL=""  D
"RTN","IBOHPT1",81,0)
 .D INPTCK
"RTN","IBOHPT1",82,0)
 .I IBOK S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBOHPT1",83,0)
 Q
"RTN","IBOHPT1",84,0)
 ;
"RTN","IBOHPT1",85,0)
INPTCK ; does bill belong to charge? returns IBOK=0 if no
"RTN","IBOHPT1",86,0)
 N IBBILL0,IBBILLU
"RTN","IBOHPT1",87,0)
 S IBBILL0=$G(^DGCR(399,IBBILL,0)),IBBILLU=$G(^("U"))
"RTN","IBOHPT1",88,0)
 S IBOK=1
"RTN","IBOHPT1",89,0)
CK1 ; for same patient?
"RTN","IBOHPT1",90,0)
 I DFN=$P(IBBILL0,"^",2)
"RTN","IBOHPT1",91,0)
 S IBOK=$T
"RTN","IBOHPT1",92,0)
 Q:'IBOK
"RTN","IBOHPT1",93,0)
CK2 ; same type- inp or opt?
"RTN","IBOHPT1",94,0)
 N B S B=$S(+$P(IBBILL0,"^",5)<3:"I",1:"O")
"RTN","IBOHPT1",95,0)
 I B=IBATYPE
"RTN","IBOHPT1",96,0)
 S IBOK=$T
"RTN","IBOHPT1",97,0)
 Q:'IBOK
"RTN","IBOHPT1",98,0)
CK3 ; overlap in date range?
"RTN","IBOHPT1",99,0)
 N F,T
"RTN","IBOHPT1",100,0)
 S F=+IBBILLU,T=$P(IBBILLU,"^",2)
"RTN","IBOHPT1",101,0)
 I (IBTO<F)!(IBFR>T)
"RTN","IBOHPT1",102,0)
 S IBOK='$T
"RTN","IBOHPT1",103,0)
 Q:'IBOK
"RTN","IBOHPT1",104,0)
CK4 ; insurance bill?
"RTN","IBOHPT1",105,0)
 I $P(IBBILL0,"^",11)="i"
"RTN","IBOHPT1",106,0)
 S IBOK=$T
"RTN","IBOHPT1",107,0)
 Q
"RTN","IBOHPT1",108,0)
OPT ; outpatient bills
"RTN","IBOHPT1",109,0)
 N X,IBV,IBBILL,IBOK,IBBILL0
"RTN","IBOHPT1",110,0)
 S IBV=(IBFR\1)-.0001 F  S IBV=$O(^DGCR(399,"AOPV",DFN,IBV)) Q:'IBV!(IBV>IBTO)  S IBBILL=0 D
"RTN","IBOHPT1",111,0)
 .F  S IBBILL=$O(^DGCR(399,"AOPV",DFN,IBV,IBBILL)) Q:('IBBILL)  D
"RTN","IBOHPT1",112,0)
 ..Q:$D(^TMP($J,"IB",-DATE,IBNX,IBBILL))
"RTN","IBOHPT1",113,0)
 ..S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 Q:'IBOK
"RTN","IBOHPT1",114,0)
 ..S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBOHPT1",115,0)
 Q
"RTN","IBOHPT1",116,0)
RX ; rx refill bills
"RTN","IBOHPT1",117,0)
 Q:'IBIBRX
"RTN","IBOHPT1",118,0)
 S (IBRX,IBRXN,IBRF,IBRDT)=0 N IENS
"RTN","IBOHPT1",119,0)
 I $P(IBND,"^",4)'["52:" Q
"RTN","IBOHPT1",120,0)
 ;
"RTN","IBOHPT1",121,0)
 S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBOHPT1",122,0)
 ;
"RTN","IBOHPT1",123,0)
 I +IBRF>0 S IENS=+IBRF_","_+IBRXN_",",IBRDT=$$GET1^DIQ(52.1,IENS,.01,"I")
"RTN","IBOHPT1",124,0)
 I +IBRF=0 S IENS=+IBRXN_",",IBRDT=$$GET1^DIQ(52,IENS,22,"I")
"RTN","IBOHPT1",125,0)
 ;
"RTN","IBOHPT1",126,0)
 Q:(IBRX="")!('IBRDT)
"RTN","IBOHPT1",127,0)
 N X,IBBILL,IBBILL0,IBFILL,IBFILL0,IBOK S IBBILL=0
"RTN","IBOHPT1",128,0)
 S IBFILL=0 F  S IBFILL=$O(^IBA(362.4,"B",IBRX,IBFILL)) Q:IBFILL=""  D
"RTN","IBOHPT1",129,0)
 .S IBFILL0=$G(^IBA(362.4,IBFILL,0)) I $P(IBFILL0,"^",3)'=IBRDT Q
"RTN","IBOHPT1",130,0)
 .S IBBILL=+$P(IBFILL0,"^",2) I 'IBBILL Q
"RTN","IBOHPT1",131,0)
 .S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 I 'IBOK Q
"RTN","IBOHPT1",132,0)
 .S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBOHPT1",133,0)
 Q
"RTN","IBOLK")
0^26^B17475445
"RTN","IBOLK",1,0)
IBOLK ;ALB/AAS - INTEGRATED BILLING - DISPLAY BY BILL NUMBER ; 6-MAR-91
"RTN","IBOLK",2,0)
 ;;2.0; INTEGRATED BILLING ;**199**; 21-MAR-94
"RTN","IBOLK",3,0)
 ;
"RTN","IBOLK",4,0)
% ;
"RTN","IBOLK",5,0)
 ;***
"RTN","IBOLK",6,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOLK" D T1^%ZOSV ;stop rt clock
"RTN","IBOLK",7,0)
 ;S XRTL=$ZU(0),XRTN="IBOLK-1" D T0^%ZOSV ;start rt clock
"RTN","IBOLK",8,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOLK",9,0)
 S DIC("A")="Select CHARGE ID or PATIENT NAME: ",DIC="^PRCA(430,",DIC(0)="AEQM" D ^DIC K DIC G END1:+Y<1 S IBIL=$P(Y,"^",2)
"RTN","IBOLK",10,0)
 S IBIFN=$O(^DGCR(399,"B",$P(IBIL,"-",2),0))
"RTN","IBOLK",11,0)
 I '$D(^IB("ABIL",IBIL)),'IBIFN W !!,"Billing has no Record of this Charge ID.",! G %
"RTN","IBOLK",12,0)
 ;
"RTN","IBOLK",13,0)
BRIEF R !,"(B)rief or (F)ull Inquiry: B// ",X:DTIME G:X="^"!('$T) END1 S:X="" X="B" S X=$E(X)
"RTN","IBOLK",14,0)
 I "BFbf"'[X D  G BRIEF
"RTN","IBOLK",15,0)
 . W !!?5,"Enter: '<CR>'  -  To select the Brief Inquiry."
"RTN","IBOLK",16,0)
 . W !?12,"'F'     -  To select the Full Inquiry.  This option will"
"RTN","IBOLK",17,0)
 . W !?23,"include the Address Inquiry, and more detailed"
"RTN","IBOLK",18,0)
 . W !?23,"information for Pharmacy Co-Pay bills."
"RTN","IBOLK",19,0)
 . W !?12,"'^'     -  To quit this option.",!
"RTN","IBOLK",20,0)
 W $S("Bb"[X:"   BRIEF",1:"   FULL") S IBFULL="Ff"[X
"RTN","IBOLK",21,0)
 I IBIFN S IBAC=8,IBQUIT=0
"RTN","IBOLK",22,0)
 ;
"RTN","IBOLK",23,0)
DEV W ! S %ZIS="QM",%ZIS("A")="Output Device: " D ^%ZIS G:POP END
"RTN","IBOLK",24,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q") D HOME^%ZIS W ! G %
"RTN","IBOLK",25,0)
 . S ZTDESC="IB Print Actions by Bill Number"
"RTN","IBOLK",26,0)
 . S ZTRTN=$S(IBIFN:"VIEW^IBCNQ",1:"EN^IBOLK")
"RTN","IBOLK",27,0)
 . S ZTSAVE("IBFULL")="",ZTSAVE("IBIL")="",ZTSAVE("IBIFN")=""
"RTN","IBOLK",28,0)
 . I IBIFN F I="IBAC","IBQUIT" S ZTSAVE(I)=""
"RTN","IBOLK",29,0)
 ;
"RTN","IBOLK",30,0)
 U IO
"RTN","IBOLK",31,0)
 ;***
"RTN","IBOLK",32,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOLK" D T1^%ZOSV ;stop rt clock
"RTN","IBOLK",33,0)
 I 'IBIFN D EN G %
"RTN","IBOLK",34,0)
 D VIEW^IBCNQ,Q^IBCNQ,END1 G %
"RTN","IBOLK",35,0)
 ;
"RTN","IBOLK",36,0)
EN ;  -Entry to display IB Action data for an AR Bill number
"RTN","IBOLK",37,0)
 ;  -Input   IBIL = external form of bill number, ie 500-K10001
"RTN","IBOLK",38,0)
 ;           IBFULL = 1 for full profile logic, 0 for brief description
"RTN","IBOLK",39,0)
 ;***
"RTN","IBOLK",40,0)
 ;S XRTL=$ZU(0),XRTN="IBOLK-2" D T0^%ZOSV ;start rt clock
"RTN","IBOLK",41,0)
 S IBN=$O(^IB("ABIL",IBIL,"")) G:'$D(^IB(IBN,0)) ENQ
"RTN","IBOLK",42,0)
 S IBTOTL=0,IBQUIT="",IBPAG=0 D NOW^%DTC S IBHDT=$$DAT2^IBOUTL($E(%,1,12)) D HDR
"RTN","IBOLK",43,0)
 ;
"RTN","IBOLK",44,0)
 S IBN="" F IBI=0:0 S IBN=$O(^IB("ABIL",IBIL,IBN)) Q:'IBN  I $D(^IB(IBN,0)) D LINE Q:IBQUIT
"RTN","IBOLK",45,0)
 I 'IBQUIT D TOTAL,PAUSE,^IBOLK1:IBFULL&('IBQUIT)
"RTN","IBOLK",46,0)
ENQ D END Q
"RTN","IBOLK",47,0)
 ;
"RTN","IBOLK",48,0)
LINE ;  -find data for one line, write line, accumulate totals
"RTN","IBOLK",49,0)
 I '$D(IBTRAN),$Y>(IOSL-5) D PAUSE Q:IBQUIT  D HDR1
"RTN","IBOLK",50,0)
 S IBND=^IB(IBN,0),IBND1=$G(^(1))
"RTN","IBOLK",51,0)
 I IBFULL,$D(^IBE(350.1,+$P(IBND,"^",3),30)) W ! S X1=$P($P($P(IBND,"^",4),";",1),":",2),X2=$P($P($P(IBND,"^",4),";",2),":",2),X=X1_"^"_$S(X2:X2,1:0) X ^(30)
"RTN","IBOLK",52,0)
 S IBTYP=$G(^IBE(350.1,+$P(IBND,"^",3),0)),IBSEQNO=$P(IBTYP,"^",5)
"RTN","IBOLK",53,0)
 W ! S Y=$P($P(IBND1,"^",2),".",1) D DT^DIQ
"RTN","IBOLK",54,0)
 W ?15,$E($P($P(IBTYP,"^")," ",2,99),1,20),?37,$E($P(IBND,"^",8),1,20),?60,$J($P(IBND,"^",6),5)
"RTN","IBOLK",55,0)
 S IBCHRG=$P(IBND,"^",7) I IBSEQNO=2 S IBCHRG=(-IBCHRG) ;cancel types are decrease adjustments
"RTN","IBOLK",56,0)
 S X=IBCHRG,X2="2$",X3=10 D COMMA^%DTC W ?69,X
"RTN","IBOLK",57,0)
 S IBTOTL=IBTOTL+IBCHRG
"RTN","IBOLK",58,0)
 I $P(IBND,"^",10),IBSEQNO=2 W !,?5,"Charge Removal Reason: ",$S($D(^IBE(350.3,$P(IBND,"^",10),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","IBOLK",59,0)
 Q
"RTN","IBOLK",60,0)
 ;
"RTN","IBOLK",61,0)
HDR S IBND=^IB(IBN,0),DFN=+$P(IBND,"^",2),IBNAME=$$PT^IBEFUNC(DFN)
"RTN","IBOLK",62,0)
HDR1 S IBPAG=IBPAG+1 I $E(IOST,1,2)["C-"!(IBPAG>1) W @IOF,*13
"RTN","IBOLK",63,0)
 W $E($P(IBNAME,"^"),1,20),"   ",$P(IBNAME,"^",2),?38,IBIL,?51,IBHDT,?72,"PAGE: ",IBPAG
"RTN","IBOLK",64,0)
 D DISP^IBARXEU(DFN,DT,2) W !
"RTN","IBOLK",65,0)
 W:'IBFULL !,"DATE",?15,"CHARGE TYPE",?37,"BRIEF DESCRIPTION",?62,"UNITS",?73,"CHARGE"
"RTN","IBOLK",66,0)
 S IBLINE="",$P(IBLINE,"=",IOM)="" W !,IBLINE K IBLINE
"RTN","IBOLK",67,0)
 Q
"RTN","IBOLK",68,0)
 ;
"RTN","IBOLK",69,0)
TOTAL W !?67,"------------" S X=IBTOTL,X2="2$",X3=12 D COMMA^%DTC
"RTN","IBOLK",70,0)
 W !,?67,X
"RTN","IBOLK",71,0)
 Q
"RTN","IBOLK",72,0)
 ;
"RTN","IBOLK",73,0)
PAUSE Q:$E(IOST,1,2)'["C-"
"RTN","IBOLK",74,0)
 F IBJ=$Y:1:(IOSL-4) W !
"RTN","IBOLK",75,0)
 S DIR(0)="E" D ^DIR K DIR I $D(DIRUT)!($D(DUOUT)) S IBQUIT=1 K DIRUT,DTOUT,DUOUT
"RTN","IBOLK",76,0)
 Q
"RTN","IBOLK",77,0)
 ;
"RTN","IBOLK",78,0)
END1 K IBFULL
"RTN","IBOLK",79,0)
END W !
"RTN","IBOLK",80,0)
 ;***
"RTN","IBOLK",81,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOLK" D T1^%ZOSV ;stop rt clock
"RTN","IBOLK",82,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBOLK",83,0)
 K X,X2,X3,Y,DFN,IBIFN,IBAC,I,IB,IBIL,IBI,IBJ,IBNAME,IBLINE,IBN,IBND,IBND1,IBCHRG,IBSEQNO,IBTYP,IBTOTL,ZTSK,IBHDT,IBPAG,IBQUIT,DN,D0,DUOUT,DTOUT,VA,VADM,VAERR
"RTN","IBOLK",84,0)
 D ^%ZISC
"RTN","IBOLK",85,0)
 Q
"RTN","IBOLK",86,0)
 ;
"RTN","IBOLK",87,0)
ENF ;  -entry point for AR to print full profile for IB actions for
"RTN","IBOLK",88,0)
 ;   an ar transaction number.
"RTN","IBOLK",89,0)
 ;  -input   x = ar transaction number ($p(^ib(ibn,0),u,12)
"RTN","IBOLK",90,0)
 ;
"RTN","IBOLK",91,0)
 S IBFULL=1
"RTN","IBOLK",92,0)
 ;
"RTN","IBOLK",93,0)
ENB ;  -entry point for AR to print brief profile for IB actions for
"RTN","IBOLK",94,0)
 ;   an ar transaction number.
"RTN","IBOLK",95,0)
 ;  -input   x = ar transaction number
"RTN","IBOLK",96,0)
 ;
"RTN","IBOLK",97,0)
 S IBTOTL=0,IBPAG=0,IBQUIT="" S:'$D(IBFULL) IBFULL=0
"RTN","IBOLK",98,0)
 S IBTRAN=X
"RTN","IBOLK",99,0)
 S IBN="" F  S IBN=$O(^IB("AT",IBTRAN,IBN)) Q:IBN=""  D LINE
"RTN","IBOLK",100,0)
 K D0,DN,X,X2,X3,Y,IBFULL,IBTOTL,IBPAG,IBQUIT,IBTRAN,IBN,IBND,IBND1,IBSEQNO,IBTYP,IBCHRG
"RTN","IBOLK",101,0)
 Q
"RTN","IBOMTP")
0^28^B2507452
"RTN","IBOMTP",1,0)
IBOMTP ;ALB/CPM - MEANS TEST BILLING PROFILE ; 10-DEC-91
"RTN","IBOMTP",2,0)
 ;;2.0;INTEGRATED BILLING;**153,199**;21-MAR-94
"RTN","IBOMTP",3,0)
 ;
"RTN","IBOMTP",4,0)
 S:'$D(DTIME) DTIME=300 D HOME^%ZIS
"RTN","IBOMTP",5,0)
 ;
"RTN","IBOMTP",6,0)
ASK ;
"RTN","IBOMTP",7,0)
 ;***
"RTN","IBOMTP",8,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOMTP" D T1^%ZOSV ;stop rt clock
"RTN","IBOMTP",9,0)
 ;S XRTL=$ZU(0),XRTN="IBOMTP-1" D T0^%ZOSV ;start rt clock
"RTN","IBOMTP",10,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBOMTP",11,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC K DIC G END:Y<1 S IBDFN=+Y
"RTN","IBOMTP",12,0)
 ;
"RTN","IBOMTP",13,0)
 ; Select Start and End dates.
"RTN","IBOMTP",14,0)
BDT S %DT="AEPX",%DT("A")="Start with DATE: ",%DT("B")="OCT 01, 1990" D ^%DT K %DT G END:Y<0 S IBBDT=Y
"RTN","IBOMTP",15,0)
EDT S Y=DT D DD^%DT S %DT="EX" W !,"Go to DATE: ",Y,"//" R X:DTIME
"RTN","IBOMTP",16,0)
 G END:'$T!(X["^") S:X="" X=DT D ^%DT G EDT:Y<0 S IBEDT=Y
"RTN","IBOMTP",17,0)
 I Y<IBBDT W *7," ??",!,"ENDING DATE must follow BEGINNING DATE.",! G BDT
"RTN","IBOMTP",18,0)
 ;
"RTN","IBOMTP",19,0)
 ; Select an output device.
"RTN","IBOMTP",20,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBOMTP",21,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q") D HOME^%ZIS,END W ! G ASK
"RTN","IBOMTP",22,0)
 . S ZTRTN="^IBOMTP1",ZTDESC="MEANS TEST BILLING PROFILE"
"RTN","IBOMTP",23,0)
 . S (ZTSAVE("IBBDT"),ZTSAVE("IBEDT"),ZTSAVE("IBDFN"))=""
"RTN","IBOMTP",24,0)
 U IO
"RTN","IBOMTP",25,0)
 ;***
"RTN","IBOMTP",26,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOMTP" D T1^%ZOSV ;stop rt clock
"RTN","IBOMTP",27,0)
 D ^IBOMTP1 ; generate report
"RTN","IBOMTP",28,0)
 D END W ! G ASK ; re-run for next patient
"RTN","IBOMTP",29,0)
 ;
"RTN","IBOMTP",30,0)
END ;
"RTN","IBOMTP",31,0)
 K %DT,IBDFN,IBBDT,IBEDT,X,Y,ZTSK
"RTN","IBOMTP",32,0)
 ;***
"RTN","IBOMTP",33,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBOMTP" D T1^%ZOSV ;stop rt clock
"RTN","IBOMTP",34,0)
 Q
"RTN","IBRREL")
0^29^B24689660
"RTN","IBRREL",1,0)
IBRREL ;ALB/CPM - RELEASE MEANS TEST CHARGES 'ON HOLD' ; 03-MAR-92
"RTN","IBRREL",2,0)
 ;;2.0;INTEGRATED BILLING;**95,153,199**;21-MAR-94
"RTN","IBRREL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBRREL",4,0)
 ;
"RTN","IBRREL",5,0)
EN ; Entry point for stand-alone 'release' option
"RTN","IBRREL",6,0)
 I '$D(^IB("AH")) W !!,"There are no patients with charges 'on hold' at this time.",! Q
"RTN","IBRREL",7,0)
 ;
"RTN","IBRREL",8,0)
 D HOME^%ZIS
"RTN","IBRREL",9,0)
 W !!,"This option is used to release Means Test charges which have been"
"RTN","IBRREL",10,0)
 W !,"placed 'on hold.'  Please enter a patient with charges 'on hold,' and these"
"RTN","IBRREL",11,0)
 W !,"charges will be displayed and may be selected to be released to Accounts",!,"Receivable.",!
"RTN","IBRREL",12,0)
 ;
"RTN","IBRREL",13,0)
ASK ;
"RTN","IBRREL",14,0)
 ;***
"RTN","IBRREL",15,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBRREL" D T1^%ZOSV ;stop rt clock
"RTN","IBRREL",16,0)
 ;S XRTL=$ZU(0),XRTN="IBRREL-1" D T0^%ZOSV ;start rt clock
"RTN","IBRREL",17,0)
 ;
"RTN","IBRREL",18,0)
 R !,"Select PATIENT NAME: ",X:DTIME G END:"^"[$E(X)
"RTN","IBRREL",19,0)
 I $E(X,1,2)="??" D HLP1 G ASK
"RTN","IBRREL",20,0)
 I $E(X)="?" D HLP G ASK
"RTN","IBRREL",21,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBRREL",22,0)
 S DIC="^DPT(",DIC(0)="QME" D ^DIC K DIC G ASK:Y<1 S DFN=+Y
"RTN","IBRREL",23,0)
 ;
"RTN","IBRREL",24,0)
 K IBA,PRCABN
"RTN","IBRREL",25,0)
 S IBI=0 F IBNUM=1:1 S IBI=$O(^IB("AH",DFN,IBI)) Q:'IBI  S IBA(IBNUM)=IBI
"RTN","IBRREL",26,0)
 I '$D(IBA) W !!,"This patient does not have any charges 'on hold.'",! G ASK
"RTN","IBRREL",27,0)
 ;
"RTN","IBRREL",28,0)
 S IBPT=$$PT^IBEFUNC(DFN) W @IOF,$P(IBPT,"^"),"      Pt ID: ",$P(IBPT,"^",2),! S I="",$P(I,"-",80)="" W I K I
"RTN","IBRREL",29,0)
 ;
"RTN","IBRREL",30,0)
 ; - display header and list charges
"RTN","IBRREL",31,0)
RESUME W !!,"The following IB Actions ",$S($D(PRCABN):"associated with this bill",1:"for this patient")," are ON HOLD:" D HDR
"RTN","IBRREL",32,0)
 S IBQ=0 F IBNUM=1:1 Q:'$D(IBA(IBNUM))  D:'(IBNUM#15)  Q:IBQ  S IBN=IBA(IBNUM) D LST
"RTN","IBRREL",33,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBRREL",34,0)
 ;
"RTN","IBRREL",35,0)
 ; - prompt user to select IB Actions
"RTN","IBRREL",36,0)
 S DIR(0)="LA^1:"_(IBNUM-1)_"^K:X[""."" X",DIR("A")="Select IB Action"_$E("s",IBNUM>2)_" (REF #) to release (or '^' to exit): ",DIR("?")="^D HELP^IBRREL"
"RTN","IBRREL",37,0)
 W ! D ^DIR K DIR I $D(DIRUT)!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBRREL",38,0)
 ;
"RTN","IBRREL",39,0)
 S IBRANGE=Y,IBSEQNO=1,IBDUZ=DUZ
"RTN","IBRREL",40,0)
 ;
"RTN","IBRREL",41,0)
 S DIR(0)="Y",DIR("A")="OK to pass "_$S($P(Y,",",2):"these charges",1:"this charge")_" to Accounts Receivable"
"RTN","IBRREL",42,0)
 D ^DIR K DIR I 'Y!($D(DIRUT))!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBRREL",43,0)
 ;
"RTN","IBRREL",44,0)
 ; - pass charges to Accounts Receivable
"RTN","IBRREL",45,0)
 W !!,"Passing charges to Accounts Receivable...",! D HDR
"RTN","IBRREL",46,0)
 F IBCTR=1:1 S IBNUM=$P(IBRANGE,",",IBCTR) Q:'IBNUM  I $D(IBA(IBNUM)) S IBNOS=IBA(IBNUM) D ^IBR,ERR:Y<1 I Y>0 S IBN=IBA(IBNUM) D LST
"RTN","IBRREL",47,0)
 W !!,"The charge"_$E("s",$P(IBRANGE,",",2)>0)_" listed above "_$S($P(IBRANGE,",",2):"have",1:"has")_" been passed to Accounts Receivable.",!
"RTN","IBRREL",48,0)
 ;
"RTN","IBRREL",49,0)
 I '$D(PRCABN) W !! S DIR(0)="E" D ^DIR K DIR D END W ! G ASK
"RTN","IBRREL",50,0)
 ;
"RTN","IBRREL",51,0)
END K DIC,DIRUT,DUOUT,DTOUT,IBA,IBAFY,IBARTYP,IBATYP,IBCTR,IBN,IBDA,IBDUZ
"RTN","IBRREL",52,0)
 K IBFAC,IBI,IBIL,IBRANGE,IBNOS,IBNUM,IBPT,IBQ,IBSEQNO,IBSERV,IBSITE
"RTN","IBRREL",53,0)
 K IBTOTL,IBTRAN,IBWHER,VA,VAERR,VADM
"RTN","IBRREL",54,0)
 K:'$D(PRCABN) DFN
"RTN","IBRREL",55,0)
 ;***
"RTN","IBRREL",56,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBRREL" D T1^%ZOSV ;stop rt clock
"RTN","IBRREL",57,0)
 Q
"RTN","IBRREL",58,0)
 ;
"RTN","IBRREL",59,0)
 ;
"RTN","IBRREL",60,0)
HDR ; Display charge header.
"RTN","IBRREL",61,0)
 N IBLINE S $P(IBLINE,"=",81)=""
"RTN","IBRREL",62,0)
 W !,IBLINE,!," REF   Action ID  Bill Type",?42,"Bill #",?51,"Fr/Fl Dt",?61,"To/Rls Dt",?73,"Charge"
"RTN","IBRREL",63,0)
 W !,IBLINE Q
"RTN","IBRREL",64,0)
 ;
"RTN","IBRREL",65,0)
LST ; Display individual IB Action.
"RTN","IBRREL",66,0)
 N IBND,IBND1,IBRXN,IBRX,IBRF,IBRDT,IENS
"RTN","IBRREL",67,0)
 S IBND=$G(^IB(IBN,0)),IBND1=$G(^IB(IBN,1)),(IBRXN,IBRX,IBRF,IBRDT)=0
"RTN","IBRREL",68,0)
 I $P(IBND,"^",4)["52:" S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBRREL",69,0)
 I IBRF>0 S IENS=+IBRF_","_+IBRXN_",",IBRDT=$$GET1^DIQ(52.1,IENS,.01,"I")
"RTN","IBRREL",70,0)
 E  S IENS=+IBRXN_",",IBRDT=$$GET1^DIQ(52,IENS,22,"I")
"RTN","IBRREL",71,0)
 W !?1,$J(IBNUM,2),?7,$J(+IBND,9)
"RTN","IBRREL",72,0)
 W ?18,$S(IBRXN>0:"Rx #: "_IBRX_$S(IBRF>0:"("_IBRF_")",1:""),1:$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^",8))
"RTN","IBRREL",73,0)
 W ?42,$P($P(IBND,"^",11),"-",2)
"RTN","IBRREL",74,0)
 W ?51,$$DAT1^IBOUTL($S(IBRXN>0:IBRDT,1:$P(IBND,"^",14)))
"RTN","IBRREL",75,0)
 W ?61,$$DAT1^IBOUTL($S($P(IBND,"^",15)'="":($P(IBND,"^",15)),1:$P(IBND1,"^",2)))
"RTN","IBRREL",76,0)
 W ?70,$J(+$P(IBND,"^",7),9,2)
"RTN","IBRREL",77,0)
 Q
"RTN","IBRREL",78,0)
 ;
"RTN","IBRREL",79,0)
ERR ; Display error message.
"RTN","IBRREL",80,0)
 W !?1,$J(IBNUM,2),?7,"Error encountered - a separate bulletin has been posted"
"RTN","IBRREL",81,0)
 Q
"RTN","IBRREL",82,0)
 ;
"RTN","IBRREL",83,0)
HLP ; Display basic help message.
"RTN","IBRREL",84,0)
 W !!,"Enter:    the name of a patient with charges 'on hold,' or"
"RTN","IBRREL",85,0)
 W !?10,"'??' --  to see all patients with charges 'on hold,' or"
"RTN","IBRREL",86,0)
 W !?10,"'^'  --  to quit this option.",!
"RTN","IBRREL",87,0)
 Q
"RTN","IBRREL",88,0)
 ;
"RTN","IBRREL",89,0)
HLP1 ; Display all patients with charges 'on hold.'
"RTN","IBRREL",90,0)
 N DFN,I,IBQ,PID
"RTN","IBRREL",91,0)
 W !!,"The following patients have charges 'on hold:'"
"RTN","IBRREL",92,0)
 S (DFN,IBQ)=0 F I=1:1 S DFN=$O(^IB("AH",DFN)) Q:'DFN  D:'(I#15)  Q:IBQ  S PID=$$PT^IBEFUNC(DFN) W !?3,$P(PID,"^"),$J("",10),$P(PID,"^",2)
"RTN","IBRREL",93,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBRREL",94,0)
 W ! Q
"RTN","IBRREL",95,0)
 ;
"RTN","IBRREL",96,0)
HELP ; Help for the 'Select' prompt.
"RTN","IBRREL",97,0)
 W !!?4,"Please enter a list or range of IB Actions (i.e. 1,3,5 or 2-4,8), none"
"RTN","IBRREL",98,0)
 W !?4,"greater than ",IBNUM-1,", to be passed to Accounts Receivable, or '^' to quit."
"RTN","IBRREL",99,0)
 Q
"RTN","IBRREL",100,0)
 ;
"RTN","IBRREL",101,0)
 ;
"RTN","IBRREL",102,0)
AR ; Accounts Receivable entry point to release charges.
"RTN","IBRREL",103,0)
 ;   Input: PRCABN -- ien of Bill/Accounts Receivable
"RTN","IBRREL",104,0)
 Q:$D(PRCABN)[0  Q:'$$IB^IBRUTL(PRCABN,1)  G RESUME
"RTN","IBTOAT")
0^30^B11359948
"RTN","IBTOAT",1,0)
IBTOAT ;ALB/AAS - CLAIMS TRACKING ADMISSION SHEET PRINT ; 18-JUN-93
"RTN","IBTOAT",2,0)
 ;;2.0; INTEGRATED BILLING ;**1,199**; 21-MAR-94
"RTN","IBTOAT",3,0)
 ;
"RTN","IBTOAT",4,0)
% I '$D(DT) D DT^DICRW
"RTN","IBTOAT",5,0)
 ;
"RTN","IBTOAT",6,0)
PAT ; -- Select patient
"RTN","IBTOAT",7,0)
 S IBTOAT=1
"RTN","IBTOAT",8,0)
 S DIC="^DPT(",DIC(0)="AEQM" ;,DIC("S")="I $D(^IBT(356,""APTA"",+Y))"
"RTN","IBTOAT",9,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBTOAT",10,0)
 D ^DIC K DIC I +Y<1 G END
"RTN","IBTOAT",11,0)
 S DFN=+Y
"RTN","IBTOAT",12,0)
 ;
"RTN","IBTOAT",13,0)
EN1 ;
"RTN","IBTOAT",14,0)
 ; -- entry point to call from event driver or registration
"RTN","IBTOAT",15,0)
 N VAIN,VAERR,VA,VAINDT,IBQUIT,DIR,I,J
"RTN","IBTOAT",16,0)
 W !
"RTN","IBTOAT",17,0)
 S IBQUIT=0
"RTN","IBTOAT",18,0)
 Q:'$D(DFN)
"RTN","IBTOAT",19,0)
 I '$G(IBTOAT) Q:'$P($G(^IBE(350.9,1,6)),"^",5)
"RTN","IBTOAT",20,0)
 S VA200="" D INP^VADPT
"RTN","IBTOAT",21,0)
 ;Q:'VAIN(1)
"RTN","IBTOAT",22,0)
 S IBTRN=$O(^IBT(356,"AD",+$G(VAIN(1)),0))
"RTN","IBTOAT",23,0)
 I IBTRN D  I IBQUIT G END
"RTN","IBTOAT",24,0)
 .N DIR
"RTN","IBTOAT",25,0)
 .S DIR(0)="Y",DIR("A")="Print Admission Sheet for Current Adm. ("_$P(VAIN(7),"^",2)_")"
"RTN","IBTOAT",26,0)
 .S DIR("B")="YES"
"RTN","IBTOAT",27,0)
 .S DIR("?")="Answer 'YES' if you want to print an admission sheet for the current admission, or 'NO' if you wish to select another admission date."
"RTN","IBTOAT",28,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQUIT=1
"RTN","IBTOAT",29,0)
 .S IBTCUR=Y
"RTN","IBTOAT",30,0)
 .Q
"RTN","IBTOAT",31,0)
 ;
"RTN","IBTOAT",32,0)
 I '$G(IBTCUR)!('$G(IBTRN))!($P($G(^IBT(356,+$G(IBTRN),0)),"^",2)'=DFN) D TRAC
"RTN","IBTOAT",33,0)
 I '$G(IBTRN) G END
"RTN","IBTOAT",34,0)
 ;
"RTN","IBTOAT",35,0)
DEV ; -- select device, run option
"RTN","IBTOAT",36,0)
 W !
"RTN","IBTOAT",37,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBTOAT",38,0)
 I $D(IO("Q")) S ZTRTN="ONE^IBTOAT1",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB - Print single admission sheet" D ^%ZTLOAD K IO("Q"),ZTSK D HOME^%ZIS G %
"RTN","IBTOAT",39,0)
 U IO D ONE^IBTOAT1,END W !! G %
"RTN","IBTOAT",40,0)
 Q
"RTN","IBTOAT",41,0)
 ;
"RTN","IBTOAT",42,0)
END ; -- Clean up
"RTN","IBTOAT",43,0)
 W !
"RTN","IBTOAT",44,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBTOAT",45,0)
 D ^%ZISC
"RTN","IBTOAT",46,0)
 K X,Y,DFN,IBTRN,%ZIS,IBTOAT,VA200,IBTCUR,MAX,POP,TAB,TAB2,IBTITLE,IBDT
"RTN","IBTOAT",47,0)
 Q
"RTN","IBTOAT",48,0)
 ;
"RTN","IBTOAT",49,0)
TRAC ; -- Select tracking module internal entry number
"RTN","IBTOAT",50,0)
 W !
"RTN","IBTOAT",51,0)
 S DIC="^IBT(356,",DIC(0)="AEQ",DIC("A")="Select Visit: "
"RTN","IBTOAT",52,0)
 S D="ADFN"_DFN
"RTN","IBTOAT",53,0)
 S DIC("S")="I $P(^(0),U,2)=DFN,$P(^(0),U,5)"
"RTN","IBTOAT",54,0)
 D IX^DIC K DIC I +Y<1 G END
"RTN","IBTOAT",55,0)
 S IBTRN=+Y
"RTN","IBTOAT",56,0)
 Q
"RTN","IBTOAT",57,0)
 ;
"RTN","IBTOAT",58,0)
REG(DGPM) ; -- can be called from registration to print an admission sheet
"RTN","IBTOAT",59,0)
 ; -- input  DGPM = admission movement
"RTN","IBTOAT",60,0)
 N IBTRKR,IBTRN,IBTRND,X,Y,I,J,DIR,DIRUT,DUOUT,DTOUT,IBQUIT,DFN
"RTN","IBTOAT",61,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTOAT",62,0)
 Q:'$P(IBTRKR,"^",6)  ; quit if use admission sheets = no
"RTN","IBTOAT",63,0)
 Q:'$G(DGPM)
"RTN","IBTOAT",64,0)
 S DFN=$P($G(^DGPM(DGPM,0)),"^",2) Q:'DFN
"RTN","IBTOAT",65,0)
 S IBTRN=$O(^IBT(356,"AD",DGPM,0))
"RTN","IBTOAT",66,0)
 I 'IBTRN D ADM^IBTUTL(DGPM)
"RTN","IBTOAT",67,0)
 S DIR(0)="Y",DIR("A")="PRINT ADMISSION SHEET",DIR("B")="YES"
"RTN","IBTOAT",68,0)
 S DIR("?")="Answer YES if you wish to print an admission sheet which could be place on the top of the inpatient chart.  Answer NO if you do not want to print one."
"RTN","IBTOAT",69,0)
 D ^DIR K DIR I Y D
"RTN","IBTOAT",70,0)
 .S ZTRTN="ONE^IBTOAT1",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB - Print single admission sheet" D ^%ZTLOAD K ZTSK
"RTN","IBTOAT",71,0)
 .;D ONE^IBTOAT1
"RTN","IBTOAT",72,0)
 Q
"RTN","IBTOBI")
0^31^B25489278
"RTN","IBTOBI",1,0)
IBTOBI ;ALB/AAS - CLAIMS TRACKING BILLING INFORMATION PRINT ; 27-OCT-93
"RTN","IBTOBI",2,0)
 ;;2.0;INTEGRATED BILLING;**91,160,199**;21-MAR-94
"RTN","IBTOBI",3,0)
 ;
"RTN","IBTOBI",4,0)
% I '$D(DT) D DT^DICRW
"RTN","IBTOBI",5,0)
 W !!,"Bill Preparation Report for a Single Visit"
"RTN","IBTOBI",6,0)
 D END
"RTN","IBTOBI",7,0)
 ;
"RTN","IBTOBI",8,0)
PAT ; -- Select patient
"RTN","IBTOBI",9,0)
 W !!
"RTN","IBTOBI",10,0)
 S DIC="^DPT(",DIC(0)="AEQM"
"RTN","IBTOBI",11,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBTOBI",12,0)
 D ^DIC K DIC I +Y<1 G END
"RTN","IBTOBI",13,0)
 S DFN=+Y
"RTN","IBTOBI",14,0)
 ;
"RTN","IBTOBI",15,0)
VSIT ;
"RTN","IBTOBI",16,0)
 ; -- get claims tracking visit entry
"RTN","IBTOBI",17,0)
 D TRAC^IBTRV K IBY
"RTN","IBTOBI",18,0)
 I '$G(IBTRN) G END
"RTN","IBTOBI",19,0)
 ;
"RTN","IBTOBI",20,0)
DEV ; -- select device, run option
"RTN","IBTOBI",21,0)
 W !
"RTN","IBTOBI",22,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBTOBI",23,0)
 I $D(IO("Q")) S ZTRTN="DQ^IBTOBI",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB - Bill Preparation Report" D ^%ZTLOAD K IO("Q"),ZTSK D HOME^%ZIS G PAT
"RTN","IBTOBI",24,0)
 ;
"RTN","IBTOBI",25,0)
 U IO
"RTN","IBTOBI",26,0)
 D ONE,END G PAT
"RTN","IBTOBI",27,0)
 Q
"RTN","IBTOBI",28,0)
DQ ; -- task man entry point
"RTN","IBTOBI",29,0)
 D ONE
"RTN","IBTOBI",30,0)
 ;
"RTN","IBTOBI",31,0)
END ; -- Clean up
"RTN","IBTOBI",32,0)
 W !
"RTN","IBTOBI",33,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBTOBI",34,0)
 D ^%ZISC
"RTN","IBTOBI",35,0)
 K I,J,X,Y,DFN,%ZIS,VA,IBTRN,IBTRND,IBTRND1,IBPAG,IBHDT,IBDISDT,IBETYP,IBQUIT,IBTAG,DIRUT,DUOUT,IBCNT,IBI,IBJ,IBNAR,IBTNOD,IBTRCD1,IBTRTP,IBDA
"RTN","IBTOBI",36,0)
 D KVAR^VADPT
"RTN","IBTOBI",37,0)
 Q
"RTN","IBTOBI",38,0)
ONE ; -- print one billing report from ct
"RTN","IBTOBI",39,0)
 S IBPAG=0,IBHDT=$$HTE^XLFDT($H,1),IBQUIT=0
"RTN","IBTOBI",40,0)
 D PID^VADPT
"RTN","IBTOBI",41,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBTOBI",42,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTOBI",43,0)
 D HDR,SECT1,^IBTOBI1
"RTN","IBTOBI",44,0)
 Q
"RTN","IBTOBI",45,0)
 ;
"RTN","IBTOBI",46,0)
HDR ; -- Print header for billing report
"RTN","IBTOBI",47,0)
 Q:IBQUIT
"RTN","IBTOBI",48,0)
 I '$D(VA("PID")) N I,J D PID^VADPT
"RTN","IBTOBI",49,0)
 I $E(IOST,1,2)="C-",IBPAG D PAUSE^VALM1 I $D(DIRUT) S IBQUIT=1 Q
"RTN","IBTOBI",50,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF
"RTN","IBTOBI",51,0)
 S IBPAG=IBPAG+1
"RTN","IBTOBI",52,0)
 W !,$S($D(IBCTHDR):IBCTHDR,1:"Bill Preparation Report"),?(IOM-33),"Page ",IBPAG,"  ",IBHDT
"RTN","IBTOBI",53,0)
 W !!,$E($P($G(^DPT(DFN,0)),"^"),1,25),?28,VA("PID"),?50,"DOB: ",$$FMTE^XLFDT($P($G(^DPT(DFN,0)),"^",3),1)
"RTN","IBTOBI",54,0)
 W !,$$EXPAND^IBTRE(356,.18,$P(IBTRND,"^",18))," on ",$$FMTE^XLFDT($P(IBTRND,"^",6),1)
"RTN","IBTOBI",55,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBTOBI",56,0)
 Q
"RTN","IBTOBI",57,0)
 ;
"RTN","IBTOBI",58,0)
SECT1 ; -- Section 1 - Visit info Region / misc billing info
"RTN","IBTOBI",59,0)
 N IBD
"RTN","IBTOBI",60,0)
 W !," Visit Information "
"RTN","IBTOBI",61,0)
 S IBD(1,1)="    Visit Type: "_$P(IBETYP,"^")
"RTN","IBTOBI",62,0)
 S X=$P(IBETYP,"^",3) I 'X W !,"No Visit Selected" Q
"RTN","IBTOBI",63,0)
 D @X
"RTN","IBTOBI",64,0)
 D MBI
"RTN","IBTOBI",65,0)
 S I=0 F  S I=$O(IBD(I)) Q:'I  W !,$G(IBD(I,1)),?44,$E($G(IBD(I,2)),1,36)
"RTN","IBTOBI",66,0)
 W !?4,$TR($J(" ",IOM-8)," ","-"),!
"RTN","IBTOBI",67,0)
 Q
"RTN","IBTOBI",68,0)
1 ; -- visit region for admission or scheduled admission
"RTN","IBTOBI",69,0)
 S IBDISDT=""
"RTN","IBTOBI",70,0)
 I $P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17) S VAINDT=+$G(^DGPM(+$P(IBTRND,"^",5),0)),IBDISDT=+$G(^DGPM(+$P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17),0))
"RTN","IBTOBI",71,0)
 I '$D(VAIN) S VA200="" D INP^VADPT
"RTN","IBTOBI",72,0)
 I VAIN(7)="" S Y=$P(IBTRND,"^",6) D D^DIQ S $P(VAIN(7),"^",2)=Y
"RTN","IBTOBI",73,0)
 S IBD(2,1)="Admission Date: "_$P(VAIN(7),"^",2)
"RTN","IBTOBI",74,0)
 S IBD(3,1)="          Ward: "_$P(VAIN(4),"^",2)
"RTN","IBTOBI",75,0)
 S IBD(4,1)="     Specialty: "_$P(VAIN(3),"^",2)
"RTN","IBTOBI",76,0)
 S IBD(5,1)="Discharge Date: "_$$FMTE^XLFDT(IBDISDT,1)
"RTN","IBTOBI",77,0)
 Q
"RTN","IBTOBI",78,0)
2 ; -- visit region for  outpatient care
"RTN","IBTOBI",79,0)
 N IBOE,IBOE0
"RTN","IBTOBI",80,0)
 S IBOE=$P(IBTRND,"^",4),IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBTOBI",81,0)
 S IBD(2,1)="    Visit Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P")
"RTN","IBTOBI",82,0)
 I +IBOE<1 S IBD(3,1)="  No Outpatient Encounter Found" Q
"RTN","IBTOBI",83,0)
 S IBD(3,1)="        Clinic: "_$P($G(^SC(+$P(IBOE0,U,4),0)),"^")
"RTN","IBTOBI",84,0)
 S IBD(4,1)="  Appt. Status: "_$$EXPAND^IBTRE(409.68,.12,$P(IBOE0,U,12))
"RTN","IBTOBI",85,0)
 S IBD(5,1)="    Appt. Type: "_$$EXPAND^IBTRE(409.68,.1,$P(IBOE0,U,10))
"RTN","IBTOBI",86,0)
 S IBD(6,1)="  Special Cond: "_$$ENCL^IBTRED(IBOE)
"RTN","IBTOBI",87,0)
 Q
"RTN","IBTOBI",88,0)
 ;
"RTN","IBTOBI",89,0)
3 ; -- visit region for rx refill
"RTN","IBTOBI",90,0)
 N PSONTALK,PSOTMP,PSORXN,PSOFILL
"RTN","IBTOBI",91,0)
 S PSONTALK=1 ;PSORXN=+$P(IBTRND,"^",8),PSOFILL=+$P(IBTRND,"^",10)
"RTN","IBTOBI",92,0)
 S X=+$P(IBTRND,"^",8)_"^"_+$P(IBTRND,"^",10) D EN^PSOCPVW
"RTN","IBTOBI",93,0)
 S IBD(2,1)="Prescription #: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),.01,"E"))
"RTN","IBTOBI",94,0)
 I $P(IBTRND,"^",10)=0 S IBD(3,1)="     Fill Date: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),22,"E"))
"RTN","IBTOBI",95,0)
 I +$P(IBTRND,"^",10) S IBD(3,1)="   Refill Date: "_$G(PSOTMP(52.1,+$P(IBTRND,"^",10),.01,"E"))
"RTN","IBTOBI",96,0)
 S IBD(4,1)="          Drug: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),6,"E"))
"RTN","IBTOBI",97,0)
 S IBD(5,1)="      Quantity: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),7,"E")),8)
"RTN","IBTOBI",98,0)
 S IBD(6,1)="   Days Supply: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),8,"E")),8)
"RTN","IBTOBI",99,0)
 S IBD(7,1)="          NDC#: "_$P($G(^PSDRUG(+$P($G(^PSRX(+$P(IBTRND,"^",8),0)),"^",6),2)),"^",4)
"RTN","IBTOBI",100,0)
 S IBD(8,1)="     Physician: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),4,"E"))
"RTN","IBTOBI",101,0)
 Q
"RTN","IBTOBI",102,0)
 ;
"RTN","IBTOBI",103,0)
4 ; -- Visit region for prosthetics
"RTN","IBTOBI",104,0)
 D 4^IBTOBI4
"RTN","IBTOBI",105,0)
 Q
"RTN","IBTOBI",106,0)
 ;
"RTN","IBTOBI",107,0)
MBI ; -- Misc. billing info
"RTN","IBTOBI",108,0)
 S IBD(1,2)=" Visit Billable: "_$S('$P(IBTRND,"^",19):"YES",1:"NO-"_$$EXPAND^IBTRE(356,.19,$P(IBTRND,"^",19)))
"RTN","IBTOBI",109,0)
 S IBD(2,2)=" Second Opinion: "_$S('$P(IBTRND,"^",14):"NOT REQUIRED",1:$S('$P(IBTRND,"^",15):"REQUIRED-NOT OBTAINED",1:"OBTAINED"))
"RTN","IBTOBI",110,0)
 S IBD(3,2)=" Auto Bill Date: "_$$FMTE^XLFDT($P(IBTRND,"^",17),1)
"RTN","IBTOBI",111,0)
 S IBD(4,2)="Special Consent: ROI "_$S('$P(IBTRND,"^",31):"NOT DETERMINED",1:$$EXPAND^IBTRE(356,.31,$P(IBTRND,"^",31)))
"RTN","IBTOBI",112,0)
 S IBD(5,2)="Special Billing: "_$$EXPAND^IBTRE(356,.12,$P(IBTRND,"^",12))
"RTN","IBTOBI",113,0)
 Q
"RTN","IBTOTR")
0^32^B16173940
"RTN","IBTOTR",1,0)
IBTOTR ;ALB/AAS - CLAIMS TRACKING INQUIRY ; 27-OCT-93
"RTN","IBTOTR",2,0)
 ;;2.0; INTEGRATED BILLING ;**40,199**; 21-MAR-94
"RTN","IBTOTR",3,0)
 ;
"RTN","IBTOTR",4,0)
% I '$D(DT) D DT^DICRW
"RTN","IBTOTR",5,0)
 W !!,"Claims Tracking Inquiry"
"RTN","IBTOTR",6,0)
 ;
"RTN","IBTOTR",7,0)
PAT ; -- Select patient
"RTN","IBTOTR",8,0)
 W !! D END
"RTN","IBTOTR",9,0)
 S DIC="^DPT(",DIC(0)="AEQM"
"RTN","IBTOTR",10,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBTOTR",11,0)
 D ^DIC K DIC I +Y<1 G END
"RTN","IBTOTR",12,0)
 S DFN=+Y
"RTN","IBTOTR",13,0)
 ;
"RTN","IBTOTR",14,0)
VSIT ;
"RTN","IBTOTR",15,0)
 ; -- get claims tracking visit entry
"RTN","IBTOTR",16,0)
 D TRAC^IBTRV K IBY
"RTN","IBTOTR",17,0)
 I '$G(IBTRN) G END
"RTN","IBTOTR",18,0)
 ;
"RTN","IBTOTR",19,0)
DEV ; -- select device, run option
"RTN","IBTOTR",20,0)
 W !
"RTN","IBTOTR",21,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBTOTR",22,0)
 I $D(IO("Q")) S ZTRTN="DQ^IBTOTR",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB - Inquire to Claims Tracking" D ^%ZTLOAD K IO("Q"),ZTSK D HOME^%ZIS G PAT
"RTN","IBTOTR",23,0)
 ;
"RTN","IBTOTR",24,0)
 U IO
"RTN","IBTOTR",25,0)
 D ONE,END G PAT
"RTN","IBTOTR",26,0)
 Q
"RTN","IBTOTR",27,0)
 ;
"RTN","IBTOTR",28,0)
END ; -- Clean up
"RTN","IBTOTR",29,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBTOTR",30,0)
 D ^%ZISC
"RTN","IBTOTR",31,0)
 K I,J,X,Y,DFN,%ZIS,VA,IBTRN,IBTRND,IBTRND1,IBPAG,IBHDT,IBDISDT,IBETYP,IBQUIT,IBTAG,IBI,IBJ,IBII,IBTRTP,IBNAR,IBCNT
"RTN","IBTOTR",32,0)
 D KVAR^VADPT
"RTN","IBTOTR",33,0)
 Q
"RTN","IBTOTR",34,0)
 ;
"RTN","IBTOTR",35,0)
DQ ; -- entry print from task man
"RTN","IBTOTR",36,0)
 D ONE G END
"RTN","IBTOTR",37,0)
 Q
"RTN","IBTOTR",38,0)
 ;
"RTN","IBTOTR",39,0)
ONE ; -- print one billing report from ct
"RTN","IBTOTR",40,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTOTR",41,0)
 S IBPAG=0,IBHDT=$$HTE^XLFDT($H,1),IBQUIT=0
"RTN","IBTOTR",42,0)
 D PID^VADPT
"RTN","IBTOTR",43,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBTOTR",44,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTOTR",45,0)
 D HDR,SECT1^IBTOBI
"RTN","IBTOTR",46,0)
 W ! D BI1^IBTOBI1,CLIN
"RTN","IBTOTR",47,0)
 ;
"RTN","IBTOTR",48,0)
 I ($Y+11)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",49,0)
 W !!,"  Insurance Review Information "
"RTN","IBTOTR",50,0)
 N I,J,IBTRC,IBTRCD,IBD,IBACTION,TCODE
"RTN","IBTOTR",51,0)
 S IBCNT=0
"RTN","IBTOTR",52,0)
 S IBII="" F  S IBII=$O(^IBT(356.2,"ATIDT",IBTRN,IBII)) Q:'IBII!(IBQUIT)  S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"ATIDT",IBTRN,IBII,IBTRC)) Q:'IBTRC!(IBQUIT)  D
"RTN","IBTOTR",53,0)
 .N IBD
"RTN","IBTOTR",54,0)
 .S IBCNT=IBCNT+1
"RTN","IBTOTR",55,0)
 .D IR1^IBTOBI2
"RTN","IBTOTR",56,0)
 .D IR2^IBTOBI2
"RTN","IBTOTR",57,0)
 .S IBJ=0 F  S IBJ=$O(IBD(IBJ)) Q:'IBJ  W !,$E($G(IBD(IBJ,1)),1,39),?40,$E($G(IBD(IBJ,2)),1,39)
"RTN","IBTOTR",58,0)
 .W !
"RTN","IBTOTR",59,0)
 .I ($Y+9)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",60,0)
 I IBCNT<1 W !,"None on file.",!
"RTN","IBTOTR",61,0)
 ;
"RTN","IBTOTR",62,0)
 I ($Y+11)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",63,0)
 W !,"  Hospital Review Information "
"RTN","IBTOTR",64,0)
 N I,J,IBTRV,IBTRVD,IBD
"RTN","IBTOTR",65,0)
 S IBCNT=0
"RTN","IBTOTR",66,0)
 S IBII="" F  S IBII=$O(^IBT(356.1,"ATIDT",IBTRN,IBII)) Q:'IBII!(IBQUIT)  S IBTRV=0 F  S IBTRV=$O(^IBT(356.1,"ATIDT",IBTRN,IBII,IBTRV)) Q:'IBTRV!(IBQUIT)  D
"RTN","IBTOTR",67,0)
 .N IBD
"RTN","IBTOTR",68,0)
 .S IBCNT=IBCNT+1
"RTN","IBTOTR",69,0)
 .D HR1^IBTOBI3
"RTN","IBTOTR",70,0)
 .D HR2^IBTOBI3
"RTN","IBTOTR",71,0)
 .; Patch #40 pick up Special Unit SI or IS
"RTN","IBTOTR",72,0)
 .D UNIT^IBTOBI3
"RTN","IBTOTR",73,0)
 .S IBJ=0 F  S IBJ=$O(IBD(IBJ)) Q:'IBJ  W !,$E($G(IBD(IBJ,1)),1,40),?40,$E($G(IBD(IBJ,2)),1,39)
"RTN","IBTOTR",74,0)
 .W !
"RTN","IBTOTR",75,0)
 .I ($Y+9)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",76,0)
 I IBCNT<1 W !,"None on file.",!
"RTN","IBTOTR",77,0)
 Q
"RTN","IBTOTR",78,0)
 ;
"RTN","IBTOTR",79,0)
HDR ; -- Print header for billing report
"RTN","IBTOTR",80,0)
 Q:IBQUIT
"RTN","IBTOTR",81,0)
 I $E(IOST,1,2)="C-",IBPAG D PAUSE^VALM1 I $D(DIRUT) S IBQUIT=1 Q
"RTN","IBTOTR",82,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF
"RTN","IBTOTR",83,0)
 S IBPAG=IBPAG+1
"RTN","IBTOTR",84,0)
 W !,"Claim Tracking Inquiry",?(IOM-33),"Page ",IBPAG,"  ",IBHDT
"RTN","IBTOTR",85,0)
 W !,$E($P($G(^DPT(DFN,0)),"^"),1,25),?28,VA("PID"),?50,"DOB: ",$$FMTE^XLFDT($P($G(^DPT(DFN,0)),"^",3),1)
"RTN","IBTOTR",86,0)
 W !,$$EXPAND^IBTRE(356,.18,$P(IBTRND,"^",18))," on ",$$FMTE^XLFDT($P(IBTRND,"^",6),1)
"RTN","IBTOTR",87,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBTOTR",88,0)
 Q
"RTN","IBTOTR",89,0)
 ;
"RTN","IBTOTR",90,0)
CLIN ; -- output clinical information
"RTN","IBTOTR",91,0)
 N IBOE,DGPM
"RTN","IBTOTR",92,0)
 ;
"RTN","IBTOTR",93,0)
 I $P(IBETYP,"^",3)=1 S DGPM=$P(^IBT(356,+IBTRN,0),"^",5) I 'DGPM Q
"RTN","IBTOTR",94,0)
 I $P(IBETYP,"^",3)=2 S IBOE=$P(^IBT(356,+IBTRN,0),"^",4)
"RTN","IBTOTR",95,0)
 F IBTAG="DIAG","PROC","PROV" D @IBTAG Q:IBQUIT
"RTN","IBTOTR",96,0)
 Q
"RTN","IBTOTR",97,0)
 ;
"RTN","IBTOTR",98,0)
DIAG ; -- print diagnosis information
"RTN","IBTOTR",99,0)
 I '$G(DGPM),('$G(IBOE)) Q
"RTN","IBTOTR",100,0)
 Q:$P(IBETYP,"^",3)>2
"RTN","IBTOTR",101,0)
 I ($Y+9)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",102,0)
 D DIAG1^IBTOBI4
"RTN","IBTOTR",103,0)
 Q
"RTN","IBTOTR",104,0)
 ;
"RTN","IBTOTR",105,0)
PROC ; -- print procedure information
"RTN","IBTOTR",106,0)
 Q:$P(IBETYP,"^",3)>2
"RTN","IBTOTR",107,0)
 I ($Y+9)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",108,0)
 D PROC1^IBTOBI4
"RTN","IBTOTR",109,0)
 Q
"RTN","IBTOTR",110,0)
 ;
"RTN","IBTOTR",111,0)
PROV ; -- print provider information
"RTN","IBTOTR",112,0)
 I '$G(DGPM),('$G(IBOE)) Q
"RTN","IBTOTR",113,0)
 Q:$P(IBETYP,"^",3)>2
"RTN","IBTOTR",114,0)
 I ($Y+9)>IOSL D HDR Q:IBQUIT
"RTN","IBTOTR",115,0)
 D PROV1^IBTOBI4
"RTN","IBTOTR",116,0)
 Q
"RTN","IBTRD")
0^33^B25402753
"RTN","IBTRD",1,0)
IBTRD ;ALB/AAS - CLAIMS TRACKING - DENIAL/ APPEALS ; 10-AUG-1993
"RTN","IBTRD",2,0)
 ;;2.0; INTEGRATED BILLING ;**1,199**; 21-MAR-94
"RTN","IBTRD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRD",4,0)
 ;
"RTN","IBTRD",5,0)
% ;
"RTN","IBTRD",6,0)
EN ; -- main entry point for IBT APPEAL/DENAIL EDITOR
"RTN","IBTRD",7,0)
 I '$D(DT) D DT^DICRW
"RTN","IBTRD",8,0)
 K XQORS,VALMEVL,IBTRD,DFN,IBCNS,IBTRN,IBTRV,IBTRC,IBFASTXT,VALMQUIT
"RTN","IBTRD",9,0)
 D ASK
"RTN","IBTRD",10,0)
 G:$D(VALMQUIT) ENQ
"RTN","IBTRD",11,0)
 I IBTRD["DPT(" S IBTYPE="P",DFN=+IBTRD D EN^VALM("IBT APPEAL/DENIAL EDITOR") G ENQ
"RTN","IBTRD",12,0)
 I IBTRD["DIC(" S IBTYPE="I",IBCNS=+IBTRD D EN^VALM("IBT APPEAL/DENIAL INS EDITOR")
"RTN","IBTRD",13,0)
ENQ K XQORS,VALMEVL,IBTRD,DFN,IBCNS,IBTRN,IBTRV,IBTRC,IBFASTXT,VALMQUIT
"RTN","IBTRD",14,0)
 K IBAMT,IBAPR,IBADG,IBDA,IBDGCR,IBDGCRU1,IBDV,IBETYP,IBETYPD,IBI,IBICD,IBLCNT,IBSEL,IBT,IBTEXT,IBTNOD,IBTSAV,VAUTD
"RTN","IBTRD",15,0)
 K IBAPEAL,IBCDFN,IBCNT,IBDEN,IBDENIAL,IBDENIAL,IBPARNT,IBPEN,IBPENAL,IBTCOD,IBTRDD,IBTRSV,IBTYPE,VAINDT,VA,VALMBCK,OFFSET,I1,I3,IBNEW,IBDENT,IBOE,Z1,T,SDCNT
"RTN","IBTRD",16,0)
 D KVAR^VADPT
"RTN","IBTRD",17,0)
 Q
"RTN","IBTRD",18,0)
 ;
"RTN","IBTRD",19,0)
HDR ; -- header code
"RTN","IBTRD",20,0)
 I $G(IBTYPE)="P" D HDRP
"RTN","IBTRD",21,0)
 I $G(IBTYPE)="I" D HDRI
"RTN","IBTRD",22,0)
 Q
"RTN","IBTRD",23,0)
 ;
"RTN","IBTRD",24,0)
HDRI ; -- header code for by ins. co.
"RTN","IBTRD",25,0)
 S VALMHDR(1)="Denials and Appeals for: "_$P(^DIC(36,+IBCNS,0),"^")
"RTN","IBTRD",26,0)
 S VALMHDR(2)=" "
"RTN","IBTRD",27,0)
 Q
"RTN","IBTRD",28,0)
 ;
"RTN","IBTRD",29,0)
HDRP ; -- header code for by pat.
"RTN","IBTRD",30,0)
 D PID^VADPT
"RTN","IBTRD",31,0)
 S VALMHDR(1)="Denials and Appeals for: "_$$PT^IBTUTL1(DFN)
"RTN","IBTRD",32,0)
 S VALMHDR(2)=" "
"RTN","IBTRD",33,0)
 Q
"RTN","IBTRD",34,0)
 ;
"RTN","IBTRD",35,0)
INIT ; -- init variables and list array
"RTN","IBTRD",36,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBTRD",37,0)
 K ^TMP("IBTRC",$J),^TMP("IBTRCDX",$J)
"RTN","IBTRD",38,0)
 K I,X,XQORNOD,DA,DR,DIE,DNM,DQ,IBTRC
"RTN","IBTRD",39,0)
 I '$G(IBTRD),$G(DFN) S IBTRD=DFN_";DPT("
"RTN","IBTRD",40,0)
 I '$G(IBTRD) S VALMQUIT=""
"RTN","IBTRD",41,0)
 S IBTRSV=""
"RTN","IBTRD",42,0)
 Q:$D(VALMQUIT)
"RTN","IBTRD",43,0)
 ;
"RTN","IBTRD",44,0)
BLD ; -- build list
"RTN","IBTRD",45,0)
 K ^TMP("IBTRD",$J),^TMP("IBTRDDX",$J)
"RTN","IBTRD",46,0)
 N IBI,J,IBTRC,IBTRCD,IBTRCD1,IBTRN
"RTN","IBTRD",47,0)
 I IBTRD["DPT(" S IBTYPE="P",DFN=+IBTRD D BLDP
"RTN","IBTRD",48,0)
 I IBTRD["DIC(" S IBTYPE="I",IBCNS=+IBTRD D BLDI
"RTN","IBTRD",49,0)
 Q
"RTN","IBTRD",50,0)
 ;
"RTN","IBTRD",51,0)
BLDI ; -- Build list of appeals/denials by ins. co.
"RTN","IBTRD",52,0)
 D HDRI
"RTN","IBTRD",53,0)
 S (IBTRC,IBCNT,VALMCNT)=0
"RTN","IBTRD",54,0)
 S IBDEN=$O(^IBE(356.7,"ACODE",20,0))
"RTN","IBTRD",55,0)
 S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"AIACT",IBCNS,IBDEN,IBTRC)) Q:'IBTRC  D 1
"RTN","IBTRD",56,0)
 S IBPEN=$O(^IBE(356.7,"ACODE",30,0))
"RTN","IBTRD",57,0)
 S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"AIACT",IBCNS,IBPEN,IBTRC)) Q:'IBTRC  D 1
"RTN","IBTRD",58,0)
 Q
"RTN","IBTRD",59,0)
 ;
"RTN","IBTRD",60,0)
BLDP ; -- Build list of appeals/denials by patient
"RTN","IBTRD",61,0)
 D HDRP
"RTN","IBTRD",62,0)
 S (IBTRC,IBCNT,VALMCNT)=0
"RTN","IBTRD",63,0)
 S VALMSG=$$MSG^IBTUTL3(DFN)
"RTN","IBTRD",64,0)
 S IBDEN=$O(^IBE(356.7,"ACODE",20,0))
"RTN","IBTRD",65,0)
 S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"APACT",DFN,IBDEN,IBTRC)) Q:'IBTRC  D 1
"RTN","IBTRD",66,0)
 S IBPEN=$O(^IBE(356.7,"ACODE",30,0))
"RTN","IBTRD",67,0)
 S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"APACT",DFN,IBPEN,IBTRC)) Q:'IBTRC  D 1
"RTN","IBTRD",68,0)
 Q
"RTN","IBTRD",69,0)
1 ; -- first add denial, then add appeal
"RTN","IBTRD",70,0)
 S IBTRN=$P(^IBT(356.2,+IBTRC,0),"^",2)
"RTN","IBTRD",71,0)
 S IBTRSV=+IBTRC
"RTN","IBTRD",72,0)
 D 2
"RTN","IBTRD",73,0)
 N IBTRC,IBTRCD,IBTRCD1
"RTN","IBTRD",74,0)
 S IBAPEAL=$O(^IBE(356.11,"ACODE",60,0)) ; find appeals
"RTN","IBTRD",75,0)
 S IBTRC=0 F  S IBTRC=$O(^IBT(356.2,"AP",IBTRSV,IBTRC)) Q:'IBTRC  D 2
"RTN","IBTRD",76,0)
 ;
"RTN","IBTRD",77,0)
 Q
"RTN","IBTRD",78,0)
2 ; -- add items to list
"RTN","IBTRD",79,0)
 S IBTRCD=$G(^IBT(356.2,+IBTRC,0))
"RTN","IBTRD",80,0)
 S IBTRCD1=$G(^IBT(356.2,+IBTRC,1))
"RTN","IBTRD",81,0)
 Q:'+$P(IBTRCD,"^",19)  ;quit if inactive
"RTN","IBTRD",82,0)
 ;
"RTN","IBTRD",83,0)
 ; -- if not the denial, must be from parent
"RTN","IBTRD",84,0)
 I IBTRC'=IBTRSV&($P(IBTRCD,"^",18)'=IBTRSV) Q
"RTN","IBTRD",85,0)
 ;
"RTN","IBTRD",86,0)
 S IBCNT=IBCNT+1
"RTN","IBTRD",87,0)
 W "."
"RTN","IBTRD",88,0)
 I IBTYPE="I" S DFN=$P(IBTRCD,"^",5) D PID^VADPT
"RTN","IBTRD",89,0)
 S X=""
"RTN","IBTRD",90,0)
 S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBTRD",91,0)
 ;
"RTN","IBTRD",92,0)
 I IBTYPE="I" D
"RTN","IBTRD",93,0)
 .S X=$$SETFLD^VALM1($P(^DPT(DFN,0),"^"),X,"PATIENT")
"RTN","IBTRD",94,0)
 .S X=$$SETFLD^VALM1(VA("BID"),X,"ID")
"RTN","IBTRD",95,0)
 ;
"RTN","IBTRD",96,0)
 I IBTYPE="P" D
"RTN","IBTRD",97,0)
 .S X=$$SETFLD^VALM1($P($G(^DIC(36,+$P(IBTRCD,"^",8),0)),"^"),X,"INS CO")
"RTN","IBTRD",98,0)
 .S X=$$SETFLD^VALM1($$GRP^IBCNS(+$P($G(^DPT(DFN,.312,+$P(IBTRCD1,"^",5),0)),"^",18)),X,"POLICY")
"RTN","IBTRD",99,0)
 ;
"RTN","IBTRD",100,0)
 S X=$$SETFLD^VALM1($P($$DAT1^IBOUTL(+IBTRCD,"2P")," "),X,"DATE")
"RTN","IBTRD",101,0)
 I $P(IBTRCD,"^",11) S X=$$SETFLD^VALM1($$EXPAND^IBTRE(356.2,.11,$P(IBTRCD,"^",11)),X,"ACTION")
"RTN","IBTRD",102,0)
 I $P(IBTRCD,"^",11)="" S X=$$SETFLD^VALM1($P($G(^IBE(356.11,+$P(IBTRCD,"^",4),0)),"^",3),X,"ACTION")
"RTN","IBTRD",103,0)
 ;
"RTN","IBTRD",104,0)
 S X=$$SETFLD^VALM1($P($G(^IBE(356.6,+$P(^IBT(356,+IBTRN,0),"^",18),0)),"^",2),X,"EVENT")
"RTN","IBTRD",105,0)
 S X=$$SETFLD^VALM1($$DAT1^IBOUTL(+$P(^IBT(356,+IBTRN,0),"^",6),"2P"),X,"EV DATE")
"RTN","IBTRD",106,0)
 S X=$$SETFLD^VALM1($$EXPAND^IBTRE(356.2,.04,$P(IBTRCD,"^",4)),X,"TYPE")
"RTN","IBTRD",107,0)
 S X=$$SETFLD^VALM1($J($$DAY^IBTUTL3($P(IBTRCD,"^",15),$P(IBTRCD,"^",16),IBTRN),3),X,"DAYS")
"RTN","IBTRD",108,0)
 S X=$$SETFLD^VALM1($$EXPAND^IBTRE(356,.31,$P(^IBT(356,IBTRN,0),"^",31)),X,"ROI")
"RTN","IBTRD",109,0)
 S X=$$SETFLD^VALM1($P(IBTRCD,"^",6),X,"CONTACT")
"RTN","IBTRD",110,0)
 S X=$$SETFLD^VALM1($P(IBTRCD,"^",7),X,"PHONE")
"RTN","IBTRD",111,0)
 S X=$$SETFLD^VALM1($P(IBTRCD,"^",9),X,"REF NO")
"RTN","IBTRD",112,0)
 D SET(X)
"RTN","IBTRD",113,0)
 Q
"RTN","IBTRD",114,0)
 ;
"RTN","IBTRD",115,0)
SET(X) ; -- set arrays
"RTN","IBTRD",116,0)
 S VALMCNT=VALMCNT+1
"RTN","IBTRD",117,0)
 S ^TMP("IBTRD",$J,VALMCNT,0)=X
"RTN","IBTRD",118,0)
 S ^TMP("IBTRD",$J,"IDX",VALMCNT,IBCNT)=""
"RTN","IBTRD",119,0)
 S ^TMP("IBTRDDX",$J,IBCNT)=VALMCNT_"^"_IBTRC
"RTN","IBTRD",120,0)
 Q
"RTN","IBTRD",121,0)
HELP ; -- help code
"RTN","IBTRD",122,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBTRD",123,0)
 Q
"RTN","IBTRD",124,0)
 ;
"RTN","IBTRD",125,0)
EXIT ; -- exit code
"RTN","IBTRD",126,0)
 K ^TMP("IBTRD",$J),^TMP("IBTRDDX",$J),IBTRD
"RTN","IBTRD",127,0)
 D CLEAN^VALM10
"RTN","IBTRD",128,0)
 Q
"RTN","IBTRD",129,0)
 ;
"RTN","IBTRD",130,0)
ASK ; -- ask for patient or ins. co.
"RTN","IBTRD",131,0)
 N DIR
"RTN","IBTRD",132,0)
 S DIR(0)="350.9,4.02",DIR("A")="Select Patient Name or Insurance Co."
"RTN","IBTRD",133,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBTRD",134,0)
 D ^DIR K DIR I $D(DIRUT) S VALMQUIT="" G ASKQ
"RTN","IBTRD",135,0)
 S IBTRD=Y
"RTN","IBTRD",136,0)
 I +IBTRD<1 S VALMQUIT=""
"RTN","IBTRD",137,0)
ASKQ Q
"VER")
8.0^22.0
**END**
**END**
