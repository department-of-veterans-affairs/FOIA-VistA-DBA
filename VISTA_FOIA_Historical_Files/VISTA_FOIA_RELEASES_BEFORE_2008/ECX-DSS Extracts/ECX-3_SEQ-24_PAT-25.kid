Released ECX*3*25 SEQ #24
Extracted from mail message
**KIDS**:ECX*3.0*25^

**INSTALL NAME**
ECX*3.0*25
"BLD",1888,0)
ECX*3.0*25^DSS EXTRACTS^0^2990615^y
"BLD",1888,4,0)
^9.64PA^^
"BLD",1888,"INIT")
ECX325CV
"BLD",1888,"KRN",0)
^9.67PA^19^18
"BLD",1888,"KRN",.4,0)
.4
"BLD",1888,"KRN",.401,0)
.401
"BLD",1888,"KRN",.402,0)
.402
"BLD",1888,"KRN",.403,0)
.403
"BLD",1888,"KRN",.5,0)
.5
"BLD",1888,"KRN",.84,0)
.84
"BLD",1888,"KRN",3.6,0)
3.6
"BLD",1888,"KRN",3.8,0)
3.8
"BLD",1888,"KRN",9.2,0)
9.2
"BLD",1888,"KRN",9.8,0)
9.8
"BLD",1888,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1888,"KRN",9.8,"NM",1,0)
ECX325CV^^0^B1263297
"BLD",1888,"KRN",9.8,"NM",2,0)
ECXSURG^^0^B17092360
"BLD",1888,"KRN",9.8,"NM","B","ECX325CV",1)

"BLD",1888,"KRN",9.8,"NM","B","ECXSURG",2)

"BLD",1888,"KRN",19,0)
19
"BLD",1888,"KRN",19.1,0)
19.1
"BLD",1888,"KRN",101,0)
101
"BLD",1888,"KRN",409.61,0)
409.61
"BLD",1888,"KRN",771,0)
771
"BLD",1888,"KRN",869.2,0)
869.2
"BLD",1888,"KRN",870,0)
870
"BLD",1888,"KRN",8994,0)
8994
"BLD",1888,"KRN","B",.4,.4)

"BLD",1888,"KRN","B",.401,.401)

"BLD",1888,"KRN","B",.402,.402)

"BLD",1888,"KRN","B",.403,.403)

"BLD",1888,"KRN","B",.5,.5)

"BLD",1888,"KRN","B",.84,.84)

"BLD",1888,"KRN","B",3.6,3.6)

"BLD",1888,"KRN","B",3.8,3.8)

"BLD",1888,"KRN","B",9.2,9.2)

"BLD",1888,"KRN","B",9.8,9.8)

"BLD",1888,"KRN","B",19,19)

"BLD",1888,"KRN","B",19.1,19.1)

"BLD",1888,"KRN","B",101,101)

"BLD",1888,"KRN","B",409.61,409.61)

"BLD",1888,"KRN","B",771,771)

"BLD",1888,"KRN","B",869.2,869.2)

"BLD",1888,"KRN","B",870,870)

"BLD",1888,"KRN","B",8994,8994)

"BLD",1888,"QUES",0)
^9.62^^
"BLD",1888,"REQB",0)
^9.611^1^1
"BLD",1888,"REQB",1,0)
ECX*3.0*13^2
"BLD",1888,"REQB","B","ECX*3.0*13",1)

"INIT")
ECX325CV
"MBREQ")
0
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
25^2990615^11714
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ECX325CV")
0^1^B1263297
"RTN","ECX325CV",1,0)
ECX325CV ;ALB/JAP  Patch ECX*3*25 Post Install Conversion ;May 21, 1999
"RTN","ECX325CV",2,0)
 ;;3.0;DSS EXTRACTS;**25**;Dec 22, 1997
"RTN","ECX325CV",3,0)
 ;
"RTN","ECX325CV",4,0)
 N ECX,NODE,DATE,CASE,NON,TYPE,OPTIME,TIME,ECNO,A1,A2
"RTN","ECX325CV",5,0)
 ;find every record in file #727.811 for fy1999
"RTN","ECX325CV",6,0)
 S ECX=0
"RTN","ECX325CV",7,0)
 F  S ECX=$O(^ECX(727.811,ECX)) Q:'ECX  S NODE=^ECX(727.811,ECX,0) I +$P(NODE,U,2)>199809 D
"RTN","ECX325CV",8,0)
 .S CASE=+$P(NODE,U,10),TYPE=$P(NODE,U,17),NON=$P(NODE,U,32)
"RTN","ECX325CV",9,0)
 .I NON]"" D
"RTN","ECX325CV",10,0)
 ..S ECNO=$G(^SRF(CASE,"NON"))
"RTN","ECX325CV",11,0)
 ..S A1=$P(ECNO,U,5),A2=$P(ECNO,U,4),TIME="##" D:(A1&A2) TIME S OPTIME=TIME
"RTN","ECX325CV",12,0)
 ..I TYPE="P" S $P(^ECX(727.811,ECX,0),U,21)=OPTIME
"RTN","ECX325CV",13,0)
 ..I TYPE'="P" S $P(^ECX(727.811,ECX,0),U,21)=""
"RTN","ECX325CV",14,0)
 Q
"RTN","ECX325CV",15,0)
 ;
"RTN","ECX325CV",16,0)
TIME ; given date/time get increment
"RTN","ECX325CV",17,0)
 ;A1=later, A2=earlier, TIME=difference
"RTN","ECX325CV",18,0)
 S TIME=$TR($J($$FMDIFF^XLFDT(A1,A2,2)/900,6,0)," ") I TIME<0 S TIME="###"
"RTN","ECX325CV",19,0)
 Q
"RTN","ECXSURG")
0^2^B17092360
"RTN","ECXSURG",1,0)
ECXSURG ;ALB/JAP,BIR/DMA,PTD-Surgery Extract for DSS ; [ 03/20/97  3:04 PM ]
"RTN","ECXSURG",2,0)
 ;;3.0;DSS EXTRACTS;**1,11,8,13,25**;Dec 22, 1997
"RTN","ECXSURG",3,0)
BEG ;entry point from option
"RTN","ECXSURG",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSURG",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSURG",6,0)
 Q
"RTN","ECXSURG",7,0)
 ;
"RTN","ECXSURG",8,0)
START ;
"RTN","ECXSURG",9,0)
 N QFLG
"RTN","ECXSURG",10,0)
 S QFLG=0
"RTN","ECXSURG",11,0)
 S ECED=ECED+.3
"RTN","ECXSURG",12,0)
 S ECD=ECSD1 F  S ECD=$O(^SRF("AC",ECD)),ECD0=0 Q:'ECD  Q:ECD>ECED  Q:QFLG  F  S ECD0=$O(^SRF("AC",ECD,ECD0)) Q:'ECD0  D
"RTN","ECXSURG",13,0)
 .I $D(^SRF(ECD0,0)) S EC0=^(0),DFN=+EC0 I $D(^DPT(DFN,0)) S ECP=^(0) D STUFF Q:QFLG
"RTN","ECXSURG",14,0)
 Q
"RTN","ECXSURG",15,0)
 ;
"RTN","ECXSURG",16,0)
STUFF ;gather data
"RTN","ECXSURG",17,0)
 N J,X,Y,SSN,DATA1,DATA2,DATAOP
"RTN","ECXSURG",18,0)
 S SSN=$P(ECP,U,9),ECNA=$E($P($P(ECP,U),",")_"    ",1,4)
"RTN","ECXSURG",19,0)
 S X=$$PRIMARY^ECXUTL2(DFN,ECD),ECPTTM=$P(X,U,1),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3)
"RTN","ECXSURG",20,0)
 S X=$$INP^ECXUTL2(DFN,ECD),ECA=$P(X,U,1),ECMN=$P(X,U,2),ECTS=$P(X,U,3),ECXADD=$P(X,U,4),ECXADD=$$ECXDATE^ECXUTL(ECXADD,ECXYM)
"RTN","ECXSURG",21,0)
 S DATA1=$S($D(^SRF(ECD0,.1)):^(.1),1:0),DATA2=$S($D(^(.2)):^(.2),1:""),DATAOP=$S($D(^("OP")):^("OP"),1:""),ECDIV=$S($D(^(8)):^(8),1:ECINST),ECANE="",ECSR=$P(DATA1,U,4),ECAT=$P(DATA1,U,13),ECNO=$G(^("NON"))
"RTN","ECXSURG",22,0)
 S ECTM=$$ECXTIME^ECXUTL($P(DATA2,U,10)) I $P(ECNO,U)="Y" S ECTM=$$ECXTIME^ECXUTL($P(ECNO,U,4))
"RTN","ECXSURG",23,0)
 S ECCAN=$G(^SRF(ECD0,30))>0 I ECCAN!('$P(DATA2,U,10)&($P(ECNO,U)'="Y")) Q
"RTN","ECXSURG",24,0)
 ;quit if cancelled or no pt. in oper. rm. time
"RTN","ECXSURG",25,0)
 ;look for non-OR
"RTN","ECXSURG",26,0)
 I $P(ECNO,U)="Y" S ECSR=$P(ECNO,U,6),ECAT=$P(ECNO,U,7),A1=$P(ECNO,U,5),A2=$P(ECNO,U,4),TIME="##" D:(A1&A2) TIME S ECNT=TIME
"RTN","ECXSURG",27,0)
 S ECNL="" I $P(ECNO,U)="Y" S ECNL=+$P(ECNO,U,2),ECNL=$P($G(^ECX(728.44,ECNL,0)),U,9) I ECNL="" S ECNL="UNKNOWN"
"RTN","ECXSURG",28,0)
 S ECSA=$P($G(^SRF(ECD0,.3)),U,4),ECO=$P($G(^SRF(ECD0,0)),U,2) S ECORTY=$P($G(^SRS(+ECO,2)),U),ECO=$P($G(^SRS(+ECO,0)),U)
"RTN","ECXSURG",29,0)
 ;get service of attending surgeon
"RTN","ECXSURG",30,0)
 S ECATSV=$P($G(^DIC(49,+$G(^VA(200,+ECAT,5)),730)),U)
"RTN","ECXSURG",31,0)
 ;add leading 2s for pointer to 200
"RTN","ECXSURG",32,0)
 S:ECAT ECAT=2_ECAT S:ECSR ECSR=2_ECSR S:ECSA ECSA=2_ECSA
"RTN","ECXSURG",33,0)
 S J=$O(^SRF(ECD0,6,0)) I J,$D(^(J,0)) S ECANE=$P(^(0),U) I $P(^(0),U,3)'="Y" F  S J=$O(^SRF(ECD0,6,J)) Q:'J  I $D(^(J,0)),$P(^(0),U,3)="Y" S ECANE=$P(^(0),U) Q
"RTN","ECXSURG",34,0)
 S ECSS=$P($G(^SRO(137.45,+$P(EC0,U,4),0)),U,2)
"RTN","ECXSURG",35,0)
 S ECSS=$$RJ^XLFSTR($P($G(^DIC(45.3,+ECSS,0)),U),3,0) S:ECSS="000" ECSS="999"
"RTN","ECXSURG",36,0)
 ;get primary procedure
"RTN","ECXSURG",37,0)
 S ECPT=+$P(DATAOP,U,2),ECPT=$P($G(^ICPT(ECPT,0)),U)
"RTN","ECXSURG",38,0)
 S ECODE0="P"_U_ECPT_U
"RTN","ECXSURG",39,0)
 F J="10,12","2,3","1,4" S A2=$P(DATA2,U,$P(J,",")),A1=$P(DATA2,U,$P(J,",",2)),TIME="##" D:(A1&A2) TIME S ECODE0=ECODE0_U_TIME K TIME
"RTN","ECXSURG",40,0)
 S ECRR="" I $D(^SRF(ECD0,1.1)) S A1=$P(^(1.1),U,8),A2=$P(^(1.1),U,7),TIME="##" D:(A1&A2) TIME S ECRR=TIME K TIME
"RTN","ECXSURG",41,0)
 I ECNL]"" S $P(ECODE0,U,5)=ECNT
"RTN","ECXSURG",42,0)
 ;ecode0=p^cpt code^^patient time^operation time^anesthesia time
"RTN","ECXSURG",43,0)
 D FILE
"RTN","ECXSURG",44,0)
 ;get secondary procedures
"RTN","ECXSURG",45,0)
 S J=0
"RTN","ECXSURG",46,0)
 F  S J=$O(^SRF(ECD0,13,J)) Q:'J  I $D(^(J,0)),$D(^(2)),$P(^(2),U)]"" S ECPT=$P(^(2),U),ECODE0="S"_U_$P($G(^ICPT(ECPT,0)),U) D FILE
"RTN","ECXSURG",47,0)
 ;ecode0=s^cpt code
"RTN","ECXSURG",48,0)
 ;get prostheses
"RTN","ECXSURG",49,0)
 S J=0
"RTN","ECXSURG",50,0)
 F  S J=$O(^SRF(ECD0,1,J)) Q:'J  I $D(^(J,0)) S X=+^(0),Q=$P($G(^(1)),U,2) S:'Q Q=1 S ECODE0="I"_U_U_U_U_U_U_X_U_Q D FILE
"RTN","ECXSURG",51,0)
 ;ecode0=i^^^^^^prosthesis^quantity
"RTN","ECXSURG",52,0)
 Q
"RTN","ECXSURG",53,0)
 ;
"RTN","ECXSURG",54,0)
FILE ;file record
"RTN","ECXSURG",55,0)
 ;node0
"RTN","ECXSURG",56,0)
 ;division^dfn^ssn^name^in/out^day^case #^surg specialty^or room #^surgeon^attending^anesthesia supervisor^anesthesia technique^
"RTN","ECXSURG",57,0)
 ;primary/secondary/prostheses^cpt^^pt time^op time^anes time^prostheses^qty^^
"RTN","ECXSURG",58,0)
 ;movement number^treating speciality^cancelled^time^or type^attending's service^non-or dss id^recovery room time^^primary care team^primary care provider^admission date
"RTN","ECXSURG",59,0)
 ;node1
"RTN","ECXSURG",60,0)
 ;mpi^dss dept^surgeon npi^attending npi^anes supervisor npi^pc provider npi^pc prov person class
"RTN","ECXSURG",61,0)
 N DA,DIK
"RTN","ECXSURG",62,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSURG",63,0)
 S ECODE=EC7_U_EC23
"RTN","ECXSURG",64,0)
 S ECODE=ECODE_U_ECDIV_U_DFN_U_SSN_U_ECNA_U_ECA_U_$$ECXDATE^ECXUTL(ECD,ECXYM)_U_ECD0_U_ECSS_U_ECO_U_ECSR_U_ECAT_U_ECSA_U_ECANE
"RTN","ECXSURG",65,0)
 S ECODE=ECODE_U_ECODE0
"RTN","ECXSURG",66,0)
 S $P(ECODE,U,26,37)=ECMN_U_ECTS_U_$S(ECCAN:"C",1:"")_U_ECTM_U_ECORTY_U_ECATSV_U_ECNL_U_ECRR_U_U_ECPTTM_U_ECPTPR_U_ECXADD
"RTN","ECXSURG",67,0)
 S ECODE1=U_U_U_U_U_U_ECCLAS
"RTN","ECXSURG",68,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXSURG",69,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXSURG",70,0)
 I $D(ZTQUEUED),ECRN>499,'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSURG",71,0)
 ;
"RTN","ECXSURG",72,0)
TIME ; given date/time get increment
"RTN","ECXSURG",73,0)
 ;A1=later, A2=earlier, TIME=difference
"RTN","ECXSURG",74,0)
 S TIME=$TR($J($$FMDIFF^XLFDT(A1,A2,2)/900,6,0)," ") I TIME<0 S TIME="###"
"RTN","ECXSURG",75,0)
 Q
"RTN","ECXSURG",76,0)
 ;
"RTN","ECXSURG",77,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSURG",78,0)
 S ECHEAD="SUR"
"RTN","ECXSURG",79,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSURG",80,0)
 Q
"RTN","ECXSURG",81,0)
 ;
"RTN","ECXSURG",82,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSURG",83,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^21.0
**END**
**END**
