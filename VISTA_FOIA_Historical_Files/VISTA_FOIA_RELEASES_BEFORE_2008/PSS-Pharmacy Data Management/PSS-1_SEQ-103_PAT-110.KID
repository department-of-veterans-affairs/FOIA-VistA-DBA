Released PSS*1*110 SEQ #103
Extracted from mail message
**KIDS**:PSS*1.0*110^

**INSTALL NAME**
PSS*1.0*110
"BLD",6673,0)
PSS*1.0*110^PHARMACY DATA MANAGEMENT^0^3060614^y
"BLD",6673,1,0)
^^3^3^3060504^
"BLD",6673,1,1,0)
1) Only allow uppercase alphabet for the NAME field in files #51.1
"BLD",6673,1,2,0)
and #51.
"BLD",6673,1,3,0)
2) Allow elligible drugs to be marked for 'OP External Dispense'.
"BLD",6673,4,0)
^9.64PA^51^1
"BLD",6673,4,51,0)
51
"BLD",6673,4,51,2,0)
^9.641^51^1
"BLD",6673,4,51,2,51,0)
MEDICATION INSTRUCTION  (File-top level)
"BLD",6673,4,51,2,51,1,0)
^9.6411^.01^1
"BLD",6673,4,51,2,51,1,.01,0)
NAME
"BLD",6673,4,51,222)
y^n^p^^^^n^^n
"BLD",6673,4,51,224)

"BLD",6673,4,"APDD",51,51)

"BLD",6673,4,"APDD",51,51,.01)

"BLD",6673,4,"B",51,51)

"BLD",6673,"ABPKG")
n
"BLD",6673,"INIT")
EN^PSSP110
"BLD",6673,"KRN",0)
^9.67PA^8989.52^19
"BLD",6673,"KRN",.4,0)
.4
"BLD",6673,"KRN",.401,0)
.401
"BLD",6673,"KRN",.402,0)
.402
"BLD",6673,"KRN",.403,0)
.403
"BLD",6673,"KRN",.5,0)
.5
"BLD",6673,"KRN",.84,0)
.84
"BLD",6673,"KRN",3.6,0)
3.6
"BLD",6673,"KRN",3.8,0)
3.8
"BLD",6673,"KRN",9.2,0)
9.2
"BLD",6673,"KRN",9.8,0)
9.8
"BLD",6673,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6673,"KRN",9.8,"NM",1,0)
PSSJSV^^0^B24822667
"BLD",6673,"KRN",9.8,"NM",2,0)
PSSP110^^0^B8043298
"BLD",6673,"KRN",9.8,"NM",3,0)
PSSDEE^^0^B91898198
"BLD",6673,"KRN",9.8,"NM","B","PSSDEE",3)

"BLD",6673,"KRN",9.8,"NM","B","PSSJSV",1)

"BLD",6673,"KRN",9.8,"NM","B","PSSP110",2)

"BLD",6673,"KRN",19,0)
19
"BLD",6673,"KRN",19.1,0)
19.1
"BLD",6673,"KRN",101,0)
101
"BLD",6673,"KRN",409.61,0)
409.61
"BLD",6673,"KRN",771,0)
771
"BLD",6673,"KRN",870,0)
870
"BLD",6673,"KRN",8989.51,0)
8989.51
"BLD",6673,"KRN",8989.52,0)
8989.52
"BLD",6673,"KRN",8994,0)
8994
"BLD",6673,"KRN","B",.4,.4)

"BLD",6673,"KRN","B",.401,.401)

"BLD",6673,"KRN","B",.402,.402)

"BLD",6673,"KRN","B",.403,.403)

"BLD",6673,"KRN","B",.5,.5)

"BLD",6673,"KRN","B",.84,.84)

"BLD",6673,"KRN","B",3.6,3.6)

"BLD",6673,"KRN","B",3.8,3.8)

"BLD",6673,"KRN","B",9.2,9.2)

"BLD",6673,"KRN","B",9.8,9.8)

"BLD",6673,"KRN","B",19,19)

"BLD",6673,"KRN","B",19.1,19.1)

"BLD",6673,"KRN","B",101,101)

"BLD",6673,"KRN","B",409.61,409.61)

"BLD",6673,"KRN","B",771,771)

"BLD",6673,"KRN","B",870,870)

"BLD",6673,"KRN","B",8989.51,8989.51)

"BLD",6673,"KRN","B",8989.52,8989.52)

"BLD",6673,"KRN","B",8994,8994)

"BLD",6673,"QUES",0)
^9.62^^
"BLD",6673,"REQB",0)
^9.611^2^2
"BLD",6673,"REQB",1,0)
PSS*1.0*59^2
"BLD",6673,"REQB",2,0)
PSS*1.0*90^2
"BLD",6673,"REQB","B","PSS*1.0*59",1)

"BLD",6673,"REQB","B","PSS*1.0*90",2)

"FIA",51)
MEDICATION INSTRUCTION
"FIA",51,0)
^PS(51,
"FIA",51,0,0)
51I
"FIA",51,0,1)
y^n^p^^^^n^^n
"FIA",51,0,10)

"FIA",51,0,11)

"FIA",51,0,"RLRO")

"FIA",51,0,"VR")
1.0^PSS
"FIA",51,51)
1
"FIA",51,51,.01)

"INIT")
EN^PSSP110
"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,20,0)
^9.402P^^
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
110^3060614
"PKG",488,22,1,"PAH",1,1,0)
^^3^3^3060614
"PKG",488,22,1,"PAH",1,1,1,0)
1) Only allow uppercase alphabet for the NAME field in files #51.1
"PKG",488,22,1,"PAH",1,1,2,0)
and #51.
"PKG",488,22,1,"PAH",1,1,3,0)
2) Allow elligible drugs to be marked for 'OP External Dispense'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSSDEE")
0^3^B91898198^B90165251
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ;01/21/00
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90,110**;9/30/97
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;
"RTN","PSSDEE",9,0)
BEGIN S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",10,0)
DONE D ^PSSDEE2 K PSSFLAG Q
"RTN","PSSDEE",11,0)
ASK W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",12,0)
 S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",13,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",14,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG
"RTN","PSSDEE",15,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",16,0)
 ; run the new routine and create message
"RTN","PSSDEE",17,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU S XX=""
"RTN","PSSDEE",18,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",19,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",20,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",21,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",22,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG) K FLG3,PSSNEW
"RTN","PSSDEE",23,0)
 Q
"RTN","PSSDEE",24,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",25,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",26,0)
 Q
"RTN","PSSDEE",27,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"." S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",28,0)
 Q
"RTN","PSSDEE",29,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",30,0)
 Q
"RTN","PSSDEE",31,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",32,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",33,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",34,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",35,0)
 I %=1 D RSET^PSSDEE1,EN1^PSSUTIL(DISPDRG,1) S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",36,0)
 Q
"RTN","PSSDEE",37,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",38,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",39,0)
 Q
"RTN","PSSDEE",40,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",41,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",42,0)
 Q
"RTN","PSSDEE",43,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",44,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",45,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",46,0)
 Q
"RTN","PSSDEE",47,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",48,0)
 Q
"RTN","PSSDEE",49,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",52,0)
 Q
"RTN","PSSDEE",53,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",54,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",55,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",56,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",57,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",58,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",59,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",60,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",61,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",62,0)
 W !
"RTN","PSSDEE",63,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",64,0)
 I FLGKY'=1 D
"RTN","PSSDEE",65,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",66,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",67,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",68,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",69,0)
 Q
"RTN","PSSDEE",70,0)
 ;
"RTN","PSSDEE",71,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",72,0)
 N CHECK,I,C
"RTN","PSSDEE",73,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",74,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",75,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",76,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",77,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",78,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",79,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",80,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",81,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",82,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",83,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",84,0)
 Q CHECK
"RTN","PSSDEE",85,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",86,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",87,0)
 Q
"RTN","PSSDEE",88,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",89,0)
 Q
"RTN","PSSDEE",90,0)
OP I FLG1 D
"RTN","PSSDEE",91,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",92,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",93,0)
 . I %=1 D
"RTN","PSSDEE",94,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",95,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",96,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",97,0)
 Q
"RTN","PSSDEE",98,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",99,0)
 Q
"RTN","PSSDEE",100,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",101,0)
 Q
"RTN","PSSDEE",102,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",103,0)
 Q
"RTN","PSSDEE",104,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",105,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",106,0)
 K PSSIVOUT
"RTN","PSSDEE",107,0)
 Q
"RTN","PSSDEE",108,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",109,0)
 Q
"RTN","PSSDEE",110,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",111,0)
 Q
"RTN","PSSDEE",112,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",113,0)
 Q
"RTN","PSSDEE",114,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",115,0)
 Q
"RTN","PSSDEE",116,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",117,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",118,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",119,0)
 Q
"RTN","PSSDEE",120,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",121,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",122,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",123,0)
 Q
"RTN","PSSDEE",124,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",125,0)
 Q
"RTN","PSSDEE",126,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",127,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",128,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",129,0)
 Q
"RTN","PSSDEE",130,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",131,0)
 Q
"RTN","PSSDEE",132,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",133,0)
 I PACK'="" D
"RTN","PSSDEE",134,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",135,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",136,0)
 .D USE1
"RTN","PSSDEE",137,0)
 Q
"RTN","PSSDEE",138,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",139,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",140,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",141,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",142,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",143,0)
 Q
"RTN","PSSDEE",144,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",145,0)
 Q
"RTN","PSSDEE",146,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",147,0)
 Q
"RTN","PSSDEE",148,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",149,0)
 Q
"RTN","PSSDEE",150,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",151,0)
 Q
"RTN","PSSDEE",152,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",153,0)
 Q
"RTN","PSSDEE",154,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",155,0)
 Q
"RTN","PSSDEE",156,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",157,0)
 Q
"RTN","PSSDEE",158,0)
OPEI N PSDRUGND
"RTN","PSSDEE",159,0)
 S PSDRUGND=$G(^PSDRUG(DISPDRG,"ND"))
"RTN","PSSDEE",160,0)
 I PSDRUGND']"" Q
"RTN","PSSDEE",161,0)
 I $P(PSDRUGND,"^",3)']"",$P(PSDRUGND,"^",10)']"" Q
"RTN","PSSDEE",162,0)
 I $P(PSDRUGND,"^",10)]"" G OPEI1
"RTN","PSSDEE",163,0)
 I $P($G(^PSNDF(50.68,$P(PSDRUGND,"^",3),1)),"^",2)]"" G OPEI1
"RTN","PSSDEE",164,0)
 Q
"RTN","PSSDEE",165,0)
OPEI1 ;
"RTN","PSSDEE",166,0)
 S DIE="^PSDRUG(",DR="28",DA=DISPDRG
"RTN","PSSDEE",167,0)
 D ^DIE
"RTN","PSSDEE",168,0)
 Q
"RTN","PSSDEE",169,0)
DEA ;
"RTN","PSSDEE",170,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",171,0)
 Q
"RTN","PSSDEE",172,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",173,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",174,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",175,0)
 Q
"RTN","PSSJSV")
0^1^B24822667^B24455142
"RTN","PSSJSV",1,0)
PSSJSV ;BIR/CML3/WRT-SCHEDULE VALIDATION ;06/24/96
"RTN","PSSJSV",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**20,38,56,59,110**;9/30/97
"RTN","PSSJSV",3,0)
 ;
"RTN","PSSJSV",4,0)
 ; Reference to ^PS(51.15 is supported by DBIA #2132
"RTN","PSSJSV",5,0)
 ; Reference to $$UP^XLFSTR(P1) is supported by DBIA #10104
"RTN","PSSJSV",6,0)
 ;
"RTN","PSSJSV",7,0)
EN ;
"RTN","PSSJSV",8,0)
 S X=PSJX,(PSJAT,PSJM,PSJTS,PSJY,PSJAX)="" I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X," ")>2:1,$L(X)>70:1,$L(X)<1:1,X["P RN":1,1:X["PR N") K PSJX,X Q
"RTN","PSSJSV",9,0)
 I X["PRN"!(X="ON CALL")!(X="ONCALL")!(X="ON-CALL") G DONE
"RTN","PSSJSV",10,0)
 I X?1."?" D:'$D(PSJNE) ENSVH^PSSJSV0 Q
"RTN","PSSJSV",11,0)
 S X0=X,(XT,Y)="" I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) PSJAT=X G DONE
"RTN","PSSJSV",12,0)
 I X["@" D DW S:$D(X) PSJAT=$P(X,"@",2) G DONE
"RTN","PSSJSV",13,0)
 I $S($D(^PS(51.1,"AC",PSJPP,X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC G:$S(PSJY:PSJTS'="C",1:PSJM) DONE
"RTN","PSSJSV",14,0)
 I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="ONETIME":1,X="1TIME":1,X="1-TIME":1,X="1 TIME":1,1:X="ONE-TIME") S PSJTS="O" W:'$D(PSJNE) "  (ONCE ONLY)" G DONE
"RTN","PSSJSV",15,0)
 S:PSJTS="" PSJTS="C" I PSJAT="" W:'$D(PSJNE) "  (Non standard schedule)" S X=PSJX
"RTN","PSSJSV",16,0)
 I $E(X,1,2)="AD" K X G DONE
"RTN","PSSJSV",17,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S PSJM=1440\$F("BTQ",$E(X)) G DONE
"RTN","PSSJSV",18,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=X1,X=$E(X,2,99) I 'X2,$E(X)="O" S X2=.5,X=$E(X,2,99)
"RTN","PSSJSV",19,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,PSJAT="" K X G DONE
"RTN","PSSJSV",20,0)
 S X=PSJX I XT S:X2 XT=XT\X2 S:'X2 XT=XT*X1
"RTN","PSSJSV",21,0)
 S PSJM=XT
"RTN","PSSJSV",22,0)
 ;
"RTN","PSSJSV",23,0)
DONE ;
"RTN","PSSJSV",24,0)
 K:$D(X)[0 PSJX K D,DIC,Q,QX,SDW,SWD,X,X0,X1,X2,XT,Y,Z Q
"RTN","PSSJSV",25,0)
 ;
"RTN","PSSJSV",26,0)
ENCHK ; admin times
"RTN","PSSJSV",27,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSSJSV",28,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSSJSV",29,0)
 S X(1)=$L(X(1)) F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$S(X(1)=2:24,1:2400):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSSJSV",30,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSSJSV",31,0)
 ;
"RTN","PSSJSV",32,0)
DIC ; 51.1 look-up
"RTN","PSSJSV",33,0)
 S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSJNE))_"ISZ",DIC("W")="I '$D(PSJNE) D DICW^PSSJSV0",D="AP"_PSJPP
"RTN","PSSJSV",34,0)
 D IX^DIC K DIC Q:Y'>0  S PSJY=+Y,(PSJX,X,X0)=Y(0,0),PSJM=$P(Y(0),"^",3),PSJTS=$P(Y(0),"^",5),PSJAX=$P(Y(0),U,7) S:PSJTS="" PSJTS="C" Q:PSJTS="O"!(PSJTS["R")  I $D(PSJW),$D(^PS(51.1,+Y,1,+PSJW,0)) S PSJAT=$P(^(0),"^",PSJTS="S"+2)
"RTN","PSSJSV",35,0)
 E  S PSJAT=$P(Y(0),"^",PSJTS="S"*4+2)
"RTN","PSSJSV",36,0)
 Q:PSJTS'="S"
"RTN","PSSJSV",37,0)
 F Y=1:1:$L(PSJAT,"-") S Y(1)=$P(PSJAT,"-",Y),PSJAT(Y(1))="",Y(2)=$O(^PS(51.15,"ACP",PSJPP,Y(1),0)) I Y(2),$D(^PS(51.15,Y(2),0)) S PSJAT(Y(1))=$P(^(0),"^",3) I $D(PSJW),$D(^(1,PSJW,0)),$P(^(0),"^",2)]"" S PSJAT(Y(1))=$P(^(0),"^",2)
"RTN","PSSJSV",38,0)
 Q
"RTN","PSSJSV",39,0)
 ;
"RTN","PSSJSV",40,0)
DW ;  week days
"RTN","PSSJSV",41,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)  S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSSJSV",42,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSSJSV",43,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSSJSV",44,0)
DWC I $L(Z)<2 K X Q
"RTN","PSSJSV",45,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSSJSV",46,0)
 E  K X
"RTN","PSSJSV",47,0)
 Q
"RTN","PSSJSV",48,0)
 ;
"RTN","PSSJSV",49,0)
ENSNV ; schedule name
"RTN","PSSJSV",50,0)
 I $S(X["""":1,$A(X)=45:1,X'?.ANP:1,$L(X)>20:1,$L(X)<2:1,1:X?1P.E) K X Q
"RTN","PSSJSV",51,0)
 I $S('$D(PSJPP):0,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X
"RTN","PSSJSV",52,0)
 I $D(DA),$D(^PS(51.1,DA,0)),$P(^(0),"^",5)["D" S ZX=X D DNVX S:$D(X) X=ZX K Z1,Z2,Z3,Z4,ZX
"RTN","PSSJSV",53,0)
 Q
"RTN","PSSJSV",54,0)
 ;
"RTN","PSSJSV",55,0)
ENSHV ;  shift in 51.1
"RTN","PSSJSV",56,0)
 I $S($L(X)>11:1,$L(X)<1:1,'$D(PSJPP):1,PSJPP="":1,PSJPP'?.ANP:1,1:'$$VERSION^XPDUTL(PSJPP)) K X Q
"RTN","PSSJSV",57,0)
 F X(1)=1:1:$L(X,"-") S X(2)=$P(X,"-",X(1)) I $S(X(2)="":1,X(2)'?.ANP:1,1:'$D(^PS(51.15,"ACP",PSJPP,X(2)))) K X Q
"RTN","PSSJSV",58,0)
 K X(1),X(2) Q
"RTN","PSSJSV",59,0)
 ;
"RTN","PSSJSV",60,0)
ENVSST ;  shift start/stop times
"RTN","PSSJSV",61,0)
 I X'?2N1"-"2N,X'?4N1"-"4N K X Q
"RTN","PSSJSV",62,0)
 F X(1)=1,2 I $P(X,"-",X(1))>$S($L($P(X,"-",X(1)))<4:24,1:2400) K X Q
"RTN","PSSJSV",63,0)
 K X(1) Q
"RTN","PSSJSV",64,0)
 ;
"RTN","PSSJSV",65,0)
ENFQD ; frequency default
"RTN","PSSJSV",66,0)
 N X1,X2,Z S Z=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:""),X=""
"RTN","PSSJSV",67,0)
 S X=$P(Z,"^",3) I Z]"" Q
"RTN","PSSJSV",68,0)
 S Z=DA I $E(Z,1,2)="AD" Q
"RTN","PSSJSV",69,0)
 I $E(Z,1,3)="BID"!($E(Z,1,3)="TID")!($E(Z,1,3)="QID") S X=1440/$F("BTQ",$E(Z)) Q
"RTN","PSSJSV",70,0)
 E  S:$E(Z)="Q" Z=$E(Z,2,99) S:'Z Z="1"_Z S X1=+Z,Z=$P(Z,+Z,2),X2=0 S:$E(Z)="X" X2=X1,Z=$E(Z,2,99) I 'X2,$E(Z)="O" S X2=.5,Z=$E(Z,2,99)
"RTN","PSSJSV",71,0)
 S X=$S(Z["'":1,(Z["D"&(Z'["AD"))!(Z["AM")!(Z["PM")!(Z["HS"&(Z'["THS")):1440,Z["H"&(Z'["TH"):60,Z["AC"!(Z["PC"):480,Z["W":10080,Z["M":40320,1:"") Q:'X  S:X2 X=X\X2 S:'X2 X=X*X1 Q
"RTN","PSSJSV",72,0)
 ;
"RTN","PSSJSV",73,0)
ENDNV ; day of the week name
"RTN","PSSJSV",74,0)
 N Z1,Z2,Z3,Z4 S X=$S($D(^PS(51.1,DA,0)):$P(^(0),"^"),1:"") I X="" K X Q
"RTN","PSSJSV",75,0)
 ;
"RTN","PSSJSV",76,0)
DNVX S Z2=1,Z4="-" I X'["-",X?.E1P.E F Z1=1:1:$L(X) I $E(X,Z1)?1P S Z4=$E(X,Z1) Q
"RTN","PSSJSV",77,0)
 F Z1=1:1:$L(X,Z4) Q:'Z2  S Z2=0 I $L($P(X,Z4,Z1))>1 F Z3="MONDAYS","TUESDAYS","WEDNESDAYS","THURSDAYS","FRIDAYS","SATURDAYS","SUNDAYS" I $P(Z3,$P(X,Z4,Z1))="" S Z2=1 Q
"RTN","PSSJSV",78,0)
 K:'Z2 X S:Z2 X="D" Q
"RTN","PSSJSV",79,0)
ENPSJ ;validate schedule names for PSJ package
"RTN","PSSJSV",80,0)
 N A,B,I
"RTN","PSSJSV",81,0)
 S X=$$UP^XLFSTR(X)
"RTN","PSSJSV",82,0)
 I $G(PSJPP)'="PSJ" Q
"RTN","PSSJSV",83,0)
 S A=$TR(X,".","") I A="OTHER" K X Q
"RTN","PSSJSV",84,0)
 F I=1:1:$L(A," ") S B=$P(A," ",I) I B="QD"!(B="QOD")!(B="HS")!(B="TIW") K X
"RTN","PSSJSV",85,0)
 Q
"RTN","PSSP110")
0^2^B8043298^n/a
"RTN","PSSP110",1,0)
PSSP110 ; Post init routine for patch PSS*1*110 03/30/2006 4:57P
"RTN","PSSP110",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**110**;9/30/97
"RTN","PSSP110",3,0)
 Q
"RTN","PSSP110",4,0)
EN ; Entry point
"RTN","PSSP110",5,0)
 ; Convert the NAME field in files #51 & 51.1 to all CAPS
"RTN","PSSP110",6,0)
 ;
"RTN","PSSP110",7,0)
 N DD,D0,DA,DIE,DR,PSSI,PSSJ,PSSCNT,PSSTXT,PSSLN,PSSAST
"RTN","PSSP110",8,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,DIFROM,PSSFLG
"RTN","PSSP110",9,0)
 I $G(U)="" S U="^"
"RTN","PSSP110",10,0)
 S XMDUZ="PSS*1*110 Post Init",XMY(DUZ)=""
"RTN","PSSP110",11,0)
 ;
"RTN","PSSP110",12,0)
 ; File 51 (Medication Instruction)
"RTN","PSSP110",13,0)
 S DIE="^PS(51,"
"RTN","PSSP110",14,0)
 D CON
"RTN","PSSP110",15,0)
 S XMSUB="File #51 modified records"
"RTN","PSSP110",16,0)
 D MSG1
"RTN","PSSP110",17,0)
 ;
"RTN","PSSP110",18,0)
 ; File 51.1 (Administration Schedule)
"RTN","PSSP110",19,0)
 S DIE="^PS(51.1,"
"RTN","PSSP110",20,0)
 D CON
"RTN","PSSP110",21,0)
 S XMSUB="File #51.1 modified records"
"RTN","PSSP110",22,0)
 D MSG1
"RTN","PSSP110",23,0)
 ;
"RTN","PSSP110",24,0)
 ; File 51.2 (Medication Routes)
"RTN","PSSP110",25,0)
 ;S XMSUB="File #51.2 'to be' modified records"
"RTN","PSSP110",26,0)
 ;D COM
"RTN","PSSP110",27,0)
 G ENQ
"RTN","PSSP110",28,0)
 ;
"RTN","PSSP110",29,0)
CON ; Convert ONLY lowercase alphabet to uppercase.  All other characters
"RTN","PSSP110",30,0)
 ; in the NAME field are left alone.
"RTN","PSSP110",31,0)
 S PSSI="",PSSCNT=0,PSSLN=2,PSSFLG=""
"RTN","PSSP110",32,0)
 F  S PSSI=$O(@(DIE_"""B"""_",PSSI)")) Q:PSSI=""  D
"RTN","PSSP110",33,0)
 . I PSSI'?.E1L.E Q  ; No lowercase in the NAME, no need to convert
"RTN","PSSP110",34,0)
 . S PSSJ=$$UP^XLFSTR(PSSI),PSSAST="*"
"RTN","PSSP110",35,0)
 . I '$O(@(DIE_"""B"""_",PSSJ,0)")) D
"RTN","PSSP110",36,0)
 . . S DA=$O(@(DIE_"""B"""_",PSSI,0)")),DR=".01///"_PSSJ
"RTN","PSSP110",37,0)
 . . D ^DIE
"RTN","PSSP110",38,0)
 . . S PSSAST=""
"RTN","PSSP110",39,0)
 . E  S PSSFLG=1
"RTN","PSSP110",40,0)
 . S PSSCNT=PSSCNT+1
"RTN","PSSP110",41,0)
 . S PSSLN=PSSLN+1,PSSTXT(PSSLN)=PSSAST_PSSI
"RTN","PSSP110",42,0)
 Q
"RTN","PSSP110",43,0)
COM ; Compile a list of all medication routes that do NOT
"RTN","PSSP110",44,0)
 ; have an abbreviation and send it to DUZ.
"RTN","PSSP110",45,0)
 S PSSI="",PSSCNT=0,PSSLN=2
"RTN","PSSP110",46,0)
 F  S PSSI=$O(^PS(51.2,PSSI)) Q:PSSI']""  D
"RTN","PSSP110",47,0)
 . I '$D(^PS(51.2,PSSI,0)) Q
"RTN","PSSP110",48,0)
 . S PSSJ=$G(^PS(51.2,PSSI,0))
"RTN","PSSP110",49,0)
 . I $P(PSSJ,U,3)']"" D
"RTN","PSSP110",50,0)
 . . S PSSCNT=PSSCNT+1,PSSLN=PSSLN+1
"RTN","PSSP110",51,0)
 . . S PSSTXT(PSSLN)=$P(PSSJ,U,1)
"RTN","PSSP110",52,0)
 I PSSCNT<1 D  Q
"RTN","PSSP110",53,0)
 . S PSSTXT(1)="All medication routes have abbreviations!"
"RTN","PSSP110",54,0)
 . D SEND
"RTN","PSSP110",55,0)
 S PSSTXT(1)="The following medication route/s does/do not"
"RTN","PSSP110",56,0)
 S PSSTXT(2)="have a corresponding abbreviation:"
"RTN","PSSP110",57,0)
 D SEND
"RTN","PSSP110",58,0)
 Q
"RTN","PSSP110",59,0)
MSG1 ; Send message to user DUZ for files 51 & 51.1
"RTN","PSSP110",60,0)
 I PSSCNT<1 D  Q
"RTN","PSSP110",61,0)
 . S PSSTXT(1)="No NAME conversion was neccessary!"
"RTN","PSSP110",62,0)
 . D SEND
"RTN","PSSP110",63,0)
 S PSSTXT(1)="The following NAME/s was/were converted"
"RTN","PSSP110",64,0)
 S PSSTXT(2)="from lowercase to uppercase:"
"RTN","PSSP110",65,0)
 I PSSFLG=1 D
"RTN","PSSP110",66,0)
 . S PSSLN=PSSLN+1
"RTN","PSSP110",67,0)
 . S PSSTXT(PSSLN)="Record/s marked with an '*' was/were skipped."
"RTN","PSSP110",68,0)
 . S PSSLN=PSSLN+1
"RTN","PSSP110",69,0)
 . S PSSTXT(PSSLN)="Conversion to uppercase would have created a"
"RTN","PSSP110",70,0)
 . S PSSLN=PSSLN+1
"RTN","PSSP110",71,0)
 . S PSSTXT(PSSLN)="duplicate NAME.  Please check!!"
"RTN","PSSP110",72,0)
 D SEND
"RTN","PSSP110",73,0)
 Q
"RTN","PSSP110",74,0)
SEND ;
"RTN","PSSP110",75,0)
 S XMTEXT="PSSTXT(",XMDUZ="PSS*1*110 Post Init",XMY(DUZ)=""
"RTN","PSSP110",76,0)
 D ^XMD
"RTN","PSSP110",77,0)
 K PSSTXT
"RTN","PSSP110",78,0)
ENQ Q
"VER")
8.0^22.0
"^DD",51,51,.01,0)
NAME^RFX^^0;1^S X=$$UP^XLFSTR(X) K:$L(X)>9!($L(X)<1)!'(X?.ANP) X
"^DD",51,51,.01,1,0)
^.1
"^DD",51,51,.01,1,1,0)
51^B
"^DD",51,51,.01,1,1,1)
S ^PS(51,"B",X,DA)=""
"^DD",51,51,.01,1,1,2)
K ^PS(51,"B",X,DA)
"^DD",51,51,.01,1,2,0)
51^AIN^MUMPS
"^DD",51,51,.01,1,2,1)
I $P(^PS(51,DA,0),"^",4) S ^PS(51,"AI",X,DA)=""
"^DD",51,51,.01,1,2,2)
I $P(^PS(51,DA,0),"^",4) K ^PS(51,"AI",X,DA)
"^DD",51,51,.01,1,2,"%D",0)
^^2^2^2970926^^
"^DD",51,51,.01,1,2,"%D",1,0)
Sets intended use cross-ref.
"^DD",51,51,.01,1,2,"%D",2,0)
In the form of: ^PS(51,"AI",X,DA)
"^DD",51,51,.01,1,3,0)
51^A^MUMPS
"^DD",51,51,.01,1,3,1)
S X1=^PS(51,DA,0),%=$P(X1,"^",1) I %'="" S ^PS(51,"A",%)=$P(X1,"^",2)_"^"_$S($D(^PS(51,DA,9)):^(9),1:"")
"^DD",51,51,.01,1,3,2)
K ^PS(51,"A",X)
"^DD",51,51,.01,1,3,"%D",0)
^.101^3^3^3001010^^^^
"^DD",51,51,.01,1,3,"%D",1,0)
This cross reference uses the drug name to obtain the drug's expanded
"^DD",51,51,.01,1,3,"%D",2,0)
name and plural.
"^DD",51,51,.01,1,3,"%D",3,0)
In the form of: ^PS(51,"A",$P(^PS(51,DA,0),"^",1))
"^DD",51,51,.01,1,3,"DT")
3001010
"^DD",51,51,.01,3)
Answer must be 1-9 characters in length.
"^DD",51,51,.01,20,0)
^.3LA^1^1
"^DD",51,51,.01,20,1,0)
PS
"^DD",51,51,.01,21,0)
^.001^3^3^3060329^^^^
"^DD",51,51,.01,21,1,0)
  For inpatient pharmacy use, you may enter one of the following standard
"^DD",51,51,.01,21,2,0)
times or you may use a non-standard schedule when appropriate.  For
"^DD",51,51,.01,21,3,0)
example,  Q36H  or Q17H.
"^DD",51,51,.01,"DT")
3060403
"BLD",6673,6)
^103
**END**
**END**
